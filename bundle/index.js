function _assert_this_initialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _call_super(t,e,r){e=_get_prototype_of(e);return _possible_constructor_return(t,_is_native_reflect_construct()?Reflect.construct(e,r||[],_get_prototype_of(t).constructor):e.apply(t,r))}function _class_call_check(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(t,n.key,n)}}function _create_class(t,e,r){if(e)_defineProperties(t.prototype,e);if(r)_defineProperties(t,r);return t}function _get_prototype_of(t){_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)};return _get_prototype_of(t)}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:true,configurable:true}});if(e)_set_prototype_of(t,e)}function _possible_constructor_return(t,e){if(e&&("object"===_type_of(e)||"function"==typeof e))return e;return _assert_this_initialized(t)}function _set_prototype_of(t,e){_set_prototype_of=Object.setPrototypeOf||function(t,e){t.__proto__=e;return t};return _set_prototype_of(t,e)}function _type_of(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function _is_native_reflect_construct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_is_native_reflect_construct=function(){return!!t})()}var t=Object.defineProperty;var S=function(e,r,n){return r in e?t(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n};var h=function(e,r){return t(e,"name",{value:r,configurable:!0})};var i=function(t,e,r){return S(t,(void 0===e?"undefined":_type_of(e))!="symbol"?e+"":e,r)};System.register(["./core.js"],function(t,e){"use strict";var r,n;return{setters:[function(t){r=t.P,n=t.C}],execute:h(function(){var e=/*#__PURE__*/function(){function l(t,e){var r=this;_class_call_check(this,l);i(this,"options");i(this,"performance");i(this,"isRunning",!1);i(this,"checkTimer");i(this,"fpsHistory");i(this,"actualFPS",0);i(this,"start",h(function(){r.isRunning||(r.isRunning=!0,r.checkTimer=r.options.CheckInterval,r.fpsHistory=[])},"start"));i(this,"stop",h(function(){r.isRunning&&(r.isRunning=!1,r.options.OnlyUpdateWhenSwitchScene&&r.checkFps())},"stop"));i(this,"postStep",h(function(t){r.isRunning&&(r.checkTimer-=t,!(r.checkTimer>0)&&(r.checkTimer+=r.options.CheckInterval,r.fpsHistory.push(r.actualFPS),r.options.OnlyUpdateWhenSwitchScene||r.fpsHistory.length>=5&&r.checkFps()))},"postStep"));this.options=e,this.performance=t}_create_class(l,[{key:"checkFps",value:function(){if(0===this.fpsHistory.length)return;var t=!1;this.options.AutoUpgradeQuality&&this.isHighFps()&&(t=this.performance.upgradeGraphicsQuality()),this.isLowFps()&&(t=this.performance.downgradeGraphicsQuality()),t&&(this.fpsHistory=[])}},{key:"getFpsMedian",value:function(){return this.getMedian(this.fpsHistory)}},{key:"getMedian",value:function(t){if(0===t.length)return Number.NaN;var e=t.sort(function(t,e){return t-e}),r=Math.floor(e.length/2);return e.length%2===0?(e[r-1]+e[r])/2:e[r]}},{key:"isLowFps",value:function(){return this.getFpsMedian()<this.options.FpsThreshold}},{key:"isHighFps",value:function(){return this.getFpsMedian()>1.2*this.options.FpsThreshold}}]);return l}();h(e,"FpsTracker");var o=e;var s=/*#__PURE__*/function(t){_inherits(f,t);function f(){_class_call_check(this,f);var t;t=_call_super(this,f,arguments);i(t,"enabled",!1);i(t,"quality");i(t,"fpsTracker");i(t,"pixelRatio");i(t,"trackingSceneNames",[]);i(t,"trackingScene",h(function(e){if(t.trackingSceneNames.indexOf(e)<0){console.warn("\uD83D\uDEAB Adaptive performance: ".concat(e," is not configured"));return}t.stopFPSTracker(),t.startFPSTracker(),console.info("\uD83D\uDCC8 Adaptive performance: tracking ".concat(e))},"trackingScene"));i(t,"startFPSTracker",h(function(){t.fpsTracker.start()},"startFPSTracker"));i(t,"stopFPSTracker",h(function(){t.fpsTracker.stop()},"stopFPSTracker"));return t}_create_class(f,[{key:"configure",value:function(t){var e=t.Enabled,r=t.Quality,n=t.Options,o=t.TrackingSceneNames;this.enabled=e,this.quality=r,this.pixelRatio=window.devicePixelRatio,this.trackingSceneNames=o,this.createFPSTracker(n)}},{key:"getCurrentQuality",value:function(){return this.pixelRatio}},{key:"downgradeGraphicsQuality",value:function(){var t=this.quality,e=t.Min,r=t.AdjustStep,n=this.pixelRatio;if(n<=e)return!1;var o=+(n-r).toFixed(2);return!(o<e)&&(this.pixelRatio=o,this.resizeGameWorld(this.pixelRatio),console.warn("\uD83D\uDCAB Graphics quality was downgraded! (".concat(n," -> ").concat(o,")")),!0)}},{key:"upgradeGraphicsQuality",value:function(){var t=this.quality,e=t.Max,r=t.AdjustStep,n=this.pixelRatio;if(n>=e)return!1;var o=+(n+r).toFixed(2);return!(o>e)&&(this.pixelRatio=o,this.resizeGameWorld(this.pixelRatio),console.warn("\uD83D\uDE80 Graphics quality was upgraded! (".concat(n," -> ").concat(o,")")),!0)}},{key:"createFPSTracker",value:function(t){this.fpsTracker=new o(this,t)}},{key:"event",get:function(){return this.game.event}},{key:"resizeGameWorld",value:function(t){var e={forcePixelRatio:t};this.event.emit(n.REQUEST_RESIZE_GAME,e)}},{key:"updatePostStepDeltaTime",value:function(t){this.fpsTracker.postStep(t)}},{key:"updateActualFPS",value:function(t){this.fpsTracker.actualFPS=t}}]);return f}(r.Plugins.BasePlugin);h(s,"AdaptivePerformancePlugin");var a=s;t("default",a)},"execute")}});