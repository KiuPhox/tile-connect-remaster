const __vite__fileDeps=["./bundle/index.js","./bundle/core.js","./bundle/console.js","./bundle/__commonjsHelpers__.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var ho=Object.defineProperty;var tr=(u,e,t)=>e in u?ho(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var c=(u,e)=>ho(u,"name",{value:e,configurable:!0});var p=(u,e,t)=>tr(u,typeof e!="symbol"?e+"":e,t);import{G as f,P as C,M as er,_ as rt,a as k,C as at}from"./bundle/core.js";import{g as sr}from"./bundle/__commonjsHelpers__.js";c(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}c(t,"getFetchOpts");function s(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}c(s,"processPreload")},"polyfill")();const{Valid:yt,Object:nt,String:Ce,Json:uo}=f.Utils,Lt="is invalid",j=class j{static addDefaultData(e){yt.isObject(e)||this.prototype.exception("default data",Lt),e=uo.clone(e);const{name:t}=this;yt.isObject(j.data[t])||(j.data[t]={}),j.data[t]=nt.merge(j.data[t],e),console.info(`${t} default data:`,j.data[t])}static getDefaultData(){const{name:e}=this;return uo.clone(j.data[e])}static addValidateFunction(e,t){yt.isString(e)||this.prototype.exception("validate key",Lt),typeof t!="function"&&this.prototype.exception("validate function",Lt);const s=`validate${Ce.capitalize(e)}`;nt.assign(this.prototype,{[s]:t})}constructor(e){this.defaultData(),this.processData(e)}processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}defaultData(){const{name:e}=this.constructor;this.lazyDefaultData(j.data[e])}lazyDefaultData(e){yt.isObject(e)||this.exception("data",Lt);for(const t in e)if(nt.hasOwn(e,t)){const s=e[t];nt.assign(this,{[t]:s})}}lazyValidateStructure(e){yt.isObject(e)||this.exception("structure","is not object"),this.getKeys().forEach(t=>{const s=this[t];s===void 0&&this.exception("structure",`has no key ${t}`),!nt.hasOwn(e,t)&&s!==void 0&&this.setDefaultData(t,e)})}setDefaultData(e,t){yt.isObject(t)||this.exception("data",Lt);const s=this[e];s===void 0&&this.exception("default",`has no key ${e}`),nt.assign(t,{[e]:s})}lazyValidateData(e){this.getKeys().forEach(t=>{const s=e[t],a=Ce.removeDiacritics(t).replace(/[^a-zA-Z0-9]/g,""),n=`validate${Ce.capitalize(a)}`,i=this[n];if(typeof i=="function")try{i.call(this,s)}catch(o){console.warn(o),this.setDefaultData(t,e)}else this.exception("validate",`has no function ${n}`)})}lazySetupData(e){this.getKeys().forEach(t=>{const s=e[t];nt.assign(this,{[t]:s})})}validate(){this.validateData(this.toObject())}exception(e,t){throw new Error(`${this.constructor.name}: ${e} ${t}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([e])=>e!=="toObject"))}getKeys(){return Object.keys(this).filter(e=>e!=="toObject")}};c(j,"BaseDtos"),p(j,"data",{});let $=j;f.Dtos={Base:$};const ar={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded"},xt={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0}},{Valid:Ot}=f.Utils,{playerId:nr,name:ir,photo:or,locale:rr}=xt,Tt="is invalid",Na=class Na extends ${setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!Ot.isString(e)||!e)&&this.exception("_id",Tt)}validatePlayerId(e){(!Ot.isString(e)||!e)&&this.exception("playerId",Tt)}validateName(e){(!Ot.isString(e)||!e)&&this.exception("name",Tt)}validatePhoto(e){Ot.isString(e)||this.exception("photo",Tt)}validateLocale(e){(!Ot.isString(e)||!e)&&this.exception("locale",Tt)}toObject(){return super.toObject()}};c(Na,"PlayerInfoDtos");let Et=Na;Et.addDefaultData({playerId:nr,name:ir,photo:or,locale:rr});const X=new Et({playerId:"10",name:"Your Friend"}).toObject(),Ca=class Ca extends Error{constructor(t){super(t);p(this,"code");this.code="CREATE_MATCH_FAILED"}};c(Ca,"ACreateMatchFailed");let K=Ca;const La=class La extends K{constructor(e){super(e),this.name="PlayerIdNotValid",this.message=e??"Player id is not valid"}};c(La,"PlayerIdNotValid");let D=La;const{Dtos:Le,Utils:cr,Events:lr}=f,{Array:dr,Object:hr,Json:Oe,Valid:po}=cr,Oa=class Oa{constructor(e){p(this,"game");p(this,"initContext",c(()=>{const e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},t=new Le.Context.Info(e),{contextId:s,contextType:a,entryPointData:n}=t.toObject();this.game.context.receiveContext(s,a,n)},"initContext"));p(this,"initPlayer",c(async()=>{const{player:e}=this.game,t=this.getPlayerInfo();console.info("playerInfo",Oe.clone(t));const s=dr.unique(hr.vals(ar));console.info("dataKeys",s);const a=await GameSDK.player.getDataAsync(s);console.info("rawData",Oe.clone(a));const n=new Le.Player.Data(a).toObject();console.info("playerData",Oe.clone(n)),e.receiveData(t,n),this.game.event.emit(lr.PLAYER_INFO_LOADED)},"initPlayer"));p(this,"getPlayerInfo",c(()=>{try{const e=GameSDK.player.getID();let t=GameSDK.player.getName();const s=GameSDK.player.getPhoto(),a=GameSDK.getLocale();if(!po.isString(e))throw new D;return po.isString(t)||(t="You"),new Le.Player.Info({playerId:e,name:t,photo:s,locale:a}).toObject()}catch{return X}},"getPlayerInfo"));this.game=e}};c(Oa,"StateInitiator");let ke=Oa;const Ta=class Ta extends Error{constructor(t,s){super(t);p(this,"payload");this.name="BadRequest",this.message=t??"This request is bad",this.payload=s}};c(Ta,"BadRequest");let Ft=Ta;const Ma=class Ma extends Error{constructor(t,s){super(t);p(this,"payload");this.name="RequestTimeout",this.message=t??"This request is timeout",this.payload=s}};c(Ma,"RequestTimeout");let Ut=Ma;const{Utils:ur,Configs:pr}=f,{AppId:yo,Network:xa}=pr,yr=c(u=>{if(!u.ok)throw new Ft(void 0,{response:u})},"validateResponse"),Bo=c(()=>{const u=window.game.auth.getToken();return{token:u,timeout:xa.Timeout,headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}}},"defaultConfig"),jo=c((u,e,t,s)=>async()=>{try{if(!yo)throw new Ft("AppId is not defined");const a=`${u}/apps/${yo}/${e}`,n=new AbortController;t.signal=n.signal;const i=setTimeout(()=>{n.abort()},t.timeout);f.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const o=await fetch(a,t);return clearTimeout(i),yr(o),await o.json()||{}}catch(a){if(a instanceof Ft)return null;throw a instanceof Object&&"name"in a&&a.name==="AbortError"?new Ut:a}},"requester"),Ea=c(async(u,e)=>{try{return u()}catch(t){if(t instanceof Ut&&e>0)try{return await ur.Time.sleepAsync(600),await Ea(u,e-1)}catch{return{}}return t instanceof Ut?{}:(console.warn("Request error",t),{})}},"handleRequest"),At=c(async(u,e={},t,s=xa.Retries)=>{try{const a={...Bo(),...e,method:"GET"},n=jo(t,u,a);return await Ea(n,s)}catch(a){return console.warn("Get error",a),{}}},"get"),R=c(async(u,e,t={},s,a=xa.Retries)=>{try{const n={...Bo(),...t,method:"POST"},i=jo(s,u,n,e);return await Ea(i,a)}catch(n){return console.warn("Post error",n),{}}},"post"),{ApiUrl:fr}=f.Configs.Notification,gr=c(async u=>{if(!f.Utils.Object.hasOwn(u,"playerId"))throw new Error("Missing playerId");const{playerId:e}=u;await R(`players/${e}`,u,{},fr,10)},"updatePlayerProfileNotificationAsync");var Ko=(u=>(u.IDLE="idle",u.LOADING="loading",u.FILLED="filled",u.SHOWING="showing",u))(Ko||{});const Wo=Ko;var zo=(u=>(u.BANNER="banner",u.INTERSTITIAL="interstitial",u.REWARDED_VIDEO="rewarded_video",u))(zo||{});const Q=zo;var It;let $t=(It=class extends Error{constructor(t,s){super(s);p(this,"code");this.code=t,this.message=s}},c(It,"AdError"),It);const Ra=class Ra{constructor(e,t){p(this,"type");p(this,"status");p(this,"placementId");this.type=e,this.status=Wo.IDLE,this.placementId=t}getStatus(){return this.status}exception(e){throw new $t("AD_INSTANCE_ERROR",e)}};c(Ra,"BaseInstance");let Be=Ra;var Dt;let Ho=(Dt=class extends Be{loadAsync(){this.exception("This method is not implemented")}showAsync(){this.exception("This method is not implemented")}hideAsync(){this.exception("Unsupported method")}},c(Dt,"AdInstance"),Dt);f.Plugins.Ads={Types:Q,Status:Wo,AdError:$t,AdInstance:Ho};const{Array:Te,Object:wr}=f.Utils,_a=class _a extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"enabled");p(this,"config");p(this,"lastCallAdShownTime");p(this,"isAdFullSizeShowed");p(this,"ads",{});p(this,"safeAreaBottom")}init(){this.lastCallAdShownTime=0,this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}calculateSafeAreaBottom(){try{const t=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(t,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(t){this.config=t,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new $t("ADS_NOT_ENABLED","Ads is't enabled")}isAdFullSizeShowing(){return this.isAdFullSizeShowed}setAdInstance(t,s,a){if(this.ads[s]){console.warn(`AdsPlugin: Ad instance with placementId ${s} already exists`);return}this.ads[s]={type:t,placementId:s,interval:null,instance:new a(t,s)}}async preloadInterstitialAdAsync(){await this.loadAdAsync(Q.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new $t("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(Q.INTERSTITIAL)}async preloadRewardedVideoAsync(){await this.loadAdAsync(Q.REWARDED_VIDEO)}async showRewardedVideoAsync(){await this.showAdAsync(Q.REWARDED_VIDEO)}async loadAdAsync(t,s){this.checkEnabled(),await this.getAd(t,s).instance.loadAsync()}async showAdAsync(t,s){this.checkEnabled();const{event:a}=this.game,n=this.getAd(t,s);this.lastCallAdShownTime=window.performance.now()/1e3;try{a.emit(f.Events.AD_SHOWING,{placementId:s}),this.isAdFullSizeShowed=!0,await n.instance.showAsync()}finally{a.emit(f.Events.AD_CLOSED,{placementId:s}),this.isAdFullSizeShowed=!1}}getAdStatus(t,s){return this.checkEnabled(),this.getAd(t,s).instance.getStatus()}getAd(t,s){let a=null;if(s?a=this.getAdByPlacementId(s):a=this.getPriorityAdByType(t),!a)throw new $t("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return a}getAdsByType(t){return wr.vals(this.ads).filter(s=>s.type===t)}getAdByPlacementId(t){const s=this.ads[t];return s||null}getPriorityAdByType(t){const s=this.getAdsByType(t);if(!s.length)return null;const a=Te.search(s,n=>n.type===t);return a||null}canbeShowInterstitialAd(t){return this.canbeShowInterstitialAdByTime(t)}canbeShowInterstitialAdByTime(t){try{const s=window.performance.now()/1e3;let a;if(t)a=this.getCommonAdConfig(t);else{const d=this.getPriorityAdByType(Q.INTERSTITIAL);if(!d)return!1;a=this.getCommonAdConfig(d.placementId)}const{SecondsBetweenAds:n,SecondsFirstTime:i}=a,o=s-this.lastCallAdShownTime,r=o>n,l=o>i;return this.lastCallAdShownTime>0?r:l}catch(s){return console.warn("Error while checking canbeShowInterstitialAdByTime",s),!1}}canbeShowBannerAd(t){try{const s=this.getBannerConfig(t),{Platform:a}=s;if(a==="ALL")return!0;const n=GameSDK.getPlatform();return n?n===a:!1}catch(s){return console.warn("Error while checking canbeShowBannerAd",s),!1}}async showBannerAdAsync(t){this.checkEnabled();const s=this.getAd(Q.BANNER,t);if(!this.canbeShowBannerAd(s.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(s.placementId),await s.instance.showAsync();const{event:a}=this.game;a.emit(f.Events.AD_SHOWING,{placementId:t});const n=this.getBannerConfig(s.placementId),{SecondsReload:i}=n;i<=0||(s.interval=setTimeout(()=>{this.showBannerAdAsync(s.placementId)},i*1e3))}async hideBannerAdAsync(t){this.checkEnabled();const s=this.getAd(Q.BANNER,t);this.cleanBannerReloadTimer(s.placementId),await s.instance.hideAsync();const{event:a}=this.game;a.emit(f.Events.AD_CLOSED,{placementId:t})}cleanBannerReloadTimer(t){try{const s=this.getAd(Q.BANNER,t),{interval:a}=s;if(!a)return;clearInterval(a)}catch(s){console.warn("Error while cleaning banner reload timer",s)}}getCommonAdConfig(t){const s=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions],a=Te.search(s,n=>n.PlacementId===t);if(!a)throw new Error(`Ad config with placementId ${t} not found`);return a}getBannerConfig(t){const s=Te.search(this.config.BannerDisplayAdOptions,a=>a.PlacementId===t);if(!s)throw new Error(`Banner config with placementId ${t} not found`);return s}getBannerHeight(t,s,a=!0){this.checkEnabled();const n=this.getBannerConfig(t),i=GameSDK.getBannerHeight(n);return a?(i+this.safeAreaBottom)*s:i*s}getSafeAreaBottom(t){return this.safeAreaBottom*t}};c(_a,"AdsPlugin");let je=_a;var qo=(u=>(u.BUTTON_CLICK="button_click",u.SCREEN_OPEN="screen_open",u.LOAD_START="load_start",u.LOAD_COMPLETE="load_complete",u.GAME_SDK_READY="game_sdk_ready",u.APP_READY="app_ready",u.PAGE_VIEW="page_view",u.TUTORIAL_BEGIN="tutorial_begin",u.TUTORIAL_STEP="tutorial_step",u.TUTORIAL_COMPLETE="tutorial_complete",u.MATCH_START="match_start",u.MATCH_RESCUE="match_rescue",u.MATCH_END="match_end",u.LEVEL_START="level_start",u.LEVEL_RESCUE="level_rescue",u.LEVEL_END="level_end",u.SHARE="share",u.MESSAGE="message",u.INVITE="invite",u.SHORTCUT_CREATE="shortcut_create",u.SHORTCUT_CREATE_POPUP="shortcut_create_popup",u.BOT_SUBSCRIBE="bot_subscribe",u.BOT_SUBSCRIBE_POPUP="bot_subscribe_popup",u.AD_LOAD="ad_load",u.AD_LOAD_FAILED="ad_load_failed",u.AD_SHOW="ad_show",u.AD_SHOW_FAILED="ad_show_failed",u.AD_REWARD="ad_reward",u.AD_IMPRESSION="ad_impression",u.NEW_USER="new_user",u.JOIN_GROUP="join_group",u.TOURNAMENT_START="tournament_start",u.TOURNAMENT_SHARE="tournament_share",u.TOURNAMENT_CREATE="tournament_create",u.TOURNAMENT_POST_SCORE="tournament_post_score",u.GET_FREE_ITEM="get_free_item",u.USE_ITEM="use_item",u.EARN_ITEM="earn_item",u))(qo||{});const V=qo,{String:fo,Valid:mr}=f.Utils;var Pt;let Ar=(Pt=class{constructor(e,t,s){p(this,"game");p(this,"name");p(this,"color");p(this,"options");p(this,"selfLog");p(this,"currentPath");this.game=e,this.name=t,this.options=s,this.color=s.color||"#FFF",this.selfLog=s.log,this.currentPath="/",console.info(`%c${this.name}: init`,`color: ${this.color}`,this.options)}event(e,t){this.logInfo("event",{name:e,payload:t});const s=this.formatEventName(e);this.processEvent(s,t)}logInfo(e,t){this.selfLog&&console.info(`%c${this.name}: ${e}`,`color: ${this.color}`,t)}pageview(e){let t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),console.info("AnalyticsService: Page view",t),document.title=t,this.event(V.PAGE_VIEW,{page_title:t})}levelStart(e,t){this.event(V.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e)})}levelFail(e,t){this.event(V.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e)})}levelRescue(e,t){this.event(V.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e)})}levelComplete(e,t){this.event(V.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e)})}loadAdEvent(e,t){this.event(V.AD_LOAD,{ad_type:e,screen_name:t})}showAdEvent(e,t){this.event(V.AD_SHOW,{ad_type:e,screen_name:t}),this.event(V.AD_IMPRESSION,{ad_format:e})}loadInterstitialAd(e){this.loadAdEvent("interstitial",e)}showInterstitialAd(e){this.showAdEvent("interstitial",e)}loadRewardedVideoAd(e){this.loadAdEvent("rewarded_video",e)}showRewardedVideoAd(e){this.showAdEvent("rewarded_video",e)}receiveVideoReward(e){this.event(V.AD_REWARD,{screen_name:e})}loadAdFail(e,t){this.event(V.AD_LOAD_FAILED,{ad_type:e,screen_name:t})}showAdFail(e,t){this.event(V.AD_SHOW_FAILED,{ad_type:e,screen_name:t})}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}getLevelName(e){return`Level ${e}`}getPageTitle(e){const t=e.split("/").pop();if(!mr.isString(t))return e;const s=t.replace(/([-_\s.])/g," $1");return fo.toUpperCamelCase(s)}addGameModeToPageTitle(e){const{match:t}=this.game,s=t.getMatchState();let{mode:a}=s;return a||(a="Normal"),`${fo.toUpperCamelCase(a)}::${e}`}},c(Pt,"BaseAnalytics"),Pt);f.Plugins.Analytics={Events:V,BaseAnalytics:Ar};const $a=class $a extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"analytics",[]);p(this,"placement","unknown");p(this,"pageview",c(t=>{if(!this.isActive())return;this.placement=t;const s=this.getPageByKey(t);this.analytics.forEach(a=>{a.pageview(s)})},"pageview"))}add(t){this.analytics.some(a=>a.name===t.name)||this.analytics.push(t)}isActive(){return this.analytics.length>=1}event(t,s){this.isActive()&&this.analytics.forEach(a=>{a.event(t,s)})}levelStart(t,s){this.isActive()&&this.analytics.forEach(a=>{a.levelStart(t,s)})}levelRescue(t,s){this.isActive()&&this.analytics.forEach(a=>{a.levelRescue(t,s)})}levelFail(t,s){this.isActive()&&this.analytics.forEach(a=>{a.levelFail(t,s)})}levelComplete(t,s){this.isActive()&&this.analytics.forEach(a=>{a.levelComplete(t,s)})}loadInterstitialAd(){this.isActive()&&this.analytics.forEach(t=>{t.loadInterstitialAd(this.placement)})}showInterstitialAd(){this.isActive()&&this.analytics.forEach(t=>{t.showInterstitialAd(this.placement)})}loadRewardedVideoAd(){this.isActive()&&this.analytics.forEach(t=>{t.loadRewardedVideoAd(this.placement)})}showRewardedVideoAd(){this.isActive()&&this.analytics.forEach(t=>{t.showRewardedVideoAd(this.placement)})}receiveVideoReward(){this.isActive()&&this.analytics.forEach(t=>{t.receiveVideoReward(this.placement)})}loadAdFail(t){this.isActive()&&this.analytics.forEach(s=>{s.loadAdFail(t,this.placement)})}showAdFail(t){this.isActive()&&this.analytics.forEach(s=>{s.showAdFail(t,this.placement)})}getPageByKey(t){if(t.indexOf("_")>-1){let s=t.replace(/_/g,"-");return s=s.toLowerCase(),s}else{let s=t.length-1,a="";for(;s>0;){a=t.charAt(s);const n=isNaN(parseInt(a,10)),i=a===a.toUpperCase();n&&i&&(t=`${t.slice(0,s)}-${t.slice(s)}`),s--}return t.toLowerCase()}}};c($a,"AnalyticsPlugin");let Ke=$a;const Ga=class Ga{constructor(e){p(this,"key");this.key=e}getKey(){return this.key}};c(Ga,"BaseAudioPlayer");let We=Ga;const Va=class Va{constructor(e){p(this,"id");p(this,"isMuteAll");p(this,"masterVolume");p(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}setAudioClip(e,t){this.audioClips[e]={...this.audioClips[e],...t}}play(e,t){const s=this.getAudioClip(e);if(s){const{audioPlayer:a}=s;this.playWithRealConfig(a,t)}else this.loadAndPlay(e,t)}async loadAndPlay(e,t){try{const s=await this.onLoadAudio(e,t),{volume:a=1}=t||{};this.setAudioClip(e,{volume:a,audioPlayer:s}),this.playWithRealConfig(s,t)}catch(s){console.warn("playAudio",s)}}playWithRealConfig(e,t){if(t){const{volume:s=1}=t;t.volume=this.masterVolume*s}e.play(t)}pause(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.pause(),!0}resume(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.resume(),!0}stop(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(e,t){try{const{audioPlayer:s,volume:a=1}=e;switch(t){case"play":s.play();break;case"pause":s.pause();break;case"resume":s.resume();break;case"stop":s.stop();break;case"mute":s.setVolume(0);break;case"unmute":case"setVolume":s.setVolume(this.masterVolume*a);break;default:throw new Error(`Unsupported function: ${t}`)}}catch(s){console.warn("queueAudioPlayer",s)}}callAudioPlayers(e){const{Object:t}=f.Utils;t.vals(this.audioClips).forEach(a=>{this.queueAudioPlayer(a,e)})}};c(Va,"BaseChannelManager");let ze=Va;f.Plugins.Audio={BaseAudioPlayer:We,BaseChannelManager:ze};const Fa=class Fa extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"firstChannelId");p(this,"channels",{})}addChannel(t){const s=t.getId();this.channels[s]=t,this.firstChannelId||(this.firstChannelId=s)}getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];const s=this.channels[t];if(!s)throw new Error(`Channel ${t} not found`);return s}play(t,s,a){try{this.getChannel(a).play(t,s)}catch(n){console.warn("playSound",n)}}pause(t,s){try{this.getChannel(s).pause(t)}catch(a){console.warn("pauseSound",a)}}resume(t,s){try{this.getChannel(s).resume(t)}catch(a){console.warn("resumeSound",a)}}stop(t,s){try{this.getChannel(s).stop(t)}catch(a){console.warn("stopSound",a)}}stopAll(t){try{this.getChannel(t).stopAll()}catch(s){console.warn("stopAllSounds",s)}}mute(t){try{this.getChannel(t).muteAll()}catch(s){console.warn("mute",s)}}unmute(t){try{this.getChannel(t).unmuteAll()}catch(s){console.warn("unmute",s)}}setVolume(t,s){try{this.getChannel(s).setVolume(t)}catch(a){console.warn("setSoundVolume",a)}}};c(Fa,"AudioPlugin");let He=Fa;const Ir={token:"",isRequesting:!1},Ua=class Ua extends C.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("auth",Ir)}async requestToken(){const{storage:e}=this.game;try{if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return;e.setStorageData("auth","isRequesting",!0);const n=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();e.setStorageData("auth","token",n)}catch(t){if(f.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;e.setStorageData("auth","token",""),console.error(t)}finally{e.setStorageData("auth","isRequesting",!1)}}getToken(){const{storage:e}=this.game;return e.getStorageData("auth","token")}};c(Ua,"AuthPlugin");let qe=Ua;var Yo=(u=>(u.SOLO="solo",u.TOURNAMENT="tournament",u.SHARE_INVITE="share_invite",u.MATCHING_GROUP="matching_group_match",u.CHALLENGE_FRIEND="challenge_friend_match",u))(Yo||{});const kt=Yo,ct=er,{Array:td,Valid:Dr,Browser:Pr}=f.Utils,ka=class ka{constructor(e){p(this,"game");this.game=e}isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}isValidEntryPointData(e){return Dr.isObject(e)}isTournamentEntryPoint(e){return["facebook~game_list~tournaments","fb_feed_tournament_unit"].indexOf(e)>=0}receiveContext(e,t,s){const{storage:a}=this.game;a.setStorageData("context","contextId",e),this.isValidEntryPointData(s)?a.setStorageData("context","entryPointData",s):console.warn(`Invalid context type: ${t}`),this.isValidContextType(t)?a.setStorageData("context","contextType",t):console.warn(`Invalid context type: ${t}`)}async detectContextSessionType(){const{storage:e}=this.game,t=e.getStorageData("context","entryPointData"),{type:s}=t,{SOLO:a,TOURNAMENT:n,MATCHING_GROUP:i,SHARE_INVITE:o,CHALLENGE_FRIEND:r}=kt;let l=a;if(s===n&&(l=n),s===i&&(l=i),(s===r||s===o)&&(l=r),l===a){const d=Pr.getQueryParams().entry_point;if(d)l=this.isTournamentEntryPoint(d)?n:a;else try{if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");await GameSDK.getTournamentAsync(),l=n}catch{}}e.setStorageData("context","sessionContextType",l)}detectContextGameMode(){const{player:e,storage:t}=this.game,s=t.getStorageData("context","entryPointData"),a=t.getStorageData("context","sessionContextType"),n=e.getPlayerId(),{matchId:i,playerId:o,opponentId:r=X.playerId}=s,l=n===o,h=r===X.playerId||[r,o].indexOf(n)>=0,{TOURNAMENT:y,MATCHING_GROUP:g,SHARE_INVITE:m,CHALLENGE_FRIEND:I}=kt;let w=ct.SINGLE;a===y&&(w=ct.TOURNAMENT),a===m&&!l&&(w=ct.CHALLENGE_FRIEND),a===I&&i&&h&&(w=ct.CHALLENGE_FRIEND),a===g&&(w=ct.MATCHING_GROUP),t.setStorageData("context","contextGameMode",w)}};c(ka,"Context");let Ye=ka;const Ba=class Ba extends Error{constructor(e){super(e),this.name="PlayerHasFinishedMatch",this.message=e??"Player has finished match"}};c(Ba,"PlayerHasFinishedMatch");let le=Ba;const ja=class ja extends Error{constructor(e){super(e),this.name="PlayerNotJoinInMatch",this.message=e||"Player is not join in match"}};c(ja,"PlayerNotJoinInMatch");let Bt=ja;const{Events:Me,Plugins:xr}=f,{Analytics:Er}=xr,Ka=class Ka{constructor(e){p(this,"game");this.game=e}async processContextData(){const{player:e,analytics:t,storage:s}=this.game,a=s.getStorageData("context","contextId"),n=s.getStorageData("context","entryPointData"),i=s.getStorageData("context","sessionContextType"),{type:o,matchId:r,playerId:l,opponentId:d,playerScore:h}=n||{};console.info("isFirstLogin",e.isFirstLogin()),e.isFirstLogin()&&t.event(Er.Events.NEW_USER);const{TOURNAMENT:y,SHARE_INVITE:g,MATCHING_GROUP:m,CHALLENGE_FRIEND:I}=kt;if(i===y){try{await this.processTournamentModeAsync()}catch{await this.processSingleModeAsync()}return}if(i===I){if(o===g&&typeof l=="string"){await this.processChallengeFromPostAsync(l);return}if(o===I&&typeof r=="string"&&typeof l=="string"&&typeof d=="string"){await this.processChallengeFromMessageAsync({contextId:a,matchId:r,playerId:l,opponentId:d});return}}if(i===m&&typeof l=="string"&&typeof h=="number"){await this.processMatchingGroupModeAsync(l,h);return}if(e.isFirstLogin()){await this.processSingleModeAsync(),e.loggedIn();return}this.switchToDashboardScene()}async processTournamentModeAsync(){const{match:e,player:t}=this.game,s=t.getPlayerId(),a=GameSDK.context.getID();if(typeof a!="string")throw new Error("Cannot get contextId");await e.tournament.continue.processAsync({playerId:s,contextId:a}),this.switchToGameScene()}async processChallengeFromPostAsync(e){const{match:t,player:s}=this.game,a=s.getPlayerId();if(a===e)await t.single.start.processAsync({playerId:a});else try{await t.challenge.friend.processAsync({playerId:a,opponentId:e})}catch(i){console.warn("processChallengeFromPostAsync",i),await t.single.start.processAsync({playerId:a})}this.switchToGameScene()}async processChallengeFromMessageAsync(e){try{await this.processContinueChallengeFromMessageAsync(e)}catch(t){if(console.warn("processContinueChallengeFromMessageAsync",t),t instanceof le){await this.processAwaitChallengeFromMessageAsync(e);return}if(t instanceof Bt){await this.processJoinChallengeFromMessageAsync(e);return}this.switchToDashboardScene()}}async processContinueChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,{match:i,player:o}=this.game,r=o.getPlayerId();if(a===r)await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:r,opponentId:n});else{const d=n===X.playerId;await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:r,opponentId:d?n:a})}this.switchToGameScene()}async processJoinChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,o=i.getPlayerId();await n.challenge.join.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a}),this.switchToGameScene()}async processAwaitChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,o=i.getPlayerId();try{await n.challenge.await.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a}),this.switchToChallengeResultScene()}catch(r){console.warn("processAwaitChallengeFromMessageAsync",r),await this.processResultChallengeFromMessageAsync(e)}}async processResultChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,o=i.getPlayerId();try{await n.challenge.result.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a}),this.switchToChallengeResultScene()}catch{this.switchToDashboardScene()}}async processMatchingGroupModeAsync(e,t){const{match:s,player:a}=this.game;await s.group.join.processAsync({playerId:a.getPlayerId(),opponentId:e,opponentScore:t}),this.switchToGameScene()}async processSingleModeAsync(){const{match:e,player:t}=this.game,s=t.getPlayerId();await e.single.start.processAsync({playerId:s}),this.switchToGameScene()}switchToDashboardScene(){const{event:e}=this.game;e.emit(Me.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isMatchStartFromLoader:!0}})}switchToGameScene(){const{event:e}=this.game;e.emit(Me.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isMatchStartFromLoader:!0}})}switchToChallengeResultScene(){const{event:e}=this.game;e.emit(Me.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isMatchStartFromLoader:!0}})}};c(Ka,"Loader");let Qe=Ka;const Qo={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},{Events:Sr}=f,Wa=class Wa extends C.Plugins.BasePlugin{constructor(t){super(t);p(this,"context");p(this,"loader");this.loader=new Qe(t),this.context=new Ye(t)}init(){const{storage:t}=this.game;t.addStorage("context",Qo)}getSessionContextTypes(){return kt}async processContextData(){try{await this.loader.processContextData()}catch(t){console.error("processContextData",t),this.switchToDashboardScene()}}async detectContextSessionType(){try{await this.context.detectContextSessionType()}catch(t){console.error("detectContextSessionType",t)}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(t,s,a){this.context.receiveContext(t,s,a)}switchToDashboardScene(){const{event:t}=this.game;t.emit(Sr.SWITCH_SCENE,{sceneName:"DashboardScene"})}};c(Wa,"ContextPlugin");let Xe=Wa;const{Valid:Re}=f.Utils,{contextId:vr,contextType:br,entryPointData:Nr}=Qo,_e="is invalid",za=class za extends ${constructor(){super(...arguments);p(this,"data")}setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateContextId(t){Re.isString(t)||this.exception("contextId",_e)}validateContextType(t){(!Re.isString(t)||!t)&&this.exception("contextType",_e)}validateEntryPointData(t){Re.isObject(t)||this.exception("entryPointData",_e)}toObject(){return super.toObject()}};c(za,"ContextInfoDtos");let de=za;de.addDefaultData({contextId:vr,contextType:br,entryPointData:Nr});f.Dtos.Context={Info:de};const Cr={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},{Object:Lr}=f.Utils,Ha=class Ha{async getDailyRewardsAsync(){return Lr.vals(Cr)}};c(Ha,"DailyRewardsAPI");let Je=Ha;const Mt={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},Or={dailyRewards:{}},go=f.Configs.DailyRewards,qa=class qa extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"dailyRewardsApi",new Je)}init(){const{storage:t}=this.game;t.addStorage("dailyRewards",Or)}async requestDailyRewardsAsync(){const t=await this.dailyRewardsApi.getDailyRewardsAsync();t.length!==0&&this.receiveDailyRewards(t)}getDailyRewards(){const{storage:t}=this.game,s=t.getStorageData("dailyRewards","dailyRewards");return s||null}logLoginReward(){const{player:t}=this.game,{logDays:s}=t.getPlayerData().dailyRewarded,a=[...s];a[a.length-1]=!0,this.logDailyRewards(a)}logDailyRewards(t,s=!1){const{player:a}=this.game;a.setPlayerDataByName("dailyRewarded",{logDays:t,lastRewarded:s?0:Date.now()})}receiveDailyRewards(t){const{player:s}=this.game,{logDays:a,lastRewarded:n}=s.getPlayerData().dailyRewarded,i=new Date,o=new Date(n),r=new Date(o.toDateString()),l=Math.abs(i.valueOf()-r.valueOf()),h=Math.floor(l/864e5)>1,g=go.CheckInterrupt&&h||a.length>=go.MaxDays,m=g?[!1]:[...a,!1];this.logDailyRewards(m);const I=t.map((w,L)=>{const z=L<m.length,x=m.length===L+1,Ne=m[L]===!1;let B=Mt.WAITING;return x?B=Mt.READY:g?B=Mt.WAITING:z&&Ne?B=Mt.SKIPPED:z&&(B=Mt.REWARDED),{...w,status:B}});this.setDailyRewards(I)}setDailyRewards(t){const{storage:s}=this.game;s.setStorageData("dailyRewards","dailyRewards",t)}};c(qa,"DailyRewardsPlugin");let Ze=qa;var Sa={exports:{}};Sa.exports;(function(u){var e=Object.prototype.hasOwnProperty,t="~";function s(){}c(s,"Events"),Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function a(r,l,d){this.fn=r,this.context=l,this.once=d||!1}c(a,"EE");function n(r,l,d,h,y){if(typeof d!="function")throw new TypeError("The listener must be a function");var g=new a(d,h||r,y),m=t?t+l:l;return r._events[m]?r._events[m].fn?r._events[m]=[r._events[m],g]:r._events[m].push(g):(r._events[m]=g,r._eventsCount++),r}c(n,"addListener");function i(r,l){--r._eventsCount===0?r._events=new s:delete r._events[l]}c(i,"clearEvent");function o(){this._events=new s,this._eventsCount=0}c(o,"EventEmitter"),o.prototype.eventNames=c(function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},"eventNames"),o.prototype.listeners=c(function(l){var d=t?t+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var y=0,g=h.length,m=new Array(g);y<g;y++)m[y]=h[y].fn;return m},"listeners"),o.prototype.listenerCount=c(function(l){var d=t?t+l:l,h=this._events[d];return h?h.fn?1:h.length:0},"listenerCount"),o.prototype.emit=c(function(l,d,h,y,g,m){var I=t?t+l:l;if(!this._events[I])return!1;var w=this._events[I],L=arguments.length,z,x;if(w.fn){switch(w.once&&this.removeListener(l,w.fn,void 0,!0),L){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,d),!0;case 3:return w.fn.call(w.context,d,h),!0;case 4:return w.fn.call(w.context,d,h,y),!0;case 5:return w.fn.call(w.context,d,h,y,g),!0;case 6:return w.fn.call(w.context,d,h,y,g,m),!0}for(x=1,z=new Array(L-1);x<L;x++)z[x-1]=arguments[x];w.fn.apply(w.context,z)}else{var Ne=w.length,B;for(x=0;x<Ne;x++)switch(w[x].once&&this.removeListener(l,w[x].fn,void 0,!0),L){case 1:w[x].fn.call(w[x].context);break;case 2:w[x].fn.call(w[x].context,d);break;case 3:w[x].fn.call(w[x].context,d,h);break;case 4:w[x].fn.call(w[x].context,d,h,y);break;default:if(!z)for(B=1,z=new Array(L-1);B<L;B++)z[B-1]=arguments[B];w[x].fn.apply(w[x].context,z)}}return!0},"emit"),o.prototype.on=c(function(l,d,h){return n(this,l,d,h,!1)},"on"),o.prototype.once=c(function(l,d,h){return n(this,l,d,h,!0)},"once"),o.prototype.removeListener=c(function(l,d,h,y){var g=t?t+l:l;if(!this._events[g])return this;if(!d)return i(this,g),this;var m=this._events[g];if(m.fn)m.fn===d&&(!y||m.once)&&(!h||m.context===h)&&i(this,g);else{for(var I=0,w=[],L=m.length;I<L;I++)(m[I].fn!==d||y&&!m[I].once||h&&m[I].context!==h)&&w.push(m[I]);w.length?this._events[g]=w.length===1?w[0]:w:i(this,g)}return this},"removeListener"),o.prototype.removeAllListeners=c(function(l){var d;return l?(d=t?t+l:l,this._events[d]&&i(this,d)):(this._events=new s,this._eventsCount=0),this},"removeAllListeners"),o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,u.exports=o})(Sa);var Tr=Sa.exports;const Mr=sr(Tr),Z=new Mr,Rr={names:[],history:[]},Ya=class Ya extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"enableLog",!1);p(this,"muteEvents",[])}init(){const{storage:t}=this.game;t.addStorage("event",Rr)}enableLogEvent(){this.enableLog=!0}on(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"on","listening"),Z.on(t,s)}once(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"once","listening"),Z.once(t,s)}off(t,s){this.validateCallback(s),Z.off(t,s),this.addHistory(t,"any","removed")}mute(t){this.muteEvents.indexOf(t)>-1||this.muteEvents.push(t)}clear(t){Z.removeAllListeners(t),this.addHistory(t,"any","removed")}emit(t,s){if(this.muteEvents.indexOf(t)>-1)return;let a=[];s&&(a=[s]),this.addHistory(t,"any","called",s),Z.emit(t,...a)}validateCallback(t){if(typeof t!="function")throw new Error("Callback must be a function")}addEventName(t){const{storage:s}=this.game,a=s.getStorageData("event","names");a.indexOf(t)<0&&a.push(t)}getEventListeners(){const t=Z.eventNames();return Object.keys(t)}getHistory(){const{storage:t}=this.game;return t.getStorageData("event","history")}getEventEmitCount(t){return this.getHistory().filter(a=>a.name===t&&a.status==="called").length}getLastEventInfo(t){const s=this.getHistory();let a=null;for(let n=s.length-1;n>=0;n--)if(s[n].name===t){a=s[n];break}return a}getTypeFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.type)??null}getCallsFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.called)??0}addHistory(t,s,a,n){const o=this.getTypeFromHistory(t)??s,r=this.getCallsFromHistory(t),l=a==="called"?r+1:r;this.getHistory().push({type:o,status:a,name:t,called:l,payload:n??{}}),this.logEventInfo(t,o,a,l)}logEventInfo(t,s,a,n){if(this.enableLog){if(a==="listening"){console.info(`Event (${s}) ${t}: ${a}`);const i=Z.listenerCount(t);i>1&&console.warn(`Event ${t} has ${i} listener`)}else s!=="any"&&console.info(`Event (${s}) ${t}: ${a} (${n} times)`);a==="called"&&Z.listenerCount(t)<=0&&console.warn(`Event ${t} is called but not listening`)}}};c(Ya,"EventPlugin");let ts=Ya;const es={},Gt=Object.freeze(Object.defineProperty({__proto__:null,default:es},Symbol.toStringTag,{value:"Module"})),_r='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',{Configs:$r,Utils:Gr}=f,{Object:wo}=Gr,{Enabled:Vr,WideframeConfigs:ss}=$r.FrameCapture,Fr=c(async u=>{if(!Vr)return console.warn("FrameCapture is not enabled"),null;const e=kr(u);if(!e)return null;Ur(e,ss.ResultChallenge);const{frameCapture:t}=window.game,{Width:s,Height:a}=ss.ResultChallenge;return t.captureAsync({name:"ResultChallenge",width:s,height:a,renderOptions:e})},"renderResultChallenge"),Ur=c((u,e)=>{const{Width:t,Height:s,Wideframe:a}=e;u.wideframe={name:"result-challenge",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe$2"),kr=c(u=>{try{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:a="20",opponentPhoto:n="",opponentScore:i=0,isPlayerFinished:o,isOpponentFinished:r}=u,{RenderOptions:l}=ss.ResultChallenge,d=wo.camelCaseKeys(wo.clone(l)),{playerPhoto:h,opponentPhoto:y}=d,g=s===i,m=s>i,I=o??r,w=o&&r;return h.type==="image"&&(h.name=`${e}`,h.image=t),y.type==="image"&&(y.name=`${a}`,y.image=n),I&&Br(d,{playerScore:s,opponentScore:i,isPlayerFinished:o,isOpponentFinished:r}),!w||g?(delete d.leftCrown,delete d.rightCrown,d):(m?delete d.rightCrown:delete d.leftCrown,d)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$2"),Br=c((u,e)=>{const{leftScore:t,rightScore:s}=u,{playerScore:a=0,opponentScore:n=0,isPlayerFinished:i,isOpponentFinished:o}=e;t.type==="text"&&(t.text=i?`${a}`:"???"),s.type==="text"&&(s.text=o?`${n}`:"???")},"addRenderScores"),{Configs:jr,Utils:Kr}=f,{Object:mo}=Kr,{Enabled:Wr,WideframeConfigs:as}=jr.FrameCapture,zr=c(async u=>{if(!Wr)return console.warn("FrameCapture is not enabled"),null;const e=qr(u);if(!e)return null;Hr(e,as.ShareLeaderboard);const{frameCapture:t}=window.game,{Width:s,Height:a}=as.ShareLeaderboard;return t.captureAsync({name:"ShareLeaderboard",width:s,height:a,renderOptions:e})},"renderShareLeaderboard"),Hr=c((u,e)=>{const{Width:t,Height:s,Wideframe:a}=e;u.wideframe={name:"share-leaderboard",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe$1"),qr=c(u=>{try{const{playerId:e,playerPhoto:t,leaders:s}=u,{RenderOptions:a}=as.ShareLeaderboard,n=mo.camelCaseKeys(mo.clone(a)),{avatar:i}=n;return i.type==="image"&&(i.name=`${e}`,i.image=t),Yr(n,s),n}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$1"),Yr=c((u,e)=>{const t="600 48px";e.forEach((s,a)=>{const{id:n,name:i,photo:o,score:r}=s;let l=1294+180*a;u[`photo_${n}`]={depth:-1,name:n,type:"image",image:o,size:[96,96],position:[436,l]},l=1360+180*a,u[`name_${n}`]={font:t,depth:1,name:n,type:"text",text:i,position:[600,l]},u[`score_${n}`]={font:t,depth:1,name:n,type:"text",text:`${r}`,position:[100,l]}})},"addLeaders"),{Configs:Qr,Utils:Xr}=f,{Object:Ao}=Xr,{Enabled:Jr,WideframeConfigs:ns}=Qr.FrameCapture,Zr=c(async u=>{if(!Jr)return console.warn("FrameCapture is not enabled"),null;const e=ec(u);if(!e)return null;tc(e,ns.ShareScore);const{frameCapture:t}=window.game,{Width:s,Height:a}=ns.ShareScore;return t.captureAsync({name:"ShareScore",width:s,height:a,renderOptions:e})},"renderShareScore"),tc=c((u,e)=>{const{Width:t,Height:s,Wideframe:a}=e;u.wideframe={name:"share-score",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe"),ec=c(u=>{try{const{playerId:e,playerPhoto:t,playerScore:s}=u,{RenderOptions:a}=ns.ShareScore,n=Ao.camelCaseKeys(Ao.clone(a));console.log("renderOptions",n);const{avatar:i,playerScore:o}=n;return i.type==="image"&&(i.name=`${e}`,i.image=t),o.type==="text"&&(o.text=`${s}`),n}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions"),{Configs:sc,Utils:ac}=f,{Image:Xt,Object:Rt,Valid:Jt}=ac,{Options:$e}=sc.FrameCapture,Qa=class Qa extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"width");p(this,"height");p(this,"canvas",null);p(this,"testRenderOptions",null);p(this,"caches",{});p(this,"wideframe",{})}init(){this.addWideframeRender("renderShareScore",Zr),this.addWideframeRender("renderResultChallenge",Fr),this.addWideframeRender("renderShareLeaderboard",zr)}async preloadAsync(t){const{renderOptions:s}=t;await this.loadImages(s)}async captureAsync(t){const{width:s,height:a,renderOptions:n}=t;return this.width=s,this.height=a,this.createCanvas(),await this.loadImages(n),this.drawObjects(n),this.snapshotFrameAsync()}addWideframeRender(t,s){this.wideframe[t]=s}setTestRenderOptions(t){if(!t){this.testRenderOptions=null;return}const s=Rt.camelCaseKeys(t);this.testRenderOptions=Rt.merge(this.testRenderOptions,s)}createCanvas(){if(this.canvas){const t=this.canvas.getContext("2d");t?t.clearRect(0,0,this.canvas.width,this.canvas.height):this.canvas=null}this.canvas||(this.canvas=document.createElement("canvas",{is:"canvas"})),this.canvas.width=this.width,this.canvas.height=this.height}async loadImages(t){const s=Rt.vals(t).filter(o=>o.type==="image"),a=this.prepareLoadImages(s),n=Rt.vals(a);if(n.length<1)return;const i=await Promise.all(n);this.cacheImages(a,i)}prepareLoadImages(t){const s={};for(const a of t){const{name:n,image:i,fallbackImage:o}=a,r=this.caches[n];!Jt.isString(i)||r||(i===""&&Jt.isString(o)&&(a.image=o),console.info("prepareLoadImages",a),s[n]=new Promise(l=>{const d=Xt.loadImage(i);d.catch(()=>{Jt.isString(o)?(a.image=o,Xt.loadImage(a.image).then(h=>{l(h)}).catch(()=>{l(null)})):l(null)}),d.then(h=>{l(h)})}))}return s}cacheImages(t,s){for(const a in t){const n=s.shift();n&&(this.caches[a]=n)}}drawObjects(t){const s=Rt.vals(t).sort((a,n)=>a.depth-n.depth);for(const a of s)switch(a.type){case"text":this.drawText(a);break;case"image":this.drawImage(a);break}}drawText(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{position:a,font:n,text:i,color:o,lineWidth:r,textAlign:l}=t;s.font=`${n} ${_r}`,s.fillStyle=o??"#ffffff",r&&(s.lineWidth=r),l&&(s.textAlign=l),console.info("drawText",t);const[d,h]=a;s.fillText(i,d,h)}drawImage(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{name:a,size:n,position:i,fallbackImage:o}=t;let r=this.caches[a];if(!r&&o&&(r=this.caches[o]),!r)throw new Error(`Image ${a} not found`);console.info("drawImage",t);const[l,d]=i,[h,y]=n;s.drawImage(r,l,d,h,y)}async snapshotFrameAsync(){if(!this.canvas)return null;let t=null;if($e.UseBlobIfPossible&&"toBlob"in this.canvas?t=await this.createAsBlob():t=this.createAsDataImage(),!t)throw new Error("Image data is null");return Jt.isDebugger()&&Xt.logImage(t),t}createAsDataImage(){if(!this.canvas)return null;const t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return null;const{Quality:s,RenderType:a}=$e;return t.canvas.toDataURL(`image/${a}`,s)}createAsBlob(){return new Promise(t=>{if(!this.canvas){t(null);return}const{Quality:s,RenderType:a}=$e;this.canvas.toBlob(n=>{if(!n){t(null);return}Xt.blobToDataImage(n).then(i=>{t(i)})},`image/${a}`,s)})}};c(Qa,"FrameCapturePlugin");let is=Qa;const Xa=class Xa extends Error{constructor(t,s){super(`Text with key "${t}" not found in locale "${s}"`);p(this,"key");p(this,"locale");this.name="MissingKeyInLocaleError",this.key=t,this.locale=s}};c(Xa,"MissingKeyInLocaleError");let he=Xa;const Ja=class Ja extends Error{constructor(t){super(`Locale not found: ${t}`);p(this,"locale");this.name="LocaleNotFoundError",this.locale=t}};c(Ja,"LocaleNotFoundError");let ue=Ja;const{Utils:Io}=f,Za=class Za extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"locale");p(this,"data",{})}add(t,s){this.data[t]=s}choose(t){this.locale=t;const{event:s}=this.game;s.emit(f.Events.LANGUAGE_CHANGED,{locale:t})}getText(t,s,a){try{const{text:n}=this.getLocaleData(a);if(!Io.Object.hasOwn(n,t)){const o=a??this.getCurrentLocale();throw new he(String(t),o)}const i=n[t];return this.replaceVariables(i,s??[])}catch(n){return n instanceof he?(console.warn(`Text with key "${n.key}" not found in locale "${n.locale}"`),n.key):n instanceof ue?(console.warn(`Locale "${n.locale}" not found`),String(t)):(console.error(n),String(t))}}getTexture(t){const{texture:s}=this.getLocaleData();return s[t]}getCurrentLocale(){return this.locale||"en"}getLocaleData(t){const s=t??this.getCurrentLocale();if(!Io.Object.hasOwn(this.data,s))throw new ue(s);return this.data[s]}replaceVariables(t,s){const a=s.length;if(a==0)return t;let n=t;for(let i=0;i<a;i++){const o=s[i],r=`%{${i}}`;n=n.replace(r,o)}return n}};c(Za,"LanguagePlugin");let os=Za;const nc={_id:"",name:"",createdBy:"",description:"",expireTime:7*24*60*60*1e3,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15},{Configs:ic,Utils:oc}=f,{Object:Zt,String:Do,Valid:rc}=oc,{OtherHost:te,Mockup:ee,AppId:cc}=ic,tn=class tn{constructor(){p(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await rt(async()=>{const{default:t}=await Promise.resolve().then(()=>Gt);return{default:t}},void 0,import.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load LeaderboardAPIMock");this.mockAPI=new e}async getLeaderboardAsync(e,t,s){const a=Do.params(s);let n;return ee.Leaderboards.Enabled?(await this.initMockAPI(),"playerIds"in s?n=await this.mockAPI.getPlayers(e,s):n=await this.mockAPI.getLeaders(e,s)):n=await At(`${t}?${a}`,{},te),!Zt.hasOwn(n,"data")||!Array.isArray(n.data)?[]:n.data}async getLeaderboardsAsync(e){let t;const s=f.Utils.String.params(e),a="leaderboards";return ee.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.getLeaderboardsAsync(e)):(t=await At(`${a}?${s}`,{},te),!Zt.hasOwn(t,"data")||!Array.isArray(t.data)?[]:t.data)}async setLeaderboardScoreAsync(e){const{leaderboardId:t,playerId:s,score:a}=e;ee.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.setScoreAsync(t,s,a)):await R(`leaderboards/${t}/players/${s}`,{score:a},{},te)}async createLeaderboardAsync(e){const t=e._id??Do.generateObjectId(),s={...nc,...e,_id:t,appId:cc},a="leaderboards";let n;if(ee.Leaderboards.Enabled?(await this.initMockAPI(),n=await this.mockAPI.createLeaderboard(s)):(n=await R(a,s,{},te),Zt.hasOwn(n,"data")&&rc.isObject(n.data)&&(n=n.data)),!Zt.hasOwn(n,"_id")||n._id!==t)throw new Error("Create leaderboard failed");return t}};c(tn,"LeaderboardAPI");let rs=tn;const Po={limit:0,offset:0,leaders:{},isRequesting:!1},lc={leaderboards:{}},{Array:dc,Valid:hc,Json:xo,Object:se}=f.Utils,en=class en extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"lbAPI",new rs);p(this,"configs")}init(){const{storage:t}=this.game;t.addStorage("leaderboard",lc),this.configs={}}addLeaderboard(t){const{name:s,type:a,leaderboardId:n,autoSortRank:i}=t;if(this.getLeaderboard(s)){console.warn(`Leaderboard with name ${s} already exists`);return}let r=`leaderboards/${n}/`;(a==="global"||a==="tournament")&&(r+="leaders"),a==="friends"&&(r+="players"),this.configs[s]={id:n,name:s,type:a,host:r,autoSortRank:i};const l=xo.clone(Po);this.setLeaderboard(s,{...l})}async requestLeaderboardsAsync(t){try{return await this.lbAPI.getLeaderboardsAsync(t)}catch(s){return console.warn("requestGlobalLeaderboardsAsync",s),[]}}async requestLeaderboardAsync(t,s){try{this.validateLeaderboard(t),this.clearLeaderboard(t),this.setLeaderboard(t,{isRequesting:!0});const{id:a,type:n,host:i}=this.configs[t];let o=[];if(n==="friends"){const{player:r}=this.game,l=r.getPlayerId(),d=r.getConnectedPlayerIds(s,0),h=[l,...d];this.configs[t].playerIds=[...h],o=await this.lbAPI.getLeaderboardAsync(a,i,{playerIds:h})}else o=await this.lbAPI.getLeaderboardAsync(a,i,{limit:s,offset:0});if(o.length===0)return;await this.receiveLeaderboardAsync(t,o),this.setLeaderboard(t,{limit:s,offset:0})}finally{this.setLeaderboard(t,{isRequesting:!1})}}async loadMoreLeaderboardAsync(t,s){const a=this.getLeaderboard(t);if(a){if(this.configs[t].type==="friends"){console.warn("Cannot load more leaderboard with type friend");return}try{this.setLeaderboard(t,{isRequesting:!0});const{id:n,host:i}=this.configs[t],{offset:o,limit:r}=a,l=o+r,d=await this.lbAPI.getLeaderboardAsync(n,i,{limit:s,offset:l});if(d.length===0)return;this.receiveLeaderboardAsync(t,d),this.setLeaderboard(t,{limit:s,offset:l})}finally{this.setLeaderboard(t,{isRequesting:!1})}}}getLeaderboard(t){const{storage:s}=this.game,a=s.getStorageData("leaderboard","leaderboards");return a[t]?a[t]:null}async getLeadersByPlayerIdsAsync(t,s){try{this.validateLeaderboard(t);const{id:a}=this.configs[t],n=`leaderboards/${a}/players`,i=await this.lbAPI.getLeaderboardAsync(a,n,{playerIds:s});return i.length===0?[]:this.toLeaders(i)}catch(a){return console.warn(a),[]}}clearLeaderboard(t){try{this.validateLeaderboard(t);const s=xo.clone(Po);this.setLeaderboard(t,null),this.setLeaderboard(t,{...s})}catch(s){console.warn(s)}}isLeaderboardEmpty(t){const s=this.getLeaderboard(t);if(!s)return!0;const{leaders:a}=s;return Object.keys(a).length===0}isExistLeaderboardId(t){const{configs:s}=this;return se.vals(s).some(a=>a.id===t)}getLeaderboardName(t){const{configs:s}=this,a=dc.search(se.vals(s),n=>n.id===t);return a?a.name:null}async setLeaderboardScoreAsync(t,s,a){try{this.validateLeaderboard(t);const{id:n}=this.configs[t],i=await this.getLastScoreOnLeaderboard(t,s);if(i&&a<=i)return;await this.lbAPI.setLeaderboardScoreAsync({leaderboardId:n,playerId:s,score:a})}catch(n){console.warn(n)}}async getLastScoreOnLeaderboard(t,s){const a=await this.getLeadersByPlayerIdsAsync(t,[s]);return a.length===0?null:a[0].score}async createLeaderboardAsync(t){return this.lbAPI.createLeaderboardAsync(t)}validateLeaderboard(t){const s=this.getLeaderboard(t);if(!hc.isObject(s))throw new Error(`Leaderboard with name ${t} not found`)}setLeaderboard(t,s){const{storage:a}=this.game;a.setStorageData("leaderboard","leaderboards",{[t]:s})}async receiveLeaderboardAsync(t,s){this.validateLeaderboard(t);const n=(await this.toLeaders(s)).filter(h=>h.name&&h.photo),{offset:i=0,leaders:o={}}=this.getLeaderboard(t)??{},r=n.filter(h=>!o[h.playerId]);if(i>0&&r.length>0){const h=se.vals(o);r.unshift(...h)}let l=r.sort((h,y)=>y.score-h.score);this.configs[t].autoSortRank&&(l=l.map((h,y)=>({...h,rank:y+1})));const d=se.keyBy(l,"playerId");this.setLeaderboard(t,{leaders:d})}async toLeaders(t){const{profile:s}=this.game,a=t.map(r=>r.playerId);await s.requestProfiles(a);const n=s.getProfiles();return t.map(r=>{const{playerId:l}=r,d=n[l];return d?{...r,name:d.name,photo:d.photo}:{...r,name:"Nameless",photo:"default"}}).map(r=>({...r,score:parseInt(r.score,10)}))}};c(en,"LeaderboardPlugin");let cs=en;const sn=class sn{constructor(){p(this,"APIHost")}setAPIHost(e){this.APIHost=e}getAPIHost(){return this.APIHost}};c(sn,"BaseAPI");let ls=sn;const{Utils:Eo}=f,an=class an extends ls{async createSingleMatchAsync(e){const s=await R("single-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getSingleMatchDetailAsync(){const t=await At("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateSingleMatchMoveAsync(e,t){const s=`single-matches/${e}/move`,a=await R(s,t,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishSingleMatchAsync(e){const t=`single-matches/${e}/finish`,s=await R(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createEndlessMatchAsync(e){const s=await R("endless-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getEndlessMatchDetailAsync(){const t=await At("endless-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateEndlessMatchMilestoneAsync(e,t){const s=`endless-matches/${e}/milestone`,a=await R(s,t,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishEndlessMatchAsync(e){const t=`endless-matches/${e}/finish`,s=await R(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createMatchAsync(e){const s=await R("matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async joinMatchAsync(e){const t=`matches/${e}/join`,s=await R(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async getMatchDetailByIdAsync(e){const t=`matches/${e}`,s=await At(t,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishMatchAsync(e){const{matchId:t="",score:s=0,level:a=0,extraData:n={}}=e,i=`matches/${t}/finish`,o=await R(i,{matchId:t,score:s,level:a,extraData:n},{},this.getAPIHost());return this.returnValidMatchData(o)}returnValidMatchData(e){let t={};return!Eo.Valid.isObject(e)||!Eo.Object.hasOwn(e,"data")||(t=e.data),t}};c(an,"MatchAPI");let ds=an;const nn=class nn{constructor(e){p(this,"matchAPI");this.createAPI(),this.setAPIConfig(e)}createAPI(){this.matchAPI=new ds}setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}setMatchAPIInstance(e){this.matchAPI=e}getMatchAPI(){return this.matchAPI}};c(nn,"APIHandler");let hs=nn;const on=class on{constructor(e,t){p(this,"game");p(this,"match");this.game=e,this.match=t}startLog(e){this.match.useCPUProfile&&console.profile(this.constructor.name),console.group(`🚀 ${this.constructor.name}`),e&&console.log("📦 ? Payload:",e)}endLog(){console.groupEnd(),this.match.useCPUProfile&&console.profileEnd()}async processAsync(e){throw new Error("Not implemented")}};c(on,"BaseConcrete");let E=on;const rn=class rn extends K{constructor(e){super(e),this.name="LevelNotDefined",this.message=e??"Level is not defined"}};c(rn,"LevelNotDefined");let pe=rn;const cn=class cn extends K{constructor(e){super(e),this.name="MatchModeNotDefined",this.message=e??"Match id is not defined"}};c(cn,"MatchModeNotDefined");let jt=cn;const{Object:Ge,Valid:uc}=f.Utils,ln=class ln{constructor(e){p(this,"game");p(this,"match");p(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}setNext(e){return this.nextHandler=e,e}async processAsync(e){console.groupCollapsed(`➡️ ${this.constructor.name}`),this.logData("Before",e)}async nextAsync(e){this.logData("After",e),console.groupEnd(),this.nextHandler&&await this.nextHandler.processAsync(e)}logData(e,t){if(!uc.isDebugger())return;console.groupCollapsed(`📦 MatchState: ${e}`);const{profiles:s,customData:a,...n}=t;console.info("💾 Base"),console.table(Ge.clone(n)),console.info("💾 Profile"),console.table(Ge.clone(s)),console.info("💾 Custom"),console.table(Ge.clone(a)),console.groupEnd()}};c(ln,"BaseHandler");let A=ln;const{Plugins:pc,Utils:yc}=f,{Analytics:fc}=pc,{String:gc,Valid:So}=yc,dn=class dn extends A{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e,{level:a}=s;this.validateMode(t),this.validateLevel(a);const{analytics:n}=this.game;n.event(fc.Events.MATCH_START,{level:a,game_mode:gc.toUpperCamelCase(t),level_name:`level_${a}`}),await this.nextAsync(e)}validateMode(e){if(!So.isString(e))throw new jt}validateLevel(e){if(!So.isNumber(e))throw new pe}};c(dn,"LogMatchStartHandler");let G=dn;const _={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},hn=class hn extends A{async processAsync(e){super.processAsync(e);const{mode:t,status:s}=e;let a=t??ct.SINGLE;s===_.FINISHED&&(a=ct.SINGLE),this.contextGameModeDetected(a),await this.nextAsync(e)}contextGameModeDetected(e){const{storage:t}=this.game;t.setStorageData("context","contextGameMode",e)}};c(hn,"ContextGameModeHandler");let b=hn;const un=class un extends Error{constructor(e){super(e),this.name="GetMatchDetailFailed",this.message=e??"Get match detail failed"}};c(un,"GetMatchDetailFailed");let Kt=un;const pn=class pn extends Error{constructor(e){super(e),this.name="MatchAreNotActive",this.message=e??"Match are not active"}};c(pn,"MatchAreNotActive");let ye=pn;const yn=class yn extends K{constructor(e){super(e),this.name="MatchIdNotValid",this.message=e??"Match id is not valid"}};c(yn,"MatchIdNotValid");let W=yn;const fn=class fn extends Error{constructor(e){super(e),this.name="OpponentHasFinishedMatch",this.message=e||"Opponent has finished match"}};c(fn,"OpponentHasFinishedMatch");let us=fn;const gn=class gn extends K{constructor(e){super(e),this.name="OpponentIdNotValid",this.message=e??"Opponent id is not valid"}};c(gn,"OpponentIdNotValid");let O=gn;const wn=class wn extends Error{constructor(e){super(e),this.name="PlayerNotCurrentInMatch",this.message=e??"The player is not currently in this match"}};c(wn,"PlayerNotCurrentInMatch");let Wt=wn;const mn=class mn extends Error{constructor(e){super(e),this.name="PlayerNotFinishedMatch",this.message=e||"Player not finished match"}};c(mn,"PlayerNotFinishedMatch");let fe=mn;const{Dtos:wc}=f,An=class An extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new wc.Match.Data(t).toObject();this.validateAwaitMatchData(e,s),this.updateMatchData(e,s),this.validateMatchStatus(e),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new W}validateMatchStatus(e){const{status:t}=e;if(t!==_.ACTIVE)throw new ye}validateAwaitMatchData(e,t){const{id:s,customData:a}=e,{_id:n,whitePlayerId:i,blackPlayerId:o}=t;if(typeof n!="string"||n!==s)throw new Kt;const{playerId:r}=a,l=i===r,d=o===r;if(!l&&o===X.playerId)throw new Bt;if(!l&&!d)throw new Wt}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new D;const{finished:n}=t[a];if(!n)throw new fe}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:a}=s;if(typeof a!="string")throw new O;const{finished:n}=t[a];if(n)throw new us}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:l,status:d}=t;e.status=d;const h=a===s.playerId,y=h?a:n,g=h?n:a;e.customData.playerId=y,e.customData.opponentId=g,e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});const m=h?i:o,I=h?o:i;e.profiles[y].score=m,e.profiles[g].score=I;const w=h?r:l,L=h?l:r;e.profiles[y].finished=w,e.profiles[g].finished=L}};c(An,"AwaitMatchHandler");let ps=An;const va={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},In=class In extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.initializeMatch(t),await this.nextAsync(t)}initializeMatch(t){const{id:s,mode:a,customData:n}=this.payload;t.id=s??null,t.mode=a||null,t.status=_.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData={...va,...t.customData,...n}}};c(In,"PrepareMatchHandler");let T=In;const lt=kt,Dn=class Dn extends Error{constructor(e){super(e),this.name="UnavailableFeature",this.message=`Unavailable feature: ${e}`}};c(Dn,"UnavailableFeature");let P=Dn;const Pn=class Pn extends K{constructor(e){super(e),this.name="ContextIdNotValid",this.message=e??"Context id is not valid"}};c(Pn,"ContextIdNotValid");let F=Pn;const xn=class xn extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAwaitingAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesAwaitingAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:l,score:d=0,finished:h}=o;if(!h)return null;const{photo:y,score:g=0,finished:m}=r;return m?null:await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:g,isPlayerFinished:!0,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesAwaitingAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:r}=a[i],l={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${r} is waiting for you to finish this game. Play now!`,localizations:{vi_VN:`${r} đang chờ bạn kết thúc trận đấu. Chơi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(l)}};c(xn,"SendAwaitingMessageHandler");let ys=xn;const En=class En extends A{async processAsync(e){await this.nextAsync(e)}async nextAsync(e){this.nextHandler&&await this.nextHandler.processAsync(e)}};c(En,"NothingHandler");let v=En;const Sn=class Sn extends K{constructor(e){super(e),this.name="ProfileNotFound",this.message=e??"Profile not found"}};c(Sn,"ProfileNotFound");let M=Sn;const{Dtos:mc}=f,vn=class vn extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const{customData:t}=e,{playerId:s,opponentId:a}=t;let n=s;const i=await this.getProfile(n);if(!i)throw new M;if(this.updateMatchProfile(e,n,i),n=a,n!==X.playerId){const o=await this.getProfile(n);if(!o)throw new M;this.updateMatchProfile(e,n,o)}else this.updateMatchProfile(e,n);await this.nextAsync(e)}validateData(e){const{customData:t}=e,{playerId:s,opponentId:a}=t;if(!s||typeof s!="string")throw new D;if(!a||typeof a!="string")throw new O}async getProfile(e){const{profile:t}=this.game;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchProfile(e,t,s){const{name:a,photo:n}=s??X,i=new mc.Match.Profile({id:t,name:a,photo:n}).toObject();e.profiles[t]?(e.profiles[t].name=i.name,e.profiles[t].photo=i.photo):e.profiles[t]=i}};c(vn,"GetMatchProfilesHandler");let J=vn;const bn=class bn extends E{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new v(this),i=new T(this,{id:t,mode:k.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const o=new ps(this);i.setNext(o);const r=new J(this);o.setNext(r);const l=new ys(this);r.setNext(l);const d=new G(this);l.setNext(d);const h=new b(this);d.setNext(h);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};c(bn,"AwaitChallengeMatchConcrete");let fs=bn;const Nn=class Nn extends K{constructor(e){super(e),this.name="CreateContextFailed",this.message=e??"Create context failed"}};c(Nn,"CreateContextFailed");let zt=Nn;const{Valid:vo,Object:bo}=f.Utils,Cn=class Cn extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{opponentId:s}=this.payload,a=await this.createAsync(s);t.customData.contextId=a,await this.nextAsync(t)}async createAsync(t){try{await GameSDK.context.createAsync(t)}catch(a){this.validateError(a)}const s=GameSDK.context.getID();if(!vo.isString(s))throw new zt;return s}validateError(t){if(!bo.hasOwn(t,"code"))throw t;if(t.code!=="SAME_CONTEXT"){if(t.code==="INVALID_PARAM"){if(!this.isNotConnectedPlayerError(t))throw t;return}throw t}}validateErrorMessage(t){if(!bo.hasOwn(t,"message")||!vo.isString(t.message))throw t}isNotConnectedPlayerError(t){return this.validateErrorMessage(t),t.message.indexOf("is not a connected player of the current player")>-1}};c(Cn,"CreateContextHandler");let gs=Cn;const Ln=class Ln extends K{constructor(e){super(e),this.name="MatchAreNotOpen",this.message=e??"Match are not open"}};c(Ln,"MatchAreNotOpen");let St=Ln;const{Dtos:Ac}=f,On=class On extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t);const s=await this.createMatchAsync(t),a=new Ac.Match.Data(s).toObject();this.updateMatchState(t,a),await this.nextAsync(t)}validateData(t){const{status:s,customData:a}=t,{opponentId:n}=a;if(typeof n!="string")throw new O;if(s!==_.OPEN)throw new St}async createMatchAsync(t){const{opponentId:s}=t.customData,{extraData:a}=this.payload;if(!s)return{};const n={opponentPlayerId:s,extraData:a};return this.match.api.getMatchAPI().createMatchAsync(n)}updateMatchState(t,s){const{customData:a}=t,{_id:n,whitePlayerId:i,blackPlayerId:o,whitePlayerFinish:r,blackPlayerFinish:l}=s,d=i===a.opponentId;t.id=n||null;const h=d?o:i,y=d?i:o;t.customData.playerId=h,t.customData.opponentId=y,t.profiles[h]||(t.profiles[h]={id:h,name:"",photo:"",finished:!1}),t.profiles[y]||(t.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=d?l:r,m=d?r:l;t.profiles[h].finished=g,t.profiles[y].finished=m}};c(On,"CreateMatchHandler");let ge=On;const Tn=class Tn extends A{async processAsync(e){if(super.processAsync(e),e.status!==_.OPEN)throw new St;this.startMatch(e),await this.nextAsync(e)}startMatch(e){e.status=_.ACTIVE,e.startAt=Date.now()}};c(Tn,"StartMatchHandler");let U=Tn;const Mn=class Mn extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesChallengeAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesChallengeAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:l,score:d=0}=o,{photo:h,score:y=0}=r;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:y,isPlayerFinished:!1,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesChallengeAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:r}=a[i],l={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${r} challenges you`,localizations:{vi_VN:`${r} thử thách bạn trong trận đấu này. Chơi ngay!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await GameSDK.extra.updateAsync(l)}};c(Mn,"SendChallengeMessageHandler");let we=Mn;const Rn=class Rn extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s}=e,a=new v(this),n=new gs(this,{opponentId:s});a.setNext(n);const i=new T(this,{mode:k.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:s}});n.setNext(i);const o=new ge(this,{extraData:e.extraData});i.setNext(o);const r=new J(this);o.setNext(r);const l=new U(this);r.setNext(l);const d=new G(this);l.setNext(d);const h=new we(this);d.setNext(h);const y=new b(this);h.setNext(y);const g=this.match.getMatchState();await a.processAsync(g)}finally{this.endLog()}}};c(Rn,"ChallengeFriendConcrete");let ws=Rn;const _n=class _n extends Error{constructor(e){super(e),this.name="SameContext",this.message=e??"Same context"}};c(_n,"SameContext");let Vt=_n;const{Utils:No}=f,$n=class $n extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;await this.switchAsync(s),t.customData.contextId=s,await this.nextAsync(t)}checkSameContext(t){const s=t==="SOLO",a=GameSDK.context.getID();if(a===t)throw new Vt;if(s&&a===null)throw new Vt}async switchAsync(t){const s=t==="SOLO";try{this.checkSameContext(t),await GameSDK.context.switchAsync(t,s)}catch(a){if(a instanceof Vt)return;if(!No.Object.hasOwn(a,"code"))throw a;if(No.Device.isAndroid()&&s&&a.code==="INVALID_PARAM")return;if(a.code!=="SAME_CONTEXT")throw a}}};c($n,"SwitchContextHandler");let vt=$n;const{Dtos:Ic}=f,Gn=class Gn extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Ic.Match.Data(t).toObject();this.validateContinueMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t,status:s}=e;if(typeof t!="string")throw new W;if(s!==_.OPEN)throw new St}validateContinueMatchData(e,t){const{id:s,customData:a}=e,{_id:n,whitePlayerId:i,blackPlayerId:o}=t;if(typeof n!="string"||n!==s)throw console.warn("🤖 ? respMatchDataValidated",t),new Kt;const{playerId:r}=a,l=i===r,d=o===r;if(!l&&o===X.playerId)throw new Bt;if(!l&&!d)throw new Wt}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new D;const{finished:n}=t[a];if(n)throw new le}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:l}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=d?i:o,m=d?o:i;e.profiles[h].score=g,e.profiles[y].score=m;const I=d?r:l,w=d?l:r;e.profiles[h].finished=I,e.profiles[y].finished=w}};c(Gn,"ContinueMatchHandler");let ms=Gn;const Vn=class Vn extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesCurrentScoreAsync();t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesCurrentScoreAsync(){try{const{player:e,frameCapture:t}=this.game,{playerId:s,photo:a}=e.getPlayer(),{profiles:n}=this.match.getMatchState(),{score:i=0}=n[s]||{};return await t.wideframe.renderShareScore({playerId:s,playerPhoto:a,playerScore:i})}catch(e){return console.warn("createWideframesCurrentScoreAsync",e),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:r}=a[i],l={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${r} made an update.`,localizations:{vi_VN:`${r} đã cập nhật trận đấu. Chơi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(l)}};c(Vn,"SendUpdateMessageHandler");let As=Vn;const Fn=class Fn extends E{async processAsync(e){try{this.startLog(e);const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,i=new v(this),o=new vt(this,{contextId:t});i.setNext(o);const r=new T(this,{id:s,mode:k.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:n}});o.setNext(r);const l=new ms(this);r.setNext(l);const d=new J(this);l.setNext(d);const h=new U(this);d.setNext(h);const y=new As(this);h.setNext(y);const g=new G(this);y.setNext(g);const m=new b(this);g.setNext(m);const I=this.match.getMatchState();await i.processAsync(I)}finally{this.endLog()}}};c(Fn,"ContinueChallengeMatchConcrete");let Is=Fn;const{Plugins:Dc,Utils:Pc}=f,{Analytics:xc}=Dc,{String:Ec,Valid:Co}=Pc,Un=class Un extends A{async processAsync(e){super.processAsync(e);const{customData:t,mode:s,startAt:a,finishAt:n}=e,{level:i}=t;this.validateMode(s),this.validateLevel(i);const{analytics:o}=this.game,r=Math.floor((n-a)/1e3);o.event(xc.Events.MATCH_END,{level:i,game_mode:Ec.toUpperCamelCase(s),level_name:`level_${i}`,time_played:r}),await this.nextAsync(e)}validateMode(e){if(!Co.isString(e))throw new jt}validateLevel(e){if(!Co.isNumber(e))throw new pe}};c(Un,"LogMatchFinishedHandler");let dt=Un;const kn=class kn extends Error{constructor(e){super(e),this.name="PlayerNotLoggedIn",this.message=e||"Player is not logged in"}};c(kn,"PlayerNotLoggedIn");let me=kn;const Bn=class Bn extends Error{constructor(e){super(e),this.name="ScoreNotValid",this.message=e??"Score is not valid"}};c(Bn,"ScoreNotValid");let ht=Bn;const jn=class jn extends Error{constructor(e){super(e),this.name="LeaderboardIdNotValid",this.message=e??"Leaderboard id is not valid"}};c(jn,"LeaderboardIdNotValid");let ut=jn;const Kn=class Kn extends Error{constructor(e){super(e),this.name="LeaderboardNotExist",this.message=e??"Leaderboard not exist in game"}};c(Kn,"LeaderboardNotExist");let Ds=Kn;const{Valid:Lo}=f.Utils,Wn=class Wn extends A{constructor(t,s){super(t);p(this,"payload");p(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.setupSetScorePayload(t),this.setLeaderboardScoreAsync(),await this.nextAsync(t)}async setupSetScorePayload(t){const{profiles:s,customData:a}=t,{playerId:n}=a;if(!n||!s[n])throw new M;const{score:i,leaderboardId:o}=this.payload;if(!Lo.isNumber(i))throw new ht;if(!Lo.isString(o))throw new ut;this.leaderboardPayload={score:i,playerId:n,leaderboardId:o}}async setLeaderboardScoreAsync(){try{const{playerId:t,score:s,leaderboardId:a}=this.leaderboardPayload,n=this.game.leaderboard.getLeaderboardName(a);if(!n)throw new Ds;await this.game.leaderboard.setLeaderboardScoreAsync(n,t,s)}catch(t){console.warn("setLeaderboardScoreAsync",t)}}};c(Wn,"SetLeaderboardScoreHandler");let bt=Wn;const{Valid:Sc}=f.Utils,{Leaderboards:vc}=f.Configs,zn=class zn extends bt{constructor(e){super(e,{score:0,leaderboardId:vc.LeaderboardId})}async setupSetScorePayload(e){if(GameSDK.player.isGuest())throw new me;const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new M;const{score:n}=t[a];if(!Sc.isNumber(n))throw new ht;this.payload.score=n,super.setupSetScorePayload(e)}};c(zn,"PostGlobalLeaderboardScoreHandler");let Ht=zn;const{Dtos:bc,Utils:Nc}=f,{Valid:ae,Object:Cc}=Nc,Hn=class Hn extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateMatchData(t);const{useAPI:s}=this.payload;if(s){const a=await this.finishMatchAsync(t),n=new bc.Match.Data(a).toObject();this.updateMatchFromAPI(t,n)}else this.updateMatchData(t);this.updateMatchState(t),await this.nextAsync(t)}validateMatchData(t){const{status:s,profiles:a,customData:n}=t;if(s!==_.ACTIVE)throw new ye;const{playerId:i}=n;if(!i||!Cc.hasOwn(a,i))throw new Wt}updateMatchData(t){const{playerId:s}=t.customData;if(!ae.isString(s))throw new D;t.profiles[s].finished=!0}updateMatchState(t){t.status=_.FINISHED,t.finishAt=Date.now()}async finishMatchAsync(t){const{id:s,profiles:a,customData:n}=t,{level:i,playerId:o}=n;if(!ae.isString(o))throw new D;const{score:r}=a[o],{extraData:l}=this.payload,d={matchId:s??"",score:r,level:i,extraData:l};return this.match.api.getMatchAPI().finishMatchAsync(d)}updateMatchFromAPI(t,s){const{playerId:a,opponentId:n}=t.customData;if(!ae.isString(a))throw new D;if(!ae.isString(n))throw new O;const{whitePlayerId:i,whitePlayerScore:o,blackPlayerScore:r,whitePlayerFinish:l,blackPlayerFinish:d}=s,h=a===i,y=h?o:r,g=h?r:o,m=h?l:d,I=h?d:l;t.profiles[a].score=y,t.profiles[n].score=g,t.profiles[a].finished=m,t.profiles[n].finished=I}};c(Hn,"FinishMatchHandler");let pt=Hn;const qn=class qn extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync(e);t&&this.progressSendFinishedMessage(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesResultAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:l,score:d=0,finished:h}=o,{photo:y,score:g=0,finished:m}=r;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:g,isPlayerFinished:!!h,isOpponentFinished:!!m})}catch(t){return console.warn("createWideframesResultAsync",t),null}}progressSendFinishedMessage(e,t){const{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||typeof n!="string")throw new D;if(!i||typeof i!="string")throw new O;const{score:o=0,finished:r}=s[n],{score:l=0,finished:d}=s[i];r?this.sendFinishMessageAsync(e,t):d&&o>l?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}async sendFinishMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:r}=a[i],l={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:_.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:`${r} just finished. Check them now.`,localizations:{vi_VN:`${r} vừa hoàn thành màn chơi. Nhấn để xem kết quả trận đấu.`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(l)}async sendPlayTurnMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;const{name:r,score:l}=a[i],d={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:_.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${r} got ${l} scores. So easy! Can you?`,localizations:{vi_VN:`${r} đã đạt ${l} điểm! Nhấn Chơi để so tài!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(d)}async sendBestScoreMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;const{name:r,score:l}=a[i],d={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:_.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:`${r} beat your high score. Their score: ${l}`,localizations:{vi_VN:`${r} đã vượt qua điểm số của bạn, với ${l} điểm!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(d)}};c(qn,"SendFinishedMessageHandler");let Ps=qn;const Yn=class Yn extends A{async processAsync(e){super.processAsync(e),this.setPlayerBestScore(e),await this.nextAsync(e)}setPlayerBestScore(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new M;const{player:n}=this.game,i=n.getBestScore()||0,{score:o=0}=t[a];o<=i||(n.setBestScore(o),t[a].bestScore=o)}};c(Yn,"SetPlayerBestScoreHandler");let Nt=Yn;const Qn=class Qn extends E{async processAsync(e){try{this.startLog(e);const{extraData:t}=e??{},s=new v(this),a=new pt(this,{useAPI:!0,extraData:t});s.setNext(a);const n=new Ps(this);a.setNext(n);const i=new dt(this);n.setNext(i);const o=new Nt(this);i.setNext(o);const r=new Ht(this);o.setNext(r);const l=new b(this);r.setNext(l);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}};c(Qn,"FinishChallengeMatchConcrete");let xs=Qn;const Xn=class Xn extends Error{constructor(e){super(e),this.name="ContextAreSolo",this.message=e??"Context are solo"}};c(Xn,"ContextAreSolo");let Es=Xn;const Jn=class Jn extends Error{constructor(e){super(e),this.name="OpponentNotJoinInContext",this.message=e??"Opponent is not join in context"}};c(Jn,"OpponentNotJoinInContext");let Ss=Jn;const Zn=class Zn extends Error{constructor(e){super(e),this.name="NetworkFailure",this.message=e??"Network failure"}};c(Zn,"NetworkFailure");let vs=Zn;const{Utils:Lc,Dtos:Oc}=f,{Array:Tc,Object:Mc}=Lc,ti=class ti extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.checkCurrentContext();const s=await this.getOpponentIdFromContextAsync();t.customData.opponentId=s,await this.nextAsync(t)}checkCurrentContext(){const t=GameSDK.context.getID();if(typeof t!="string")throw new F;if(t==="SOLO")throw new Es}async getOpponentIdFromContextAsync(){const{ignoreId:t}=this.payload,s=await this.getContextPlayers([t]);if(s.length>1)throw new Ss;let a=X;return s.length===1&&(a=s[0]),a.playerId}async getContextPlayers(t){try{const s=await GameSDK.context.getPlayersAsync(),a=[];return s.forEach(n=>{const i=n.getID();if(t.indexOf(i)>-1)return;const o=n.getName();if(!o)return;const r=n.getPhoto();a.push(new Oc.Player.Info({playerId:i,name:o,photo:r}).toObject())}),Tc.unique(a)}catch(s){if(Mc.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new vs;return[]}}};c(ti,"GetOpponentChallengeContextHandler");let bs=ti;const ei=class ei extends Error{constructor(e){super(e),this.name="ContextIsTournament",this.message=e??"Context is a tournament"}};c(ei,"ContextIsTournament");let qt=ei;const{Object:Rc}=f.Utils,si=class si extends A{async processAsync(e){super.processAsync(e);const t=await this.chooseAsync();await this.checkContextTournament(),e.customData.contextId=t,await this.nextAsync(e)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(t){if(!Rc.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}const e=GameSDK.context.getID();if(typeof e!="string")throw new zt;return e}async checkContextTournament(){try{if(!GameSDK.context.getID())return;throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new qt):new P("getTournamentAsync")}catch(e){if(e instanceof qt)throw e}}};c(si,"ChooseContextHandler");let Ns=si;const ai=class ai extends E{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new v(this),a=new Ns(this);s.setNext(a);const n=new T(this,{mode:k.CHALLENGE_FRIEND,customData:{playerId:t}});a.setNext(n);const i=new bs(this,{ignoreId:t});n.setNext(i);const o=new ge(this,{extraData:e.extraData});i.setNext(o);const r=new J(this);o.setNext(r);const l=new U(this);r.setNext(l);const d=new G(this);l.setNext(d);const h=new we(this);d.setNext(h);const y=new b(this);h.setNext(y);const g=this.match.getMatchState();await s.processAsync(g)}finally{this.endLog()}}};c(ai,"InviteFriendsConcrete");let Cs=ai;const ni=class ni extends Error{constructor(e){super(e),this.name="JoinMatchFailed",this.message=e??"Join match failed"}};c(ni,"JoinMatchFailed");let Ls=ni;const ii=class ii extends Error{constructor(e){super(e),this.name="MatchAreFinished",this.message=e??"Match are finished"}};c(ii,"MatchAreFinished");let Os=ii;const oi=class oi extends Error{constructor(e){super(e),this.name="OtherPlayerHasJoinedMatch",this.message=e??"Other player has joined match"}};c(oi,"OtherPlayerHasJoinedMatch");let Ts=oi;const{Dtos:_c}=f,ri=class ri extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.joinMatchAsync(e),s=new _c.Match.Data(t).toObject();this.validateJoinMatchData(e,s),this.updateMatchData(e,s),await this.nextAsync(e)}validateMatchData(e){const{status:t}=e;if(t!==_.OPEN)throw new St}validateJoinMatchData(e,t){const{id:s,customData:a}=e,{_id:n,blackPlayerId:i,whitePlayerId:o,whitePlayerFinish:r,blackPlayerFinish:l}=t,d=i===a.playerId,h=o===a.opponentId;if(typeof n!="string"||n!==s||!h)throw console.warn("🤖 ? matchData",t),new Ls;if(r&&l)throw new Os;if(!d)throw new Ts}async joinMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().joinMatchAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:l}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=d?i:o,m=d?o:i;e.profiles[h].score=g,e.profiles[y].score=m;const I=d?r:l,w=d?l:r;e.profiles[h].finished=I,e.profiles[y].finished=w}};c(ri,"JoinMatchHandler");let Ms=ri;const ci=class ci extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAcceptedAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesAcceptedAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:l,score:d=0,finished:h}=o;if(h)return null;const{photo:y,score:g=0,finished:m}=r;return m?await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:g,isPlayerFinished:!1,isOpponentFinished:!0}):null}catch(t){return console.warn("createWideframesAcceptedAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:r}=a[i],l={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${r} accepted the challenge.`,localizations:{vi_VN:`${r} đã chấp nhận tham gia trận đấu.`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(l)}};c(ci,"SendAcceptedMessageHandler");let Rs=ci;const li=class li extends E{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new v(this),i=new T(this,{id:t,mode:k.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const o=new Ms(this);i.setNext(o);const r=new J(this);o.setNext(r);const l=new U(this);r.setNext(l);const d=new Rs(this);l.setNext(d);const h=new G(this);d.setNext(h);const y=new b(this);h.setNext(y);const g=this.match.getMatchState();await n.processAsync(g)}finally{this.endLog()}}};c(li,"JoinChallengeMatchConcrete");let _s=li;const Xo={_id:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1},{Valid:q}=f.Utils,Y="is invalid",di=class di extends ${setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!q.isString(e)||!e)&&this.exception("_id",Y)}validateStatus(e){(!q.isString(e)||!e)&&this.exception("status",Y)}validateWinnerId(e){e!==null&&(!q.isString(e)||!e)&&this.exception("winnerId",Y)}validateWhitePlayerId(e){(!q.isString(e)||!e)&&this.exception("whitePlayerId",Y)}validateBlackPlayerId(e){(!q.isString(e)||!e)&&this.exception("blackPlayerId",Y)}validateWhitePlayerScore(e){q.isNumber(e)||this.exception("whitePlayerScore",Y)}validateBlackPlayerScore(e){q.isNumber(e)||this.exception("blackPlayerScore",Y)}validateWhitePlayerFinish(e){q.isBoolean(e)||this.exception("whitePlayerFinish",Y)}validateBlackPlayerFinish(e){q.isBoolean(e)||this.exception("blackPlayerFinish",Y)}toObject(){return super.toObject()}static getDefaultData(){return Xo}};c(di,"RespMatchDataDtos");let Yt=di;Yt.addDefaultData(Xo);const hi=class hi extends Error{constructor(e){super(e),this.name="MatchAreNotFinished",this.message=e||"Match are not finished"}};c(hi,"MatchAreNotFinished");let $s=hi;const ui=class ui extends Error{constructor(e){super(e),this.name="OpponentNotFinishedMatch",this.message=e||"Opponent not finished match"}};c(ui,"OpponentNotFinishedMatch");let Gs=ui;const pi=class pi extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Yt(t).toObject();this.validateResultMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new W}validateResultMatchData(e,t){const{id:s}=e,{_id:a,whitePlayerFinish:n,blackPlayerFinish:i}=t;if(typeof a!="string"||a!==s)throw new Kt;if(!n&&!i)throw new $s}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new D;const{finished:n}=t[a];if(!n)throw new fe}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:a}=s;if(typeof a!="string")throw new O;const{finished:n}=t[a];if(!n)throw new Gs}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:l}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!0}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!0});const g=d?i:o,m=d?o:i;e.profiles[h].score=g,e.profiles[y].score=m;const I=d?r:l,w=d?l:r;e.profiles[h].finished=I,e.profiles[y].finished=w}};c(pi,"ResultMatchHandler");let Vs=pi;const yi=class yi extends E{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new v(this),i=new T(this,{id:t,mode:k.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const o=new Vs(this);i.setNext(o);const r=new J(this);o.setNext(r);const l=new b(this);r.setNext(l);const d=this.match.getMatchState();await n.processAsync(d)}finally{this.endLog()}}};c(yi,"ResultChallengeMatchConcrete");let Fs=yi;const fi=class fi extends E{constructor(){super(...arguments);p(this,"fallbackSingleMode");p(this,"startFLowChallengeFriend",c(async t=>{try{return await this.match.challenge.invite.processAsync(t),!0}catch(s){return s}},"startFLowChallengeFriend"));p(this,"startFlowTournament",c(async t=>{try{const s=GameSDK.context.getID();if(typeof s!="string")throw new F;await this.match.tournament.continue.processAsync({playerId:t,contextId:s})}catch{await this.startFlowSingle(t)}},"startFlowTournament"));p(this,"startFlowSingle",c(async t=>{if(!this.fallbackSingleMode)throw new Error("Fallback single mode is not enabled");await this.match.single.start.processAsync({playerId:t})},"startFlowSingle"))}async processAsync(t){try{this.startLog(t);const{playerId:s,extraData:a,fallbackSingleMode:n}=t;this.fallbackSingleMode=n;const i=await this.startFLowChallengeFriend({playerId:s,extraData:a});if(i===!0)return;i instanceof qt?await this.startFlowTournament(s):await this.startFlowSingle(s)}finally{this.endLog()}}};c(fi,"ChooseContextConcrete");let Us=fi;const{Valid:$c}=f.Utils,{Leaderboards:Gc}=f.Configs,gi=class gi extends bt{constructor(e){super(e,{score:0,leaderboardId:Gc.LeaderboardEndlessId})}async setupSetScorePayload(e){if(GameSDK.player.isGuest())throw new me;const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new M;const{endlessScore:n}=t[a];if(!$c.isNumber(n))throw new ht;this.payload.score=n,super.setupSetScorePayload(e)}};c(gi,"PostGlobalLeaderboardEndlessScoreHandler");let ks=gi;const wi=class wi extends A{async processAsync(e){super.processAsync(e),this.setPlayerEndlessScore(e),await this.nextAsync(e)}setPlayerEndlessScore(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new M;const{player:n}=this.game,i=n.getBestEndlessScore()??0,{endlessScore:o=0}=t[a],r=i<o?o:i;n.setBestEndlessScore(r),t[a].bestEndlessScore=r}};c(wi,"SetPlayerEndlessScoreHandler");let Bs=wi;const mi=class mi extends E{async processAsync(){try{this.startLog();const e=new v(this),t=new pt(this,{useAPI:!1});e.setNext(t);const s=new dt(this);t.setNext(s);const a=new Bs(this);s.setNext(a);const n=new ks(this);a.setNext(n);const i=new b(this);n.setNext(i);const o=this.match.getMatchState();await e.processAsync(o)}finally{this.endLog()}}};c(mi,"FinishEndlessConcrete");let js=mi;const Ai=class Ai extends Error{constructor(e){super(e),this.name="ProfileIdNotDefined",this.message=e??"Profile id is not defined"}};c(Ai,"ProfileIdNotDefined");let Ks=Ai;const{Dtos:Vc}=f,Ii=class Ii extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{profileId:s}=this.payload;if(!s)throw new Ks;const{player:a}=this.game,n=a.getPlayerId();let i;if(s===n)i=this.getPlayerProfile();else if(i=await this.getProfileAsync(s),!i)throw new M;this.updateMatchData(i,t),await this.nextAsync(t)}getPlayerProfile(){const{player:t}=this.game,{playerId:s,name:a,photo:n,locale:i}=t.getPlayer();return{playerId:s,name:a,photo:n,locale:i}}async getProfileAsync(t){const{profile:s}=this.game;return await s.requestProfiles([t]),s.getProfiles()[t]}updateMatchData(t,s){const{playerId:a,name:n,photo:i}=t,o=new Vc.Match.Profile({id:a,name:n,photo:i}).toObject();s.profiles[a]=o}};c(Ii,"GetProfileHandler");let st=Ii;const Di=class Di extends E{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new v(this),a=new vt(this,{contextId:"SOLO"});s.setNext(a);const n=new T(this,{id:"234567",mode:k.ENDLESS,customData:{playerId:t}});a.setNext(n);const i=new U(this);n.setNext(i);const o=new st(this,{profileId:t});i.setNext(o);const r=new G(this);o.setNext(r);const l=new b(this);r.setNext(l);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}};c(Di,"StartEndlessConcrete");let Ws=Di;const{Valid:Fc}=f.Utils,Pi=class Pi extends bt{constructor(e){super(e,{score:0,leaderboardId:""})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:a,leaderboardId:n}=s;if(!n)throw new ut;if(!a||!t[a])throw new M;const{score:i}=t[a];if(!Fc.isNumber(i))throw new ht;this.payload.score=i,this.payload.leaderboardId=n,super.setupSetScorePayload(e)}};c(Pi,"PostLeaderboardScoreHandler");let Qt=Pi;const xi=class xi extends A{async processAsync(e){super.processAsync(e),this.validateData(e),this.progressSendGroupMessage(e),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesResultGroupAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:l,score:d=0}=o,{photo:h,score:y=0}=r;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:y,isPlayerFinished:!0,isOpponentFinished:!0})}catch(t){return console.warn("createWideframesResultGroupAsync",t),null}}async createWideframesBestScoreAsync(e){try{const{player:t,frameCapture:s}=this.game,{playerId:a}=e.customData,{playerId:n,photo:i,data:o}=t.getPlayer();if(a!==n)return null;const{score:r}=o||{};return await s.wideframe.renderShareScore({playerId:n,playerPhoto:i,playerScore:r})}catch(t){return console.warn("createWideframesBestScoreAsync",t),null}}async progressSendGroupMessage(e){const{profiles:t,customData:s}=e,{playerId:a,opponentId:n}=s;if(n&&typeof n=="string"){if(!a||typeof a!="string")throw new D;const{score:o=0}=t[a]||{},{score:r=0}=t[n]||{};if(o>r){const l=await this.createWideframesResultGroupAsync(e);if(!l)return;this.sendBestScoreMessageAsync(e,l);return}}const i=await this.createWideframesBestScoreAsync(e);i&&this.sendChallengeMessageAsync(e,i)}async sendBestScoreMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:i,score:o}=s[n],l={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:o},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi"}},text:{default:`${i} beats your high score. Their score: ${o}.`,localizations:{vi_VN:`${i} vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(l)}async sendChallengeMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new D;const{name:i,score:o}=s[n],l={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:o},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${i} got ${o} scores. So easy! Can you?`,localizations:{vi_VN:`${i} đã đạt ${o} điểm! Quá dễ luôn. Chơi lại nào!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(l)}};c(xi,"SendGroupMessageHandler");let zs=xi;const Ei=class Ei extends E{async processAsync(){try{this.startLog();const e=new v(this),t=new pt(this,{useAPI:!1});e.setNext(t);const s=new zs(this);t.setNext(s);const a=new dt(this);s.setNext(a);const n=new Nt(this);a.setNext(n);const i=new Qt(this);n.setNext(i);const o=new b(this);i.setNext(o);const r=this.match.getMatchState();await e.processAsync(r)}finally{this.endLog()}}};c(Ei,"FinishGroupConcrete");let Hs=Ei;const{Dtos:Uc}=f,Si=class Si extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateProfileMatchData(t),await this.nextAsync(t)}updateProfileMatchData(t){const{id:s}=this.payload,{profiles:a}=t;if(!a[s])throw new M;const n={...a[s],...this.payload},i=new Uc.Match.Profile(n).toObject();a[i.id]=i}};c(Si,"SetProfileDataHandler");let Ct=Si;const vi=class vi extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s,opponentScore:a}=e,n=new v(this),i=new T(this,{id:"7749",mode:k.MATCHING_GROUP,customData:{playerId:t,opponentId:s}});n.setNext(i);const o=new J(this);i.setNext(o);const r=new Ct(this,{id:t,score:a});o.setNext(r);const l=new U(this);r.setNext(l);const d=new G(this);l.setNext(d);const h=new b(this);d.setNext(h);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};c(vi,"JoinGroupConcrete");let qs=vi;const bi=class bi extends Error{constructor(e){super(e),this.name="MatchGroupNotSupported",this.message=e??"Match group is not supported"}};c(bi,"MatchGroupNotSupported");let Ae=bi;const{String:kc}=f.Utils,Ni=class Ni extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.checkMatchGroupSupported();const s=this.getMatchTag(),a=await this.matchingGroup(s);t.customData.contextId=a,await this.nextAsync(t)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new P("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new P("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new Ae;if(!await GameSDK.extra.checkCanPlayerMatchAsync())throw new Ae}getMatchTag(){const{locale:t}=this.payload;let s="global";if(t){const a=kc.getLanguageCode(t);a==="en"&&(s="en"),a==="in"&&(s="in")}return s}async matchingGroup(t){if(!("matchPlayerAsync"in GameSDK.extra))throw new P("matchPlayerAsync");await GameSDK.extra.matchPlayerAsync(t,!0,!0);const s=GameSDK.context.getID();if(typeof s!="string")throw new zt;return s}};c(Ni,"GroupContextHandler");let Ys=Ni;const Ci=class Ci extends E{async processAsync(e){try{this.startLog(e);const{locale:t,playerId:s}=e,a=new v(this),n=new Ys(this,{locale:t});a.setNext(n);const i=new T(this,{id:"7749",mode:k.MATCHING_GROUP,customData:{playerId:s}});n.setNext(i);const o=new U(this);i.setNext(o);const r=new st(this,{profileId:s});o.setNext(r);const l=new G(this);r.setNext(l);const d=new b(this);l.setNext(d);const h=this.match.getMatchState();await a.processAsync(h)}finally{this.endLog()}}};c(Ci,"StartGroupConcrete");let Qs=Ci;const Li=class Li extends A{async processAsync(e){super.processAsync(e),await this.setMSNLeaderboardScore(e),await this.nextAsync(e)}async setMSNLeaderboardScore(e){try{const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new M;const{score:n}=t[a];if(!f.Utils.Valid.isNumber(n))throw new ht;if(!("submitGameResultsAsync"in GameSDK.extra))throw new P("submitGameResultsAsync");GameSDK.extra.submitGameResultsAsync(n)}catch(t){console.warn("submitScoreToMSNLeaderboardHandler",t)}}};c(Li,"SubmitScoreToMSNLeaderboardHandler");let Xs=Li;const Oi=class Oi extends E{async processAsync(){try{this.startLog();const e=new v(this),t=new pt(this,{useAPI:!1});e.setNext(t);const s=new dt(this);t.setNext(s);const a=new Nt(this);s.setNext(a);const n=new Ht(this);a.setNext(n);const i=new Xs(this);n.setNext(i);const o=new b(this);i.setNext(o);const r=this.match.getMatchState();await e.processAsync(r)}finally{this.endLog()}}};c(Oi,"FinishSingleConcrete");let Js=Oi;const Ti=class Ti extends E{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new v(this),a=new vt(this,{contextId:"SOLO"});s.setNext(a);const n=new T(this,{id:"123456",mode:k.SINGLE,customData:{playerId:t}});a.setNext(n);const i=new U(this);n.setNext(i);const o=new st(this,{profileId:t});i.setNext(o);const r=new G(this);o.setNext(r);const l=new b(this);r.setNext(l);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}};c(Ti,"StartSingleConcrete");let Zs=Ti;const{Plugins:Bc,Utils:jc}=f,{Analytics:Kc}=Bc,{String:Wc,Valid:zc}=jc,Mi=class Mi extends A{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e;this.validateMode(t);const{analytics:a}=this.game,{tournamentId:n,leaderboardId:i}=s;a.event(Kc.Events.TOURNAMENT_START,{success:!0,game_mode:Wc.toUpperCamelCase(t),tournament_id:n,leaderboard_id:i}),await this.nextAsync(e)}validateMode(e){if(!zc.isString(e))throw new jt}};c(Mi,"LogTournamentStartHandler");let Ie=Mi;const Ri=class Ri extends Error{constructor(e){super(e),this.name="TournamentIdNotValid",this.message=e??"Tournament id is not valid"}};c(Ri,"TournamentIdNotValid");let De=Ri;const{Valid:Ve}=f.Utils,_i=class _i extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;this.validateContextId(s);const a=await GameSDK.getTournamentAsync(),n=a.getID().toString();this.validateTournamentId(n);const i=JSON.parse(a.getPayload()||"{}"),{leaderboardId:o}=i;this.validateLeaderboardId(o),t.customData.contextId=s,t.customData.tournamentId=n,t.customData.leaderboardId=o,await this.nextAsync(t)}validateContextId(t){if(!Ve.isString(t))throw new F}validateTournamentId(t){if(!Ve.isString(t))throw new De}validateLeaderboardId(t){if(!Ve.isString(t)||t==="")throw new ut}};c(_i,"ContinueTournamentHandler");let ta=_i;const $i=class $i extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,contextId:s}=e,a=new v(this),n=new ta(this,{contextId:s});a.setNext(n);const i=new T(this,{id:"1997",mode:k.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const o=new U(this);i.setNext(o);const r=new st(this,{profileId:t});o.setNext(r);const l=new G(this);r.setNext(l);const d=new Ie(this);l.setNext(d);const h=new b(this);l.setNext(h);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}};c($i,"ContinueTournamentConcrete");let ea=$i;const{Plugins:Hc}=f,{Analytics:qc}=Hc,Gi=class Gi extends A{async processAsync(e){super.processAsync(e);const{customData:t}=e,{analytics:s}=this.game,{tournamentId:a,leaderboardId:n}=t;s.event(qc.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:a,leaderboard_id:n}),await this.nextAsync(e)}};c(Gi,"LogTournamentCreateHandler");let sa=Gi;const Vi=class Vi extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.createTournamentAsync(),await this.updateMatchStateAsync(t),await this.nextAsync(t)}async createTournamentAsync(){const{name:t,score:s,customData:a}=this.payload;await GameSDK.tournament.createAsync({initialScore:s,config:{title:t,tournamentTitle:t},data:a})}async updateMatchStateAsync(t){try{if(!("getTournamentAsync"in GameSDK))throw new P("getTournamentAsync");const s=await GameSDK.getTournamentAsync(),a=s.getContextID(),n=s.getID().toString(),{playerId:i}=this.payload;t.customData.playerId=i,t.customData.contextId=a,t.customData.tournamentId=n}catch(s){if(s instanceof P)return}}};c(Vi,"CreateTournamentHandler");let aa=Vi;const{Valid:Oo}=f.Utils,Fi=class Fi extends A{constructor(t,s){super(t);p(this,"payload");p(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.validatePayload(),await this.setupCreatePayload(t),await this.createLeaderboardAsync(t),await this.nextAsync(t)}validatePayload(){const{leaderboardId:t}=this.payload;if(!Oo.isString(t))throw new ut}validatePlayerId(t){if(!Oo.isString(t))throw new D}async setupCreatePayload(t){const{playerId:s}=t.customData;this.validatePlayerId(s);const{name:a,leaderboardId:n,customData:i}=this.payload;this.leaderboardPayload={_id:n,name:a??"",createdBy:s,description:JSON.stringify(i)}}async createLeaderboardAsync(t){const s=await this.game.leaderboard.createLeaderboardAsync(this.leaderboardPayload);t.customData.leaderboardId=s}};c(Fi,"CreateLeaderboardHandler");let na=Fi;const Ui=class Ui extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,name:s,score:a,leaderboardId:n,payload:i}=e,o=new v(this),r=new vt(this,{contextId:"SOLO"});o.setNext(r);const l=new aa(this,{name:s,score:a,playerId:t,customData:i});r.setNext(l);const d=new st(this,{profileId:t});l.setNext(d);const h=new Ct(this,{id:t,score:a});d.setNext(h);const y=new na(this,{name:s,customData:i,leaderboardId:n});h.setNext(y);const g=new Qt(this);y.setNext(g);const m=new sa(this);g.setNext(m);const I=this.match.getMatchState();await o.processAsync(I)}finally{this.endLog()}}};c(Ui,"CreateTournamentConcrete");let ia=Ui;const{Analytics:To}=f.Plugins,{Valid:Yc}=f.Utils,ki=class ki extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t),await this.postScoreTournamentAsync(t),await this.nextAsync(t)}validateData(t){const{profiles:s,customData:a}=t,{playerId:n}=a;if(this.validatePlayerId(n),!s[n])throw new M}validatePlayerId(t){if(!Yc.isString(t))throw new D}getPlayerProfile(t){const{profiles:s,customData:a}=t,{playerId:n}=a;return this.validatePlayerId(n),s[n]}isNewBestScore(t){const s=this.getPlayerProfile(t),{score:a=0,bestScore:n=0}=s;return a>n}async postScoreTournamentAsync(t){const{analytics:s}=window.game,a=this.getPlayerProfile(t),{score:n=0}=a;let i=null,o=!1;const{checkBestScore:r}=this.payload,l=this.isNewBestScore(t);try{if(!("getTournamentAsync"in GameSDK))throw new P("getTournamentAsync");await GameSDK.getTournamentAsync(),!r||l?(i=To.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:n})):(i=To.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(n)),o=!0}catch(d){console.warn("Post Score Tournament",d)}finally{i&&s.event(i,{success:o})}}};c(ki,"PostScoreTournamentHandler");let oa=ki;const Bi=class Bi extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,bestScore:s}=e,a=new v(this),n=new pt(this,{useAPI:!1});a.setNext(n);const i=new Ct(this,{id:t,bestScore:s});n.setNext(i);const o=new oa(this,{checkBestScore:!1});i.setNext(o);const r=new dt(this);o.setNext(r);const l=new Nt(this);r.setNext(l);const d=new Qt(this);l.setNext(d);const h=new Ht(this);d.setNext(h);const y=new b(this);h.setNext(y);const g=this.match.getMatchState();await a.processAsync(g)}finally{this.endLog()}}};c(Bi,"FinishTournamentConcrete");let ra=Bi;const{Valid:Fe,Object:Qc}=f.Utils,ji=class ji extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{tournamentId:s}=this.payload;this.validateTournamentId(s),await this.joinTournamentAsync(s);const a=await GameSDK.getTournamentAsync(),n=a.getContextID();this.validateContextId(n);const i=JSON.parse(a.getPayload()||"{}"),{leaderboardId:o}=i;this.validateLeaderboardId(o),t.customData.contextId=n,t.customData.tournamentId=s,t.customData.leaderboardId=o,await this.nextAsync(t)}validateTournamentId(t){if(!Fe.isString(t))throw new De}validateContextId(t){if(!Fe.isString(t))throw new F}validateLeaderboardId(t){if(!Fe.isString(t)||t==="")throw new ut}async joinTournamentAsync(t){if(!("tournament"in GameSDK))throw new P("tournament");try{await GameSDK.tournament.joinAsync(t)}catch(s){if(!Qc.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}};c(ji,"JoinTournamentHandler");let ca=ji;const Ki=class Ki extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,tournamentId:s}=e,a=new v(this),n=new ca(this,{tournamentId:s});a.setNext(n);const i=new T(this,{id:"1997",mode:k.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const o=new U(this);i.setNext(o);const r=new st(this,{profileId:t});o.setNext(r);const l=new G(this);r.setNext(l);const d=new Ie(this);l.setNext(d);const h=new b(this);d.setNext(h);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}};c(Ki,"JoinTournamentConcrete");let la=Ki;const{Dtos:Xc,Utils:Jc}=f,{Object:Zc}=Jc,Wi=class Wi extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateMatchCustomData(t),await this.nextAsync(t)}updateMatchCustomData(t){const s=Zc.merge(t.customData,this.payload),a=new Xc.Match.CustomData(s).toObject();t.customData=a}};c(Wi,"SetMatchCustomDataHandler");let da=Wi;const tl={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:{...va}},{Configs:Mo}=f,zi=class zi extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"base");p(this,"group");p(this,"single");p(this,"endless");p(this,"context");p(this,"challenge");p(this,"tournament");p(this,"api");p(this,"handler");p(this,"useCPUProfile")}init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}setUseCPUProfile(t){this.useCPUProfile=t}createMatchData(){const{storage:t}=this.game;t.addStorage("match",tl)}getMatchState(){const{storage:t}=this.game;return t.getStorage("match")}createBaseConcrete(){this.base=new E(this.game,this)}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createConcreteHandlers(){this.handler={setProfileData:c(async t=>{const s=new Ct(this.base,t);await this.processHandlerAsync(s)},"setProfileData"),setMatchCustomData:c(async t=>{const s=new da(this.base,t);await this.processHandlerAsync(s)},"setMatchCustomData"),setLeaderboardScore:c(async t=>{const s=new bt(this.base,t);await this.processHandlerAsync(s)},"setLeaderboardScore")}}createAPIHandler(){const t={appId:Mo.AppId,matchAPIHost:Mo.ApiHost};this.api=new hs(t)}createGroupFlows(){this.group={join:new qs(this.game,this),start:new Qs(this.game,this),finish:new Hs(this.game,this)}}createSingleFlows(){this.single={start:new Zs(this.game,this),finish:new Js(this.game,this)}}createEndlessFlows(){this.endless={start:new Ws(this.game,this),finish:new js(this.game,this)}}createContextFlows(){this.context={choose:new Us(this.game,this)}}createChallengeFlows(){this.challenge={invite:new Cs(this.game,this),friend:new ws(this.game,this),join:new _s(this.game,this),await:new fs(this.game,this),result:new Fs(this.game,this),finish:new xs(this.game,this),continue:new Is(this.game,this)}}createTournamentFlows(){this.tournament={join:new la(this.game,this),create:new ia(this.game,this),finish:new ra(this.game,this),continue:new ea(this.game,this)}}processHandlerAsync(t){const s=this.getMatchState();return t.processAsync(s)}};c(zi,"MatchPlugin");let ha=zi;const{Valid:it}=f.Utils,ot="is invalid",Hi=class Hi extends ${setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!it.isNumber(e)||!e)&&this.exception("level",ot)}validateRescued(e){(!it.isNumber(e)||e<0)&&this.exception("rescued",ot)}validateContextId(e){it.isString(e)||this.exception("contextId",ot)}validatePlayerId(e){it.isString(e)||this.exception("playerId",ot)}validateOpponentId(e){it.isString(e)||this.exception("opponentId",ot)}validateTournamentId(e){it.isString(e)||this.exception("tournamentId",ot)}validateLeaderboardId(e){it.isString(e)||this.exception("leaderboardId",ot)}toObject(){return super.toObject()}static getDefaultData(){return $.getDefaultData()}};c(Hi,"MatchCustomDataDtos");let Pe=Hi;Pe.addDefaultData(va);const{Valid:tt}=f.Utils,et="is invalid",qi=class qi extends ${setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!tt.isString(e)||!e)&&this.exception("id",et)}validateName(e){(!tt.isString(e)||!e)&&this.exception("name",et)}validatePhoto(e){tt.isString(e)||this.exception("photo",et)}validateScore(e){(!tt.isNumber(e)||e<0)&&this.exception("score",et)}validateBestScore(e){(!tt.isNumber(e)||e<0)&&this.exception("bestScore",et)}validateEndlessScore(e){(!tt.isNumber(e)||e<0)&&this.exception("endlessScore",et)}validateBestEndlessScore(e){(!tt.isNumber(e)||e<0)&&this.exception("bestEndlessScore",et)}validateFinished(e){tt.isBoolean(e)||this.exception("finished",et)}toObject(){return super.toObject()}static getDefaultData(){return $.getDefaultData()}};c(qi,"MatchProfileDtos");let xe=qi;xe.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0});f.Dtos.Match={Data:Yt,CustomData:Pe,Profile:xe};const{Utils:el}=f,{ApiHost:sl}=f.Configs,al=c(async u=>{const e=await R("players",u,{},sl,10);return el.Object.hasOwn(e,"data")?e.data||{}:{}},"updatePlayerProfileAsync"),{Utils:nl,Configs:il}=f,{AppId:ol}=il,{Array:rl,Object:ne,Valid:cl}=nl,Yi=class Yi extends C.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("player",xt)}async saveToCloud(){try{const e=this.getPlayerData();await GameSDK.player.setDataAsync(e)}catch(e){console.warn(e)}}receiveData(e,t){const{storage:s}=this.game,{playerId:a,name:n,photo:i,locale:o}=e;s.setStorageData("player","playerId",a),s.setStorageData("player","name",n),s.setStorageData("player","photo",i),s.setStorageData("player","locale",o),t&&this.setPlayerData(t)}async syncProfileToServer(){const{storage:e}=this.game,t=this.getPlayer(),{playerId:s,name:a,photo:n,locale:i}=t;let o=this.getPlayerASID();!cl.isString(o)&&"getASIDAsync"in GameSDK.player&&(o=await GameSDK.player.getASIDAsync()??o,e.setStorageData("player","ASID",`${o}`)),await al({appId:ol,ASID:o,playerId:s,name:a,photo:n,locale:i})}setPlayerDataByName(e,t){this.setPlayerData({[e]:t})}setPlayerData(e){const{storage:t}=this.game;t.setStorageData("player","data",e),this.saveToCloud()}setBestScore(e){this.setPlayerDataByName("score",e)}setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}setSetting(e,t){this.setPlayerDataByName("settings",{[e]:t})}setGameData(e){const t=this.getGameData()??{},s=ne.merge(t,e);this.setPlayerDataByName("gameData",s)}async requestConnectedPlayers(){const{storage:e}=this.game,s=(await GameSDK.player.getConnectedPlayersAsync()).map(i=>{const o=i.getID(),r=i.getName(),l=i.getPhoto();return!o||!r||!l?null:new Et({playerId:o,name:r,photo:l}).toObject()}),a=rl.unique(s);if(a.length<1)return;const n=ne.keyBy(a,"playerId");e.setStorageData("player","connectedPlayers",n)}getPlayer(){const{storage:e}=this.game;return e.getStorage("player")}getPlayerId(){const{storage:e}=this.game;return e.getStorageData("player","playerId")}getPlayerASID(){const{storage:e}=this.game;return e.getStorageData("player","ASID")}getPlayerLocale(){const{storage:e}=this.game;return e.getStorageData("player","locale")}getPlayerData(){const{storage:e}=this.game;return e.getStorageData("player","data")}getPlayerDataByKey(e){const t=this.getPlayerData();return ne.hasOwn(t,e)?t[e]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(e){const t=this.getPlayerSettings();return ne.hasOwn(t,e)?t[e]:null}getPlayerSettings(){const{settings:e}=this.getPlayerData();return e}isFirstLogin(){return this.getPlayerDataByKey("isFirstLogin")??xt.data.isFirstLogin}loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}getBestScore(){const{score:e}=this.getPlayerData();return e}getBestEndlessScore(){const{endlessScore:e}=this.getPlayerData();return e}getConnectedPlayers(){const{storage:e}=this.game;return e.getStorageData("player","connectedPlayers")}getConnectedPlayerIds(e,t){const s=this.getConnectedPlayers();return Object.keys(s).slice(t,t+e)}};c(Yi,"PlayerPlugin");let ua=Yi;const{Dtos:Ro,Utils:ll}=f,{Valid:ft}=ll,{score:Jo,endlessScore:dl,settings:hl,gameData:ul,isFirstLogin:pl,dailyRewarded:yl}=xt.data,gt="is invalid",Qi=class Qi extends ${processData(e){this.validateStructure(e),e.settings=new Ro.Player.Settings(e.settings).toObject(),e.gameData=new Ro.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateScore(e){(!ft.isNumber(e)||e<0)&&this.exception("score",gt)}validateEndlessScore(e){(!ft.isNumber(e)||Jo<0)&&this.exception("endlessScore",gt)}validateSettings(e){ft.isObject(e)||this.exception("settings",gt)}validateGameData(e){ft.isObject(e)||this.exception("gameData",gt)}validateIsFirstLogin(e){ft.isBoolean(e)||this.exception("isFirstLogin",gt)}validateDailyRewarded(e){ft.isObject(e)||this.exception("dailyRewarded",gt)}toObject(){return super.toObject()}};c(Qi,"PlayerDataDtos");let Ee=Qi;Ee.addDefaultData({score:Jo,endlessScore:dl,settings:hl,gameData:ul,isFirstLogin:pl,dailyRewarded:yl});const{Valid:_o}=f.Utils,{level:fl,coins:gl}=xt.data.gameData,Xi=class Xi extends ${setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!_o.isNumber(e)||e<0)&&this.exception("level","is invalid")}validateCoins(e){(!_o.isNumber(e)||e<0)&&this.exception("coins","is invalid")}toObject(){return super.toObject()}};c(Xi,"PlayerGameDataDtos");let Se=Xi;Se.addDefaultData({level:fl,coins:gl});const{Valid:ie}=f.Utils,{sound:wl,music:ml,vibrate:Al,language:Il}=xt.data.settings,oe="is invalid",Ji=class Ji extends ${setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateSound(e){ie.isBoolean(e)||this.exception("sound",oe)}validateMusic(e){ie.isBoolean(e)||this.exception("music",oe)}validateVibrate(e){ie.isBoolean(e)||this.exception("vibrate",oe)}validateLanguage(e){(!ie.isString(e)||!e)&&this.exception("language",oe)}toObject(){return super.toObject()}};c(Ji,"PlayerSettingsDtos");let ve=Ji;ve.addDefaultData({sound:wl,music:ml,vibrate:Al,language:Il});f.Dtos.Player={Info:Et,Data:Ee,Settings:ve,GameData:Se};const{Configs:Dl,Utils:Pl}=f,{Object:xl,String:El}=Pl,{ApiHost:Sl,Mockup:vl}=Dl,Zi=class Zi{constructor(){p(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await rt(async()=>{const{default:t}=await Promise.resolve().then(()=>Gt);return{default:t}},void 0,import.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load ProfileAPIMock");this.mockAPI=new e}async getPlayersAsync(e){const t=El.params(e);let s;return vl.Profile.Enabled?(await this.initMockAPI(),s=await this.mockAPI.getPlayersAsync(e)):s=await At(`players?${t}`,{},Sl),!xl.hasOwn(s,"data")||!Array.isArray(s.data)?[]:s.data}};c(Zi,"ProfileAPI");let pa=Zi;const bl={profiles:{},profileIds:[]},{Utils:Nl,Dtos:Cl}=f,{Array:Ll,Valid:Ol,Object:Tl}=Nl,to=class to extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"profileAPI",new pa)}init(){const{storage:t}=this.game;t.addStorage("profile",bl)}async requestProfiles(t){const s=this.getProfileIds(),a=Ll.difference(t,s);if(a.length<1)return;const n=await this.profileAPI.getPlayersAsync({playerIds:a});if(!this.validateProfilesResponse(n))return;const i=this.convertToProfiles(n);this.setProfiles(i)}getProfile(t){return this.getProfiles()[t]??null}getProfiles(){const{storage:t}=this.game;return t.getStorageData("profile","profiles")}setProfiles(t){const{storage:s}=this.game;s.setStorageData("profile","profiles",t),s.setStorageData("profile","profileIds",Object.keys(t))}getProfileIds(){const{storage:t}=this.game;return t.getStorageData("profile","profileIds")}validateProfilesResponse(t){return!(!Array.isArray(t)||t.length<1)}convertToProfiles(t){const s={};return t.forEach(a=>{Tl.hasOwn(a,"playerId")&&Ol.isString(a.playerId)&&(s[a.playerId]=new Cl.Player.Info(a).toObject())}),s}};c(to,"ProfilePlugin");let ya=to;const{Utils:$o}=f,eo=class eo extends C.Plugins.BasePlugin{constructor(t){super(t);p(this,"storages");this.storages={}}addStorage(t,s){console.info("addStorage",t,s),this.storages[t]=s}setStorageData(t,s,a){let n;if($o.Valid.isObject(a)){const i=this.getStorageData(t,s);n=$o.Object.merge(i,a)}else n=a;this.storages[t][s]=n}getStorageData(t,s){return this.getStorage(t)[s]}getStorage(t){return this.storages[t]}};c(eo,"StoragePlugin");let fa=eo;const so=class so extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"isVisible",!0);p(this,"browserPrefixes",["moz","ms","o","","webkit"]);p(this,"handleVisibilityChange",c(t=>{if(["focus","blur"].indexOf(t)>-1)return t==="focus"?this.onVisibleEvent():this.onHiddenEvent();const a=this.getBrowserPrefix();return this.getHiddenPropertyName(a)in document?this.onHiddenEvent():this.onVisibleEvent()},"handleVisibilityChange"))}init(){const t=this.getBrowserPrefix();[this.getVisibilityEvent(t),"focus","blur"].forEach(n=>{window.addEventListener(n,()=>{this.handleVisibilityChange(n)},!1),document.addEventListener(n,()=>{this.handleVisibilityChange(n)},!1)})}isGameVisible(){return this.isVisible}getHiddenPropertyName(t){return t?t+"Hidden":"hidden"}getVisibilityEvent(t){return(t||"")+"visibilitychange"}getBrowserPrefix(){for(const t of this.browserPrefixes)if(this.getHiddenPropertyName(t)in document)return t;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(f.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(f.Events.VISIBILITY_HIDDEN))}};c(so,"VisibilityPlugin");let ga=so;const ao=class ao extends Ho{async loadAsync(){this.exception("Unsupported method")}async showAsync(){this.exception("This method is not implemented")}async hideAsync(){this.exception("This method is not implemented")}};c(ao,"BannerInstance");let wa=ao;const{Status:Go}=f.Plugins.Ads,no=class no extends wa{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId),this.status=Go.SHOWING}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId),this.status=Go.IDLE}};c(no,"BannerAdInstance");let ma=no;const{Object:Ml}=f.Utils,{Status:H,Types:wt,AdError:re,AdInstance:Rl}=f.Plugins.Ads,io=class io extends Rl{constructor(t,s){super(t,s);p(this,"instance");p(this,"instanceLoadFailedQueue",[]);this.instance=null}async loadAsync(){if(console.info("AdInstance","loadAsync called",{type:this.type,status:this.status}),this.status!==H.IDLE)throw new re("AD_NOT_READY","Ad is not ready.");try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new re("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.status=H.LOADING,await this.instance.loadAsync(),this.status=H.FILLED,console.info("AdInstance","loadAsync success",{type:this.type,status:this.status}),this.type===wt.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(),this.type===wt.REWARDED_VIDEO&&self.game.analytics.loadRewardedVideoAd()}catch(t){throw console.warn("AdInstance","loadAsync failed",{type:this.type,status:this.status,error:t}),this.status=H.IDLE,t instanceof Object&&"code"in t&&t.code==="INVALID_PARAM"&&(this.instance=null),this.instance&&this.instanceLoadFailedQueue.push(this.instance),self.game.analytics.loadAdFail(this.type),t}}async showAsync(){if(console.info("AdInstance","showAsync called",{type:this.type,status:this.status}),this.status!==H.FILLED)throw new re("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new re("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");let t=!1;try{this.status=H.SHOWING,await this.instance.showAsync(),t=!0,this.status=H.IDLE,this.instance=null,console.info("AdInstance","showAsync success",{type:this.type,status:this.status})}catch(s){throw console.warn("AdInstance","showAsync failed",{type:this.type,status:this.status,error:s}),this.status=H.FILLED,f.Utils.Object.hasOwn(s,"code")&&(s.code==="AD_NOT_LOADED"&&(this.status=H.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf(`${s.code}`)>-1&&(this.status=H.IDLE,this.instance=null),s.code==="USER_INPUT"&&(t=!0)),s}finally{t?(this.type===wt.INTERSTITIAL&&self.game.analytics.showInterstitialAd(),this.type===wt.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd()):self.game.analytics.showAdFail(this.type)}}async createInstanceByType(t){try{switch(t){case wt.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case wt.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);default:return null}}catch(s){if(!Ml.hasOwn(s,"code"))throw s;return s.code==="ADS_TOO_MANY_INSTANCES"?this.getAdInstanceFailed():null}}getAdInstanceFailed(){const{length:t}=this.instanceLoadFailedQueue,s=Math.floor(Math.random()*t);return this.instanceLoadFailedQueue[s]||null}};c(io,"NormalAdInstance");let be=io;const{BaseAnalytics:_l,Events:Vo}=f.Plugins.Analytics,$l=[Vo.BUTTON_CLICK,Vo.SCREEN_OPEN],oo=class oo extends _l{constructor(t,s){super(t,"FacebookAnalytics",{...s,color:"#0F52BA"});p(this,"prefix");this.prefix=s.prefix}processEvent(t,s){if(!("logEvent"in GameSDK.extra)||$l.indexOf(t)>-1)return;const a=this.addPrefixToEventName(t);GameSDK.extra.logEvent(a,1,s)}addPrefixToEventName(t){return`${this.prefix}_${t}`}};c(oo,"FacebookAnalytics");let Aa=oo;const{BaseAnalytics:Gl,Events:Vl}=f.Plugins.Analytics,Fl=[Vl.SCREEN_OPEN],ro=class ro extends Gl{constructor(e,t){super(e,"FirebaseAnalytics",{...t,color:"#FFCA28"})}setUser(e,t){var s;(s=this.game.firebase.services.analytics)==null||s.setUser(e,t)}processEvent(e,t){var s;Fl.indexOf(e)>=0||(s=this.game.firebase.services.analytics)==null||s.event(e,t)}};c(ro,"FirebaseAnalytics");let Ia=ro;const{BaseAnalytics:Ul,Events:kl}=f.Plugins.Analytics,Bl=[kl.SCREEN_OPEN],co=class co extends Ul{constructor(e,t){super(e,"GoogleAnalytics",{...t,color:"#E35335"})}processEvent(e,t){Bl.indexOf(e)>=0||gtag("event",e,t)}};c(co,"GoogleAnalytics");let Da=co;const jl="production",Ue="37",{Dtos:Kl,Events:mt,Configs:N,Utils:Wl}=f,{Object:Fo,Json:_t,String:Uo,Valid:ko,Mark:S}=Wl,lo=class lo extends C.Game{constructor(){super(...arguments);p(this,"markName","Core Initialize");p(this,"modulePlugins",[]);p(this,"handleProtectGameInstance",c(()=>{const t=this.event.getEventEmitCount(at.MODULE_PLUGIN_READY),s=this.modulePlugins.length;t<s||(window.game=Object.freeze(window.game))},"handleProtectGameInstance"));p(this,"initMonitorErrorPlugin",c(()=>{if(!this.monitorError)return;const{MonitorError:t}=N.Debugger,{ApiKey:s,Service:a,TrackUser:n,FilterErrors:i,ListPlayerDevIds:o}=t,r=GameSDK.player.getID(),l=GameSDK.player.getName();r&&o.indexOf(r)>-1||(this.monitorError.configure({apiKey:s,service:a,trackUser:n,releaseStage:jl,buildVersion:`${Ue}`}),this.monitorError.setUser({id:r,name:l}),this.monitorError.addFilterErrors(i),this.updateMonitorErrorUserAndMetadata(),this.processErrorsQueue())},"initMonitorErrorPlugin"));p(this,"updateMonitorErrorUserAndMetadata",c(()=>{if(!(this.event.getEventEmitCount(mt.PLAYER_INFO_LOADED)>0)){this.event.once(mt.PLAYER_INFO_LOADED,this.processWhenPlayerInfoLoaded);return}this.processWhenPlayerInfoLoaded()},"updateMonitorErrorUserAndMetadata"));p(this,"processErrorsQueue",c(()=>{window.__errorQueue&&(window.__errorQueue.forEach(t=>{if(this.monitorError)if(t instanceof Error)this.monitorError.sendException(t);else{const{message:s,code:a,stack:n}=t||{message:"",code:"Unknown",stack:"Unknown stack"},i=new Error(s||a);i.stack=n,this.monitorError.sendException(i)}}),window.__errorQueue=null)},"processErrorsQueue"));p(this,"processWhenPlayerInfoLoaded",c(()=>{var a,n;const{playerId:t,name:s}=this.player.getPlayer();(a=this.monitorError)==null||a.setUser({id:t,name:s}),(n=this.monitorError)==null||n.addMetadata({isFirstLogin:this.player.isFirstLogin()})},"processWhenPlayerInfoLoaded"));p(this,"handleSaveRemoteConfig",c(t=>{try{const s={[t.type]:t};this.player.setPlayerDataByName("remoteConfig",s)}catch(s){console.warn("handleSaveGameCoreConfig",s)}},"handleSaveRemoteConfig"));p(this,"handleUpdateGameCoreConfig",c(t=>{try{const{id:s,type:a}=t;if(a!=="GameCore")return;f.Configs=Fo.merge(f.Configs,t.config);const{Ads:n}=f.Configs;this.ads.configure(n),this.event.emit(at.REMOTE_CONFIG_UPDATED,{id:s,type:a})}catch(s){console.warn("handleUpdateGameCoreConfig",s)}},"handleUpdateGameCoreConfig"));p(this,"handleStorageCurrentRemoteConfig",c(()=>{const t=this.player.getPlayerDataByKey("remoteConfig");if(console.info("playerRemoteConfig",_t.clone(t)),!!t){for(const s in t)if(Fo.hasOwn(t,s)){const a=t[s],n=_t.clone(a);console.log("newRemoteConfig",n);const i=new Kl.RemoteConfig.Data(n).toObject();console.info("remoteConfigValid",i),this.remoteConfig.setRemoteConfig(i),this.remoteConfig.processUpdateConfig(i.id,i.type)}}},"handleStorageCurrentRemoteConfig"));p(this,"initAdaptivePerformancePlugin",c(()=>{if(!this.adaptivePerformance)return;const t=_t.clone(N.AdaptivePerformance);this.adaptivePerformance.configure(t)},"initAdaptivePerformancePlugin"));p(this,"processAfterSyncProfile",c(()=>{const{Notification:t}=N;t.Enabled&&this.updatePlayerProfileToNotificationService()},"processAfterSyncProfile"))}getBuildVersion(){return parseInt(`${Ue}`)}async boot(){console.groupCollapsed("🧬 GameCore Boot"),super.boot(),this.addPlugins(),this.initEventPlugin(),this.event.emit(mt.CORE_BOOTING),this.initFirebasePlugin(),this.initMarkCoreInitialize(),S.putAttr(this.markName,"Step","Init Plugins"),this.initAds(),this.initMatchPlugin(),this.initRemoteConfig(),S.putAttr(this.markName,"Step","Load Lazy Plugins"),ko.isDebugger()||this.event.on(mt.MODULE_PLUGIN_READY,this.handleProtectGameInstance),this.addMonitorPlugin().then(this.initMonitorErrorPlugin),this.addAdaptivePerformancePlugin().then(this.initAdaptivePerformancePlugin),S.putAttr(this.markName,"Step","Load Dev Plugins"),this.addDevPlugins().then(()=>{this.initConsolePlugin(),this.initProfilerPlugin(),this.initCanvasRecorderPlugin()})}async start(){console.groupEnd(),console.groupCollapsed("🧬 GameCore Start"),super.start(),S.putAttr(this.markName,"Step","Core Start"),this.event.emit(mt.CORE_STARTING),S.putAttr(this.markName,"Step","Request Token"),await this.auth.requestToken(),S.putAttr(this.markName,"Step","Init States"),await this.initState(),S.putAttr(this.markName,"Step","Process Player Profile"),this.processPlayerProfile(),S.putAttr(this.markName,"Step","Process Context Payload"),await this.context.detectContextSessionType(),this.context.detectContextGameMode();const t=this.storage.getStorageData("context","sessionContextType");S.putAttr(this.markName,"Context Mode",t),S.putAttr(this.markName,"Step","Init Analytics"),this.initGoogleAnalytics(),this.initFirebaseAnalytics(),this.initFacebookAnalytics(),S.putAttr(this.markName,"Step","Core Ready"),S.putAttr(this.markName,"Success","true"),S.stop(this.markName),this.event.emit(mt.CORE_READY)}addPlugins(){this.installPlugin("Storage",fa),this.installPlugin("Event",ts),this.installPlugin("Ads",je),this.installPlugin("Auth",qe),this.installPlugin("Audio",He),this.installPlugin("Match",ha),this.installPlugin("Player",ua),this.installPlugin("Profile",ya),this.installPlugin("Context",Xe),this.installPlugin("Language",os),this.installPlugin("Firebase",es),this.installPlugin("Analytics",Ke),this.installPlugin("Visibility",ga),this.installPlugin("Leaderboard",cs),this.installPlugin("DailyRewards",Ze),this.installPlugin("FrameCapture",is),this.installPlugin("RemoteConfig",es)}installPlugin(t,s,a=!1){const n=Uo.toCamelCase(Uo.capitalize(t));this.plugins.install(t,s,!0,n),t!=="Storage"&&(a?this.emitModulePluginReady(t):this.emitCorePluginReady(t))}async addMonitorPlugin(){const{MonitorError:t}=N.Debugger;if(!t.Enabled)return;this.modulePlugins.push("MonitorError");const s=(await rt(async()=>{const{default:a}=await Promise.resolve().then(()=>Gt);return{default:a}},void 0,import.meta.url)).default;typeof s=="function"&&this.installPlugin("MonitorError",s,!0)}async addAdaptivePerformancePlugin(){const{AdaptivePerformance:t}=N;if(!t.Enabled)return;this.modulePlugins.push("AdaptivePerformance");const s=(await rt(async()=>{const{default:a}=await import("./bundle/index.js");return{default:a}},__vite__mapDeps([0,1]),import.meta.url)).default;typeof s=="function"&&this.installPlugin("AdaptivePerformance",s,!0)}async addDevPlugins(){if(!ko.isDebugger())return;const{ShowConsole:t,ShowProfiler:s,CanvasRecorder:a}=N.Debugger;if(t){this.modulePlugins.push("Console");const n=(await rt(async()=>{const{default:i}=await import("./bundle/console.js");return{default:i}},__vite__mapDeps([2,1,3]),import.meta.url)).default;typeof n=="function"&&this.installPlugin("Console",n,!0)}if(s){this.modulePlugins.push("Profiler");const n=(await rt(async()=>{const{default:i}=await Promise.resolve().then(()=>Gt);return{default:i}},void 0,import.meta.url)).default;typeof n=="function"&&this.installPlugin("Profiler",n,!0)}if(a.Enabled){this.modulePlugins.push("CanvasRecorder");const n=(await rt(async()=>{const{default:i}=await Promise.resolve().then(()=>Gt);return{default:i}},void 0,import.meta.url)).default;typeof n=="function"&&this.installPlugin("CanvasRecorder",n,!0)}}emitCorePluginReady(t){this.event.emit(at.CORE_PLUGIN_READY,{name:t})}emitModulePluginReady(t){this.event.emit(at.MODULE_PLUGIN_READY,{name:t})}initEventPlugin(){const{EventLogging:t}=N.Debugger;t&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}initAds(){const{Ads:t}=f.Plugins;this.ads.configure(N.Ads),this.initAdInstance(t,N)}initAdInstance(t,s){const{InterstitialAdOptions:a,RewardedVideoAdOptions:n,BannerDisplayAdOptions:i}=s.Ads;a.forEach(o=>{this.ads.setAdInstance(t.Types.INTERSTITIAL,o.PlacementId,be)}),n.forEach(o=>{this.ads.setAdInstance(t.Types.REWARDED_VIDEO,o.PlacementId,be)}),i.forEach(o=>{this.ads.setAdInstance(t.Types.BANNER,o.PlacementId,ma)})}async initState(){try{const t=new ke(this);t.initContext(),await t.initPlayer()}catch(t){console.error("StateInitiator",t)}}initConsolePlugin(){this.console&&this.console.configure()}initProfilerPlugin(){this.profiler&&this.profiler.configure()}initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;const{CanvasRecorder:t}=N.Debugger,{Type:s,Quality:a,RecordFps:n,SyncFps:i}=t.Options;this.canvasRecorder.configure({type:s,quality:a,syncFps:i,recordFps:n});const o=document.querySelector("canvas");if(!o)return console.error("Canvas not found");this.canvasRecorder.setCanvas(o)}initRemoteConfig(){const{RemoteConfig:t}=N;if(!t.Enabled)return;const s=_t.clone(t);this.remoteConfig.configure(s),this.event.on(at.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(at.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.once(at.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}initFirebasePlugin(){const{Firebase:t}=N;if(!t.Enabled)return;const s=_t.clone(t);this.firebase.configure(s),S.setService(this.firebase.services.performance)}initMarkCoreInitialize(){N.PerformanceMonitor.CoreFlows&&(S.measure(this.markName),S.putAttr(this.markName,"Build",`${Ue}`),S.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),S.putAttr(this.markName,"Platform",GameSDK.getPlatform()),S.putAttr(this.markName,"Success","false"),S.start(this.markName))}async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch(t){console.warn("processPlayerProfile fail",t)}}async updatePlayerProfileToNotificationService(){try{const{AppId:t}=N,s=this.player.getPlayer(),{ASID:a,playerId:n,name:i,photo:o,locale:r}=s;await gr({appId:t,ASID:a,playerId:n,name:i,photo:o,locale:r})}catch(t){console.warn("updatePlayerProfileToNotificationService",t)}}initGoogleAnalytics(){const{Enabled:t,ConsoleLog:s}=N.Analytics.GoogleAnalytics??{};t&&this.analytics.add(new Da(this.game,{log:!!s}))}initFirebaseAnalytics(){const{Enabled:t,ConsoleLog:s}=N.Analytics.FirebaseAnalytics??{};if(!t)return;const a=new Ia(this.game,{log:!!s}),n=this.player.getPlayer(),{ASID:i,playerId:o,locale:r}=n;a.setUser(o,{ASID:i,locale:r}),this.analytics.add(a)}initFacebookAnalytics(){const{Enabled:t,Prefix:s,ConsoleLog:a}=N.Analytics.FacebookAnalytics??{};if(t){if(typeof s!="string"){console.warn("Facebook Analytics is not configured");return}this.analytics.add(new Aa(this.game,{prefix:s,log:!!a}))}}};c(lo,"MagicGame");let Pa=lo;const{Configs:zl,Utils:Hl,Events:ba}=f,{Device:ql}=Hl,{ForceDesktopDPR:ce}=zl.GameEngine,Yl=c(async()=>{try{gtag("event","app_initialize")}catch(t){console.warn("gtag init",t)}const u=new Pa;window.game=u;const e=20;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e),window.__gameCoreStart=!0,await u.boot(),u.event.once(ba.REQUEST_CORE_START,Zo),Ql(u)},"initGame"),Zo=c(()=>{if(!window.__sdkInitiated){game.event.once(ba.GAME_SDK_READY,Zo);return}window.game.start(),console.warn("Game started");const u=25;window.__sdkLoadingCount<u&&(window.__sdkLoadingCount=u)},"startGame"),Ql=c(u=>{const t=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(t);const s=10;window.__sdkLoadingCount<s&&(window.__sdkLoadingCount=s),u.event.emit(ba.GAME_SDK_READY)},5)},"waitGameSDK");ce!==!1&&ql.isDesktop()&&typeof ce=="number"&&ce>0&&(window.devicePixelRatio=ce);Yl();
