const __vite__fileDeps=["./bundle/index.js","./bundle/core.js","./bundle/console.js","./bundle/__commonjsHelpers__.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
var oo=Object.defineProperty;var Qo=(u,e,t)=>e in u?oo(u,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):u[e]=t;var c=(u,e)=>oo(u,"name",{value:e,configurable:!0});var p=(u,e,t)=>Qo(u,typeof e!="symbol"?e+"":e,t);import{G as f,P as C,M as Xo,_ as rt,a as k,C as at}from"./bundle/core.js";import{g as Jo}from"./bundle/__commonjsHelpers__.js";c(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerPolicy&&(n.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?n.credentials="include":a.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}c(t,"getFetchOpts");function s(a){if(a.ep)return;a.ep=!0;const n=t(a);fetch(a.href,n)}c(s,"processPreload")},"polyfill")();const{Valid:pt,Object:nt,String:Ne,Json:ro}=f.Utils,Lt="is invalid",j=class j{static addDefaultData(e){pt.isObject(e)||this.prototype.exception("default data",Lt),e=ro.clone(e);const{name:t}=this;pt.isObject(j.data[t])||(j.data[t]={}),j.data[t]=nt.merge(j.data[t],e),console.info(`${t} default data:`,j.data[t])}static getDefaultData(){const{name:e}=this;return ro.clone(j.data[e])}static addValidateFunction(e,t){pt.isString(e)||this.prototype.exception("validate key",Lt),typeof t!="function"&&this.prototype.exception("validate function",Lt);const s=`validate${Ne.capitalize(e)}`;nt.assign(this.prototype,{[s]:t})}constructor(e){this.defaultData(),this.processData(e)}processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}defaultData(){const{name:e}=this.constructor;this.lazyDefaultData(j.data[e])}lazyDefaultData(e){pt.isObject(e)||this.exception("data",Lt);for(const t in e)if(nt.hasOwn(e,t)){const s=e[t];nt.assign(this,{[t]:s})}}lazyValidateStructure(e){pt.isObject(e)||this.exception("structure","is not object"),this.getKeys().forEach(t=>{const s=this[t];s===void 0&&this.exception("structure",`has no key ${t}`),!nt.hasOwn(e,t)&&s!==void 0&&this.setDefaultData(t,e)})}setDefaultData(e,t){pt.isObject(t)||this.exception("data",Lt);const s=this[e];s===void 0&&this.exception("default",`has no key ${e}`),nt.assign(t,{[e]:s})}lazyValidateData(e){this.getKeys().forEach(t=>{const s=e[t],a=Ne.removeDiacritics(t).replace(/[^a-zA-Z0-9]/g,""),n=`validate${Ne.capitalize(a)}`,i=this[n];if(typeof i=="function")try{i.call(this,s)}catch(o){console.warn(o),this.setDefaultData(t,e)}else this.exception("validate",`has no function ${n}`)})}lazySetupData(e){this.getKeys().forEach(t=>{const s=e[t];nt.assign(this,{[t]:s})})}validate(){this.validateData(this.toObject())}exception(e,t){throw new Error(`${this.constructor.name}: ${e} ${t}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([e])=>e!=="toObject"))}getKeys(){return Object.keys(this).filter(e=>e!=="toObject")}};c(j,"BaseDtos"),p(j,"data",{});let _=j;f.Dtos={Base:_};const Zo={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded"},Pt={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0}},{Valid:Ot}=f.Utils,{playerId:tr,name:er,photo:sr,locale:ar}=Pt,Tt="is invalid",va=class va extends _{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!Ot.isString(e)||!e)&&this.exception("_id",Tt)}validatePlayerId(e){(!Ot.isString(e)||!e)&&this.exception("playerId",Tt)}validateName(e){(!Ot.isString(e)||!e)&&this.exception("name",Tt)}validatePhoto(e){Ot.isString(e)||this.exception("photo",Tt)}validateLocale(e){(!Ot.isString(e)||!e)&&this.exception("locale",Tt)}toObject(){return super.toObject()}};c(va,"PlayerInfoDtos");let xt=va;xt.addDefaultData({playerId:tr,name:er,photo:sr,locale:ar});const X=new xt({playerId:"10",name:"Your Friend"}).toObject(),ba=class ba extends Error{constructor(t){super(t);p(this,"code");this.code="CREATE_MATCH_FAILED"}};c(ba,"ACreateMatchFailed");let K=ba;const Na=class Na extends K{constructor(e){super(e),this.name="PlayerIdNotValid",this.message=e??"Player id is not valid"}};c(Na,"PlayerIdNotValid");let D=Na;const{Dtos:Ce,Utils:nr,Events:ir}=f,{Array:or,Object:rr,Json:Le,Valid:co}=nr,Ca=class Ca{constructor(e){p(this,"game");p(this,"initContext",c(()=>{const e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},t=new Ce.Context.Info(e),{contextId:s,contextType:a,entryPointData:n}=t.toObject();this.game.context.receiveContext(s,a,n)},"initContext"));p(this,"initPlayer",c(async()=>{const{player:e}=this.game,t=this.getPlayerInfo();console.info("playerInfo",Le.clone(t));const s=or.unique(rr.vals(Zo));console.info("dataKeys",s);const a=await GameSDK.player.getDataAsync(s);console.info("rawData",Le.clone(a));const n=new Ce.Player.Data(a).toObject();console.info("playerData",Le.clone(n)),e.receiveData(t,n),this.game.event.emit(ir.PLAYER_INFO_LOADED)},"initPlayer"));p(this,"getPlayerInfo",c(()=>{try{const e=GameSDK.player.getID();let t=GameSDK.player.getName();const s=GameSDK.player.getPhoto(),a=GameSDK.getLocale();if(!co.isString(e))throw new D;return co.isString(t)||(t="You"),new Ce.Player.Info({playerId:e,name:t,photo:s,locale:a}).toObject()}catch{return X}},"getPlayerInfo"));this.game=e}};c(Ca,"StateInitiator");let Ue=Ca;const La=class La extends Error{constructor(t,s){super(t);p(this,"payload");this.name="BadRequest",this.message=t??"This request is bad",this.payload=s}};c(La,"BadRequest");let Ft=La;const Oa=class Oa extends Error{constructor(t,s){super(t);p(this,"payload");this.name="RequestTimeout",this.message=t??"This request is timeout",this.payload=s}};c(Oa,"RequestTimeout");let Ut=Oa;const{Utils:cr,Configs:lr}=f,{AppId:lo,Network:Da}=lr,dr=c(u=>{if(!u.ok)throw new Ft(void 0,{response:u})},"validateResponse"),Go=c(()=>{const u=window.game.auth.getToken();return{token:u,timeout:Da.Timeout,headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"}}},"defaultConfig"),Fo=c((u,e,t,s)=>async()=>{try{if(!lo)throw new Ft("AppId is not defined");const a=`${u}/apps/${lo}/${e}`,n=new AbortController;t.signal=n.signal;const i=setTimeout(()=>{n.abort()},t.timeout);f.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const o=await fetch(a,t);return clearTimeout(i),dr(o),await o.json()||{}}catch(a){if(a instanceof Ft)return null;throw a instanceof Object&&"name"in a&&a.name==="AbortError"?new Ut:a}},"requester"),Pa=c(async(u,e)=>{try{return u()}catch(t){if(t instanceof Ut&&e>0)try{return await cr.Time.sleepAsync(600),await Pa(u,e-1)}catch{return{}}return t instanceof Ut?{}:(console.warn("Request error",t),{})}},"handleRequest"),mt=c(async(u,e={},t,s=Da.Retries)=>{try{const a={...Go(),...e,method:"GET"},n=Fo(t,u,a);return await Pa(n,s)}catch(a){return console.warn("Get error",a),{}}},"get"),M=c(async(u,e,t={},s,a=Da.Retries)=>{try{const n={...Go(),...t,method:"POST"},i=Fo(s,u,n,e);return await Pa(i,a)}catch(n){return console.warn("Post error",n),{}}},"post"),{ApiUrl:hr}=f.Configs.Notification,ur=c(async u=>{if(!f.Utils.Object.hasOwn(u,"playerId"))throw new Error("Missing playerId");const{playerId:e}=u;await M(`players/${e}`,u,{},hr,10)},"updatePlayerProfileNotificationAsync");var Uo=(u=>(u.IDLE="idle",u.LOADING="loading",u.FILLED="filled",u.SHOWING="showing",u))(Uo||{});const ko=Uo;var Bo=(u=>(u.BANNER="banner",u.INTERSTITIAL="interstitial",u.REWARDED_VIDEO="rewarded_video",u))(Bo||{});const Q=Bo;var At;let $t=(At=class extends Error{constructor(t,s){super(s);p(this,"code");this.code=t,this.message=s}},c(At,"AdError"),At);const Ta=class Ta{constructor(e,t){p(this,"type");p(this,"status");p(this,"placementId");this.type=e,this.status=ko.IDLE,this.placementId=t}getStatus(){return this.status}exception(e){throw new $t("AD_INSTANCE_ERROR",e)}};c(Ta,"BaseInstance");let ke=Ta;var It;let jo=(It=class extends ke{loadAsync(){this.exception("This method is not implemented")}showAsync(){this.exception("This method is not implemented")}hideAsync(){this.exception("Unsupported method")}},c(It,"AdInstance"),It);f.Plugins.Ads={Types:Q,Status:ko,AdError:$t,AdInstance:jo};const{Array:Oe,Object:pr}=f.Utils,Ma=class Ma extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"enabled");p(this,"config");p(this,"lastCallAdShownTime");p(this,"isAdFullSizeShowed");p(this,"ads",{});p(this,"safeAreaBottom")}init(){this.lastCallAdShownTime=0,this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}calculateSafeAreaBottom(){try{const t=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(t,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(t){this.config=t,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new $t("ADS_NOT_ENABLED","Ads is't enabled")}isAdFullSizeShowing(){return this.isAdFullSizeShowed}setAdInstance(t,s,a){if(this.ads[s]){console.warn(`AdsPlugin: Ad instance with placementId ${s} already exists`);return}this.ads[s]={type:t,placementId:s,interval:null,instance:new a(t,s)}}async preloadInterstitialAdAsync(){await this.loadAdAsync(Q.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new $t("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(Q.INTERSTITIAL)}async preloadRewardedVideoAsync(){await this.loadAdAsync(Q.REWARDED_VIDEO)}async showRewardedVideoAsync(){await this.showAdAsync(Q.REWARDED_VIDEO)}async loadAdAsync(t,s){this.checkEnabled(),await this.getAd(t,s).instance.loadAsync()}async showAdAsync(t,s){this.checkEnabled();const{event:a}=this.game,n=this.getAd(t,s);this.lastCallAdShownTime=window.performance.now()/1e3;try{a.emit(f.Events.AD_SHOWING,{placementId:s}),this.isAdFullSizeShowed=!0,await n.instance.showAsync()}finally{a.emit(f.Events.AD_CLOSED,{placementId:s}),this.isAdFullSizeShowed=!1}}getAdStatus(t,s){return this.checkEnabled(),this.getAd(t,s).instance.getStatus()}getAd(t,s){let a=null;if(s?a=this.getAdByPlacementId(s):a=this.getPriorityAdByType(t),!a)throw new $t("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return a}getAdsByType(t){return pr.vals(this.ads).filter(s=>s.type===t)}getAdByPlacementId(t){const s=this.ads[t];return s||null}getPriorityAdByType(t){const s=this.getAdsByType(t);if(!s.length)return null;const a=Oe.search(s,n=>n.type===t);return a||null}canbeShowInterstitialAd(t){return this.canbeShowInterstitialAdByTime(t)}canbeShowInterstitialAdByTime(t){try{const s=window.performance.now()/1e3;let a;if(t)a=this.getCommonAdConfig(t);else{const d=this.getPriorityAdByType(Q.INTERSTITIAL);if(!d)return!1;a=this.getCommonAdConfig(d.placementId)}const{SecondsBetweenAds:n,SecondsFirstTime:i}=a,o=s-this.lastCallAdShownTime,r=o>n,l=o>i;return this.lastCallAdShownTime>0?r:l}catch(s){return console.warn("Error while checking canbeShowInterstitialAdByTime",s),!1}}canbeShowBannerAd(t){try{const s=this.getBannerConfig(t),{Platform:a}=s;if(a==="ALL")return!0;const n=GameSDK.getPlatform();return n?n===a:!1}catch(s){return console.warn("Error while checking canbeShowBannerAd",s),!1}}async showBannerAdAsync(t){this.checkEnabled();const s=this.getAd(Q.BANNER,t);if(!this.canbeShowBannerAd(s.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(s.placementId),await s.instance.showAsync();const{event:a}=this.game;a.emit(f.Events.AD_SHOWING,{placementId:t});const n=this.getBannerConfig(s.placementId),{SecondsReload:i}=n;i<=0||(s.interval=setTimeout(()=>{this.showBannerAdAsync(s.placementId)},i*1e3))}async hideBannerAdAsync(t){this.checkEnabled();const s=this.getAd(Q.BANNER,t);this.cleanBannerReloadTimer(s.placementId),await s.instance.hideAsync();const{event:a}=this.game;a.emit(f.Events.AD_CLOSED,{placementId:t})}cleanBannerReloadTimer(t){try{const s=this.getAd(Q.BANNER,t),{interval:a}=s;if(!a)return;clearInterval(a)}catch(s){console.warn("Error while cleaning banner reload timer",s)}}getCommonAdConfig(t){const s=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions],a=Oe.search(s,n=>n.PlacementId===t);if(!a)throw new Error(`Ad config with placementId ${t} not found`);return a}getBannerConfig(t){const s=Oe.search(this.config.BannerDisplayAdOptions,a=>a.PlacementId===t);if(!s)throw new Error(`Banner config with placementId ${t} not found`);return s}getBannerHeight(t,s,a=!0){this.checkEnabled();const n=this.getBannerConfig(t),i=GameSDK.getBannerHeight(n);return a?(i+this.safeAreaBottom)*s:i*s}getSafeAreaBottom(t){return this.safeAreaBottom*t}};c(Ma,"AdsPlugin");let Be=Ma;var Ko=(u=>(u.BUTTON_CLICK="button_click",u.SCREEN_OPEN="screen_open",u.LOAD_START="load_start",u.LOAD_COMPLETE="load_complete",u.GAME_SDK_READY="game_sdk_ready",u.APP_READY="app_ready",u.PAGE_VIEW="page_view",u.TUTORIAL_BEGIN="tutorial_begin",u.TUTORIAL_STEP="tutorial_step",u.TUTORIAL_COMPLETE="tutorial_complete",u.MATCH_START="match_start",u.MATCH_RESCUE="match_rescue",u.MATCH_END="match_end",u.LEVEL_START="level_start",u.LEVEL_RESCUE="level_rescue",u.LEVEL_END="level_end",u.SHARE="share",u.MESSAGE="message",u.INVITE="invite",u.SHORTCUT_CREATE="shortcut_create",u.SHORTCUT_CREATE_POPUP="shortcut_create_popup",u.BOT_SUBSCRIBE="bot_subscribe",u.BOT_SUBSCRIBE_POPUP="bot_subscribe_popup",u.AD_LOAD="ad_load",u.AD_LOAD_FAILED="ad_load_failed",u.AD_SHOW="ad_show",u.AD_SHOW_FAILED="ad_show_failed",u.AD_REWARD="ad_reward",u.AD_IMPRESSION="ad_impression",u.NEW_USER="new_user",u.JOIN_GROUP="join_group",u.TOURNAMENT_START="tournament_start",u.TOURNAMENT_SHARE="tournament_share",u.TOURNAMENT_CREATE="tournament_create",u.TOURNAMENT_POST_SCORE="tournament_post_score",u.GET_FREE_ITEM="get_free_item",u.USE_ITEM="use_item",u.EARN_ITEM="earn_item",u))(Ko||{});const G=Ko,{String:ho,Valid:yr}=f.Utils;var Dt;let fr=(Dt=class{constructor(e,t,s){p(this,"game");p(this,"name");p(this,"color");p(this,"options");p(this,"selfLog");p(this,"currentPath");this.game=e,this.name=t,this.options=s,this.color=s.color||"#FFF",this.selfLog=s.log,this.currentPath="/",console.info(`%c${this.name}: init`,`color: ${this.color}`,this.options)}event(e,t){this.logInfo("event",{name:e,payload:t});const s=this.formatEventName(e);this.processEvent(s,t)}logInfo(e,t){this.selfLog&&console.info(`%c${this.name}: ${e}`,`color: ${this.color}`,t)}pageview(e){let t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),console.info("AnalyticsService: Page view",t),document.title=t,this.event(G.PAGE_VIEW,{page_title:t})}levelStart(e,t){this.event(G.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e)})}levelFail(e,t){this.event(G.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e)})}levelRescue(e,t){this.event(G.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e)})}levelComplete(e,t){this.event(G.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e)})}loadAdEvent(e,t){this.event(G.AD_LOAD,{ad_type:e,screen_name:t})}showAdEvent(e,t){this.event(G.AD_SHOW,{ad_type:e,screen_name:t}),this.event(G.AD_IMPRESSION,{ad_format:e})}loadInterstitialAd(e){this.loadAdEvent("interstitial",e)}showInterstitialAd(e){this.showAdEvent("interstitial",e)}loadRewardedVideoAd(e){this.loadAdEvent("rewarded_video",e)}showRewardedVideoAd(e){this.showAdEvent("rewarded_video",e)}receiveVideoReward(e){this.event(G.AD_REWARD,{screen_name:e})}loadAdFail(e,t){this.event(G.AD_LOAD_FAILED,{ad_type:e,screen_name:t})}showAdFail(e,t){this.event(G.AD_SHOW_FAILED,{ad_type:e,screen_name:t})}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}getLevelName(e){return`Level ${e}`}getPageTitle(e){const t=e.split("/").pop();if(!yr.isString(t))return e;const s=t.replace(/([-_\s.])/g," $1");return ho.toUpperCamelCase(s)}addGameModeToPageTitle(e){const{match:t}=this.game,s=t.getMatchState();let{mode:a}=s;return a||(a="Normal"),`${ho.toUpperCamelCase(a)}::${e}`}},c(Dt,"BaseAnalytics"),Dt);f.Plugins.Analytics={Events:G,BaseAnalytics:fr};const Ra=class Ra extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"analytics",[]);p(this,"placement","unknown");p(this,"pageview",c(t=>{if(!this.isActive())return;this.placement=t;const s=this.getPageByKey(t);this.analytics.forEach(a=>{a.pageview(s)})},"pageview"))}add(t){this.analytics.some(a=>a.name===t.name)||this.analytics.push(t)}isActive(){return this.analytics.length>=1}event(t,s){this.isActive()&&this.analytics.forEach(a=>{a.event(t,s)})}levelStart(t,s){this.isActive()&&this.analytics.forEach(a=>{a.levelStart(t,s)})}levelRescue(t,s){this.isActive()&&this.analytics.forEach(a=>{a.levelRescue(t,s)})}levelFail(t,s){this.isActive()&&this.analytics.forEach(a=>{a.levelFail(t,s)})}levelComplete(t,s){this.isActive()&&this.analytics.forEach(a=>{a.levelComplete(t,s)})}loadInterstitialAd(){this.isActive()&&this.analytics.forEach(t=>{t.loadInterstitialAd(this.placement)})}showInterstitialAd(){this.isActive()&&this.analytics.forEach(t=>{t.showInterstitialAd(this.placement)})}loadRewardedVideoAd(){this.isActive()&&this.analytics.forEach(t=>{t.loadRewardedVideoAd(this.placement)})}showRewardedVideoAd(){this.isActive()&&this.analytics.forEach(t=>{t.showRewardedVideoAd(this.placement)})}receiveVideoReward(){this.isActive()&&this.analytics.forEach(t=>{t.receiveVideoReward(this.placement)})}loadAdFail(t){this.isActive()&&this.analytics.forEach(s=>{s.loadAdFail(t,this.placement)})}showAdFail(t){this.isActive()&&this.analytics.forEach(s=>{s.showAdFail(t,this.placement)})}getPageByKey(t){if(t.indexOf("_")>-1){let s=t.replace(/_/g,"-");return s=s.toLowerCase(),s}else{let s=t.length-1,a="";for(;s>0;){a=t.charAt(s);const n=isNaN(parseInt(a,10)),i=a===a.toUpperCase();n&&i&&(t=`${t.slice(0,s)}-${t.slice(s)}`),s--}return t.toLowerCase()}}};c(Ra,"AnalyticsPlugin");let je=Ra;const _a=class _a{constructor(e){p(this,"key");this.key=e}getKey(){return this.key}};c(_a,"BaseAudioPlayer");let Ke=_a;const $a=class $a{constructor(e){p(this,"id");p(this,"isMuteAll");p(this,"masterVolume");p(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}setAudioClip(e,t){this.audioClips[e]={...this.audioClips[e],...t}}play(e,t){const s=this.getAudioClip(e);if(s){const{audioPlayer:a}=s;this.playWithRealConfig(a,t)}else this.loadAndPlay(e,t)}async loadAndPlay(e,t){try{const s=await this.onLoadAudio(e,t),{volume:a=1}=t||{};this.setAudioClip(e,{volume:a,audioPlayer:s}),this.playWithRealConfig(s,t)}catch(s){console.warn("playAudio",s)}}playWithRealConfig(e,t){if(t){const{volume:s=1}=t;t.volume=this.masterVolume*s}e.play(t)}pause(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.pause(),!0}resume(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.resume(),!0}stop(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(e,t){try{const{audioPlayer:s,volume:a=1}=e;switch(t){case"play":s.play();break;case"pause":s.pause();break;case"resume":s.resume();break;case"stop":s.stop();break;case"mute":s.setVolume(0);break;case"unmute":case"setVolume":s.setVolume(this.masterVolume*a);break;default:throw new Error(`Unsupported function: ${t}`)}}catch(s){console.warn("queueAudioPlayer",s)}}callAudioPlayers(e){const{Object:t}=f.Utils;t.vals(this.audioClips).forEach(a=>{this.queueAudioPlayer(a,e)})}};c($a,"BaseChannelManager");let We=$a;f.Plugins.Audio={BaseAudioPlayer:Ke,BaseChannelManager:We};const Va=class Va extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"firstChannelId");p(this,"channels",{})}addChannel(t){const s=t.getId();this.channels[s]=t,this.firstChannelId||(this.firstChannelId=s)}getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];const s=this.channels[t];if(!s)throw new Error(`Channel ${t} not found`);return s}play(t,s,a){try{this.getChannel(a).play(t,s)}catch(n){console.warn("playSound",n)}}pause(t,s){try{this.getChannel(s).pause(t)}catch(a){console.warn("pauseSound",a)}}resume(t,s){try{this.getChannel(s).resume(t)}catch(a){console.warn("resumeSound",a)}}stop(t,s){try{this.getChannel(s).stop(t)}catch(a){console.warn("stopSound",a)}}stopAll(t){try{this.getChannel(t).stopAll()}catch(s){console.warn("stopAllSounds",s)}}mute(t){try{this.getChannel(t).muteAll()}catch(s){console.warn("mute",s)}}unmute(t){try{this.getChannel(t).unmuteAll()}catch(s){console.warn("unmute",s)}}setVolume(t,s){try{this.getChannel(s).setVolume(t)}catch(a){console.warn("setSoundVolume",a)}}};c(Va,"AudioPlugin");let ze=Va;const gr={token:"",isRequesting:!1},Ga=class Ga extends C.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("auth",gr)}async requestToken(){const{storage:e}=this.game;try{if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return;e.setStorageData("auth","isRequesting",!0);const n=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();e.setStorageData("auth","token",n)}catch(t){if(f.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;e.setStorageData("auth","token",""),console.error(t)}finally{e.setStorageData("auth","isRequesting",!1)}}getToken(){const{storage:e}=this.game;return e.getStorageData("auth","token")}};c(Ga,"AuthPlugin");let He=Ga;var Wo=(u=>(u.SOLO="solo",u.TOURNAMENT="tournament",u.SHARE_INVITE="share_invite",u.MATCHING_GROUP="matching_group_match",u.CHALLENGE_FRIEND="challenge_friend_match",u))(Wo||{});const kt=Wo,ct=Xo,{Array:wr,Valid:mr}=f.Utils,Fa=class Fa{constructor(e){p(this,"game");this.game=e}isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}isValidEntryPointData(e){return mr.isObject(e)}isTournamentEntryPoint(e){return["facebook~game_list~tournaments","fb_feed_tournament_unit"].indexOf(e)>=0}receiveContext(e,t,s){const{storage:a}=this.game;a.setStorageData("context","contextId",e),this.isValidEntryPointData(s)?a.setStorageData("context","entryPointData",s):console.warn(`Invalid context type: ${t}`),this.isValidContextType(t)?a.setStorageData("context","contextType",t):console.warn(`Invalid context type: ${t}`)}async detectContextSessionType(){const{storage:e}=this.game,t=e.getStorageData("context","entryPointData"),{type:s}=t,{SOLO:a,TOURNAMENT:n,MATCHING_GROUP:i,SHARE_INVITE:o,CHALLENGE_FRIEND:r}=kt;let l=a;if(s===n&&(l=n),s===i&&(l=i),(s===r||s===o)&&(l=r),l===a){let d=null;try{d=new URLSearchParams(window.location.search).get("entry_point")}catch{const g=window.location.search.substring(1).split("&");d=wr.search(g,w=>{const[I]=w.split("=");return I==="entry_point"})}if(d)l=this.isTournamentEntryPoint(d)?n:a;else try{if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");await GameSDK.getTournamentAsync(),l=n}catch{}}e.setStorageData("context","sessionContextType",l)}detectContextGameMode(){const{player:e,storage:t}=this.game,s=t.getStorageData("context","entryPointData"),a=t.getStorageData("context","sessionContextType"),n=e.getPlayerId(),{matchId:i,playerId:o,opponentId:r=X.playerId}=s,l=n===o,h=r===X.playerId||[r,o].indexOf(n)>=0,{TOURNAMENT:y,MATCHING_GROUP:g,SHARE_INVITE:w,CHALLENGE_FRIEND:I}=kt;let m=ct.SINGLE;a===y&&(m=ct.TOURNAMENT),a===w&&!l&&(m=ct.CHALLENGE_FRIEND),a===I&&i&&h&&(m=ct.CHALLENGE_FRIEND),a===g&&(m=ct.MATCHING_GROUP),t.setStorageData("context","contextGameMode",m)}};c(Fa,"Context");let qe=Fa;const Ua=class Ua extends Error{constructor(e){super(e),this.name="PlayerHasFinishedMatch",this.message=e??"Player has finished match"}};c(Ua,"PlayerHasFinishedMatch");let le=Ua;const ka=class ka extends Error{constructor(e){super(e),this.name="PlayerNotJoinInMatch",this.message=e||"Player is not join in match"}};c(ka,"PlayerNotJoinInMatch");let Bt=ka;const{Events:Te,Plugins:Ar}=f,{Analytics:Ir}=Ar,Ba=class Ba{constructor(e){p(this,"game");this.game=e}async processContextData(){const{player:e,analytics:t,storage:s}=this.game,a=s.getStorageData("context","contextId"),n=s.getStorageData("context","entryPointData"),i=s.getStorageData("context","sessionContextType"),{type:o,matchId:r,playerId:l,opponentId:d,playerScore:h}=n||{};console.info("isFirstLogin",e.isFirstLogin()),e.isFirstLogin()&&t.event(Ir.Events.NEW_USER);const{TOURNAMENT:y,SHARE_INVITE:g,MATCHING_GROUP:w,CHALLENGE_FRIEND:I}=kt;if(i===y){try{await this.processTournamentModeAsync()}catch{await this.processSingleModeAsync()}return}if(i===I){if(o===g&&typeof l=="string"){await this.processChallengeFromPostAsync(l);return}if(o===I&&typeof r=="string"&&typeof l=="string"&&typeof d=="string"){await this.processChallengeFromMessageAsync({contextId:a,matchId:r,playerId:l,opponentId:d});return}}if(i===w&&typeof l=="string"&&typeof h=="number"){await this.processMatchingGroupModeAsync(l,h);return}if(e.isFirstLogin()){await this.processSingleModeAsync(),e.loggedIn();return}this.switchToDashboardScene()}async processTournamentModeAsync(){const{match:e,player:t}=this.game,s=t.getPlayerId(),a=GameSDK.context.getID();if(typeof a!="string")throw new Error("Cannot get contextId");await e.tournament.continue.processAsync({playerId:s,contextId:a}),this.switchToGameScene()}async processChallengeFromPostAsync(e){const{match:t,player:s}=this.game,a=s.getPlayerId();if(a===e)await t.single.start.processAsync({playerId:a});else try{await t.challenge.friend.processAsync({playerId:a,opponentId:e})}catch(i){console.warn("processChallengeFromPostAsync",i),await t.single.start.processAsync({playerId:a})}this.switchToGameScene()}async processChallengeFromMessageAsync(e){try{await this.processContinueChallengeFromMessageAsync(e)}catch(t){if(console.warn("processContinueChallengeFromMessageAsync",t),t instanceof le){await this.processAwaitChallengeFromMessageAsync(e);return}if(t instanceof Bt){await this.processJoinChallengeFromMessageAsync(e);return}this.switchToDashboardScene()}}async processContinueChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,{match:i,player:o}=this.game,r=o.getPlayerId();if(a===r)await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:r,opponentId:n});else{const d=n===X.playerId;await i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:r,opponentId:d?n:a})}this.switchToGameScene()}async processJoinChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,o=i.getPlayerId();await n.challenge.join.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a}),this.switchToGameScene()}async processAwaitChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,o=i.getPlayerId();try{await n.challenge.await.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a}),this.switchToChallengeResultScene()}catch(r){console.warn("processAwaitChallengeFromMessageAsync",r),await this.processResultChallengeFromMessageAsync(e)}}async processResultChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:a}=e,{match:n,player:i}=this.game,o=i.getPlayerId();try{await n.challenge.result.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a}),this.switchToChallengeResultScene()}catch{this.switchToDashboardScene()}}async processMatchingGroupModeAsync(e,t){const{match:s,player:a}=this.game;await s.group.join.processAsync({playerId:a.getPlayerId(),opponentId:e,opponentScore:t}),this.switchToGameScene()}async processSingleModeAsync(){const{match:e,player:t}=this.game,s=t.getPlayerId();await e.single.start.processAsync({playerId:s}),this.switchToGameScene()}switchToDashboardScene(){const{event:e}=this.game;e.emit(Te.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isMatchStartFromLoader:!0}})}switchToGameScene(){const{event:e}=this.game;e.emit(Te.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isMatchStartFromLoader:!0}})}switchToChallengeResultScene(){const{event:e}=this.game;e.emit(Te.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isMatchStartFromLoader:!0}})}};c(Ba,"Loader");let Ye=Ba;const zo={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},{Events:Dr}=f,ja=class ja extends C.Plugins.BasePlugin{constructor(t){super(t);p(this,"context");p(this,"loader");this.loader=new Ye(t),this.context=new qe(t)}init(){const{storage:t}=this.game;t.addStorage("context",zo)}getSessionContextTypes(){return kt}async processContextData(){try{await this.loader.processContextData()}catch(t){console.error("processContextData",t),this.switchToDashboardScene()}}async detectContextSessionType(){try{await this.context.detectContextSessionType()}catch(t){console.error("detectContextSessionType",t)}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(t,s,a){this.context.receiveContext(t,s,a)}switchToDashboardScene(){const{event:t}=this.game;t.emit(Dr.SWITCH_SCENE,{sceneName:"DashboardScene"})}};c(ja,"ContextPlugin");let Qe=ja;const{Valid:Me}=f.Utils,{contextId:Pr,contextType:xr,entryPointData:Er}=zo,Re="is invalid",Ka=class Ka extends _{constructor(){super(...arguments);p(this,"data")}setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateContextId(t){Me.isString(t)||this.exception("contextId",Re)}validateContextType(t){(!Me.isString(t)||!t)&&this.exception("contextType",Re)}validateEntryPointData(t){Me.isObject(t)||this.exception("entryPointData",Re)}toObject(){return super.toObject()}};c(Ka,"ContextInfoDtos");let de=Ka;de.addDefaultData({contextId:Pr,contextType:xr,entryPointData:Er});f.Dtos.Context={Info:de};const Sr={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},{Object:vr}=f.Utils,Wa=class Wa{async getDailyRewardsAsync(){return vr.vals(Sr)}};c(Wa,"DailyRewardsAPI");let Xe=Wa;const Mt={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},br={dailyRewards:{}},uo=f.Configs.DailyRewards,za=class za extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"dailyRewardsApi",new Xe)}init(){const{storage:t}=this.game;t.addStorage("dailyRewards",br)}async requestDailyRewardsAsync(){const t=await this.dailyRewardsApi.getDailyRewardsAsync();t.length!==0&&this.receiveDailyRewards(t)}getDailyRewards(){const{storage:t}=this.game,s=t.getStorageData("dailyRewards","dailyRewards");return s||null}logLoginReward(){const{player:t}=this.game,{logDays:s}=t.getPlayerData().dailyRewarded,a=[...s];a[a.length-1]=!0,this.logDailyRewards(a)}logDailyRewards(t,s=!1){const{player:a}=this.game;a.setPlayerDataByName("dailyRewarded",{logDays:t,lastRewarded:s?0:Date.now()})}receiveDailyRewards(t){const{player:s}=this.game,{logDays:a,lastRewarded:n}=s.getPlayerData().dailyRewarded,i=new Date,o=new Date(n),r=new Date(o.toDateString()),l=Math.abs(i.valueOf()-r.valueOf()),h=Math.floor(l/864e5)>1,g=uo.CheckInterrupt&&h||a.length>=uo.MaxDays,w=g?[!1]:[...a,!1];this.logDailyRewards(w);const I=t.map((m,L)=>{const z=L<w.length,P=w.length===L+1,be=w[L]===!1;let B=Mt.WAITING;return P?B=Mt.READY:g?B=Mt.WAITING:z&&be?B=Mt.SKIPPED:z&&(B=Mt.REWARDED),{...m,status:B}});this.setDailyRewards(I)}setDailyRewards(t){const{storage:s}=this.game;s.setStorageData("dailyRewards","dailyRewards",t)}};c(za,"DailyRewardsPlugin");let Je=za;var xa={exports:{}};xa.exports;(function(u){var e=Object.prototype.hasOwnProperty,t="~";function s(){}c(s,"Events"),Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function a(r,l,d){this.fn=r,this.context=l,this.once=d||!1}c(a,"EE");function n(r,l,d,h,y){if(typeof d!="function")throw new TypeError("The listener must be a function");var g=new a(d,h||r,y),w=t?t+l:l;return r._events[w]?r._events[w].fn?r._events[w]=[r._events[w],g]:r._events[w].push(g):(r._events[w]=g,r._eventsCount++),r}c(n,"addListener");function i(r,l){--r._eventsCount===0?r._events=new s:delete r._events[l]}c(i,"clearEvent");function o(){this._events=new s,this._eventsCount=0}c(o,"EventEmitter"),o.prototype.eventNames=c(function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},"eventNames"),o.prototype.listeners=c(function(l){var d=t?t+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var y=0,g=h.length,w=new Array(g);y<g;y++)w[y]=h[y].fn;return w},"listeners"),o.prototype.listenerCount=c(function(l){var d=t?t+l:l,h=this._events[d];return h?h.fn?1:h.length:0},"listenerCount"),o.prototype.emit=c(function(l,d,h,y,g,w){var I=t?t+l:l;if(!this._events[I])return!1;var m=this._events[I],L=arguments.length,z,P;if(m.fn){switch(m.once&&this.removeListener(l,m.fn,void 0,!0),L){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,d),!0;case 3:return m.fn.call(m.context,d,h),!0;case 4:return m.fn.call(m.context,d,h,y),!0;case 5:return m.fn.call(m.context,d,h,y,g),!0;case 6:return m.fn.call(m.context,d,h,y,g,w),!0}for(P=1,z=new Array(L-1);P<L;P++)z[P-1]=arguments[P];m.fn.apply(m.context,z)}else{var be=m.length,B;for(P=0;P<be;P++)switch(m[P].once&&this.removeListener(l,m[P].fn,void 0,!0),L){case 1:m[P].fn.call(m[P].context);break;case 2:m[P].fn.call(m[P].context,d);break;case 3:m[P].fn.call(m[P].context,d,h);break;case 4:m[P].fn.call(m[P].context,d,h,y);break;default:if(!z)for(B=1,z=new Array(L-1);B<L;B++)z[B-1]=arguments[B];m[P].fn.apply(m[P].context,z)}}return!0},"emit"),o.prototype.on=c(function(l,d,h){return n(this,l,d,h,!1)},"on"),o.prototype.once=c(function(l,d,h){return n(this,l,d,h,!0)},"once"),o.prototype.removeListener=c(function(l,d,h,y){var g=t?t+l:l;if(!this._events[g])return this;if(!d)return i(this,g),this;var w=this._events[g];if(w.fn)w.fn===d&&(!y||w.once)&&(!h||w.context===h)&&i(this,g);else{for(var I=0,m=[],L=w.length;I<L;I++)(w[I].fn!==d||y&&!w[I].once||h&&w[I].context!==h)&&m.push(w[I]);m.length?this._events[g]=m.length===1?m[0]:m:i(this,g)}return this},"removeListener"),o.prototype.removeAllListeners=c(function(l){var d;return l?(d=t?t+l:l,this._events[d]&&i(this,d)):(this._events=new s,this._eventsCount=0),this},"removeAllListeners"),o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,u.exports=o})(xa);var Nr=xa.exports;const Cr=Jo(Nr),Z=new Cr,Lr={names:[],history:[]},Ha=class Ha extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"enableLog",!1);p(this,"muteEvents",[])}init(){const{storage:t}=this.game;t.addStorage("event",Lr)}enableLogEvent(){this.enableLog=!0}on(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"on","listening"),Z.on(t,s)}once(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"once","listening"),Z.once(t,s)}off(t,s){this.validateCallback(s),Z.off(t,s),this.addHistory(t,"any","removed")}mute(t){this.muteEvents.indexOf(t)>-1||this.muteEvents.push(t)}clear(t){Z.removeAllListeners(t),this.addHistory(t,"any","removed")}emit(t,s){if(this.muteEvents.indexOf(t)>-1)return;let a=[];s&&(a=[s]),this.addHistory(t,"any","called",s),Z.emit(t,...a)}validateCallback(t){if(typeof t!="function")throw new Error("Callback must be a function")}addEventName(t){const{storage:s}=this.game,a=s.getStorageData("event","names");a.indexOf(t)<0&&a.push(t)}getEventListeners(){const t=Z.eventNames();return Object.keys(t)}getHistory(){const{storage:t}=this.game;return t.getStorageData("event","history")}getEventEmitCount(t){return this.getHistory().filter(a=>a.name===t&&a.status==="called").length}getLastEventInfo(t){const s=this.getHistory();let a=null;for(let n=s.length-1;n>=0;n--)if(s[n].name===t){a=s[n];break}return a}getTypeFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.type)??null}getCallsFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.called)??0}addHistory(t,s,a,n){const o=this.getTypeFromHistory(t)??s,r=this.getCallsFromHistory(t),l=a==="called"?r+1:r;this.getHistory().push({type:o,status:a,name:t,called:l,payload:n??{}}),this.logEventInfo(t,o,a,l)}logEventInfo(t,s,a,n){if(this.enableLog){if(a==="listening"){console.info(`Event (${s}) ${t}: ${a}`);const i=Z.listenerCount(t);i>1&&console.warn(`Event ${t} has ${i} listener`)}else s!=="any"&&console.info(`Event (${s}) ${t}: ${a} (${n} times)`);a==="called"&&Z.listenerCount(t)<=0&&console.warn(`Event ${t} is called but not listening`)}}};c(Ha,"EventPlugin");let Ze=Ha;const ts={},Vt=Object.freeze(Object.defineProperty({__proto__:null,default:ts},Symbol.toStringTag,{value:"Module"})),Or='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',{Configs:Tr,Utils:Mr}=f,{Object:po}=Mr,{Enabled:Rr,WideframeConfigs:es}=Tr.FrameCapture,_r=c(async u=>{if(!Rr)return console.warn("FrameCapture is not enabled"),null;const e=Vr(u);if(!e)return null;$r(e,es.ResultChallenge);const{frameCapture:t}=window.game,{Width:s,Height:a}=es.ResultChallenge;return t.captureAsync({name:"ResultChallenge",width:s,height:a,renderOptions:e})},"renderResultChallenge"),$r=c((u,e)=>{const{Width:t,Height:s,Wideframe:a}=e;u.wideframe={name:"result-challenge",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe$2"),Vr=c(u=>{try{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:a="20",opponentPhoto:n="",opponentScore:i=0,isPlayerFinished:o,isOpponentFinished:r}=u,{RenderOptions:l}=es.ResultChallenge,d=po.camelCaseKeys(po.clone(l)),{playerPhoto:h,opponentPhoto:y}=d,g=s===i,w=s>i,I=o??r,m=o&&r;return h.type==="image"&&(h.name=`${e}`,h.image=t),y.type==="image"&&(y.name=`${a}`,y.image=n),I&&Gr(d,{playerScore:s,opponentScore:i,isPlayerFinished:o,isOpponentFinished:r}),!m||g?(delete d.leftCrown,delete d.rightCrown,d):(w?delete d.rightCrown:delete d.leftCrown,d)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$2"),Gr=c((u,e)=>{const{leftScore:t,rightScore:s}=u,{playerScore:a=0,opponentScore:n=0,isPlayerFinished:i,isOpponentFinished:o}=e;t.type==="text"&&(t.text=i?`${a}`:"???"),s.type==="text"&&(s.text=o?`${n}`:"???")},"addRenderScores"),{Configs:Fr,Utils:Ur}=f,{Object:yo}=Ur,{Enabled:kr,WideframeConfigs:ss}=Fr.FrameCapture,Br=c(async u=>{if(!kr)return console.warn("FrameCapture is not enabled"),null;const e=Kr(u);if(!e)return null;jr(e,ss.ShareLeaderboard);const{frameCapture:t}=window.game,{Width:s,Height:a}=ss.ShareLeaderboard;return t.captureAsync({name:"ShareLeaderboard",width:s,height:a,renderOptions:e})},"renderShareLeaderboard"),jr=c((u,e)=>{const{Width:t,Height:s,Wideframe:a}=e;u.wideframe={name:"share-leaderboard",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe$1"),Kr=c(u=>{try{const{playerId:e,playerPhoto:t,leaders:s}=u,{RenderOptions:a}=ss.ShareLeaderboard,n=yo.camelCaseKeys(yo.clone(a)),{avatar:i}=n;return i.type==="image"&&(i.name=`${e}`,i.image=t),Wr(n,s),n}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$1"),Wr=c((u,e)=>{const t="600 48px";e.forEach((s,a)=>{const{id:n,name:i,photo:o,score:r}=s;let l=1294+180*a;u[`photo_${n}`]={depth:-1,name:n,type:"image",image:o,size:[96,96],position:[436,l]},l=1360+180*a,u[`name_${n}`]={font:t,depth:1,name:n,type:"text",text:i,position:[600,l]},u[`score_${n}`]={font:t,depth:1,name:n,type:"text",text:`${r}`,position:[100,l]}})},"addLeaders"),{Configs:zr,Utils:Hr}=f,{Object:fo}=Hr,{Enabled:qr,WideframeConfigs:as}=zr.FrameCapture,Yr=c(async u=>{if(!qr)return console.warn("FrameCapture is not enabled"),null;const e=Xr(u);if(!e)return null;Qr(e,as.ShareScore);const{frameCapture:t}=window.game,{Width:s,Height:a}=as.ShareScore;return t.captureAsync({name:"ShareScore",width:s,height:a,renderOptions:e})},"renderShareScore"),Qr=c((u,e)=>{const{Width:t,Height:s,Wideframe:a}=e;u.wideframe={name:"share-score",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe"),Xr=c(u=>{try{const{playerId:e,playerPhoto:t,playerScore:s}=u,{RenderOptions:a}=as.ShareScore,n=fo.camelCaseKeys(fo.clone(a));console.log("renderOptions",n);const{avatar:i,playerScore:o}=n;return i.type==="image"&&(i.name=`${e}`,i.image=t),o.type==="text"&&(o.text=`${s}`),n}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions"),{Configs:Jr,Utils:Zr}=f,{Image:Xt,Object:Rt,Valid:Jt}=Zr,{Options:_e}=Jr.FrameCapture,qa=class qa extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"width");p(this,"height");p(this,"canvas",null);p(this,"testRenderOptions",null);p(this,"caches",{});p(this,"wideframe",{})}init(){this.addWideframeRender("renderShareScore",Yr),this.addWideframeRender("renderResultChallenge",_r),this.addWideframeRender("renderShareLeaderboard",Br)}async preloadAsync(t){const{renderOptions:s}=t;await this.loadImages(s)}async captureAsync(t){const{width:s,height:a,renderOptions:n}=t;return this.width=s,this.height=a,this.createCanvas(),await this.loadImages(n),this.drawObjects(n),this.snapshotFrameAsync()}addWideframeRender(t,s){this.wideframe[t]=s}setTestRenderOptions(t){if(!t){this.testRenderOptions=null;return}const s=Rt.camelCaseKeys(t);this.testRenderOptions=Rt.merge(this.testRenderOptions,s)}createCanvas(){if(this.canvas){const t=this.canvas.getContext("2d");t?t.clearRect(0,0,this.canvas.width,this.canvas.height):this.canvas=null}this.canvas||(this.canvas=document.createElement("canvas",{is:"canvas"})),this.canvas.width=this.width,this.canvas.height=this.height}async loadImages(t){const s=Rt.vals(t).filter(o=>o.type==="image"),a=this.prepareLoadImages(s),n=Rt.vals(a);if(n.length<1)return;const i=await Promise.all(n);this.cacheImages(a,i)}prepareLoadImages(t){const s={};for(const a of t){const{name:n,image:i,fallbackImage:o}=a,r=this.caches[n];!Jt.isString(i)||r||(i===""&&Jt.isString(o)&&(a.image=o),console.info("prepareLoadImages",a),s[n]=new Promise(l=>{const d=Xt.loadImage(i);d.catch(()=>{Jt.isString(o)?(a.image=o,Xt.loadImage(a.image).then(h=>{l(h)}).catch(()=>{l(null)})):l(null)}),d.then(h=>{l(h)})}))}return s}cacheImages(t,s){for(const a in t){const n=s.shift();n&&(this.caches[a]=n)}}drawObjects(t){const s=Rt.vals(t).sort((a,n)=>a.depth-n.depth);for(const a of s)switch(a.type){case"text":this.drawText(a);break;case"image":this.drawImage(a);break}}drawText(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{position:a,font:n,text:i,color:o,lineWidth:r,textAlign:l}=t;s.font=`${n} ${Or}`,s.fillStyle=o??"#ffffff",r&&(s.lineWidth=r),l&&(s.textAlign=l),console.info("drawText",t);const[d,h]=a;s.fillText(i,d,h)}drawImage(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{name:a,size:n,position:i,fallbackImage:o}=t;let r=this.caches[a];if(!r&&o&&(r=this.caches[o]),!r)throw new Error(`Image ${a} not found`);console.info("drawImage",t);const[l,d]=i,[h,y]=n;s.drawImage(r,l,d,h,y)}async snapshotFrameAsync(){if(!this.canvas)return null;let t=null;if(_e.UseBlobIfPossible&&"toBlob"in this.canvas?t=await this.createAsBlob():t=this.createAsDataImage(),!t)throw new Error("Image data is null");return Jt.isDebugger()&&Xt.logImage(t),t}createAsDataImage(){if(!this.canvas)return null;const t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return null;const{Quality:s,RenderType:a}=_e;return t.canvas.toDataURL(`image/${a}`,s)}createAsBlob(){return new Promise(t=>{if(!this.canvas){t(null);return}const{Quality:s,RenderType:a}=_e;this.canvas.toBlob(n=>{if(!n){t(null);return}Xt.blobToDataImage(n).then(i=>{t(i)})},`image/${a}`,s)})}};c(qa,"FrameCapturePlugin");let ns=qa;const Ya=class Ya extends Error{constructor(t,s){super(`Text with key "${t}" not found in locale "${s}"`);p(this,"key");p(this,"locale");this.name="MissingKeyInLocaleError",this.key=t,this.locale=s}};c(Ya,"MissingKeyInLocaleError");let he=Ya;const Qa=class Qa extends Error{constructor(t){super(`Locale not found: ${t}`);p(this,"locale");this.name="LocaleNotFoundError",this.locale=t}};c(Qa,"LocaleNotFoundError");let ue=Qa;const{Utils:go}=f,Xa=class Xa extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"locale");p(this,"data",{})}add(t,s){this.data[t]=s}choose(t){this.locale=t;const{event:s}=this.game;s.emit(f.Events.LANGUAGE_CHANGED,{locale:t})}getText(t,s,a){try{const{text:n}=this.getLocaleData(a);if(!go.Object.hasOwn(n,t)){const o=a??this.getCurrentLocale();throw new he(String(t),o)}const i=n[t];return this.replaceVariables(i,s??[])}catch(n){return n instanceof he?(console.warn(`Text with key "${n.key}" not found in locale "${n.locale}"`),n.key):n instanceof ue?(console.warn(`Locale "${n.locale}" not found`),String(t)):(console.error(n),String(t))}}getTexture(t){const{texture:s}=this.getLocaleData();return s[t]}getCurrentLocale(){return this.locale||"en"}getLocaleData(t){const s=t??this.getCurrentLocale();if(!go.Object.hasOwn(this.data,s))throw new ue(s);return this.data[s]}replaceVariables(t,s){const a=s.length;if(a==0)return t;let n=t;for(let i=0;i<a;i++){const o=s[i],r=`%{${i}}`;n=n.replace(r,o)}return n}};c(Xa,"LanguagePlugin");let is=Xa;const tc={_id:"",name:"",createdBy:"",description:"",expireTime:7*24*60*60*1e3,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15},{Configs:ec,Utils:sc}=f,{Object:Zt,String:wo,Valid:ac}=sc,{OtherHost:te,Mockup:ee,AppId:nc}=ec,Ja=class Ja{constructor(){p(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await rt(async()=>{const{default:t}=await Promise.resolve().then(()=>Vt);return{default:t}},void 0,import.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load LeaderboardAPIMock");this.mockAPI=new e}async getLeaderboardAsync(e,t,s){const a=wo.params(s);let n;return ee.Leaderboards.Enabled?(await this.initMockAPI(),"playerIds"in s?n=await this.mockAPI.getPlayers(e,s):n=await this.mockAPI.getLeaders(e,s)):n=await mt(`${t}?${a}`,{},te),!Zt.hasOwn(n,"data")||!Array.isArray(n.data)?[]:n.data}async getLeaderboardsAsync(e){let t;const s=f.Utils.String.params(e),a="leaderboards";return ee.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.getLeaderboardsAsync(e)):(t=await mt(`${a}?${s}`,{},te),!Zt.hasOwn(t,"data")||!Array.isArray(t.data)?[]:t.data)}async setLeaderboardScoreAsync(e){const{leaderboardId:t,playerId:s,score:a}=e;ee.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.setScoreAsync(t,s,a)):await M(`leaderboards/${t}/players/${s}`,{score:a},{},te)}async createLeaderboardAsync(e){const t=e._id??wo.generateObjectId(),s={...tc,...e,_id:t,appId:nc},a="leaderboards";let n;if(ee.Leaderboards.Enabled?(await this.initMockAPI(),n=await this.mockAPI.createLeaderboard(s)):(n=await M(a,s,{},te),Zt.hasOwn(n,"data")&&ac.isObject(n.data)&&(n=n.data)),!Zt.hasOwn(n,"_id")||n._id!==t)throw new Error("Create leaderboard failed");return t}};c(Ja,"LeaderboardAPI");let os=Ja;const mo={limit:0,offset:0,leaders:{},isRequesting:!1},ic={leaderboards:{}},{Array:oc,Valid:rc,Json:Ao,Object:se}=f.Utils,Za=class Za extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"lbAPI",new os);p(this,"configs")}init(){const{storage:t}=this.game;t.addStorage("leaderboard",ic),this.configs={}}addLeaderboard(t){const{name:s,type:a,leaderboardId:n,autoSortRank:i}=t;if(this.getLeaderboard(s)){console.warn(`Leaderboard with name ${s} already exists`);return}let r=`leaderboards/${n}/`;(a==="global"||a==="tournament")&&(r+="leaders"),a==="friends"&&(r+="players"),this.configs[s]={id:n,name:s,type:a,host:r,autoSortRank:i};const l=Ao.clone(mo);this.setLeaderboard(s,{...l})}async requestLeaderboardsAsync(t){try{return await this.lbAPI.getLeaderboardsAsync(t)}catch(s){return console.warn("requestGlobalLeaderboardsAsync",s),[]}}async requestLeaderboardAsync(t,s){try{this.validateLeaderboard(t),this.clearLeaderboard(t),this.setLeaderboard(t,{isRequesting:!0});const{id:a,type:n,host:i}=this.configs[t];let o=[];if(n==="friends"){const{player:r}=this.game,l=r.getPlayerId(),d=r.getConnectedPlayerIds(s,0),h=[l,...d];this.configs[t].playerIds=[...h],o=await this.lbAPI.getLeaderboardAsync(a,i,{playerIds:h})}else o=await this.lbAPI.getLeaderboardAsync(a,i,{limit:s,offset:0});if(o.length===0)return;await this.receiveLeaderboardAsync(t,o),this.setLeaderboard(t,{limit:s,offset:0})}finally{this.setLeaderboard(t,{isRequesting:!1})}}async loadMoreLeaderboardAsync(t,s){const a=this.getLeaderboard(t);if(a){if(this.configs[t].type==="friends"){console.warn("Cannot load more leaderboard with type friend");return}try{this.setLeaderboard(t,{isRequesting:!0});const{id:n,host:i}=this.configs[t],{offset:o,limit:r}=a,l=o+r,d=await this.lbAPI.getLeaderboardAsync(n,i,{limit:s,offset:l});if(d.length===0)return;this.receiveLeaderboardAsync(t,d),this.setLeaderboard(t,{limit:s,offset:l})}finally{this.setLeaderboard(t,{isRequesting:!1})}}}getLeaderboard(t){const{storage:s}=this.game,a=s.getStorageData("leaderboard","leaderboards");return a[t]?a[t]:null}async getLeadersByPlayerIdsAsync(t,s){try{this.validateLeaderboard(t);const{id:a}=this.configs[t],n=`leaderboards/${a}/players`,i=await this.lbAPI.getLeaderboardAsync(a,n,{playerIds:s});return i.length===0?[]:this.toLeaders(i)}catch(a){return console.warn(a),[]}}clearLeaderboard(t){try{this.validateLeaderboard(t);const s=Ao.clone(mo);this.setLeaderboard(t,null),this.setLeaderboard(t,{...s})}catch(s){console.warn(s)}}isLeaderboardEmpty(t){const s=this.getLeaderboard(t);if(!s)return!0;const{leaders:a}=s;return Object.keys(a).length===0}isExistLeaderboardId(t){const{configs:s}=this;return se.vals(s).some(a=>a.id===t)}getLeaderboardName(t){const{configs:s}=this,a=oc.search(se.vals(s),n=>n.id===t);return a?a.name:null}async setLeaderboardScoreAsync(t,s,a){try{this.validateLeaderboard(t);const{id:n}=this.configs[t],i=await this.getLastScoreOnLeaderboard(t,s);if(i&&a<=i)return;await this.lbAPI.setLeaderboardScoreAsync({leaderboardId:n,playerId:s,score:a})}catch(n){console.warn(n)}}async getLastScoreOnLeaderboard(t,s){const a=await this.getLeadersByPlayerIdsAsync(t,[s]);return a.length===0?null:a[0].score}async createLeaderboardAsync(t){return this.lbAPI.createLeaderboardAsync(t)}validateLeaderboard(t){const s=this.getLeaderboard(t);if(!rc.isObject(s))throw new Error(`Leaderboard with name ${t} not found`)}setLeaderboard(t,s){const{storage:a}=this.game;a.setStorageData("leaderboard","leaderboards",{[t]:s})}async receiveLeaderboardAsync(t,s){this.validateLeaderboard(t);const n=(await this.toLeaders(s)).filter(h=>h.name&&h.photo),{offset:i=0,leaders:o={}}=this.getLeaderboard(t)??{},r=n.filter(h=>!o[h.playerId]);if(i>0&&r.length>0){const h=se.vals(o);r.unshift(...h)}let l=r.sort((h,y)=>y.score-h.score);this.configs[t].autoSortRank&&(l=l.map((h,y)=>({...h,rank:y+1})));const d=se.keyBy(l,"playerId");this.setLeaderboard(t,{leaders:d})}async toLeaders(t){const{profile:s}=this.game,a=t.map(r=>r.playerId);await s.requestProfiles(a);const n=s.getProfiles();return t.map(r=>{const{playerId:l}=r,d=n[l];return d?{...r,name:d.name,photo:d.photo}:{...r,name:"Nameless",photo:"default"}}).map(r=>({...r,score:parseInt(r.score,10)}))}};c(Za,"LeaderboardPlugin");let rs=Za;const tn=class tn{constructor(){p(this,"APIHost")}setAPIHost(e){this.APIHost=e}getAPIHost(){return this.APIHost}};c(tn,"BaseAPI");let cs=tn;const{Utils:Io}=f,en=class en extends cs{async createSingleMatchAsync(e){const s=await M("single-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getSingleMatchDetailAsync(){const t=await mt("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateSingleMatchMoveAsync(e,t){const s=`single-matches/${e}/move`,a=await M(s,t,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishSingleMatchAsync(e){const t=`single-matches/${e}/finish`,s=await M(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createEndlessMatchAsync(e){const s=await M("endless-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getEndlessMatchDetailAsync(){const t=await mt("endless-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateEndlessMatchMilestoneAsync(e,t){const s=`endless-matches/${e}/milestone`,a=await M(s,t,{},this.getAPIHost());return this.returnValidMatchData(a)}async finishEndlessMatchAsync(e){const t=`endless-matches/${e}/finish`,s=await M(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createMatchAsync(e){const s=await M("matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async joinMatchAsync(e){const t=`matches/${e}/join`,s=await M(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async getMatchDetailByIdAsync(e){const t=`matches/${e}`,s=await mt(t,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishMatchAsync(e){const{matchId:t="",score:s=0,level:a=0,extraData:n={}}=e,i=`matches/${t}/finish`,o=await M(i,{matchId:t,score:s,level:a,extraData:n},{},this.getAPIHost());return this.returnValidMatchData(o)}returnValidMatchData(e){let t={};return!Io.Valid.isObject(e)||!Io.Object.hasOwn(e,"data")||(t=e.data),t}};c(en,"MatchAPI");let ls=en;const sn=class sn{constructor(e){p(this,"matchAPI");this.createAPI(),this.setAPIConfig(e)}createAPI(){this.matchAPI=new ls}setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}setMatchAPIInstance(e){this.matchAPI=e}getMatchAPI(){return this.matchAPI}};c(sn,"APIHandler");let ds=sn;const an=class an{constructor(e,t){p(this,"game");p(this,"match");this.game=e,this.match=t}startLog(e){this.match.useCPUProfile&&console.profile(this.constructor.name),console.group(` ${this.constructor.name}`),e&&console.log(" ? Payload:",e)}endLog(){console.groupEnd(),this.match.useCPUProfile&&console.profileEnd()}async processAsync(e){throw new Error("Not implemented")}};c(an,"BaseConcrete");let E=an;const nn=class nn extends K{constructor(e){super(e),this.name="LevelNotDefined",this.message=e??"Level is not defined"}};c(nn,"LevelNotDefined");let pe=nn;const on=class on extends K{constructor(e){super(e),this.name="MatchModeNotDefined",this.message=e??"Match id is not defined"}};c(on,"MatchModeNotDefined");let jt=on;const{Object:$e,Valid:cc}=f.Utils,rn=class rn{constructor(e){p(this,"game");p(this,"match");p(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}setNext(e){return this.nextHandler=e,e}async processAsync(e){console.groupCollapsed(` ${this.constructor.name}`),this.logData("Before",e)}async nextAsync(e){this.logData("After",e),console.groupEnd(),this.nextHandler&&await this.nextHandler.processAsync(e)}logData(e,t){if(!cc.isDebugger())return;console.groupCollapsed(` MatchState: ${e}`);const{profiles:s,customData:a,...n}=t;console.info(" Base"),console.table($e.clone(n)),console.info(" Profile"),console.table($e.clone(s)),console.info(" Custom"),console.table($e.clone(a)),console.groupEnd()}};c(rn,"BaseHandler");let A=rn;const{Plugins:lc,Utils:dc}=f,{Analytics:hc}=lc,{String:uc,Valid:Do}=dc,cn=class cn extends A{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e,{level:a}=s;this.validateMode(t),this.validateLevel(a);const{analytics:n}=this.game;n.event(hc.Events.MATCH_START,{level:a,game_mode:uc.toUpperCamelCase(t),level_name:`level_${a}`}),await this.nextAsync(e)}validateMode(e){if(!Do.isString(e))throw new jt}validateLevel(e){if(!Do.isNumber(e))throw new pe}};c(cn,"LogMatchStartHandler");let $=cn;const R={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},ln=class ln extends A{async processAsync(e){super.processAsync(e);const{mode:t,status:s}=e;let a=t??ct.SINGLE;s===R.FINISHED&&(a=ct.SINGLE),this.contextGameModeDetected(a),await this.nextAsync(e)}contextGameModeDetected(e){const{storage:t}=this.game;t.setStorageData("context","contextGameMode",e)}};c(ln,"ContextGameModeHandler");let b=ln;const dn=class dn extends Error{constructor(e){super(e),this.name="GetMatchDetailFailed",this.message=e??"Get match detail failed"}};c(dn,"GetMatchDetailFailed");let Kt=dn;const hn=class hn extends Error{constructor(e){super(e),this.name="MatchAreNotActive",this.message=e??"Match are not active"}};c(hn,"MatchAreNotActive");let ye=hn;const un=class un extends K{constructor(e){super(e),this.name="MatchIdNotValid",this.message=e??"Match id is not valid"}};c(un,"MatchIdNotValid");let W=un;const pn=class pn extends Error{constructor(e){super(e),this.name="OpponentHasFinishedMatch",this.message=e||"Opponent has finished match"}};c(pn,"OpponentHasFinishedMatch");let hs=pn;const yn=class yn extends K{constructor(e){super(e),this.name="OpponentIdNotValid",this.message=e??"Opponent id is not valid"}};c(yn,"OpponentIdNotValid");let O=yn;const fn=class fn extends Error{constructor(e){super(e),this.name="PlayerNotCurrentInMatch",this.message=e??"The player is not currently in this match"}};c(fn,"PlayerNotCurrentInMatch");let Wt=fn;const gn=class gn extends Error{constructor(e){super(e),this.name="PlayerNotFinishedMatch",this.message=e||"Player not finished match"}};c(gn,"PlayerNotFinishedMatch");let fe=gn;const{Dtos:pc}=f,wn=class wn extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new pc.Match.Data(t).toObject();this.validateAwaitMatchData(e,s),this.updateMatchData(e,s),this.validateMatchStatus(e),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new W}validateMatchStatus(e){const{status:t}=e;if(t!==R.ACTIVE)throw new ye}validateAwaitMatchData(e,t){const{id:s,customData:a}=e,{_id:n,whitePlayerId:i,blackPlayerId:o}=t;if(typeof n!="string"||n!==s)throw new Kt;const{playerId:r}=a,l=i===r,d=o===r;if(!l&&o===X.playerId)throw new Bt;if(!l&&!d)throw new Wt}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new D;const{finished:n}=t[a];if(!n)throw new fe}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:a}=s;if(typeof a!="string")throw new O;const{finished:n}=t[a];if(n)throw new hs}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:l,status:d}=t;e.status=d;const h=a===s.playerId,y=h?a:n,g=h?n:a;e.customData.playerId=y,e.customData.opponentId=g,e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});const w=h?i:o,I=h?o:i;e.profiles[y].score=w,e.profiles[g].score=I;const m=h?r:l,L=h?l:r;e.profiles[y].finished=m,e.profiles[g].finished=L}};c(wn,"AwaitMatchHandler");let us=wn;const Ea={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},mn=class mn extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.initializeMatch(t),await this.nextAsync(t)}initializeMatch(t){const{id:s,mode:a,customData:n}=this.payload;t.id=s??null,t.mode=a||null,t.status=R.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData={...Ea,...t.customData,...n}}};c(mn,"PrepareMatchHandler");let T=mn;const lt=kt,An=class An extends Error{constructor(e){super(e),this.name="UnavailableFeature",this.message=`Unavailable feature: ${e}`}};c(An,"UnavailableFeature");let x=An;const In=class In extends K{constructor(e){super(e),this.name="ContextIdNotValid",this.message=e??"Context id is not valid"}};c(In,"ContextIdNotValid");let F=In;const Dn=class Dn extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAwaitingAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesAwaitingAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:l,score:d=0,finished:h}=o;if(!h)return null;const{photo:y,score:g=0,finished:w}=r;return w?null:await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:g,isPlayerFinished:!0,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesAwaitingAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:r}=a[i],l={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${r} is waiting for you to finish this game. Play now!`,localizations:{vi_VN:`${r} ang ch bn kt thc trn u. Chi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(l)}};c(Dn,"SendAwaitingMessageHandler");let ps=Dn;const Pn=class Pn extends A{async processAsync(e){await this.nextAsync(e)}async nextAsync(e){this.nextHandler&&await this.nextHandler.processAsync(e)}};c(Pn,"NothingHandler");let v=Pn;const xn=class xn extends K{constructor(e){super(e),this.name="ProfileNotFound",this.message=e??"Profile not found"}};c(xn,"ProfileNotFound");let V=xn;const{Dtos:yc}=f,En=class En extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const{customData:t}=e,{playerId:s,opponentId:a}=t;let n=s;const i=await this.getProfile(n);if(!i)throw new V;if(this.updateMatchProfile(e,n,i),n=a,n!==X.playerId){const o=await this.getProfile(n);if(!o)throw new V;this.updateMatchProfile(e,n,o)}else this.updateMatchProfile(e,n);await this.nextAsync(e)}validateData(e){const{customData:t}=e,{playerId:s,opponentId:a}=t;if(!s||typeof s!="string")throw new D;if(!a||typeof a!="string")throw new O}async getProfile(e){const{profile:t}=this.game;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchProfile(e,t,s){const{name:a,photo:n}=s??X,i=new yc.Match.Profile({id:t,name:a,photo:n}).toObject();e.profiles[t]?(e.profiles[t].name=i.name,e.profiles[t].photo=i.photo):e.profiles[t]=i}};c(En,"GetMatchProfilesHandler");let J=En;const Sn=class Sn extends E{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new v(this),i=new T(this,{id:t,mode:k.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const o=new us(this);i.setNext(o);const r=new J(this);o.setNext(r);const l=new ps(this);r.setNext(l);const d=new $(this);l.setNext(d);const h=new b(this);d.setNext(h);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};c(Sn,"AwaitChallengeMatchConcrete");let ys=Sn;const vn=class vn extends K{constructor(e){super(e),this.name="CreateContextFailed",this.message=e??"Create context failed"}};c(vn,"CreateContextFailed");let zt=vn;const{Valid:Po,Object:xo}=f.Utils,bn=class bn extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{opponentId:s}=this.payload,a=await this.createAsync(s);t.customData.contextId=a,await this.nextAsync(t)}async createAsync(t){try{await GameSDK.context.createAsync(t)}catch(a){this.validateError(a)}const s=GameSDK.context.getID();if(!Po.isString(s))throw new zt;return s}validateError(t){if(!xo.hasOwn(t,"code"))throw t;if(t.code!=="SAME_CONTEXT"){if(t.code==="INVALID_PARAM"){if(!this.isNotConnectedPlayerError(t))throw t;return}throw t}}validateErrorMessage(t){if(!xo.hasOwn(t,"message")||!Po.isString(t.message))throw t}isNotConnectedPlayerError(t){return this.validateErrorMessage(t),t.message.indexOf("is not a connected player of the current player")>-1}};c(bn,"CreateContextHandler");let fs=bn;const Nn=class Nn extends K{constructor(e){super(e),this.name="MatchAreNotOpen",this.message=e??"Match are not open"}};c(Nn,"MatchAreNotOpen");let Et=Nn;const{Dtos:fc}=f,Cn=class Cn extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t);const s=await this.createMatchAsync(t),a=new fc.Match.Data(s).toObject();this.updateMatchState(t,a),await this.nextAsync(t)}validateData(t){const{status:s,customData:a}=t,{opponentId:n}=a;if(typeof n!="string")throw new O;if(s!==R.OPEN)throw new Et}async createMatchAsync(t){const{opponentId:s}=t.customData,{extraData:a}=this.payload;if(!s)return{};const n={opponentPlayerId:s,extraData:a};return this.match.api.getMatchAPI().createMatchAsync(n)}updateMatchState(t,s){const{customData:a}=t,{_id:n,whitePlayerId:i,blackPlayerId:o,whitePlayerFinish:r,blackPlayerFinish:l}=s,d=i===a.opponentId;t.id=n||null;const h=d?o:i,y=d?i:o;t.customData.playerId=h,t.customData.opponentId=y,t.profiles[h]||(t.profiles[h]={id:h,name:"",photo:"",finished:!1}),t.profiles[y]||(t.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=d?l:r,w=d?r:l;t.profiles[h].finished=g,t.profiles[y].finished=w}};c(Cn,"CreateMatchHandler");let ge=Cn;const Ln=class Ln extends A{async processAsync(e){if(super.processAsync(e),e.status!==R.OPEN)throw new Et;this.startMatch(e),await this.nextAsync(e)}startMatch(e){e.status=R.ACTIVE,e.startAt=Date.now()}};c(Ln,"StartMatchHandler");let U=Ln;const On=class On extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesChallengeAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesChallengeAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:l,score:d=0}=o,{photo:h,score:y=0}=r;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:y,isPlayerFinished:!1,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesChallengeAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:r}=a[i],l={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${r} challenges you`,localizations:{vi_VN:`${r} th thch bn trong trn u ny. Chi ngay!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await GameSDK.extra.updateAsync(l)}};c(On,"SendChallengeMessageHandler");let we=On;const Tn=class Tn extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s}=e,a=new v(this),n=new fs(this,{opponentId:s});a.setNext(n);const i=new T(this,{mode:k.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:s}});n.setNext(i);const o=new ge(this,{extraData:e.extraData});i.setNext(o);const r=new J(this);o.setNext(r);const l=new U(this);r.setNext(l);const d=new $(this);l.setNext(d);const h=new we(this);d.setNext(h);const y=new b(this);h.setNext(y);const g=this.match.getMatchState();await a.processAsync(g)}finally{this.endLog()}}};c(Tn,"ChallengeFriendConcrete");let gs=Tn;const Mn=class Mn extends Error{constructor(e){super(e),this.name="SameContext",this.message=e??"Same context"}};c(Mn,"SameContext");let Gt=Mn;const{Utils:Eo}=f,Rn=class Rn extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;await this.switchAsync(s),t.customData.contextId=s,await this.nextAsync(t)}checkSameContext(t){const s=t==="SOLO",a=GameSDK.context.getID();if(a===t)throw new Gt;if(s&&a===null)throw new Gt}async switchAsync(t){const s=t==="SOLO";try{this.checkSameContext(t),await GameSDK.context.switchAsync(t,s)}catch(a){if(a instanceof Gt)return;if(!Eo.Object.hasOwn(a,"code"))throw a;if(Eo.Device.isAndroid()&&s&&a.code==="INVALID_PARAM")return;if(a.code!=="SAME_CONTEXT")throw a}}};c(Rn,"SwitchContextHandler");let St=Rn;const{Dtos:gc}=f,_n=class _n extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new gc.Match.Data(t).toObject();this.validateContinueMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t,status:s}=e;if(typeof t!="string")throw new W;if(s!==R.OPEN)throw new Et}validateContinueMatchData(e,t){const{id:s,customData:a}=e,{_id:n,whitePlayerId:i,blackPlayerId:o}=t;if(typeof n!="string"||n!==s)throw console.warn(" ? respMatchDataValidated",t),new Kt;const{playerId:r}=a,l=i===r,d=o===r;if(!l&&o===X.playerId)throw new Bt;if(!l&&!d)throw new Wt}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new D;const{finished:n}=t[a];if(n)throw new le}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:l}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=d?i:o,w=d?o:i;e.profiles[h].score=g,e.profiles[y].score=w;const I=d?r:l,m=d?l:r;e.profiles[h].finished=I,e.profiles[y].finished=m}};c(_n,"ContinueMatchHandler");let ws=_n;const $n=class $n extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesCurrentScoreAsync();t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesCurrentScoreAsync(){try{const{player:e,frameCapture:t}=this.game,{playerId:s,photo:a}=e.getPlayer(),{profiles:n}=this.match.getMatchState(),{score:i=0}=n[s]||{};return await t.wideframe.renderShareScore({playerId:s,playerPhoto:a,playerScore:i})}catch(e){return console.warn("createWideframesCurrentScoreAsync",e),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:r}=a[i],l={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${r} made an update.`,localizations:{vi_VN:`${r}  cp nht trn u. Chi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(l)}};c($n,"SendUpdateMessageHandler");let ms=$n;const Vn=class Vn extends E{async processAsync(e){try{this.startLog(e);const{contextId:t,matchId:s,playerId:a,opponentId:n}=e,i=new v(this),o=new St(this,{contextId:t});i.setNext(o);const r=new T(this,{id:s,mode:k.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:n}});o.setNext(r);const l=new ws(this);r.setNext(l);const d=new J(this);l.setNext(d);const h=new U(this);d.setNext(h);const y=new ms(this);h.setNext(y);const g=new $(this);y.setNext(g);const w=new b(this);g.setNext(w);const I=this.match.getMatchState();await i.processAsync(I)}finally{this.endLog()}}};c(Vn,"ContinueChallengeMatchConcrete");let As=Vn;const{Plugins:wc,Utils:mc}=f,{Analytics:Ac}=wc,{String:Ic,Valid:So}=mc,Gn=class Gn extends A{async processAsync(e){super.processAsync(e);const{customData:t,mode:s,startAt:a,finishAt:n}=e,{level:i}=t;this.validateMode(s),this.validateLevel(i);const{analytics:o}=this.game,r=Math.floor((n-a)/1e3);o.event(Ac.Events.MATCH_END,{level:i,game_mode:Ic.toUpperCamelCase(s),level_name:`level_${i}`,time_played:r}),await this.nextAsync(e)}validateMode(e){if(!So.isString(e))throw new jt}validateLevel(e){if(!So.isNumber(e))throw new pe}};c(Gn,"LogMatchFinishedHandler");let dt=Gn;const Fn=class Fn extends Error{constructor(e){super(e),this.name="ScoreNotValid",this.message=e??"Score is not valid"}};c(Fn,"ScoreNotValid");let vt=Fn;const Un=class Un extends Error{constructor(e){super(e),this.name="LeaderboardIdNotValid",this.message=e??"Leaderboard id is not valid"}};c(Un,"LeaderboardIdNotValid");let ht=Un;const kn=class kn extends Error{constructor(e){super(e),this.name="LeaderboardNotExist",this.message=e??"Leaderboard not exist in game"}};c(kn,"LeaderboardNotExist");let Is=kn;const{Valid:vo}=f.Utils,Bn=class Bn extends A{constructor(t,s){super(t);p(this,"payload");p(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.setupSetScorePayload(t),this.setLeaderboardScoreAsync(),await this.nextAsync(t)}async setupSetScorePayload(t){const{profiles:s,customData:a}=t,{playerId:n}=a;if(!n||!s[n])throw new V;const{score:i,leaderboardId:o}=this.payload;if(!vo.isNumber(i))throw new vt;if(!vo.isString(o))throw new ht;this.leaderboardPayload={score:i,playerId:n,leaderboardId:o}}async setLeaderboardScoreAsync(){try{const{playerId:t,score:s,leaderboardId:a}=this.leaderboardPayload,n=this.game.leaderboard.getLeaderboardName(a);if(!n)throw new Is;await this.game.leaderboard.setLeaderboardScoreAsync(n,t,s)}catch(t){console.warn("setLeaderboardScoreAsync",t)}}};c(Bn,"SetLeaderboardScoreHandler");let bt=Bn;const{Valid:Dc}=f.Utils,{Leaderboards:Pc}=f.Configs,jn=class jn extends bt{constructor(e){super(e,{score:0,leaderboardId:Pc.LeaderboardId})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new V;const{score:n}=t[a];if(!Dc.isNumber(n))throw new vt;this.payload.score=n,super.setupSetScorePayload(e)}};c(jn,"PostGlobalLeaderboardScoreHandler");let Ht=jn;const{Dtos:xc,Utils:Ec}=f,{Valid:ae,Object:Sc}=Ec,Kn=class Kn extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateMatchData(t);const{useAPI:s}=this.payload;if(s){const a=await this.finishMatchAsync(t),n=new xc.Match.Data(a).toObject();this.updateMatchFromAPI(t,n)}else this.updateMatchData(t);this.updateMatchState(t),await this.nextAsync(t)}validateMatchData(t){const{status:s,profiles:a,customData:n}=t;if(s!==R.ACTIVE)throw new ye;const{playerId:i}=n;if(!i||!Sc.hasOwn(a,i))throw new Wt}updateMatchData(t){const{playerId:s}=t.customData;if(!ae.isString(s))throw new D;t.profiles[s].finished=!0}updateMatchState(t){t.status=R.FINISHED,t.finishAt=Date.now()}async finishMatchAsync(t){const{id:s,profiles:a,customData:n}=t,{level:i,playerId:o}=n;if(!ae.isString(o))throw new D;const{score:r}=a[o],{extraData:l}=this.payload,d={matchId:s??"",score:r,level:i,extraData:l};return this.match.api.getMatchAPI().finishMatchAsync(d)}updateMatchFromAPI(t,s){const{playerId:a,opponentId:n}=t.customData;if(!ae.isString(a))throw new D;if(!ae.isString(n))throw new O;const{whitePlayerId:i,whitePlayerScore:o,blackPlayerScore:r,whitePlayerFinish:l,blackPlayerFinish:d}=s,h=a===i,y=h?o:r,g=h?r:o,w=h?l:d,I=h?d:l;t.profiles[a].score=y,t.profiles[n].score=g,t.profiles[a].finished=w,t.profiles[n].finished=I}};c(Kn,"FinishMatchHandler");let ut=Kn;const Wn=class Wn extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync(e);t&&this.progressSendFinishedMessage(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesResultAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:l,score:d=0,finished:h}=o,{photo:y,score:g=0,finished:w}=r;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:g,isPlayerFinished:!!h,isOpponentFinished:!!w})}catch(t){return console.warn("createWideframesResultAsync",t),null}}progressSendFinishedMessage(e,t){const{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||typeof n!="string")throw new D;if(!i||typeof i!="string")throw new O;const{score:o=0,finished:r}=s[n],{score:l=0,finished:d}=s[i];r?this.sendFinishMessageAsync(e,t):d&&o>l?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}async sendFinishMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:r}=a[i],l={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:R.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kt qu"}},text:{default:`${r} just finished. Check them now.`,localizations:{vi_VN:`${r} va hon thnh mn chi. Nhn  xem kt qu trn u.`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(l)}async sendPlayTurnMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;const{name:r,score:l}=a[i],d={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:R.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${r} got ${l} scores. So easy! Can you?`,localizations:{vi_VN:`${r}  t ${l} im! Nhn Chi  so ti!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(d)}async sendBestScoreMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;const{name:r,score:l}=a[i],d={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:R.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kt qu"}},text:{default:`${r} beat your high score. Their score: ${l}`,localizations:{vi_VN:`${r}  vt qua im s ca bn, vi ${l} im!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(d)}};c(Wn,"SendFinishedMessageHandler");let Ds=Wn;const zn=class zn extends A{async processAsync(e){super.processAsync(e),this.setPlayerBestScore(e),await this.nextAsync(e)}setPlayerBestScore(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new V;const{player:n}=this.game,i=n.getBestScore()||0,{score:o=0}=t[a];o<=i||(n.setBestScore(o),t[a].bestScore=o)}};c(zn,"SetPlayerBestScoreHandler");let Nt=zn;const Hn=class Hn extends E{async processAsync(e){try{this.startLog(e);const{extraData:t}=e??{},s=new v(this),a=new ut(this,{useAPI:!0,extraData:t});s.setNext(a);const n=new Ds(this);a.setNext(n);const i=new dt(this);n.setNext(i);const o=new Nt(this);i.setNext(o);const r=new Ht(this);o.setNext(r);const l=new b(this);r.setNext(l);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}};c(Hn,"FinishChallengeMatchConcrete");let Ps=Hn;const qn=class qn extends Error{constructor(e){super(e),this.name="ContextAreSolo",this.message=e??"Context are solo"}};c(qn,"ContextAreSolo");let xs=qn;const Yn=class Yn extends Error{constructor(e){super(e),this.name="OpponentNotJoinInContext",this.message=e??"Opponent is not join in context"}};c(Yn,"OpponentNotJoinInContext");let Es=Yn;const Qn=class Qn extends Error{constructor(e){super(e),this.name="NetworkFailure",this.message=e??"Network failure"}};c(Qn,"NetworkFailure");let Ss=Qn;const{Utils:vc,Dtos:bc}=f,{Array:Nc,Object:Cc}=vc,Xn=class Xn extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.checkCurrentContext();const s=await this.getOpponentIdFromContextAsync();t.customData.opponentId=s,await this.nextAsync(t)}checkCurrentContext(){const t=GameSDK.context.getID();if(typeof t!="string")throw new F;if(t==="SOLO")throw new xs}async getOpponentIdFromContextAsync(){const{ignoreId:t}=this.payload,s=await this.getContextPlayers([t]);if(s.length>1)throw new Es;let a=X;return s.length===1&&(a=s[0]),a.playerId}async getContextPlayers(t){try{const s=await GameSDK.context.getPlayersAsync(),a=[];return s.forEach(n=>{const i=n.getID();if(t.indexOf(i)>-1)return;const o=n.getName();if(!o)return;const r=n.getPhoto();a.push(new bc.Player.Info({playerId:i,name:o,photo:r}).toObject())}),Nc.unique(a)}catch(s){if(Cc.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new Ss;return[]}}};c(Xn,"GetOpponentChallengeContextHandler");let vs=Xn;const Jn=class Jn extends Error{constructor(e){super(e),this.name="ContextIsTournament",this.message=e??"Context is a tournament"}};c(Jn,"ContextIsTournament");let qt=Jn;const{Object:Lc}=f.Utils,Zn=class Zn extends A{async processAsync(e){super.processAsync(e);const t=await this.chooseAsync();await this.checkContextTournament(),e.customData.contextId=t,await this.nextAsync(e)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(t){if(!Lc.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}const e=GameSDK.context.getID();if(typeof e!="string")throw new zt;return e}async checkContextTournament(){try{if(!GameSDK.context.getID())return;throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new qt):new x("getTournamentAsync")}catch(e){if(e instanceof qt)throw e}}};c(Zn,"ChooseContextHandler");let bs=Zn;const ti=class ti extends E{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new v(this),a=new bs(this);s.setNext(a);const n=new T(this,{mode:k.CHALLENGE_FRIEND,customData:{playerId:t}});a.setNext(n);const i=new vs(this,{ignoreId:t});n.setNext(i);const o=new ge(this,{extraData:e.extraData});i.setNext(o);const r=new J(this);o.setNext(r);const l=new U(this);r.setNext(l);const d=new $(this);l.setNext(d);const h=new we(this);d.setNext(h);const y=new b(this);h.setNext(y);const g=this.match.getMatchState();await s.processAsync(g)}finally{this.endLog()}}};c(ti,"InviteFriendsConcrete");let Ns=ti;const ei=class ei extends Error{constructor(e){super(e),this.name="JoinMatchFailed",this.message=e??"Join match failed"}};c(ei,"JoinMatchFailed");let Cs=ei;const si=class si extends Error{constructor(e){super(e),this.name="MatchAreFinished",this.message=e??"Match are finished"}};c(si,"MatchAreFinished");let Ls=si;const ai=class ai extends Error{constructor(e){super(e),this.name="OtherPlayerHasJoinedMatch",this.message=e??"Other player has joined match"}};c(ai,"OtherPlayerHasJoinedMatch");let Os=ai;const{Dtos:Oc}=f,ni=class ni extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.joinMatchAsync(e),s=new Oc.Match.Data(t).toObject();this.validateJoinMatchData(e,s),this.updateMatchData(e,s),await this.nextAsync(e)}validateMatchData(e){const{status:t}=e;if(t!==R.OPEN)throw new Et}validateJoinMatchData(e,t){const{id:s,customData:a}=e,{_id:n,blackPlayerId:i,whitePlayerId:o,whitePlayerFinish:r,blackPlayerFinish:l}=t,d=i===a.playerId,h=o===a.opponentId;if(typeof n!="string"||n!==s||!h)throw console.warn(" ? matchData",t),new Cs;if(r&&l)throw new Ls;if(!d)throw new Os}async joinMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().joinMatchAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:l}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const g=d?i:o,w=d?o:i;e.profiles[h].score=g,e.profiles[y].score=w;const I=d?r:l,m=d?l:r;e.profiles[h].finished=I,e.profiles[y].finished=m}};c(ni,"JoinMatchHandler");let Ts=ni;const ii=class ii extends A{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAcceptedAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesAcceptedAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:l,score:d=0,finished:h}=o;if(h)return null;const{photo:y,score:g=0,finished:w}=r;return w?await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:y,opponentScore:g,isPlayerFinished:!1,isOpponentFinished:!0}):null}catch(t){return console.warn("createWideframesAcceptedAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:a,customData:n}=e,{playerId:i,opponentId:o}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:r}=a[i],l={data:{type:lt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${r} accepted the challenge.`,localizations:{vi_VN:`${r}  chp nhn tham gia trn u.`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(l)}};c(ii,"SendAcceptedMessageHandler");let Ms=ii;const oi=class oi extends E{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new v(this),i=new T(this,{id:t,mode:k.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const o=new Ts(this);i.setNext(o);const r=new J(this);o.setNext(r);const l=new U(this);r.setNext(l);const d=new Ms(this);l.setNext(d);const h=new $(this);d.setNext(h);const y=new b(this);h.setNext(y);const g=this.match.getMatchState();await n.processAsync(g)}finally{this.endLog()}}};c(oi,"JoinChallengeMatchConcrete");let Rs=oi;const Ho={_id:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1},{Valid:q}=f.Utils,Y="is invalid",ri=class ri extends _{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!q.isString(e)||!e)&&this.exception("_id",Y)}validateStatus(e){(!q.isString(e)||!e)&&this.exception("status",Y)}validateWinnerId(e){e!==null&&(!q.isString(e)||!e)&&this.exception("winnerId",Y)}validateWhitePlayerId(e){(!q.isString(e)||!e)&&this.exception("whitePlayerId",Y)}validateBlackPlayerId(e){(!q.isString(e)||!e)&&this.exception("blackPlayerId",Y)}validateWhitePlayerScore(e){q.isNumber(e)||this.exception("whitePlayerScore",Y)}validateBlackPlayerScore(e){q.isNumber(e)||this.exception("blackPlayerScore",Y)}validateWhitePlayerFinish(e){q.isBoolean(e)||this.exception("whitePlayerFinish",Y)}validateBlackPlayerFinish(e){q.isBoolean(e)||this.exception("blackPlayerFinish",Y)}toObject(){return super.toObject()}static getDefaultData(){return Ho}};c(ri,"RespMatchDataDtos");let Yt=ri;Yt.addDefaultData(Ho);const ci=class ci extends Error{constructor(e){super(e),this.name="MatchAreNotFinished",this.message=e||"Match are not finished"}};c(ci,"MatchAreNotFinished");let _s=ci;const li=class li extends Error{constructor(e){super(e),this.name="OpponentNotFinishedMatch",this.message=e||"Opponent not finished match"}};c(li,"OpponentNotFinishedMatch");let $s=li;const di=class di extends A{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Yt(t).toObject();this.validateResultMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new W}validateResultMatchData(e,t){const{id:s}=e,{_id:a,whitePlayerFinish:n,blackPlayerFinish:i}=t;if(typeof a!="string"||a!==s)throw new Kt;if(!n&&!i)throw new _s}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(typeof a!="string")throw new D;const{finished:n}=t[a];if(!n)throw new fe}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:a}=s;if(typeof a!="string")throw new O;const{finished:n}=t[a];if(!n)throw new $s}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:a,blackPlayerId:n,whitePlayerScore:i,blackPlayerScore:o,whitePlayerFinish:r,blackPlayerFinish:l}=t,d=a===s.playerId,h=d?a:n,y=d?n:a;e.customData.playerId=h,e.customData.opponentId=y,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!0}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!0});const g=d?i:o,w=d?o:i;e.profiles[h].score=g,e.profiles[y].score=w;const I=d?r:l,m=d?l:r;e.profiles[h].finished=I,e.profiles[y].finished=m}};c(di,"ResultMatchHandler");let Vs=di;const hi=class hi extends E{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:a}=e,n=new v(this),i=new T(this,{id:t,mode:k.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);const o=new Vs(this);i.setNext(o);const r=new J(this);o.setNext(r);const l=new b(this);r.setNext(l);const d=this.match.getMatchState();await n.processAsync(d)}finally{this.endLog()}}};c(hi,"ResultChallengeMatchConcrete");let Gs=hi;const ui=class ui extends E{constructor(){super(...arguments);p(this,"fallbackSingleMode");p(this,"startFLowChallengeFriend",c(async t=>{try{return await this.match.challenge.invite.processAsync(t),!0}catch(s){return s}},"startFLowChallengeFriend"));p(this,"startFlowTournament",c(async t=>{try{const s=GameSDK.context.getID();if(typeof s!="string")throw new F;await this.match.tournament.continue.processAsync({playerId:t,contextId:s})}catch{await this.startFlowSingle(t)}},"startFlowTournament"));p(this,"startFlowSingle",c(async t=>{if(!this.fallbackSingleMode)throw new Error("Fallback single mode is not enabled");await this.match.single.start.processAsync({playerId:t})},"startFlowSingle"))}async processAsync(t){try{this.startLog(t);const{playerId:s,extraData:a,fallbackSingleMode:n}=t;this.fallbackSingleMode=n;const i=await this.startFLowChallengeFriend({playerId:s,extraData:a});if(i===!0)return;i instanceof qt?await this.startFlowTournament(s):await this.startFlowSingle(s)}finally{this.endLog()}}};c(ui,"ChooseContextConcrete");let Fs=ui;const{Valid:Tc}=f.Utils,{Leaderboards:Mc}=f.Configs,pi=class pi extends bt{constructor(e){super(e,{score:0,leaderboardId:Mc.LeaderboardEndlessId})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new V;const{endlessScore:n}=t[a];if(!Tc.isNumber(n))throw new vt;this.payload.score=n,super.setupSetScorePayload(e)}};c(pi,"PostGlobalLeaderboardEndlessScoreHandler");let Us=pi;const yi=class yi extends A{async processAsync(e){super.processAsync(e),this.setPlayerEndlessScore(e),await this.nextAsync(e)}setPlayerEndlessScore(e){const{profiles:t,customData:s}=e,{playerId:a}=s;if(!a||!t[a])throw new V;const{player:n}=this.game,i=n.getBestEndlessScore()??0,{endlessScore:o=0}=t[a],r=i<o?o:i;n.setBestEndlessScore(r),t[a].bestEndlessScore=r}};c(yi,"SetPlayerEndlessScoreHandler");let ks=yi;const fi=class fi extends E{async processAsync(){try{this.startLog();const e=new v(this),t=new ut(this,{useAPI:!1});e.setNext(t);const s=new dt(this);t.setNext(s);const a=new ks(this);s.setNext(a);const n=new Us(this);a.setNext(n);const i=new b(this);n.setNext(i);const o=this.match.getMatchState();await e.processAsync(o)}finally{this.endLog()}}};c(fi,"FinishEndlessConcrete");let Bs=fi;const gi=class gi extends Error{constructor(e){super(e),this.name="ProfileIdNotDefined",this.message=e??"Profile id is not defined"}};c(gi,"ProfileIdNotDefined");let js=gi;const{Dtos:Rc}=f,wi=class wi extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{profileId:s}=this.payload;if(!s)throw new js;const{player:a}=this.game,n=a.getPlayerId();let i;if(s===n)i=this.getPlayerProfile();else if(i=await this.getProfileAsync(s),!i)throw new V;this.updateMatchData(i,t),await this.nextAsync(t)}getPlayerProfile(){const{player:t}=this.game,{playerId:s,name:a,photo:n,locale:i}=t.getPlayer();return{playerId:s,name:a,photo:n,locale:i}}async getProfileAsync(t){const{profile:s}=this.game;return await s.requestProfiles([t]),s.getProfiles()[t]}updateMatchData(t,s){const{playerId:a,name:n,photo:i}=t,o=new Rc.Match.Profile({id:a,name:n,photo:i}).toObject();s.profiles[a]=o}};c(wi,"GetProfileHandler");let st=wi;const mi=class mi extends E{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new v(this),a=new St(this,{contextId:"SOLO"});s.setNext(a);const n=new T(this,{id:"234567",mode:k.ENDLESS,customData:{playerId:t}});a.setNext(n);const i=new U(this);n.setNext(i);const o=new st(this,{profileId:t});i.setNext(o);const r=new $(this);o.setNext(r);const l=new b(this);r.setNext(l);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}};c(mi,"StartEndlessConcrete");let Ks=mi;const{Valid:_c}=f.Utils,Ai=class Ai extends bt{constructor(e){super(e,{score:0,leaderboardId:""})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:a,leaderboardId:n}=s;if(!n)throw new ht;if(!a||!t[a])throw new V;const{score:i}=t[a];if(!_c.isNumber(i))throw new vt;this.payload.score=i,this.payload.leaderboardId=n,super.setupSetScorePayload(e)}};c(Ai,"PostLeaderboardScoreHandler");let Qt=Ai;const Ii=class Ii extends A{async processAsync(e){super.processAsync(e),this.validateData(e),this.progressSendGroupMessage(e),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:a,opponentId:n}=s;if(!t||typeof t!="string")throw new W;if(!a||typeof a!="string")throw new F;if(!n||typeof n!="string")throw new O}async createWideframesResultGroupAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:a}=e,{playerId:n,opponentId:i}=a;if(!n||!i)return null;const o=s[n],r=s[i],{photo:l,score:d=0}=o,{photo:h,score:y=0}=r;return await t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:y,isPlayerFinished:!0,isOpponentFinished:!0})}catch(t){return console.warn("createWideframesResultGroupAsync",t),null}}async createWideframesBestScoreAsync(e){try{const{player:t,frameCapture:s}=this.game,{playerId:a}=e.customData,{playerId:n,photo:i,data:o}=t.getPlayer();if(a!==n)return null;const{score:r}=o||{};return await s.wideframe.renderShareScore({playerId:n,playerPhoto:i,playerScore:r})}catch(t){return console.warn("createWideframesBestScoreAsync",t),null}}async progressSendGroupMessage(e){const{profiles:t,customData:s}=e,{playerId:a,opponentId:n}=s;if(n&&typeof n=="string"){if(!a||typeof a!="string")throw new D;const{score:o=0}=t[a]||{},{score:r=0}=t[n]||{};if(o>r){const l=await this.createWideframesResultGroupAsync(e);if(!l)return;this.sendBestScoreMessageAsync(e,l);return}}const i=await this.createWideframesBestScoreAsync(e);i&&this.sendChallengeMessageAsync(e,i)}async sendBestScoreMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");const{name:i,score:o}=s[n],l={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:o},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chi"}},text:{default:`${i} beats your high score. Their score: ${o}.`,localizations:{vi_VN:`${i} va vt im s cao nht ca bn! Chi ln na ch?`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(l)}async sendChallengeMessageAsync(e,t){const{profiles:s,customData:a}=e,{playerId:n}=a;if(!n||typeof n!="string")throw new D;const{name:i,score:o}=s[n],l={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:o},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${i} got ${o} scores. So easy! Can you?`,localizations:{vi_VN:`${i}  t ${o} im! Qu d lun. Chi li no!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new x("updateAsync");await GameSDK.extra.updateAsync(l)}};c(Ii,"SendGroupMessageHandler");let Ws=Ii;const Di=class Di extends E{async processAsync(){try{this.startLog();const e=new v(this),t=new ut(this,{useAPI:!1});e.setNext(t);const s=new Ws(this);t.setNext(s);const a=new dt(this);s.setNext(a);const n=new Nt(this);a.setNext(n);const i=new Qt(this);n.setNext(i);const o=new b(this);i.setNext(o);const r=this.match.getMatchState();await e.processAsync(r)}finally{this.endLog()}}};c(Di,"FinishGroupConcrete");let zs=Di;const{Dtos:$c}=f,Pi=class Pi extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateProfileMatchData(t),await this.nextAsync(t)}updateProfileMatchData(t){const{id:s}=this.payload,{profiles:a}=t;if(!a[s])throw new V;const n={...a[s],...this.payload},i=new $c.Match.Profile(n).toObject();a[i.id]=i}};c(Pi,"SetProfileDataHandler");let Ct=Pi;const xi=class xi extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s,opponentScore:a}=e,n=new v(this),i=new T(this,{id:"7749",mode:k.MATCHING_GROUP,customData:{playerId:t,opponentId:s}});n.setNext(i);const o=new J(this);i.setNext(o);const r=new Ct(this,{id:t,score:a});o.setNext(r);const l=new U(this);r.setNext(l);const d=new $(this);l.setNext(d);const h=new b(this);d.setNext(h);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};c(xi,"JoinGroupConcrete");let Hs=xi;const Ei=class Ei extends Error{constructor(e){super(e),this.name="MatchGroupNotSupported",this.message=e??"Match group is not supported"}};c(Ei,"MatchGroupNotSupported");let me=Ei;const{String:Vc}=f.Utils,Si=class Si extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.checkMatchGroupSupported();const s=this.getMatchTag(),a=await this.matchingGroup(s);t.customData.contextId=a,await this.nextAsync(t)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new x("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new x("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new me;if(!await GameSDK.extra.checkCanPlayerMatchAsync())throw new me}getMatchTag(){const{locale:t}=this.payload;let s="global";if(t){const a=Vc.getLanguageCode(t);a==="en"&&(s="en"),a==="in"&&(s="in")}return s}async matchingGroup(t){if(!("matchPlayerAsync"in GameSDK.extra))throw new x("matchPlayerAsync");await GameSDK.extra.matchPlayerAsync(t,!0,!0);const s=GameSDK.context.getID();if(typeof s!="string")throw new zt;return s}};c(Si,"GroupContextHandler");let qs=Si;const vi=class vi extends E{async processAsync(e){try{this.startLog(e);const{locale:t,playerId:s}=e,a=new v(this),n=new qs(this,{locale:t});a.setNext(n);const i=new T(this,{id:"7749",mode:k.MATCHING_GROUP,customData:{playerId:s}});n.setNext(i);const o=new U(this);i.setNext(o);const r=new st(this,{profileId:s});o.setNext(r);const l=new $(this);r.setNext(l);const d=new b(this);l.setNext(d);const h=this.match.getMatchState();await a.processAsync(h)}finally{this.endLog()}}};c(vi,"StartGroupConcrete");let Ys=vi;const bi=class bi extends E{async processAsync(){try{this.startLog();const e=new v(this),t=new ut(this,{useAPI:!1});e.setNext(t);const s=new dt(this);t.setNext(s);const a=new Nt(this);s.setNext(a);const n=new Ht(this);a.setNext(n);const i=new b(this);n.setNext(i);const o=this.match.getMatchState();await e.processAsync(o)}finally{this.endLog()}}};c(bi,"FinishSingleConcrete");let Qs=bi;const Ni=class Ni extends E{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new v(this),a=new St(this,{contextId:"SOLO"});s.setNext(a);const n=new T(this,{id:"123456",mode:k.SINGLE,customData:{playerId:t}});a.setNext(n);const i=new U(this);n.setNext(i);const o=new st(this,{profileId:t});i.setNext(o);const r=new $(this);o.setNext(r);const l=new b(this);r.setNext(l);const d=this.match.getMatchState();await s.processAsync(d)}finally{this.endLog()}}};c(Ni,"StartSingleConcrete");let Xs=Ni;const{Plugins:Gc,Utils:Fc}=f,{Analytics:Uc}=Gc,{String:kc,Valid:Bc}=Fc,Ci=class Ci extends A{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e;this.validateMode(t);const{analytics:a}=this.game,{tournamentId:n,leaderboardId:i}=s;a.event(Uc.Events.TOURNAMENT_START,{success:!0,game_mode:kc.toUpperCamelCase(t),tournament_id:n,leaderboard_id:i}),await this.nextAsync(e)}validateMode(e){if(!Bc.isString(e))throw new jt}};c(Ci,"LogTournamentStartHandler");let Ae=Ci;const Li=class Li extends Error{constructor(e){super(e),this.name="TournamentIdNotValid",this.message=e??"Tournament id is not valid"}};c(Li,"TournamentIdNotValid");let Ie=Li;const{Valid:Ve}=f.Utils,Oi=class Oi extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;this.validateContextId(s);const a=await GameSDK.getTournamentAsync(),n=a.getID().toString();this.validateTournamentId(n);const i=JSON.parse(a.getPayload()||"{}"),{leaderboardId:o}=i;this.validateLeaderboardId(o),t.customData.contextId=s,t.customData.tournamentId=n,t.customData.leaderboardId=o,await this.nextAsync(t)}validateContextId(t){if(!Ve.isString(t))throw new F}validateTournamentId(t){if(!Ve.isString(t))throw new Ie}validateLeaderboardId(t){if(!Ve.isString(t)||t==="")throw new ht}};c(Oi,"ContinueTournamentHandler");let Js=Oi;const Ti=class Ti extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,contextId:s}=e,a=new v(this),n=new Js(this,{contextId:s});a.setNext(n);const i=new T(this,{id:"1997",mode:k.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const o=new U(this);i.setNext(o);const r=new st(this,{profileId:t});o.setNext(r);const l=new $(this);r.setNext(l);const d=new Ae(this);l.setNext(d);const h=new b(this);l.setNext(h);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}};c(Ti,"ContinueTournamentConcrete");let Zs=Ti;const{Plugins:jc}=f,{Analytics:Kc}=jc,Mi=class Mi extends A{async processAsync(e){super.processAsync(e);const{customData:t}=e,{analytics:s}=this.game,{tournamentId:a,leaderboardId:n}=t;s.event(Kc.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:a,leaderboard_id:n}),await this.nextAsync(e)}};c(Mi,"LogTournamentCreateHandler");let ta=Mi;const Ri=class Ri extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.createTournamentAsync(),await this.updateMatchStateAsync(t),await this.nextAsync(t)}async createTournamentAsync(){const{name:t,score:s,customData:a}=this.payload;await GameSDK.tournament.createAsync({initialScore:s,config:{title:t,tournamentTitle:t},data:a})}async updateMatchStateAsync(t){try{if(!("getTournamentAsync"in GameSDK))throw new x("getTournamentAsync");const s=await GameSDK.getTournamentAsync(),a=s.getContextID(),n=s.getID().toString(),{playerId:i}=this.payload;t.customData.playerId=i,t.customData.contextId=a,t.customData.tournamentId=n}catch(s){if(s instanceof x)return}}};c(Ri,"CreateTournamentHandler");let ea=Ri;const{Valid:bo}=f.Utils,_i=class _i extends A{constructor(t,s){super(t);p(this,"payload");p(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.validatePayload(),await this.setupCreatePayload(t),await this.createLeaderboardAsync(t),await this.nextAsync(t)}validatePayload(){const{leaderboardId:t}=this.payload;if(!bo.isString(t))throw new ht}validatePlayerId(t){if(!bo.isString(t))throw new D}async setupCreatePayload(t){const{playerId:s}=t.customData;this.validatePlayerId(s);const{name:a,leaderboardId:n,customData:i}=this.payload;this.leaderboardPayload={_id:n,name:a??"",createdBy:s,description:JSON.stringify(i)}}async createLeaderboardAsync(t){const s=await this.game.leaderboard.createLeaderboardAsync(this.leaderboardPayload);t.customData.leaderboardId=s}};c(_i,"CreateLeaderboardHandler");let sa=_i;const $i=class $i extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,name:s,score:a,leaderboardId:n,payload:i}=e,o=new v(this),r=new St(this,{contextId:"SOLO"});o.setNext(r);const l=new ea(this,{name:s,score:a,playerId:t,customData:i});r.setNext(l);const d=new st(this,{profileId:t});l.setNext(d);const h=new Ct(this,{id:t,score:a});d.setNext(h);const y=new sa(this,{name:s,customData:i,leaderboardId:n});h.setNext(y);const g=new Qt(this);y.setNext(g);const w=new ta(this);g.setNext(w);const I=this.match.getMatchState();await o.processAsync(I)}finally{this.endLog()}}};c($i,"CreateTournamentConcrete");let aa=$i;const{Analytics:No}=f.Plugins,{Valid:Wc}=f.Utils,Vi=class Vi extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t),await this.postScoreTournamentAsync(t),await this.nextAsync(t)}validateData(t){const{profiles:s,customData:a}=t,{playerId:n}=a;if(this.validatePlayerId(n),!s[n])throw new V}validatePlayerId(t){if(!Wc.isString(t))throw new D}getPlayerProfile(t){const{profiles:s,customData:a}=t,{playerId:n}=a;return this.validatePlayerId(n),s[n]}isNewBestScore(t){const s=this.getPlayerProfile(t),{score:a=0,bestScore:n=0}=s;return a>n}async postScoreTournamentAsync(t){const{analytics:s}=window.game,a=this.getPlayerProfile(t),{score:n=0}=a;let i=null,o=!1;const{checkBestScore:r}=this.payload,l=this.isNewBestScore(t);try{if(!("getTournamentAsync"in GameSDK))throw new x("getTournamentAsync");await GameSDK.getTournamentAsync(),!r||l?(i=No.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:n})):(i=No.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(n)),o=!0}catch(d){console.warn("Post Score Tournament",d)}finally{i&&s.event(i,{success:o})}}};c(Vi,"PostScoreTournamentHandler");let na=Vi;const Gi=class Gi extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,bestScore:s}=e,a=new v(this),n=new ut(this,{useAPI:!1});a.setNext(n);const i=new Ct(this,{id:t,bestScore:s});n.setNext(i);const o=new na(this,{checkBestScore:!1});i.setNext(o);const r=new dt(this);o.setNext(r);const l=new Nt(this);r.setNext(l);const d=new Qt(this);l.setNext(d);const h=new Ht(this);d.setNext(h);const y=new b(this);h.setNext(y);const g=this.match.getMatchState();await a.processAsync(g)}finally{this.endLog()}}};c(Gi,"FinishTournamentConcrete");let ia=Gi;const{Valid:Ge,Object:zc}=f.Utils,Fi=class Fi extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{tournamentId:s}=this.payload;this.validateTournamentId(s),await this.joinTournamentAsync(s);const a=await GameSDK.getTournamentAsync(),n=a.getContextID();this.validateContextId(n);const i=JSON.parse(a.getPayload()||"{}"),{leaderboardId:o}=i;this.validateLeaderboardId(o),t.customData.contextId=n,t.customData.tournamentId=s,t.customData.leaderboardId=o,await this.nextAsync(t)}validateTournamentId(t){if(!Ge.isString(t))throw new Ie}validateContextId(t){if(!Ge.isString(t))throw new F}validateLeaderboardId(t){if(!Ge.isString(t)||t==="")throw new ht}async joinTournamentAsync(t){if(!("tournament"in GameSDK))throw new x("tournament");try{await GameSDK.tournament.joinAsync(t)}catch(s){if(!zc.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}};c(Fi,"JoinTournamentHandler");let oa=Fi;const Ui=class Ui extends E{async processAsync(e){try{this.startLog(e);const{playerId:t,tournamentId:s}=e,a=new v(this),n=new oa(this,{tournamentId:s});a.setNext(n);const i=new T(this,{id:"1997",mode:k.TOURNAMENT,customData:{playerId:t}});n.setNext(i);const o=new U(this);i.setNext(o);const r=new st(this,{profileId:t});o.setNext(r);const l=new $(this);r.setNext(l);const d=new Ae(this);l.setNext(d);const h=new b(this);d.setNext(h);const y=this.match.getMatchState();await a.processAsync(y)}finally{this.endLog()}}};c(Ui,"JoinTournamentConcrete");let ra=Ui;const{Dtos:Hc,Utils:qc}=f,{Object:Yc}=qc,ki=class ki extends A{constructor(t,s){super(t);p(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateMatchCustomData(t),await this.nextAsync(t)}updateMatchCustomData(t){const s=Yc.merge(t.customData,this.payload),a=new Hc.Match.CustomData(s).toObject();t.customData=a}};c(ki,"SetMatchCustomDataHandler");let ca=ki;const Qc={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:{...Ea}},{Configs:Co}=f,Bi=class Bi extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"base");p(this,"group");p(this,"single");p(this,"endless");p(this,"context");p(this,"challenge");p(this,"tournament");p(this,"api");p(this,"handler");p(this,"useCPUProfile")}init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}setUseCPUProfile(t){this.useCPUProfile=t}createMatchData(){const{storage:t}=this.game;t.addStorage("match",Qc)}getMatchState(){const{storage:t}=this.game;return t.getStorage("match")}createBaseConcrete(){this.base=new E(this.game,this)}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createConcreteHandlers(){this.handler={setProfileData:c(async t=>{const s=new Ct(this.base,t);await this.processHandlerAsync(s)},"setProfileData"),setMatchCustomData:c(async t=>{const s=new ca(this.base,t);await this.processHandlerAsync(s)},"setMatchCustomData"),setLeaderboardScore:c(async t=>{const s=new bt(this.base,t);await this.processHandlerAsync(s)},"setLeaderboardScore")}}createAPIHandler(){const t={appId:Co.AppId,matchAPIHost:Co.ApiHost};this.api=new ds(t)}createGroupFlows(){this.group={join:new Hs(this.game,this),start:new Ys(this.game,this),finish:new zs(this.game,this)}}createSingleFlows(){this.single={start:new Xs(this.game,this),finish:new Qs(this.game,this)}}createEndlessFlows(){this.endless={start:new Ks(this.game,this),finish:new Bs(this.game,this)}}createContextFlows(){this.context={choose:new Fs(this.game,this)}}createChallengeFlows(){this.challenge={invite:new Ns(this.game,this),friend:new gs(this.game,this),join:new Rs(this.game,this),await:new ys(this.game,this),result:new Gs(this.game,this),finish:new Ps(this.game,this),continue:new As(this.game,this)}}createTournamentFlows(){this.tournament={join:new ra(this.game,this),create:new aa(this.game,this),finish:new ia(this.game,this),continue:new Zs(this.game,this)}}processHandlerAsync(t){const s=this.getMatchState();return t.processAsync(s)}};c(Bi,"MatchPlugin");let la=Bi;const{Valid:it}=f.Utils,ot="is invalid",ji=class ji extends _{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!it.isNumber(e)||!e)&&this.exception("level",ot)}validateRescued(e){(!it.isNumber(e)||e<0)&&this.exception("rescued",ot)}validateContextId(e){it.isString(e)||this.exception("contextId",ot)}validatePlayerId(e){it.isString(e)||this.exception("playerId",ot)}validateOpponentId(e){it.isString(e)||this.exception("opponentId",ot)}validateTournamentId(e){it.isString(e)||this.exception("tournamentId",ot)}validateLeaderboardId(e){it.isString(e)||this.exception("leaderboardId",ot)}toObject(){return super.toObject()}static getDefaultData(){return _.getDefaultData()}};c(ji,"MatchCustomDataDtos");let De=ji;De.addDefaultData(Ea);const{Valid:tt}=f.Utils,et="is invalid",Ki=class Ki extends _{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!tt.isString(e)||!e)&&this.exception("id",et)}validateName(e){(!tt.isString(e)||!e)&&this.exception("name",et)}validatePhoto(e){tt.isString(e)||this.exception("photo",et)}validateScore(e){(!tt.isNumber(e)||e<0)&&this.exception("score",et)}validateBestScore(e){(!tt.isNumber(e)||e<0)&&this.exception("bestScore",et)}validateEndlessScore(e){(!tt.isNumber(e)||e<0)&&this.exception("endlessScore",et)}validateBestEndlessScore(e){(!tt.isNumber(e)||e<0)&&this.exception("bestEndlessScore",et)}validateFinished(e){tt.isBoolean(e)||this.exception("finished",et)}toObject(){return super.toObject()}static getDefaultData(){return _.getDefaultData()}};c(Ki,"MatchProfileDtos");let Pe=Ki;Pe.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0});f.Dtos.Match={Data:Yt,CustomData:De,Profile:Pe};const{Utils:Xc}=f,{ApiHost:Jc}=f.Configs,Zc=c(async u=>{const e=await M("players",u,{},Jc,10);return Xc.Object.hasOwn(e,"data")?e.data||{}:{}},"updatePlayerProfileAsync"),{Utils:tl,Configs:el}=f,{AppId:sl}=el,{Array:al,Object:ne,Valid:nl}=tl,Wi=class Wi extends C.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("player",Pt)}async saveToCloud(){try{const e=this.getPlayerData();await GameSDK.player.setDataAsync(e)}catch(e){console.warn(e)}}receiveData(e,t){const{storage:s}=this.game,{playerId:a,name:n,photo:i,locale:o}=e;s.setStorageData("player","playerId",a),s.setStorageData("player","name",n),s.setStorageData("player","photo",i),s.setStorageData("player","locale",o),t&&this.setPlayerData(t)}async syncProfileToServer(){const{storage:e}=this.game,t=this.getPlayer(),{playerId:s,name:a,photo:n,locale:i}=t;let o=this.getPlayerASID();!nl.isString(o)&&"getASIDAsync"in GameSDK.player&&(o=await GameSDK.player.getASIDAsync()??o,e.setStorageData("player","ASID",`${o}`)),await Zc({appId:sl,ASID:o,playerId:s,name:a,photo:n,locale:i})}setPlayerDataByName(e,t){this.setPlayerData({[e]:t})}setPlayerData(e){const{storage:t}=this.game;t.setStorageData("player","data",e),this.saveToCloud()}setBestScore(e){this.setPlayerDataByName("score",e)}setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}setSetting(e,t){this.setPlayerDataByName("settings",{[e]:t})}setGameData(e){const t=this.getGameData()??{},s=ne.merge(t,e);this.setPlayerDataByName("gameData",s)}async requestConnectedPlayers(){const{storage:e}=this.game,s=(await GameSDK.player.getConnectedPlayersAsync()).map(i=>{const o=i.getID(),r=i.getName(),l=i.getPhoto();return!o||!r||!l?null:new xt({playerId:o,name:r,photo:l}).toObject()}),a=al.unique(s);if(a.length<1)return;const n=ne.keyBy(a,"playerId");e.setStorageData("player","connectedPlayers",n)}getPlayer(){const{storage:e}=this.game;return e.getStorage("player")}getPlayerId(){const{storage:e}=this.game;return e.getStorageData("player","playerId")}getPlayerASID(){const{storage:e}=this.game;return e.getStorageData("player","ASID")}getPlayerLocale(){const{storage:e}=this.game;return e.getStorageData("player","locale")}getPlayerData(){const{storage:e}=this.game;return e.getStorageData("player","data")}getPlayerDataByKey(e){const t=this.getPlayerData();return ne.hasOwn(t,e)?t[e]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(e){const t=this.getPlayerSettings();return ne.hasOwn(t,e)?t[e]:null}getPlayerSettings(){const{settings:e}=this.getPlayerData();return e}isFirstLogin(){return this.getPlayerDataByKey("isFirstLogin")??Pt.data.isFirstLogin}loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}getBestScore(){const{score:e}=this.getPlayerData();return e}getBestEndlessScore(){const{endlessScore:e}=this.getPlayerData();return e}getConnectedPlayers(){const{storage:e}=this.game;return e.getStorageData("player","connectedPlayers")}getConnectedPlayerIds(e,t){const s=this.getConnectedPlayers();return Object.keys(s).slice(t,t+e)}};c(Wi,"PlayerPlugin");let da=Wi;const{Dtos:Lo,Utils:il}=f,{Valid:yt}=il,{score:qo,endlessScore:ol,settings:rl,gameData:cl,isFirstLogin:ll,dailyRewarded:dl}=Pt.data,ft="is invalid",zi=class zi extends _{processData(e){this.validateStructure(e),e.settings=new Lo.Player.Settings(e.settings).toObject(),e.gameData=new Lo.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateScore(e){(!yt.isNumber(e)||e<0)&&this.exception("score",ft)}validateEndlessScore(e){(!yt.isNumber(e)||qo<0)&&this.exception("endlessScore",ft)}validateSettings(e){yt.isObject(e)||this.exception("settings",ft)}validateGameData(e){yt.isObject(e)||this.exception("gameData",ft)}validateIsFirstLogin(e){yt.isBoolean(e)||this.exception("isFirstLogin",ft)}validateDailyRewarded(e){yt.isObject(e)||this.exception("dailyRewarded",ft)}toObject(){return super.toObject()}};c(zi,"PlayerDataDtos");let xe=zi;xe.addDefaultData({score:qo,endlessScore:ol,settings:rl,gameData:cl,isFirstLogin:ll,dailyRewarded:dl});const{Valid:Oo}=f.Utils,{level:hl,coins:ul}=Pt.data.gameData,Hi=class Hi extends _{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!Oo.isNumber(e)||e<0)&&this.exception("level","is invalid")}validateCoins(e){(!Oo.isNumber(e)||e<0)&&this.exception("coins","is invalid")}toObject(){return super.toObject()}};c(Hi,"PlayerGameDataDtos");let Ee=Hi;Ee.addDefaultData({level:hl,coins:ul});const{Valid:ie}=f.Utils,{sound:pl,music:yl,vibrate:fl,language:gl}=Pt.data.settings,oe="is invalid",qi=class qi extends _{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateSound(e){ie.isBoolean(e)||this.exception("sound",oe)}validateMusic(e){ie.isBoolean(e)||this.exception("music",oe)}validateVibrate(e){ie.isBoolean(e)||this.exception("vibrate",oe)}validateLanguage(e){(!ie.isString(e)||!e)&&this.exception("language",oe)}toObject(){return super.toObject()}};c(qi,"PlayerSettingsDtos");let Se=qi;Se.addDefaultData({sound:pl,music:yl,vibrate:fl,language:gl});f.Dtos.Player={Info:xt,Data:xe,Settings:Se,GameData:Ee};const{Configs:wl,Utils:ml}=f,{Object:Al,String:Il}=ml,{ApiHost:Dl,Mockup:Pl}=wl,Yi=class Yi{constructor(){p(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await rt(async()=>{const{default:t}=await Promise.resolve().then(()=>Vt);return{default:t}},void 0,import.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load ProfileAPIMock");this.mockAPI=new e}async getPlayersAsync(e){const t=Il.params(e);let s;return Pl.Profile.Enabled?(await this.initMockAPI(),s=await this.mockAPI.getPlayersAsync(e)):s=await mt(`players?${t}`,{},Dl),!Al.hasOwn(s,"data")||!Array.isArray(s.data)?[]:s.data}};c(Yi,"ProfileAPI");let ha=Yi;const xl={profiles:{},profileIds:[]},{Utils:El,Dtos:Sl}=f,{Array:vl,Valid:bl,Object:Nl}=El,Qi=class Qi extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"profileAPI",new ha)}init(){const{storage:t}=this.game;t.addStorage("profile",xl)}async requestProfiles(t){const s=this.getProfileIds(),a=vl.difference(t,s);if(a.length<1)return;const n=await this.profileAPI.getPlayersAsync({playerIds:a});if(!this.validateProfilesResponse(n))return;const i=this.convertToProfiles(n);this.setProfiles(i)}getProfile(t){return this.getProfiles()[t]??null}getProfiles(){const{storage:t}=this.game;return t.getStorageData("profile","profiles")}setProfiles(t){const{storage:s}=this.game;s.setStorageData("profile","profiles",t),s.setStorageData("profile","profileIds",Object.keys(t))}getProfileIds(){const{storage:t}=this.game;return t.getStorageData("profile","profileIds")}validateProfilesResponse(t){return!(!Array.isArray(t)||t.length<1)}convertToProfiles(t){const s={};return t.forEach(a=>{Nl.hasOwn(a,"playerId")&&bl.isString(a.playerId)&&(s[a.playerId]=new Sl.Player.Info(a).toObject())}),s}};c(Qi,"ProfilePlugin");let ua=Qi;const{Utils:To}=f,Xi=class Xi extends C.Plugins.BasePlugin{constructor(t){super(t);p(this,"storages");this.storages={}}addStorage(t,s){console.info("addStorage",t,s),this.storages[t]=s}setStorageData(t,s,a){let n;if(To.Valid.isObject(a)){const i=this.getStorageData(t,s);n=To.Object.merge(i,a)}else n=a;this.storages[t][s]=n}getStorageData(t,s){return this.getStorage(t)[s]}getStorage(t){return this.storages[t]}};c(Xi,"StoragePlugin");let pa=Xi;const Ji=class Ji extends C.Plugins.BasePlugin{constructor(){super(...arguments);p(this,"isVisible",!0);p(this,"browserPrefixes",["moz","ms","o","","webkit"]);p(this,"handleVisibilityChange",c(t=>{if(["focus","blur"].indexOf(t)>-1)return t==="focus"?this.onVisibleEvent():this.onHiddenEvent();const a=this.getBrowserPrefix();return this.getHiddenPropertyName(a)in document?this.onHiddenEvent():this.onVisibleEvent()},"handleVisibilityChange"))}init(){const t=this.getBrowserPrefix();[this.getVisibilityEvent(t),"focus","blur"].forEach(n=>{window.addEventListener(n,()=>{this.handleVisibilityChange(n)},!1),document.addEventListener(n,()=>{this.handleVisibilityChange(n)},!1)})}isGameVisible(){return this.isVisible}getHiddenPropertyName(t){return t?t+"Hidden":"hidden"}getVisibilityEvent(t){return(t||"")+"visibilitychange"}getBrowserPrefix(){for(const t of this.browserPrefixes)if(this.getHiddenPropertyName(t)in document)return t;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(f.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(f.Events.VISIBILITY_HIDDEN))}};c(Ji,"VisibilityPlugin");let ya=Ji;const Zi=class Zi extends jo{async loadAsync(){this.exception("Unsupported method")}async showAsync(){this.exception("This method is not implemented")}async hideAsync(){this.exception("This method is not implemented")}};c(Zi,"BannerInstance");let fa=Zi;const{Status:Mo}=f.Plugins.Ads,to=class to extends fa{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId),this.status=Mo.SHOWING}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId),this.status=Mo.IDLE}};c(to,"BannerAdInstance");let ga=to;const{Object:Cl}=f.Utils,{Status:H,Types:gt,AdError:re,AdInstance:Ll}=f.Plugins.Ads,eo=class eo extends Ll{constructor(t,s){super(t,s);p(this,"instance");p(this,"instanceLoadFailedQueue",[]);this.instance=null}async loadAsync(){if(console.info("AdInstance","loadAsync called",{type:this.type,status:this.status}),this.status!==H.IDLE)throw new re("AD_NOT_READY","Ad is not ready.");try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new re("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.status=H.LOADING,await this.instance.loadAsync(),this.status=H.FILLED,console.info("AdInstance","loadAsync success",{type:this.type,status:this.status}),this.type===gt.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(),this.type===gt.REWARDED_VIDEO&&self.game.analytics.loadRewardedVideoAd()}catch(t){throw console.warn("AdInstance","loadAsync failed",{type:this.type,status:this.status,error:t}),this.status=H.IDLE,t instanceof Object&&"code"in t&&t.code==="INVALID_PARAM"&&(this.instance=null),this.instance&&this.instanceLoadFailedQueue.push(this.instance),self.game.analytics.loadAdFail(this.type),t}}async showAsync(){if(console.info("AdInstance","showAsync called",{type:this.type,status:this.status}),this.status!==H.FILLED)throw new re("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new re("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");let t=!1;try{this.status=H.SHOWING,await this.instance.showAsync(),t=!0,this.status=H.IDLE,this.instance=null,console.info("AdInstance","showAsync success",{type:this.type,status:this.status})}catch(s){throw console.warn("AdInstance","showAsync failed",{type:this.type,status:this.status,error:s}),this.status=H.FILLED,f.Utils.Object.hasOwn(s,"code")&&(s.code==="AD_NOT_LOADED"&&(this.status=H.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf(`${s.code}`)>-1&&(this.status=H.IDLE,this.instance=null),s.code==="USER_INPUT"&&(t=!0)),s}finally{t?(this.type===gt.INTERSTITIAL&&self.game.analytics.showInterstitialAd(),this.type===gt.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd()):self.game.analytics.showAdFail(this.type)}}async createInstanceByType(t){try{switch(t){case gt.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case gt.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);default:return null}}catch(s){if(!Cl.hasOwn(s,"code"))throw s;return s.code==="ADS_TOO_MANY_INSTANCES"?this.getAdInstanceFailed():null}}getAdInstanceFailed(){const{length:t}=this.instanceLoadFailedQueue,s=Math.floor(Math.random()*t);return this.instanceLoadFailedQueue[s]||null}};c(eo,"NormalAdInstance");let ve=eo;const{BaseAnalytics:Ol,Events:Ro}=f.Plugins.Analytics,Tl=[Ro.BUTTON_CLICK,Ro.SCREEN_OPEN],so=class so extends Ol{constructor(t,s){super(t,"FacebookAnalytics",{...s,color:"#0F52BA"});p(this,"prefix");this.prefix=s.prefix}processEvent(t,s){if(!("logEvent"in GameSDK.extra)||Tl.indexOf(t)>-1)return;const a=this.addPrefixToEventName(t);GameSDK.extra.logEvent(a,1,s)}addPrefixToEventName(t){return`${this.prefix}_${t}`}};c(so,"FacebookAnalytics");let wa=so;const{BaseAnalytics:Ml,Events:Rl}=f.Plugins.Analytics,_l=[Rl.SCREEN_OPEN],ao=class ao extends Ml{constructor(e,t){super(e,"FirebaseAnalytics",{...t,color:"#FFCA28"})}setUser(e,t){var s;(s=this.game.firebase.services.analytics)==null||s.setUser(e,t)}processEvent(e,t){var s;_l.indexOf(e)>=0||(s=this.game.firebase.services.analytics)==null||s.event(e,t)}};c(ao,"FirebaseAnalytics");let ma=ao;const{BaseAnalytics:$l,Events:Vl}=f.Plugins.Analytics,Gl=[Vl.SCREEN_OPEN],no=class no extends $l{constructor(e,t){super(e,"GoogleAnalytics",{...t,color:"#E35335"})}processEvent(e,t){Gl.indexOf(e)>=0||gtag("event",e,t)}};c(no,"GoogleAnalytics");let Aa=no;const Fl="production",Fe="26",{Dtos:Ul,Events:wt,Configs:N,Utils:kl}=f,{Object:_o,Json:_t,String:$o,Valid:Vo,Mark:S}=kl,io=class io extends C.Game{constructor(){super(...arguments);p(this,"markName","Core Initialize");p(this,"modulePlugins",[]);p(this,"handleProtectGameInstance",c(()=>{const t=this.event.getEventEmitCount(at.MODULE_PLUGIN_READY),s=this.modulePlugins.length;t<s||(window.game=Object.freeze(window.game))},"handleProtectGameInstance"));p(this,"initMonitorErrorPlugin",c(()=>{if(!this.monitorError)return;const{MonitorError:t}=N.Debugger,{ApiKey:s,Service:a,TrackUser:n,FilterErrors:i,ListPlayerDevIds:o}=t,r=GameSDK.player.getID(),l=GameSDK.player.getName();r&&o.indexOf(r)>-1||(this.monitorError.configure({apiKey:s,service:a,trackUser:n,releaseStage:Fl,buildVersion:`${Fe}`}),this.monitorError.setUser({id:r,name:l}),this.monitorError.addFilterErrors(i),this.updateMonitorErrorUserAndMetadata(),this.processErrorsQueue())},"initMonitorErrorPlugin"));p(this,"updateMonitorErrorUserAndMetadata",c(()=>{if(!(this.event.getEventEmitCount(wt.PLAYER_INFO_LOADED)>0)){this.event.once(wt.PLAYER_INFO_LOADED,this.processWhenPlayerInfoLoaded);return}this.processWhenPlayerInfoLoaded()},"updateMonitorErrorUserAndMetadata"));p(this,"processErrorsQueue",c(()=>{window.__errorQueue&&(window.__errorQueue.forEach(t=>{if(this.monitorError)if(t instanceof Error)this.monitorError.sendException(t);else{const{message:s,code:a,stack:n}=t||{message:"",code:"Unknown",stack:"Unknown stack"},i=new Error(s||a);i.stack=n,this.monitorError.sendException(i)}}),window.__errorQueue=null)},"processErrorsQueue"));p(this,"processWhenPlayerInfoLoaded",c(()=>{var a,n;const{playerId:t,name:s}=this.player.getPlayer();(a=this.monitorError)==null||a.setUser({id:t,name:s}),(n=this.monitorError)==null||n.addMetadata({isFirstLogin:this.player.isFirstLogin()})},"processWhenPlayerInfoLoaded"));p(this,"handleSaveRemoteConfig",c(t=>{try{const s={[t.type]:t};this.player.setPlayerDataByName("remoteConfig",s)}catch(s){console.warn("handleSaveGameCoreConfig",s)}},"handleSaveRemoteConfig"));p(this,"handleUpdateGameCoreConfig",c(t=>{try{const{id:s,type:a}=t;if(a!=="GameCore")return;f.Configs=_o.merge(f.Configs,t.config);const{Ads:n}=f.Configs;this.ads.configure(n),this.event.emit(at.REMOTE_CONFIG_UPDATED,{id:s,type:a})}catch(s){console.warn("handleUpdateGameCoreConfig",s)}},"handleUpdateGameCoreConfig"));p(this,"handleStorageCurrentRemoteConfig",c(()=>{const t=this.player.getPlayerDataByKey("remoteConfig");if(console.info("playerRemoteConfig",_t.clone(t)),!!t){for(const s in t)if(_o.hasOwn(t,s)){const a=t[s],n=_t.clone(a);console.log("newRemoteConfig",n);const i=new Ul.RemoteConfig.Data(n).toObject();console.info("remoteConfigValid",i),this.remoteConfig.setRemoteConfig(i),this.remoteConfig.processUpdateConfig(i.id,i.type)}}},"handleStorageCurrentRemoteConfig"));p(this,"initAdaptivePerformancePlugin",c(()=>{if(!this.adaptivePerformance)return;const t=_t.clone(N.AdaptivePerformance);this.adaptivePerformance.configure(t)},"initAdaptivePerformancePlugin"));p(this,"processAfterSyncProfile",c(()=>{const{Notification:t}=N;t.Enabled&&this.updatePlayerProfileToNotificationService()},"processAfterSyncProfile"))}getBuildVersion(){return parseInt(`${Fe}`)}async boot(){console.groupCollapsed(" GameCore Boot"),super.boot(),this.addPlugins(),this.initEventPlugin(),this.event.emit(wt.CORE_BOOTING),this.initFirebasePlugin(),this.initMarkCoreInitialize(),S.putAttr(this.markName,"Step","Init Plugins"),this.initAds(),this.initMatchPlugin(),this.initRemoteConfig(),S.putAttr(this.markName,"Step","Load Lazy Plugins"),Vo.isDebugger()||this.event.on(wt.MODULE_PLUGIN_READY,this.handleProtectGameInstance),this.addMonitorPlugin().then(this.initMonitorErrorPlugin),this.addAdaptivePerformancePlugin().then(this.initAdaptivePerformancePlugin),S.putAttr(this.markName,"Step","Load Dev Plugins"),this.addDevPlugins().then(()=>{this.initConsolePlugin(),this.initProfilerPlugin(),this.initCanvasRecorderPlugin()})}async start(){console.groupEnd(),console.groupCollapsed(" GameCore Start"),super.start(),S.putAttr(this.markName,"Step","Core Start"),this.event.emit(wt.CORE_STARTING),S.putAttr(this.markName,"Step","Request Token"),await this.auth.requestToken(),S.putAttr(this.markName,"Step","Init States"),await this.initState(),S.putAttr(this.markName,"Step","Process Player Profile"),this.processPlayerProfile(),S.putAttr(this.markName,"Step","Process Context Payload"),await this.context.detectContextSessionType(),this.context.detectContextGameMode();const t=this.storage.getStorageData("context","sessionContextType");S.putAttr(this.markName,"Context Mode",t),S.putAttr(this.markName,"Step","Init Analytics"),this.initGoogleAnalytics(),this.initFirebaseAnalytics(),this.initFacebookAnalytics(),S.putAttr(this.markName,"Step","Core Ready"),S.putAttr(this.markName,"Success","true"),S.stop(this.markName),this.event.emit(wt.CORE_READY)}addPlugins(){this.installPlugin("Storage",pa),this.installPlugin("Event",Ze),this.installPlugin("Ads",Be),this.installPlugin("Auth",He),this.installPlugin("Audio",ze),this.installPlugin("Match",la),this.installPlugin("Player",da),this.installPlugin("Profile",ua),this.installPlugin("Context",Qe),this.installPlugin("Language",is),this.installPlugin("Firebase",ts),this.installPlugin("Analytics",je),this.installPlugin("Visibility",ya),this.installPlugin("Leaderboard",rs),this.installPlugin("DailyRewards",Je),this.installPlugin("FrameCapture",ns),this.installPlugin("RemoteConfig",ts)}installPlugin(t,s,a=!1){const n=$o.toCamelCase($o.capitalize(t));this.plugins.install(t,s,!0,n),t!=="Storage"&&(a?this.emitModulePluginReady(t):this.emitCorePluginReady(t))}async addMonitorPlugin(){const{MonitorError:t}=N.Debugger;if(!t.Enabled)return;this.modulePlugins.push("MonitorError");const s=(await rt(async()=>{const{default:a}=await Promise.resolve().then(()=>Vt);return{default:a}},void 0,import.meta.url)).default;typeof s=="function"&&this.installPlugin("MonitorError",s,!0)}async addAdaptivePerformancePlugin(){const{AdaptivePerformance:t}=N;if(!t.Enabled)return;this.modulePlugins.push("AdaptivePerformance");const s=(await rt(async()=>{const{default:a}=await import("./bundle/index.js");return{default:a}},__vite__mapDeps([0,1]),import.meta.url)).default;typeof s=="function"&&this.installPlugin("AdaptivePerformance",s,!0)}async addDevPlugins(){if(!Vo.isDebugger())return;const{ShowConsole:t,ShowProfiler:s,CanvasRecorder:a}=N.Debugger;if(t){this.modulePlugins.push("Console");const n=(await rt(async()=>{const{default:i}=await import("./bundle/console.js");return{default:i}},__vite__mapDeps([2,1,3]),import.meta.url)).default;typeof n=="function"&&this.installPlugin("Console",n,!0)}if(s){this.modulePlugins.push("Profiler");const n=(await rt(async()=>{const{default:i}=await Promise.resolve().then(()=>Vt);return{default:i}},void 0,import.meta.url)).default;typeof n=="function"&&this.installPlugin("Profiler",n,!0)}if(a.Enabled){this.modulePlugins.push("CanvasRecorder");const n=(await rt(async()=>{const{default:i}=await Promise.resolve().then(()=>Vt);return{default:i}},void 0,import.meta.url)).default;typeof n=="function"&&this.installPlugin("CanvasRecorder",n,!0)}}emitCorePluginReady(t){this.event.emit(at.CORE_PLUGIN_READY,{name:t})}emitModulePluginReady(t){this.event.emit(at.MODULE_PLUGIN_READY,{name:t})}initEventPlugin(){const{EventLogging:t}=N.Debugger;t&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}initAds(){const{Ads:t}=f.Plugins;this.ads.configure(N.Ads),this.initAdInstance(t,N)}initAdInstance(t,s){const{InterstitialAdOptions:a,RewardedVideoAdOptions:n,BannerDisplayAdOptions:i}=s.Ads;a.forEach(o=>{this.ads.setAdInstance(t.Types.INTERSTITIAL,o.PlacementId,ve)}),n.forEach(o=>{this.ads.setAdInstance(t.Types.REWARDED_VIDEO,o.PlacementId,ve)}),i.forEach(o=>{this.ads.setAdInstance(t.Types.BANNER,o.PlacementId,ga)})}async initState(){try{const t=new Ue(this);t.initContext(),await t.initPlayer()}catch(t){console.error("StateInitiator",t)}}initConsolePlugin(){this.console&&this.console.configure()}initProfilerPlugin(){this.profiler&&this.profiler.configure()}initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;const{CanvasRecorder:t}=N.Debugger,{Type:s,Quality:a,RecordFps:n,SyncFps:i}=t.Options;this.canvasRecorder.configure({type:s,quality:a,syncFps:i,recordFps:n});const o=document.querySelector("canvas");if(!o)return console.error("Canvas not found");this.canvasRecorder.setCanvas(o)}initRemoteConfig(){const{RemoteConfig:t}=N;if(!t.Enabled)return;const s=_t.clone(t);this.remoteConfig.configure(s),this.event.on(at.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(at.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.once(at.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}initFirebasePlugin(){const{Firebase:t}=N;if(!t.Enabled)return;const s=_t.clone(t);this.firebase.configure(s),S.setService(this.firebase.services.performance)}initMarkCoreInitialize(){N.PerformanceMonitor.CoreFlows&&(S.measure(this.markName),S.putAttr(this.markName,"Build",`${Fe}`),S.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),S.putAttr(this.markName,"Platform",GameSDK.getPlatform()),S.putAttr(this.markName,"Success","false"),S.start(this.markName))}async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch(t){console.warn("processPlayerProfile fail",t)}}async updatePlayerProfileToNotificationService(){try{const{AppId:t}=N,s=this.player.getPlayer(),{ASID:a,playerId:n,name:i,photo:o,locale:r}=s;await ur({appId:t,ASID:a,playerId:n,name:i,photo:o,locale:r})}catch(t){console.warn("updatePlayerProfileToNotificationService",t)}}initGoogleAnalytics(){const{Enabled:t,ConsoleLog:s}=N.Analytics.GoogleAnalytics??{};t&&this.analytics.add(new Aa(this.game,{log:!!s}))}initFirebaseAnalytics(){const{Enabled:t,ConsoleLog:s}=N.Analytics.FirebaseAnalytics??{};if(!t)return;const a=new ma(this.game,{log:!!s}),n=this.player.getPlayer(),{ASID:i,playerId:o,locale:r}=n;a.setUser(o,{ASID:i,locale:r}),this.analytics.add(a)}initFacebookAnalytics(){const{Enabled:t,Prefix:s,ConsoleLog:a}=N.Analytics.FacebookAnalytics??{};if(t){if(typeof s!="string"){console.warn("Facebook Analytics is not configured");return}this.analytics.add(new wa(this.game,{prefix:s,log:!!a}))}}};c(io,"MagicGame");let Ia=io;const{Configs:Bl,Utils:jl,Events:Sa}=f,{Device:Kl}=jl,{ForceDesktopDPR:ce}=Bl.GameEngine,Wl=c(async()=>{try{gtag("event","app_initialize")}catch(t){console.warn("gtag init",t)}const u=new Ia;window.game=u;const e=20;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e),window.__gameCoreStart=!0,await u.boot(),u.event.once(Sa.REQUEST_CORE_START,Yo),zl(u)},"initGame"),Yo=c(()=>{if(!window.__sdkInitiated){game.event.once(Sa.GAME_SDK_READY,Yo);return}window.game.start(),console.warn("Game started");const u=25;window.__sdkLoadingCount<u&&(window.__sdkLoadingCount=u)},"startGame"),zl=c(u=>{const t=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(t);const s=10;window.__sdkLoadingCount<s&&(window.__sdkLoadingCount=s),u.event.emit(Sa.GAME_SDK_READY)},5)},"waitGameSDK");ce!==!1&&Kl.isDesktop()&&typeof ce=="number"&&ce>0&&(window.devicePixelRatio=ce);Wl();
