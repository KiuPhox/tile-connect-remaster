var Wc=Object.defineProperty;var hh=(a,e,t)=>e in a?Wc(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var o=(a,e)=>Wc(a,"name",{value:e,configurable:!0});var f=(a,e,t)=>(hh(a,typeof e!="symbol"?e+"":e,t),t);import{G as g,P as N,M as uh,_ as dt,a as Q,C as st}from"./bundle/core.js";import{g as fh}from"./bundle/__commonjsHelpers__.js";o(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}o(t,"getFetchOpts");function s(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}o(s,"processPreload")},"polyfill")();const{Valid:kt,Object:xs,String:Ns,Json:Hc}=g.Utils,ne="is invalid",et=class et{static addDefaultData(e){kt.isObject(e)||this.prototype.exception("default data",ne),e=Hc.clone(e);const{name:t}=this;kt.isObject(et.data[t])||(et.data[t]={}),et.data[t]=xs.merge(et.data[t],e),console.info(`${t} default data:`,et.data[t])}static getDefaultData(){const{name:e}=this;return Hc.clone(et.data[e])}static addValidateFunction(e,t){kt.isString(e)||this.prototype.exception("validate key",ne),typeof t!="function"&&this.prototype.exception("validate function",ne);const s=`validate${Ns.capitalize(e)}`;Object.assign(this.prototype,{[s]:t})}constructor(e){this.defaultData(),this.processData(e)}processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}defaultData(){const{name:e}=this.constructor;this.lazyDefaultData(et.data[e])}lazyDefaultData(e){kt.isObject(e)||this.exception("data",ne);for(const t in e)if(xs.hasOwn(e,t)){const s=e[t];Object.assign(this,{[t]:s})}}lazyValidateStructure(e){kt.isObject(e)||this.exception("structure","is not object"),this.getKeys().forEach(t=>{const s=this[t];s===void 0&&this.exception("structure",`has no key ${t}`),!xs.hasOwn(e,t)&&s!==void 0&&this.setDefaultData(t,e)})}setDefaultData(e,t){kt.isObject(t)||this.exception("data",ne);const s=this[e];s===void 0&&this.exception("default",`has no key ${e}`),Object.assign(t,{[e]:s})}lazyValidateData(e){this.getKeys().forEach(t=>{const s=e[t],n=Ns.removeDiacritics(t).replace(/[^a-zA-Z0-9]/g,""),i=`validate${Ns.capitalize(n)}`,r=this[i];if(typeof r=="function")try{r.call(this,s)}catch(c){console.warn(c),this.setDefaultData(t,e)}else this.exception("validate",`has no function ${i}`)})}lazySetupData(e){this.getKeys().forEach(t=>{const s=e[t];Object.assign(this,{[t]:s})})}validate(){this.validateData(this.toObject())}exception(e,t){throw new Error(`${this.constructor.name}: ${e} ${t}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([e])=>e!=="toObject"))}getKeys(){return Object.keys(this).filter(e=>e!=="toObject")}};o(et,"BaseDtos"),f(et,"data",{});let L=et;g.Dtos={Base:L};const ph={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded"},Ht={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0}},{Valid:ae}=g.Utils,{playerId:gh,name:yh,photo:mh,locale:wh}=Ht,ie="is invalid",Oi=class Oi extends L{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!ae.isString(e)||!e)&&this.exception("_id",ie)}validatePlayerId(e){(!ae.isString(e)||!e)&&this.exception("playerId",ie)}validateName(e){(!ae.isString(e)||!e)&&this.exception("name",ie)}validatePhoto(e){ae.isString(e)||this.exception("photo",ie)}validateLocale(e){(!ae.isString(e)||!e)&&this.exception("locale",ie)}toObject(){return super.toObject()}};o(Oi,"PlayerInfoDtos");let qt=Oi;qt.addDefaultData({playerId:gh,name:yh,photo:mh,locale:wh});const ht=new qt({playerId:"10",name:"Your Friend"}).toObject(),Mi=class Mi extends Error{constructor(t){super(t);f(this,"code");this.code="CREATE_MATCH_FAILED"}};o(Mi,"ACreateMatchFailed");let nt=Mi;const Ri=class Ri extends nt{constructor(e){super(e),this.name="PlayerIdNotValid",this.message=e??"Player id is not valid"}};o(Ri,"PlayerIdNotValid");let D=Ri;const{Dtos:Os}=g,Li=class Li{constructor(e){f(this,"game");f(this,"initContext",o(()=>{const e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},t=new Os.Context.Info(e),{contextId:s,contextType:n,entryPointData:i}=t.toObject();this.game.context.receiveContext(s,n,i)},"initContext"));f(this,"initPlayer",o(async()=>{const{player:e}=this.game,t=this.getPlayerInfo();console.info("playerInfo",g.Utils.Json.clone(t));const s=Object.values(ph);console.info("dataKeys",s);const n=await GameSDK.player.getDataAsync(s);console.info("rawData",g.Utils.Json.clone(n));const i=new Os.Player.Data(n).toObject();console.info("playerData",g.Utils.Json.clone(i)),e.receiveData(t,i),this.game.event.emit(g.Events.PLAYER_INFO_LOADED)},"initPlayer"));f(this,"getPlayerInfo",o(()=>{try{const e=GameSDK.player.getID();let t=GameSDK.player.getName();const s=GameSDK.player.getPhoto(),n=GameSDK.getLocale();if(!g.Utils.Valid.isString(e))throw new D;return g.Utils.Valid.isString(t)||(t="You"),new Os.Player.Info({playerId:e,name:t,photo:s,locale:n}).toObject()}catch{return ht}},"getPlayerInfo"));this.game=e}};o(Li,"StateInitiator");let tn=Li;const $i=class $i extends Error{constructor(t,s){super(t);f(this,"payload");this.name="BadRequest",this.message=t??"This request is bad",this.payload=s}};o($i,"BadRequest");let ue=$i;const Fi=class Fi extends Error{constructor(t,s){super(t);f(this,"payload");this.name="RequestTimeout",this.message=t??"This request is timeout",this.payload=s}};o(Fi,"RequestTimeout");let fe=Fi;const{Utils:Ah,Configs:Ih}=g,{AppId:qc,Network:yi}=Ih,bh=o(a=>{if(!a.ok)throw new ue(void 0,{response:a})},"validateResponse"),ed=o(()=>{const a=window.game.auth.getToken();return{token:a,timeout:yi.Timeout,headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}},"defaultConfig"),sd=o((a,e,t,s)=>async()=>{try{if(!qc)throw new ue("AppId is not defined");const n=`${a}/apps/${qc}/${e}`,i=new AbortController;t.signal=i.signal;const r=setTimeout(()=>{i.abort()},t.timeout);g.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const c=await fetch(n,t);return clearTimeout(r),bh(c),await c.json()||{}}catch(n){if(n instanceof ue)return null;throw n instanceof Object&&"name"in n&&n.name==="AbortError"?new fe:n}},"requester"),mi=o(async(a,e)=>{try{return a()}catch(t){if(t instanceof fe&&e>0)try{return await Ah.Time.sleepAsync(600),await mi(a,e-1)}catch{return{}}return t instanceof fe?{}:(console.warn("Request error",t),{})}},"handleRequest"),Kt=o(async(a,e={},t,s=yi.Retries)=>{try{const n={...ed(),...e,method:"GET"},i=sd(t,a,n);return await mi(i,s)}catch(n){return console.warn("Get error",n),{}}},"get"),B=o(async(a,e,t={},s,n=yi.Retries)=>{try{const i={...ed(),...t,method:"POST"},r=sd(s,a,i,e);return await mi(r,n)}catch(i){return console.warn("Post error",i),{}}},"post"),{ApiUrl:Eh}=g.Configs.Notification,Dh=o(async a=>{if(!g.Utils.Object.hasOwn(a,"playerId"))throw new Error("Missing playerId");const{playerId:e}=a;await B(`players/${e}`,a,{},Eh,10)},"updatePlayerProfileNotificationAsync");var nd=(a=>(a.IDLE="idle",a.LOADING="loading",a.FILLED="filled",a.SHOWING="showing",a))(nd||{});const ad=nd;var id=(a=>(a.BANNER="banner",a.INTERSTITIAL="interstitial",a.REWARDED_VIDEO="rewarded_video",a))(id||{});const lt=id;var xe;let ce=(xe=class extends Error{constructor(t,s){super(s);f(this,"code");this.code=t,this.message=s}},o(xe,"AdError"),xe);const Ui=class Ui{constructor(e,t){f(this,"type");f(this,"status");f(this,"placementId");this.type=e,this.status=ad.IDLE,this.placementId=t}getStatus(){return this.status}exception(e){throw new ce("AD_INSTANCE_ERROR",e)}};o(Ui,"BaseInstance");let en=Ui;var Ne;let rd=(Ne=class extends en{loadAsync(){this.exception("This method is not implemented")}showAsync(){this.exception("This method is not implemented")}hideAsync(){this.exception("Unsupported method")}},o(Ne,"AdInstance"),Ne);g.Plugins.Ads={Types:lt,Status:ad,AdError:ce,AdInstance:rd};const ki=class ki extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"enabled");f(this,"config");f(this,"lastCallAdShownTime");f(this,"isAdFullSizeShowed");f(this,"ads",{});f(this,"safeAreaBottom")}init(){this.lastCallAdShownTime=0,this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}calculateSafeAreaBottom(){try{const t=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(t,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(t){this.config=t,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new ce("ADS_NOT_ENABLED","Ads is't enabled")}isAdFullSizeShowing(){return this.isAdFullSizeShowed}setAdInstance(t,s,n){if(this.ads[s]){console.warn(`AdsPlugin: Ad instance with placementId ${s} already exists`);return}this.ads[s]={type:t,placementId:s,interval:null,instance:new n(t,s)}}async preloadInterstitialAdAsync(){await this.loadAdAsync(lt.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new ce("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(lt.INTERSTITIAL)}async preloadRewardedVideoAsync(){await this.loadAdAsync(lt.REWARDED_VIDEO)}async showRewardedVideoAsync(){await this.showAdAsync(lt.REWARDED_VIDEO)}async loadAdAsync(t,s){this.checkEnabled(),await this.getAd(t,s).instance.loadAsync()}async showAdAsync(t,s){this.checkEnabled();const{event:n}=this.game,i=this.getAd(t,s);this.lastCallAdShownTime=window.performance.now()/1e3;try{n.emit(g.Events.AD_SHOWING,{placementId:s}),this.isAdFullSizeShowed=!0,await i.instance.showAsync()}finally{n.emit(g.Events.AD_CLOSED,{placementId:s}),this.isAdFullSizeShowed=!1}}getAdStatus(t,s){return this.checkEnabled(),this.getAd(t,s).instance.getStatus()}getAd(t,s){let n=null;if(s?n=this.getAdByPlacementId(s):n=this.getPriorityAdByType(t),!n)throw new ce("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return n}getAdsByType(t){return Object.values(this.ads).filter(s=>s.type===t)}getAdByPlacementId(t){const s=this.ads[t];return s||null}getPriorityAdByType(t){const s=this.getAdsByType(t);if(!s.length)return null;const n=s.find(i=>i.type===t);return n||null}canbeShowInterstitialAd(t){return this.canbeShowInterstitialAdByTime(t)}canbeShowInterstitialAdByTime(t){try{const s=window.performance.now()/1e3;let n;if(t)n=this.getCommonAdConfig(t);else{const h=this.getPriorityAdByType(lt.INTERSTITIAL);if(!h)return!1;n=this.getCommonAdConfig(h.placementId)}const{SecondsBetweenAds:i,SecondsFirstTime:r}=n,c=s-this.lastCallAdShownTime,l=c>i,d=c>r;return this.lastCallAdShownTime>0?l:d}catch(s){return console.warn("Error while checking canbeShowInterstitialAdByTime",s),!1}}canbeShowBannerAd(t){try{const s=this.getBannerConfig(t),{Platform:n}=s;if(n==="ALL")return!0;const i=GameSDK.getPlatform();return i?i===n:!1}catch(s){return console.warn("Error while checking canbeShowBannerAd",s),!1}}async showBannerAdAsync(t){this.checkEnabled();const s=this.getAd(lt.BANNER,t);if(!this.canbeShowBannerAd(s.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(s.placementId),await s.instance.showAsync();const{event:n}=this.game;n.emit(g.Events.AD_SHOWING,{placementId:t});const i=this.getBannerConfig(s.placementId),{SecondsReload:r}=i;r<=0||(s.interval=setTimeout(()=>{this.showBannerAdAsync(s.placementId)},r*1e3))}async hideBannerAdAsync(t){this.checkEnabled();const s=this.getAd(lt.BANNER,t);this.cleanBannerReloadTimer(s.placementId),await s.instance.hideAsync();const{event:n}=this.game;n.emit(g.Events.AD_CLOSED,{placementId:t})}cleanBannerReloadTimer(t){try{const s=this.getAd(lt.BANNER,t),{interval:n}=s;if(!n)return;clearInterval(n)}catch(s){console.warn("Error while cleaning banner reload timer",s)}}getCommonAdConfig(t){const n=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions].find(i=>i.PlacementId===t);if(!n)throw new Error(`Ad config with placementId ${t} not found`);return n}getBannerConfig(t){const s=this.config.BannerDisplayAdOptions.find(n=>n.PlacementId===t);if(!s)throw new Error(`Banner config with placementId ${t} not found`);return s}getBannerHeight(t,s,n=!0){this.checkEnabled();const i=this.getBannerConfig(t),r=GameSDK.getBannerHeight(i);return n?(r+this.safeAreaBottom)*s:r*s}getSafeAreaBottom(t){return this.safeAreaBottom*t}};o(ki,"AdsPlugin");let sn=ki;var od=(a=>(a.BUTTON_CLICK="button_click",a.SCREEN_OPEN="screen_open",a.LOAD_START="load_start",a.LOAD_COMPLETE="load_complete",a.APP_READY="app_ready",a.PAGE_VIEW="page_view",a.TUTORIAL_BEGIN="tutorial_begin",a.TUTORIAL_STEP="tutorial_step",a.TUTORIAL_COMPLETE="tutorial_complete",a.MATCH_START="match_start",a.MATCH_RESCUE="match_rescue",a.MATCH_END="match_end",a.LEVEL_START="level_start",a.LEVEL_RESCUE="level_rescue",a.LEVEL_END="level_end",a.SHARE="share",a.MESSAGE="message",a.INVITE="invite",a.SHORTCUT_CREATE="shortcut_create",a.SHORTCUT_CREATE_POPUP="shortcut_create_popup",a.BOT_SUBSCRIBE="bot_subscribe",a.BOT_SUBSCRIBE_POPUP="bot_subscribe_popup",a.AD_LOAD="ad_load",a.AD_LOAD_FAILED="ad_load_failed",a.AD_SHOW="ad_show",a.AD_SHOW_FAILED="ad_show_failed",a.AD_REWARD="ad_reward",a.AD_IMPRESSION="ad_impression",a.NEW_USER="new_user",a.JOIN_GROUP="join_group",a.TOURNAMENT_START="tournament_start",a.TOURNAMENT_SHARE="tournament_share",a.TOURNAMENT_CREATE="tournament_create",a.TOURNAMENT_POST_SCORE="tournament_post_score",a.GET_FREE_ITEM="get_free_item",a.USE_ITEM="use_item",a.EARN_ITEM="earn_item",a))(od||{});const H=od,{String:Yc,Valid:Sh}=g.Utils;var Oe;let vh=(Oe=class{constructor(e,t,s){f(this,"game");f(this,"name");f(this,"color");f(this,"options");f(this,"selfLog");f(this,"currentPath");this.game=e,this.name=t,this.options=s,this.color=s.color||"#FFF",this.selfLog=s.log,this.currentPath="/",console.info(`%c${this.name}: init`,`color: ${this.color}`,this.options)}event(e,t){this.logInfo("event",{name:e,payload:t});const s=this.formatEventName(e);this.processEvent(s,t)}logInfo(e,t){this.selfLog&&console.info(`%c${this.name}: ${e}`,`color: ${this.color}`,t)}pageview(e){let t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),console.info("AnalyticsService: Page view",t),document.title=t,this.event(H.PAGE_VIEW,{page_title:t})}levelStart(e,t){this.event(H.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e)})}levelFail(e,t){this.event(H.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e)})}levelRescue(e,t){this.event(H.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e)})}levelComplete(e,t){this.event(H.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e)})}loadAdEvent(e,t){this.event(H.AD_LOAD,{ad_type:e,screen_name:t})}showAdEvent(e,t){this.event(H.AD_SHOW,{ad_type:e,screen_name:t}),this.event(H.AD_IMPRESSION,{ad_format:e})}loadInterstitialAd(e){this.loadAdEvent("interstitial",e)}showInterstitialAd(e){this.showAdEvent("interstitial",e)}loadRewardedVideoAd(e){this.loadAdEvent("rewarded_video",e)}showRewardedVideoAd(e){this.showAdEvent("rewarded_video",e)}receiveVideoReward(e){this.event(H.AD_REWARD,{screen_name:e})}loadAdFail(e,t){this.event(H.AD_LOAD_FAILED,{ad_type:e,screen_name:t})}showAdFail(e,t){this.event(H.AD_SHOW_FAILED,{ad_type:e,screen_name:t})}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}getLevelName(e){return`Level ${e}`}getPageTitle(e){const t=e.split("/").pop();if(!Sh.isString(t))return e;const s=t.replace(/([-_\s.])/g," $1");return Yc.toUpperCamelCase(s)}addGameModeToPageTitle(e){const{match:t}=this.game,s=t.getMatchState();let{mode:n}=s;return n||(n="Normal"),`${Yc.toUpperCamelCase(n)}::${e}`}},o(Oe,"BaseAnalytics"),Oe);g.Plugins.Analytics={Events:H,BaseAnalytics:vh};const Bi=class Bi extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"analytics",[]);f(this,"placement","unknown");f(this,"pageview",o(t=>{if(!this.isActive())return;this.placement=t;const s=this.getPageByKey(t);this.analytics.forEach(n=>{n.pageview(s)})},"pageview"))}add(t){this.analytics.some(n=>n.name===t.name)||this.analytics.push(t)}isActive(){return this.analytics.length>=1}event(t,s){this.isActive()&&this.analytics.forEach(n=>{n.event(t,s)})}levelStart(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelStart(t,s)})}levelRescue(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelRescue(t,s)})}levelFail(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelFail(t,s)})}levelComplete(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelComplete(t,s)})}loadInterstitialAd(){this.isActive()&&this.analytics.forEach(t=>{t.loadInterstitialAd(this.placement)})}showInterstitialAd(){this.isActive()&&this.analytics.forEach(t=>{t.showInterstitialAd(this.placement)})}loadRewardedVideoAd(){this.isActive()&&this.analytics.forEach(t=>{t.loadRewardedVideoAd(this.placement)})}showRewardedVideoAd(){this.isActive()&&this.analytics.forEach(t=>{t.showRewardedVideoAd(this.placement)})}receiveVideoReward(){this.isActive()&&this.analytics.forEach(t=>{t.receiveVideoReward(this.placement)})}loadAdFail(t){this.isActive()&&this.analytics.forEach(s=>{s.loadAdFail(t,this.placement)})}showAdFail(t){this.isActive()&&this.analytics.forEach(s=>{s.showAdFail(t,this.placement)})}getPageByKey(t){if(t.includes("_")){let s=t.replace(/_/g,"-");return s=s.toLowerCase(),s}else{let s=t.length-1,n="";for(;s>0;){n=t.charAt(s);const i=isNaN(parseInt(n,10)),r=n===n.toUpperCase();i&&r&&(t=`${t.slice(0,s)}-${t.slice(s)}`),s--}return t.toLowerCase()}}};o(Bi,"AnalyticsPlugin");let nn=Bi;const Vi=class Vi{constructor(e){f(this,"key");this.key=e}getKey(){return this.key}};o(Vi,"BaseAudioPlayer");let an=Vi;const Gi=class Gi{constructor(e){f(this,"id");f(this,"isMuteAll");f(this,"masterVolume");f(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}setAudioClip(e,t){this.audioClips[e]={...this.audioClips[e],...t}}play(e,t){const s=this.getAudioClip(e);if(s){const{audioPlayer:n}=s;this.playWithRealConfig(n,t)}else this.loadAndPlay(e,t)}async loadAndPlay(e,t){try{const s=await this.onLoadAudio(e,t),{volume:n=1}=t||{};this.setAudioClip(e,{volume:n,audioPlayer:s}),this.playWithRealConfig(s,t)}catch(s){console.warn("playAudio",s)}}playWithRealConfig(e,t){if(t){const{volume:s=1}=t;t.volume=this.masterVolume*s}e.play(t)}pause(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.pause(),!0}resume(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.resume(),!0}stop(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(e,t){try{const{audioPlayer:s,volume:n=1}=e;switch(t){case"play":s.play();break;case"pause":s.pause();break;case"resume":s.resume();break;case"stop":s.stop();break;case"mute":s.setVolume(0);break;case"unmute":case"setVolume":s.setVolume(this.masterVolume*n);break;default:throw new Error(`Unsupported function: ${t}`)}}catch(s){console.warn("queueAudioPlayer",s)}}callAudioPlayers(e){Object.values(this.audioClips).forEach(s=>{this.queueAudioPlayer(s,e)})}};o(Gi,"BaseChannelManager");let rn=Gi;g.Plugins.Audio={BaseAudioPlayer:an,BaseChannelManager:rn};const ji=class ji extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"firstChannelId");f(this,"channels",{})}addChannel(t){const s=t.getId();this.channels[s]=t,this.firstChannelId||(this.firstChannelId=s)}getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];const s=this.channels[t];if(!s)throw new Error(`Channel ${t} not found`);return s}play(t,s,n){try{this.getChannel(n).play(t,s)}catch(i){console.warn("playSound",i)}}pause(t,s){try{this.getChannel(s).pause(t)}catch(n){console.warn("pauseSound",n)}}resume(t,s){try{this.getChannel(s).resume(t)}catch(n){console.warn("resumeSound",n)}}stop(t,s){try{this.getChannel(s).stop(t)}catch(n){console.warn("stopSound",n)}}stopAll(t){try{this.getChannel(t).stopAll()}catch(s){console.warn("stopAllSounds",s)}}mute(t){try{this.getChannel(t).muteAll()}catch(s){console.warn("mute",s)}}unmute(t){try{this.getChannel(t).unmuteAll()}catch(s){console.warn("unmute",s)}}setVolume(t,s){try{this.getChannel(s).setVolume(t)}catch(n){console.warn("setSoundVolume",n)}}};o(ji,"AudioPlugin");let on=ji;const Ph={token:"",isRequesting:!1},zi=class zi extends N.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("auth",Ph)}async requestToken(){const{storage:e}=this.game;try{if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return;e.setStorageData("auth","isRequesting",!0);const i=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();e.setStorageData("auth","token",i)}catch(t){if(g.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;e.setStorageData("auth","token",""),console.error(t)}finally{e.setStorageData("auth","isRequesting",!1)}}getToken(){const{storage:e}=this.game;return e.getStorageData("auth","token")}};o(zi,"AuthPlugin");let cn=zi;var cd=(a=>(a.SOLO="solo",a.TOURNAMENT="tournament",a.SHARE_INVITE="share_invite",a.MATCHING_GROUP="matching_group_match",a.CHALLENGE_FRIEND="challenge_friend_match",a))(cd||{});const pe=cd,Tt=uh,Ki=class Ki{constructor(e){f(this,"game");this.game=e}isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}isValidEntryPointData(e){return g.Utils.Valid.isObject(e)}isTournamentEntryPoint(e){return["facebook~game_list~tournaments","fb_feed_tournament_unit"].indexOf(e)>=0}receiveContext(e,t,s){const{storage:n}=this.game;n.setStorageData("context","contextId",e),this.isValidEntryPointData(s)?n.setStorageData("context","entryPointData",s):console.warn(`Invalid context type: ${t}`),this.isValidContextType(t)?n.setStorageData("context","contextType",t):console.warn(`Invalid context type: ${t}`)}async detectContextSessionType(){var h;const{storage:e}=this.game,t=e.getStorageData("context","entryPointData"),{type:s}=t,{SOLO:n,TOURNAMENT:i,MATCHING_GROUP:r,SHARE_INVITE:c,CHALLENGE_FRIEND:l}=pe;let d=n;if(s===i&&(d=i),s===r&&(d=r),(s===l||s===c)&&(d=l),d===n){let u=null;try{u=new URLSearchParams(window.location.search).get("entry_point")}catch{u=((h=window.location.search.substring(1).split("&").find(A=>A.startsWith("entry_point=")))==null?void 0:h.split("=")[1])||null}if(u)d=this.isTournamentEntryPoint(u)?i:n;else try{if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");await GameSDK.getTournamentAsync(),d=i}catch{}}e.setStorageData("context","sessionContextType",d)}detectContextGameMode(){const{player:e,storage:t}=this.game,s=t.getStorageData("context","entryPointData"),n=t.getStorageData("context","sessionContextType"),i=e.getPlayerId(),{matchId:r,playerId:c,opponentId:l=ht.playerId}=s,d=i===c,u=l===ht.playerId||[l,c].indexOf(i)>=0,{TOURNAMENT:p,MATCHING_GROUP:y,SHARE_INVITE:w,CHALLENGE_FRIEND:A}=pe;let m=Tt.SINGLE;n===p&&(m=Tt.TOURNAMENT),n===w&&!d&&(m=Tt.CHALLENGE_FRIEND),n===A&&r&&u&&(m=Tt.CHALLENGE_FRIEND),n===y&&(m=Tt.MATCHING_GROUP),t.setStorageData("context","contextGameMode",m)}};o(Ki,"Context");let ln=Ki;const Wi=class Wi extends Error{constructor(e){super(e),this.name="PlayerHasFinishedMatch",this.message=e??"Player has finished match"}};o(Wi,"PlayerHasFinishedMatch");let Qe=Wi;const Hi=class Hi extends Error{constructor(e){super(e),this.name="PlayerNotJoinInMatch",this.message=e||"Player is not join in match"}};o(Hi,"PlayerNotJoinInMatch");let ge=Hi;const{Events:Ms,Plugins:Ch}=g,{Analytics:Th}=Ch,qi=class qi{constructor(e){f(this,"game");this.game=e}async processContextData(){const{player:e,analytics:t,storage:s}=this.game,n=s.getStorageData("context","contextId"),i=s.getStorageData("context","entryPointData"),r=s.getStorageData("context","sessionContextType"),{type:c,matchId:l,playerId:d,opponentId:h,playerScore:u}=i||{};console.info("isFirstLogin",e.isFirstLogin()),e.isFirstLogin()&&t.event(Th.Events.NEW_USER);const{TOURNAMENT:p,SHARE_INVITE:y,MATCHING_GROUP:w,CHALLENGE_FRIEND:A}=pe;if(r===p){try{await this.processTournamentModeAsync()}catch{await this.processSingleModeAsync()}return}if(r===A){if(c===y&&typeof d=="string"){await this.processChallengeFromPostAsync(d);return}if(c===A&&typeof l=="string"&&typeof d=="string"&&typeof h=="string"){await this.processChallengeFromMessageAsync({contextId:n,matchId:l,playerId:d,opponentId:h});return}}if(r===w&&typeof d=="string"&&typeof u=="number"){await this.processMatchingGroupModeAsync(d,u);return}if(e.isFirstLogin()){await this.processSingleModeAsync(),e.loggedIn();return}this.switchToDashboardScene()}async processTournamentModeAsync(){const{match:e,player:t}=this.game,s=t.getPlayerId(),n=GameSDK.context.getID();if(typeof n!="string")throw new Error("Cannot get contextId");await e.tournament.continue.processAsync({playerId:s,contextId:n}),this.switchToGameScene()}async processChallengeFromPostAsync(e){const{match:t,player:s}=this.game,n=s.getPlayerId();if(n===e)await t.single.start.processAsync({playerId:n});else try{await t.challenge.friend.processAsync({playerId:n,opponentId:e})}catch(r){console.warn("processChallengeFromPostAsync",r),await t.single.start.processAsync({playerId:n})}this.switchToGameScene()}async processChallengeFromMessageAsync(e){try{await this.processContinueChallengeFromMessageAsync(e)}catch(t){if(console.warn("processContinueChallengeFromMessageAsync",t),t instanceof Qe){await this.processAwaitChallengeFromMessageAsync(e);return}if(t instanceof ge){await this.processJoinChallengeFromMessageAsync(e);return}this.switchToDashboardScene()}}async processContinueChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:n,opponentId:i}=e,{match:r,player:c}=this.game,l=c.getPlayerId();if(n===l)await r.challenge.continue.processAsync({contextId:t,matchId:s,playerId:l,opponentId:i});else{const h=i===ht.playerId;await r.challenge.continue.processAsync({contextId:t,matchId:s,playerId:l,opponentId:h?i:n})}this.switchToGameScene()}async processJoinChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:n}=e,{match:i,player:r}=this.game,c=r.getPlayerId();await i.challenge.join.processAsync({contextId:t,matchId:s,playerId:c,opponentId:n}),this.switchToGameScene()}async processAwaitChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:n}=e,{match:i,player:r}=this.game,c=r.getPlayerId();try{await i.challenge.await.processAsync({contextId:t,matchId:s,playerId:c,opponentId:n}),this.switchToChallengeResultScene()}catch(l){console.warn("processAwaitChallengeFromMessageAsync",l),await this.processResultChallengeFromMessageAsync(e)}}async processResultChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:n}=e,{match:i,player:r}=this.game,c=r.getPlayerId();try{await i.challenge.result.processAsync({contextId:t,matchId:s,playerId:c,opponentId:n}),this.switchToChallengeResultScene()}catch{this.switchToDashboardScene()}}async processMatchingGroupModeAsync(e,t){const{match:s,player:n}=this.game;await s.group.join.processAsync({playerId:n.getPlayerId(),opponentId:e,opponentScore:t}),this.switchToGameScene()}async processSingleModeAsync(){const{match:e,player:t}=this.game,s=t.getPlayerId();await e.single.start.processAsync({playerId:s}),this.switchToGameScene()}switchToDashboardScene(){const{event:e}=this.game;e.emit(Ms.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isMatchStartFromLoader:!0}})}switchToGameScene(){const{event:e}=this.game;e.emit(Ms.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isMatchStartFromLoader:!0}})}switchToChallengeResultScene(){const{event:e}=this.game;e.emit(Ms.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isMatchStartFromLoader:!0}})}};o(qi,"Loader");let dn=qi;const ld={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},{Events:_h}=g,Yi=class Yi extends N.Plugins.BasePlugin{constructor(t){super(t);f(this,"context");f(this,"loader");this.loader=new dn(t),this.context=new ln(t)}init(){const{storage:t}=this.game;t.addStorage("context",ld)}getSessionContextTypes(){return pe}async processContextData(){try{await this.loader.processContextData()}catch(t){console.error("processContextData",t),this.switchToDashboardScene()}}async detectContextSessionType(){try{await this.context.detectContextSessionType()}catch(t){console.error("detectContextSessionType",t)}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(t,s,n){this.context.receiveContext(t,s,n)}switchToDashboardScene(){const{event:t}=this.game;t.emit(_h.SWITCH_SCENE,{sceneName:"DashboardScene"})}};o(Yi,"ContextPlugin");let hn=Yi;const{Valid:Rs}=g.Utils,{contextId:xh,contextType:Nh,entryPointData:Oh}=ld,Ls="is invalid",Xi=class Xi extends L{constructor(){super(...arguments);f(this,"data")}setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateContextId(t){Rs.isString(t)||this.exception("contextId",Ls)}validateContextType(t){(!Rs.isString(t)||!t)&&this.exception("contextType",Ls)}validateEntryPointData(t){Rs.isObject(t)||this.exception("entryPointData",Ls)}toObject(){return super.toObject()}};o(Xi,"ContextInfoDtos");let Ze=Xi;Ze.addDefaultData({contextId:xh,contextType:Nh,entryPointData:Oh});g.Dtos.Context={Info:Ze};const Mh={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},Ji=class Ji{async getDailyRewardsAsync(){return Object.values(Mh)}};o(Ji,"DailyRewardsAPI");let un=Ji;const re={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},Rh={dailyRewards:{}},Xc=g.Configs.DailyRewards,Qi=class Qi extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"dailyRewardsApi",new un)}init(){const{storage:t}=this.game;t.addStorage("dailyRewards",Rh)}async requestDailyRewardsAsync(){const t=await this.dailyRewardsApi.getDailyRewardsAsync();t.length!==0&&this.receiveDailyRewards(t)}getDailyRewards(){const{storage:t}=this.game,s=t.getStorageData("dailyRewards","dailyRewards");return s||null}logLoginReward(){const{player:t}=this.game,{logDays:s}=t.getPlayerData().dailyRewarded,n=[...s];n[n.length-1]=!0,this.logDailyRewards(n)}logDailyRewards(t,s=!1){const{player:n}=this.game;n.setPlayerDataByName("dailyRewarded",{logDays:t,lastRewarded:s?0:Date.now()})}receiveDailyRewards(t){const{player:s}=this.game,{logDays:n,lastRewarded:i}=s.getPlayerData().dailyRewarded,r=new Date,c=new Date(i),l=new Date(c.toDateString()),d=Math.abs(r.valueOf()-l.valueOf()),u=Math.floor(d/864e5)>1,y=Xc.CheckInterrupt&&u||n.length>=Xc.MaxDays,w=y?[!1]:[...n,!1];this.logDailyRewards(w);const A=t.map((m,E)=>{const k=E<w.length,S=w.length===E+1,_s=w[E]===!1;let Z=re.WAITING;return S?Z=re.READY:y?Z=re.WAITING:k&&_s?Z=re.SKIPPED:k&&(Z=re.REWARDED),{...m,status:Z}});this.setDailyRewards(A)}setDailyRewards(t){const{storage:s}=this.game;s.setStorageData("dailyRewards","dailyRewards",t)}};o(Qi,"DailyRewardsPlugin");let fn=Qi;var wi={exports:{}};wi.exports;(function(a){var e=Object.prototype.hasOwnProperty,t="~";function s(){}o(s,"Events"),Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(l,d,h){this.fn=l,this.context=d,this.once=h||!1}o(n,"EE");function i(l,d,h,u,p){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new n(h,u||l,p),w=t?t+d:d;return l._events[w]?l._events[w].fn?l._events[w]=[l._events[w],y]:l._events[w].push(y):(l._events[w]=y,l._eventsCount++),l}o(i,"addListener");function r(l,d){--l._eventsCount===0?l._events=new s:delete l._events[d]}o(r,"clearEvent");function c(){this._events=new s,this._eventsCount=0}o(c,"EventEmitter"),c.prototype.eventNames=o(function(){var d=[],h,u;if(this._eventsCount===0)return d;for(u in h=this._events)e.call(h,u)&&d.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(h)):d},"eventNames"),c.prototype.listeners=o(function(d){var h=t?t+d:d,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var p=0,y=u.length,w=new Array(y);p<y;p++)w[p]=u[p].fn;return w},"listeners"),c.prototype.listenerCount=o(function(d){var h=t?t+d:d,u=this._events[h];return u?u.fn?1:u.length:0},"listenerCount"),c.prototype.emit=o(function(d,h,u,p,y,w){var A=t?t+d:d;if(!this._events[A])return!1;var m=this._events[A],E=arguments.length,k,S;if(m.fn){switch(m.once&&this.removeListener(d,m.fn,void 0,!0),E){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,u),!0;case 4:return m.fn.call(m.context,h,u,p),!0;case 5:return m.fn.call(m.context,h,u,p,y),!0;case 6:return m.fn.call(m.context,h,u,p,y,w),!0}for(S=1,k=new Array(E-1);S<E;S++)k[S-1]=arguments[S];m.fn.apply(m.context,k)}else{var _s=m.length,Z;for(S=0;S<_s;S++)switch(m[S].once&&this.removeListener(d,m[S].fn,void 0,!0),E){case 1:m[S].fn.call(m[S].context);break;case 2:m[S].fn.call(m[S].context,h);break;case 3:m[S].fn.call(m[S].context,h,u);break;case 4:m[S].fn.call(m[S].context,h,u,p);break;default:if(!k)for(Z=1,k=new Array(E-1);Z<E;Z++)k[Z-1]=arguments[Z];m[S].fn.apply(m[S].context,k)}}return!0},"emit"),c.prototype.on=o(function(d,h,u){return i(this,d,h,u,!1)},"on"),c.prototype.once=o(function(d,h,u){return i(this,d,h,u,!0)},"once"),c.prototype.removeListener=o(function(d,h,u,p){var y=t?t+d:d;if(!this._events[y])return this;if(!h)return r(this,y),this;var w=this._events[y];if(w.fn)w.fn===h&&(!p||w.once)&&(!u||w.context===u)&&r(this,y);else{for(var A=0,m=[],E=w.length;A<E;A++)(w[A].fn!==h||p&&!w[A].once||u&&w[A].context!==u)&&m.push(w[A]);m.length?this._events[y]=m.length===1?m[0]:m:r(this,y)}return this},"removeListener"),c.prototype.removeAllListeners=o(function(d){var h;return d?(h=t?t+d:d,this._events[h]&&r(this,h)):(this._events=new s,this._eventsCount=0),this},"removeAllListeners"),c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,a.exports=c})(wi);var Lh=wi.exports;const $h=fh(Lh),gt=new $h,Fh={names:[],history:[]},Zi=class Zi extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"enableLog",!1);f(this,"muteEvents",[])}init(){const{storage:t}=this.game;t.addStorage("event",Fh)}enableLogEvent(){this.enableLog=!0}on(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"on","listening"),gt.on(t,s)}once(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"once","listening"),gt.once(t,s)}off(t,s){this.validateCallback(s),gt.off(t,s),this.addHistory(t,"any","removed")}mute(t){this.muteEvents.includes(t)||this.muteEvents.push(t)}clear(t){gt.removeAllListeners(t),this.addHistory(t,"any","removed")}emit(t,s){if(this.muteEvents.includes(t))return;let n=[];s&&(n=[s]),this.addHistory(t,"any","called",s),gt.emit(t,...n)}validateCallback(t){if(typeof t!="function")throw new Error("Callback must be a function")}addEventName(t){const{storage:s}=this.game,n=s.getStorageData("event","names");n.includes(t)||n.push(t)}getEventListeners(){const t=gt.eventNames();return Object.keys(t)}getHistory(){const{storage:t}=this.game;return t.getStorageData("event","history")}getEventEmitCount(t){return this.getHistory().filter(n=>n.name===t&&n.status==="called").length}getLastEventInfo(t){return this.getHistory().findLast(n=>n.name===t)??null}getTypeFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.type)??null}getCallsFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.called)??0}addHistory(t,s,n,i){const c=this.getTypeFromHistory(t)??s,l=this.getCallsFromHistory(t),d=n==="called"?l+1:l;this.getHistory().push({type:c,status:n,name:t,called:d,payload:i??{}}),this.logEventInfo(t,c,n,d)}logEventInfo(t,s,n,i){if(this.enableLog){if(n==="listening"){console.info(`Event (${s}) ${t}: ${n}`);const r=gt.listenerCount(t);r>1&&console.warn(`Event ${t} has ${r} listener`)}else s!=="any"&&console.info(`Event (${s}) ${t}: ${n} (${i} times)`);n==="called"&&gt.listenerCount(t)<=0&&console.warn(`Event ${t} is called but not listening`)}}};o(Zi,"EventPlugin");let pn=Zi;var Jc={};const dd=o(function(a){const e=[];let t=0;for(let s=0;s<a.length;s++){let n=a.charCodeAt(s);n<128?e[t++]=n:n<2048?(e[t++]=n>>6|192,e[t++]=n&63|128):(n&64512)===55296&&s+1<a.length&&(a.charCodeAt(s+1)&64512)===56320?(n=65536+((n&1023)<<10)+(a.charCodeAt(++s)&1023),e[t++]=n>>18|240,e[t++]=n>>12&63|128,e[t++]=n>>6&63|128,e[t++]=n&63|128):(e[t++]=n>>12|224,e[t++]=n>>6&63|128,e[t++]=n&63|128)}return e},"stringToByteArray$1"),Uh=o(function(a){const e=[];let t=0,s=0;for(;t<a.length;){const n=a[t++];if(n<128)e[s++]=String.fromCharCode(n);else if(n>191&&n<224){const i=a[t++];e[s++]=String.fromCharCode((n&31)<<6|i&63)}else if(n>239&&n<365){const i=a[t++],r=a[t++],c=a[t++],l=((n&7)<<18|(i&63)<<12|(r&63)<<6|c&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=a[t++],r=a[t++];e[s++]=String.fromCharCode((n&15)<<12|(i&63)<<6|r&63)}}return e.join("")},"byteArrayToString"),hd={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(a,e){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let n=0;n<a.length;n+=3){const i=a[n],r=n+1<a.length,c=r?a[n+1]:0,l=n+2<a.length,d=l?a[n+2]:0,h=i>>2,u=(i&3)<<4|c>>4;let p=(c&15)<<2|d>>6,y=d&63;l||(y=64,r||(p=64)),s.push(t[h],t[u],t[p],t[y])}return s.join("")},encodeString(a,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(a):this.encodeByteArray(dd(a),e)},decodeString(a,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(a):Uh(this.decodeStringToByteArray(a,e))},decodeStringToByteArray(a,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let n=0;n<a.length;){const i=t[a.charAt(n++)],c=n<a.length?t[a.charAt(n)]:0;++n;const d=n<a.length?t[a.charAt(n)]:64;++n;const u=n<a.length?t[a.charAt(n)]:64;if(++n,i==null||c==null||d==null||u==null)throw new gn;const p=i<<2|c>>4;if(s.push(p),d!==64){const y=c<<4&240|d>>2;if(s.push(y),u!==64){const w=d<<6&192|u;s.push(w)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}},tr=class tr extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}};o(tr,"DecodeBase64StringError");let gn=tr;const kh=o(function(a){const e=dd(a);return hd.encodeByteArray(e,!0)},"base64Encode"),ud=o(function(a){return kh(a).replace(/\./g,"")},"base64urlEncodeWithoutPadding"),Bh=o(function(a){try{return hd.decodeString(a,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},"base64Decode");function Vh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}o(Vh,"getGlobal");const Gh=o(()=>Vh().__FIREBASE_DEFAULTS__,"getDefaultsFromGlobal"),jh=o(()=>{if(typeof process>"u"||typeof Jc>"u")return;const a=Jc.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)},"getDefaultsFromEnvVariable"),zh=o(()=>{if(typeof document>"u")return;let a;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=a&&Bh(a[1]);return e&&JSON.parse(e)},"getDefaultsFromCookie"),Kh=o(()=>{try{return Gh()||jh()||zh()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},"getDefaults"),fd=o(()=>{var a;return(a=Kh())===null||a===void 0?void 0:a.config},"getDefaultAppConfig");const er=class er{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}};o(er,"Deferred");let yn=er;function Wh(){const a=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof a=="object"&&a.id!==void 0}o(Wh,"isBrowserExtension");function Ss(){try{return typeof indexedDB=="object"}catch{return!1}}o(Ss,"isIndexedDBAvailable");function Ai(){return new Promise((a,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(s);n.onsuccess=()=>{n.result.close(),t||self.indexedDB.deleteDatabase(s),a(!0)},n.onupgradeneeded=()=>{t=!1},n.onerror=()=>{var i;e(((i=n.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}o(Ai,"validateIndexedDBOpenable");function pd(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}o(pd,"areCookiesEnabled");const Hh="FirebaseError",bs=class bs extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=Hh,Object.setPrototypeOf(this,bs.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,bt.prototype.create)}};o(bs,"FirebaseError");let ut=bs;const sr=class sr{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],r=i?qh(i,s):"Error",c=`${this.serviceName}: ${r} (${n}).`;return new ut(n,c,s)}};o(sr,"ErrorFactory");let bt=sr;function qh(a,e){return a.replace(Yh,(t,s)=>{const n=e[s];return n!=null?String(n):`<${s}?>`})}o(qh,"replaceTemplate");const Yh=/\{\$([^}]+)}/g;function ts(a,e){if(a===e)return!0;const t=Object.keys(a),s=Object.keys(e);for(const n of t){if(!s.includes(n))return!1;const i=a[n],r=e[n];if(Qc(i)&&Qc(r)){if(!ts(i,r))return!1}else if(i!==r)return!1}for(const n of s)if(!t.includes(n))return!1;return!0}o(ts,"deepEqual");function Qc(a){return a!==null&&typeof a=="object"}o(Qc,"isObject");const Xh=1e3,Jh=2,Qh=4*60*60*1e3,Zh=.5;function mn(a,e=Xh,t=Jh){const s=e*Math.pow(t,a),n=Math.round(Zh*s*(Math.random()-.5)*2);return Math.min(Qh,s+n)}o(mn,"calculateBackoffMillis");function W(a){return a&&a._delegate?a._delegate:a}o(W,"getModularInstance");const nr=class nr{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};o(nr,"Component");let Y=nr;const Pt="[DEFAULT]";const ar=class ar{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new yn;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&s.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),n=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(i){if(n)return null;throw i}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(eu(e))try{this.getOrInitializeService({instanceIdentifier:Pt})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:n});s.resolve(i)}catch{}}}}clearInstance(e=Pt){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Pt){return this.instances.has(e)}getOptions(e=Pt){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,r]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);s===c&&r.resolve(n)}return n}onInit(e,t){var s;const n=this.normalizeInstanceIdentifier(t),i=(s=this.onInitCallbacks.get(n))!==null&&s!==void 0?s:new Set;i.add(e),this.onInitCallbacks.set(n,i);const r=this.instances.get(n);return r&&e(r,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const n of s)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:tu(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Pt){return this.component?this.component.multipleInstances?e:Pt:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};o(ar,"Provider");let wn=ar;function tu(a){return a===Pt?void 0:a}o(tu,"normalizeIdentifierForFactory");function eu(a){return a.instantiationMode==="EAGER"}o(eu,"isComponentEager");const ir=class ir{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new wn(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};o(ir,"ComponentContainer");let An=ir;var b;(function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"})(b||(b={}));const su={debug:b.DEBUG,verbose:b.VERBOSE,info:b.INFO,warn:b.WARN,error:b.ERROR,silent:b.SILENT},nu=b.INFO,au={[b.DEBUG]:"log",[b.VERBOSE]:"log",[b.INFO]:"info",[b.WARN]:"warn",[b.ERROR]:"error"},iu=o((a,e,...t)=>{if(e<a.logLevel)return;const s=new Date().toISOString(),n=au[e];if(n)console[n](`[${s}]  ${a.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},"defaultLogHandler"),rr=class rr{constructor(e){this.name=e,this._logLevel=nu,this._logHandler=iu,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in b))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?su[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,b.DEBUG,...e),this._logHandler(this,b.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,b.VERBOSE,...e),this._logHandler(this,b.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,b.INFO,...e),this._logHandler(this,b.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,b.WARN,...e),this._logHandler(this,b.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,b.ERROR,...e),this._logHandler(this,b.ERROR,...e)}};o(rr,"Logger");let Yt=rr;const ru=o((a,e)=>e.some(t=>a instanceof t),"instanceOfAny");let Zc,tl;function ou(){return Zc||(Zc=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}o(ou,"getIdbProxyableTypes");function cu(){return tl||(tl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}o(cu,"getCursorAdvanceMethods");const gd=new WeakMap,In=new WeakMap,yd=new WeakMap,$s=new WeakMap,Ii=new WeakMap;function lu(a){const e=new Promise((t,s)=>{const n=o(()=>{a.removeEventListener("success",i),a.removeEventListener("error",r)},"unlisten"),i=o(()=>{t(wt(a.result)),n()},"success"),r=o(()=>{s(a.error),n()},"error");a.addEventListener("success",i),a.addEventListener("error",r)});return e.then(t=>{t instanceof IDBCursor&&gd.set(t,a)}).catch(()=>{}),Ii.set(e,a),e}o(lu,"promisifyRequest");function du(a){if(In.has(a))return;const e=new Promise((t,s)=>{const n=o(()=>{a.removeEventListener("complete",i),a.removeEventListener("error",r),a.removeEventListener("abort",r)},"unlisten"),i=o(()=>{t(),n()},"complete"),r=o(()=>{s(a.error||new DOMException("AbortError","AbortError")),n()},"error");a.addEventListener("complete",i),a.addEventListener("error",r),a.addEventListener("abort",r)});In.set(a,e)}o(du,"cacheDonePromiseForTransaction");let bn={get(a,e,t){if(a instanceof IDBTransaction){if(e==="done")return In.get(a);if(e==="objectStoreNames")return a.objectStoreNames||yd.get(a);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return wt(a[e])},set(a,e,t){return a[e]=t,!0},has(a,e){return a instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in a}};function hu(a){bn=a(bn)}o(hu,"replaceTraps");function uu(a){return a===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=a.call(Fs(this),e,...t);return yd.set(s,e.sort?e.sort():[e]),wt(s)}:cu().includes(a)?function(...e){return a.apply(Fs(this),e),wt(gd.get(this))}:function(...e){return wt(a.apply(Fs(this),e))}}o(uu,"wrapFunction");function fu(a){return typeof a=="function"?uu(a):(a instanceof IDBTransaction&&du(a),ru(a,ou())?new Proxy(a,bn):a)}o(fu,"transformCachableValue");function wt(a){if(a instanceof IDBRequest)return lu(a);if($s.has(a))return $s.get(a);const e=fu(a);return e!==a&&($s.set(a,e),Ii.set(e,a)),e}o(wt,"wrap");const Fs=o(a=>Ii.get(a),"unwrap");function md(a,e,{blocked:t,upgrade:s,blocking:n,terminated:i}={}){const r=indexedDB.open(a,e),c=wt(r);return s&&r.addEventListener("upgradeneeded",l=>{s(wt(r.result),l.oldVersion,l.newVersion,wt(r.transaction),l)}),t&&r.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{i&&l.addEventListener("close",()=>i()),n&&l.addEventListener("versionchange",d=>n(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}o(md,"openDB");const pu=["get","getKey","getAll","getAllKeys","count"],gu=["put","add","delete","clear"],Us=new Map;function el(a,e){if(!(a instanceof IDBDatabase&&!(e in a)&&typeof e=="string"))return;if(Us.get(e))return Us.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,n=gu.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(n||pu.includes(t)))return;const i=o(async function(r,...c){const l=this.transaction(r,n?"readwrite":"readonly");let d=l.store;return s&&(d=d.index(c.shift())),(await Promise.all([d[t](...c),n&&l.done]))[0]},"method");return Us.set(e,i),i}o(el,"getMethod");hu(a=>({...a,get:(e,t,s)=>el(e,t)||a.get(e,t,s),has:(e,t)=>!!el(e,t)||a.has(e,t)}));const or=class or{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(yu(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}};o(or,"PlatformLoggerServiceImpl");let En=or;function yu(a){const e=a.getComponent();return(e==null?void 0:e.type)==="VERSION"}o(yu,"isVersionServiceProvider");const Dn="@firebase/app",sl="0.9.27";const Mt=new Yt("@firebase/app"),mu="@firebase/app-compat",wu="@firebase/analytics-compat",Au="@firebase/analytics",Iu="@firebase/app-check-compat",bu="@firebase/app-check",Eu="@firebase/auth",Du="@firebase/auth-compat",Su="@firebase/database",vu="@firebase/database-compat",Pu="@firebase/functions",Cu="@firebase/functions-compat",Tu="@firebase/installations",_u="@firebase/installations-compat",xu="@firebase/messaging",Nu="@firebase/messaging-compat",Ou="@firebase/performance",Mu="@firebase/performance-compat",Ru="@firebase/remote-config",Lu="@firebase/remote-config-compat",$u="@firebase/storage",Fu="@firebase/storage-compat",Uu="@firebase/firestore",ku="@firebase/firestore-compat",Bu="firebase",Vu="10.8.0";const Sn="[DEFAULT]",Gu={[Dn]:"fire-core",[mu]:"fire-core-compat",[Au]:"fire-analytics",[wu]:"fire-analytics-compat",[bu]:"fire-app-check",[Iu]:"fire-app-check-compat",[Eu]:"fire-auth",[Du]:"fire-auth-compat",[Su]:"fire-rtdb",[vu]:"fire-rtdb-compat",[Pu]:"fire-fn",[Cu]:"fire-fn-compat",[Tu]:"fire-iid",[_u]:"fire-iid-compat",[xu]:"fire-fcm",[Nu]:"fire-fcm-compat",[Ou]:"fire-perf",[Mu]:"fire-perf-compat",[Ru]:"fire-rc",[Lu]:"fire-rc-compat",[$u]:"fire-gcs",[Fu]:"fire-gcs-compat",[Uu]:"fire-fst",[ku]:"fire-fst-compat","fire-js":"fire-js",[Bu]:"fire-js-all"};const es=new Map,vn=new Map;function ju(a,e){try{a.container.addComponent(e)}catch(t){Mt.debug(`Component ${e.name} failed to register with FirebaseApp ${a.name}`,t)}}o(ju,"_addComponent");function ft(a){const e=a.name;if(vn.has(e))return Mt.debug(`There were multiple attempts to register component ${e}.`),!1;vn.set(e,a);for(const t of es.values())ju(t,a);return!0}o(ft,"_registerComponent");function se(a,e){const t=a.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),a.container.getProvider(e)}o(se,"_getProvider");const zu={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},At=new bt("app","Firebase",zu);const cr=class cr{constructor(e,t,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new Y("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw At.create("app-deleted",{appName:this._name})}};o(cr,"FirebaseAppImpl");let Pn=cr;const Ku=Vu;function wd(a,e={}){let t=a;typeof e!="object"&&(e={name:e});const s=Object.assign({name:Sn,automaticDataCollectionEnabled:!1},e),n=s.name;if(typeof n!="string"||!n)throw At.create("bad-app-name",{appName:String(n)});if(t||(t=fd()),!t)throw At.create("no-options");const i=es.get(n);if(i){if(ts(t,i.options)&&ts(s,i.config))return i;throw At.create("duplicate-app",{appName:n})}const r=new An(n);for(const l of vn.values())r.addComponent(l);const c=new Pn(t,s,r);return es.set(n,c),c}o(wd,"initializeApp");function bi(a=Sn){const e=es.get(a);if(!e&&a===Sn&&fd())return wd();if(!e)throw At.create("no-app",{appName:a});return e}o(bi,"getApp");function q(a,e,t){var s;let n=(s=Gu[a])!==null&&s!==void 0?s:a;t&&(n+=`-${t}`);const i=n.match(/\s|\//),r=e.match(/\s|\//);if(i||r){const c=[`Unable to register library "${n}" with version "${e}":`];i&&c.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&r&&c.push("and"),r&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Mt.warn(c.join(" "));return}ft(new Y(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}o(q,"registerVersion");const Wu="firebase-heartbeat-database",Hu=1,ye="firebase-heartbeat-store";let ks=null;function Ad(){return ks||(ks=md(Wu,Hu,{upgrade:(a,e)=>{switch(e){case 0:try{a.createObjectStore(ye)}catch(t){console.warn(t)}}}}).catch(a=>{throw At.create("idb-open",{originalErrorMessage:a.message})})),ks}o(Ad,"getDbPromise$1");async function qu(a){try{const t=(await Ad()).transaction(ye),s=await t.objectStore(ye).get(Id(a));return await t.done,s}catch(e){if(e instanceof ut)Mt.warn(e.message);else{const t=At.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Mt.warn(t.message)}}}o(qu,"readHeartbeatsFromIndexedDB");async function nl(a,e){try{const s=(await Ad()).transaction(ye,"readwrite");await s.objectStore(ye).put(e,Id(a)),await s.done}catch(t){if(t instanceof ut)Mt.warn(t.message);else{const s=At.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Mt.warn(s.message)}}}o(nl,"writeHeartbeatsToIndexedDB");function Id(a){return`${a.name}!${a.options.appId}`}o(Id,"computeKey");const Yu=1024,Xu=30*24*60*60*1e3,lr=class lr{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Tn(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=al();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(r=>r.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const c=new Date(r.date).valueOf();return Date.now()-c<=Xu}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=al(),{heartbeatsToSend:s,unsentEntries:n}=Ju(this._heartbeatsCache.heartbeats),i=ud(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}};o(lr,"HeartbeatServiceImpl");let Cn=lr;function al(){return new Date().toISOString().substring(0,10)}o(al,"getUTCDateString");function Ju(a,e=Yu){const t=[];let s=a.slice();for(const n of a){const i=t.find(r=>r.agent===n.agent);if(i){if(i.dates.push(n.date),il(t)>e){i.dates.pop();break}}else if(t.push({agent:n.agent,dates:[n.date]}),il(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}o(Ju,"extractHeartbeatsForHeader");const dr=class dr{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ss()?Ai().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await qu(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return nl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return nl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}};o(dr,"HeartbeatStorageImpl");let Tn=dr;function il(a){return ud(JSON.stringify({version:2,heartbeats:a})).length}o(il,"countBytes");function Qu(a){ft(new Y("platform-logger",e=>new En(e),"PRIVATE")),ft(new Y("heartbeat",e=>new Cn(e),"PRIVATE")),q(Dn,sl,a),q(Dn,sl,"esm2017"),q("fire-js","")}o(Qu,"registerCoreComponents");Qu("");var Zu="firebase",tf="10.8.0";q(Zu,tf,"app");const bd="@firebase/installations",Ei="0.6.5";const Ed=1e4,Dd=`w:${Ei}`,Sd="FIS_v2",ef="https://firebaseinstallations.googleapis.com/v1",sf=60*60*1e3,nf="installations",af="Installations";const rf={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Rt=new bt(nf,af,rf);function vd(a){return a instanceof ut&&a.code.includes("request-failed")}o(vd,"isServerError");function Pd({projectId:a}){return`${ef}/projects/${a}/installations`}o(Pd,"getInstallationsEndpoint");function Cd(a){return{token:a.token,requestStatus:2,expiresIn:cf(a.expiresIn),creationTime:Date.now()}}o(Cd,"extractAuthTokenInfoFromResponse");async function Td(a,e){const s=(await e.json()).error;return Rt.create("request-failed",{requestName:a,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}o(Td,"getErrorFromResponse");function _d({apiKey:a}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":a})}o(_d,"getHeaders$1");function of(a,{refreshToken:e}){const t=_d(a);return t.append("Authorization",lf(e)),t}o(of,"getHeadersWithAuth");async function xd(a){const e=await a();return e.status>=500&&e.status<600?a():e}o(xd,"retryIfServerError");function cf(a){return Number(a.replace("s","000"))}o(cf,"getExpiresInFromResponseExpiresIn");function lf(a){return`${Sd} ${a}`}o(lf,"getAuthorizationHeader");async function df({appConfig:a,heartbeatServiceProvider:e},{fid:t}){const s=Pd(a),n=_d(a),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&n.append("x-firebase-client",d)}const r={fid:t,authVersion:Sd,appId:a.appId,sdkVersion:Dd},c={method:"POST",headers:n,body:JSON.stringify(r)},l=await xd(()=>fetch(s,c));if(l.ok){const d=await l.json();return{fid:d.fid||t,registrationStatus:2,refreshToken:d.refreshToken,authToken:Cd(d.authToken)}}else throw await Td("Create Installation",l)}o(df,"createInstallationRequest");function Nd(a){return new Promise(e=>{setTimeout(e,a)})}o(Nd,"sleep");function hf(a){return btoa(String.fromCharCode(...a)).replace(/\+/g,"-").replace(/\//g,"_")}o(hf,"bufferToBase64UrlSafe");const uf=/^[cdef][\w-]{21}$/,_n="";function ff(){try{const a=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(a),a[0]=112+a[0]%16;const t=pf(a);return uf.test(t)?t:_n}catch{return _n}}o(ff,"generateFid");function pf(a){return hf(a).substr(0,22)}o(pf,"encode");function vs(a){return`${a.appName}!${a.appId}`}o(vs,"getKey");const Od=new Map;function Md(a,e){const t=vs(a);Rd(t,e),gf(t,e)}o(Md,"fidChanged");function Rd(a,e){const t=Od.get(a);if(t)for(const s of t)s(e)}o(Rd,"callFidChangeCallbacks");function gf(a,e){const t=yf();t&&t.postMessage({key:a,fid:e}),mf()}o(gf,"broadcastFidChange");let _t=null;function yf(){return!_t&&"BroadcastChannel"in self&&(_t=new BroadcastChannel("[Firebase] FID Change"),_t.onmessage=a=>{Rd(a.data.key,a.data.fid)}),_t}o(yf,"getBroadcastChannel");function mf(){Od.size===0&&_t&&(_t.close(),_t=null)}o(mf,"closeBroadcastChannel");const wf="firebase-installations-database",Af=1,Lt="firebase-installations-store";let Bs=null;function Di(){return Bs||(Bs=md(wf,Af,{upgrade:(a,e)=>{switch(e){case 0:a.createObjectStore(Lt)}}})),Bs}o(Di,"getDbPromise");async function ss(a,e){const t=vs(a),n=(await Di()).transaction(Lt,"readwrite"),i=n.objectStore(Lt),r=await i.get(t);return await i.put(e,t),await n.done,(!r||r.fid!==e.fid)&&Md(a,e.fid),e}o(ss,"set");async function Ld(a){const e=vs(a),s=(await Di()).transaction(Lt,"readwrite");await s.objectStore(Lt).delete(e),await s.done}o(Ld,"remove");async function Ps(a,e){const t=vs(a),n=(await Di()).transaction(Lt,"readwrite"),i=n.objectStore(Lt),r=await i.get(t),c=e(r);return c===void 0?await i.delete(t):await i.put(c,t),await n.done,c&&(!r||r.fid!==c.fid)&&Md(a,c.fid),c}o(Ps,"update");async function Si(a){let e;const t=await Ps(a.appConfig,s=>{const n=If(s),i=bf(a,n);return e=i.registrationPromise,i.installationEntry});return t.fid===_n?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}o(Si,"getInstallationEntry");function If(a){const e=a||{fid:ff(),registrationStatus:0};return $d(e)}o(If,"updateOrCreateInstallationEntry");function bf(a,e){if(e.registrationStatus===0){if(!navigator.onLine){const n=Promise.reject(Rt.create("app-offline"));return{installationEntry:e,registrationPromise:n}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=Ef(a,t);return{installationEntry:t,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Df(a)}:{installationEntry:e}}o(bf,"triggerRegistrationIfNecessary");async function Ef(a,e){try{const t=await df(a,e);return ss(a.appConfig,t)}catch(t){throw vd(t)&&t.customData.serverCode===409?await Ld(a.appConfig):await ss(a.appConfig,{fid:e.fid,registrationStatus:0}),t}}o(Ef,"registerInstallation");async function Df(a){let e=await rl(a.appConfig);for(;e.registrationStatus===1;)await Nd(100),e=await rl(a.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:s}=await Si(a);return s||t}return e}o(Df,"waitUntilFidRegistration");function rl(a){return Ps(a,e=>{if(!e)throw Rt.create("installation-not-found");return $d(e)})}o(rl,"updateInstallationRequest");function $d(a){return Sf(a)?{fid:a.fid,registrationStatus:0}:a}o($d,"clearTimedOutRequest");function Sf(a){return a.registrationStatus===1&&a.registrationTime+Ed<Date.now()}o(Sf,"hasInstallationRequestTimedOut");async function vf({appConfig:a,heartbeatServiceProvider:e},t){const s=Pf(a,t),n=of(a,t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&n.append("x-firebase-client",d)}const r={installation:{sdkVersion:Dd,appId:a.appId}},c={method:"POST",headers:n,body:JSON.stringify(r)},l=await xd(()=>fetch(s,c));if(l.ok){const d=await l.json();return Cd(d)}else throw await Td("Generate Auth Token",l)}o(vf,"generateAuthTokenRequest");function Pf(a,{fid:e}){return`${Pd(a)}/${e}/authTokens:generate`}o(Pf,"getGenerateAuthTokenEndpoint");async function vi(a,e=!1){let t;const s=await Ps(a.appConfig,i=>{if(!Fd(i))throw Rt.create("not-registered");const r=i.authToken;if(!e&&_f(r))return i;if(r.requestStatus===1)return t=Cf(a,e),i;{if(!navigator.onLine)throw Rt.create("app-offline");const c=Nf(i);return t=Tf(a,c),c}});return t?await t:s.authToken}o(vi,"refreshAuthToken");async function Cf(a,e){let t=await ol(a.appConfig);for(;t.authToken.requestStatus===1;)await Nd(100),t=await ol(a.appConfig);const s=t.authToken;return s.requestStatus===0?vi(a,e):s}o(Cf,"waitUntilAuthTokenRequest");function ol(a){return Ps(a,e=>{if(!Fd(e))throw Rt.create("not-registered");const t=e.authToken;return Of(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}o(ol,"updateAuthTokenRequest");async function Tf(a,e){try{const t=await vf(a,e),s=Object.assign(Object.assign({},e),{authToken:t});return await ss(a.appConfig,s),t}catch(t){if(vd(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Ld(a.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await ss(a.appConfig,s)}throw t}}o(Tf,"fetchAuthTokenFromServer");function Fd(a){return a!==void 0&&a.registrationStatus===2}o(Fd,"isEntryRegistered");function _f(a){return a.requestStatus===2&&!xf(a)}o(_f,"isAuthTokenValid");function xf(a){const e=Date.now();return e<a.creationTime||a.creationTime+a.expiresIn<e+sf}o(xf,"isAuthTokenExpired");function Nf(a){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},a),{authToken:e})}o(Nf,"makeAuthTokenRequestInProgressEntry");function Of(a){return a.requestStatus===1&&a.requestTime+Ed<Date.now()}o(Of,"hasAuthTokenRequestTimedOut");async function Mf(a){const e=a,{installationEntry:t,registrationPromise:s}=await Si(e);return s?s.catch(console.error):vi(e).catch(console.error),t.fid}o(Mf,"getId");async function Rf(a,e=!1){const t=a;return await Lf(t),(await vi(t,e)).token}o(Rf,"getToken");async function Lf(a){const{registrationPromise:e}=await Si(a);e&&await e}o(Lf,"completeInstallationRegistration");function $f(a){if(!a||!a.options)throw Vs("App Configuration");if(!a.name)throw Vs("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!a.options[t])throw Vs(t);return{appName:a.name,projectId:a.options.projectId,apiKey:a.options.apiKey,appId:a.options.appId}}o($f,"extractAppConfig");function Vs(a){return Rt.create("missing-app-config-values",{valueName:a})}o(Vs,"getMissingValueError");const Ud="installations",Ff="installations-internal",Uf=o(a=>{const e=a.getProvider("app").getImmediate(),t=$f(e),s=se(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:s,_delete:()=>Promise.resolve()}},"publicFactory"),kf=o(a=>{const e=a.getProvider("app").getImmediate(),t=se(e,Ud).getImmediate();return{getId:()=>Mf(t),getToken:n=>Rf(t,n)}},"internalFactory");function Bf(){ft(new Y(Ud,Uf,"PUBLIC")),ft(new Y(Ff,kf,"PRIVATE"))}o(Bf,"registerInstallations");Bf();q(bd,Ei);q(bd,Ei,"esm2017");const ns="analytics",Vf="firebase_id",Gf="origin",jf=60*1e3,zf="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Pi="https://www.googletagmanager.com/gtag/js";const R=new Yt("@firebase/analytics");const Kf={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},G=new bt("analytics","Analytics",Kf);function Wf(a){if(!a.startsWith(Pi)){const e=G.create("invalid-gtag-resource",{gtagURL:a});return R.warn(e.message),""}return a}o(Wf,"createGtagTrustedTypesScriptURL");function kd(a){return Promise.all(a.map(e=>e.catch(t=>t)))}o(kd,"promiseAllSettled");function Hf(a,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(a,e)),t}o(Hf,"createTrustedTypesPolicy");function qf(a,e){const t=Hf("firebase-js-sdk-policy",{createScriptURL:Wf}),s=document.createElement("script"),n=`${Pi}?l=${a}&id=${e}`;s.src=t?t==null?void 0:t.createScriptURL(n):n,s.async=!0,document.head.appendChild(s)}o(qf,"insertScriptTag");function Yf(a){let e=[];return Array.isArray(window[a])?e=window[a]:window[a]=e,e}o(Yf,"getOrCreateDataLayer");async function Xf(a,e,t,s,n,i){const r=s[n];try{if(r)await e[r];else{const l=(await kd(t)).find(d=>d.measurementId===n);l&&await e[l.appId]}}catch(c){R.error(c)}a("config",n,i)}o(Xf,"gtagOnConfig");async function Jf(a,e,t,s,n){try{let i=[];if(n&&n.send_to){let r=n.send_to;Array.isArray(r)||(r=[r]);const c=await kd(t);for(const l of r){const d=c.find(u=>u.measurementId===l),h=d&&e[d.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),a("event",s,n||{})}catch(i){R.error(i)}}o(Jf,"gtagOnEvent");function Qf(a,e,t,s){async function n(i,...r){try{if(i==="event"){const[c,l]=r;await Jf(a,e,t,c,l)}else if(i==="config"){const[c,l]=r;await Xf(a,e,t,s,c,l)}else if(i==="consent"){const[c]=r;a("consent","update",c)}else if(i==="get"){const[c,l,d]=r;a("get",c,l,d)}else if(i==="set"){const[c]=r;a("set",c)}else a(i,...r)}catch(c){R.error(c)}}return o(n,"gtagWrapper"),n}o(Qf,"wrapGtag");function Zf(a,e,t,s,n){let i=o(function(...r){window[s].push(arguments)},"gtagCore");return window[n]&&typeof window[n]=="function"&&(i=window[n]),window[n]=Qf(i,a,e,t),{gtagCore:i,wrappedGtag:window[n]}}o(Zf,"wrapOrCreateGtag");function tp(a){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Pi)&&t.src.includes(a))return t;return null}o(tp,"findGtagScriptOnPage");const ep=30,sp=1e3,hr=class hr{constructor(e={},t=sp){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};o(hr,"RetryData");let xn=hr;const Bd=new xn;function np(a){return new Headers({Accept:"application/json","x-goog-api-key":a})}o(np,"getHeaders");async function ap(a){var e;const{appId:t,apiKey:s}=a,n={method:"GET",headers:np(s)},i=zf.replace("{app-id}",t),r=await fetch(i,n);if(r.status!==200&&r.status!==304){let c="";try{const l=await r.json();!((e=l.error)===null||e===void 0)&&e.message&&(c=l.error.message)}catch{}throw G.create("config-fetch-failed",{httpStatus:r.status,responseMessage:c})}return r.json()}o(ap,"fetchDynamicConfig");async function ip(a,e=Bd,t){const{appId:s,apiKey:n,measurementId:i}=a.options;if(!s)throw G.create("no-app-id");if(!n){if(i)return{measurementId:i,appId:s};throw G.create("no-api-key")}const r=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new Nn;return setTimeout(async()=>{c.abort()},t!==void 0?t:jf),Vd({appId:s,apiKey:n,measurementId:i},r,c,e)}o(ip,"fetchDynamicConfigWithRetry");async function Vd(a,{throttleEndTimeMillis:e,backoffCount:t},s,n=Bd){var i;const{appId:r,measurementId:c}=a;try{await rp(s,e)}catch(l){if(c)return R.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:r,measurementId:c};throw l}try{const l=await ap(a);return n.deleteThrottleMetadata(r),l}catch(l){const d=l;if(!op(d)){if(n.deleteThrottleMetadata(r),c)return R.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${d==null?void 0:d.message}]`),{appId:r,measurementId:c};throw l}const h=Number((i=d==null?void 0:d.customData)===null||i===void 0?void 0:i.httpStatus)===503?mn(t,n.intervalMillis,ep):mn(t,n.intervalMillis),u={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return n.setThrottleMetadata(r,u),R.debug(`Calling attemptFetch again in ${h} millis`),Vd(a,u,s,n)}}o(Vd,"attemptFetchDynamicConfigWithRetry");function rp(a,e){return new Promise((t,s)=>{const n=Math.max(e-Date.now(),0),i=setTimeout(t,n);a.addEventListener(()=>{clearTimeout(i),s(G.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}o(rp,"setAbortableTimeout$1");function op(a){if(!(a instanceof ut)||!a.customData)return!1;const e=Number(a.customData.httpStatus);return e===429||e===500||e===503||e===504}o(op,"isRetriableError$1");const ur=class ur{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}};o(ur,"AnalyticsAbortSignal");let Nn=ur;async function cp(a,e,t,s,n){if(n&&n.global){a("event",t,s);return}else{const i=await e,r=Object.assign(Object.assign({},s),{send_to:i});a("event",t,r)}}o(cp,"logEvent$1");async function lp(a,e,t,s){if(s&&s.global)return a("set",{user_id:t}),Promise.resolve();{const n=await e;a("config",n,{update:!0,user_id:t})}}o(lp,"setUserId$1");async function dp(a,e,t,s){if(s&&s.global){const n={};for(const i of Object.keys(t))n[`user_properties.${i}`]=t[i];return a("set",n),Promise.resolve()}else{const n=await e;a("config",n,{update:!0,user_properties:t})}}o(dp,"setUserProperties$1");async function hp(){if(Ss())try{await Ai()}catch(a){return R.warn(G.create("indexeddb-unavailable",{errorInfo:a==null?void 0:a.toString()}).message),!1}else return R.warn(G.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}o(hp,"validateIndexedDB");async function up(a,e,t,s,n,i,r){var c;const l=ip(a);l.then(y=>{t[y.measurementId]=y.appId,a.options.measurementId&&y.measurementId!==a.options.measurementId&&R.warn(`The measurement ID in the local Firebase config (${a.options.measurementId}) does not match the measurement ID fetched from the server (${y.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(y=>R.error(y)),e.push(l);const d=hp().then(y=>{if(y)return s.getId()}),[h,u]=await Promise.all([l,d]);tp(i)||qf(i,h.measurementId),n("js",new Date);const p=(c=r==null?void 0:r.config)!==null&&c!==void 0?c:{};return p[Gf]="firebase",p.update=!0,u!=null&&(p[Vf]=u),n("config",h.measurementId,p),h.measurementId}o(up,"_initializeAnalytics");var Me;let fp=(Me=class{constructor(e){this.app=e}_delete(){return delete xt[this.app.options.appId],Promise.resolve()}},o(Me,"AnalyticsService"),Me),xt={},cl=[];const ll={};let Gs="dataLayer",pp="gtag",dl,Cs,hl=!1;function gp(){const a=[];if(Wh()&&a.push("This is a browser extension environment."),pd()||a.push("Cookies are not available."),a.length>0){const e=a.map((s,n)=>`(${n+1}) ${s}`).join(" "),t=G.create("invalid-analytics-context",{errorInfo:e});R.warn(t.message)}}o(gp,"warnOnBrowserContextMismatch");function yp(a,e,t){gp();const s=a.options.appId;if(!s)throw G.create("no-app-id");if(!a.options.apiKey)if(a.options.measurementId)R.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${a.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw G.create("no-api-key");if(xt[s]!=null)throw G.create("already-exists",{id:s});if(!hl){Yf(Gs);const{wrappedGtag:i,gtagCore:r}=Zf(xt,cl,ll,Gs,pp);Cs=i,dl=r,hl=!0}return xt[s]=up(a,cl,ll,e,dl,Gs,t),new fp(a)}o(yp,"factory$1");function mp(a=bi()){a=W(a);const e=se(a,ns);return e.isInitialized()?e.getImmediate():wp(a)}o(mp,"getAnalytics");function wp(a,e={}){const t=se(a,ns);if(t.isInitialized()){const n=t.getImmediate();if(ts(e,t.getOptions()))return n;throw G.create("already-initialized")}return t.initialize({options:e})}o(wp,"initializeAnalytics");function Ap(a,e,t){a=W(a),lp(Cs,xt[a.app.options.appId],e,t).catch(s=>R.error(s))}o(Ap,"setUserId");function Ip(a,e,t){a=W(a),dp(Cs,xt[a.app.options.appId],e,t).catch(s=>R.error(s))}o(Ip,"setUserProperties");function Gd(a,e,t,s){a=W(a),cp(Cs,xt[a.app.options.appId],e,t,s).catch(n=>R.error(n))}o(Gd,"logEvent");const ul="@firebase/analytics",fl="0.10.1";function bp(){ft(new Y(ns,(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate();return yp(s,n,t)},"PUBLIC")),ft(new Y("analytics-internal",a,"PRIVATE")),q(ul,fl),q(ul,fl,"esm2017");function a(e){try{const t=e.getProvider(ns).getImmediate();return{logEvent:(s,n,i)=>Gd(t,s,n,i)}}catch(t){throw G.create("interop-component-reg-failed",{reason:t})}}o(a,"internalFactory")}o(bp,"registerAnalytics");bp();const fr=class fr{constructor(e){f(this,"plugin");f(this,"firebaseApp");this.plugin=e,"firebaseApp"in e&&(this.firebaseApp=e.firebaseApp)}setStorageData(e,t,s){const{storage:n}=this.plugin.game,i={[e]:{[t]:s}};n.setStorageData("firebase","services",i)}};o(fr,"BaseService");let me=fr;const{Valid:pl}=g.Utils,pr=class pr extends me{constructor(t){super(t);f(this,"analytics");this.initialize()}initialize(){this.analytics=mp(this.firebaseApp),this.setStorageData("analytics","isInitialized",!0)}event(t,s){this.analytics&&pl.isString(t)&&pl.isObject(s)&&(Gd(this.analytics,t,s,{global:!0}),this.setStorageData("analytics","lastEvent",t))}setUser(t,s){this.analytics&&(Ap(this.analytics,t),Ip(this.analytics,s))}};o(pr,"AnalyticsService");let On=pr;const gl="@firebase/performance",Mn="0.6.5";const jd=Mn,Ep="FB-PERF-TRACE-START",Dp="FB-PERF-TRACE-STOP",Rn="FB-PERF-TRACE-MEASURE",zd="_wt_",Kd="_fp",Wd="_fcp",Hd="_fid",qd="@firebase/performance/config",Yd="@firebase/performance/configexpire",Sp="performance",Xd="Performance";const vp={"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."},M=new bt(Sp,Xd,vp);const rt=new Yt(Xd);rt.logLevel=b.INFO;let js,Jd;const Es=class Es{constructor(e){if(this.window=e,!e)throw M.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){!this.performance||!this.performance.mark||this.performance.mark(e)}measure(e,t,s){!this.performance||!this.performance.measure||this.performance.measure(e,t,s)}getEntriesByType(e){return!this.performance||!this.performance.getEntriesByType?[]:this.performance.getEntriesByType(e)}getEntriesByName(e){return!this.performance||!this.performance.getEntriesByName?[]:this.performance.getEntriesByName(e)}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return!fetch||!Promise||!pd()?(rt.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1):Ss()?!0:(rt.info("IndexedDB is not supported by current browser"),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver(n=>{for(const i of n.getEntries())t(i)}).observe({entryTypes:[e]})}static getInstance(){return js===void 0&&(js=new Es(Jd)),js}};o(Es,"Api");let x=Es;function Pp(a){Jd=a}o(Pp,"setupApi");let Qd;function Cp(a){const e=a.getId();return e.then(t=>{Qd=t}),e}o(Cp,"getIidPromise");function Ci(){return Qd}o(Ci,"getIid");function Tp(a){const e=a.getToken();return e.then(t=>{}),e}o(Tp,"getAuthTokenPromise");function yl(a,e){const t=a.length-e.length;if(t<0||t>1)throw M.create("invalid String merger input");const s=[];for(let n=0;n<a.length;n++)s.push(a.charAt(n)),e.length>n&&s.push(e.charAt(n));return s.join("")}o(yl,"mergeStrings");let zs;const Ds=class Ds{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=yl("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=yl("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return zs===void 0&&(zs=new Ds),zs}};o(Ds,"SettingsService");let V=Ds;var Wt;(function(a){a[a.UNKNOWN=0]="UNKNOWN",a[a.VISIBLE=1]="VISIBLE",a[a.HIDDEN=2]="HIDDEN"})(Wt||(Wt={}));const _p=["firebase_","google_","ga_"],xp=new RegExp("^[a-zA-Z]\\w*$"),Np=40,Op=100;function Mp(){const a=x.getInstance().navigator;return a!=null&&a.serviceWorker?a.serviceWorker.controller?2:3:1}o(Mp,"getServiceWorkerStatus");function Zd(){switch(x.getInstance().document.visibilityState){case"visible":return Wt.VISIBLE;case"hidden":return Wt.HIDDEN;default:return Wt.UNKNOWN}}o(Zd,"getVisibilityState");function Rp(){const e=x.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}o(Rp,"getEffectiveConnectionType");function Lp(a){return a.length===0||a.length>Np?!1:!_p.some(t=>a.startsWith(t))&&!!a.match(xp)}o(Lp,"isValidCustomAttributeName");function $p(a){return a.length!==0&&a.length<=Op}o($p,"isValidCustomAttributeValue");function th(a){var e;const t=(e=a.options)===null||e===void 0?void 0:e.appId;if(!t)throw M.create("no app id");return t}o(th,"getAppId");function Fp(a){var e;const t=(e=a.options)===null||e===void 0?void 0:e.projectId;if(!t)throw M.create("no project id");return t}o(Fp,"getProjectId");function Up(a){var e;const t=(e=a.options)===null||e===void 0?void 0:e.apiKey;if(!t)throw M.create("no api key");return t}o(Up,"getApiKey");const kp="0.0.1",tt={loggingEnabled:!0},Bp="FIREBASE_INSTALLATIONS_AUTH";function Vp(a,e){const t=Gp();return t?(ml(t),Promise.resolve()):Kp(a,e).then(ml).then(s=>jp(s),()=>{})}o(Vp,"getConfig");function Gp(){const a=x.getInstance().localStorage;if(!a)return;const e=a.getItem(Yd);if(!e||!Wp(e))return;const t=a.getItem(qd);if(t)try{return JSON.parse(t)}catch{return}}o(Gp,"getStoredConfig");function jp(a){const e=x.getInstance().localStorage;!a||!e||(e.setItem(qd,JSON.stringify(a)),e.setItem(Yd,String(Date.now()+V.getInstance().configTimeToLive*60*60*1e3)))}o(jp,"storeConfig");const zp="Could not fetch config, will use default configs";function Kp(a,e){return Tp(a.installations).then(t=>{const s=Fp(a.app),n=Up(a.app),i=`https://firebaseremoteconfig.googleapis.com/v1/projects/${s}/namespaces/fireperf:fetch?key=${n}`,r=new Request(i,{method:"POST",headers:{Authorization:`${Bp} ${t}`},body:JSON.stringify({app_instance_id:e,app_instance_id_token:t,app_id:th(a.app),app_version:jd,sdk_version:kp})});return fetch(r).then(c=>{if(c.ok)return c.json();throw M.create("RC response not ok")})}).catch(()=>{rt.info(zp)})}o(Kp,"getRemoteConfig$1");function ml(a){if(!a)return a;const e=V.getInstance(),t=a.entries||{};return t.fpr_enabled!==void 0?e.loggingEnabled=String(t.fpr_enabled)==="true":e.loggingEnabled=tt.loggingEnabled,t.fpr_log_source?e.logSource=Number(t.fpr_log_source):tt.logSource&&(e.logSource=tt.logSource),t.fpr_log_endpoint_url?e.logEndPointUrl=t.fpr_log_endpoint_url:tt.logEndPointUrl&&(e.logEndPointUrl=tt.logEndPointUrl),t.fpr_log_transport_key?e.transportKey=t.fpr_log_transport_key:tt.transportKey&&(e.transportKey=tt.transportKey),t.fpr_vc_network_request_sampling_rate!==void 0?e.networkRequestsSamplingRate=Number(t.fpr_vc_network_request_sampling_rate):tt.networkRequestsSamplingRate!==void 0&&(e.networkRequestsSamplingRate=tt.networkRequestsSamplingRate),t.fpr_vc_trace_sampling_rate!==void 0?e.tracesSamplingRate=Number(t.fpr_vc_trace_sampling_rate):tt.tracesSamplingRate!==void 0&&(e.tracesSamplingRate=tt.tracesSamplingRate),e.logTraceAfterSampling=wl(e.tracesSamplingRate),e.logNetworkAfterSampling=wl(e.networkRequestsSamplingRate),a}o(ml,"processConfig");function Wp(a){return Number(a)>Date.now()}o(Wp,"configValid");function wl(a){return Math.random()<=a}o(wl,"shouldLogAfterSampling");let Ti=1,Ks;function eh(a){return Ti=2,Ks=Ks||qp(a),Ks}o(eh,"getInitializationPromise");function Hp(){return Ti===3}o(Hp,"isPerfInitialized");function qp(a){return Yp().then(()=>Cp(a.installations)).then(e=>Vp(a,e)).then(()=>Al(),()=>Al())}o(qp,"initializePerf");function Yp(){const a=x.getInstance().document;return new Promise(e=>{if(a&&a.readyState!=="complete"){const t=o(()=>{a.readyState==="complete"&&(a.removeEventListener("readystatechange",t),e())},"handler");a.addEventListener("readystatechange",t)}else e()})}o(Yp,"getDocumentReadyComplete");function Al(){Ti=3}o(Al,"changeInitializationStatus");const _i=10*1e3,Xp=5.5*1e3,sh=3,Jp=1e3;let as=sh,It=[],Il=!1;function Qp(){Il||(Ts(Xp),Il=!0)}o(Qp,"setupTransportService");function Ts(a){setTimeout(()=>{if(as!==0){if(!It.length)return Ts(_i);Zp()}},a)}o(Ts,"processQueue");function Zp(){const a=It.splice(0,Jp),e=a.map(s=>({source_extension_json_proto3:s.message,event_time_ms:String(s.eventTime)})),t={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:V.getInstance().logSource,log_event:e};tg(t,a).catch(()=>{It=[...a,...It],as--,rt.info(`Tries left: ${as}.`),Ts(_i)})}o(Zp,"dispatchQueueEvents");function tg(a,e){return eg(a).then(t=>(t.ok||rt.info("Call to Firebase backend failed."),t.json())).then(t=>{const s=Number(t.nextRequestWaitMillis);let n=_i;isNaN(s)||(n=Math.max(s,n));const i=t.logResponseDetails;Array.isArray(i)&&i.length>0&&i[0].responseAction==="RETRY_REQUEST_LATER"&&(It=[...e,...It],rt.info("Retry transport request later.")),as=sh,Ts(n)})}o(tg,"sendEventsToFl");function eg(a){const e=V.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(a)})}o(eg,"postToFlEndpoint");function sg(a){if(!a.eventTime||!a.message)throw M.create("invalid cc log");It=[...It,a]}o(sg,"addToQueue");function ng(a){return(...e)=>{const t=a(...e);sg({message:t,eventTime:Date.now()})}}o(ng,"transportHandler");let Ws;function nh(a,e){Ws||(Ws=ng(ig)),Ws(a,e)}o(nh,"sendLog");function Le(a){const e=V.getInstance();!e.instrumentationEnabled&&a.isAuto||!e.dataCollectionEnabled&&!a.isAuto||x.getInstance().requiredApisAvailable()&&(a.isAuto&&Zd()!==Wt.VISIBLE||(Hp()?Hs(a):eh(a.performanceController).then(()=>Hs(a),()=>Hs(a))))}o(Le,"logTrace");function Hs(a){if(!Ci())return;const e=V.getInstance();!e.loggingEnabled||!e.logTraceAfterSampling||setTimeout(()=>nh(a,1),0)}o(Hs,"sendTraceLog");function ag(a){const e=V.getInstance();if(!e.instrumentationEnabled)return;const t=a.url,s=e.logEndPointUrl.split("?")[0],n=e.flTransportEndpointUrl.split("?")[0];t===s||t===n||!e.loggingEnabled||!e.logNetworkAfterSampling||setTimeout(()=>nh(a,0),0)}o(ag,"logNetworkRequest");function ig(a,e){return e===0?rg(a):og(a)}o(ig,"serializer");function rg(a){const e={url:a.url,http_method:a.httpMethod||0,http_response_code:200,response_payload_bytes:a.responsePayloadBytes,client_start_time_us:a.startTimeUs,time_to_response_initiated_us:a.timeToResponseInitiatedUs,time_to_response_completed_us:a.timeToResponseCompletedUs},t={application_info:ah(a.performanceController.app),network_request_metric:e};return JSON.stringify(t)}o(rg,"serializeNetworkRequest");function og(a){const e={name:a.name,is_auto:a.isAuto,client_start_time_us:a.startTimeUs,duration_us:a.durationUs};Object.keys(a.counters).length!==0&&(e.counters=a.counters);const t=a.getAttributes();Object.keys(t).length!==0&&(e.custom_attributes=t);const s={application_info:ah(a.performanceController.app),trace_metric:e};return JSON.stringify(s)}o(og,"serializeTrace");function ah(a){return{google_app_id:th(a),app_instance_id:Ci(),web_app_info:{sdk_version:jd,page_url:x.getInstance().getUrl(),service_worker_status:Mp(),visibility_state:Zd(),effective_connection_type:Rp()},application_process_state:0}}o(ah,"getApplicationInfo");const cg=100,lg="_",dg=[Kd,Wd,Hd];function hg(a,e){return a.length===0||a.length>cg?!1:e&&e.startsWith(zd)&&dg.indexOf(a)>-1||!a.startsWith(lg)}o(hg,"isValidMetricName");function ug(a){const e=Math.floor(a);return e<a&&rt.info(`Metric value should be an Integer, setting the value as : ${e}.`),e}o(ug,"convertMetricValueToInteger");const he=class he{constructor(e,t,s=!1,n){this.performanceController=e,this.name=t,this.isAuto=s,this.state=1,this.customAttributes={},this.counters={},this.api=x.getInstance(),this.randomId=Math.floor(Math.random()*1e6),this.isAuto||(this.traceStartMark=`${Ep}-${this.randomId}-${this.name}`,this.traceStopMark=`${Dp}-${this.randomId}-${this.name}`,this.traceMeasure=n||`${Rn}-${this.randomId}-${this.name}`,n&&this.calculateTraceMetrics())}start(){if(this.state!==1)throw M.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(this.state!==2)throw M.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Le(this)}record(e,t,s){if(e<=0)throw M.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw M.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(t*1e3),this.startTimeUs=Math.floor(e*1e3),s&&s.attributes&&(this.customAttributes=Object.assign({},s.attributes)),s&&s.metrics)for(const n of Object.keys(s.metrics))isNaN(Number(s.metrics[n]))||(this.counters[n]=Math.floor(Number(s.metrics[n])));Le(this)}incrementMetric(e,t=1){this.counters[e]===void 0?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(hg(e,this.name))this.counters[e]=ug(t??0);else throw M.create("invalid custom metric name",{customMetricName:e})}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const s=Lp(e),n=$p(t);if(s&&n){this.customAttributes[e]=t;return}if(!s)throw M.create("invalid attribute name",{attributeName:e});if(!n)throw M.create("invalid attribute value",{attributeValue:t})}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){this.customAttributes[e]!==void 0&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(t.duration*1e3),this.startTimeUs=Math.floor((t.startTime+this.api.getTimeOrigin())*1e3))}static createOobTrace(e,t,s,n){const i=x.getInstance().getUrl();if(!i)return;const r=new he(e,zd+i,!0),c=Math.floor(x.getInstance().getTimeOrigin()*1e3);r.setStartTime(c),t&&t[0]&&(r.setDuration(Math.floor(t[0].duration*1e3)),r.putMetric("domInteractive",Math.floor(t[0].domInteractive*1e3)),r.putMetric("domContentLoadedEventEnd",Math.floor(t[0].domContentLoadedEventEnd*1e3)),r.putMetric("loadEventEnd",Math.floor(t[0].loadEventEnd*1e3)));const l="first-paint",d="first-contentful-paint";if(s){const h=s.find(p=>p.name===l);h&&h.startTime&&r.putMetric(Kd,Math.floor(h.startTime*1e3));const u=s.find(p=>p.name===d);u&&u.startTime&&r.putMetric(Wd,Math.floor(u.startTime*1e3)),n&&r.putMetric(Hd,Math.floor(n*1e3))}Le(r)}static createUserTimingTrace(e,t){const s=new he(e,t,!1,t);Le(s)}};o(he,"Trace");let Nt=he;function bl(a,e){const t=e;if(!t||t.responseStart===void 0)return;const s=x.getInstance().getTimeOrigin(),n=Math.floor((t.startTime+s)*1e3),i=t.responseStart?Math.floor((t.responseStart-t.startTime)*1e3):void 0,r=Math.floor((t.responseEnd-t.startTime)*1e3),c=t.name&&t.name.split("?")[0],l={performanceController:a,url:c,responsePayloadBytes:t.transferSize,startTimeUs:n,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:r};ag(l)}o(bl,"createNetworkRequestEntry");const fg=5e3;function El(a){Ci()&&(setTimeout(()=>gg(a),0),setTimeout(()=>pg(a),0),setTimeout(()=>yg(a),0))}o(El,"setupOobResources");function pg(a){const e=x.getInstance(),t=e.getEntriesByType("resource");for(const s of t)bl(a,s);e.setupObserver("resource",s=>bl(a,s))}o(pg,"setupNetworkRequests");function gg(a){const e=x.getInstance(),t=e.getEntriesByType("navigation"),s=e.getEntriesByType("paint");if(e.onFirstInputDelay){let n=setTimeout(()=>{Nt.createOobTrace(a,t,s),n=void 0},fg);e.onFirstInputDelay(i=>{n&&(clearTimeout(n),Nt.createOobTrace(a,t,s,i))})}else Nt.createOobTrace(a,t,s)}o(gg,"setupOobTraces");function yg(a){const e=x.getInstance(),t=e.getEntriesByType("measure");for(const s of t)Dl(a,s);e.setupObserver("measure",s=>Dl(a,s))}o(yg,"setupUserTimingTraces");function Dl(a,e){const t=e.name;t.substring(0,Rn.length)!==Rn&&Nt.createUserTimingTrace(a,t)}o(Dl,"createUserTimingTrace");const gr=class gr{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||((e==null?void 0:e.dataCollectionEnabled)!==void 0&&(this.dataCollectionEnabled=e.dataCollectionEnabled),(e==null?void 0:e.instrumentationEnabled)!==void 0&&(this.instrumentationEnabled=e.instrumentationEnabled),x.getInstance().requiredApisAvailable()?Ai().then(t=>{t&&(Qp(),eh(this).then(()=>El(this),()=>El(this)),this.initialized=!0)}).catch(t=>{rt.info(`Environment doesn't support IndexedDB: ${t}`)}):rt.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){V.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return V.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){V.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return V.getInstance().dataCollectionEnabled}};o(gr,"PerformanceController");let Ln=gr;const mg="[DEFAULT]";function wg(a=bi()){return a=W(a),se(a,"performance").getImmediate()}o(wg,"getPerformance");function Ag(a,e){return a=W(a),new Nt(a,e)}o(Ag,"trace");const Ig=o((a,{options:e})=>{const t=a.getProvider("app").getImmediate(),s=a.getProvider("installations-internal").getImmediate();if(t.name!==mg)throw M.create("FB not default");if(typeof window>"u")throw M.create("no window");Pp(window);const n=new Ln(t,s);return n._init(e),n},"factory");function bg(){ft(new Y("performance",Ig,"PUBLIC")),q(gl,Mn),q(gl,Mn,"esm2017")}o(bg,"registerPerformance");bg();const yr=class yr extends me{constructor(t){super(t);f(this,"perf");f(this,"traces");this.traces={},this.initialize()}initialize(){this.perf=wg(this.firebaseApp),this.perf.dataCollectionEnabled=!0,this.perf.instrumentationEnabled=!1,this.setStorageData("performance","isInitialized",!0)}measure(t){this.perf&&(this.traces[t]=Ag(this.perf,t))}start(t){this.traces[t]&&this.traces[t].start()}record(t,s){if(!this.traces[t])return;const{startTime:n=Date.now(),duration:i,options:r}=s;this.traces[t].record(n,i,r)}stop(t){this.traces[t]&&this.traces[t].stop()}putMetric(t,s,n=1){if(!this.traces[t])return;const i=this.formatKeyName(s);this.traces[t].putMetric(i,n)}incrementMetric(t,s,n=1){if(!this.traces[t])return;const i=this.formatKeyName(s);this.traces[t].incrementMetric(i,n)}putAttr(t,s,n){if(!this.traces[t])return;const i=this.formatKeyName(s);this.traces[t].putAttribute(i,n)}removeAttr(t,s){if(!this.traces[t])return;const n=this.formatKeyName(s);this.traces[t].removeAttribute(n)}formatKeyName(t){return t.replace(/\s/g,"_")}};o(yr,"PerformanceService");let $n=yr;const qs="@firebase/remote-config",Sl="0.4.5";const mr=class mr{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}};o(mr,"RemoteConfigAbortSignal");let Fn=mr;const ih="remote-config";const Eg={"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"},$=new bt("remoteconfig","Remote Config",Eg);function Dg(a,e){return a instanceof ut&&a.code.indexOf(e)!==-1}o(Dg,"hasErrorCode");const Sg=!1,vg="",vl=0,Pg=["1","true","t","yes","y","on"],wr=class wr{constructor(e,t=vg){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return this._source==="static"?Sg:Pg.indexOf(this._value.toLowerCase())>=0}asNumber(){if(this._source==="static")return vl;let e=Number(this._value);return isNaN(e)&&(e=vl),e}getSource(){return this._source}};o(wr,"Value");let le=wr;function Cg(a=bi()){return a=W(a),se(a,ih).getImmediate()}o(Cg,"getRemoteConfig");async function Tg(a){const e=W(a),[t,s]=await Promise.all([e._storage.getLastSuccessfulFetchResponse(),e._storage.getActiveConfigEtag()]);return!t||!t.config||!t.eTag||t.eTag===s?!1:(await Promise.all([e._storageCache.setActiveConfig(t.config),e._storage.setActiveConfigEtag(t.eTag)]),!0)}o(Tg,"activate");function _g(a){const e=W(a);return e._initializePromise||(e._initializePromise=e._storageCache.loadFromStorage().then(()=>{e._isInitializationComplete=!0})),e._initializePromise}o(_g,"ensureInitialized");async function xg(a){const e=W(a),t=new Fn;setTimeout(async()=>{t.abort()},e.settings.fetchTimeoutMillis);try{await e._client.fetch({cacheMaxAgeMillis:e.settings.minimumFetchIntervalMillis,signal:t}),await e._storageCache.setLastFetchStatus("success")}catch(s){const n=Dg(s,"fetch-throttle")?"throttle":"failure";throw await e._storageCache.setLastFetchStatus(n),s}}o(xg,"fetchConfig");function Ng(a,e){return Og(W(a),e).asString()}o(Ng,"getString");function Og(a,e){const t=W(a);t._isInitializationComplete||t._logger.debug(`A value was requested for key "${e}" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.`);const s=t._storageCache.getActiveConfig();return s&&s[e]!==void 0?new le("remote",s[e]):t.defaultConfig&&t.defaultConfig[e]!==void 0?new le("default",String(t.defaultConfig[e])):(t._logger.debug(`Returning static value for key "${e}". Define a default or remote value if this is unintentional.`),new le("static"))}o(Og,"getValue");const Ar=class Ar{constructor(e,t,s,n){this.client=e,this.storage=t,this.storageCache=s,this.logger=n}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const s=Date.now()-t,n=s<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${s}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${n}.`),n}async fetch(e){const[t,s]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(s&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return s;e.eTag=s&&s.eTag;const n=await this.client.fetch(e),i=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return n.status===200&&i.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(i),n}};o(Ar,"CachingClient");let Un=Ar;function Mg(a=navigator){return a.languages&&a.languages[0]||a.language}o(Mg,"getUserLanguage");const Ir=class Ir{constructor(e,t,s,n,i,r){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=s,this.projectId=n,this.apiKey=i,this.appId=r}async fetch(e){const[t,s]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,r={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},c={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:s,app_id:this.appId,language_code:Mg()},l={method:"POST",headers:r,body:JSON.stringify(c)},d=fetch(i,l),h=new Promise((m,E)=>{e.signal.addEventListener(()=>{const k=new Error("The operation was aborted.");k.name="AbortError",E(k)})});let u;try{await Promise.race([d,h]),u=await d}catch(m){let E="fetch-client-network";throw(m==null?void 0:m.name)==="AbortError"&&(E="fetch-timeout"),$.create(E,{originalErrorMessage:m==null?void 0:m.message})}let p=u.status;const y=u.headers.get("ETag")||void 0;let w,A;if(u.status===200){let m;try{m=await u.json()}catch(E){throw $.create("fetch-client-parse",{originalErrorMessage:E==null?void 0:E.message})}w=m.entries,A=m.state}if(A==="INSTANCE_STATE_UNSPECIFIED"?p=500:A==="NO_CHANGE"?p=304:(A==="NO_TEMPLATE"||A==="EMPTY_CONFIG")&&(w={}),p!==304&&p!==200)throw $.create("fetch-status",{httpStatus:p});return{status:p,eTag:y,config:w}}};o(Ir,"RestClient");let kn=Ir;function Rg(a,e){return new Promise((t,s)=>{const n=Math.max(e-Date.now(),0),i=setTimeout(t,n);a.addEventListener(()=>{clearTimeout(i),s($.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}o(Rg,"setAbortableTimeout");function Lg(a){if(!(a instanceof ut)||!a.customData)return!1;const e=Number(a.customData.httpStatus);return e===429||e===500||e===503||e===504}o(Lg,"isRetriableError");const br=class br{constructor(e,t){this.client=e,this.storage=t}async fetch(e){const t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:s}){await Rg(e.signal,t);try{const n=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),n}catch(n){if(!Lg(n))throw n;const i={throttleEndTimeMillis:Date.now()+mn(s),backoffCount:s+1};return await this.storage.setThrottleMetadata(i),this.attemptFetch(e,i)}}};o(br,"RetryingClient");let Bn=br;const $g=60*1e3,Fg=12*60*60*1e3,Er=class Er{constructor(e,t,s,n,i){this.app=e,this._client=t,this._storageCache=s,this._storage=n,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:$g,minimumFetchIntervalMillis:Fg},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}};o(Er,"RemoteConfig");let Vn=Er;function Je(a,e){const t=a.target.error||void 0;return $.create(e,{originalErrorMessage:t&&(t==null?void 0:t.message)})}o(Je,"toFirebaseError");const Ct="app_namespace_store",Ug="firebase_remote_config",kg=1;function Bg(){return new Promise((a,e)=>{try{const t=indexedDB.open(Ug,kg);t.onerror=s=>{e(Je(s,"storage-open"))},t.onsuccess=s=>{a(s.target.result)},t.onupgradeneeded=s=>{const n=s.target.result;switch(s.oldVersion){case 0:n.createObjectStore(Ct,{keyPath:"compositeKey"})}}}catch(t){e($.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}})}o(Bg,"openDatabase");const Dr=class Dr{constructor(e,t,s,n=Bg()){this.appId=e,this.appName=t,this.namespace=s,this.openDbPromise=n}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(e){const t=await this.openDbPromise;return new Promise((s,n)=>{const r=t.transaction([Ct],"readonly").objectStore(Ct),c=this.createCompositeKey(e);try{const l=r.get(c);l.onerror=d=>{n(Je(d,"storage-get"))},l.onsuccess=d=>{const h=d.target.result;s(h?h.value:void 0)}}catch(l){n($.create("storage-get",{originalErrorMessage:l==null?void 0:l.message}))}})}async set(e,t){const s=await this.openDbPromise;return new Promise((n,i)=>{const c=s.transaction([Ct],"readwrite").objectStore(Ct),l=this.createCompositeKey(e);try{const d=c.put({compositeKey:l,value:t});d.onerror=h=>{i(Je(h,"storage-set"))},d.onsuccess=()=>{n()}}catch(d){i($.create("storage-set",{originalErrorMessage:d==null?void 0:d.message}))}})}async delete(e){const t=await this.openDbPromise;return new Promise((s,n)=>{const r=t.transaction([Ct],"readwrite").objectStore(Ct),c=this.createCompositeKey(e);try{const l=r.delete(c);l.onerror=d=>{n(Je(d,"storage-delete"))},l.onsuccess=()=>{s()}}catch(l){n($.create("storage-delete",{originalErrorMessage:l==null?void 0:l.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}};o(Dr,"Storage");let Gn=Dr;const Sr=class Sr{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){const e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),s=this.storage.getActiveConfig(),n=await e;n&&(this.lastFetchStatus=n);const i=await t;i&&(this.lastSuccessfulFetchTimestampMillis=i);const r=await s;r&&(this.activeConfig=r)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}};o(Sr,"StorageCache");let jn=Sr;function Vg(){ft(new Y(ih,a,"PUBLIC").setMultipleInstances(!0)),q(qs,Sl),q(qs,Sl,"esm2017");function a(e,{instanceIdentifier:t}){const s=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate();if(typeof window>"u")throw $.create("registration-window");if(!Ss())throw $.create("indexed-db-unavailable");const{projectId:i,apiKey:r,appId:c}=s.options;if(!i)throw $.create("registration-project-id");if(!r)throw $.create("registration-api-key");if(!c)throw $.create("registration-app-id");t=t||"firebase";const l=new Gn(c,s.name,t),d=new jn(l),h=new Yt(qs);h.logLevel=b.ERROR;const u=new kn(n,Ku,t,i,r,c),p=new Bn(u,l),y=new Un(p,l,d,h),w=new Vn(s,y,d,l,h);return _g(w),w}o(a,"remoteConfigFactory")}o(Vg,"registerRemoteConfig");async function Gg(a){return a=W(a),await xg(a),Tg(a)}o(Gg,"fetchAndActivate");Vg();const{Valid:Pl}=g.Utils,vr=class vr extends me{constructor(t){super(t);f(this,"remoteConfig");this.initialize()}initialize(){this.remoteConfig=Cg(this.firebaseApp),this.setStorageData("remoteConfig","isInitialized",!0)}async fetchDataAsync(){this.remoteConfig&&(await Gg(this.remoteConfig),this.setStorageData("remoteConfig","lastFetchTime",Date.now()),this.setStorageData("remoteConfig","lastFetchStatus",this.remoteConfig.lastFetchStatus))}getDataByKey(t){if(!this.remoteConfig)return null;const s=Ng(this.remoteConfig,t);if(!Pl.isString(s))return null;const n=JSON.parse(s);return Pl.isObject(n.data)?(this.setStorageData("remoteConfig","lastConfig",n),n):null}};o(vr,"RemoteConfigService");let zn=vr;const jg={services:{},isInitialized:!1},Pr=class Pr extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"firebaseApp");f(this,"services")}init(){this.services={};const{storage:t}=this.game;t.addStorage("firebase",jg)}configure(t){this.initializeFirebase(t.Options),this.initializeServices(t.Services)}initializeFirebase(t){const s={appId:t.AppId,apiKey:t.ApiKey,projectId:t.ProjectId,authDomain:t.AuthDomain,measurementId:t.MeasurementId,storageBucket:t.StorageBucket,messagingSenderId:t.MessagingSenderId};this.firebaseApp=wd(s),this.setStorageData("isInitialized",!0)}initializeServices(t){this.getStorageData("isInitialized")&&(this.initializeAnalytics(t.Analytics),this.initializePerformance(t.Performance),this.initializeRemoteConfig(t.RemoteConfig))}initializeAnalytics(t){t.Enabled&&(this.services.analytics=new On(this))}initializePerformance(t){t.Enabled&&(this.services.performance=new $n(this))}initializeRemoteConfig(t){t.Enabled&&(this.services.remoteConfig=new zn(this))}setStorageData(t,s){const{storage:n}=this.game;n.setStorageData("firebase",t,s)}getStorageData(t){const{storage:s}=this.game;return s.getStorageData("firebase",t)}};o(Pr,"FirebasePlugin");let Kn=Pr;const zg='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',{Configs:Kg,Utils:Wg}=g,{Object:Cl}=Wg,{Enabled:Hg,WideframeConfigs:Wn}=Kg.FrameCapture,qg=o(async a=>{if(!Hg)return console.warn("FrameCapture is not enabled"),null;const e=Xg(a);if(!e)return null;Yg(e,Wn.ResultChallenge);const{frameCapture:t}=window.game,{Width:s,Height:n}=Wn.ResultChallenge;return t.captureAsync({name:"ResultChallenge",width:s,height:n,renderOptions:e})},"renderResultChallenge"),Yg=o((a,e)=>{const{Width:t,Height:s,Wideframe:n}=e;a.wideframe={name:"result-challenge",type:"image",depth:0,image:n,size:[t,s],position:[0,0]}},"addWideframe$2"),Xg=o(a=>{try{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:n="20",opponentPhoto:i="",opponentScore:r=0,isPlayerFinished:c,isOpponentFinished:l}=a,{RenderOptions:d}=Wn.ResultChallenge,h=Cl.camelCaseKeys(Cl.clone(d)),{playerPhoto:u,opponentPhoto:p}=h,y=s===r,w=s>r,A=c??l,m=c&&l;return u.type==="image"&&(u.name=`${e}`,u.image=t),p.type==="image"&&(p.name=`${n}`,p.image=i),A&&Jg(h,{playerScore:s,opponentScore:r,isPlayerFinished:c,isOpponentFinished:l}),!m||y?(delete h.leftCrown,delete h.rightCrown,h):(w?delete h.rightCrown:delete h.leftCrown,h)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$2"),Jg=o((a,e)=>{const{leftScore:t,rightScore:s}=a,{playerScore:n=0,opponentScore:i=0,isPlayerFinished:r,isOpponentFinished:c}=e;t.type==="text"&&(t.text=r?`${n}`:"???"),s.type==="text"&&(s.text=c?`${i}`:"???")},"addRenderScores"),{Configs:Qg,Utils:Zg}=g,{Object:Tl}=Zg,{Enabled:ty,WideframeConfigs:Hn}=Qg.FrameCapture,ey=o(async a=>{if(!ty)return console.warn("FrameCapture is not enabled"),null;const e=ny(a);if(!e)return null;sy(e,Hn.ShareLeaderboard);const{frameCapture:t}=window.game,{Width:s,Height:n}=Hn.ShareLeaderboard;return t.captureAsync({name:"ShareLeaderboard",width:s,height:n,renderOptions:e})},"renderShareLeaderboard"),sy=o((a,e)=>{const{Width:t,Height:s,Wideframe:n}=e;a.wideframe={name:"share-leaderboard",type:"image",depth:0,image:n,size:[t,s],position:[0,0]}},"addWideframe$1"),ny=o(a=>{try{const{playerId:e,playerPhoto:t,leaders:s}=a,{RenderOptions:n}=Hn.ShareLeaderboard,i=Tl.camelCaseKeys(Tl.clone(n)),{avatar:r}=i;return r.type==="image"&&(r.name=`${e}`,r.image=t),ay(i,s),i}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$1"),ay=o((a,e)=>{const t="600 48px";e.forEach((s,n)=>{const{id:i,name:r,photo:c,score:l}=s;let d=1294+180*n;a[`photo_${i}`]={depth:-1,name:i,type:"image",image:c,size:[96,96],position:[436,d]},d=1360+180*n,a[`name_${i}`]={font:t,depth:1,name:i,type:"text",text:r,position:[600,d]},a[`score_${i}`]={font:t,depth:1,name:i,type:"text",text:`${l}`,position:[100,d]}})},"addLeaders"),{Configs:iy,Utils:ry}=g,{Object:_l}=ry,{Enabled:oy,WideframeConfigs:qn}=iy.FrameCapture,cy=o(async a=>{if(!oy)return console.warn("FrameCapture is not enabled"),null;const e=dy(a);if(!e)return null;ly(e,qn.ShareScore);const{frameCapture:t}=window.game,{Width:s,Height:n}=qn.ShareScore;return t.captureAsync({name:"ShareScore",width:s,height:n,renderOptions:e})},"renderShareScore"),ly=o((a,e)=>{const{Width:t,Height:s,Wideframe:n}=e;a.wideframe={name:"share-score",type:"image",depth:0,image:n,size:[t,s],position:[0,0]}},"addWideframe"),dy=o(a=>{try{const{playerId:e,playerPhoto:t,playerScore:s}=a,{RenderOptions:n}=qn.ShareScore,i=_l.camelCaseKeys(_l.clone(n));console.log("renderOptions",i);const{avatar:r,playerScore:c}=i;return r.type==="image"&&(r.name=`${e}`,r.image=t),c.type==="text"&&(c.text=`${s}`),i}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions"),{Configs:hy,Utils:uy}=g,{Image:$e,Object:xl,Valid:Fe}=uy,{Options:Ys}=hy.FrameCapture,Cr=class Cr extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"width");f(this,"height");f(this,"canvas",null);f(this,"testRenderOptions",null);f(this,"caches",{});f(this,"wideframe",{})}init(){this.addWideframeRender("renderShareScore",cy),this.addWideframeRender("renderResultChallenge",qg),this.addWideframeRender("renderShareLeaderboard",ey)}async preloadAsync(t){const{renderOptions:s}=t;await this.loadImages(s)}async captureAsync(t){const{width:s,height:n,renderOptions:i}=t;return this.width=s,this.height=n,this.createCanvas(),await this.loadImages(i),this.drawObjects(i),this.snapshotFrameAsync()}addWideframeRender(t,s){this.wideframe[t]=s}setTestRenderOptions(t){if(!t){this.testRenderOptions=null;return}const s=xl.camelCaseKeys(t);this.testRenderOptions=xl.merge(this.testRenderOptions,s)}createCanvas(){if(this.canvas){const t=this.canvas.getContext("2d");t?t.clearRect(0,0,this.canvas.width,this.canvas.height):this.canvas=null}this.canvas||(this.canvas=document.createElement("canvas",{is:"canvas"})),this.canvas.width=this.width,this.canvas.height=this.height}async loadImages(t){const s=Object.values(t).filter(c=>c.type==="image"),n=this.prepareLoadImages(s),i=Object.values(n);if(i.length<1)return;const r=await Promise.all(i);this.cacheImages(n,r)}prepareLoadImages(t){const s={};for(const n of t){const{name:i,image:r,fallbackImage:c}=n,l=this.caches[i];!Fe.isString(r)||l||(r===""&&Fe.isString(c)&&(n.image=c),console.info("prepareLoadImages",n),s[i]=new Promise(d=>{const h=$e.loadImage(r);h.catch(()=>{Fe.isString(c)?(n.image=c,$e.loadImage(n.image).then(u=>{d(u)})):d(null)}),h.then(u=>{d(u)})}))}return s}cacheImages(t,s){for(const n in t){const i=s.shift();i&&(this.caches[n]=i)}}drawObjects(t){const s=Object.values(t).sort((n,i)=>n.depth-i.depth);for(const n of s)switch(n.type){case"text":this.drawText(n);break;case"image":this.drawImage(n);break}}drawText(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{position:n,font:i,text:r,color:c,lineWidth:l,textAlign:d}=t;s.font=`${i} ${zg}`,s.fillStyle=c??"#ffffff",l&&(s.lineWidth=l),d&&(s.textAlign=d),console.info("drawText",t);const[h,u]=n;s.fillText(r,h,u)}drawImage(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{name:n,size:i,position:r,fallbackImage:c}=t;let l=this.caches[n];if(!l&&c&&(l=this.caches[c]),!l)throw new Error(`Image ${n} not found`);console.info("drawImage",t);const[d,h]=r,[u,p]=i;s.drawImage(l,d,h,u,p)}async snapshotFrameAsync(){if(!this.canvas)return null;let t=null;if(Ys.UseBlobIfPossible&&"toBlob"in this.canvas?t=await this.createAsBlob():t=this.createAsDataImage(),!t)throw new Error("Image data is null");return Fe.isDebugger()&&$e.logImage(t),t}createAsDataImage(){if(!this.canvas)return null;const t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return null;const{Quality:s,RenderType:n}=Ys;return t.canvas.toDataURL(`image/${n}`,s)}createAsBlob(){return new Promise(t=>{if(!this.canvas){t(null);return}const{Quality:s,RenderType:n}=Ys;this.canvas.toBlob(i=>{if(!i){t(null);return}$e.blobToDataImage(i).then(r=>{t(r)})},`image/${n}`,s)})}};o(Cr,"FrameCapturePlugin");let Yn=Cr;const Tr=class Tr extends Error{constructor(t,s){super(`Text with key "${t}" not found in locale "${s}"`);f(this,"key");f(this,"locale");this.name="MissingKeyInLocaleError",this.key=t,this.locale=s}};o(Tr,"MissingKeyInLocaleError");let is=Tr;const _r=class _r extends Error{constructor(t){super(`Locale not found: ${t}`);f(this,"locale");this.name="LocaleNotFoundError",this.locale=t}};o(_r,"LocaleNotFoundError");let rs=_r;const{Utils:Nl}=g,xr=class xr extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"locale");f(this,"data",{})}add(t,s){this.data[t]=s}choose(t){this.locale=t;const{event:s}=this.game;s.emit(g.Events.LANGUAGE_CHANGED,{locale:t})}getText(t,s,n){try{const{text:i}=this.getLocaleData(n);if(!Nl.Object.hasOwn(i,t)){const c=n??this.getCurrentLocale();throw new is(String(t),c)}const r=i[t];return this.replaceVariables(r,s??[])}catch(i){return i instanceof is?(console.warn(`Text with key "${i.key}" not found in locale "${i.locale}"`),i.key):i instanceof rs?(console.warn(`Locale "${i.locale}" not found`),String(t)):(console.error(i),String(t))}}getTexture(t){const{texture:s}=this.getLocaleData();return s[t]}getCurrentLocale(){return this.locale||"en"}getLocaleData(t){const s=t??this.getCurrentLocale();if(!Nl.Object.hasOwn(this.data,s))throw new rs(s);return this.data[s]}replaceVariables(t,s){const n=s.length;if(n==0)return t;let i=t;for(let r=0;r<n;r++){const c=s[r],l=`%{${r}}`;i=i.replace(l,c)}return i}};o(xr,"LanguagePlugin");let Xn=xr;const fy={_id:"",name:"",createdBy:"",description:"",expireTime:7*24*60*60*1e3,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15},{Configs:py,Utils:gy}=g,{Object:Ue,String:Ol,Valid:yy}=gy,{OtherHost:ke,Mockup:Be,AppId:my}=py,Nr=class Nr{constructor(){f(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await dt(()=>import("./bundle/empty-script.js"),__vite__mapDeps([]),import.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load LeaderboardAPIMock");this.mockAPI=new e}async getLeaderboardAsync(e,t,s){const n=Ol.params(s);let i;return Be.Leaderboards.Enabled?(await this.initMockAPI(),"playerIds"in s?i=await this.mockAPI.getPlayers(e,s):i=await this.mockAPI.getLeaders(e,s)):i=await Kt(`${t}?${n}`,{},ke),!Ue.hasOwn(i,"data")||!Array.isArray(i.data)?[]:i.data}async getLeaderboardsAsync(e){let t;const s=g.Utils.String.params(e),n="leaderboards";return Be.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.getLeaderboardsAsync(e)):(t=await Kt(`${n}?${s}`,{},ke),!Ue.hasOwn(t,"data")||!Array.isArray(t.data)?[]:t.data)}async setLeaderboardScoreAsync(e){const{leaderboardId:t,playerId:s,score:n}=e;Be.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.setScoreAsync(t,s,n)):await B(`leaderboards/${t}/players/${s}`,{score:n},{},ke)}async createLeaderboardAsync(e){const t=e._id??Ol.generateObjectId(),s={...fy,...e,_id:t,appId:my},n="leaderboards";let i;if(Be.Leaderboards.Enabled?(await this.initMockAPI(),i=await this.mockAPI.createLeaderboard(s)):(i=await B(n,s,{},ke),Ue.hasOwn(i,"data")&&yy.isObject(i.data)&&(i=i.data)),!Ue.hasOwn(i,"_id")||i._id!==t)throw new Error("Create leaderboard failed");return t}};o(Nr,"LeaderboardAPI");let Jn=Nr;const Ml={limit:0,offset:0,leaders:{},isRequesting:!1},wy={leaderboards:{}},{Valid:Ay,Json:Rl,Object:Iy}=g.Utils,Or=class Or extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"lbAPI",new Jn);f(this,"configs")}init(){const{storage:t}=this.game;t.addStorage("leaderboard",wy),this.configs={}}addLeaderboard(t){const{name:s,type:n,leaderboardId:i,autoSortRank:r}=t;if(this.getLeaderboard(s)){console.warn(`Leaderboard with name ${s} already exists`);return}let l=`leaderboards/${i}/`;(n==="global"||n==="tournament")&&(l+="leaders"),n==="friends"&&(l+="players"),this.configs[s]={id:i,name:s,type:n,host:l,autoSortRank:r};const d=Rl.clone(Ml);this.setLeaderboard(s,{...d})}async requestLeaderboardsAsync(t){try{return await this.lbAPI.getLeaderboardsAsync(t)}catch(s){return console.warn("requestGlobalLeaderboardsAsync",s),[]}}async requestLeaderboardAsync(t,s){try{this.validateLeaderboard(t),this.clearLeaderboard(t),this.setLeaderboard(t,{isRequesting:!0});const{id:n,type:i,host:r}=this.configs[t];let c=[];if(i==="friends"){const{player:l}=this.game,d=l.getPlayerId(),h=l.getConnectedPlayerIds(s,0),u=[d,...h];this.configs[t].playerIds=[...u],c=await this.lbAPI.getLeaderboardAsync(n,r,{playerIds:u})}else c=await this.lbAPI.getLeaderboardAsync(n,r,{limit:s,offset:0});if(c.length===0)return;await this.receiveLeaderboardAsync(t,c),this.setLeaderboard(t,{limit:s,offset:0})}finally{this.setLeaderboard(t,{isRequesting:!1})}}async loadMoreLeaderboardAsync(t,s){const n=this.getLeaderboard(t);if(n){if(this.configs[t].type==="friends"){console.warn("Cannot load more leaderboard with type friend");return}try{this.setLeaderboard(t,{isRequesting:!0});const{id:i,host:r}=this.configs[t],{offset:c,limit:l}=n,d=c+l,h=await this.lbAPI.getLeaderboardAsync(i,r,{limit:s,offset:d});if(h.length===0)return;this.receiveLeaderboardAsync(t,h),this.setLeaderboard(t,{limit:s,offset:d})}finally{this.setLeaderboard(t,{isRequesting:!1})}}}getLeaderboard(t){const{storage:s}=this.game,n=s.getStorageData("leaderboard","leaderboards");return n[t]?n[t]:null}async getLeadersByPlayerIdsAsync(t,s){try{this.validateLeaderboard(t);const{id:n}=this.configs[t],i=`leaderboards/${n}/players`,r=await this.lbAPI.getLeaderboardAsync(n,i,{playerIds:s});return r.length===0?[]:this.toLeaders(r)}catch(n){return console.warn(n),[]}}clearLeaderboard(t){try{this.validateLeaderboard(t);const s=Rl.clone(Ml);this.setLeaderboard(t,null),this.setLeaderboard(t,{...s})}catch(s){console.warn(s)}}isLeaderboardEmpty(t){const s=this.getLeaderboard(t);if(!s)return!0;const{leaders:n}=s;return Object.keys(n).length===0}isExistLeaderboardId(t){const{configs:s}=this;return Object.values(s).some(n=>n.id===t)}getLeaderboardName(t){const{configs:s}=this,n=Object.values(s).find(i=>i.id===t);return n?n.name:null}async setLeaderboardScoreAsync(t,s,n){try{this.validateLeaderboard(t);const{id:i}=this.configs[t],r=await this.getLastScoreOnLeaderboard(t,s);if(r&&n<=r)return;await this.lbAPI.setLeaderboardScoreAsync({leaderboardId:i,playerId:s,score:n})}catch(i){console.warn(i)}}async getLastScoreOnLeaderboard(t,s){const n=await this.getLeadersByPlayerIdsAsync(t,[s]);return n.length===0?null:n[0].score}async createLeaderboardAsync(t){return this.lbAPI.createLeaderboardAsync(t)}validateLeaderboard(t){const s=this.getLeaderboard(t);if(!Ay.isObject(s))throw new Error(`Leaderboard with name ${t} not found`)}setLeaderboard(t,s){const{storage:n}=this.game;n.setStorageData("leaderboard","leaderboards",{[t]:s})}async receiveLeaderboardAsync(t,s){this.validateLeaderboard(t);const i=(await this.toLeaders(s)).filter(u=>u.name&&u.photo),{offset:r=0,leaders:c={}}=this.getLeaderboard(t)??{},l=i.filter(u=>!c[u.playerId]);if(r>0&&l.length>0){const u=Object.values(c);l.unshift(...u)}let d=l.sort((u,p)=>p.score-u.score);this.configs[t].autoSortRank&&(d=d.map((u,p)=>({...u,rank:p+1})));const h=Iy.keyBy(d,"playerId");this.setLeaderboard(t,{leaders:h})}async toLeaders(t){const{profile:s}=this.game,n=t.map(l=>l.playerId);await s.requestProfiles(n);const i=s.getProfiles();return t.map(l=>{const{playerId:d}=l,h=i[d];return h?{...l,name:h.name,photo:h.photo}:{...l,name:"Nameless",photo:"default"}}).map(l=>({...l,score:parseInt(l.score,10)}))}};o(Or,"LeaderboardPlugin");let Qn=Or;const Mr=class Mr{constructor(){f(this,"APIHost")}setAPIHost(e){this.APIHost=e}getAPIHost(){return this.APIHost}};o(Mr,"BaseAPI");let Zn=Mr;const{Utils:Ll}=g,Rr=class Rr extends Zn{async createSingleMatchAsync(e){const s=await B("single-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getSingleMatchDetailAsync(){const t=await Kt("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateSingleMatchMoveAsync(e,t){const s=`single-matches/${e}/move`,n=await B(s,t,{},this.getAPIHost());return this.returnValidMatchData(n)}async finishSingleMatchAsync(e){const t=`single-matches/${e}/finish`,s=await B(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createEndlessMatchAsync(e){const s=await B("endless-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getEndlessMatchDetailAsync(){const t=await Kt("endless-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateEndlessMatchMilestoneAsync(e,t){const s=`endless-matches/${e}/milestone`,n=await B(s,t,{},this.getAPIHost());return this.returnValidMatchData(n)}async finishEndlessMatchAsync(e){const t=`endless-matches/${e}/finish`,s=await B(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createMatchAsync(e){const s=await B("matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async joinMatchAsync(e){const t=`matches/${e}/join`,s=await B(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async getMatchDetailByIdAsync(e){const t=`matches/${e}`,s=await Kt(t,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishMatchAsync(e){const{matchId:t="",score:s=0,level:n=0,extraData:i={}}=e,r=`matches/${t}/finish`,c=await B(r,{matchId:t,score:s,level:n,extraData:i},{},this.getAPIHost());return this.returnValidMatchData(c)}returnValidMatchData(e){let t={};return!Ll.Valid.isObject(e)||!Ll.Object.hasOwn(e,"data")||(t=e.data),t}};o(Rr,"MatchAPI");let ta=Rr;const Lr=class Lr{constructor(e){f(this,"matchAPI");this.createAPI(),this.setAPIConfig(e)}createAPI(){this.matchAPI=new ta}setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}setMatchAPIInstance(e){this.matchAPI=e}getMatchAPI(){return this.matchAPI}};o(Lr,"APIHandler");let ea=Lr;const $r=class $r{constructor(e,t){f(this,"game");f(this,"match");this.game=e,this.match=t}startLog(e){this.match.useCPUProfile&&console.profile(this.constructor.name),console.group(` ${this.constructor.name}`),e&&console.log(" ? Payload:",e)}endLog(){console.groupEnd(),this.match.useCPUProfile&&console.profileEnd()}async processAsync(e){throw new Error("Not implemented")}};o($r,"BaseConcrete");let P=$r;const Fr=class Fr extends nt{constructor(e){super(e),this.name="LevelNotDefined",this.message=e??"Level is not defined"}};o(Fr,"LevelNotDefined");let os=Fr;const Ur=class Ur extends nt{constructor(e){super(e),this.name="MatchModeNotDefined",this.message=e??"Match id is not defined"}};o(Ur,"MatchModeNotDefined");let we=Ur;const{Object:Xs,Valid:by}=g.Utils;var Re;let I=(Re=class{constructor(e){f(this,"game");f(this,"match");f(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}setNext(e){return this.nextHandler=e,e}async processAsync(e){console.groupCollapsed(` ${this.constructor.name}`),this.logData("Before",e)}async nextAsync(e){this.logData("After",e),console.groupEnd(),this.nextHandler&&await this.nextHandler.processAsync(e)}logData(e,t){if(!by.isDebugger())return;console.groupCollapsed(` MatchState: ${e}`);const{profiles:s,customData:n,...i}=t;console.info(" Base"),console.table(Xs.clone(i)),console.info(" Profile"),console.table(Xs.clone(s)),console.info(" Custom"),console.table(Xs.clone(n)),console.groupEnd()}},o(Re,"BaseHandler"),Re);const{Plugins:Ey,Utils:Dy}=g,{Analytics:Sy}=Ey,{String:vy,Valid:$l}=Dy,kr=class kr extends I{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e,{level:n}=s;this.validateMode(t),this.validateLevel(n);const{analytics:i}=this.game;i.event(Sy.Events.MATCH_START,{level:n,game_mode:vy.toUpperCamelCase(t),level_name:`level_${n}`}),await this.nextAsync(e)}validateMode(e){if(!$l.isString(e))throw new we}validateLevel(e){if(!$l.isNumber(e))throw new os}};o(kr,"LogMatchStartHandler");let z=kr;const j={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},Br=class Br extends I{async processAsync(e){super.processAsync(e);const{mode:t,status:s}=e;let n=t??Tt.SINGLE;s===j.FINISHED&&(n=Tt.SINGLE),this.contextGameModeDetected(n),await this.nextAsync(e)}contextGameModeDetected(e){const{storage:t}=this.game;t.setStorageData("context","contextGameMode",e)}};o(Br,"ContextGameModeHandler");let _=Br;const Vr=class Vr extends Error{constructor(e){super(e),this.name="GetMatchDetailFailed",this.message=e??"Get match detail failed"}};o(Vr,"GetMatchDetailFailed");let Ae=Vr;const Gr=class Gr extends Error{constructor(e){super(e),this.name="MatchAreNotActive",this.message=e??"Match are not active"}};o(Gr,"MatchAreNotActive");let cs=Gr;const jr=class jr extends nt{constructor(e){super(e),this.name="MatchIdNotValid",this.message=e??"Match id is not valid"}};o(jr,"MatchIdNotValid");let at=jr;const zr=class zr extends Error{constructor(e){super(e),this.name="OpponentHasFinishedMatch",this.message=e||"Opponent has finished match"}};o(zr,"OpponentHasFinishedMatch");let sa=zr;const Kr=class Kr extends nt{constructor(e){super(e),this.name="OpponentIdNotValid",this.message=e??"Opponent id is not valid"}};o(Kr,"OpponentIdNotValid");let F=Kr;const Wr=class Wr extends Error{constructor(e){super(e),this.name="PlayerNotCurrentInMatch",this.message=e??"The player is not currently in this match"}};o(Wr,"PlayerNotCurrentInMatch");let Ie=Wr;const Hr=class Hr extends Error{constructor(e){super(e),this.name="PlayerNotFinishedMatch",this.message=e||"Player not finished match"}};o(Hr,"PlayerNotFinishedMatch");let ls=Hr;const{Dtos:Py}=g,qr=class qr extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Py.Match.Data(t).toObject();this.validateAwaitMatchData(e,s),this.updateMatchData(e,s),this.validateMatchStatus(e),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new at}validateMatchStatus(e){const{status:t}=e;if(t!==j.ACTIVE)throw new cs}validateAwaitMatchData(e,t){const{id:s,customData:n}=e,{_id:i,whitePlayerId:r,blackPlayerId:c}=t;if(typeof i!="string"||i!==s)throw new Ae;const{playerId:l}=n,d=r===l,h=c===l;if(!d&&c===ht.playerId)throw new ge;if(!d&&!h)throw new Ie}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(typeof n!="string")throw new D;const{finished:i}=t[n];if(!i)throw new ls}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:n}=s;if(typeof n!="string")throw new F;const{finished:i}=t[n];if(i)throw new sa}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d,status:h}=t;e.status=h;const u=n===s.playerId,p=u?n:i,y=u?i:n;e.customData.playerId=p,e.customData.opponentId=y,e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const w=u?r:c,A=u?c:r;e.profiles[p].score=w,e.profiles[y].score=A;const m=u?l:d,E=u?d:l;e.profiles[p].finished=m,e.profiles[y].finished=E}};o(qr,"AwaitMatchHandler");let na=qr;const xi={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},Yr=class Yr extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.initializeMatch(t),await this.nextAsync(t)}initializeMatch(t){const{id:s,mode:n,customData:i}=this.payload;t.id=s??null,t.mode=n||null,t.status=j.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData={...xi,...t.customData,...i}}};o(Yr,"PrepareMatchHandler");let U=Yr;const Ot=pe,Xr=class Xr extends Error{constructor(e){super(e),this.name="UnavailableFeature",this.message=`Unavailable feature: ${e}`}};o(Xr,"UnavailableFeature");let v=Xr;const Jr=class Jr extends nt{constructor(e){super(e),this.name="ContextIdNotValid",this.message=e??"Context id is not valid"}};o(Jr,"ContextIdNotValid");let X=Jr;const Qr=class Qr extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAwaitingAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new F}async createWideframesAwaitingAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0,finished:u}=c;if(!u)return null;const{photo:p,score:y=0,finished:w}=l;return w?null:await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:p,opponentScore:y,isPlayerFinished:!0,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesAwaitingAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");const{name:l}=n[r],d={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${l} is waiting for you to finish this game. Play now!`,localizations:{vi_VN:`${l} ang ch bn kt thc trn u. Chi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(d)}};o(Qr,"SendAwaitingMessageHandler");let aa=Qr;const Zr=class Zr extends I{async processAsync(e){await this.nextAsync(e)}async nextAsync(e){this.nextHandler&&await this.nextHandler.processAsync(e)}};o(Zr,"NothingHandler");let T=Zr;const to=class to extends nt{constructor(e){super(e),this.name="ProfileNotFound",this.message=e??"Profile not found"}};o(to,"ProfileNotFound");let K=to;const{Dtos:Cy}=g,eo=class eo extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const{customData:t}=e,{playerId:s,opponentId:n}=t;let i=s;const r=await this.getProfile(i);if(!r)throw new K;if(this.updateMatchProfile(e,i,r),i=n,i!==ht.playerId){const c=await this.getProfile(i);if(!c)throw new K;this.updateMatchProfile(e,i,c)}else this.updateMatchProfile(e,i);await this.nextAsync(e)}validateData(e){const{customData:t}=e,{playerId:s,opponentId:n}=t;if(!s||typeof s!="string")throw new D;if(!n||typeof n!="string")throw new F}async getProfile(e){const{profile:t}=this.game;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchProfile(e,t,s){const{name:n,photo:i}=s??ht,r=new Cy.Match.Profile({id:t,name:n,photo:i}).toObject();e.profiles[t]?(e.profiles[t].name=r.name,e.profiles[t].photo=r.photo):e.profiles[t]=r}};o(eo,"GetMatchProfilesHandler");let pt=eo;const so=class so extends P{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:n}=e,i=new T(this),r=new U(this,{id:t,mode:Q.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:n}});i.setNext(r);const c=new na(this);r.setNext(c);const l=new pt(this);c.setNext(l);const d=new aa(this);l.setNext(d);const h=new z(this);d.setNext(h);const u=new _(this);h.setNext(u);const p=this.match.getMatchState();await i.processAsync(p)}finally{this.endLog()}}};o(so,"AwaitChallengeMatchConcrete");let ia=so;const no=class no extends nt{constructor(e){super(e),this.name="CreateContextFailed",this.message=e??"Create context failed"}};o(no,"CreateContextFailed");let be=no;const{Valid:Fl,Object:Ul}=g.Utils,ao=class ao extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{opponentId:s}=this.payload,n=await this.createAsync(s);t.customData.contextId=n,await this.nextAsync(t)}async createAsync(t){try{await GameSDK.context.createAsync(t)}catch(n){this.validateError(n)}const s=GameSDK.context.getID();if(!Fl.isString(s))throw new be;return s}validateError(t){if(!Ul.hasOwn(t,"code"))throw t;if(t.code!=="SAME_CONTEXT"){if(t.code==="INVALID_PARAM"){if(!this.isNotConnectedPlayerError(t))throw t;return}throw t}}validateErrorMessage(t){if(!Ul.hasOwn(t,"message")||!Fl.isString(t.message))throw t}isNotConnectedPlayerError(t){return this.validateErrorMessage(t),t.message.includes("is not a connected player of the current player")}};o(ao,"CreateContextHandler");let ra=ao;const io=class io extends nt{constructor(e){super(e),this.name="MatchAreNotOpen",this.message=e??"Match are not open"}};o(io,"MatchAreNotOpen");let Xt=io;const{Dtos:Ty}=g,ro=class ro extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t);const s=await this.createMatchAsync(t),n=new Ty.Match.Data(s).toObject();this.updateMatchState(t,n),await this.nextAsync(t)}validateData(t){const{status:s,customData:n}=t,{opponentId:i}=n;if(typeof i!="string")throw new F;if(s!==j.OPEN)throw new Xt}async createMatchAsync(t){const{opponentId:s}=t.customData,{extraData:n}=this.payload;if(!s)return{};const i={opponentPlayerId:s,extraData:n};return this.match.api.getMatchAPI().createMatchAsync(i)}updateMatchState(t,s){const{customData:n}=t,{_id:i,whitePlayerId:r,blackPlayerId:c,whitePlayerFinish:l,blackPlayerFinish:d}=s,h=r===n.opponentId;t.id=i||null;const u=h?c:r,p=h?r:c;t.customData.playerId=u,t.customData.opponentId=p,t.profiles[u]||(t.profiles[u]={id:u,name:"",photo:"",finished:!1}),t.profiles[p]||(t.profiles[p]={id:p,name:"",photo:"",finished:!1});const y=h?d:l,w=h?l:d;t.profiles[u].finished=y,t.profiles[p].finished=w}};o(ro,"CreateMatchHandler");let ds=ro;const oo=class oo extends I{async processAsync(e){if(super.processAsync(e),e.status!==j.OPEN)throw new Xt;this.startMatch(e),await this.nextAsync(e)}startMatch(e){e.status=j.ACTIVE,e.startAt=Date.now()}};o(oo,"StartMatchHandler");let J=oo;const co=class co extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesChallengeAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new F}async createWideframesChallengeAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0}=c,{photo:u,score:p=0}=l;return await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:u,opponentScore:p,isPlayerFinished:!1,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesChallengeAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");const{name:l}=n[r],d={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${l} challenges you`,localizations:{vi_VN:`${l} th thch bn trong trn u ny. Chi ngay!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await GameSDK.extra.updateAsync(d)}};o(co,"SendChallengeMessageHandler");let hs=co;const lo=class lo extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s}=e,n=new T(this),i=new ra(this,{opponentId:s});n.setNext(i);const r=new U(this,{mode:Q.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:s}});i.setNext(r);const c=new ds(this,{extraData:e.extraData});r.setNext(c);const l=new pt(this);c.setNext(l);const d=new J(this);l.setNext(d);const h=new z(this);d.setNext(h);const u=new hs(this);h.setNext(u);const p=new _(this);u.setNext(p);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};o(lo,"ChallengeFriendConcrete");let oa=lo;const ho=class ho extends Error{constructor(e){super(e),this.name="SameContext",this.message=e??"Same context"}};o(ho,"SameContext");let de=ho;const{Utils:kl}=g,uo=class uo extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;await this.switchAsync(s),t.customData.contextId=s,await this.nextAsync(t)}checkSameContext(t){const s=t==="SOLO",n=GameSDK.context.getID();if(n===t)throw new de;if(s&&n===null)throw new de}async switchAsync(t){const s=t==="SOLO";try{this.checkSameContext(t),await GameSDK.context.switchAsync(t,s)}catch(n){if(n instanceof de)return;if(!kl.Object.hasOwn(n,"code"))throw n;if(kl.Device.isAndroid()&&s&&n.code==="INVALID_PARAM")return;if(n.code!=="SAME_CONTEXT")throw n}}};o(uo,"SwitchContextHandler");let Jt=uo;const{Dtos:_y}=g,fo=class fo extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new _y.Match.Data(t).toObject();this.validateContinueMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t,status:s}=e;if(typeof t!="string")throw new at;if(s!==j.OPEN)throw new Xt}validateContinueMatchData(e,t){const{id:s,customData:n}=e,{_id:i,whitePlayerId:r,blackPlayerId:c}=t;if(typeof i!="string"||i!==s)throw console.warn(" ? respMatchDataValidated",t),new Ae;const{playerId:l}=n,d=r===l,h=c===l;if(!d&&c===ht.playerId)throw new ge;if(!d&&!h)throw new Ie}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(typeof n!="string")throw new D;const{finished:i}=t[n];if(i)throw new Qe}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=n===s.playerId,u=h?n:i,p=h?i:n;e.customData.playerId=u,e.customData.opponentId=p,e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!1}),e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1});const y=h?r:c,w=h?c:r;e.profiles[u].score=y,e.profiles[p].score=w;const A=h?l:d,m=h?d:l;e.profiles[u].finished=A,e.profiles[p].finished=m}};o(fo,"ContinueMatchHandler");let ca=fo;const po=class po extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesCurrentScoreAsync();t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new F}async createWideframesCurrentScoreAsync(){try{const{player:e,frameCapture:t}=this.game,{playerId:s,photo:n}=e.getPlayer(),{profiles:i}=this.match.getMatchState(),{score:r=0}=i[s]||{};return await t.wideframe.renderShareScore({playerId:s,playerPhoto:n,playerScore:r})}catch(e){return console.warn("createWideframesCurrentScoreAsync",e),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");const{name:l}=n[r],d={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${l} made an update.`,localizations:{vi_VN:`${l}  cp nht trn u. Chi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");await GameSDK.extra.updateAsync(d)}};o(po,"SendUpdateMessageHandler");let la=po;const go=class go extends P{async processAsync(e){try{this.startLog(e);const{contextId:t,matchId:s,playerId:n,opponentId:i}=e,r=new T(this),c=new Jt(this,{contextId:t});r.setNext(c);const l=new U(this,{id:s,mode:Q.CHALLENGE_FRIEND,customData:{playerId:n,opponentId:i}});c.setNext(l);const d=new ca(this);l.setNext(d);const h=new pt(this);d.setNext(h);const u=new J(this);h.setNext(u);const p=new la(this);u.setNext(p);const y=new z(this);p.setNext(y);const w=new _(this);y.setNext(w);const A=this.match.getMatchState();await r.processAsync(A)}finally{this.endLog()}}};o(go,"ContinueChallengeMatchConcrete");let da=go;const{Plugins:xy,Utils:Ny}=g,{Analytics:Oy}=xy,{String:My,Valid:Bl}=Ny,yo=class yo extends I{async processAsync(e){super.processAsync(e);const{customData:t,mode:s,startAt:n,finishAt:i}=e,{level:r}=t;this.validateMode(s),this.validateLevel(r);const{analytics:c}=this.game,l=Math.floor((i-n)/1e3);c.event(Oy.Events.MATCH_END,{level:r,game_mode:My.toUpperCamelCase(s),level_name:`level_${r}`,time_played:l}),await this.nextAsync(e)}validateMode(e){if(!Bl.isString(e))throw new we}validateLevel(e){if(!Bl.isNumber(e))throw new os}};o(yo,"LogMatchFinishedHandler");let $t=yo;const mo=class mo extends Error{constructor(e){super(e),this.name="ScoreNotValid",this.message=e??"Score is not valid"}};o(mo,"ScoreNotValid");let Qt=mo;const wo=class wo extends Error{constructor(e){super(e),this.name="LeaderboardIdNotValid",this.message=e??"Leaderboard id is not valid"}};o(wo,"LeaderboardIdNotValid");let Ft=wo;const Ao=class Ao extends Error{constructor(e){super(e),this.name="LeaderboardNotExist",this.message=e??"Leaderboard not exist in game"}};o(Ao,"LeaderboardNotExist");let ha=Ao;const{Valid:Vl}=g.Utils,Io=class Io extends I{constructor(t,s){super(t);f(this,"payload");f(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.setupSetScorePayload(t),this.setLeaderboardScoreAsync(),await this.nextAsync(t)}async setupSetScorePayload(t){const{profiles:s,customData:n}=t,{playerId:i}=n;if(!i||!s[i])throw new K;const{score:r,leaderboardId:c}=this.payload;if(!Vl.isNumber(r))throw new Qt;if(!Vl.isString(c))throw new Ft;this.leaderboardPayload={score:r,playerId:i,leaderboardId:c}}async setLeaderboardScoreAsync(){try{const{playerId:t,score:s,leaderboardId:n}=this.leaderboardPayload,i=this.game.leaderboard.getLeaderboardName(n);if(!i)throw new ha;await this.game.leaderboard.setLeaderboardScoreAsync(i,t,s)}catch(t){console.warn("setLeaderboardScoreAsync",t)}}};o(Io,"SetLeaderboardScoreHandler");let Zt=Io;const{Valid:Ry}=g.Utils,{Leaderboards:Ly}=g.Configs,bo=class bo extends Zt{constructor(e){super(e,{score:0,leaderboardId:Ly.LeaderboardId})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new K;const{score:i}=t[n];if(!Ry.isNumber(i))throw new Qt;this.payload.score=i,super.setupSetScorePayload(e)}};o(bo,"PostGlobalLeaderboardScoreHandler");let Ee=bo;const{Dtos:$y,Utils:Fy}=g,{Valid:Ve,Object:Uy}=Fy,Eo=class Eo extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateMatchData(t);const{useAPI:s}=this.payload;if(s){const n=await this.finishMatchAsync(t),i=new $y.Match.Data(n).toObject();this.updateMatchFromAPI(t,i)}else this.updateMatchData(t);this.updateMatchState(t),await this.nextAsync(t)}validateMatchData(t){const{status:s,profiles:n,customData:i}=t;if(s!==j.ACTIVE)throw new cs;const{playerId:r}=i;if(!r||!Uy.hasOwn(n,r))throw new Ie}updateMatchData(t){const{playerId:s}=t.customData;if(!Ve.isString(s))throw new D;t.profiles[s].finished=!0}updateMatchState(t){t.status=j.FINISHED,t.finishAt=Date.now()}async finishMatchAsync(t){const{id:s,profiles:n,customData:i}=t,{level:r,playerId:c}=i;if(!Ve.isString(c))throw new D;const{score:l}=n[c],{extraData:d}=this.payload,h={matchId:s??"",score:l,level:r,extraData:d};return this.match.api.getMatchAPI().finishMatchAsync(h)}updateMatchFromAPI(t,s){const{playerId:n,opponentId:i}=t.customData;if(!Ve.isString(n))throw new D;if(!Ve.isString(i))throw new F;const{whitePlayerId:r,whitePlayerScore:c,blackPlayerScore:l,whitePlayerFinish:d,blackPlayerFinish:h}=s,u=n===r,p=u?c:l,y=u?l:c,w=u?d:h,A=u?h:d;t.profiles[n].score=p,t.profiles[i].score=y,t.profiles[n].finished=w,t.profiles[i].finished=A}};o(Eo,"FinishMatchHandler");let Ut=Eo;const Do=class Do extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync(e);t&&this.progressSendFinishedMessage(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new F}async createWideframesResultAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0,finished:u}=c,{photo:p,score:y=0,finished:w}=l;return await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:p,opponentScore:y,isPlayerFinished:!!u,isOpponentFinished:!!w})}catch(t){return console.warn("createWideframesResultAsync",t),null}}progressSendFinishedMessage(e,t){const{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new D;if(!r||typeof r!="string")throw new F;const{score:c=0,finished:l}=s[i],{score:d=0,finished:h}=s[r];l?this.sendFinishMessageAsync(e,t):h&&c>d?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}async sendFinishMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");const{name:l}=n[r],d={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c,status:j.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kt qu"}},text:{default:`${l} just finished. Check them now.`,localizations:{vi_VN:`${l} va hon thnh mn chi. Nhn  xem kt qu trn u.`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");await GameSDK.extra.updateAsync(d)}async sendPlayTurnMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;const{name:l,score:d}=n[r],h={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c,status:j.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${l} got ${d} scores. So easy! Can you?`,localizations:{vi_VN:`${l}  t ${d} im! Nhn Chi  so ti!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");await GameSDK.extra.updateAsync(h)}async sendBestScoreMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;const{name:l,score:d}=n[r],h={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c,status:j.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kt qu"}},text:{default:`${l} beat your high score. Their score: ${d}`,localizations:{vi_VN:`${l}  vt qua im s ca bn, vi ${d} im!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");await GameSDK.extra.updateAsync(h)}};o(Do,"SendFinishedMessageHandler");let ua=Do;const So=class So extends I{async processAsync(e){super.processAsync(e),this.setPlayerBestScore(e),await this.nextAsync(e)}setPlayerBestScore(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new K;const{player:i}=this.game,r=i.getBestScore()||0,{score:c=0}=t[n];c<=r||(i.setBestScore(c),t[n].bestScore=c)}};o(So,"SetPlayerBestScoreHandler");let te=So;const vo=class vo extends P{async processAsync(e){try{this.startLog(e);const{extraData:t}=e??{},s=new T(this),n=new Ut(this,{useAPI:!0,extraData:t});s.setNext(n);const i=new ua(this);n.setNext(i);const r=new $t(this);i.setNext(r);const c=new te(this);r.setNext(c);const l=new Ee(this);c.setNext(l);const d=new _(this);l.setNext(d);const h=this.match.getMatchState();await s.processAsync(h)}finally{this.endLog()}}};o(vo,"FinishChallengeMatchConcrete");let fa=vo;const Po=class Po extends Error{constructor(e){super(e),this.name="ContextAreSolo",this.message=e??"Context are solo"}};o(Po,"ContextAreSolo");let pa=Po;const Co=class Co extends Error{constructor(e){super(e),this.name="OpponentNotJoinInContext",this.message=e??"Opponent is not join in context"}};o(Co,"OpponentNotJoinInContext");let ga=Co;const To=class To extends Error{constructor(e){super(e),this.name="NetworkFailure",this.message=e??"Network failure"}};o(To,"NetworkFailure");let ya=To;const{Utils:ky,Dtos:By}=g,{Array:Vy,Object:Gy}=ky,_o=class _o extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.checkCurrentContext();const s=await this.getOpponentIdFromContextAsync();t.customData.opponentId=s,await this.nextAsync(t)}checkCurrentContext(){const t=GameSDK.context.getID();if(typeof t!="string")throw new X;if(t==="SOLO")throw new pa}async getOpponentIdFromContextAsync(){const{ignoreId:t}=this.payload,s=await this.getContextPlayers([t]);if(s.length>1)throw new ga;let n=ht;return s.length===1&&(n=s[0]),n.playerId}async getContextPlayers(t){try{const s=await GameSDK.context.getPlayersAsync(),n=[];return s.forEach(i=>{const r=i.getID();if(t.includes(r))return;const c=i.getName();if(!c)return;const l=i.getPhoto();n.push(new By.Player.Info({playerId:r,name:c,photo:l}).toObject())}),Vy.unique(n)}catch(s){if(Gy.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new ya;return[]}}};o(_o,"GetOpponentChallengeContextHandler");let ma=_o;const xo=class xo extends Error{constructor(e){super(e),this.name="ContextIsTournament",this.message=e??"Context is a tournament"}};o(xo,"ContextIsTournament");let De=xo;const{Object:jy}=g.Utils,No=class No extends I{async processAsync(e){super.processAsync(e);const t=await this.chooseAsync();await this.checkContextTournament(),e.customData.contextId=t,await this.nextAsync(e)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(t){if(!jy.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}const e=GameSDK.context.getID();if(typeof e!="string")throw new be;return e}async checkContextTournament(){try{if(!GameSDK.context.getID())return;throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new De):new v("getTournamentAsync")}catch(e){if(e instanceof De)throw e}}};o(No,"ChooseContextHandler");let wa=No;const Oo=class Oo extends P{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new T(this),n=new wa(this);s.setNext(n);const i=new U(this,{mode:Q.CHALLENGE_FRIEND,customData:{playerId:t}});n.setNext(i);const r=new ma(this,{ignoreId:t});i.setNext(r);const c=new ds(this,{extraData:e.extraData});r.setNext(c);const l=new pt(this);c.setNext(l);const d=new J(this);l.setNext(d);const h=new z(this);d.setNext(h);const u=new hs(this);h.setNext(u);const p=new _(this);u.setNext(p);const y=this.match.getMatchState();await s.processAsync(y)}finally{this.endLog()}}};o(Oo,"InviteFriendsConcrete");let Aa=Oo;const Mo=class Mo extends Error{constructor(e){super(e),this.name="JoinMatchFailed",this.message=e??"Join match failed"}};o(Mo,"JoinMatchFailed");let Ia=Mo;const Ro=class Ro extends Error{constructor(e){super(e),this.name="MatchAreFinished",this.message=e??"Match are finished"}};o(Ro,"MatchAreFinished");let ba=Ro;const Lo=class Lo extends Error{constructor(e){super(e),this.name="OtherPlayerHasJoinedMatch",this.message=e??"Other player has joined match"}};o(Lo,"OtherPlayerHasJoinedMatch");let Ea=Lo;const{Dtos:zy}=g,$o=class $o extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.joinMatchAsync(e),s=new zy.Match.Data(t).toObject();this.validateJoinMatchData(e,s),this.updateMatchData(e,s),await this.nextAsync(e)}validateMatchData(e){const{status:t}=e;if(t!==j.OPEN)throw new Xt}validateJoinMatchData(e,t){const{id:s,customData:n}=e,{_id:i,blackPlayerId:r,whitePlayerId:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=r===n.playerId,u=c===n.opponentId;if(typeof i!="string"||i!==s||!u)throw console.warn(" ? matchData",t),new Ia;if(l&&d)throw new ba;if(!h)throw new Ea}async joinMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().joinMatchAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=n===s.playerId,u=h?n:i,p=h?i:n;e.customData.playerId=u,e.customData.opponentId=p,e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!1}),e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1});const y=h?r:c,w=h?c:r;e.profiles[u].score=y,e.profiles[p].score=w;const A=h?l:d,m=h?d:l;e.profiles[u].finished=A,e.profiles[p].finished=m}};o($o,"JoinMatchHandler");let Da=$o;const Fo=class Fo extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAcceptedAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new F}async createWideframesAcceptedAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0,finished:u}=c;if(u)return null;const{photo:p,score:y=0,finished:w}=l;return w?await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:p,opponentScore:y,isPlayerFinished:!1,isOpponentFinished:!0}):null}catch(t){return console.warn("createWideframesAcceptedAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");const{name:l}=n[r],d={data:{type:Ot.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${l} accepted the challenge.`,localizations:{vi_VN:`${l}  chp nhn tham gia trn u.`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(d)}};o(Fo,"SendAcceptedMessageHandler");let Sa=Fo;const Uo=class Uo extends P{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:n}=e,i=new T(this),r=new U(this,{id:t,mode:Q.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:n}});i.setNext(r);const c=new Da(this);r.setNext(c);const l=new pt(this);c.setNext(l);const d=new J(this);l.setNext(d);const h=new Sa(this);d.setNext(h);const u=new z(this);h.setNext(u);const p=new _(this);u.setNext(p);const y=this.match.getMatchState();await i.processAsync(y)}finally{this.endLog()}}};o(Uo,"JoinChallengeMatchConcrete");let va=Uo;const rh={_id:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1},{Valid:ot}=g.Utils,ct="is invalid",ko=class ko extends L{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!ot.isString(e)||!e)&&this.exception("_id",ct)}validateStatus(e){(!ot.isString(e)||!e)&&this.exception("status",ct)}validateWinnerId(e){e!==null&&(!ot.isString(e)||!e)&&this.exception("winnerId",ct)}validateWhitePlayerId(e){(!ot.isString(e)||!e)&&this.exception("whitePlayerId",ct)}validateBlackPlayerId(e){(!ot.isString(e)||!e)&&this.exception("blackPlayerId",ct)}validateWhitePlayerScore(e){ot.isNumber(e)||this.exception("whitePlayerScore",ct)}validateBlackPlayerScore(e){ot.isNumber(e)||this.exception("blackPlayerScore",ct)}validateWhitePlayerFinish(e){ot.isBoolean(e)||this.exception("whitePlayerFinish",ct)}validateBlackPlayerFinish(e){ot.isBoolean(e)||this.exception("blackPlayerFinish",ct)}toObject(){return super.toObject()}static getDefaultData(){return rh}};o(ko,"RespMatchDataDtos");let Se=ko;Se.addDefaultData(rh);const Bo=class Bo extends Error{constructor(e){super(e),this.name="MatchAreNotFinished",this.message=e||"Match are not finished"}};o(Bo,"MatchAreNotFinished");let Pa=Bo;const Vo=class Vo extends Error{constructor(e){super(e),this.name="OpponentNotFinishedMatch",this.message=e||"Opponent not finished match"}};o(Vo,"OpponentNotFinishedMatch");let Ca=Vo;const Go=class Go extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Se(t).toObject();this.validateResultMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new at}validateResultMatchData(e,t){const{id:s}=e,{_id:n,whitePlayerFinish:i,blackPlayerFinish:r}=t;if(typeof n!="string"||n!==s)throw new Ae;if(!i&&!r)throw new Pa}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(typeof n!="string")throw new D;const{finished:i}=t[n];if(!i)throw new ls}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:n}=s;if(typeof n!="string")throw new F;const{finished:i}=t[n];if(!i)throw new Ca}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=n===s.playerId,u=h?n:i,p=h?i:n;e.customData.playerId=u,e.customData.opponentId=p,e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!0}),e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!0});const y=h?r:c,w=h?c:r;e.profiles[u].score=y,e.profiles[p].score=w;const A=h?l:d,m=h?d:l;e.profiles[u].finished=A,e.profiles[p].finished=m}};o(Go,"ResultMatchHandler");let Ta=Go;const jo=class jo extends P{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:n}=e,i=new T(this),r=new U(this,{id:t,mode:Q.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:n}});i.setNext(r);const c=new Ta(this);r.setNext(c);const l=new pt(this);c.setNext(l);const d=new _(this);l.setNext(d);const h=this.match.getMatchState();await i.processAsync(h)}finally{this.endLog()}}};o(jo,"ResultChallengeMatchConcrete");let _a=jo;const zo=class zo extends P{constructor(){super(...arguments);f(this,"fallbackSingleMode");f(this,"startFLowChallengeFriend",o(async t=>{try{return await this.match.challenge.invite.processAsync(t),!0}catch(s){return s}},"startFLowChallengeFriend"));f(this,"startFlowTournament",o(async t=>{try{const s=GameSDK.context.getID();if(typeof s!="string")throw new X;await this.match.tournament.continue.processAsync({playerId:t,contextId:s})}catch{await this.startFlowSingle(t)}},"startFlowTournament"));f(this,"startFlowSingle",o(async t=>{if(!this.fallbackSingleMode)throw new Error("Fallback single mode is not enabled");await this.match.single.start.processAsync({playerId:t})},"startFlowSingle"))}async processAsync(t){try{this.startLog(t);const{playerId:s,extraData:n,fallbackSingleMode:i}=t;this.fallbackSingleMode=i;const r=await this.startFLowChallengeFriend({playerId:s,extraData:n});if(r===!0)return;r instanceof De?await this.startFlowTournament(s):await this.startFlowSingle(s)}finally{this.endLog()}}};o(zo,"ChooseContextConcrete");let xa=zo;const{Valid:Ky}=g.Utils,{Leaderboards:Wy}=g.Configs,Ko=class Ko extends Zt{constructor(e){super(e,{score:0,leaderboardId:Wy.LeaderboardEndlessId})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new K;const{endlessScore:i}=t[n];if(!Ky.isNumber(i))throw new Qt;this.payload.score=i,super.setupSetScorePayload(e)}};o(Ko,"PostGlobalLeaderboardEndlessScoreHandler");let Na=Ko;const Wo=class Wo extends I{async processAsync(e){super.processAsync(e),this.setPlayerEndlessScore(e),await this.nextAsync(e)}setPlayerEndlessScore(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new K;const{player:i}=this.game,r=i.getBestEndlessScore()??0,{endlessScore:c=0}=t[n],l=r<c?c:r;i.setBestEndlessScore(l),t[n].bestEndlessScore=l}};o(Wo,"SetPlayerEndlessScoreHandler");let Oa=Wo;const Ho=class Ho extends P{async processAsync(){try{this.startLog();const e=new T(this),t=new Ut(this,{useAPI:!1});e.setNext(t);const s=new $t(this);t.setNext(s);const n=new Oa(this);s.setNext(n);const i=new Na(this);n.setNext(i);const r=new _(this);i.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}};o(Ho,"FinishEndlessConcrete");let Ma=Ho;const qo=class qo extends Error{constructor(e){super(e),this.name="ProfileIdNotDefined",this.message=e??"Profile id is not defined"}};o(qo,"ProfileIdNotDefined");let Ra=qo;const{Dtos:Hy}=g,Yo=class Yo extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{profileId:s}=this.payload;if(!s)throw new Ra;const{player:n}=this.game,i=n.getPlayerId();let r;if(s===i)r=this.getPlayerProfile();else if(r=await this.getProfileAsync(s),!r)throw new K;this.updateMatchData(r,t),await this.nextAsync(t)}getPlayerProfile(){const{player:t}=this.game,{playerId:s,name:n,photo:i,locale:r}=t.getPlayer();return{playerId:s,name:n,photo:i,locale:r}}async getProfileAsync(t){const{profile:s}=this.game;return await s.requestProfiles([t]),s.getProfiles()[t]}updateMatchData(t,s){const{playerId:n,name:i,photo:r}=t,c=new Hy.Match.Profile({id:n,name:i,photo:r}).toObject();s.profiles[n]=c}};o(Yo,"GetProfileHandler");let Et=Yo;const Xo=class Xo extends P{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new T(this),n=new Jt(this,{contextId:"SOLO"});s.setNext(n);const i=new U(this,{id:"234567",mode:Q.ENDLESS,customData:{playerId:t}});n.setNext(i);const r=new J(this);i.setNext(r);const c=new Et(this,{profileId:t});r.setNext(c);const l=new z(this);c.setNext(l);const d=new _(this);l.setNext(d);const h=this.match.getMatchState();await s.processAsync(h)}finally{this.endLog()}}};o(Xo,"StartEndlessConcrete");let La=Xo;const{Valid:qy}=g.Utils,Jo=class Jo extends Zt{constructor(e){super(e,{score:0,leaderboardId:""})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:n,leaderboardId:i}=s;if(!i)throw new Ft;if(!n||!t[n])throw new K;const{score:r}=t[n];if(!qy.isNumber(r))throw new Qt;this.payload.score=r,this.payload.leaderboardId=i,super.setupSetScorePayload(e)}};o(Jo,"PostLeaderboardScoreHandler");let ve=Jo;const Qo=class Qo extends I{async processAsync(e){super.processAsync(e),this.validateData(e),this.progressSendGroupMessage(e),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new X;if(!i||typeof i!="string")throw new F}async createWideframesResultGroupAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0}=c,{photo:u,score:p=0}=l;return await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:u,opponentScore:p,isPlayerFinished:!0,isOpponentFinished:!0})}catch(t){return console.warn("createWideframesResultGroupAsync",t),null}}async createWideframesBestScoreAsync(e){try{const{player:t,frameCapture:s}=this.game,{playerId:n}=e.customData,{playerId:i,photo:r,data:c}=t.getPlayer();if(n!==i)return null;const{score:l}=c||{};return await s.wideframe.renderShareScore({playerId:i,playerPhoto:r,playerScore:l})}catch(t){return console.warn("createWideframesBestScoreAsync",t),null}}async progressSendGroupMessage(e){const{profiles:t,customData:s}=e,{playerId:n,opponentId:i}=s;if(i&&typeof i=="string"){if(!n||typeof n!="string")throw new D;const{score:c=0}=t[n]||{},{score:l=0}=t[i]||{};if(c>l){const d=await this.createWideframesResultGroupAsync(e);if(!d)return;this.sendBestScoreMessageAsync(e,d);return}}const r=await this.createWideframesBestScoreAsync(e);r&&this.sendChallengeMessageAsync(e,r)}async sendBestScoreMessageAsync(e,t){const{profiles:s,customData:n}=e,{playerId:i}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");const{name:r,score:c}=s[i],d={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:i,playerName:r,playerScore:c},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chi"}},text:{default:`${r} beats your high score. Their score: ${c}.`,localizations:{vi_VN:`${r} va vt im s cao nht ca bn! Chi ln na ch?`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");await GameSDK.extra.updateAsync(d)}async sendChallengeMessageAsync(e,t){const{profiles:s,customData:n}=e,{playerId:i}=n;if(!i||typeof i!="string")throw new D;const{name:r,score:c}=s[i],d={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:i,playerName:r,playerScore:c},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:`${r} got ${c} scores. So easy! Can you?`,localizations:{vi_VN:`${r}  t ${c} im! Qu d lun. Chi li no!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new v("updateAsync");await GameSDK.extra.updateAsync(d)}};o(Qo,"SendGroupMessageHandler");let $a=Qo;const Zo=class Zo extends P{async processAsync(){try{this.startLog();const e=new T(this),t=new Ut(this,{useAPI:!1});e.setNext(t);const s=new $a(this);t.setNext(s);const n=new $t(this);s.setNext(n);const i=new te(this);n.setNext(i);const r=new ve(this);i.setNext(r);const c=new _(this);r.setNext(c);const l=this.match.getMatchState();await e.processAsync(l)}finally{this.endLog()}}};o(Zo,"FinishGroupConcrete");let Fa=Zo;const{Dtos:Yy}=g,tc=class tc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateProfileMatchData(t),await this.nextAsync(t)}updateProfileMatchData(t){const{id:s}=this.payload,{profiles:n}=t;if(!n[s])throw new K;const i={...n[s],...this.payload},r=new Yy.Match.Profile(i).toObject();n[r.id]=r}};o(tc,"SetProfileDataHandler");let ee=tc;const ec=class ec extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s,opponentScore:n}=e,i=new T(this),r=new U(this,{id:"7749",mode:Q.MATCHING_GROUP,customData:{playerId:t,opponentId:s}});i.setNext(r);const c=new pt(this);r.setNext(c);const l=new ee(this,{id:t,score:n});c.setNext(l);const d=new J(this);l.setNext(d);const h=new z(this);d.setNext(h);const u=new _(this);h.setNext(u);const p=this.match.getMatchState();await i.processAsync(p)}finally{this.endLog()}}};o(ec,"JoinGroupConcrete");let Ua=ec;const sc=class sc extends Error{constructor(e){super(e),this.name="MatchGroupNotSupported",this.message=e??"Match group is not supported"}};o(sc,"MatchGroupNotSupported");let us=sc;const{String:Xy}=g.Utils,nc=class nc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.checkMatchGroupSupported();const s=this.getMatchTag(),n=await this.matchingGroup(s);t.customData.contextId=n,await this.nextAsync(t)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new v("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new v("checkCanPlayerMatchAsync");if(!GameSDK.getSupportedAPIs().includes("checkCanPlayerMatchAsync"))throw new us;if(!await GameSDK.extra.checkCanPlayerMatchAsync())throw new us}getMatchTag(){const{locale:t}=this.payload;let s="global";if(t){const n=Xy.getLanguageCode(t);n==="en"&&(s="en"),n==="in"&&(s="in")}return s}async matchingGroup(t){if(!("matchPlayerAsync"in GameSDK.extra))throw new v("matchPlayerAsync");await GameSDK.extra.matchPlayerAsync(t,!0,!0);const s=GameSDK.context.getID();if(typeof s!="string")throw new be;return s}};o(nc,"GroupContextHandler");let ka=nc;const ac=class ac extends P{async processAsync(e){try{this.startLog(e);const{locale:t,playerId:s}=e,n=new T(this),i=new ka(this,{locale:t});n.setNext(i);const r=new U(this,{id:"7749",mode:Q.MATCHING_GROUP,customData:{playerId:s}});i.setNext(r);const c=new J(this);r.setNext(c);const l=new Et(this,{profileId:s});c.setNext(l);const d=new z(this);l.setNext(d);const h=new _(this);d.setNext(h);const u=this.match.getMatchState();await n.processAsync(u)}finally{this.endLog()}}};o(ac,"StartGroupConcrete");let Ba=ac;const ic=class ic extends P{async processAsync(){try{this.startLog();const e=new T(this),t=new Ut(this,{useAPI:!1});e.setNext(t);const s=new $t(this);t.setNext(s);const n=new te(this);s.setNext(n);const i=new Ee(this);n.setNext(i);const r=new _(this);i.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}};o(ic,"FinishSingleConcrete");let Va=ic;const rc=class rc extends P{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new T(this),n=new Jt(this,{contextId:"SOLO"});s.setNext(n);const i=new U(this,{id:"123456",mode:Q.SINGLE,customData:{playerId:t}});n.setNext(i);const r=new J(this);i.setNext(r);const c=new Et(this,{profileId:t});r.setNext(c);const l=new z(this);c.setNext(l);const d=new _(this);l.setNext(d);const h=this.match.getMatchState();await s.processAsync(h)}finally{this.endLog()}}};o(rc,"StartSingleConcrete");let Ga=rc;const{Plugins:Jy,Utils:Qy}=g,{Analytics:Zy}=Jy,{String:tm,Valid:em}=Qy,oc=class oc extends I{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e;this.validateMode(t);const{analytics:n}=this.game,{tournamentId:i,leaderboardId:r}=s;n.event(Zy.Events.TOURNAMENT_START,{success:!0,game_mode:tm.toUpperCamelCase(t),tournament_id:i,leaderboard_id:r}),await this.nextAsync(e)}validateMode(e){if(!em.isString(e))throw new we}};o(oc,"LogTournamentStartHandler");let fs=oc;const cc=class cc extends Error{constructor(e){super(e),this.name="TournamentIdNotValid",this.message=e??"Tournament id is not valid"}};o(cc,"TournamentIdNotValid");let ps=cc;const{Valid:Js}=g.Utils,lc=class lc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;this.validateContextId(s);const n=await GameSDK.getTournamentAsync(),i=n.getID().toString();this.validateTournamentId(i);const r=JSON.parse(n.getPayload()||"{}"),{leaderboardId:c}=r;this.validateLeaderboardId(c),t.customData.contextId=s,t.customData.tournamentId=i,t.customData.leaderboardId=c,await this.nextAsync(t)}validateContextId(t){if(!Js.isString(t))throw new X}validateTournamentId(t){if(!Js.isString(t))throw new ps}validateLeaderboardId(t){if(!Js.isString(t)||t==="")throw new Ft}};o(lc,"ContinueTournamentHandler");let ja=lc;const dc=class dc extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,contextId:s}=e,n=new T(this),i=new ja(this,{contextId:s});n.setNext(i);const r=new U(this,{id:"1997",mode:Q.TOURNAMENT,customData:{playerId:t}});i.setNext(r);const c=new J(this);r.setNext(c);const l=new Et(this,{profileId:t});c.setNext(l);const d=new z(this);l.setNext(d);const h=new fs(this);d.setNext(h);const u=new _(this);d.setNext(u);const p=this.match.getMatchState();await n.processAsync(p)}finally{this.endLog()}}};o(dc,"ContinueTournamentConcrete");let za=dc;const{Plugins:sm}=g,{Analytics:nm}=sm,hc=class hc extends I{async processAsync(e){super.processAsync(e);const{customData:t}=e,{analytics:s}=this.game,{tournamentId:n,leaderboardId:i}=t;s.event(nm.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:n,leaderboard_id:i}),await this.nextAsync(e)}};o(hc,"LogTournamentCreateHandler");let Ka=hc;const uc=class uc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.createTournamentAsync(),await this.updateMatchStateAsync(t),await this.nextAsync(t)}async createTournamentAsync(){const{name:t,score:s,customData:n}=this.payload;await GameSDK.tournament.createAsync({initialScore:s,config:{title:t,tournamentTitle:t},data:n})}async updateMatchStateAsync(t){try{if(!("getTournamentAsync"in GameSDK))throw new v("getTournamentAsync");const s=await GameSDK.getTournamentAsync(),n=s.getContextID(),i=s.getID().toString(),{playerId:r}=this.payload;t.customData.playerId=r,t.customData.contextId=n,t.customData.tournamentId=i}catch(s){if(s instanceof v)return}}};o(uc,"CreateTournamentHandler");let Wa=uc;const{Valid:Gl}=g.Utils,fc=class fc extends I{constructor(t,s){super(t);f(this,"payload");f(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.validatePayload(),await this.setupCreatePayload(t),await this.createLeaderboardAsync(t),await this.nextAsync(t)}validatePayload(){const{leaderboardId:t}=this.payload;if(!Gl.isString(t))throw new Ft}validatePlayerId(t){if(!Gl.isString(t))throw new D}async setupCreatePayload(t){const{playerId:s}=t.customData;this.validatePlayerId(s);const{name:n,leaderboardId:i,customData:r}=this.payload;this.leaderboardPayload={_id:i,name:n??"",createdBy:s,description:JSON.stringify(r)}}async createLeaderboardAsync(t){const s=await this.game.leaderboard.createLeaderboardAsync(this.leaderboardPayload);t.customData.leaderboardId=s}};o(fc,"CreateLeaderboardHandler");let Ha=fc;const pc=class pc extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,name:s,score:n,leaderboardId:i,payload:r}=e,c=new T(this),l=new Jt(this,{contextId:"SOLO"});c.setNext(l);const d=new Wa(this,{name:s,score:n,playerId:t,customData:r});l.setNext(d);const h=new Et(this,{profileId:t});d.setNext(h);const u=new ee(this,{id:t,score:n});h.setNext(u);const p=new Ha(this,{name:s,customData:r,leaderboardId:i});u.setNext(p);const y=new ve(this);p.setNext(y);const w=new Ka(this);y.setNext(w);const A=this.match.getMatchState();await c.processAsync(A)}finally{this.endLog()}}};o(pc,"CreateTournamentConcrete");let qa=pc;const{Analytics:jl}=g.Plugins,{Valid:am}=g.Utils,gc=class gc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t),await this.postScoreTournamentAsync(t),await this.nextAsync(t)}validateData(t){const{profiles:s,customData:n}=t,{playerId:i}=n;if(this.validatePlayerId(i),!s[i])throw new K}validatePlayerId(t){if(!am.isString(t))throw new D}getPlayerProfile(t){const{profiles:s,customData:n}=t,{playerId:i}=n;return this.validatePlayerId(i),s[i]}isNewBestScore(t){const s=this.getPlayerProfile(t),{score:n=0,bestScore:i=0}=s;return n>i}async postScoreTournamentAsync(t){const{analytics:s}=window.game,n=this.getPlayerProfile(t),{score:i=0}=n;let r=null,c=!1;const{checkBestScore:l}=this.payload,d=this.isNewBestScore(t);try{if(!("getTournamentAsync"in GameSDK))throw new v("getTournamentAsync");await GameSDK.getTournamentAsync(),!l||d?(r=jl.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:i})):(r=jl.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(i)),c=!0}catch(h){console.warn("Post Score Tournament",h)}finally{r&&s.event(r,{success:c})}}};o(gc,"PostScoreTournamentHandler");let Ya=gc;const yc=class yc extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,bestScore:s}=e,n=new T(this),i=new Ut(this,{useAPI:!1});n.setNext(i);const r=new ee(this,{id:t,bestScore:s});i.setNext(r);const c=new Ya(this,{checkBestScore:!1});r.setNext(c);const l=new $t(this);c.setNext(l);const d=new te(this);l.setNext(d);const h=new ve(this);d.setNext(h);const u=new Ee(this);h.setNext(u);const p=new _(this);u.setNext(p);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};o(yc,"FinishTournamentConcrete");let Xa=yc;const{Valid:Qs,Object:im}=g.Utils,mc=class mc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{tournamentId:s}=this.payload;this.validateTournamentId(s),await this.joinTournamentAsync(s);const n=await GameSDK.getTournamentAsync(),i=n.getContextID();this.validateContextId(i);const r=JSON.parse(n.getPayload()||"{}"),{leaderboardId:c}=r;this.validateLeaderboardId(c),t.customData.contextId=i,t.customData.tournamentId=s,t.customData.leaderboardId=c,await this.nextAsync(t)}validateTournamentId(t){if(!Qs.isString(t))throw new ps}validateContextId(t){if(!Qs.isString(t))throw new X}validateLeaderboardId(t){if(!Qs.isString(t)||t==="")throw new Ft}async joinTournamentAsync(t){if(!("tournament"in GameSDK))throw new v("tournament");try{await GameSDK.tournament.joinAsync(t)}catch(s){if(!im.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}};o(mc,"JoinTournamentHandler");let Ja=mc;const wc=class wc extends P{async processAsync(e){try{this.startLog(e);const{playerId:t,tournamentId:s}=e,n=new T(this),i=new Ja(this,{tournamentId:s});n.setNext(i);const r=new U(this,{id:"1997",mode:Q.TOURNAMENT,customData:{playerId:t}});i.setNext(r);const c=new J(this);r.setNext(c);const l=new Et(this,{profileId:t});c.setNext(l);const d=new z(this);l.setNext(d);const h=new fs(this);d.setNext(h);const u=new _(this);h.setNext(u);const p=this.match.getMatchState();await n.processAsync(p)}finally{this.endLog()}}};o(wc,"JoinTournamentConcrete");let Qa=wc;const{Dtos:rm,Utils:om}=g,{Object:cm}=om,Ac=class Ac extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateMatchCustomData(t),await this.nextAsync(t)}updateMatchCustomData(t){const s=cm.merge(t.customData,this.payload),n=new rm.Match.CustomData(s).toObject();t.customData=n}};o(Ac,"SetMatchCustomDataHandler");let Za=Ac;const lm={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:{...xi}},{Configs:zl}=g,Ic=class Ic extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"base");f(this,"group");f(this,"single");f(this,"endless");f(this,"context");f(this,"challenge");f(this,"tournament");f(this,"api");f(this,"handler");f(this,"useCPUProfile")}init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}setUseCPUProfile(t){this.useCPUProfile=t}createMatchData(){const{storage:t}=this.game;t.addStorage("match",lm)}getMatchState(){const{storage:t}=this.game;return t.getStorage("match")}createBaseConcrete(){this.base=new P(this.game,this)}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createConcreteHandlers(){this.handler={setProfileData:async t=>{const s=new ee(this.base,t);await this.processHandlerAsync(s)},setMatchCustomData:async t=>{const s=new Za(this.base,t);await this.processHandlerAsync(s)},setLeaderboardScore:async t=>{const s=new Zt(this.base,t);await this.processHandlerAsync(s)}}}createAPIHandler(){const t={appId:zl.AppId,matchAPIHost:zl.ApiHost};this.api=new ea(t)}createGroupFlows(){this.group={join:new Ua(this.game,this),start:new Ba(this.game,this),finish:new Fa(this.game,this)}}createSingleFlows(){this.single={start:new Ga(this.game,this),finish:new Va(this.game,this)}}createEndlessFlows(){this.endless={start:new La(this.game,this),finish:new Ma(this.game,this)}}createContextFlows(){this.context={choose:new xa(this.game,this)}}createChallengeFlows(){this.challenge={invite:new Aa(this.game,this),friend:new oa(this.game,this),join:new va(this.game,this),await:new ia(this.game,this),result:new _a(this.game,this),finish:new fa(this.game,this),continue:new da(this.game,this)}}createTournamentFlows(){this.tournament={join:new Qa(this.game,this),create:new qa(this.game,this),finish:new Xa(this.game,this),continue:new za(this.game,this)}}processHandlerAsync(t){const s=this.getMatchState();return t.processAsync(s)}};o(Ic,"MatchPlugin");let ti=Ic;const{Valid:Dt}=g.Utils,St="is invalid",bc=class bc extends L{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!Dt.isNumber(e)||!e)&&this.exception("level",St)}validateRescued(e){(!Dt.isNumber(e)||e<0)&&this.exception("rescued",St)}validateContextId(e){Dt.isString(e)||this.exception("contextId",St)}validatePlayerId(e){Dt.isString(e)||this.exception("playerId",St)}validateOpponentId(e){Dt.isString(e)||this.exception("opponentId",St)}validateTournamentId(e){Dt.isString(e)||this.exception("tournamentId",St)}validateLeaderboardId(e){Dt.isString(e)||this.exception("leaderboardId",St)}toObject(){return super.toObject()}static getDefaultData(){return L.getDefaultData()}};o(bc,"MatchCustomDataDtos");let gs=bc;gs.addDefaultData(xi);const{Valid:yt}=g.Utils,mt="is invalid",Ec=class Ec extends L{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!yt.isString(e)||!e)&&this.exception("id",mt)}validateName(e){(!yt.isString(e)||!e)&&this.exception("name",mt)}validatePhoto(e){yt.isString(e)||this.exception("photo",mt)}validateScore(e){(!yt.isNumber(e)||e<0)&&this.exception("score",mt)}validateBestScore(e){(!yt.isNumber(e)||e<0)&&this.exception("bestScore",mt)}validateEndlessScore(e){(!yt.isNumber(e)||e<0)&&this.exception("endlessScore",mt)}validateBestEndlessScore(e){(!yt.isNumber(e)||e<0)&&this.exception("bestEndlessScore",mt)}validateFinished(e){yt.isBoolean(e)||this.exception("finished",mt)}toObject(){return super.toObject()}static getDefaultData(){return L.getDefaultData()}};o(Ec,"MatchProfileDtos");let ys=Ec;ys.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0});g.Dtos.Match={Data:Se,CustomData:gs,Profile:ys};const{Utils:dm}=g,{ApiHost:hm}=g.Configs,um=o(async a=>{const e=await B("players",a,{},hm,10);return dm.Object.hasOwn(e,"data")?e.data||{}:{}},"updatePlayerProfileAsync"),{Utils:fm,Configs:pm}=g,{AppId:gm}=pm,{Array:ym,Object:Ge,Valid:mm}=fm,Dc=class Dc extends N.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("player",Ht)}async saveToCloud(){try{const e=this.getPlayerData();await GameSDK.player.setDataAsync(e)}catch(e){console.warn(e)}}receiveData(e,t){const{storage:s}=this.game,{playerId:n,name:i,photo:r,locale:c}=e;s.setStorageData("player","playerId",n),s.setStorageData("player","name",i),s.setStorageData("player","photo",r),s.setStorageData("player","locale",c),t&&this.setPlayerData(t)}async syncProfileToServer(){const{storage:e}=this.game,t=this.getPlayer(),{playerId:s,name:n,photo:i,locale:r}=t;let c=this.getPlayerASID();!mm.isString(c)&&"getASIDAsync"in GameSDK.player&&(c=await GameSDK.player.getASIDAsync()??c,e.setStorageData("player","ASID",`${c}`)),await um({appId:gm,ASID:c,playerId:s,name:n,photo:i,locale:r})}setPlayerDataByName(e,t){this.setPlayerData({[e]:t})}setPlayerData(e){const{storage:t}=this.game;t.setStorageData("player","data",e),this.saveToCloud()}setBestScore(e){this.setPlayerDataByName("score",e)}setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}setSetting(e,t){this.setPlayerDataByName("settings",{[e]:t})}setGameData(e){const t=this.getGameData()??{},s=Ge.merge(t,e);this.setPlayerDataByName("gameData",s)}async requestConnectedPlayers(){const{storage:e}=this.game,s=(await GameSDK.player.getConnectedPlayersAsync()).map(r=>{const c=r.getID(),l=r.getName(),d=r.getPhoto();return!c||!l||!d?null:new qt({playerId:c,name:l,photo:d}).toObject()}),n=ym.unique(s);if(n.length<1)return;const i=Ge.keyBy(n,"playerId");e.setStorageData("player","connectedPlayers",i)}getPlayer(){const{storage:e}=this.game;return e.getStorage("player")}getPlayerId(){const{storage:e}=this.game;return e.getStorageData("player","playerId")}getPlayerASID(){const{storage:e}=this.game;return e.getStorageData("player","ASID")}getPlayerLocale(){const{storage:e}=this.game;return e.getStorageData("player","locale")}getPlayerData(){const{storage:e}=this.game;return e.getStorageData("player","data")}getPlayerDataByKey(e){const t=this.getPlayerData();return Ge.hasOwn(t,e)?t[e]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(e){const t=this.getPlayerSettings();return Ge.hasOwn(t,e)?t[e]:null}getPlayerSettings(){const{settings:e}=this.getPlayerData();return e}isFirstLogin(){return this.getPlayerDataByKey("isFirstLogin")??Ht.data.isFirstLogin}loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}getBestScore(){const{score:e}=this.getPlayerData();return e}getBestEndlessScore(){const{endlessScore:e}=this.getPlayerData();return e}getConnectedPlayers(){const{storage:e}=this.game;return e.getStorageData("player","connectedPlayers")}getConnectedPlayerIds(e,t){const s=this.getConnectedPlayers();return Object.keys(s).slice(t,t+e)}};o(Dc,"PlayerPlugin");let ei=Dc;const{Dtos:Kl,Utils:wm}=g,{Valid:Bt}=wm,{score:oh,endlessScore:Am,settings:Im,gameData:bm,isFirstLogin:Em,dailyRewarded:Dm}=Ht.data,Vt="is invalid",Sc=class Sc extends L{processData(e){this.validateStructure(e),e.settings=new Kl.Player.Settings(e.settings).toObject(),e.gameData=new Kl.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateScore(e){(!Bt.isNumber(e)||e<0)&&this.exception("score",Vt)}validateEndlessScore(e){(!Bt.isNumber(e)||oh<0)&&this.exception("endlessScore",Vt)}validateSettings(e){Bt.isObject(e)||this.exception("settings",Vt)}validateGameData(e){Bt.isObject(e)||this.exception("gameData",Vt)}validateIsFirstLogin(e){Bt.isBoolean(e)||this.exception("isFirstLogin",Vt)}validateDailyRewarded(e){Bt.isObject(e)||this.exception("dailyRewarded",Vt)}toObject(){return super.toObject()}};o(Sc,"PlayerDataDtos");let ms=Sc;ms.addDefaultData({score:oh,endlessScore:Am,settings:Im,gameData:bm,isFirstLogin:Em,dailyRewarded:Dm});const{Valid:Wl}=g.Utils,{level:Sm,coins:vm}=Ht.data.gameData,vc=class vc extends L{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!Wl.isNumber(e)||e<0)&&this.exception("level","is invalid")}validateCoins(e){(!Wl.isNumber(e)||e<0)&&this.exception("coins","is invalid")}toObject(){return super.toObject()}};o(vc,"PlayerGameDataDtos");let ws=vc;ws.addDefaultData({level:Sm,coins:vm});const{Valid:je}=g.Utils,{sound:Pm,music:Cm,vibrate:Tm,language:_m}=Ht.data.settings,ze="is invalid",Pc=class Pc extends L{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateSound(e){je.isBoolean(e)||this.exception("sound",ze)}validateMusic(e){je.isBoolean(e)||this.exception("music",ze)}validateVibrate(e){je.isBoolean(e)||this.exception("vibrate",ze)}validateLanguage(e){(!je.isString(e)||!e)&&this.exception("language",ze)}toObject(){return super.toObject()}};o(Pc,"PlayerSettingsDtos");let As=Pc;As.addDefaultData({sound:Pm,music:Cm,vibrate:Tm,language:_m});g.Dtos.Player={Info:qt,Data:ms,Settings:As,GameData:ws};const{Configs:xm,Utils:Nm}=g,{Object:Om,String:Mm}=Nm,{ApiHost:Rm,Mockup:Lm}=xm,Cc=class Cc{constructor(){f(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await dt(()=>import("./bundle/empty-script.js"),__vite__mapDeps([]),import.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load ProfileAPIMock");this.mockAPI=new e}async getPlayersAsync(e){const t=Mm.params(e);let s;return Lm.Profile.Enabled?(await this.initMockAPI(),s=await this.mockAPI.getPlayersAsync(e)):s=await Kt(`players?${t}`,{},Rm),!Om.hasOwn(s,"data")||!Array.isArray(s.data)?[]:s.data}};o(Cc,"ProfileAPI");let si=Cc;const $m={profiles:{},profileIds:[]},{Utils:Fm,Dtos:Um}=g,{Array:km,Valid:Bm,Object:Vm}=Fm,Tc=class Tc extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"profileAPI",new si)}init(){const{storage:t}=this.game;t.addStorage("profile",$m)}async requestProfiles(t){const s=this.getProfileIds(),n=km.difference(t,s);if(n.length<1)return;const i=await this.profileAPI.getPlayersAsync({playerIds:n});if(!this.validateProfilesResponse(i))return;const r=this.convertToProfiles(i);this.setProfiles(r)}getProfile(t){return this.getProfiles()[t]??null}getProfiles(){const{storage:t}=this.game;return t.getStorageData("profile","profiles")}setProfiles(t){const{storage:s}=this.game;s.setStorageData("profile","profiles",t),s.setStorageData("profile","profileIds",Object.keys(t))}getProfileIds(){const{storage:t}=this.game;return t.getStorageData("profile","profileIds")}validateProfilesResponse(t){return!(!Array.isArray(t)||t.length<1)}convertToProfiles(t){const s={};return t.forEach(n=>{Vm.hasOwn(n,"playerId")&&Bm.isString(n.playerId)&&(s[n.playerId]=new Um.Player.Info(n).toObject())}),s}};o(Tc,"ProfilePlugin");let ni=Tc;const{Valid:Ke,Object:Hl}=g.Utils,{Ads:ch,Gameplay:lh}=g.Configs,We="is invalid",_c=class _c extends L{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateAds(e){Ke.isObject(e)||this.exception("ads",We),this.validateCommonData(e,ch)}validateGameplay(e){Ke.isObject(e)||this.exception("gameplay",We),this.validateCommonData(e,lh)}validateCommonData(e,t){Object.keys(e).forEach(s=>{if(!Hl.hasOwn(e,s))return;Hl.hasOwn(t,s)||this.exception(`the "${s}" key`,We);const n=e[s],i=t[s];typeof n!=typeof i&&this.exception("value",We),Ke.isObject(n)&&Ke.isObject(i)&&this.validateCommonData(n,i)})}toObject(){return super.toObject()}};o(_c,"GameCoreConfigDtos");let Pe=_c;Pe.addDefaultData({Ads:ch,Gameplay:lh});const{Valid:He,Object:Gm}=g.Utils,xc=class xc extends L{setupData(e){this.lazySetupData(e)}validateStructure(e){}validateData(e){this.validateCommonData(e)}validateCommonData(e,t=!0){Object.keys(e).forEach(s=>{if(!Gm.hasOwn(e,s))return;const n=e[s];!He.isBoolean(n)&&!He.isNumber(n)&&!He.isString(n)&&this.exception("value","is invalid"),He.isObject(n)&&this.validateCommonData(n,!1),t&&Object.assign(this,{[s]:n})})}toObject(){return super.toObject()}};o(xc,"GamePlayConfigDtos");let Ce=xc;Ce.addDefaultData({});const{Valid:Gt,Object:ql}=g.Utils,vt="is invalid",Nc=class Nc extends L{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!Gt.isString(e)||!e)&&this.exception("id",vt);const{remoteConfig:t}=window.game;return t.isRemoteConfigId(e)}validateType(e){(!Gt.isString(e)||!e)&&this.exception("type",vt),["GameCore","Gameplay"].includes(e)||this.exception("type",vt)}validateInfo(e){(!Gt.isObject(e)||!e)&&this.exception("info",vt),(!ql.hasOwn(e,"version")||!Gt.isString(e.version)||!e.version)&&this.exception("info.version",vt),(!ql.hasOwn(e,"createdAt")||!Gt.isString(e.createdAt)||!e.createdAt)&&this.exception("info.createdAt",vt)}validateConfig(e){Gt.isObject(e)||this.exception("config",vt)}toObject(){return super.toObject()}};o(Nc,"RemoteConfigDataDtos");let Te=Nc;Te.addDefaultData({id:"default",type:"GameCore",info:{version:"1.0.0",priority:100,createdAt:"unknown"},config:{}});const Oc=class Oc{constructor(e){f(this,"game");f(this,"plugin");f(this,"data");this.plugin=e,this.game=e.game,this.data=[]}getConfigById(e){return this.data.filter(s=>s.id===e)[0]}getConfigByVersion(e){return this.data.filter(s=>s.info.version===e)[0]}getConfigByLatestVersion(){return this.data.sort((t,s)=>t.info.createdAt.localeCompare(s.info.createdAt))[0]}getConfigByPriority(e){return this.data.filter(s=>s.info.priority<=e)[0]}};o(Oc,"BaseHandler");let _e=Oc;const{Valid:qe}=g.Utils,Mc=class Mc extends _e{constructor(t){super(t);f(this,"firebaseRemoteConfig");this.initialize()}initialize(){const{services:t}=this.game.firebase;if(!t.remoteConfig)throw new Error("FirebaseHandler: Firebase Remote Config is not initialized");this.firebaseRemoteConfig=t.remoteConfig}async fetchConfig(t){await this.firebaseRemoteConfig.fetchDataAsync();const s=this.getConfig(t);if(!s)throw new Error("FirebaseHandler: Parse data failed");return s}getConfig(t){const{id:s,type:n,conditions:i}=t;let r=null;if(this.data=[],r=this.getResultByType(n),console.log("Get config from remote",r),!r)return null;const{data:c}=r;if(!c||c.length===0)return null;if(this.data=c,s)return this.getConfigById(s);let l=null;return qe.isObject(i)&&(l=this.getConfigByConditions(i)),l||this.getConfigByLatestVersion()}getResultByType(t){switch(t){case"GameCore":return this.firebaseRemoteConfig.getDataByKey("gamecore_configs");case"Gameplay":return this.firebaseRemoteConfig.getDataByKey("gameplay_configs");default:return null}}getConfigByConditions(t){const{latest:s,version:n,priority:i}=t;return qe.isString(n)?this.getConfigByVersion(n):qe.isNumber(i)?this.getConfigByPriority(i):qe.isBoolean(s)?this.getConfigByLatestVersion():null}};o(Mc,"FirebaseHandler");let ai=Mc;const Rc=class Rc extends _e{async fetchConfig(e){const{id:t,type:s,conditions:n}=e;await g.Utils.Time.sleepAsync(800);let i=null;switch(s){case"GameCore":i=await this.requestGameCoreConfig(t,n);break;case"Gameplay":i=await this.requestGamePlayConfig(t,n);break;default:console.warn("fetchConfig: Invalid type",s);break}return i}async requestGameCoreConfig(e,t){if(this.data=(await dt(()=>import("./bundle/mock-gamecore-configs.js"),__vite__mapDeps([]),import.meta.url)).default,e)return this.getConfigById(e);const{version:s}=t??{};return s?this.getConfigByVersion(s):this.getConfigByLatestVersion()}async requestGamePlayConfig(e,t){if(this.data=(await dt(()=>import("./bundle/mock-gameplay-configs.js"),__vite__mapDeps([]),import.meta.url)).default,e)return this.getConfigById(e);const{latest:s,version:n,priority:i}=t??{};return n?this.getConfigByVersion(n):i?this.getConfigByPriority(i):s?this.getConfigByLatestVersion():this.getConfigByLatestVersion()}};o(Rc,"MockupHandler");let ii=Rc;const Lc=class Lc extends _e{async fetchConfig(e){const{type:t}=e,s=null;switch(t){case"GameCore":break;case"Gameplay":break;default:console.warn("fetchConfig: Invalid type",t);break}return s}};o(Lc,"SelfHostedHandler");let ri=Lc;const jm={fetchStatus:"idle",changes:[],remoteConfigs:{GameCore:{},Gameplay:{}}},$c=class $c extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"enabled");f(this,"config");f(this,"handler");f(this,"timer");f(this,"handleFetchConfig",o(()=>{!this.enabled||this.getFetchStatus()==="fetching"||(this.fetchLatestConfigAsync("GameCore").then(s=>{s&&this.processUpdateConfig(s,"GameCore")}),this.fetchLatestConfigAsync("Gameplay").then(s=>{s&&this.processUpdateConfig(s,"Gameplay")}))},"handleFetchConfig"));f(this,"handleRemoteConfigUpdated",o(async t=>{if(!this.enabled)return;const{id:s,type:n}=t??{};if(this.checkChange(s,"updated"))return;const i=this.getRemoteConfig(s,n);if(!i)return;const{event:r}=this.game;r.emit(st.REQUEST_SAVE_CONFIG,i),this.pushChange(s,"updated")},"handleRemoteConfigUpdated"))}init(){const{storage:t}=this.game;t.addStorage("remoteConfig",jm)}configure(t){this.config=t,this.enabled=this.config.Enabled,this.listenEvents(),this.createHandler(),this.initAutoFetch()}isRemoteConfigId(t){/^[a-zA-Z0-9_-]+$/.test(`${t}`)||this.exception("id","is invalid")}isRemoteConfigStored(t,s){return!!this.getRemoteConfig(t,s)}listenEvents(){const{event:t}=this.game;t.on(st.REMOTE_CONFIG_UPDATED,this.handleRemoteConfigUpdated)}createHandler(){const{ServiceType:t}=this.config;switch(t){case"mockup":this.handler=new ii(this);break;case"firebase":this.handler=new ai(this);break;case"selfHosted":this.handler=new ri(this);break;default:console.warn("RemoteConfigPlugin: Invalid service type"),this.enabled=!1}}initAutoFetch(){if(!this.enabled)return;const{FetchIntervalInSeconds:t}=this.config.Options;if(t<=0)return;clearInterval(this.timer);const s=1e3;this.handleFetchConfig(),this.timer=setInterval(this.handleFetchConfig,t*s)}async fetchConfigAsync(t){if(!this.enabled)return!1;try{const{id:s,type:n}=t;this.config.SupportedDataTypes.indexOf(n)===-1&&this.exception(`"${n}" type`,"is unsupported"),s&&this.isRemoteConfigStored(s,n)&&this.exception(`"${s}" id`,"is stored"),this.setFetchStatus("fetching");const i=await this.handler.fetchConfig(t);console.info("[fetchConfigAsync]",i);const r=new Te(i).toObject();let c;switch(r.type){case"GameCore":c=new Pe(r.config).toObject();break;case"Gameplay":c=new Ce(r.config).toObject();break}return r.config=c,this.setRemoteConfig(r),this.setFetchStatus("success"),r.id}catch(s){return console.warn("[fetchConfigAsync]",s),this.setFetchStatus("failure"),!1}}async fetchLatestConfigAsync(t){if(!this.enabled)return!1;try{return await this.fetchConfigAsync({type:t,conditions:{latest:!0}})}catch(s){return console.warn("[fetchLatestConfigAsync]",s),!1}}async fetchDefaultConfigAsync(t){if(!this.enabled)return!1;try{const{DefaultConfigId:s}=this.config;return this.isRemoteConfigId(s),this.fetchConfigAsync({id:s,type:t})}catch(s){return console.warn("[fetchDefaultConfigAsync]",s),!1}}processUpdateConfig(t,s){if(!this.enabled)return!1;try{const n=this.getRemoteConfig(t,s);return n||this.exception(`"${t}" id`,"is not stored"),this.checkChange(t,"updated")&&this.exception(`"${t}" id`,"is updated"),this.requestUpdateConfig(n),this.requestHotUpdate(t,n.type),this.pushChange(t,"requested"),!0}catch{return!1}}requestUpdateConfig(t){if(!this.enabled)return;const{event:s}=this.game;s.emit(st.REQUEST_UPDATE_CONFIG,t)}requestHotUpdate(t,s){if(!this.enabled)return;const{ForceReloadGame:n}=this.config.Options;if(!n)return;const{event:i}=this.game;i.emit(st.REQUEST_HOT_RELOAD,{id:t,type:s})}rollbackConfig(t,s){try{const n=this.getRemoteConfig(t,s);return n?(this.requestUpdateConfig(n),this.requestHotUpdate(t,n.type),this.pushChange(t,"rollback"),!0):!1}catch(n){return console.warn("[rollbackConfig]",n),!1}}setStorageData(t,s){const{storage:n}=this.game;n.setStorageData("remoteConfig",t,s)}getRemoteConfigs(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","remoteConfigs")}getRemoteConfig(t,s){return this.getRemoteConfigs()[s][t]||null}setRemoteConfig(t){const{id:s,type:n}=t;this.setStorageData("remoteConfigs",{[n]:{[s]:t}})}setFetchStatus(t){this.setStorageData("fetchStatus",t)}getFetchStatus(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","fetchStatus")}getChanges(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","changes")}pushChange(t,s){const n={id:t,actionStatus:s},i=this.getChanges();i.push(n),this.setStorageData("changes",i)}checkChange(t,s){const i=this.getChanges().findLast(r=>r.id===t);return i?i.actionStatus===s:!1}exception(t,s){throw new Error(`RemoteConfigPlugin: ${t} ${s}`)}};o($c,"RemoteConfigPlugin");let oi=$c;g.Dtos.RemoteConfig={Data:Te,GameCore:Pe,Gameplay:Ce};g.Dtos.Player.Data.addDefaultData({remoteConfig:{GameCore:{},Gameplay:{}}});g.Dtos.Player.Data.addValidateFunction("remoteConfig",a=>{const{Valid:e}=g.Utils;if(!e.isObject(a))throw new Error("remoteConfig is invalid");if(!("GameCore"in a))throw new Error("remoteConfig.GameCore is invalid");if(!("Gameplay"in a))throw new Error("remoteConfig.Gameplay is invalid")});const{Utils:Yl}=g,Fc=class Fc extends N.Plugins.BasePlugin{constructor(t){super(t);f(this,"storages");this.storages={}}addStorage(t,s){console.info("addStorage",t,s),this.storages[t]=s}setStorageData(t,s,n){let i;if(Yl.Valid.isObject(n)){const r=this.getStorageData(t,s);i=Yl.Object.merge(r,n)}else i=n;this.storages[t][s]=i}getStorageData(t,s){return this.getStorage(t)[s]}getStorage(t){return this.storages[t]}};o(Fc,"StoragePlugin");let ci=Fc;const Uc=class Uc extends N.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"isVisible",!0);f(this,"browserPrefixes",["moz","ms","o","","webkit"]);f(this,"handleVisibilityChange",o(t=>{if(["focus","blur"].includes(t))return t==="focus"?this.onVisibleEvent():this.onHiddenEvent();const n=this.getBrowserPrefix();return this.getHiddenPropertyName(n)in document?this.onHiddenEvent():this.onVisibleEvent()},"handleVisibilityChange"))}init(){const t=this.getBrowserPrefix();[this.getVisibilityEvent(t),"focus","blur"].forEach(i=>{window.addEventListener(i,()=>{this.handleVisibilityChange(i)},!1),document.addEventListener(i,()=>{this.handleVisibilityChange(i)},!1)})}isGameVisible(){return this.isVisible}getHiddenPropertyName(t){return t?t+"Hidden":"hidden"}getVisibilityEvent(t){return(t||"")+"visibilitychange"}getBrowserPrefix(){for(const t of this.browserPrefixes)if(this.getHiddenPropertyName(t)in document)return t;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(g.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(g.Events.VISIBILITY_HIDDEN))}};o(Uc,"VisibilityPlugin");let li=Uc;const kc=class kc extends rd{async loadAsync(){this.exception("Unsupported method")}async showAsync(){this.exception("This method is not implemented")}async hideAsync(){this.exception("This method is not implemented")}};o(kc,"BannerInstance");let di=kc;const{Status:Xl}=g.Plugins.Ads,Bc=class Bc extends di{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId),this.status=Xl.SHOWING}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId),this.status=Xl.IDLE}};o(Bc,"BannerAdInstance");let hi=Bc;const{Object:zm}=g.Utils,{Status:it,Types:jt,AdError:Ye,AdInstance:Km}=g.Plugins.Ads,Vc=class Vc extends Km{constructor(t,s){super(t,s);f(this,"instance");f(this,"instanceLoadFailedQueue",[]);this.instance=null}async loadAsync(){if(console.info("AdInstance","loadAsync called",{type:this.type,status:this.status}),this.status!==it.IDLE)throw new Ye("AD_NOT_READY","Ad is not ready.");try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new Ye("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.status=it.LOADING,await this.instance.loadAsync(),this.status=it.FILLED,console.info("AdInstance","loadAsync success",{type:this.type,status:this.status}),this.type===jt.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(),this.type===jt.REWARDED_VIDEO&&self.game.analytics.loadRewardedVideoAd()}catch(t){throw console.warn("AdInstance","loadAsync failed",{type:this.type,status:this.status,error:t}),this.status=it.IDLE,t instanceof Object&&"code"in t&&t.code==="INVALID_PARAM"&&(this.instance=null),this.instance&&this.instanceLoadFailedQueue.push(this.instance),self.game.analytics.loadAdFail(this.type),t}}async showAsync(){if(console.info("AdInstance","showAsync called",{type:this.type,status:this.status}),this.status!==it.FILLED)throw new Ye("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new Ye("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");let t=!1;try{this.status=it.SHOWING,await this.instance.showAsync(),t=!0,this.status=it.IDLE,this.instance=null,console.info("AdInstance","showAsync success",{type:this.type,status:this.status})}catch(s){throw console.warn("AdInstance","showAsync failed",{type:this.type,status:this.status,error:s}),this.status=it.FILLED,g.Utils.Object.hasOwn(s,"code")&&(s.code==="AD_NOT_LOADED"&&(this.status=it.IDLE),["USER_INPUT","INVALID_PARAM","INVALID_OPERATION"].includes(`${s.code}`)&&(this.status=it.IDLE,this.instance=null),s.code==="USER_INPUT"&&(t=!0)),s}finally{t?(this.type===jt.INTERSTITIAL&&self.game.analytics.showInterstitialAd(),this.type===jt.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd()):self.game.analytics.showAdFail(this.type)}}async createInstanceByType(t){try{switch(t){case jt.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case jt.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);default:return null}}catch(s){if(!zm.hasOwn(s,"code"))throw s;return s.code==="ADS_TOO_MANY_INSTANCES"?this.getAdInstanceFailed():null}}getAdInstanceFailed(){const{length:t}=this.instanceLoadFailedQueue,s=Math.floor(Math.random()*t);return this.instanceLoadFailedQueue[s]||null}};o(Vc,"NormalAdInstance");let Is=Vc;const{BaseAnalytics:Wm,Events:Jl}=g.Plugins.Analytics,Hm=[Jl.BUTTON_CLICK,Jl.SCREEN_OPEN],Gc=class Gc extends Wm{constructor(t,s){super(t,"FacebookAnalytics",{...s,color:"#0F52BA"});f(this,"prefix");this.prefix=s.prefix}processEvent(t,s){if(!("logEvent"in GameSDK.extra)||Hm.includes(t))return;const n=this.addPrefixToEventName(t);GameSDK.extra.logEvent(n,1,s)}addPrefixToEventName(t){return`${this.prefix}_${t}`}};o(Gc,"FacebookAnalytics");let ui=Gc;const{BaseAnalytics:qm,Events:Ym}=g.Plugins.Analytics,Xm=[Ym.SCREEN_OPEN],jc=class jc extends qm{constructor(e,t){super(e,"FirebaseAnalytics",{...t,color:"#FFCA28"})}setUser(e,t){var s;(s=this.game.firebase.services.analytics)==null||s.setUser(e,t)}processEvent(e,t){var s;Xm.indexOf(e)>=0||(s=this.game.firebase.services.analytics)==null||s.event(e,t)}};o(jc,"FirebaseAnalytics");let fi=jc;const{BaseAnalytics:Jm,Events:Qm}=g.Plugins.Analytics,Zm=[Qm.SCREEN_OPEN],zc=class zc extends Jm{constructor(e,t){super(e,"GoogleAnalytics",{...t,color:"#E35335"})}processEvent(e,t){Zm.indexOf(e)>=0||gtag("event",e,t)}};o(zc,"GoogleAnalytics");let pi=zc;const tw="production",Zs="3",{Dtos:ew,Events:zt,Configs:O,Utils:sw}=g,{Object:Ql,Json:oe,String:Zl,Valid:td,Mark:C}=sw,Kc=class Kc extends N.Game{constructor(){super(...arguments);f(this,"markName","Core Initialize");f(this,"modulePlugins",[]);f(this,"handleProtectGameInstance",o(()=>{const t=this.event.getEventEmitCount(st.MODULE_PLUGIN_READY),s=this.modulePlugins.length;t<s||(window.game=Object.freeze(window.game))},"handleProtectGameInstance"));f(this,"initMonitorErrorPlugin",o(()=>{if(!this.monitorError)return;const{MonitorError:t}=O.Debugger,{ApiKey:s,Service:n,TrackUser:i,FilterErrors:r,ListPlayerDevIds:c}=t,l=GameSDK.player.getID(),d=GameSDK.player.getName();l&&c.includes(l)||(this.monitorError.configure({apiKey:s,service:n,trackUser:i,releaseStage:tw,buildVersion:`${Zs}`}),this.monitorError.setUser({id:l,name:d}),this.monitorError.addFilterErrors(r),this.updateMonitorErrorUserAndMetadata())},"initMonitorErrorPlugin"));f(this,"updateMonitorErrorUserAndMetadata",o(()=>{if(!(this.event.getEventEmitCount(zt.PLAYER_INFO_LOADED)>0)){this.event.once(zt.PLAYER_INFO_LOADED,this.processWhenPlayerInfoLoaded);return}this.processWhenPlayerInfoLoaded()},"updateMonitorErrorUserAndMetadata"));f(this,"processWhenPlayerInfoLoaded",o(()=>{var n,i;const{playerId:t,name:s}=this.player.getPlayer();(n=this.monitorError)==null||n.setUser({id:t,name:s}),(i=this.monitorError)==null||i.addMetadata({isFirstLogin:this.player.isFirstLogin()})},"processWhenPlayerInfoLoaded"));f(this,"handleSaveRemoteConfig",o(t=>{try{const s={[t.type]:t};this.player.setPlayerDataByName("remoteConfig",s)}catch(s){console.warn("handleSaveGameCoreConfig",s)}},"handleSaveRemoteConfig"));f(this,"handleUpdateGameCoreConfig",o(t=>{try{const{id:s,type:n}=t;if(n!=="GameCore")return;g.Configs=Ql.merge(g.Configs,t.config);const{Ads:i}=g.Configs;this.ads.configure(i),this.event.emit(st.REMOTE_CONFIG_UPDATED,{id:s,type:n})}catch(s){console.warn("handleUpdateGameCoreConfig",s)}},"handleUpdateGameCoreConfig"));f(this,"handleStorageCurrentRemoteConfig",o(()=>{const t=this.player.getPlayerDataByKey("remoteConfig");if(console.info("playerRemoteConfig",oe.clone(t)),!!t){for(const s in t)if(Ql.hasOwn(t,s)){const n=t[s],i=oe.clone(n);console.log("newRemoteConfig",i);const r=new ew.RemoteConfig.Data(i).toObject();console.info("remoteConfigValid",r),this.remoteConfig.setRemoteConfig(r),this.remoteConfig.processUpdateConfig(r.id,r.type)}}},"handleStorageCurrentRemoteConfig"));f(this,"initAdaptivePerformancePlugin",o(()=>{if(!this.adaptivePerformance)return;const t=oe.clone(O.AdaptivePerformance);this.adaptivePerformance.configure(t)},"initAdaptivePerformancePlugin"));f(this,"processAfterSyncProfile",o(()=>{const{Notification:t}=O;t.Enabled&&this.updatePlayerProfileToNotificationService()},"processAfterSyncProfile"))}getBuildVersion(){return parseInt(`${Zs}`)}async boot(){console.groupCollapsed(" GameCore Boot"),super.boot(),this.addPlugins(),this.initEventPlugin(),this.event.emit(zt.CORE_BOOTING),this.initFirebasePlugin(),this.initMarkCoreInitialize(),C.putAttr(this.markName,"Step","Init Plugins"),this.initAds(),this.initMatchPlugin(),this.initRemoteConfig(),C.putAttr(this.markName,"Step","Load Lazy Plugins"),td.isDebugger()||this.event.on(zt.MODULE_PLUGIN_READY,this.handleProtectGameInstance),this.addMonitorPlugin().then(this.initMonitorErrorPlugin),this.addAdaptivePerformancePlugin().then(this.initAdaptivePerformancePlugin),C.putAttr(this.markName,"Step","Load Dev Plugins"),this.addDevPlugins().then(()=>{this.initConsolePlugin(),this.initProfilerPlugin(),this.initCanvasRecorderPlugin()})}async start(){console.groupEnd(),console.groupCollapsed(" GameCore Start"),super.start(),C.putAttr(this.markName,"Step","Core Start"),this.event.emit(zt.CORE_STARTING),C.putAttr(this.markName,"Step","Request Token"),await this.auth.requestToken(),C.putAttr(this.markName,"Step","Init States"),await this.initState(),C.putAttr(this.markName,"Step","Process Player Profile"),this.processPlayerProfile(),C.putAttr(this.markName,"Step","Process Context Payload"),await this.context.detectContextSessionType(),this.context.detectContextGameMode();const t=this.storage.getStorageData("context","sessionContextType");C.putAttr(this.markName,"Context Mode",t),C.putAttr(this.markName,"Step","Init Analytics"),this.initGoogleAnalytics(),this.initFirebaseAnalytics(),this.initFacebookAnalytics(),C.putAttr(this.markName,"Step","Core Ready"),C.putAttr(this.markName,"Success","true"),C.stop(this.markName),this.event.emit(zt.CORE_READY)}addPlugins(){this.installPlugin("Storage",ci),this.installPlugin("Event",pn),this.installPlugin("Ads",sn),this.installPlugin("Auth",cn),this.installPlugin("Audio",on),this.installPlugin("Match",ti),this.installPlugin("Player",ei),this.installPlugin("Profile",ni),this.installPlugin("Context",hn),this.installPlugin("Language",Xn),this.installPlugin("Firebase",Kn),this.installPlugin("Analytics",nn),this.installPlugin("Visibility",li),this.installPlugin("Leaderboard",Qn),this.installPlugin("DailyRewards",fn),this.installPlugin("FrameCapture",Yn),this.installPlugin("RemoteConfig",oi)}installPlugin(t,s,n=!1){const i=Zl.toCamelCase(Zl.capitalize(t));this.plugins.install(t,s,!0,i),t!=="Storage"&&(n?this.emitModulePluginReady(t):this.emitCorePluginReady(t))}async addMonitorPlugin(){const{MonitorError:t}=O.Debugger;if(!t.Enabled)return;this.modulePlugins.push("MonitorError");const s=(await dt(()=>import("./bundle/empty-script2.js"),__vite__mapDeps([]),import.meta.url)).default;typeof s=="function"&&this.installPlugin("MonitorError",s,!0)}async addAdaptivePerformancePlugin(){const{AdaptivePerformance:t}=O;if(!t.Enabled)return;this.modulePlugins.push("AdaptivePerformance");const s=(await dt(()=>import("./bundle/index.js"),__vite__mapDeps([0,1]),import.meta.url)).default;typeof s=="function"&&this.installPlugin("AdaptivePerformance",s,!0)}async addDevPlugins(){if(!td.isDebugger())return;const{ShowConsole:t,ShowProfiler:s,CanvasRecorder:n}=O.Debugger;if(t){this.modulePlugins.push("Console");const i=(await dt(()=>import("./bundle/console.js"),__vite__mapDeps([2,1,3]),import.meta.url)).default;typeof i=="function"&&this.installPlugin("Console",i,!0)}if(s){this.modulePlugins.push("Profiler");const i=(await dt(()=>import("./bundle/empty-script2.js"),__vite__mapDeps([]),import.meta.url)).default;typeof i=="function"&&this.installPlugin("Profiler",i,!0)}if(n.Enabled){this.modulePlugins.push("CanvasRecorder");const i=(await dt(()=>import("./bundle/empty-script2.js"),__vite__mapDeps([]),import.meta.url)).default;typeof i=="function"&&this.installPlugin("CanvasRecorder",i,!0)}}emitCorePluginReady(t){this.event.emit(st.CORE_PLUGIN_READY,{name:t})}emitModulePluginReady(t){this.event.emit(st.MODULE_PLUGIN_READY,{name:t})}initEventPlugin(){const{EventLogging:t}=O.Debugger;t&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}initAds(){const{Ads:t}=g.Plugins;this.ads.configure(O.Ads),this.initAdInstance(t,O)}initAdInstance(t,s){const{InterstitialAdOptions:n,RewardedVideoAdOptions:i,BannerDisplayAdOptions:r}=s.Ads;n.forEach(c=>{this.ads.setAdInstance(t.Types.INTERSTITIAL,c.PlacementId,Is)}),i.forEach(c=>{this.ads.setAdInstance(t.Types.REWARDED_VIDEO,c.PlacementId,Is)}),r.forEach(c=>{this.ads.setAdInstance(t.Types.BANNER,c.PlacementId,hi)})}async initState(){try{const t=new tn(this);t.initContext(),await t.initPlayer()}catch(t){console.error("StateInitiator",t)}}initConsolePlugin(){this.console&&this.console.configure()}initProfilerPlugin(){this.profiler&&this.profiler.configure()}initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;const{CanvasRecorder:t}=O.Debugger,{Type:s,Quality:n,RecordFps:i,SyncFps:r}=t.Options;this.canvasRecorder.configure({type:s,quality:n,syncFps:r,recordFps:i});const c=document.querySelector("canvas");if(!c)return console.error("Canvas not found");this.canvasRecorder.setCanvas(c)}initRemoteConfig(){const{RemoteConfig:t}=O;if(!t.Enabled)return;const s=oe.clone(t);this.remoteConfig.configure(s),this.event.on(st.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(st.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.once(st.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}initFirebasePlugin(){const{Firebase:t}=O;if(!t.Enabled)return;const s=oe.clone(t);this.firebase.configure(s),C.setService(this.firebase.services.performance)}initMarkCoreInitialize(){O.PerformanceMonitor.CoreFlows&&(C.measure(this.markName),C.putAttr(this.markName,"Build",`${Zs}`),C.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),C.putAttr(this.markName,"Platform",GameSDK.getPlatform()),C.putAttr(this.markName,"Success","false"),C.start(this.markName))}async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch(t){console.warn("processPlayerProfile fail",t)}}async updatePlayerProfileToNotificationService(){try{const{AppId:t}=O,s=this.player.getPlayer(),{ASID:n,playerId:i,name:r,photo:c,locale:l}=s;await Dh({appId:t,ASID:n,playerId:i,name:r,photo:c,locale:l})}catch(t){console.warn("updatePlayerProfileToNotificationService",t)}}initGoogleAnalytics(){const{Enabled:t,ConsoleLog:s}=O.Analytics.GoogleAnalytics??{};t&&this.analytics.add(new pi(this.game,{log:!!s}))}initFirebaseAnalytics(){const{Enabled:t,ConsoleLog:s}=O.Analytics.FirebaseAnalytics??{};if(!t)return;const n=new fi(this.game,{log:!!s}),i=this.player.getPlayer(),{ASID:r,playerId:c,locale:l}=i;n.setUser(c,{ASID:r,locale:l}),this.analytics.add(n)}initFacebookAnalytics(){const{Enabled:t,Prefix:s,ConsoleLog:n}=O.Analytics.FacebookAnalytics??{};if(t){if(typeof s!="string"){console.warn("Facebook Analytics is not configured");return}this.analytics.add(new ui(this.game,{prefix:s,log:!!n}))}}};o(Kc,"MagicGame");let gi=Kc;const{Configs:nw,Utils:aw,Events:Ni}=g,{Device:iw}=aw,{ForceDesktopDPR:Xe}=nw.GameEngine,rw=o(async()=>{try{gtag("event","app_initialize")}catch(t){console.warn("gtag init",t)}const a=new gi;window.game=a;const e=30;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e),window.__gameCoreStart=!0,await a.boot(),a.event.once(Ni.REQUEST_CORE_START,dh),ow(a)},"initGame"),dh=o(()=>{if(!window.__sdkInitiated){game.event.once(Ni.GAME_SDK_READY,dh);return}window.game.start();const a=35;window.__sdkLoadingCount<a&&(window.__sdkLoadingCount=a)},"startGame"),ow=o(a=>{const t=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(t);const s=20;window.__sdkLoadingCount<s&&(window.__sdkLoadingCount=s),a.event.emit(Ni.GAME_SDK_READY)},5)},"waitGameSDK");Xe!==!1&&iw.isDesktop()&&typeof Xe=="number"&&Xe>0&&(window.devicePixelRatio=Xe);rw();
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./bundle/index.js","./bundle/core.js","./bundle/console.js","./bundle/__commonjsHelpers__.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
