function _array_like_to_array(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_with_holes(arr){if(Array.isArray(arr))return arr}function _array_without_holes(arr){if(Array.isArray(arr))return _array_like_to_array(arr)}function _assert_this_initialized(self1){if(self1===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self1}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(info.done){resolve(value)}else{Promise.resolve(value).then(_next,_throw)}}function _async_to_generator(fn){return function(){var self1=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self1,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(undefined)})}}function _class_call_check(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _construct(Parent,args,Class){if(_is_native_reflect_construct()){_construct=Reflect.construct}else{_construct=function construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor;if(Class)_set_prototype_of(instance,Class.prototype);return instance}}return _construct.apply(null,arguments)}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _define_property(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get}else{_get=function get(target,property,receiver){var base=_super_prop_base(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver||target)}return desc.value}}return _get(target,property,receiver||target)}function _get_prototype_of(o){_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _get_prototype_of(o)}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_set_prototype_of(subClass,superClass)}function _instanceof(left,right){if(right!=null&&typeof Symbol!=="undefined"&&right[Symbol.hasInstance]){return!!right[Symbol.hasInstance](left)}else{return left instanceof right}}function _is_native_function(fn){return Function.toString.call(fn).indexOf("[native code]")!==-1}function _iterable_to_array(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _iterable_to_array_limit(arr,i){var _i=arr==null?null:typeof Symbol!=="undefined"&&arr[Symbol.iterator]||arr["@@iterator"];if(_i==null)return;var _arr=[];var _n=true;var _d=false;var _s,_e;try{for(_i=_i.call(arr);!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"]!=null)_i["return"]()}finally{if(_d)throw _e}}return _arr}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};var ownKeys=Object.keys(source);if(typeof Object.getOwnPropertySymbols==="function"){ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))}ownKeys.forEach(function(key){_define_property(target,key,source[key])})}return target}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})}keys.push.apply(keys,symbols)}return keys}function _object_spread_props(target,source){source=source!=null?source:{};if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}function _object_without_properties(source,excluded){if(source==null)return{};var target=_object_without_properties_loose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key]}}return target}function _object_without_properties_loose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key]}return target}function _possible_constructor_return(self1,call){if(call&&(_type_of(call)==="object"||typeof call==="function")){return call}return _assert_this_initialized(self1)}function _set_prototype_of(o,p){_set_prototype_of=Object.setPrototypeOf||function setPrototypeOf(o,p){o.__proto__=p;return o};return _set_prototype_of(o,p)}function _sliced_to_array(arr,i){return _array_with_holes(arr)||_iterable_to_array_limit(arr,i)||_unsupported_iterable_to_array(arr,i)||_non_iterable_rest()}function _super_prop_base(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_get_prototype_of(object);if(object===null)break}return object}function _to_consumable_array(arr){return _array_without_holes(arr)||_iterable_to_array(arr)||_unsupported_iterable_to_array(arr)||_non_iterable_spread()}function _type_of(obj){"@swc/helpers - typeof";return obj&&typeof Symbol!=="undefined"&&obj.constructor===Symbol?"symbol":typeof obj}function _unsupported_iterable_to_array(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,minLen)}function _wrap_native_super(Class){var _cache=typeof Map==="function"?new Map:undefined;_wrap_native_super=function wrapNativeSuper(Class){if(Class===null||!_is_native_function(Class))return Class;if(typeof Class!=="function"){throw new TypeError("Super expression must either be null or a function")}if(typeof _cache!=="undefined"){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return _construct(Class,arguments,_get_prototype_of(this).constructor)}Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _set_prototype_of(Wrapper,Class)};return _wrap_native_super(Class)}function _is_native_reflect_construct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _create_super(Derived){var hasNativeReflectConstruct=_is_native_reflect_construct();return function _createSuperInternal(){var Super=_get_prototype_of(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_get_prototype_of(this).constructor;result=Reflect.construct(Super,arguments,NewTarget)}else{result=Super.apply(this,arguments)}return _possible_constructor_return(this,result)}}function _ts_generator(thisArg,body){var f,y,t,g,_={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]};return g={next:verb(0),"throw":verb(1),"return":verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}var nr=Object.defineProperty;var td=function(et,b,y){return b in et?nr(et,b,{enumerable:!0,configurable:!0,writable:!0,value:y}):et[b]=y};var c=function(et,b){return nr(et,"name",{value:b,configurable:!0})};var u=function(et,b,y){return td(et,(typeof b==="undefined"?"undefined":_type_of(b))!="symbol"?b+"":b,y)};System.register(["./bundle/core.js","./bundle/__commonjsHelpers__.js"],function(et,b){"use strict";var y,C,po,st,$,at,yo;return{setters:[function(L){y=L.G,C=L.P,po=L.M,st=L._,$=L.a,at=L.C},function(L){yo=L.g}],execute:c(function(){var Ct,Ot,Lt;var _y_Utils=y.Utils,L=_y_Utils.Valid,ct=_y_Utils.Object,Oe=_y_Utils.String,fo=_y_Utils.Json,Tt="is invalid",H=function(){function H(e){_class_call_check(this,H);this.defaultData(),this.processData(e)}_create_class(H,[{key:"processData",value:function processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}},{key:"defaultData",value:function defaultData(){var _this_constructor=this.constructor,e=_this_constructor.name;this.lazyDefaultData(H.data[e])}},{key:"lazyDefaultData",value:function lazyDefaultData(e){L.isObject(e)||this.exception("data",Tt);for(var t in e)if(ct.hasOwn(e,t)){var s=e[t];ct.assign(this,_define_property({},t,s))}}},{key:"lazyValidateStructure",value:function lazyValidateStructure(e){var _this=this;L.isObject(e)||this.exception("structure","is not object"),this.getKeys().forEach(function(t){var s=_this[t];s===void 0&&_this.exception("structure","has no key ".concat(t)),!ct.hasOwn(e,t)&&s!==void 0&&_this.setDefaultData(t,e)})}},{key:"setDefaultData",value:function setDefaultData(e,t){L.isObject(t)||this.exception("data",Tt);var s=this[e];s===void 0&&this.exception("default","has no key ".concat(e)),ct.assign(t,_define_property({},e,s))}},{key:"lazyValidateData",value:function lazyValidateData(e){var _this=this;this.getKeys().forEach(function(t){var s=e[t],a=Oe.removeDiacritics(t).replace(/[^a-zA-Z0-9]/g,""),n="validate".concat(Oe.capitalize(a)),i=_this[n];if(typeof i=="function")try{i.call(_this,s)}catch(o){console.warn(o),_this.setDefaultData(t,e)}else _this.exception("validate","has no function ".concat(n))})}},{key:"lazySetupData",value:function lazySetupData(e){var _this=this;this.getKeys().forEach(function(t){var s=e[t];ct.assign(_this,_define_property({},t,s))})}},{key:"validate",value:function validate(){this.validateData(this.toObject())}},{key:"exception",value:function exception(e,t){throw new Error("".concat(this.constructor.name,": ").concat(e," ").concat(t))}},{key:"toObject",value:function toObject(){return Object.fromEntries(Object.entries(this).filter(function(param){var _param=_sliced_to_array(param,1),e=_param[0];return e!=="toObject"}))}},{key:"getKeys",value:function getKeys(){return Object.keys(this).filter(function(e){return e!=="toObject"})}}],[{key:"addDefaultData",value:function addDefaultData(e){L.isObject(e)||this.prototype.exception("default data",Tt),e=fo.clone(e);var _this=this,t=_this.name;L.isObject(H.data[t])||(H.data[t]={}),H.data[t]=ct.merge(H.data[t],e),console.info("".concat(t," default data:"),H.data[t])}},{key:"getDefaultData",value:function getDefaultData(){var _this=this,e=_this.name;return fo.clone(H.data[e])}},{key:"addValidateFunction",value:function addValidateFunction(e,t){L.isString(e)||this.prototype.exception("validate key",Tt),typeof t!="function"&&this.prototype.exception("validate function",Tt);var s="validate".concat(Oe.capitalize(e));ct.assign(this.prototype,_define_property({},s,t))}}]);return H}();c(H,"BaseDtos"),u(H,"data",{});var G=H;y.Dtos={Base:G};var ir={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded"},wt={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0}},_y_Utils1=y.Utils,Mt=_y_Utils1.Valid,or=wt.playerId,rr=wt.name,cr=wt.photo,lr=wt.locale,Rt="is invalid",Ca=function(G){_inherits(Ca,G);var _super=_create_super(Ca);function Ca(){_class_call_check(this,Ca);return _super.apply(this,arguments)}_create_class(Ca,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){(!Mt.isString(e)||!e)&&this.exception("_id",Rt)}},{key:"validatePlayerId",value:function validatePlayerId(e){(!Mt.isString(e)||!e)&&this.exception("playerId",Rt)}},{key:"validateName",value:function validateName(e){(!Mt.isString(e)||!e)&&this.exception("name",Rt)}},{key:"validatePhoto",value:function validatePhoto(e){Mt.isString(e)||this.exception("photo",Rt)}},{key:"validateLocale",value:function validateLocale(e){(!Mt.isString(e)||!e)&&this.exception("locale",Rt)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ca.prototype),"toObject",this).call(this)}}]);return Ca}(G);c(Ca,"PlayerInfoDtos");var mt=Ca;mt.addDefaultData({playerId:or,name:rr,photo:cr,locale:lr});var X=new mt({playerId:"10",name:"Your Friend"}).toObject(),Oa=function(Error1){_inherits(Oa,Error1);var _super=_create_super(Oa);function Oa(t){_class_call_check(this,Oa);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"code");_this.code="CREATE_MATCH_FAILED";return _this}return Oa}(_wrap_native_super(Error));c(Oa,"ACreateMatchFailed");var K=Oa;var La=function(K){_inherits(La,K);var _super=_create_super(La);function La(e){_class_call_check(this,La);var _this;_this=_super.call(this,e),_this.name="PlayerIdNotValid",_this.message=e!==null&&e!==void 0?e:"Player id is not valid";return _possible_constructor_return(_this)}return La}(K);c(La,"PlayerIdNotValid");var D=La;var Le=y.Dtos,dr=y.Utils,hr=y.Events,ur=dr.Array,pr=dr.Object,Te=dr.Json,go=dr.Valid,Ta=function Ta(e){var _this=this;_class_call_check(this,Ta);u(this,"game");u(this,"initContext",c(function(){var _$e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},t=new Le.Context.Info(_$e),_t_toObject=t.toObject(),s=_t_toObject.contextId,a=_t_toObject.contextType,n=_t_toObject.entryPointData;_this.game.context.receiveContext(s,a,n)},"initContext"));var _this1=this;u(this,"initPlayer",c(_async_to_generator(function(){var _this_game,_$e,t,s,a,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this1.game,_$e=_this_game.player,t=_this1.getPlayerInfo();console.info("playerInfo",Te.clone(t));s=ur.unique(pr.vals(ir));console.info("dataKeys",s);return[4,GameSDK.player.getDataAsync(s)];case 1:a=_state.sent();console.info("rawData",Te.clone(a));n=new Le.Player.Data(a).toObject();console.info("playerData",Te.clone(n)),_$e.receiveData(t,n),_this1.game.event.emit(hr.PLAYER_INFO_LOADED);return[2]}})}),"initPlayer"));u(this,"getPlayerInfo",c(function(){try{var _$e=GameSDK.player.getID();var t=GameSDK.player.getName();var s=GameSDK.player.getPhoto(),a=GameSDK.getLocale();if(!go.isString(_$e))throw new D;return go.isString(t)||(t="You"),new Le.Player.Info({playerId:_$e,name:t,photo:s,locale:a}).toObject()}catch(e){return X}},"getPlayerInfo"));this.game=e};c(Ta,"StateInitiator");var Me=Ta;var Ma=function(Error1){_inherits(Ma,Error1);var _super=_create_super(Ma);function Ma(t,s){_class_call_check(this,Ma);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.name="BadRequest",_this.message=t!==null&&t!==void 0?t:"This request is bad",_this.payload=s;return _this}return Ma}(_wrap_native_super(Error));c(Ma,"BadRequest");var _t=Ma;var Ra=function(Error1){_inherits(Ra,Error1);var _super=_create_super(Ra);function Ra(t,s){_class_call_check(this,Ra);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.name="RequestTimeout",_this.message=t!==null&&t!==void 0?t:"This request is timeout",_this.payload=s;return _this}return Ra}(_wrap_native_super(Error));c(Ra,"RequestTimeout");var $t=Ra;var yr=y.Utils,fr=y.Configs,wo=fr.AppId,Re=fr.Network,gr=c(function(p){if(!p.ok)throw new _t(void 0,{response:p})},"validateResponse"),mo=c(function(){var p=window.game.auth.getToken();return{token:p,timeout:Re.Timeout,headers:{Authorization:"Bearer ".concat(p),"Content-Type":"application/json"}}},"defaultConfig"),Ao=c(function(p,e,t,s){return _async_to_generator(function(){var _$a,n,i,o,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,3,,4]);if(!wo)throw new _t("AppId is not defined");_$a="".concat(p,"/apps/").concat(wo,"/").concat(e),n=new AbortController;t.signal=n.signal;i=setTimeout(function(){n.abort()},t.timeout);y.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));return[4,fetch(_$a,t)];case 1:o=_state.sent();clearTimeout(i),gr(o);return[4,o.json()];case 2:return[2,_state.sent()||{}];case 3:a=_state.sent();if(_instanceof(a,_t))return[2,null];throw _instanceof(a,Object)&&"name"in a&&a.name==="AbortError"?new $t:a;case 4:return[2]}})})},"requester"),_e=c(function(){var _ref=_async_to_generator(function(p,e){var t,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,1,,7]);return[2,p()];case 1:t=_state.sent();if(!(_instanceof(t,$t)&&e>0))return[3,6];_state.label=2;case 2:_state.trys.push([2,5,,6]);return[4,yr.Time.sleepAsync(600)];case 3:_state.sent();return[4,_e(p,e-1)];case 4:return[2,_state.sent()];case 5:e1=_state.sent();return[2,{}];case 6:return[2,_instanceof(t,$t)?{}:(console.warn("Request error",t),{})];case 7:return[2]}})});return function(p,e){return _ref.apply(this,arguments)}}(),"handleRequest"),At=c(function(){var _ref=_async_to_generator(function(p){var e,t,s,_$a,n,a;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:e=_arguments.length>1&&_arguments[1]!==void 0?_arguments[1]:{},t=_arguments.length>2?_arguments[2]:void 0,s=_arguments.length>3&&_arguments[3]!==void 0?_arguments[3]:Re.Retries;_state.label=1;case 1:_state.trys.push([1,3,,4]);_$a=_object_spread_props(_object_spread({},mo(),e),{method:"GET"}),n=Ao(t,p,_$a);return[4,_e(n,s)];case 2:return[2,_state.sent()];case 3:a=_state.sent();return[2,(console.warn("Get error",a),{})];case 4:return[2]}})});return function(p){return _ref.apply(this,arguments)}}(),"get"),V=c(function(){var _ref=_async_to_generator(function(p,e){var t,s,a,_$n,i,n;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=_arguments.length>2&&_arguments[2]!==void 0?_arguments[2]:{},s=_arguments.length>3?_arguments[3]:void 0,a=_arguments.length>4&&_arguments[4]!==void 0?_arguments[4]:Re.Retries;_state.label=1;case 1:_state.trys.push([1,3,,4]);_$n=_object_spread_props(_object_spread({},mo(),t),{method:"POST"}),i=Ao(s,p,_$n,e);return[4,_e(i,a)];case 2:return[2,_state.sent()];case 3:n=_state.sent();return[2,(console.warn("Post error",n),{})];case 4:return[2]}})});return function(p,e){return _ref.apply(this,arguments)}}(),"post"),_y_Configs_Notification=y.Configs.Notification,wr=_y_Configs_Notification.ApiUrl,mr=c(function(){var _ref=_async_to_generator(function(p){var e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!y.Utils.Object.hasOwn(p,"playerId"))throw new Error("Missing playerId");e=p.playerId;return[4,V("players/".concat(e),p,{},wr,10)];case 1:_state.sent();return[2]}})});return function(p){return _ref.apply(this,arguments)}}(),"updatePlayerProfileNotificationAsync");var Io=function(p){return p.IDLE="idle",p.LOADING="loading",p.FILLED="filled",p.SHOWING="showing",p}(Io||{});var Do=Io;var Po=function(p){return p.BANNER="banner",p.INTERSTITIAL="interstitial",p.REWARDED_VIDEO="rewarded_video",p}(Po||{});var W=Po;var Gt=(Ct=function(Error1){_inherits(Ct,Error1);var _super=_create_super(Ct);function Ct(t,s){_class_call_check(this,Ct);var _this;_this=_super.call(this,s);u(_assert_this_initialized(_this),"code");_this.code=t,_this.message=s;return _this}return Ct}(_wrap_native_super(Error)),c(Ct,"AdError"),Ct);var _a=function(){function _a(e,t){_class_call_check(this,_a);u(this,"type");u(this,"status");u(this,"placementId");this.type=e,this.status=Do.IDLE,this.placementId=t}_create_class(_a,[{key:"getStatus",value:function getStatus(){return this.status}},{key:"exception",value:function exception(e){throw new Gt("AD_INSTANCE_ERROR",e)}}]);return _a}();c(_a,"BaseInstance");var $e=_a,xo=(Ot=function($e){_inherits(Ot,$e);var _super=_create_super(Ot);function Ot(){_class_call_check(this,Ot);return _super.apply(this,arguments)}_create_class(Ot,[{key:"loadAsync",value:function loadAsync(){this.exception("This method is not implemented")}},{key:"showAsync",value:function showAsync(){this.exception("This method is not implemented")}},{key:"hideAsync",value:function hideAsync(){this.exception("Unsupported method")}}]);return Ot}($e),c(Ot,"AdInstance"),Ot);y.Plugins.Ads={Types:W,Status:Do,AdError:Gt,AdInstance:xo};var _y_Utils2=y.Utils,Ge=_y_Utils2.Array,Ar=_y_Utils2.Object,$a=function(_C_Plugins_BasePlugin){_inherits($a,_C_Plugins_BasePlugin);var _super=_create_super($a);function $a(){_class_call_check(this,$a);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"enabled");u(_assert_this_initialized(_this),"config");u(_assert_this_initialized(_this),"lastCallAdShownTime");u(_assert_this_initialized(_this),"isAdFullSizeShowed");u(_assert_this_initialized(_this),"ads",{});u(_assert_this_initialized(_this),"safeAreaBottom");return _this}_create_class($a,[{key:"init",value:function init(){this.lastCallAdShownTime=0,this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}},{key:"calculateSafeAreaBottom",value:function calculateSafeAreaBottom(){try{var t=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(t,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch(e){this.safeAreaBottom=0}}},{key:"configure",value:function configure(t){this.config=t,this.enabled=this.config.Enabled}},{key:"checkEnabled",value:function checkEnabled(){if(!this.enabled)throw new Gt("ADS_NOT_ENABLED","Ads is't enabled")}},{key:"isAdFullSizeShowing",value:function isAdFullSizeShowing(){return this.isAdFullSizeShowed}},{key:"setAdInstance",value:function setAdInstance(t,s,a){if(this.ads[s]){console.warn("AdsPlugin: Ad instance with placementId ".concat(s," already exists"));return}this.ads[s]={type:t,placementId:s,interval:null,instance:new a(t,s)}}},{key:"preloadInterstitialAdAsync",value:function preloadInterstitialAdAsync(){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this.loadAdAsync(W.INTERSTITIAL)];case 1:_state.sent();return[2]}})})()}},{key:"showInterstitialAdAsync",value:function showInterstitialAdAsync(){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!_this.canbeShowInterstitialAd())throw new Gt("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");return[4,_this.showAdAsync(W.INTERSTITIAL)];case 1:_state.sent();return[2]}})})()}},{key:"preloadRewardedVideoAsync",value:function preloadRewardedVideoAsync(){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this.loadAdAsync(W.REWARDED_VIDEO)];case 1:_state.sent();return[2]}})})()}},{key:"showRewardedVideoAsync",value:function showRewardedVideoAsync(){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this.showAdAsync(W.REWARDED_VIDEO)];case 1:_state.sent();return[2]}})})()}},{key:"loadAdAsync",value:function loadAdAsync(t,s){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_this.checkEnabled();return[4,_this.getAd(t,s).instance.loadAsync()];case 1:_state.sent();return[2]}})})()}},{key:"showAdAsync",value:function showAdAsync(t,s){var _this=this;return _async_to_generator(function(){var _this_game,a,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this.checkEnabled();_this_game=_this.game,a=_this_game.event,n=_this.getAd(t,s);_this.lastCallAdShownTime=window.performance.now()/1e3;_state.label=1;case 1:_state.trys.push([1,,3,4]);a.emit(y.Events.AD_SHOWING,{placementId:s}),_this.isAdFullSizeShowed=!0;return[4,n.instance.showAsync()];case 2:_state.sent();return[3,4];case 3:a.emit(y.Events.AD_CLOSED,{placementId:s}),_this.isAdFullSizeShowed=!1;return[7];case 4:return[2]}})})()}},{key:"getAdStatus",value:function getAdStatus(t,s){return this.checkEnabled(),this.getAd(t,s).instance.getStatus()}},{key:"getAd",value:function getAd(t,s){var a=null;if(s?a=this.getAdByPlacementId(s):a=this.getPriorityAdByType(t),!a)throw new Gt("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return a}},{key:"getAdsByType",value:function getAdsByType(t){return Ar.vals(this.ads).filter(function(s){return s.type===t})}},{key:"getAdByPlacementId",value:function getAdByPlacementId(t){var s=this.ads[t];return s||null}},{key:"getPriorityAdByType",value:function getPriorityAdByType(t){var s=this.getAdsByType(t);if(!s.length)return null;var a=Ge.search(s,function(n){return n.type===t});return a||null}},{key:"canbeShowInterstitialAd",value:function canbeShowInterstitialAd(t){return this.canbeShowInterstitialAdByTime(t)}},{key:"canbeShowInterstitialAdByTime",value:function canbeShowInterstitialAdByTime(t){try{var _$s=window.performance.now()/1e3;var a;if(t)a=this.getCommonAdConfig(t);else{var d=this.getPriorityAdByType(W.INTERSTITIAL);if(!d)return!1;a=this.getCommonAdConfig(d.placementId)}var n=a.SecondsBetweenAds,i=a.SecondsFirstTime,o=_$s-this.lastCallAdShownTime,r=o>n,l=o>i;return this.lastCallAdShownTime>0?r:l}catch(s){return console.warn("Error while checking canbeShowInterstitialAdByTime",s),!1}}},{key:"canbeShowBannerAd",value:function canbeShowBannerAd(t){try{var _$s=this.getBannerConfig(t),a=_$s.Platform;if(a==="ALL")return!0;var n=GameSDK.getPlatform();return n?n===a:!1}catch(s){return console.warn("Error while checking canbeShowBannerAd",s),!1}}},{key:"showBannerAdAsync",value:function showBannerAdAsync(t){var _this=this;return _async_to_generator(function(){var s,_this_game,a,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this.checkEnabled();s=_this.getAd(W.BANNER,t);if(!_this.canbeShowBannerAd(s.placementId))throw new Error("Banner ad can not be shown");_this.cleanBannerReloadTimer(s.placementId);return[4,s.instance.showAsync()];case 1:_state.sent();_this_game=_this.game,a=_this_game.event;a.emit(y.Events.AD_SHOWING,{placementId:t});n=_this.getBannerConfig(s.placementId),i=n.SecondsReload;i<=0||(s.interval=setTimeout(function(){_this.showBannerAdAsync(s.placementId)},i*1e3));return[2]}})})()}},{key:"showMSNBannerAdsAsync",value:function showMSNBannerAdsAsync(){var _this=this;return _async_to_generator(function(){var t,_this_game,s,_y_Configs_Ads,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=_this.getAd(W.BANNER,void 0);if(!_this.canbeShowBannerAd(t.placementId))throw new Error("Banner ad can not be shown");return[4,t.instance.showAsync()];case 1:_state.sent();_this_game=_this.game,s=_this_game.event,_y_Configs_Ads=y.Configs.Ads,a=_y_Configs_Ads.BannerDisplayAdOptions;a.forEach(function(param){var n=param.PlacementId;s.emit(y.Events.AD_SHOWING,{placementId:n})});return[2]}})})()}},{key:"hideBannerAdAsync",value:function hideBannerAdAsync(t){var _this=this;return _async_to_generator(function(){var s,_this_game,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this.checkEnabled();s=_this.getAd(W.BANNER,t);_this.cleanBannerReloadTimer(s.placementId);return[4,s.instance.hideAsync()];case 1:_state.sent();_this_game=_this.game,a=_this_game.event;a.emit(y.Events.AD_CLOSED,{placementId:t});return[2]}})})()}},{key:"hideMSNBannerAdsAsync",value:function hideMSNBannerAdsAsync(){var _this=this;return _async_to_generator(function(){var _this_game,s,_y_Configs_Ads,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this.checkEnabled();return[4,_this.getAd(W.BANNER,void 0).instance.hideAsync()];case 1:_state.sent();_this_game=_this.game,s=_this_game.event,_y_Configs_Ads=y.Configs.Ads,a=_y_Configs_Ads.BannerDisplayAdOptions;a.forEach(function(param){var n=param.PlacementId;s.emit(y.Events.AD_CLOSED,{placementId:n})});return[2]}})})()}},{key:"cleanBannerReloadTimer",value:function cleanBannerReloadTimer(t){try{var _$s=this.getAd(W.BANNER,t),a=_$s.interval;if(!a)return;clearInterval(a)}catch(s){console.warn("Error while cleaning banner reload timer",s)}}},{key:"getCommonAdConfig",value:function getCommonAdConfig(t){var s=_to_consumable_array(this.config.InterstitialAdOptions).concat(_to_consumable_array(this.config.RewardedVideoAdOptions)),a=Ge.search(s,function(n){return n.PlacementId===t});if(!a)throw new Error("Ad config with placementId ".concat(t," not found"));return a}},{key:"getBannerConfig",value:function getBannerConfig(t){var s=Ge.search(this.config.BannerDisplayAdOptions,function(a){return a.PlacementId===t});if(!s)throw new Error("Banner config with placementId ".concat(t," not found"));return s}},{key:"getBannerHeight",value:function getBannerHeight(t,s){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;this.checkEnabled();var n=this.getBannerConfig(t),i=GameSDK.getBannerHeight(n);return a?(i+this.safeAreaBottom)*s:i*s}},{key:"getSafeAreaBottom",value:function getSafeAreaBottom(t){return this.safeAreaBottom*t}}]);return $a}(C.Plugins.BasePlugin);c($a,"AdsPlugin");var Ve=$a;var Eo=function(p){return p.BUTTON_CLICK="button_click",p.SCREEN_OPEN="screen_open",p.LOAD_START="load_start",p.LOAD_COMPLETE="load_complete",p.ENGINE_READY="engine_ready",p.GAME_SDK_READY="game_sdk_ready",p.APP_READY="app_ready",p.PAGE_VIEW="page_view",p.TUTORIAL_BEGIN="tutorial_begin",p.TUTORIAL_STEP="tutorial_step",p.TUTORIAL_COMPLETE="tutorial_complete",p.MATCH_START="match_start",p.MATCH_RESCUE="match_rescue",p.MATCH_END="match_end",p.LEVEL_START="level_start",p.LEVEL_RESCUE="level_rescue",p.LEVEL_END="level_end",p.SHARE="share",p.MESSAGE="message",p.INVITE="invite",p.SHORTCUT_CREATE="shortcut_create",p.SHORTCUT_CREATE_POPUP="shortcut_create_popup",p.BOT_SUBSCRIBE="bot_subscribe",p.BOT_SUBSCRIBE_POPUP="bot_subscribe_popup",p.AD_LOAD="ad_load",p.AD_LOAD_FAILED="ad_load_failed",p.AD_SHOW="ad_show",p.AD_SHOW_FAILED="ad_show_failed",p.AD_REWARD="ad_reward",p.AD_IMPRESSION="ad_impression",p.NEW_USER="new_user",p.RETURNING_USER="returning_user",p.JOIN_GROUP="join_group",p.TOURNAMENT_START="tournament_start",p.TOURNAMENT_SHARE="tournament_share",p.TOURNAMENT_CREATE="tournament_create",p.TOURNAMENT_POST_SCORE="tournament_post_score",p.GET_FREE_ITEM="get_free_item",p.USE_ITEM="use_item",p.EARN_ITEM="earn_item",p}(Eo||{});var k=Eo,_y_Utils3=y.Utils,So=_y_Utils3.String,Ir=_y_Utils3.Valid;var Dr=(Lt=function(){function Lt(e,t,s){_class_call_check(this,Lt);u(this,"game");u(this,"name");u(this,"color");u(this,"options");u(this,"selfLog");u(this,"currentPath");this.game=e,this.name=t,this.options=s,this.color=s.color||"#FFF",this.selfLog=s.log,this.currentPath="/",console.info("%c".concat(this.name,": init"),"color: ".concat(this.color),this.options)}_create_class(Lt,[{key:"event",value:function event(e,t){this.logInfo("event",{name:e,payload:t});var s=this.formatEventName(e);this.processEvent(s,t)}},{key:"logInfo",value:function logInfo(e,t){this.selfLog&&console.info("%c".concat(this.name,": ").concat(e),"color: ".concat(this.color),t)}},{key:"pageview",value:function pageview(e){var t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),console.info("AnalyticsService: Page view",t),document.title=t,this.event(k.PAGE_VIEW,{page_title:t})}},{key:"levelStart",value:function levelStart(e,t){this.event(k.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e)})}},{key:"levelFail",value:function levelFail(e,t){this.event(k.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e)})}},{key:"levelRescue",value:function levelRescue(e,t){this.event(k.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e)})}},{key:"levelComplete",value:function levelComplete(e,t){this.event(k.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e)})}},{key:"loadAdEvent",value:function loadAdEvent(e,t){this.event(k.AD_LOAD,{ad_type:e,screen_name:t})}},{key:"showAdEvent",value:function showAdEvent(e,t){this.event(k.AD_SHOW,{ad_type:e,screen_name:t}),this.event(k.AD_IMPRESSION,{ad_format:e})}},{key:"loadInterstitialAd",value:function loadInterstitialAd(e){this.loadAdEvent("interstitial",e)}},{key:"showInterstitialAd",value:function showInterstitialAd(e){this.showAdEvent("interstitial",e)}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(e){this.loadAdEvent("rewarded_video",e)}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(e){this.showAdEvent("rewarded_video",e)}},{key:"receiveVideoReward",value:function receiveVideoReward(e){this.event(k.AD_REWARD,{screen_name:e})}},{key:"loadAdFail",value:function loadAdFail(e,t){this.event(k.AD_LOAD_FAILED,{ad_type:e,screen_name:t})}},{key:"showAdFail",value:function showAdFail(e,t){this.event(k.AD_SHOW_FAILED,{ad_type:e,screen_name:t})}},{key:"formatEventName",value:function formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(e)}},{key:"getPageTitle",value:function getPageTitle(e){var t=e.split("/").pop();if(!Ir.isString(t))return e;var s=t.replace(/([-_\s.])/g," $1");return So.toUpperCamelCase(s)}},{key:"addGameModeToPageTitle",value:function addGameModeToPageTitle(e){var _this_game=this.game,t=_this_game.match,s=t.getMatchState();var a=s.mode;return a||(a="Normal"),"".concat(So.toUpperCamelCase(a),"::").concat(e)}}]);return Lt}(),c(Lt,"BaseAnalytics"),Lt);y.Plugins.Analytics={Events:k,BaseAnalytics:Dr};var Ga=function(_C_Plugins_BasePlugin){_inherits(Ga,_C_Plugins_BasePlugin);var _super=_create_super(Ga);function Ga(){_class_call_check(this,Ga);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"analytics",[]);u(_assert_this_initialized(_this),"placement","unknown");u(_assert_this_initialized(_this),"pageview",c(function(t){if(!_this.isActive())return;_this.placement=t;var s=_this.getPageByKey(t);_this.analytics.forEach(function(a){a.pageview(s)})},"pageview"));return _this}_create_class(Ga,[{key:"add",value:function add(t){this.analytics.some(function(a){return a.name===t.name})||this.analytics.push(t)}},{key:"isActive",value:function isActive(){return this.analytics.length>=1}},{key:"event",value:function event(t,s){this.isActive()&&this.analytics.forEach(function(a){a.event(t,s)})}},{key:"levelStart",value:function levelStart(t,s){this.isActive()&&this.analytics.forEach(function(a){a.levelStart(t,s)})}},{key:"levelRescue",value:function levelRescue(t,s){this.isActive()&&this.analytics.forEach(function(a){a.levelRescue(t,s)})}},{key:"levelFail",value:function levelFail(t,s){this.isActive()&&this.analytics.forEach(function(a){a.levelFail(t,s)})}},{key:"levelComplete",value:function levelComplete(t,s){this.isActive()&&this.analytics.forEach(function(a){a.levelComplete(t,s)})}},{key:"loadInterstitialAd",value:function loadInterstitialAd(){var _this=this;this.isActive()&&this.analytics.forEach(function(t){t.loadInterstitialAd(_this.placement)})}},{key:"showInterstitialAd",value:function showInterstitialAd(){var _this=this;this.isActive()&&this.analytics.forEach(function(t){t.showInterstitialAd(_this.placement)})}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(){var _this=this;this.isActive()&&this.analytics.forEach(function(t){t.loadRewardedVideoAd(_this.placement)})}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(){var _this=this;this.isActive()&&this.analytics.forEach(function(t){t.showRewardedVideoAd(_this.placement)})}},{key:"receiveVideoReward",value:function receiveVideoReward(){var _this=this;this.isActive()&&this.analytics.forEach(function(t){t.receiveVideoReward(_this.placement)})}},{key:"loadAdFail",value:function loadAdFail(t){var _this=this;this.isActive()&&this.analytics.forEach(function(s){s.loadAdFail(t,_this.placement)})}},{key:"showAdFail",value:function showAdFail(t){var _this=this;this.isActive()&&this.analytics.forEach(function(s){s.showAdFail(t,_this.placement)})}},{key:"getPageByKey",value:function getPageByKey(t){if(t.indexOf("_")>-1){var s=t.replace(/_/g,"-");return s=s.toLowerCase(),s}else{var s1=t.length-1,a="";for(;s1>0;){a=t.charAt(s1);var n=isNaN(parseInt(a,10)),i=a===a.toUpperCase();n&&i&&(t="".concat(t.slice(0,s1),"-").concat(t.slice(s1))),s1--}return t.toLowerCase()}}}]);return Ga}(C.Plugins.BasePlugin);c(Ga,"AnalyticsPlugin");var Fe=Ga;var Va=function(){function Va(e){_class_call_check(this,Va);u(this,"key");this.key=e}_create_class(Va,[{key:"getKey",value:function getKey(){return this.key}}]);return Va}();c(Va,"BaseAudioPlayer");var Ue=Va;var Fa=function(){function Fa(e){_class_call_check(this,Fa);u(this,"id");u(this,"isMuteAll");u(this,"masterVolume");u(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}_create_class(Fa,[{key:"getId",value:function getId(){return this.id}},{key:"getAudioClip",value:function getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}},{key:"setAudioClip",value:function setAudioClip(e,t){this.audioClips[e]=_object_spread({},this.audioClips[e],t)}},{key:"play",value:function play(e,t){var s=this.getAudioClip(e);if(s){var a=s.audioPlayer;this.playWithRealConfig(a,t)}else this.loadAndPlay(e,t)}},{key:"loadAndPlay",value:function loadAndPlay(e,t){var _this=this;return _async_to_generator(function(){var _$s,_ref,tmp,a,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,_this.onLoadAudio(e,t)];case 1:_$s=_state.sent(),_ref=t||{},tmp=_ref.volume,a=tmp===void 0?1:tmp;_this.setAudioClip(e,{volume:a,audioPlayer:_$s}),_this.playWithRealConfig(_$s,t);return[3,3];case 2:s=_state.sent();console.warn("playAudio",s);return[3,3];case 3:return[2]}})})()}},{key:"playWithRealConfig",value:function playWithRealConfig(e,t){if(t){var tmp=t.volume,s=tmp===void 0?1:tmp;t.volume=this.masterVolume*s}e.play(t)}},{key:"pause",value:function pause(e){var t=this.getAudioClip(e);if(!t)return!1;var s=t.audioPlayer;return s.pause(),!0}},{key:"resume",value:function resume(e){var t=this.getAudioClip(e);if(!t)return!1;var s=t.audioPlayer;return s.resume(),!0}},{key:"stop",value:function stop(e){var t=this.getAudioClip(e);if(!t)return!1;var s=t.audioPlayer;return s.stop(),!0}},{key:"stopAll",value:function stopAll(){this.callAudioPlayers("stop")}},{key:"muteAll",value:function muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}},{key:"unmuteAll",value:function unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}},{key:"setVolume",value:function setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}},{key:"getVolume",value:function getVolume(){return this.masterVolume}},{key:"queueAudioPlayer",value:function queueAudioPlayer(e,t){try{var _$s=e.audioPlayer,tmp=e.volume,a=tmp===void 0?1:tmp;switch(t){case"play":_$s.play();break;case"pause":_$s.pause();break;case"resume":_$s.resume();break;case"stop":_$s.stop();break;case"mute":_$s.setVolume(0);break;case"unmute":case"setVolume":_$s.setVolume(this.masterVolume*a);break;default:throw new Error("Unsupported function: ".concat(t))}}catch(s){console.warn("queueAudioPlayer",s)}}},{key:"callAudioPlayers",value:function callAudioPlayers(e){var _this=this;var _y_Utils=y.Utils,t=_y_Utils.Object;t.vals(this.audioClips).forEach(function(a){_this.queueAudioPlayer(a,e)})}}]);return Fa}();c(Fa,"BaseChannelManager");var ke=Fa;y.Plugins.Audio={BaseAudioPlayer:Ue,BaseChannelManager:ke};var Ua=function(_C_Plugins_BasePlugin){_inherits(Ua,_C_Plugins_BasePlugin);var _super=_create_super(Ua);function Ua(){_class_call_check(this,Ua);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"firstChannelId");u(_assert_this_initialized(_this),"channels",{});return _this}_create_class(Ua,[{key:"addChannel",value:function addChannel(t){var s=t.getId();this.channels[s]=t,this.firstChannelId||(this.firstChannelId=s)}},{key:"getChannel",value:function getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];var s=this.channels[t];if(!s)throw new Error("Channel ".concat(t," not found"));return s}},{key:"play",value:function play(t,s,a){try{this.getChannel(a).play(t,s)}catch(n){console.warn("playSound",n)}}},{key:"pause",value:function pause(t,s){try{this.getChannel(s).pause(t)}catch(a){console.warn("pauseSound",a)}}},{key:"resume",value:function resume(t,s){try{this.getChannel(s).resume(t)}catch(a){console.warn("resumeSound",a)}}},{key:"stop",value:function stop(t,s){try{this.getChannel(s).stop(t)}catch(a){console.warn("stopSound",a)}}},{key:"stopAll",value:function stopAll(t){try{this.getChannel(t).stopAll()}catch(s){console.warn("stopAllSounds",s)}}},{key:"mute",value:function mute(t){try{this.getChannel(t).muteAll()}catch(s){console.warn("mute",s)}}},{key:"unmute",value:function unmute(t){try{this.getChannel(t).unmuteAll()}catch(s){console.warn("unmute",s)}}},{key:"setVolume",value:function setVolume(t,s){try{this.getChannel(s).setVolume(t)}catch(a){console.warn("setSoundVolume",a)}}}]);return Ua}(C.Plugins.BasePlugin);c(Ua,"AudioPlugin");var Be=Ua;var Pr={token:"",isRequesting:!1},ka=function(_C_Plugins_BasePlugin){_inherits(ka,_C_Plugins_BasePlugin);var _super=_create_super(ka);function ka(){_class_call_check(this,ka);return _super.apply(this,arguments)}_create_class(ka,[{key:"init",value:function init(){var _this_game=this.game,e=_this_game.storage;e.addStorage("auth",Pr)}},{key:"requestToken",value:function requestToken(){var _this=this;return _async_to_generator(function(){var _this_game,e,n,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,e=_this_game.storage;_state.label=1;case 1:_state.trys.push([1,3,4,5]);if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return[2];e.setStorageData("auth","isRequesting",!0);return[4,GameSDK.player.getSignedPlayerInfoAsync()];case 2:n=_state.sent().getSignature();e.setStorageData("auth","token",n);return[3,5];case 3:t=_state.sent();if(y.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return[2];e.setStorageData("auth","token",""),console.error(t);return[3,5];case 4:e.setStorageData("auth","isRequesting",!1);return[7];case 5:return[2]}})})()}},{key:"getToken",value:function getToken(){var _this_game=this.game,e=_this_game.storage;return e.getStorageData("auth","token")}}]);return ka}(C.Plugins.BasePlugin);c(ka,"AuthPlugin");var je=ka;var vo=function(p){return p.SOLO="solo",p.TOURNAMENT="tournament",p.SHARE_INVITE="share_invite",p.MATCHING_GROUP="matching_group_match",p.CHALLENGE_FRIEND="challenge_friend_match",p}(vo||{});var Vt=vo,lt=po,_y_Utils4=y.Utils,ed=_y_Utils4.Array,xr=_y_Utils4.Valid,Er=_y_Utils4.Browser,Ba=function(){function Ba(e){_class_call_check(this,Ba);u(this,"game");this.game=e}_create_class(Ba,[{key:"isValidContextType",value:function isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}},{key:"isValidEntryPointData",value:function isValidEntryPointData(e){return xr.isObject(e)}},{key:"isTournamentEntryPoint",value:function isTournamentEntryPoint(e){return["facebook~game_list~tournaments","fb_feed_tournament_unit"].indexOf(e)>=0}},{key:"receiveContext",value:function receiveContext(e,t,s){var _this_game=this.game,a=_this_game.storage;a.setStorageData("context","contextId",e),this.isValidEntryPointData(s)?a.setStorageData("context","entryPointData",s):console.warn("Invalid context type: ".concat(t)),this.isValidContextType(t)?a.setStorageData("context","contextType",t):console.warn("Invalid context type: ".concat(t))}},{key:"detectContextSessionType",value:function detectContextSessionType(){var _this=this;return _async_to_generator(function(){var _this_game,e,t,s,a,n,i,o,r,l,d,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,e=_this_game.storage,t=e.getStorageData("context","entryPointData"),s=t.type,a=Vt.SOLO,n=Vt.TOURNAMENT,i=Vt.MATCHING_GROUP,o=Vt.SHARE_INVITE,r=Vt.CHALLENGE_FRIEND;l=a;if(!(s===n&&(l=n),s===i&&(l=i),(s===r||s===o)&&(l=r),l===a))return[3,4];d=Er.getQueryParams().entry_point;if(!d)return[3,1];l=_this.isTournamentEntryPoint(d)?n:a;return[3,4];case 1:_state.trys.push([1,3,,4]);if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");return[4,GameSDK.getTournamentAsync()];case 2:_state.sent(),l=n;return[3,4];case 3:e1=_state.sent();return[3,4];case 4:e.setStorageData("context","sessionContextType",l);return[2]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){var _this_game=this.game,e=_this_game.player,t=_this_game.storage,s=t.getStorageData("context","entryPointData"),a=t.getStorageData("context","sessionContextType"),n=e.getPlayerId(),i=s.matchId,o=s.playerId,tmp=s.opponentId,r=tmp===void 0?X.playerId:tmp,l=n===o,h=r===X.playerId||[r,o].indexOf(n)>=0,f=Vt.TOURNAMENT,g=Vt.MATCHING_GROUP,m=Vt.SHARE_INVITE,I=Vt.CHALLENGE_FRIEND;var w=lt.SINGLE;a===f&&(w=lt.TOURNAMENT),a===m&&!l&&(w=lt.CHALLENGE_FRIEND),a===I&&i&&h&&(w=lt.CHALLENGE_FRIEND),a===g&&(w=lt.MATCHING_GROUP),t.setStorageData("context","contextGameMode",w)}}]);return Ba}();c(Ba,"Context");var Ke=Ba;var ja=function(Error1){_inherits(ja,Error1);var _super=_create_super(ja);function ja(e){_class_call_check(this,ja);var _this;_this=_super.call(this,e),_this.name="PlayerHasFinishedMatch",_this.message=e!==null&&e!==void 0?e:"Player has finished match";return _possible_constructor_return(_this)}return ja}(_wrap_native_super(Error));c(ja,"PlayerHasFinishedMatch");var Zt=ja;var Ka=function(Error1){_inherits(Ka,Error1);var _super=_create_super(Ka);function Ka(e){_class_call_check(this,Ka);var _this;_this=_super.call(this,e),_this.name="PlayerNotJoinInMatch",_this.message=e||"Player is not join in match";return _possible_constructor_return(_this)}return Ka}(_wrap_native_super(Error));c(Ka,"PlayerNotJoinInMatch");var Ft=Ka;var We=y.Events,Sr=y.Plugins,vr=y.Utils,br=vr.Object,bo=Sr.Analytics,Wa=function(){function Wa(e){_class_call_check(this,Wa);u(this,"game");this.game=e}_create_class(Wa,[{key:"processContextData",value:function processContextData(){var _this=this;return _async_to_generator(function(){var _this_game,e,t,s,a,n,i,_ref,o,r,l,d,h,w,f,g,m,I,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,e=_this_game.player,t=_this_game.analytics,s=_this_game.storage,a=s.getStorageData("context","contextId"),n=s.getStorageData("context","entryPointData"),i=s.getStorageData("context","sessionContextType"),_ref=n||{},o=_ref.type,r=_ref.matchId,l=_ref.playerId,d=_ref.opponentId,h=_ref.playerScore;if(e.isFirstLogin())t.event(bo.Events.NEW_USER);else{w=e.getGameData();t.event(bo.Events.RETURNING_USER,{game_data:br.snakeCaseKeys(w||{})})}f=Vt.TOURNAMENT,g=Vt.SHARE_INVITE,m=Vt.MATCHING_GROUP,I=Vt.CHALLENGE_FRIEND;if(!(i===f))return[3,6];_state.label=1;case 1:_state.trys.push([1,3,,5]);return[4,_this.processTournamentModeAsync()];case 2:_state.sent();return[3,5];case 3:e1=_state.sent();return[4,_this.processSingleModeAsync()];case 4:_state.sent();return[3,5];case 5:return[2];case 6:if(!(i===I))return[3,10];if(!(o===g&&typeof l=="string"))return[3,8];return[4,_this.processChallengeFromPostAsync(l)];case 7:_state.sent();return[2];case 8:if(!(o===I&&typeof r=="string"&&typeof l=="string"&&typeof d=="string"))return[3,10];return[4,_this.processChallengeFromMessageAsync({contextId:a,matchId:r,playerId:l,opponentId:d})];case 9:_state.sent();return[2];case 10:if(!(i===m&&typeof l=="string"&&typeof h=="number"))return[3,12];return[4,_this.processMatchingGroupModeAsync(l,h)];case 11:_state.sent();return[2];case 12:if(!e.isFirstLogin())return[3,14];return[4,_this.processSingleModeAsync()];case 13:_state.sent(),e.loggedIn();return[2];case 14:_this.switchToDashboardScene();return[2]}})})()}},{key:"processTournamentModeAsync",value:function processTournamentModeAsync(){var _this=this;return _async_to_generator(function(){var _this_game,e,t,s,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,e=_this_game.match,t=_this_game.player,s=t.getPlayerId(),a=GameSDK.context.getID();if(typeof a!="string")throw new Error("Cannot get contextId");return[4,e.tournament.continue.processAsync({playerId:s,contextId:a})];case 1:_state.sent(),_this.switchToGameScene();return[2]}})})()}},{key:"processChallengeFromPostAsync",value:function processChallengeFromPostAsync(e){var _this=this;return _async_to_generator(function(){var _this_game,t,s,a,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,t=_this_game.match,s=_this_game.player,a=s.getPlayerId();if(!(a===e))return[3,2];return[4,t.single.start.processAsync({playerId:a})];case 1:_state.sent();return[3,6];case 2:_state.trys.push([2,4,,6]);return[4,t.challenge.friend.processAsync({playerId:a,opponentId:e})];case 3:_state.sent();return[3,6];case 4:i=_state.sent();console.warn("processChallengeFromPostAsync",i);return[4,t.single.start.processAsync({playerId:a})];case 5:_state.sent();return[3,6];case 6:_this.switchToGameScene();return[2]}})})()}},{key:"processChallengeFromMessageAsync",value:function processChallengeFromMessageAsync(e){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,7]);return[4,_this.processContinueChallengeFromMessageAsync(e)];case 1:_state.sent();return[3,7];case 2:t=_state.sent();if(!(console.warn("processContinueChallengeFromMessageAsync",t),_instanceof(t,Zt)))return[3,4];return[4,_this.processAwaitChallengeFromMessageAsync(e)];case 3:_state.sent();return[2];case 4:if(!_instanceof(t,Ft))return[3,6];return[4,_this.processJoinChallengeFromMessageAsync(e)];case 5:_state.sent();return[2];case 6:_this.switchToDashboardScene();return[3,7];case 7:return[2]}})})()}},{key:"processContinueChallengeFromMessageAsync",value:function processContinueChallengeFromMessageAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,_this_game,i,o,r,d;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=e.contextId,s=e.matchId,a=e.playerId,n=e.opponentId,_this_game=_this.game,i=_this_game.match,o=_this_game.player,r=o.getPlayerId();if(!(a===r))return[3,2];return[4,i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:r,opponentId:n})];case 1:_state.sent();return[3,4];case 2:d=n===X.playerId;return[4,i.challenge.continue.processAsync({contextId:t,matchId:s,playerId:r,opponentId:d?n:a})];case 3:_state.sent();_state.label=4;case 4:_this.switchToGameScene();return[2]}})})()}},{key:"processJoinChallengeFromMessageAsync",value:function processJoinChallengeFromMessageAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,_this_game,n,i,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=e.contextId,s=e.matchId,a=e.playerId,_this_game=_this.game,n=_this_game.match,i=_this_game.player,o=i.getPlayerId();return[4,n.challenge.join.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a})];case 1:_state.sent(),_this.switchToGameScene();return[2]}})})()}},{key:"processAwaitChallengeFromMessageAsync",value:function processAwaitChallengeFromMessageAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,_this_game,n,i,o,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=e.contextId,s=e.matchId,a=e.playerId,_this_game=_this.game,n=_this_game.match,i=_this_game.player,o=i.getPlayerId();_state.label=1;case 1:_state.trys.push([1,3,,5]);return[4,n.challenge.await.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a})];case 2:_state.sent(),_this.switchToChallengeResultScene();return[3,5];case 3:r=_state.sent();console.warn("processAwaitChallengeFromMessageAsync",r);return[4,_this.processResultChallengeFromMessageAsync(e)];case 4:_state.sent();return[3,5];case 5:return[2]}})})()}},{key:"processResultChallengeFromMessageAsync",value:function processResultChallengeFromMessageAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,_this_game,n,i,o,e1;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=e.contextId,s=e.matchId,a=e.playerId,_this_game=_this.game,n=_this_game.match,i=_this_game.player,o=i.getPlayerId();_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,n.challenge.result.processAsync({contextId:t,matchId:s,playerId:o,opponentId:a})];case 2:_state.sent(),_this.switchToChallengeResultScene();return[3,4];case 3:e1=_state.sent();_this.switchToDashboardScene();return[3,4];case 4:return[2]}})})()}},{key:"processMatchingGroupModeAsync",value:function processMatchingGroupModeAsync(e,t){var _this=this;return _async_to_generator(function(){var _this_game,s,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,s=_this_game.match,a=_this_game.player;return[4,s.group.join.processAsync({playerId:a.getPlayerId(),opponentId:e,opponentScore:t})];case 1:_state.sent(),_this.switchToGameScene();return[2]}})})()}},{key:"processSingleModeAsync",value:function processSingleModeAsync(){var _this=this;return _async_to_generator(function(){var _this_game,e,t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,e=_this_game.match,t=_this_game.player,s=t.getPlayerId();return[4,e.single.start.processAsync({playerId:s})];case 1:_state.sent(),_this.switchToGameScene();return[2]}})})()}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){var _this_game=this.game,e=_this_game.event;e.emit(We.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isMatchStartFromLoader:!0}})}},{key:"switchToGameScene",value:function switchToGameScene(){var _this_game=this.game,e=_this_game.event;e.emit(We.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isMatchStartFromLoader:!0}})}},{key:"switchToChallengeResultScene",value:function switchToChallengeResultScene(){var _this_game=this.game,e=_this_game.event;e.emit(We.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isMatchStartFromLoader:!0}})}}]);return Wa}();c(Wa,"Loader");var ze=Wa;var No={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},Nr=y.Events,za=function(_C_Plugins_BasePlugin){_inherits(za,_C_Plugins_BasePlugin);var _super=_create_super(za);function za(t){_class_call_check(this,za);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"context");u(_assert_this_initialized(_this),"loader");_this.loader=new ze(t),_this.context=new Ke(t);return _this}_create_class(za,[{key:"init",value:function init(){var _this_game=this.game,t=_this_game.storage;t.addStorage("context",No)}},{key:"getSessionContextTypes",value:function getSessionContextTypes(){return Vt}},{key:"processContextData",value:function processContextData(){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,_this.loader.processContextData()];case 1:_state.sent();return[3,3];case 2:t=_state.sent();console.error("processContextData",t),_this.switchToDashboardScene();return[3,3];case 3:return[2]}})})()}},{key:"detectContextSessionType",value:function detectContextSessionType(){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,_this.context.detectContextSessionType()];case 1:_state.sent();return[3,3];case 2:t=_state.sent();console.error("detectContextSessionType",t);return[3,3];case 3:return[2]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){this.context.detectContextGameMode()}},{key:"receiveContext",value:function receiveContext(t,s,a){this.context.receiveContext(t,s,a)}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){var _this_game=this.game,t=_this_game.event;t.emit(Nr.SWITCH_SCENE,{sceneName:"DashboardScene"})}}]);return za}(C.Plugins.BasePlugin);c(za,"ContextPlugin");var He=za;var _y_Utils5=y.Utils,qe=_y_Utils5.Valid,Cr=No.contextId,Or=No.contextType,Lr=No.entryPointData,Ye="is invalid",Ha=function(G){_inherits(Ha,G);var _super=_create_super(Ha);function Ha(){_class_call_check(this,Ha);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"data");return _this}_create_class(Ha,[{key:"setupData",value:function setupData(t){this.lazySetupData(t)}},{key:"validateStructure",value:function validateStructure(t){this.lazyValidateStructure(t)}},{key:"validateData",value:function validateData(t){this.lazyValidateData(t)}},{key:"validateContextId",value:function validateContextId(t){qe.isString(t)||this.exception("contextId",Ye)}},{key:"validateContextType",value:function validateContextType(t){(!qe.isString(t)||!t)&&this.exception("contextType",Ye)}},{key:"validateEntryPointData",value:function validateEntryPointData(t){qe.isObject(t)||this.exception("entryPointData",Ye)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ha.prototype),"toObject",this).call(this)}}]);return Ha}(G);c(Ha,"ContextInfoDtos");var te=Ha;te.addDefaultData({contextId:Cr,contextType:Or,entryPointData:Lr}),y.Dtos.Context={Info:te};var Tr={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},_y_Utils6=y.Utils,Mr=_y_Utils6.Object,qa=function(){function qa(){_class_call_check(this,qa)}_create_class(qa,[{key:"getDailyRewardsAsync",value:function getDailyRewardsAsync(){return _async_to_generator(function(){return _ts_generator(this,function(_state){return[2,Mr.vals(Tr)]})})()}}]);return qa}();c(qa,"DailyRewardsAPI");var Qe=qa;var Ut={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},Rr={dailyRewards:{}},Co=y.Configs.DailyRewards,Ya=function(_C_Plugins_BasePlugin){_inherits(Ya,_C_Plugins_BasePlugin);var _super=_create_super(Ya);function Ya(){_class_call_check(this,Ya);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"dailyRewardsApi",new Qe);return _this}_create_class(Ya,[{key:"init",value:function init(){var _this_game=this.game,t=_this_game.storage;t.addStorage("dailyRewards",Rr)}},{key:"requestDailyRewardsAsync",value:function requestDailyRewardsAsync(){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this.dailyRewardsApi.getDailyRewardsAsync()];case 1:t=_state.sent();t.length!==0&&_this.receiveDailyRewards(t);return[2]}})})()}},{key:"getDailyRewards",value:function getDailyRewards(){var _this_game=this.game,t=_this_game.storage,s=t.getStorageData("dailyRewards","dailyRewards");return s||null}},{key:"logLoginReward",value:function logLoginReward(){var _this_game=this.game,t=_this_game.player,_t_getPlayerData_dailyRewarded=t.getPlayerData().dailyRewarded,s=_t_getPlayerData_dailyRewarded.logDays,a=_to_consumable_array(s);a[a.length-1]=!0,this.logDailyRewards(a)}},{key:"logDailyRewards",value:function logDailyRewards(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;var _this_game=this.game,a=_this_game.player;a.setPlayerDataByName("dailyRewarded",{logDays:t,lastRewarded:s?0:Date.now()})}},{key:"receiveDailyRewards",value:function receiveDailyRewards(t){var _this_game=this.game,s=_this_game.player,_s_getPlayerData_dailyRewarded=s.getPlayerData().dailyRewarded,a=_s_getPlayerData_dailyRewarded.logDays,n=_s_getPlayerData_dailyRewarded.lastRewarded,i=new Date,o=new Date(n),r=new Date(o.toDateString()),l=Math.abs(i.valueOf()-r.valueOf()),h=Math.floor(l/864e5)>1,g=Co.CheckInterrupt&&h||a.length>=Co.MaxDays,m=g?[!1]:_to_consumable_array(a).concat([!1]);this.logDailyRewards(m);var I=t.map(function(w,_){var Q=_<m.length,E=m.length===_+1,uo=m[_]===!1;var q=Ut.WAITING;return E?q=Ut.READY:g?q=Ut.WAITING:Q&&uo?q=Ut.SKIPPED:Q&&(q=Ut.REWARDED),_object_spread_props(_object_spread({},w),{status:q})});this.setDailyRewards(I)}},{key:"setDailyRewards",value:function setDailyRewards(t){var _this_game=this.game,s=_this_game.storage;s.setStorageData("dailyRewards","dailyRewards",t)}}]);return Ya}(C.Plugins.BasePlugin);c(Ya,"DailyRewardsPlugin");var Xe=Ya;var Je={exports:{}};Je.exports,function(p){var e=Object.prototype.hasOwnProperty,t="~";function s(){}c(s,"Events"),Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function a(r,l,d){this.fn=r,this.context=l,this.once=d||!1}c(a,"EE");function n(r,l,d,h,f){if(typeof d!="function")throw new TypeError("The listener must be a function");var g=new a(d,h||r,f),m=t?t+l:l;return r._events[m]?r._events[m].fn?r._events[m]=[r._events[m],g]:r._events[m].push(g):(r._events[m]=g,r._eventsCount++),r}c(n,"addListener");function i(r,l){--r._eventsCount===0?r._events=new s:delete r._events[l]}c(i,"clearEvent");function o(){this._events=new s,this._eventsCount=0}c(o,"EventEmitter"),o.prototype.eventNames=c(function(){var l=[],d,h;if(this._eventsCount===0)return l;for(h in d=this._events)e.call(d,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(d)):l},"eventNames"),o.prototype.listeners=c(function(l){var d=t?t+l:l,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,g=h.length,m=new Array(g);f<g;f++)m[f]=h[f].fn;return m},"listeners"),o.prototype.listenerCount=c(function(l){var d=t?t+l:l,h=this._events[d];return h?h.fn?1:h.length:0},"listenerCount"),o.prototype.emit=c(function(l,d,h,f,g,m){var I=t?t+l:l;if(!this._events[I])return!1;var w=this._events[I],_=arguments.length,Q,E;if(w.fn){switch(w.once&&this.removeListener(l,w.fn,void 0,!0),_){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,d),!0;case 3:return w.fn.call(w.context,d,h),!0;case 4:return w.fn.call(w.context,d,h,f),!0;case 5:return w.fn.call(w.context,d,h,f,g),!0;case 6:return w.fn.call(w.context,d,h,f,g,m),!0}for(E=1,Q=new Array(_-1);E<_;E++)Q[E-1]=arguments[E];w.fn.apply(w.context,Q)}else{var uo=w.length,q;for(E=0;E<uo;E++)switch(w[E].once&&this.removeListener(l,w[E].fn,void 0,!0),_){case 1:w[E].fn.call(w[E].context);break;case 2:w[E].fn.call(w[E].context,d);break;case 3:w[E].fn.call(w[E].context,d,h);break;case 4:w[E].fn.call(w[E].context,d,h,f);break;default:if(!Q)for(q=1,Q=new Array(_-1);q<_;q++)Q[q-1]=arguments[q];w[E].fn.apply(w[E].context,Q)}}return!0},"emit"),o.prototype.on=c(function(l,d,h){return n(this,l,d,h,!1)},"on"),o.prototype.once=c(function(l,d,h){return n(this,l,d,h,!0)},"once"),o.prototype.removeListener=c(function(l,d,h,f){var g=t?t+l:l;if(!this._events[g])return this;if(!d)return i(this,g),this;var m=this._events[g];if(m.fn)m.fn===d&&(!f||m.once)&&(!h||m.context===h)&&i(this,g);else{for(var I=0,w=[],_=m.length;I<_;I++)(m[I].fn!==d||f&&!m[I].once||h&&m[I].context!==h)&&w.push(m[I]);w.length?this._events[g]=w.length===1?w[0]:w:i(this,g)}return this},"removeListener"),o.prototype.removeAllListeners=c(function(l){var d;return l?(d=t?t+l:l,this._events[d]&&i(this,d)):(this._events=new s,this._eventsCount=0),this},"removeAllListeners"),o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,p.exports=o}(Je);var _r=Je.exports;var $r=yo(_r),nt=new $r,Gr={names:[],history:[]},Qa=function(_C_Plugins_BasePlugin){_inherits(Qa,_C_Plugins_BasePlugin);var _super=_create_super(Qa);function Qa(){_class_call_check(this,Qa);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"enableLog",!1);u(_assert_this_initialized(_this),"muteEvents",[]);return _this}_create_class(Qa,[{key:"init",value:function init(){var _this_game=this.game,t=_this_game.storage;t.addStorage("event",Gr)}},{key:"enableLogEvent",value:function enableLogEvent(){this.enableLog=!0}},{key:"on",value:function on(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"on","listening"),nt.on(t,s)}},{key:"once",value:function once(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"once","listening"),nt.once(t,s)}},{key:"off",value:function off(t,s){this.validateCallback(s),nt.off(t,s),this.addHistory(t,"any","removed")}},{key:"mute",value:function mute(t){this.muteEvents.indexOf(t)>-1||this.muteEvents.push(t)}},{key:"clear",value:function clear(t){nt.removeAllListeners(t),this.addHistory(t,"any","removed")}},{key:"emit",value:function emit(t,s){var _nt;if(this.muteEvents.indexOf(t)>-1)return;var a=[];s&&(a=[s]),this.addHistory(t,"any","called",s),(_nt=nt).emit.apply(_nt,[t].concat(_to_consumable_array(a)))}},{key:"validateCallback",value:function validateCallback(t){if(typeof t!="function")throw new Error("Callback must be a function")}},{key:"addEventName",value:function addEventName(t){var _this_game=this.game,s=_this_game.storage,a=s.getStorageData("event","names");a.indexOf(t)<0&&a.push(t)}},{key:"getEventListeners",value:function getEventListeners(){var t=nt.eventNames();return Object.keys(t)}},{key:"getHistory",value:function getHistory(){var _this_game=this.game,t=_this_game.storage;return t.getStorageData("event","history")}},{key:"getEventEmitCount",value:function getEventEmitCount(t){return this.getHistory().filter(function(a){return a.name===t&&a.status==="called"}).length}},{key:"getLastEventInfo",value:function getLastEventInfo(t){var s=this.getHistory();var a=null;for(var n=s.length-1;n>=0;n--)if(s[n].name===t){a=s[n];break}return a}},{key:"getTypeFromHistory",value:function getTypeFromHistory(t){var s=this.getLastEventInfo(t);var _ref;return(_ref=s==null?void 0:s.type)!==null&&_ref!==void 0?_ref:null}},{key:"getCallsFromHistory",value:function getCallsFromHistory(t){var s=this.getLastEventInfo(t);var _ref;return(_ref=s==null?void 0:s.called)!==null&&_ref!==void 0?_ref:0}},{key:"addHistory",value:function addHistory(t,s,a,n){var _this_getTypeFromHistory;var o=(_this_getTypeFromHistory=this.getTypeFromHistory(t))!==null&&_this_getTypeFromHistory!==void 0?_this_getTypeFromHistory:s,r=this.getCallsFromHistory(t),l=a==="called"?r+1:r;this.getHistory().push({type:o,status:a,name:t,called:l,payload:n!==null&&n!==void 0?n:{}}),this.logEventInfo(t,o,a,l)}},{key:"logEventInfo",value:function logEventInfo(t,s,a,n){if(this.enableLog){if(a==="listening"){console.info("Event (".concat(s,") ").concat(t,": ").concat(a));var i=nt.listenerCount(t);i>1&&console.warn("Event ".concat(t," has ").concat(i," listener"))}else s!=="any"&&console.info("Event (".concat(s,") ").concat(t,": ").concat(a," (").concat(n," times)"));a==="called"&&nt.listenerCount(t)<=0&&console.warn("Event ".concat(t," is called but not listening"))}}}]);return Qa}(C.Plugins.BasePlugin);c(Qa,"EventPlugin");var Ze=Qa;var ts={},kt=Object.freeze(Object.defineProperty({__proto__:null,default:ts},Symbol.toStringTag,{value:"Module"})),Vr='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',Fr=y.Configs,Ur=y.Utils,Oo=Ur.Object,_Fr_FrameCapture=Fr.FrameCapture,kr=_Fr_FrameCapture.Enabled,es=_Fr_FrameCapture.WideframeConfigs,Br=c(function(){var _ref=_async_to_generator(function(p){var e,_window_game,t,_es_ResultChallenge,s,a;return _ts_generator(this,function(_state){if(!kr)return[2,(console.warn("FrameCapture is not enabled"),null)];e=Kr(p);if(!e)return[2,null];jr(e,es.ResultChallenge);_window_game=window.game,t=_window_game.frameCapture,_es_ResultChallenge=es.ResultChallenge,s=_es_ResultChallenge.Width,a=_es_ResultChallenge.Height;return[2,t.captureAsync({name:"ResultChallenge",width:s,height:a,renderOptions:e})]})});return function(p){return _ref.apply(this,arguments)}}(),"renderResultChallenge"),jr=c(function(p,e){var t=e.Width,s=e.Height,a=e.Wideframe;p.wideframe={name:"result-challenge",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe$2"),Kr=c(function(p){try{var tmp=p.playerId,_$e=tmp===void 0?"10":tmp,tmp1=p.playerPhoto,t=tmp1===void 0?"":tmp1,tmp2=p.playerScore,s=tmp2===void 0?0:tmp2,tmp3=p.opponentId,a=tmp3===void 0?"20":tmp3,tmp4=p.opponentPhoto,n=tmp4===void 0?"":tmp4,tmp5=p.opponentScore,i=tmp5===void 0?0:tmp5,o=p.isPlayerFinished,r=p.isOpponentFinished,_es_ResultChallenge=es.ResultChallenge,l=_es_ResultChallenge.RenderOptions,d=Oo.camelCaseKeys(Oo.clone(l)),h=d.playerPhoto,f=d.opponentPhoto,g=s===i,m=s>i,I=o!==null&&o!==void 0?o:r,w=o&&r;return h.type==="image"&&(h.name="".concat(_$e),h.image=t),f.type==="image"&&(f.name="".concat(a),f.image=n),I&&Wr(d,{playerScore:s,opponentScore:i,isPlayerFinished:o,isOpponentFinished:r}),!w||g?(delete d.leftCrown,delete d.rightCrown,d):(m?delete d.rightCrown:delete d.leftCrown,d)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$2"),Wr=c(function(p,e){var t=p.leftScore,s=p.rightScore,tmp=e.playerScore,a=tmp===void 0?0:tmp,tmp1=e.opponentScore,n=tmp1===void 0?0:tmp1,i=e.isPlayerFinished,o=e.isOpponentFinished;t.type==="text"&&(t.text=i?"".concat(a):"???"),s.type==="text"&&(s.text=o?"".concat(n):"???")},"addRenderScores"),zr=y.Configs,Hr=y.Utils,Lo=Hr.Object,_zr_FrameCapture=zr.FrameCapture,qr=_zr_FrameCapture.Enabled,ss=_zr_FrameCapture.WideframeConfigs,Yr=c(function(){var _ref=_async_to_generator(function(p){var e,_window_game,t,_ss_ShareLeaderboard,s,a;return _ts_generator(this,function(_state){if(!qr)return[2,(console.warn("FrameCapture is not enabled"),null)];e=Xr(p);if(!e)return[2,null];Qr(e,ss.ShareLeaderboard);_window_game=window.game,t=_window_game.frameCapture,_ss_ShareLeaderboard=ss.ShareLeaderboard,s=_ss_ShareLeaderboard.Width,a=_ss_ShareLeaderboard.Height;return[2,t.captureAsync({name:"ShareLeaderboard",width:s,height:a,renderOptions:e})]})});return function(p){return _ref.apply(this,arguments)}}(),"renderShareLeaderboard"),Qr=c(function(p,e){var t=e.Width,s=e.Height,a=e.Wideframe;p.wideframe={name:"share-leaderboard",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe$1"),Xr=c(function(p){try{var _$e=p.playerId,t=p.playerPhoto,s=p.leaders,_ss_ShareLeaderboard=ss.ShareLeaderboard,a=_ss_ShareLeaderboard.RenderOptions,n=Lo.camelCaseKeys(Lo.clone(a)),i=n.avatar;return i.type==="image"&&(i.name="".concat(_$e),i.image=t),Jr(n,s),n}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$1"),Jr=c(function(p,e){var t="600 48px";e.forEach(function(s,a){var n=s.id,i=s.name,o=s.photo,r=s.score;var l=1294+180*a;p["photo_".concat(n)]={depth:-1,name:n,type:"image",image:o,size:[96,96],position:[436,l]},l=1360+180*a,p["name_".concat(n)]={font:t,depth:1,name:n,type:"text",text:i,position:[600,l]},p["score_".concat(n)]={font:t,depth:1,name:n,type:"text",text:"".concat(r),position:[100,l]}})},"addLeaders"),Zr=y.Configs,tc=y.Utils,To=tc.Object,_Zr_FrameCapture=Zr.FrameCapture,ec=_Zr_FrameCapture.Enabled,as=_Zr_FrameCapture.WideframeConfigs,sc=c(function(){var _ref=_async_to_generator(function(p){var e,_window_game,t,_as_ShareScore,s,a;return _ts_generator(this,function(_state){if(!ec)return[2,(console.warn("FrameCapture is not enabled"),null)];e=nc(p);if(!e)return[2,null];ac(e,as.ShareScore);_window_game=window.game,t=_window_game.frameCapture,_as_ShareScore=as.ShareScore,s=_as_ShareScore.Width,a=_as_ShareScore.Height;return[2,t.captureAsync({name:"ShareScore",width:s,height:a,renderOptions:e})]})});return function(p){return _ref.apply(this,arguments)}}(),"renderShareScore"),ac=c(function(p,e){var t=e.Width,s=e.Height,a=e.Wideframe;p.wideframe={name:"share-score",type:"image",depth:0,image:a,size:[t,s],position:[0,0]}},"addWideframe"),nc=c(function(p){try{var _$e=p.playerId,t=p.playerPhoto,s=p.playerScore,_as_ShareScore=as.ShareScore,a=_as_ShareScore.RenderOptions,n=To.camelCaseKeys(To.clone(a));console.log("renderOptions",n);var i=n.avatar,o=n.playerScore;return i.type==="image"&&(i.name="".concat(_$e),i.image=t),o.type==="text"&&(o.text="".concat(s)),n}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions"),ic=y.Configs,oc=y.Utils,ee=oc.Image,Bt=oc.Object,se=oc.Valid,_ic_FrameCapture=ic.FrameCapture,ns=_ic_FrameCapture.Options,Xa=function(_C_Plugins_BasePlugin){_inherits(Xa,_C_Plugins_BasePlugin);var _super=_create_super(Xa);function Xa(){_class_call_check(this,Xa);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"width");u(_assert_this_initialized(_this),"height");u(_assert_this_initialized(_this),"canvas",null);u(_assert_this_initialized(_this),"testRenderOptions",null);u(_assert_this_initialized(_this),"caches",{});u(_assert_this_initialized(_this),"wideframe",{});return _this}_create_class(Xa,[{key:"init",value:function init(){this.addWideframeRender("renderShareScore",sc),this.addWideframeRender("renderResultChallenge",Br),this.addWideframeRender("renderShareLeaderboard",Yr)}},{key:"preloadAsync",value:function preloadAsync(t){var _this=this;return _async_to_generator(function(){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=t.renderOptions;return[4,_this.loadImages(s)];case 1:_state.sent();return[2]}})})()}},{key:"captureAsync",value:function captureAsync(t){var _this=this;return _async_to_generator(function(){var s,a,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=t.width,a=t.height,n=t.renderOptions;_this.width=s,_this.height=a,_this.createCanvas();return[4,_this.loadImages(n)];case 1:return[2,(_state.sent(),_this.drawObjects(n),_this.snapshotFrameAsync())]}})})()}},{key:"addWideframeRender",value:function addWideframeRender(t,s){this.wideframe[t]=s}},{key:"setTestRenderOptions",value:function setTestRenderOptions(t){if(!t){this.testRenderOptions=null;return}var s=Bt.camelCaseKeys(t);this.testRenderOptions=Bt.merge(this.testRenderOptions,s)}},{key:"createCanvas",value:function createCanvas(){if(this.canvas){var t=this.canvas.getContext("2d");t?t.clearRect(0,0,this.canvas.width,this.canvas.height):this.canvas=null}this.canvas||(this.canvas=document.createElement("canvas",{is:"canvas"})),this.canvas.width=this.width,this.canvas.height=this.height}},{key:"loadImages",value:function loadImages(t){var _this=this;return _async_to_generator(function(){var s,a,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=Bt.vals(t).filter(function(o){return o.type==="image"}),a=_this.prepareLoadImages(s),n=Bt.vals(a);if(n.length<1)return[2];return[4,Promise.all(n)];case 1:i=_state.sent();_this.cacheImages(a,i);return[2]}})})()}},{key:"prepareLoadImages",value:function prepareLoadImages(t){var s={};var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{var _this,_loop=function(){var a=_step.value;var n=a.name,i=a.image,o=a.fallbackImage,r=_this.caches[n];!se.isString(i)||r||(i===""&&se.isString(o)&&(a.image=o),console.info("prepareLoadImages",a),s[n]=new Promise(function(l){var d=ee.loadImage(i);d.catch(function(){se.isString(o)?(a.image=o,ee.loadImage(a.image).then(function(h){l(h)}).catch(function(){l(null)})):l(null)}),d.then(function(h){l(h)})}))};for(var _iterator=t[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true)_this=this,_loop()}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return s}},{key:"cacheImages",value:function cacheImages(t,s){for(var a in t){var n=s.shift();n&&(this.caches[a]=n)}}},{key:"drawObjects",value:function drawObjects(t){var s=Bt.vals(t).sort(function(a,n){return a.depth-n.depth});var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=s[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var a=_step.value;switch(a.type){case"text":this.drawText(a);break;case"image":this.drawImage(a);break}}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}}},{key:"drawText",value:function drawText(t){if(!this.canvas)return;var s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;var a=t.position,n=t.font,i=t.text,o=t.color,r=t.lineWidth,l=t.textAlign;s.font="".concat(n," ").concat(Vr),s.fillStyle=o!==null&&o!==void 0?o:"#ffffff",r&&(s.lineWidth=r),l&&(s.textAlign=l),console.info("drawText",t);var _a=_sliced_to_array(a,2),d=_a[0],h=_a[1];s.fillText(i,d,h)}},{key:"drawImage",value:function drawImage(t){if(!this.canvas)return;var s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;var a=t.name,n=t.size,i=t.position,o=t.fallbackImage;var r=this.caches[a];if(!r&&o&&(r=this.caches[o]),!r)throw new Error("Image ".concat(a," not found"));console.info("drawImage",t);var _i=_sliced_to_array(i,2),l=_i[0],d=_i[1],_n=_sliced_to_array(n,2),h=_n[0],f=_n[1];s.drawImage(r,l,d,h,f)}},{key:"snapshotFrameAsync",value:function snapshotFrameAsync(){var _this=this;return _async_to_generator(function(){var t,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!_this.canvas)return[2,null];t=null;if(!(ns.UseBlobIfPossible&&"toBlob"in _this.canvas))return[3,2];return[4,_this.createAsBlob()];case 1:_tmp=t=_state.sent();return[3,3];case 2:_tmp=t=_this.createAsDataImage();_state.label=3;case 3:if(_tmp,!t)throw new Error("Image data is null");return[2,(se.isDebugger()&&ee.logImage(t),t)]}})})()}},{key:"createAsDataImage",value:function createAsDataImage(){if(!this.canvas)return null;var t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return null;var s=ns.Quality,a=ns.RenderType;return t.canvas.toDataURL("image/".concat(a),s)}},{key:"createAsBlob",value:function createAsBlob(){var _this=this;return new Promise(function(t){if(!_this.canvas){t(null);return}var s=ns.Quality,a=ns.RenderType;_this.canvas.toBlob(function(n){if(!n){t(null);return}ee.blobToDataImage(n).then(function(i){t(i)})},"image/".concat(a),s)})}}]);return Xa}(C.Plugins.BasePlugin);c(Xa,"FrameCapturePlugin");var is=Xa;var Ja=function(Error1){_inherits(Ja,Error1);var _super=_create_super(Ja);function Ja(t,s){_class_call_check(this,Ja);var _this;_this=_super.call(this,'Text with key "'.concat(t,'" not found in locale "').concat(s,'"'));u(_assert_this_initialized(_this),"key");u(_assert_this_initialized(_this),"locale");_this.name="MissingKeyInLocaleError",_this.key=t,_this.locale=s;return _this}return Ja}(_wrap_native_super(Error));c(Ja,"MissingKeyInLocaleError");var ae=Ja;var Za=function(Error1){_inherits(Za,Error1);var _super=_create_super(Za);function Za(t){_class_call_check(this,Za);var _this;_this=_super.call(this,"Locale not found: ".concat(t));u(_assert_this_initialized(_this),"locale");_this.name="LocaleNotFoundError",_this.locale=t;return _this}return Za}(_wrap_native_super(Error));c(Za,"LocaleNotFoundError");var ne=Za;var Mo=y.Utils,tn=function(_C_Plugins_BasePlugin){_inherits(tn,_C_Plugins_BasePlugin);var _super=_create_super(tn);function tn(){_class_call_check(this,tn);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"locale");u(_assert_this_initialized(_this),"data",{});return _this}_create_class(tn,[{key:"add",value:function add(t,s){this.data[t]=s}},{key:"choose",value:function choose(t){this.locale=t;var _this_game=this.game,s=_this_game.event;s.emit(y.Events.LANGUAGE_CHANGED,{locale:t})}},{key:"getText",value:function getText(t,s,a){try{var _this_getLocaleData=this.getLocaleData(a),_$n=_this_getLocaleData.text;if(!Mo.Object.hasOwn(_$n,t)){var o=a!==null&&a!==void 0?a:this.getCurrentLocale();throw new ae(String(t),o)}var i=_$n[t];return this.replaceVariables(i,s!==null&&s!==void 0?s:[])}catch(n){return _instanceof(n,ae)?(console.warn('Text with key "'.concat(n.key,'" not found in locale "').concat(n.locale,'"')),n.key):_instanceof(n,ne)?(console.warn('Locale "'.concat(n.locale,'" not found')),String(t)):(console.error(n),String(t))}}},{key:"getTexture",value:function getTexture(t){var _this_getLocaleData=this.getLocaleData(),s=_this_getLocaleData.texture;return s[t]}},{key:"getCurrentLocale",value:function getCurrentLocale(){return this.locale||"en"}},{key:"getLocaleData",value:function getLocaleData(t){var s=t!==null&&t!==void 0?t:this.getCurrentLocale();if(!Mo.Object.hasOwn(this.data,s))throw new ne(s);return this.data[s]}},{key:"replaceVariables",value:function replaceVariables(t,s){var a=s.length;if(a==0)return t;var n=t;for(var i=0;i<a;i++){var o=s[i],r="%{".concat(i,"}");n=n.replace(r,o)}return n}}]);return tn}(C.Plugins.BasePlugin);c(tn,"LanguagePlugin");var os=tn;var rc={_id:"",name:"",createdBy:"",description:"",expireTime:7*24*60*60*1e3,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15},cc=y.Configs,lc=y.Utils,ie=lc.Object,Ro=lc.String,dc=lc.Valid,oe=cc.OtherHost,re=cc.Mockup,hc=cc.AppId,en=function(){function en(){_class_call_check(this,en);u(this,"mockAPI")}_create_class(en,[{key:"initMockAPI",value:function initMockAPI(){var _this=this;return _async_to_generator(function(){var e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(_this.mockAPI)return[2];return[4,st(_async_to_generator(function(){var _ref,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.resolve().then(function(){return kt})];case 1:_ref=_state.sent(),t=_ref.default;return[2,{default:t}]}})}),void 0,b.meta.url)];case 1:e=_state.sent().default;if(typeof e!="function")throw new Error("Cannot load LeaderboardAPIMock");_this.mockAPI=new e;return[2]}})})()}},{key:"getLeaderboardAsync",value:function getLeaderboardAsync(e,t,s){var _this=this;return _async_to_generator(function(){var a,n,_tmp,_tmp1;return _ts_generator(this,function(_state){switch(_state.label){case 0:a=Ro.params(s);if(!re.Leaderboards.Enabled)return[3,6];return[4,_this.initMockAPI()];case 1:_state.sent();if(!("playerIds"in s))return[3,3];return[4,_this.mockAPI.getPlayers(e,s)];case 2:_tmp1=n=_state.sent();return[3,5];case 3:return[4,_this.mockAPI.getLeaders(e,s)];case 4:_tmp1=n=_state.sent();_state.label=5;case 5:_tmp=_tmp1;return[3,8];case 6:return[4,At("".concat(t,"?").concat(a),{},oe)];case 7:_tmp=n=_state.sent();_state.label=8;case 8:return[2,(_tmp,!ie.hasOwn(n,"data")||!Array.isArray(n.data)?[]:n.data)]}})})()}},{key:"getLeaderboardsAsync",value:function getLeaderboardsAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=y.Utils.String.params(e),a="leaderboards";if(!re.Leaderboards.Enabled)return[3,3];return[4,_this.initMockAPI()];case 1:_state.sent();return[4,_this.mockAPI.getLeaderboardsAsync(e)];case 2:_tmp=_state.sent();return[3,5];case 3:return[4,At("".concat(a,"?").concat(s),{},oe)];case 4:_tmp=(t=_state.sent(),!ie.hasOwn(t,"data")||!Array.isArray(t.data)?[]:t.data);_state.label=5;case 5:return[2,_tmp]}})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=e.leaderboardId,s=e.playerId,a=e.score;if(!re.Leaderboards.Enabled)return[3,3];return[4,_this.initMockAPI()];case 1:_state.sent();return[4,_this.mockAPI.setScoreAsync(t,s,a)];case 2:_tmp=_state.sent();return[3,5];case 3:return[4,V("leaderboards/".concat(t,"/players/").concat(s),{score:a},{},oe)];case 4:_tmp=_state.sent();_state.label=5;case 5:_tmp;return[2]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var _this=this;return _async_to_generator(function(){var _e__id,t,s,a,n,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=(_e__id=e._id)!==null&&_e__id!==void 0?_e__id:Ro.generateObjectId(),s=_object_spread_props(_object_spread({},rc,e),{_id:t,appId:hc}),a="leaderboards";if(!re.Leaderboards.Enabled)return[3,3];return[4,_this.initMockAPI()];case 1:_state.sent();return[4,_this.mockAPI.createLeaderboard(s)];case 2:_tmp=n=_state.sent();return[3,5];case 3:return[4,V(a,s,{},oe)];case 4:_tmp=(n=_state.sent(),ie.hasOwn(n,"data")&&dc.isObject(n.data)&&(n=n.data));_state.label=5;case 5:if(_tmp,!ie.hasOwn(n,"_id")||n._id!==t)throw new Error("Create leaderboard failed");return[2,t]}})})()}}]);return en}();c(en,"LeaderboardAPI");var rs=en;var _o={limit:0,offset:0,leaders:{},isRequesting:!1},uc={leaderboards:{}},_y_Utils7=y.Utils,pc=_y_Utils7.Array,yc=_y_Utils7.Valid,$o=_y_Utils7.Json,ce=_y_Utils7.Object,sn=function(_C_Plugins_BasePlugin){_inherits(sn,_C_Plugins_BasePlugin);var _super=_create_super(sn);function sn(){_class_call_check(this,sn);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"lbAPI",new rs);u(_assert_this_initialized(_this),"configs");return _this}_create_class(sn,[{key:"init",value:function init(){var _this_game=this.game,t=_this_game.storage;t.addStorage("leaderboard",uc),this.configs={}}},{key:"addLeaderboard",value:function addLeaderboard(t){var s=t.name,a=t.type,n=t.leaderboardId,i=t.autoSortRank;if(this.getLeaderboard(s)){console.warn("Leaderboard with name ".concat(s," already exists"));return}var r="leaderboards/".concat(n,"/");(a==="global"||a==="tournament")&&(r+="leaders"),a==="friends"&&(r+="players"),this.configs[s]={id:n,name:s,type:a,host:r,autoSortRank:i};var l=$o.clone(_o);this.setLeaderboard(s,_object_spread({},l))}},{key:"requestLeaderboardsAsync",value:function requestLeaderboardsAsync(t){var _this=this;return _async_to_generator(function(){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,_this.lbAPI.getLeaderboardsAsync(t)];case 1:return[2,_state.sent()];case 2:s=_state.sent();return[2,(console.warn("requestGlobalLeaderboardsAsync",s),[])];case 3:return[2]}})})()}},{key:"requestLeaderboardAsync",value:function requestLeaderboardAsync(t,s){var _this=this;return _async_to_generator(function(){var _this_configs_t,a,n,i,o,_this_game,r,l,d,h;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,6,7]);_this.validateLeaderboard(t),_this.clearLeaderboard(t),_this.setLeaderboard(t,{isRequesting:!0});_this_configs_t=_this.configs[t],a=_this_configs_t.id,n=_this_configs_t.type,i=_this_configs_t.host;o=[];if(!(n==="friends"))return[3,2];_this_game=_this.game,r=_this_game.player,l=r.getPlayerId(),d=r.getConnectedPlayerIds(s,0),h=[l].concat(_to_consumable_array(d));_this.configs[t].playerIds=_to_consumable_array(h);return[4,_this.lbAPI.getLeaderboardAsync(a,i,{playerIds:h})];case 1:o=_state.sent();return[3,4];case 2:return[4,_this.lbAPI.getLeaderboardAsync(a,i,{limit:s,offset:0})];case 3:o=_state.sent();_state.label=4;case 4:if(o.length===0)return[2];return[4,_this.receiveLeaderboardAsync(t,o)];case 5:_state.sent(),_this.setLeaderboard(t,{limit:s,offset:0});return[3,7];case 6:_this.setLeaderboard(t,{isRequesting:!1});return[7];case 7:return[2]}})})()}},{key:"loadMoreLeaderboardAsync",value:function loadMoreLeaderboardAsync(t,s){var _this=this;return _async_to_generator(function(){var a,_this_configs_t,n,i,o,r,l,d;return _ts_generator(this,function(_state){switch(_state.label){case 0:a=_this.getLeaderboard(t);if(!a)return[3,4];if(_this.configs[t].type==="friends"){console.warn("Cannot load more leaderboard with type friend");return[2]}_state.label=1;case 1:_state.trys.push([1,,3,4]);_this.setLeaderboard(t,{isRequesting:!0});_this_configs_t=_this.configs[t],n=_this_configs_t.id,i=_this_configs_t.host,o=a.offset,r=a.limit,l=o+r;return[4,_this.lbAPI.getLeaderboardAsync(n,i,{limit:s,offset:l})];case 2:d=_state.sent();if(d.length===0)return[2];_this.receiveLeaderboardAsync(t,d),_this.setLeaderboard(t,{limit:s,offset:l});return[3,4];case 3:_this.setLeaderboard(t,{isRequesting:!1});return[7];case 4:return[2]}})})()}},{key:"getLeaderboard",value:function getLeaderboard(t){var _this_game=this.game,s=_this_game.storage,a=s.getStorageData("leaderboard","leaderboards");return a[t]?a[t]:null}},{key:"getLeadersByPlayerIdsAsync",value:function getLeadersByPlayerIdsAsync(t,s){var _this=this;return _async_to_generator(function(){var _this_configs_t,_$a,n,i,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);_this.validateLeaderboard(t);_this_configs_t=_this.configs[t],_$a=_this_configs_t.id,n="leaderboards/".concat(_$a,"/players");return[4,_this.lbAPI.getLeaderboardAsync(_$a,n,{playerIds:s})];case 1:i=_state.sent();return[2,i.length===0?[]:_this.toLeaders(i)];case 2:a=_state.sent();return[2,(console.warn(a),[])];case 3:return[2]}})})()}},{key:"clearLeaderboard",value:function clearLeaderboard(t){try{this.validateLeaderboard(t);var _$s=$o.clone(_o);this.setLeaderboard(t,null),this.setLeaderboard(t,_object_spread({},_$s))}catch(s){console.warn(s)}}},{key:"isLeaderboardEmpty",value:function isLeaderboardEmpty(t){var s=this.getLeaderboard(t);if(!s)return!0;var a=s.leaders;return Object.keys(a).length===0}},{key:"isExistLeaderboardId",value:function isExistLeaderboardId(t){var _this=this,s=_this.configs;return ce.vals(s).some(function(a){return a.id===t})}},{key:"getLeaderboardName",value:function getLeaderboardName(t){var _this=this,s=_this.configs,a=pc.search(ce.vals(s),function(n){return n.id===t});return a?a.name:null}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(t,s,a){var _this=this;return _async_to_generator(function(){var _this_configs_t,_$n,i,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,3,,4]);_this.validateLeaderboard(t);_this_configs_t=_this.configs[t],_$n=_this_configs_t.id;return[4,_this.getLastScoreOnLeaderboard(t,s)];case 1:i=_state.sent();if(i&&a<=i)return[2];return[4,_this.lbAPI.setLeaderboardScoreAsync({leaderboardId:_$n,playerId:s,score:a})];case 2:_state.sent();return[3,4];case 3:n=_state.sent();console.warn(n);return[3,4];case 4:return[2]}})})()}},{key:"getLastScoreOnLeaderboard",value:function getLastScoreOnLeaderboard(t,s){var _this=this;return _async_to_generator(function(){var a;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this.getLeadersByPlayerIdsAsync(t,[s])];case 1:a=_state.sent();return[2,a.length===0?null:a[0].score]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(t){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){return[2,_this.lbAPI.createLeaderboardAsync(t)]})})()}},{key:"validateLeaderboard",value:function validateLeaderboard(t){var s=this.getLeaderboard(t);if(!yc.isObject(s))throw new Error("Leaderboard with name ".concat(t," not found"))}},{key:"setLeaderboard",value:function setLeaderboard(t,s){var _this_game=this.game,a=_this_game.storage;a.setStorageData("leaderboard","leaderboards",_define_property({},t,s))}},{key:"receiveLeaderboardAsync",value:function receiveLeaderboardAsync(t,s){var _this=this;return _async_to_generator(function(){var _this_getLeaderboard,n,_ref,tmp,i,tmp1,o,r,_r,h,l,d;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this.validateLeaderboard(t);return[4,_this.toLeaders(s)];case 1:n=_state.sent().filter(function(h){return h.name&&h.photo}),_ref=(_this_getLeaderboard=_this.getLeaderboard(t))!==null&&_this_getLeaderboard!==void 0?_this_getLeaderboard:{},tmp=_ref.offset,i=tmp===void 0?0:tmp,tmp1=_ref.leaders,o=tmp1===void 0?{}:tmp1,r=n.filter(function(h){return!o[h.playerId]});if(i>0&&r.length>0){;h=ce.vals(o);(_r=r).unshift.apply(_r,_to_consumable_array(h))}l=r.sort(function(h,f){return f.score-h.score});_this.configs[t].autoSortRank&&(l=l.map(function(h,f){return _object_spread_props(_object_spread({},h),{rank:f+1})}));d=ce.keyBy(l,"playerId");_this.setLeaderboard(t,{leaders:d});return[2]}})})()}},{key:"toLeaders",value:function toLeaders(t){var _this=this;return _async_to_generator(function(){var _this_game,s,a,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,s=_this_game.profile,a=t.map(function(r){return r.playerId});return[4,s.requestProfiles(a)];case 1:_state.sent();n=s.getProfiles();return[2,t.map(function(r){var l=r.playerId,d=n[l];return d?_object_spread_props(_object_spread({},r),{name:d.name,photo:d.photo}):_object_spread_props(_object_spread({},r),{name:"Nameless",photo:"default"})}).map(function(r){return _object_spread_props(_object_spread({},r),{score:parseInt(r.score,10)})})]}})})()}}]);return sn}(C.Plugins.BasePlugin);c(sn,"LeaderboardPlugin");var cs=sn;var an=function(){function an(){_class_call_check(this,an);u(this,"APIHost")}_create_class(an,[{key:"setAPIHost",value:function setAPIHost(e){this.APIHost=e}},{key:"getAPIHost",value:function getAPIHost(){return this.APIHost}}]);return an}();c(an,"BaseAPI");var ls=an;var Go=y.Utils,nn=function(ls){_inherits(nn,ls);var _super=_create_super(nn);function nn(){_class_call_check(this,nn);return _super.apply(this,arguments)}_create_class(nn,[{key:"createSingleMatchAsync",value:function createSingleMatchAsync(e){var _this=this;return _async_to_generator(function(){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,V("single-matches",e,{},_this.getAPIHost())];case 1:s=_state.sent();return[2,_this.returnValidMatchData(s)]}})})()}},{key:"getSingleMatchDetailAsync",value:function getSingleMatchDetailAsync(){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,At("single-matches/active",{},_this.getAPIHost())];case 1:t=_state.sent();return[2,_this.returnValidMatchData(t)]}})})()}},{key:"updateSingleMatchMoveAsync",value:function updateSingleMatchMoveAsync(e,t){var _this=this;return _async_to_generator(function(){var s,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:s="single-matches/".concat(e,"/move");return[4,V(s,t,{},_this.getAPIHost())];case 1:a=_state.sent();return[2,_this.returnValidMatchData(a)]}})})()}},{key:"finishSingleMatchAsync",value:function finishSingleMatchAsync(e){var _this=this;return _async_to_generator(function(){var t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:t="single-matches/".concat(e,"/finish");return[4,V(t,{},{},_this.getAPIHost())];case 1:s=_state.sent();return[2,_this.returnValidMatchData(s)]}})})()}},{key:"createEndlessMatchAsync",value:function createEndlessMatchAsync(e){var _this=this;return _async_to_generator(function(){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,V("endless-matches",e,{},_this.getAPIHost())];case 1:s=_state.sent();return[2,_this.returnValidMatchData(s)]}})})()}},{key:"getEndlessMatchDetailAsync",value:function getEndlessMatchDetailAsync(){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,At("endless-matches/active",{},_this.getAPIHost())];case 1:t=_state.sent();return[2,_this.returnValidMatchData(t)]}})})()}},{key:"updateEndlessMatchMilestoneAsync",value:function updateEndlessMatchMilestoneAsync(e,t){var _this=this;return _async_to_generator(function(){var s,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:s="endless-matches/".concat(e,"/milestone");return[4,V(s,t,{},_this.getAPIHost())];case 1:a=_state.sent();return[2,_this.returnValidMatchData(a)]}})})()}},{key:"finishEndlessMatchAsync",value:function finishEndlessMatchAsync(e){var _this=this;return _async_to_generator(function(){var t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:t="endless-matches/".concat(e,"/finish");return[4,V(t,{},{},_this.getAPIHost())];case 1:s=_state.sent();return[2,_this.returnValidMatchData(s)]}})})()}},{key:"createMatchAsync",value:function createMatchAsync(e){var _this=this;return _async_to_generator(function(){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,V("matches",e,{},_this.getAPIHost())];case 1:s=_state.sent();return[2,_this.returnValidMatchData(s)]}})})()}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var _this=this;return _async_to_generator(function(){var t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:t="matches/".concat(e,"/join");return[4,V(t,{},{},_this.getAPIHost())];case 1:s=_state.sent();return[2,_this.returnValidMatchData(s)]}})})()}},{key:"getMatchDetailByIdAsync",value:function getMatchDetailByIdAsync(e){var _this=this;return _async_to_generator(function(){var t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:t="matches/".concat(e);return[4,At(t,{},_this.getAPIHost())];case 1:s=_state.sent();return[2,_this.returnValidMatchData(s)]}})})()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){var _this=this;return _async_to_generator(function(){var tmp,t,tmp1,s,tmp2,a,tmp3,n,i,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:tmp=e.matchId,t=tmp===void 0?"":tmp,tmp1=e.score,s=tmp1===void 0?0:tmp1,tmp2=e.level,a=tmp2===void 0?0:tmp2,tmp3=e.extraData,n=tmp3===void 0?{}:tmp3,i="matches/".concat(t,"/finish");return[4,V(i,{matchId:t,score:s,level:a,extraData:n},{},_this.getAPIHost())];case 1:o=_state.sent();return[2,_this.returnValidMatchData(o)]}})})()}},{key:"returnValidMatchData",value:function returnValidMatchData(e){var t={};return!Go.Valid.isObject(e)||!Go.Object.hasOwn(e,"data")||(t=e.data),t}}]);return nn}(ls);c(nn,"MatchAPI");var ds=nn;var on=function(){function on(e){_class_call_check(this,on);u(this,"matchAPI");this.createAPI(),this.setAPIConfig(e)}_create_class(on,[{key:"createAPI",value:function createAPI(){this.matchAPI=new ds}},{key:"setAPIConfig",value:function setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}},{key:"setMatchAPIInstance",value:function setMatchAPIInstance(e){this.matchAPI=e}},{key:"getMatchAPI",value:function getMatchAPI(){return this.matchAPI}}]);return on}();c(on,"APIHandler");var hs=on;var rn=function(){function rn(e,t){_class_call_check(this,rn);u(this,"game");u(this,"match");this.game=e,this.match=t}_create_class(rn,[{key:"startLog",value:function startLog(e){this.match.useCPUProfile&&console.profile(this.constructor.name),console.group("\uD83D\uDE80 ".concat(this.constructor.name)),e&&console.log("\uD83D\uDCE6 ? Payload:",e)}},{key:"endLog",value:function endLog(){console.groupEnd(),this.match.useCPUProfile&&console.profileEnd()}},{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(_state){throw new Error("Not implemented")})})()}}]);return rn}();c(rn,"BaseConcrete");var x=rn;var cn=function(K){_inherits(cn,K);var _super=_create_super(cn);function cn(e){_class_call_check(this,cn);var _this;_this=_super.call(this,e),_this.name="LevelNotDefined",_this.message=e!==null&&e!==void 0?e:"Level is not defined";return _possible_constructor_return(_this)}return cn}(K);c(cn,"LevelNotDefined");var le=cn;var ln=function(K){_inherits(ln,K);var _super=_create_super(ln);function ln(e){_class_call_check(this,ln);var _this;_this=_super.call(this,e),_this.name="MatchModeNotDefined",_this.message=e!==null&&e!==void 0?e:"Match id is not defined";return _possible_constructor_return(_this)}return ln}(K);c(ln,"MatchModeNotDefined");var jt=ln;var _y_Utils8=y.Utils,us=_y_Utils8.Object,fc=_y_Utils8.Valid,dn=function(){function dn(e){_class_call_check(this,dn);u(this,"game");u(this,"match");u(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}_create_class(dn,[{key:"setNext",value:function setNext(e){return this.nextHandler=e,e}},{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){console.groupCollapsed(" ".concat(_this.constructor.name)),_this.logData("Before",e);return[2]})})()}},{key:"nextAsync",value:function nextAsync(e){var _this=this;return _async_to_generator(function(){var _tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this.logData("After",e),console.groupEnd();_tmp=_this.nextHandler;if(!_tmp)return[3,2];return[4,_this.nextHandler.processAsync(e)];case 1:_tmp=_state.sent();_state.label=2;case 2:_tmp;return[2]}})})()}},{key:"logData",value:function logData(e,t){if(!fc.isDebugger())return;console.groupCollapsed("\uD83D\uDCE6 MatchState: ".concat(e));var s=t.profiles,a=t.customData,n=_object_without_properties(t,["profiles","customData"]);console.info("\uD83D\uDCBE Base"),console.table(us.clone(n)),console.info("\uD83D\uDCBE Profile"),console.table(us.clone(s)),console.info("\uD83D\uDCBE Custom"),console.table(us.clone(a)),console.groupEnd()}}]);return dn}();c(dn,"BaseHandler");var A=dn;var gc=y.Plugins,wc=y.Utils,mc=gc.Analytics,Ac=wc.String,Vo=wc.Valid,hn=function(A){_inherits(hn,A);var _super=_create_super(hn);function hn(){_class_call_check(this,hn);return _super.apply(this,arguments)}_create_class(hn,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(hn.prototype),"processAsync",_this)};return _async_to_generator(function(){var t,s,a,_this_game,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e);t=e.mode,s=e.customData,a=s.level;_this1.validateMode(t),_this1.validateLevel(a);_this_game=_this1.game,n=_this_game.analytics;n.event(mc.Events.MATCH_START,{level:a,game_mode:Ac.toUpperCamelCase(t),level_name:"level_".concat(a)});return[4,_this1.nextAsync(e)];case 1:_state.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!Vo.isString(e))throw new jt}},{key:"validateLevel",value:function validateLevel(e){if(!Vo.isNumber(e))throw new le}}]);return hn}(A);c(hn,"LogMatchStartHandler");var F=hn;var U={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},un=function(A){_inherits(un,A);var _super=_create_super(un);function un(){_class_call_check(this,un);return _super.apply(this,arguments)}_create_class(un,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(un.prototype),"processAsync",_this)};return _async_to_generator(function(){var t,s,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e);t=e.mode,s=e.status;a=t!==null&&t!==void 0?t:lt.SINGLE;s===U.FINISHED&&(a=lt.SINGLE),_this1.contextGameModeDetected(a);return[4,_this1.nextAsync(e)];case 1:_state.sent();return[2]}})})()}},{key:"contextGameModeDetected",value:function contextGameModeDetected(e){var _this_game=this.game,t=_this_game.storage;t.setStorageData("context","contextGameMode",e)}}]);return un}(A);c(un,"ContextGameModeHandler");var N=un;var pn=function(Error1){_inherits(pn,Error1);var _super=_create_super(pn);function pn(e){_class_call_check(this,pn);var _this;_this=_super.call(this,e),_this.name="GetMatchDetailFailed",_this.message=e!==null&&e!==void 0?e:"Get match detail failed";return _possible_constructor_return(_this)}return pn}(_wrap_native_super(Error));c(pn,"GetMatchDetailFailed");var Kt=pn;var yn=function(Error1){_inherits(yn,Error1);var _super=_create_super(yn);function yn(e){_class_call_check(this,yn);var _this;_this=_super.call(this,e),_this.name="MatchAreNotActive",_this.message=e!==null&&e!==void 0?e:"Match are not active";return _possible_constructor_return(_this)}return yn}(_wrap_native_super(Error));c(yn,"MatchAreNotActive");var de=yn;var fn=function(K){_inherits(fn,K);var _super=_create_super(fn);function fn(e){_class_call_check(this,fn);var _this;_this=_super.call(this,e),_this.name="MatchIdNotValid",_this.message=e!==null&&e!==void 0?e:"Match id is not valid";return _possible_constructor_return(_this)}return fn}(K);c(fn,"MatchIdNotValid");var z=fn;var gn=function(Error1){_inherits(gn,Error1);var _super=_create_super(gn);function gn(e){_class_call_check(this,gn);var _this;_this=_super.call(this,e),_this.name="OpponentHasFinishedMatch",_this.message=e||"Opponent has finished match";return _possible_constructor_return(_this)}return gn}(_wrap_native_super(Error));c(gn,"OpponentHasFinishedMatch");var ps=gn;var wn=function(K){_inherits(wn,K);var _super=_create_super(wn);function wn(e){_class_call_check(this,wn);var _this;_this=_super.call(this,e),_this.name="OpponentIdNotValid",_this.message=e!==null&&e!==void 0?e:"Opponent id is not valid";return _possible_constructor_return(_this)}return wn}(K);c(wn,"OpponentIdNotValid");var T=wn;var mn=function(Error1){_inherits(mn,Error1);var _super=_create_super(mn);function mn(e){_class_call_check(this,mn);var _this;_this=_super.call(this,e),_this.name="PlayerNotCurrentInMatch",_this.message=e!==null&&e!==void 0?e:"The player is not currently in this match";return _possible_constructor_return(_this)}return mn}(_wrap_native_super(Error));c(mn,"PlayerNotCurrentInMatch");var Wt=mn;var An=function(Error1){_inherits(An,Error1);var _super=_create_super(An);function An(e){_class_call_check(this,An);var _this;_this=_super.call(this,e),_this.name="PlayerNotFinishedMatch",_this.message=e||"Player not finished match";return _possible_constructor_return(_this)}return An}(_wrap_native_super(Error));c(An,"PlayerNotFinishedMatch");var he=An;var Ic=y.Dtos,In=function(A){_inherits(In,A);var _super=_create_super(In);function In(){_class_call_check(this,In);return _super.apply(this,arguments)}_create_class(In,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(In.prototype),"processAsync",_this)};return _async_to_generator(function(){var t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.validateMatchData(e);return[4,_this1.getMatchAsync(e)];case 1:t=_state.sent(),s=new Ic.Match.Data(t).toObject();_this1.validateAwaitMatchData(e,s),_this1.updateMatchData(e,s),_this1.validateMatchStatus(e),_this1.validatePlayerTurn(e),_this1.validateOpponentTurn(e);return[4,_this1.nextAsync(e)];case 2:_state.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id;if(typeof t!="string")throw new z}},{key:"validateMatchStatus",value:function validateMatchStatus(e){var t=e.status;if(t!==U.ACTIVE)throw new de}},{key:"validateAwaitMatchData",value:function validateAwaitMatchData(e,t){var s=e.id,a=e.customData,n=t._id,i=t.whitePlayerId,o=t.blackPlayerId;if(typeof n!="string"||n!==s)throw new Kt;var r=a.playerId,l=i===r,d=o===r;if(!l&&o===X.playerId)throw new Ft;if(!l&&!d)throw new Wt}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,s=e.customData,a=s.playerId;if(typeof a!="string")throw new D;var _t_a=t[a],n=_t_a.finished;if(!n)throw new he}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,s=e.customData,a=s.opponentId;if(typeof a!="string")throw new T;var _t_a=t[a],n=_t_a.finished;if(n)throw new ps}},{key:"getMatchAsync",value:function getMatchAsync(e){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){t=e.id;return[2,t?_this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var s=e.customData,a=t.whitePlayerId,n=t.blackPlayerId,i=t.whitePlayerScore,o=t.blackPlayerScore,r=t.whitePlayerFinish,l=t.blackPlayerFinish,d=t.status;e.status=d;var h=a===s.playerId,f=h?a:n,g=h?n:a;e.customData.playerId=f,e.customData.opponentId=g,e.profiles[f]||(e.profiles[f]={id:f,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});var m=h?i:o,I=h?o:i;e.profiles[f].score=m,e.profiles[g].score=I;var w=h?r:l,_=h?l:r;e.profiles[f].finished=w,e.profiles[g].finished=_}}]);return In}(A);c(In,"AwaitMatchHandler");var ys=In;var fs={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},Dn=function(A){_inherits(Dn,A);var _super=_create_super(Dn);function Dn(t,s){_class_call_check(this,Dn);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(Dn,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Dn.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t),_this1.initializeMatch(t);return[4,_this1.nextAsync(t)];case 1:_state.sent();return[2]}})})()}},{key:"initializeMatch",value:function initializeMatch(t){var _this_payload=this.payload,s=_this_payload.id,a=_this_payload.mode,n=_this_payload.customData;t.id=s!==null&&s!==void 0?s:null,t.mode=a||null,t.status=U.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData=_object_spread({},fs,t.customData,n)}}]);return Dn}(A);c(Dn,"PrepareMatchHandler");var M=Dn;var dt=Vt,Pn=function(Error1){_inherits(Pn,Error1);var _super=_create_super(Pn);function Pn(e){_class_call_check(this,Pn);var _this;_this=_super.call(this,e),_this.name="UnavailableFeature",_this.message="Unavailable feature: ".concat(e);return _possible_constructor_return(_this)}return Pn}(_wrap_native_super(Error));c(Pn,"UnavailableFeature");var P=Pn;var xn=function(K){_inherits(xn,K);var _super=_create_super(xn);function xn(e){_class_call_check(this,xn);var _this;_this=_super.call(this,e),_this.name="ContextIdNotValid",_this.message=e!==null&&e!==void 0?e:"Context id is not valid";return _possible_constructor_return(_this)}return xn}(K);c(xn,"ContextIdNotValid");var B=xn;var En=function(A){_inherits(En,A);var _super=_create_super(En);function En(){_class_call_check(this,En);return _super.apply(this,arguments)}_create_class(En,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(En.prototype),"processAsync",_this)};return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.validateData(e);return[4,_this1.createWideframesAwaitingAsync(e)];case 1:t=_state.sent();t&&_this1.sendMessageAsync(e,t);return[4,_this1.nextAsync(e)];case 2:_state.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,s=e.customData,a=s.contextId,n=s.opponentId;if(!t||typeof t!="string")throw new z;if(!a||typeof a!="string")throw new B;if(!n||typeof n!="string")throw new T}},{key:"createWideframesAwaitingAsync",value:function createWideframesAwaitingAsync(e){var _this=this;return _async_to_generator(function(){var _this_game,_$t,s,a,n,i,o,r,l,tmp,d,h,f,tmp1,g,m,_tmp,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,4,,5]);_this_game=_this.game,_$t=_this_game.frameCapture,s=e.profiles,a=e.customData,n=a.playerId,i=a.opponentId;if(!n||!i)return[2,null];o=s[n],r=s[i],l=o.photo,tmp=o.score,d=tmp===void 0?0:tmp,h=o.finished;if(!h)return[2,null];f=r.photo,tmp1=r.score,g=tmp1===void 0?0:tmp1,m=r.finished;if(!m)return[3,1];_tmp=null;return[3,3];case 1:return[4,_$t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:f,opponentScore:g,isPlayerFinished:!0,isOpponentFinished:!1})];case 2:_tmp=_state.sent();_state.label=3;case 3:return[2,_tmp];case 4:t=_state.sent();return[2,(console.warn("createWideframesAwaitingAsync",t),null)];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var s,a,n,i,o,_a_i,r,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=e.id,a=e.profiles,n=e.customData,i=n.playerId,o=n.opponentId;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");_a_i=a[i],r=_a_i.name,l={data:{type:dt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:"".concat(r," is waiting for you to finish this game. Play now!"),localizations:{vi_VN:"".concat(r," ang ch bn kt th\xfac trn u. Chi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(l)];case 1:_state.sent();return[2]}})})()}}]);return En}(A);c(En,"SendAwaitingMessageHandler");var gs=En;var Sn=function(A){_inherits(Sn,A);var _super=_create_super(Sn);function Sn(){_class_call_check(this,Sn);return _super.apply(this,arguments)}_create_class(Sn,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this.nextAsync(e)];case 1:_state.sent();return[2]}})})()}},{key:"nextAsync",value:function nextAsync(e){var _this=this;return _async_to_generator(function(){var _tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp=_this.nextHandler;if(!_tmp)return[3,2];return[4,_this.nextHandler.processAsync(e)];case 1:_tmp=_state.sent();_state.label=2;case 2:_tmp;return[2]}})})()}}]);return Sn}(A);c(Sn,"NothingHandler");var S=Sn;var vn=function(K){_inherits(vn,K);var _super=_create_super(vn);function vn(e){_class_call_check(this,vn);var _this;_this=_super.call(this,e),_this.name="ProfileNotFound",_this.message=e!==null&&e!==void 0?e:"Profile not found";return _possible_constructor_return(_this)}return vn}(K);c(vn,"ProfileNotFound");var R=vn;var Dc=y.Dtos,bn=function(A){_inherits(bn,A);var _super=_create_super(bn);function bn(){_class_call_check(this,bn);return _super.apply(this,arguments)}_create_class(bn,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(bn.prototype),"processAsync",_this)};return _async_to_generator(function(){var t,s,a,n,i,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.validateData(e);t=e.customData,s=t.playerId,a=t.opponentId;n=s;return[4,_this1.getProfile(n)];case 1:i=_state.sent();if(!i)throw new R;if(!(_this1.updateMatchProfile(e,n,i),n=a,n!==X.playerId))return[3,3];return[4,_this1.getProfile(n)];case 2:o=_state.sent();if(!o)throw new R;_this1.updateMatchProfile(e,n,o);return[3,4];case 3:_this1.updateMatchProfile(e,n);_state.label=4;case 4:return[4,_this1.nextAsync(e)];case 5:_state.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.customData,s=t.playerId,a=t.opponentId;if(!s||typeof s!="string")throw new D;if(!a||typeof a!="string")throw new T}},{key:"getProfile",value:function getProfile(e){var _this=this;return _async_to_generator(function(){var _this_game,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,t=_this_game.profile;return[4,t.requestProfiles([e])];case 1:return[2,(_state.sent(),t.getProfiles()[e])]}})})()}},{key:"updateMatchProfile",value:function updateMatchProfile(e,t,s){var _ref=s!==null&&s!==void 0?s:X,a=_ref.name,n=_ref.photo,i=new Dc.Match.Profile({id:t,name:a,photo:n}).toObject();e.profiles[t]?(e.profiles[t].name=i.name,e.profiles[t].photo=i.photo):e.profiles[t]=i}}]);return bn}(A);c(bn,"GetMatchProfilesHandler");var J=bn;var Nn=function(x){_inherits(Nn,x);var _super=_create_super(Nn);function Nn(){_class_call_check(this,Nn);return _super.apply(this,arguments)}_create_class(Nn,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d,h,f;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.matchId,s=e.playerId,a=e.opponentId,n=new S(_this),i=new M(_this,{id:t,mode:$.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);o=new ys(_this);i.setNext(o);r=new J(_this);o.setNext(r);l=new gs(_this);r.setNext(l);d=new F(_this);l.setNext(d);h=new N(_this);d.setNext(h);f=_this.match.getMatchState();return[4,n.processAsync(f)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return Nn}(x);c(Nn,"AwaitChallengeMatchConcrete");var ws=Nn;var Cn=function(K){_inherits(Cn,K);var _super=_create_super(Cn);function Cn(e){_class_call_check(this,Cn);var _this;_this=_super.call(this,e),_this.name="CreateContextFailed",_this.message=e!==null&&e!==void 0?e:"Create context failed";return _possible_constructor_return(_this)}return Cn}(K);c(Cn,"CreateContextFailed");var zt=Cn;var _y_Utils9=y.Utils,Fo=_y_Utils9.Valid,Uo=_y_Utils9.Object,On=function(A){_inherits(On,A);var _super=_create_super(On);function On(t,s){_class_call_check(this,On);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(On,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(On.prototype),"processAsync",_this)};return _async_to_generator(function(){var _this_payload,s,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t);_this_payload=_this1.payload,s=_this_payload.opponentId;return[4,_this1.createAsync(s)];case 1:a=_state.sent();t.customData.contextId=a;return[4,_this1.nextAsync(t)];case 2:_state.sent();return[2]}})})()}},{key:"createAsync",value:function createAsync(t){var _this=this;return _async_to_generator(function(){var a,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,GameSDK.context.createAsync(t)];case 1:_state.sent();return[3,3];case 2:a=_state.sent();_this.validateError(a);return[3,3];case 3:s=GameSDK.context.getID();if(!Fo.isString(s))throw new zt;return[2,s]}})})()}},{key:"validateError",value:function validateError(t){if(!Uo.hasOwn(t,"code"))throw t;if(t.code!=="SAME_CONTEXT"){if(t.code==="INVALID_PARAM"){if(!this.isNotConnectedPlayerError(t))throw t;return}throw t}}},{key:"validateErrorMessage",value:function validateErrorMessage(t){if(!Uo.hasOwn(t,"message")||!Fo.isString(t.message))throw t}},{key:"isNotConnectedPlayerError",value:function isNotConnectedPlayerError(t){return this.validateErrorMessage(t),t.message.indexOf("is not a connected player of the current player")>-1}}]);return On}(A);c(On,"CreateContextHandler");var ms=On;var Ln=function(K){_inherits(Ln,K);var _super=_create_super(Ln);function Ln(e){_class_call_check(this,Ln);var _this;_this=_super.call(this,e),_this.name="MatchAreNotOpen",_this.message=e!==null&&e!==void 0?e:"Match are not open";return _possible_constructor_return(_this)}return Ln}(K);c(Ln,"MatchAreNotOpen");var It=Ln;var Pc=y.Dtos,Tn=function(A){_inherits(Tn,A);var _super=_create_super(Tn);function Tn(t,s){_class_call_check(this,Tn);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(Tn,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Tn.prototype),"processAsync",_this)};return _async_to_generator(function(){var s,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t),_this1.validateData(t);return[4,_this1.createMatchAsync(t)];case 1:s=_state.sent(),a=new Pc.Match.Data(s).toObject();_this1.updateMatchState(t,a);return[4,_this1.nextAsync(t)];case 2:_state.sent();return[2]}})})()}},{key:"validateData",value:function validateData(t){var s=t.status,a=t.customData,n=a.opponentId;if(typeof n!="string")throw new T;if(s!==U.OPEN)throw new It}},{key:"createMatchAsync",value:function createMatchAsync(t){var _this=this;return _async_to_generator(function(){var _t_customData,s,_this_payload,a,n;return _ts_generator(this,function(_state){_t_customData=t.customData,s=_t_customData.opponentId,_this_payload=_this.payload,a=_this_payload.extraData;if(!s)return[2,{}];n={opponentPlayerId:s,extraData:a};return[2,_this.match.api.getMatchAPI().createMatchAsync(n)]})})()}},{key:"updateMatchState",value:function updateMatchState(t,s){var a=t.customData,n=s._id,i=s.whitePlayerId,o=s.blackPlayerId,r=s.whitePlayerFinish,l=s.blackPlayerFinish,d=i===a.opponentId;t.id=n||null;var h=d?o:i,f=d?i:o;t.customData.playerId=h,t.customData.opponentId=f,t.profiles[h]||(t.profiles[h]={id:h,name:"",photo:"",finished:!1}),t.profiles[f]||(t.profiles[f]={id:f,name:"",photo:"",finished:!1});var g=d?l:r,m=d?r:l;t.profiles[h].finished=g,t.profiles[f].finished=m}}]);return Tn}(A);c(Tn,"CreateMatchHandler");var ue=Tn;var Mn=function(A){_inherits(Mn,A);var _super=_create_super(Mn);function Mn(){_class_call_check(this,Mn);return _super.apply(this,arguments)}_create_class(Mn,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Mn.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:if(_superprop_get_processAsync().call(_this1,e),e.status!==U.OPEN)throw new It;_this1.startMatch(e);return[4,_this1.nextAsync(e)];case 1:_state.sent();return[2]}})})()}},{key:"startMatch",value:function startMatch(e){e.status=U.ACTIVE,e.startAt=Date.now()}}]);return Mn}(A);c(Mn,"StartMatchHandler");var j=Mn;var Rn=function(A){_inherits(Rn,A);var _super=_create_super(Rn);function Rn(){_class_call_check(this,Rn);return _super.apply(this,arguments)}_create_class(Rn,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Rn.prototype),"processAsync",_this)};return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.validateData(e);return[4,_this1.createWideframesChallengeAsync(e)];case 1:t=_state.sent();t&&_this1.sendMessageAsync(e,t);return[4,_this1.nextAsync(e)];case 2:_state.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,s=e.customData,a=s.contextId,n=s.opponentId;if(!t||typeof t!="string")throw new z;if(!a||typeof a!="string")throw new B;if(!n||typeof n!="string")throw new T}},{key:"createWideframesChallengeAsync",value:function createWideframesChallengeAsync(e){var _this=this;return _async_to_generator(function(){var _this_game,_$t,s,a,n,i,o,r,l,tmp,d,h,tmp1,f,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);_this_game=_this.game,_$t=_this_game.frameCapture,s=e.profiles,a=e.customData,n=a.playerId,i=a.opponentId;if(!n||!i)return[2,null];o=s[n],r=s[i],l=o.photo,tmp=o.score,d=tmp===void 0?0:tmp,h=r.photo,tmp1=r.score,f=tmp1===void 0?0:tmp1;return[4,_$t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:f,isPlayerFinished:!1,isOpponentFinished:!1})];case 1:return[2,_state.sent()];case 2:t=_state.sent();return[2,(console.warn("createWideframesChallengeAsync",t),null)];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var s,a,n,i,o,_a_i,r,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=e.id,a=e.profiles,n=e.customData,i=n.playerId,o=n.opponentId;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");_a_i=a[i],r=_a_i.name,l={data:{type:dt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:"".concat(r," challenges you"),localizations:{vi_VN:"".concat(r," th th\xe1ch bn trong trn u n\xe0y. Chi ngay!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(l)];case 1:_state.sent();return[2]}})})()}}]);return Rn}(A);c(Rn,"SendChallengeMessageHandler");var pe=Rn;var _n=function(x){_inherits(_n,x);var _super=_create_super(_n);function _n(){_class_call_check(this,_n);return _super.apply(this,arguments)}_create_class(_n,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d,h,f,g;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.playerId,s=e.opponentId,a=new S(_this),n=new ms(_this,{opponentId:s});a.setNext(n);i=new M(_this,{mode:$.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:s}});n.setNext(i);o=new ue(_this,{extraData:e.extraData});i.setNext(o);r=new J(_this);o.setNext(r);l=new j(_this);r.setNext(l);d=new F(_this);l.setNext(d);h=new pe(_this);d.setNext(h);f=new N(_this);h.setNext(f);g=_this.match.getMatchState();return[4,a.processAsync(g)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return _n}(x);c(_n,"ChallengeFriendConcrete");var As=_n;var $n=function(Error1){_inherits($n,Error1);var _super=_create_super($n);function $n(e){_class_call_check(this,$n);var _this;_this=_super.call(this,e),_this.name="SameContext",_this.message=e!==null&&e!==void 0?e:"Same context";return _possible_constructor_return(_this)}return $n}(_wrap_native_super(Error));c($n,"SameContext");var Ht=$n;var ko=y.Utils,Gn=function(A){_inherits(Gn,A);var _super=_create_super(Gn);function Gn(t,s){_class_call_check(this,Gn);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(Gn,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Gn.prototype),"processAsync",_this)};return _async_to_generator(function(){var _this_payload,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t);_this_payload=_this1.payload,s=_this_payload.contextId;return[4,_this1.switchAsync(s)];case 1:_state.sent(),t.customData.contextId=s;return[4,_this1.nextAsync(t)];case 2:_state.sent();return[2]}})})()}},{key:"checkSameContext",value:function checkSameContext(t){var s=t==="SOLO",a=GameSDK.context.getID();if(a===t)throw new Ht;if(s&&a===null)throw new Ht}},{key:"switchAsync",value:function switchAsync(t){var _this=this;return _async_to_generator(function(){var s,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=t==="SOLO";_state.label=1;case 1:_state.trys.push([1,3,,4]);_this.checkSameContext(t);return[4,GameSDK.context.switchAsync(t,s)];case 2:_state.sent();return[3,4];case 3:a=_state.sent();if(_instanceof(a,Ht))return[2];if(!ko.Object.hasOwn(a,"code"))throw a;if(ko.Device.isAndroid()&&s&&a.code==="INVALID_PARAM")return[2];if(a.code!=="SAME_CONTEXT")throw a;return[3,4];case 4:return[2]}})})()}}]);return Gn}(A);c(Gn,"SwitchContextHandler");var Dt=Gn;var xc=y.Dtos,Vn=function(A){_inherits(Vn,A);var _super=_create_super(Vn);function Vn(){_class_call_check(this,Vn);return _super.apply(this,arguments)}_create_class(Vn,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Vn.prototype),"processAsync",_this)};return _async_to_generator(function(){var t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.validateMatchData(e);return[4,_this1.getMatchAsync(e)];case 1:t=_state.sent(),s=new xc.Match.Data(t).toObject();_this1.validateContinueMatchData(e,s),_this1.updateMatchData(e,s),_this1.validatePlayerTurn(e);return[4,_this1.nextAsync(e)];case 2:_state.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id,s=e.status;if(typeof t!="string")throw new z;if(s!==U.OPEN)throw new It}},{key:"validateContinueMatchData",value:function validateContinueMatchData(e,t){var s=e.id,a=e.customData,n=t._id,i=t.whitePlayerId,o=t.blackPlayerId;if(typeof n!="string"||n!==s)throw console.warn("\uD83E\uDD16 ? respMatchDataValidated",t),new Kt;var r=a.playerId,l=i===r,d=o===r;if(!l&&o===X.playerId)throw new Ft;if(!l&&!d)throw new Wt}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,s=e.customData,a=s.playerId;if(typeof a!="string")throw new D;var _t_a=t[a],n=_t_a.finished;if(n)throw new Zt}},{key:"getMatchAsync",value:function getMatchAsync(e){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){t=e.id;return[2,t?_this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var s=e.customData,a=t.whitePlayerId,n=t.blackPlayerId,i=t.whitePlayerScore,o=t.blackPlayerScore,r=t.whitePlayerFinish,l=t.blackPlayerFinish,d=a===s.playerId,h=d?a:n,f=d?n:a;e.customData.playerId=h,e.customData.opponentId=f,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[f]||(e.profiles[f]={id:f,name:"",photo:"",finished:!1});var g=d?i:o,m=d?o:i;e.profiles[h].score=g,e.profiles[f].score=m;var I=d?r:l,w=d?l:r;e.profiles[h].finished=I,e.profiles[f].finished=w}}]);return Vn}(A);c(Vn,"ContinueMatchHandler");var Is=Vn;var Fn=function(A){_inherits(Fn,A);var _super=_create_super(Fn);function Fn(){_class_call_check(this,Fn);return _super.apply(this,arguments)}_create_class(Fn,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Fn.prototype),"processAsync",_this)};return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.validateData(e);return[4,_this1.createWideframesCurrentScoreAsync()];case 1:t=_state.sent();t&&_this1.sendMessageAsync(e,t);return[4,_this1.nextAsync(e)];case 2:_state.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,s=e.customData,a=s.contextId,n=s.opponentId;if(!t||typeof t!="string")throw new z;if(!a||typeof a!="string")throw new B;if(!n||typeof n!="string")throw new T}},{key:"createWideframesCurrentScoreAsync",value:function createWideframesCurrentScoreAsync(){var _this=this;return _async_to_generator(function(){var _this_game,_$e,t,_e_getPlayer,s,a,_this_match_getMatchState,n,_ref,tmp,i,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);_this_game=_this.game,_$e=_this_game.player,t=_this_game.frameCapture,_e_getPlayer=_$e.getPlayer(),s=_e_getPlayer.playerId,a=_e_getPlayer.photo,_this_match_getMatchState=_this.match.getMatchState(),n=_this_match_getMatchState.profiles,_ref=n[s]||{},tmp=_ref.score,i=tmp===void 0?0:tmp;return[4,t.wideframe.renderShareScore({playerId:s,playerPhoto:a,playerScore:i})];case 1:return[2,_state.sent()];case 2:e=_state.sent();return[2,(console.warn("createWideframesCurrentScoreAsync",e),null)];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var s,a,n,i,o,_a_i,r,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=e.id,a=e.profiles,n=e.customData,i=n.playerId,o=n.opponentId;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");_a_i=a[i],r=_a_i.name,l={data:{type:dt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:"".concat(r," made an update."),localizations:{vi_VN:"".concat(r," \xe3 cp nht trn u. Chi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");return[4,GameSDK.extra.updateAsync(l)];case 1:_state.sent();return[2]}})})()}}]);return Fn}(A);c(Fn,"SendUpdateMessageHandler");var Ds=Fn;var Un=function(x){_inherits(Un,x);var _super=_create_super(Un);function Un(){_class_call_check(this,Un);return _super.apply(this,arguments)}_create_class(Un,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d,h,f,g,m,I;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.contextId,s=e.matchId,a=e.playerId,n=e.opponentId,i=new S(_this),o=new Dt(_this,{contextId:t});i.setNext(o);r=new M(_this,{id:s,mode:$.CHALLENGE_FRIEND,customData:{playerId:a,opponentId:n}});o.setNext(r);l=new Is(_this);r.setNext(l);d=new J(_this);l.setNext(d);h=new j(_this);d.setNext(h);f=new Ds(_this);h.setNext(f);g=new F(_this);f.setNext(g);m=new N(_this);g.setNext(m);I=_this.match.getMatchState();return[4,i.processAsync(I)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return Un}(x);c(Un,"ContinueChallengeMatchConcrete");var Ps=Un;var Ec=y.Plugins,Sc=y.Utils,vc=Ec.Analytics,bc=Sc.String,Bo=Sc.Valid,kn=function(A){_inherits(kn,A);var _super=_create_super(kn);function kn(){_class_call_check(this,kn);return _super.apply(this,arguments)}_create_class(kn,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(kn.prototype),"processAsync",_this)};return _async_to_generator(function(){var t,s,a,n,i,_this_game,o,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e);t=e.customData,s=e.mode,a=e.startAt,n=e.finishAt,i=t.level;_this1.validateMode(s),_this1.validateLevel(i);_this_game=_this1.game,o=_this_game.analytics,r=Math.floor((n-a)/1e3);o.event(vc.Events.MATCH_END,{level:i,game_mode:bc.toUpperCamelCase(s),level_name:"level_".concat(i),time_played:r});return[4,_this1.nextAsync(e)];case 1:_state.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!Bo.isString(e))throw new jt}},{key:"validateLevel",value:function validateLevel(e){if(!Bo.isNumber(e))throw new le}}]);return kn}(A);c(kn,"LogMatchFinishedHandler");var ht=kn;var Bn=function(Error1){_inherits(Bn,Error1);var _super=_create_super(Bn);function Bn(e){_class_call_check(this,Bn);var _this;_this=_super.call(this,e),_this.name="PlayerNotLoggedIn",_this.message=e||"Player is not logged in";return _possible_constructor_return(_this)}return Bn}(_wrap_native_super(Error));c(Bn,"PlayerNotLoggedIn");var ye=Bn;var jn=function(Error1){_inherits(jn,Error1);var _super=_create_super(jn);function jn(e){_class_call_check(this,jn);var _this;_this=_super.call(this,e),_this.name="ScoreNotValid",_this.message=e!==null&&e!==void 0?e:"Score is not valid";return _possible_constructor_return(_this)}return jn}(_wrap_native_super(Error));c(jn,"ScoreNotValid");var ut=jn;var Kn=function(Error1){_inherits(Kn,Error1);var _super=_create_super(Kn);function Kn(e){_class_call_check(this,Kn);var _this;_this=_super.call(this,e),_this.name="LeaderboardIdNotValid",_this.message=e!==null&&e!==void 0?e:"Leaderboard id is not valid";return _possible_constructor_return(_this)}return Kn}(_wrap_native_super(Error));c(Kn,"LeaderboardIdNotValid");var pt=Kn;var Wn=function(Error1){_inherits(Wn,Error1);var _super=_create_super(Wn);function Wn(e){_class_call_check(this,Wn);var _this;_this=_super.call(this,e),_this.name="LeaderboardNotExist",_this.message=e!==null&&e!==void 0?e:"Leaderboard not exist in game";return _possible_constructor_return(_this)}return Wn}(_wrap_native_super(Error));c(Wn,"LeaderboardNotExist");var xs=Wn;var _y_Utils10=y.Utils,jo=_y_Utils10.Valid,zn=function(A){_inherits(zn,A);var _super=_create_super(zn);function zn(t,s){_class_call_check(this,zn);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");u(_assert_this_initialized(_this),"leaderboardPayload");_this.payload=s;return _this}_create_class(zn,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(zn.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t),_this1.setupSetScorePayload(t),_this1.setLeaderboardScoreAsync();return[4,_this1.nextAsync(t)];case 1:_state.sent();return[2]}})})()}},{key:"setupSetScorePayload",value:function setupSetScorePayload(t){var _this=this;return _async_to_generator(function(){var s,a,n,_this_payload,i,o;return _ts_generator(this,function(_state){s=t.profiles,a=t.customData,n=a.playerId;if(!n||!s[n])throw new R;_this_payload=_this.payload,i=_this_payload.score,o=_this_payload.leaderboardId;if(!jo.isNumber(i))throw new ut;if(!jo.isString(o))throw new pt;_this.leaderboardPayload={score:i,playerId:n,leaderboardId:o};return[2]})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(){var _this=this;return _async_to_generator(function(){var _this_leaderboardPayload,_$t,s,a,n,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);_this_leaderboardPayload=_this.leaderboardPayload,_$t=_this_leaderboardPayload.playerId,s=_this_leaderboardPayload.score,a=_this_leaderboardPayload.leaderboardId,n=_this.game.leaderboard.getLeaderboardName(a);if(!n)throw new xs;return[4,_this.game.leaderboard.setLeaderboardScoreAsync(n,_$t,s)];case 1:_state.sent();return[3,3];case 2:t=_state.sent();console.warn("setLeaderboardScoreAsync",t);return[3,3];case 3:return[2]}})})()}}]);return zn}(A);c(zn,"SetLeaderboardScoreHandler");var Pt=zn;var _y_Utils11=y.Utils,Nc=_y_Utils11.Valid,_y_Configs=y.Configs,Cc=_y_Configs.Leaderboards,Hn=function(Pt){_inherits(Hn,Pt);var _super=_create_super(Hn);function Hn(e){_class_call_check(this,Hn);return _super.call(this,e,{score:0,leaderboardId:Cc.LeaderboardId})}_create_class(Hn,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var _this=this;var _this1=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(Hn.prototype),"setupSetScorePayload",_this)};return _async_to_generator(function(){var t,s,a,_t_a,n;return _ts_generator(this,function(_state){if(GameSDK.player.isGuest())throw new ye;t=e.profiles,s=e.customData,a=s.playerId;if(!a||!t[a])throw new R;_t_a=t[a],n=_t_a.score;if(!Nc.isNumber(n))throw new ut;_this1.payload.score=n,_superprop_get_setupSetScorePayload().call(_this1,e);return[2]})})()}}]);return Hn}(Pt);c(Hn,"PostGlobalLeaderboardScoreHandler");var qt=Hn;var Oc=y.Dtos,Lc=y.Utils,fe=Lc.Valid,Tc=Lc.Object,qn=function(A){_inherits(qn,A);var _super=_create_super(qn);function qn(t,s){_class_call_check(this,qn);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(qn,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(qn.prototype),"processAsync",_this)};return _async_to_generator(function(){var _this_payload,s,a,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t),_this1.validateMatchData(t);_this_payload=_this1.payload,s=_this_payload.useAPI;if(!s)return[3,2];return[4,_this1.finishMatchAsync(t)];case 1:a=_state.sent(),n=new Oc.Match.Data(a).toObject();_this1.updateMatchFromAPI(t,n);return[3,3];case 2:_this1.updateMatchData(t);_state.label=3;case 3:_this1.updateMatchState(t);return[4,_this1.nextAsync(t)];case 4:_state.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(t){var s=t.status,a=t.profiles,n=t.customData;if(s!==U.ACTIVE)throw new de;var i=n.playerId;if(!i||!Tc.hasOwn(a,i))throw new Wt}},{key:"updateMatchData",value:function updateMatchData(t){var _t_customData=t.customData,s=_t_customData.playerId;if(!fe.isString(s))throw new D;t.profiles[s].finished=!0}},{key:"updateMatchState",value:function updateMatchState(t){t.status=U.FINISHED,t.finishAt=Date.now()}},{key:"finishMatchAsync",value:function finishMatchAsync(t){var _this=this;return _async_to_generator(function(){var s,a,n,i,o,_a_o,r,_this_payload,l,d;return _ts_generator(this,function(_state){s=t.id,a=t.profiles,n=t.customData,i=n.level,o=n.playerId;if(!fe.isString(o))throw new D;_a_o=a[o],r=_a_o.score,_this_payload=_this.payload,l=_this_payload.extraData,d={matchId:s!==null&&s!==void 0?s:"",score:r,level:i,extraData:l};return[2,_this.match.api.getMatchAPI().finishMatchAsync(d)]})})()}},{key:"updateMatchFromAPI",value:function updateMatchFromAPI(t,s){var _t_customData=t.customData,a=_t_customData.playerId,n=_t_customData.opponentId;if(!fe.isString(a))throw new D;if(!fe.isString(n))throw new T;var i=s.whitePlayerId,o=s.whitePlayerScore,r=s.blackPlayerScore,l=s.whitePlayerFinish,d=s.blackPlayerFinish,h=a===i,f=h?o:r,g=h?r:o,m=h?l:d,I=h?d:l;t.profiles[a].score=f,t.profiles[n].score=g,t.profiles[a].finished=m,t.profiles[n].finished=I}}]);return qn}(A);c(qn,"FinishMatchHandler");var yt=qn;var Yn=function(A){_inherits(Yn,A);var _super=_create_super(Yn);function Yn(){_class_call_check(this,Yn);return _super.apply(this,arguments)}_create_class(Yn,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Yn.prototype),"processAsync",_this)};return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.validateData(e);return[4,_this1.createWideframesResultAsync(e)];case 1:t=_state.sent();t&&_this1.progressSendFinishedMessage(e,t);return[4,_this1.nextAsync(e)];case 2:_state.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,s=e.customData,a=s.contextId,n=s.opponentId;if(!t||typeof t!="string")throw new z;if(!a||typeof a!="string")throw new B;if(!n||typeof n!="string")throw new T}},{key:"createWideframesResultAsync",value:function createWideframesResultAsync(e){var _this=this;return _async_to_generator(function(){var _this_game,_$t,s,a,n,i,o,r,l,tmp,d,h,f,tmp1,g,m,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);_this_game=_this.game,_$t=_this_game.frameCapture,s=e.profiles,a=e.customData,n=a.playerId,i=a.opponentId;if(!n||!i)return[2,null];o=s[n],r=s[i],l=o.photo,tmp=o.score,d=tmp===void 0?0:tmp,h=o.finished,f=r.photo,tmp1=r.score,g=tmp1===void 0?0:tmp1,m=r.finished;return[4,_$t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:f,opponentScore:g,isPlayerFinished:!!h,isOpponentFinished:!!m})];case 1:return[2,_state.sent()];case 2:t=_state.sent();return[2,(console.warn("createWideframesResultAsync",t),null)];case 3:return[2]}})})()}},{key:"progressSendFinishedMessage",value:function progressSendFinishedMessage(e,t){var s=e.profiles,a=e.customData,n=a.playerId,i=a.opponentId;if(!n||typeof n!="string")throw new D;if(!i||typeof i!="string")throw new T;var _s_n=s[n],tmp=_s_n.score,o=tmp===void 0?0:tmp,r=_s_n.finished,_s_i=s[i],tmp1=_s_i.score,l=tmp1===void 0?0:tmp1,d=_s_i.finished;r?this.sendFinishMessageAsync(e,t):d&&o>l?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}},{key:"sendFinishMessageAsync",value:function sendFinishMessageAsync(e,t){return _async_to_generator(function(){var s,a,n,i,o,_a_i,r,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=e.id,a=e.profiles,n=e.customData,i=n.playerId,o=n.opponentId;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");_a_i=a[i],r=_a_i.name,l={data:{type:dt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:U.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kt qu"}},text:{default:"".concat(r," just finished. Check them now."),localizations:{vi_VN:"".concat(r," va ho\xe0n th\xe0nh m\xe0n chi. Nhn  xem kt qu trn u.")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");return[4,GameSDK.extra.updateAsync(l)];case 1:_state.sent();return[2]}})})()}},{key:"sendPlayTurnMessageAsync",value:function sendPlayTurnMessageAsync(e,t){return _async_to_generator(function(){var s,a,n,i,o,_a_i,r,l,d;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=e.id,a=e.profiles,n=e.customData,i=n.playerId,o=n.opponentId;if(!i||typeof i!="string")throw new D;_a_i=a[i],r=_a_i.name,l=_a_i.score,d={data:{type:dt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:U.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:"".concat(r," got ").concat(l," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(r," \xe3 t ").concat(l," im! Nhn Chi  so t\xe0i!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");return[4,GameSDK.extra.updateAsync(d)];case 1:_state.sent();return[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){return _async_to_generator(function(){var s,a,n,i,o,_a_i,r,l,d;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=e.id,a=e.profiles,n=e.customData,i=n.playerId,o=n.opponentId;if(!i||typeof i!="string")throw new D;_a_i=a[i],r=_a_i.name,l=_a_i.score,d={data:{type:dt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o,status:U.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kt qu"}},text:{default:"".concat(r," beat your high score. Their score: ").concat(l),localizations:{vi_VN:"".concat(r," \xe3 vt qua im s ca bn, vi ").concat(l," im!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");return[4,GameSDK.extra.updateAsync(d)];case 1:_state.sent();return[2]}})})()}}]);return Yn}(A);c(Yn,"SendFinishedMessageHandler");var Es=Yn;var Qn=function(A){_inherits(Qn,A);var _super=_create_super(Qn);function Qn(){_class_call_check(this,Qn);return _super.apply(this,arguments)}_create_class(Qn,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Qn.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.setPlayerBestScore(e);return[4,_this1.nextAsync(e)];case 1:_state.sent();return[2]}})})()}},{key:"setPlayerBestScore",value:function setPlayerBestScore(e){var t=e.profiles,s=e.customData,a=s.playerId;if(!a||!t[a])throw new R;var _this_game=this.game,n=_this_game.player,i=n.getBestScore()||0,_t_a=t[a],tmp=_t_a.score,o=tmp===void 0?0:tmp;o<=i||(n.setBestScore(o),t[a].bestScore=o)}}]);return Qn}(A);c(Qn,"SetPlayerBestScoreHandler");var xt=Qn;var Xn=function(x){_inherits(Xn,x);var _super=_create_super(Xn);function Xn(){_class_call_check(this,Xn);return _super.apply(this,arguments)}_create_class(Xn,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var _ref,t,s,a,n,i,o,r,l,d;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);_ref=e!==null&&e!==void 0?e:{},t=_ref.extraData,s=new S(_this),a=new yt(_this,{useAPI:!0,extraData:t});s.setNext(a);n=new Es(_this);a.setNext(n);i=new ht(_this);n.setNext(i);o=new xt(_this);i.setNext(o);r=new qt(_this);o.setNext(r);l=new N(_this);r.setNext(l);d=_this.match.getMatchState();return[4,s.processAsync(d)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return Xn}(x);c(Xn,"FinishChallengeMatchConcrete");var Ss=Xn;var Jn=function(Error1){_inherits(Jn,Error1);var _super=_create_super(Jn);function Jn(e){_class_call_check(this,Jn);var _this;_this=_super.call(this,e),_this.name="ContextAreSolo",_this.message=e!==null&&e!==void 0?e:"Context are solo";return _possible_constructor_return(_this)}return Jn}(_wrap_native_super(Error));c(Jn,"ContextAreSolo");var vs=Jn;var Zn=function(Error1){_inherits(Zn,Error1);var _super=_create_super(Zn);function Zn(e){_class_call_check(this,Zn);var _this;_this=_super.call(this,e),_this.name="OpponentNotJoinInContext",_this.message=e!==null&&e!==void 0?e:"Opponent is not join in context";return _possible_constructor_return(_this)}return Zn}(_wrap_native_super(Error));c(Zn,"OpponentNotJoinInContext");var bs=Zn;var ti=function(Error1){_inherits(ti,Error1);var _super=_create_super(ti);function ti(e){_class_call_check(this,ti);var _this;_this=_super.call(this,e),_this.name="NetworkFailure",_this.message=e!==null&&e!==void 0?e:"Network failure";return _possible_constructor_return(_this)}return ti}(_wrap_native_super(Error));c(ti,"NetworkFailure");var Ns=ti;var Mc=y.Utils,Rc=y.Dtos,_c=Mc.Array,$c=Mc.Object,ei=function(A){_inherits(ei,A);var _super=_create_super(ei);function ei(t,s){_class_call_check(this,ei);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(ei,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ei.prototype),"processAsync",_this)};return _async_to_generator(function(){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t),_this1.checkCurrentContext();return[4,_this1.getOpponentIdFromContextAsync()];case 1:s=_state.sent();t.customData.opponentId=s;return[4,_this1.nextAsync(t)];case 2:_state.sent();return[2]}})})()}},{key:"checkCurrentContext",value:function checkCurrentContext(){var t=GameSDK.context.getID();if(typeof t!="string")throw new B;if(t==="SOLO")throw new vs}},{key:"getOpponentIdFromContextAsync",value:function getOpponentIdFromContextAsync(){var _this=this;return _async_to_generator(function(){var _this_payload,t,s,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_payload=_this.payload,t=_this_payload.ignoreId;return[4,_this.getContextPlayers([t])];case 1:s=_state.sent();if(s.length>1)throw new bs;a=X;return[2,(s.length===1&&(a=s[0]),a.playerId)]}})})()}},{key:"getContextPlayers",value:function getContextPlayers(t){return _async_to_generator(function(){var _$s,a,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,GameSDK.context.getPlayersAsync()];case 1:_$s=_state.sent(),a=[];return[2,(_$s.forEach(function(n){var i=n.getID();if(t.indexOf(i)>-1)return;var o=n.getName();if(!o)return;var r=n.getPhoto();a.push(new Rc.Player.Info({playerId:i,name:o,photo:r}).toObject())}),_c.unique(a))];case 2:s=_state.sent();if($c.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new Ns;return[2,[]];case 3:return[2]}})})()}}]);return ei}(A);c(ei,"GetOpponentChallengeContextHandler");var Cs=ei;var si=function(Error1){_inherits(si,Error1);var _super=_create_super(si);function si(e){_class_call_check(this,si);var _this;_this=_super.call(this,e),_this.name="ContextIsTournament",_this.message=e!==null&&e!==void 0?e:"Context is a tournament";return _possible_constructor_return(_this)}return si}(_wrap_native_super(Error));c(si,"ContextIsTournament");var Yt=si;var _y_Utils12=y.Utils,Gc=_y_Utils12.Object,ai=function(A){_inherits(ai,A);var _super=_create_super(ai);function ai(){_class_call_check(this,ai);return _super.apply(this,arguments)}_create_class(ai,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ai.prototype),"processAsync",_this)};return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e);return[4,_this1.chooseAsync()];case 1:t=_state.sent();return[4,_this1.checkContextTournament()];case 2:_state.sent(),e.customData.contextId=t;return[4,_this1.nextAsync(e)];case 3:_state.sent();return[2]}})})()}},{key:"chooseAsync",value:function chooseAsync(){return _async_to_generator(function(){var t,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})];case 1:_state.sent();return[3,3];case 2:t=_state.sent();if(!Gc.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t;return[3,3];case 3:e=GameSDK.context.getID();if(typeof e!="string")throw new zt;return[2,e]}})})()}},{key:"checkContextTournament",value:function checkContextTournament(){return _async_to_generator(function(){var _tmp,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,4,,5]);if(!GameSDK.context.getID())return[2];if(!("getTournamentAsync"in GameSDK))return[3,2];return[4,GameSDK.getTournamentAsync()];case 1:_tmp=(_state.sent(),new Yt);return[3,3];case 2:_tmp=new P("getTournamentAsync");_state.label=3;case 3:throw _tmp;case 4:e=_state.sent();if(_instanceof(e,Yt))throw e;return[3,5];case 5:return[2]}})})()}}]);return ai}(A);c(ai,"ChooseContextHandler");var Os=ai;var ni=function(x){_inherits(ni,x);var _super=_create_super(ni);function ni(){_class_call_check(this,ni);return _super.apply(this,arguments)}_create_class(ni,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d,h,f,g;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.playerId,s=new S(_this),a=new Os(_this);s.setNext(a);n=new M(_this,{mode:$.CHALLENGE_FRIEND,customData:{playerId:t}});a.setNext(n);i=new Cs(_this,{ignoreId:t});n.setNext(i);o=new ue(_this,{extraData:e.extraData});i.setNext(o);r=new J(_this);o.setNext(r);l=new j(_this);r.setNext(l);d=new F(_this);l.setNext(d);h=new pe(_this);d.setNext(h);f=new N(_this);h.setNext(f);g=_this.match.getMatchState();return[4,s.processAsync(g)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return ni}(x);c(ni,"InviteFriendsConcrete");var Ls=ni;var ii=function(Error1){_inherits(ii,Error1);var _super=_create_super(ii);function ii(e){_class_call_check(this,ii);var _this;_this=_super.call(this,e),_this.name="JoinMatchFailed",_this.message=e!==null&&e!==void 0?e:"Join match failed";return _possible_constructor_return(_this)}return ii}(_wrap_native_super(Error));c(ii,"JoinMatchFailed");var Ts=ii;var oi=function(Error1){_inherits(oi,Error1);var _super=_create_super(oi);function oi(e){_class_call_check(this,oi);var _this;_this=_super.call(this,e),_this.name="MatchAreFinished",_this.message=e!==null&&e!==void 0?e:"Match are finished";return _possible_constructor_return(_this)}return oi}(_wrap_native_super(Error));c(oi,"MatchAreFinished");var Ms=oi;var ri=function(Error1){_inherits(ri,Error1);var _super=_create_super(ri);function ri(e){_class_call_check(this,ri);var _this;_this=_super.call(this,e),_this.name="OtherPlayerHasJoinedMatch",_this.message=e!==null&&e!==void 0?e:"Other player has joined match";return _possible_constructor_return(_this)}return ri}(_wrap_native_super(Error));c(ri,"OtherPlayerHasJoinedMatch");var Rs=ri;var Vc=y.Dtos,ci=function(A){_inherits(ci,A);var _super=_create_super(ci);function ci(){_class_call_check(this,ci);return _super.apply(this,arguments)}_create_class(ci,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ci.prototype),"processAsync",_this)};return _async_to_generator(function(){var t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.validateMatchData(e);return[4,_this1.joinMatchAsync(e)];case 1:t=_state.sent(),s=new Vc.Match.Data(t).toObject();_this1.validateJoinMatchData(e,s),_this1.updateMatchData(e,s);return[4,_this1.nextAsync(e)];case 2:_state.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.status;if(t!==U.OPEN)throw new It}},{key:"validateJoinMatchData",value:function validateJoinMatchData(e,t){var s=e.id,a=e.customData,n=t._id,i=t.blackPlayerId,o=t.whitePlayerId,r=t.whitePlayerFinish,l=t.blackPlayerFinish,d=i===a.playerId,h=o===a.opponentId;if(typeof n!="string"||n!==s||!h)throw console.warn("\uD83E\uDD16 ? matchData",t),new Ts;if(r&&l)throw new Ms;if(!d)throw new Rs}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){t=e.id;return[2,t?_this.match.api.getMatchAPI().joinMatchAsync(t):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var s=e.customData,a=t.whitePlayerId,n=t.blackPlayerId,i=t.whitePlayerScore,o=t.blackPlayerScore,r=t.whitePlayerFinish,l=t.blackPlayerFinish,d=a===s.playerId,h=d?a:n,f=d?n:a;e.customData.playerId=h,e.customData.opponentId=f,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!1}),e.profiles[f]||(e.profiles[f]={id:f,name:"",photo:"",finished:!1});var g=d?i:o,m=d?o:i;e.profiles[h].score=g,e.profiles[f].score=m;var I=d?r:l,w=d?l:r;e.profiles[h].finished=I,e.profiles[f].finished=w}}]);return ci}(A);c(ci,"JoinMatchHandler");var _s=ci;var li=function(A){_inherits(li,A);var _super=_create_super(li);function li(){_class_call_check(this,li);return _super.apply(this,arguments)}_create_class(li,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(li.prototype),"processAsync",_this)};return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.validateData(e);return[4,_this1.createWideframesAcceptedAsync(e)];case 1:t=_state.sent();t&&_this1.sendMessageAsync(e,t);return[4,_this1.nextAsync(e)];case 2:_state.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,s=e.customData,a=s.contextId,n=s.opponentId;if(!t||typeof t!="string")throw new z;if(!a||typeof a!="string")throw new B;if(!n||typeof n!="string")throw new T}},{key:"createWideframesAcceptedAsync",value:function createWideframesAcceptedAsync(e){var _this=this;return _async_to_generator(function(){var _this_game,_$t,s,a,n,i,o,r,l,tmp,d,h,f,tmp1,g,m,_tmp,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,4,,5]);_this_game=_this.game,_$t=_this_game.frameCapture,s=e.profiles,a=e.customData,n=a.playerId,i=a.opponentId;if(!n||!i)return[2,null];o=s[n],r=s[i],l=o.photo,tmp=o.score,d=tmp===void 0?0:tmp,h=o.finished;if(h)return[2,null];f=r.photo,tmp1=r.score,g=tmp1===void 0?0:tmp1,m=r.finished;if(!m)return[3,2];return[4,_$t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:f,opponentScore:g,isPlayerFinished:!1,isOpponentFinished:!0})];case 1:_tmp=_state.sent();return[3,3];case 2:_tmp=null;_state.label=3;case 3:return[2,_tmp];case 4:t=_state.sent();return[2,(console.warn("createWideframesAcceptedAsync",t),null)];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var s,a,n,i,o,_a_i,r,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=e.id,a=e.profiles,n=e.customData,i=n.playerId,o=n.opponentId;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");_a_i=a[i],r=_a_i.name,l={data:{type:dt.CHALLENGE_FRIEND,matchId:s,playerId:i,opponentId:o},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:"".concat(r," accepted the challenge."),localizations:{vi_VN:"".concat(r," \xe3 chp nhn tham gia trn u.")}},image:t,strategy:"LAST",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(l)];case 1:_state.sent();return[2]}})})()}}]);return li}(A);c(li,"SendAcceptedMessageHandler");var $s=li;var di=function(x){_inherits(di,x);var _super=_create_super(di);function di(){_class_call_check(this,di);return _super.apply(this,arguments)}_create_class(di,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d,h,f,g;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.matchId,s=e.playerId,a=e.opponentId,n=new S(_this),i=new M(_this,{id:t,mode:$.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);o=new _s(_this);i.setNext(o);r=new J(_this);o.setNext(r);l=new j(_this);r.setNext(l);d=new $s(_this);l.setNext(d);h=new F(_this);d.setNext(h);f=new N(_this);h.setNext(f);g=_this.match.getMatchState();return[4,n.processAsync(g)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return di}(x);c(di,"JoinChallengeMatchConcrete");var Gs=di;var Ko={_id:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1},_y_Utils13=y.Utils,Z=_y_Utils13.Valid,tt="is invalid",hi=function(G){_inherits(hi,G);var _super=_create_super(hi);function hi(){_class_call_check(this,hi);return _super.apply(this,arguments)}_create_class(hi,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){(!Z.isString(e)||!e)&&this.exception("_id",tt)}},{key:"validateStatus",value:function validateStatus(e){(!Z.isString(e)||!e)&&this.exception("status",tt)}},{key:"validateWinnerId",value:function validateWinnerId(e){e!==null&&(!Z.isString(e)||!e)&&this.exception("winnerId",tt)}},{key:"validateWhitePlayerId",value:function validateWhitePlayerId(e){(!Z.isString(e)||!e)&&this.exception("whitePlayerId",tt)}},{key:"validateBlackPlayerId",value:function validateBlackPlayerId(e){(!Z.isString(e)||!e)&&this.exception("blackPlayerId",tt)}},{key:"validateWhitePlayerScore",value:function validateWhitePlayerScore(e){Z.isNumber(e)||this.exception("whitePlayerScore",tt)}},{key:"validateBlackPlayerScore",value:function validateBlackPlayerScore(e){Z.isNumber(e)||this.exception("blackPlayerScore",tt)}},{key:"validateWhitePlayerFinish",value:function validateWhitePlayerFinish(e){Z.isBoolean(e)||this.exception("whitePlayerFinish",tt)}},{key:"validateBlackPlayerFinish",value:function validateBlackPlayerFinish(e){Z.isBoolean(e)||this.exception("blackPlayerFinish",tt)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(hi.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return Ko}}]);return hi}(G);c(hi,"RespMatchDataDtos");var Qt=hi;Qt.addDefaultData(Ko);var ui=function(Error1){_inherits(ui,Error1);var _super=_create_super(ui);function ui(e){_class_call_check(this,ui);var _this;_this=_super.call(this,e),_this.name="MatchAreNotFinished",_this.message=e||"Match are not finished";return _possible_constructor_return(_this)}return ui}(_wrap_native_super(Error));c(ui,"MatchAreNotFinished");var Vs=ui;var pi=function(Error1){_inherits(pi,Error1);var _super=_create_super(pi);function pi(e){_class_call_check(this,pi);var _this;_this=_super.call(this,e),_this.name="OpponentNotFinishedMatch",_this.message=e||"Opponent not finished match";return _possible_constructor_return(_this)}return pi}(_wrap_native_super(Error));c(pi,"OpponentNotFinishedMatch");var Fs=pi;var yi=function(A){_inherits(yi,A);var _super=_create_super(yi);function yi(){_class_call_check(this,yi);return _super.apply(this,arguments)}_create_class(yi,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(yi.prototype),"processAsync",_this)};return _async_to_generator(function(){var t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.validateMatchData(e);return[4,_this1.getMatchAsync(e)];case 1:t=_state.sent(),s=new Qt(t).toObject();_this1.validateResultMatchData(e,s),_this1.updateMatchData(e,s),_this1.validatePlayerTurn(e),_this1.validateOpponentTurn(e);return[4,_this1.nextAsync(e)];case 2:_state.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id;if(typeof t!="string")throw new z}},{key:"validateResultMatchData",value:function validateResultMatchData(e,t){var s=e.id,a=t._id,n=t.whitePlayerFinish,i=t.blackPlayerFinish;if(typeof a!="string"||a!==s)throw new Kt;if(!n&&!i)throw new Vs}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,s=e.customData,a=s.playerId;if(typeof a!="string")throw new D;var _t_a=t[a],n=_t_a.finished;if(!n)throw new he}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,s=e.customData,a=s.opponentId;if(typeof a!="string")throw new T;var _t_a=t[a],n=_t_a.finished;if(!n)throw new Fs}},{key:"getMatchAsync",value:function getMatchAsync(e){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){t=e.id;return[2,t?_this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var s=e.customData,a=t.whitePlayerId,n=t.blackPlayerId,i=t.whitePlayerScore,o=t.blackPlayerScore,r=t.whitePlayerFinish,l=t.blackPlayerFinish,d=a===s.playerId,h=d?a:n,f=d?n:a;e.customData.playerId=h,e.customData.opponentId=f,e.profiles[h]||(e.profiles[h]={id:h,name:"",photo:"",finished:!0}),e.profiles[f]||(e.profiles[f]={id:f,name:"",photo:"",finished:!0});var g=d?i:o,m=d?o:i;e.profiles[h].score=g,e.profiles[f].score=m;var I=d?r:l,w=d?l:r;e.profiles[h].finished=I,e.profiles[f].finished=w}}]);return yi}(A);c(yi,"ResultMatchHandler");var Us=yi;var fi=function(x){_inherits(fi,x);var _super=_create_super(fi);function fi(){_class_call_check(this,fi);return _super.apply(this,arguments)}_create_class(fi,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.matchId,s=e.playerId,a=e.opponentId,n=new S(_this),i=new M(_this,{id:t,mode:$.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:a}});n.setNext(i);o=new Us(_this);i.setNext(o);r=new J(_this);o.setNext(r);l=new N(_this);r.setNext(l);d=_this.match.getMatchState();return[4,n.processAsync(d)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return fi}(x);c(fi,"ResultChallengeMatchConcrete");var ks=fi;var gi=function(x){_inherits(gi,x);var _super=_create_super(gi);function gi(){_class_call_check(this,gi);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"fallbackSingleMode");var _this1=_assert_this_initialized(_this);u(_assert_this_initialized(_this),"startFLowChallengeFriend",c(function(){var _ref=_async_to_generator(function(t){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,_this1.match.challenge.invite.processAsync(t)];case 1:return[2,(_state.sent(),!0)];case 2:s=_state.sent();return[2,s];case 3:return[2]}})});return function(t){return _ref.apply(this,arguments)}}(),"startFLowChallengeFriend"));var _this2=_assert_this_initialized(_this);u(_assert_this_initialized(_this),"startFlowTournament",c(function(){var _ref=_async_to_generator(function(t){var s,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,4]);s=GameSDK.context.getID();if(typeof s!="string")throw new B;return[4,_this2.match.tournament.continue.processAsync({playerId:t,contextId:s})];case 1:_state.sent();return[3,4];case 2:e=_state.sent();return[4,_this2.startFlowSingle(t)];case 3:_state.sent();return[3,4];case 4:return[2]}})});return function(t){return _ref.apply(this,arguments)}}(),"startFlowTournament"));var _this3=_assert_this_initialized(_this);u(_assert_this_initialized(_this),"startFlowSingle",c(function(){var _ref=_async_to_generator(function(t){return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!_this3.fallbackSingleMode)throw new Error("Fallback single mode is not enabled");return[4,_this3.match.single.start.processAsync({playerId:t})];case 1:_state.sent();return[2]}})});return function(t){return _ref.apply(this,arguments)}}(),"startFlowSingle"));return _this}_create_class(gi,[{key:"processAsync",value:function processAsync(t){var _this=this;return _async_to_generator(function(){var s,a,n,i,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,6,7]);_this.startLog(t);s=t.playerId,a=t.extraData,n=t.fallbackSingleMode;_this.fallbackSingleMode=n;return[4,_this.startFLowChallengeFriend({playerId:s,extraData:a})];case 1:i=_state.sent();if(i===!0)return[2];if(!_instanceof(i,Yt))return[3,3];return[4,_this.startFlowTournament(s)];case 2:_tmp=_state.sent();return[3,5];case 3:return[4,_this.startFlowSingle(s)];case 4:_tmp=_state.sent();_state.label=5;case 5:_tmp;return[3,7];case 6:_this.endLog();return[7];case 7:return[2]}})})()}}]);return gi}(x);c(gi,"ChooseContextConcrete");var Bs=gi;var _y_Utils14=y.Utils,Fc=_y_Utils14.Valid,_y_Configs1=y.Configs,Uc=_y_Configs1.Leaderboards,wi=function(Pt){_inherits(wi,Pt);var _super=_create_super(wi);function wi(e){_class_call_check(this,wi);return _super.call(this,e,{score:0,leaderboardId:Uc.LeaderboardEndlessId})}_create_class(wi,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var _this=this;var _this1=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(wi.prototype),"setupSetScorePayload",_this)};return _async_to_generator(function(){var t,s,a,_t_a,n;return _ts_generator(this,function(_state){if(GameSDK.player.isGuest())throw new ye;t=e.profiles,s=e.customData,a=s.playerId;if(!a||!t[a])throw new R;_t_a=t[a],n=_t_a.endlessScore;if(!Fc.isNumber(n))throw new ut;_this1.payload.score=n,_superprop_get_setupSetScorePayload().call(_this1,e);return[2]})})()}}]);return wi}(Pt);c(wi,"PostGlobalLeaderboardEndlessScoreHandler");var js=wi;var mi=function(A){_inherits(mi,A);var _super=_create_super(mi);function mi(){_class_call_check(this,mi);return _super.apply(this,arguments)}_create_class(mi,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(mi.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.setPlayerEndlessScore(e);return[4,_this1.nextAsync(e)];case 1:_state.sent();return[2]}})})()}},{key:"setPlayerEndlessScore",value:function setPlayerEndlessScore(e){var t=e.profiles,s=e.customData,a=s.playerId;if(!a||!t[a])throw new R;var _n_getBestEndlessScore;var _this_game=this.game,n=_this_game.player,i=(_n_getBestEndlessScore=n.getBestEndlessScore())!==null&&_n_getBestEndlessScore!==void 0?_n_getBestEndlessScore:0,_t_a=t[a],tmp=_t_a.endlessScore,o=tmp===void 0?0:tmp,r=i<o?o:i;n.setBestEndlessScore(r),t[a].bestEndlessScore=r}}]);return mi}(A);c(mi,"SetPlayerEndlessScoreHandler");var Ks=mi;var Ai=function(x){_inherits(Ai,x);var _super=_create_super(Ai);function Ai(){_class_call_check(this,Ai);return _super.apply(this,arguments)}_create_class(Ai,[{key:"processAsync",value:function processAsync(){var _this=this;return _async_to_generator(function(){var e,t,s,a,n,i,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog();e=new S(_this),t=new yt(_this,{useAPI:!1});e.setNext(t);s=new ht(_this);t.setNext(s);a=new Ks(_this);s.setNext(a);n=new js(_this);a.setNext(n);i=new N(_this);n.setNext(i);o=_this.match.getMatchState();return[4,e.processAsync(o)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return Ai}(x);c(Ai,"FinishEndlessConcrete");var Ws=Ai;var Ii=function(Error1){_inherits(Ii,Error1);var _super=_create_super(Ii);function Ii(e){_class_call_check(this,Ii);var _this;_this=_super.call(this,e),_this.name="ProfileIdNotDefined",_this.message=e!==null&&e!==void 0?e:"Profile id is not defined";return _possible_constructor_return(_this)}return Ii}(_wrap_native_super(Error));c(Ii,"ProfileIdNotDefined");var zs=Ii;var kc=y.Dtos,Di=function(A){_inherits(Di,A);var _super=_create_super(Di);function Di(t,s){_class_call_check(this,Di);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(Di,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Di.prototype),"processAsync",_this)};return _async_to_generator(function(){var _this_payload,s,_this_game,a,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t);_this_payload=_this1.payload,s=_this_payload.profileId;if(!s)throw new zs;_this_game=_this1.game,a=_this_game.player,n=a.getPlayerId();if(!(s===n))return[3,1];i=_this1.getPlayerProfile();return[3,3];case 1:return[4,_this1.getProfileAsync(s)];case 2:if(i=_state.sent(),!i)throw new R;_state.label=3;case 3:_this1.updateMatchData(i,t);return[4,_this1.nextAsync(t)];case 4:_state.sent();return[2]}})})()}},{key:"getPlayerProfile",value:function getPlayerProfile(){var _this_game=this.game,t=_this_game.player,_t_getPlayer=t.getPlayer(),s=_t_getPlayer.playerId,a=_t_getPlayer.name,n=_t_getPlayer.photo,i=_t_getPlayer.locale;return{playerId:s,name:a,photo:n,locale:i}}},{key:"getProfileAsync",value:function getProfileAsync(t){var _this=this;return _async_to_generator(function(){var _this_game,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,s=_this_game.profile;return[4,s.requestProfiles([t])];case 1:return[2,(_state.sent(),s.getProfiles()[t])]}})})()}},{key:"updateMatchData",value:function updateMatchData(t,s){var a=t.playerId,n=t.name,i=t.photo,o=new kc.Match.Profile({id:a,name:n,photo:i}).toObject();s.profiles[a]=o}}]);return Di}(A);c(Di,"GetProfileHandler");var it=Di;var Pi=function(x){_inherits(Pi,x);var _super=_create_super(Pi);function Pi(){_class_call_check(this,Pi);return _super.apply(this,arguments)}_create_class(Pi,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.playerId,s=new S(_this),a=new Dt(_this,{contextId:"SOLO"});s.setNext(a);n=new M(_this,{id:"234567",mode:$.ENDLESS,customData:{playerId:t}});a.setNext(n);i=new j(_this);n.setNext(i);o=new it(_this,{profileId:t});i.setNext(o);r=new F(_this);o.setNext(r);l=new N(_this);r.setNext(l);d=_this.match.getMatchState();return[4,s.processAsync(d)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return Pi}(x);c(Pi,"StartEndlessConcrete");var Hs=Pi;var _y_Utils15=y.Utils,Bc=_y_Utils15.Valid,xi=function(Pt){_inherits(xi,Pt);var _super=_create_super(xi);function xi(e){_class_call_check(this,xi);return _super.call(this,e,{score:0,leaderboardId:""})}_create_class(xi,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var _this=this;var _this1=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(xi.prototype),"setupSetScorePayload",_this)};return _async_to_generator(function(){var t,s,a,n,_t_a,i;return _ts_generator(this,function(_state){t=e.profiles,s=e.customData,a=s.playerId,n=s.leaderboardId;if(!n)throw new pt;if(!a||!t[a])throw new R;_t_a=t[a],i=_t_a.score;if(!Bc.isNumber(i))throw new ut;_this1.payload.score=i,_this1.payload.leaderboardId=n,_superprop_get_setupSetScorePayload().call(_this1,e);return[2]})})()}}]);return xi}(Pt);c(xi,"PostLeaderboardScoreHandler");var Xt=xi;var Ei=function(A){_inherits(Ei,A);var _super=_create_super(Ei);function Ei(){_class_call_check(this,Ei);return _super.apply(this,arguments)}_create_class(Ei,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ei.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e),_this1.validateData(e),_this1.progressSendGroupMessage(e);return[4,_this1.nextAsync(e)];case 1:_state.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,s=e.customData,a=s.contextId,n=s.opponentId;if(!t||typeof t!="string")throw new z;if(!a||typeof a!="string")throw new B;if(!n||typeof n!="string")throw new T}},{key:"createWideframesResultGroupAsync",value:function createWideframesResultGroupAsync(e){var _this=this;return _async_to_generator(function(){var _this_game,_$t,s,a,n,i,o,r,l,tmp,d,h,tmp1,f,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);_this_game=_this.game,_$t=_this_game.frameCapture,s=e.profiles,a=e.customData,n=a.playerId,i=a.opponentId;if(!n||!i)return[2,null];o=s[n],r=s[i],l=o.photo,tmp=o.score,d=tmp===void 0?0:tmp,h=r.photo,tmp1=r.score,f=tmp1===void 0?0:tmp1;return[4,_$t.wideframe.renderResultChallenge({playerId:n,playerPhoto:l,playerScore:d,opponentId:i,opponentPhoto:h,opponentScore:f,isPlayerFinished:!0,isOpponentFinished:!0})];case 1:return[2,_state.sent()];case 2:t=_state.sent();return[2,(console.warn("createWideframesResultGroupAsync",t),null)];case 3:return[2]}})})()}},{key:"createWideframesBestScoreAsync",value:function createWideframesBestScoreAsync(e){var _this=this;return _async_to_generator(function(){var _this_game,_$t,s,_e_customData,a,_t_getPlayer,n,i,o,_ref,r,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);_this_game=_this.game,_$t=_this_game.player,s=_this_game.frameCapture,_e_customData=e.customData,a=_e_customData.playerId,_t_getPlayer=_$t.getPlayer(),n=_t_getPlayer.playerId,i=_t_getPlayer.photo,o=_t_getPlayer.data;if(a!==n)return[2,null];_ref=o||{},r=_ref.score;return[4,s.wideframe.renderShareScore({playerId:n,playerPhoto:i,playerScore:r})];case 1:return[2,_state.sent()];case 2:t=_state.sent();return[2,(console.warn("createWideframesBestScoreAsync",t),null)];case 3:return[2]}})})()}},{key:"progressSendGroupMessage",value:function progressSendGroupMessage(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,_ref,tmp,o,_ref1,tmp1,r,l,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=e.profiles,s=e.customData,a=s.playerId,n=s.opponentId;if(!(n&&typeof n=="string"))return[3,2];if(!a||typeof a!="string")throw new D;_ref=t[a]||{},tmp=_ref.score,o=tmp===void 0?0:tmp,_ref1=t[n]||{},tmp1=_ref1.score,r=tmp1===void 0?0:tmp1;if(!(o>r))return[3,2];return[4,_this.createWideframesResultGroupAsync(e)];case 1:l=_state.sent();if(!l)return[2];_this.sendBestScoreMessageAsync(e,l);return[2];case 2:return[4,_this.createWideframesBestScoreAsync(e)];case 3:i=_state.sent();i&&_this.sendChallengeMessageAsync(e,i);return[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){var _this=this;return _async_to_generator(function(){var s,a,n,_s_n,i,o,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=e.profiles,a=e.customData,n=a.playerId;if(!n||typeof n!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");_s_n=s[n],i=_s_n.name,o=_s_n.score,l={data:{type:_this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:o},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chi"}},text:{default:"".concat(i," beats your high score. Their score: ").concat(o,"."),localizations:{vi_VN:"".concat(i," va vt im s cao nht ca bn! Chi ln na ch?")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");return[4,GameSDK.extra.updateAsync(l)];case 1:_state.sent();return[2]}})})()}},{key:"sendChallengeMessageAsync",value:function sendChallengeMessageAsync(e,t){var _this=this;return _async_to_generator(function(){var s,a,n,_s_n,i,o,l;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=e.profiles,a=e.customData,n=a.playerId;if(!n||typeof n!="string")throw new D;_s_n=s[n],i=_s_n.name,o=_s_n.score,l={data:{type:_this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:n,playerName:i,playerScore:o},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chi ngay"}},text:{default:"".concat(i," got ").concat(o," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(i," \xe3 t ").concat(o," im! Qu\xe1 d lu\xf4n. Chi li n\xe0o!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");return[4,GameSDK.extra.updateAsync(l)];case 1:_state.sent();return[2]}})})()}}]);return Ei}(A);c(Ei,"SendGroupMessageHandler");var qs=Ei;var Si=function(x){_inherits(Si,x);var _super=_create_super(Si);function Si(){_class_call_check(this,Si);return _super.apply(this,arguments)}_create_class(Si,[{key:"processAsync",value:function processAsync(){var _this=this;return _async_to_generator(function(){var e,t,s,a,n,i,o,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog();e=new S(_this),t=new yt(_this,{useAPI:!1});e.setNext(t);s=new qs(_this);t.setNext(s);a=new ht(_this);s.setNext(a);n=new xt(_this);a.setNext(n);i=new Xt(_this);n.setNext(i);o=new N(_this);i.setNext(o);r=_this.match.getMatchState();return[4,e.processAsync(r)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return Si}(x);c(Si,"FinishGroupConcrete");var Ys=Si;var jc=y.Dtos,vi=function(A){_inherits(vi,A);var _super=_create_super(vi);function vi(t,s){_class_call_check(this,vi);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(vi,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(vi.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t),_this1.updateProfileMatchData(t);return[4,_this1.nextAsync(t)];case 1:_state.sent();return[2]}})})()}},{key:"updateProfileMatchData",value:function updateProfileMatchData(t){var _this_payload=this.payload,s=_this_payload.id,a=t.profiles;if(!a[s])throw new R;var n=_object_spread({},a[s],this.payload),i=new jc.Match.Profile(n).toObject();a[i.id]=i}}]);return vi}(A);c(vi,"SetProfileDataHandler");var Et=vi;var bi=function(x){_inherits(bi,x);var _super=_create_super(bi);function bi(){_class_call_check(this,bi);return _super.apply(this,arguments)}_create_class(bi,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d,h,f;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.playerId,s=e.opponentId,a=e.opponentScore,n=new S(_this),i=new M(_this,{id:"7749",mode:$.MATCHING_GROUP,customData:{playerId:t,opponentId:s}});n.setNext(i);o=new J(_this);i.setNext(o);r=new Et(_this,{id:t,score:a});o.setNext(r);l=new j(_this);r.setNext(l);d=new F(_this);l.setNext(d);h=new N(_this);d.setNext(h);f=_this.match.getMatchState();return[4,n.processAsync(f)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return bi}(x);c(bi,"JoinGroupConcrete");var Qs=bi;var Ni=function(Error1){_inherits(Ni,Error1);var _super=_create_super(Ni);function Ni(e){_class_call_check(this,Ni);var _this;_this=_super.call(this,e),_this.name="MatchGroupNotSupported",_this.message=e!==null&&e!==void 0?e:"Match group is not supported";return _possible_constructor_return(_this)}return Ni}(_wrap_native_super(Error));c(Ni,"MatchGroupNotSupported");var ge=Ni;var _y_Utils16=y.Utils,Kc=_y_Utils16.String,Ci=function(A){_inherits(Ci,A);var _super=_create_super(Ci);function Ci(t,s){_class_call_check(this,Ci);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(Ci,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ci.prototype),"processAsync",_this)};return _async_to_generator(function(){var s,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t);return[4,_this1.checkMatchGroupSupported()];case 1:_state.sent();s=_this1.getMatchTag();return[4,_this1.matchingGroup(s)];case 2:a=_state.sent();t.customData.contextId=a;return[4,_this1.nextAsync(t)];case 3:_state.sent();return[2]}})})()}},{key:"checkMatchGroupSupported",value:function checkMatchGroupSupported(){return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!("getSupportedAPIs"in GameSDK))throw new P("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new P("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new ge;return[4,GameSDK.extra.checkCanPlayerMatchAsync()];case 1:if(!_state.sent())throw new ge;return[2]}})})()}},{key:"getMatchTag",value:function getMatchTag(){var _this_payload=this.payload,t=_this_payload.locale;var s="global";if(t){var a=Kc.getLanguageCode(t);a==="en"&&(s="en"),a==="in"&&(s="in")}return s}},{key:"matchingGroup",value:function matchingGroup(t){return _async_to_generator(function(){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!("matchPlayerAsync"in GameSDK.extra))throw new P("matchPlayerAsync");return[4,GameSDK.extra.matchPlayerAsync(t,!0,!0)];case 1:_state.sent();s=GameSDK.context.getID();if(typeof s!="string")throw new zt;return[2,s]}})})()}}]);return Ci}(A);c(Ci,"GroupContextHandler");var Xs=Ci;var Oi=function(x){_inherits(Oi,x);var _super=_create_super(Oi);function Oi(){_class_call_check(this,Oi);return _super.apply(this,arguments)}_create_class(Oi,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d,h;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.locale,s=e.playerId,a=new S(_this),n=new Xs(_this,{locale:t});a.setNext(n);i=new M(_this,{id:"7749",mode:$.MATCHING_GROUP,customData:{playerId:s}});n.setNext(i);o=new j(_this);i.setNext(o);r=new it(_this,{profileId:s});o.setNext(r);l=new F(_this);r.setNext(l);d=new N(_this);l.setNext(d);h=_this.match.getMatchState();return[4,a.processAsync(h)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return Oi}(x);c(Oi,"StartGroupConcrete");var Js=Oi;var Li=function(A){_inherits(Li,A);var _super=_create_super(Li);function Li(){_class_call_check(this,Li);return _super.apply(this,arguments)}_create_class(Li,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Li.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e);return[4,_this1.setMSNLeaderboardScore(e)];case 1:_state.sent();return[4,_this1.nextAsync(e)];case 2:_state.sent();return[2]}})})()}},{key:"setMSNLeaderboardScore",value:function setMSNLeaderboardScore(e){return _async_to_generator(function(){var _$t,s,a,_t_a,n;return _ts_generator(this,function(_state){try{_$t=e.profiles,s=e.customData,a=s.playerId;if(!a||!_$t[a])throw new R;_t_a=_$t[a],n=_t_a.score;if(!y.Utils.Valid.isNumber(n))throw new ut;if(!("submitGameResultsAsync"in GameSDK.extra))throw new P("submitGameResultsAsync");GameSDK.extra.submitGameResultsAsync(n)}catch(t){console.warn("submitScoreToMSNLeaderboardHandler",t)}return[2]})})()}}]);return Li}(A);c(Li,"SubmitScoreToMSNLeaderboardHandler");var Zs=Li;var Ti=function(x){_inherits(Ti,x);var _super=_create_super(Ti);function Ti(){_class_call_check(this,Ti);return _super.apply(this,arguments)}_create_class(Ti,[{key:"processAsync",value:function processAsync(){var _this=this;return _async_to_generator(function(){var e,t,s,a,n,i,o,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog();e=new S(_this),t=new yt(_this,{useAPI:!1});e.setNext(t);s=new ht(_this);t.setNext(s);a=new xt(_this);s.setNext(a);n=new qt(_this);a.setNext(n);i=new Zs(_this);n.setNext(i);o=new N(_this);i.setNext(o);r=_this.match.getMatchState();return[4,e.processAsync(r)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return Ti}(x);c(Ti,"FinishSingleConcrete");var ta=Ti;var Mi=function(x){_inherits(Mi,x);var _super=_create_super(Mi);function Mi(){_class_call_check(this,Mi);return _super.apply(this,arguments)}_create_class(Mi,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.playerId,s=new S(_this),a=new Dt(_this,{contextId:"SOLO"});s.setNext(a);n=new M(_this,{id:"123456",mode:$.SINGLE,customData:{playerId:t}});a.setNext(n);i=new j(_this);n.setNext(i);o=new it(_this,{profileId:t});i.setNext(o);r=new F(_this);o.setNext(r);l=new N(_this);r.setNext(l);d=_this.match.getMatchState();return[4,s.processAsync(d)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return Mi}(x);c(Mi,"StartSingleConcrete");var ea=Mi;var Wc=y.Plugins,zc=y.Utils,Hc=Wc.Analytics,qc=zc.String,Yc=zc.Valid,Ri=function(A){_inherits(Ri,A);var _super=_create_super(Ri);function Ri(){_class_call_check(this,Ri);return _super.apply(this,arguments)}_create_class(Ri,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ri.prototype),"processAsync",_this)};return _async_to_generator(function(){var t,s,_this_game,a,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e);t=e.mode,s=e.customData;_this1.validateMode(t);_this_game=_this1.game,a=_this_game.analytics,n=s.tournamentId,i=s.leaderboardId;a.event(Hc.Events.TOURNAMENT_START,{success:!0,game_mode:qc.toUpperCamelCase(t),tournament_id:n,leaderboard_id:i});return[4,_this1.nextAsync(e)];case 1:_state.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!Yc.isString(e))throw new jt}}]);return Ri}(A);c(Ri,"LogTournamentStartHandler");var we=Ri;var _i=function(Error1){_inherits(_i,Error1);var _super=_create_super(_i);function _i(e){_class_call_check(this,_i);var _this;_this=_super.call(this,e),_this.name="TournamentIdNotValid",_this.message=e!==null&&e!==void 0?e:"Tournament id is not valid";return _possible_constructor_return(_this)}return _i}(_wrap_native_super(Error));c(_i,"TournamentIdNotValid");var me=_i;var _y_Utils17=y.Utils,sa=_y_Utils17.Valid,$i=function(A){_inherits($i,A);var _super=_create_super($i);function $i(t,s){_class_call_check(this,$i);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class($i,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of($i.prototype),"processAsync",_this)};return _async_to_generator(function(){var _this_payload,s,a,n,i,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t);_this_payload=_this1.payload,s=_this_payload.contextId;_this1.validateContextId(s);return[4,GameSDK.getTournamentAsync()];case 1:a=_state.sent(),n=a.getID().toString();_this1.validateTournamentId(n);i=JSON.parse(a.getPayload()||"{}"),o=i.leaderboardId;_this1.validateLeaderboardId(o),t.customData.contextId=s,t.customData.tournamentId=n,t.customData.leaderboardId=o;return[4,_this1.nextAsync(t)];case 2:_state.sent();return[2]}})})()}},{key:"validateContextId",value:function validateContextId(t){if(!sa.isString(t))throw new B}},{key:"validateTournamentId",value:function validateTournamentId(t){if(!sa.isString(t))throw new me}},{key:"validateLeaderboardId",value:function validateLeaderboardId(t){if(!sa.isString(t)||t==="")throw new pt}}]);return $i}(A);c($i,"ContinueTournamentHandler");var aa=$i;var Gi=function(x){_inherits(Gi,x);var _super=_create_super(Gi);function Gi(){_class_call_check(this,Gi);return _super.apply(this,arguments)}_create_class(Gi,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d,h,f;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.playerId,s=e.contextId,a=new S(_this),n=new aa(_this,{contextId:s});a.setNext(n);i=new M(_this,{id:"1997",mode:$.TOURNAMENT,customData:{playerId:t}});n.setNext(i);o=new j(_this);i.setNext(o);r=new it(_this,{profileId:t});o.setNext(r);l=new F(_this);r.setNext(l);d=new we(_this);l.setNext(d);h=new N(_this);l.setNext(h);f=_this.match.getMatchState();return[4,a.processAsync(f)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return Gi}(x);c(Gi,"ContinueTournamentConcrete");var na=Gi;var Qc=y.Plugins,Xc=Qc.Analytics,Vi=function(A){_inherits(Vi,A);var _super=_create_super(Vi);function Vi(){_class_call_check(this,Vi);return _super.apply(this,arguments)}_create_class(Vi,[{key:"processAsync",value:function processAsync(e){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Vi.prototype),"processAsync",_this)};return _async_to_generator(function(){var t,_this_game,s,a,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,e);t=e.customData,_this_game=_this1.game,s=_this_game.analytics,a=t.tournamentId,n=t.leaderboardId;s.event(Xc.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:a,leaderboard_id:n});return[4,_this1.nextAsync(e)];case 1:_state.sent();return[2]}})})()}}]);return Vi}(A);c(Vi,"LogTournamentCreateHandler");var ia=Vi;var Fi=function(A){_inherits(Fi,A);var _super=_create_super(Fi);function Fi(t,s){_class_call_check(this,Fi);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(Fi,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Fi.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t);return[4,_this1.createTournamentAsync()];case 1:_state.sent();return[4,_this1.updateMatchStateAsync(t)];case 2:_state.sent();return[4,_this1.nextAsync(t)];case 3:_state.sent();return[2]}})})()}},{key:"createTournamentAsync",value:function createTournamentAsync(){var _this=this;return _async_to_generator(function(){var _this_payload,t,s,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_payload=_this.payload,t=_this_payload.name,s=_this_payload.score,a=_this_payload.customData;return[4,GameSDK.tournament.createAsync({initialScore:s,config:{title:t,tournamentTitle:t},data:a})];case 1:_state.sent();return[2]}})})()}},{key:"updateMatchStateAsync",value:function updateMatchStateAsync(t){var _this=this;return _async_to_generator(function(){var _$s,a,n,_this_payload,i,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);if(!("getTournamentAsync"in GameSDK))throw new P("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 1:_$s=_state.sent(),a=_$s.getContextID(),n=_$s.getID().toString(),_this_payload=_this.payload,i=_this_payload.playerId;t.customData.playerId=i,t.customData.contextId=a,t.customData.tournamentId=n;return[3,3];case 2:s=_state.sent();if(_instanceof(s,P))return[2];return[3,3];case 3:return[2]}})})()}}]);return Fi}(A);c(Fi,"CreateTournamentHandler");var oa=Fi;var _y_Utils18=y.Utils,Wo=_y_Utils18.Valid,Ui=function(A){_inherits(Ui,A);var _super=_create_super(Ui);function Ui(t,s){_class_call_check(this,Ui);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");u(_assert_this_initialized(_this),"leaderboardPayload");_this.payload=s;return _this}_create_class(Ui,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ui.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t),_this1.validatePayload();return[4,_this1.setupCreatePayload(t)];case 1:_state.sent();return[4,_this1.createLeaderboardAsync(t)];case 2:_state.sent();return[4,_this1.nextAsync(t)];case 3:_state.sent();return[2]}})})()}},{key:"validatePayload",value:function validatePayload(){var _this_payload=this.payload,t=_this_payload.leaderboardId;if(!Wo.isString(t))throw new pt}},{key:"validatePlayerId",value:function validatePlayerId(t){if(!Wo.isString(t))throw new D}},{key:"setupCreatePayload",value:function setupCreatePayload(t){var _this=this;return _async_to_generator(function(){var _t_customData,s,_this_payload,a,n,i;return _ts_generator(this,function(_state){_t_customData=t.customData,s=_t_customData.playerId;_this.validatePlayerId(s);_this_payload=_this.payload,a=_this_payload.name,n=_this_payload.leaderboardId,i=_this_payload.customData;_this.leaderboardPayload={_id:n,name:a!==null&&a!==void 0?a:"",createdBy:s,description:JSON.stringify(i)};return[2]})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(t){var _this=this;return _async_to_generator(function(){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,_this.game.leaderboard.createLeaderboardAsync(_this.leaderboardPayload)];case 1:s=_state.sent();t.customData.leaderboardId=s;return[2]}})})()}}]);return Ui}(A);c(Ui,"CreateLeaderboardHandler");var ra=Ui;var ki=function(x){_inherits(ki,x);var _super=_create_super(ki);function ki(){_class_call_check(this,ki);return _super.apply(this,arguments)}_create_class(ki,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d,h,f,g,m,I;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.playerId,s=e.name,a=e.score,n=e.leaderboardId,i=e.payload,o=new S(_this),r=new Dt(_this,{contextId:"SOLO"});o.setNext(r);l=new oa(_this,{name:s,score:a,playerId:t,customData:i});r.setNext(l);d=new it(_this,{profileId:t});l.setNext(d);h=new Et(_this,{id:t,score:a});d.setNext(h);f=new ra(_this,{name:s,customData:i,leaderboardId:n});h.setNext(f);g=new Xt(_this);f.setNext(g);m=new ia(_this);g.setNext(m);I=_this.match.getMatchState();return[4,o.processAsync(I)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return ki}(x);c(ki,"CreateTournamentConcrete");var ca=ki;var _y_Plugins=y.Plugins,zo=_y_Plugins.Analytics,_y_Utils19=y.Utils,Jc=_y_Utils19.Valid,Bi=function(A){_inherits(Bi,A);var _super=_create_super(Bi);function Bi(t,s){_class_call_check(this,Bi);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(Bi,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Bi.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t),_this1.validateData(t);return[4,_this1.postScoreTournamentAsync(t)];case 1:_state.sent();return[4,_this1.nextAsync(t)];case 2:_state.sent();return[2]}})})()}},{key:"validateData",value:function validateData(t){var s=t.profiles,a=t.customData,n=a.playerId;if(this.validatePlayerId(n),!s[n])throw new R}},{key:"validatePlayerId",value:function validatePlayerId(t){if(!Jc.isString(t))throw new D}},{key:"getPlayerProfile",value:function getPlayerProfile(t){var s=t.profiles,a=t.customData,n=a.playerId;return this.validatePlayerId(n),s[n]}},{key:"isNewBestScore",value:function isNewBestScore(t){var s=this.getPlayerProfile(t),tmp=s.score,a=tmp===void 0?0:tmp,tmp1=s.bestScore,n=tmp1===void 0?0:tmp1;return a>n}},{key:"postScoreTournamentAsync",value:function postScoreTournamentAsync(t){var _this=this;return _async_to_generator(function(){var _window_game,s,a,tmp,n,i,o,_this_payload,r,l,_tmp,d;return _ts_generator(this,function(_state){switch(_state.label){case 0:_window_game=window.game,s=_window_game.analytics,a=_this.getPlayerProfile(t),tmp=a.score,n=tmp===void 0?0:tmp;i=null,o=!1;_this_payload=_this.payload,r=_this_payload.checkBestScore,l=_this.isNewBestScore(t);_state.label=1;case 1:_state.trys.push([1,7,8,9]);if(!("getTournamentAsync"in GameSDK))throw new P("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 2:_state.sent();if(!(!r||l))return[3,4];i=zo.Events.TOURNAMENT_SHARE;return[4,GameSDK.tournament.shareAsync({score:n})];case 3:_tmp=_state.sent();return[3,6];case 4:i=zo.Events.TOURNAMENT_POST_SCORE;return[4,GameSDK.tournament.postScoreAsync(n)];case 5:_tmp=_state.sent();_state.label=6;case 6:_tmp,o=!0;return[3,9];case 7:d=_state.sent();console.warn("Post Score Tournament",d);return[3,9];case 8:i&&s.event(i,{success:o});return[7];case 9:return[2]}})})()}}]);return Bi}(A);c(Bi,"PostScoreTournamentHandler");var la=Bi;var ji=function(x){_inherits(ji,x);var _super=_create_super(ji);function ji(){_class_call_check(this,ji);return _super.apply(this,arguments)}_create_class(ji,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d,h,f,g;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.playerId,s=e.bestScore,a=new S(_this),n=new yt(_this,{useAPI:!1});a.setNext(n);i=new Et(_this,{id:t,bestScore:s});n.setNext(i);o=new la(_this,{checkBestScore:!1});i.setNext(o);r=new ht(_this);o.setNext(r);l=new xt(_this);r.setNext(l);d=new Xt(_this);l.setNext(d);h=new qt(_this);d.setNext(h);f=new N(_this);h.setNext(f);g=_this.match.getMatchState();return[4,a.processAsync(g)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return ji}(x);c(ji,"FinishTournamentConcrete");var da=ji;var _y_Utils20=y.Utils,ha=_y_Utils20.Valid,Zc=_y_Utils20.Object,Ki=function(A){_inherits(Ki,A);var _super=_create_super(Ki);function Ki(t,s){_class_call_check(this,Ki);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(Ki,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ki.prototype),"processAsync",_this)};return _async_to_generator(function(){var _this_payload,s,a,n,i,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t);_this_payload=_this1.payload,s=_this_payload.tournamentId;_this1.validateTournamentId(s);return[4,_this1.joinTournamentAsync(s)];case 1:_state.sent();return[4,GameSDK.getTournamentAsync()];case 2:a=_state.sent(),n=a.getContextID();_this1.validateContextId(n);i=JSON.parse(a.getPayload()||"{}"),o=i.leaderboardId;_this1.validateLeaderboardId(o),t.customData.contextId=n,t.customData.tournamentId=s,t.customData.leaderboardId=o;return[4,_this1.nextAsync(t)];case 3:_state.sent();return[2]}})})()}},{key:"validateTournamentId",value:function validateTournamentId(t){if(!ha.isString(t))throw new me}},{key:"validateContextId",value:function validateContextId(t){if(!ha.isString(t))throw new B}},{key:"validateLeaderboardId",value:function validateLeaderboardId(t){if(!ha.isString(t)||t==="")throw new pt}},{key:"joinTournamentAsync",value:function joinTournamentAsync(t){return _async_to_generator(function(){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!("tournament"in GameSDK))throw new P("tournament");_state.label=1;case 1:_state.trys.push([1,3,,4]);return[4,GameSDK.tournament.joinAsync(t)];case 2:_state.sent();return[3,4];case 3:s=_state.sent();if(!Zc.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s;return[3,4];case 4:return[2]}})})()}}]);return Ki}(A);c(Ki,"JoinTournamentHandler");var ua=Ki;var Wi=function(x){_inherits(Wi,x);var _super=_create_super(Wi);function Wi(){_class_call_check(this,Wi);return _super.apply(this,arguments)}_create_class(Wi,[{key:"processAsync",value:function processAsync(e){var _this=this;return _async_to_generator(function(){var t,s,a,n,i,o,r,l,d,h,f;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,,2,3]);_this.startLog(e);t=e.playerId,s=e.tournamentId,a=new S(_this),n=new ua(_this,{tournamentId:s});a.setNext(n);i=new M(_this,{id:"1997",mode:$.TOURNAMENT,customData:{playerId:t}});n.setNext(i);o=new j(_this);i.setNext(o);r=new it(_this,{profileId:t});o.setNext(r);l=new F(_this);r.setNext(l);d=new we(_this);l.setNext(d);h=new N(_this);d.setNext(h);f=_this.match.getMatchState();return[4,a.processAsync(f)];case 1:_state.sent();return[3,3];case 2:_this.endLog();return[7];case 3:return[2]}})})()}}]);return Wi}(x);c(Wi,"JoinTournamentConcrete");var pa=Wi;var tl=y.Dtos,el=y.Utils,sl=el.Object,zi=function(A){_inherits(zi,A);var _super=_create_super(zi);function zi(t,s){_class_call_check(this,zi);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"payload");_this.payload=s;return _this}_create_class(zi,[{key:"processAsync",value:function processAsync(t){var _this=this;var _this1=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(zi.prototype),"processAsync",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:_superprop_get_processAsync().call(_this1,t),_this1.updateMatchCustomData(t);return[4,_this1.nextAsync(t)];case 1:_state.sent();return[2]}})})()}},{key:"updateMatchCustomData",value:function updateMatchCustomData(t){var s=sl.merge(t.customData,this.payload),a=new tl.Match.CustomData(s).toObject();t.customData=a}}]);return zi}(A);c(zi,"SetMatchCustomDataHandler");var ya=zi;var al={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:_object_spread({},fs)},Ho=y.Configs,Hi=function(_C_Plugins_BasePlugin){_inherits(Hi,_C_Plugins_BasePlugin);var _super=_create_super(Hi);function Hi(){_class_call_check(this,Hi);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"base");u(_assert_this_initialized(_this),"group");u(_assert_this_initialized(_this),"single");u(_assert_this_initialized(_this),"endless");u(_assert_this_initialized(_this),"context");u(_assert_this_initialized(_this),"challenge");u(_assert_this_initialized(_this),"tournament");u(_assert_this_initialized(_this),"api");u(_assert_this_initialized(_this),"handler");u(_assert_this_initialized(_this),"useCPUProfile");return _this}_create_class(Hi,[{key:"init",value:function init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}},{key:"setUseCPUProfile",value:function setUseCPUProfile(t){this.useCPUProfile=t}},{key:"createMatchData",value:function createMatchData(){var _this_game=this.game,t=_this_game.storage;t.addStorage("match",al)}},{key:"getMatchState",value:function getMatchState(){var _this_game=this.game,t=_this_game.storage;return t.getStorage("match")}},{key:"createBaseConcrete",value:function createBaseConcrete(){this.base=new x(this.game,this)}},{key:"createConcreteFlows",value:function createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}},{key:"createConcreteHandlers",value:function createConcreteHandlers(){var _this=this;var _this1=this;var _this2=this;this.handler={setProfileData:c(function(){var _ref=_async_to_generator(function(t){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=new Et(_this.base,t);return[4,_this.processHandlerAsync(s)];case 1:_state.sent();return[2]}})});return function(t){return _ref.apply(this,arguments)}}(),"setProfileData"),setMatchCustomData:c(function(){var _ref=_async_to_generator(function(t){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=new ya(_this1.base,t);return[4,_this1.processHandlerAsync(s)];case 1:_state.sent();return[2]}})});return function(t){return _ref.apply(this,arguments)}}(),"setMatchCustomData"),setLeaderboardScore:c(function(){var _ref=_async_to_generator(function(t){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=new Pt(_this2.base,t);return[4,_this2.processHandlerAsync(s)];case 1:_state.sent();return[2]}})});return function(t){return _ref.apply(this,arguments)}}(),"setLeaderboardScore")}}},{key:"createAPIHandler",value:function createAPIHandler(){var t={appId:Ho.AppId,matchAPIHost:Ho.ApiHost};this.api=new hs(t)}},{key:"createGroupFlows",value:function createGroupFlows(){this.group={join:new Qs(this.game,this),start:new Js(this.game,this),finish:new Ys(this.game,this)}}},{key:"createSingleFlows",value:function createSingleFlows(){this.single={start:new ea(this.game,this),finish:new ta(this.game,this)}}},{key:"createEndlessFlows",value:function createEndlessFlows(){this.endless={start:new Hs(this.game,this),finish:new Ws(this.game,this)}}},{key:"createContextFlows",value:function createContextFlows(){this.context={choose:new Bs(this.game,this)}}},{key:"createChallengeFlows",value:function createChallengeFlows(){this.challenge={invite:new Ls(this.game,this),friend:new As(this.game,this),join:new Gs(this.game,this),await:new ws(this.game,this),result:new ks(this.game,this),finish:new Ss(this.game,this),continue:new Ps(this.game,this)}}},{key:"createTournamentFlows",value:function createTournamentFlows(){this.tournament={join:new pa(this.game,this),create:new ca(this.game,this),finish:new da(this.game,this),continue:new na(this.game,this)}}},{key:"processHandlerAsync",value:function processHandlerAsync(t){var s=this.getMatchState();return t.processAsync(s)}}]);return Hi}(C.Plugins.BasePlugin);c(Hi,"MatchPlugin");var fa=Hi;var _y_Utils21=y.Utils,ft=_y_Utils21.Valid,gt="is invalid",qi=function(G1){_inherits(qi,G1);var _super=_create_super(qi);function qi(){_class_call_check(this,qi);return _super.apply(this,arguments)}_create_class(qi,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!ft.isNumber(e)||!e)&&this.exception("level",gt)}},{key:"validateRescued",value:function validateRescued(e){(!ft.isNumber(e)||e<0)&&this.exception("rescued",gt)}},{key:"validateContextId",value:function validateContextId(e){ft.isString(e)||this.exception("contextId",gt)}},{key:"validatePlayerId",value:function validatePlayerId(e){ft.isString(e)||this.exception("playerId",gt)}},{key:"validateOpponentId",value:function validateOpponentId(e){ft.isString(e)||this.exception("opponentId",gt)}},{key:"validateTournamentId",value:function validateTournamentId(e){ft.isString(e)||this.exception("tournamentId",gt)}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){ft.isString(e)||this.exception("leaderboardId",gt)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(qi.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return G.getDefaultData()}}]);return qi}(G);c(qi,"MatchCustomDataDtos");var Ae=qi;Ae.addDefaultData(fs);var _y_Utils22=y.Utils,ot=_y_Utils22.Valid,rt="is invalid",Yi=function(G1){_inherits(Yi,G1);var _super=_create_super(Yi);function Yi(){_class_call_check(this,Yi);return _super.apply(this,arguments)}_create_class(Yi,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){(!ot.isString(e)||!e)&&this.exception("id",rt)}},{key:"validateName",value:function validateName(e){(!ot.isString(e)||!e)&&this.exception("name",rt)}},{key:"validatePhoto",value:function validatePhoto(e){ot.isString(e)||this.exception("photo",rt)}},{key:"validateScore",value:function validateScore(e){(!ot.isNumber(e)||e<0)&&this.exception("score",rt)}},{key:"validateBestScore",value:function validateBestScore(e){(!ot.isNumber(e)||e<0)&&this.exception("bestScore",rt)}},{key:"validateEndlessScore",value:function validateEndlessScore(e){(!ot.isNumber(e)||e<0)&&this.exception("endlessScore",rt)}},{key:"validateBestEndlessScore",value:function validateBestEndlessScore(e){(!ot.isNumber(e)||e<0)&&this.exception("bestEndlessScore",rt)}},{key:"validateFinished",value:function validateFinished(e){ot.isBoolean(e)||this.exception("finished",rt)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Yi.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return G.getDefaultData()}}]);return Yi}(G);c(Yi,"MatchProfileDtos");var Ie=Yi;Ie.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0}),y.Dtos.Match={Data:Qt,CustomData:Ae,Profile:Ie};var nl=y.Utils,_y_Configs2=y.Configs,il=_y_Configs2.ApiHost,ol=c(function(){var _ref=_async_to_generator(function(p){var e;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,V("players",p,{},il,10)];case 1:e=_state.sent();return[2,nl.Object.hasOwn(e,"data")?e.data||{}:{}]}})});return function(p){return _ref.apply(this,arguments)}}(),"updatePlayerProfileAsync"),rl=y.Utils,cl=y.Configs,ll=cl.AppId,dl=rl.Array,De=rl.Object,hl=rl.Valid,Qi=function(_C_Plugins_BasePlugin){_inherits(Qi,_C_Plugins_BasePlugin);var _super=_create_super(Qi);function Qi(){_class_call_check(this,Qi);return _super.apply(this,arguments)}_create_class(Qi,[{key:"init",value:function init(){var _this_game=this.game,e=_this_game.storage;e.addStorage("player",wt)}},{key:"saveToCloud",value:function saveToCloud(){var _this=this;return _async_to_generator(function(){var _$e,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);_$e=_this.getPlayerData();return[4,GameSDK.player.setDataAsync(_$e)];case 1:_state.sent();return[3,3];case 2:e=_state.sent();console.warn(e);return[3,3];case 3:return[2]}})})()}},{key:"receiveData",value:function receiveData(e,t){var _this_game=this.game,s=_this_game.storage,a=e.playerId,n=e.name,i=e.photo,o=e.locale;s.setStorageData("player","playerId",a),s.setStorageData("player","name",n),s.setStorageData("player","photo",i),s.setStorageData("player","locale",o),t&&this.setPlayerData(t)}},{key:"syncProfileToServer",value:function syncProfileToServer(){var _this=this;return _async_to_generator(function(){var _this_game,e,t,s,a,n,i,o,_ref,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,e=_this_game.storage,t=_this.getPlayer(),s=t.playerId,a=t.name,n=t.photo,i=t.locale;o=_this.getPlayerASID();_tmp=!hl.isString(o)&&"getASIDAsync"in GameSDK.player;if(!_tmp)return[3,2];return[4,GameSDK.player.getASIDAsync()];case 1:_tmp=(o=(_ref=_state.sent())!==null&&_ref!==void 0?_ref:o,e.setStorageData("player","ASID","".concat(o)));_state.label=2;case 2:_tmp;return[4,ol({appId:ll,ASID:o,playerId:s,name:a,photo:n,locale:i})];case 3:_state.sent();return[2]}})})()}},{key:"setPlayerDataByName",value:function setPlayerDataByName(e,t){this.setPlayerData(_define_property({},e,t))}},{key:"setPlayerData",value:function setPlayerData(e){var _this_game=this.game,t=_this_game.storage;t.setStorageData("player","data",e),this.saveToCloud()}},{key:"setBestScore",value:function setBestScore(e){this.setPlayerDataByName("score",e)}},{key:"setBestEndlessScore",value:function setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}},{key:"setSetting",value:function setSetting(e,t){this.setPlayerDataByName("settings",_define_property({},e,t))}},{key:"setGameData",value:function setGameData(e){var _this_getGameData;var t=(_this_getGameData=this.getGameData())!==null&&_this_getGameData!==void 0?_this_getGameData:{},s=De.merge(t,e);this.setPlayerDataByName("gameData",s)}},{key:"requestConnectedPlayers",value:function requestConnectedPlayers(){var _this=this;return _async_to_generator(function(){var _this_game,e,s,a,n;return _ts_generator(this,function(_state){switch(_state.label){case 0:_this_game=_this.game,e=_this_game.storage;return[4,GameSDK.player.getConnectedPlayersAsync()];case 1:s=_state.sent().map(function(i){var o=i.getID(),r=i.getName(),l=i.getPhoto();return!o||!r||!l?null:new mt({playerId:o,name:r,photo:l}).toObject()}),a=dl.unique(s);if(a.length<1)return[2];n=De.keyBy(a,"playerId");e.setStorageData("player","connectedPlayers",n);return[2]}})})()}},{key:"getPlayer",value:function getPlayer(){var _this_game=this.game,e=_this_game.storage;return e.getStorage("player")}},{key:"getPlayerId",value:function getPlayerId(){var _this_game=this.game,e=_this_game.storage;return e.getStorageData("player","playerId")}},{key:"getPlayerASID",value:function getPlayerASID(){var _this_game=this.game,e=_this_game.storage;return e.getStorageData("player","ASID")}},{key:"getPlayerLocale",value:function getPlayerLocale(){var _this_game=this.game,e=_this_game.storage;return e.getStorageData("player","locale")}},{key:"getPlayerData",value:function getPlayerData(){var _this_game=this.game,e=_this_game.storage;return e.getStorageData("player","data")}},{key:"getPlayerDataByKey",value:function getPlayerDataByKey(e){var t=this.getPlayerData();return De.hasOwn(t,e)?t[e]:null}},{key:"getGameData",value:function getGameData(){return this.getPlayerDataByKey("gameData")}},{key:"getPlayerSetting",value:function getPlayerSetting(e){var t=this.getPlayerSettings();return De.hasOwn(t,e)?t[e]:null}},{key:"getPlayerSettings",value:function getPlayerSettings(){var _this_getPlayerData=this.getPlayerData(),e=_this_getPlayerData.settings;return e}},{key:"isFirstLogin",value:function isFirstLogin(){var _this_getPlayerDataByKey;return(_this_getPlayerDataByKey=this.getPlayerDataByKey("isFirstLogin"))!==null&&_this_getPlayerDataByKey!==void 0?_this_getPlayerDataByKey:wt.data.isFirstLogin}},{key:"loggedIn",value:function loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}},{key:"getBestScore",value:function getBestScore(){var _this_getPlayerData=this.getPlayerData(),e=_this_getPlayerData.score;return e}},{key:"getBestEndlessScore",value:function getBestEndlessScore(){var _this_getPlayerData=this.getPlayerData(),e=_this_getPlayerData.endlessScore;return e}},{key:"getConnectedPlayers",value:function getConnectedPlayers(){var _this_game=this.game,e=_this_game.storage;return e.getStorageData("player","connectedPlayers")}},{key:"getConnectedPlayerIds",value:function getConnectedPlayerIds(e,t){var s=this.getConnectedPlayers();return Object.keys(s).slice(t,t+e)}}]);return Qi}(C.Plugins.BasePlugin);c(Qi,"PlayerPlugin");var ga=Qi;var qo=y.Dtos,ul=y.Utils,St=ul.Valid,_wt_data=wt.data,Yo=_wt_data.score,pl=_wt_data.endlessScore,yl=_wt_data.settings,fl=_wt_data.gameData,gl=_wt_data.isFirstLogin,wl=_wt_data.dailyRewarded,vt="is invalid",Xi=function(G){_inherits(Xi,G);var _super=_create_super(Xi);function Xi(){_class_call_check(this,Xi);return _super.apply(this,arguments)}_create_class(Xi,[{key:"processData",value:function processData(e){this.validateStructure(e),e.settings=new qo.Player.Settings(e.settings).toObject(),e.gameData=new qo.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}},{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateScore",value:function validateScore(e){(!St.isNumber(e)||e<0)&&this.exception("score",vt)}},{key:"validateEndlessScore",value:function validateEndlessScore(e){(!St.isNumber(e)||Yo<0)&&this.exception("endlessScore",vt)}},{key:"validateSettings",value:function validateSettings(e){St.isObject(e)||this.exception("settings",vt)}},{key:"validateGameData",value:function validateGameData(e){St.isObject(e)||this.exception("gameData",vt)}},{key:"validateIsFirstLogin",value:function validateIsFirstLogin(e){St.isBoolean(e)||this.exception("isFirstLogin",vt)}},{key:"validateDailyRewarded",value:function validateDailyRewarded(e){St.isObject(e)||this.exception("dailyRewarded",vt)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Xi.prototype),"toObject",this).call(this)}}]);return Xi}(G);c(Xi,"PlayerDataDtos");var Pe=Xi;Pe.addDefaultData({score:Yo,endlessScore:pl,settings:yl,gameData:fl,isFirstLogin:gl,dailyRewarded:wl});var _y_Utils23=y.Utils,Qo=_y_Utils23.Valid,_wt_data_gameData=wt.data.gameData,ml=_wt_data_gameData.level,Al=_wt_data_gameData.coins,Ji=function(G){_inherits(Ji,G);var _super=_create_super(Ji);function Ji(){_class_call_check(this,Ji);return _super.apply(this,arguments)}_create_class(Ji,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!Qo.isNumber(e)||e<0)&&this.exception("level","is invalid")}},{key:"validateCoins",value:function validateCoins(e){(!Qo.isNumber(e)||e<0)&&this.exception("coins","is invalid")}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ji.prototype),"toObject",this).call(this)}}]);return Ji}(G);c(Ji,"PlayerGameDataDtos");var xe=Ji;xe.addDefaultData({level:ml,coins:Al});var _y_Utils24=y.Utils,Ee=_y_Utils24.Valid,_wt_data_settings=wt.data.settings,Il=_wt_data_settings.sound,Dl=_wt_data_settings.music,Pl=_wt_data_settings.vibrate,xl=_wt_data_settings.language,Se="is invalid",Zi=function(G){_inherits(Zi,G);var _super=_create_super(Zi);function Zi(){_class_call_check(this,Zi);return _super.apply(this,arguments)}_create_class(Zi,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateSound",value:function validateSound(e){Ee.isBoolean(e)||this.exception("sound",Se)}},{key:"validateMusic",value:function validateMusic(e){Ee.isBoolean(e)||this.exception("music",Se)}},{key:"validateVibrate",value:function validateVibrate(e){Ee.isBoolean(e)||this.exception("vibrate",Se)}},{key:"validateLanguage",value:function validateLanguage(e){(!Ee.isString(e)||!e)&&this.exception("language",Se)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Zi.prototype),"toObject",this).call(this)}}]);return Zi}(G);c(Zi,"PlayerSettingsDtos");var ve=Zi;ve.addDefaultData({sound:Il,music:Dl,vibrate:Pl,language:xl}),y.Dtos.Player={Info:mt,Data:Pe,Settings:ve,GameData:xe};var El=y.Configs,Sl=y.Utils,vl=Sl.Object,bl=Sl.String,Nl=El.ApiHost,Cl=El.Mockup,to=function(){function to(){_class_call_check(this,to);u(this,"mockAPI")}_create_class(to,[{key:"initMockAPI",value:function initMockAPI(){var _this=this;return _async_to_generator(function(){var e;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(_this.mockAPI)return[2];return[4,st(_async_to_generator(function(){var _ref,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.resolve().then(function(){return kt})];case 1:_ref=_state.sent(),t=_ref.default;return[2,{default:t}]}})}),void 0,b.meta.url)];case 1:e=_state.sent().default;if(typeof e!="function")throw new Error("Cannot load ProfileAPIMock");_this.mockAPI=new e;return[2]}})})()}},{key:"getPlayersAsync",value:function getPlayersAsync(e){var _this=this;return _async_to_generator(function(){var t,s,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=bl.params(e);if(!Cl.Profile.Enabled)return[3,3];return[4,_this.initMockAPI()];case 1:_state.sent();return[4,_this.mockAPI.getPlayersAsync(e)];case 2:_tmp=s=_state.sent();return[3,5];case 3:return[4,At("players?".concat(t),{},Nl)];case 4:_tmp=s=_state.sent();_state.label=5;case 5:return[2,(_tmp,!vl.hasOwn(s,"data")||!Array.isArray(s.data)?[]:s.data)]}})})()}}]);return to}();c(to,"ProfileAPI");var wa=to;var Ol={profiles:{},profileIds:[]},Ll=y.Utils,Tl=y.Dtos,Ml=Ll.Array,Rl=Ll.Valid,_l=Ll.Object,eo=function(_C_Plugins_BasePlugin){_inherits(eo,_C_Plugins_BasePlugin);var _super=_create_super(eo);function eo(){_class_call_check(this,eo);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"profileAPI",new wa);return _this}_create_class(eo,[{key:"init",value:function init(){var _this_game=this.game,t=_this_game.storage;t.addStorage("profile",Ol)}},{key:"requestProfiles",value:function requestProfiles(t){var _this=this;return _async_to_generator(function(){var s,a,n,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:s=_this.getProfileIds(),a=Ml.difference(t,s);if(a.length<1)return[2];return[4,_this.profileAPI.getPlayersAsync({playerIds:a})];case 1:n=_state.sent();if(!_this.validateProfilesResponse(n))return[2];i=_this.convertToProfiles(n);_this.setProfiles(i);return[2]}})})()}},{key:"getProfile",value:function getProfile(t){var _this_getProfiles_t;return(_this_getProfiles_t=this.getProfiles()[t])!==null&&_this_getProfiles_t!==void 0?_this_getProfiles_t:null}},{key:"getProfiles",value:function getProfiles(){var _this_game=this.game,t=_this_game.storage;return t.getStorageData("profile","profiles")}},{key:"setProfiles",value:function setProfiles(t){var _this_game=this.game,s=_this_game.storage;s.setStorageData("profile","profiles",t),s.setStorageData("profile","profileIds",Object.keys(t))}},{key:"getProfileIds",value:function getProfileIds(){var _this_game=this.game,t=_this_game.storage;return t.getStorageData("profile","profileIds")}},{key:"validateProfilesResponse",value:function validateProfilesResponse(t){return!(!Array.isArray(t)||t.length<1)}},{key:"convertToProfiles",value:function convertToProfiles(t){var s={};return t.forEach(function(a){_l.hasOwn(a,"playerId")&&Rl.isString(a.playerId)&&(s[a.playerId]=new Tl.Player.Info(a).toObject())}),s}}]);return eo}(C.Plugins.BasePlugin);c(eo,"ProfilePlugin");var ma=eo;var Xo=y.Utils,so=function(_C_Plugins_BasePlugin){_inherits(so,_C_Plugins_BasePlugin);var _super=_create_super(so);function so(t){_class_call_check(this,so);var _this;_this=_super.call(this,t);u(_assert_this_initialized(_this),"storages");_this.storages={};return _this}_create_class(so,[{key:"addStorage",value:function addStorage(t,s){console.info("addStorage",t,s),this.storages[t]=s}},{key:"setStorageData",value:function setStorageData(t,s,a){var n;if(Xo.Valid.isObject(a)){var i=this.getStorageData(t,s);n=Xo.Object.merge(i,a)}else n=a;this.storages[t][s]=n}},{key:"getStorageData",value:function getStorageData(t,s){return this.getStorage(t)[s]}},{key:"getStorage",value:function getStorage(t){return this.storages[t]}}]);return so}(C.Plugins.BasePlugin);c(so,"StoragePlugin");var Aa=so;var ao=function(_C_Plugins_BasePlugin){_inherits(ao,_C_Plugins_BasePlugin);var _super=_create_super(ao);function ao(){_class_call_check(this,ao);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"isVisible",!0);u(_assert_this_initialized(_this),"browserPrefixes",["moz","ms","o","","webkit"]);u(_assert_this_initialized(_this),"handleVisibilityChange",c(function(t){if(["focus","blur"].indexOf(t)>-1)return t==="focus"?_this.onVisibleEvent():_this.onHiddenEvent();var a=_this.getBrowserPrefix();return _this.getHiddenPropertyName(a) in document?_this.onHiddenEvent():_this.onVisibleEvent()},"handleVisibilityChange"));return _this}_create_class(ao,[{key:"init",value:function init(){var _this=this;var t=this.getBrowserPrefix();[this.getVisibilityEvent(t),"focus","blur"].forEach(function(n){window.addEventListener(n,function(){_this.handleVisibilityChange(n)},!1),document.addEventListener(n,function(){_this.handleVisibilityChange(n)},!1)})}},{key:"isGameVisible",value:function isGameVisible(){return this.isVisible}},{key:"getHiddenPropertyName",value:function getHiddenPropertyName(t){return t?t+"Hidden":"hidden"}},{key:"getVisibilityEvent",value:function getVisibilityEvent(t){return(t||"")+"visibilitychange"}},{key:"getBrowserPrefix",value:function getBrowserPrefix(){var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;try{for(var _iterator=this.browserPrefixes[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var t=_step.value;if(this.getHiddenPropertyName(t) in document)return t}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return""}},{key:"onVisibleEvent",value:function onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(y.Events.VISIBILITY_VISIBLE))}},{key:"onHiddenEvent",value:function onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(y.Events.VISIBILITY_HIDDEN))}}]);return ao}(C.Plugins.BasePlugin);c(ao,"VisibilityPlugin");var Ia=ao;var no=function(xo){_inherits(no,xo);var _super=_create_super(no);function no(){_class_call_check(this,no);return _super.apply(this,arguments)}_create_class(no,[{key:"loadAsync",value:function loadAsync(){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){_this.exception("Unsupported method");return[2]})})()}},{key:"showAsync",value:function showAsync(){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){_this.exception("This method is not implemented");return[2]})})()}},{key:"hideAsync",value:function hideAsync(){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){_this.exception("This method is not implemented");return[2]})})()}}]);return no}(xo);c(no,"BannerInstance");var Da=no;var _y_Plugins_Ads=y.Plugins.Ads,Jo=_y_Plugins_Ads.Status,io=function(Da){_inherits(io,Da);var _super=_create_super(io);function io(){_class_call_check(this,io);return _super.apply(this,arguments)}_create_class(io,[{key:"showAsync",value:function showAsync(){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,GameSDK.loadBannerAdAsync(_this.placementId)];case 1:_state.sent(),_this.status=Jo.SHOWING;return[2]}})})()}},{key:"hideAsync",value:function hideAsync(){var _this=this;return _async_to_generator(function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,GameSDK.hideBannerAdAsync(_this.placementId)];case 1:_state.sent(),_this.status=Jo.IDLE;return[2]}})})()}}]);return io}(Da);c(io,"BannerAdInstance");var Pa=io;var _y_Utils25=y.Utils,$l=_y_Utils25.Object,_y_Plugins_Ads1=y.Plugins.Ads,Y=_y_Plugins_Ads1.Status,bt=_y_Plugins_Ads1.Types,be=_y_Plugins_Ads1.AdError,Gl=_y_Plugins_Ads1.AdInstance,oo=function(Gl){_inherits(oo,Gl);var _super=_create_super(oo);function oo(t,s){_class_call_check(this,oo);var _this;_this=_super.call(this,t,s);u(_assert_this_initialized(_this),"instance");u(_assert_this_initialized(_this),"instanceLoadFailedQueue",[]);_this.instance=null;return _this}_create_class(oo,[{key:"loadAsync",value:function loadAsync(){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(console.info("AdInstance","loadAsync called",{type:_this.type,status:_this.status}),_this.status!==Y.IDLE)throw new be("AD_NOT_READY","Ad is not ready.");_state.label=1;case 1:_state.trys.push([1,4,,5]);return[4,_this.createInstanceByType(_this.type)];case 2:if(_this.instance=_state.sent(),_this.instance===null)throw new be("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");_this.status=Y.LOADING;return[4,_this.instance.loadAsync()];case 3:_state.sent(),_this.status=Y.FILLED,console.info("AdInstance","loadAsync success",{type:_this.type,status:_this.status}),_this.type===bt.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(),_this.type===bt.REWARDED_VIDEO&&self.game.analytics.loadRewardedVideoAd();return[3,5];case 4:t=_state.sent();throw console.warn("AdInstance","loadAsync failed",{type:_this.type,status:_this.status,error:t}),_this.status=Y.IDLE,_instanceof(t,Object)&&"code"in t&&t.code==="INVALID_PARAM"&&(_this.instance=null),_this.instance&&_this.instanceLoadFailedQueue.push(_this.instance),self.game.analytics.loadAdFail(_this.type),t;case 5:return[2]}})})()}},{key:"showAsync",value:function showAsync(){var _this=this;return _async_to_generator(function(){var t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(console.info("AdInstance","showAsync called",{type:_this.type,status:_this.status}),_this.status!==Y.FILLED)throw new be("AD_NOT_FILLED","Ad is not filled.");if(_this.instance===null)throw new be("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");t=!1;_state.label=1;case 1:_state.trys.push([1,3,4,5]);_this.status=Y.SHOWING;return[4,_this.instance.showAsync()];case 2:_state.sent(),t=!0,_this.status=Y.IDLE,_this.instance=null,console.info("AdInstance","showAsync success",{type:_this.type,status:_this.status});return[3,5];case 3:s=_state.sent();throw console.warn("AdInstance","showAsync failed",{type:_this.type,status:_this.status,error:s}),_this.status=Y.FILLED,y.Utils.Object.hasOwn(s,"code")&&(s.code==="AD_NOT_LOADED"&&(_this.status=Y.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf("".concat(s.code))>-1&&(_this.status=Y.IDLE,_this.instance=null),s.code==="USER_INPUT"&&(t=!0)),s;case 4:t?(_this.type===bt.INTERSTITIAL&&self.game.analytics.showInterstitialAd(),_this.type===bt.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd()):self.game.analytics.showAdFail(_this.type);return[7];case 5:return[2]}})})()}},{key:"createInstanceByType",value:function createInstanceByType(t){var _this=this;return _async_to_generator(function(){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,7,,8]);switch(t){case bt.REWARDED_VIDEO:return[3,1];case bt.INTERSTITIAL:return[3,3]}return[3,5];case 1:return[4,GameSDK.getRewardedVideoAsync(_this.placementId)];case 2:return[2,_state.sent()];case 3:return[4,GameSDK.getInterstitialAdAsync(_this.placementId)];case 4:return[2,_state.sent()];case 5:return[2,null];case 6:return[3,8];case 7:s=_state.sent();if(!$l.hasOwn(s,"code"))throw s;return[2,s.code==="ADS_TOO_MANY_INSTANCES"?_this.getAdInstanceFailed():null];case 8:return[2]}})})()}},{key:"getAdInstanceFailed",value:function getAdInstanceFailed(){var _this_instanceLoadFailedQueue=this.instanceLoadFailedQueue,t=_this_instanceLoadFailedQueue.length,s=Math.floor(Math.random()*t);return this.instanceLoadFailedQueue[s]||null}}]);return oo}(Gl);c(oo,"NormalAdInstance");var Ne=oo;var _y_Plugins_Analytics=y.Plugins.Analytics,Vl=_y_Plugins_Analytics.BaseAnalytics,Zo=_y_Plugins_Analytics.Events,Fl=[Zo.BUTTON_CLICK,Zo.SCREEN_OPEN],ro=function(Vl){_inherits(ro,Vl);var _super=_create_super(ro);function ro(t,s){_class_call_check(this,ro);var _this;_this=_super.call(this,t,"FacebookAnalytics",_object_spread_props(_object_spread({},s),{color:"#0F52BA"}));u(_assert_this_initialized(_this),"prefix");_this.prefix=s.prefix;return _this}_create_class(ro,[{key:"processEvent",value:function processEvent(t,s){if(!("logEvent"in GameSDK.extra)||Fl.indexOf(t)>-1)return;var a=this.addPrefixToEventName(t);GameSDK.extra.logEvent(a,1,s)}},{key:"addPrefixToEventName",value:function addPrefixToEventName(t){return"".concat(this.prefix,"_").concat(t)}}]);return ro}(Vl);c(ro,"FacebookAnalytics");var xa=ro;var _y_Plugins_Analytics1=y.Plugins.Analytics,Ul=_y_Plugins_Analytics1.BaseAnalytics,kl=_y_Plugins_Analytics1.Events,Bl=[kl.SCREEN_OPEN],co=function(Ul){_inherits(co,Ul);var _super=_create_super(co);function co(e,t){_class_call_check(this,co);return _super.call(this,e,"FirebaseAnalytics",_object_spread_props(_object_spread({},t),{color:"#FFCA28"}))}_create_class(co,[{key:"setUser",value:function setUser(e,t){var s;(s=this.game.firebase.services.analytics)==null||s.setUser(e,t)}},{key:"processEvent",value:function processEvent(e,t){var s;Bl.indexOf(e)>=0||(s=this.game.firebase.services.analytics)==null||s.event(e,t)}}]);return co}(Ul);c(co,"FirebaseAnalytics");var Ea=co;var _y_Plugins_Analytics2=y.Plugins.Analytics,jl=_y_Plugins_Analytics2.BaseAnalytics,Kl=_y_Plugins_Analytics2.Events,Wl=[Kl.SCREEN_OPEN],lo=function(jl){_inherits(lo,jl);var _super=_create_super(lo);function lo(e,t){_class_call_check(this,lo);return _super.call(this,e,"GoogleAnalytics",_object_spread_props(_object_spread({},t),{color:"#E35335"}))}_create_class(lo,[{key:"processEvent",value:function processEvent(e,t){Wl.indexOf(e)>=0||gtag("event",e,t)}}]);return lo}(jl);c(lo,"GoogleAnalytics");var Sa=lo;var zl="production",va="57",Hl=y.Dtos,Nt=y.Events,O=y.Configs,ql=y.Utils,tr=ql.Object,Jt=ql.Json,er=ql.String,sr=ql.Valid,v=ql.Mark,ho=function(_C_Game){_inherits(ho,_C_Game);var _super=_create_super(ho);function ho(){_class_call_check(this,ho);var _this;_this=_super.call.apply(_super,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(_this),"markName","Core Initialize");u(_assert_this_initialized(_this),"modulePlugins",[]);u(_assert_this_initialized(_this),"handleProtectGameInstance",c(function(){var t=_this.event.getEventEmitCount(at.MODULE_PLUGIN_READY),s=_this.modulePlugins.length;t<s||(window.game=Object.freeze(window.game))},"handleProtectGameInstance"));u(_assert_this_initialized(_this),"initMonitorErrorPlugin",c(function(){if(!_this.monitorError)return;var _O_Debugger=O.Debugger,t=_O_Debugger.MonitorError,s=t.ApiKey,a=t.Service,n=t.TrackUser,i=t.FilterErrors,o=t.ListPlayerDevIds,r=GameSDK.player.getID(),l=GameSDK.player.getName();r&&o.indexOf(r)>-1||(_this.monitorError.configure({apiKey:s,service:a,trackUser:n,releaseStage:zl,buildVersion:"".concat(va)}),_this.monitorError.setUser({id:r,name:l}),_this.monitorError.addFilterErrors(i),_this.updateMonitorErrorUserAndMetadata(),_this.processErrorsQueue())},"initMonitorErrorPlugin"));u(_assert_this_initialized(_this),"updateMonitorErrorUserAndMetadata",c(function(){if(!(_this.event.getEventEmitCount(Nt.PLAYER_INFO_LOADED)>0)){_this.event.once(Nt.PLAYER_INFO_LOADED,_this.processWhenPlayerInfoLoaded);return}_this.processWhenPlayerInfoLoaded()},"updateMonitorErrorUserAndMetadata"));u(_assert_this_initialized(_this),"processErrorsQueue",c(function(){window.__errorQueue&&(window.__errorQueue.forEach(function(t){if(_this.monitorError)if(_instanceof(t,Error))_this.monitorError.sendException(t);else{var _ref=t||{message:"",code:"Unknown",stack:"Unknown stack"},s=_ref.message,a=_ref.code,n=_ref.stack,i=new Error(s||a);i.stack=n,_this.monitorError.sendException(i)}}),window.__errorQueue=null)},"processErrorsQueue"));u(_assert_this_initialized(_this),"processWhenPlayerInfoLoaded",c(function(){var a,n;var _this_player_getPlayer=_this.player.getPlayer(),t=_this_player_getPlayer.playerId,s=_this_player_getPlayer.name;(a=_this.monitorError)==null||a.setUser({id:t,name:s}),(n=_this.monitorError)==null||n.addMetadata({isFirstLogin:_this.player.isFirstLogin()})},"processWhenPlayerInfoLoaded"));u(_assert_this_initialized(_this),"handleSaveRemoteConfig",c(function(t){try{var _$s=_define_property({},t.type,t);_this.player.setPlayerDataByName("remoteConfig",_$s)}catch(s){console.warn("handleSaveGameCoreConfig",s)}},"handleSaveRemoteConfig"));u(_assert_this_initialized(_this),"handleUpdateGameCoreConfig",c(function(t){try{var _$s=t.id,a=t.type;if(a!=="GameCore")return;y.Configs=tr.merge(y.Configs,t.config);var _y_Configs=y.Configs,n=_y_Configs.Ads;_this.ads.configure(n),_this.event.emit(at.REMOTE_CONFIG_UPDATED,{id:_$s,type:a})}catch(s){console.warn("handleUpdateGameCoreConfig",s)}},"handleUpdateGameCoreConfig"));u(_assert_this_initialized(_this),"handleStorageCurrentRemoteConfig",c(function(){var t=_this.player.getPlayerDataByKey("remoteConfig");if(console.info("playerRemoteConfig",Jt.clone(t)),!!t){for(var s in t)if(tr.hasOwn(t,s)){var a=t[s],n=Jt.clone(a);console.log("newRemoteConfig",n);var i=new Hl.RemoteConfig.Data(n).toObject();console.info("remoteConfigValid",i),_this.remoteConfig.setRemoteConfig(i),_this.remoteConfig.processUpdateConfig(i.id,i.type)}}},"handleStorageCurrentRemoteConfig"));u(_assert_this_initialized(_this),"initAdaptivePerformancePlugin",c(function(){if(!_this.adaptivePerformance)return;var t=Jt.clone(O.AdaptivePerformance);_this.adaptivePerformance.configure(t)},"initAdaptivePerformancePlugin"));u(_assert_this_initialized(_this),"processAfterSyncProfile",c(function(){var t=O.Notification;t.Enabled&&_this.updatePlayerProfileToNotificationService()},"processAfterSyncProfile"));return _this}_create_class(ho,[{key:"getBuildVersion",value:function getBuildVersion(){return parseInt("".concat(va))}},{key:"boot",value:function boot(){var _this=this;var _this1=this,_superprop_get_boot=function(){return _get(_get_prototype_of(ho.prototype),"boot",_this)};return _async_to_generator(function(){return _ts_generator(this,function(_state){console.groupCollapsed("\uD83E\uDDEC GameCore Boot"),_superprop_get_boot().call(_this1),_this1.addPlugins(),_this1.initEventPlugin(),_this1.event.emit(Nt.CORE_BOOTING),_this1.initFirebasePlugin(),_this1.initMarkCoreInitialize(),v.putAttr(_this1.markName,"Step","Init Plugins"),_this1.initAds(),_this1.initMatchPlugin(),_this1.initRemoteConfig(),v.putAttr(_this1.markName,"Step","Load Lazy Plugins"),sr.isDebugger()||_this1.event.on(Nt.MODULE_PLUGIN_READY,_this1.handleProtectGameInstance),_this1.addMonitorPlugin().then(_this1.initMonitorErrorPlugin),_this1.addAdaptivePerformancePlugin().then(_this1.initAdaptivePerformancePlugin),v.putAttr(_this1.markName,"Step","Load Dev Plugins"),_this1.addDevPlugins().then(function(){_this1.initConsolePlugin(),_this1.initProfilerPlugin(),_this1.initCanvasRecorderPlugin()});return[2]})})()}},{key:"start",value:function start(){var _this=this;var _this1=this,_superprop_get_start=function(){return _get(_get_prototype_of(ho.prototype),"start",_this)};return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:console.groupEnd(),console.groupCollapsed("\uD83E\uDDEC GameCore Start"),_superprop_get_start().call(_this1),v.putAttr(_this1.markName,"Step","Core Start"),_this1.event.emit(Nt.CORE_STARTING),v.putAttr(_this1.markName,"Step","Request Token");return[4,_this1.auth.requestToken()];case 1:_state.sent(),v.putAttr(_this1.markName,"Step","Init States");return[4,_this1.initState()];case 2:_state.sent(),v.putAttr(_this1.markName,"Step","Process Player Profile"),_this1.processPlayerProfile(),v.putAttr(_this1.markName,"Step","Process Context Payload");return[4,_this1.context.detectContextSessionType()];case 3:_state.sent(),_this1.context.detectContextGameMode();t=_this1.storage.getStorageData("context","sessionContextType");v.putAttr(_this1.markName,"Context Mode",t),v.putAttr(_this1.markName,"Step","Init Analytics"),_this1.initGoogleAnalytics(),_this1.initFirebaseAnalytics(),_this1.initFacebookAnalytics(),v.putAttr(_this1.markName,"Step","Core Ready"),v.putAttr(_this1.markName,"Success","true"),v.stop(_this1.markName),_this1.event.emit(Nt.CORE_READY);return[2]}})})()}},{key:"addPlugins",value:function addPlugins(){this.installPlugin("Storage",Aa),this.installPlugin("Event",Ze),this.installPlugin("Ads",Ve),this.installPlugin("Auth",je),this.installPlugin("Audio",Be),this.installPlugin("Match",fa),this.installPlugin("Player",ga),this.installPlugin("Profile",ma),this.installPlugin("Context",He),this.installPlugin("Language",os),this.installPlugin("Analytics",Fe),this.installPlugin("Visibility",Ia),this.installPlugin("Leaderboard",cs),this.installPlugin("DailyRewards",Xe),this.installPlugin("FrameCapture",is),this.installPlugin("RemoteConfig",ts),"Proxy"in window&&this.installPlugin("Firebase",ts)}},{key:"installPlugin",value:function installPlugin(t,s){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;var n=er.toCamelCase(er.capitalize(t));this.plugins.install(t,s,!0,n),t!=="Storage"&&(a?this.emitModulePluginReady(t):this.emitCorePluginReady(t))}},{key:"addMonitorPlugin",value:function addMonitorPlugin(){var _this=this;return _async_to_generator(function(){var _O_Debugger,t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:_O_Debugger=O.Debugger,t=_O_Debugger.MonitorError;if(!t.Enabled)return[2];_this.modulePlugins.push("MonitorError");return[4,st(_async_to_generator(function(){var _ref,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.resolve().then(function(){return kt})];case 1:_ref=_state.sent(),a=_ref.default;return[2,{default:a}]}})}),void 0,b.meta.url)];case 1:s=_state.sent().default;typeof s=="function"&&_this.installPlugin("MonitorError",s,!0);return[2]}})})()}},{key:"addAdaptivePerformancePlugin",value:function addAdaptivePerformancePlugin(){var _this=this;return _async_to_generator(function(){var t,s;return _ts_generator(this,function(_state){switch(_state.label){case 0:t=O.AdaptivePerformance;if(!t.Enabled)return[2];_this.modulePlugins.push("AdaptivePerformance");return[4,st(_async_to_generator(function(){var _ref,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,b.import("./bundle/index.js")];case 1:_ref=_state.sent(),a=_ref.default;return[2,{default:a}]}})}),void 0,b.meta.url)];case 1:s=_state.sent().default;typeof s=="function"&&_this.installPlugin("AdaptivePerformance",s,!0);return[2]}})})()}},{key:"addDevPlugins",value:function addDevPlugins(){var _this=this;return _async_to_generator(function(){var _O_Debugger,t,s,a,n,n1,n2;return _ts_generator(this,function(_state){switch(_state.label){case 0:if(!sr.isDebugger())return[2];_O_Debugger=O.Debugger,t=_O_Debugger.ShowConsole,s=_O_Debugger.ShowProfiler,a=_O_Debugger.CanvasRecorder;if(!t)return[3,2];_this.modulePlugins.push("Console");return[4,st(_async_to_generator(function(){var _ref,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,b.import("./bundle/console.js")];case 1:_ref=_state.sent(),i=_ref.default;return[2,{default:i}]}})}),void 0,b.meta.url)];case 1:n=_state.sent().default;typeof n=="function"&&_this.installPlugin("Console",n,!0);_state.label=2;case 2:if(!s)return[3,4];_this.modulePlugins.push("Profiler");return[4,st(_async_to_generator(function(){var _ref,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.resolve().then(function(){return kt})];case 1:_ref=_state.sent(),i=_ref.default;return[2,{default:i}]}})}),void 0,b.meta.url)];case 3:n1=_state.sent().default;typeof n1=="function"&&_this.installPlugin("Profiler",n1,!0);_state.label=4;case 4:if(!a.Enabled)return[3,6];_this.modulePlugins.push("CanvasRecorder");return[4,st(_async_to_generator(function(){var _ref,i;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,Promise.resolve().then(function(){return kt})];case 1:_ref=_state.sent(),i=_ref.default;return[2,{default:i}]}})}),void 0,b.meta.url)];case 5:n2=_state.sent().default;typeof n2=="function"&&_this.installPlugin("CanvasRecorder",n2,!0);_state.label=6;case 6:return[2]}})})()}},{key:"emitCorePluginReady",value:function emitCorePluginReady(t){this.event.emit(at.CORE_PLUGIN_READY,{name:t})}},{key:"emitModulePluginReady",value:function emitModulePluginReady(t){this.event.emit(at.MODULE_PLUGIN_READY,{name:t})}},{key:"initEventPlugin",value:function initEventPlugin(){var _O_Debugger=O.Debugger,t=_O_Debugger.EventLogging;t&&this.event.enableLogEvent()}},{key:"initMatchPlugin",value:function initMatchPlugin(){this.match.setUseCPUProfile(!1)}},{key:"initAds",value:function initAds(){var _y_Plugins=y.Plugins,t=_y_Plugins.Ads;this.ads.configure(O.Ads),this.initAdInstance(t,O)}},{key:"initAdInstance",value:function initAdInstance(t,s){var _this=this;var _s_Ads=s.Ads,a=_s_Ads.InterstitialAdOptions,n=_s_Ads.RewardedVideoAdOptions,i=_s_Ads.BannerDisplayAdOptions;a.forEach(function(o){_this.ads.setAdInstance(t.Types.INTERSTITIAL,o.PlacementId,Ne)}),n.forEach(function(o){_this.ads.setAdInstance(t.Types.REWARDED_VIDEO,o.PlacementId,Ne)}),i.forEach(function(o){_this.ads.setAdInstance(t.Types.BANNER,o.PlacementId,Pa)})}},{key:"initState",value:function initState(){var _this=this;return _async_to_generator(function(){var _$t,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);_$t=new Me(_this);_$t.initContext();return[4,_$t.initPlayer()];case 1:_state.sent();return[3,3];case 2:t=_state.sent();console.error("StateInitiator",t);return[3,3];case 3:return[2]}})})()}},{key:"initConsolePlugin",value:function initConsolePlugin(){this.console&&this.console.configure()}},{key:"initProfilerPlugin",value:function initProfilerPlugin(){this.profiler&&this.profiler.configure()}},{key:"initCanvasRecorderPlugin",value:function initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;var _O_Debugger=O.Debugger,t=_O_Debugger.CanvasRecorder,_t_Options=t.Options,s=_t_Options.Type,a=_t_Options.Quality,n=_t_Options.RecordFps,i=_t_Options.SyncFps;this.canvasRecorder.configure({type:s,quality:a,syncFps:i,recordFps:n});var o=document.querySelector("canvas");if(!o)return console.error("Canvas not found");this.canvasRecorder.setCanvas(o)}},{key:"initRemoteConfig",value:function initRemoteConfig(){var t=O.RemoteConfig;if(!t.Enabled)return;var s=Jt.clone(t);this.remoteConfig.configure(s),this.event.on(at.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(at.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.once(at.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}},{key:"initFirebasePlugin",value:function initFirebasePlugin(){var t=O.Firebase;if(!t.Enabled||!this.firebase)return;var s=Jt.clone(t);this.firebase.configure(s),v.setService(this.firebase.services.performance)}},{key:"initMarkCoreInitialize",value:function initMarkCoreInitialize(){O.PerformanceMonitor.CoreFlows&&(v.measure(this.markName),v.putAttr(this.markName,"Build","".concat(va)),v.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),v.putAttr(this.markName,"Platform",GameSDK.getPlatform()),v.putAttr(this.markName,"Success","false"),v.start(this.markName))}},{key:"processPlayerProfile",value:function processPlayerProfile(){var _this=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,_this.player.syncProfileToServer()];case 1:_state.sent(),_this.processAfterSyncProfile();return[3,3];case 2:t=_state.sent();console.warn("processPlayerProfile fail",t);return[3,3];case 3:return[2]}})})()}},{key:"updatePlayerProfileToNotificationService",value:function updatePlayerProfileToNotificationService(){var _this=this;return _async_to_generator(function(){var _$t,s,a,n,i,o,r,t;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);_$t=O.AppId,s=_this.player.getPlayer(),a=s.ASID,n=s.playerId,i=s.name,o=s.photo,r=s.locale;return[4,mr({appId:_$t,ASID:a,playerId:n,name:i,photo:o,locale:r})];case 1:_state.sent();return[3,3];case 2:t=_state.sent();console.warn("updatePlayerProfileToNotificationService",t);return[3,3];case 3:return[2]}})})()}},{key:"initGoogleAnalytics",value:function initGoogleAnalytics(){var _O_Analytics_GoogleAnalytics;var _ref=(_O_Analytics_GoogleAnalytics=O.Analytics.GoogleAnalytics)!==null&&_O_Analytics_GoogleAnalytics!==void 0?_O_Analytics_GoogleAnalytics:{},t=_ref.Enabled,s=_ref.ConsoleLog;t&&this.analytics.add(new Sa(this.game,{log:!!s}))}},{key:"initFirebaseAnalytics",value:function initFirebaseAnalytics(){var _O_Analytics_FirebaseAnalytics;var _ref=(_O_Analytics_FirebaseAnalytics=O.Analytics.FirebaseAnalytics)!==null&&_O_Analytics_FirebaseAnalytics!==void 0?_O_Analytics_FirebaseAnalytics:{},t=_ref.Enabled,s=_ref.ConsoleLog;if(!t)return;var a=new Ea(this.game,{log:!!s}),n=this.player.getPlayer(),i=n.ASID,o=n.playerId,r=n.locale;a.setUser(o,{ASID:i,locale:r}),this.analytics.add(a)}},{key:"initFacebookAnalytics",value:function initFacebookAnalytics(){var _O_Analytics_FacebookAnalytics;var _ref=(_O_Analytics_FacebookAnalytics=O.Analytics.FacebookAnalytics)!==null&&_O_Analytics_FacebookAnalytics!==void 0?_O_Analytics_FacebookAnalytics:{},t=_ref.Enabled,s=_ref.Prefix,a=_ref.ConsoleLog;if(t){if(typeof s!="string"){console.warn("Facebook Analytics is not configured");return}this.analytics.add(new xa(this.game,{prefix:s,log:!!a}))}}}]);return ho}(C.Game);c(ho,"MagicGame");var ba=ho;var Yl=y.Configs,Ql=y.Utils,Na=y.Events,Xl=Ql.Device,_Yl_GameEngine=Yl.GameEngine,Ce=_Yl_GameEngine.ForceDesktopDPR,Jl=c(_async_to_generator(function(){var p,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:try{gtag("event","app_initialize")}catch(t){console.warn("gtag init",t)}p=new ba;window.game=p;e=20;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e),window.__gameCoreStart=!0;return[4,p.boot()];case 1:_state.sent(),p.event.once(Na.REQUEST_CORE_START,ar),Zl(p);return[2]}})}),"initGame"),ar=c(function(){if(!window.__sdkInitiated){game.event.once(Na.GAME_SDK_READY,ar);return}window.game.start(),console.warn("Game started");var p=25;window.__sdkLoadingCount<p&&(window.__sdkLoadingCount=p)},"startGame"),Zl=c(function(p){var t=setInterval(function(){if(!window.__sdkInitiated)return;clearInterval(t);var s=10;window.__sdkLoadingCount<s&&(window.__sdkLoadingCount=s),p.event.emit(Na.GAME_SDK_READY)},5)},"waitGameSDK");Ce!==!1&&Xl.isDesktop()&&typeof Ce=="number"&&Ce>0&&(window.devicePixelRatio=Ce),Jl()},"execute")}});