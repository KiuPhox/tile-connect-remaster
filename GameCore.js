function _array_like_to_array(e,t){if(null==t||t>e.length)t=e.length;for(var r=0,l=new Array(t);r<t;r++)l[r]=e[r];return l}function _array_with_holes(e){if(Array.isArray(e))return e}function _array_without_holes(e){if(Array.isArray(e))return _array_like_to_array(e)}function _assert_this_initialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function asyncGeneratorStep(e,t,r,l,_,d,h){try{var y=e[d](h);var p=y.value}catch(e){r(e);return}if(y.done)t(p);else Promise.resolve(p).then(l,_)}function _async_to_generator(e){return function(){var t=this,r=arguments;return new Promise(function(l,_){var d=e.apply(t,r);function _next(e){asyncGeneratorStep(d,l,_,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(d,l,_,_next,_throw,"throw",e)}_next(void 0)})}}function _class_call_check(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _construct(){_construct=_is_native_reflect_construct()?Reflect.construct:function construct(e,t,r){var l=[null];l.push.apply(l,t);var _=Function.bind.apply(e,l);var d=new _;if(r)_set_prototype_of(d,r.prototype);return d};return _construct.apply(null,arguments)}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||false;l.configurable=true;if("value"in l)l.writable=true;Object.defineProperty(e,l.key,l)}}function _create_class(e,t,r){if(t)_defineProperties(e.prototype,t);if(r)_defineProperties(e,r);return e}function _define_property(e,t,r){if(t in e)Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true});else e[t]=r;return e}function _get(e,t,r){_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function get(e,t,r){var l=_super_prop_base(e,t);if(!l)return;var _=Object.getOwnPropertyDescriptor(l,t);if(_.get)return _.get.call(r||e);return _.value};return _get(e,t,r||e)}function _get_prototype_of(e){_get_prototype_of=Object.setPrototypeOf?Object.getPrototypeOf:function getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)};return _get_prototype_of(e)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:true,configurable:true}});if(t)_set_prototype_of(e,t)}function _instanceof(e,t){if(null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance])return!!t[Symbol.hasInstance](e);return e instanceof t}function _is_native_function(e){return -1!==Function.toString.call(e).indexOf("[native code]")}function _iterable_to_array(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterable_to_array_limit(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==r)return;var l=[];var _=true;var d=false;var h,y;try{for(r=r.call(e);!(_=(h=r.next()).done);_=true){l.push(h.value);if(t&&l.length===t)break}}catch(e){d=true;y=e}finally{try{if(!_&&null!=r.return)r.return()}finally{if(d)throw y}}return l}function _non_iterable_rest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _object_spread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};var l=Object.keys(r);if("function"==typeof Object.getOwnPropertySymbols)l=l.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}));l.forEach(function(t){_define_property(e,t,r[t])})}return e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);if(t)l=l.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable});r.push.apply(r,l)}return r}function _object_spread_props(e,t){t=null!=t?t:{};if(Object.getOwnPropertyDescriptors)Object.defineProperties(e,Object.getOwnPropertyDescriptors(t));else ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))});return e}function _object_without_properties(e,t){if(null==e)return{};var r=_object_without_properties_loose(e,t);var l,_;if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);for(_=0;_<d.length;_++){l=d[_];if(!(t.indexOf(l)>=0)){if(!!Object.prototype.propertyIsEnumerable.call(e,l))r[l]=e[l]}}}return r}function _object_without_properties_loose(e,t){if(null==e)return{};var r={};var l=Object.keys(e);var _,d;for(d=0;d<l.length;d++){_=l[d];if(!(t.indexOf(_)>=0))r[_]=e[_]}return r}function _possible_constructor_return(e,t){if(t&&("object"===_type_of(t)||"function"==typeof t))return t;return _assert_this_initialized(e)}function _set_prototype_of(e,t){_set_prototype_of=Object.setPrototypeOf||function setPrototypeOf(e,t){e.__proto__=t;return e};return _set_prototype_of(e,t)}function _sliced_to_array(e,t){return _array_with_holes(e)||_iterable_to_array_limit(e,t)||_unsupported_iterable_to_array(e,t)||_non_iterable_rest()}function _super_prop_base(e,t){while(!Object.prototype.hasOwnProperty.call(e,t)){e=_get_prototype_of(e);if(null===e)break}return e}function _to_consumable_array(e){return _array_without_holes(e)||_iterable_to_array(e)||_unsupported_iterable_to_array(e)||_non_iterable_spread()}function _type_of(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function _unsupported_iterable_to_array(e,t){if(!e)return;if("string"==typeof e)return _array_like_to_array(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor)r=e.constructor.name;if("Map"===r||"Set"===r)return Array.from(r);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _array_like_to_array(e,t)}function _wrap_native_super(e){var t="function"==typeof Map?new Map:void 0;_wrap_native_super=function wrapNativeSuper(e){if(null===e||!_is_native_function(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,Wrapper)}function Wrapper(){return _construct(e,arguments,_get_prototype_of(this).constructor)}Wrapper.prototype=Object.create(e.prototype,{constructor:{value:Wrapper,enumerable:false,writable:true,configurable:true}});return _set_prototype_of(Wrapper,e)};return _wrap_native_super(e)}function _is_native_reflect_construct(){if("undefined"==typeof Reflect||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if("function"==typeof Proxy)return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true}catch(e){return false}}function _create_super(e){var t=_is_native_reflect_construct();return function _createSuperInternal(){var r=_get_prototype_of(e),l;if(t){var _=_get_prototype_of(this).constructor;l=Reflect.construct(r,arguments,_)}else l=r.apply(this,arguments);return _possible_constructor_return(this,l)}}function _ts_generator(e,t){var r,l,_,d,h={label:0,sent:function(){if(1&_[0])throw _[1];return _[1]},trys:[],ops:[]};return d={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(d[Symbol.iterator]=function(){return this}),d;function verb(e){return function(t){return step([e,t])}}function step(d){if(r)throw new TypeError("Generator is already executing.");while(h)try{if(r=1,l&&(_=2&d[0]?l.return:d[0]?l.throw||((_=l.return)&&_.call(l),0):l.next)&&!(_=_.call(l,d[1])).done)return _;if(l=0,_)d=[2&d[0],_.value];switch(d[0]){case 0:case 1:_=d;break;case 4:h.label++;return{value:d[1],done:false};case 5:h.label++;l=d[1];d=[0];continue;case 7:d=h.ops.pop();h.trys.pop();continue;default:if(_=h.trys,!(_=_.length>0&&_[_.length-1])&&(6===d[0]||2===d[0])){h=0;continue}if(3===d[0]&&(!_||d[1]>_[0]&&d[1]<_[3])){h.label=d[1];break}if(6===d[0]&&h.label<_[1]){h.label=_[1];_=d;break}if(_&&h.label<_[2]){h.label=_[2];h.ops.push(d);break}if(_[2])h.ops.pop();h.trys.pop();continue}d=t.call(e,h)}catch(e){d=[6,e];l=0}finally{r=_=0}if(5&d[0])throw d[1];return{value:d[0]?d[1]:void 0,done:true}}}var nr=Object.defineProperty;var td=function(e,t,r){return t in e?nr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r};var c=function(e,t){return nr(e,"name",{value:t,configurable:!0})};var u=function(e,t,r){return td(e,(void 0===t?"undefined":_type_of(t))!="symbol"?t+"":t,r)};System.register(["./bundle/core.js","./bundle/__commonjsHelpers__.js"],function(e,t){"use strict";var r,l,_,d,h,y,p;return{setters:[function(e){r=e.G,l=e.P,_=e.M,d=e._,h=e.a,y=e.C},function(e){p=e.g}],execute:c(function(){var e,f,v;var g=r.Utils,m=g.Valid,A=g.Object,w=g.String,I=g.Json,b="is invalid",k=function(){function z(e){_class_call_check(this,z);this.defaultData(),this.processData(e)}_create_class(z,[{key:"processData",value:function processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}},{key:"defaultData",value:function defaultData(){var e=this.constructor,t=e.name;this.lazyDefaultData(z.data[t])}},{key:"lazyDefaultData",value:function lazyDefaultData(e){m.isObject(e)||this.exception("data",b);for(var t in e)if(A.hasOwn(e,t)){var r=e[t];A.assign(this,_define_property({},t,r))}}},{key:"lazyValidateStructure",value:function lazyValidateStructure(e){var t=this;m.isObject(e)||this.exception("structure","is not object"),this.getKeys().forEach(function(r){var l=t[r];void 0===l&&t.exception("structure","has no key ".concat(r)),A.hasOwn(e,r)||void 0===l||t.setDefaultData(r,e)})}},{key:"setDefaultData",value:function setDefaultData(e,t){m.isObject(t)||this.exception("data",b);var r=this[e];void 0===r&&this.exception("default","has no key ".concat(e)),A.assign(t,_define_property({},e,r))}},{key:"lazyValidateData",value:function lazyValidateData(e){var t=this;this.getKeys().forEach(function(r){var l=e[r],_=w.removeDiacritics(r).replace(/[^a-zA-Z0-9]/g,""),d="validate".concat(w.capitalize(_)),h=t[d];if("function"==typeof h)try{h.call(t,l)}catch(l){console.warn(l),t.setDefaultData(r,e)}else t.exception("validate","has no function ".concat(d))})}},{key:"lazySetupData",value:function lazySetupData(e){var t=this;this.getKeys().forEach(function(r){var l=e[r];A.assign(t,_define_property({},r,l))})}},{key:"validate",value:function validate(){this.validateData(this.toObject())}},{key:"exception",value:function exception(e,t){throw new Error("".concat(this.constructor.name,": ").concat(e," ").concat(t))}},{key:"toObject",value:function toObject(){return Object.fromEntries(Object.entries(this).filter(function(e){var t=_sliced_to_array(e,1),r=t[0];return"toObject"!==r}))}},{key:"getKeys",value:function getKeys(){return Object.keys(this).filter(function(e){return"toObject"!==e})}}],[{key:"addDefaultData",value:function addDefaultData(e){m.isObject(e)||this.prototype.exception("default data",b),e=I.clone(e);var t=this,r=t.name;m.isObject(z.data[r])||(z.data[r]={}),z.data[r]=A.merge(z.data[r],e),console.info("".concat(r," default data:"),z.data[r])}},{key:"getDefaultData",value:function getDefaultData(){var e=this,t=e.name;return I.clone(z.data[t])}},{key:"addValidateFunction",value:function addValidateFunction(e,t){m.isString(e)||this.prototype.exception("validate key",b),"function"!=typeof t&&this.prototype.exception("validate function",b);var r="validate".concat(w.capitalize(e));A.assign(this.prototype,_define_property({},r,t))}}]);return z}();c(k,"BaseDtos"),u(k,"data",{});var S=k;r.Dtos={Base:S};var D={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded"},P={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0}},E=r.Utils,C=E.Valid,x=P.playerId,M=P.name,N=P.photo,L=P.locale,O="is invalid",T=function(e){_inherits(Ca,e);var t=_create_super(Ca);function Ca(){_class_call_check(this,Ca);return t.apply(this,arguments)}_create_class(Ca,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){C.isString(e)&&e||this.exception("_id",O)}},{key:"validatePlayerId",value:function validatePlayerId(e){C.isString(e)&&e||this.exception("playerId",O)}},{key:"validateName",value:function validateName(e){C.isString(e)&&e||this.exception("name",O)}},{key:"validatePhoto",value:function validatePhoto(e){C.isString(e)||this.exception("photo",O)}},{key:"validateLocale",value:function validateLocale(e){C.isString(e)&&e||this.exception("locale",O)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ca.prototype),"toObject",this).call(this)}}]);return Ca}(S);c(T,"PlayerInfoDtos");var R=T;R.addDefaultData({playerId:x,name:M,photo:N,locale:L});var F=new R({playerId:"10",name:"Your Friend"}).toObject(),G=function(e){_inherits(Oa,e);var t=_create_super(Oa);function Oa(e){_class_call_check(this,Oa);var r;r=t.call(this,e);u(_assert_this_initialized(r),"code");r.code="CREATE_MATCH_FAILED";return r}return Oa}(_wrap_native_super(Error));c(G,"ACreateMatchFailed");var V=G;var j=function(e){_inherits(La,e);var t=_create_super(La);function La(e){_class_call_check(this,La);var r;r=t.call(this,e),r.name="PlayerIdNotValid",r.message=null!=e?e:"Player id is not valid";return _possible_constructor_return(r)}return La}(V);c(j,"PlayerIdNotValid");var B=j;var H=r.Dtos,U=r.Utils,K=r.Events,W=U.Array,q=U.Object,J=U.Json,Y=U.Valid,Ta=function Ta(e){var t=this;_class_call_check(this,Ta);u(this,"game");u(this,"initContext",c(function(){var e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},r=new H.Context.Info(e),l=r.toObject(),_=l.contextId,d=l.contextType,h=l.entryPointData;t.game.context.receiveContext(_,d,h)},"initContext"));var r=this;u(this,"initPlayer",c(_async_to_generator(function(){var e,t,l,_,d,h;return _ts_generator(this,function(y){switch(y.label){case 0:e=r.game,t=e.player,l=r.getPlayerInfo();console.info("playerInfo",J.clone(l));_=W.unique(q.vals(D));console.info("dataKeys",_);return[4,GameSDK.player.getDataAsync(_)];case 1:d=y.sent();console.info("rawData",J.clone(d));h=new H.Player.Data(d).toObject();console.info("playerData",J.clone(h)),t.receiveData(l,h),r.game.event.emit(K.PLAYER_INFO_LOADED);return[2]}})}),"initPlayer"));u(this,"getPlayerInfo",c(function(){try{var e=GameSDK.player.getID();var t=GameSDK.player.getName();var r=GameSDK.player.getPhoto(),l=GameSDK.getLocale();if(!Y.isString(e))throw new B;return Y.isString(t)||(t="You"),new H.Player.Info({playerId:e,name:t,photo:r,locale:l}).toObject()}catch(e){return F}},"getPlayerInfo"));this.game=e};c(Ta,"StateInitiator");var Q=Ta;var X=function(e){_inherits(Ma,e);var t=_create_super(Ma);function Ma(e,r){_class_call_check(this,Ma);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.name="BadRequest",l.message=null!=e?e:"This request is bad",l.payload=r;return l}return Ma}(_wrap_native_super(Error));c(X,"BadRequest");var $=X;var Z=function(e){_inherits(Ra,e);var t=_create_super(Ra);function Ra(e,r){_class_call_check(this,Ra);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.name="RequestTimeout",l.message=null!=e?e:"This request is timeout",l.payload=r;return l}return Ra}(_wrap_native_super(Error));c(Z,"RequestTimeout");var ee=Z;var et=r.Utils,ea=r.Configs,er=ea.AppId,es=ea.Network,ec=c(function(e){if(!e.ok)throw new $(void 0,{response:e})},"validateResponse"),el=c(function(){var e=window.game.auth.getToken();return{token:e,timeout:es.Timeout,headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}}},"defaultConfig"),eu=c(function(e,t,l,_){return _async_to_generator(function(){var d,h,y,p,f;return _ts_generator(this,function(v){switch(v.label){case 0:v.trys.push([0,3,,4]);if(!er)throw new $("AppId is not defined");d="".concat(e,"/apps/").concat(er,"/").concat(t),h=new AbortController;l.signal=h.signal;y=setTimeout(function(){h.abort()},l.timeout);r.Utils.Valid.isObject(_)&&(l.body=JSON.stringify(_));return[4,fetch(d,l)];case 1:p=v.sent();clearTimeout(y),ec(p);return[4,p.json()];case 2:return[2,v.sent()||{}];case 3:f=v.sent();if(_instanceof(f,$))return[2,null];throw _instanceof(f,Object)&&"name"in f&&"AbortError"===f.name?new ee:f;case 4:return[2]}})})},"requester"),e_=c(function(){var e=_async_to_generator(function(e,t){var r;return _ts_generator(this,function(l){switch(l.label){case 0:l.trys.push([0,1,,7]);return[2,e()];case 1:r=l.sent();if(!(_instanceof(r,ee)&&t>0))return[3,6];l.label=2;case 2:l.trys.push([2,5,,6]);return[4,et.Time.sleepAsync(600)];case 3:l.sent();return[4,e_(e,t-1)];case 4:return[2,l.sent()];case 5:l.sent();return[2,{}];case 6:return[2,_instanceof(r,ee)?{}:(console.warn("Request error",r),{})];case 7:return[2]}})});return function(t,r){return e.apply(this,arguments)}}(),"handleRequest"),ed=c(function(){var e=_async_to_generator(function(e){var t,r,l,_,d,h;var y=arguments;return _ts_generator(this,function(p){switch(p.label){case 0:t=y.length>1&&void 0!==y[1]?y[1]:{},r=y.length>2?y[2]:void 0,l=y.length>3&&void 0!==y[3]?y[3]:es.Retries;p.label=1;case 1:p.trys.push([1,3,,4]);_=_object_spread_props(_object_spread({},el(),t),{method:"GET"}),d=eu(r,e,_);return[4,e_(d,l)];case 2:return[2,p.sent()];case 3:h=p.sent();return[2,(console.warn("Get error",h),{})];case 4:return[2]}})});return function(t){return e.apply(this,arguments)}}(),"get"),eh=c(function(){var e=_async_to_generator(function(e,t){var r,l,_,d,h,y;var p=arguments;return _ts_generator(this,function(f){switch(f.label){case 0:r=p.length>2&&void 0!==p[2]?p[2]:{},l=p.length>3?p[3]:void 0,_=p.length>4&&void 0!==p[4]?p[4]:es.Retries;f.label=1;case 1:f.trys.push([1,3,,4]);d=_object_spread_props(_object_spread({},el(),r),{method:"POST"}),h=eu(l,e,d,t);return[4,e_(h,_)];case 2:return[2,f.sent()];case 3:y=f.sent();return[2,(console.warn("Post error",y),{})];case 4:return[2]}})});return function(t,r){return e.apply(this,arguments)}}(),"post"),ey=r.Configs.Notification,ep=ey.ApiUrl,ef=c(function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(l){switch(l.label){case 0:if(!r.Utils.Object.hasOwn(e,"playerId"))throw new Error("Missing playerId");t=e.playerId;return[4,eh("players/".concat(t),e,{},ep,10)];case 1:l.sent();return[2]}})});return function(t){return e.apply(this,arguments)}}(),"updatePlayerProfileNotificationAsync");var ev=function(e){return e.IDLE="idle",e.LOADING="loading",e.FILLED="filled",e.SHOWING="showing",e}(ev||{});var eg=ev;var em=function(e){return e.BANNER="banner",e.INTERSTITIAL="interstitial",e.REWARDED_VIDEO="rewarded_video",e}(em||{});var eA=em;var ew=(e=function(e){_inherits(Ct,e);var t=_create_super(Ct);function Ct(e,r){_class_call_check(this,Ct);var l;l=t.call(this,r);u(_assert_this_initialized(l),"code");l.code=e,l.message=r;return l}return Ct}(_wrap_native_super(Error)),c(e,"AdError"),e);var eI=function(){function _a(e,t){_class_call_check(this,_a);u(this,"type");u(this,"status");u(this,"placementId");this.type=e,this.status=eg.IDLE,this.placementId=t}_create_class(_a,[{key:"getStatus",value:function getStatus(){return this.status}},{key:"exception",value:function exception(e){throw new ew("AD_INSTANCE_ERROR",e)}}]);return _a}();c(eI,"BaseInstance");var eb=eI,ek=(f=function(e){_inherits(Ot,e);var t=_create_super(Ot);function Ot(){_class_call_check(this,Ot);return t.apply(this,arguments)}_create_class(Ot,[{key:"loadAsync",value:function loadAsync(){this.exception("This method is not implemented")}},{key:"showAsync",value:function showAsync(){this.exception("This method is not implemented")}},{key:"hideAsync",value:function hideAsync(){this.exception("Unsupported method")}}]);return Ot}(eb),c(f,"AdInstance"),f);r.Plugins.Ads={Types:eA,Status:eg,AdError:ew,AdInstance:ek};var eS=r.Utils,eD=eS.Array,eP=eS.Object,eE=function(e){_inherits($a,e);var t=_create_super($a);function $a(){_class_call_check(this,$a);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"enabled");u(_assert_this_initialized(e),"config");u(_assert_this_initialized(e),"lastCallAdShownTime");u(_assert_this_initialized(e),"isAdFullSizeShowed");u(_assert_this_initialized(e),"ads",{});u(_assert_this_initialized(e),"safeAreaBottom");return e}_create_class($a,[{key:"init",value:function init(){this.lastCallAdShownTime=0,this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}},{key:"calculateSafeAreaBottom",value:function calculateSafeAreaBottom(){try{var e=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(e,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch(e){this.safeAreaBottom=0}}},{key:"configure",value:function configure(e){this.config=e,this.enabled=this.config.Enabled}},{key:"checkEnabled",value:function checkEnabled(){if(!this.enabled)throw new ew("ADS_NOT_ENABLED","Ads is't enabled")}},{key:"isAdFullSizeShowing",value:function isAdFullSizeShowing(){return this.isAdFullSizeShowed}},{key:"setAdInstance",value:function setAdInstance(e,t,r){if(this.ads[t]){console.warn("AdsPlugin: Ad instance with placementId ".concat(t," already exists"));return}this.ads[t]={type:e,placementId:t,interval:null,instance:new r(e,t)}}},{key:"preloadInterstitialAdAsync",value:function preloadInterstitialAdAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,e.loadAdAsync(eA.INTERSTITIAL)];case 1:t.sent();return[2]}})})()}},{key:"showInterstitialAdAsync",value:function showInterstitialAdAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:if(!e.canbeShowInterstitialAd())throw new ew("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");return[4,e.showAdAsync(eA.INTERSTITIAL)];case 1:t.sent();return[2]}})})()}},{key:"preloadRewardedVideoAsync",value:function preloadRewardedVideoAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,e.loadAdAsync(eA.REWARDED_VIDEO)];case 1:t.sent();return[2]}})})()}},{key:"showRewardedVideoAsync",value:function showRewardedVideoAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,e.showAdAsync(eA.REWARDED_VIDEO)];case 1:t.sent();return[2]}})})()}},{key:"loadAdAsync",value:function loadAdAsync(e,t){var r=this;return _async_to_generator(function(){return _ts_generator(this,function(l){switch(l.label){case 0:r.checkEnabled();return[4,r.getAd(e,t).instance.loadAsync()];case 1:l.sent();return[2]}})})()}},{key:"showAdAsync",value:function showAdAsync(e,t){var l=this;return _async_to_generator(function(){var _,d,h;return _ts_generator(this,function(y){switch(y.label){case 0:l.checkEnabled();_=l.game,d=_.event,h=l.getAd(e,t);l.lastCallAdShownTime=window.performance.now()/1e3;y.label=1;case 1:y.trys.push([1,,3,4]);d.emit(r.Events.AD_SHOWING,{placementId:t}),l.isAdFullSizeShowed=!0;return[4,h.instance.showAsync()];case 2:y.sent();return[3,4];case 3:d.emit(r.Events.AD_CLOSED,{placementId:t}),l.isAdFullSizeShowed=!1;return[7];case 4:return[2]}})})()}},{key:"getAdStatus",value:function getAdStatus(e,t){return this.checkEnabled(),this.getAd(e,t).instance.getStatus()}},{key:"getAd",value:function getAd(e,t){var r=null;if(t?r=this.getAdByPlacementId(t):r=this.getPriorityAdByType(e),!r)throw new ew("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return r}},{key:"getAdsByType",value:function getAdsByType(e){return eP.vals(this.ads).filter(function(t){return t.type===e})}},{key:"getAdByPlacementId",value:function getAdByPlacementId(e){var t=this.ads[e];return t||null}},{key:"getPriorityAdByType",value:function getPriorityAdByType(e){var t=this.getAdsByType(e);if(!t.length)return null;var r=eD.search(t,function(t){return t.type===e});return r||null}},{key:"canbeShowInterstitialAd",value:function canbeShowInterstitialAd(e){return this.canbeShowInterstitialAdByTime(e)}},{key:"canbeShowInterstitialAdByTime",value:function canbeShowInterstitialAdByTime(e){try{var t=window.performance.now()/1e3;var r;if(e)r=this.getCommonAdConfig(e);else{var l=this.getPriorityAdByType(eA.INTERSTITIAL);if(!l)return!1;r=this.getCommonAdConfig(l.placementId)}var _=r.SecondsBetweenAds,d=r.SecondsFirstTime,h=t-this.lastCallAdShownTime,y=h>_,p=h>d;return this.lastCallAdShownTime>0?y:p}catch(e){return console.warn("Error while checking canbeShowInterstitialAdByTime",e),!1}}},{key:"canbeShowBannerAd",value:function canbeShowBannerAd(e){try{var t=this.getBannerConfig(e),r=t.Platform;if("ALL"===r)return!0;var l=GameSDK.getPlatform();return!!l&&l===r}catch(e){return console.warn("Error while checking canbeShowBannerAd",e),!1}}},{key:"showBannerAdAsync",value:function showBannerAdAsync(e){var t=this;return _async_to_generator(function(){var l,_,d,h,y;return _ts_generator(this,function(p){switch(p.label){case 0:t.checkEnabled();l=t.getAd(eA.BANNER,e);if(!t.canbeShowBannerAd(l.placementId))throw new Error("Banner ad can not be shown");t.cleanBannerReloadTimer(l.placementId);return[4,l.instance.showAsync()];case 1:p.sent();_=t.game,d=_.event;d.emit(r.Events.AD_SHOWING,{placementId:e});h=t.getBannerConfig(l.placementId),y=h.SecondsReload;y<=0||(l.interval=setTimeout(function(){t.showBannerAdAsync(l.placementId)},1e3*y));return[2]}})})()}},{key:"hideBannerAdAsync",value:function hideBannerAdAsync(e){var t=this;return _async_to_generator(function(){var l,_,d;return _ts_generator(this,function(h){switch(h.label){case 0:t.checkEnabled();l=t.getAd(eA.BANNER,e);t.cleanBannerReloadTimer(l.placementId);return[4,l.instance.hideAsync()];case 1:h.sent();_=t.game,d=_.event;d.emit(r.Events.AD_CLOSED,{placementId:e});return[2]}})})()}},{key:"cleanBannerReloadTimer",value:function cleanBannerReloadTimer(e){try{var t=this.getAd(eA.BANNER,e),r=t.interval;if(!r)return;clearInterval(r)}catch(e){console.warn("Error while cleaning banner reload timer",e)}}},{key:"getCommonAdConfig",value:function getCommonAdConfig(e){var t=_to_consumable_array(this.config.InterstitialAdOptions).concat(_to_consumable_array(this.config.RewardedVideoAdOptions)),r=eD.search(t,function(t){return t.PlacementId===e});if(!r)throw new Error("Ad config with placementId ".concat(e," not found"));return r}},{key:"getBannerConfig",value:function getBannerConfig(e){var t=eD.search(this.config.BannerDisplayAdOptions,function(t){return t.PlacementId===e});if(!t)throw new Error("Banner config with placementId ".concat(e," not found"));return t}},{key:"getBannerHeight",value:function getBannerHeight(e,t,r){var l=!(arguments.length>2)||void 0===r||r;this.checkEnabled();var _=this.getBannerConfig(e),d=GameSDK.getBannerHeight(_);return l?(d+this.safeAreaBottom)*t:d*t}},{key:"getSafeAreaBottom",value:function getSafeAreaBottom(e){return this.safeAreaBottom*e}}]);return $a}(l.Plugins.BasePlugin);c(eE,"AdsPlugin");var eC=eE;var ex=function(e){return e.BUTTON_CLICK="button_click",e.SCREEN_OPEN="screen_open",e.LOAD_START="load_start",e.LOAD_COMPLETE="load_complete",e.ENGINE_READY="engine_ready",e.GAME_SDK_READY="game_sdk_ready",e.APP_READY="app_ready",e.PAGE_VIEW="page_view",e.TUTORIAL_BEGIN="tutorial_begin",e.TUTORIAL_STEP="tutorial_step",e.TUTORIAL_COMPLETE="tutorial_complete",e.MATCH_START="match_start",e.MATCH_RESCUE="match_rescue",e.MATCH_END="match_end",e.LEVEL_START="level_start",e.LEVEL_RESCUE="level_rescue",e.LEVEL_END="level_end",e.SHARE="share",e.MESSAGE="message",e.INVITE="invite",e.SHORTCUT_CREATE="shortcut_create",e.SHORTCUT_CREATE_POPUP="shortcut_create_popup",e.BOT_SUBSCRIBE="bot_subscribe",e.BOT_SUBSCRIBE_POPUP="bot_subscribe_popup",e.AD_LOAD="ad_load",e.AD_LOAD_FAILED="ad_load_failed",e.AD_SHOW="ad_show",e.AD_SHOW_FAILED="ad_show_failed",e.AD_REWARD="ad_reward",e.AD_IMPRESSION="ad_impression",e.NEW_USER="new_user",e.RETURNING_USER="returning_user",e.JOIN_GROUP="join_group",e.TOURNAMENT_START="tournament_start",e.TOURNAMENT_SHARE="tournament_share",e.TOURNAMENT_CREATE="tournament_create",e.TOURNAMENT_POST_SCORE="tournament_post_score",e.GET_FREE_ITEM="get_free_item",e.USE_ITEM="use_item",e.EARN_ITEM="earn_item",e}(ex||{});var eM=ex,eN=r.Utils,eL=eN.String,eO=eN.Valid;var eT=(v=function(){function Lt(e,t,r){_class_call_check(this,Lt);u(this,"game");u(this,"name");u(this,"color");u(this,"options");u(this,"selfLog");u(this,"currentPath");this.game=e,this.name=t,this.options=r,this.color=r.color||"#FFF",this.selfLog=r.log,this.currentPath="/",console.info("%c".concat(this.name,": init"),"color: ".concat(this.color),this.options)}_create_class(Lt,[{key:"event",value:function event(e,t){this.logInfo("event",{name:e,payload:t});var r=this.formatEventName(e);this.processEvent(r,t)}},{key:"logInfo",value:function logInfo(e,t){this.selfLog&&console.info("%c".concat(this.name,": ").concat(e),"color: ".concat(this.color),t)}},{key:"pageview",value:function pageview(e){var t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),console.info("AnalyticsService: Page view",t),document.title=t,this.event(eM.PAGE_VIEW,{page_title:t})}},{key:"levelStart",value:function levelStart(e,t){this.event(eM.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e)})}},{key:"levelFail",value:function levelFail(e,t){this.event(eM.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e)})}},{key:"levelRescue",value:function levelRescue(e,t){this.event(eM.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e)})}},{key:"levelComplete",value:function levelComplete(e,t){this.event(eM.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e)})}},{key:"loadAdEvent",value:function loadAdEvent(e,t){this.event(eM.AD_LOAD,{ad_type:e,screen_name:t})}},{key:"showAdEvent",value:function showAdEvent(e,t){this.event(eM.AD_SHOW,{ad_type:e,screen_name:t}),this.event(eM.AD_IMPRESSION,{ad_format:e})}},{key:"loadInterstitialAd",value:function loadInterstitialAd(e){this.loadAdEvent("interstitial",e)}},{key:"showInterstitialAd",value:function showInterstitialAd(e){this.showAdEvent("interstitial",e)}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(e){this.loadAdEvent("rewarded_video",e)}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(e){this.showAdEvent("rewarded_video",e)}},{key:"receiveVideoReward",value:function receiveVideoReward(e){this.event(eM.AD_REWARD,{screen_name:e})}},{key:"loadAdFail",value:function loadAdFail(e,t){this.event(eM.AD_LOAD_FAILED,{ad_type:e,screen_name:t})}},{key:"showAdFail",value:function showAdFail(e,t){this.event(eM.AD_SHOW_FAILED,{ad_type:e,screen_name:t})}},{key:"formatEventName",value:function formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}},{key:"getLevelName",value:function getLevelName(e){return"Level ".concat(e)}},{key:"getPageTitle",value:function getPageTitle(e){var t=e.split("/").pop();if(!eO.isString(t))return e;var r=t.replace(/([-_\s.])/g," $1");return eL.toUpperCamelCase(r)}},{key:"addGameModeToPageTitle",value:function addGameModeToPageTitle(e){var t=this.game,r=t.match,l=r.getMatchState();var _=l.mode;return _||(_="Normal"),"".concat(eL.toUpperCamelCase(_),"::").concat(e)}}]);return Lt}(),c(v,"BaseAnalytics"),v);r.Plugins.Analytics={Events:eM,BaseAnalytics:eT};var eR=function(e){_inherits(Ga,e);var t=_create_super(Ga);function Ga(){_class_call_check(this,Ga);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"analytics",[]);u(_assert_this_initialized(e),"placement","unknown");u(_assert_this_initialized(e),"pageview",c(function(t){if(!e.isActive())return;e.placement=t;var r=e.getPageByKey(t);e.analytics.forEach(function(e){e.pageview(r)})},"pageview"));return e}_create_class(Ga,[{key:"add",value:function add(e){this.analytics.some(function(t){return t.name===e.name})||this.analytics.push(e)}},{key:"isActive",value:function isActive(){return this.analytics.length>=1}},{key:"event",value:function event(e,t){this.isActive()&&this.analytics.forEach(function(r){r.event(e,t)})}},{key:"levelStart",value:function levelStart(e,t){this.isActive()&&this.analytics.forEach(function(r){r.levelStart(e,t)})}},{key:"levelRescue",value:function levelRescue(e,t){this.isActive()&&this.analytics.forEach(function(r){r.levelRescue(e,t)})}},{key:"levelFail",value:function levelFail(e,t){this.isActive()&&this.analytics.forEach(function(r){r.levelFail(e,t)})}},{key:"levelComplete",value:function levelComplete(e,t){this.isActive()&&this.analytics.forEach(function(r){r.levelComplete(e,t)})}},{key:"loadInterstitialAd",value:function loadInterstitialAd(){var e=this;this.isActive()&&this.analytics.forEach(function(t){t.loadInterstitialAd(e.placement)})}},{key:"showInterstitialAd",value:function showInterstitialAd(){var e=this;this.isActive()&&this.analytics.forEach(function(t){t.showInterstitialAd(e.placement)})}},{key:"loadRewardedVideoAd",value:function loadRewardedVideoAd(){var e=this;this.isActive()&&this.analytics.forEach(function(t){t.loadRewardedVideoAd(e.placement)})}},{key:"showRewardedVideoAd",value:function showRewardedVideoAd(){var e=this;this.isActive()&&this.analytics.forEach(function(t){t.showRewardedVideoAd(e.placement)})}},{key:"receiveVideoReward",value:function receiveVideoReward(){var e=this;this.isActive()&&this.analytics.forEach(function(t){t.receiveVideoReward(e.placement)})}},{key:"loadAdFail",value:function loadAdFail(e){var t=this;this.isActive()&&this.analytics.forEach(function(r){r.loadAdFail(e,t.placement)})}},{key:"showAdFail",value:function showAdFail(e){var t=this;this.isActive()&&this.analytics.forEach(function(r){r.showAdFail(e,t.placement)})}},{key:"getPageByKey",value:function getPageByKey(e){if(e.indexOf("_")>-1){var t=e.replace(/_/g,"-");return t.toLowerCase()}var r=e.length-1,l="";for(;r>0;){l=e.charAt(r);var _=isNaN(parseInt(l,10)),d=l===l.toUpperCase();_&&d&&(e="".concat(e.slice(0,r),"-").concat(e.slice(r))),r--}return e.toLowerCase()}}]);return Ga}(l.Plugins.BasePlugin);c(eR,"AnalyticsPlugin");var eF=eR;var eG=function(){function Va(e){_class_call_check(this,Va);u(this,"key");this.key=e}_create_class(Va,[{key:"getKey",value:function getKey(){return this.key}}]);return Va}();c(eG,"BaseAudioPlayer");var eV=eG;var ej=function(){function Fa(e){_class_call_check(this,Fa);u(this,"id");u(this,"isMuteAll");u(this,"masterVolume");u(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}_create_class(Fa,[{key:"getId",value:function getId(){return this.id}},{key:"getAudioClip",value:function getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}},{key:"setAudioClip",value:function setAudioClip(e,t){this.audioClips[e]=_object_spread({},this.audioClips[e],t)}},{key:"play",value:function play(e,t){var r=this.getAudioClip(e);if(r){var l=r.audioPlayer;this.playWithRealConfig(l,t)}else this.loadAndPlay(e,t)}},{key:"loadAndPlay",value:function loadAndPlay(e,t){var r=this;return _async_to_generator(function(){var l,_,d,h,y;return _ts_generator(this,function(p){switch(p.label){case 0:p.trys.push([0,2,,3]);return[4,r.onLoadAudio(e,t)];case 1:l=p.sent(),_=t||{},d=_.volume,h=void 0===d?1:d;r.setAudioClip(e,{volume:h,audioPlayer:l}),r.playWithRealConfig(l,t);return[3,3];case 2:y=p.sent();console.warn("playAudio",y);return[3,3];case 3:return[2]}})})()}},{key:"playWithRealConfig",value:function playWithRealConfig(e,t){if(t){var r=t.volume,l=void 0===r?1:r;t.volume=this.masterVolume*l}e.play(t)}},{key:"pause",value:function pause(e){var t=this.getAudioClip(e);if(!t)return!1;var r=t.audioPlayer;return r.pause(),!0}},{key:"resume",value:function resume(e){var t=this.getAudioClip(e);if(!t)return!1;var r=t.audioPlayer;return r.resume(),!0}},{key:"stop",value:function stop(e){var t=this.getAudioClip(e);if(!t)return!1;var r=t.audioPlayer;return r.stop(),!0}},{key:"stopAll",value:function stopAll(){this.callAudioPlayers("stop")}},{key:"muteAll",value:function muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}},{key:"unmuteAll",value:function unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}},{key:"setVolume",value:function setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}},{key:"getVolume",value:function getVolume(){return this.masterVolume}},{key:"queueAudioPlayer",value:function queueAudioPlayer(e,t){try{var r=e.audioPlayer,l=e.volume,_=void 0===l?1:l;switch(t){case"play":r.play();break;case"pause":r.pause();break;case"resume":r.resume();break;case"stop":r.stop();break;case"mute":r.setVolume(0);break;case"unmute":case"setVolume":r.setVolume(this.masterVolume*_);break;default:throw new Error("Unsupported function: ".concat(t))}}catch(e){console.warn("queueAudioPlayer",e)}}},{key:"callAudioPlayers",value:function callAudioPlayers(e){var t=this;var l=r.Utils,_=l.Object;_.vals(this.audioClips).forEach(function(r){t.queueAudioPlayer(r,e)})}}]);return Fa}();c(ej,"BaseChannelManager");var eB=ej;r.Plugins.Audio={BaseAudioPlayer:eV,BaseChannelManager:eB};var eH=function(e){_inherits(Ua,e);var t=_create_super(Ua);function Ua(){_class_call_check(this,Ua);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"firstChannelId");u(_assert_this_initialized(e),"channels",{});return e}_create_class(Ua,[{key:"addChannel",value:function addChannel(e){var t=e.getId();this.channels[t]=e,this.firstChannelId||(this.firstChannelId=t)}},{key:"getChannel",value:function getChannel(e){if(void 0===e)return this.channels[this.firstChannelId];var t=this.channels[e];if(!t)throw new Error("Channel ".concat(e," not found"));return t}},{key:"play",value:function play(e,t,r){try{this.getChannel(r).play(e,t)}catch(e){console.warn("playSound",e)}}},{key:"pause",value:function pause(e,t){try{this.getChannel(t).pause(e)}catch(e){console.warn("pauseSound",e)}}},{key:"resume",value:function resume(e,t){try{this.getChannel(t).resume(e)}catch(e){console.warn("resumeSound",e)}}},{key:"stop",value:function stop(e,t){try{this.getChannel(t).stop(e)}catch(e){console.warn("stopSound",e)}}},{key:"stopAll",value:function stopAll(e){try{this.getChannel(e).stopAll()}catch(e){console.warn("stopAllSounds",e)}}},{key:"mute",value:function mute(e){try{this.getChannel(e).muteAll()}catch(e){console.warn("mute",e)}}},{key:"unmute",value:function unmute(e){try{this.getChannel(e).unmuteAll()}catch(e){console.warn("unmute",e)}}},{key:"setVolume",value:function setVolume(e,t){try{this.getChannel(t).setVolume(e)}catch(e){console.warn("setSoundVolume",e)}}}]);return Ua}(l.Plugins.BasePlugin);c(eH,"AudioPlugin");var eU=eH;var ez={token:"",isRequesting:!1},eK=function(e){_inherits(ka,e);var t=_create_super(ka);function ka(){_class_call_check(this,ka);return t.apply(this,arguments)}_create_class(ka,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("auth",ez)}},{key:"requestToken",value:function requestToken(){var e=this;return _async_to_generator(function(){var t,l,_,d;return _ts_generator(this,function(h){switch(h.label){case 0:t=e.game,l=t.storage;h.label=1;case 1:h.trys.push([1,3,4,5]);if(l.getStorageData("auth","isRequesting")||""!==l.getStorageData("auth","token"))return[2];l.setStorageData("auth","isRequesting",!0);return[4,GameSDK.player.getSignedPlayerInfoAsync()];case 2:_=h.sent().getSignature();l.setStorageData("auth","token",_);return[3,5];case 3:d=h.sent();if(r.Utils.Object.hasOwn(d,"code")&&"PENDING_REQUEST"===d.code)return[2];l.setStorageData("auth","token",""),console.error(d);return[3,5];case 4:l.setStorageData("auth","isRequesting",!1);return[7];case 5:return[2]}})})()}},{key:"getToken",value:function getToken(){var e=this.game,t=e.storage;return t.getStorageData("auth","token")}}]);return ka}(l.Plugins.BasePlugin);c(eK,"AuthPlugin");var eW=eK;var eq=function(e){return e.SOLO="solo",e.TOURNAMENT="tournament",e.SHARE_INVITE="share_invite",e.MATCHING_GROUP="matching_group_match",e.CHALLENGE_FRIEND="challenge_friend_match",e}(eq||{});var eJ=eq,eY=_,eQ=r.Utils,eX=(eQ.Array,eQ.Valid),e$=eQ.Browser,eZ=function(){function Ba(e){_class_call_check(this,Ba);u(this,"game");this.game=e}_create_class(Ba,[{key:"isValidContextType",value:function isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}},{key:"isValidEntryPointData",value:function isValidEntryPointData(e){return eX.isObject(e)}},{key:"isTournamentEntryPoint",value:function isTournamentEntryPoint(e){return["facebook~game_list~tournaments","fb_feed_tournament_unit"].indexOf(e)>=0}},{key:"receiveContext",value:function receiveContext(e,t,r){var l=this.game,_=l.storage;_.setStorageData("context","contextId",e),this.isValidEntryPointData(r)?_.setStorageData("context","entryPointData",r):console.warn("Invalid context type: ".concat(t)),this.isValidContextType(t)?_.setStorageData("context","contextType",t):console.warn("Invalid context type: ".concat(t))}},{key:"detectContextSessionType",value:function detectContextSessionType(){var e=this;return _async_to_generator(function(){var t,r,l,_,d,h,y,p,f,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:t=e.game,r=t.storage,l=r.getStorageData("context","entryPointData"),_=l.type,d=eJ.SOLO,h=eJ.TOURNAMENT,y=eJ.MATCHING_GROUP,p=eJ.SHARE_INVITE,f=eJ.CHALLENGE_FRIEND;v=d;if(_===h&&(v=h),_===y&&(v=y),(_===f||_===p)&&(v=f),v!==d)return[3,4];g=e$.getQueryParams().entry_point;if(!g)return[3,1];v=e.isTournamentEntryPoint(g)?h:d;return[3,4];case 1:m.trys.push([1,3,,4]);if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");return[4,GameSDK.getTournamentAsync()];case 2:m.sent(),v=h;return[3,4];case 3:m.sent();return[3,4];case 4:r.setStorageData("context","sessionContextType",v);return[2]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){var e=this.game,t=e.player,r=e.storage,l=r.getStorageData("context","entryPointData"),_=r.getStorageData("context","sessionContextType"),d=t.getPlayerId(),h=l.matchId,y=l.playerId,p=l.opponentId,f=void 0===p?F.playerId:p,v=d===y,g=f===F.playerId||[f,y].indexOf(d)>=0,m=eJ.TOURNAMENT,A=eJ.MATCHING_GROUP,w=eJ.SHARE_INVITE,I=eJ.CHALLENGE_FRIEND;var b=eY.SINGLE;_===m&&(b=eY.TOURNAMENT),_!==w||v||(b=eY.CHALLENGE_FRIEND),_===I&&h&&g&&(b=eY.CHALLENGE_FRIEND),_===A&&(b=eY.MATCHING_GROUP),r.setStorageData("context","contextGameMode",b)}}]);return Ba}();c(eZ,"Context");var e0=eZ;var e2=function(e){_inherits(ja,e);var t=_create_super(ja);function ja(e){_class_call_check(this,ja);var r;r=t.call(this,e),r.name="PlayerHasFinishedMatch",r.message=null!=e?e:"Player has finished match";return _possible_constructor_return(r)}return ja}(_wrap_native_super(Error));c(e2,"PlayerHasFinishedMatch");var e1=e2;var e3=function(e){_inherits(Ka,e);var t=_create_super(Ka);function Ka(e){_class_call_check(this,Ka);var r;r=t.call(this,e),r.name="PlayerNotJoinInMatch",r.message=e||"Player is not join in match";return _possible_constructor_return(r)}return Ka}(_wrap_native_super(Error));c(e3,"PlayerNotJoinInMatch");var e4=e3;var e5=r.Events,e7=r.Plugins,e6=r.Utils,e8=e6.Object,e9=e7.Analytics,te=function(){function Wa(e){_class_call_check(this,Wa);u(this,"game");this.game=e}_create_class(Wa,[{key:"processContextData",value:function processContextData(){var e=this;return _async_to_generator(function(){var t,r,l,_,d,h,y,p,f,v,g,m,A,w,I,b,k,S;return _ts_generator(this,function(D){switch(D.label){case 0:t=e.game,r=t.player,l=t.analytics,_=t.storage,d=_.getStorageData("context","contextId"),h=_.getStorageData("context","entryPointData"),y=_.getStorageData("context","sessionContextType"),p=h||{},f=p.type,v=p.matchId,g=p.playerId,m=p.opponentId,A=p.playerScore;if(r.isFirstLogin())l.event(e9.Events.NEW_USER);else{w=r.getGameData();l.event(e9.Events.RETURNING_USER,{game_data:e8.snakeCaseKeys(w||{})})}I=eJ.TOURNAMENT,b=eJ.SHARE_INVITE,k=eJ.MATCHING_GROUP,S=eJ.CHALLENGE_FRIEND;if(y!==I)return[3,6];D.label=1;case 1:D.trys.push([1,3,,5]);return[4,e.processTournamentModeAsync()];case 2:D.sent();return[3,5];case 3:D.sent();return[4,e.processSingleModeAsync()];case 4:D.sent();return[3,5];case 5:return[2];case 6:if(y!==S)return[3,10];if(!(f===b&&"string"==typeof g))return[3,8];return[4,e.processChallengeFromPostAsync(g)];case 7:D.sent();return[2];case 8:if(!(f===S&&"string"==typeof v&&"string"==typeof g&&"string"==typeof m))return[3,10];return[4,e.processChallengeFromMessageAsync({contextId:d,matchId:v,playerId:g,opponentId:m})];case 9:D.sent();return[2];case 10:if(!(y===k&&"string"==typeof g&&"number"==typeof A))return[3,12];return[4,e.processMatchingGroupModeAsync(g,A)];case 11:D.sent();return[2];case 12:if(!r.isFirstLogin())return[3,14];return[4,e.processSingleModeAsync()];case 13:D.sent(),r.loggedIn();return[2];case 14:e.switchToDashboardScene();return[2]}})})()}},{key:"processTournamentModeAsync",value:function processTournamentModeAsync(){var e=this;return _async_to_generator(function(){var t,r,l,_,d;return _ts_generator(this,function(h){switch(h.label){case 0:t=e.game,r=t.match,l=t.player,_=l.getPlayerId(),d=GameSDK.context.getID();if("string"!=typeof d)throw new Error("Cannot get contextId");return[4,r.tournament.continue.processAsync({playerId:_,contextId:d})];case 1:h.sent(),e.switchToGameScene();return[2]}})})()}},{key:"processChallengeFromPostAsync",value:function processChallengeFromPostAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h;return _ts_generator(this,function(y){switch(y.label){case 0:r=t.game,l=r.match,_=r.player,d=_.getPlayerId();if(d!==e)return[3,2];return[4,l.single.start.processAsync({playerId:d})];case 1:y.sent();return[3,6];case 2:y.trys.push([2,4,,6]);return[4,l.challenge.friend.processAsync({playerId:d,opponentId:e})];case 3:y.sent();return[3,6];case 4:h=y.sent();console.warn("processChallengeFromPostAsync",h);return[4,l.single.start.processAsync({playerId:d})];case 5:y.sent();return[3,6];case 6:t.switchToGameScene();return[2]}})})()}},{key:"processChallengeFromMessageAsync",value:function processChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:l.trys.push([0,2,,7]);return[4,t.processContinueChallengeFromMessageAsync(e)];case 1:l.sent();return[3,7];case 2:r=l.sent();if(console.warn("processContinueChallengeFromMessageAsync",r),!_instanceof(r,e1))return[3,4];return[4,t.processAwaitChallengeFromMessageAsync(e)];case 3:l.sent();return[2];case 4:if(!_instanceof(r,e4))return[3,6];return[4,t.processJoinChallengeFromMessageAsync(e)];case 5:l.sent();return[2];case 6:t.switchToDashboardScene();return[3,7];case 7:return[2]}})})()}},{key:"processContinueChallengeFromMessageAsync",value:function processContinueChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v;return _ts_generator(this,function(g){switch(g.label){case 0:r=e.contextId,l=e.matchId,_=e.playerId,d=e.opponentId,h=t.game,y=h.match,p=h.player,f=p.getPlayerId();if(_!==f)return[3,2];return[4,y.challenge.continue.processAsync({contextId:r,matchId:l,playerId:f,opponentId:d})];case 1:g.sent();return[3,4];case 2:v=d===F.playerId;return[4,y.challenge.continue.processAsync({contextId:r,matchId:l,playerId:f,opponentId:v?d:_})];case 3:g.sent();g.label=4;case 4:t.switchToGameScene();return[2]}})})()}},{key:"processJoinChallengeFromMessageAsync",value:function processJoinChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p;return _ts_generator(this,function(f){switch(f.label){case 0:r=e.contextId,l=e.matchId,_=e.playerId,d=t.game,h=d.match,y=d.player,p=y.getPlayerId();return[4,h.challenge.join.processAsync({contextId:r,matchId:l,playerId:p,opponentId:_})];case 1:f.sent(),t.switchToGameScene();return[2]}})})()}},{key:"processAwaitChallengeFromMessageAsync",value:function processAwaitChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.contextId,l=e.matchId,_=e.playerId,d=t.game,h=d.match,y=d.player,p=y.getPlayerId();v.label=1;case 1:v.trys.push([1,3,,5]);return[4,h.challenge.await.processAsync({contextId:r,matchId:l,playerId:p,opponentId:_})];case 2:v.sent(),t.switchToChallengeResultScene();return[3,5];case 3:f=v.sent();console.warn("processAwaitChallengeFromMessageAsync",f);return[4,t.processResultChallengeFromMessageAsync(e)];case 4:v.sent();return[3,5];case 5:return[2]}})})()}},{key:"processResultChallengeFromMessageAsync",value:function processResultChallengeFromMessageAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p;return _ts_generator(this,function(f){switch(f.label){case 0:r=e.contextId,l=e.matchId,_=e.playerId,d=t.game,h=d.match,y=d.player,p=y.getPlayerId();f.label=1;case 1:f.trys.push([1,3,,4]);return[4,h.challenge.result.processAsync({contextId:r,matchId:l,playerId:p,opponentId:_})];case 2:f.sent(),t.switchToChallengeResultScene();return[3,4];case 3:f.sent();t.switchToDashboardScene();return[3,4];case 4:return[2]}})})()}},{key:"processMatchingGroupModeAsync",value:function processMatchingGroupModeAsync(e,t){var r=this;return _async_to_generator(function(){var l,_,d;return _ts_generator(this,function(h){switch(h.label){case 0:l=r.game,_=l.match,d=l.player;return[4,_.group.join.processAsync({playerId:d.getPlayerId(),opponentId:e,opponentScore:t})];case 1:h.sent(),r.switchToGameScene();return[2]}})})()}},{key:"processSingleModeAsync",value:function processSingleModeAsync(){var e=this;return _async_to_generator(function(){var t,r,l,_;return _ts_generator(this,function(d){switch(d.label){case 0:t=e.game,r=t.match,l=t.player,_=l.getPlayerId();return[4,r.single.start.processAsync({playerId:_})];case 1:d.sent(),e.switchToGameScene();return[2]}})})()}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){var e=this.game,t=e.event;t.emit(e5.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isMatchStartFromLoader:!0}})}},{key:"switchToGameScene",value:function switchToGameScene(){var e=this.game,t=e.event;t.emit(e5.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isMatchStartFromLoader:!0}})}},{key:"switchToChallengeResultScene",value:function switchToChallengeResultScene(){var e=this.game,t=e.event;t.emit(e5.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isMatchStartFromLoader:!0}})}}]);return Wa}();c(te,"Loader");var tt=te;var ta={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},tr=r.Events,ts=function(e){_inherits(za,e);var t=_create_super(za);function za(e){_class_call_check(this,za);var r;r=t.call(this,e);u(_assert_this_initialized(r),"context");u(_assert_this_initialized(r),"loader");r.loader=new tt(e),r.context=new e0(e);return r}_create_class(za,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("context",ta)}},{key:"getSessionContextTypes",value:function getSessionContextTypes(){return eJ}},{key:"processContextData",value:function processContextData(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,e.loader.processContextData()];case 1:r.sent();return[3,3];case 2:t=r.sent();console.error("processContextData",t),e.switchToDashboardScene();return[3,3];case 3:return[2]}})})()}},{key:"detectContextSessionType",value:function detectContextSessionType(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,e.context.detectContextSessionType()];case 1:r.sent();return[3,3];case 2:t=r.sent();console.error("detectContextSessionType",t);return[3,3];case 3:return[2]}})})()}},{key:"detectContextGameMode",value:function detectContextGameMode(){this.context.detectContextGameMode()}},{key:"receiveContext",value:function receiveContext(e,t,r){this.context.receiveContext(e,t,r)}},{key:"switchToDashboardScene",value:function switchToDashboardScene(){var e=this.game,t=e.event;t.emit(tr.SWITCH_SCENE,{sceneName:"DashboardScene"})}}]);return za}(l.Plugins.BasePlugin);c(ts,"ContextPlugin");var tc=ts;var tl=r.Utils,tu=tl.Valid,t_=ta.contextId,th=ta.contextType,ty=ta.entryPointData,tp="is invalid",tf=function(e){_inherits(Ha,e);var t=_create_super(Ha);function Ha(){_class_call_check(this,Ha);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"data");return e}_create_class(Ha,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateContextId",value:function validateContextId(e){tu.isString(e)||this.exception("contextId",tp)}},{key:"validateContextType",value:function validateContextType(e){tu.isString(e)&&e||this.exception("contextType",tp)}},{key:"validateEntryPointData",value:function validateEntryPointData(e){tu.isObject(e)||this.exception("entryPointData",tp)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ha.prototype),"toObject",this).call(this)}}]);return Ha}(S);c(tf,"ContextInfoDtos");var tv=tf;tv.addDefaultData({contextId:t_,contextType:th,entryPointData:ty}),r.Dtos.Context={Info:tv};var tg={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},tm=r.Utils,tA=tm.Object,tw=function(){function qa(){_class_call_check(this,qa)}_create_class(qa,[{key:"getDailyRewardsAsync",value:function getDailyRewardsAsync(){return _async_to_generator(function(){return _ts_generator(this,function(e){return[2,tA.vals(tg)]})})()}}]);return qa}();c(tw,"DailyRewardsAPI");var tI=tw;var tb={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},tk={dailyRewards:{}},tS=r.Configs.DailyRewards,tD=function(e){_inherits(Ya,e);var t=_create_super(Ya);function Ya(){_class_call_check(this,Ya);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"dailyRewardsApi",new tI);return e}_create_class(Ya,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("dailyRewards",tk)}},{key:"requestDailyRewardsAsync",value:function requestDailyRewardsAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,e.dailyRewardsApi.getDailyRewardsAsync()];case 1:t=r.sent();0!==t.length&&e.receiveDailyRewards(t);return[2]}})})()}},{key:"getDailyRewards",value:function getDailyRewards(){var e=this.game,t=e.storage,r=t.getStorageData("dailyRewards","dailyRewards");return r||null}},{key:"logLoginReward",value:function logLoginReward(){var e=this.game,t=e.player,r=t.getPlayerData().dailyRewarded,l=r.logDays,_=_to_consumable_array(l);_[_.length-1]=!0,this.logDailyRewards(_)}},{key:"logDailyRewards",value:function logDailyRewards(e,t){var r=arguments.length>1&&void 0!==t&&t;var l=this.game,_=l.player;_.setPlayerDataByName("dailyRewarded",{logDays:e,lastRewarded:r?0:Date.now()})}},{key:"receiveDailyRewards",value:function receiveDailyRewards(e){var t=this.game,r=t.player,l=r.getPlayerData().dailyRewarded,_=l.logDays,d=l.lastRewarded,h=new Date,y=new Date(d),p=new Date(y.toDateString()),f=Math.abs(h.valueOf()-p.valueOf()),v=Math.floor(f/864e5)>1,g=tS.CheckInterrupt&&v||_.length>=tS.MaxDays,m=g?[!1]:_to_consumable_array(_).concat([!1]);this.logDailyRewards(m);var A=e.map(function(e,t){var r=t<m.length,l=m.length===t+1,_=!1===m[t];var d=tb.WAITING;return l?d=tb.READY:g?d=tb.WAITING:r&&_?d=tb.SKIPPED:r&&(d=tb.REWARDED),_object_spread_props(_object_spread({},e),{status:d})});this.setDailyRewards(A)}},{key:"setDailyRewards",value:function setDailyRewards(e){var t=this.game,r=t.storage;r.setStorageData("dailyRewards","dailyRewards",e)}}]);return Ya}(l.Plugins.BasePlugin);c(tD,"DailyRewardsPlugin");var tP=tD;var tE={exports:{}};tE.exports,function(e){var t=Object.prototype.hasOwnProperty,r="~";function s(){}c(s,"Events"),Object.create&&(s.prototype=Object.create(null),new s().__proto__||(r=!1));function a(e,t,r){this.fn=e,this.context=t,this.once=r||!1}c(a,"EE");function n(e,t,l,_,d){if("function"!=typeof l)throw new TypeError("The listener must be a function");var h=new a(l,_||e,d),y=r?r+t:t;return e._events[y]?e._events[y].fn?e._events[y]=[e._events[y],h]:e._events[y].push(h):(e._events[y]=h,e._eventsCount++),e}c(n,"addListener");function i(e,t){0===--e._eventsCount?e._events=new s:delete e._events[t]}c(i,"clearEvent");function o(){this._events=new s,this._eventsCount=0}c(o,"EventEmitter"),o.prototype.eventNames=c(function(){var e=[],l,_;if(0===this._eventsCount)return e;for(_ in l=this._events)t.call(l,_)&&e.push(r?_.slice(1):_);return Object.getOwnPropertySymbols?e.concat(Object.getOwnPropertySymbols(l)):e},"eventNames"),o.prototype.listeners=c(function(e){var t=r?r+e:e,l=this._events[t];if(!l)return[];if(l.fn)return[l.fn];for(var _=0,d=l.length,h=new Array(d);_<d;_++)h[_]=l[_].fn;return h},"listeners"),o.prototype.listenerCount=c(function(e){var t=r?r+e:e,l=this._events[t];return l?l.fn?1:l.length:0},"listenerCount"),o.prototype.emit=c(function(e,t,l,_,d,h){var y=r?r+e:e;if(!this._events[y])return!1;var p=this._events[y],f=arguments.length,v,g;if(p.fn){switch(p.once&&this.removeListener(e,p.fn,void 0,!0),f){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,t),!0;case 3:return p.fn.call(p.context,t,l),!0;case 4:return p.fn.call(p.context,t,l,_),!0;case 5:return p.fn.call(p.context,t,l,_,d),!0;case 6:return p.fn.call(p.context,t,l,_,d,h),!0}for(g=1,v=new Array(f-1);g<f;g++)v[g-1]=arguments[g];p.fn.apply(p.context,v)}else{var m=p.length,A;for(g=0;g<m;g++)switch(p[g].once&&this.removeListener(e,p[g].fn,void 0,!0),f){case 1:p[g].fn.call(p[g].context);break;case 2:p[g].fn.call(p[g].context,t);break;case 3:p[g].fn.call(p[g].context,t,l);break;case 4:p[g].fn.call(p[g].context,t,l,_);break;default:if(!v)for(A=1,v=new Array(f-1);A<f;A++)v[A-1]=arguments[A];p[g].fn.apply(p[g].context,v)}}return!0},"emit"),o.prototype.on=c(function(e,t,r){return n(this,e,t,r,!1)},"on"),o.prototype.once=c(function(e,t,r){return n(this,e,t,r,!0)},"once"),o.prototype.removeListener=c(function(e,t,l,_){var d=r?r+e:e;if(!this._events[d])return this;if(!t)return i(this,d),this;var h=this._events[d];if(h.fn)h.fn!==t||_&&!h.once||l&&h.context!==l||i(this,d);else{for(var y=0,p=[],f=h.length;y<f;y++)(h[y].fn!==t||_&&!h[y].once||l&&h[y].context!==l)&&p.push(h[y]);p.length?this._events[d]=1===p.length?p[0]:p:i(this,d)}return this},"removeListener"),o.prototype.removeAllListeners=c(function(e){var t;return e?(t=r?r+e:e,this._events[t]&&i(this,t)):(this._events=new s,this._eventsCount=0),this},"removeAllListeners"),o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,e.exports=o}(tE);var tC=tE.exports;var tx=p(tC),tM=new tx,tN={names:[],history:[]},tL=function(e){_inherits(Qa,e);var t=_create_super(Qa);function Qa(){_class_call_check(this,Qa);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"enableLog",!1);u(_assert_this_initialized(e),"muteEvents",[]);return e}_create_class(Qa,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("event",tN)}},{key:"enableLogEvent",value:function enableLogEvent(){this.enableLog=!0}},{key:"on",value:function on(e,t){this.validateCallback(t),this.addEventName(e),this.addHistory(e,"on","listening"),tM.on(e,t)}},{key:"once",value:function once(e,t){this.validateCallback(t),this.addEventName(e),this.addHistory(e,"once","listening"),tM.once(e,t)}},{key:"off",value:function off(e,t){this.validateCallback(t),tM.off(e,t),this.addHistory(e,"any","removed")}},{key:"mute",value:function mute(e){this.muteEvents.indexOf(e)>-1||this.muteEvents.push(e)}},{key:"clear",value:function clear(e){tM.removeAllListeners(e),this.addHistory(e,"any","removed")}},{key:"emit",value:function emit(e,t){var r;if(this.muteEvents.indexOf(e)>-1)return;var l=[];t&&(l=[t]),this.addHistory(e,"any","called",t),(r=tM).emit.apply(r,[e].concat(_to_consumable_array(l)))}},{key:"validateCallback",value:function validateCallback(e){if("function"!=typeof e)throw new Error("Callback must be a function")}},{key:"addEventName",value:function addEventName(e){var t=this.game,r=t.storage,l=r.getStorageData("event","names");l.indexOf(e)<0&&l.push(e)}},{key:"getEventListeners",value:function getEventListeners(){var e=tM.eventNames();return Object.keys(e)}},{key:"getHistory",value:function getHistory(){var e=this.game,t=e.storage;return t.getStorageData("event","history")}},{key:"getEventEmitCount",value:function getEventEmitCount(e){return this.getHistory().filter(function(t){return t.name===e&&"called"===t.status}).length}},{key:"getLastEventInfo",value:function getLastEventInfo(e){var t=this.getHistory();var r=null;for(var l=t.length-1;l>=0;l--)if(t[l].name===e){r=t[l];break}return r}},{key:"getTypeFromHistory",value:function getTypeFromHistory(e){var t=this.getLastEventInfo(e);var r;return null!==(r=null==t?void 0:t.type)&&void 0!==r?r:null}},{key:"getCallsFromHistory",value:function getCallsFromHistory(e){var t=this.getLastEventInfo(e);var r;return null!==(r=null==t?void 0:t.called)&&void 0!==r?r:0}},{key:"addHistory",value:function addHistory(e,t,r,l){var _;var d=null!==(_=this.getTypeFromHistory(e))&&void 0!==_?_:t,h=this.getCallsFromHistory(e),y="called"===r?h+1:h;this.getHistory().push({type:d,status:r,name:e,called:y,payload:null!=l?l:{}}),this.logEventInfo(e,d,r,y)}},{key:"logEventInfo",value:function logEventInfo(e,t,r,l){if(this.enableLog){if("listening"===r){console.info("Event (".concat(t,") ").concat(e,": ").concat(r));var _=tM.listenerCount(e);_>1&&console.warn("Event ".concat(e," has ").concat(_," listener"))}else"any"!==t&&console.info("Event (".concat(t,") ").concat(e,": ").concat(r," (").concat(l," times)"));"called"===r&&tM.listenerCount(e)<=0&&console.warn("Event ".concat(e," is called but not listening"))}}}]);return Qa}(l.Plugins.BasePlugin);c(tL,"EventPlugin");var tO=tL;var tT={},tR=Object.freeze(Object.defineProperty({__proto__:null,default:tT},Symbol.toStringTag,{value:"Module"})),tF='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',tG=r.Configs,tV=r.Utils,tj=tV.Object,tB=tG.FrameCapture,tH=tB.Enabled,tU=tB.WideframeConfigs,tz=c(function(){var e=_async_to_generator(function(e){var t,r,l,_,d,h;return _ts_generator(this,function(y){if(!tH)return[2,(console.warn("FrameCapture is not enabled"),null)];t=tW(e);if(!t)return[2,null];tK(t,tU.ResultChallenge);r=window.game,l=r.frameCapture,_=tU.ResultChallenge,d=_.Width,h=_.Height;return[2,l.captureAsync({name:"ResultChallenge",width:d,height:h,renderOptions:t})]})});return function(t){return e.apply(this,arguments)}}(),"renderResultChallenge"),tK=c(function(e,t){var r=t.Width,l=t.Height,_=t.Wideframe;e.wideframe={name:"result-challenge",type:"image",depth:0,image:_,size:[r,l],position:[0,0]}},"addWideframe$2"),tW=c(function(e){try{var t=e.playerId,r=void 0===t?"10":t,l=e.playerPhoto,_=void 0===l?"":l,d=e.playerScore,h=void 0===d?0:d,y=e.opponentId,p=void 0===y?"20":y,f=e.opponentPhoto,v=void 0===f?"":f,g=e.opponentScore,m=void 0===g?0:g,A=e.isPlayerFinished,w=e.isOpponentFinished,I=tU.ResultChallenge,b=I.RenderOptions,k=tj.camelCaseKeys(tj.clone(b)),S=k.playerPhoto,D=k.opponentPhoto,P=h===m,E=h>m,C=null!=A?A:w,x=A&&w;return"image"===S.type&&(S.name="".concat(r),S.image=_),"image"===D.type&&(D.name="".concat(p),D.image=v),C&&tq(k,{playerScore:h,opponentScore:m,isPlayerFinished:A,isOpponentFinished:w}),!x||P?(delete k.leftCrown,delete k.rightCrown,k):(E?delete k.rightCrown:delete k.leftCrown,k)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$2"),tq=c(function(e,t){var r=e.leftScore,l=e.rightScore,_=t.playerScore,d=void 0===_?0:_,h=t.opponentScore,y=void 0===h?0:h,p=t.isPlayerFinished,f=t.isOpponentFinished;"text"===r.type&&(r.text=p?"".concat(d):"???"),"text"===l.type&&(l.text=f?"".concat(y):"???")},"addRenderScores"),tJ=r.Configs,tY=r.Utils,tQ=tY.Object,tX=tJ.FrameCapture,t$=tX.Enabled,tZ=tX.WideframeConfigs,t0=c(function(){var e=_async_to_generator(function(e){var t,r,l,_,d,h;return _ts_generator(this,function(y){if(!t$)return[2,(console.warn("FrameCapture is not enabled"),null)];t=t1(e);if(!t)return[2,null];t2(t,tZ.ShareLeaderboard);r=window.game,l=r.frameCapture,_=tZ.ShareLeaderboard,d=_.Width,h=_.Height;return[2,l.captureAsync({name:"ShareLeaderboard",width:d,height:h,renderOptions:t})]})});return function(t){return e.apply(this,arguments)}}(),"renderShareLeaderboard"),t2=c(function(e,t){var r=t.Width,l=t.Height,_=t.Wideframe;e.wideframe={name:"share-leaderboard",type:"image",depth:0,image:_,size:[r,l],position:[0,0]}},"addWideframe$1"),t1=c(function(e){try{var t=e.playerId,r=e.playerPhoto,l=e.leaders,_=tZ.ShareLeaderboard,d=_.RenderOptions,h=tQ.camelCaseKeys(tQ.clone(d)),y=h.avatar;return"image"===y.type&&(y.name="".concat(t),y.image=r),t3(h,l),h}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$1"),t3=c(function(e,t){var r="600 48px";t.forEach(function(t,l){var _=t.id,d=t.name,h=t.photo,y=t.score;var p=1294+180*l;e["photo_".concat(_)]={depth:-1,name:_,type:"image",image:h,size:[96,96],position:[436,p]},p=1360+180*l,e["name_".concat(_)]={font:r,depth:1,name:_,type:"text",text:d,position:[600,p]},e["score_".concat(_)]={font:r,depth:1,name:_,type:"text",text:"".concat(y),position:[100,p]}})},"addLeaders"),t4=r.Configs,t5=r.Utils,t7=t5.Object,t6=t4.FrameCapture,t8=t6.Enabled,t9=t6.WideframeConfigs,ne=c(function(){var e=_async_to_generator(function(e){var t,r,l,_,d,h;return _ts_generator(this,function(y){if(!t8)return[2,(console.warn("FrameCapture is not enabled"),null)];t=na(e);if(!t)return[2,null];nt(t,t9.ShareScore);r=window.game,l=r.frameCapture,_=t9.ShareScore,d=_.Width,h=_.Height;return[2,l.captureAsync({name:"ShareScore",width:d,height:h,renderOptions:t})]})});return function(t){return e.apply(this,arguments)}}(),"renderShareScore"),nt=c(function(e,t){var r=t.Width,l=t.Height,_=t.Wideframe;e.wideframe={name:"share-score",type:"image",depth:0,image:_,size:[r,l],position:[0,0]}},"addWideframe"),na=c(function(e){try{var t=e.playerId,r=e.playerPhoto,l=e.playerScore,_=t9.ShareScore,d=_.RenderOptions,h=t7.camelCaseKeys(t7.clone(d));console.log("renderOptions",h);var y=h.avatar,p=h.playerScore;return"image"===y.type&&(y.name="".concat(t),y.image=r),"text"===p.type&&(p.text="".concat(l)),h}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions"),ns=r.Configs,nc=r.Utils,nl=nc.Image,nu=nc.Object,n_=nc.Valid,nd=ns.FrameCapture,nh=nd.Options,ny=function(e){_inherits(Xa,e);var t=_create_super(Xa);function Xa(){_class_call_check(this,Xa);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"width");u(_assert_this_initialized(e),"height");u(_assert_this_initialized(e),"canvas",null);u(_assert_this_initialized(e),"testRenderOptions",null);u(_assert_this_initialized(e),"caches",{});u(_assert_this_initialized(e),"wideframe",{});return e}_create_class(Xa,[{key:"init",value:function init(){this.addWideframeRender("renderShareScore",ne),this.addWideframeRender("renderResultChallenge",tz),this.addWideframeRender("renderShareLeaderboard",t0)}},{key:"preloadAsync",value:function preloadAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:r=e.renderOptions;return[4,t.loadImages(r)];case 1:l.sent();return[2]}})})()}},{key:"captureAsync",value:function captureAsync(e){var t=this;return _async_to_generator(function(){var r,l,_;return _ts_generator(this,function(d){switch(d.label){case 0:r=e.width,l=e.height,_=e.renderOptions;t.width=r,t.height=l,t.createCanvas();return[4,t.loadImages(_)];case 1:return[2,(d.sent(),t.drawObjects(_),t.snapshotFrameAsync())]}})})()}},{key:"addWideframeRender",value:function addWideframeRender(e,t){this.wideframe[e]=t}},{key:"setTestRenderOptions",value:function setTestRenderOptions(e){if(!e){this.testRenderOptions=null;return}var t=nu.camelCaseKeys(e);this.testRenderOptions=nu.merge(this.testRenderOptions,t)}},{key:"createCanvas",value:function createCanvas(){if(this.canvas){var e=this.canvas.getContext("2d");e?e.clearRect(0,0,this.canvas.width,this.canvas.height):this.canvas=null}this.canvas||(this.canvas=document.createElement("canvas",{is:"canvas"})),this.canvas.width=this.width,this.canvas.height=this.height}},{key:"loadImages",value:function loadImages(e){var t=this;return _async_to_generator(function(){var r,l,_,d;return _ts_generator(this,function(h){switch(h.label){case 0:r=nu.vals(e).filter(function(e){return"image"===e.type}),l=t.prepareLoadImages(r),_=nu.vals(l);if(_.length<1)return[2];return[4,Promise.all(_)];case 1:d=h.sent();t.cacheImages(l,d);return[2]}})})()}},{key:"prepareLoadImages",value:function prepareLoadImages(e){var t={};var r=true,l=false,_=void 0;try{var d,_loop=function(){var e=y.value;var r=e.name,l=e.image,_=e.fallbackImage,h=d.caches[r];!n_.isString(l)||h||(""===l&&n_.isString(_)&&(e.image=_),console.info("prepareLoadImages",e),t[r]=new Promise(function(t){var r=nl.loadImage(l);r.catch(function(){n_.isString(_)?(e.image=_,nl.loadImage(e.image).then(function(e){t(e)}).catch(function(){t(null)})):t(null)}),r.then(function(e){t(e)})}))};for(var h=e[Symbol.iterator](),y;!(r=(y=h.next()).done);r=true)d=this,_loop()}catch(e){l=true;_=e}finally{try{if(!r&&null!=h.return)h.return()}finally{if(l)throw _}}return t}},{key:"cacheImages",value:function cacheImages(e,t){for(var r in e){var l=t.shift();l&&(this.caches[r]=l)}}},{key:"drawObjects",value:function drawObjects(e){var t=nu.vals(e).sort(function(e,t){return e.depth-t.depth});var r=true,l=false,_=void 0;try{for(var d=t[Symbol.iterator](),h;!(r=(h=d.next()).done);r=true){var y=h.value;switch(y.type){case"text":this.drawText(y);break;case"image":this.drawImage(y);break}}}catch(e){l=true;_=e}finally{try{if(!r&&null!=d.return)d.return()}finally{if(l)throw _}}}},{key:"drawText",value:function drawText(e){if(!this.canvas)return;var t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return;var r=e.position,l=e.font,_=e.text,d=e.color,h=e.lineWidth,y=e.textAlign;t.font="".concat(l," ").concat(tF),t.fillStyle=null!=d?d:"#ffffff",h&&(t.lineWidth=h),y&&(t.textAlign=y),console.info("drawText",e);var p=_sliced_to_array(r,2),f=p[0],v=p[1];t.fillText(_,f,v)}},{key:"drawImage",value:function drawImage(e){if(!this.canvas)return;var t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return;var r=e.name,l=e.size,_=e.position,d=e.fallbackImage;var h=this.caches[r];if(!h&&d&&(h=this.caches[d]),!h)throw new Error("Image ".concat(r," not found"));console.info("drawImage",e);var y=_sliced_to_array(_,2),p=y[0],f=y[1],v=_sliced_to_array(l,2),g=v[0],m=v[1];t.drawImage(h,p,f,g,m)}},{key:"snapshotFrameAsync",value:function snapshotFrameAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:if(!e.canvas)return[2,null];t=null;if(!(nh.UseBlobIfPossible&&"toBlob"in e.canvas))return[3,2];return[4,e.createAsBlob()];case 1:t=r.sent();return[3,3];case 2:t=e.createAsDataImage();r.label=3;case 3:if(!t)throw new Error("Image data is null");return[2,(n_.isDebugger()&&nl.logImage(t),t)]}})})()}},{key:"createAsDataImage",value:function createAsDataImage(){if(!this.canvas)return null;var e=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!e)return null;var t=nh.Quality,r=nh.RenderType;return e.canvas.toDataURL("image/".concat(r),t)}},{key:"createAsBlob",value:function createAsBlob(){var e=this;return new Promise(function(t){if(!e.canvas){t(null);return}var r=nh.Quality,l=nh.RenderType;e.canvas.toBlob(function(e){if(!e){t(null);return}nl.blobToDataImage(e).then(function(e){t(e)})},"image/".concat(l),r)})}}]);return Xa}(l.Plugins.BasePlugin);c(ny,"FrameCapturePlugin");var np=ny;var nf=function(e){_inherits(Ja,e);var t=_create_super(Ja);function Ja(e,r){_class_call_check(this,Ja);var l;l=t.call(this,'Text with key "'.concat(e,'" not found in locale "').concat(r,'"'));u(_assert_this_initialized(l),"key");u(_assert_this_initialized(l),"locale");l.name="MissingKeyInLocaleError",l.key=e,l.locale=r;return l}return Ja}(_wrap_native_super(Error));c(nf,"MissingKeyInLocaleError");var nv=nf;var ng=function(e){_inherits(Za,e);var t=_create_super(Za);function Za(e){_class_call_check(this,Za);var r;r=t.call(this,"Locale not found: ".concat(e));u(_assert_this_initialized(r),"locale");r.name="LocaleNotFoundError",r.locale=e;return r}return Za}(_wrap_native_super(Error));c(ng,"LocaleNotFoundError");var nm=ng;var nA=r.Utils,nw=function(e){_inherits(tn,e);var t=_create_super(tn);function tn(){_class_call_check(this,tn);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"locale");u(_assert_this_initialized(e),"data",{});return e}_create_class(tn,[{key:"add",value:function add(e,t){this.data[e]=t}},{key:"choose",value:function choose(e){this.locale=e;var t=this.game,l=t.event;l.emit(r.Events.LANGUAGE_CHANGED,{locale:e})}},{key:"getText",value:function getText(e,t,r){try{var l=this.getLocaleData(r),_=l.text;if(!nA.Object.hasOwn(_,e)){var d=null!=r?r:this.getCurrentLocale();throw new nv(String(e),d)}var h=_[e];return this.replaceVariables(h,null!=t?t:[])}catch(t){return _instanceof(t,nv)?(console.warn('Text with key "'.concat(t.key,'" not found in locale "').concat(t.locale,'"')),t.key):_instanceof(t,nm)?(console.warn('Locale "'.concat(t.locale,'" not found')),String(e)):(console.error(t),String(e))}}},{key:"getTexture",value:function getTexture(e){var t=this.getLocaleData(),r=t.texture;return r[e]}},{key:"getCurrentLocale",value:function getCurrentLocale(){return this.locale||"en"}},{key:"getLocaleData",value:function getLocaleData(e){var t=null!=e?e:this.getCurrentLocale();if(!nA.Object.hasOwn(this.data,t))throw new nm(t);return this.data[t]}},{key:"replaceVariables",value:function replaceVariables(e,t){var r=t.length;if(0==r)return e;var l=e;for(var _=0;_<r;_++){var d=t[_],h="%{".concat(_,"}");l=l.replace(h,d)}return l}}]);return tn}(l.Plugins.BasePlugin);c(nw,"LanguagePlugin");var nI=nw;var nb={_id:"",name:"",createdBy:"",description:"",expireTime:6048e5,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15},nk=r.Configs,nS=r.Utils,nD=nS.Object,nP=nS.String,nE=nS.Valid,nC=nk.OtherHost,nx=nk.Mockup,nM=nk.AppId,nN=function(){function en(){_class_call_check(this,en);u(this,"mockAPI")}_create_class(en,[{key:"initMockAPI",value:function initMockAPI(){var e=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:if(e.mockAPI)return[2];return[4,d(_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tR})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:r=l.sent().default;if("function"!=typeof r)throw new Error("Cannot load LeaderboardAPIMock");e.mockAPI=new r;return[2]}})})()}},{key:"getLeaderboardAsync",value:function getLeaderboardAsync(e,t,r){var l=this;return _async_to_generator(function(){var _,d;return _ts_generator(this,function(h){switch(h.label){case 0:_=nP.params(r);if(!nx.Leaderboards.Enabled)return[3,6];return[4,l.initMockAPI()];case 1:h.sent();if(!("playerIds"in r))return[3,3];return[4,l.mockAPI.getPlayers(e,r)];case 2:d=h.sent();return[3,5];case 3:return[4,l.mockAPI.getLeaders(e,r)];case 4:d=h.sent();h.label=5;case 5:return[3,8];case 6:return[4,ed("".concat(t,"?").concat(_),{},nC)];case 7:d=h.sent();h.label=8;case 8:return[2,nD.hasOwn(d,"data")&&Array.isArray(d.data)?d.data:[]]}})})()}},{key:"getLeaderboardsAsync",value:function getLeaderboardsAsync(e){var t=this;return _async_to_generator(function(){var l,_,d,h;return _ts_generator(this,function(y){switch(y.label){case 0:_=r.Utils.String.params(e),d="leaderboards";if(!nx.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:y.sent();return[4,t.mockAPI.getLeaderboardsAsync(e)];case 2:h=y.sent();return[3,5];case 3:return[4,ed("".concat(d,"?").concat(_),{},nC)];case 4:h=(l=y.sent(),nD.hasOwn(l,"data")&&Array.isArray(l.data)?l.data:[]);y.label=5;case 5:return[2,h]}})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e){var t=this;return _async_to_generator(function(){var r,l,_;return _ts_generator(this,function(d){switch(d.label){case 0:r=e.leaderboardId,l=e.playerId,_=e.score;if(!nx.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:d.sent();return[4,t.mockAPI.setScoreAsync(r,l,_)];case 2:d.sent();return[3,5];case 3:return[4,eh("leaderboards/".concat(r,"/players/").concat(l),{score:_},{},nC)];case 4:d.sent();d.label=5;case 5:return[2]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h;return _ts_generator(this,function(y){switch(y.label){case 0:l=null!==(r=e._id)&&void 0!==r?r:nP.generateObjectId(),_=_object_spread_props(_object_spread({},nb,e),{_id:l,appId:nM}),d="leaderboards";if(!nx.Leaderboards.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:y.sent();return[4,t.mockAPI.createLeaderboard(_)];case 2:h=y.sent();return[3,5];case 3:return[4,eh(d,_,{},nC)];case 4:h=y.sent(),nD.hasOwn(h,"data")&&nE.isObject(h.data)&&(h=h.data);y.label=5;case 5:if(!nD.hasOwn(h,"_id")||h._id!==l)throw new Error("Create leaderboard failed");return[2,l]}})})()}}]);return en}();c(nN,"LeaderboardAPI");var nL=nN;var nO={limit:0,offset:0,leaders:{},isRequesting:!1},nT={leaderboards:{}},nR=r.Utils,nF=nR.Array,nG=nR.Valid,nV=nR.Json,nj=nR.Object,nB=function(e){_inherits(sn,e);var t=_create_super(sn);function sn(){_class_call_check(this,sn);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"lbAPI",new nL);u(_assert_this_initialized(e),"configs");return e}_create_class(sn,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("leaderboard",nT),this.configs={}}},{key:"addLeaderboard",value:function addLeaderboard(e){var t=e.name,r=e.type,l=e.leaderboardId,_=e.autoSortRank;if(this.getLeaderboard(t)){console.warn("Leaderboard with name ".concat(t," already exists"));return}var d="leaderboards/".concat(l,"/");("global"===r||"tournament"===r)&&(d+="leaders"),"friends"===r&&(d+="players"),this.configs[t]={id:l,name:t,type:r,host:d,autoSortRank:_};var h=nV.clone(nO);this.setLeaderboard(t,_object_spread({},h))}},{key:"requestLeaderboardsAsync",value:function requestLeaderboardsAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:l.trys.push([0,2,,3]);return[4,t.lbAPI.getLeaderboardsAsync(e)];case 1:return[2,l.sent()];case 2:r=l.sent();return[2,(console.warn("requestGlobalLeaderboardsAsync",r),[])];case 3:return[2]}})})()}},{key:"requestLeaderboardAsync",value:function requestLeaderboardAsync(e,t){var r=this;return _async_to_generator(function(){var l,_,d,h,y,p,f,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,,6,7]);r.validateLeaderboard(e),r.clearLeaderboard(e),r.setLeaderboard(e,{isRequesting:!0});l=r.configs[e],_=l.id,d=l.type,h=l.host;y=[];if("friends"!==d)return[3,2];p=r.game,f=p.player,v=f.getPlayerId(),g=f.getConnectedPlayerIds(t,0),m=[v].concat(_to_consumable_array(g));r.configs[e].playerIds=_to_consumable_array(m);return[4,r.lbAPI.getLeaderboardAsync(_,h,{playerIds:m})];case 1:y=A.sent();return[3,4];case 2:return[4,r.lbAPI.getLeaderboardAsync(_,h,{limit:t,offset:0})];case 3:y=A.sent();A.label=4;case 4:if(0===y.length)return[2];return[4,r.receiveLeaderboardAsync(e,y)];case 5:A.sent(),r.setLeaderboard(e,{limit:t,offset:0});return[3,7];case 6:r.setLeaderboard(e,{isRequesting:!1});return[7];case 7:return[2]}})})()}},{key:"loadMoreLeaderboardAsync",value:function loadMoreLeaderboardAsync(e,t){var r=this;return _async_to_generator(function(){var l,_,d,h,y,p,f,v;return _ts_generator(this,function(g){switch(g.label){case 0:l=r.getLeaderboard(e);if(!l)return[3,4];if("friends"===r.configs[e].type){console.warn("Cannot load more leaderboard with type friend");return[2]}g.label=1;case 1:g.trys.push([1,,3,4]);r.setLeaderboard(e,{isRequesting:!0});_=r.configs[e],d=_.id,h=_.host,y=l.offset,p=l.limit,f=y+p;return[4,r.lbAPI.getLeaderboardAsync(d,h,{limit:t,offset:f})];case 2:v=g.sent();if(0===v.length)return[2];r.receiveLeaderboardAsync(e,v),r.setLeaderboard(e,{limit:t,offset:f});return[3,4];case 3:r.setLeaderboard(e,{isRequesting:!1});return[7];case 4:return[2]}})})()}},{key:"getLeaderboard",value:function getLeaderboard(e){var t=this.game,r=t.storage,l=r.getStorageData("leaderboard","leaderboards");return l[e]?l[e]:null}},{key:"getLeadersByPlayerIdsAsync",value:function getLeadersByPlayerIdsAsync(e,t){var r=this;return _async_to_generator(function(){var l,_,d,h,y;return _ts_generator(this,function(p){switch(p.label){case 0:p.trys.push([0,2,,3]);r.validateLeaderboard(e);l=r.configs[e],_=l.id,d="leaderboards/".concat(_,"/players");return[4,r.lbAPI.getLeaderboardAsync(_,d,{playerIds:t})];case 1:h=p.sent();return[2,0===h.length?[]:r.toLeaders(h)];case 2:y=p.sent();return[2,(console.warn(y),[])];case 3:return[2]}})})()}},{key:"clearLeaderboard",value:function clearLeaderboard(e){try{this.validateLeaderboard(e);var t=nV.clone(nO);this.setLeaderboard(e,null),this.setLeaderboard(e,_object_spread({},t))}catch(e){console.warn(e)}}},{key:"isLeaderboardEmpty",value:function isLeaderboardEmpty(e){var t=this.getLeaderboard(e);if(!t)return!0;var r=t.leaders;return 0===Object.keys(r).length}},{key:"isExistLeaderboardId",value:function isExistLeaderboardId(e){var t=this,r=t.configs;return nj.vals(r).some(function(t){return t.id===e})}},{key:"getLeaderboardName",value:function getLeaderboardName(e){var t=this,r=t.configs,l=nF.search(nj.vals(r),function(t){return t.id===e});return l?l.name:null}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(e,t,r){var l=this;return _async_to_generator(function(){var _,d,h,y;return _ts_generator(this,function(p){switch(p.label){case 0:p.trys.push([0,3,,4]);l.validateLeaderboard(e);_=l.configs[e],d=_.id;return[4,l.getLastScoreOnLeaderboard(e,t)];case 1:h=p.sent();if(h&&r<=h)return[2];return[4,l.lbAPI.setLeaderboardScoreAsync({leaderboardId:d,playerId:t,score:r})];case 2:p.sent();return[3,4];case 3:y=p.sent();console.warn(y);return[3,4];case 4:return[2]}})})()}},{key:"getLastScoreOnLeaderboard",value:function getLastScoreOnLeaderboard(e,t){var r=this;return _async_to_generator(function(){var l;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,r.getLeadersByPlayerIdsAsync(e,[t])];case 1:l=_.sent();return[2,0===l.length?null:l[0].score]}})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){return[2,t.lbAPI.createLeaderboardAsync(e)]})})()}},{key:"validateLeaderboard",value:function validateLeaderboard(e){var t=this.getLeaderboard(e);if(!nG.isObject(t))throw new Error("Leaderboard with name ".concat(e," not found"))}},{key:"setLeaderboard",value:function setLeaderboard(e,t){var r=this.game,l=r.storage;l.setStorageData("leaderboard","leaderboards",_define_property({},e,t))}},{key:"receiveLeaderboardAsync",value:function receiveLeaderboardAsync(e,t){var r=this;return _async_to_generator(function(){var l,_,d,h,y,p,f,v,g,m,A,w;return _ts_generator(this,function(I){switch(I.label){case 0:r.validateLeaderboard(e);return[4,r.toLeaders(t)];case 1:_=I.sent().filter(function(e){return e.name&&e.photo}),d=null!==(l=r.getLeaderboard(e))&&void 0!==l?l:{},h=d.offset,y=void 0===h?0:h,p=d.leaders,f=void 0===p?{}:p,v=_.filter(function(e){return!f[e.playerId]});if(y>0&&v.length>0){m=nj.vals(f);(g=v).unshift.apply(g,_to_consumable_array(m))}A=v.sort(function(e,t){return t.score-e.score});r.configs[e].autoSortRank&&(A=A.map(function(e,t){return _object_spread_props(_object_spread({},e),{rank:t+1})}));w=nj.keyBy(A,"playerId");r.setLeaderboard(e,{leaders:w});return[2]}})})()}},{key:"toLeaders",value:function toLeaders(e){var t=this;return _async_to_generator(function(){var r,l,_,d;return _ts_generator(this,function(h){switch(h.label){case 0:r=t.game,l=r.profile,_=e.map(function(e){return e.playerId});return[4,l.requestProfiles(_)];case 1:h.sent();d=l.getProfiles();return[2,e.map(function(e){var t=e.playerId,r=d[t];return r?_object_spread_props(_object_spread({},e),{name:r.name,photo:r.photo}):_object_spread_props(_object_spread({},e),{name:"Nameless",photo:"default"})}).map(function(e){return _object_spread_props(_object_spread({},e),{score:parseInt(e.score,10)})})]}})})()}}]);return sn}(l.Plugins.BasePlugin);c(nB,"LeaderboardPlugin");var nH=nB;var nU=function(){function an(){_class_call_check(this,an);u(this,"APIHost")}_create_class(an,[{key:"setAPIHost",value:function setAPIHost(e){this.APIHost=e}},{key:"getAPIHost",value:function getAPIHost(){return this.APIHost}}]);return an}();c(nU,"BaseAPI");var nz=nU;var nK=r.Utils,nW=function(e){_inherits(nn,e);var t=_create_super(nn);function nn(){_class_call_check(this,nn);return t.apply(this,arguments)}_create_class(nn,[{key:"createSingleMatchAsync",value:function createSingleMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,eh("single-matches",e,{},t.getAPIHost())];case 1:r=l.sent();return[2,t.returnValidMatchData(r)]}})})()}},{key:"getSingleMatchDetailAsync",value:function getSingleMatchDetailAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,ed("single-matches/active",{},e.getAPIHost())];case 1:t=r.sent();return[2,e.returnValidMatchData(t)]}})})()}},{key:"updateSingleMatchMoveAsync",value:function updateSingleMatchMoveAsync(e,t){var r=this;return _async_to_generator(function(){var l,_;return _ts_generator(this,function(d){switch(d.label){case 0:l="single-matches/".concat(e,"/move");return[4,eh(l,t,{},r.getAPIHost())];case 1:_=d.sent();return[2,r.returnValidMatchData(_)]}})})()}},{key:"finishSingleMatchAsync",value:function finishSingleMatchAsync(e){var t=this;return _async_to_generator(function(){var r,l;return _ts_generator(this,function(_){switch(_.label){case 0:r="single-matches/".concat(e,"/finish");return[4,eh(r,{},{},t.getAPIHost())];case 1:l=_.sent();return[2,t.returnValidMatchData(l)]}})})()}},{key:"createEndlessMatchAsync",value:function createEndlessMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,eh("endless-matches",e,{},t.getAPIHost())];case 1:r=l.sent();return[2,t.returnValidMatchData(r)]}})})()}},{key:"getEndlessMatchDetailAsync",value:function getEndlessMatchDetailAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,ed("endless-matches/active",{},e.getAPIHost())];case 1:t=r.sent();return[2,e.returnValidMatchData(t)]}})})()}},{key:"updateEndlessMatchMilestoneAsync",value:function updateEndlessMatchMilestoneAsync(e,t){var r=this;return _async_to_generator(function(){var l,_;return _ts_generator(this,function(d){switch(d.label){case 0:l="endless-matches/".concat(e,"/milestone");return[4,eh(l,t,{},r.getAPIHost())];case 1:_=d.sent();return[2,r.returnValidMatchData(_)]}})})()}},{key:"finishEndlessMatchAsync",value:function finishEndlessMatchAsync(e){var t=this;return _async_to_generator(function(){var r,l;return _ts_generator(this,function(_){switch(_.label){case 0:r="endless-matches/".concat(e,"/finish");return[4,eh(r,{},{},t.getAPIHost())];case 1:l=_.sent();return[2,t.returnValidMatchData(l)]}})})()}},{key:"createMatchAsync",value:function createMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,eh("matches",e,{},t.getAPIHost())];case 1:r=l.sent();return[2,t.returnValidMatchData(r)]}})})()}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var t=this;return _async_to_generator(function(){var r,l;return _ts_generator(this,function(_){switch(_.label){case 0:r="matches/".concat(e,"/join");return[4,eh(r,{},{},t.getAPIHost())];case 1:l=_.sent();return[2,t.returnValidMatchData(l)]}})})()}},{key:"getMatchDetailByIdAsync",value:function getMatchDetailByIdAsync(e){var t=this;return _async_to_generator(function(){var r,l;return _ts_generator(this,function(_){switch(_.label){case 0:r="matches/".concat(e);return[4,ed(r,{},t.getAPIHost())];case 1:l=_.sent();return[2,t.returnValidMatchData(l)]}})})()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:r=e.matchId,l=void 0===r?"":r,_=e.score,d=void 0===_?0:_,h=e.level,y=void 0===h?0:h,p=e.extraData,f=void 0===p?{}:p,v="matches/".concat(l,"/finish");return[4,eh(v,{matchId:l,score:d,level:y,extraData:f},{},t.getAPIHost())];case 1:g=m.sent();return[2,t.returnValidMatchData(g)]}})})()}},{key:"returnValidMatchData",value:function returnValidMatchData(e){var t={};return nK.Valid.isObject(e)&&nK.Object.hasOwn(e,"data")&&(t=e.data),t}}]);return nn}(nz);c(nW,"MatchAPI");var nq=nW;var nJ=function(){function on(e){_class_call_check(this,on);u(this,"matchAPI");this.createAPI(),this.setAPIConfig(e)}_create_class(on,[{key:"createAPI",value:function createAPI(){this.matchAPI=new nq}},{key:"setAPIConfig",value:function setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}},{key:"setMatchAPIInstance",value:function setMatchAPIInstance(e){this.matchAPI=e}},{key:"getMatchAPI",value:function getMatchAPI(){return this.matchAPI}}]);return on}();c(nJ,"APIHandler");var nY=nJ;var nQ=function(){function rn(e,t){_class_call_check(this,rn);u(this,"game");u(this,"match");this.game=e,this.match=t}_create_class(rn,[{key:"startLog",value:function startLog(e){this.match.useCPUProfile&&console.profile(this.constructor.name),console.group("\uD83D\uDE80 ".concat(this.constructor.name)),e&&console.log("\uD83D\uDCE6 ? Payload:",e)}},{key:"endLog",value:function endLog(){console.groupEnd(),this.match.useCPUProfile&&console.profileEnd()}},{key:"processAsync",value:function processAsync(e){return _async_to_generator(function(){return _ts_generator(this,function(e){throw new Error("Not implemented")})})()}}]);return rn}();c(nQ,"BaseConcrete");var nX=nQ;var n$=function(e){_inherits(cn,e);var t=_create_super(cn);function cn(e){_class_call_check(this,cn);var r;r=t.call(this,e),r.name="LevelNotDefined",r.message=null!=e?e:"Level is not defined";return _possible_constructor_return(r)}return cn}(V);c(n$,"LevelNotDefined");var nZ=n$;var n0=function(e){_inherits(ln,e);var t=_create_super(ln);function ln(e){_class_call_check(this,ln);var r;r=t.call(this,e),r.name="MatchModeNotDefined",r.message=null!=e?e:"Match id is not defined";return _possible_constructor_return(r)}return ln}(V);c(n0,"MatchModeNotDefined");var n2=n0;var n1=r.Utils,n3=n1.Object,n4=n1.Valid,n5=function(){function dn(e){_class_call_check(this,dn);u(this,"game");u(this,"match");u(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}_create_class(dn,[{key:"setNext",value:function setNext(e){return this.nextHandler=e,e}},{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){console.groupCollapsed("➡️ ".concat(t.constructor.name)),t.logData("Before",e);return[2]})})()}},{key:"nextAsync",value:function nextAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:t.logData("After",e),console.groupEnd();r=t.nextHandler;if(!r)return[3,2];return[4,t.nextHandler.processAsync(e)];case 1:r=l.sent();l.label=2;case 2:return[2]}})})()}},{key:"logData",value:function logData(e,t){if(!n4.isDebugger())return;console.groupCollapsed("\uD83D\uDCE6 MatchState: ".concat(e));var r=t.profiles,l=t.customData,_=_object_without_properties(t,["profiles","customData"]);console.info("\uD83D\uDCBE Base"),console.table(n3.clone(_)),console.info("\uD83D\uDCBE Profile"),console.table(n3.clone(r)),console.info("\uD83D\uDCBE Custom"),console.table(n3.clone(l)),console.groupEnd()}}]);return dn}();c(n5,"BaseHandler");var n7=n5;var n6=r.Plugins,n8=r.Utils,n9=n6.Analytics,ae=n8.String,at=n8.Valid,aa=function(e){_inherits(hn,e);var t=_create_super(hn);function hn(){_class_call_check(this,hn);return t.apply(this,arguments)}_create_class(hn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(hn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l,_,d,h;return _ts_generator(this,function(y){switch(y.label){case 0:_superprop_get_processAsync().call(r,e);t=e.mode,l=e.customData,_=l.level;r.validateMode(t),r.validateLevel(_);d=r.game,h=d.analytics;h.event(n9.Events.MATCH_START,{level:_,game_mode:ae.toUpperCamelCase(t),level_name:"level_".concat(_)});return[4,r.nextAsync(e)];case 1:y.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!at.isString(e))throw new n2}},{key:"validateLevel",value:function validateLevel(e){if(!at.isNumber(e))throw new nZ}}]);return hn}(n7);c(aa,"LogMatchStartHandler");var ar=aa;var as={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},ac=function(e){_inherits(un,e);var t=_create_super(un);function un(){_class_call_check(this,un);return t.apply(this,arguments)}_create_class(un,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(un.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l,_;return _ts_generator(this,function(d){switch(d.label){case 0:_superprop_get_processAsync().call(r,e);t=e.mode,l=e.status;_=null!=t?t:eY.SINGLE;l===as.FINISHED&&(_=eY.SINGLE),r.contextGameModeDetected(_);return[4,r.nextAsync(e)];case 1:d.sent();return[2]}})})()}},{key:"contextGameModeDetected",value:function contextGameModeDetected(e){var t=this.game,r=t.storage;r.setStorageData("context","contextGameMode",e)}}]);return un}(n7);c(ac,"ContextGameModeHandler");var al=ac;var au=function(e){_inherits(pn,e);var t=_create_super(pn);function pn(e){_class_call_check(this,pn);var r;r=t.call(this,e),r.name="GetMatchDetailFailed",r.message=null!=e?e:"Get match detail failed";return _possible_constructor_return(r)}return pn}(_wrap_native_super(Error));c(au,"GetMatchDetailFailed");var a_=au;var ad=function(e){_inherits(yn,e);var t=_create_super(yn);function yn(e){_class_call_check(this,yn);var r;r=t.call(this,e),r.name="MatchAreNotActive",r.message=null!=e?e:"Match are not active";return _possible_constructor_return(r)}return yn}(_wrap_native_super(Error));c(ad,"MatchAreNotActive");var ah=ad;var ay=function(e){_inherits(fn,e);var t=_create_super(fn);function fn(e){_class_call_check(this,fn);var r;r=t.call(this,e),r.name="MatchIdNotValid",r.message=null!=e?e:"Match id is not valid";return _possible_constructor_return(r)}return fn}(V);c(ay,"MatchIdNotValid");var ap=ay;var af=function(e){_inherits(gn,e);var t=_create_super(gn);function gn(e){_class_call_check(this,gn);var r;r=t.call(this,e),r.name="OpponentHasFinishedMatch",r.message=e||"Opponent has finished match";return _possible_constructor_return(r)}return gn}(_wrap_native_super(Error));c(af,"OpponentHasFinishedMatch");var av=af;var ag=function(e){_inherits(wn,e);var t=_create_super(wn);function wn(e){_class_call_check(this,wn);var r;r=t.call(this,e),r.name="OpponentIdNotValid",r.message=null!=e?e:"Opponent id is not valid";return _possible_constructor_return(r)}return wn}(V);c(ag,"OpponentIdNotValid");var am=ag;var aA=function(e){_inherits(mn,e);var t=_create_super(mn);function mn(e){_class_call_check(this,mn);var r;r=t.call(this,e),r.name="PlayerNotCurrentInMatch",r.message=null!=e?e:"The player is not currently in this match";return _possible_constructor_return(r)}return mn}(_wrap_native_super(Error));c(aA,"PlayerNotCurrentInMatch");var aw=aA;var aI=function(e){_inherits(An,e);var t=_create_super(An);function An(e){_class_call_check(this,An);var r;r=t.call(this,e),r.name="PlayerNotFinishedMatch",r.message=e||"Player not finished match";return _possible_constructor_return(r)}return An}(_wrap_native_super(Error));c(aI,"PlayerNotFinishedMatch");var ab=aI;var ak=r.Dtos,aS=function(e){_inherits(In,e);var t=_create_super(In);function In(){_class_call_check(this,In);return t.apply(this,arguments)}_create_class(In,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(In.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l;return _ts_generator(this,function(_){switch(_.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.getMatchAsync(e)];case 1:t=_.sent(),l=new ak.Match.Data(t).toObject();r.validateAwaitMatchData(e,l),r.updateMatchData(e,l),r.validateMatchStatus(e),r.validatePlayerTurn(e),r.validateOpponentTurn(e);return[4,r.nextAsync(e)];case 2:_.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id;if("string"!=typeof t)throw new ap}},{key:"validateMatchStatus",value:function validateMatchStatus(e){var t=e.status;if(t!==as.ACTIVE)throw new ah}},{key:"validateAwaitMatchData",value:function validateAwaitMatchData(e,t){var r=e.id,l=e.customData,_=t._id,d=t.whitePlayerId,h=t.blackPlayerId;if("string"!=typeof _||_!==r)throw new a_;var y=l.playerId,p=d===y,f=h===y;if(!p&&h===F.playerId)throw new e4;if(!p&&!f)throw new aw}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,r=e.customData,l=r.playerId;if("string"!=typeof l)throw new B;var _=t[l],d=_.finished;if(!d)throw new ab}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,r=e.customData,l=r.opponentId;if("string"!=typeof l)throw new am;var _=t[l],d=_.finished;if(d)throw new av}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){r=e.id;return[2,r?t.match.api.getMatchAPI().getMatchDetailByIdAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,l=t.whitePlayerId,_=t.blackPlayerId,d=t.whitePlayerScore,h=t.blackPlayerScore,y=t.whitePlayerFinish,p=t.blackPlayerFinish,f=t.status;e.status=f;var v=l===r.playerId,g=v?l:_,m=v?_:l;e.customData.playerId=g,e.customData.opponentId=m,e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1}),e.profiles[m]||(e.profiles[m]={id:m,name:"",photo:"",finished:!1});var A=v?d:h,w=v?h:d;e.profiles[g].score=A,e.profiles[m].score=w;var I=v?y:p,b=v?p:y;e.profiles[g].finished=I,e.profiles[m].finished=b}}]);return In}(n7);c(aS,"AwaitMatchHandler");var aD=aS;var aP={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},aE=function(e){_inherits(Dn,e);var t=_create_super(Dn);function Dn(e,r){_class_call_check(this,Dn);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(Dn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Dn.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.initializeMatch(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"initializeMatch",value:function initializeMatch(e){var t=this.payload,r=t.id,l=t.mode,_=t.customData;e.id=null!=r?r:null,e.mode=l||null,e.status=as.OPEN,e.startAt=0,e.finishAt=0,e.profiles={},e.customData=_object_spread({},aP,e.customData,_)}}]);return Dn}(n7);c(aE,"PrepareMatchHandler");var aC=aE;var ax=eJ,aM=function(e){_inherits(Pn,e);var t=_create_super(Pn);function Pn(e){_class_call_check(this,Pn);var r;r=t.call(this,e),r.name="UnavailableFeature",r.message="Unavailable feature: ".concat(e);return _possible_constructor_return(r)}return Pn}(_wrap_native_super(Error));c(aM,"UnavailableFeature");var aN=aM;var aL=function(e){_inherits(xn,e);var t=_create_super(xn);function xn(e){_class_call_check(this,xn);var r;r=t.call(this,e),r.name="ContextIdNotValid",r.message=null!=e?e:"Context id is not valid";return _possible_constructor_return(r)}return xn}(V);c(aL,"ContextIdNotValid");var aO=aL;var aT=function(e){_inherits(En,e);var t=_create_super(En);function En(){_class_call_check(this,En);return t.apply(this,arguments)}_create_class(En,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(En.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesAwaitingAsync(e)];case 1:t=l.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,l=r.contextId,_=r.opponentId;if(!t||"string"!=typeof t)throw new ap;if(!l||"string"!=typeof l)throw new aO;if(!_||"string"!=typeof _)throw new am}},{key:"createWideframesAwaitingAsync",value:function createWideframesAwaitingAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g,m,A,w,I,b,k,S,D;return _ts_generator(this,function(P){switch(P.label){case 0:P.trys.push([0,4,,5]);r=t.game,l=r.frameCapture,_=e.profiles,d=e.customData,h=d.playerId,y=d.opponentId;if(!h||!y)return[2,null];p=_[h],f=_[y],v=p.photo,g=p.score,m=void 0===g?0:g,A=p.finished;if(!A)return[2,null];w=f.photo,I=f.score,b=void 0===I?0:I,k=f.finished;if(!k)return[3,1];S=null;return[3,3];case 1:return[4,l.wideframe.renderResultChallenge({playerId:h,playerPhoto:v,playerScore:m,opponentId:y,opponentPhoto:w,opponentScore:b,isPlayerFinished:!0,isOpponentFinished:!1})];case 2:S=P.sent();P.label=3;case 3:return[2,S];case 4:D=P.sent();return[2,(console.warn("createWideframesAwaitingAsync",D),null)];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,l,_,d,h,y,p,f;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,l=e.profiles,_=e.customData,d=_.playerId,h=_.opponentId;if(!d||"string"!=typeof d)throw new B;if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");y=l[d],p=y.name,f={data:{type:ax.CHALLENGE_FRIEND,matchId:r,playerId:d,opponentId:h},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(p," is waiting for you to finish this game. Play now!"),localizations:{vi_VN:"".concat(p," đang chờ bạn kết th\xfac trận đấu. Chơi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(f)];case 1:v.sent();return[2]}})})()}}]);return En}(n7);c(aT,"SendAwaitingMessageHandler");var aR=aT;var aF=function(e){_inherits(Sn,e);var t=_create_super(Sn);function Sn(){_class_call_check(this,Sn);return t.apply(this,arguments)}_create_class(Sn,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){return _ts_generator(this,function(r){switch(r.label){case 0:return[4,t.nextAsync(e)];case 1:r.sent();return[2]}})})()}},{key:"nextAsync",value:function nextAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:r=t.nextHandler;if(!r)return[3,2];return[4,t.nextHandler.processAsync(e)];case 1:r=l.sent();l.label=2;case 2:return[2]}})})()}}]);return Sn}(n7);c(aF,"NothingHandler");var aG=aF;var aV=function(e){_inherits(vn,e);var t=_create_super(vn);function vn(e){_class_call_check(this,vn);var r;r=t.call(this,e),r.name="ProfileNotFound",r.message=null!=e?e:"Profile not found";return _possible_constructor_return(r)}return vn}(V);c(aV,"ProfileNotFound");var aj=aV;var aB=r.Dtos,aH=function(e){_inherits(bn,e);var t=_create_super(bn);function bn(){_class_call_check(this,bn);return t.apply(this,arguments)}_create_class(bn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(bn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l,_,d,h,y;return _ts_generator(this,function(p){switch(p.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);t=e.customData,l=t.playerId,_=t.opponentId;d=l;return[4,r.getProfile(d)];case 1:h=p.sent();if(!h)throw new aj;if(r.updateMatchProfile(e,d,h),d=_,d===F.playerId)return[3,3];return[4,r.getProfile(d)];case 2:y=p.sent();if(!y)throw new aj;r.updateMatchProfile(e,d,y);return[3,4];case 3:r.updateMatchProfile(e,d);p.label=4;case 4:return[4,r.nextAsync(e)];case 5:p.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.customData,r=t.playerId,l=t.opponentId;if(!r||"string"!=typeof r)throw new B;if(!l||"string"!=typeof l)throw new am}},{key:"getProfile",value:function getProfile(e){var t=this;return _async_to_generator(function(){var r,l;return _ts_generator(this,function(_){switch(_.label){case 0:r=t.game,l=r.profile;return[4,l.requestProfiles([e])];case 1:return[2,(_.sent(),l.getProfiles()[e])]}})})()}},{key:"updateMatchProfile",value:function updateMatchProfile(e,t,r){var l=null!=r?r:F,_=l.name,d=l.photo,h=new aB.Match.Profile({id:t,name:_,photo:d}).toObject();e.profiles[t]?(e.profiles[t].name=h.name,e.profiles[t].photo=h.photo):e.profiles[t]=h}}]);return bn}(n7);c(aH,"GetMatchProfilesHandler");var aU=aH;var az=function(e){_inherits(Nn,e);var t=_create_super(Nn);function Nn(){_class_call_check(this,Nn);return t.apply(this,arguments)}_create_class(Nn,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,,2,3]);t.startLog(e);r=e.matchId,l=e.playerId,_=e.opponentId,d=new aG(t),y=new aC(t,{id:r,mode:h.CHALLENGE_FRIEND,customData:{playerId:l,opponentId:_}});d.setNext(y);p=new aD(t);y.setNext(p);f=new aU(t);p.setNext(f);v=new aR(t);f.setNext(v);g=new ar(t);v.setNext(g);m=new al(t);g.setNext(m);A=t.match.getMatchState();return[4,d.processAsync(A)];case 1:w.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Nn}(nX);c(az,"AwaitChallengeMatchConcrete");var aK=az;var aW=function(e){_inherits(Cn,e);var t=_create_super(Cn);function Cn(e){_class_call_check(this,Cn);var r;r=t.call(this,e),r.name="CreateContextFailed",r.message=null!=e?e:"Create context failed";return _possible_constructor_return(r)}return Cn}(V);c(aW,"CreateContextFailed");var aq=aW;var aJ=r.Utils,aY=aJ.Valid,aQ=aJ.Object,aX=function(e){_inherits(On,e);var t=_create_super(On);function On(e,r){_class_call_check(this,On);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(On,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(On.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l,_;return _ts_generator(this,function(d){switch(d.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,l=t.opponentId;return[4,r.createAsync(l)];case 1:_=d.sent();e.customData.contextId=_;return[4,r.nextAsync(e)];case 2:d.sent();return[2]}})})()}},{key:"createAsync",value:function createAsync(e){var t=this;return _async_to_generator(function(){var r,l;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,GameSDK.context.createAsync(e)];case 1:_.sent();return[3,3];case 2:r=_.sent();t.validateError(r);return[3,3];case 3:l=GameSDK.context.getID();if(!aY.isString(l))throw new aq;return[2,l]}})})()}},{key:"validateError",value:function validateError(e){if(!aQ.hasOwn(e,"code"))throw e;if("SAME_CONTEXT"!==e.code){if("INVALID_PARAM"===e.code){if(!this.isNotConnectedPlayerError(e))throw e;return}throw e}}},{key:"validateErrorMessage",value:function validateErrorMessage(e){if(!aQ.hasOwn(e,"message")||!aY.isString(e.message))throw e}},{key:"isNotConnectedPlayerError",value:function isNotConnectedPlayerError(e){return this.validateErrorMessage(e),e.message.indexOf("is not a connected player of the current player")>-1}}]);return On}(n7);c(aX,"CreateContextHandler");var a$=aX;var aZ=function(e){_inherits(Ln,e);var t=_create_super(Ln);function Ln(e){_class_call_check(this,Ln);var r;r=t.call(this,e),r.name="MatchAreNotOpen",r.message=null!=e?e:"Match are not open";return _possible_constructor_return(r)}return Ln}(V);c(aZ,"MatchAreNotOpen");var a0=aZ;var a2=r.Dtos,a1=function(e){_inherits(Tn,e);var t=_create_super(Tn);function Tn(e,r){_class_call_check(this,Tn);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(Tn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Tn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l;return _ts_generator(this,function(_){switch(_.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createMatchAsync(e)];case 1:t=_.sent(),l=new a2.Match.Data(t).toObject();r.updateMatchState(e,l);return[4,r.nextAsync(e)];case 2:_.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.status,r=e.customData,l=r.opponentId;if("string"!=typeof l)throw new am;if(t!==as.OPEN)throw new a0}},{key:"createMatchAsync",value:function createMatchAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h;return _ts_generator(this,function(y){r=e.customData,l=r.opponentId,_=t.payload,d=_.extraData;if(!l)return[2,{}];h={opponentPlayerId:l,extraData:d};return[2,t.match.api.getMatchAPI().createMatchAsync(h)]})})()}},{key:"updateMatchState",value:function updateMatchState(e,t){var r=e.customData,l=t._id,_=t.whitePlayerId,d=t.blackPlayerId,h=t.whitePlayerFinish,y=t.blackPlayerFinish,p=_===r.opponentId;e.id=l||null;var f=p?d:_,v=p?_:d;e.customData.playerId=f,e.customData.opponentId=v,e.profiles[f]||(e.profiles[f]={id:f,name:"",photo:"",finished:!1}),e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!1});var g=p?y:h,m=p?h:y;e.profiles[f].finished=g,e.profiles[v].finished=m}}]);return Tn}(n7);c(a1,"CreateMatchHandler");var a3=a1;var a4=function(e){_inherits(Mn,e);var t=_create_super(Mn);function Mn(){_class_call_check(this,Mn);return t.apply(this,arguments)}_create_class(Mn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Mn.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:if(_superprop_get_processAsync().call(r,e),e.status!==as.OPEN)throw new a0;r.startMatch(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"startMatch",value:function startMatch(e){e.status=as.ACTIVE,e.startAt=Date.now()}}]);return Mn}(n7);c(a4,"StartMatchHandler");var a5=a4;var a7=function(e){_inherits(Rn,e);var t=_create_super(Rn);function Rn(){_class_call_check(this,Rn);return t.apply(this,arguments)}_create_class(Rn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Rn.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesChallengeAsync(e)];case 1:t=l.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,l=r.contextId,_=r.opponentId;if(!t||"string"!=typeof t)throw new ap;if(!l||"string"!=typeof l)throw new aO;if(!_||"string"!=typeof _)throw new am}},{key:"createWideframesChallengeAsync",value:function createWideframesChallengeAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g,m,A,w,I,b;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,3]);r=t.game,l=r.frameCapture,_=e.profiles,d=e.customData,h=d.playerId,y=d.opponentId;if(!h||!y)return[2,null];p=_[h],f=_[y],v=p.photo,g=p.score,m=void 0===g?0:g,A=f.photo,w=f.score,I=void 0===w?0:w;return[4,l.wideframe.renderResultChallenge({playerId:h,playerPhoto:v,playerScore:m,opponentId:y,opponentPhoto:A,opponentScore:I,isPlayerFinished:!1,isOpponentFinished:!1})];case 1:return[2,k.sent()];case 2:b=k.sent();return[2,(console.warn("createWideframesChallengeAsync",b),null)];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,l,_,d,h,y,p,f;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,l=e.profiles,_=e.customData,d=_.playerId,h=_.opponentId;if(!d||"string"!=typeof d)throw new B;if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");y=l[d],p=y.name,f={data:{type:ax.CHALLENGE_FRIEND,matchId:r,playerId:d,opponentId:h},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(p," challenges you"),localizations:{vi_VN:"".concat(p," thử th\xe1ch bạn trong trận đấu n\xe0y. Chơi ngay!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(f)];case 1:v.sent();return[2]}})})()}}]);return Rn}(n7);c(a7,"SendChallengeMessageHandler");var a6=a7;var a8=function(e){_inherits(_n,e);var t=_create_super(_n);function _n(){_class_call_check(this,_n);return t.apply(this,arguments)}_create_class(_n,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g,m,A,w;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,l=e.opponentId,_=new aG(t),d=new a$(t,{opponentId:l});_.setNext(d);y=new aC(t,{mode:h.CHALLENGE_FRIEND,customData:{playerId:r,opponentId:l}});d.setNext(y);p=new a3(t,{extraData:e.extraData});y.setNext(p);f=new aU(t);p.setNext(f);v=new a5(t);f.setNext(v);g=new ar(t);v.setNext(g);m=new a6(t);g.setNext(m);A=new al(t);m.setNext(A);w=t.match.getMatchState();return[4,_.processAsync(w)];case 1:I.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return _n}(nX);c(a8,"ChallengeFriendConcrete");var a9=a8;var re=function(e){_inherits($n,e);var t=_create_super($n);function $n(e){_class_call_check(this,$n);var r;r=t.call(this,e),r.name="SameContext",r.message=null!=e?e:"Same context";return _possible_constructor_return(r)}return $n}(_wrap_native_super(Error));c(re,"SameContext");var rt=re;var ra=r.Utils,rr=function(e){_inherits(Gn,e);var t=_create_super(Gn);function Gn(e,r){_class_call_check(this,Gn);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(Gn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Gn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l;return _ts_generator(this,function(_){switch(_.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,l=t.contextId;return[4,r.switchAsync(l)];case 1:_.sent(),e.customData.contextId=l;return[4,r.nextAsync(e)];case 2:_.sent();return[2]}})})()}},{key:"checkSameContext",value:function checkSameContext(e){var t="SOLO"===e,r=GameSDK.context.getID();if(r===e)throw new rt;if(t&&null===r)throw new rt}},{key:"switchAsync",value:function switchAsync(e){var t=this;return _async_to_generator(function(){var r,l;return _ts_generator(this,function(_){switch(_.label){case 0:r="SOLO"===e;_.label=1;case 1:_.trys.push([1,3,,4]);t.checkSameContext(e);return[4,GameSDK.context.switchAsync(e,r)];case 2:_.sent();return[3,4];case 3:l=_.sent();if(_instanceof(l,rt))return[2];if(!ra.Object.hasOwn(l,"code"))throw l;if(ra.Device.isAndroid()&&r&&"INVALID_PARAM"===l.code)return[2];if("SAME_CONTEXT"!==l.code)throw l;return[3,4];case 4:return[2]}})})()}}]);return Gn}(n7);c(rr,"SwitchContextHandler");var rs=rr;var rc=r.Dtos,rl=function(e){_inherits(Vn,e);var t=_create_super(Vn);function Vn(){_class_call_check(this,Vn);return t.apply(this,arguments)}_create_class(Vn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Vn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l;return _ts_generator(this,function(_){switch(_.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.getMatchAsync(e)];case 1:t=_.sent(),l=new rc.Match.Data(t).toObject();r.validateContinueMatchData(e,l),r.updateMatchData(e,l),r.validatePlayerTurn(e);return[4,r.nextAsync(e)];case 2:_.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id,r=e.status;if("string"!=typeof t)throw new ap;if(r!==as.OPEN)throw new a0}},{key:"validateContinueMatchData",value:function validateContinueMatchData(e,t){var r=e.id,l=e.customData,_=t._id,d=t.whitePlayerId,h=t.blackPlayerId;if("string"!=typeof _||_!==r)throw console.warn("\uD83E\uDD16 ? respMatchDataValidated",t),new a_;var y=l.playerId,p=d===y,f=h===y;if(!p&&h===F.playerId)throw new e4;if(!p&&!f)throw new aw}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,r=e.customData,l=r.playerId;if("string"!=typeof l)throw new B;var _=t[l],d=_.finished;if(d)throw new e1}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){r=e.id;return[2,r?t.match.api.getMatchAPI().getMatchDetailByIdAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,l=t.whitePlayerId,_=t.blackPlayerId,d=t.whitePlayerScore,h=t.blackPlayerScore,y=t.whitePlayerFinish,p=t.blackPlayerFinish,f=l===r.playerId,v=f?l:_,g=f?_:l;e.customData.playerId=v,e.customData.opponentId=g,e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});var m=f?d:h,A=f?h:d;e.profiles[v].score=m,e.profiles[g].score=A;var w=f?y:p,I=f?p:y;e.profiles[v].finished=w,e.profiles[g].finished=I}}]);return Vn}(n7);c(rl,"ContinueMatchHandler");var ru=rl;var r_=function(e){_inherits(Fn,e);var t=_create_super(Fn);function Fn(){_class_call_check(this,Fn);return t.apply(this,arguments)}_create_class(Fn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Fn.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesCurrentScoreAsync()];case 1:t=l.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,l=r.contextId,_=r.opponentId;if(!t||"string"!=typeof t)throw new ap;if(!l||"string"!=typeof l)throw new aO;if(!_||"string"!=typeof _)throw new am}},{key:"createWideframesCurrentScoreAsync",value:function createWideframesCurrentScoreAsync(){var e=this;return _async_to_generator(function(){var t,r,l,_,d,h,y,p,f,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,2,,3]);t=e.game,r=t.player,l=t.frameCapture,_=r.getPlayer(),d=_.playerId,h=_.photo,y=e.match.getMatchState(),p=y.profiles,f=p[d]||{},v=f.score,g=void 0===v?0:v;return[4,l.wideframe.renderShareScore({playerId:d,playerPhoto:h,playerScore:g})];case 1:return[2,A.sent()];case 2:m=A.sent();return[2,(console.warn("createWideframesCurrentScoreAsync",m),null)];case 3:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,l,_,d,h,y,p,f;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,l=e.profiles,_=e.customData,d=_.playerId,h=_.opponentId;if(!d||"string"!=typeof d)throw new B;if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");y=l[d],p=y.name,f={data:{type:ax.CHALLENGE_FRIEND,matchId:r,playerId:d,opponentId:h},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(p," made an update."),localizations:{vi_VN:"".concat(p," đ\xe3 cập nhật trận đấu. Chơi ngay!")}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");return[4,GameSDK.extra.updateAsync(f)];case 1:v.sent();return[2]}})})()}}]);return Fn}(n7);c(r_,"SendUpdateMessageHandler");var rd=r_;var rh=function(e){_inherits(Un,e);var t=_create_super(Un);function Un(){_class_call_check(this,Un);return t.apply(this,arguments)}_create_class(Un,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g,m,A,w,I,b;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,,2,3]);t.startLog(e);r=e.contextId,l=e.matchId,_=e.playerId,d=e.opponentId,y=new aG(t),p=new rs(t,{contextId:r});y.setNext(p);f=new aC(t,{id:l,mode:h.CHALLENGE_FRIEND,customData:{playerId:_,opponentId:d}});p.setNext(f);v=new ru(t);f.setNext(v);g=new aU(t);v.setNext(g);m=new a5(t);g.setNext(m);A=new rd(t);m.setNext(A);w=new ar(t);A.setNext(w);I=new al(t);w.setNext(I);b=t.match.getMatchState();return[4,y.processAsync(b)];case 1:k.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Un}(nX);c(rh,"ContinueChallengeMatchConcrete");var ry=rh;var rp=r.Plugins,rf=r.Utils,rv=rp.Analytics,rg=rf.String,rm=rf.Valid,rA=function(e){_inherits(kn,e);var t=_create_super(kn);function kn(){_class_call_check(this,kn);return t.apply(this,arguments)}_create_class(kn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(kn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l,_,d,h,y,p,f;return _ts_generator(this,function(v){switch(v.label){case 0:_superprop_get_processAsync().call(r,e);t=e.customData,l=e.mode,_=e.startAt,d=e.finishAt,h=t.level;r.validateMode(l),r.validateLevel(h);y=r.game,p=y.analytics,f=Math.floor((d-_)/1e3);p.event(rv.Events.MATCH_END,{level:h,game_mode:rg.toUpperCamelCase(l),level_name:"level_".concat(h),time_played:f});return[4,r.nextAsync(e)];case 1:v.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!rm.isString(e))throw new n2}},{key:"validateLevel",value:function validateLevel(e){if(!rm.isNumber(e))throw new nZ}}]);return kn}(n7);c(rA,"LogMatchFinishedHandler");var rw=rA;var rI=function(e){_inherits(Bn,e);var t=_create_super(Bn);function Bn(e){_class_call_check(this,Bn);var r;r=t.call(this,e),r.name="PlayerNotLoggedIn",r.message=e||"Player is not logged in";return _possible_constructor_return(r)}return Bn}(_wrap_native_super(Error));c(rI,"PlayerNotLoggedIn");var rb=rI;var rk=function(e){_inherits(jn,e);var t=_create_super(jn);function jn(e){_class_call_check(this,jn);var r;r=t.call(this,e),r.name="ScoreNotValid",r.message=null!=e?e:"Score is not valid";return _possible_constructor_return(r)}return jn}(_wrap_native_super(Error));c(rk,"ScoreNotValid");var rS=rk;var rD=function(e){_inherits(Kn,e);var t=_create_super(Kn);function Kn(e){_class_call_check(this,Kn);var r;r=t.call(this,e),r.name="LeaderboardIdNotValid",r.message=null!=e?e:"Leaderboard id is not valid";return _possible_constructor_return(r)}return Kn}(_wrap_native_super(Error));c(rD,"LeaderboardIdNotValid");var rP=rD;var rE=function(e){_inherits(Wn,e);var t=_create_super(Wn);function Wn(e){_class_call_check(this,Wn);var r;r=t.call(this,e),r.name="LeaderboardNotExist",r.message=null!=e?e:"Leaderboard not exist in game";return _possible_constructor_return(r)}return Wn}(_wrap_native_super(Error));c(rE,"LeaderboardNotExist");var rC=rE;var rx=r.Utils,rM=rx.Valid,rN=function(e){_inherits(zn,e);var t=_create_super(zn);function zn(e,r){_class_call_check(this,zn);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");u(_assert_this_initialized(l),"leaderboardPayload");l.payload=r;return l}_create_class(zn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(zn.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.setupSetScorePayload(e),r.setLeaderboardScoreAsync();return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y;return _ts_generator(this,function(p){r=e.profiles,l=e.customData,_=l.playerId;if(!_||!r[_])throw new aj;d=t.payload,h=d.score,y=d.leaderboardId;if(!rM.isNumber(h))throw new rS;if(!rM.isString(y))throw new rP;t.leaderboardPayload={score:h,playerId:_,leaderboardId:y};return[2]})})()}},{key:"setLeaderboardScoreAsync",value:function setLeaderboardScoreAsync(){var e=this;return _async_to_generator(function(){var t,r,l,_,d,h;return _ts_generator(this,function(y){switch(y.label){case 0:y.trys.push([0,2,,3]);t=e.leaderboardPayload,r=t.playerId,l=t.score,_=t.leaderboardId,d=e.game.leaderboard.getLeaderboardName(_);if(!d)throw new rC;return[4,e.game.leaderboard.setLeaderboardScoreAsync(d,r,l)];case 1:y.sent();return[3,3];case 2:h=y.sent();console.warn("setLeaderboardScoreAsync",h);return[3,3];case 3:return[2]}})})()}}]);return zn}(n7);c(rN,"SetLeaderboardScoreHandler");var rL=rN;var rO=r.Utils,rT=rO.Valid,rR=r.Configs,rF=rR.Leaderboards,rG=function(e){_inherits(Hn,e);var t=_create_super(Hn);function Hn(e){_class_call_check(this,Hn);return t.call(this,e,{score:0,leaderboardId:rF.LeaderboardId})}_create_class(Hn,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;var r=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(Hn.prototype),"setupSetScorePayload",t)};return _async_to_generator(function(){var t,l,_,d,h;return _ts_generator(this,function(y){if(GameSDK.player.isGuest())throw new rb;t=e.profiles,l=e.customData,_=l.playerId;if(!_||!t[_])throw new aj;d=t[_],h=d.score;if(!rT.isNumber(h))throw new rS;r.payload.score=h,_superprop_get_setupSetScorePayload().call(r,e);return[2]})})()}}]);return Hn}(rL);c(rG,"PostGlobalLeaderboardScoreHandler");var rV=rG;var rj=r.Dtos,rB=r.Utils,rH=rB.Valid,rU=rB.Object,rz=function(e){_inherits(qn,e);var t=_create_super(qn);function qn(e,r){_class_call_check(this,qn);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(qn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(qn.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l,_,d;return _ts_generator(this,function(h){switch(h.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);t=r.payload,l=t.useAPI;if(!l)return[3,2];return[4,r.finishMatchAsync(e)];case 1:_=h.sent(),d=new rj.Match.Data(_).toObject();r.updateMatchFromAPI(e,d);return[3,3];case 2:r.updateMatchData(e);h.label=3;case 3:r.updateMatchState(e);return[4,r.nextAsync(e)];case 4:h.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.status,r=e.profiles,l=e.customData;if(t!==as.ACTIVE)throw new ah;var _=l.playerId;if(!_||!rU.hasOwn(r,_))throw new aw}},{key:"updateMatchData",value:function updateMatchData(e){var t=e.customData,r=t.playerId;if(!rH.isString(r))throw new B;e.profiles[r].finished=!0}},{key:"updateMatchState",value:function updateMatchState(e){e.status=as.FINISHED,e.finishAt=Date.now()}},{key:"finishMatchAsync",value:function finishMatchAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g;return _ts_generator(this,function(m){r=e.id,l=e.profiles,_=e.customData,d=_.level,h=_.playerId;if(!rH.isString(h))throw new B;y=l[h],p=y.score,f=t.payload,v=f.extraData,g={matchId:null!=r?r:"",score:p,level:d,extraData:v};return[2,t.match.api.getMatchAPI().finishMatchAsync(g)]})})()}},{key:"updateMatchFromAPI",value:function updateMatchFromAPI(e,t){var r=e.customData,l=r.playerId,_=r.opponentId;if(!rH.isString(l))throw new B;if(!rH.isString(_))throw new am;var d=t.whitePlayerId,h=t.whitePlayerScore,y=t.blackPlayerScore,p=t.whitePlayerFinish,f=t.blackPlayerFinish,v=l===d,g=v?h:y,m=v?y:h,A=v?p:f,w=v?f:p;e.profiles[l].score=g,e.profiles[_].score=m,e.profiles[l].finished=A,e.profiles[_].finished=w}}]);return qn}(n7);c(rz,"FinishMatchHandler");var rK=rz;var rW=function(e){_inherits(Yn,e);var t=_create_super(Yn);function Yn(){_class_call_check(this,Yn);return t.apply(this,arguments)}_create_class(Yn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Yn.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesResultAsync(e)];case 1:t=l.sent();t&&r.progressSendFinishedMessage(e,t);return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,l=r.contextId,_=r.opponentId;if(!t||"string"!=typeof t)throw new ap;if(!l||"string"!=typeof l)throw new aO;if(!_||"string"!=typeof _)throw new am}},{key:"createWideframesResultAsync",value:function createWideframesResultAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g,m,A,w,I,b,k,S;return _ts_generator(this,function(D){switch(D.label){case 0:D.trys.push([0,2,,3]);r=t.game,l=r.frameCapture,_=e.profiles,d=e.customData,h=d.playerId,y=d.opponentId;if(!h||!y)return[2,null];p=_[h],f=_[y],v=p.photo,g=p.score,m=void 0===g?0:g,A=p.finished,w=f.photo,I=f.score,b=void 0===I?0:I,k=f.finished;return[4,l.wideframe.renderResultChallenge({playerId:h,playerPhoto:v,playerScore:m,opponentId:y,opponentPhoto:w,opponentScore:b,isPlayerFinished:!!A,isOpponentFinished:!!k})];case 1:return[2,D.sent()];case 2:S=D.sent();return[2,(console.warn("createWideframesResultAsync",S),null)];case 3:return[2]}})})()}},{key:"progressSendFinishedMessage",value:function progressSendFinishedMessage(e,t){var r=e.profiles,l=e.customData,_=l.playerId,d=l.opponentId;if(!_||"string"!=typeof _)throw new B;if(!d||"string"!=typeof d)throw new am;var h=r[_],y=h.score,p=void 0===y?0:y,f=h.finished,v=r[d],g=v.score,m=void 0===g?0:g,A=v.finished;f?this.sendFinishMessageAsync(e,t):A&&p>m?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}},{key:"sendFinishMessageAsync",value:function sendFinishMessageAsync(e,t){return _async_to_generator(function(){var r,l,_,d,h,y,p,f;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,l=e.profiles,_=e.customData,d=_.playerId,h=_.opponentId;if(!d||"string"!=typeof d)throw new B;if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");y=l[d],p=y.name,f={data:{type:ax.CHALLENGE_FRIEND,matchId:r,playerId:d,opponentId:h,status:as.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(p," just finished. Check them now."),localizations:{vi_VN:"".concat(p," vừa ho\xe0n th\xe0nh m\xe0n chơi. Nhấn để xem kết quả trận đấu.")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");return[4,GameSDK.extra.updateAsync(f)];case 1:v.sent();return[2]}})})()}},{key:"sendPlayTurnMessageAsync",value:function sendPlayTurnMessageAsync(e,t){return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v;return _ts_generator(this,function(g){switch(g.label){case 0:r=e.id,l=e.profiles,_=e.customData,d=_.playerId,h=_.opponentId;if(!d||"string"!=typeof d)throw new B;y=l[d],p=y.name,f=y.score,v={data:{type:ax.CHALLENGE_FRIEND,matchId:r,playerId:d,opponentId:h,status:as.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(p," got ").concat(f," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(p," đ\xe3 đạt ").concat(f," điểm! Nhấn Chơi để so t\xe0i!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");return[4,GameSDK.extra.updateAsync(v)];case 1:g.sent();return[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v;return _ts_generator(this,function(g){switch(g.label){case 0:r=e.id,l=e.profiles,_=e.customData,d=_.playerId,h=_.opponentId;if(!d||"string"!=typeof d)throw new B;y=l[d],p=y.name,f=y.score,v={data:{type:ax.CHALLENGE_FRIEND,matchId:r,playerId:d,opponentId:h,status:as.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:"".concat(p," beat your high score. Their score: ").concat(f),localizations:{vi_VN:"".concat(p," đ\xe3 vượt qua điểm số của bạn, với ").concat(f," điểm!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");return[4,GameSDK.extra.updateAsync(v)];case 1:g.sent();return[2]}})})()}}]);return Yn}(n7);c(rW,"SendFinishedMessageHandler");var rq=rW;var rJ=function(e){_inherits(Qn,e);var t=_create_super(Qn);function Qn(){_class_call_check(this,Qn);return t.apply(this,arguments)}_create_class(Qn,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Qn.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.setPlayerBestScore(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"setPlayerBestScore",value:function setPlayerBestScore(e){var t=e.profiles,r=e.customData,l=r.playerId;if(!l||!t[l])throw new aj;var _=this.game,d=_.player,h=d.getBestScore()||0,y=t[l],p=y.score,f=void 0===p?0:p;f<=h||(d.setBestScore(f),t[l].bestScore=f)}}]);return Qn}(n7);c(rJ,"SetPlayerBestScoreHandler");var rY=rJ;var rQ=function(e){_inherits(Xn,e);var t=_create_super(Xn);function Xn(){_class_call_check(this,Xn);return t.apply(this,arguments)}_create_class(Xn,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:m.trys.push([0,,2,3]);t.startLog(e);r=null!=e?e:{},l=r.extraData,_=new aG(t),d=new rK(t,{useAPI:!0,extraData:l});_.setNext(d);h=new rq(t);d.setNext(h);y=new rw(t);h.setNext(y);p=new rY(t);y.setNext(p);f=new rV(t);p.setNext(f);v=new al(t);f.setNext(v);g=t.match.getMatchState();return[4,_.processAsync(g)];case 1:m.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Xn}(nX);c(rQ,"FinishChallengeMatchConcrete");var rX=rQ;var r$=function(e){_inherits(Jn,e);var t=_create_super(Jn);function Jn(e){_class_call_check(this,Jn);var r;r=t.call(this,e),r.name="ContextAreSolo",r.message=null!=e?e:"Context are solo";return _possible_constructor_return(r)}return Jn}(_wrap_native_super(Error));c(r$,"ContextAreSolo");var rZ=r$;var r0=function(e){_inherits(Zn,e);var t=_create_super(Zn);function Zn(e){_class_call_check(this,Zn);var r;r=t.call(this,e),r.name="OpponentNotJoinInContext",r.message=null!=e?e:"Opponent is not join in context";return _possible_constructor_return(r)}return Zn}(_wrap_native_super(Error));c(r0,"OpponentNotJoinInContext");var r2=r0;var r1=function(e){_inherits(ti,e);var t=_create_super(ti);function ti(e){_class_call_check(this,ti);var r;r=t.call(this,e),r.name="NetworkFailure",r.message=null!=e?e:"Network failure";return _possible_constructor_return(r)}return ti}(_wrap_native_super(Error));c(r1,"NetworkFailure");var r3=r1;var r4=r.Utils,r5=r.Dtos,r7=r4.Array,r6=r4.Object,r8=function(e){_inherits(ei,e);var t=_create_super(ei);function ei(e,r){_class_call_check(this,ei);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(ei,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ei.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e),r.checkCurrentContext();return[4,r.getOpponentIdFromContextAsync()];case 1:t=l.sent();e.customData.opponentId=t;return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"checkCurrentContext",value:function checkCurrentContext(){var e=GameSDK.context.getID();if("string"!=typeof e)throw new aO;if("SOLO"===e)throw new rZ}},{key:"getOpponentIdFromContextAsync",value:function getOpponentIdFromContextAsync(){var e=this;return _async_to_generator(function(){var t,r,l,_;return _ts_generator(this,function(d){switch(d.label){case 0:t=e.payload,r=t.ignoreId;return[4,e.getContextPlayers([r])];case 1:l=d.sent();if(l.length>1)throw new r2;_=F;return[2,(1===l.length&&(_=l[0]),_.playerId)]}})})()}},{key:"getContextPlayers",value:function getContextPlayers(e){return _async_to_generator(function(){var t,r,l;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,GameSDK.context.getPlayersAsync()];case 1:t=_.sent(),r=[];return[2,(t.forEach(function(t){var l=t.getID();if(e.indexOf(l)>-1)return;var _=t.getName();if(!_)return;var d=t.getPhoto();r.push(new r5.Player.Info({playerId:l,name:_,photo:d}).toObject())}),r7.unique(r))];case 2:l=_.sent();if(r6.hasOwn(l,"code")&&"NETWORK_FAILURE"===l.code)throw new r3;return[2,[]];case 3:return[2]}})})()}}]);return ei}(n7);c(r8,"GetOpponentChallengeContextHandler");var r9=r8;var se=function(e){_inherits(si,e);var t=_create_super(si);function si(e){_class_call_check(this,si);var r;r=t.call(this,e),r.name="ContextIsTournament",r.message=null!=e?e:"Context is a tournament";return _possible_constructor_return(r)}return si}(_wrap_native_super(Error));c(se,"ContextIsTournament");var st=se;var sa=r.Utils,sr=sa.Object,ss=function(e){_inherits(ai,e);var t=_create_super(ai);function ai(){_class_call_check(this,ai);return t.apply(this,arguments)}_create_class(ai,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ai.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e);return[4,r.chooseAsync()];case 1:t=l.sent();return[4,r.checkContextTournament()];case 2:l.sent(),e.customData.contextId=t;return[4,r.nextAsync(e)];case 3:l.sent();return[2]}})})()}},{key:"chooseAsync",value:function chooseAsync(){return _async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})];case 1:r.sent();return[3,3];case 2:e=r.sent();if(!sr.hasOwn(e,"code")||"SAME_CONTEXT"!==e.code)throw e;return[3,3];case 3:t=GameSDK.context.getID();if("string"!=typeof t)throw new aq;return[2,t]}})})()}},{key:"checkContextTournament",value:function checkContextTournament(){return _async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,4,,5]);if(!GameSDK.context.getID())return[2];if(!("getTournamentAsync"in GameSDK))return[3,2];return[4,GameSDK.getTournamentAsync()];case 1:e=(r.sent(),new st);return[3,3];case 2:e=new aN("getTournamentAsync");r.label=3;case 3:throw e;case 4:t=r.sent();if(_instanceof(t,st))throw t;return[3,5];case 5:return[2]}})})()}}]);return ai}(n7);c(ss,"ChooseContextHandler");var sc=ss;var sl=function(e){_inherits(ni,e);var t=_create_super(ni);function ni(){_class_call_check(this,ni);return t.apply(this,arguments)}_create_class(ni,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g,m,A,w;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,l=new aG(t),_=new sc(t);l.setNext(_);d=new aC(t,{mode:h.CHALLENGE_FRIEND,customData:{playerId:r}});_.setNext(d);y=new r9(t,{ignoreId:r});d.setNext(y);p=new a3(t,{extraData:e.extraData});y.setNext(p);f=new aU(t);p.setNext(f);v=new a5(t);f.setNext(v);g=new ar(t);v.setNext(g);m=new a6(t);g.setNext(m);A=new al(t);m.setNext(A);w=t.match.getMatchState();return[4,l.processAsync(w)];case 1:I.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return ni}(nX);c(sl,"InviteFriendsConcrete");var su=sl;var s_=function(e){_inherits(ii,e);var t=_create_super(ii);function ii(e){_class_call_check(this,ii);var r;r=t.call(this,e),r.name="JoinMatchFailed",r.message=null!=e?e:"Join match failed";return _possible_constructor_return(r)}return ii}(_wrap_native_super(Error));c(s_,"JoinMatchFailed");var sd=s_;var sh=function(e){_inherits(oi,e);var t=_create_super(oi);function oi(e){_class_call_check(this,oi);var r;r=t.call(this,e),r.name="MatchAreFinished",r.message=null!=e?e:"Match are finished";return _possible_constructor_return(r)}return oi}(_wrap_native_super(Error));c(sh,"MatchAreFinished");var sy=sh;var sp=function(e){_inherits(ri,e);var t=_create_super(ri);function ri(e){_class_call_check(this,ri);var r;r=t.call(this,e),r.name="OtherPlayerHasJoinedMatch",r.message=null!=e?e:"Other player has joined match";return _possible_constructor_return(r)}return ri}(_wrap_native_super(Error));c(sp,"OtherPlayerHasJoinedMatch");var sf=sp;var sv=r.Dtos,sg=function(e){_inherits(ci,e);var t=_create_super(ci);function ci(){_class_call_check(this,ci);return t.apply(this,arguments)}_create_class(ci,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(ci.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l;return _ts_generator(this,function(_){switch(_.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.joinMatchAsync(e)];case 1:t=_.sent(),l=new sv.Match.Data(t).toObject();r.validateJoinMatchData(e,l),r.updateMatchData(e,l);return[4,r.nextAsync(e)];case 2:_.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.status;if(t!==as.OPEN)throw new a0}},{key:"validateJoinMatchData",value:function validateJoinMatchData(e,t){var r=e.id,l=e.customData,_=t._id,d=t.blackPlayerId,h=t.whitePlayerId,y=t.whitePlayerFinish,p=t.blackPlayerFinish,f=d===l.playerId,v=h===l.opponentId;if("string"!=typeof _||_!==r||!v)throw console.warn("\uD83E\uDD16 ? matchData",t),new sd;if(y&&p)throw new sy;if(!f)throw new sf}},{key:"joinMatchAsync",value:function joinMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){r=e.id;return[2,r?t.match.api.getMatchAPI().joinMatchAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,l=t.whitePlayerId,_=t.blackPlayerId,d=t.whitePlayerScore,h=t.blackPlayerScore,y=t.whitePlayerFinish,p=t.blackPlayerFinish,f=l===r.playerId,v=f?l:_,g=f?_:l;e.customData.playerId=v,e.customData.opponentId=g,e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!1}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!1});var m=f?d:h,A=f?h:d;e.profiles[v].score=m,e.profiles[g].score=A;var w=f?y:p,I=f?p:y;e.profiles[v].finished=w,e.profiles[g].finished=I}}]);return ci}(n7);c(sg,"JoinMatchHandler");var sm=sg;var sA=function(e){_inherits(li,e);var t=_create_super(li);function li(){_class_call_check(this,li);return t.apply(this,arguments)}_create_class(li,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(li.prototype),"processAsync",t)};return _async_to_generator(function(){var t;return _ts_generator(this,function(l){switch(l.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.createWideframesAcceptedAsync(e)];case 1:t=l.sent();t&&r.sendMessageAsync(e,t);return[4,r.nextAsync(e)];case 2:l.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,l=r.contextId,_=r.opponentId;if(!t||"string"!=typeof t)throw new ap;if(!l||"string"!=typeof l)throw new aO;if(!_||"string"!=typeof _)throw new am}},{key:"createWideframesAcceptedAsync",value:function createWideframesAcceptedAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g,m,A,w,I,b,k,S,D;return _ts_generator(this,function(P){switch(P.label){case 0:P.trys.push([0,4,,5]);r=t.game,l=r.frameCapture,_=e.profiles,d=e.customData,h=d.playerId,y=d.opponentId;if(!h||!y)return[2,null];p=_[h],f=_[y],v=p.photo,g=p.score,m=void 0===g?0:g,A=p.finished;if(A)return[2,null];w=f.photo,I=f.score,b=void 0===I?0:I,k=f.finished;if(!k)return[3,2];return[4,l.wideframe.renderResultChallenge({playerId:h,playerPhoto:v,playerScore:m,opponentId:y,opponentPhoto:w,opponentScore:b,isPlayerFinished:!1,isOpponentFinished:!0})];case 1:S=P.sent();return[3,3];case 2:S=null;P.label=3;case 3:return[2,S];case 4:D=P.sent();return[2,(console.warn("createWideframesAcceptedAsync",D),null)];case 5:return[2]}})})()}},{key:"sendMessageAsync",value:function sendMessageAsync(e,t){return _async_to_generator(function(){var r,l,_,d,h,y,p,f;return _ts_generator(this,function(v){switch(v.label){case 0:r=e.id,l=e.profiles,_=e.customData,d=_.playerId,h=_.opponentId;if(!d||"string"!=typeof d)throw new B;if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");y=l[d],p=y.name,f={data:{type:ax.CHALLENGE_FRIEND,matchId:r,playerId:d,opponentId:h},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(p," accepted the challenge."),localizations:{vi_VN:"".concat(p," đ\xe3 chấp nhận tham gia trận đấu.")}},image:t,strategy:"LAST",notification:"PUSH"};return[4,GameSDK.extra.updateAsync(f)];case 1:v.sent();return[2]}})})()}}]);return li}(n7);c(sA,"SendAcceptedMessageHandler");var sw=sA;var sI=function(e){_inherits(di,e);var t=_create_super(di);function di(){_class_call_check(this,di);return t.apply(this,arguments)}_create_class(di,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g,m,A,w;return _ts_generator(this,function(I){switch(I.label){case 0:I.trys.push([0,,2,3]);t.startLog(e);r=e.matchId,l=e.playerId,_=e.opponentId,d=new aG(t),y=new aC(t,{id:r,mode:h.CHALLENGE_FRIEND,customData:{playerId:l,opponentId:_}});d.setNext(y);p=new sm(t);y.setNext(p);f=new aU(t);p.setNext(f);v=new a5(t);f.setNext(v);g=new sw(t);v.setNext(g);m=new ar(t);g.setNext(m);A=new al(t);m.setNext(A);w=t.match.getMatchState();return[4,d.processAsync(w)];case 1:I.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return di}(nX);c(sI,"JoinChallengeMatchConcrete");var sb=sI;var sk={_id:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1},sS=r.Utils,sD=sS.Valid,sP="is invalid",sE=function(e){_inherits(hi,e);var t=_create_super(hi);function hi(){_class_call_check(this,hi);return t.apply(this,arguments)}_create_class(hi,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){sD.isString(e)&&e||this.exception("_id",sP)}},{key:"validateStatus",value:function validateStatus(e){sD.isString(e)&&e||this.exception("status",sP)}},{key:"validateWinnerId",value:function validateWinnerId(e){null===e||sD.isString(e)&&e||this.exception("winnerId",sP)}},{key:"validateWhitePlayerId",value:function validateWhitePlayerId(e){sD.isString(e)&&e||this.exception("whitePlayerId",sP)}},{key:"validateBlackPlayerId",value:function validateBlackPlayerId(e){sD.isString(e)&&e||this.exception("blackPlayerId",sP)}},{key:"validateWhitePlayerScore",value:function validateWhitePlayerScore(e){sD.isNumber(e)||this.exception("whitePlayerScore",sP)}},{key:"validateBlackPlayerScore",value:function validateBlackPlayerScore(e){sD.isNumber(e)||this.exception("blackPlayerScore",sP)}},{key:"validateWhitePlayerFinish",value:function validateWhitePlayerFinish(e){sD.isBoolean(e)||this.exception("whitePlayerFinish",sP)}},{key:"validateBlackPlayerFinish",value:function validateBlackPlayerFinish(e){sD.isBoolean(e)||this.exception("blackPlayerFinish",sP)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(hi.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return sk}}]);return hi}(S);c(sE,"RespMatchDataDtos");var sC=sE;sC.addDefaultData(sk);var sx=function(e){_inherits(ui,e);var t=_create_super(ui);function ui(e){_class_call_check(this,ui);var r;r=t.call(this,e),r.name="MatchAreNotFinished",r.message=e||"Match are not finished";return _possible_constructor_return(r)}return ui}(_wrap_native_super(Error));c(sx,"MatchAreNotFinished");var sM=sx;var sN=function(e){_inherits(pi,e);var t=_create_super(pi);function pi(e){_class_call_check(this,pi);var r;r=t.call(this,e),r.name="OpponentNotFinishedMatch",r.message=e||"Opponent not finished match";return _possible_constructor_return(r)}return pi}(_wrap_native_super(Error));c(sN,"OpponentNotFinishedMatch");var sL=sN;var sO=function(e){_inherits(yi,e);var t=_create_super(yi);function yi(){_class_call_check(this,yi);return t.apply(this,arguments)}_create_class(yi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(yi.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l;return _ts_generator(this,function(_){switch(_.label){case 0:_superprop_get_processAsync().call(r,e),r.validateMatchData(e);return[4,r.getMatchAsync(e)];case 1:t=_.sent(),l=new sC(t).toObject();r.validateResultMatchData(e,l),r.updateMatchData(e,l),r.validatePlayerTurn(e),r.validateOpponentTurn(e);return[4,r.nextAsync(e)];case 2:_.sent();return[2]}})})()}},{key:"validateMatchData",value:function validateMatchData(e){var t=e.id;if("string"!=typeof t)throw new ap}},{key:"validateResultMatchData",value:function validateResultMatchData(e,t){var r=e.id,l=t._id,_=t.whitePlayerFinish,d=t.blackPlayerFinish;if("string"!=typeof l||l!==r)throw new a_;if(!_&&!d)throw new sM}},{key:"validatePlayerTurn",value:function validatePlayerTurn(e){var t=e.profiles,r=e.customData,l=r.playerId;if("string"!=typeof l)throw new B;var _=t[l],d=_.finished;if(!d)throw new ab}},{key:"validateOpponentTurn",value:function validateOpponentTurn(e){var t=e.profiles,r=e.customData,l=r.opponentId;if("string"!=typeof l)throw new am;var _=t[l],d=_.finished;if(!d)throw new sL}},{key:"getMatchAsync",value:function getMatchAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){r=e.id;return[2,r?t.match.api.getMatchAPI().getMatchDetailByIdAsync(r):{}]})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.customData,l=t.whitePlayerId,_=t.blackPlayerId,d=t.whitePlayerScore,h=t.blackPlayerScore,y=t.whitePlayerFinish,p=t.blackPlayerFinish,f=l===r.playerId,v=f?l:_,g=f?_:l;e.customData.playerId=v,e.customData.opponentId=g,e.profiles[v]||(e.profiles[v]={id:v,name:"",photo:"",finished:!0}),e.profiles[g]||(e.profiles[g]={id:g,name:"",photo:"",finished:!0});var m=f?d:h,A=f?h:d;e.profiles[v].score=m,e.profiles[g].score=A;var w=f?y:p,I=f?p:y;e.profiles[v].finished=w,e.profiles[g].finished=I}}]);return yi}(n7);c(sO,"ResultMatchHandler");var sT=sO;var sR=function(e){_inherits(fi,e);var t=_create_super(fi);function fi(){_class_call_check(this,fi);return t.apply(this,arguments)}_create_class(fi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:m.trys.push([0,,2,3]);t.startLog(e);r=e.matchId,l=e.playerId,_=e.opponentId,d=new aG(t),y=new aC(t,{id:r,mode:h.CHALLENGE_FRIEND,customData:{playerId:l,opponentId:_}});d.setNext(y);p=new sT(t);y.setNext(p);f=new aU(t);p.setNext(f);v=new al(t);f.setNext(v);g=t.match.getMatchState();return[4,d.processAsync(g)];case 1:m.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return fi}(nX);c(sR,"ResultChallengeMatchConcrete");var sF=sR;var sG=function(e){_inherits(gi,e);var t=_create_super(gi);function gi(){_class_call_check(this,gi);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"fallbackSingleMode");var r=_assert_this_initialized(e);u(_assert_this_initialized(e),"startFLowChallengeFriend",c(function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(l){switch(l.label){case 0:l.trys.push([0,2,,3]);return[4,r.match.challenge.invite.processAsync(e)];case 1:return[2,(l.sent(),!0)];case 2:t=l.sent();return[2,t];case 3:return[2]}})});return function(t){return e.apply(this,arguments)}}(),"startFLowChallengeFriend"));var l=_assert_this_initialized(e);u(_assert_this_initialized(e),"startFlowTournament",c(function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,4]);t=GameSDK.context.getID();if("string"!=typeof t)throw new aO;return[4,l.match.tournament.continue.processAsync({playerId:e,contextId:t})];case 1:r.sent();return[3,4];case 2:r.sent();return[4,l.startFlowSingle(e)];case 3:r.sent();return[3,4];case 4:return[2]}})});return function(t){return e.apply(this,arguments)}}(),"startFlowTournament"));var _=_assert_this_initialized(e);u(_assert_this_initialized(e),"startFlowSingle",c(function(){var e=_async_to_generator(function(e){return _ts_generator(this,function(t){switch(t.label){case 0:if(!_.fallbackSingleMode)throw new Error("Fallback single mode is not enabled");return[4,_.match.single.start.processAsync({playerId:e})];case 1:t.sent();return[2]}})});return function(t){return e.apply(this,arguments)}}(),"startFlowSingle"));return e}_create_class(gi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d;return _ts_generator(this,function(h){switch(h.label){case 0:h.trys.push([0,,6,7]);t.startLog(e);r=e.playerId,l=e.extraData,_=e.fallbackSingleMode;t.fallbackSingleMode=_;return[4,t.startFLowChallengeFriend({playerId:r,extraData:l})];case 1:d=h.sent();if(!0===d)return[2];if(!_instanceof(d,st))return[3,3];return[4,t.startFlowTournament(r)];case 2:h.sent();return[3,5];case 3:return[4,t.startFlowSingle(r)];case 4:h.sent();h.label=5;case 5:return[3,7];case 6:t.endLog();return[7];case 7:return[2]}})})()}}]);return gi}(nX);c(sG,"ChooseContextConcrete");var sV=sG;var sj=r.Utils,sB=sj.Valid,sH=r.Configs,sU=sH.Leaderboards,sz=function(e){_inherits(wi,e);var t=_create_super(wi);function wi(e){_class_call_check(this,wi);return t.call(this,e,{score:0,leaderboardId:sU.LeaderboardEndlessId})}_create_class(wi,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;var r=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(wi.prototype),"setupSetScorePayload",t)};return _async_to_generator(function(){var t,l,_,d,h;return _ts_generator(this,function(y){if(GameSDK.player.isGuest())throw new rb;t=e.profiles,l=e.customData,_=l.playerId;if(!_||!t[_])throw new aj;d=t[_],h=d.endlessScore;if(!sB.isNumber(h))throw new rS;r.payload.score=h,_superprop_get_setupSetScorePayload().call(r,e);return[2]})})()}}]);return wi}(rL);c(sz,"PostGlobalLeaderboardEndlessScoreHandler");var sK=sz;var sW=function(e){_inherits(mi,e);var t=_create_super(mi);function mi(){_class_call_check(this,mi);return t.apply(this,arguments)}_create_class(mi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(mi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.setPlayerEndlessScore(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"setPlayerEndlessScore",value:function setPlayerEndlessScore(e){var t=e.profiles,r=e.customData,l=r.playerId;if(!l||!t[l])throw new aj;var _;var d=this.game,h=d.player,y=null!==(_=h.getBestEndlessScore())&&void 0!==_?_:0,p=t[l],f=p.endlessScore,v=void 0===f?0:f,g=y<v?v:y;h.setBestEndlessScore(g),t[l].bestEndlessScore=g}}]);return mi}(n7);c(sW,"SetPlayerEndlessScoreHandler");var sq=sW;var sJ=function(e){_inherits(Ai,e);var t=_create_super(Ai);function Ai(){_class_call_check(this,Ai);return t.apply(this,arguments)}_create_class(Ai,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,r,l,_,d,h,y;return _ts_generator(this,function(p){switch(p.label){case 0:p.trys.push([0,,2,3]);e.startLog();t=new aG(e),r=new rK(e,{useAPI:!1});t.setNext(r);l=new rw(e);r.setNext(l);_=new sq(e);l.setNext(_);d=new sK(e);_.setNext(d);h=new al(e);d.setNext(h);y=e.match.getMatchState();return[4,t.processAsync(y)];case 1:p.sent();return[3,3];case 2:e.endLog();return[7];case 3:return[2]}})})()}}]);return Ai}(nX);c(sJ,"FinishEndlessConcrete");var sY=sJ;var sQ=function(e){_inherits(Ii,e);var t=_create_super(Ii);function Ii(e){_class_call_check(this,Ii);var r;r=t.call(this,e),r.name="ProfileIdNotDefined",r.message=null!=e?e:"Profile id is not defined";return _possible_constructor_return(r)}return Ii}(_wrap_native_super(Error));c(sQ,"ProfileIdNotDefined");var sX=sQ;var s$=r.Dtos,sZ=function(e){_inherits(Di,e);var t=_create_super(Di);function Di(e,r){_class_call_check(this,Di);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(Di,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Di.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l,_,d,h,y;return _ts_generator(this,function(p){switch(p.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,l=t.profileId;if(!l)throw new sX;_=r.game,d=_.player,h=d.getPlayerId();if(l!==h)return[3,1];y=r.getPlayerProfile();return[3,3];case 1:return[4,r.getProfileAsync(l)];case 2:if(y=p.sent(),!y)throw new aj;p.label=3;case 3:r.updateMatchData(y,e);return[4,r.nextAsync(e)];case 4:p.sent();return[2]}})})()}},{key:"getPlayerProfile",value:function getPlayerProfile(){var e=this.game,t=e.player,r=t.getPlayer(),l=r.playerId,_=r.name,d=r.photo,h=r.locale;return{playerId:l,name:_,photo:d,locale:h}}},{key:"getProfileAsync",value:function getProfileAsync(e){var t=this;return _async_to_generator(function(){var r,l;return _ts_generator(this,function(_){switch(_.label){case 0:r=t.game,l=r.profile;return[4,l.requestProfiles([e])];case 1:return[2,(_.sent(),l.getProfiles()[e])]}})})()}},{key:"updateMatchData",value:function updateMatchData(e,t){var r=e.playerId,l=e.name,_=e.photo,d=new s$.Match.Profile({id:r,name:l,photo:_}).toObject();t.profiles[r]=d}}]);return Di}(n7);c(sZ,"GetProfileHandler");var s0=sZ;var s2=function(e){_inherits(Pi,e);var t=_create_super(Pi);function Pi(){_class_call_check(this,Pi);return t.apply(this,arguments)}_create_class(Pi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:m.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,l=new aG(t),_=new rs(t,{contextId:"SOLO"});l.setNext(_);d=new aC(t,{id:"234567",mode:h.ENDLESS,customData:{playerId:r}});_.setNext(d);y=new a5(t);d.setNext(y);p=new s0(t,{profileId:r});y.setNext(p);f=new ar(t);p.setNext(f);v=new al(t);f.setNext(v);g=t.match.getMatchState();return[4,l.processAsync(g)];case 1:m.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Pi}(nX);c(s2,"StartEndlessConcrete");var s1=s2;var s3=r.Utils,s4=s3.Valid,s5=function(e){_inherits(xi,e);var t=_create_super(xi);function xi(e){_class_call_check(this,xi);return t.call(this,e,{score:0,leaderboardId:""})}_create_class(xi,[{key:"setupSetScorePayload",value:function setupSetScorePayload(e){var t=this;var r=this,_superprop_get_setupSetScorePayload=function(){return _get(_get_prototype_of(xi.prototype),"setupSetScorePayload",t)};return _async_to_generator(function(){var t,l,_,d,h,y;return _ts_generator(this,function(p){t=e.profiles,l=e.customData,_=l.playerId,d=l.leaderboardId;if(!d)throw new rP;if(!_||!t[_])throw new aj;h=t[_],y=h.score;if(!s4.isNumber(y))throw new rS;r.payload.score=y,r.payload.leaderboardId=d,_superprop_get_setupSetScorePayload().call(r,e);return[2]})})()}}]);return xi}(rL);c(s5,"PostLeaderboardScoreHandler");var s7=s5;var s6=function(e){_inherits(Ei,e);var t=_create_super(Ei);function Ei(){_class_call_check(this,Ei);return t.apply(this,arguments)}_create_class(Ei,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ei.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e),r.progressSendGroupMessage(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.id,r=e.customData,l=r.contextId,_=r.opponentId;if(!t||"string"!=typeof t)throw new ap;if(!l||"string"!=typeof l)throw new aO;if(!_||"string"!=typeof _)throw new am}},{key:"createWideframesResultGroupAsync",value:function createWideframesResultGroupAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g,m,A,w,I,b;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,3]);r=t.game,l=r.frameCapture,_=e.profiles,d=e.customData,h=d.playerId,y=d.opponentId;if(!h||!y)return[2,null];p=_[h],f=_[y],v=p.photo,g=p.score,m=void 0===g?0:g,A=f.photo,w=f.score,I=void 0===w?0:w;return[4,l.wideframe.renderResultChallenge({playerId:h,playerPhoto:v,playerScore:m,opponentId:y,opponentPhoto:A,opponentScore:I,isPlayerFinished:!0,isOpponentFinished:!0})];case 1:return[2,k.sent()];case 2:b=k.sent();return[2,(console.warn("createWideframesResultGroupAsync",b),null)];case 3:return[2]}})})()}},{key:"createWideframesBestScoreAsync",value:function createWideframesBestScoreAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,2,,3]);r=t.game,l=r.player,_=r.frameCapture,d=e.customData,h=d.playerId,y=l.getPlayer(),p=y.playerId,f=y.photo,v=y.data;if(h!==p)return[2,null];g=v||{},m=g.score;return[4,_.wideframe.renderShareScore({playerId:p,playerPhoto:f,playerScore:m})];case 1:return[2,w.sent()];case 2:A=w.sent();return[2,(console.warn("createWideframesBestScoreAsync",A),null)];case 3:return[2]}})})()}},{key:"progressSendGroupMessage",value:function progressSendGroupMessage(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:r=e.profiles,l=e.customData,_=l.playerId,d=l.opponentId;if(!(d&&"string"==typeof d))return[3,2];if(!_||"string"!=typeof _)throw new B;h=r[_]||{},y=h.score,p=void 0===y?0:y,f=r[d]||{},v=f.score,g=void 0===v?0:v;if(!(p>g))return[3,2];return[4,t.createWideframesResultGroupAsync(e)];case 1:m=w.sent();if(!m)return[2];t.sendBestScoreMessageAsync(e,m);return[2];case 2:return[4,t.createWideframesBestScoreAsync(e)];case 3:A=w.sent();A&&t.sendChallengeMessageAsync(e,A);return[2]}})})()}},{key:"sendBestScoreMessageAsync",value:function sendBestScoreMessageAsync(e,t){var r=this;return _async_to_generator(function(){var l,_,d,h,y,p,f;return _ts_generator(this,function(v){switch(v.label){case 0:l=e.profiles,_=e.customData,d=_.playerId;if(!d||"string"!=typeof d)throw new B;if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");h=l[d],y=h.name,p=h.score,f={data:{type:r.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:d,playerName:y,playerScore:p},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi"}},text:{default:"".concat(y," beats your high score. Their score: ").concat(p,"."),localizations:{vi_VN:"".concat(y," vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");return[4,GameSDK.extra.updateAsync(f)];case 1:v.sent();return[2]}})})()}},{key:"sendChallengeMessageAsync",value:function sendChallengeMessageAsync(e,t){var r=this;return _async_to_generator(function(){var l,_,d,h,y,p,f;return _ts_generator(this,function(v){switch(v.label){case 0:l=e.profiles,_=e.customData,d=_.playerId;if(!d||"string"!=typeof d)throw new B;h=l[d],y=h.name,p=h.score,f={data:{type:r.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:d,playerName:y,playerScore:p},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:"".concat(y," got ").concat(p," scores. So easy! Can you?"),localizations:{vi_VN:"".concat(y," đ\xe3 đạt ").concat(p," điểm! Qu\xe1 dễ lu\xf4n. Chơi lại n\xe0o!")}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new aN("updateAsync");return[4,GameSDK.extra.updateAsync(f)];case 1:v.sent();return[2]}})})()}}]);return Ei}(n7);c(s6,"SendGroupMessageHandler");var s8=s6;var s9=function(e){_inherits(Si,e);var t=_create_super(Si);function Si(){_class_call_check(this,Si);return t.apply(this,arguments)}_create_class(Si,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,r,l,_,d,h,y,p;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,,2,3]);e.startLog();t=new aG(e),r=new rK(e,{useAPI:!1});t.setNext(r);l=new s8(e);r.setNext(l);_=new rw(e);l.setNext(_);d=new rY(e);_.setNext(d);h=new s7(e);d.setNext(h);y=new al(e);h.setNext(y);p=e.match.getMatchState();return[4,t.processAsync(p)];case 1:f.sent();return[3,3];case 2:e.endLog();return[7];case 3:return[2]}})})()}}]);return Si}(nX);c(s9,"FinishGroupConcrete");var ie=s9;var it=r.Dtos,ia=function(e){_inherits(vi,e);var t=_create_super(vi);function vi(e,r){_class_call_check(this,vi);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(vi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(vi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.updateProfileMatchData(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"updateProfileMatchData",value:function updateProfileMatchData(e){var t=this.payload,r=t.id,l=e.profiles;if(!l[r])throw new aj;var _=_object_spread({},l[r],this.payload),d=new it.Match.Profile(_).toObject();l[d.id]=d}}]);return vi}(n7);c(ia,"SetProfileDataHandler");var ir=ia;var is=function(e){_inherits(bi,e);var t=_create_super(bi);function bi(){_class_call_check(this,bi);return t.apply(this,arguments)}_create_class(bi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,l=e.opponentId,_=e.opponentScore,d=new aG(t),y=new aC(t,{id:"7749",mode:h.MATCHING_GROUP,customData:{playerId:r,opponentId:l}});d.setNext(y);p=new aU(t);y.setNext(p);f=new ir(t,{id:r,score:_});p.setNext(f);v=new a5(t);f.setNext(v);g=new ar(t);v.setNext(g);m=new al(t);g.setNext(m);A=t.match.getMatchState();return[4,d.processAsync(A)];case 1:w.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return bi}(nX);c(is,"JoinGroupConcrete");var ic=is;var il=function(e){_inherits(Ni,e);var t=_create_super(Ni);function Ni(e){_class_call_check(this,Ni);var r;r=t.call(this,e),r.name="MatchGroupNotSupported",r.message=null!=e?e:"Match group is not supported";return _possible_constructor_return(r)}return Ni}(_wrap_native_super(Error));c(il,"MatchGroupNotSupported");var iu=il;var i_=r.Utils,id=i_.String,ih=function(e){_inherits(Ci,e);var t=_create_super(Ci);function Ci(e,r){_class_call_check(this,Ci);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(Ci,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ci.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l;return _ts_generator(this,function(_){switch(_.label){case 0:_superprop_get_processAsync().call(r,e);return[4,r.checkMatchGroupSupported()];case 1:_.sent();t=r.getMatchTag();return[4,r.matchingGroup(t)];case 2:l=_.sent();e.customData.contextId=l;return[4,r.nextAsync(e)];case 3:_.sent();return[2]}})})()}},{key:"checkMatchGroupSupported",value:function checkMatchGroupSupported(){return _async_to_generator(function(){return _ts_generator(this,function(e){switch(e.label){case 0:if(!("getSupportedAPIs"in GameSDK))throw new aN("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new aN("checkCanPlayerMatchAsync");if(!(GameSDK.getSupportedAPIs().indexOf("checkCanPlayerMatchAsync")>-1))throw new iu;return[4,GameSDK.extra.checkCanPlayerMatchAsync()];case 1:if(!e.sent())throw new iu;return[2]}})})()}},{key:"getMatchTag",value:function getMatchTag(){var e=this.payload,t=e.locale;var r="global";if(t){var l=id.getLanguageCode(t);"en"===l&&(r="en"),"in"===l&&(r="in")}return r}},{key:"matchingGroup",value:function matchingGroup(e){return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:if(!("matchPlayerAsync"in GameSDK.extra))throw new aN("matchPlayerAsync");return[4,GameSDK.extra.matchPlayerAsync(e,!0,!0)];case 1:r.sent();t=GameSDK.context.getID();if("string"!=typeof t)throw new aq;return[2,t]}})})()}}]);return Ci}(n7);c(ih,"GroupContextHandler");var iy=ih;var ip=function(e){_inherits(Oi,e);var t=_create_super(Oi);function Oi(){_class_call_check(this,Oi);return t.apply(this,arguments)}_create_class(Oi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,,2,3]);t.startLog(e);r=e.locale,l=e.playerId,_=new aG(t),d=new iy(t,{locale:r});_.setNext(d);y=new aC(t,{id:"7749",mode:h.MATCHING_GROUP,customData:{playerId:l}});d.setNext(y);p=new a5(t);y.setNext(p);f=new s0(t,{profileId:l});p.setNext(f);v=new ar(t);f.setNext(v);g=new al(t);v.setNext(g);m=t.match.getMatchState();return[4,_.processAsync(m)];case 1:A.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Oi}(nX);c(ip,"StartGroupConcrete");var iv=ip;var ig=function(e){_inherits(Li,e);var t=_create_super(Li);function Li(){_class_call_check(this,Li);return t.apply(this,arguments)}_create_class(Li,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Li.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e);return[4,r.setMSNLeaderboardScore(e)];case 1:t.sent();return[4,r.nextAsync(e)];case 2:t.sent();return[2]}})})()}},{key:"setMSNLeaderboardScore",value:function setMSNLeaderboardScore(e){return _async_to_generator(function(){var t,l,_,d,h;return _ts_generator(this,function(y){try{t=e.profiles,l=e.customData,_=l.playerId;if(!_||!t[_])throw new aj;d=t[_],h=d.score;if(!r.Utils.Valid.isNumber(h))throw new rS;if(!("submitGameResultsAsync"in GameSDK.extra))throw new aN("submitGameResultsAsync");GameSDK.extra.submitGameResultsAsync(h)}catch(e){console.warn("submitScoreToMSNLeaderboardHandler",e)}return[2]})})()}}]);return Li}(n7);c(ig,"SubmitScoreToMSNLeaderboardHandler");var im=ig;var iA=function(e){_inherits(Ti,e);var t=_create_super(Ti);function Ti(){_class_call_check(this,Ti);return t.apply(this,arguments)}_create_class(Ti,[{key:"processAsync",value:function processAsync(){var e=this;return _async_to_generator(function(){var t,r,l,_,d,h,y,p;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,,2,3]);e.startLog();t=new aG(e),r=new rK(e,{useAPI:!1});t.setNext(r);l=new rw(e);r.setNext(l);_=new rY(e);l.setNext(_);d=new rV(e);_.setNext(d);h=new im(e);d.setNext(h);y=new al(e);h.setNext(y);p=e.match.getMatchState();return[4,t.processAsync(p)];case 1:f.sent();return[3,3];case 2:e.endLog();return[7];case 3:return[2]}})})()}}]);return Ti}(nX);c(iA,"FinishSingleConcrete");var iw=iA;var iI=function(e){_inherits(Mi,e);var t=_create_super(Mi);function Mi(){_class_call_check(this,Mi);return t.apply(this,arguments)}_create_class(Mi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g;return _ts_generator(this,function(m){switch(m.label){case 0:m.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,l=new aG(t),_=new rs(t,{contextId:"SOLO"});l.setNext(_);d=new aC(t,{id:"123456",mode:h.SINGLE,customData:{playerId:r}});_.setNext(d);y=new a5(t);d.setNext(y);p=new s0(t,{profileId:r});y.setNext(p);f=new ar(t);p.setNext(f);v=new al(t);f.setNext(v);g=t.match.getMatchState();return[4,l.processAsync(g)];case 1:m.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Mi}(nX);c(iI,"StartSingleConcrete");var ib=iI;var ik=r.Plugins,iS=r.Utils,iD=ik.Analytics,iP=iS.String,iE=iS.Valid,iC=function(e){_inherits(Ri,e);var t=_create_super(Ri);function Ri(){_class_call_check(this,Ri);return t.apply(this,arguments)}_create_class(Ri,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ri.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l,_,d,h,y;return _ts_generator(this,function(p){switch(p.label){case 0:_superprop_get_processAsync().call(r,e);t=e.mode,l=e.customData;r.validateMode(t);_=r.game,d=_.analytics,h=l.tournamentId,y=l.leaderboardId;d.event(iD.Events.TOURNAMENT_START,{success:!0,game_mode:iP.toUpperCamelCase(t),tournament_id:h,leaderboard_id:y});return[4,r.nextAsync(e)];case 1:p.sent();return[2]}})})()}},{key:"validateMode",value:function validateMode(e){if(!iE.isString(e))throw new n2}}]);return Ri}(n7);c(iC,"LogTournamentStartHandler");var ix=iC;var iM=function(e){_inherits(_i,e);var t=_create_super(_i);function _i(e){_class_call_check(this,_i);var r;r=t.call(this,e),r.name="TournamentIdNotValid",r.message=null!=e?e:"Tournament id is not valid";return _possible_constructor_return(r)}return _i}(_wrap_native_super(Error));c(iM,"TournamentIdNotValid");var iN=iM;var iL=r.Utils,iO=iL.Valid,iT=function(e){_inherits($i,e);var t=_create_super($i);function $i(e,r){_class_call_check(this,$i);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class($i,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of($i.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l,_,d,h,y;return _ts_generator(this,function(p){switch(p.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,l=t.contextId;r.validateContextId(l);return[4,GameSDK.getTournamentAsync()];case 1:_=p.sent(),d=_.getID().toString();r.validateTournamentId(d);h=JSON.parse(_.getPayload()||"{}"),y=h.leaderboardId;r.validateLeaderboardId(y),e.customData.contextId=l,e.customData.tournamentId=d,e.customData.leaderboardId=y;return[4,r.nextAsync(e)];case 2:p.sent();return[2]}})})()}},{key:"validateContextId",value:function validateContextId(e){if(!iO.isString(e))throw new aO}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!iO.isString(e))throw new iN}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!iO.isString(e)||""===e)throw new rP}}]);return $i}(n7);c(iT,"ContinueTournamentHandler");var iR=iT;var iF=function(e){_inherits(Gi,e);var t=_create_super(Gi);function Gi(){_class_call_check(this,Gi);return t.apply(this,arguments)}_create_class(Gi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,l=e.contextId,_=new aG(t),d=new iR(t,{contextId:l});_.setNext(d);y=new aC(t,{id:"1997",mode:h.TOURNAMENT,customData:{playerId:r}});d.setNext(y);p=new a5(t);y.setNext(p);f=new s0(t,{profileId:r});p.setNext(f);v=new ar(t);f.setNext(v);g=new ix(t);v.setNext(g);m=new al(t);v.setNext(m);A=t.match.getMatchState();return[4,_.processAsync(A)];case 1:w.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Gi}(nX);c(iF,"ContinueTournamentConcrete");var iG=iF;var iV=r.Plugins,ij=iV.Analytics,iB=function(e){_inherits(Vi,e);var t=_create_super(Vi);function Vi(){_class_call_check(this,Vi);return t.apply(this,arguments)}_create_class(Vi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Vi.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l,_,d,h;return _ts_generator(this,function(y){switch(y.label){case 0:_superprop_get_processAsync().call(r,e);t=e.customData,l=r.game,_=l.analytics,d=t.tournamentId,h=t.leaderboardId;_.event(ij.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:d,leaderboard_id:h});return[4,r.nextAsync(e)];case 1:y.sent();return[2]}})})()}}]);return Vi}(n7);c(iB,"LogTournamentCreateHandler");var iH=iB;var iU=function(e){_inherits(Fi,e);var t=_create_super(Fi);function Fi(e,r){_class_call_check(this,Fi);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(Fi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Fi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e);return[4,r.createTournamentAsync()];case 1:t.sent();return[4,r.updateMatchStateAsync(e)];case 2:t.sent();return[4,r.nextAsync(e)];case 3:t.sent();return[2]}})})()}},{key:"createTournamentAsync",value:function createTournamentAsync(){var e=this;return _async_to_generator(function(){var t,r,l,_;return _ts_generator(this,function(d){switch(d.label){case 0:t=e.payload,r=t.name,l=t.score,_=t.customData;return[4,GameSDK.tournament.createAsync({initialScore:l,config:{title:r,tournamentTitle:r},data:_})];case 1:d.sent();return[2]}})})()}},{key:"updateMatchStateAsync",value:function updateMatchStateAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y;return _ts_generator(this,function(p){switch(p.label){case 0:p.trys.push([0,2,,3]);if(!("getTournamentAsync"in GameSDK))throw new aN("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 1:r=p.sent(),l=r.getContextID(),_=r.getID().toString(),d=t.payload,h=d.playerId;e.customData.playerId=h,e.customData.contextId=l,e.customData.tournamentId=_;return[3,3];case 2:y=p.sent();if(_instanceof(y,aN))return[2];return[3,3];case 3:return[2]}})})()}}]);return Fi}(n7);c(iU,"CreateTournamentHandler");var iz=iU;var iK=r.Utils,iW=iK.Valid,iq=function(e){_inherits(Ui,e);var t=_create_super(Ui);function Ui(e,r){_class_call_check(this,Ui);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");u(_assert_this_initialized(l),"leaderboardPayload");l.payload=r;return l}_create_class(Ui,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ui.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.validatePayload();return[4,r.setupCreatePayload(e)];case 1:t.sent();return[4,r.createLeaderboardAsync(e)];case 2:t.sent();return[4,r.nextAsync(e)];case 3:t.sent();return[2]}})})()}},{key:"validatePayload",value:function validatePayload(){var e=this.payload,t=e.leaderboardId;if(!iW.isString(t))throw new rP}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!iW.isString(e))throw new B}},{key:"setupCreatePayload",value:function setupCreatePayload(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y;return _ts_generator(this,function(p){r=e.customData,l=r.playerId;t.validatePlayerId(l);_=t.payload,d=_.name,h=_.leaderboardId,y=_.customData;t.leaderboardPayload={_id:h,name:null!=d?d:"",createdBy:l,description:JSON.stringify(y)};return[2]})})()}},{key:"createLeaderboardAsync",value:function createLeaderboardAsync(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,t.game.leaderboard.createLeaderboardAsync(t.leaderboardPayload)];case 1:r=l.sent();e.customData.leaderboardId=r;return[2]}})})()}}]);return Ui}(n7);c(iq,"CreateLeaderboardHandler");var iJ=iq;var iY=function(e){_inherits(ki,e);var t=_create_super(ki);function ki(){_class_call_check(this,ki);return t.apply(this,arguments)}_create_class(ki,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g,m,A,w,I;return _ts_generator(this,function(b){switch(b.label){case 0:b.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,l=e.name,_=e.score,d=e.leaderboardId,h=e.payload,y=new aG(t),p=new rs(t,{contextId:"SOLO"});y.setNext(p);f=new iz(t,{name:l,score:_,playerId:r,customData:h});p.setNext(f);v=new s0(t,{profileId:r});f.setNext(v);g=new ir(t,{id:r,score:_});v.setNext(g);m=new iJ(t,{name:l,customData:h,leaderboardId:d});g.setNext(m);A=new s7(t);m.setNext(A);w=new iH(t);A.setNext(w);I=t.match.getMatchState();return[4,y.processAsync(I)];case 1:b.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return ki}(nX);c(iY,"CreateTournamentConcrete");var iQ=iY;var iX=r.Plugins,i$=iX.Analytics,iZ=r.Utils,i0=iZ.Valid,i2=function(e){_inherits(Bi,e);var t=_create_super(Bi);function Bi(e,r){_class_call_check(this,Bi);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(Bi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Bi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.validateData(e);return[4,r.postScoreTournamentAsync(e)];case 1:t.sent();return[4,r.nextAsync(e)];case 2:t.sent();return[2]}})})()}},{key:"validateData",value:function validateData(e){var t=e.profiles,r=e.customData,l=r.playerId;if(this.validatePlayerId(l),!t[l])throw new aj}},{key:"validatePlayerId",value:function validatePlayerId(e){if(!i0.isString(e))throw new B}},{key:"getPlayerProfile",value:function getPlayerProfile(e){var t=e.profiles,r=e.customData,l=r.playerId;return this.validatePlayerId(l),t[l]}},{key:"isNewBestScore",value:function isNewBestScore(e){var t=this.getPlayerProfile(e),r=t.score,l=void 0===r?0:r,_=t.bestScore,d=void 0===_?0:_;return l>d}},{key:"postScoreTournamentAsync",value:function postScoreTournamentAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g,m;return _ts_generator(this,function(A){switch(A.label){case 0:r=window.game,l=r.analytics,_=t.getPlayerProfile(e),d=_.score,h=void 0===d?0:d;y=null,p=!1;f=t.payload,v=f.checkBestScore,g=t.isNewBestScore(e);A.label=1;case 1:A.trys.push([1,7,8,9]);if(!("getTournamentAsync"in GameSDK))throw new aN("getTournamentAsync");return[4,GameSDK.getTournamentAsync()];case 2:A.sent();if(!(!v||g))return[3,4];y=i$.Events.TOURNAMENT_SHARE;return[4,GameSDK.tournament.shareAsync({score:h})];case 3:A.sent();return[3,6];case 4:y=i$.Events.TOURNAMENT_POST_SCORE;return[4,GameSDK.tournament.postScoreAsync(h)];case 5:A.sent();A.label=6;case 6:p=!0;return[3,9];case 7:m=A.sent();console.warn("Post Score Tournament",m);return[3,9];case 8:y&&l.event(y,{success:p});return[7];case 9:return[2]}})})()}}]);return Bi}(n7);c(i2,"PostScoreTournamentHandler");var i1=i2;var i3=function(e){_inherits(ji,e);var t=_create_super(ji);function ji(){_class_call_check(this,ji);return t.apply(this,arguments)}_create_class(ji,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,h,y,p,f,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,l=e.bestScore,_=new aG(t),d=new rK(t,{useAPI:!1});_.setNext(d);h=new ir(t,{id:r,bestScore:l});d.setNext(h);y=new i1(t,{checkBestScore:!1});h.setNext(y);p=new rw(t);y.setNext(p);f=new rY(t);p.setNext(f);v=new s7(t);f.setNext(v);g=new rV(t);v.setNext(g);m=new al(t);g.setNext(m);A=t.match.getMatchState();return[4,_.processAsync(A)];case 1:w.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return ji}(nX);c(i3,"FinishTournamentConcrete");var i4=i3;var i5=r.Utils,i7=i5.Valid,i6=i5.Object,i8=function(e){_inherits(Ki,e);var t=_create_super(Ki);function Ki(e,r){_class_call_check(this,Ki);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(Ki,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(Ki.prototype),"processAsync",t)};return _async_to_generator(function(){var t,l,_,d,h,y;return _ts_generator(this,function(p){switch(p.label){case 0:_superprop_get_processAsync().call(r,e);t=r.payload,l=t.tournamentId;r.validateTournamentId(l);return[4,r.joinTournamentAsync(l)];case 1:p.sent();return[4,GameSDK.getTournamentAsync()];case 2:_=p.sent(),d=_.getContextID();r.validateContextId(d);h=JSON.parse(_.getPayload()||"{}"),y=h.leaderboardId;r.validateLeaderboardId(y),e.customData.contextId=d,e.customData.tournamentId=l,e.customData.leaderboardId=y;return[4,r.nextAsync(e)];case 3:p.sent();return[2]}})})()}},{key:"validateTournamentId",value:function validateTournamentId(e){if(!i7.isString(e))throw new iN}},{key:"validateContextId",value:function validateContextId(e){if(!i7.isString(e))throw new aO}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){if(!i7.isString(e)||""===e)throw new rP}},{key:"joinTournamentAsync",value:function joinTournamentAsync(e){return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:if(!("tournament"in GameSDK))throw new aN("tournament");r.label=1;case 1:r.trys.push([1,3,,4]);return[4,GameSDK.tournament.joinAsync(e)];case 2:r.sent();return[3,4];case 3:t=r.sent();if(!i6.hasOwn(t,"code")||"SAME_CONTEXT"!==t.code)throw t;return[3,4];case 4:return[2]}})})()}}]);return Ki}(n7);c(i8,"JoinTournamentHandler");var i9=i8;var oe=function(e){_inherits(Wi,e);var t=_create_super(Wi);function Wi(){_class_call_check(this,Wi);return t.apply(this,arguments)}_create_class(Wi,[{key:"processAsync",value:function processAsync(e){var t=this;return _async_to_generator(function(){var r,l,_,d,y,p,f,v,g,m,A;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,,2,3]);t.startLog(e);r=e.playerId,l=e.tournamentId,_=new aG(t),d=new i9(t,{tournamentId:l});_.setNext(d);y=new aC(t,{id:"1997",mode:h.TOURNAMENT,customData:{playerId:r}});d.setNext(y);p=new a5(t);y.setNext(p);f=new s0(t,{profileId:r});p.setNext(f);v=new ar(t);f.setNext(v);g=new ix(t);v.setNext(g);m=new al(t);g.setNext(m);A=t.match.getMatchState();return[4,_.processAsync(A)];case 1:w.sent();return[3,3];case 2:t.endLog();return[7];case 3:return[2]}})})()}}]);return Wi}(nX);c(oe,"JoinTournamentConcrete");var ot=oe;var oa=r.Dtos,or=r.Utils,os=or.Object,oc=function(e){_inherits(zi,e);var t=_create_super(zi);function zi(e,r){_class_call_check(this,zi);var l;l=t.call(this,e);u(_assert_this_initialized(l),"payload");l.payload=r;return l}_create_class(zi,[{key:"processAsync",value:function processAsync(e){var t=this;var r=this,_superprop_get_processAsync=function(){return _get(_get_prototype_of(zi.prototype),"processAsync",t)};return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:_superprop_get_processAsync().call(r,e),r.updateMatchCustomData(e);return[4,r.nextAsync(e)];case 1:t.sent();return[2]}})})()}},{key:"updateMatchCustomData",value:function updateMatchCustomData(e){var t=os.merge(e.customData,this.payload),r=new oa.Match.CustomData(t).toObject();e.customData=r}}]);return zi}(n7);c(oc,"SetMatchCustomDataHandler");var ol=oc;var ou={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:_object_spread({},aP)},o_=r.Configs,od=function(e){_inherits(Hi,e);var t=_create_super(Hi);function Hi(){_class_call_check(this,Hi);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"base");u(_assert_this_initialized(e),"group");u(_assert_this_initialized(e),"single");u(_assert_this_initialized(e),"endless");u(_assert_this_initialized(e),"context");u(_assert_this_initialized(e),"challenge");u(_assert_this_initialized(e),"tournament");u(_assert_this_initialized(e),"api");u(_assert_this_initialized(e),"handler");u(_assert_this_initialized(e),"useCPUProfile");return e}_create_class(Hi,[{key:"init",value:function init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}},{key:"setUseCPUProfile",value:function setUseCPUProfile(e){this.useCPUProfile=e}},{key:"createMatchData",value:function createMatchData(){var e=this.game,t=e.storage;t.addStorage("match",ou)}},{key:"getMatchState",value:function getMatchState(){var e=this.game,t=e.storage;return t.getStorage("match")}},{key:"createBaseConcrete",value:function createBaseConcrete(){this.base=new nX(this.game,this)}},{key:"createConcreteFlows",value:function createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}},{key:"createConcreteHandlers",value:function createConcreteHandlers(){var e=this;var t=this;var r=this;this.handler={setProfileData:c(function(){var t=_async_to_generator(function(t){var r;return _ts_generator(this,function(l){switch(l.label){case 0:r=new ir(e.base,t);return[4,e.processHandlerAsync(r)];case 1:l.sent();return[2]}})});return function(e){return t.apply(this,arguments)}}(),"setProfileData"),setMatchCustomData:c(function(){var e=_async_to_generator(function(e){var r;return _ts_generator(this,function(l){switch(l.label){case 0:r=new ol(t.base,e);return[4,t.processHandlerAsync(r)];case 1:l.sent();return[2]}})});return function(t){return e.apply(this,arguments)}}(),"setMatchCustomData"),setLeaderboardScore:c(function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(l){switch(l.label){case 0:t=new rL(r.base,e);return[4,r.processHandlerAsync(t)];case 1:l.sent();return[2]}})});return function(t){return e.apply(this,arguments)}}(),"setLeaderboardScore")}}},{key:"createAPIHandler",value:function createAPIHandler(){var e={appId:o_.AppId,matchAPIHost:o_.ApiHost};this.api=new nY(e)}},{key:"createGroupFlows",value:function createGroupFlows(){this.group={join:new ic(this.game,this),start:new iv(this.game,this),finish:new ie(this.game,this)}}},{key:"createSingleFlows",value:function createSingleFlows(){this.single={start:new ib(this.game,this),finish:new iw(this.game,this)}}},{key:"createEndlessFlows",value:function createEndlessFlows(){this.endless={start:new s1(this.game,this),finish:new sY(this.game,this)}}},{key:"createContextFlows",value:function createContextFlows(){this.context={choose:new sV(this.game,this)}}},{key:"createChallengeFlows",value:function createChallengeFlows(){this.challenge={invite:new su(this.game,this),friend:new a9(this.game,this),join:new sb(this.game,this),await:new aK(this.game,this),result:new sF(this.game,this),finish:new rX(this.game,this),continue:new ry(this.game,this)}}},{key:"createTournamentFlows",value:function createTournamentFlows(){this.tournament={join:new ot(this.game,this),create:new iQ(this.game,this),finish:new i4(this.game,this),continue:new iG(this.game,this)}}},{key:"processHandlerAsync",value:function processHandlerAsync(e){var t=this.getMatchState();return e.processAsync(t)}}]);return Hi}(l.Plugins.BasePlugin);c(od,"MatchPlugin");var oh=od;var oy=r.Utils,op=oy.Valid,of="is invalid",ov=function(e){_inherits(qi,e);var t=_create_super(qi);function qi(){_class_call_check(this,qi);return t.apply(this,arguments)}_create_class(qi,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){op.isNumber(e)&&e||this.exception("level",of)}},{key:"validateRescued",value:function validateRescued(e){(!op.isNumber(e)||e<0)&&this.exception("rescued",of)}},{key:"validateContextId",value:function validateContextId(e){op.isString(e)||this.exception("contextId",of)}},{key:"validatePlayerId",value:function validatePlayerId(e){op.isString(e)||this.exception("playerId",of)}},{key:"validateOpponentId",value:function validateOpponentId(e){op.isString(e)||this.exception("opponentId",of)}},{key:"validateTournamentId",value:function validateTournamentId(e){op.isString(e)||this.exception("tournamentId",of)}},{key:"validateLeaderboardId",value:function validateLeaderboardId(e){op.isString(e)||this.exception("leaderboardId",of)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(qi.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return S.getDefaultData()}}]);return qi}(S);c(ov,"MatchCustomDataDtos");var og=ov;og.addDefaultData(aP);var om=r.Utils,oA=om.Valid,ow="is invalid",oI=function(e){_inherits(Yi,e);var t=_create_super(Yi);function Yi(){_class_call_check(this,Yi);return t.apply(this,arguments)}_create_class(Yi,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateId",value:function validateId(e){oA.isString(e)&&e||this.exception("id",ow)}},{key:"validateName",value:function validateName(e){oA.isString(e)&&e||this.exception("name",ow)}},{key:"validatePhoto",value:function validatePhoto(e){oA.isString(e)||this.exception("photo",ow)}},{key:"validateScore",value:function validateScore(e){(!oA.isNumber(e)||e<0)&&this.exception("score",ow)}},{key:"validateBestScore",value:function validateBestScore(e){(!oA.isNumber(e)||e<0)&&this.exception("bestScore",ow)}},{key:"validateEndlessScore",value:function validateEndlessScore(e){(!oA.isNumber(e)||e<0)&&this.exception("endlessScore",ow)}},{key:"validateBestEndlessScore",value:function validateBestEndlessScore(e){(!oA.isNumber(e)||e<0)&&this.exception("bestEndlessScore",ow)}},{key:"validateFinished",value:function validateFinished(e){oA.isBoolean(e)||this.exception("finished",ow)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Yi.prototype),"toObject",this).call(this)}}],[{key:"getDefaultData",value:function getDefaultData(){return S.getDefaultData()}}]);return Yi}(S);c(oI,"MatchProfileDtos");var ob=oI;ob.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0}),r.Dtos.Match={Data:sC,CustomData:og,Profile:ob};var ok=r.Utils,oS=r.Configs,oD=oS.ApiHost,oP=c(function(){var e=_async_to_generator(function(e){var t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,eh("players",e,{},oD,10)];case 1:t=r.sent();return[2,ok.Object.hasOwn(t,"data")?t.data||{}:{}]}})});return function(t){return e.apply(this,arguments)}}(),"updatePlayerProfileAsync"),oE=r.Utils,oC=r.Configs,ox=oC.AppId,oM=oE.Array,oN=oE.Object,oL=oE.Valid,oO=function(e){_inherits(Qi,e);var t=_create_super(Qi);function Qi(){_class_call_check(this,Qi);return t.apply(this,arguments)}_create_class(Qi,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("player",P)}},{key:"saveToCloud",value:function saveToCloud(){var e=this;return _async_to_generator(function(){var t,r;return _ts_generator(this,function(l){switch(l.label){case 0:l.trys.push([0,2,,3]);t=e.getPlayerData();return[4,GameSDK.player.setDataAsync(t)];case 1:l.sent();return[3,3];case 2:r=l.sent();console.warn(r);return[3,3];case 3:return[2]}})})()}},{key:"receiveData",value:function receiveData(e,t){var r=this.game,l=r.storage,_=e.playerId,d=e.name,h=e.photo,y=e.locale;l.setStorageData("player","playerId",_),l.setStorageData("player","name",d),l.setStorageData("player","photo",h),l.setStorageData("player","locale",y),t&&this.setPlayerData(t)}},{key:"syncProfileToServer",value:function syncProfileToServer(){var e=this;return _async_to_generator(function(){var t,r,l,_,d,h,y,p,f,v;return _ts_generator(this,function(g){switch(g.label){case 0:t=e.game,r=t.storage,l=e.getPlayer(),_=l.playerId,d=l.name,h=l.photo,y=l.locale;p=e.getPlayerASID();v=!oL.isString(p)&&"getASIDAsync"in GameSDK.player;if(!v)return[3,2];return[4,GameSDK.player.getASIDAsync()];case 1:v=(p=null!==(f=g.sent())&&void 0!==f?f:p,r.setStorageData("player","ASID","".concat(p)));g.label=2;case 2:return[4,oP({appId:ox,ASID:p,playerId:_,name:d,photo:h,locale:y})];case 3:g.sent();return[2]}})})()}},{key:"setPlayerDataByName",value:function setPlayerDataByName(e,t){this.setPlayerData(_define_property({},e,t))}},{key:"setPlayerData",value:function setPlayerData(e){var t=this.game,r=t.storage;r.setStorageData("player","data",e),this.saveToCloud()}},{key:"setBestScore",value:function setBestScore(e){this.setPlayerDataByName("score",e)}},{key:"setBestEndlessScore",value:function setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}},{key:"setSetting",value:function setSetting(e,t){this.setPlayerDataByName("settings",_define_property({},e,t))}},{key:"setGameData",value:function setGameData(e){var t;var r=null!==(t=this.getGameData())&&void 0!==t?t:{},l=oN.merge(r,e);this.setPlayerDataByName("gameData",l)}},{key:"requestConnectedPlayers",value:function requestConnectedPlayers(){var e=this;return _async_to_generator(function(){var t,r,l,_,d;return _ts_generator(this,function(h){switch(h.label){case 0:t=e.game,r=t.storage;return[4,GameSDK.player.getConnectedPlayersAsync()];case 1:l=h.sent().map(function(e){var t=e.getID(),r=e.getName(),l=e.getPhoto();return t&&r&&l?new R({playerId:t,name:r,photo:l}).toObject():null}),_=oM.unique(l);if(_.length<1)return[2];d=oN.keyBy(_,"playerId");r.setStorageData("player","connectedPlayers",d);return[2]}})})()}},{key:"getPlayer",value:function getPlayer(){var e=this.game,t=e.storage;return t.getStorage("player")}},{key:"getPlayerId",value:function getPlayerId(){var e=this.game,t=e.storage;return t.getStorageData("player","playerId")}},{key:"getPlayerASID",value:function getPlayerASID(){var e=this.game,t=e.storage;return t.getStorageData("player","ASID")}},{key:"getPlayerLocale",value:function getPlayerLocale(){var e=this.game,t=e.storage;return t.getStorageData("player","locale")}},{key:"getPlayerData",value:function getPlayerData(){var e=this.game,t=e.storage;return t.getStorageData("player","data")}},{key:"getPlayerDataByKey",value:function getPlayerDataByKey(e){var t=this.getPlayerData();return oN.hasOwn(t,e)?t[e]:null}},{key:"getGameData",value:function getGameData(){return this.getPlayerDataByKey("gameData")}},{key:"getPlayerSetting",value:function getPlayerSetting(e){var t=this.getPlayerSettings();return oN.hasOwn(t,e)?t[e]:null}},{key:"getPlayerSettings",value:function getPlayerSettings(){var e=this.getPlayerData(),t=e.settings;return t}},{key:"isFirstLogin",value:function isFirstLogin(){var e;return null!==(e=this.getPlayerDataByKey("isFirstLogin"))&&void 0!==e?e:P.data.isFirstLogin}},{key:"loggedIn",value:function loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}},{key:"getBestScore",value:function getBestScore(){var e=this.getPlayerData(),t=e.score;return t}},{key:"getBestEndlessScore",value:function getBestEndlessScore(){var e=this.getPlayerData(),t=e.endlessScore;return t}},{key:"getConnectedPlayers",value:function getConnectedPlayers(){var e=this.game,t=e.storage;return t.getStorageData("player","connectedPlayers")}},{key:"getConnectedPlayerIds",value:function getConnectedPlayerIds(e,t){var r=this.getConnectedPlayers();return Object.keys(r).slice(t,t+e)}}]);return Qi}(l.Plugins.BasePlugin);c(oO,"PlayerPlugin");var oT=oO;var oR=r.Dtos,oF=r.Utils,oG=oF.Valid,oV=P.data,oj=oV.score,oB=oV.endlessScore,oH=oV.settings,oU=oV.gameData,oz=oV.isFirstLogin,oK=oV.dailyRewarded,oW="is invalid",oq=function(e){_inherits(Xi,e);var t=_create_super(Xi);function Xi(){_class_call_check(this,Xi);return t.apply(this,arguments)}_create_class(Xi,[{key:"processData",value:function processData(e){this.validateStructure(e),e.settings=new oR.Player.Settings(e.settings).toObject(),e.gameData=new oR.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}},{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateScore",value:function validateScore(e){(!oG.isNumber(e)||e<0)&&this.exception("score",oW)}},{key:"validateEndlessScore",value:function validateEndlessScore(e){(!oG.isNumber(e)||oj<0)&&this.exception("endlessScore",oW)}},{key:"validateSettings",value:function validateSettings(e){oG.isObject(e)||this.exception("settings",oW)}},{key:"validateGameData",value:function validateGameData(e){oG.isObject(e)||this.exception("gameData",oW)}},{key:"validateIsFirstLogin",value:function validateIsFirstLogin(e){oG.isBoolean(e)||this.exception("isFirstLogin",oW)}},{key:"validateDailyRewarded",value:function validateDailyRewarded(e){oG.isObject(e)||this.exception("dailyRewarded",oW)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Xi.prototype),"toObject",this).call(this)}}]);return Xi}(S);c(oq,"PlayerDataDtos");var oJ=oq;oJ.addDefaultData({score:oj,endlessScore:oB,settings:oH,gameData:oU,isFirstLogin:oz,dailyRewarded:oK});var oY=r.Utils,oQ=oY.Valid,oX=P.data.gameData,o$=oX.level,oZ=oX.coins,o0=function(e){_inherits(Ji,e);var t=_create_super(Ji);function Ji(){_class_call_check(this,Ji);return t.apply(this,arguments)}_create_class(Ji,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateLevel",value:function validateLevel(e){(!oQ.isNumber(e)||e<0)&&this.exception("level","is invalid")}},{key:"validateCoins",value:function validateCoins(e){(!oQ.isNumber(e)||e<0)&&this.exception("coins","is invalid")}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Ji.prototype),"toObject",this).call(this)}}]);return Ji}(S);c(o0,"PlayerGameDataDtos");var o2=o0;o2.addDefaultData({level:o$,coins:oZ});var o1=r.Utils,o3=o1.Valid,o4=P.data.settings,o5=o4.sound,o7=o4.music,o6=o4.vibrate,o8=o4.language,o9="is invalid",ce=function(e){_inherits(Zi,e);var t=_create_super(Zi);function Zi(){_class_call_check(this,Zi);return t.apply(this,arguments)}_create_class(Zi,[{key:"setupData",value:function setupData(e){this.lazySetupData(e)}},{key:"validateStructure",value:function validateStructure(e){this.lazyValidateStructure(e)}},{key:"validateData",value:function validateData(e){this.lazyValidateData(e)}},{key:"validateSound",value:function validateSound(e){o3.isBoolean(e)||this.exception("sound",o9)}},{key:"validateMusic",value:function validateMusic(e){o3.isBoolean(e)||this.exception("music",o9)}},{key:"validateVibrate",value:function validateVibrate(e){o3.isBoolean(e)||this.exception("vibrate",o9)}},{key:"validateLanguage",value:function validateLanguage(e){o3.isString(e)&&e||this.exception("language",o9)}},{key:"toObject",value:function toObject(){return _get(_get_prototype_of(Zi.prototype),"toObject",this).call(this)}}]);return Zi}(S);c(ce,"PlayerSettingsDtos");var ct=ce;ct.addDefaultData({sound:o5,music:o7,vibrate:o6,language:o8}),r.Dtos.Player={Info:R,Data:oJ,Settings:ct,GameData:o2};var ca=r.Configs,cr=r.Utils,cs=cr.Object,cc=cr.String,cl=ca.ApiHost,cu=ca.Mockup,c_=function(){function to(){_class_call_check(this,to);u(this,"mockAPI")}_create_class(to,[{key:"initMockAPI",value:function initMockAPI(){var e=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:if(e.mockAPI)return[2];return[4,d(_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tR})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:r=l.sent().default;if("function"!=typeof r)throw new Error("Cannot load ProfileAPIMock");e.mockAPI=new r;return[2]}})})()}},{key:"getPlayersAsync",value:function getPlayersAsync(e){var t=this;return _async_to_generator(function(){var r,l;return _ts_generator(this,function(_){switch(_.label){case 0:r=cc.params(e);if(!cu.Profile.Enabled)return[3,3];return[4,t.initMockAPI()];case 1:_.sent();return[4,t.mockAPI.getPlayersAsync(e)];case 2:l=_.sent();return[3,5];case 3:return[4,ed("players?".concat(r),{},cl)];case 4:l=_.sent();_.label=5;case 5:return[2,cs.hasOwn(l,"data")&&Array.isArray(l.data)?l.data:[]]}})})()}}]);return to}();c(c_,"ProfileAPI");var cd=c_;var ch={profiles:{},profileIds:[]},cy=r.Utils,cp=r.Dtos,cf=cy.Array,cv=cy.Valid,cg=cy.Object,cm=function(e){_inherits(eo,e);var t=_create_super(eo);function eo(){_class_call_check(this,eo);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"profileAPI",new cd);return e}_create_class(eo,[{key:"init",value:function init(){var e=this.game,t=e.storage;t.addStorage("profile",ch)}},{key:"requestProfiles",value:function requestProfiles(e){var t=this;return _async_to_generator(function(){var r,l,_,d;return _ts_generator(this,function(h){switch(h.label){case 0:r=t.getProfileIds(),l=cf.difference(e,r);if(l.length<1)return[2];return[4,t.profileAPI.getPlayersAsync({playerIds:l})];case 1:_=h.sent();if(!t.validateProfilesResponse(_))return[2];d=t.convertToProfiles(_);t.setProfiles(d);return[2]}})})()}},{key:"getProfile",value:function getProfile(e){var t;return null!==(t=this.getProfiles()[e])&&void 0!==t?t:null}},{key:"getProfiles",value:function getProfiles(){var e=this.game,t=e.storage;return t.getStorageData("profile","profiles")}},{key:"setProfiles",value:function setProfiles(e){var t=this.game,r=t.storage;r.setStorageData("profile","profiles",e),r.setStorageData("profile","profileIds",Object.keys(e))}},{key:"getProfileIds",value:function getProfileIds(){var e=this.game,t=e.storage;return t.getStorageData("profile","profileIds")}},{key:"validateProfilesResponse",value:function validateProfilesResponse(e){return!(!Array.isArray(e)||e.length<1)}},{key:"convertToProfiles",value:function convertToProfiles(e){var t={};return e.forEach(function(e){cg.hasOwn(e,"playerId")&&cv.isString(e.playerId)&&(t[e.playerId]=new cp.Player.Info(e).toObject())}),t}}]);return eo}(l.Plugins.BasePlugin);c(cm,"ProfilePlugin");var cA=cm;var cw=r.Utils,cI=function(e){_inherits(so,e);var t=_create_super(so);function so(e){_class_call_check(this,so);var r;r=t.call(this,e);u(_assert_this_initialized(r),"storages");r.storages={};return r}_create_class(so,[{key:"addStorage",value:function addStorage(e,t){console.info("addStorage",e,t),this.storages[e]=t}},{key:"setStorageData",value:function setStorageData(e,t,r){var l;if(cw.Valid.isObject(r)){var _=this.getStorageData(e,t);l=cw.Object.merge(_,r)}else l=r;this.storages[e][t]=l}},{key:"getStorageData",value:function getStorageData(e,t){return this.getStorage(e)[t]}},{key:"getStorage",value:function getStorage(e){return this.storages[e]}}]);return so}(l.Plugins.BasePlugin);c(cI,"StoragePlugin");var cb=cI;var ck=function(e){_inherits(ao,e);var t=_create_super(ao);function ao(){_class_call_check(this,ao);var e;e=t.call.apply(t,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"isVisible",!0);u(_assert_this_initialized(e),"browserPrefixes",["moz","ms","o","","webkit"]);u(_assert_this_initialized(e),"handleVisibilityChange",c(function(t){if(["focus","blur"].indexOf(t)>-1)return"focus"===t?e.onVisibleEvent():e.onHiddenEvent();var r=e.getBrowserPrefix();return e.getHiddenPropertyName(r) in document?e.onHiddenEvent():e.onVisibleEvent()},"handleVisibilityChange"));return e}_create_class(ao,[{key:"init",value:function init(){var e=this;var t=this.getBrowserPrefix();[this.getVisibilityEvent(t),"focus","blur"].forEach(function(t){window.addEventListener(t,function(){e.handleVisibilityChange(t)},!1),document.addEventListener(t,function(){e.handleVisibilityChange(t)},!1)})}},{key:"isGameVisible",value:function isGameVisible(){return this.isVisible}},{key:"getHiddenPropertyName",value:function getHiddenPropertyName(e){return e?e+"Hidden":"hidden"}},{key:"getVisibilityEvent",value:function getVisibilityEvent(e){return(e||"")+"visibilitychange"}},{key:"getBrowserPrefix",value:function getBrowserPrefix(){var e=true,t=false,r=void 0;try{for(var l=this.browserPrefixes[Symbol.iterator](),_;!(e=(_=l.next()).done);e=true){var d=_.value;if(this.getHiddenPropertyName(d) in document)return d}}catch(e){t=true;r=e}finally{try{if(!e&&null!=l.return)l.return()}finally{if(t)throw r}}return""}},{key:"onVisibleEvent",value:function onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(r.Events.VISIBILITY_VISIBLE))}},{key:"onHiddenEvent",value:function onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(r.Events.VISIBILITY_HIDDEN))}}]);return ao}(l.Plugins.BasePlugin);c(ck,"VisibilityPlugin");var cS=ck;var cD=function(e){_inherits(no,e);var t=_create_super(no);function no(){_class_call_check(this,no);return t.apply(this,arguments)}_create_class(no,[{key:"loadAsync",value:function loadAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){e.exception("Unsupported method");return[2]})})()}},{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){e.exception("This method is not implemented");return[2]})})()}},{key:"hideAsync",value:function hideAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){e.exception("This method is not implemented");return[2]})})()}}]);return no}(ek);c(cD,"BannerInstance");var cP=cD;var cE=r.Plugins.Ads,cC=cE.Status,cx=function(e){_inherits(io,e);var t=_create_super(io);function io(){_class_call_check(this,io);return t.apply(this,arguments)}_create_class(io,[{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,GameSDK.loadBannerAdAsync(e.placementId)];case 1:t.sent(),e.status=cC.SHOWING;return[2]}})})()}},{key:"hideAsync",value:function hideAsync(){var e=this;return _async_to_generator(function(){return _ts_generator(this,function(t){switch(t.label){case 0:return[4,GameSDK.hideBannerAdAsync(e.placementId)];case 1:t.sent(),e.status=cC.IDLE;return[2]}})})()}}]);return io}(cP);c(cx,"BannerAdInstance");var cM=cx;var cN=r.Utils,cL=cN.Object,cO=r.Plugins.Ads,cT=cO.Status,cR=cO.Types,cF=cO.AdError,cG=cO.AdInstance,cV=function(e){_inherits(oo,e);var t=_create_super(oo);function oo(e,r){_class_call_check(this,oo);var l;l=t.call(this,e,r);u(_assert_this_initialized(l),"instance");u(_assert_this_initialized(l),"instanceLoadFailedQueue",[]);l.instance=null;return l}_create_class(oo,[{key:"loadAsync",value:function loadAsync(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:if(console.info("AdInstance","loadAsync called",{type:e.type,status:e.status}),e.status!==cT.IDLE)throw new cF("AD_NOT_READY","Ad is not ready.");r.label=1;case 1:r.trys.push([1,4,,5]);return[4,e.createInstanceByType(e.type)];case 2:if(e.instance=r.sent(),null===e.instance)throw new cF("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");e.status=cT.LOADING;return[4,e.instance.loadAsync()];case 3:r.sent(),e.status=cT.FILLED,console.info("AdInstance","loadAsync success",{type:e.type,status:e.status}),e.type===cR.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(),e.type===cR.REWARDED_VIDEO&&self.game.analytics.loadRewardedVideoAd();return[3,5];case 4:t=r.sent();throw console.warn("AdInstance","loadAsync failed",{type:e.type,status:e.status,error:t}),e.status=cT.IDLE,_instanceof(t,Object)&&"code"in t&&"INVALID_PARAM"===t.code&&(e.instance=null),e.instance&&e.instanceLoadFailedQueue.push(e.instance),self.game.analytics.loadAdFail(e.type),t;case 5:return[2]}})})()}},{key:"showAsync",value:function showAsync(){var e=this;return _async_to_generator(function(){var t,l;return _ts_generator(this,function(_){switch(_.label){case 0:if(console.info("AdInstance","showAsync called",{type:e.type,status:e.status}),e.status!==cT.FILLED)throw new cF("AD_NOT_FILLED","Ad is not filled.");if(null===e.instance)throw new cF("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");t=!1;_.label=1;case 1:_.trys.push([1,3,4,5]);e.status=cT.SHOWING;return[4,e.instance.showAsync()];case 2:_.sent(),t=!0,e.status=cT.IDLE,e.instance=null,console.info("AdInstance","showAsync success",{type:e.type,status:e.status});return[3,5];case 3:l=_.sent();throw console.warn("AdInstance","showAsync failed",{type:e.type,status:e.status,error:l}),e.status=cT.FILLED,r.Utils.Object.hasOwn(l,"code")&&("AD_NOT_LOADED"===l.code&&(e.status=cT.IDLE),["INVALID_PARAM","INVALID_OPERATION","USER_INPUT"].indexOf("".concat(l.code))>-1&&(e.status=cT.IDLE,e.instance=null),"USER_INPUT"===l.code&&(t=!0)),l;case 4:t?(e.type===cR.INTERSTITIAL&&self.game.analytics.showInterstitialAd(),e.type===cR.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd()):self.game.analytics.showAdFail(e.type);return[7];case 5:return[2]}})})()}},{key:"createInstanceByType",value:function createInstanceByType(e){var t=this;return _async_to_generator(function(){var r;return _ts_generator(this,function(l){switch(l.label){case 0:l.trys.push([0,7,,8]);switch(e){case cR.REWARDED_VIDEO:return[3,1];case cR.INTERSTITIAL:return[3,3]}return[3,5];case 1:return[4,GameSDK.getRewardedVideoAsync(t.placementId)];case 2:return[2,l.sent()];case 3:return[4,GameSDK.getInterstitialAdAsync(t.placementId)];case 4:return[2,l.sent()];case 5:return[2,null];case 6:return[3,8];case 7:r=l.sent();if(!cL.hasOwn(r,"code"))throw r;return[2,"ADS_TOO_MANY_INSTANCES"===r.code?t.getAdInstanceFailed():null];case 8:return[2]}})})()}},{key:"getAdInstanceFailed",value:function getAdInstanceFailed(){var e=this.instanceLoadFailedQueue,t=e.length,r=Math.floor(Math.random()*t);return this.instanceLoadFailedQueue[r]||null}}]);return oo}(cG);c(cV,"NormalAdInstance");var cj=cV;var cB=r.Plugins.Analytics,cH=cB.BaseAnalytics,cU=cB.Events,cz=[cU.BUTTON_CLICK,cU.SCREEN_OPEN],cK=function(e){_inherits(ro,e);var t=_create_super(ro);function ro(e,r){_class_call_check(this,ro);var l;l=t.call(this,e,"FacebookAnalytics",_object_spread_props(_object_spread({},r),{color:"#0F52BA"}));u(_assert_this_initialized(l),"prefix");l.prefix=r.prefix;return l}_create_class(ro,[{key:"processEvent",value:function processEvent(e,t){if(!("logEvent"in GameSDK.extra)||cz.indexOf(e)>-1)return;var r=this.addPrefixToEventName(e);GameSDK.extra.logEvent(r,1,t)}},{key:"addPrefixToEventName",value:function addPrefixToEventName(e){return"".concat(this.prefix,"_").concat(e)}}]);return ro}(cH);c(cK,"FacebookAnalytics");var cW=cK;var cq=r.Plugins.Analytics,cJ=cq.BaseAnalytics,cY=cq.Events,cQ=[cY.SCREEN_OPEN],cX=function(e){_inherits(co,e);var t=_create_super(co);function co(e,r){_class_call_check(this,co);return t.call(this,e,"FirebaseAnalytics",_object_spread_props(_object_spread({},r),{color:"#FFCA28"}))}_create_class(co,[{key:"setUser",value:function setUser(e,t){var r;null==(r=this.game.firebase.services.analytics)||r.setUser(e,t)}},{key:"processEvent",value:function processEvent(e,t){var r;cQ.indexOf(e)>=0||null==(r=this.game.firebase.services.analytics)||r.event(e,t)}}]);return co}(cJ);c(cX,"FirebaseAnalytics");var c$=cX;var cZ=r.Plugins.Analytics,c0=cZ.BaseAnalytics,c2=cZ.Events,c1=[c2.SCREEN_OPEN],c3=function(e){_inherits(lo,e);var t=_create_super(lo);function lo(e,r){_class_call_check(this,lo);return t.call(this,e,"GoogleAnalytics",_object_spread_props(_object_spread({},r),{color:"#E35335"}))}_create_class(lo,[{key:"processEvent",value:function processEvent(e,t){c1.indexOf(e)>=0||gtag("event",e,t)}}]);return lo}(c0);c(c3,"GoogleAnalytics");var c4=c3;var c5="production",c7="45",c6=r.Dtos,c8=r.Events,c9=r.Configs,le=r.Utils,lt=le.Object,la=le.Json,lr=le.String,ls=le.Valid,lc=le.Mark,ll=function(e){_inherits(ho,e);var l=_create_super(ho);function ho(){_class_call_check(this,ho);var e;e=l.call.apply(l,[this].concat(Array.prototype.slice.call(arguments)));u(_assert_this_initialized(e),"markName","Core Initialize");u(_assert_this_initialized(e),"modulePlugins",[]);u(_assert_this_initialized(e),"handleProtectGameInstance",c(function(){var t=e.event.getEventEmitCount(y.MODULE_PLUGIN_READY),r=e.modulePlugins.length;t<r||(window.game=Object.freeze(window.game))},"handleProtectGameInstance"));u(_assert_this_initialized(e),"initMonitorErrorPlugin",c(function(){if(!e.monitorError)return;var t=c9.Debugger,r=t.MonitorError,l=r.ApiKey,_=r.Service,d=r.TrackUser,h=r.FilterErrors,y=r.ListPlayerDevIds,p=GameSDK.player.getID(),f=GameSDK.player.getName();p&&y.indexOf(p)>-1||(e.monitorError.configure({apiKey:l,service:_,trackUser:d,releaseStage:c5,buildVersion:"".concat(c7)}),e.monitorError.setUser({id:p,name:f}),e.monitorError.addFilterErrors(h),e.updateMonitorErrorUserAndMetadata(),e.processErrorsQueue())},"initMonitorErrorPlugin"));u(_assert_this_initialized(e),"updateMonitorErrorUserAndMetadata",c(function(){if(!(e.event.getEventEmitCount(c8.PLAYER_INFO_LOADED)>0)){e.event.once(c8.PLAYER_INFO_LOADED,e.processWhenPlayerInfoLoaded);return}e.processWhenPlayerInfoLoaded()},"updateMonitorErrorUserAndMetadata"));u(_assert_this_initialized(e),"processErrorsQueue",c(function(){window.__errorQueue&&(window.__errorQueue.forEach(function(t){if(e.monitorError){if(_instanceof(t,Error))e.monitorError.sendException(t);else{var r=t||{message:"",code:"Unknown",stack:"Unknown stack"},l=r.message,_=r.code,d=r.stack,h=new Error(l||_);h.stack=d,e.monitorError.sendException(h)}}}),window.__errorQueue=null)},"processErrorsQueue"));u(_assert_this_initialized(e),"processWhenPlayerInfoLoaded",c(function(){var t,r;var l=e.player.getPlayer(),_=l.playerId,d=l.name;null==(t=e.monitorError)||t.setUser({id:_,name:d}),null==(r=e.monitorError)||r.addMetadata({isFirstLogin:e.player.isFirstLogin()})},"processWhenPlayerInfoLoaded"));u(_assert_this_initialized(e),"handleSaveRemoteConfig",c(function(t){try{var r=_define_property({},t.type,t);e.player.setPlayerDataByName("remoteConfig",r)}catch(e){console.warn("handleSaveGameCoreConfig",e)}},"handleSaveRemoteConfig"));u(_assert_this_initialized(e),"handleUpdateGameCoreConfig",c(function(t){try{var l=t.id,_=t.type;if("GameCore"!==_)return;r.Configs=lt.merge(r.Configs,t.config);var d=r.Configs,h=d.Ads;e.ads.configure(h),e.event.emit(y.REMOTE_CONFIG_UPDATED,{id:l,type:_})}catch(e){console.warn("handleUpdateGameCoreConfig",e)}},"handleUpdateGameCoreConfig"));u(_assert_this_initialized(e),"handleStorageCurrentRemoteConfig",c(function(){var t=e.player.getPlayerDataByKey("remoteConfig");if(console.info("playerRemoteConfig",la.clone(t)),!!t){for(var r in t)if(lt.hasOwn(t,r)){var l=t[r],_=la.clone(l);console.log("newRemoteConfig",_);var d=new c6.RemoteConfig.Data(_).toObject();console.info("remoteConfigValid",d),e.remoteConfig.setRemoteConfig(d),e.remoteConfig.processUpdateConfig(d.id,d.type)}}},"handleStorageCurrentRemoteConfig"));u(_assert_this_initialized(e),"initAdaptivePerformancePlugin",c(function(){if(!e.adaptivePerformance)return;var t=la.clone(c9.AdaptivePerformance);e.adaptivePerformance.configure(t)},"initAdaptivePerformancePlugin"));u(_assert_this_initialized(e),"processAfterSyncProfile",c(function(){var t=c9.Notification;t.Enabled&&e.updatePlayerProfileToNotificationService()},"processAfterSyncProfile"));return e}_create_class(ho,[{key:"getBuildVersion",value:function getBuildVersion(){return parseInt("".concat(c7))}},{key:"boot",value:function boot(){var e=this;var t=this,_superprop_get_boot=function(){return _get(_get_prototype_of(ho.prototype),"boot",e)};return _async_to_generator(function(){return _ts_generator(this,function(e){console.groupCollapsed("\uD83E\uDDEC GameCore Boot"),_superprop_get_boot().call(t),t.addPlugins(),t.initEventPlugin(),t.event.emit(c8.CORE_BOOTING),t.initFirebasePlugin(),t.initMarkCoreInitialize(),lc.putAttr(t.markName,"Step","Init Plugins"),t.initAds(),t.initMatchPlugin(),t.initRemoteConfig(),lc.putAttr(t.markName,"Step","Load Lazy Plugins"),ls.isDebugger()||t.event.on(c8.MODULE_PLUGIN_READY,t.handleProtectGameInstance),t.addMonitorPlugin().then(t.initMonitorErrorPlugin),t.addAdaptivePerformancePlugin().then(t.initAdaptivePerformancePlugin),lc.putAttr(t.markName,"Step","Load Dev Plugins"),t.addDevPlugins().then(function(){t.initConsolePlugin(),t.initProfilerPlugin(),t.initCanvasRecorderPlugin()});return[2]})})()}},{key:"start",value:function start(){var e=this;var t=this,_superprop_get_start=function(){return _get(_get_prototype_of(ho.prototype),"start",e)};return _async_to_generator(function(){var e;return _ts_generator(this,function(r){switch(r.label){case 0:console.groupEnd(),console.groupCollapsed("\uD83E\uDDEC GameCore Start"),_superprop_get_start().call(t),lc.putAttr(t.markName,"Step","Core Start"),t.event.emit(c8.CORE_STARTING),lc.putAttr(t.markName,"Step","Request Token");return[4,t.auth.requestToken()];case 1:r.sent(),lc.putAttr(t.markName,"Step","Init States");return[4,t.initState()];case 2:r.sent(),lc.putAttr(t.markName,"Step","Process Player Profile"),t.processPlayerProfile(),lc.putAttr(t.markName,"Step","Process Context Payload");return[4,t.context.detectContextSessionType()];case 3:r.sent(),t.context.detectContextGameMode();e=t.storage.getStorageData("context","sessionContextType");lc.putAttr(t.markName,"Context Mode",e),lc.putAttr(t.markName,"Step","Init Analytics"),t.initGoogleAnalytics(),t.initFirebaseAnalytics(),t.initFacebookAnalytics(),lc.putAttr(t.markName,"Step","Core Ready"),lc.putAttr(t.markName,"Success","true"),lc.stop(t.markName),t.event.emit(c8.CORE_READY);return[2]}})})()}},{key:"addPlugins",value:function addPlugins(){this.installPlugin("Storage",cb),this.installPlugin("Event",tO),this.installPlugin("Ads",eC),this.installPlugin("Auth",eW),this.installPlugin("Audio",eU),this.installPlugin("Match",oh),this.installPlugin("Player",oT),this.installPlugin("Profile",cA),this.installPlugin("Context",tc),this.installPlugin("Language",nI),this.installPlugin("Analytics",eF),this.installPlugin("Visibility",cS),this.installPlugin("Leaderboard",nH),this.installPlugin("DailyRewards",tP),this.installPlugin("FrameCapture",np),this.installPlugin("RemoteConfig",tT),"Proxy"in window&&this.installPlugin("Firebase",tT)}},{key:"installPlugin",value:function installPlugin(e,t,r){var l=arguments.length>2&&void 0!==r&&r;var _=lr.toCamelCase(lr.capitalize(e));this.plugins.install(e,t,!0,_),"Storage"!==e&&(l?this.emitModulePluginReady(e):this.emitCorePluginReady(e))}},{key:"addMonitorPlugin",value:function addMonitorPlugin(){var e=this;return _async_to_generator(function(){var r,l,_;return _ts_generator(this,function(h){switch(h.label){case 0:r=c9.Debugger,l=r.MonitorError;if(!l.Enabled)return[2];e.modulePlugins.push("MonitorError");return[4,d(_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tR})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 1:_=h.sent().default;"function"==typeof _&&e.installPlugin("MonitorError",_,!0);return[2]}})})()}},{key:"addAdaptivePerformancePlugin",value:function addAdaptivePerformancePlugin(){var e=this;return _async_to_generator(function(){var r,l;return _ts_generator(this,function(_){switch(_.label){case 0:r=c9.AdaptivePerformance;if(!r.Enabled)return[2];e.modulePlugins.push("AdaptivePerformance");return[4,d(_async_to_generator(function(){var e,r;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,t.import("./bundle/index.js")];case 1:e=l.sent(),r=e.default;return[2,{default:r}]}})}),void 0,t.meta.url)];case 1:l=_.sent().default;"function"==typeof l&&e.installPlugin("AdaptivePerformance",l,!0);return[2]}})})()}},{key:"addDevPlugins",value:function addDevPlugins(){var e=this;return _async_to_generator(function(){var r,l,_,h,y,p,f;return _ts_generator(this,function(v){switch(v.label){case 0:if(!ls.isDebugger())return[2];r=c9.Debugger,l=r.ShowConsole,_=r.ShowProfiler,h=r.CanvasRecorder;if(!l)return[3,2];e.modulePlugins.push("Console");return[4,d(_async_to_generator(function(){var e,r;return _ts_generator(this,function(l){switch(l.label){case 0:return[4,t.import("./bundle/console.js")];case 1:e=l.sent(),r=e.default;return[2,{default:r}]}})}),void 0,t.meta.url)];case 1:y=v.sent().default;"function"==typeof y&&e.installPlugin("Console",y,!0);v.label=2;case 2:if(!_)return[3,4];e.modulePlugins.push("Profiler");return[4,d(_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tR})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 3:p=v.sent().default;"function"==typeof p&&e.installPlugin("Profiler",p,!0);v.label=4;case 4:if(!h.Enabled)return[3,6];e.modulePlugins.push("CanvasRecorder");return[4,d(_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return tR})];case 1:e=r.sent(),t=e.default;return[2,{default:t}]}})}),void 0,t.meta.url)];case 5:f=v.sent().default;"function"==typeof f&&e.installPlugin("CanvasRecorder",f,!0);v.label=6;case 6:return[2]}})})()}},{key:"emitCorePluginReady",value:function emitCorePluginReady(e){this.event.emit(y.CORE_PLUGIN_READY,{name:e})}},{key:"emitModulePluginReady",value:function emitModulePluginReady(e){this.event.emit(y.MODULE_PLUGIN_READY,{name:e})}},{key:"initEventPlugin",value:function initEventPlugin(){var e=c9.Debugger,t=e.EventLogging;t&&this.event.enableLogEvent()}},{key:"initMatchPlugin",value:function initMatchPlugin(){this.match.setUseCPUProfile(!1)}},{key:"initAds",value:function initAds(){var e=r.Plugins,t=e.Ads;this.ads.configure(c9.Ads),this.initAdInstance(t,c9)}},{key:"initAdInstance",value:function initAdInstance(e,t){var r=this;var l=t.Ads,_=l.InterstitialAdOptions,d=l.RewardedVideoAdOptions,h=l.BannerDisplayAdOptions;_.forEach(function(t){r.ads.setAdInstance(e.Types.INTERSTITIAL,t.PlacementId,cj)}),d.forEach(function(t){r.ads.setAdInstance(e.Types.REWARDED_VIDEO,t.PlacementId,cj)}),h.forEach(function(t){r.ads.setAdInstance(e.Types.BANNER,t.PlacementId,cM)})}},{key:"initState",value:function initState(){var e=this;return _async_to_generator(function(){var t,r;return _ts_generator(this,function(l){switch(l.label){case 0:l.trys.push([0,2,,3]);t=new Q(e);t.initContext();return[4,t.initPlayer()];case 1:l.sent();return[3,3];case 2:r=l.sent();console.error("StateInitiator",r);return[3,3];case 3:return[2]}})})()}},{key:"initConsolePlugin",value:function initConsolePlugin(){this.console&&this.console.configure()}},{key:"initProfilerPlugin",value:function initProfilerPlugin(){this.profiler&&this.profiler.configure()}},{key:"initCanvasRecorderPlugin",value:function initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;var e=c9.Debugger,t=e.CanvasRecorder,r=t.Options,l=r.Type,_=r.Quality,d=r.RecordFps,h=r.SyncFps;this.canvasRecorder.configure({type:l,quality:_,syncFps:h,recordFps:d});var y=document.querySelector("canvas");if(!y)return console.error("Canvas not found");this.canvasRecorder.setCanvas(y)}},{key:"initRemoteConfig",value:function initRemoteConfig(){var e=c9.RemoteConfig;if(!e.Enabled)return;var t=la.clone(e);this.remoteConfig.configure(t),this.event.on(y.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(y.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.once(y.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}},{key:"initFirebasePlugin",value:function initFirebasePlugin(){var e=c9.Firebase;if(!e.Enabled||!this.firebase)return;var t=la.clone(e);this.firebase.configure(t),lc.setService(this.firebase.services.performance)}},{key:"initMarkCoreInitialize",value:function initMarkCoreInitialize(){c9.PerformanceMonitor.CoreFlows&&(lc.measure(this.markName),lc.putAttr(this.markName,"Build","".concat(c7)),lc.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),lc.putAttr(this.markName,"Platform",GameSDK.getPlatform()),lc.putAttr(this.markName,"Success","false"),lc.start(this.markName))}},{key:"processPlayerProfile",value:function processPlayerProfile(){var e=this;return _async_to_generator(function(){var t;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,e.player.syncProfileToServer()];case 1:r.sent(),e.processAfterSyncProfile();return[3,3];case 2:t=r.sent();console.warn("processPlayerProfile fail",t);return[3,3];case 3:return[2]}})})()}},{key:"updatePlayerProfileToNotificationService",value:function updatePlayerProfileToNotificationService(){var e=this;return _async_to_generator(function(){var t,r,l,_,d,h,y,p;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,2,,3]);t=c9.AppId,r=e.player.getPlayer(),l=r.ASID,_=r.playerId,d=r.name,h=r.photo,y=r.locale;return[4,ef({appId:t,ASID:l,playerId:_,name:d,photo:h,locale:y})];case 1:f.sent();return[3,3];case 2:p=f.sent();console.warn("updatePlayerProfileToNotificationService",p);return[3,3];case 3:return[2]}})})()}},{key:"initGoogleAnalytics",value:function initGoogleAnalytics(){var e;var t=null!==(e=c9.Analytics.GoogleAnalytics)&&void 0!==e?e:{},r=t.Enabled,l=t.ConsoleLog;r&&this.analytics.add(new c4(this.game,{log:!!l}))}},{key:"initFirebaseAnalytics",value:function initFirebaseAnalytics(){var e;var t=null!==(e=c9.Analytics.FirebaseAnalytics)&&void 0!==e?e:{},r=t.Enabled,l=t.ConsoleLog;if(!r)return;var _=new c$(this.game,{log:!!l}),d=this.player.getPlayer(),h=d.ASID,y=d.playerId,p=d.locale;_.setUser(y,{ASID:h,locale:p}),this.analytics.add(_)}},{key:"initFacebookAnalytics",value:function initFacebookAnalytics(){var e;var t=null!==(e=c9.Analytics.FacebookAnalytics)&&void 0!==e?e:{},r=t.Enabled,l=t.Prefix,_=t.ConsoleLog;if(r){if("string"!=typeof l){console.warn("Facebook Analytics is not configured");return}this.analytics.add(new cW(this.game,{prefix:l,log:!!_}))}}}]);return ho}(l.Game);c(ll,"MagicGame");var lu=ll;var l_=r.Configs,ld=r.Utils,lh=r.Events,ly=ld.Device,lp=l_.GameEngine,lf=lp.ForceDesktopDPR,lv=c(_async_to_generator(function(){var e,t;return _ts_generator(this,function(r){switch(r.label){case 0:try{gtag("event","app_initialize")}catch(e){console.warn("gtag init",e)}e=new lu;window.game=e;t=20;window.__sdkLoadingCount<t&&(window.__sdkLoadingCount=t),window.__gameCoreStart=!0;return[4,e.boot()];case 1:r.sent(),e.event.once(lh.REQUEST_CORE_START,lg),lm(e);return[2]}})}),"initGame"),lg=c(function(){if(!window.__sdkInitiated){game.event.once(lh.GAME_SDK_READY,lg);return}window.game.start(),console.warn("Game started");var e=25;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e)},"startGame"),lm=c(function(e){var t=setInterval(function(){if(!window.__sdkInitiated)return;clearInterval(t);var r=10;window.__sdkLoadingCount<r&&(window.__sdkLoadingCount=r),e.event.emit(lh.GAME_SDK_READY)},5)},"waitGameSDK");!1!==lf&&ly.isDesktop()&&"number"==typeof lf&&lf>0&&(window.devicePixelRatio=lf),lv()},"execute")}});