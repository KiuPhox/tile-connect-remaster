var gh=Object.defineProperty;var hw=(mt,b,g)=>b in mt?gh(mt,b,{enumerable:!0,configurable:!0,writable:!0,value:g}):mt[b]=g;var o=(mt,b)=>gh(mt,"name",{value:b,configurable:!0});var f=(mt,b,g)=>hw(mt,typeof b!="symbol"?b+"":b,g);System.register(["./bundle/core.js","./bundle/__commonjsHelpers__.js"],function(mt,b){"use strict";var g,x,qc,ot,V,X,Yc;return{setters:[F=>{g=F.G,x=F.P,qc=F.M,ot=F._,V=F.a,X=F.C},F=>{Yc=F.g}],execute:o(function(){var ie,re,oe,ce,le;const{Valid:F,Object:Ns,String:Os,Json:Xc}=g.Utils,de="is invalid",it=class it{static addDefaultData(e){F.isObject(e)||this.prototype.exception("default data",de),e=Xc.clone(e);const{name:t}=this;F.isObject(it.data[t])||(it.data[t]={}),it.data[t]=Ns.merge(it.data[t],e),console.info(`${t} default data:`,it.data[t])}static getDefaultData(){const{name:e}=this;return Xc.clone(it.data[e])}static addValidateFunction(e,t){F.isString(e)||this.prototype.exception("validate key",de),typeof t!="function"&&this.prototype.exception("validate function",de);const s=`validate${Os.capitalize(e)}`;Object.assign(this.prototype,{[s]:t})}constructor(e){this.defaultData(),this.processData(e)}processData(e){this.validateStructure(e),this.validateData(e),this.setupData(e)}defaultData(){const{name:e}=this.constructor;this.lazyDefaultData(it.data[e])}lazyDefaultData(e){F.isObject(e)||this.exception("data",de);for(const t in e)if(Ns.hasOwn(e,t)){const s=e[t];Object.assign(this,{[t]:s})}}lazyValidateStructure(e){F.isObject(e)||this.exception("structure","is not object"),this.getKeys().forEach(t=>{const s=this[t];s===void 0&&this.exception("structure",`has no key ${t}`),!Ns.hasOwn(e,t)&&s!==void 0&&this.setDefaultData(t,e)})}setDefaultData(e,t){F.isObject(t)||this.exception("data",de);const s=this[e];s===void 0&&this.exception("default",`has no key ${e}`),Object.assign(t,{[e]:s})}lazyValidateData(e){this.getKeys().forEach(t=>{const s=e[t],n=Os.removeDiacritics(t).replace(/[^a-zA-Z0-9]/g,""),i=`validate${Os.capitalize(n)}`,r=this[i];if(typeof r=="function")try{r.call(this,s)}catch(c){console.warn(c),this.setDefaultData(t,e)}else this.exception("validate",`has no function ${i}`)})}lazySetupData(e){this.getKeys().forEach(t=>{const s=e[t];Object.assign(this,{[t]:s})})}validate(){this.validateData(this.toObject())}exception(e,t){throw new Error(`${this.constructor.name}: ${e} ${t}`)}toObject(){return Object.fromEntries(Object.entries(this).filter(([e])=>e!=="toObject"))}getKeys(){return Object.keys(this).filter(e=>e!=="toObject")}};o(it,"BaseDtos"),f(it,"data",{});let R=it;g.Dtos={Base:R};const yh={score:"score",endlessScore:"endlessScore",settings:"settings",gameData:"gameData",remoteConfig:"remoteConfig",isFirstLogin:"isFirstLogin",dailyRewarded:"dailyRewarded"},Gt={ASID:null,playerId:"0000",name:"Guest",photo:"",locale:"en_US",connectedPlayers:{},data:{dailyRewarded:{logDays:[],lastRewarded:0},score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:{coins:0,level:1},isFirstLogin:!0}},{Valid:he}=g.Utils,{playerId:mh,name:wh,photo:Ah,locale:Ih}=Gt,ue="is invalid",Mi=class Mi extends R{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!he.isString(e)||!e)&&this.exception("_id",ue)}validatePlayerId(e){(!he.isString(e)||!e)&&this.exception("playerId",ue)}validateName(e){(!he.isString(e)||!e)&&this.exception("name",ue)}validatePhoto(e){he.isString(e)||this.exception("photo",ue)}validateLocale(e){(!he.isString(e)||!e)&&this.exception("locale",ue)}toObject(){return super.toObject()}};o(Mi,"PlayerInfoDtos");let jt=Mi;jt.addDefaultData({playerId:mh,name:wh,photo:Ah,locale:Ih});const dt=new jt({playerId:"10",name:"Your Friend"}).toObject(),Ri=class Ri extends Error{constructor(t){super(t);f(this,"code");this.code="CREATE_MATCH_FAILED"}};o(Ri,"ACreateMatchFailed");let st=Ri;const Li=class Li extends st{constructor(e){super(e),this.name="PlayerIdNotValid",this.message=e??"Player id is not valid"}};o(Li,"PlayerIdNotValid");let D=Li;const{Dtos:Ms}=g,$i=class $i{constructor(e){f(this,"game");f(this,"initContext",o(()=>{const e={contextId:GameSDK.context.getID(),contextType:GameSDK.context.getType(),entryPointData:GameSDK.getEntryPointData()},t=new Ms.Context.Info(e),{contextId:s,contextType:n,entryPointData:i}=t.toObject();this.game.context.receiveContext(s,n,i)},"initContext"));f(this,"initPlayer",o(async()=>{const{player:e}=this.game,t=this.getPlayerInfo();console.info("playerInfo",g.Utils.Json.clone(t));const s=Object.values(yh);console.info("dataKeys",s);const n=await GameSDK.player.getDataAsync(s);console.info("rawData",g.Utils.Json.clone(n));const i=new Ms.Player.Data(n).toObject();console.info("playerData",g.Utils.Json.clone(i)),e.receiveData(t,i),this.game.event.emit(g.Events.PLAYER_INFO_LOADED)},"initPlayer"));f(this,"getPlayerInfo",o(()=>{try{const e=GameSDK.player.getID();let t=GameSDK.player.getName();const s=GameSDK.player.getPhoto(),n=GameSDK.getLocale();if(!g.Utils.Valid.isString(e))throw new D;return g.Utils.Valid.isString(t)||(t="You"),new Ms.Player.Info({playerId:e,name:t,photo:s,locale:n}).toObject()}catch{return dt}},"getPlayerInfo"));this.game=e}};o($i,"StateInitiator");let Rs=$i;const Fi=class Fi extends Error{constructor(t,s){super(t);f(this,"payload");this.name="BadRequest",this.message=t??"This request is bad",this.payload=s}};o(Fi,"BadRequest");let fe=Fi;const ki=class ki extends Error{constructor(t,s){super(t);f(this,"payload");this.name="RequestTimeout",this.message=t??"This request is timeout",this.payload=s}};o(ki,"RequestTimeout");let pe=ki;const{Utils:bh,Configs:Eh}=g,{AppId:Qc,Network:Ls}=Eh,Dh=o(a=>{if(!a.ok)throw new fe(void 0,{response:a})},"validateResponse"),Jc=o(()=>{const a=window.game.auth.getToken();return{token:a,timeout:Ls.Timeout,headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}},"defaultConfig"),Zc=o((a,e,t,s)=>async()=>{try{if(!Qc)throw new fe("AppId is not defined");const n=`${a}/apps/${Qc}/${e}`,i=new AbortController;t.signal=i.signal;const r=setTimeout(()=>{i.abort()},t.timeout);g.Utils.Valid.isObject(s)&&(t.body=JSON.stringify(s));const c=await fetch(n,t);return clearTimeout(r),Dh(c),await c.json()||{}}catch(n){if(n instanceof fe)return null;throw n instanceof Object&&"name"in n&&n.name==="AbortError"?new pe:n}},"requester"),$s=o(async(a,e)=>{try{return a()}catch(t){if(t instanceof pe&&e>0)try{return await bh.Time.sleepAsync(600),await $s(a,e-1)}catch{return{}}return t instanceof pe?{}:(console.warn("Request error",t),{})}},"handleRequest"),zt=o(async(a,e={},t,s=Ls.Retries)=>{try{const n={...Jc(),...e,method:"GET"},i=Zc(t,a,n);return await $s(i,s)}catch(n){return console.warn("Get error",n),{}}},"get"),G=o(async(a,e,t={},s,n=Ls.Retries)=>{try{const i={...Jc(),...t,method:"POST"},r=Zc(s,a,i,e);return await $s(r,n)}catch(i){return console.warn("Post error",i),{}}},"post"),{ApiUrl:vh}=g.Configs.Notification,Sh=o(async a=>{if(!g.Utils.Object.hasOwn(a,"playerId"))throw new Error("Missing playerId");const{playerId:e}=a;await G(`players/${e}`,a,{},vh,10)},"updatePlayerProfileNotificationAsync");var tl=(a=>(a.IDLE="idle",a.LOADING="loading",a.FILLED="filled",a.SHOWING="showing",a))(tl||{});const el=tl;var sl=(a=>(a.BANNER="banner",a.INTERSTITIAL="interstitial",a.REWARDED_VIDEO="rewarded_video",a))(sl||{});const ht=sl;let ge=(ie=class extends Error{constructor(t,s){super(s);f(this,"code");this.code=t,this.message=s}},o(ie,"AdError"),ie);const Ui=class Ui{constructor(e,t){f(this,"type");f(this,"status");f(this,"placementId");this.type=e,this.status=el.IDLE,this.placementId=t}getStatus(){return this.status}exception(e){throw new ge("AD_INSTANCE_ERROR",e)}};o(Ui,"BaseInstance");let Fs=Ui,nl=(re=class extends Fs{loadAsync(){this.exception("This method is not implemented")}showAsync(){this.exception("This method is not implemented")}hideAsync(){this.exception("Unsupported method")}},o(re,"AdInstance"),re);g.Plugins.Ads={Types:ht,Status:el,AdError:ge,AdInstance:nl};const Bi=class Bi extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"enabled");f(this,"config");f(this,"lastCallAdShownTime");f(this,"isAdFullSizeShowed");f(this,"ads",{});f(this,"safeAreaBottom")}init(){this.lastCallAdShownTime=0,this.isAdFullSizeShowed=!1,this.calculateSafeAreaBottom()}calculateSafeAreaBottom(){try{const t=getComputedStyle(document.documentElement).getPropertyValue("--sab");this.safeAreaBottom=parseInt(t,10),isNaN(this.safeAreaBottom)&&(this.safeAreaBottom=0)}catch{this.safeAreaBottom=0}}configure(t){this.config=t,this.enabled=this.config.Enabled}checkEnabled(){if(!this.enabled)throw new ge("ADS_NOT_ENABLED","Ads is't enabled")}isAdFullSizeShowing(){return this.isAdFullSizeShowed}setAdInstance(t,s,n){if(this.ads[s]){console.warn(`AdsPlugin: Ad instance with placementId ${s} already exists`);return}this.ads[s]={type:t,placementId:s,interval:null,instance:new n(t,s)}}async preloadInterstitialAdAsync(){await this.loadAdAsync(ht.INTERSTITIAL)}async showInterstitialAdAsync(){if(!this.canbeShowInterstitialAd())throw new ge("INTERSTITIAL_AD_CAN_NOT_SHOW","Can't show interstitial ad");await this.showAdAsync(ht.INTERSTITIAL)}async preloadRewardedVideoAsync(){await this.loadAdAsync(ht.REWARDED_VIDEO)}async showRewardedVideoAsync(){await this.showAdAsync(ht.REWARDED_VIDEO)}async loadAdAsync(t,s){this.checkEnabled(),await this.getAd(t,s).instance.loadAsync()}async showAdAsync(t,s){this.checkEnabled();const{event:n}=this.game,i=this.getAd(t,s);this.lastCallAdShownTime=window.performance.now()/1e3;try{n.emit(g.Events.AD_SHOWING,{placementId:s}),this.isAdFullSizeShowed=!0,await i.instance.showAsync()}finally{n.emit(g.Events.AD_CLOSED,{placementId:s}),this.isAdFullSizeShowed=!1}}getAdStatus(t,s){return this.checkEnabled(),this.getAd(t,s).instance.getStatus()}getAd(t,s){let n=null;if(s?n=this.getAdByPlacementId(s):n=this.getPriorityAdByType(t),!n)throw new ge("AD_INSTANCE_NOT_INITIATED","The instance ads not yet initiated");return n}getAdsByType(t){return Object.values(this.ads).filter(s=>s.type===t)}getAdByPlacementId(t){const s=this.ads[t];return s||null}getPriorityAdByType(t){const s=this.getAdsByType(t);if(!s.length)return null;const n=s.find(i=>i.type===t);return n||null}canbeShowInterstitialAd(t){return this.canbeShowInterstitialAdByTime(t)}canbeShowInterstitialAdByTime(t){try{const s=window.performance.now()/1e3;let n;if(t)n=this.getCommonAdConfig(t);else{const h=this.getPriorityAdByType(ht.INTERSTITIAL);if(!h)return!1;n=this.getCommonAdConfig(h.placementId)}const{SecondsBetweenAds:i,SecondsFirstTime:r}=n,c=s-this.lastCallAdShownTime,l=c>i,d=c>r;return this.lastCallAdShownTime>0?l:d}catch(s){return console.warn("Error while checking canbeShowInterstitialAdByTime",s),!1}}canbeShowBannerAd(t){try{const s=this.getBannerConfig(t),{Platform:n}=s;if(n==="ALL")return!0;const i=GameSDK.getPlatform();return i?i===n:!1}catch(s){return console.warn("Error while checking canbeShowBannerAd",s),!1}}async showBannerAdAsync(t){this.checkEnabled();const s=this.getAd(ht.BANNER,t);if(!this.canbeShowBannerAd(s.placementId))throw new Error("Banner ad can not be shown");this.cleanBannerReloadTimer(s.placementId),await s.instance.showAsync();const{event:n}=this.game;n.emit(g.Events.AD_SHOWING,{placementId:t});const i=this.getBannerConfig(s.placementId),{SecondsReload:r}=i;r<=0||(s.interval=setTimeout(()=>{this.showBannerAdAsync(s.placementId)},r*1e3))}async hideBannerAdAsync(t){this.checkEnabled();const s=this.getAd(ht.BANNER,t);this.cleanBannerReloadTimer(s.placementId),await s.instance.hideAsync();const{event:n}=this.game;n.emit(g.Events.AD_CLOSED,{placementId:t})}cleanBannerReloadTimer(t){try{const s=this.getAd(ht.BANNER,t),{interval:n}=s;if(!n)return;clearInterval(n)}catch(s){console.warn("Error while cleaning banner reload timer",s)}}getCommonAdConfig(t){const n=[...this.config.InterstitialAdOptions,...this.config.RewardedVideoAdOptions].find(i=>i.PlacementId===t);if(!n)throw new Error(`Ad config with placementId ${t} not found`);return n}getBannerConfig(t){const s=this.config.BannerDisplayAdOptions.find(n=>n.PlacementId===t);if(!s)throw new Error(`Banner config with placementId ${t} not found`);return s}getBannerHeight(t,s,n=!0){this.checkEnabled();const i=this.getBannerConfig(t),r=GameSDK.getBannerHeight(i);return n?(r+this.safeAreaBottom)*s:r*s}getSafeAreaBottom(t){return this.safeAreaBottom*t}};o(Bi,"AdsPlugin");let ks=Bi;var al=(a=>(a.BUTTON_CLICK="button_click",a.SCREEN_OPEN="screen_open",a.LOAD_START="load_start",a.LOAD_COMPLETE="load_complete",a.GAME_SDK_READY="game_sdk_ready",a.APP_READY="app_ready",a.PAGE_VIEW="page_view",a.TUTORIAL_BEGIN="tutorial_begin",a.TUTORIAL_STEP="tutorial_step",a.TUTORIAL_COMPLETE="tutorial_complete",a.MATCH_START="match_start",a.MATCH_RESCUE="match_rescue",a.MATCH_END="match_end",a.LEVEL_START="level_start",a.LEVEL_RESCUE="level_rescue",a.LEVEL_END="level_end",a.SHARE="share",a.MESSAGE="message",a.INVITE="invite",a.SHORTCUT_CREATE="shortcut_create",a.SHORTCUT_CREATE_POPUP="shortcut_create_popup",a.BOT_SUBSCRIBE="bot_subscribe",a.BOT_SUBSCRIBE_POPUP="bot_subscribe_popup",a.AD_LOAD="ad_load",a.AD_LOAD_FAILED="ad_load_failed",a.AD_SHOW="ad_show",a.AD_SHOW_FAILED="ad_show_failed",a.AD_REWARD="ad_reward",a.AD_IMPRESSION="ad_impression",a.NEW_USER="new_user",a.JOIN_GROUP="join_group",a.TOURNAMENT_START="tournament_start",a.TOURNAMENT_SHARE="tournament_share",a.TOURNAMENT_CREATE="tournament_create",a.TOURNAMENT_POST_SCORE="tournament_post_score",a.GET_FREE_ITEM="get_free_item",a.USE_ITEM="use_item",a.EARN_ITEM="earn_item",a))(al||{});const Q=al,{String:il,Valid:Ph}=g.Utils;let Ch=(oe=class{constructor(e,t,s){f(this,"game");f(this,"name");f(this,"color");f(this,"options");f(this,"selfLog");f(this,"currentPath");this.game=e,this.name=t,this.options=s,this.color=s.color||"#FFF",this.selfLog=s.log,this.currentPath="/",console.info(`%c${this.name}: init`,`color: ${this.color}`,this.options)}event(e,t){this.logInfo("event",{name:e,payload:t});const s=this.formatEventName(e);this.processEvent(s,t)}logInfo(e,t){this.selfLog&&console.info(`%c${this.name}: ${e}`,`color: ${this.color}`,t)}pageview(e){let t=this.getPageTitle(e);t=this.addGameModeToPageTitle(t),console.info("AnalyticsService: Page view",t),document.title=t,this.event(Q.PAGE_VIEW,{page_title:t})}levelStart(e,t){this.event(Q.LEVEL_START,{level:e,score:t,level_name:this.getLevelName(e)})}levelFail(e,t){this.event(Q.LEVEL_END,{level:e,score:t,success:!1,level_name:this.getLevelName(e)})}levelRescue(e,t){this.event(Q.LEVEL_RESCUE,{level:e,score:t,level_name:this.getLevelName(e)})}levelComplete(e,t){this.event(Q.LEVEL_END,{level:e,score:t,success:!0,level_name:this.getLevelName(e)})}loadAdEvent(e,t){this.event(Q.AD_LOAD,{ad_type:e,screen_name:t})}showAdEvent(e,t){this.event(Q.AD_SHOW,{ad_type:e,screen_name:t}),this.event(Q.AD_IMPRESSION,{ad_format:e})}loadInterstitialAd(e){this.loadAdEvent("interstitial",e)}showInterstitialAd(e){this.showAdEvent("interstitial",e)}loadRewardedVideoAd(e){this.loadAdEvent("rewarded_video",e)}showRewardedVideoAd(e){this.showAdEvent("rewarded_video",e)}receiveVideoReward(e){this.event(Q.AD_REWARD,{screen_name:e})}loadAdFail(e,t){this.event(Q.AD_LOAD_FAILED,{ad_type:e,screen_name:t})}showAdFail(e,t){this.event(Q.AD_SHOW_FAILED,{ad_type:e,screen_name:t})}formatEventName(e){return e.toLowerCase().replace(/:/g,"_")}getLevelName(e){return`Level ${e}`}getPageTitle(e){const t=e.split("/").pop();if(!Ph.isString(t))return e;const s=t.replace(/([-_\s.])/g," $1");return il.toUpperCamelCase(s)}addGameModeToPageTitle(e){const{match:t}=this.game,s=t.getMatchState();let{mode:n}=s;return n||(n="Normal"),`${il.toUpperCamelCase(n)}::${e}`}},o(oe,"BaseAnalytics"),oe);g.Plugins.Analytics={Events:Q,BaseAnalytics:Ch};const Vi=class Vi extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"analytics",[]);f(this,"placement","unknown");f(this,"pageview",o(t=>{if(!this.isActive())return;this.placement=t;const s=this.getPageByKey(t);this.analytics.forEach(n=>{n.pageview(s)})},"pageview"))}add(t){this.analytics.some(n=>n.name===t.name)||this.analytics.push(t)}isActive(){return this.analytics.length>=1}event(t,s){this.isActive()&&this.analytics.forEach(n=>{n.event(t,s)})}levelStart(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelStart(t,s)})}levelRescue(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelRescue(t,s)})}levelFail(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelFail(t,s)})}levelComplete(t,s){this.isActive()&&this.analytics.forEach(n=>{n.levelComplete(t,s)})}loadInterstitialAd(){this.isActive()&&this.analytics.forEach(t=>{t.loadInterstitialAd(this.placement)})}showInterstitialAd(){this.isActive()&&this.analytics.forEach(t=>{t.showInterstitialAd(this.placement)})}loadRewardedVideoAd(){this.isActive()&&this.analytics.forEach(t=>{t.loadRewardedVideoAd(this.placement)})}showRewardedVideoAd(){this.isActive()&&this.analytics.forEach(t=>{t.showRewardedVideoAd(this.placement)})}receiveVideoReward(){this.isActive()&&this.analytics.forEach(t=>{t.receiveVideoReward(this.placement)})}loadAdFail(t){this.isActive()&&this.analytics.forEach(s=>{s.loadAdFail(t,this.placement)})}showAdFail(t){this.isActive()&&this.analytics.forEach(s=>{s.showAdFail(t,this.placement)})}getPageByKey(t){if(t.includes("_")){let s=t.replace(/_/g,"-");return s=s.toLowerCase(),s}else{let s=t.length-1,n="";for(;s>0;){n=t.charAt(s);const i=isNaN(parseInt(n,10)),r=n===n.toUpperCase();i&&r&&(t=`${t.slice(0,s)}-${t.slice(s)}`),s--}return t.toLowerCase()}}};o(Vi,"AnalyticsPlugin");let Us=Vi;const Gi=class Gi{constructor(e){f(this,"key");this.key=e}getKey(){return this.key}};o(Gi,"BaseAudioPlayer");let Bs=Gi;const ji=class ji{constructor(e){f(this,"id");f(this,"isMuteAll");f(this,"masterVolume");f(this,"audioClips");this.id=e,this.masterVolume=1,this.isMuteAll=!1,this.audioClips={}}getId(){return this.id}getAudioClip(e){return this.audioClips[e]?this.audioClips[e]:null}setAudioClip(e,t){this.audioClips[e]={...this.audioClips[e],...t}}play(e,t){const s=this.getAudioClip(e);if(s){const{audioPlayer:n}=s;this.playWithRealConfig(n,t)}else this.loadAndPlay(e,t)}async loadAndPlay(e,t){try{const s=await this.onLoadAudio(e,t),{volume:n=1}=t||{};this.setAudioClip(e,{volume:n,audioPlayer:s}),this.playWithRealConfig(s,t)}catch(s){console.warn("playAudio",s)}}playWithRealConfig(e,t){if(t){const{volume:s=1}=t;t.volume=this.masterVolume*s}e.play(t)}pause(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.pause(),!0}resume(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.resume(),!0}stop(e){const t=this.getAudioClip(e);if(!t)return!1;const{audioPlayer:s}=t;return s.stop(),!0}stopAll(){this.callAudioPlayers("stop")}muteAll(){this.isMuteAll||(this.isMuteAll=!0,this.callAudioPlayers("mute"))}unmuteAll(){this.isMuteAll&&(this.isMuteAll=!1,this.callAudioPlayers("unmute"))}setVolume(e){this.masterVolume=e,this.callAudioPlayers("setVolume")}getVolume(){return this.masterVolume}queueAudioPlayer(e,t){try{const{audioPlayer:s,volume:n=1}=e;switch(t){case"play":s.play();break;case"pause":s.pause();break;case"resume":s.resume();break;case"stop":s.stop();break;case"mute":s.setVolume(0);break;case"unmute":case"setVolume":s.setVolume(this.masterVolume*n);break;default:throw new Error(`Unsupported function: ${t}`)}}catch(s){console.warn("queueAudioPlayer",s)}}callAudioPlayers(e){Object.values(this.audioClips).forEach(s=>{this.queueAudioPlayer(s,e)})}};o(ji,"BaseChannelManager");let Vs=ji;g.Plugins.Audio={BaseAudioPlayer:Bs,BaseChannelManager:Vs};const zi=class zi extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"firstChannelId");f(this,"channels",{})}addChannel(t){const s=t.getId();this.channels[s]=t,this.firstChannelId||(this.firstChannelId=s)}getChannel(t){if(t===void 0)return this.channels[this.firstChannelId];const s=this.channels[t];if(!s)throw new Error(`Channel ${t} not found`);return s}play(t,s,n){try{this.getChannel(n).play(t,s)}catch(i){console.warn("playSound",i)}}pause(t,s){try{this.getChannel(s).pause(t)}catch(n){console.warn("pauseSound",n)}}resume(t,s){try{this.getChannel(s).resume(t)}catch(n){console.warn("resumeSound",n)}}stop(t,s){try{this.getChannel(s).stop(t)}catch(n){console.warn("stopSound",n)}}stopAll(t){try{this.getChannel(t).stopAll()}catch(s){console.warn("stopAllSounds",s)}}mute(t){try{this.getChannel(t).muteAll()}catch(s){console.warn("mute",s)}}unmute(t){try{this.getChannel(t).unmuteAll()}catch(s){console.warn("unmute",s)}}setVolume(t,s){try{this.getChannel(s).setVolume(t)}catch(n){console.warn("setSoundVolume",n)}}};o(zi,"AudioPlugin");let Gs=zi;const _h={token:"",isRequesting:!1},Ki=class Ki extends x.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("auth",_h)}async requestToken(){const{storage:e}=this.game;try{if(e.getStorageData("auth","isRequesting")||e.getStorageData("auth","token")!=="")return;e.setStorageData("auth","isRequesting",!0);const i=(await GameSDK.player.getSignedPlayerInfoAsync()).getSignature();e.setStorageData("auth","token",i)}catch(t){if(g.Utils.Object.hasOwn(t,"code")&&t.code==="PENDING_REQUEST")return;e.setStorageData("auth","token",""),console.error(t)}finally{e.setStorageData("auth","isRequesting",!1)}}getToken(){const{storage:e}=this.game;return e.getStorageData("auth","token")}};o(Ki,"AuthPlugin");let js=Ki;var rl=(a=>(a.SOLO="solo",a.TOURNAMENT="tournament",a.SHARE_INVITE="share_invite",a.MATCHING_GROUP="matching_group_match",a.CHALLENGE_FRIEND="challenge_friend_match",a))(rl||{});const ye=rl,Pt=qc,Wi=class Wi{constructor(e){f(this,"game");this.game=e}isValidContextType(e){return["THREAD","POST","SOLO","GROUP"].indexOf(e)>=0}isValidEntryPointData(e){return g.Utils.Valid.isObject(e)}isTournamentEntryPoint(e){return["facebook~game_list~tournaments","fb_feed_tournament_unit"].indexOf(e)>=0}receiveContext(e,t,s){const{storage:n}=this.game;n.setStorageData("context","contextId",e),this.isValidEntryPointData(s)?n.setStorageData("context","entryPointData",s):console.warn(`Invalid context type: ${t}`),this.isValidContextType(t)?n.setStorageData("context","contextType",t):console.warn(`Invalid context type: ${t}`)}async detectContextSessionType(){var h;const{storage:e}=this.game,t=e.getStorageData("context","entryPointData"),{type:s}=t,{SOLO:n,TOURNAMENT:i,MATCHING_GROUP:r,SHARE_INVITE:c,CHALLENGE_FRIEND:l}=ye;let d=n;if(s===i&&(d=i),s===r&&(d=r),(s===l||s===c)&&(d=l),d===n){let u=null;try{u=new URLSearchParams(window.location.search).get("entry_point")}catch{u=((h=window.location.search.substring(1).split("&").find(A=>A.startsWith("entry_point=")))==null?void 0:h.split("=")[1])||null}if(u)d=this.isTournamentEntryPoint(u)?i:n;else try{if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");await GameSDK.getTournamentAsync(),d=i}catch{}}e.setStorageData("context","sessionContextType",d)}detectContextGameMode(){const{player:e,storage:t}=this.game,s=t.getStorageData("context","entryPointData"),n=t.getStorageData("context","sessionContextType"),i=e.getPlayerId(),{matchId:r,playerId:c,opponentId:l=dt.playerId}=s,d=i===c,u=l===dt.playerId||[l,c].indexOf(i)>=0,{TOURNAMENT:p,MATCHING_GROUP:y,SHARE_INVITE:w,CHALLENGE_FRIEND:A}=ye;let m=Pt.SINGLE;n===p&&(m=Pt.TOURNAMENT),n===w&&!d&&(m=Pt.CHALLENGE_FRIEND),n===A&&r&&u&&(m=Pt.CHALLENGE_FRIEND),n===y&&(m=Pt.MATCHING_GROUP),t.setStorageData("context","contextGameMode",m)}};o(Wi,"Context");let zs=Wi;const Hi=class Hi extends Error{constructor(e){super(e),this.name="PlayerHasFinishedMatch",this.message=e??"Player has finished match"}};o(Hi,"PlayerHasFinishedMatch");let Fe=Hi;const qi=class qi extends Error{constructor(e){super(e),this.name="PlayerNotJoinInMatch",this.message=e||"Player is not join in match"}};o(qi,"PlayerNotJoinInMatch");let me=qi;const{Events:Ks,Plugins:Th}=g,{Analytics:xh}=Th,Yi=class Yi{constructor(e){f(this,"game");this.game=e}async processContextData(){const{player:e,analytics:t,storage:s}=this.game,n=s.getStorageData("context","contextId"),i=s.getStorageData("context","entryPointData"),r=s.getStorageData("context","sessionContextType"),{type:c,matchId:l,playerId:d,opponentId:h,playerScore:u}=i||{};console.info("isFirstLogin",e.isFirstLogin()),e.isFirstLogin()&&t.event(xh.Events.NEW_USER);const{TOURNAMENT:p,SHARE_INVITE:y,MATCHING_GROUP:w,CHALLENGE_FRIEND:A}=ye;if(r===p){try{await this.processTournamentModeAsync()}catch{await this.processSingleModeAsync()}return}if(r===A){if(c===y&&typeof d=="string"){await this.processChallengeFromPostAsync(d);return}if(c===A&&typeof l=="string"&&typeof d=="string"&&typeof h=="string"){await this.processChallengeFromMessageAsync({contextId:n,matchId:l,playerId:d,opponentId:h});return}}if(r===w&&typeof d=="string"&&typeof u=="number"){await this.processMatchingGroupModeAsync(d,u);return}if(e.isFirstLogin()){await this.processSingleModeAsync(),e.loggedIn();return}this.switchToDashboardScene()}async processTournamentModeAsync(){const{match:e,player:t}=this.game,s=t.getPlayerId(),n=GameSDK.context.getID();if(typeof n!="string")throw new Error("Cannot get contextId");await e.tournament.continue.processAsync({playerId:s,contextId:n}),this.switchToGameScene()}async processChallengeFromPostAsync(e){const{match:t,player:s}=this.game,n=s.getPlayerId();if(n===e)await t.single.start.processAsync({playerId:n});else try{await t.challenge.friend.processAsync({playerId:n,opponentId:e})}catch(r){console.warn("processChallengeFromPostAsync",r),await t.single.start.processAsync({playerId:n})}this.switchToGameScene()}async processChallengeFromMessageAsync(e){try{await this.processContinueChallengeFromMessageAsync(e)}catch(t){if(console.warn("processContinueChallengeFromMessageAsync",t),t instanceof Fe){await this.processAwaitChallengeFromMessageAsync(e);return}if(t instanceof me){await this.processJoinChallengeFromMessageAsync(e);return}this.switchToDashboardScene()}}async processContinueChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:n,opponentId:i}=e,{match:r,player:c}=this.game,l=c.getPlayerId();if(n===l)await r.challenge.continue.processAsync({contextId:t,matchId:s,playerId:l,opponentId:i});else{const h=i===dt.playerId;await r.challenge.continue.processAsync({contextId:t,matchId:s,playerId:l,opponentId:h?i:n})}this.switchToGameScene()}async processJoinChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:n}=e,{match:i,player:r}=this.game,c=r.getPlayerId();await i.challenge.join.processAsync({contextId:t,matchId:s,playerId:c,opponentId:n}),this.switchToGameScene()}async processAwaitChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:n}=e,{match:i,player:r}=this.game,c=r.getPlayerId();try{await i.challenge.await.processAsync({contextId:t,matchId:s,playerId:c,opponentId:n}),this.switchToChallengeResultScene()}catch(l){console.warn("processAwaitChallengeFromMessageAsync",l),await this.processResultChallengeFromMessageAsync(e)}}async processResultChallengeFromMessageAsync(e){const{contextId:t,matchId:s,playerId:n}=e,{match:i,player:r}=this.game,c=r.getPlayerId();try{await i.challenge.result.processAsync({contextId:t,matchId:s,playerId:c,opponentId:n}),this.switchToChallengeResultScene()}catch{this.switchToDashboardScene()}}async processMatchingGroupModeAsync(e,t){const{match:s,player:n}=this.game;await s.group.join.processAsync({playerId:n.getPlayerId(),opponentId:e,opponentScore:t}),this.switchToGameScene()}async processSingleModeAsync(){const{match:e,player:t}=this.game,s=t.getPlayerId();await e.single.start.processAsync({playerId:s}),this.switchToGameScene()}switchToDashboardScene(){const{event:e}=this.game;e.emit(Ks.SWITCH_SCENE,{sceneName:"DashboardScene",sceneData:{isMatchStartFromLoader:!0}})}switchToGameScene(){const{event:e}=this.game;e.emit(Ks.SWITCH_SCENE,{sceneName:"GameScene",sceneData:{isMatchStartFromLoader:!0}})}switchToChallengeResultScene(){const{event:e}=this.game;e.emit(Ks.SWITCH_SCENE,{sceneName:"ChallengeResultScene",sceneData:{isMatchStartFromLoader:!0}})}};o(Yi,"Loader");let Ws=Yi;const ol={processed:!1,contextId:"",contextType:"SOLO",entryPointData:{},contextGameMode:"",sessionContextType:""},{Events:Nh}=g,Xi=class Xi extends x.Plugins.BasePlugin{constructor(t){super(t);f(this,"context");f(this,"loader");this.loader=new Ws(t),this.context=new zs(t)}init(){const{storage:t}=this.game;t.addStorage("context",ol)}getSessionContextTypes(){return ye}async processContextData(){try{await this.loader.processContextData()}catch(t){console.error("processContextData",t),this.switchToDashboardScene()}}async detectContextSessionType(){try{await this.context.detectContextSessionType()}catch(t){console.error("detectContextSessionType",t)}}detectContextGameMode(){this.context.detectContextGameMode()}receiveContext(t,s,n){this.context.receiveContext(t,s,n)}switchToDashboardScene(){const{event:t}=this.game;t.emit(Nh.SWITCH_SCENE,{sceneName:"DashboardScene"})}};o(Xi,"ContextPlugin");let Hs=Xi;const{Valid:qs}=g.Utils,{contextId:Oh,contextType:Mh,entryPointData:Rh}=ol,Ys="is invalid",Qi=class Qi extends R{constructor(){super(...arguments);f(this,"data")}setupData(t){this.lazySetupData(t)}validateStructure(t){this.lazyValidateStructure(t)}validateData(t){this.lazyValidateData(t)}validateContextId(t){qs.isString(t)||this.exception("contextId",Ys)}validateContextType(t){(!qs.isString(t)||!t)&&this.exception("contextType",Ys)}validateEntryPointData(t){qs.isObject(t)||this.exception("entryPointData",Ys)}toObject(){return super.toObject()}};o(Qi,"ContextInfoDtos");let ke=Qi;ke.addDefaultData({contextId:Oh,contextType:Mh,entryPointData:Rh}),g.Dtos.Context={Info:ke};const Lh={0:{id:1,type:"coin",value:300},1:{id:2,type:"coin",value:500},2:{id:3,type:"coin",value:1e3},3:{id:4,type:"coin",value:2e3},4:{id:5,type:"coin",value:3e3},5:{id:6,type:"coin",value:5e3},6:{id:7,type:"coin",value:1e3}},Ji=class Ji{async getDailyRewardsAsync(){return Object.values(Lh)}};o(Ji,"DailyRewardsAPI");let Xs=Ji;const we={REWARDED:"rewarded",SKIPPED:"skipped",READY:"ready",WAITING:"waiting"},$h={dailyRewards:{}},cl=g.Configs.DailyRewards,Zi=class Zi extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"dailyRewardsApi",new Xs)}init(){const{storage:t}=this.game;t.addStorage("dailyRewards",$h)}async requestDailyRewardsAsync(){const t=await this.dailyRewardsApi.getDailyRewardsAsync();t.length!==0&&this.receiveDailyRewards(t)}getDailyRewards(){const{storage:t}=this.game,s=t.getStorageData("dailyRewards","dailyRewards");return s||null}logLoginReward(){const{player:t}=this.game,{logDays:s}=t.getPlayerData().dailyRewarded,n=[...s];n[n.length-1]=!0,this.logDailyRewards(n)}logDailyRewards(t,s=!1){const{player:n}=this.game;n.setPlayerDataByName("dailyRewarded",{logDays:t,lastRewarded:s?0:Date.now()})}receiveDailyRewards(t){const{player:s}=this.game,{logDays:n,lastRewarded:i}=s.getPlayerData().dailyRewarded,r=new Date,c=new Date(i),l=new Date(c.toDateString()),d=Math.abs(r.valueOf()-l.valueOf()),u=Math.floor(d/864e5)>1,y=cl.CheckInterrupt&&u||n.length>=cl.MaxDays,w=y?[!1]:[...n,!1];this.logDailyRewards(w);const A=t.map((m,v)=>{const Y=v<w.length,C=w.length===v+1,Hc=w[v]===!1;let rt=we.WAITING;return C?rt=we.READY:y?rt=we.WAITING:Y&&Hc?rt=we.SKIPPED:Y&&(rt=we.REWARDED),{...m,status:rt}});this.setDailyRewards(A)}setDailyRewards(t){const{storage:s}=this.game;s.setStorageData("dailyRewards","dailyRewards",t)}};o(Zi,"DailyRewardsPlugin");let Qs=Zi;var Js={exports:{}};Js.exports,function(a){var e=Object.prototype.hasOwnProperty,t="~";function s(){}o(s,"Events"),Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function n(l,d,h){this.fn=l,this.context=d,this.once=h||!1}o(n,"EE");function i(l,d,h,u,p){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new n(h,u||l,p),w=t?t+d:d;return l._events[w]?l._events[w].fn?l._events[w]=[l._events[w],y]:l._events[w].push(y):(l._events[w]=y,l._eventsCount++),l}o(i,"addListener");function r(l,d){--l._eventsCount===0?l._events=new s:delete l._events[d]}o(r,"clearEvent");function c(){this._events=new s,this._eventsCount=0}o(c,"EventEmitter"),c.prototype.eventNames=o(function(){var d=[],h,u;if(this._eventsCount===0)return d;for(u in h=this._events)e.call(h,u)&&d.push(t?u.slice(1):u);return Object.getOwnPropertySymbols?d.concat(Object.getOwnPropertySymbols(h)):d},"eventNames"),c.prototype.listeners=o(function(d){var h=t?t+d:d,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var p=0,y=u.length,w=new Array(y);p<y;p++)w[p]=u[p].fn;return w},"listeners"),c.prototype.listenerCount=o(function(d){var h=t?t+d:d,u=this._events[h];return u?u.fn?1:u.length:0},"listenerCount"),c.prototype.emit=o(function(d,h,u,p,y,w){var A=t?t+d:d;if(!this._events[A])return!1;var m=this._events[A],v=arguments.length,Y,C;if(m.fn){switch(m.once&&this.removeListener(d,m.fn,void 0,!0),v){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,u),!0;case 4:return m.fn.call(m.context,h,u,p),!0;case 5:return m.fn.call(m.context,h,u,p,y),!0;case 6:return m.fn.call(m.context,h,u,p,y,w),!0}for(C=1,Y=new Array(v-1);C<v;C++)Y[C-1]=arguments[C];m.fn.apply(m.context,Y)}else{var Hc=m.length,rt;for(C=0;C<Hc;C++)switch(m[C].once&&this.removeListener(d,m[C].fn,void 0,!0),v){case 1:m[C].fn.call(m[C].context);break;case 2:m[C].fn.call(m[C].context,h);break;case 3:m[C].fn.call(m[C].context,h,u);break;case 4:m[C].fn.call(m[C].context,h,u,p);break;default:if(!Y)for(rt=1,Y=new Array(v-1);rt<v;rt++)Y[rt-1]=arguments[rt];m[C].fn.apply(m[C].context,Y)}}return!0},"emit"),c.prototype.on=o(function(d,h,u){return i(this,d,h,u,!1)},"on"),c.prototype.once=o(function(d,h,u){return i(this,d,h,u,!0)},"once"),c.prototype.removeListener=o(function(d,h,u,p){var y=t?t+d:d;if(!this._events[y])return this;if(!h)return r(this,y),this;var w=this._events[y];if(w.fn)w.fn===h&&(!p||w.once)&&(!u||w.context===u)&&r(this,y);else{for(var A=0,m=[],v=w.length;A<v;A++)(w[A].fn!==h||p&&!w[A].once||u&&w[A].context!==u)&&m.push(w[A]);m.length?this._events[y]=m.length===1?m[0]:m:r(this,y)}return this},"removeListener"),c.prototype.removeAllListeners=o(function(d){var h;return d?(h=t?t+d:d,this._events[h]&&r(this,h)):(this._events=new s,this._eventsCount=0),this},"removeAllListeners"),c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=t,c.EventEmitter=c,a.exports=c}(Js);var Fh=Js.exports;const kh=Yc(Fh),wt=new kh,Uh={names:[],history:[]},tr=class tr extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"enableLog",!1);f(this,"muteEvents",[])}init(){const{storage:t}=this.game;t.addStorage("event",Uh)}enableLogEvent(){this.enableLog=!0}on(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"on","listening"),wt.on(t,s)}once(t,s){this.validateCallback(s),this.addEventName(t),this.addHistory(t,"once","listening"),wt.once(t,s)}off(t,s){this.validateCallback(s),wt.off(t,s),this.addHistory(t,"any","removed")}mute(t){this.muteEvents.includes(t)||this.muteEvents.push(t)}clear(t){wt.removeAllListeners(t),this.addHistory(t,"any","removed")}emit(t,s){if(this.muteEvents.includes(t))return;let n=[];s&&(n=[s]),this.addHistory(t,"any","called",s),wt.emit(t,...n)}validateCallback(t){if(typeof t!="function")throw new Error("Callback must be a function")}addEventName(t){const{storage:s}=this.game,n=s.getStorageData("event","names");n.includes(t)||n.push(t)}getEventListeners(){const t=wt.eventNames();return Object.keys(t)}getHistory(){const{storage:t}=this.game;return t.getStorageData("event","history")}getEventEmitCount(t){return this.getHistory().filter(n=>n.name===t&&n.status==="called").length}getLastEventInfo(t){const s=this.getHistory();let n=null;for(let i=s.length-1;i>=0;i--)if(s[i].name===t){n=s[i];break}return n}getTypeFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.type)??null}getCallsFromHistory(t){const s=this.getLastEventInfo(t);return(s==null?void 0:s.called)??0}addHistory(t,s,n,i){const c=this.getTypeFromHistory(t)??s,l=this.getCallsFromHistory(t),d=n==="called"?l+1:l;this.getHistory().push({type:c,status:n,name:t,called:d,payload:i??{}}),this.logEventInfo(t,c,n,d)}logEventInfo(t,s,n,i){if(this.enableLog){if(n==="listening"){console.info(`Event (${s}) ${t}: ${n}`);const r=wt.listenerCount(t);r>1&&console.warn(`Event ${t} has ${r} listener`)}else s!=="any"&&console.info(`Event (${s}) ${t}: ${n} (${i} times)`);n==="called"&&wt.listenerCount(t)<=0&&console.warn(`Event ${t} is called but not listening`)}}};o(tr,"EventPlugin");let Zs=tr;var ll={};const dl=o(function(a){const e=[];let t=0;for(let s=0;s<a.length;s++){let n=a.charCodeAt(s);n<128?e[t++]=n:n<2048?(e[t++]=n>>6|192,e[t++]=n&63|128):(n&64512)===55296&&s+1<a.length&&(a.charCodeAt(s+1)&64512)===56320?(n=65536+((n&1023)<<10)+(a.charCodeAt(++s)&1023),e[t++]=n>>18|240,e[t++]=n>>12&63|128,e[t++]=n>>6&63|128,e[t++]=n&63|128):(e[t++]=n>>12|224,e[t++]=n>>6&63|128,e[t++]=n&63|128)}return e},"stringToByteArray$1"),Bh=o(function(a){const e=[];let t=0,s=0;for(;t<a.length;){const n=a[t++];if(n<128)e[s++]=String.fromCharCode(n);else if(n>191&&n<224){const i=a[t++];e[s++]=String.fromCharCode((n&31)<<6|i&63)}else if(n>239&&n<365){const i=a[t++],r=a[t++],c=a[t++],l=((n&7)<<18|(i&63)<<12|(r&63)<<6|c&63)-65536;e[s++]=String.fromCharCode(55296+(l>>10)),e[s++]=String.fromCharCode(56320+(l&1023))}else{const i=a[t++],r=a[t++];e[s++]=String.fromCharCode((n&15)<<12|(i&63)<<6|r&63)}}return e.join("")},"byteArrayToString"),hl={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(a,e){if(!Array.isArray(a))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let n=0;n<a.length;n+=3){const i=a[n],r=n+1<a.length,c=r?a[n+1]:0,l=n+2<a.length,d=l?a[n+2]:0,h=i>>2,u=(i&3)<<4|c>>4;let p=(c&15)<<2|d>>6,y=d&63;l||(y=64,r||(p=64)),s.push(t[h],t[u],t[p],t[y])}return s.join("")},encodeString(a,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(a):this.encodeByteArray(dl(a),e)},decodeString(a,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(a):Bh(this.decodeStringToByteArray(a,e))},decodeStringToByteArray(a,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let n=0;n<a.length;){const i=t[a.charAt(n++)],c=n<a.length?t[a.charAt(n)]:0;++n;const d=n<a.length?t[a.charAt(n)]:64;++n;const u=n<a.length?t[a.charAt(n)]:64;if(++n,i==null||c==null||d==null||u==null)throw new tn;const p=i<<2|c>>4;if(s.push(p),d!==64){const y=c<<4&240|d>>2;if(s.push(y),u!==64){const w=d<<6&192|u;s.push(w)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let a=0;a<this.ENCODED_VALS.length;a++)this.byteToCharMap_[a]=this.ENCODED_VALS.charAt(a),this.charToByteMap_[this.byteToCharMap_[a]]=a,this.byteToCharMapWebSafe_[a]=this.ENCODED_VALS_WEBSAFE.charAt(a),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[a]]=a,a>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(a)]=a,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(a)]=a)}}},er=class er extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}};o(er,"DecodeBase64StringError");let tn=er;const Vh=o(function(a){const e=dl(a);return hl.encodeByteArray(e,!0)},"base64Encode"),ul=o(function(a){return Vh(a).replace(/\./g,"")},"base64urlEncodeWithoutPadding"),Gh=o(function(a){try{return hl.decodeString(a,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},"base64Decode");function jh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}o(jh,"getGlobal");const zh=o(()=>jh().__FIREBASE_DEFAULTS__,"getDefaultsFromGlobal"),Kh=o(()=>{if(typeof process>"u"||typeof ll>"u")return;const a=ll.__FIREBASE_DEFAULTS__;if(a)return JSON.parse(a)},"getDefaultsFromEnvVariable"),Wh=o(()=>{if(typeof document>"u")return;let a;try{a=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=a&&Gh(a[1]);return e&&JSON.parse(e)},"getDefaultsFromCookie"),Hh=o(()=>{try{return zh()||Kh()||Wh()}catch(a){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${a}`);return}},"getDefaults"),fl=o(()=>{var a;return(a=Hh())===null||a===void 0?void 0:a.config},"getDefaultAppConfig");const sr=class sr{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,s)=>{t?this.reject(t):this.resolve(s),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,s))}}};o(sr,"Deferred");let en=sr;function qh(){const a=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof a=="object"&&a.id!==void 0}o(qh,"isBrowserExtension");function Ue(){try{return typeof indexedDB=="object"}catch{return!1}}o(Ue,"isIndexedDBAvailable");function sn(){return new Promise((a,e)=>{try{let t=!0;const s="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(s);n.onsuccess=()=>{n.result.close(),t||self.indexedDB.deleteDatabase(s),a(!0)},n.onupgradeneeded=()=>{t=!1},n.onerror=()=>{var i;e(((i=n.error)===null||i===void 0?void 0:i.message)||"")}}catch(t){e(t)}})}o(sn,"validateIndexedDBOpenable");function pl(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}o(pl,"areCookiesEnabled");const Yh="FirebaseError",_s=class _s extends Error{constructor(e,t,s){super(t),this.code=e,this.customData=s,this.name=Yh,Object.setPrototypeOf(this,_s.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,At.prototype.create)}};o(_s,"FirebaseError");let ut=_s;const nr=class nr{constructor(e,t,s){this.service=e,this.serviceName=t,this.errors=s}create(e,...t){const s=t[0]||{},n=`${this.service}/${e}`,i=this.errors[e],r=i?Xh(i,s):"Error",c=`${this.serviceName}: ${r} (${n}).`;return new ut(n,c,s)}};o(nr,"ErrorFactory");let At=nr;function Xh(a,e){return a.replace(Qh,(t,s)=>{const n=e[s];return n!=null?String(n):`<${s}?>`})}o(Xh,"replaceTemplate");const Qh=/\{\$([^}]+)}/g;function Be(a,e){if(a===e)return!0;const t=Object.keys(a),s=Object.keys(e);for(const n of t){if(!s.includes(n))return!1;const i=a[n],r=e[n];if(gl(i)&&gl(r)){if(!Be(i,r))return!1}else if(i!==r)return!1}for(const n of s)if(!t.includes(n))return!1;return!0}o(Be,"deepEqual");function gl(a){return a!==null&&typeof a=="object"}o(gl,"isObject");const Jh=1e3,Zh=2,tu=4*60*60*1e3,eu=.5;function nn(a,e=Jh,t=Zh){const s=e*Math.pow(t,a),n=Math.round(eu*s*(Math.random()-.5)*2);return Math.min(tu,s+n)}o(nn,"calculateBackoffMillis");function j(a){return a&&a._delegate?a._delegate:a}o(j,"getModularInstance");const ar=class ar{constructor(e,t,s){this.name=e,this.instanceFactory=t,this.type=s,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};o(ar,"Component");let J=ar;const Ct="[DEFAULT]";const ir=class ir{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const s=new en;if(this.instancesDeferred.set(t,s),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&s.resolve(n)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const s=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),n=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(s)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:s})}catch(i){if(n)return null;throw i}else{if(n)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(nu(e))try{this.getOrInitializeService({instanceIdentifier:Ct})}catch{}for(const[t,s]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const i=this.getOrInitializeService({instanceIdentifier:n});s.resolve(i)}catch{}}}}clearInstance(e=Ct){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Ct){return this.instances.has(e)}getOptions(e=Ct){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,s=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(s))throw Error(`${this.name}(${s}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const n=this.getOrInitializeService({instanceIdentifier:s,options:t});for(const[i,r]of this.instancesDeferred.entries()){const c=this.normalizeInstanceIdentifier(i);s===c&&r.resolve(n)}return n}onInit(e,t){var s;const n=this.normalizeInstanceIdentifier(t),i=(s=this.onInitCallbacks.get(n))!==null&&s!==void 0?s:new Set;i.add(e),this.onInitCallbacks.set(n,i);const r=this.instances.get(n);return r&&e(r,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const s=this.onInitCallbacks.get(t);if(s)for(const n of s)try{n(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let s=this.instances.get(e);if(!s&&this.component&&(s=this.component.instanceFactory(this.container,{instanceIdentifier:su(e),options:t}),this.instances.set(e,s),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(s,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,s)}catch{}return s||null}normalizeInstanceIdentifier(e=Ct){return this.component?this.component.multipleInstances?e:Ct:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};o(ir,"Provider");let an=ir;function su(a){return a===Ct?void 0:a}o(su,"normalizeIdentifierForFactory");function nu(a){return a.instantiationMode==="EAGER"}o(nu,"isComponentEager");const rr=class rr{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new an(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};o(rr,"ComponentContainer");let rn=rr;var E;(function(a){a[a.DEBUG=0]="DEBUG",a[a.VERBOSE=1]="VERBOSE",a[a.INFO=2]="INFO",a[a.WARN=3]="WARN",a[a.ERROR=4]="ERROR",a[a.SILENT=5]="SILENT"})(E||(E={}));const au={debug:E.DEBUG,verbose:E.VERBOSE,info:E.INFO,warn:E.WARN,error:E.ERROR,silent:E.SILENT},iu=E.INFO,ru={[E.DEBUG]:"log",[E.VERBOSE]:"log",[E.INFO]:"info",[E.WARN]:"warn",[E.ERROR]:"error"},ou=o((a,e,...t)=>{if(e<a.logLevel)return;const s=new Date().toISOString(),n=ru[e];if(n)console[n](`[${s}]  ${a.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},"defaultLogHandler"),or=class or{constructor(e){this.name=e,this._logLevel=iu,this._logHandler=ou,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in E))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?au[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,E.DEBUG,...e),this._logHandler(this,E.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,E.VERBOSE,...e),this._logHandler(this,E.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,E.INFO,...e),this._logHandler(this,E.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,E.WARN,...e),this._logHandler(this,E.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,E.ERROR,...e),this._logHandler(this,E.ERROR,...e)}};o(or,"Logger");let Kt=or;const cu=o((a,e)=>e.some(t=>a instanceof t),"instanceOfAny");let yl,ml;function lu(){return yl||(yl=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}o(lu,"getIdbProxyableTypes");function du(){return ml||(ml=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}o(du,"getCursorAdvanceMethods");const wl=new WeakMap,on=new WeakMap,Al=new WeakMap,cn=new WeakMap,ln=new WeakMap;function hu(a){const e=new Promise((t,s)=>{const n=o(()=>{a.removeEventListener("success",i),a.removeEventListener("error",r)},"unlisten"),i=o(()=>{t(It(a.result)),n()},"success"),r=o(()=>{s(a.error),n()},"error");a.addEventListener("success",i),a.addEventListener("error",r)});return e.then(t=>{t instanceof IDBCursor&&wl.set(t,a)}).catch(()=>{}),ln.set(e,a),e}o(hu,"promisifyRequest");function uu(a){if(on.has(a))return;const e=new Promise((t,s)=>{const n=o(()=>{a.removeEventListener("complete",i),a.removeEventListener("error",r),a.removeEventListener("abort",r)},"unlisten"),i=o(()=>{t(),n()},"complete"),r=o(()=>{s(a.error||new DOMException("AbortError","AbortError")),n()},"error");a.addEventListener("complete",i),a.addEventListener("error",r),a.addEventListener("abort",r)});on.set(a,e)}o(uu,"cacheDonePromiseForTransaction");let dn={get(a,e,t){if(a instanceof IDBTransaction){if(e==="done")return on.get(a);if(e==="objectStoreNames")return a.objectStoreNames||Al.get(a);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return It(a[e])},set(a,e,t){return a[e]=t,!0},has(a,e){return a instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in a}};function fu(a){dn=a(dn)}o(fu,"replaceTraps");function pu(a){return a===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const s=a.call(hn(this),e,...t);return Al.set(s,e.sort?e.sort():[e]),It(s)}:du().includes(a)?function(...e){return a.apply(hn(this),e),It(wl.get(this))}:function(...e){return It(a.apply(hn(this),e))}}o(pu,"wrapFunction");function gu(a){return typeof a=="function"?pu(a):(a instanceof IDBTransaction&&uu(a),cu(a,lu())?new Proxy(a,dn):a)}o(gu,"transformCachableValue");function It(a){if(a instanceof IDBRequest)return hu(a);if(cn.has(a))return cn.get(a);const e=gu(a);return e!==a&&(cn.set(a,e),ln.set(e,a)),e}o(It,"wrap");const hn=o(a=>ln.get(a),"unwrap");function Il(a,e,{blocked:t,upgrade:s,blocking:n,terminated:i}={}){const r=indexedDB.open(a,e),c=It(r);return s&&r.addEventListener("upgradeneeded",l=>{s(It(r.result),l.oldVersion,l.newVersion,It(r.transaction),l)}),t&&r.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),c.then(l=>{i&&l.addEventListener("close",()=>i()),n&&l.addEventListener("versionchange",d=>n(d.oldVersion,d.newVersion,d))}).catch(()=>{}),c}o(Il,"openDB");const yu=["get","getKey","getAll","getAllKeys","count"],mu=["put","add","delete","clear"],un=new Map;function bl(a,e){if(!(a instanceof IDBDatabase&&!(e in a)&&typeof e=="string"))return;if(un.get(e))return un.get(e);const t=e.replace(/FromIndex$/,""),s=e!==t,n=mu.includes(t);if(!(t in(s?IDBIndex:IDBObjectStore).prototype)||!(n||yu.includes(t)))return;const i=o(async function(r,...c){const l=this.transaction(r,n?"readwrite":"readonly");let d=l.store;return s&&(d=d.index(c.shift())),(await Promise.all([d[t](...c),n&&l.done]))[0]},"method");return un.set(e,i),i}o(bl,"getMethod"),fu(a=>({...a,get:o((e,t,s)=>bl(e,t)||a.get(e,t,s),"get"),has:o((e,t)=>!!bl(e,t)||a.has(e,t),"has")}));const cr=class cr{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(wu(t)){const s=t.getImmediate();return`${s.library}/${s.version}`}else return null}).filter(t=>t).join(" ")}};o(cr,"PlatformLoggerServiceImpl");let fn=cr;function wu(a){const e=a.getComponent();return(e==null?void 0:e.type)==="VERSION"}o(wu,"isVersionServiceProvider");const pn="@firebase/app",El="0.10.5";const _t=new Kt("@firebase/app"),Au="@firebase/app-compat",Iu="@firebase/analytics-compat",bu="@firebase/analytics",Eu="@firebase/app-check-compat",Du="@firebase/app-check",vu="@firebase/auth",Su="@firebase/auth-compat",Pu="@firebase/database",Cu="@firebase/database-compat",_u="@firebase/functions",Tu="@firebase/functions-compat",xu="@firebase/installations",Nu="@firebase/installations-compat",Ou="@firebase/messaging",Mu="@firebase/messaging-compat",Ru="@firebase/performance",Lu="@firebase/performance-compat",$u="@firebase/remote-config",Fu="@firebase/remote-config-compat",ku="@firebase/storage",Uu="@firebase/storage-compat",Bu="@firebase/firestore",Vu="@firebase/vertexai-preview",Gu="@firebase/firestore-compat",ju="firebase",zu="10.12.2";const gn="[DEFAULT]",Ku={[pn]:"fire-core",[Au]:"fire-core-compat",[bu]:"fire-analytics",[Iu]:"fire-analytics-compat",[Du]:"fire-app-check",[Eu]:"fire-app-check-compat",[vu]:"fire-auth",[Su]:"fire-auth-compat",[Pu]:"fire-rtdb",[Cu]:"fire-rtdb-compat",[_u]:"fire-fn",[Tu]:"fire-fn-compat",[xu]:"fire-iid",[Nu]:"fire-iid-compat",[Ou]:"fire-fcm",[Mu]:"fire-fcm-compat",[Ru]:"fire-perf",[Lu]:"fire-perf-compat",[$u]:"fire-rc",[Fu]:"fire-rc-compat",[ku]:"fire-gcs",[Uu]:"fire-gcs-compat",[Bu]:"fire-fst",[Gu]:"fire-fst-compat",[Vu]:"fire-vertex","fire-js":"fire-js",[ju]:"fire-js-all"};const Ve=new Map,Wu=new Map,yn=new Map;function Dl(a,e){try{a.container.addComponent(e)}catch(t){_t.debug(`Component ${e.name} failed to register with FirebaseApp ${a.name}`,t)}}o(Dl,"_addComponent");function ft(a){const e=a.name;if(yn.has(e))return _t.debug(`There were multiple attempts to register component ${e}.`),!1;yn.set(e,a);for(const t of Ve.values())Dl(t,a);for(const t of Wu.values())Dl(t,a);return!0}o(ft,"_registerComponent");function Wt(a,e){const t=a.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),a.container.getProvider(e)}o(Wt,"_getProvider");const Hu={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},bt=new At("app","Firebase",Hu);const lr=class lr{constructor(e,t,s){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=s,this.container.addComponent(new J("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw bt.create("app-deleted",{appName:this._name})}};o(lr,"FirebaseAppImpl");let mn=lr;const qu=zu;function vl(a,e={}){let t=a;typeof e!="object"&&(e={name:e});const s=Object.assign({name:gn,automaticDataCollectionEnabled:!1},e),n=s.name;if(typeof n!="string"||!n)throw bt.create("bad-app-name",{appName:String(n)});if(t||(t=fl()),!t)throw bt.create("no-options");const i=Ve.get(n);if(i){if(Be(t,i.options)&&Be(s,i.config))return i;throw bt.create("duplicate-app",{appName:n})}const r=new rn(n);for(const l of yn.values())r.addComponent(l);const c=new mn(t,s,r);return Ve.set(n,c),c}o(vl,"initializeApp");function wn(a=gn){const e=Ve.get(a);if(!e&&a===gn&&fl())return vl();if(!e)throw bt.create("no-app",{appName:a});return e}o(wn,"getApp");function Z(a,e,t){var s;let n=(s=Ku[a])!==null&&s!==void 0?s:a;t&&(n+=`-${t}`);const i=n.match(/\s|\//),r=e.match(/\s|\//);if(i||r){const c=[`Unable to register library "${n}" with version "${e}":`];i&&c.push(`library name "${n}" contains illegal characters (whitespace or "/")`),i&&r&&c.push("and"),r&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),_t.warn(c.join(" "));return}ft(new J(`${n}-version`,()=>({library:n,version:e}),"VERSION"))}o(Z,"registerVersion");const Yu="firebase-heartbeat-database",Xu=1,Ae="firebase-heartbeat-store";let An=null;function Sl(){return An||(An=Il(Yu,Xu,{upgrade:o((a,e)=>{switch(e){case 0:try{a.createObjectStore(Ae)}catch(t){console.warn(t)}}},"upgrade")}).catch(a=>{throw bt.create("idb-open",{originalErrorMessage:a.message})})),An}o(Sl,"getDbPromise$1");async function Qu(a){try{const t=(await Sl()).transaction(Ae),s=await t.objectStore(Ae).get(Cl(a));return await t.done,s}catch(e){if(e instanceof ut)_t.warn(e.message);else{const t=bt.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});_t.warn(t.message)}}}o(Qu,"readHeartbeatsFromIndexedDB");async function Pl(a,e){try{const s=(await Sl()).transaction(Ae,"readwrite");await s.objectStore(Ae).put(e,Cl(a)),await s.done}catch(t){if(t instanceof ut)_t.warn(t.message);else{const s=bt.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});_t.warn(s.message)}}}o(Pl,"writeHeartbeatsToIndexedDB");function Cl(a){return`${a.name}!${a.options.appId}`}o(Cl,"computeKey");const Ju=1024,Zu=30*24*60*60*1e3,dr=class dr{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new bn(t),this._heartbeatsCachePromise=this._storage.read().then(s=>(this._heartbeatsCache=s,s))}async triggerHeartbeat(){var e,t;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=_l();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(r=>r.date===i)))return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const c=new Date(r.date).valueOf();return Date.now()-c<=Zu}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=_l(),{heartbeatsToSend:s,unsentEntries:n}=tf(this._heartbeatsCache.heartbeats),i=ul(JSON.stringify({version:2,heartbeats:s}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}};o(dr,"HeartbeatServiceImpl");let In=dr;function _l(){return new Date().toISOString().substring(0,10)}o(_l,"getUTCDateString");function tf(a,e=Ju){const t=[];let s=a.slice();for(const n of a){const i=t.find(r=>r.agent===n.agent);if(i){if(i.dates.push(n.date),Tl(t)>e){i.dates.pop();break}}else if(t.push({agent:n.agent,dates:[n.date]}),Tl(t)>e){t.pop();break}s=s.slice(1)}return{heartbeatsToSend:t,unsentEntries:s}}o(tf,"extractHeartbeatsForHeader");const hr=class hr{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ue()?sn().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await Qu(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Pl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Pl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}else return}};o(hr,"HeartbeatStorageImpl");let bn=hr;function Tl(a){return ul(JSON.stringify({version:2,heartbeats:a})).length}o(Tl,"countBytes");function ef(a){ft(new J("platform-logger",e=>new fn(e),"PRIVATE")),ft(new J("heartbeat",e=>new In(e),"PRIVATE")),Z(pn,El,a),Z(pn,El,"esm2017"),Z("fire-js","")}o(ef,"registerCoreComponents"),ef("");var sf="firebase",nf="10.12.2";Z(sf,nf,"app");const xl="@firebase/installations",En="0.6.7";const Nl=1e4,Ol=`w:${En}`,Ml="FIS_v2",af="https://firebaseinstallations.googleapis.com/v1",rf=60*60*1e3,of="installations",cf="Installations";const lf={"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."},Tt=new At(of,cf,lf);function Rl(a){return a instanceof ut&&a.code.includes("request-failed")}o(Rl,"isServerError");function Ll({projectId:a}){return`${af}/projects/${a}/installations`}o(Ll,"getInstallationsEndpoint");function $l(a){return{token:a.token,requestStatus:2,expiresIn:hf(a.expiresIn),creationTime:Date.now()}}o($l,"extractAuthTokenInfoFromResponse");async function Fl(a,e){const s=(await e.json()).error;return Tt.create("request-failed",{requestName:a,serverCode:s.code,serverMessage:s.message,serverStatus:s.status})}o(Fl,"getErrorFromResponse");function kl({apiKey:a}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":a})}o(kl,"getHeaders$1");function df(a,{refreshToken:e}){const t=kl(a);return t.append("Authorization",uf(e)),t}o(df,"getHeadersWithAuth");async function Ul(a){const e=await a();return e.status>=500&&e.status<600?a():e}o(Ul,"retryIfServerError");function hf(a){return Number(a.replace("s","000"))}o(hf,"getExpiresInFromResponseExpiresIn");function uf(a){return`${Ml} ${a}`}o(uf,"getAuthorizationHeader");async function ff({appConfig:a,heartbeatServiceProvider:e},{fid:t}){const s=Ll(a),n=kl(a),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&n.append("x-firebase-client",d)}const r={fid:t,authVersion:Ml,appId:a.appId,sdkVersion:Ol},c={method:"POST",headers:n,body:JSON.stringify(r)},l=await Ul(()=>fetch(s,c));if(l.ok){const d=await l.json();return{fid:d.fid||t,registrationStatus:2,refreshToken:d.refreshToken,authToken:$l(d.authToken)}}else throw await Fl("Create Installation",l)}o(ff,"createInstallationRequest");function Bl(a){return new Promise(e=>{setTimeout(e,a)})}o(Bl,"sleep");function pf(a){return btoa(String.fromCharCode(...a)).replace(/\+/g,"-").replace(/\//g,"_")}o(pf,"bufferToBase64UrlSafe");const gf=/^[cdef][\w-]{21}$/,Dn="";function yf(){try{const a=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(a),a[0]=112+a[0]%16;const t=mf(a);return gf.test(t)?t:Dn}catch{return Dn}}o(yf,"generateFid");function mf(a){return pf(a).substr(0,22)}o(mf,"encode");function Ge(a){return`${a.appName}!${a.appId}`}o(Ge,"getKey");const Vl=new Map;function Gl(a,e){const t=Ge(a);jl(t,e),wf(t,e)}o(Gl,"fidChanged");function jl(a,e){const t=Vl.get(a);if(t)for(const s of t)s(e)}o(jl,"callFidChangeCallbacks");function wf(a,e){const t=Af();t&&t.postMessage({key:a,fid:e}),If()}o(wf,"broadcastFidChange");let xt=null;function Af(){return!xt&&"BroadcastChannel"in self&&(xt=new BroadcastChannel("[Firebase] FID Change"),xt.onmessage=a=>{jl(a.data.key,a.data.fid)}),xt}o(Af,"getBroadcastChannel");function If(){Vl.size===0&&xt&&(xt.close(),xt=null)}o(If,"closeBroadcastChannel");const bf="firebase-installations-database",Ef=1,Nt="firebase-installations-store";let vn=null;function Sn(){return vn||(vn=Il(bf,Ef,{upgrade:o((a,e)=>{switch(e){case 0:a.createObjectStore(Nt)}},"upgrade")})),vn}o(Sn,"getDbPromise");async function je(a,e){const t=Ge(a),n=(await Sn()).transaction(Nt,"readwrite"),i=n.objectStore(Nt),r=await i.get(t);return await i.put(e,t),await n.done,(!r||r.fid!==e.fid)&&Gl(a,e.fid),e}o(je,"set");async function zl(a){const e=Ge(a),s=(await Sn()).transaction(Nt,"readwrite");await s.objectStore(Nt).delete(e),await s.done}o(zl,"remove");async function ze(a,e){const t=Ge(a),n=(await Sn()).transaction(Nt,"readwrite"),i=n.objectStore(Nt),r=await i.get(t),c=e(r);return c===void 0?await i.delete(t):await i.put(c,t),await n.done,c&&(!r||r.fid!==c.fid)&&Gl(a,c.fid),c}o(ze,"update");async function Pn(a){let e;const t=await ze(a.appConfig,s=>{const n=Df(s),i=vf(a,n);return e=i.registrationPromise,i.installationEntry});return t.fid===Dn?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}o(Pn,"getInstallationEntry");function Df(a){const e=a||{fid:yf(),registrationStatus:0};return Wl(e)}o(Df,"updateOrCreateInstallationEntry");function vf(a,e){if(e.registrationStatus===0){if(!navigator.onLine){const n=Promise.reject(Tt.create("app-offline"));return{installationEntry:e,registrationPromise:n}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},s=Sf(a,t);return{installationEntry:t,registrationPromise:s}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:Pf(a)}:{installationEntry:e}}o(vf,"triggerRegistrationIfNecessary");async function Sf(a,e){try{const t=await ff(a,e);return je(a.appConfig,t)}catch(t){throw Rl(t)&&t.customData.serverCode===409?await zl(a.appConfig):await je(a.appConfig,{fid:e.fid,registrationStatus:0}),t}}o(Sf,"registerInstallation");async function Pf(a){let e=await Kl(a.appConfig);for(;e.registrationStatus===1;)await Bl(100),e=await Kl(a.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:s}=await Pn(a);return s||t}return e}o(Pf,"waitUntilFidRegistration");function Kl(a){return ze(a,e=>{if(!e)throw Tt.create("installation-not-found");return Wl(e)})}o(Kl,"updateInstallationRequest");function Wl(a){return Cf(a)?{fid:a.fid,registrationStatus:0}:a}o(Wl,"clearTimedOutRequest");function Cf(a){return a.registrationStatus===1&&a.registrationTime+Nl<Date.now()}o(Cf,"hasInstallationRequestTimedOut");async function _f({appConfig:a,heartbeatServiceProvider:e},t){const s=Tf(a,t),n=df(a,t),i=e.getImmediate({optional:!0});if(i){const d=await i.getHeartbeatsHeader();d&&n.append("x-firebase-client",d)}const r={installation:{sdkVersion:Ol,appId:a.appId}},c={method:"POST",headers:n,body:JSON.stringify(r)},l=await Ul(()=>fetch(s,c));if(l.ok){const d=await l.json();return $l(d)}else throw await Fl("Generate Auth Token",l)}o(_f,"generateAuthTokenRequest");function Tf(a,{fid:e}){return`${Ll(a)}/${e}/authTokens:generate`}o(Tf,"getGenerateAuthTokenEndpoint");async function Cn(a,e=!1){let t;const s=await ze(a.appConfig,i=>{if(!ql(i))throw Tt.create("not-registered");const r=i.authToken;if(!e&&Of(r))return i;if(r.requestStatus===1)return t=xf(a,e),i;{if(!navigator.onLine)throw Tt.create("app-offline");const c=Rf(i);return t=Nf(a,c),c}});return t?await t:s.authToken}o(Cn,"refreshAuthToken");async function xf(a,e){let t=await Hl(a.appConfig);for(;t.authToken.requestStatus===1;)await Bl(100),t=await Hl(a.appConfig);const s=t.authToken;return s.requestStatus===0?Cn(a,e):s}o(xf,"waitUntilAuthTokenRequest");function Hl(a){return ze(a,e=>{if(!ql(e))throw Tt.create("not-registered");const t=e.authToken;return Lf(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}o(Hl,"updateAuthTokenRequest");async function Nf(a,e){try{const t=await _f(a,e),s=Object.assign(Object.assign({},e),{authToken:t});return await je(a.appConfig,s),t}catch(t){if(Rl(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await zl(a.appConfig);else{const s=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await je(a.appConfig,s)}throw t}}o(Nf,"fetchAuthTokenFromServer");function ql(a){return a!==void 0&&a.registrationStatus===2}o(ql,"isEntryRegistered");function Of(a){return a.requestStatus===2&&!Mf(a)}o(Of,"isAuthTokenValid");function Mf(a){const e=Date.now();return e<a.creationTime||a.creationTime+a.expiresIn<e+rf}o(Mf,"isAuthTokenExpired");function Rf(a){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},a),{authToken:e})}o(Rf,"makeAuthTokenRequestInProgressEntry");function Lf(a){return a.requestStatus===1&&a.requestTime+Nl<Date.now()}o(Lf,"hasAuthTokenRequestTimedOut");async function $f(a){const e=a,{installationEntry:t,registrationPromise:s}=await Pn(e);return s?s.catch(console.error):Cn(e).catch(console.error),t.fid}o($f,"getId");async function Ff(a,e=!1){const t=a;return await kf(t),(await Cn(t,e)).token}o(Ff,"getToken");async function kf(a){const{registrationPromise:e}=await Pn(a);e&&await e}o(kf,"completeInstallationRegistration");function Uf(a){if(!a||!a.options)throw _n("App Configuration");if(!a.name)throw _n("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!a.options[t])throw _n(t);return{appName:a.name,projectId:a.options.projectId,apiKey:a.options.apiKey,appId:a.options.appId}}o(Uf,"extractAppConfig");function _n(a){return Tt.create("missing-app-config-values",{valueName:a})}o(_n,"getMissingValueError");const Yl="installations",Bf="installations-internal",Vf=o(a=>{const e=a.getProvider("app").getImmediate(),t=Uf(e),s=Wt(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:s,_delete:o(()=>Promise.resolve(),"_delete")}},"publicFactory"),Gf=o(a=>{const e=a.getProvider("app").getImmediate(),t=Wt(e,Yl).getImmediate();return{getId:o(()=>$f(t),"getId"),getToken:o(n=>Ff(t,n),"getToken")}},"internalFactory");function jf(){ft(new J(Yl,Vf,"PUBLIC")),ft(new J(Bf,Gf,"PRIVATE"))}o(jf,"registerInstallations"),jf(),Z(xl,En),Z(xl,En,"esm2017");const Ke="analytics",zf="firebase_id",Kf="origin",Wf=60*1e3,Hf="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Tn="https://www.googletagmanager.com/gtag/js";const L=new Kt("@firebase/analytics");const qf={"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.',"no-client-id":'The "client_id" field is empty.',"invalid-gtag-resource":"Trusted Types detected an invalid gtag resource: {$gtagURL}."},z=new At("analytics","Analytics",qf);function Yf(a){if(!a.startsWith(Tn)){const e=z.create("invalid-gtag-resource",{gtagURL:a});return L.warn(e.message),""}return a}o(Yf,"createGtagTrustedTypesScriptURL");function Xl(a){return Promise.all(a.map(e=>e.catch(t=>t)))}o(Xl,"promiseAllSettled");function Xf(a,e){let t;return window.trustedTypes&&(t=window.trustedTypes.createPolicy(a,e)),t}o(Xf,"createTrustedTypesPolicy");function Qf(a,e){const t=Xf("firebase-js-sdk-policy",{createScriptURL:Yf}),s=document.createElement("script"),n=`${Tn}?l=${a}&id=${e}`;s.src=t?t==null?void 0:t.createScriptURL(n):n,s.async=!0,document.head.appendChild(s)}o(Qf,"insertScriptTag");function Jf(a){let e=[];return Array.isArray(window[a])?e=window[a]:window[a]=e,e}o(Jf,"getOrCreateDataLayer");async function Zf(a,e,t,s,n,i){const r=s[n];try{if(r)await e[r];else{const l=(await Xl(t)).find(d=>d.measurementId===n);l&&await e[l.appId]}}catch(c){L.error(c)}a("config",n,i)}o(Zf,"gtagOnConfig");async function tp(a,e,t,s,n){try{let i=[];if(n&&n.send_to){let r=n.send_to;Array.isArray(r)||(r=[r]);const c=await Xl(t);for(const l of r){const d=c.find(u=>u.measurementId===l),h=d&&e[d.appId];if(h)i.push(h);else{i=[];break}}}i.length===0&&(i=Object.values(e)),await Promise.all(i),a("event",s,n||{})}catch(i){L.error(i)}}o(tp,"gtagOnEvent");function ep(a,e,t,s){async function n(i,...r){try{if(i==="event"){const[c,l]=r;await tp(a,e,t,c,l)}else if(i==="config"){const[c,l]=r;await Zf(a,e,t,s,c,l)}else if(i==="consent"){const[c,l]=r;a("consent",c,l)}else if(i==="get"){const[c,l,d]=r;a("get",c,l,d)}else if(i==="set"){const[c]=r;a("set",c)}else a(i,...r)}catch(c){L.error(c)}}return o(n,"gtagWrapper"),n}o(ep,"wrapGtag");function sp(a,e,t,s,n){let i=o(function(...r){window[s].push(arguments)},"gtagCore");return window[n]&&typeof window[n]=="function"&&(i=window[n]),window[n]=ep(i,a,e,t),{gtagCore:i,wrappedGtag:window[n]}}o(sp,"wrapOrCreateGtag");function np(a){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Tn)&&t.src.includes(a))return t;return null}o(np,"findGtagScriptOnPage");const ap=30,ip=1e3,ur=class ur{constructor(e={},t=ip){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};o(ur,"RetryData");let xn=ur;const Ql=new xn;function rp(a){return new Headers({Accept:"application/json","x-goog-api-key":a})}o(rp,"getHeaders");async function op(a){var e;const{appId:t,apiKey:s}=a,n={method:"GET",headers:rp(s)},i=Hf.replace("{app-id}",t),r=await fetch(i,n);if(r.status!==200&&r.status!==304){let c="";try{const l=await r.json();!((e=l.error)===null||e===void 0)&&e.message&&(c=l.error.message)}catch{}throw z.create("config-fetch-failed",{httpStatus:r.status,responseMessage:c})}return r.json()}o(op,"fetchDynamicConfig");async function cp(a,e=Ql,t){const{appId:s,apiKey:n,measurementId:i}=a.options;if(!s)throw z.create("no-app-id");if(!n){if(i)return{measurementId:i,appId:s};throw z.create("no-api-key")}const r=e.getThrottleMetadata(s)||{backoffCount:0,throttleEndTimeMillis:Date.now()},c=new Nn;return setTimeout(async()=>{c.abort()},Wf),Jl({appId:s,apiKey:n,measurementId:i},r,c,e)}o(cp,"fetchDynamicConfigWithRetry");async function Jl(a,{throttleEndTimeMillis:e,backoffCount:t},s,n=Ql){var i;const{appId:r,measurementId:c}=a;try{await lp(s,e)}catch(l){if(c)return L.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:r,measurementId:c};throw l}try{const l=await op(a);return n.deleteThrottleMetadata(r),l}catch(l){const d=l;if(!dp(d)){if(n.deleteThrottleMetadata(r),c)return L.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${d==null?void 0:d.message}]`),{appId:r,measurementId:c};throw l}const h=Number((i=d==null?void 0:d.customData)===null||i===void 0?void 0:i.httpStatus)===503?nn(t,n.intervalMillis,ap):nn(t,n.intervalMillis),u={throttleEndTimeMillis:Date.now()+h,backoffCount:t+1};return n.setThrottleMetadata(r,u),L.debug(`Calling attemptFetch again in ${h} millis`),Jl(a,u,s,n)}}o(Jl,"attemptFetchDynamicConfigWithRetry");function lp(a,e){return new Promise((t,s)=>{const n=Math.max(e-Date.now(),0),i=setTimeout(t,n);a.addEventListener(()=>{clearTimeout(i),s(z.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}o(lp,"setAbortableTimeout$1");function dp(a){if(!(a instanceof ut)||!a.customData)return!1;const e=Number(a.customData.httpStatus);return e===429||e===500||e===503||e===504}o(dp,"isRetriableError$1");const fr=class fr{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}};o(fr,"AnalyticsAbortSignal");let Nn=fr;async function hp(a,e,t,s,n){if(n&&n.global){a("event",t,s);return}else{const i=await e,r=Object.assign(Object.assign({},s),{send_to:i});a("event",t,r)}}o(hp,"logEvent$1");async function up(a,e,t,s){{const n=await e;a("config",n,{update:!0,user_id:t})}}o(up,"setUserId$1");async function fp(a,e,t,s){{const n=await e;a("config",n,{update:!0,user_properties:t})}}o(fp,"setUserProperties$1");async function pp(){if(Ue())try{await sn()}catch(a){return L.warn(z.create("indexeddb-unavailable",{errorInfo:a==null?void 0:a.toString()}).message),!1}else return L.warn(z.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}o(pp,"validateIndexedDB");async function gp(a,e,t,s,n,i,r){var c;const l=cp(a);l.then(y=>{t[y.measurementId]=y.appId,a.options.measurementId&&y.measurementId!==a.options.measurementId&&L.warn(`The measurement ID in the local Firebase config (${a.options.measurementId}) does not match the measurement ID fetched from the server (${y.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(y=>L.error(y)),e.push(l);const d=pp().then(y=>{if(y)return s.getId()}),[h,u]=await Promise.all([l,d]);np(i)||Qf(i,h.measurementId),n("js",new Date);const p=(c=r==null?void 0:r.config)!==null&&c!==void 0?c:{};return p[Kf]="firebase",p.update=!0,u!=null&&(p[zf]=u),n("config",h.measurementId,p),h.measurementId}o(gp,"_initializeAnalytics");let yp=(ce=class{constructor(e){this.app=e}_delete(){return delete Ot[this.app.options.appId],Promise.resolve()}},o(ce,"AnalyticsService"),ce),Ot={},Zl=[];const td={};let On="dataLayer",mp="gtag",ed,We,sd=!1;function wp(){const a=[];if(qh()&&a.push("This is a browser extension environment."),pl()||a.push("Cookies are not available."),a.length>0){const e=a.map((s,n)=>`(${n+1}) ${s}`).join(" "),t=z.create("invalid-analytics-context",{errorInfo:e});L.warn(t.message)}}o(wp,"warnOnBrowserContextMismatch");function Ap(a,e,t){wp();const s=a.options.appId;if(!s)throw z.create("no-app-id");if(!a.options.apiKey)if(a.options.measurementId)L.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${a.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw z.create("no-api-key");if(Ot[s]!=null)throw z.create("already-exists",{id:s});if(!sd){Jf(On);const{wrappedGtag:i,gtagCore:r}=sp(Ot,Zl,td,On,mp);We=i,ed=r,sd=!0}return Ot[s]=gp(a,Zl,td,e,ed,On,t),new yp(a)}o(Ap,"factory$1");function Ip(a=wn()){a=j(a);const e=Wt(a,Ke);return e.isInitialized()?e.getImmediate():bp(a)}o(Ip,"getAnalytics");function bp(a,e={}){const t=Wt(a,Ke);if(t.isInitialized()){const n=t.getImmediate();if(Be(e,t.getOptions()))return n;throw z.create("already-initialized")}return t.initialize({options:e})}o(bp,"initializeAnalytics");function Ep(a,e,t){a=j(a),up(We,Ot[a.app.options.appId],e).catch(s=>L.error(s))}o(Ep,"setUserId");function Dp(a,e,t){a=j(a),fp(We,Ot[a.app.options.appId],e).catch(s=>L.error(s))}o(Dp,"setUserProperties");function nd(a,e,t,s){a=j(a),hp(We,Ot[a.app.options.appId],e,t,s).catch(n=>L.error(n))}o(nd,"logEvent");const ad="@firebase/analytics",id="0.10.4";function vp(){ft(new J(Ke,(e,{options:t})=>{const s=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate();return Ap(s,n,t)},"PUBLIC")),ft(new J("analytics-internal",a,"PRIVATE")),Z(ad,id),Z(ad,id,"esm2017");function a(e){try{const t=e.getProvider(Ke).getImmediate();return{logEvent:o((s,n,i)=>nd(t,s,n,i),"logEvent")}}catch(t){throw z.create("interop-component-reg-failed",{reason:t})}}o(a,"internalFactory")}o(vp,"registerAnalytics"),vp();const pr=class pr{constructor(e){f(this,"plugin");f(this,"firebaseApp");this.plugin=e,"firebaseApp"in e&&(this.firebaseApp=e.firebaseApp)}setStorageData(e,t,s){const{storage:n}=this.plugin.game,i={[e]:{[t]:s}};n.setStorageData("firebase","services",i)}};o(pr,"BaseService");let Ie=pr;const{Valid:rd}=g.Utils,gr=class gr extends Ie{constructor(t){super(t);f(this,"analytics");this.initialize()}initialize(){this.analytics=Ip(this.firebaseApp),this.setStorageData("analytics","isInitialized",!0)}event(t,s){this.analytics&&rd.isString(t)&&rd.isObject(s)&&(nd(this.analytics,t,s,{global:!0}),this.setStorageData("analytics","lastEvent",t))}setUser(t,s){this.analytics&&(Ep(this.analytics,t),Dp(this.analytics,s))}};o(gr,"AnalyticsService");let Mn=gr;const od="@firebase/performance",Rn="0.6.7";const cd=Rn,Sp="FB-PERF-TRACE-START",Pp="FB-PERF-TRACE-STOP",Ln="FB-PERF-TRACE-MEASURE",ld="_wt_",dd="_fp",hd="_fcp",ud="_fid",fd="@firebase/performance/config",pd="@firebase/performance/configexpire",Cp="performance",gd="Performance";const _p={"trace started":"Trace {$traceName} was started before.","trace stopped":"Trace {$traceName} is not running.","nonpositive trace startTime":"Trace {$traceName} startTime should be positive.","nonpositive trace duration":"Trace {$traceName} duration should be positive.","no window":"Window is not available.","no app id":"App id is not available.","no project id":"Project id is not available.","no api key":"Api key is not available.","invalid cc log":"Attempted to queue invalid cc event","FB not default":"Performance can only start when Firebase app instance is the default one.","RC response not ok":"RC response is not ok","invalid attribute name":"Attribute name {$attributeName} is invalid.","invalid attribute value":"Attribute value {$attributeValue} is invalid.","invalid custom metric name":"Custom metric name {$customMetricName} is invalid","invalid String merger input":"Input for String merger is invalid, contact support team to resolve.","already initialized":"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."},$=new At(Cp,gd,_p);const ct=new Kt(gd);ct.logLevel=E.INFO;let $n,yd;const Ts=class Ts{constructor(e){if(this.window=e,!e)throw $.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){!this.performance||!this.performance.mark||this.performance.mark(e)}measure(e,t,s){!this.performance||!this.performance.measure||this.performance.measure(e,t,s)}getEntriesByType(e){return!this.performance||!this.performance.getEntriesByType?[]:this.performance.getEntriesByType(e)}getEntriesByName(e){return!this.performance||!this.performance.getEntriesByName?[]:this.performance.getEntriesByName(e)}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return!fetch||!Promise||!pl()?(ct.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1):Ue()?!0:(ct.info("IndexedDB is not supported by current browser"),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver(n=>{for(const i of n.getEntries())t(i)}).observe({entryTypes:[e]})}static getInstance(){return $n===void 0&&($n=new Ts(yd)),$n}};o(Ts,"Api");let O=Ts;function Tp(a){yd=a}o(Tp,"setupApi");let md;function xp(a){const e=a.getId();return e.then(t=>{md=t}),e}o(xp,"getIidPromise");function Fn(){return md}o(Fn,"getIid");function Np(a){const e=a.getToken();return e.then(t=>{}),e}o(Np,"getAuthTokenPromise");function wd(a,e){const t=a.length-e.length;if(t<0||t>1)throw $.create("invalid String merger input");const s=[];for(let n=0;n<a.length;n++)s.push(a.charAt(n)),e.length>n&&s.push(e.charAt(n));return s.join("")}o(wd,"mergeStrings");let kn;const xs=class xs{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=wd("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=wd("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return kn===void 0&&(kn=new xs),kn}};o(xs,"SettingsService");let K=xs;var Ht;(function(a){a[a.UNKNOWN=0]="UNKNOWN",a[a.VISIBLE=1]="VISIBLE",a[a.HIDDEN=2]="HIDDEN"})(Ht||(Ht={}));const Op=["firebase_","google_","ga_"],Mp=new RegExp("^[a-zA-Z]\\w*$"),Rp=40,Lp=100;function $p(){const a=O.getInstance().navigator;return a!=null&&a.serviceWorker?a.serviceWorker.controller?2:3:1}o($p,"getServiceWorkerStatus");function Ad(){switch(O.getInstance().document.visibilityState){case"visible":return Ht.VISIBLE;case"hidden":return Ht.HIDDEN;default:return Ht.UNKNOWN}}o(Ad,"getVisibilityState");function Fp(){const e=O.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}o(Fp,"getEffectiveConnectionType");function kp(a){return a.length===0||a.length>Rp?!1:!Op.some(t=>a.startsWith(t))&&!!a.match(Mp)}o(kp,"isValidCustomAttributeName");function Up(a){return a.length!==0&&a.length<=Lp}o(Up,"isValidCustomAttributeValue");function Id(a){var e;const t=(e=a.options)===null||e===void 0?void 0:e.appId;if(!t)throw $.create("no app id");return t}o(Id,"getAppId");function Bp(a){var e;const t=(e=a.options)===null||e===void 0?void 0:e.projectId;if(!t)throw $.create("no project id");return t}o(Bp,"getProjectId");function Vp(a){var e;const t=(e=a.options)===null||e===void 0?void 0:e.apiKey;if(!t)throw $.create("no api key");return t}o(Vp,"getApiKey");const Gp="0.0.1",nt={loggingEnabled:!0},jp="FIREBASE_INSTALLATIONS_AUTH";function zp(a,e){const t=Kp();return t?(bd(t),Promise.resolve()):qp(a,e).then(bd).then(s=>Wp(s),()=>{})}o(zp,"getConfig");function Kp(){const a=O.getInstance().localStorage;if(!a)return;const e=a.getItem(pd);if(!e||!Yp(e))return;const t=a.getItem(fd);if(t)try{return JSON.parse(t)}catch{return}}o(Kp,"getStoredConfig");function Wp(a){const e=O.getInstance().localStorage;!a||!e||(e.setItem(fd,JSON.stringify(a)),e.setItem(pd,String(Date.now()+K.getInstance().configTimeToLive*60*60*1e3)))}o(Wp,"storeConfig");const Hp="Could not fetch config, will use default configs";function qp(a,e){return Np(a.installations).then(t=>{const s=Bp(a.app),n=Vp(a.app),i=`https://firebaseremoteconfig.googleapis.com/v1/projects/${s}/namespaces/fireperf:fetch?key=${n}`,r=new Request(i,{method:"POST",headers:{Authorization:`${jp} ${t}`},body:JSON.stringify({app_instance_id:e,app_instance_id_token:t,app_id:Id(a.app),app_version:cd,sdk_version:Gp})});return fetch(r).then(c=>{if(c.ok)return c.json();throw $.create("RC response not ok")})}).catch(()=>{ct.info(Hp)})}o(qp,"getRemoteConfig$1");function bd(a){if(!a)return a;const e=K.getInstance(),t=a.entries||{};return t.fpr_enabled!==void 0?e.loggingEnabled=String(t.fpr_enabled)==="true":e.loggingEnabled=nt.loggingEnabled,t.fpr_log_source?e.logSource=Number(t.fpr_log_source):nt.logSource&&(e.logSource=nt.logSource),t.fpr_log_endpoint_url?e.logEndPointUrl=t.fpr_log_endpoint_url:nt.logEndPointUrl&&(e.logEndPointUrl=nt.logEndPointUrl),t.fpr_log_transport_key?e.transportKey=t.fpr_log_transport_key:nt.transportKey&&(e.transportKey=nt.transportKey),t.fpr_vc_network_request_sampling_rate!==void 0?e.networkRequestsSamplingRate=Number(t.fpr_vc_network_request_sampling_rate):nt.networkRequestsSamplingRate!==void 0&&(e.networkRequestsSamplingRate=nt.networkRequestsSamplingRate),t.fpr_vc_trace_sampling_rate!==void 0?e.tracesSamplingRate=Number(t.fpr_vc_trace_sampling_rate):nt.tracesSamplingRate!==void 0&&(e.tracesSamplingRate=nt.tracesSamplingRate),e.logTraceAfterSampling=Ed(e.tracesSamplingRate),e.logNetworkAfterSampling=Ed(e.networkRequestsSamplingRate),a}o(bd,"processConfig");function Yp(a){return Number(a)>Date.now()}o(Yp,"configValid");function Ed(a){return Math.random()<=a}o(Ed,"shouldLogAfterSampling");let Un=1,Bn;function Dd(a){return Un=2,Bn=Bn||Qp(a),Bn}o(Dd,"getInitializationPromise");function Xp(){return Un===3}o(Xp,"isPerfInitialized");function Qp(a){return Jp().then(()=>xp(a.installations)).then(e=>zp(a,e)).then(()=>vd(),()=>vd())}o(Qp,"initializePerf");function Jp(){const a=O.getInstance().document;return new Promise(e=>{if(a&&a.readyState!=="complete"){const t=o(()=>{a.readyState==="complete"&&(a.removeEventListener("readystatechange",t),e())},"handler");a.addEventListener("readystatechange",t)}else e()})}o(Jp,"getDocumentReadyComplete");function vd(){Un=3}o(vd,"changeInitializationStatus");const Vn=10*1e3,Zp=5.5*1e3,Sd=3,tg=1e3;let He=Sd,Et=[],Pd=!1;function eg(){Pd||(qe(Zp),Pd=!0)}o(eg,"setupTransportService");function qe(a){setTimeout(()=>{if(He!==0){if(!Et.length)return qe(Vn);sg()}},a)}o(qe,"processQueue");function sg(){const a=Et.splice(0,tg),e=a.map(s=>({source_extension_json_proto3:s.message,event_time_ms:String(s.eventTime)})),t={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:K.getInstance().logSource,log_event:e};ng(t,a).catch(()=>{Et=[...a,...Et],He--,ct.info(`Tries left: ${He}.`),qe(Vn)})}o(sg,"dispatchQueueEvents");function ng(a,e){return ag(a).then(t=>(t.ok||ct.info("Call to Firebase backend failed."),t.json())).then(t=>{const s=Number(t.nextRequestWaitMillis);let n=Vn;isNaN(s)||(n=Math.max(s,n));const i=t.logResponseDetails;Array.isArray(i)&&i.length>0&&i[0].responseAction==="RETRY_REQUEST_LATER"&&(Et=[...e,...Et],ct.info("Retry transport request later.")),He=Sd,qe(n)})}o(ng,"sendEventsToFl");function ag(a){const e=K.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(a)})}o(ag,"postToFlEndpoint");function ig(a){if(!a.eventTime||!a.message)throw $.create("invalid cc log");Et=[...Et,a]}o(ig,"addToQueue");function rg(a){return(...e)=>{const t=a(...e);ig({message:t,eventTime:Date.now()})}}o(rg,"transportHandler");let Gn;function Cd(a,e){Gn||(Gn=rg(cg)),Gn(a,e)}o(Cd,"sendLog");function Ye(a){const e=K.getInstance();!e.instrumentationEnabled&&a.isAuto||!e.dataCollectionEnabled&&!a.isAuto||O.getInstance().requiredApisAvailable()&&(a.isAuto&&Ad()!==Ht.VISIBLE||(Xp()?jn(a):Dd(a.performanceController).then(()=>jn(a),()=>jn(a))))}o(Ye,"logTrace");function jn(a){if(!Fn())return;const e=K.getInstance();!e.loggingEnabled||!e.logTraceAfterSampling||setTimeout(()=>Cd(a,1),0)}o(jn,"sendTraceLog");function og(a){const e=K.getInstance();if(!e.instrumentationEnabled)return;const t=a.url,s=e.logEndPointUrl.split("?")[0],n=e.flTransportEndpointUrl.split("?")[0];t===s||t===n||!e.loggingEnabled||!e.logNetworkAfterSampling||setTimeout(()=>Cd(a,0),0)}o(og,"logNetworkRequest");function cg(a,e){return e===0?lg(a):dg(a)}o(cg,"serializer");function lg(a){const e={url:a.url,http_method:a.httpMethod||0,http_response_code:200,response_payload_bytes:a.responsePayloadBytes,client_start_time_us:a.startTimeUs,time_to_response_initiated_us:a.timeToResponseInitiatedUs,time_to_response_completed_us:a.timeToResponseCompletedUs},t={application_info:_d(a.performanceController.app),network_request_metric:e};return JSON.stringify(t)}o(lg,"serializeNetworkRequest");function dg(a){const e={name:a.name,is_auto:a.isAuto,client_start_time_us:a.startTimeUs,duration_us:a.durationUs};Object.keys(a.counters).length!==0&&(e.counters=a.counters);const t=a.getAttributes();Object.keys(t).length!==0&&(e.custom_attributes=t);const s={application_info:_d(a.performanceController.app),trace_metric:e};return JSON.stringify(s)}o(dg,"serializeTrace");function _d(a){return{google_app_id:Id(a),app_instance_id:Fn(),web_app_info:{sdk_version:cd,page_url:O.getInstance().getUrl(),service_worker_status:$p(),visibility_state:Ad(),effective_connection_type:Fp()},application_process_state:0}}o(_d,"getApplicationInfo");const hg=100,ug="_",fg=[dd,hd,ud];function pg(a,e){return a.length===0||a.length>hg?!1:e&&e.startsWith(ld)&&fg.indexOf(a)>-1||!a.startsWith(ug)}o(pg,"isValidMetricName");function gg(a){const e=Math.floor(a);return e<a&&ct.info(`Metric value should be an Integer, setting the value as : ${e}.`),e}o(gg,"convertMetricValueToInteger");const $e=class $e{constructor(e,t,s=!1,n){this.performanceController=e,this.name=t,this.isAuto=s,this.state=1,this.customAttributes={},this.counters={},this.api=O.getInstance(),this.randomId=Math.floor(Math.random()*1e6),this.isAuto||(this.traceStartMark=`${Sp}-${this.randomId}-${this.name}`,this.traceStopMark=`${Pp}-${this.randomId}-${this.name}`,this.traceMeasure=n||`${Ln}-${this.randomId}-${this.name}`,n&&this.calculateTraceMetrics())}start(){if(this.state!==1)throw $.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(this.state!==2)throw $.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),Ye(this)}record(e,t,s){if(e<=0)throw $.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw $.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(t*1e3),this.startTimeUs=Math.floor(e*1e3),s&&s.attributes&&(this.customAttributes=Object.assign({},s.attributes)),s&&s.metrics)for(const n of Object.keys(s.metrics))isNaN(Number(s.metrics[n]))||(this.counters[n]=Math.floor(Number(s.metrics[n])));Ye(this)}incrementMetric(e,t=1){this.counters[e]===void 0?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(pg(e,this.name))this.counters[e]=gg(t??0);else throw $.create("invalid custom metric name",{customMetricName:e})}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const s=kp(e),n=Up(t);if(s&&n){this.customAttributes[e]=t;return}if(!s)throw $.create("invalid attribute name",{attributeName:e});if(!n)throw $.create("invalid attribute value",{attributeValue:t})}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){this.customAttributes[e]!==void 0&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(t.duration*1e3),this.startTimeUs=Math.floor((t.startTime+this.api.getTimeOrigin())*1e3))}static createOobTrace(e,t,s,n){const i=O.getInstance().getUrl();if(!i)return;const r=new $e(e,ld+i,!0),c=Math.floor(O.getInstance().getTimeOrigin()*1e3);r.setStartTime(c),t&&t[0]&&(r.setDuration(Math.floor(t[0].duration*1e3)),r.putMetric("domInteractive",Math.floor(t[0].domInteractive*1e3)),r.putMetric("domContentLoadedEventEnd",Math.floor(t[0].domContentLoadedEventEnd*1e3)),r.putMetric("loadEventEnd",Math.floor(t[0].loadEventEnd*1e3)));const l="first-paint",d="first-contentful-paint";if(s){const h=s.find(p=>p.name===l);h&&h.startTime&&r.putMetric(dd,Math.floor(h.startTime*1e3));const u=s.find(p=>p.name===d);u&&u.startTime&&r.putMetric(hd,Math.floor(u.startTime*1e3)),n&&r.putMetric(ud,Math.floor(n*1e3))}Ye(r)}static createUserTimingTrace(e,t){const s=new $e(e,t,!1,t);Ye(s)}};o($e,"Trace");let Mt=$e;function Td(a,e){const t=e;if(!t||t.responseStart===void 0)return;const s=O.getInstance().getTimeOrigin(),n=Math.floor((t.startTime+s)*1e3),i=t.responseStart?Math.floor((t.responseStart-t.startTime)*1e3):void 0,r=Math.floor((t.responseEnd-t.startTime)*1e3),c=t.name&&t.name.split("?")[0],l={performanceController:a,url:c,responsePayloadBytes:t.transferSize,startTimeUs:n,timeToResponseInitiatedUs:i,timeToResponseCompletedUs:r};og(l)}o(Td,"createNetworkRequestEntry");const yg=5e3;function xd(a){Fn()&&(setTimeout(()=>wg(a),0),setTimeout(()=>mg(a),0),setTimeout(()=>Ag(a),0))}o(xd,"setupOobResources");function mg(a){const e=O.getInstance(),t=e.getEntriesByType("resource");for(const s of t)Td(a,s);e.setupObserver("resource",s=>Td(a,s))}o(mg,"setupNetworkRequests");function wg(a){const e=O.getInstance(),t=e.getEntriesByType("navigation"),s=e.getEntriesByType("paint");if(e.onFirstInputDelay){let n=setTimeout(()=>{Mt.createOobTrace(a,t,s),n=void 0},yg);e.onFirstInputDelay(i=>{n&&(clearTimeout(n),Mt.createOobTrace(a,t,s,i))})}else Mt.createOobTrace(a,t,s)}o(wg,"setupOobTraces");function Ag(a){const e=O.getInstance(),t=e.getEntriesByType("measure");for(const s of t)Nd(a,s);e.setupObserver("measure",s=>Nd(a,s))}o(Ag,"setupUserTimingTraces");function Nd(a,e){const t=e.name;t.substring(0,Ln.length)!==Ln&&Mt.createUserTimingTrace(a,t)}o(Nd,"createUserTimingTrace");const yr=class yr{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||((e==null?void 0:e.dataCollectionEnabled)!==void 0&&(this.dataCollectionEnabled=e.dataCollectionEnabled),(e==null?void 0:e.instrumentationEnabled)!==void 0&&(this.instrumentationEnabled=e.instrumentationEnabled),O.getInstance().requiredApisAvailable()?sn().then(t=>{t&&(eg(),Dd(this).then(()=>xd(this),()=>xd(this)),this.initialized=!0)}).catch(t=>{ct.info(`Environment doesn't support IndexedDB: ${t}`)}):ct.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){K.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return K.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){K.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return K.getInstance().dataCollectionEnabled}};o(yr,"PerformanceController");let zn=yr;const Ig="[DEFAULT]";function bg(a=wn()){return a=j(a),Wt(a,"performance").getImmediate()}o(bg,"getPerformance");function Eg(a,e){return a=j(a),new Mt(a,e)}o(Eg,"trace");const Dg=o((a,{options:e})=>{const t=a.getProvider("app").getImmediate(),s=a.getProvider("installations-internal").getImmediate();if(t.name!==Ig)throw $.create("FB not default");if(typeof window>"u")throw $.create("no window");Tp(window);const n=new zn(t,s);return n._init(e),n},"factory");function vg(){ft(new J("performance",Dg,"PUBLIC")),Z(od,Rn),Z(od,Rn,"esm2017")}o(vg,"registerPerformance"),vg();const mr=class mr extends Ie{constructor(t){super(t);f(this,"perf");f(this,"traces");this.traces={},this.initialize()}initialize(){this.perf=bg(this.firebaseApp),this.perf.dataCollectionEnabled=!0,this.perf.instrumentationEnabled=!1,this.setStorageData("performance","isInitialized",!0)}measure(t){this.perf&&(this.traces[t]=Eg(this.perf,t))}start(t){this.traces[t]&&this.traces[t].start()}record(t,s){if(!this.traces[t])return;const{startTime:n=Date.now(),duration:i,options:r}=s;this.traces[t].record(n,i,r)}stop(t){this.traces[t]&&this.traces[t].stop()}putMetric(t,s,n=1){if(!this.traces[t])return;const i=this.formatKeyName(s);this.traces[t].putMetric(i,n)}incrementMetric(t,s,n=1){if(!this.traces[t])return;const i=this.formatKeyName(s);this.traces[t].incrementMetric(i,n)}putAttr(t,s,n){if(!this.traces[t])return;const i=this.formatKeyName(s);this.traces[t].putAttribute(i,n)}removeAttr(t,s){if(!this.traces[t])return;const n=this.formatKeyName(s);this.traces[t].removeAttribute(n)}formatKeyName(t){return t.replace(/\s/g,"_")}};o(mr,"PerformanceService");let Kn=mr;const Wn="@firebase/remote-config",Od="0.4.7";const wr=class wr{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}};o(wr,"RemoteConfigAbortSignal");let Hn=wr;const Md="remote-config";const Sg={"registration-window":"Undefined window object. This SDK only supports usage in a browser environment.","registration-project-id":"Undefined project identifier. Check Firebase app initialization.","registration-api-key":"Undefined API key. Check Firebase app initialization.","registration-app-id":"Undefined app identifier. Check Firebase app initialization.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","storage-delete":"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.","fetch-client-network":"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-timeout":'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',"fetch-throttle":'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',"fetch-client-parse":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","indexed-db-unavailable":"Indexed DB is not supported by current browser"},k=new At("remoteconfig","Remote Config",Sg);function Pg(a,e){return a instanceof ut&&a.code.indexOf(e)!==-1}o(Pg,"hasErrorCode");const Cg=!1,_g="",Rd=0,Tg=["1","true","t","yes","y","on"],Ar=class Ar{constructor(e,t=_g){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return this._source==="static"?Cg:Tg.indexOf(this._value.toLowerCase())>=0}asNumber(){if(this._source==="static")return Rd;let e=Number(this._value);return isNaN(e)&&(e=Rd),e}getSource(){return this._source}};o(Ar,"Value");let be=Ar;function xg(a=wn()){return a=j(a),Wt(a,Md).getImmediate()}o(xg,"getRemoteConfig");async function Ng(a){const e=j(a),[t,s]=await Promise.all([e._storage.getLastSuccessfulFetchResponse(),e._storage.getActiveConfigEtag()]);return!t||!t.config||!t.eTag||t.eTag===s?!1:(await Promise.all([e._storageCache.setActiveConfig(t.config),e._storage.setActiveConfigEtag(t.eTag)]),!0)}o(Ng,"activate");function Og(a){const e=j(a);return e._initializePromise||(e._initializePromise=e._storageCache.loadFromStorage().then(()=>{e._isInitializationComplete=!0})),e._initializePromise}o(Og,"ensureInitialized");async function Mg(a){const e=j(a),t=new Hn;setTimeout(async()=>{t.abort()},e.settings.fetchTimeoutMillis);try{await e._client.fetch({cacheMaxAgeMillis:e.settings.minimumFetchIntervalMillis,signal:t}),await e._storageCache.setLastFetchStatus("success")}catch(s){const n=Pg(s,"fetch-throttle")?"throttle":"failure";throw await e._storageCache.setLastFetchStatus(n),s}}o(Mg,"fetchConfig");function Rg(a,e){return Lg(j(a),e).asString()}o(Rg,"getString");function Lg(a,e){const t=j(a);t._isInitializationComplete||t._logger.debug(`A value was requested for key "${e}" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.`);const s=t._storageCache.getActiveConfig();return s&&s[e]!==void 0?new be("remote",s[e]):t.defaultConfig&&t.defaultConfig[e]!==void 0?new be("default",String(t.defaultConfig[e])):(t._logger.debug(`Returning static value for key "${e}". Define a default or remote value if this is unintentional.`),new be("static"))}o(Lg,"getValue");const Ir=class Ir{constructor(e,t,s,n){this.client=e,this.storage=t,this.storageCache=s,this.logger=n}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const s=Date.now()-t,n=s<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${s}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${n}.`),n}async fetch(e){const[t,s]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(s&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return s;e.eTag=s&&s.eTag;const n=await this.client.fetch(e),i=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return n.status===200&&i.push(this.storage.setLastSuccessfulFetchResponse(n)),await Promise.all(i),n}};o(Ir,"CachingClient");let qn=Ir;function $g(a=navigator){return a.languages&&a.languages[0]||a.language}o($g,"getUserLanguage");const br=class br{constructor(e,t,s,n,i,r){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=s,this.projectId=n,this.apiKey=i,this.appId=r}async fetch(e){const[t,s]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),i=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,r={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},c={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:s,app_id:this.appId,language_code:$g()},l={method:"POST",headers:r,body:JSON.stringify(c)},d=fetch(i,l),h=new Promise((m,v)=>{e.signal.addEventListener(()=>{const Y=new Error("The operation was aborted.");Y.name="AbortError",v(Y)})});let u;try{await Promise.race([d,h]),u=await d}catch(m){let v="fetch-client-network";throw(m==null?void 0:m.name)==="AbortError"&&(v="fetch-timeout"),k.create(v,{originalErrorMessage:m==null?void 0:m.message})}let p=u.status;const y=u.headers.get("ETag")||void 0;let w,A;if(u.status===200){let m;try{m=await u.json()}catch(v){throw k.create("fetch-client-parse",{originalErrorMessage:v==null?void 0:v.message})}w=m.entries,A=m.state}if(A==="INSTANCE_STATE_UNSPECIFIED"?p=500:A==="NO_CHANGE"?p=304:(A==="NO_TEMPLATE"||A==="EMPTY_CONFIG")&&(w={}),p!==304&&p!==200)throw k.create("fetch-status",{httpStatus:p});return{status:p,eTag:y,config:w}}};o(br,"RestClient");let Yn=br;function Fg(a,e){return new Promise((t,s)=>{const n=Math.max(e-Date.now(),0),i=setTimeout(t,n);a.addEventListener(()=>{clearTimeout(i),s(k.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}o(Fg,"setAbortableTimeout");function kg(a){if(!(a instanceof ut)||!a.customData)return!1;const e=Number(a.customData.httpStatus);return e===429||e===500||e===503||e===504}o(kg,"isRetriableError");const Er=class Er{constructor(e,t){this.client=e,this.storage=t}async fetch(e){const t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:s}){await Fg(e.signal,t);try{const n=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),n}catch(n){if(!kg(n))throw n;const i={throttleEndTimeMillis:Date.now()+nn(s),backoffCount:s+1};return await this.storage.setThrottleMetadata(i),this.attemptFetch(e,i)}}};o(Er,"RetryingClient");let Xn=Er;const Ug=60*1e3,Bg=12*60*60*1e3,Dr=class Dr{constructor(e,t,s,n,i){this.app=e,this._client=t,this._storageCache=s,this._storage=n,this._logger=i,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:Ug,minimumFetchIntervalMillis:Bg},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}};o(Dr,"RemoteConfig");let Qn=Dr;function Xe(a,e){const t=a.target.error||void 0;return k.create(e,{originalErrorMessage:t&&(t==null?void 0:t.message)})}o(Xe,"toFirebaseError");const Rt="app_namespace_store",Vg="firebase_remote_config",Gg=1;function jg(){return new Promise((a,e)=>{try{const t=indexedDB.open(Vg,Gg);t.onerror=s=>{e(Xe(s,"storage-open"))},t.onsuccess=s=>{a(s.target.result)},t.onupgradeneeded=s=>{const n=s.target.result;switch(s.oldVersion){case 0:n.createObjectStore(Rt,{keyPath:"compositeKey"})}}}catch(t){e(k.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}})}o(jg,"openDatabase");const vr=class vr{constructor(e,t,s,n=jg()){this.appId=e,this.appName=t,this.namespace=s,this.openDbPromise=n}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(e){const t=await this.openDbPromise;return new Promise((s,n)=>{const r=t.transaction([Rt],"readonly").objectStore(Rt),c=this.createCompositeKey(e);try{const l=r.get(c);l.onerror=d=>{n(Xe(d,"storage-get"))},l.onsuccess=d=>{const h=d.target.result;s(h?h.value:void 0)}}catch(l){n(k.create("storage-get",{originalErrorMessage:l==null?void 0:l.message}))}})}async set(e,t){const s=await this.openDbPromise;return new Promise((n,i)=>{const c=s.transaction([Rt],"readwrite").objectStore(Rt),l=this.createCompositeKey(e);try{const d=c.put({compositeKey:l,value:t});d.onerror=h=>{i(Xe(h,"storage-set"))},d.onsuccess=()=>{n()}}catch(d){i(k.create("storage-set",{originalErrorMessage:d==null?void 0:d.message}))}})}async delete(e){const t=await this.openDbPromise;return new Promise((s,n)=>{const r=t.transaction([Rt],"readwrite").objectStore(Rt),c=this.createCompositeKey(e);try{const l=r.delete(c);l.onerror=d=>{n(Xe(d,"storage-delete"))},l.onsuccess=()=>{s()}}catch(l){n(k.create("storage-delete",{originalErrorMessage:l==null?void 0:l.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}};o(vr,"Storage");let Jn=vr;const Sr=class Sr{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){const e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),s=this.storage.getActiveConfig(),n=await e;n&&(this.lastFetchStatus=n);const i=await t;i&&(this.lastSuccessfulFetchTimestampMillis=i);const r=await s;r&&(this.activeConfig=r)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}};o(Sr,"StorageCache");let Zn=Sr;function zg(){ft(new J(Md,a,"PUBLIC").setMultipleInstances(!0)),Z(Wn,Od),Z(Wn,Od,"esm2017");function a(e,{instanceIdentifier:t}){const s=e.getProvider("app").getImmediate(),n=e.getProvider("installations-internal").getImmediate();if(typeof window>"u")throw k.create("registration-window");if(!Ue())throw k.create("indexed-db-unavailable");const{projectId:i,apiKey:r,appId:c}=s.options;if(!i)throw k.create("registration-project-id");if(!r)throw k.create("registration-api-key");if(!c)throw k.create("registration-app-id");t=t||"firebase";const l=new Jn(c,s.name,t),d=new Zn(l),h=new Kt(Wn);h.logLevel=E.ERROR;const u=new Yn(n,qu,t,i,r,c),p=new Xn(u,l),y=new qn(p,l,d,h),w=new Qn(s,y,d,l,h);return Og(w),w}o(a,"remoteConfigFactory")}o(zg,"registerRemoteConfig");async function Kg(a){return a=j(a),await Mg(a),Ng(a)}o(Kg,"fetchAndActivate"),zg();const{Valid:Ld}=g.Utils,Pr=class Pr extends Ie{constructor(t){super(t);f(this,"remoteConfig");this.initialize()}initialize(){this.remoteConfig=xg(this.firebaseApp),this.setStorageData("remoteConfig","isInitialized",!0)}async fetchDataAsync(){this.remoteConfig&&(await Kg(this.remoteConfig),this.setStorageData("remoteConfig","lastFetchTime",Date.now()),this.setStorageData("remoteConfig","lastFetchStatus",this.remoteConfig.lastFetchStatus))}getDataByKey(t){if(!this.remoteConfig)return null;const s=Rg(this.remoteConfig,t);if(!Ld.isString(s))return null;const n=JSON.parse(s);return Ld.isObject(n.data)?(this.setStorageData("remoteConfig","lastConfig",n),n):null}};o(Pr,"RemoteConfigService");let ta=Pr;const Wg={services:{},isInitialized:!1},Cr=class Cr extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"firebaseApp");f(this,"services")}init(){this.services={};const{storage:t}=this.game;t.addStorage("firebase",Wg)}configure(t){this.initializeFirebase(t.Options),this.initializeServices(t.Services)}initializeFirebase(t){const s={appId:t.AppId,apiKey:t.ApiKey,projectId:t.ProjectId,authDomain:t.AuthDomain,measurementId:t.MeasurementId,storageBucket:t.StorageBucket,messagingSenderId:t.MessagingSenderId};this.firebaseApp=vl(s),this.setStorageData("isInitialized",!0)}initializeServices(t){this.getStorageData("isInitialized")&&(this.initializeAnalytics(t.Analytics),this.initializePerformance(t.Performance),this.initializeRemoteConfig(t.RemoteConfig))}initializeAnalytics(t){t.Enabled&&(this.services.analytics=new Mn(this))}initializePerformance(t){t.Enabled&&(this.services.performance=new Kn(this))}initializeRemoteConfig(t){t.Enabled&&(this.services.remoteConfig=new ta(this))}setStorageData(t,s){const{storage:n}=this.game;n.setStorageData("firebase",t,s)}getStorageData(t){const{storage:s}=this.game;return s.getStorageData("firebase",t)}};o(Cr,"FirebasePlugin");let ea=Cr;const Hg='nunito,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Fira Sans","Droid Sans","Helvetica Neue",sans-serif',{Configs:qg,Utils:Yg}=g,{Object:$d}=Yg,{Enabled:Xg,WideframeConfigs:sa}=qg.FrameCapture,Qg=o(async a=>{if(!Xg)return console.warn("FrameCapture is not enabled"),null;const e=Zg(a);if(!e)return null;Jg(e,sa.ResultChallenge);const{frameCapture:t}=window.game,{Width:s,Height:n}=sa.ResultChallenge;return t.captureAsync({name:"ResultChallenge",width:s,height:n,renderOptions:e})},"renderResultChallenge"),Jg=o((a,e)=>{const{Width:t,Height:s,Wideframe:n}=e;a.wideframe={name:"result-challenge",type:"image",depth:0,image:n,size:[t,s],position:[0,0]}},"addWideframe$2"),Zg=o(a=>{try{const{playerId:e="10",playerPhoto:t="",playerScore:s=0,opponentId:n="20",opponentPhoto:i="",opponentScore:r=0,isPlayerFinished:c,isOpponentFinished:l}=a,{RenderOptions:d}=sa.ResultChallenge,h=$d.camelCaseKeys($d.clone(d)),{playerPhoto:u,opponentPhoto:p}=h,y=s===r,w=s>r,A=c??l,m=c&&l;return u.type==="image"&&(u.name=`${e}`,u.image=t),p.type==="image"&&(p.name=`${n}`,p.image=i),A&&ty(h,{playerScore:s,opponentScore:r,isPlayerFinished:c,isOpponentFinished:l}),!m||y?(delete h.leftCrown,delete h.rightCrown,h):(w?delete h.rightCrown:delete h.leftCrown,h)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$2"),ty=o((a,e)=>{const{leftScore:t,rightScore:s}=a,{playerScore:n=0,opponentScore:i=0,isPlayerFinished:r,isOpponentFinished:c}=e;t.type==="text"&&(t.text=r?`${n}`:"???"),s.type==="text"&&(s.text=c?`${i}`:"???")},"addRenderScores"),{Configs:ey,Utils:sy}=g,{Object:Fd}=sy,{Enabled:ny,WideframeConfigs:na}=ey.FrameCapture,ay=o(async a=>{if(!ny)return console.warn("FrameCapture is not enabled"),null;const e=ry(a);if(!e)return null;iy(e,na.ShareLeaderboard);const{frameCapture:t}=window.game,{Width:s,Height:n}=na.ShareLeaderboard;return t.captureAsync({name:"ShareLeaderboard",width:s,height:n,renderOptions:e})},"renderShareLeaderboard"),iy=o((a,e)=>{const{Width:t,Height:s,Wideframe:n}=e;a.wideframe={name:"share-leaderboard",type:"image",depth:0,image:n,size:[t,s],position:[0,0]}},"addWideframe$1"),ry=o(a=>{try{const{playerId:e,playerPhoto:t,leaders:s}=a,{RenderOptions:n}=na.ShareLeaderboard,i=Fd.camelCaseKeys(Fd.clone(n)),{avatar:r}=i;return r.type==="image"&&(r.name=`${e}`,r.image=t),oy(i,s),i}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions$1"),oy=o((a,e)=>{const t="600 48px";e.forEach((s,n)=>{const{id:i,name:r,photo:c,score:l}=s;let d=1294+180*n;a[`photo_${i}`]={depth:-1,name:i,type:"image",image:c,size:[96,96],position:[436,d]},d=1360+180*n,a[`name_${i}`]={font:t,depth:1,name:i,type:"text",text:r,position:[600,d]},a[`score_${i}`]={font:t,depth:1,name:i,type:"text",text:`${l}`,position:[100,d]}})},"addLeaders"),{Configs:cy,Utils:ly}=g,{Object:kd}=ly,{Enabled:dy,WideframeConfigs:aa}=cy.FrameCapture,hy=o(async a=>{if(!dy)return console.warn("FrameCapture is not enabled"),null;const e=fy(a);if(!e)return null;uy(e,aa.ShareScore);const{frameCapture:t}=window.game,{Width:s,Height:n}=aa.ShareScore;return t.captureAsync({name:"ShareScore",width:s,height:n,renderOptions:e})},"renderShareScore"),uy=o((a,e)=>{const{Width:t,Height:s,Wideframe:n}=e;a.wideframe={name:"share-score",type:"image",depth:0,image:n,size:[t,s],position:[0,0]}},"addWideframe"),fy=o(a=>{try{const{playerId:e,playerPhoto:t,playerScore:s}=a,{RenderOptions:n}=aa.ShareScore,i=kd.camelCaseKeys(kd.clone(n));console.log("renderOptions",i);const{avatar:r,playerScore:c}=i;return r.type==="image"&&(r.name=`${e}`,r.image=t),c.type==="text"&&(c.text=`${s}`),i}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},"getRenderOptions"),{Configs:py,Utils:gy}=g,{Image:Qe,Object:Ud,Valid:Je}=gy,{Options:ia}=py.FrameCapture,_r=class _r extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"width");f(this,"height");f(this,"canvas",null);f(this,"testRenderOptions",null);f(this,"caches",{});f(this,"wideframe",{})}init(){this.addWideframeRender("renderShareScore",hy),this.addWideframeRender("renderResultChallenge",Qg),this.addWideframeRender("renderShareLeaderboard",ay)}async preloadAsync(t){const{renderOptions:s}=t;await this.loadImages(s)}async captureAsync(t){const{width:s,height:n,renderOptions:i}=t;return this.width=s,this.height=n,this.createCanvas(),await this.loadImages(i),this.drawObjects(i),this.snapshotFrameAsync()}addWideframeRender(t,s){this.wideframe[t]=s}setTestRenderOptions(t){if(!t){this.testRenderOptions=null;return}const s=Ud.camelCaseKeys(t);this.testRenderOptions=Ud.merge(this.testRenderOptions,s)}createCanvas(){if(this.canvas){const t=this.canvas.getContext("2d");t?t.clearRect(0,0,this.canvas.width,this.canvas.height):this.canvas=null}this.canvas||(this.canvas=document.createElement("canvas",{is:"canvas"})),this.canvas.width=this.width,this.canvas.height=this.height}async loadImages(t){const s=Object.values(t).filter(c=>c.type==="image"),n=this.prepareLoadImages(s),i=Object.values(n);if(i.length<1)return;const r=await Promise.all(i);this.cacheImages(n,r)}prepareLoadImages(t){const s={};for(const n of t){const{name:i,image:r,fallbackImage:c}=n,l=this.caches[i];!Je.isString(r)||l||(r===""&&Je.isString(c)&&(n.image=c),console.info("prepareLoadImages",n),s[i]=new Promise(d=>{const h=Qe.loadImage(r);h.catch(()=>{Je.isString(c)?(n.image=c,Qe.loadImage(n.image).then(u=>{d(u)})):d(null)}),h.then(u=>{d(u)})}))}return s}cacheImages(t,s){for(const n in t){const i=s.shift();i&&(this.caches[n]=i)}}drawObjects(t){const s=Object.values(t).sort((n,i)=>n.depth-i.depth);for(const n of s)switch(n.type){case"text":this.drawText(n);break;case"image":this.drawImage(n);break}}drawText(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{position:n,font:i,text:r,color:c,lineWidth:l,textAlign:d}=t;s.font=`${i} ${Hg}`,s.fillStyle=c??"#ffffff",l&&(s.lineWidth=l),d&&(s.textAlign=d),console.info("drawText",t);const[h,u]=n;s.fillText(r,h,u)}drawImage(t){if(!this.canvas)return;const s=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!s)return;const{name:n,size:i,position:r,fallbackImage:c}=t;let l=this.caches[n];if(!l&&c&&(l=this.caches[c]),!l)throw new Error(`Image ${n} not found`);console.info("drawImage",t);const[d,h]=r,[u,p]=i;s.drawImage(l,d,h,u,p)}async snapshotFrameAsync(){if(!this.canvas)return null;let t=null;if(ia.UseBlobIfPossible&&"toBlob"in this.canvas?t=await this.createAsBlob():t=this.createAsDataImage(),!t)throw new Error("Image data is null");return Je.isDebugger()&&Qe.logImage(t),t}createAsDataImage(){if(!this.canvas)return null;const t=this.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!0});if(!t)return null;const{Quality:s,RenderType:n}=ia;return t.canvas.toDataURL(`image/${n}`,s)}createAsBlob(){return new Promise(t=>{if(!this.canvas){t(null);return}const{Quality:s,RenderType:n}=ia;this.canvas.toBlob(i=>{if(!i){t(null);return}Qe.blobToDataImage(i).then(r=>{t(r)})},`image/${n}`,s)})}};o(_r,"FrameCapturePlugin");let ra=_r;const Tr=class Tr extends Error{constructor(t,s){super(`Text with key "${t}" not found in locale "${s}"`);f(this,"key");f(this,"locale");this.name="MissingKeyInLocaleError",this.key=t,this.locale=s}};o(Tr,"MissingKeyInLocaleError");let Ze=Tr;const xr=class xr extends Error{constructor(t){super(`Locale not found: ${t}`);f(this,"locale");this.name="LocaleNotFoundError",this.locale=t}};o(xr,"LocaleNotFoundError");let ts=xr;const{Utils:Bd}=g,Nr=class Nr extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"locale");f(this,"data",{})}add(t,s){this.data[t]=s}choose(t){this.locale=t;const{event:s}=this.game;s.emit(g.Events.LANGUAGE_CHANGED,{locale:t})}getText(t,s,n){try{const{text:i}=this.getLocaleData(n);if(!Bd.Object.hasOwn(i,t)){const c=n??this.getCurrentLocale();throw new Ze(String(t),c)}const r=i[t];return this.replaceVariables(r,s??[])}catch(i){return i instanceof Ze?(console.warn(`Text with key "${i.key}" not found in locale "${i.locale}"`),i.key):i instanceof ts?(console.warn(`Locale "${i.locale}" not found`),String(t)):(console.error(i),String(t))}}getTexture(t){const{texture:s}=this.getLocaleData();return s[t]}getCurrentLocale(){return this.locale||"en"}getLocaleData(t){const s=t??this.getCurrentLocale();if(!Bd.Object.hasOwn(this.data,s))throw new ts(s);return this.data[s]}replaceVariables(t,s){const n=s.length;if(n==0)return t;let i=t;for(let r=0;r<n;r++){const c=s[r],l=`%{${r}}`;i=i.replace(l,c)}return i}};o(Nr,"LanguagePlugin");let oa=Nr;const yy={_id:"",name:"",createdBy:"",description:"",expireTime:7*24*60*60*1e3,type:"app_leaderboard",timezone:"utc+0",createdAt:"2024-01-01T09:00:00.000Z",sortOrder:"desc",statistics:"max",resettable:"manually",resetScore:0,numberOfLeaders:15},{Configs:my,Utils:wy}=g,{Object:es,String:Vd,Valid:Ay}=wy,{OtherHost:ss,Mockup:ns,AppId:Iy}=my,Or=class Or{constructor(){f(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await ot(async()=>{const{default:t}=await b.import("./bundle/empty-script.js");return{default:t}},void 0,b.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load LeaderboardAPIMock");this.mockAPI=new e}async getLeaderboardAsync(e,t,s){const n=Vd.params(s);let i;return ns.Leaderboards.Enabled?(await this.initMockAPI(),"playerIds"in s?i=await this.mockAPI.getPlayers(e,s):i=await this.mockAPI.getLeaders(e,s)):i=await zt(`${t}?${n}`,{},ss),!es.hasOwn(i,"data")||!Array.isArray(i.data)?[]:i.data}async getLeaderboardsAsync(e){let t;const s=g.Utils.String.params(e),n="leaderboards";return ns.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.getLeaderboardsAsync(e)):(t=await zt(`${n}?${s}`,{},ss),!es.hasOwn(t,"data")||!Array.isArray(t.data)?[]:t.data)}async setLeaderboardScoreAsync(e){const{leaderboardId:t,playerId:s,score:n}=e;ns.Leaderboards.Enabled?(await this.initMockAPI(),await this.mockAPI.setScoreAsync(t,s,n)):await G(`leaderboards/${t}/players/${s}`,{score:n},{},ss)}async createLeaderboardAsync(e){const t=e._id??Vd.generateObjectId(),s={...yy,...e,_id:t,appId:Iy},n="leaderboards";let i;if(ns.Leaderboards.Enabled?(await this.initMockAPI(),i=await this.mockAPI.createLeaderboard(s)):(i=await G(n,s,{},ss),es.hasOwn(i,"data")&&Ay.isObject(i.data)&&(i=i.data)),!es.hasOwn(i,"_id")||i._id!==t)throw new Error("Create leaderboard failed");return t}};o(Or,"LeaderboardAPI");let ca=Or;const Gd={limit:0,offset:0,leaders:{},isRequesting:!1},by={leaderboards:{}},{Valid:Ey,Json:jd,Object:Dy}=g.Utils,Mr=class Mr extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"lbAPI",new ca);f(this,"configs")}init(){const{storage:t}=this.game;t.addStorage("leaderboard",by),this.configs={}}addLeaderboard(t){const{name:s,type:n,leaderboardId:i,autoSortRank:r}=t;if(this.getLeaderboard(s)){console.warn(`Leaderboard with name ${s} already exists`);return}let l=`leaderboards/${i}/`;(n==="global"||n==="tournament")&&(l+="leaders"),n==="friends"&&(l+="players"),this.configs[s]={id:i,name:s,type:n,host:l,autoSortRank:r};const d=jd.clone(Gd);this.setLeaderboard(s,{...d})}async requestLeaderboardsAsync(t){try{return await this.lbAPI.getLeaderboardsAsync(t)}catch(s){return console.warn("requestGlobalLeaderboardsAsync",s),[]}}async requestLeaderboardAsync(t,s){try{this.validateLeaderboard(t),this.clearLeaderboard(t),this.setLeaderboard(t,{isRequesting:!0});const{id:n,type:i,host:r}=this.configs[t];let c=[];if(i==="friends"){const{player:l}=this.game,d=l.getPlayerId(),h=l.getConnectedPlayerIds(s,0),u=[d,...h];this.configs[t].playerIds=[...u],c=await this.lbAPI.getLeaderboardAsync(n,r,{playerIds:u})}else c=await this.lbAPI.getLeaderboardAsync(n,r,{limit:s,offset:0});if(c.length===0)return;await this.receiveLeaderboardAsync(t,c),this.setLeaderboard(t,{limit:s,offset:0})}finally{this.setLeaderboard(t,{isRequesting:!1})}}async loadMoreLeaderboardAsync(t,s){const n=this.getLeaderboard(t);if(n){if(this.configs[t].type==="friends"){console.warn("Cannot load more leaderboard with type friend");return}try{this.setLeaderboard(t,{isRequesting:!0});const{id:i,host:r}=this.configs[t],{offset:c,limit:l}=n,d=c+l,h=await this.lbAPI.getLeaderboardAsync(i,r,{limit:s,offset:d});if(h.length===0)return;this.receiveLeaderboardAsync(t,h),this.setLeaderboard(t,{limit:s,offset:d})}finally{this.setLeaderboard(t,{isRequesting:!1})}}}getLeaderboard(t){const{storage:s}=this.game,n=s.getStorageData("leaderboard","leaderboards");return n[t]?n[t]:null}async getLeadersByPlayerIdsAsync(t,s){try{this.validateLeaderboard(t);const{id:n}=this.configs[t],i=`leaderboards/${n}/players`,r=await this.lbAPI.getLeaderboardAsync(n,i,{playerIds:s});return r.length===0?[]:this.toLeaders(r)}catch(n){return console.warn(n),[]}}clearLeaderboard(t){try{this.validateLeaderboard(t);const s=jd.clone(Gd);this.setLeaderboard(t,null),this.setLeaderboard(t,{...s})}catch(s){console.warn(s)}}isLeaderboardEmpty(t){const s=this.getLeaderboard(t);if(!s)return!0;const{leaders:n}=s;return Object.keys(n).length===0}isExistLeaderboardId(t){const{configs:s}=this;return Object.values(s).some(n=>n.id===t)}getLeaderboardName(t){const{configs:s}=this,n=Object.values(s).find(i=>i.id===t);return n?n.name:null}async setLeaderboardScoreAsync(t,s,n){try{this.validateLeaderboard(t);const{id:i}=this.configs[t],r=await this.getLastScoreOnLeaderboard(t,s);if(r&&n<=r)return;await this.lbAPI.setLeaderboardScoreAsync({leaderboardId:i,playerId:s,score:n})}catch(i){console.warn(i)}}async getLastScoreOnLeaderboard(t,s){const n=await this.getLeadersByPlayerIdsAsync(t,[s]);return n.length===0?null:n[0].score}async createLeaderboardAsync(t){return this.lbAPI.createLeaderboardAsync(t)}validateLeaderboard(t){const s=this.getLeaderboard(t);if(!Ey.isObject(s))throw new Error(`Leaderboard with name ${t} not found`)}setLeaderboard(t,s){const{storage:n}=this.game;n.setStorageData("leaderboard","leaderboards",{[t]:s})}async receiveLeaderboardAsync(t,s){this.validateLeaderboard(t);const i=(await this.toLeaders(s)).filter(u=>u.name&&u.photo),{offset:r=0,leaders:c={}}=this.getLeaderboard(t)??{},l=i.filter(u=>!c[u.playerId]);if(r>0&&l.length>0){const u=Object.values(c);l.unshift(...u)}let d=l.sort((u,p)=>p.score-u.score);this.configs[t].autoSortRank&&(d=d.map((u,p)=>({...u,rank:p+1})));const h=Dy.keyBy(d,"playerId");this.setLeaderboard(t,{leaders:h})}async toLeaders(t){const{profile:s}=this.game,n=t.map(l=>l.playerId);await s.requestProfiles(n);const i=s.getProfiles();return t.map(l=>{const{playerId:d}=l,h=i[d];return h?{...l,name:h.name,photo:h.photo}:{...l,name:"Nameless",photo:"default"}}).map(l=>({...l,score:parseInt(l.score,10)}))}};o(Mr,"LeaderboardPlugin");let la=Mr;const Rr=class Rr{constructor(){f(this,"APIHost")}setAPIHost(e){this.APIHost=e}getAPIHost(){return this.APIHost}};o(Rr,"BaseAPI");let da=Rr;const{Utils:zd}=g,Lr=class Lr extends da{async createSingleMatchAsync(e){const s=await G("single-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getSingleMatchDetailAsync(){const t=await zt("single-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateSingleMatchMoveAsync(e,t){const s=`single-matches/${e}/move`,n=await G(s,t,{},this.getAPIHost());return this.returnValidMatchData(n)}async finishSingleMatchAsync(e){const t=`single-matches/${e}/finish`,s=await G(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createEndlessMatchAsync(e){const s=await G("endless-matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async getEndlessMatchDetailAsync(){const t=await zt("endless-matches/active",{},this.getAPIHost());return this.returnValidMatchData(t)}async updateEndlessMatchMilestoneAsync(e,t){const s=`endless-matches/${e}/milestone`,n=await G(s,t,{},this.getAPIHost());return this.returnValidMatchData(n)}async finishEndlessMatchAsync(e){const t=`endless-matches/${e}/finish`,s=await G(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async createMatchAsync(e){const s=await G("matches",e,{},this.getAPIHost());return this.returnValidMatchData(s)}async joinMatchAsync(e){const t=`matches/${e}/join`,s=await G(t,{},{},this.getAPIHost());return this.returnValidMatchData(s)}async getMatchDetailByIdAsync(e){const t=`matches/${e}`,s=await zt(t,{},this.getAPIHost());return this.returnValidMatchData(s)}async finishMatchAsync(e){const{matchId:t="",score:s=0,level:n=0,extraData:i={}}=e,r=`matches/${t}/finish`,c=await G(r,{matchId:t,score:s,level:n,extraData:i},{},this.getAPIHost());return this.returnValidMatchData(c)}returnValidMatchData(e){let t={};return!zd.Valid.isObject(e)||!zd.Object.hasOwn(e,"data")||(t=e.data),t}};o(Lr,"MatchAPI");let ha=Lr;const $r=class $r{constructor(e){f(this,"matchAPI");this.createAPI(),this.setAPIConfig(e)}createAPI(){this.matchAPI=new ha}setAPIConfig(e){e.matchAPIHost&&this.matchAPI.setAPIHost(e.matchAPIHost)}setMatchAPIInstance(e){this.matchAPI=e}getMatchAPI(){return this.matchAPI}};o($r,"APIHandler");let ua=$r;const Fr=class Fr{constructor(e,t){f(this,"game");f(this,"match");this.game=e,this.match=t}startLog(e){this.match.useCPUProfile&&console.profile(this.constructor.name),console.group(`🚀 ${this.constructor.name}`),e&&console.log("📦 ? Payload:",e)}endLog(){console.groupEnd(),this.match.useCPUProfile&&console.profileEnd()}async processAsync(e){throw new Error("Not implemented")}};o(Fr,"BaseConcrete");let S=Fr;const kr=class kr extends st{constructor(e){super(e),this.name="LevelNotDefined",this.message=e??"Level is not defined"}};o(kr,"LevelNotDefined");let as=kr;const Ur=class Ur extends st{constructor(e){super(e),this.name="MatchModeNotDefined",this.message=e??"Match id is not defined"}};o(Ur,"MatchModeNotDefined");let Ee=Ur;const{Object:fa,Valid:vy}=g.Utils;let I=(le=class{constructor(e){f(this,"game");f(this,"match");f(this,"nextHandler");this.game=e.game,this.match=e.match,this.nextHandler=null}setNext(e){return this.nextHandler=e,e}async processAsync(e){console.groupCollapsed(`➡️ ${this.constructor.name}`),this.logData("Before",e)}async nextAsync(e){this.logData("After",e),console.groupEnd(),this.nextHandler&&await this.nextHandler.processAsync(e)}logData(e,t){if(!vy.isDebugger())return;console.groupCollapsed(`📦 MatchState: ${e}`);const{profiles:s,customData:n,...i}=t;console.info("💾 Base"),console.table(fa.clone(i)),console.info("💾 Profile"),console.table(fa.clone(s)),console.info("💾 Custom"),console.table(fa.clone(n)),console.groupEnd()}},o(le,"BaseHandler"),le);const{Plugins:Sy,Utils:Py}=g,{Analytics:Cy}=Sy,{String:_y,Valid:Kd}=Py,Br=class Br extends I{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e,{level:n}=s;this.validateMode(t),this.validateLevel(n);const{analytics:i}=this.game;i.event(Cy.Events.MATCH_START,{level:n,game_mode:_y.toUpperCamelCase(t),level_name:`level_${n}`}),await this.nextAsync(e)}validateMode(e){if(!Kd.isString(e))throw new Ee}validateLevel(e){if(!Kd.isNumber(e))throw new as}};o(Br,"LogMatchStartHandler");let W=Br;const H={OPEN:"open",ACTIVE:"active",FINISHED:"finished"},Vr=class Vr extends I{async processAsync(e){super.processAsync(e);const{mode:t,status:s}=e;let n=t??Pt.SINGLE;s===H.FINISHED&&(n=Pt.SINGLE),this.contextGameModeDetected(n),await this.nextAsync(e)}contextGameModeDetected(e){const{storage:t}=this.game;t.setStorageData("context","contextGameMode",e)}};o(Vr,"ContextGameModeHandler");let N=Vr;const Gr=class Gr extends Error{constructor(e){super(e),this.name="GetMatchDetailFailed",this.message=e??"Get match detail failed"}};o(Gr,"GetMatchDetailFailed");let De=Gr;const jr=class jr extends Error{constructor(e){super(e),this.name="MatchAreNotActive",this.message=e??"Match are not active"}};o(jr,"MatchAreNotActive");let is=jr;const zr=class zr extends st{constructor(e){super(e),this.name="MatchIdNotValid",this.message=e??"Match id is not valid"}};o(zr,"MatchIdNotValid");let at=zr;const Kr=class Kr extends Error{constructor(e){super(e),this.name="OpponentHasFinishedMatch",this.message=e||"Opponent has finished match"}};o(Kr,"OpponentHasFinishedMatch");let pa=Kr;const Wr=class Wr extends st{constructor(e){super(e),this.name="OpponentIdNotValid",this.message=e??"Opponent id is not valid"}};o(Wr,"OpponentIdNotValid");let U=Wr;const Hr=class Hr extends Error{constructor(e){super(e),this.name="PlayerNotCurrentInMatch",this.message=e??"The player is not currently in this match"}};o(Hr,"PlayerNotCurrentInMatch");let ve=Hr;const qr=class qr extends Error{constructor(e){super(e),this.name="PlayerNotFinishedMatch",this.message=e||"Player not finished match"}};o(qr,"PlayerNotFinishedMatch");let rs=qr;const{Dtos:Ty}=g,Yr=class Yr extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Ty.Match.Data(t).toObject();this.validateAwaitMatchData(e,s),this.updateMatchData(e,s),this.validateMatchStatus(e),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new at}validateMatchStatus(e){const{status:t}=e;if(t!==H.ACTIVE)throw new is}validateAwaitMatchData(e,t){const{id:s,customData:n}=e,{_id:i,whitePlayerId:r,blackPlayerId:c}=t;if(typeof i!="string"||i!==s)throw new De;const{playerId:l}=n,d=r===l,h=c===l;if(!d&&c===dt.playerId)throw new me;if(!d&&!h)throw new ve}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(typeof n!="string")throw new D;const{finished:i}=t[n];if(!i)throw new rs}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:n}=s;if(typeof n!="string")throw new U;const{finished:i}=t[n];if(i)throw new pa}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d,status:h}=t;e.status=h;const u=n===s.playerId,p=u?n:i,y=u?i:n;e.customData.playerId=p,e.customData.opponentId=y,e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1}),e.profiles[y]||(e.profiles[y]={id:y,name:"",photo:"",finished:!1});const w=u?r:c,A=u?c:r;e.profiles[p].score=w,e.profiles[y].score=A;const m=u?l:d,v=u?d:l;e.profiles[p].finished=m,e.profiles[y].finished=v}};o(Yr,"AwaitMatchHandler");let ga=Yr;const ya={level:1,rescued:0,contextId:null,playerId:null,opponentId:null,tournamentId:null,leaderboardId:null},Xr=class Xr extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.initializeMatch(t),await this.nextAsync(t)}initializeMatch(t){const{id:s,mode:n,customData:i}=this.payload;t.id=s??null,t.mode=n||null,t.status=H.OPEN,t.startAt=0,t.finishAt=0,t.profiles={},t.customData={...ya,...t.customData,...i}}};o(Xr,"PrepareMatchHandler");let B=Xr;const Lt=ye,Qr=class Qr extends Error{constructor(e){super(e),this.name="UnavailableFeature",this.message=`Unavailable feature: ${e}`}};o(Qr,"UnavailableFeature");let P=Qr;const Jr=class Jr extends st{constructor(e){super(e),this.name="ContextIdNotValid",this.message=e??"Context id is not valid"}};o(Jr,"ContextIdNotValid");let tt=Jr;const Zr=class Zr extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAwaitingAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new tt;if(!i||typeof i!="string")throw new U}async createWideframesAwaitingAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0,finished:u}=c;if(!u)return null;const{photo:p,score:y=0,finished:w}=l;return w?null:await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:p,opponentScore:y,isPlayerFinished:!0,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesAwaitingAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:l}=n[r],d={data:{type:Lt.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${l} is waiting for you to finish this game. Play now!`,localizations:{vi_VN:`${l} đang chờ bạn kết thúc trận đấu. Chơi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(d)}};o(Zr,"SendAwaitingMessageHandler");let ma=Zr;const to=class to extends I{async processAsync(e){await this.nextAsync(e)}async nextAsync(e){this.nextHandler&&await this.nextHandler.processAsync(e)}};o(to,"NothingHandler");let _=to;const eo=class eo extends st{constructor(e){super(e),this.name="ProfileNotFound",this.message=e??"Profile not found"}};o(eo,"ProfileNotFound");let q=eo;const{Dtos:xy}=g,so=class so extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const{customData:t}=e,{playerId:s,opponentId:n}=t;let i=s;const r=await this.getProfile(i);if(!r)throw new q;if(this.updateMatchProfile(e,i,r),i=n,i!==dt.playerId){const c=await this.getProfile(i);if(!c)throw new q;this.updateMatchProfile(e,i,c)}else this.updateMatchProfile(e,i);await this.nextAsync(e)}validateData(e){const{customData:t}=e,{playerId:s,opponentId:n}=t;if(!s||typeof s!="string")throw new D;if(!n||typeof n!="string")throw new U}async getProfile(e){const{profile:t}=this.game;return await t.requestProfiles([e]),t.getProfiles()[e]}updateMatchProfile(e,t,s){const{name:n,photo:i}=s??dt,r=new xy.Match.Profile({id:t,name:n,photo:i}).toObject();e.profiles[t]?(e.profiles[t].name=r.name,e.profiles[t].photo=r.photo):e.profiles[t]=r}};o(so,"GetMatchProfilesHandler");let pt=so;const no=class no extends S{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:n}=e,i=new _(this),r=new B(this,{id:t,mode:V.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:n}});i.setNext(r);const c=new ga(this);r.setNext(c);const l=new pt(this);c.setNext(l);const d=new ma(this);l.setNext(d);const h=new W(this);d.setNext(h);const u=new N(this);h.setNext(u);const p=this.match.getMatchState();await i.processAsync(p)}finally{this.endLog()}}};o(no,"AwaitChallengeMatchConcrete");let wa=no;const ao=class ao extends st{constructor(e){super(e),this.name="CreateContextFailed",this.message=e??"Create context failed"}};o(ao,"CreateContextFailed");let Se=ao;const{Valid:Wd,Object:Hd}=g.Utils,io=class io extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{opponentId:s}=this.payload,n=await this.createAsync(s);t.customData.contextId=n,await this.nextAsync(t)}async createAsync(t){try{await GameSDK.context.createAsync(t)}catch(n){this.validateError(n)}const s=GameSDK.context.getID();if(!Wd.isString(s))throw new Se;return s}validateError(t){if(!Hd.hasOwn(t,"code"))throw t;if(t.code!=="SAME_CONTEXT"){if(t.code==="INVALID_PARAM"){if(!this.isNotConnectedPlayerError(t))throw t;return}throw t}}validateErrorMessage(t){if(!Hd.hasOwn(t,"message")||!Wd.isString(t.message))throw t}isNotConnectedPlayerError(t){return this.validateErrorMessage(t),t.message.includes("is not a connected player of the current player")}};o(io,"CreateContextHandler");let Aa=io;const ro=class ro extends st{constructor(e){super(e),this.name="MatchAreNotOpen",this.message=e??"Match are not open"}};o(ro,"MatchAreNotOpen");let qt=ro;const{Dtos:Ny}=g,oo=class oo extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t);const s=await this.createMatchAsync(t),n=new Ny.Match.Data(s).toObject();this.updateMatchState(t,n),await this.nextAsync(t)}validateData(t){const{status:s,customData:n}=t,{opponentId:i}=n;if(typeof i!="string")throw new U;if(s!==H.OPEN)throw new qt}async createMatchAsync(t){const{opponentId:s}=t.customData,{extraData:n}=this.payload;if(!s)return{};const i={opponentPlayerId:s,extraData:n};return this.match.api.getMatchAPI().createMatchAsync(i)}updateMatchState(t,s){const{customData:n}=t,{_id:i,whitePlayerId:r,blackPlayerId:c,whitePlayerFinish:l,blackPlayerFinish:d}=s,h=r===n.opponentId;t.id=i||null;const u=h?c:r,p=h?r:c;t.customData.playerId=u,t.customData.opponentId=p,t.profiles[u]||(t.profiles[u]={id:u,name:"",photo:"",finished:!1}),t.profiles[p]||(t.profiles[p]={id:p,name:"",photo:"",finished:!1});const y=h?d:l,w=h?l:d;t.profiles[u].finished=y,t.profiles[p].finished=w}};o(oo,"CreateMatchHandler");let os=oo;const co=class co extends I{async processAsync(e){if(super.processAsync(e),e.status!==H.OPEN)throw new qt;this.startMatch(e),await this.nextAsync(e)}startMatch(e){e.status=H.ACTIVE,e.startAt=Date.now()}};o(co,"StartMatchHandler");let et=co;const lo=class lo extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesChallengeAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new tt;if(!i||typeof i!="string")throw new U}async createWideframesChallengeAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0}=c,{photo:u,score:p=0}=l;return await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:u,opponentScore:p,isPlayerFinished:!1,isOpponentFinished:!1})}catch(t){return console.warn("createWideframesChallengeAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:l}=n[r],d={data:{type:Lt.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${l} challenges you`,localizations:{vi_VN:`${l} thử thách bạn trong trận đấu này. Chơi ngay!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};await GameSDK.extra.updateAsync(d)}};o(lo,"SendChallengeMessageHandler");let cs=lo;const ho=class ho extends S{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s}=e,n=new _(this),i=new Aa(this,{opponentId:s});n.setNext(i);const r=new B(this,{mode:V.CHALLENGE_FRIEND,customData:{playerId:t,opponentId:s}});i.setNext(r);const c=new os(this,{extraData:e.extraData});r.setNext(c);const l=new pt(this);c.setNext(l);const d=new et(this);l.setNext(d);const h=new W(this);d.setNext(h);const u=new cs(this);h.setNext(u);const p=new N(this);u.setNext(p);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};o(ho,"ChallengeFriendConcrete");let Ia=ho;const uo=class uo extends Error{constructor(e){super(e),this.name="SameContext",this.message=e??"Same context"}};o(uo,"SameContext");let Pe=uo;const{Utils:qd}=g,fo=class fo extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;await this.switchAsync(s),t.customData.contextId=s,await this.nextAsync(t)}checkSameContext(t){const s=t==="SOLO",n=GameSDK.context.getID();if(n===t)throw new Pe;if(s&&n===null)throw new Pe}async switchAsync(t){const s=t==="SOLO";try{this.checkSameContext(t),await GameSDK.context.switchAsync(t,s)}catch(n){if(n instanceof Pe)return;if(!qd.Object.hasOwn(n,"code"))throw n;if(qd.Device.isAndroid()&&s&&n.code==="INVALID_PARAM")return;if(n.code!=="SAME_CONTEXT")throw n}}};o(fo,"SwitchContextHandler");let Yt=fo;const{Dtos:Oy}=g,po=class po extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Oy.Match.Data(t).toObject();this.validateContinueMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t,status:s}=e;if(typeof t!="string")throw new at;if(s!==H.OPEN)throw new qt}validateContinueMatchData(e,t){const{id:s,customData:n}=e,{_id:i,whitePlayerId:r,blackPlayerId:c}=t;if(typeof i!="string"||i!==s)throw console.warn("🤖 ? respMatchDataValidated",t),new De;const{playerId:l}=n,d=r===l,h=c===l;if(!d&&c===dt.playerId)throw new me;if(!d&&!h)throw new ve}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(typeof n!="string")throw new D;const{finished:i}=t[n];if(i)throw new Fe}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=n===s.playerId,u=h?n:i,p=h?i:n;e.customData.playerId=u,e.customData.opponentId=p,e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!1}),e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1});const y=h?r:c,w=h?c:r;e.profiles[u].score=y,e.profiles[p].score=w;const A=h?l:d,m=h?d:l;e.profiles[u].finished=A,e.profiles[p].finished=m}};o(po,"ContinueMatchHandler");let ba=po;const go=class go extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesCurrentScoreAsync();t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new tt;if(!i||typeof i!="string")throw new U}async createWideframesCurrentScoreAsync(){try{const{player:e,frameCapture:t}=this.game,{playerId:s,photo:n}=e.getPlayer(),{profiles:i}=this.match.getMatchState(),{score:r=0}=i[s]||{};return await t.wideframe.renderShareScore({playerId:s,playerPhoto:n,playerScore:r})}catch(e){return console.warn("createWideframesCurrentScoreAsync",e),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:l}=n[r],d={data:{type:Lt.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${l} made an update.`,localizations:{vi_VN:`${l} đã cập nhật trận đấu. Chơi ngay!`}},image:t,strategy:"LAST",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(d)}};o(go,"SendUpdateMessageHandler");let Ea=go;const yo=class yo extends S{async processAsync(e){try{this.startLog(e);const{contextId:t,matchId:s,playerId:n,opponentId:i}=e,r=new _(this),c=new Yt(this,{contextId:t});r.setNext(c);const l=new B(this,{id:s,mode:V.CHALLENGE_FRIEND,customData:{playerId:n,opponentId:i}});c.setNext(l);const d=new ba(this);l.setNext(d);const h=new pt(this);d.setNext(h);const u=new et(this);h.setNext(u);const p=new Ea(this);u.setNext(p);const y=new W(this);p.setNext(y);const w=new N(this);y.setNext(w);const A=this.match.getMatchState();await r.processAsync(A)}finally{this.endLog()}}};o(yo,"ContinueChallengeMatchConcrete");let Da=yo;const{Plugins:My,Utils:Ry}=g,{Analytics:Ly}=My,{String:$y,Valid:Yd}=Ry,mo=class mo extends I{async processAsync(e){super.processAsync(e);const{customData:t,mode:s,startAt:n,finishAt:i}=e,{level:r}=t;this.validateMode(s),this.validateLevel(r);const{analytics:c}=this.game,l=Math.floor((i-n)/1e3);c.event(Ly.Events.MATCH_END,{level:r,game_mode:$y.toUpperCamelCase(s),level_name:`level_${r}`,time_played:l}),await this.nextAsync(e)}validateMode(e){if(!Yd.isString(e))throw new Ee}validateLevel(e){if(!Yd.isNumber(e))throw new as}};o(mo,"LogMatchFinishedHandler");let $t=mo;const wo=class wo extends Error{constructor(e){super(e),this.name="ScoreNotValid",this.message=e??"Score is not valid"}};o(wo,"ScoreNotValid");let Xt=wo;const Ao=class Ao extends Error{constructor(e){super(e),this.name="LeaderboardIdNotValid",this.message=e??"Leaderboard id is not valid"}};o(Ao,"LeaderboardIdNotValid");let Ft=Ao;const Io=class Io extends Error{constructor(e){super(e),this.name="LeaderboardNotExist",this.message=e??"Leaderboard not exist in game"}};o(Io,"LeaderboardNotExist");let va=Io;const{Valid:Xd}=g.Utils,bo=class bo extends I{constructor(t,s){super(t);f(this,"payload");f(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.setupSetScorePayload(t),this.setLeaderboardScoreAsync(),await this.nextAsync(t)}async setupSetScorePayload(t){const{profiles:s,customData:n}=t,{playerId:i}=n;if(!i||!s[i])throw new q;const{score:r,leaderboardId:c}=this.payload;if(!Xd.isNumber(r))throw new Xt;if(!Xd.isString(c))throw new Ft;this.leaderboardPayload={score:r,playerId:i,leaderboardId:c}}async setLeaderboardScoreAsync(){try{const{playerId:t,score:s,leaderboardId:n}=this.leaderboardPayload,i=this.game.leaderboard.getLeaderboardName(n);if(!i)throw new va;await this.game.leaderboard.setLeaderboardScoreAsync(i,t,s)}catch(t){console.warn("setLeaderboardScoreAsync",t)}}};o(bo,"SetLeaderboardScoreHandler");let Qt=bo;const{Valid:Fy}=g.Utils,{Leaderboards:ky}=g.Configs,Eo=class Eo extends Qt{constructor(e){super(e,{score:0,leaderboardId:ky.LeaderboardId})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new q;const{score:i}=t[n];if(!Fy.isNumber(i))throw new Xt;this.payload.score=i,super.setupSetScorePayload(e)}};o(Eo,"PostGlobalLeaderboardScoreHandler");let Ce=Eo;const{Dtos:Uy,Utils:By}=g,{Valid:ls,Object:Vy}=By,Do=class Do extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateMatchData(t);const{useAPI:s}=this.payload;if(s){const n=await this.finishMatchAsync(t),i=new Uy.Match.Data(n).toObject();this.updateMatchFromAPI(t,i)}else this.updateMatchData(t);this.updateMatchState(t),await this.nextAsync(t)}validateMatchData(t){const{status:s,profiles:n,customData:i}=t;if(s!==H.ACTIVE)throw new is;const{playerId:r}=i;if(!r||!Vy.hasOwn(n,r))throw new ve}updateMatchData(t){const{playerId:s}=t.customData;if(!ls.isString(s))throw new D;t.profiles[s].finished=!0}updateMatchState(t){t.status=H.FINISHED,t.finishAt=Date.now()}async finishMatchAsync(t){const{id:s,profiles:n,customData:i}=t,{level:r,playerId:c}=i;if(!ls.isString(c))throw new D;const{score:l}=n[c],{extraData:d}=this.payload,h={matchId:s??"",score:l,level:r,extraData:d};return this.match.api.getMatchAPI().finishMatchAsync(h)}updateMatchFromAPI(t,s){const{playerId:n,opponentId:i}=t.customData;if(!ls.isString(n))throw new D;if(!ls.isString(i))throw new U;const{whitePlayerId:r,whitePlayerScore:c,blackPlayerScore:l,whitePlayerFinish:d,blackPlayerFinish:h}=s,u=n===r,p=u?c:l,y=u?l:c,w=u?d:h,A=u?h:d;t.profiles[n].score=p,t.profiles[i].score=y,t.profiles[n].finished=w,t.profiles[i].finished=A}};o(Do,"FinishMatchHandler");let kt=Do;const vo=class vo extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesResultAsync(e);t&&this.progressSendFinishedMessage(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new tt;if(!i||typeof i!="string")throw new U}async createWideframesResultAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0,finished:u}=c,{photo:p,score:y=0,finished:w}=l;return await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:p,opponentScore:y,isPlayerFinished:!!u,isOpponentFinished:!!w})}catch(t){return console.warn("createWideframesResultAsync",t),null}}progressSendFinishedMessage(e,t){const{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||typeof i!="string")throw new D;if(!r||typeof r!="string")throw new U;const{score:c=0,finished:l}=s[i],{score:d=0,finished:h}=s[r];l?this.sendFinishMessageAsync(e,t):h&&c>d?this.sendBestScoreMessageAsync(e,t):this.sendPlayTurnMessageAsync(e,t)}async sendFinishMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:l}=n[r],d={data:{type:Lt.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c,status:H.FINISHED},action:"CUSTOM",template:"finished",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:`${l} just finished. Check them now.`,localizations:{vi_VN:`${l} vừa hoàn thành màn chơi. Nhấn để xem kết quả trận đấu.`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(d)}async sendPlayTurnMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;const{name:l,score:d}=n[r],h={data:{type:Lt.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c,status:H.ACTIVE},action:"CUSTOM",template:"finished",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${l} got ${d} scores. So easy! Can you?`,localizations:{vi_VN:`${l} đã đạt ${d} điểm! Nhấn Chơi để so tài!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(h)}async sendBestScoreMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;const{name:l,score:d}=n[r],h={data:{type:Lt.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c,status:H.FINISHED},action:"CUSTOM",template:"pass_score",cta:{default:"See result",localizations:{vi_VN:"Xem kết quả"}},text:{default:`${l} beat your high score. Their score: ${d}`,localizations:{vi_VN:`${l} đã vượt qua điểm số của bạn, với ${d} điểm!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(h)}};o(vo,"SendFinishedMessageHandler");let Sa=vo;const So=class So extends I{async processAsync(e){super.processAsync(e),this.setPlayerBestScore(e),await this.nextAsync(e)}setPlayerBestScore(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new q;const{player:i}=this.game,r=i.getBestScore()||0,{score:c=0}=t[n];c<=r||(i.setBestScore(c),t[n].bestScore=c)}};o(So,"SetPlayerBestScoreHandler");let Jt=So;const Po=class Po extends S{async processAsync(e){try{this.startLog(e);const{extraData:t}=e??{},s=new _(this),n=new kt(this,{useAPI:!0,extraData:t});s.setNext(n);const i=new Sa(this);n.setNext(i);const r=new $t(this);i.setNext(r);const c=new Jt(this);r.setNext(c);const l=new Ce(this);c.setNext(l);const d=new N(this);l.setNext(d);const h=this.match.getMatchState();await s.processAsync(h)}finally{this.endLog()}}};o(Po,"FinishChallengeMatchConcrete");let Pa=Po;const Co=class Co extends Error{constructor(e){super(e),this.name="ContextAreSolo",this.message=e??"Context are solo"}};o(Co,"ContextAreSolo");let Ca=Co;const _o=class _o extends Error{constructor(e){super(e),this.name="OpponentNotJoinInContext",this.message=e??"Opponent is not join in context"}};o(_o,"OpponentNotJoinInContext");let _a=_o;const To=class To extends Error{constructor(e){super(e),this.name="NetworkFailure",this.message=e??"Network failure"}};o(To,"NetworkFailure");let Ta=To;const{Utils:Gy,Dtos:jy}=g,{Array:zy,Object:Ky}=Gy,xo=class xo extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.checkCurrentContext();const s=await this.getOpponentIdFromContextAsync();t.customData.opponentId=s,await this.nextAsync(t)}checkCurrentContext(){const t=GameSDK.context.getID();if(typeof t!="string")throw new tt;if(t==="SOLO")throw new Ca}async getOpponentIdFromContextAsync(){const{ignoreId:t}=this.payload,s=await this.getContextPlayers([t]);if(s.length>1)throw new _a;let n=dt;return s.length===1&&(n=s[0]),n.playerId}async getContextPlayers(t){try{const s=await GameSDK.context.getPlayersAsync(),n=[];return s.forEach(i=>{const r=i.getID();if(t.includes(r))return;const c=i.getName();if(!c)return;const l=i.getPhoto();n.push(new jy.Player.Info({playerId:r,name:c,photo:l}).toObject())}),zy.unique(n)}catch(s){if(Ky.hasOwn(s,"code")&&s.code==="NETWORK_FAILURE")throw new Ta;return[]}}};o(xo,"GetOpponentChallengeContextHandler");let xa=xo;const No=class No extends Error{constructor(e){super(e),this.name="ContextIsTournament",this.message=e??"Context is a tournament"}};o(No,"ContextIsTournament");let _e=No;const{Object:Wy}=g.Utils,Oo=class Oo extends I{async processAsync(e){super.processAsync(e);const t=await this.chooseAsync();await this.checkContextTournament(),e.customData.contextId=t,await this.nextAsync(e)}async chooseAsync(){try{await GameSDK.context.chooseAsync({filters:["INCLUDE_EXISTING_CHALLENGES"],minSize:2,maxSize:2})}catch(t){if(!Wy.hasOwn(t,"code")||t.code!=="SAME_CONTEXT")throw t}const e=GameSDK.context.getID();if(typeof e!="string")throw new Se;return e}async checkContextTournament(){try{if(!GameSDK.context.getID())return;throw"getTournamentAsync"in GameSDK?(await GameSDK.getTournamentAsync(),new _e):new P("getTournamentAsync")}catch(e){if(e instanceof _e)throw e}}};o(Oo,"ChooseContextHandler");let Na=Oo;const Mo=class Mo extends S{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new _(this),n=new Na(this);s.setNext(n);const i=new B(this,{mode:V.CHALLENGE_FRIEND,customData:{playerId:t}});n.setNext(i);const r=new xa(this,{ignoreId:t});i.setNext(r);const c=new os(this,{extraData:e.extraData});r.setNext(c);const l=new pt(this);c.setNext(l);const d=new et(this);l.setNext(d);const h=new W(this);d.setNext(h);const u=new cs(this);h.setNext(u);const p=new N(this);u.setNext(p);const y=this.match.getMatchState();await s.processAsync(y)}finally{this.endLog()}}};o(Mo,"InviteFriendsConcrete");let Oa=Mo;const Ro=class Ro extends Error{constructor(e){super(e),this.name="JoinMatchFailed",this.message=e??"Join match failed"}};o(Ro,"JoinMatchFailed");let Ma=Ro;const Lo=class Lo extends Error{constructor(e){super(e),this.name="MatchAreFinished",this.message=e??"Match are finished"}};o(Lo,"MatchAreFinished");let Ra=Lo;const $o=class $o extends Error{constructor(e){super(e),this.name="OtherPlayerHasJoinedMatch",this.message=e??"Other player has joined match"}};o($o,"OtherPlayerHasJoinedMatch");let La=$o;const{Dtos:Hy}=g,Fo=class Fo extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.joinMatchAsync(e),s=new Hy.Match.Data(t).toObject();this.validateJoinMatchData(e,s),this.updateMatchData(e,s),await this.nextAsync(e)}validateMatchData(e){const{status:t}=e;if(t!==H.OPEN)throw new qt}validateJoinMatchData(e,t){const{id:s,customData:n}=e,{_id:i,blackPlayerId:r,whitePlayerId:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=r===n.playerId,u=c===n.opponentId;if(typeof i!="string"||i!==s||!u)throw console.warn("🤖 ? matchData",t),new Ma;if(l&&d)throw new Ra;if(!h)throw new La}async joinMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().joinMatchAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=n===s.playerId,u=h?n:i,p=h?i:n;e.customData.playerId=u,e.customData.opponentId=p,e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!1}),e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!1});const y=h?r:c,w=h?c:r;e.profiles[u].score=y,e.profiles[p].score=w;const A=h?l:d,m=h?d:l;e.profiles[u].finished=A,e.profiles[p].finished=m}};o(Fo,"JoinMatchHandler");let $a=Fo;const ko=class ko extends I{async processAsync(e){super.processAsync(e),this.validateData(e);const t=await this.createWideframesAcceptedAsync(e);t&&this.sendMessageAsync(e,t),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new tt;if(!i||typeof i!="string")throw new U}async createWideframesAcceptedAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0,finished:u}=c;if(u)return null;const{photo:p,score:y=0,finished:w}=l;return w?await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:p,opponentScore:y,isPlayerFinished:!1,isOpponentFinished:!0}):null}catch(t){return console.warn("createWideframesAcceptedAsync",t),null}}async sendMessageAsync(e,t){const{id:s,profiles:n,customData:i}=e,{playerId:r,opponentId:c}=i;if(!r||typeof r!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:l}=n[r],d={data:{type:Lt.CHALLENGE_FRIEND,matchId:s,playerId:r,opponentId:c},action:"CUSTOM",template:"challenge",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${l} accepted the challenge.`,localizations:{vi_VN:`${l} đã chấp nhận tham gia trận đấu.`}},image:t,strategy:"LAST",notification:"PUSH"};await GameSDK.extra.updateAsync(d)}};o(ko,"SendAcceptedMessageHandler");let Fa=ko;const Uo=class Uo extends S{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:n}=e,i=new _(this),r=new B(this,{id:t,mode:V.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:n}});i.setNext(r);const c=new $a(this);r.setNext(c);const l=new pt(this);c.setNext(l);const d=new et(this);l.setNext(d);const h=new Fa(this);d.setNext(h);const u=new W(this);h.setNext(u);const p=new N(this);u.setNext(p);const y=this.match.getMatchState();await i.processAsync(y)}finally{this.endLog()}}};o(Uo,"JoinChallengeMatchConcrete");let ka=Uo;const Qd={_id:"",status:"",winnerId:"",whitePlayerId:"",blackPlayerId:"",whitePlayerScore:0,blackPlayerScore:0,whitePlayerFinish:!1,blackPlayerFinish:!1},{Valid:gt}=g.Utils,yt="is invalid",Bo=class Bo extends R{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!gt.isString(e)||!e)&&this.exception("_id",yt)}validateStatus(e){(!gt.isString(e)||!e)&&this.exception("status",yt)}validateWinnerId(e){e!==null&&(!gt.isString(e)||!e)&&this.exception("winnerId",yt)}validateWhitePlayerId(e){(!gt.isString(e)||!e)&&this.exception("whitePlayerId",yt)}validateBlackPlayerId(e){(!gt.isString(e)||!e)&&this.exception("blackPlayerId",yt)}validateWhitePlayerScore(e){gt.isNumber(e)||this.exception("whitePlayerScore",yt)}validateBlackPlayerScore(e){gt.isNumber(e)||this.exception("blackPlayerScore",yt)}validateWhitePlayerFinish(e){gt.isBoolean(e)||this.exception("whitePlayerFinish",yt)}validateBlackPlayerFinish(e){gt.isBoolean(e)||this.exception("blackPlayerFinish",yt)}toObject(){return super.toObject()}static getDefaultData(){return Qd}};o(Bo,"RespMatchDataDtos");let Te=Bo;Te.addDefaultData(Qd);const Vo=class Vo extends Error{constructor(e){super(e),this.name="MatchAreNotFinished",this.message=e||"Match are not finished"}};o(Vo,"MatchAreNotFinished");let Ua=Vo;const Go=class Go extends Error{constructor(e){super(e),this.name="OpponentNotFinishedMatch",this.message=e||"Opponent not finished match"}};o(Go,"OpponentNotFinishedMatch");let Ba=Go;const jo=class jo extends I{async processAsync(e){super.processAsync(e),this.validateMatchData(e);const t=await this.getMatchAsync(e),s=new Te(t).toObject();this.validateResultMatchData(e,s),this.updateMatchData(e,s),this.validatePlayerTurn(e),this.validateOpponentTurn(e),await this.nextAsync(e)}validateMatchData(e){const{id:t}=e;if(typeof t!="string")throw new at}validateResultMatchData(e,t){const{id:s}=e,{_id:n,whitePlayerFinish:i,blackPlayerFinish:r}=t;if(typeof n!="string"||n!==s)throw new De;if(!i&&!r)throw new Ua}validatePlayerTurn(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(typeof n!="string")throw new D;const{finished:i}=t[n];if(!i)throw new rs}validateOpponentTurn(e){const{profiles:t,customData:s}=e,{opponentId:n}=s;if(typeof n!="string")throw new U;const{finished:i}=t[n];if(!i)throw new Ba}async getMatchAsync(e){const{id:t}=e;return t?this.match.api.getMatchAPI().getMatchDetailByIdAsync(t):{}}updateMatchData(e,t){const{customData:s}=e,{whitePlayerId:n,blackPlayerId:i,whitePlayerScore:r,blackPlayerScore:c,whitePlayerFinish:l,blackPlayerFinish:d}=t,h=n===s.playerId,u=h?n:i,p=h?i:n;e.customData.playerId=u,e.customData.opponentId=p,e.profiles[u]||(e.profiles[u]={id:u,name:"",photo:"",finished:!0}),e.profiles[p]||(e.profiles[p]={id:p,name:"",photo:"",finished:!0});const y=h?r:c,w=h?c:r;e.profiles[u].score=y,e.profiles[p].score=w;const A=h?l:d,m=h?d:l;e.profiles[u].finished=A,e.profiles[p].finished=m}};o(jo,"ResultMatchHandler");let Va=jo;const zo=class zo extends S{async processAsync(e){try{this.startLog(e);const{matchId:t,playerId:s,opponentId:n}=e,i=new _(this),r=new B(this,{id:t,mode:V.CHALLENGE_FRIEND,customData:{playerId:s,opponentId:n}});i.setNext(r);const c=new Va(this);r.setNext(c);const l=new pt(this);c.setNext(l);const d=new N(this);l.setNext(d);const h=this.match.getMatchState();await i.processAsync(h)}finally{this.endLog()}}};o(zo,"ResultChallengeMatchConcrete");let Ga=zo;const Ko=class Ko extends S{constructor(){super(...arguments);f(this,"fallbackSingleMode");f(this,"startFLowChallengeFriend",o(async t=>{try{return await this.match.challenge.invite.processAsync(t),!0}catch(s){return s}},"startFLowChallengeFriend"));f(this,"startFlowTournament",o(async t=>{try{const s=GameSDK.context.getID();if(typeof s!="string")throw new tt;await this.match.tournament.continue.processAsync({playerId:t,contextId:s})}catch{await this.startFlowSingle(t)}},"startFlowTournament"));f(this,"startFlowSingle",o(async t=>{if(!this.fallbackSingleMode)throw new Error("Fallback single mode is not enabled");await this.match.single.start.processAsync({playerId:t})},"startFlowSingle"))}async processAsync(t){try{this.startLog(t);const{playerId:s,extraData:n,fallbackSingleMode:i}=t;this.fallbackSingleMode=i;const r=await this.startFLowChallengeFriend({playerId:s,extraData:n});if(r===!0)return;r instanceof _e?await this.startFlowTournament(s):await this.startFlowSingle(s)}finally{this.endLog()}}};o(Ko,"ChooseContextConcrete");let ja=Ko;const{Valid:qy}=g.Utils,{Leaderboards:Yy}=g.Configs,Wo=class Wo extends Qt{constructor(e){super(e,{score:0,leaderboardId:Yy.LeaderboardEndlessId})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new q;const{endlessScore:i}=t[n];if(!qy.isNumber(i))throw new Xt;this.payload.score=i,super.setupSetScorePayload(e)}};o(Wo,"PostGlobalLeaderboardEndlessScoreHandler");let za=Wo;const Ho=class Ho extends I{async processAsync(e){super.processAsync(e),this.setPlayerEndlessScore(e),await this.nextAsync(e)}setPlayerEndlessScore(e){const{profiles:t,customData:s}=e,{playerId:n}=s;if(!n||!t[n])throw new q;const{player:i}=this.game,r=i.getBestEndlessScore()??0,{endlessScore:c=0}=t[n],l=r<c?c:r;i.setBestEndlessScore(l),t[n].bestEndlessScore=l}};o(Ho,"SetPlayerEndlessScoreHandler");let Ka=Ho;const qo=class qo extends S{async processAsync(){try{this.startLog();const e=new _(this),t=new kt(this,{useAPI:!1});e.setNext(t);const s=new $t(this);t.setNext(s);const n=new Ka(this);s.setNext(n);const i=new za(this);n.setNext(i);const r=new N(this);i.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}};o(qo,"FinishEndlessConcrete");let Wa=qo;const Yo=class Yo extends Error{constructor(e){super(e),this.name="ProfileIdNotDefined",this.message=e??"Profile id is not defined"}};o(Yo,"ProfileIdNotDefined");let Ha=Yo;const{Dtos:Xy}=g,Xo=class Xo extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{profileId:s}=this.payload;if(!s)throw new Ha;const{player:n}=this.game,i=n.getPlayerId();let r;if(s===i)r=this.getPlayerProfile();else if(r=await this.getProfileAsync(s),!r)throw new q;this.updateMatchData(r,t),await this.nextAsync(t)}getPlayerProfile(){const{player:t}=this.game,{playerId:s,name:n,photo:i,locale:r}=t.getPlayer();return{playerId:s,name:n,photo:i,locale:r}}async getProfileAsync(t){const{profile:s}=this.game;return await s.requestProfiles([t]),s.getProfiles()[t]}updateMatchData(t,s){const{playerId:n,name:i,photo:r}=t,c=new Xy.Match.Profile({id:n,name:i,photo:r}).toObject();s.profiles[n]=c}};o(Xo,"GetProfileHandler");let Dt=Xo;const Qo=class Qo extends S{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new _(this),n=new Yt(this,{contextId:"SOLO"});s.setNext(n);const i=new B(this,{id:"234567",mode:V.ENDLESS,customData:{playerId:t}});n.setNext(i);const r=new et(this);i.setNext(r);const c=new Dt(this,{profileId:t});r.setNext(c);const l=new W(this);c.setNext(l);const d=new N(this);l.setNext(d);const h=this.match.getMatchState();await s.processAsync(h)}finally{this.endLog()}}};o(Qo,"StartEndlessConcrete");let qa=Qo;const{Valid:Qy}=g.Utils,Jo=class Jo extends Qt{constructor(e){super(e,{score:0,leaderboardId:""})}async setupSetScorePayload(e){const{profiles:t,customData:s}=e,{playerId:n,leaderboardId:i}=s;if(!i)throw new Ft;if(!n||!t[n])throw new q;const{score:r}=t[n];if(!Qy.isNumber(r))throw new Xt;this.payload.score=r,this.payload.leaderboardId=i,super.setupSetScorePayload(e)}};o(Jo,"PostLeaderboardScoreHandler");let xe=Jo;const Zo=class Zo extends I{async processAsync(e){super.processAsync(e),this.validateData(e),this.progressSendGroupMessage(e),await this.nextAsync(e)}validateData(e){const{id:t,customData:s}=e,{contextId:n,opponentId:i}=s;if(!t||typeof t!="string")throw new at;if(!n||typeof n!="string")throw new tt;if(!i||typeof i!="string")throw new U}async createWideframesResultGroupAsync(e){try{const{frameCapture:t}=this.game,{profiles:s,customData:n}=e,{playerId:i,opponentId:r}=n;if(!i||!r)return null;const c=s[i],l=s[r],{photo:d,score:h=0}=c,{photo:u,score:p=0}=l;return await t.wideframe.renderResultChallenge({playerId:i,playerPhoto:d,playerScore:h,opponentId:r,opponentPhoto:u,opponentScore:p,isPlayerFinished:!0,isOpponentFinished:!0})}catch(t){return console.warn("createWideframesResultGroupAsync",t),null}}async createWideframesBestScoreAsync(e){try{const{player:t,frameCapture:s}=this.game,{playerId:n}=e.customData,{playerId:i,photo:r,data:c}=t.getPlayer();if(n!==i)return null;const{score:l}=c||{};return await s.wideframe.renderShareScore({playerId:i,playerPhoto:r,playerScore:l})}catch(t){return console.warn("createWideframesBestScoreAsync",t),null}}async progressSendGroupMessage(e){const{profiles:t,customData:s}=e,{playerId:n,opponentId:i}=s;if(i&&typeof i=="string"){if(!n||typeof n!="string")throw new D;const{score:c=0}=t[n]||{},{score:l=0}=t[i]||{};if(c>l){const d=await this.createWideframesResultGroupAsync(e);if(!d)return;this.sendBestScoreMessageAsync(e,d);return}}const r=await this.createWideframesBestScoreAsync(e);r&&this.sendChallengeMessageAsync(e,r)}async sendBestScoreMessageAsync(e,t){const{profiles:s,customData:n}=e,{playerId:i}=n;if(!i||typeof i!="string")throw new D;if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");const{name:r,score:c}=s[i],d={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:i,playerName:r,playerScore:c},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi"}},text:{default:`${r} beats your high score. Their score: ${c}.`,localizations:{vi_VN:`${r} vừa vượt điểm số cao nhất của bạn! Chơi lần nữa chứ?`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(d)}async sendChallengeMessageAsync(e,t){const{profiles:s,customData:n}=e,{playerId:i}=n;if(!i||typeof i!="string")throw new D;const{name:r,score:c}=s[i],d={data:{type:this.game.context.getSessionContextTypes().MATCHING_GROUP,playerId:i,playerName:r,playerScore:c},action:"CUSTOM",template:"play_turn",cta:{default:"Play",localizations:{vi_VN:"Chơi ngay"}},text:{default:`${r} got ${c} scores. So easy! Can you?`,localizations:{vi_VN:`${r} đã đạt ${c} điểm! Quá dễ luôn. Chơi lại nào!`}},image:t,strategy:"IMMEDIATE",notification:"PUSH"};if(!("updateAsync"in GameSDK.extra))throw new P("updateAsync");await GameSDK.extra.updateAsync(d)}};o(Zo,"SendGroupMessageHandler");let Ya=Zo;const tc=class tc extends S{async processAsync(){try{this.startLog();const e=new _(this),t=new kt(this,{useAPI:!1});e.setNext(t);const s=new Ya(this);t.setNext(s);const n=new $t(this);s.setNext(n);const i=new Jt(this);n.setNext(i);const r=new xe(this);i.setNext(r);const c=new N(this);r.setNext(c);const l=this.match.getMatchState();await e.processAsync(l)}finally{this.endLog()}}};o(tc,"FinishGroupConcrete");let Xa=tc;const{Dtos:Jy}=g,ec=class ec extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateProfileMatchData(t),await this.nextAsync(t)}updateProfileMatchData(t){const{id:s}=this.payload,{profiles:n}=t;if(!n[s])throw new q;const i={...n[s],...this.payload},r=new Jy.Match.Profile(i).toObject();n[r.id]=r}};o(ec,"SetProfileDataHandler");let Zt=ec;const sc=class sc extends S{async processAsync(e){try{this.startLog(e);const{playerId:t,opponentId:s,opponentScore:n}=e,i=new _(this),r=new B(this,{id:"7749",mode:V.MATCHING_GROUP,customData:{playerId:t,opponentId:s}});i.setNext(r);const c=new pt(this);r.setNext(c);const l=new Zt(this,{id:t,score:n});c.setNext(l);const d=new et(this);l.setNext(d);const h=new W(this);d.setNext(h);const u=new N(this);h.setNext(u);const p=this.match.getMatchState();await i.processAsync(p)}finally{this.endLog()}}};o(sc,"JoinGroupConcrete");let Qa=sc;const nc=class nc extends Error{constructor(e){super(e),this.name="MatchGroupNotSupported",this.message=e??"Match group is not supported"}};o(nc,"MatchGroupNotSupported");let ds=nc;const{String:Zy}=g.Utils,ac=class ac extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.checkMatchGroupSupported();const s=this.getMatchTag(),n=await this.matchingGroup(s);t.customData.contextId=n,await this.nextAsync(t)}async checkMatchGroupSupported(){if(!("getSupportedAPIs"in GameSDK))throw new P("getSupportedAPIs");if(!("checkCanPlayerMatchAsync"in GameSDK.extra))throw new P("checkCanPlayerMatchAsync");if(!GameSDK.getSupportedAPIs().includes("checkCanPlayerMatchAsync"))throw new ds;if(!await GameSDK.extra.checkCanPlayerMatchAsync())throw new ds}getMatchTag(){const{locale:t}=this.payload;let s="global";if(t){const n=Zy.getLanguageCode(t);n==="en"&&(s="en"),n==="in"&&(s="in")}return s}async matchingGroup(t){if(!("matchPlayerAsync"in GameSDK.extra))throw new P("matchPlayerAsync");await GameSDK.extra.matchPlayerAsync(t,!0,!0);const s=GameSDK.context.getID();if(typeof s!="string")throw new Se;return s}};o(ac,"GroupContextHandler");let Ja=ac;const ic=class ic extends S{async processAsync(e){try{this.startLog(e);const{locale:t,playerId:s}=e,n=new _(this),i=new Ja(this,{locale:t});n.setNext(i);const r=new B(this,{id:"7749",mode:V.MATCHING_GROUP,customData:{playerId:s}});i.setNext(r);const c=new et(this);r.setNext(c);const l=new Dt(this,{profileId:s});c.setNext(l);const d=new W(this);l.setNext(d);const h=new N(this);d.setNext(h);const u=this.match.getMatchState();await n.processAsync(u)}finally{this.endLog()}}};o(ic,"StartGroupConcrete");let Za=ic;const rc=class rc extends S{async processAsync(){try{this.startLog();const e=new _(this),t=new kt(this,{useAPI:!1});e.setNext(t);const s=new $t(this);t.setNext(s);const n=new Jt(this);s.setNext(n);const i=new Ce(this);n.setNext(i);const r=new N(this);i.setNext(r);const c=this.match.getMatchState();await e.processAsync(c)}finally{this.endLog()}}};o(rc,"FinishSingleConcrete");let ti=rc;const oc=class oc extends S{async processAsync(e){try{this.startLog(e);const{playerId:t}=e,s=new _(this),n=new Yt(this,{contextId:"SOLO"});s.setNext(n);const i=new B(this,{id:"123456",mode:V.SINGLE,customData:{playerId:t}});n.setNext(i);const r=new et(this);i.setNext(r);const c=new Dt(this,{profileId:t});r.setNext(c);const l=new W(this);c.setNext(l);const d=new N(this);l.setNext(d);const h=this.match.getMatchState();await s.processAsync(h)}finally{this.endLog()}}};o(oc,"StartSingleConcrete");let ei=oc;const{Plugins:tm,Utils:em}=g,{Analytics:sm}=tm,{String:nm,Valid:am}=em,cc=class cc extends I{async processAsync(e){super.processAsync(e);const{mode:t,customData:s}=e;this.validateMode(t);const{analytics:n}=this.game,{tournamentId:i,leaderboardId:r}=s;n.event(sm.Events.TOURNAMENT_START,{success:!0,game_mode:nm.toUpperCamelCase(t),tournament_id:i,leaderboard_id:r}),await this.nextAsync(e)}validateMode(e){if(!am.isString(e))throw new Ee}};o(cc,"LogTournamentStartHandler");let hs=cc;const lc=class lc extends Error{constructor(e){super(e),this.name="TournamentIdNotValid",this.message=e??"Tournament id is not valid"}};o(lc,"TournamentIdNotValid");let us=lc;const{Valid:si}=g.Utils,dc=class dc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{contextId:s}=this.payload;this.validateContextId(s);const n=await GameSDK.getTournamentAsync(),i=n.getID().toString();this.validateTournamentId(i);const r=JSON.parse(n.getPayload()||"{}"),{leaderboardId:c}=r;this.validateLeaderboardId(c),t.customData.contextId=s,t.customData.tournamentId=i,t.customData.leaderboardId=c,await this.nextAsync(t)}validateContextId(t){if(!si.isString(t))throw new tt}validateTournamentId(t){if(!si.isString(t))throw new us}validateLeaderboardId(t){if(!si.isString(t)||t==="")throw new Ft}};o(dc,"ContinueTournamentHandler");let ni=dc;const hc=class hc extends S{async processAsync(e){try{this.startLog(e);const{playerId:t,contextId:s}=e,n=new _(this),i=new ni(this,{contextId:s});n.setNext(i);const r=new B(this,{id:"1997",mode:V.TOURNAMENT,customData:{playerId:t}});i.setNext(r);const c=new et(this);r.setNext(c);const l=new Dt(this,{profileId:t});c.setNext(l);const d=new W(this);l.setNext(d);const h=new hs(this);d.setNext(h);const u=new N(this);d.setNext(u);const p=this.match.getMatchState();await n.processAsync(p)}finally{this.endLog()}}};o(hc,"ContinueTournamentConcrete");let ai=hc;const{Plugins:im}=g,{Analytics:rm}=im,uc=class uc extends I{async processAsync(e){super.processAsync(e);const{customData:t}=e,{analytics:s}=this.game,{tournamentId:n,leaderboardId:i}=t;s.event(rm.Events.TOURNAMENT_CREATE,{success:!0,tournament_id:n,leaderboard_id:i}),await this.nextAsync(e)}};o(uc,"LogTournamentCreateHandler");let ii=uc;const fc=class fc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),await this.createTournamentAsync(),await this.updateMatchStateAsync(t),await this.nextAsync(t)}async createTournamentAsync(){const{name:t,score:s,customData:n}=this.payload;await GameSDK.tournament.createAsync({initialScore:s,config:{title:t,tournamentTitle:t},data:n})}async updateMatchStateAsync(t){try{if(!("getTournamentAsync"in GameSDK))throw new P("getTournamentAsync");const s=await GameSDK.getTournamentAsync(),n=s.getContextID(),i=s.getID().toString(),{playerId:r}=this.payload;t.customData.playerId=r,t.customData.contextId=n,t.customData.tournamentId=i}catch(s){if(s instanceof P)return}}};o(fc,"CreateTournamentHandler");let ri=fc;const{Valid:Jd}=g.Utils,pc=class pc extends I{constructor(t,s){super(t);f(this,"payload");f(this,"leaderboardPayload");this.payload=s}async processAsync(t){super.processAsync(t),this.validatePayload(),await this.setupCreatePayload(t),await this.createLeaderboardAsync(t),await this.nextAsync(t)}validatePayload(){const{leaderboardId:t}=this.payload;if(!Jd.isString(t))throw new Ft}validatePlayerId(t){if(!Jd.isString(t))throw new D}async setupCreatePayload(t){const{playerId:s}=t.customData;this.validatePlayerId(s);const{name:n,leaderboardId:i,customData:r}=this.payload;this.leaderboardPayload={_id:i,name:n??"",createdBy:s,description:JSON.stringify(r)}}async createLeaderboardAsync(t){const s=await this.game.leaderboard.createLeaderboardAsync(this.leaderboardPayload);t.customData.leaderboardId=s}};o(pc,"CreateLeaderboardHandler");let oi=pc;const gc=class gc extends S{async processAsync(e){try{this.startLog(e);const{playerId:t,name:s,score:n,leaderboardId:i,payload:r}=e,c=new _(this),l=new Yt(this,{contextId:"SOLO"});c.setNext(l);const d=new ri(this,{name:s,score:n,playerId:t,customData:r});l.setNext(d);const h=new Dt(this,{profileId:t});d.setNext(h);const u=new Zt(this,{id:t,score:n});h.setNext(u);const p=new oi(this,{name:s,customData:r,leaderboardId:i});u.setNext(p);const y=new xe(this);p.setNext(y);const w=new ii(this);y.setNext(w);const A=this.match.getMatchState();await c.processAsync(A)}finally{this.endLog()}}};o(gc,"CreateTournamentConcrete");let ci=gc;const{Analytics:Zd}=g.Plugins,{Valid:om}=g.Utils,yc=class yc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.validateData(t),await this.postScoreTournamentAsync(t),await this.nextAsync(t)}validateData(t){const{profiles:s,customData:n}=t,{playerId:i}=n;if(this.validatePlayerId(i),!s[i])throw new q}validatePlayerId(t){if(!om.isString(t))throw new D}getPlayerProfile(t){const{profiles:s,customData:n}=t,{playerId:i}=n;return this.validatePlayerId(i),s[i]}isNewBestScore(t){const s=this.getPlayerProfile(t),{score:n=0,bestScore:i=0}=s;return n>i}async postScoreTournamentAsync(t){const{analytics:s}=window.game,n=this.getPlayerProfile(t),{score:i=0}=n;let r=null,c=!1;const{checkBestScore:l}=this.payload,d=this.isNewBestScore(t);try{if(!("getTournamentAsync"in GameSDK))throw new P("getTournamentAsync");await GameSDK.getTournamentAsync(),!l||d?(r=Zd.Events.TOURNAMENT_SHARE,await GameSDK.tournament.shareAsync({score:i})):(r=Zd.Events.TOURNAMENT_POST_SCORE,await GameSDK.tournament.postScoreAsync(i)),c=!0}catch(h){console.warn("Post Score Tournament",h)}finally{r&&s.event(r,{success:c})}}};o(yc,"PostScoreTournamentHandler");let li=yc;const mc=class mc extends S{async processAsync(e){try{this.startLog(e);const{playerId:t,bestScore:s}=e,n=new _(this),i=new kt(this,{useAPI:!1});n.setNext(i);const r=new Zt(this,{id:t,bestScore:s});i.setNext(r);const c=new li(this,{checkBestScore:!1});r.setNext(c);const l=new $t(this);c.setNext(l);const d=new Jt(this);l.setNext(d);const h=new xe(this);d.setNext(h);const u=new Ce(this);h.setNext(u);const p=new N(this);u.setNext(p);const y=this.match.getMatchState();await n.processAsync(y)}finally{this.endLog()}}};o(mc,"FinishTournamentConcrete");let di=mc;const{Valid:hi,Object:cm}=g.Utils,wc=class wc extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t);const{tournamentId:s}=this.payload;this.validateTournamentId(s),await this.joinTournamentAsync(s);const n=await GameSDK.getTournamentAsync(),i=n.getContextID();this.validateContextId(i);const r=JSON.parse(n.getPayload()||"{}"),{leaderboardId:c}=r;this.validateLeaderboardId(c),t.customData.contextId=i,t.customData.tournamentId=s,t.customData.leaderboardId=c,await this.nextAsync(t)}validateTournamentId(t){if(!hi.isString(t))throw new us}validateContextId(t){if(!hi.isString(t))throw new tt}validateLeaderboardId(t){if(!hi.isString(t)||t==="")throw new Ft}async joinTournamentAsync(t){if(!("tournament"in GameSDK))throw new P("tournament");try{await GameSDK.tournament.joinAsync(t)}catch(s){if(!cm.hasOwn(s,"code")||s.code!=="SAME_CONTEXT")throw s}}};o(wc,"JoinTournamentHandler");let ui=wc;const Ac=class Ac extends S{async processAsync(e){try{this.startLog(e);const{playerId:t,tournamentId:s}=e,n=new _(this),i=new ui(this,{tournamentId:s});n.setNext(i);const r=new B(this,{id:"1997",mode:V.TOURNAMENT,customData:{playerId:t}});i.setNext(r);const c=new et(this);r.setNext(c);const l=new Dt(this,{profileId:t});c.setNext(l);const d=new W(this);l.setNext(d);const h=new hs(this);d.setNext(h);const u=new N(this);h.setNext(u);const p=this.match.getMatchState();await n.processAsync(p)}finally{this.endLog()}}};o(Ac,"JoinTournamentConcrete");let fi=Ac;const{Dtos:lm,Utils:dm}=g,{Object:hm}=dm,Ic=class Ic extends I{constructor(t,s){super(t);f(this,"payload");this.payload=s}async processAsync(t){super.processAsync(t),this.updateMatchCustomData(t),await this.nextAsync(t)}updateMatchCustomData(t){const s=hm.merge(t.customData,this.payload),n=new lm.Match.CustomData(s).toObject();t.customData=n}};o(Ic,"SetMatchCustomDataHandler");let pi=Ic;const um={id:null,mode:null,status:null,startAt:0,finishAt:0,profiles:{},customData:{...ya}},{Configs:th}=g,bc=class bc extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"base");f(this,"group");f(this,"single");f(this,"endless");f(this,"context");f(this,"challenge");f(this,"tournament");f(this,"api");f(this,"handler");f(this,"useCPUProfile")}init(){this.createMatchData(),this.createAPIHandler(),this.createBaseConcrete(),this.createConcreteFlows(),this.createConcreteHandlers()}setUseCPUProfile(t){this.useCPUProfile=t}createMatchData(){const{storage:t}=this.game;t.addStorage("match",um)}getMatchState(){const{storage:t}=this.game;return t.getStorage("match")}createBaseConcrete(){this.base=new S(this.game,this)}createConcreteFlows(){this.createGroupFlows(),this.createSingleFlows(),this.createEndlessFlows(),this.createContextFlows(),this.createChallengeFlows(),this.createTournamentFlows()}createConcreteHandlers(){this.handler={setProfileData:o(async t=>{const s=new Zt(this.base,t);await this.processHandlerAsync(s)},"setProfileData"),setMatchCustomData:o(async t=>{const s=new pi(this.base,t);await this.processHandlerAsync(s)},"setMatchCustomData"),setLeaderboardScore:o(async t=>{const s=new Qt(this.base,t);await this.processHandlerAsync(s)},"setLeaderboardScore")}}createAPIHandler(){const t={appId:th.AppId,matchAPIHost:th.ApiHost};this.api=new ua(t)}createGroupFlows(){this.group={join:new Qa(this.game,this),start:new Za(this.game,this),finish:new Xa(this.game,this)}}createSingleFlows(){this.single={start:new ei(this.game,this),finish:new ti(this.game,this)}}createEndlessFlows(){this.endless={start:new qa(this.game,this),finish:new Wa(this.game,this)}}createContextFlows(){this.context={choose:new ja(this.game,this)}}createChallengeFlows(){this.challenge={invite:new Oa(this.game,this),friend:new Ia(this.game,this),join:new ka(this.game,this),await:new wa(this.game,this),result:new Ga(this.game,this),finish:new Pa(this.game,this),continue:new Da(this.game,this)}}createTournamentFlows(){this.tournament={join:new fi(this.game,this),create:new ci(this.game,this),finish:new di(this.game,this),continue:new ai(this.game,this)}}processHandlerAsync(t){const s=this.getMatchState();return t.processAsync(s)}};o(bc,"MatchPlugin");let gi=bc;const{Valid:Ut}=g.Utils,Bt="is invalid",Ec=class Ec extends R{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!Ut.isNumber(e)||!e)&&this.exception("level",Bt)}validateRescued(e){(!Ut.isNumber(e)||e<0)&&this.exception("rescued",Bt)}validateContextId(e){Ut.isString(e)||this.exception("contextId",Bt)}validatePlayerId(e){Ut.isString(e)||this.exception("playerId",Bt)}validateOpponentId(e){Ut.isString(e)||this.exception("opponentId",Bt)}validateTournamentId(e){Ut.isString(e)||this.exception("tournamentId",Bt)}validateLeaderboardId(e){Ut.isString(e)||this.exception("leaderboardId",Bt)}toObject(){return super.toObject()}static getDefaultData(){return R.getDefaultData()}};o(Ec,"MatchCustomDataDtos");let fs=Ec;fs.addDefaultData(ya);const{Valid:vt}=g.Utils,St="is invalid",Dc=class Dc extends R{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!vt.isString(e)||!e)&&this.exception("id",St)}validateName(e){(!vt.isString(e)||!e)&&this.exception("name",St)}validatePhoto(e){vt.isString(e)||this.exception("photo",St)}validateScore(e){(!vt.isNumber(e)||e<0)&&this.exception("score",St)}validateBestScore(e){(!vt.isNumber(e)||e<0)&&this.exception("bestScore",St)}validateEndlessScore(e){(!vt.isNumber(e)||e<0)&&this.exception("endlessScore",St)}validateBestEndlessScore(e){(!vt.isNumber(e)||e<0)&&this.exception("bestEndlessScore",St)}validateFinished(e){vt.isBoolean(e)||this.exception("finished",St)}toObject(){return super.toObject()}static getDefaultData(){return R.getDefaultData()}};o(Dc,"MatchProfileDtos");let ps=Dc;ps.addDefaultData({id:"",name:"Your Friend",photo:"./assets/images/others/avatar.png",score:0,bestScore:0,finished:!1,endlessScore:0,bestEndlessScore:0}),g.Dtos.Match={Data:Te,CustomData:fs,Profile:ps};const{Utils:fm}=g,{ApiHost:pm}=g.Configs,gm=o(async a=>{const e=await G("players",a,{},pm,10);return fm.Object.hasOwn(e,"data")?e.data||{}:{}},"updatePlayerProfileAsync"),{Utils:ym,Configs:mm}=g,{AppId:wm}=mm,{Array:Am,Object:gs,Valid:Im}=ym,vc=class vc extends x.Plugins.BasePlugin{init(){const{storage:e}=this.game;e.addStorage("player",Gt)}async saveToCloud(){try{const e=this.getPlayerData();await GameSDK.player.setDataAsync(e)}catch(e){console.warn(e)}}receiveData(e,t){const{storage:s}=this.game,{playerId:n,name:i,photo:r,locale:c}=e;s.setStorageData("player","playerId",n),s.setStorageData("player","name",i),s.setStorageData("player","photo",r),s.setStorageData("player","locale",c),t&&this.setPlayerData(t)}async syncProfileToServer(){const{storage:e}=this.game,t=this.getPlayer(),{playerId:s,name:n,photo:i,locale:r}=t;let c=this.getPlayerASID();!Im.isString(c)&&"getASIDAsync"in GameSDK.player&&(c=await GameSDK.player.getASIDAsync()??c,e.setStorageData("player","ASID",`${c}`)),await gm({appId:wm,ASID:c,playerId:s,name:n,photo:i,locale:r})}setPlayerDataByName(e,t){this.setPlayerData({[e]:t})}setPlayerData(e){const{storage:t}=this.game;t.setStorageData("player","data",e),this.saveToCloud()}setBestScore(e){this.setPlayerDataByName("score",e)}setBestEndlessScore(e){this.setPlayerDataByName("endlessScore",e)}setSetting(e,t){this.setPlayerDataByName("settings",{[e]:t})}setGameData(e){const t=this.getGameData()??{},s=gs.merge(t,e);this.setPlayerDataByName("gameData",s)}async requestConnectedPlayers(){const{storage:e}=this.game,s=(await GameSDK.player.getConnectedPlayersAsync()).map(r=>{const c=r.getID(),l=r.getName(),d=r.getPhoto();return!c||!l||!d?null:new jt({playerId:c,name:l,photo:d}).toObject()}),n=Am.unique(s);if(n.length<1)return;const i=gs.keyBy(n,"playerId");e.setStorageData("player","connectedPlayers",i)}getPlayer(){const{storage:e}=this.game;return e.getStorage("player")}getPlayerId(){const{storage:e}=this.game;return e.getStorageData("player","playerId")}getPlayerASID(){const{storage:e}=this.game;return e.getStorageData("player","ASID")}getPlayerLocale(){const{storage:e}=this.game;return e.getStorageData("player","locale")}getPlayerData(){const{storage:e}=this.game;return e.getStorageData("player","data")}getPlayerDataByKey(e){const t=this.getPlayerData();return gs.hasOwn(t,e)?t[e]:null}getGameData(){return this.getPlayerDataByKey("gameData")}getPlayerSetting(e){const t=this.getPlayerSettings();return gs.hasOwn(t,e)?t[e]:null}getPlayerSettings(){const{settings:e}=this.getPlayerData();return e}isFirstLogin(){return this.getPlayerDataByKey("isFirstLogin")??Gt.data.isFirstLogin}loggedIn(){this.setPlayerDataByName("isFirstLogin",!1)}getBestScore(){const{score:e}=this.getPlayerData();return e}getBestEndlessScore(){const{endlessScore:e}=this.getPlayerData();return e}getConnectedPlayers(){const{storage:e}=this.game;return e.getStorageData("player","connectedPlayers")}getConnectedPlayerIds(e,t){const s=this.getConnectedPlayers();return Object.keys(s).slice(t,t+e)}};o(vc,"PlayerPlugin");let yi=vc;const{Dtos:eh,Utils:bm}=g,{Valid:te}=bm,{score:sh,endlessScore:Em,settings:Dm,gameData:vm,isFirstLogin:Sm,dailyRewarded:Pm}=Gt.data,ee="is invalid",Sc=class Sc extends R{processData(e){this.validateStructure(e),e.settings=new eh.Player.Settings(e.settings).toObject(),e.gameData=new eh.Player.GameData(e.gameData).toObject(),this.validateData(e),this.setupData(e)}setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateScore(e){(!te.isNumber(e)||e<0)&&this.exception("score",ee)}validateEndlessScore(e){(!te.isNumber(e)||sh<0)&&this.exception("endlessScore",ee)}validateSettings(e){te.isObject(e)||this.exception("settings",ee)}validateGameData(e){te.isObject(e)||this.exception("gameData",ee)}validateIsFirstLogin(e){te.isBoolean(e)||this.exception("isFirstLogin",ee)}validateDailyRewarded(e){te.isObject(e)||this.exception("dailyRewarded",ee)}toObject(){return super.toObject()}};o(Sc,"PlayerDataDtos");let ys=Sc;ys.addDefaultData({score:sh,endlessScore:Em,settings:Dm,gameData:vm,isFirstLogin:Sm,dailyRewarded:Pm});const{Valid:nh}=g.Utils,{level:Cm,coins:_m}=Gt.data.gameData,Pc=class Pc extends R{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateLevel(e){(!nh.isNumber(e)||e<0)&&this.exception("level","is invalid")}validateCoins(e){(!nh.isNumber(e)||e<0)&&this.exception("coins","is invalid")}toObject(){return super.toObject()}};o(Pc,"PlayerGameDataDtos");let ms=Pc;ms.addDefaultData({level:Cm,coins:_m});const{Valid:ws}=g.Utils,{sound:Tm,music:xm,vibrate:Nm,language:Om}=Gt.data.settings,As="is invalid",Cc=class Cc extends R{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateSound(e){ws.isBoolean(e)||this.exception("sound",As)}validateMusic(e){ws.isBoolean(e)||this.exception("music",As)}validateVibrate(e){ws.isBoolean(e)||this.exception("vibrate",As)}validateLanguage(e){(!ws.isString(e)||!e)&&this.exception("language",As)}toObject(){return super.toObject()}};o(Cc,"PlayerSettingsDtos");let Is=Cc;Is.addDefaultData({sound:Tm,music:xm,vibrate:Nm,language:Om}),g.Dtos.Player={Info:jt,Data:ys,Settings:Is,GameData:ms};const{Configs:Mm,Utils:Rm}=g,{Object:Lm,String:$m}=Rm,{ApiHost:Fm,Mockup:km}=Mm,_c=class _c{constructor(){f(this,"mockAPI")}async initMockAPI(){if(this.mockAPI)return;const e=(await ot(async()=>{const{default:t}=await b.import("./bundle/empty-script.js");return{default:t}},void 0,b.meta.url)).default;if(typeof e!="function")throw new Error("Cannot load ProfileAPIMock");this.mockAPI=new e}async getPlayersAsync(e){const t=$m.params(e);let s;return km.Profile.Enabled?(await this.initMockAPI(),s=await this.mockAPI.getPlayersAsync(e)):s=await zt(`players?${t}`,{},Fm),!Lm.hasOwn(s,"data")||!Array.isArray(s.data)?[]:s.data}};o(_c,"ProfileAPI");let mi=_c;const Um={profiles:{},profileIds:[]},{Utils:Bm,Dtos:Vm}=g,{Array:Gm,Valid:jm,Object:zm}=Bm,Tc=class Tc extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"profileAPI",new mi)}init(){const{storage:t}=this.game;t.addStorage("profile",Um)}async requestProfiles(t){const s=this.getProfileIds(),n=Gm.difference(t,s);if(n.length<1)return;const i=await this.profileAPI.getPlayersAsync({playerIds:n});if(!this.validateProfilesResponse(i))return;const r=this.convertToProfiles(i);this.setProfiles(r)}getProfile(t){return this.getProfiles()[t]??null}getProfiles(){const{storage:t}=this.game;return t.getStorageData("profile","profiles")}setProfiles(t){const{storage:s}=this.game;s.setStorageData("profile","profiles",t),s.setStorageData("profile","profileIds",Object.keys(t))}getProfileIds(){const{storage:t}=this.game;return t.getStorageData("profile","profileIds")}validateProfilesResponse(t){return!(!Array.isArray(t)||t.length<1)}convertToProfiles(t){const s={};return t.forEach(n=>{zm.hasOwn(n,"playerId")&&jm.isString(n.playerId)&&(s[n.playerId]=new Vm.Player.Info(n).toObject())}),s}};o(Tc,"ProfilePlugin");let wi=Tc;const{Valid:bs,Object:ah}=g.Utils,{Ads:ih,Gameplay:rh}=g.Configs,Es="is invalid",xc=class xc extends R{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateAds(e){bs.isObject(e)||this.exception("ads",Es),this.validateCommonData(e,ih)}validateGameplay(e){bs.isObject(e)||this.exception("gameplay",Es),this.validateCommonData(e,rh)}validateCommonData(e,t){Object.keys(e).forEach(s=>{if(!ah.hasOwn(e,s))return;ah.hasOwn(t,s)||this.exception(`the "${s}" key`,Es);const n=e[s],i=t[s];typeof n!=typeof i&&this.exception("value",Es),bs.isObject(n)&&bs.isObject(i)&&this.validateCommonData(n,i)})}toObject(){return super.toObject()}};o(xc,"GameCoreConfigDtos");let Ne=xc;Ne.addDefaultData({Ads:ih,Gameplay:rh});const{Valid:Ds,Object:Km}=g.Utils,Nc=class Nc extends R{setupData(e){this.lazySetupData(e)}validateStructure(e){}validateData(e){this.validateCommonData(e)}validateCommonData(e,t=!0){Object.keys(e).forEach(s=>{if(!Km.hasOwn(e,s))return;const n=e[s];!Ds.isBoolean(n)&&!Ds.isNumber(n)&&!Ds.isString(n)&&this.exception("value","is invalid"),Ds.isObject(n)&&this.validateCommonData(n,!1),t&&Object.assign(this,{[s]:n})})}toObject(){return super.toObject()}};o(Nc,"GamePlayConfigDtos");let Oe=Nc;Oe.addDefaultData({});const{Valid:se,Object:oh}=g.Utils,Vt="is invalid",Oc=class Oc extends R{setupData(e){this.lazySetupData(e)}validateStructure(e){this.lazyValidateStructure(e)}validateData(e){this.lazyValidateData(e)}validateId(e){(!se.isString(e)||!e)&&this.exception("id",Vt);const{remoteConfig:t}=window.game;return t.isRemoteConfigId(e)}validateType(e){(!se.isString(e)||!e)&&this.exception("type",Vt),["GameCore","Gameplay"].includes(e)||this.exception("type",Vt)}validateInfo(e){(!se.isObject(e)||!e)&&this.exception("info",Vt),(!oh.hasOwn(e,"version")||!se.isString(e.version)||!e.version)&&this.exception("info.version",Vt),(!oh.hasOwn(e,"createdAt")||!se.isString(e.createdAt)||!e.createdAt)&&this.exception("info.createdAt",Vt)}validateConfig(e){se.isObject(e)||this.exception("config",Vt)}toObject(){return super.toObject()}};o(Oc,"RemoteConfigDataDtos");let Me=Oc;Me.addDefaultData({id:"default",type:"GameCore",info:{version:"1.0.0",priority:100,createdAt:"unknown"},config:{}});const Mc=class Mc{constructor(e){f(this,"game");f(this,"plugin");f(this,"data");this.plugin=e,this.game=e.game,this.data=[]}getConfigById(e){return this.data.filter(s=>s.id===e)[0]}getConfigByVersion(e){return this.data.filter(s=>s.info.version===e)[0]}getConfigByLatestVersion(){return this.data.sort((t,s)=>t.info.createdAt.localeCompare(s.info.createdAt))[0]}getConfigByPriority(e){return this.data.filter(s=>s.info.priority<=e)[0]}};o(Mc,"BaseHandler");let Re=Mc;const{Valid:vs}=g.Utils,Rc=class Rc extends Re{constructor(t){super(t);f(this,"firebaseRemoteConfig");this.initialize()}initialize(){const{services:t}=this.game.firebase;if(!t.remoteConfig)throw new Error("FirebaseHandler: Firebase Remote Config is not initialized");this.firebaseRemoteConfig=t.remoteConfig}async fetchConfig(t){await this.firebaseRemoteConfig.fetchDataAsync();const s=this.getConfig(t);if(!s)throw new Error("FirebaseHandler: Parse data failed");return s}getConfig(t){const{id:s,type:n,conditions:i}=t;let r=null;if(this.data=[],r=this.getResultByType(n),console.log("Get config from remote",r),!r)return null;const{data:c}=r;if(!c||c.length===0)return null;if(this.data=c,s)return this.getConfigById(s);let l=null;return vs.isObject(i)&&(l=this.getConfigByConditions(i)),l||this.getConfigByLatestVersion()}getResultByType(t){switch(t){case"GameCore":return this.firebaseRemoteConfig.getDataByKey("gamecore_configs");case"Gameplay":return this.firebaseRemoteConfig.getDataByKey("gameplay_configs");default:return null}}getConfigByConditions(t){const{latest:s,version:n,priority:i}=t;return vs.isString(n)?this.getConfigByVersion(n):vs.isNumber(i)?this.getConfigByPriority(i):vs.isBoolean(s)?this.getConfigByLatestVersion():null}};o(Rc,"FirebaseHandler");let Ai=Rc;const Lc=class Lc extends Re{async fetchConfig(e){const{id:t,type:s,conditions:n}=e;await g.Utils.Time.sleepAsync(800);let i=null;switch(s){case"GameCore":i=await this.requestGameCoreConfig(t,n);break;case"Gameplay":i=await this.requestGamePlayConfig(t,n);break;default:console.warn("fetchConfig: Invalid type",s);break}return i}async requestGameCoreConfig(e,t){if(this.data=(await ot(async()=>{const{default:n}=await b.import("./bundle/mock-gamecore-configs.js");return{default:n}},void 0,b.meta.url)).default,e)return this.getConfigById(e);const{version:s}=t??{};return s?this.getConfigByVersion(s):this.getConfigByLatestVersion()}async requestGamePlayConfig(e,t){if(this.data=(await ot(async()=>{const{default:r}=await b.import("./bundle/mock-gameplay-configs.js");return{default:r}},void 0,b.meta.url)).default,e)return this.getConfigById(e);const{latest:s,version:n,priority:i}=t??{};return n?this.getConfigByVersion(n):i?this.getConfigByPriority(i):s?this.getConfigByLatestVersion():this.getConfigByLatestVersion()}};o(Lc,"MockupHandler");let Ii=Lc;const $c=class $c extends Re{async fetchConfig(e){const{type:t}=e,s=null;switch(t){case"GameCore":break;case"Gameplay":break;default:console.warn("fetchConfig: Invalid type",t);break}return s}};o($c,"SelfHostedHandler");let bi=$c;const Wm={fetchStatus:"idle",changes:[],remoteConfigs:{GameCore:{},Gameplay:{}}},Fc=class Fc extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"enabled");f(this,"config");f(this,"handler");f(this,"timer");f(this,"handleFetchConfig",o(()=>{!this.enabled||this.getFetchStatus()==="fetching"||(this.fetchLatestConfigAsync("GameCore").then(s=>{s&&this.processUpdateConfig(s,"GameCore")}),this.fetchLatestConfigAsync("Gameplay").then(s=>{s&&this.processUpdateConfig(s,"Gameplay")}))},"handleFetchConfig"));f(this,"handleRemoteConfigUpdated",o(async t=>{if(!this.enabled)return;const{id:s,type:n}=t??{};if(this.checkChange(s,"updated"))return;const i=this.getRemoteConfig(s,n);if(!i)return;const{event:r}=this.game;r.emit(X.REQUEST_SAVE_CONFIG,i),this.pushChange(s,"updated")},"handleRemoteConfigUpdated"))}init(){const{storage:t}=this.game;t.addStorage("remoteConfig",Wm)}configure(t){this.config=t,this.enabled=this.config.Enabled,this.listenEvents(),this.createHandler(),this.initAutoFetch()}isRemoteConfigId(t){/^[a-zA-Z0-9_-]+$/.test(`${t}`)||this.exception("id","is invalid")}isRemoteConfigStored(t,s){return!!this.getRemoteConfig(t,s)}listenEvents(){const{event:t}=this.game;t.on(X.REMOTE_CONFIG_UPDATED,this.handleRemoteConfigUpdated)}createHandler(){const{ServiceType:t}=this.config;switch(t){case"mockup":this.handler=new Ii(this);break;case"firebase":this.handler=new Ai(this);break;case"selfHosted":this.handler=new bi(this);break;default:console.warn("RemoteConfigPlugin: Invalid service type"),this.enabled=!1}}initAutoFetch(){if(!this.enabled)return;const{FetchIntervalInSeconds:t}=this.config.Options;if(t<=0)return;clearInterval(this.timer);const s=1e3;this.handleFetchConfig(),this.timer=setInterval(this.handleFetchConfig,t*s)}async fetchConfigAsync(t){if(!this.enabled)return!1;try{const{id:s,type:n}=t;this.config.SupportedDataTypes.indexOf(n)===-1&&this.exception(`"${n}" type`,"is unsupported"),s&&this.isRemoteConfigStored(s,n)&&this.exception(`"${s}" id`,"is stored"),this.setFetchStatus("fetching");const i=await this.handler.fetchConfig(t);console.info("[fetchConfigAsync]",i);const r=new Me(i).toObject();let c;switch(r.type){case"GameCore":c=new Ne(r.config).toObject();break;case"Gameplay":c=new Oe(r.config).toObject();break}return r.config=c,this.setRemoteConfig(r),this.setFetchStatus("success"),r.id}catch(s){return console.warn("[fetchConfigAsync]",s),this.setFetchStatus("failure"),!1}}async fetchLatestConfigAsync(t){if(!this.enabled)return!1;try{return await this.fetchConfigAsync({type:t,conditions:{latest:!0}})}catch(s){return console.warn("[fetchLatestConfigAsync]",s),!1}}async fetchDefaultConfigAsync(t){if(!this.enabled)return!1;try{const{DefaultConfigId:s}=this.config;return this.isRemoteConfigId(s),this.fetchConfigAsync({id:s,type:t})}catch(s){return console.warn("[fetchDefaultConfigAsync]",s),!1}}processUpdateConfig(t,s){if(!this.enabled)return!1;try{const n=this.getRemoteConfig(t,s);return n||this.exception(`"${t}" id`,"is not stored"),this.checkChange(t,"updated")&&this.exception(`"${t}" id`,"is updated"),this.requestUpdateConfig(n),this.requestHotUpdate(t,n.type),this.pushChange(t,"requested"),!0}catch{return!1}}requestUpdateConfig(t){if(!this.enabled)return;const{event:s}=this.game;s.emit(X.REQUEST_UPDATE_CONFIG,t)}requestHotUpdate(t,s){if(!this.enabled)return;const{ForceReloadGame:n}=this.config.Options;if(!n)return;const{event:i}=this.game;i.emit(X.REQUEST_HOT_RELOAD,{id:t,type:s})}rollbackConfig(t,s){try{const n=this.getRemoteConfig(t,s);return n?(this.requestUpdateConfig(n),this.requestHotUpdate(t,n.type),this.pushChange(t,"rollback"),!0):!1}catch(n){return console.warn("[rollbackConfig]",n),!1}}setStorageData(t,s){const{storage:n}=this.game;n.setStorageData("remoteConfig",t,s)}getRemoteConfigs(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","remoteConfigs")}getRemoteConfig(t,s){return this.getRemoteConfigs()[s][t]||null}setRemoteConfig(t){const{id:s,type:n}=t;this.setStorageData("remoteConfigs",{[n]:{[s]:t}})}setFetchStatus(t){this.setStorageData("fetchStatus",t)}getFetchStatus(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","fetchStatus")}getChanges(){const{storage:t}=this.game;return t.getStorageData("remoteConfig","changes")}pushChange(t,s){const n={id:t,actionStatus:s},i=this.getChanges();i.push(n),this.setStorageData("changes",i)}checkChange(t,s){const n=this.getChanges();let i=null;for(let r=n.length-1;r>=0;r--)if(n[r].id===t){i=n[r];break}return i?i.actionStatus===s:!1}exception(t,s){throw new Error(`RemoteConfigPlugin: ${t} ${s}`)}};o(Fc,"RemoteConfigPlugin");let Ei=Fc;g.Dtos.RemoteConfig={Data:Me,GameCore:Ne,Gameplay:Oe},g.Dtos.Player.Data.addDefaultData({remoteConfig:{GameCore:{},Gameplay:{}}}),g.Dtos.Player.Data.addValidateFunction("remoteConfig",a=>{const{Valid:e}=g.Utils;if(!e.isObject(a))throw new Error("remoteConfig is invalid");if(!("GameCore"in a))throw new Error("remoteConfig.GameCore is invalid");if(!("Gameplay"in a))throw new Error("remoteConfig.Gameplay is invalid")});const{Utils:ch}=g,kc=class kc extends x.Plugins.BasePlugin{constructor(t){super(t);f(this,"storages");this.storages={}}addStorage(t,s){console.info("addStorage",t,s),this.storages[t]=s}setStorageData(t,s,n){let i;if(ch.Valid.isObject(n)){const r=this.getStorageData(t,s);i=ch.Object.merge(r,n)}else i=n;this.storages[t][s]=i}getStorageData(t,s){return this.getStorage(t)[s]}getStorage(t){return this.storages[t]}};o(kc,"StoragePlugin");let Di=kc;const Uc=class Uc extends x.Plugins.BasePlugin{constructor(){super(...arguments);f(this,"isVisible",!0);f(this,"browserPrefixes",["moz","ms","o","","webkit"]);f(this,"handleVisibilityChange",o(t=>{if(["focus","blur"].includes(t))return t==="focus"?this.onVisibleEvent():this.onHiddenEvent();const n=this.getBrowserPrefix();return this.getHiddenPropertyName(n)in document?this.onHiddenEvent():this.onVisibleEvent()},"handleVisibilityChange"))}init(){const t=this.getBrowserPrefix();[this.getVisibilityEvent(t),"focus","blur"].forEach(i=>{window.addEventListener(i,()=>{this.handleVisibilityChange(i)},!1),document.addEventListener(i,()=>{this.handleVisibilityChange(i)},!1)})}isGameVisible(){return this.isVisible}getHiddenPropertyName(t){return t?t+"Hidden":"hidden"}getVisibilityEvent(t){return(t||"")+"visibilitychange"}getBrowserPrefix(){for(const t of this.browserPrefixes)if(this.getHiddenPropertyName(t)in document)return t;return""}onVisibleEvent(){this.isVisible||(this.isVisible=!0,this.game.event.emit(g.Events.VISIBILITY_VISIBLE))}onHiddenEvent(){this.isVisible&&(this.isVisible=!1,this.game.event.emit(g.Events.VISIBILITY_HIDDEN))}};o(Uc,"VisibilityPlugin");let vi=Uc;const Bc=class Bc extends nl{async loadAsync(){this.exception("Unsupported method")}async showAsync(){this.exception("This method is not implemented")}async hideAsync(){this.exception("This method is not implemented")}};o(Bc,"BannerInstance");let Si=Bc;const{Status:lh}=g.Plugins.Ads,Vc=class Vc extends Si{async showAsync(){await GameSDK.loadBannerAdAsync(this.placementId),this.status=lh.SHOWING}async hideAsync(){await GameSDK.hideBannerAdAsync(this.placementId),this.status=lh.IDLE}};o(Vc,"BannerAdInstance");let Pi=Vc;const{Object:Hm}=g.Utils,{Status:lt,Types:ne,AdError:Ss,AdInstance:qm}=g.Plugins.Ads,Gc=class Gc extends qm{constructor(t,s){super(t,s);f(this,"instance");f(this,"instanceLoadFailedQueue",[]);this.instance=null}async loadAsync(){if(console.info("AdInstance","loadAsync called",{type:this.type,status:this.status}),this.status!==lt.IDLE)throw new Ss("AD_NOT_READY","Ad is not ready.");try{if(this.instance=await this.createInstanceByType(this.type),this.instance===null)throw new Ss("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");this.status=lt.LOADING,await this.instance.loadAsync(),this.status=lt.FILLED,console.info("AdInstance","loadAsync success",{type:this.type,status:this.status}),this.type===ne.INTERSTITIAL&&self.game.analytics.loadInterstitialAd(),this.type===ne.REWARDED_VIDEO&&self.game.analytics.loadRewardedVideoAd()}catch(t){throw console.warn("AdInstance","loadAsync failed",{type:this.type,status:this.status,error:t}),this.status=lt.IDLE,t instanceof Object&&"code"in t&&t.code==="INVALID_PARAM"&&(this.instance=null),this.instance&&this.instanceLoadFailedQueue.push(this.instance),self.game.analytics.loadAdFail(this.type),t}}async showAsync(){if(console.info("AdInstance","showAsync called",{type:this.type,status:this.status}),this.status!==lt.FILLED)throw new Ss("AD_NOT_FILLED","Ad is not filled.");if(this.instance===null)throw new Ss("AD_INSTANCE_NOT_INITIATED","Ad instance didn't initiated.");let t=!1;try{this.status=lt.SHOWING,await this.instance.showAsync(),t=!0,this.status=lt.IDLE,this.instance=null,console.info("AdInstance","showAsync success",{type:this.type,status:this.status})}catch(s){throw console.warn("AdInstance","showAsync failed",{type:this.type,status:this.status,error:s}),this.status=lt.FILLED,g.Utils.Object.hasOwn(s,"code")&&(s.code==="AD_NOT_LOADED"&&(this.status=lt.IDLE),["USER_INPUT","INVALID_PARAM","INVALID_OPERATION"].includes(`${s.code}`)&&(this.status=lt.IDLE,this.instance=null),s.code==="USER_INPUT"&&(t=!0)),s}finally{t?(this.type===ne.INTERSTITIAL&&self.game.analytics.showInterstitialAd(),this.type===ne.REWARDED_VIDEO&&self.game.analytics.showRewardedVideoAd()):self.game.analytics.showAdFail(this.type)}}async createInstanceByType(t){try{switch(t){case ne.REWARDED_VIDEO:return await GameSDK.getRewardedVideoAsync(this.placementId);case ne.INTERSTITIAL:return await GameSDK.getInterstitialAdAsync(this.placementId);default:return null}}catch(s){if(!Hm.hasOwn(s,"code"))throw s;return s.code==="ADS_TOO_MANY_INSTANCES"?this.getAdInstanceFailed():null}}getAdInstanceFailed(){const{length:t}=this.instanceLoadFailedQueue,s=Math.floor(Math.random()*t);return this.instanceLoadFailedQueue[s]||null}};o(Gc,"NormalAdInstance");let Ps=Gc;const{BaseAnalytics:Ym,Events:dh}=g.Plugins.Analytics,Xm=[dh.BUTTON_CLICK,dh.SCREEN_OPEN],jc=class jc extends Ym{constructor(t,s){super(t,"FacebookAnalytics",{...s,color:"#0F52BA"});f(this,"prefix");this.prefix=s.prefix}processEvent(t,s){if(!("logEvent"in GameSDK.extra)||Xm.includes(t))return;const n=this.addPrefixToEventName(t);GameSDK.extra.logEvent(n,1,s)}addPrefixToEventName(t){return`${this.prefix}_${t}`}};o(jc,"FacebookAnalytics");let Ci=jc;const{BaseAnalytics:Qm,Events:Jm}=g.Plugins.Analytics,Zm=[Jm.SCREEN_OPEN],zc=class zc extends Qm{constructor(e,t){super(e,"FirebaseAnalytics",{...t,color:"#FFCA28"})}setUser(e,t){var s;(s=this.game.firebase.services.analytics)==null||s.setUser(e,t)}processEvent(e,t){var s;Zm.indexOf(e)>=0||(s=this.game.firebase.services.analytics)==null||s.event(e,t)}};o(zc,"FirebaseAnalytics");let _i=zc;const{BaseAnalytics:tw,Events:ew}=g.Plugins.Analytics,sw=[ew.SCREEN_OPEN],Kc=class Kc extends tw{constructor(e,t){super(e,"GoogleAnalytics",{...t,color:"#E35335"})}processEvent(e,t){sw.indexOf(e)>=0||gtag("event",e,t)}};o(Kc,"GoogleAnalytics");let Ti=Kc;const nw="production",xi="5",{Dtos:aw,Events:ae,Configs:M,Utils:iw}=g,{Object:hh,Json:Le,String:uh,Valid:fh,Mark:T}=iw,Wc=class Wc extends x.Game{constructor(){super(...arguments);f(this,"markName","Core Initialize");f(this,"modulePlugins",[]);f(this,"handleProtectGameInstance",o(()=>{const t=this.event.getEventEmitCount(X.MODULE_PLUGIN_READY),s=this.modulePlugins.length;t<s||(window.game=Object.freeze(window.game))},"handleProtectGameInstance"));f(this,"initMonitorErrorPlugin",o(()=>{if(!this.monitorError)return;const{MonitorError:t}=M.Debugger,{ApiKey:s,Service:n,TrackUser:i,FilterErrors:r,ListPlayerDevIds:c}=t,l=GameSDK.player.getID(),d=GameSDK.player.getName();l&&c.includes(l)||(this.monitorError.configure({apiKey:s,service:n,trackUser:i,releaseStage:nw,buildVersion:`${xi}`}),this.monitorError.setUser({id:l,name:d}),this.monitorError.addFilterErrors(r),this.updateMonitorErrorUserAndMetadata(),this.processErrorsQueue())},"initMonitorErrorPlugin"));f(this,"updateMonitorErrorUserAndMetadata",o(()=>{if(!(this.event.getEventEmitCount(ae.PLAYER_INFO_LOADED)>0)){this.event.once(ae.PLAYER_INFO_LOADED,this.processWhenPlayerInfoLoaded);return}this.processWhenPlayerInfoLoaded()},"updateMonitorErrorUserAndMetadata"));f(this,"processErrorsQueue",o(()=>{window.__errorQueue&&(window.__errorQueue.forEach(t=>{if(this.monitorError)if(t instanceof Error)this.monitorError.sendException(t);else{const{message:s,code:n,stack:i}=t||{message:"",code:"Unknown",stack:"Unknown stack"},r=new Error(s||n);r.stack=i,this.monitorError.sendException(r)}}),window.__errorQueue=null)},"processErrorsQueue"));f(this,"processWhenPlayerInfoLoaded",o(()=>{var n,i;const{playerId:t,name:s}=this.player.getPlayer();(n=this.monitorError)==null||n.setUser({id:t,name:s}),(i=this.monitorError)==null||i.addMetadata({isFirstLogin:this.player.isFirstLogin()})},"processWhenPlayerInfoLoaded"));f(this,"handleSaveRemoteConfig",o(t=>{try{const s={[t.type]:t};this.player.setPlayerDataByName("remoteConfig",s)}catch(s){console.warn("handleSaveGameCoreConfig",s)}},"handleSaveRemoteConfig"));f(this,"handleUpdateGameCoreConfig",o(t=>{try{const{id:s,type:n}=t;if(n!=="GameCore")return;g.Configs=hh.merge(g.Configs,t.config);const{Ads:i}=g.Configs;this.ads.configure(i),this.event.emit(X.REMOTE_CONFIG_UPDATED,{id:s,type:n})}catch(s){console.warn("handleUpdateGameCoreConfig",s)}},"handleUpdateGameCoreConfig"));f(this,"handleStorageCurrentRemoteConfig",o(()=>{const t=this.player.getPlayerDataByKey("remoteConfig");if(console.info("playerRemoteConfig",Le.clone(t)),!!t){for(const s in t)if(hh.hasOwn(t,s)){const n=t[s],i=Le.clone(n);console.log("newRemoteConfig",i);const r=new aw.RemoteConfig.Data(i).toObject();console.info("remoteConfigValid",r),this.remoteConfig.setRemoteConfig(r),this.remoteConfig.processUpdateConfig(r.id,r.type)}}},"handleStorageCurrentRemoteConfig"));f(this,"initAdaptivePerformancePlugin",o(()=>{if(!this.adaptivePerformance)return;const t=Le.clone(M.AdaptivePerformance);this.adaptivePerformance.configure(t)},"initAdaptivePerformancePlugin"));f(this,"processAfterSyncProfile",o(()=>{const{Notification:t}=M;t.Enabled&&this.updatePlayerProfileToNotificationService()},"processAfterSyncProfile"))}getBuildVersion(){return parseInt(`${xi}`)}async boot(){console.groupCollapsed("🧬 GameCore Boot"),super.boot(),this.addPlugins(),this.initEventPlugin(),this.event.emit(ae.CORE_BOOTING),this.initFirebasePlugin(),this.initMarkCoreInitialize(),T.putAttr(this.markName,"Step","Init Plugins"),this.initAds(),this.initMatchPlugin(),this.initRemoteConfig(),T.putAttr(this.markName,"Step","Load Lazy Plugins"),fh.isDebugger()||this.event.on(ae.MODULE_PLUGIN_READY,this.handleProtectGameInstance),this.addMonitorPlugin().then(this.initMonitorErrorPlugin),this.addAdaptivePerformancePlugin().then(this.initAdaptivePerformancePlugin),T.putAttr(this.markName,"Step","Load Dev Plugins"),this.addDevPlugins().then(()=>{this.initConsolePlugin(),this.initProfilerPlugin(),this.initCanvasRecorderPlugin()})}async start(){console.groupEnd(),console.groupCollapsed("🧬 GameCore Start"),super.start(),T.putAttr(this.markName,"Step","Core Start"),this.event.emit(ae.CORE_STARTING),T.putAttr(this.markName,"Step","Request Token"),await this.auth.requestToken(),T.putAttr(this.markName,"Step","Init States"),await this.initState(),T.putAttr(this.markName,"Step","Process Player Profile"),this.processPlayerProfile(),T.putAttr(this.markName,"Step","Process Context Payload"),await this.context.detectContextSessionType(),this.context.detectContextGameMode();const t=this.storage.getStorageData("context","sessionContextType");T.putAttr(this.markName,"Context Mode",t),T.putAttr(this.markName,"Step","Init Analytics"),this.initGoogleAnalytics(),this.initFirebaseAnalytics(),this.initFacebookAnalytics(),T.putAttr(this.markName,"Step","Core Ready"),T.putAttr(this.markName,"Success","true"),T.stop(this.markName),this.event.emit(ae.CORE_READY)}addPlugins(){this.installPlugin("Storage",Di),this.installPlugin("Event",Zs),this.installPlugin("Ads",ks),this.installPlugin("Auth",js),this.installPlugin("Audio",Gs),this.installPlugin("Match",gi),this.installPlugin("Player",yi),this.installPlugin("Profile",wi),this.installPlugin("Context",Hs),this.installPlugin("Language",oa),this.installPlugin("Firebase",ea),this.installPlugin("Analytics",Us),this.installPlugin("Visibility",vi),this.installPlugin("Leaderboard",la),this.installPlugin("DailyRewards",Qs),this.installPlugin("FrameCapture",ra),this.installPlugin("RemoteConfig",Ei)}installPlugin(t,s,n=!1){const i=uh.toCamelCase(uh.capitalize(t));this.plugins.install(t,s,!0,i),t!=="Storage"&&(n?this.emitModulePluginReady(t):this.emitCorePluginReady(t))}async addMonitorPlugin(){const{MonitorError:t}=M.Debugger;if(!t.Enabled)return;this.modulePlugins.push("MonitorError");const s=(await ot(async()=>{const{default:n}=await b.import("./bundle/empty-script2.js");return{default:n}},void 0,b.meta.url)).default;typeof s=="function"&&this.installPlugin("MonitorError",s,!0)}async addAdaptivePerformancePlugin(){const{AdaptivePerformance:t}=M;if(!t.Enabled)return;this.modulePlugins.push("AdaptivePerformance");const s=(await ot(async()=>{const{default:n}=await b.import("./bundle/index.js");return{default:n}},void 0,b.meta.url)).default;typeof s=="function"&&this.installPlugin("AdaptivePerformance",s,!0)}async addDevPlugins(){if(!fh.isDebugger())return;const{ShowConsole:t,ShowProfiler:s,CanvasRecorder:n}=M.Debugger;if(t){this.modulePlugins.push("Console");const i=(await ot(async()=>{const{default:r}=await b.import("./bundle/console.js");return{default:r}},void 0,b.meta.url)).default;typeof i=="function"&&this.installPlugin("Console",i,!0)}if(s){this.modulePlugins.push("Profiler");const i=(await ot(async()=>{const{default:r}=await b.import("./bundle/empty-script2.js");return{default:r}},void 0,b.meta.url)).default;typeof i=="function"&&this.installPlugin("Profiler",i,!0)}if(n.Enabled){this.modulePlugins.push("CanvasRecorder");const i=(await ot(async()=>{const{default:r}=await b.import("./bundle/empty-script2.js");return{default:r}},void 0,b.meta.url)).default;typeof i=="function"&&this.installPlugin("CanvasRecorder",i,!0)}}emitCorePluginReady(t){this.event.emit(X.CORE_PLUGIN_READY,{name:t})}emitModulePluginReady(t){this.event.emit(X.MODULE_PLUGIN_READY,{name:t})}initEventPlugin(){const{EventLogging:t}=M.Debugger;t&&this.event.enableLogEvent()}initMatchPlugin(){this.match.setUseCPUProfile(!1)}initAds(){const{Ads:t}=g.Plugins;this.ads.configure(M.Ads),this.initAdInstance(t,M)}initAdInstance(t,s){const{InterstitialAdOptions:n,RewardedVideoAdOptions:i,BannerDisplayAdOptions:r}=s.Ads;n.forEach(c=>{this.ads.setAdInstance(t.Types.INTERSTITIAL,c.PlacementId,Ps)}),i.forEach(c=>{this.ads.setAdInstance(t.Types.REWARDED_VIDEO,c.PlacementId,Ps)}),r.forEach(c=>{this.ads.setAdInstance(t.Types.BANNER,c.PlacementId,Pi)})}async initState(){try{const t=new Rs(this);t.initContext(),await t.initPlayer()}catch(t){console.error("StateInitiator",t)}}initConsolePlugin(){this.console&&this.console.configure()}initProfilerPlugin(){this.profiler&&this.profiler.configure()}initCanvasRecorderPlugin(){if(!this.canvasRecorder)return;const{CanvasRecorder:t}=M.Debugger,{Type:s,Quality:n,RecordFps:i,SyncFps:r}=t.Options;this.canvasRecorder.configure({type:s,quality:n,syncFps:r,recordFps:i});const c=document.querySelector("canvas");if(!c)return console.error("Canvas not found");this.canvasRecorder.setCanvas(c)}initRemoteConfig(){const{RemoteConfig:t}=M;if(!t.Enabled)return;const s=Le.clone(t);this.remoteConfig.configure(s),this.event.on(X.REQUEST_SAVE_CONFIG,this.handleSaveRemoteConfig),this.event.on(X.REQUEST_UPDATE_CONFIG,this.handleUpdateGameCoreConfig),this.event.once(X.PLAYER_INFO_LOADED,this.handleStorageCurrentRemoteConfig)}initFirebasePlugin(){const{Firebase:t}=M;if(!t.Enabled)return;const s=Le.clone(t);this.firebase.configure(s),T.setService(this.firebase.services.performance)}initMarkCoreInitialize(){M.PerformanceMonitor.CoreFlows&&(T.measure(this.markName),T.putAttr(this.markName,"Build",`${xi}`),T.putAttr(this.markName,"GameSDK",GameSDK.getSDKName()),T.putAttr(this.markName,"Platform",GameSDK.getPlatform()),T.putAttr(this.markName,"Success","false"),T.start(this.markName))}async processPlayerProfile(){try{await this.player.syncProfileToServer(),this.processAfterSyncProfile()}catch(t){console.warn("processPlayerProfile fail",t)}}async updatePlayerProfileToNotificationService(){try{const{AppId:t}=M,s=this.player.getPlayer(),{ASID:n,playerId:i,name:r,photo:c,locale:l}=s;await Sh({appId:t,ASID:n,playerId:i,name:r,photo:c,locale:l})}catch(t){console.warn("updatePlayerProfileToNotificationService",t)}}initGoogleAnalytics(){const{Enabled:t,ConsoleLog:s}=M.Analytics.GoogleAnalytics??{};t&&this.analytics.add(new Ti(this.game,{log:!!s}))}initFirebaseAnalytics(){const{Enabled:t,ConsoleLog:s}=M.Analytics.FirebaseAnalytics??{};if(!t)return;const n=new _i(this.game,{log:!!s}),i=this.player.getPlayer(),{ASID:r,playerId:c,locale:l}=i;n.setUser(c,{ASID:r,locale:l}),this.analytics.add(n)}initFacebookAnalytics(){const{Enabled:t,Prefix:s,ConsoleLog:n}=M.Analytics.FacebookAnalytics??{};if(t){if(typeof s!="string"){console.warn("Facebook Analytics is not configured");return}this.analytics.add(new Ci(this.game,{prefix:s,log:!!n}))}}};o(Wc,"MagicGame");let Ni=Wc;const{Configs:rw,Utils:ow,Events:Oi}=g,{Device:cw}=ow,{ForceDesktopDPR:Cs}=rw.GameEngine,lw=o(async()=>{try{gtag("event","app_initialize")}catch(t){console.warn("gtag init",t)}const a=new Ni;window.game=a;const e=20;window.__sdkLoadingCount<e&&(window.__sdkLoadingCount=e),window.__gameCoreStart=!0,await a.boot(),a.event.once(Oi.REQUEST_CORE_START,ph),dw(a)},"initGame"),ph=o(()=>{if(!window.__sdkInitiated){game.event.once(Oi.GAME_SDK_READY,ph);return}window.game.start(),console.warn("Game started");const a=25;window.__sdkLoadingCount<a&&(window.__sdkLoadingCount=a)},"startGame"),dw=o(a=>{const t=setInterval(()=>{if(!window.__sdkInitiated)return;clearInterval(t);const s=10;window.__sdkLoadingCount<s&&(window.__sdkLoadingCount=s),a.event.emit(Oi.GAME_SDK_READY)},5)},"waitGameSDK");Cs!==!1&&cw.isDesktop()&&typeof Cs=="number"&&Cs>0&&(window.devicePixelRatio=Cs),lw()},"execute")}});
