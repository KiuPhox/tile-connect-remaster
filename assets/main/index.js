function _instanceof(g,E){if(null!=E&&"undefined"!=typeof Symbol&&E[Symbol.hasInstance])return!!E[Symbol.hasInstance](g);return g instanceof E}function _type_of(g){return g&&"undefined"!=typeof Symbol&&g.constructor===Symbol?"symbol":typeof g}function _ts_generator(g,E){var _,k,C,A,T={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return A={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(A[Symbol.iterator]=function(){return this}),A;function verb(g){return function(E){return step([g,E])}}function step(A){if(_)throw new TypeError("Generator is already executing.");while(T)try{if(_=1,k&&(C=2&A[0]?k.return:A[0]?k.throw||((C=k.return)&&C.call(k),0):k.next)&&!(C=C.call(k,A[1])).done)return C;if(k=0,C)A=[2&A[0],C.value];switch(A[0]){case 0:case 1:C=A;break;case 4:T.label++;return{value:A[1],done:false};case 5:T.label++;k=A[1];A=[0];continue;case 7:A=T.ops.pop();T.trys.pop();continue;default:if(C=T.trys,!(C=C.length>0&&C[C.length-1])&&(6===A[0]||2===A[0])){T=0;continue}if(3===A[0]&&(!C||A[1]>C[0]&&A[1]<C[3])){T.label=A[1];break}if(6===A[0]&&T.label<C[1]){T.label=C[1];C=A;break}if(C&&T.label<C[2]){T.label=C[2];T.ops.push(A);break}if(C[2])T.ops.pop();T.trys.pop();continue}A=E.call(g,T)}catch(g){A=[6,g];k=0}finally{_=C=0}if(5&A[0])throw A[1];return{value:A[0]?A[1]:void 0,done:true}}}System.register("chunks:///main.js",["cc"],function(g,E){var _,k,C,A,T,R,I,P,L,O,B,N,M,D,F,U,x,z,G,V,K,H,q,W,j,X,Y,J,Q,Z,$,ee,en,ei,ea,er,eo,es,el,eu,ec,eh,ep,ef,ey,ev,eg,em,eb,ew,eS,eE,e_,ek,eC,eA,eT,eR,eI,eP,eL,eO,eB,eN,eM,eD,eF,eU,ex,ez,eG,eV,eK,eH,eq,eW,ej,eX,eY,eJ,eQ,eZ,e$,e0,e1,e2;return{setters:[function(g){_=g.cclegacy,k=g._decorator,C=g.Node,A=g.Color,T=g.Canvas,R=g.UITransform,I=g.instantiate,P=g.Label,L=g.RichText,O=g.Toggle,B=g.Button,N=g.director,M=g.Component,D=g.AudioSource,F=g.resources,U=g.AudioClip,x=g.CCString,z=g.tween,G=g.Animation,V=g.CCInteger,K=g.CCFloat,H=g.Widget,q=g.Layout,W=g.view,j=g.screen,X=g.math,Y=g.isCCObject,J=g.CCBoolean,Q=g.game,Z=g.ccenum,$=g.find,ee=g.Prefab,en=g.JsonAsset,ei=g.AnimationClip,ea=g.ImageAsset,er=g.SpriteFrame,eo=g.Sprite,es=g.Enum,el=g.easing,eu=g.UIOpacity,ec=g.EventHandler,eh=g.animation,ep=g.Input,ef=g.Graphics,ey=g.profiler,ev=g.sys,eg=g.EventTarget,em=g.Vec3,eb=g.View,ew=g.ProgressBar,eS=g.Vec2,eE=g.Font,e_=g.Director,ek=g.Layers,eC=g.randomRangeInt,eA=g.pseudoRandomRangeInt,eT=g.pseudoRandom,eR=g.randomRange,eI=g.Pool,eP=g.repeat,eL=g.lerp,eO=g.approx,eB=g.EPSILON,eN=g.RealCurve,eM=g.Gradient,eD=g.bits,eF=g.random,eU=g.Material,ex=g.toRadian,ez=g.HorizontalTextAlignment,eG=g.Tween,eV=g.ParticleSystem2D,eK=g.ScrollView,eH=g.NodeEventType,eq=g.Mask,eW=g.settings,ej=g.Settings,eX=g.AssetManager,eY=g.input,eJ=g.macro,eQ=g.DynamicAtlasManager,eZ=g.ResolutionPolicy,e$=g.Texture2D,e0=g.UIRenderer,e1=g.CCObject,e2=g.Game}],execute:function(){function e(g,E){var _=Object.keys(g);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(g);E&&(k=k.filter(function(E){return Object.getOwnPropertyDescriptor(g,E).enumerable})),_.push.apply(_,k)}return _}function Me(g){for(var E=1;E<arguments.length;E++){var _=null!=arguments[E]?arguments[E]:{};E%2?e(Object(_),!0).forEach(function(E){Ge(g,E,_[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(_)):e(Object(_)).forEach(function(E){Object.defineProperty(g,E,Object.getOwnPropertyDescriptor(_,E))})}return g}function De(g,E,_,k,C,A,T){try{var R=g[A](T),I=R.value}catch(g){return void _(g)}R.done?E(I):Promise.resolve(I).then(k,C)}function Be(g){return function(){var E=this,_=arguments;return new Promise(function(k,C){var A=g.apply(E,_);function r(g){De(A,k,C,r,s,"next",g)}function s(g){De(A,k,C,r,s,"throw",g)}r(void 0)})}}function Fe(g,E){if(!_instanceof(g,E))throw new TypeError("Cannot call a class as a function")}function xe(g,E){for(var _=0;_<E.length;_++){var k=E[_];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(g,ot(k.key),k)}}function Ue(g,E,_){return E&&xe(g.prototype,E),_&&xe(g,_),Object.defineProperty(g,"prototype",{writable:!1}),g}function Ge(g,E,_){return(E=ot(E))in g?Object.defineProperty(g,E,{value:_,enumerable:!0,configurable:!0,writable:!0}):g[E]=_,g}function ze(g,E){if("function"!=typeof E&&null!==E)throw new TypeError("Super expression must either be null or a function");g.prototype=Object.create(E&&E.prototype,{constructor:{value:g,writable:!0,configurable:!0}}),Object.defineProperty(g,"prototype",{writable:!1}),E&&He(g,E)}function Ve(g){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)})(g)}function He(g,E){return(He=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,E){return g.__proto__=E,g})(g,E)}function qe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(g){return!1}}function We(){return(We=qe()?Reflect.construct.bind():function(g,E,_){var k=[null];k.push.apply(k,E);var C=new(Function.bind.apply(g,k));return _&&He(C,_.prototype),C}).apply(null,arguments)}function je(g){var E="function"==typeof Map?new Map:void 0;return(je=function(g){if(null===g||(_=g,-1===Function.toString.call(_).indexOf("[native code]")))return g;var _;if("function"!=typeof g)throw new TypeError("Super expression must either be null or a function");if(void 0!==E){if(E.has(g))return E.get(g);E.set(g,i)}function i(){return We(g,arguments,Ve(this).constructor)}return i.prototype=Object.create(g.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),He(i,g)})(g)}function Ke(g){if(void 0===g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function Ye(g,E){if(E&&("object"==(void 0===E?"undefined":_type_of(E))||"function"==typeof E))return E;if(void 0!==E)throw new TypeError("Derived constructors may only return object or undefined");return Ke(g)}function Xe(g){var E=qe();return function(){var _,k=Ve(g);if(E){var C=Ve(this).constructor;_=Reflect.construct(k,arguments,C)}else _=k.apply(this,arguments);return Ye(this,_)}}function Qe(g,E){for(;!Object.prototype.hasOwnProperty.call(g,E)&&null!==(g=Ve(g)););return g}function Je(){return(Je="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(g,E,_){var k=Qe(g,E);if(k){var C=Object.getOwnPropertyDescriptor(k,E);return C.get?C.get.call(arguments.length<3?g:_):C.value}}).apply(this,arguments)}function Ze(g,E,_,k){return(Ze="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(g,E,_,k){var C,A=Qe(g,E);if(A){if((C=Object.getOwnPropertyDescriptor(A,E)).set)return C.set.call(k,_),!0;if(!C.writable)return!1}if(C=Object.getOwnPropertyDescriptor(k,E)){if(!C.writable)return!1;C.value=_,Object.defineProperty(k,E,C)}else Ge(k,E,_);return!0})(g,E,_,k)}function $e(g,E,_,k,C){if(!Ze(g,E,_,k||g)&&C)throw new TypeError("failed to set property");return _}function et(g,E){return function(g){if(Array.isArray(g))return g}(g)||function(g,E){var _=null==g?null:"undefined"!=typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(null!=_){var k,C,A,T,R=[],I=!0,P=!1;try{if(A=(_=_.call(g)).next,0===E){if(Object(_)!==_)return;I=!1}else for(;!(I=(k=A.call(_)).done)&&(R.push(k.value),R.length!==E);I=!0);}catch(g){P=!0,C=g}finally{try{if(!I&&null!=_.return&&(T=_.return(),Object(T)!==T))return}finally{if(P)throw C}}return R}}(g,E)||nt(g,E)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(g){return function(g){if(Array.isArray(g))return it(g)}(g)||function(g){if("undefined"!=typeof Symbol&&null!=g[Symbol.iterator]||null!=g["@@iterator"])return Array.from(g)}(g)||nt(g)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nt(g,E){if(g){if("string"==typeof g)return it(g,E);var _=Object.prototype.toString.call(g).slice(8,-1);return"Object"===_&&g.constructor&&(_=g.constructor.name),"Map"===_||"Set"===_?Array.from(g):"Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_)?it(g,E):void 0}}function it(g,E){(null==E||E>g.length)&&(E=g.length);for(var _=0,k=new Array(E);_<E;_++)k[_]=g[_];return k}function at(g,E){var _="undefined"!=typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(!_){if(Array.isArray(g)||(_=nt(g))||E&&g&&"number"==typeof g.length){_&&(g=_);var k=0,a=function(){};return{s:a,n:function(){return k>=g.length?{done:!0}:{done:!1,value:g[k++]}},e:function(g){throw g},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var C,A=!0,T=!1;return{s:function(){_=_.call(g)},n:function(){var g=_.next();return A=g.done,g},e:function(g){T=!0,C=g},f:function(){try{A||null==_.return||_.return()}finally{if(T)throw C}}}}function ot(g){var E=function(g,E){if("object"!=(void 0===g?"undefined":_type_of(g))||null===g)return g;var _=g[Symbol.toPrimitive];if(void 0!==_){var k=_.call(g,E||"default");if("object"!=(void 0===k?"undefined":_type_of(k)))return k;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===E?String:Number)(g)}(g,"string");return"symbol"==(void 0===E?"undefined":_type_of(E))?E:String(E)}function rt(g,E,_,k){_&&Object.defineProperty(g,E,{enumerable:_.enumerable,configurable:_.configurable,writable:_.writable,value:_.initializer?_.initializer.call(k):void 0})}function st(g,E,_,k,C){var A={};return Object.keys(k).forEach(function(g){A[g]=k[g]}),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=_.slice().reverse().reduce(function(_,k){return k(g,E,_)||_},A),C&&void 0!==A.initializer&&(A.value=A.initializer?A.initializer.call(C):void 0,A.initializer=void 0),void 0===A.initializer&&(Object.defineProperty(g,E,A),A=null),A}var g,e4,e3,e5,e6,e8,e9,e7;_._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var te=k.ccclass,tn=k.property;g=te("internal.DebugViewRuntimeControl"),e4=tn(C),e3=tn(C),e5=tn(C),g((e8=st((e6=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"compositeModeToggle",e8,Ke(g)),rt(g,"singleModeToggle",e9,Ke(g)),rt(g,"EnableAllCompositeModeButton",e7,Ke(g)),g._single=0,g.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],g.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],g.strMisc=["CSM Layer Coloration","Lighting With Albedo"],g.compositeModeToggleList=[],g.singleModeToggleList=[],g.miscModeToggleList=[],g.textComponentList=[],g.labelComponentList=[],g.textContentList=[],g._currentColorIndex=0,g.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],g.color=[A.WHITE,A.BLACK,A.RED,A.GREEN,A.BLUE],g}return Ue(n,[{key:"start",value:function(){if(this.node.parent.getComponent(T)){var g=this.node.parent.getComponent(R),E=.5*g.width,_=.5*g.height,k=.1*E-E,C=_-.1*_,N=this.node.getChildByName("MiscMode"),M=I(N);M.parent=this.node,M.name="Buttons";var D=I(N);D.parent=this.node,D.name="Titles";for(var F=0;F<2;F++){var U=I(this.EnableAllCompositeModeButton.getChildByName("Label"));U.setPosition(k+(F>0?450:150),C,0),U.setScale(.75,.75,.75),U.parent=D;var x=U.getComponent(P);x.string=F?"----------Composite Mode----------":"----------Single Mode----------",x.color=A.WHITE,x.overflow=0,this.labelComponentList[this.labelComponentList.length]=x}C-=20;for(var z=0,G=0;G<this.strSingle.length;G++,z++){G===this.strSingle.length>>1&&(k+=200,z=0);var V=G?I(this.singleModeToggle):this.singleModeToggle;V.setPosition(k,C-20*z,0),V.setScale(.5,.5,.5),V.parent=this.singleModeToggle.parent;var K=V.getComponentInChildren(L);K.string=this.strSingle[G],this.textComponentList[this.textComponentList.length]=K,this.textContentList[this.textContentList.length]=K.string,V.on(O.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[G]=V}k+=200,this.EnableAllCompositeModeButton.setPosition(k+15,C,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(B.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=M;var H=this.EnableAllCompositeModeButton.getComponentInChildren(P);this.labelComponentList[this.labelComponentList.length]=H;var q=I(this.EnableAllCompositeModeButton);q.setPosition(k+90,C,0),q.setScale(.5,.5,.5),q.on(B.EventType.CLICK,this.changeTextColor,this),q.parent=M,(H=q.getComponentInChildren(P)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=H;var W=I(this.EnableAllCompositeModeButton);W.setPosition(k+200,C,0),W.setScale(.5,.5,.5),W.on(B.EventType.CLICK,this.hideUI,this),W.parent=this.node.parent,(H=W.getComponentInChildren(P)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=H,this.hideButtonLabel=H,C-=40;for(var j=0;j<this.strMisc.length;j++){var X=I(this.compositeModeToggle);X.setPosition(k,C-20*j,0),X.setScale(.5,.5,.5),X.parent=N;var Y=X.getComponentInChildren(L);Y.string=this.strMisc[j],this.textComponentList[this.textComponentList.length]=Y,this.textContentList[this.textContentList.length]=Y.string,X.getComponent(O).isChecked=!!j,X.on(O.EventType.TOGGLE,j?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[j]=X}C-=150;for(var J=0;J<this.strComposite.length;J++){var Q=J?I(this.compositeModeToggle):this.compositeModeToggle;Q.setPosition(k,C-20*J,0),Q.setScale(.5,.5,.5),Q.parent=this.compositeModeToggle.parent;var Z=Q.getComponentInChildren(L);Z.string=this.strComposite[J],this.textComponentList[this.textComponentList.length]=Z,this.textContentList[this.textContentList.length]=Z.string,Q.on(O.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[J]=Q}}else console.error("debug-view-runtime-control should be child of Canvas")}},{key:"isTextMatched",value:function(g,E){var _=new String(g),k=_.search(">");return -1===k?g===E:(_=(_=_.substr(k+1)).substr(0,_.search("<")))===E}},{key:"toggleSingleMode",value:function(g){for(var E=N.root.debugView,_=g.getComponentInChildren(L),k=0;k<this.strSingle.length;k++)this.isTextMatched(_.string,this.strSingle[k])&&(E.singleMode=k)}},{key:"toggleCompositeMode",value:function(g){for(var E=N.root.debugView,_=g.getComponentInChildren(L),k=0;k<this.strComposite.length;k++)this.isTextMatched(_.string,this.strComposite[k])&&E.enableCompositeMode(k,g.isChecked)}},{key:"toggleLightingWithAlbedo",value:function(g){N.root.debugView.lightingWithAlbedo=g.isChecked}},{key:"toggleCSMColoration",value:function(g){N.root.debugView.csmLayerColoration=g.isChecked}},{key:"enableAllCompositeMode",value:function(g){var E=N.root.debugView;E.enableAllCompositeMode(!0);for(var _=0;_<this.compositeModeToggleList.length;_++)this.compositeModeToggleList[_].getComponent(O).isChecked=!0;var k=this.miscModeToggleList[0].getComponent(O);k.isChecked=!1,E.csmLayerColoration=!1,(k=this.miscModeToggleList[1].getComponent(O)).isChecked=!0,E.lightingWithAlbedo=!0}},{key:"hideUI",value:function(g){var E=this.node.getChildByName("Titles"),_=!E.active;this.singleModeToggleList[0].parent.active=_,this.miscModeToggleList[0].parent.active=_,this.compositeModeToggleList[0].parent.active=_,this.EnableAllCompositeModeButton.parent.active=_,E.active=_,this.hideButtonLabel.string=_?"Hide UI":"Show UI"}},{key:"changeTextColor",value:function(g){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var E=0;E<this.textComponentList.length;E++)this.textComponentList[E].string=this.strColor[this._currentColorIndex]+this.textContentList[E]+"</color>";for(var _=0;_<this.labelComponentList.length;_++)this.labelComponentList[_].color=this.color[this._currentColorIndex]}},{key:"onLoad",value:function(){}},{key:"update",value:function(g){}}]),n}(M)).prototype,"compositeModeToggle",[e4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e9=st(e6.prototype,"singleModeToggle",[e3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e7=st(e6.prototype,"EnableAllCompositeModeButton",[e5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e6));_._RF.pop(),_._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var ti=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,g)).audioSource=_,k}return Ue(n,[{key:"play",value:function(g){if(g){var E=g.volume,_=void 0===E?1:E,k=g.loop,C=void 0!==k&&k;this.audioSource.volume=_,this.audioSource.loop=C}this.audioSource.play()}},{key:"pause",value:function(){this.audioSource.pause()}},{key:"resume",value:function(){this.audioSource.state===D.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function(){this.audioSource.stop()}},{key:"setVolume",value:function(g){this.audioSource.volume=g}},{key:"getVolume",value:function(){return this.audioSource.volume}},{key:"getAudioSource",value:function(){return this.audioSource}}]),n}(GameCore.Plugins.Audio.BaseAudioPlayer);_._RF.pop(),_._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var ta=GameCore,tr=ta.Plugins.Audio.BaseChannelManager,to=ta.Utils.Array,ts=function(g){ze(i,g);var E,_=Xe(i);function i(g,E){var k;return Fe(this,i),(k=_.call(this,E)).allowMultipleTracking={},k.handleLoadedAudio=function(g,E){var _=k.node.addComponent(D);return _.clip=E,_.playOnAwake=!1,new ti(g,_)},k.node=g,k}return Ue(i,[{key:"playing",value:function(g){var E,_=null===(E=this.getAudioClip(g))||void 0===E?void 0:E.audioPlayer;return!!_&&_.getAudioSource().state===D.AudioState.PLAYING}},{key:"onLoadAudio",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(E){_=this;return[2,new Promise(function(E,k){F.load(g,U,function(C,A){try{if(C)throw new Error(C.message);if(!_.node.isValid)return;var T=_.handleLoadedAudio(g,A);E(T)}catch(g){_instanceof(g,Error)?k(g):k(new Error("Audio load: Unknown error"))}})})]})}),function(g,_){return E.apply(this,arguments)})},{key:"playWithRealConfig",value:function(g,E){if(this.isCanPlay(E)){if(E){var _=E.volume,k=void 0===_?1:_,C=E.allowMultiple,A=void 0!==C&&C;if(E.volume=this.getVolume()*k,A){var T=g.getAudioSource().clip;if(!T)return;return void this.requestDuplicateAudioPlayer(g.getKey(),T,E).play(E)}}g.play(E)}}},{key:"isCanPlay",value:function(g){var E=this;if(g){var _=g.checkList;if((void 0===_?[]:_).some(function(g){var _=E.getAudioClip(g);return!!_&&_.audioPlayer.getAudioSource().state===D.AudioState.PLAYING}))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function(g,E,_){var k=this.getDuplicateAudioFromPool(g);if(k){if(_){var C=k.key,A=_.volume,T=void 0===A?1:A;this.setAudioClip(C,{volume:T})}return k.audioPlayer}var R="".concat(g,"_").concat(this.allowMultipleTracking[g].currentPostFix),I=this.handleLoadedAudio(R,E);return this.allowMultipleTracking[g].list.push({audioPlayer:I,key:R}),this.allowMultipleTracking[g].currentPostFix+=1,this.setAudioClip(R,{audioPlayer:I,volume:1}),I}},{key:"getDuplicateAudioFromPool",value:function(g){if(this.allowMultipleTracking[g]){var E=this.allowMultipleTracking[g].list,_=to.search(E,function(g){return g.audioPlayer.getAudioSource().state!==D.AudioState.PLAYING});if(_)return _}else this.allowMultipleTracking[g]={currentPostFix:1,list:[]};return null}}]),i}(tr);_._RF.pop();var tl,tu,tc,th,tp,tf=!1;_._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var ty,tv,tg,tm,tb,tw=k.ccclass,tS=k.property,tE=globalThis.game,t_=tE.audio,tk=tE.player,tC=(tl=tw("Music"),tu=tS(x),tl((tp=st((th=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"channelId",tp,Ke(g)),g.channel=null,g.isMute=!1,g.volume=1,g}return Ue(n,[{key:"__preload",value:function(){this.makePersistent(),this.channel=new ts(this.node,this.channelId),t_.addChannel(this.channel)}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"playing",value:function(g){var E,_;return null!==(E=null===(_=this.channel)||void 0===_?void 0:_.playing(g))&&void 0!==E&&E}},{key:"play",value:function(g,E){if(!this.isMusicEnable())return Promise.resolve();var _=null!=E?E:{};return _.loop||(_.loop=!0),t_.play(g,_,this.channelId)}},{key:"isMusicEnable",value:function(){return!!tk.getPlayerSetting("music")}},{key:"setVolume",value:function(g){this.volume=g,this.isMute||t_.setVolume(g,this.channelId)}},{key:"getVolume",value:function(){return t_.getVolume(this.channelId)}},{key:"pause",value:function(g){t_.pause(g,this.channelId)}},{key:"resume",value:function(g){this.isMusicEnable()&&t_.resume(g,this.channelId)}},{key:"stop",value:function(g){t_.stop(g,this.channelId)}},{key:"mute",value:function(g){this.isMute=g,g?t_.mute(this.channelId):(this.setVolume(this.volume),t_.unmute(this.channelId))}}]),n}(M)).prototype,"channelId",[tu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),tc=th))||tc);_._RF.pop(),_._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var tA=k.ccclass,tT=k.property,tR=globalThis.game,tI=tR.audio,tP=tR.player,tL=(ty=tA("Sound"),tv=tT(x),ty((tb=st((tm=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"channelId",tb,Ke(g)),g.channel=null,g}return Ue(n,[{key:"__preload",value:function(){this.channel=new ts(this.node,this.channelId),tI.addChannel(this.channel)}},{key:"onLoad",value:function(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"removePersistent",value:function(){N.removePersistRootNode(this.node)}},{key:"play",value:function(g,E){return this.isSoundEnable()?tI.play(g,E,this.channelId):Promise.resolve()}},{key:"isSoundEnable",value:function(){return!!tP.getPlayerSetting("sound")}},{key:"setVolume",value:function(g){tI.setVolume(g,this.channelId)}},{key:"pause",value:function(g){tI.pause(g,this.channelId)}},{key:"resume",value:function(g){this.isSoundEnable()&&tI.resume(g,this.channelId)}},{key:"stop",value:function(g){tI.stop(g,this.channelId)}},{key:"stopAll",value:function(){tI.stopAll(this.channelId)}},{key:"mute",value:function(g){g?tI.mute(this.channelId):tI.unmute(this.channelId)}}]),n}(M)).prototype,"channelId",[tv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),tg=tm))||tg);_._RF.pop(),_._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);var tO,tB,tN,tM,tD,tF,tU,tx,tz,tG,tV,tK,tH,tq,tW,tj,tX,tY,tJ,tQ,tZ=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"elasticOut",value:function(g,E,_){var k=E||.1,C=_||.1;if(0===g)return 0;if(1===g)return 1;var A=C/4;return k<1?k=1:A=C*Math.asin(1/k)/(2*Math.PI),k*Math.pow(2,-10*g)*Math.sin(2*Math.PI*(g-A)/C)+1}},{key:"easeOutExpo",value:function(g){return 1===g?1:1-Math.pow(2,-10*g)}},{key:"easeInExpo",value:function(g){return 0===g?0:Math.pow(2,10*g-10)}},{key:"runTweenAsync",value:function(g,E){return new Promise(function(_){var k=g.call(function(){_({tween:g})}).start();E&&(E.aborted?(k.stop(),_({tween:g})):E.addAbortListener(function(){k.stop(),_({tween:g})}))})}},{key:"runOnUpdateAsync",value:function(g,E,_,k){return new Promise(function(C,A){var T=z(g).to(E,{},{onUpdate:function(g,E){if(void 0!==E)try{_(E)}catch(g){A(_instanceof(g,Error)?g:new Error(JSON.stringify(g)))}}}).call(function(){C({tween:T})}).start();k&&(k.aborted?(T.stop(),C({tween:T})):k.addAbortListener(function(){T.stop(),C({tween:T})}))})}},{key:"waitTweenAsync",value:function(g,E){return new Promise(function(_){var k=z({});k.delay(g),k.call(function(){_()}),k.start(),E&&(E.aborted?(k.stop(),_()):E.addAbortListener(function(){k.stop(),_()}))})}},{key:"runAnimationAsync",value:function(g,E,_){return void 0===_?new Promise(function(_){g.play(E),g.once(G.EventType.FINISHED,_)}):_.aborted?Promise.resolve():new Promise(function(k){_.addAbortListener(function(){g.off(G.EventType.FINISHED,k),g.stop(),k()}),g.play(E),g.once(G.EventType.FINISHED,k)})}}]),e}();_._RF.pop(),_._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var t$=k.ccclass,t0=k.property,t1=(tO=t$("AutoLayoutWrappee"),tB=t0({type:R}),tN=t0({type:R}),tO((tF=st((tD=Ue(function e(){Fe(this,e),rt(this,"wrapeeContainer",tF,this),rt(this,"wrapee",tU,this)})).prototype,"wrapeeContainer",[tB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tU=st(tD.prototype,"wrapee",[tN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tM=tD))||tM),t2=(tx=t$("AutoLayout"),tz=t0({displayName:"Use Auto Layout"}),tG=t0({type:[t1],displayName:"Children",visible:function(){return this.useAutoLayout}}),tV=t0({visible:!1,serializable:!0}),tK=t0({type:V,displayName:"Selected Index",visible:function(){return this.useAutoLayout}}),tH=t0({type:K,displayName:"Deselected Icon Width",group:"Edge Icons",visible:function(){return this.useAutoLayout}}),tq=t0({visible:!1,serializable:!0}),tx((tX=st((tj=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"useAutoLayout",tX,Ke(g)),rt(g,"children",tY,Ke(g)),g.mappedChildren=[],rt(g,"selected",tJ,Ke(g)),rt(g,"deselectedIconW",tQ,Ke(g)),g.tweens=[],g}return Ue(i,[{key:"selectedIndex",get:function(){return this.selected},set:function(g){this.selected=g,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(g){this.deselectedIconW=g,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map(function(g){var E=g.wrapeeContainer.getComponent(H);if(!E)throw new Error("AutoLayout: Widget component not found");return Me(Me({},g),{},{wrapeeContainerWidget:E})})}},{key:"updateLayout",value:function(g){var E=arguments.length>0&&void 0!==g&&g;if(this._layoutDirty||E){this.updateChildrenAnchors();var _,k=at(this.mappedChildren);try{for(k.s();!(_=k.n()).done;){var C=_.value;C.wrapeeContainerWidget.updateAlignment()}}catch(g){k.e(g)}finally{k.f()}}Je(Ve(i.prototype),"updateLayout",this).call(this,E)}},{key:"getSelectedWorldX",value:function(){var g=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?g.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*g.width:g.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(g){if(g<this.selectedIndex)return 0;if(g>this.selectedIndex)return 1;if(0===g){var E=this.mappedChildren[g].wrapeeContainer.width,_=this.deselectedIconWidth/2,k=this.paddingLeft;return((k+E+(E-_+this.spacingX))/2-k)/E}if(g===this.children.length-1){var C=this.mappedChildren[g].wrapeeContainer.width,A=C-this.deselectedIconWidth/2+this.spacingX;return((A+C+this.paddingRight)/2-A)/C}return .5}},{key:"updateChildrenAnchors",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=this,_=at(this.tweens);try{for(_.s();!(g=_.n()).done;)g.value.stop()}catch(g){_.e(g)}finally{_.f()}this.tweens=[];return[4,Promise.all([this.children.flatMap(function(g,_){return E.getChildrenAnchorsTweens(g,E.getAnchorX(_))}).map(function(g){return tZ.runTweenAsync(g)})])];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var g=this;this.children.forEach(function(E,_){var k=g.getAnchorX(_);E.wrapee.setAnchorPoint(k,E.wrapee.anchorY),E.wrapeeContainer.setAnchorPoint(k,E.wrapeeContainer.anchorY)})}},{key:"getChildrenAnchorsTweens",value:function(g,E){return[z(g.wrapee).to(.3,{anchorX:E},{easing:"sineInOut"}).call(function(){g.wrapee.setAnchorPoint(E,g.wrapee.anchorY)}),z(g.wrapeeContainer).to(.3,{anchorX:E},{easing:"sineInOut"}).call(function(){g.wrapeeContainer.setAnchorPoint(E,g.wrapeeContainer.anchorY)})]}}]),i}(q)).prototype,"useAutoLayout",[tz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),tY=st(tj.prototype,"children",[tG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tJ=st(tj.prototype,"selected",[tV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),st(tj.prototype,"selectedIndex",[tK],Object.getOwnPropertyDescriptor(tj.prototype,"selectedIndex"),tj.prototype),st(tj.prototype,"deselectedIconWidth",[tH],Object.getOwnPropertyDescriptor(tj.prototype,"deselectedIconWidth"),tj.prototype),tQ=st(tj.prototype,"deselectedIconW",[tq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tW=tj))||tW);_._RF.pop(),_._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);var t4="view-resize",t3="view-resized",t5="request-view-resize",t6="layout-changed",t8="gameplay-update-config",t9="opened-skip-overlay",t7="closed-skip-overlay",ne="result-scene-replay",nn="result-scene-home",ni="upgrade-dynamic-atlas",na="asset-quality-change",nr="change-quality-assets",no="widget-resized";_._RF.pop(),_._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);var ns=function(){function e(){Fe(this,e)}return Ue(e,[{key:"getWindowSizeVsWorldGameRatio",value:function(){var g=W.getVisibleSize(),E=j.windowSize.width,_=window.devicePixelRatio;return E/(_=_>2?2:_)/g.width}},{key:"getBoundingBoxTo",value:function(g,E){var _=X.mat4();X.Mat4.fromSRT(_,E.getRotation(),E.getPosition(),E.getScale());var k=E.getComponent(R);if(!k)throw new Error("Node must have UITransform component");var C=k.anchorPoint,A=k.contentSize,T=A.width,I=A.height,P=new X.Rect(-C.x*T,-C.y*I,T,I),L=X.mat4();if(X.Mat4.multiply(L,g,_),P.transformMat4(L),!E.children||0===E.children.length)return P;var O,B=E.children,N=E.getWorldMatrix(),M=at(B);try{for(M.s();!(O=M.n()).done;){var D=O.value;if(null!=D&&D.active){if(D.getComponent(R)){var F=this.getBoundingBoxTo(N,D);F&&X.Rect.union(P,P,F)}}}}catch(g){M.e(g)}finally{M.f()}return P}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getBoundingBoxToWorld",value:function(g){if(g.parent){var E=g.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(E,g)}var _=g.getComponent(R);if(!_)throw new Error("Node must have UITransform component");return _.getBoundingBox()}},{key:"worldSizeToCssSize",value:function(g){return g*this.inst.getWindowSizeVsWorldGameRatio()}},{key:"cssSizeToWorldSize",value:function(g){return g/this.inst.getWindowSizeVsWorldGameRatio()}},{key:"getScreenWidthCss",value:function(){var g=document,E=g.body,_=g.documentElement,k=E.clientWidth,C=_.clientWidth;return Math.max(C,k)||0}},{key:"getScreenHeightCss",value:function(){var g=document,E=g.body,_=g.documentElement,k=E.clientHeight,C=_.clientHeight;return Math.max(C,k)||0}}]),e}();_._RF.pop(),_._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);var nl,nu,nc,nh,np=GameCore.Utils,nf=np.Array,ny=np.Object,nv=np.Valid,ng=np.String,nm=globalThis.game.monitorError,nb="compUtils",nw="".concat(nb,"_validateProperty"),jn=function(g){return"".concat(nw,"_").concat(ng.capitalize(g))},nS="".concat(nb,"_getComponent"),nE=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"".concat(g," is missing the required property: <").concat(_,">"))).className=g,k.propertyName=_,k}return Ue(n)}(je(Error)),n_=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"".concat(g," is missing these required properties: [").concat(_.map(function(g){return g.propertyName}).join(", "),"]"))).className=g,k.errors=_,k}return Ue(n)}(je(Error)),nk=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"],nC=function(){function e(){Fe(this,e),this.validComponentCalled={}}return Ue(e,[{key:"validateRequiredComponents",value:function(g){var E,_=g.name,k=g.constructor,C=at(this.getRequiredComponentNames(k));try{for(C.s();!(E=C.n()).done;){var A=E.value;if(!g.getComponent(A))throw new Error("".concat(_,": Missing required ").concat(A," component"))}}catch(g){C.e(g)}finally{C.f()}}},{key:"validateRequiredProperties",value:function(g){var E,_=g.name,k=g.constructor,C=at(this.getRequiredPropNames(k));try{for(C.s();!(E=C.n()).done;){var A=E.value;if(!ny.hasOwn(g,A))throw new Error("".concat(_,": Missing required ").concat(A," property"));var T=this.getProperty(A,g);if(!Y(T))throw new Error("".concat(_,": ").concat(A," property is not a cc object"))}}catch(g){C.e(g)}finally{C.f()}}},{key:"validateCustomProperties",value:function(g){var E,_=g.name,k=at(this.getCustomPropNames(g));try{for(k.s();!(E=k.n()).done;){var C=E.value;if(!ny.hasOwn(g,C))throw new Error("".concat(_,": Missing required ").concat(C," property"));var A=this.getProperty(C,g);if(!Y(A))throw new Error("".concat(_,": ").concat(C," property is not a cc object"))}}catch(g){k.e(g)}finally{k.f()}}},{key:"getProperty",value:function(g,E){var _;if(ny.hasOwn(E,g))return(null!==(_=Object.getOwnPropertyDescriptor(E,g))&&void 0!==_?_:{}).value}},{key:"getProps",value:function(g){if(!ny.hasOwn(g,"__props__"))return[];var E=g.__props__;return Array.isArray(E)?E:[]}},{key:"getRequiredPropNames",value:function(g){return this.getProps(g).filter(function(E){return"node"!==E&&!!ny.hasOwn(g,E)&&!!Y(g[E])&&!E.startsWith("_")})}},{key:"getBaseComponentName",value:function(g){for(var E=0,_=nk;E<_.length;E++){var k=_[E];if(k.indexOf(g)>=0)return k}return g}},{key:"getRequiredComponentNames",value:function(g){var E=this;if(!ny.hasOwn(g,"_requireComponent"))return[];var _=g._requireComponent;return Array.isArray(_)?_.map(function(g){return E.getBaseComponentName(g)}):[]}},{key:"getCustomPropNames",value:function(g){var E=this,_=Object.keys(g),k=this.getProps(g.constructor);return nf.difference(_,k).filter(function(g){return g.indexOf("_")<0}).filter(function(_){if(!ny.hasOwn(g,_))return!1;var k=E.getProperty(_,g);return!(!nv.isObject(k)||!Y(k))})}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"required",value:function(g){var E=arguments.length>0&&void 0!==g?g:"both",t=function(g){if("function"==typeof E)return E(g);switch(E){case"null-check":return null!==g;case"undefined-check":return void 0!==g;case"both":return null!=g;default:return!1}};return function(g,E){if("function"==typeof g)throw new Error("The required decorator can only be applied to non-static class properties.");var _=jn(E);if(void 0!==g[_])throw new Error("The required decorator found that property name ".concat(_," already exists. The reserved method name ").concat(_," is used already or the decorator was applied multiple times."));g[_]=function(g){if(!t(this[E]))throw new nE(g,E)}}}},{key:"validateDecoratedProperties",value:function(g){var E,_=g.constructor.name,k=[],C=g;for(var A in C)if("function"==typeof C[A]&&(E=A,ng.matchStart(E,nw)))try{C[A]()}catch(g){if(_instanceof(g,nE)){k.push(g);continue}throw g}if(0!==k.length){var T=new n_(_,k);if(nv.isDebugger())throw T;console.error(T),null==nm||nm.sendException(T,{componentName:T.className,missingProperties:T.errors.map(function(g){return g.propertyName})})}}},{key:"getComponent",value:function(g){return function(E,_){if("function"==typeof E)throw new Error("The getComponent decorator can only be applied to non-static class properties.");var k,C=(k=_,"".concat(nS,"_").concat(ng.capitalize(k)));if(void 0!==E[C])throw new Error("The getComponent decorator found that property name ".concat(C," already exists. The reserved method name ").concat(C," is used already or the decorator was applied multiple times."));E[C]=function(E){E[_]=E.getComponent(g)}}}},{key:"getDecoratedComponent",value:function(g){var E,_=g;for(var k in _)"function"==typeof _[k]&&(E=k,ng.matchStart(E,nS)&&_[k](g))}},{key:"onlyRunInLifeCycle",value:function(g,E,_){var k=_.value;_.value=function(){if(this.enabledInHierarchy){for(var g=arguments.length,_=new Array(g),C=0;C<g;C++)_[C]=arguments[C];return k.apply(this,_)}console.info("Skipping method call ".concat(String(E)," because component ").concat(this.constructor.name," is not enabled in hierarchy"))}}},{key:"onlyRunInLifeCycleAsync",value:function(g,E,_){var k=_.value,C=function(){var g=Be(function(){var g,_,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:if(!this.enabledInHierarchy)return[3,2];for(g=A.length,_=new Array(g),C=0;C<g;C++)_[C]=A[C];return[4,k.apply(this,_)];case 1:return[2,T.sent()];case 2:return[2,(console.info("Skipping method call ".concat(String(E)," because component ").concat(this.constructor.name," is not enabled in hierarchy")),Promise.resolve())]}})});return function(){return g.apply(this,arguments)}}();_.value=C}},{key:"decorateComponent",value:function(g){this.getDecoratedComponent(g),this.validateDecoratedProperties(g)}},{key:"lazyValidateProperties",value:function(g,E){var _=!(arguments.length>1&&void 0!==E)||E;if(_){var k=g.constructor,C=k.name;if(!this.inst.validComponentCalled[C])try{this.inst.validateRequiredComponents(g),this.inst.validateRequiredProperties(g),this.inst.validateCustomProperties(g)}catch(E){g.enabled=!1,console.error(E)}finally{this.inst.validComponentCalled[C]=!0}}}}]),e}();_._RF.pop(),_._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);var nA=k.ccclass,nT=k.property;nl=nA("Background"),nu=nT(J),nl((nh=st((nc=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"fitHeight",nh,Ke(g)),g.resize=function(){if(g.fitHeight){var E=ns.cssSizeToWorldSize(ns.getScreenHeightCss());g.uiTransform.width=E*g.ratio,g.uiTransform.height=E}},g}return Ue(n,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.ratio=this.uiTransform.width/this.uiTransform.height,this.validateRequiredComponents(),this.listenGameEvents(),this.resize()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t3,this.resize)}},{key:"unlistenGameEvents",value:function(){Q.off(t3,this.resize)}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}}]),n}(M)).prototype,"fitHeight",[nu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nc));_._RF.pop(),_._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var nR="STARS_UPDATED",nI="PLAY_BUTTON_PRESS",nP="REQUEST_NAVIGATION",nL="REQUEST_NAVIGATION_ANIMATION",nO="DASHBOARD_EVENTS_BUTTON_PRESS";_._RF.pop(),_._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var nB=function(g){return g[g.store=0]="store",g[g.collections=1]="collections",g[g.home=2]="home",g[g.leaderboard=3]="leaderboard",g[g.tournaments=4]="tournaments",g}(nB||{});Z(nB),_._RF.pop(),_._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);var nN=GameCore.Utils.Array,nM=function(){function e(){Fe(this,e),this.callbacks=[],this.isAborted=!1,this.abortReason="",this.callbacks=[]}var g;return Ue(e,[{key:"aborted",get:function(){return this.isAborted}},{key:"reason",get:function(){return this.abortReason}},{key:"addAbortListener",value:function(g){this.callbacks.push(g)}},{key:"removeAbortListener",value:function(g){var E=nN.searchIndex(this.callbacks,function(E){return E===g});-1!==E?this.callbacks.splice(E,1):console.warn("Abort listener not found")}},{key:"abort",value:function(g){if(!this.isAborted){this.isAborted=!0,this.abortReason=g;var E,_=at(this.callbacks);try{for(_.s();!(E=_.n()).done;){var k=E.value;"function"==typeof k&&k()}}catch(g){_.e(g)}finally{_.f()}this.callbacks=[]}}},{key:"untilAborted",value:(g=Be(function(){var g;return _ts_generator(this,function(E){g=this;if(!this.isAborted)return[2,new Promise(function(E){g.addAbortListener(function(){return E()})})];return[2]})}),function(){return g.apply(this,arguments)})},{key:"call",value:function(g){this.aborted||g(this)}},{key:"callAsync",value:function(g){return this.aborted?Promise.resolve():g(this)}},{key:"chain",value:function(g){var E=this;_instanceof(g,e)?g.addAbortListener(function(){return E.abort()}):g.addEventListener("abort",function(){return E.abort()})}}],[{key:"hasBeenAborted",value:function(g){return null==g||g.aborted}}]),e}();_._RF.pop(),_._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var nD=function(g){return g.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",g.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",g.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",g.CLOUD_IDLE_ANIM="animations/CloudIdle",g.TORNADO_IDLE_ANIM="animations/TornadoIdle",g.TILE_BREAK_ANIM="animations/TileBreak",g.TILE_CLEAR_ANIM="animations/TileClear",g.TILE_SHAKE_ANIM="animations/TileShake",g.TILE_SKIN_FOLDER="loadable/tiles",g.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",g.ITEM_POPUP_FOLDER="loadable/item-popup",g.SUMMER_BG="images/bg/summer",g.AUTUMN_BG="images/bg/autumn",g.WINTER_BG="images/bg/winter",g.FLOWER_FIELD_BG="images/bg/flower-field",g.TREE_PLANTING_FESTIVAL_BG="images/bg/tree-planting-festival",g.MUSIC_FESTIVAL_BG="images/bg/music-festival",g.HARVEST_FESTIVAL_BG="images/bg/harvest-festival",g.FOOD_FESTIVAL_BG="images/bg/food-festival",g.LIGHT_FESTIVAL_BG="images/bg/light-festival",g.PEACE_FESTIVAL_BG="images/bg/peace-festival",g.FLOWER_FESTIVAL_BG="images/bg/flower-festival",g.STREET_FESTIVAL_BG="images/bg/street-festival",g.COLOR_GARDEN_BG="images/bg/color-garden",g.COLOR_FESTIVAL_BG="images/bg/color-festival",g.NATURE_SUMMER_BG="images/bg/nature-summer",g.SNOW_MOUNTAIN_BG="images/bg/snow-mountain",g.ICE_FESTIVAL_BG="images/bg/ice-festival",g.NIGHT_FESTIVAL_BG="images/bg/night-festival",g.LOST_FESTIVAL_BG="images/bg/lost-festival",g.HALLOWEEN_BG="images/bg/halloween",g.CHRISTMAS_BG="images/bg/christmas",g.SPRING_FLOWER_FESTIVAL_BG="images/bg/spring-flower-festival",g.TET_HOLIDAY_BG="images/bg/tet-holiday",g.SEA_FESTIVAL_BG="images/bg/sea-festival",g.FIREWORK_FESTIVAL_BG="images/bg/firework-festival",g.SUMMER_BG_PREVIEW="images/preview/summer",g.AUTUMN_BG_PREVIEW="images/preview/autumn",g.WINTER_BG_PREVIEW="images/preview/winter",g.FLOWER_FIELD_BG_PREVIEW="images/preview/flower-field",g.TREE_PLANTING_FESTIVAL_BG_PREVIEW="images/preview/tree-planting-festival",g.MUSIC_FESTIVAL_BG_PREVIEW="images/preview/music-festival",g.HARVEST_FESTIVAL_BG_PREVIEW="images/preview/harvest-festival",g.FOOD_FESTIVAL_BG_PREVIEW="images/preview/food-festival",g.LIGHT_FESTIVAL_BG_PREVIEW="images/preview/light-festival",g.PEACE_FESTIVAL_BG_PREVIEW="images/preview/peace-festival",g.FLOWER_FESTIVAL_BG_PREVIEW="images/preview/flower-festival",g.STREET_FESTIVAL_BG_PREVIEW="images/preview/street-festival",g.COLOR_GARDEN_BG_PREVIEW="images/preview/color-garden",g.COLOR_FESTIVAL_BG_PREVIEW="images/preview/color-festival",g.NATURE_SUMMER_BG_PREVIEW="images/preview/nature-summer",g.SNOW_MOUNTAIN_BG_PREVIEW="images/preview/snow-mountain",g.ICE_FESTIVAL_BG_PREVIEW="images/preview/ice-festival",g.NIGHT_FESTIVAL_BG_PREVIEW="images/preview/night-festival",g.LOST_FESTIVAL_BG_PREVIEW="images/preview/lost-festival",g.HALLOWEEN_BG_PREVIEW="images/preview/halloween",g.CHRISTMAS_BG_PREVIEW="images/preview/christmas",g.SPRING_FLOWER_FESTIVAL_BG_PREVIEW="images/preview/spring-flower-festival",g.TET_HOLIDAY_BG_PREVIEW="images/preview/tet-holiday",g.SEA_FESTIVAL_BG_PREVIEW="images/preview/sea-festival",g.FIREWORK_FESTIVAL_BG_PREVIEW="images/preview/firework-festival",g.SUMMER_BG_TOURNAMENT="images/tournament/summer",g.AUTUMN_BG_TOURNAMENT="images/tournament/autumn",g.WINTER_BG_TOURNAMENT="images/tournament/winter",g.FLOWER_FIELD_BG_TOURNAMENT="images/tournament/flower-field",g.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT="images/tournament/tree-planting-festival",g.MUSIC_FESTIVAL_BG_TOURNAMENT="images/tournament/music-festival",g.HARVEST_FESTIVAL_BG_TOURNAMENT="images/tournament/harvest-festival",g.FOOD_FESTIVAL_BG_TOURNAMENT="images/tournament/food-festival",g.LIGHT_FESTIVAL_BG_TOURNAMENT="images/tournament/light-festival",g.PEACE_FESTIVAL_BG_TOURNAMENT="images/tournament/peace-festival",g.FLOWER_FESTIVAL_BG_TOURNAMENT="images/tournament/flower-festival",g.STREET_FESTIVAL_BG_TOURNAMENT="images/tournament/street-festival",g.COLOR_GARDEN_BG_TOURNAMENT="images/tournament/color-garden",g.COLOR_FESTIVAL_BG_TOURNAMENT="images/tournament/color-festival",g.NATURE_SUMMER_BG_TOURNAMENT="images/tournament/nature-summer",g.SNOW_MOUNTAIN_BG_TOURNAMENT="images/tournament/snow-mountain",g.ICE_FESTIVAL_BG_TOURNAMENT="images/tournament/ice-festival",g.NIGHT_FESTIVAL_BG_TOURNAMENT="images/tournament/night-festival",g.LOST_FESTIVAL_BG_TOURNAMENT="images/tournament/lost-festival",g.HALLOWEEN_BG_TOURNAMENT="images/tournament/halloween",g.CHRISTMAS_BG_TOURNAMENT="images/tournament/christmas",g.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT="images/tournament/spring-flower-festival",g.TET_HOLIDAY_BG_TOURNAMENT="images/tournament/tet-holiday",g.SEA_FESTIVAL_BG_TOURNAMENT="images/tournament/sea-festival",g.FIREWORK_FESTIVAL_BG_TOURNAMENT="images/tournament/firework-festival",g.SUMMER_BG_THUMBNAIL="images/thumbnail/summer",g.AUTUMN_BG_THUMBNAIL="images/thumbnail/autumn",g.WINTER_BG_THUMBNAIL="images/thumbnail/winter",g.FLOWER_FIELD_BG_THUMBNAIL="images/thumbnail/flower-field",g.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL="images/thumbnail/tree-planting-festival",g.MUSIC_FESTIVAL_BG_THUMBNAIL="images/thumbnail/music-festival",g.HARVEST_FESTIVAL_BG_THUMBNAIL="images/thumbnail/harvest-festival",g.FOOD_FESTIVAL_BG_THUMBNAIL="images/thumbnail/food-festival",g.LIGHT_FESTIVAL_BG_THUMBNAIL="images/thumbnail/light-festival",g.PEACE_FESTIVAL_BG_THUMBNAIL="images/thumbnail/peace-festival",g.FLOWER_FESTIVAL_BG_THUMBNAIL="images/thumbnail/flower-festival",g.STREET_FESTIVAL_BG_THUMBNAIL="images/thumbnail/street-festival",g.COLOR_GARDEN_BG_THUMBNAIL="images/thumbnail/color-garden",g.COLOR_FESTIVAL_BG_THUMBNAIL="images/thumbnail/color-festival",g.NATURE_SUMMER_BG_THUMBNAIL="images/thumbnail/nature-summer",g.SNOW_MOUNTAIN_BG_THUMBNAIL="images/thumbnail/snow-mountain",g.ICE_FESTIVAL_BG_THUMBNAIL="images/thumbnail/ice-festival",g.NIGHT_FESTIVAL_BG_THUMBNAIL="images/thumbnail/night-festival",g.LOST_FESTIVAL_BG_THUMBNAIL="images/thumbnail/lost-festival",g.HALLOWEEN_BG_THUMBNAIL="images/thumbnail/halloween",g.CHRISTMAS_BG_THUMBNAIL="images/thumbnail/christmas",g.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL="images/thumbnail/spring-flower-festival",g.TET_HOLIDAY_BG_THUMBNAIL="images/thumbnail/tet-holiday",g.SEA_FESTIVAL_BG_THUMBNAIL="images/thumbnail/sea-festival",g.FIREWORK_FESTIVAL_BG_THUMBNAIL="images/thumbnail/firework-festival",g.COLLECTIONS_PAGE="pages/CollectionsContent",g.LEADERBOARD_PAGE="pages/LeaderboardContent",g.TOURNAMENTS_PAGE="pages/TournamentsContent",g.LEVEL_DATA_FOLDER="levels-json",g}(nD||{});_._RF.pop(),_._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);var nF={summer:nD.SUMMER_BG,autumn:nD.AUTUMN_BG,winter:nD.WINTER_BG,"spring-festival":nD.FLOWER_FIELD_BG,"tree-planting-festival":nD.TREE_PLANTING_FESTIVAL_BG,"blue-sea-festival":nD.SEA_FESTIVAL_BG,"music-festival":nD.MUSIC_FESTIVAL_BG,"harvest-festival":nD.HARVEST_FESTIVAL_BG,"food-festival":nD.FOOD_FESTIVAL_BG,"snow-festival":nD.WINTER_BG,"light-festival":nD.LIGHT_FESTIVAL_BG,"peace-festival":nD.PEACE_FESTIVAL_BG,"flower-festival":nD.FLOWER_FESTIVAL_BG,"street-festival":nD.STREET_FESTIVAL_BG,"color-garden":nD.COLOR_GARDEN_BG,"color-festival":nD.COLOR_FESTIVAL_BG,"nature-summer":nD.NATURE_SUMMER_BG,"snow-mountain":nD.SNOW_MOUNTAIN_BG,"ice-festival":nD.ICE_FESTIVAL_BG,"green-grass-festival":nD.FLOWER_FIELD_BG,"community-festival":nD.NIGHT_FESTIVAL_BG,"water-festival":nD.SEA_FESTIVAL_BG,"animal-festival":nD.TREE_PLANTING_FESTIVAL_BG,"lost-festival":nD.LOST_FESTIVAL_BG,"halloween-festival":nD.HALLOWEEN_BG,"snow-music-festival":nD.MUSIC_FESTIVAL_BG,christmas:nD.CHRISTMAS_BG,"spring-flower-festival":nD.SPRING_FLOWER_FESTIVAL_BG,"tet-holiday":nD.TET_HOLIDAY_BG,"sea-festival":nD.SEA_FESTIVAL_BG,"firework-festival":nD.FIREWORK_FESTIVAL_BG,"halloween-horror":nD.HALLOWEEN_BG,"mid-autumn":nD.SPRING_FLOWER_FESTIVAL_BG,"christmas-sweet":nD.CHRISTMAS_BG,"new-year-countdown":nD.TET_HOLIDAY_BG},nU={summer:nD.SUMMER_BG_PREVIEW,autumn:nD.AUTUMN_BG_PREVIEW,winter:nD.WINTER_BG_PREVIEW,"spring-festival":nD.FLOWER_FIELD_BG_PREVIEW,"tree-planting-festival":nD.TREE_PLANTING_FESTIVAL_BG_PREVIEW,"blue-sea-festival":nD.SEA_FESTIVAL_BG_PREVIEW,"music-festival":nD.MUSIC_FESTIVAL_BG_PREVIEW,"harvest-festival":nD.HARVEST_FESTIVAL_BG_PREVIEW,"food-festival":nD.FOOD_FESTIVAL_BG_PREVIEW,"snow-festival":nD.WINTER_BG_PREVIEW,"light-festival":nD.LIGHT_FESTIVAL_BG_PREVIEW,"peace-festival":nD.PEACE_FESTIVAL_BG_PREVIEW,"flower-festival":nD.FLOWER_FESTIVAL_BG_PREVIEW,"street-festival":nD.STREET_FESTIVAL_BG_PREVIEW,"color-garden":nD.COLOR_GARDEN_BG_PREVIEW,"color-festival":nD.COLOR_FESTIVAL_BG_PREVIEW,"nature-summer":nD.NATURE_SUMMER_BG_PREVIEW,"snow-mountain":nD.SNOW_MOUNTAIN_BG_PREVIEW,"ice-festival":nD.ICE_FESTIVAL_BG_PREVIEW,"green-grass-festival":nD.FLOWER_FIELD_BG_PREVIEW,"community-festival":nD.NIGHT_FESTIVAL_BG_PREVIEW,"water-festival":nD.SEA_FESTIVAL_BG_PREVIEW,"animal-festival":nD.TREE_PLANTING_FESTIVAL_BG_PREVIEW,"lost-festival":nD.LOST_FESTIVAL_BG_PREVIEW,"halloween-festival":nD.HALLOWEEN_BG_PREVIEW,"snow-music-festival":nD.MUSIC_FESTIVAL_BG_PREVIEW,christmas:nD.CHRISTMAS_BG_PREVIEW,"spring-flower-festival":nD.SPRING_FLOWER_FESTIVAL_BG_PREVIEW,"tet-holiday":nD.TET_HOLIDAY_BG_PREVIEW,"sea-festival":nD.SEA_FESTIVAL_BG_PREVIEW,"firework-festival":nD.FIREWORK_FESTIVAL_BG_PREVIEW,"halloween-horror":nD.HALLOWEEN_BG_PREVIEW,"mid-autumn":nD.SPRING_FLOWER_FESTIVAL_BG_PREVIEW,"christmas-sweet":nD.CHRISTMAS_BG_PREVIEW,"new-year-countdown":nD.TET_HOLIDAY_BG_PREVIEW},nx={summer:nD.SUMMER_BG_TOURNAMENT,autumn:nD.AUTUMN_BG_TOURNAMENT,winter:nD.WINTER_BG_TOURNAMENT,"spring-festival":nD.FLOWER_FIELD_BG_TOURNAMENT,"tree-planting-festival":nD.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT,"blue-sea-festival":nD.SEA_FESTIVAL_BG_TOURNAMENT,"music-festival":nD.MUSIC_FESTIVAL_BG_TOURNAMENT,"harvest-festival":nD.HARVEST_FESTIVAL_BG_TOURNAMENT,"food-festival":nD.FOOD_FESTIVAL_BG_TOURNAMENT,"snow-festival":nD.WINTER_BG_TOURNAMENT,"light-festival":nD.LIGHT_FESTIVAL_BG_TOURNAMENT,"peace-festival":nD.PEACE_FESTIVAL_BG_TOURNAMENT,"flower-festival":nD.FLOWER_FESTIVAL_BG_TOURNAMENT,"street-festival":nD.STREET_FESTIVAL_BG_TOURNAMENT,"color-garden":nD.COLOR_GARDEN_BG_TOURNAMENT,"color-festival":nD.COLOR_FESTIVAL_BG_TOURNAMENT,"nature-summer":nD.NATURE_SUMMER_BG_TOURNAMENT,"snow-mountain":nD.SNOW_MOUNTAIN_BG_TOURNAMENT,"ice-festival":nD.ICE_FESTIVAL_BG_TOURNAMENT,"green-grass-festival":nD.FLOWER_FIELD_BG_TOURNAMENT,"community-festival":nD.NIGHT_FESTIVAL_BG_TOURNAMENT,"water-festival":nD.SEA_FESTIVAL_BG_TOURNAMENT,"animal-festival":nD.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT,"lost-festival":nD.LOST_FESTIVAL_BG_TOURNAMENT,"halloween-festival":nD.HALLOWEEN_BG_TOURNAMENT,"snow-music-festival":nD.MUSIC_FESTIVAL_BG_TOURNAMENT,christmas:nD.CHRISTMAS_BG_TOURNAMENT,"spring-flower-festival":nD.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT,"tet-holiday":nD.TET_HOLIDAY_BG_TOURNAMENT,"sea-festival":nD.SEA_FESTIVAL_BG_TOURNAMENT,"firework-festival":nD.FIREWORK_FESTIVAL_BG_TOURNAMENT,"halloween-horror":nD.HALLOWEEN_BG_TOURNAMENT,"mid-autumn":nD.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT,"christmas-sweet":nD.CHRISTMAS_BG_TOURNAMENT,"new-year-countdown":nD.TET_HOLIDAY_BG_TOURNAMENT},nz={summer:nD.SUMMER_BG_THUMBNAIL,autumn:nD.AUTUMN_BG_THUMBNAIL,winter:nD.WINTER_BG_THUMBNAIL,"spring-festival":nD.FLOWER_FIELD_BG_THUMBNAIL,"tree-planting-festival":nD.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL,"blue-sea-festival":nD.SEA_FESTIVAL_BG_THUMBNAIL,"music-festival":nD.MUSIC_FESTIVAL_BG_THUMBNAIL,"harvest-festival":nD.HARVEST_FESTIVAL_BG_THUMBNAIL,"food-festival":nD.FOOD_FESTIVAL_BG_THUMBNAIL,"snow-festival":nD.WINTER_BG_THUMBNAIL,"light-festival":nD.LIGHT_FESTIVAL_BG_THUMBNAIL,"peace-festival":nD.PEACE_FESTIVAL_BG_THUMBNAIL,"flower-festival":nD.FLOWER_FESTIVAL_BG_THUMBNAIL,"street-festival":nD.STREET_FESTIVAL_BG_THUMBNAIL,"color-garden":nD.COLOR_GARDEN_BG_THUMBNAIL,"color-festival":nD.COLOR_FESTIVAL_BG_THUMBNAIL,"nature-summer":nD.NATURE_SUMMER_BG_THUMBNAIL,"snow-mountain":nD.SNOW_MOUNTAIN_BG_THUMBNAIL,"ice-festival":nD.ICE_FESTIVAL_BG_THUMBNAIL,"green-grass-festival":nD.FLOWER_FIELD_BG_THUMBNAIL,"community-festival":nD.NIGHT_FESTIVAL_BG_THUMBNAIL,"water-festival":nD.SEA_FESTIVAL_BG_THUMBNAIL,"animal-festival":nD.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL,"lost-festival":nD.LOST_FESTIVAL_BG_THUMBNAIL,"halloween-festival":nD.HALLOWEEN_BG_THUMBNAIL,"snow-music-festival":nD.MUSIC_FESTIVAL_BG_THUMBNAIL,christmas:nD.CHRISTMAS_BG_THUMBNAIL,"spring-flower-festival":nD.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL,"tet-holiday":nD.TET_HOLIDAY_BG_THUMBNAIL,"sea-festival":nD.SEA_FESTIVAL_BG_THUMBNAIL,"firework-festival":nD.FIREWORK_FESTIVAL_BG_THUMBNAIL,"halloween-horror":nD.HALLOWEEN_BG_THUMBNAIL,"mid-autumn":nD.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL,"christmas-sweet":nD.CHRISTMAS_BG_THUMBNAIL,"new-year-countdown":nD.TET_HOLIDAY_BG_THUMBNAIL};_._RF.pop(),_._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);var nG,nV,nK,nH,nq,nW,nj,nX,nY,nJ,nQ,nZ,n$,n0,n1,n2,n4,n3,n5,n6,n8,n9,n7,ie=function(){function e(){Fe(this,e)}var g,E,_,k,C,A,T,R,I,P,L,O;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"setBlockInput",value:function(g){var E=$("Canvas/InputBlocker");E?E.active=g:console.warn("InputBlocker not found")}},{key:"getBlockInput",value:function(){var g=$("Canvas/InputBlocker");return g?g.active:(console.warn("InputBlocker not found"),!1)}},{key:"loadPrefabAsync",value:function(g){var E=this.getAsset(g,ee);return null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,ee,function(g,_){E(g?null:_)})})}},{key:"loadJsonAsync",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){E=this;return[2,new Promise(function(_){var k=E.getAsset(g,en);null===k?F.load(g,en,function(g,E){g?_(null):E&&E.json?_(E.json):_(null)}):_(k.json)})]})}),function(g){return O.apply(this,arguments)})},{key:"loadAudioClipAsync",value:(L=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,U);return[2,null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,U,function(g,_){E(g?null:_)})})]})}),function(g){return L.apply(this,arguments)})},{key:"loadAnimClipAsync",value:(P=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,ei);return[2,null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,ei,function(g,_){E(g?null:_)})})]})}),function(g){return P.apply(this,arguments)})},{key:"loadImageSpriteFrameAsync",value:(I=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,ea);return[2,null!==E?Promise.resolve(er.createWithImage(E)):new Promise(function(E){F.load(g,ea,function(g,_){E(g?null:er.createWithImage(_))})})]})}),function(g){return I.apply(this,arguments)})},{key:"loadSpriteFrameAsync",value:(R=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){E=!(k.length>1&&void 0!==k[1])||k[1],_=this.getAsset(g,er);return[2,null!==_?(_.packable=E,Promise.resolve(_)):new Promise(function(_){F.load(g,er,function(g,k){!g&&k?(k.packable=E,_(k)):_(null)})})]})}),function(g){return R.apply(this,arguments)})},{key:"loadSpriteFramesDirAsync",value:(T=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){E=F.getDirWithPath(g,er);if(E.length>0){k=[],C=at(E);try{for(C.s();!(_=C.n()).done;){A=_.value,T=F.get(A.path,er);if(!T)return[2,this.loadSpriteFramesFromDirAsync(g)];k.push(T)}}catch(g){C.e(g)}finally{C.f()}return[2,k]}return[2,this.loadSpriteFramesFromDirAsync(g)]})}),function(g){return T.apply(this,arguments)})},{key:"loadSpriteFramesFromDirAsync",value:(A=Be(function(g){return _ts_generator(this,function(E){return[2,new Promise(function(E){F.loadDir(g,er,function(g,_){E(g?[]:_)})})]})}),function(g){return A.apply(this,arguments)})},{key:"loadThemeAsync",value:(C=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nF[g],"/spriteFrame"))]})}),function(g){return C.apply(this,arguments)})},{key:"loadThemePreviewAsync",value:(k=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nU[g],"/spriteFrame"))]})}),function(g){return k.apply(this,arguments)})},{key:"loadThemeTournamentAsync",value:(_=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nx[g],"/spriteFrame"))]})}),function(g){return _.apply(this,arguments)})},{key:"loadThemeThumbnailAsync",value:(E=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nz[g],"/spriteFrame"))]})}),function(g){return E.apply(this,arguments)})},{key:"loadSkinPreviewAsync",value:(g=Be(function(g){var E,_,k;return _ts_generator(this,function(C){for(E=[],_=1;_<=4;_++){k="".concat(nD.TILE_SKIN_PREVIEW_FOLDER,"/").concat(g.replace(/-/g,"_"),"_").concat(_,"/spriteFrame");E.push(this.loadSpriteFrameAsync(k))}return[2,Promise.all(E)]})}),function(E){return g.apply(this,arguments)})},{key:"getAsset",value:function(g,E){var _=F.getInfoWithPath(g,E);return _?F.get(_.path,E):null}}]),e}();_._RF.pop(),_._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var ii=k.ccclass,ia=k.property,ir=globalThis.game.monitorError,io=GameCore.Utils.Number,is=(nG=ii("MultiBackground"),nV=ia({type:eo}),nK=ia({type:eo}),nH=ia({type:R}),nq=ia({type:R}),nW=ia({type:R}),nj=ia(V),nX=ia(H),nY=ia({type:es(nB)}),nJ=ia({type:es(nB)}),nQ=nC.onlyRunInLifeCycleAsync,nZ=nC.onlyRunInLifeCycle,nG((n1=st((n0=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background1",n1,Ke(g)),rt(g,"background2",n2,Ke(g)),rt(g,"screenUiTransform",n4,Ke(g)),rt(g,"background1UiTransform",n3,Ke(g)),rt(g,"background2UiTransform",n5,Ke(g)),rt(g,"backgroundNudgeAmount",n6,Ke(g)),rt(g,"nudgeableWidget",n8,Ke(g)),rt(g,"pageOrder",n9,Ke(g)),rt(g,"homePage",n7,Ke(g)),g.currentThemeId="",g.tryNudgeBackground=function(E){var _=E.to,k=g.getDirection(g.homePage,_),C=io.sign(k),A=Math.abs(k),T=g.backgroundNudgeAmount*A,R=Math.min(g.background1UiTransform.width,g.background2UiTransform.width),I=Math.max(0,(R-g.screenUiTransform.width)/2),P=Math.min(I,T)*C;z(g.nudgeableWidget).to(.5,{horizontalCenter:P},{easing:el.cubicInOut}).start()},g}return Ue(a,[{key:"onLoad",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,nC.lazyValidateProperties(this),this.listenToNavigationEvents()}},{key:"onDestroy",value:function(){var g;null===(g=this.tweenSignal)||void 0===g||g.abort(),this.unlistenToNavigationEvents()}},{key:"listenToNavigationEvents",value:function(){this.node.scene.on(nL,this.tryNudgeBackground)}},{key:"unlistenToNavigationEvents",value:function(){this.node.scene.off(nL,this.tryNudgeBackground)}},{key:"getDirection",value:function(g,E){var _=this.pageOrder.indexOf(g),k=this.pageOrder.indexOf(E);return -1===_||-1===k?(null==ir||ir.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):_-k}},{key:"setCurrentTheme",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,ie.loadThemeAsync(g)];case 1:E=_.sent();E?this.updateBackgroundSprites(E,g):null==ir||ir.sendException(new Error("MultiBackground.setCurrentTheme: Failed to load theme ".concat(g,"'s sprite.")));return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"updateBackgroundSprites",value:function(g,E){g.packable=!1,this.background1.spriteFrame=g,this.background2.spriteFrame=g,this.currentThemeId=E}},{key:"animateToNextTheme",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(this.currentThemeId===g)return[2,Promise.resolve()];return[4,ie.loadThemeAsync(g)];case 1:_=A.sent();if(!_)return[3,3];_.packable=!1,this.currentThemeId=g,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=_,this.nextBackground.node.setSiblingIndex(1);k=this.nextBackground.getComponent(eu);if(!k)throw new Error("".concat(this.nextBackground.node.name," UIOpacity is required"));k.opacity=0,null===(E=this.tweenSignal)||void 0===E||E.abort(),this.tweenSignal=new nM;return[4,tZ.runTweenAsync(z(k).to(1,{opacity:255}),this.tweenSignal)];case 2:if(A.sent(),!this.tweenSignal.aborted){this.currentBackground.node.active=!1;C=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=C}return[3,4];case 3:null==ir||ir.sendException(new Error("MultiBackground.animateToNextTheme: Failed to load theme ".concat(g,"'s sprite.")));A.label=4;case 4:return[2]}})}),function(g){return E.apply(this,arguments)})}]),a}(M)).prototype,"background1",[nV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n2=st(n0.prototype,"background2",[nK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n4=st(n0.prototype,"screenUiTransform",[nH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n3=st(n0.prototype,"background1UiTransform",[nq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n5=st(n0.prototype,"background2UiTransform",[nW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n6=st(n0.prototype,"backgroundNudgeAmount",[nj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),n8=st(n0.prototype,"nudgeableWidget",[nX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n9=st(n0.prototype,"pageOrder",[nY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),n7=st(n0.prototype,"homePage",[nJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nB.home}}),st(n0.prototype,"setCurrentTheme",[nQ],Object.getOwnPropertyDescriptor(n0.prototype,"setCurrentTheme"),n0.prototype),st(n0.prototype,"updateBackgroundSprites",[nZ],Object.getOwnPropertyDescriptor(n0.prototype,"updateBackgroundSprites"),n0.prototype),n$=n0))||n$);_._RF.pop(),_._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var il="musics/",iu="sounds/",ic=GameCore.Utils.Object,ih={BUTTON_CLICK:"".concat(iu,"use_item_click"),BOMB_DEFUSE:"".concat(iu,"bomb_defuse"),BOMB_EXPLODE_1:"".concat(iu,"bomb_explode_1"),BOMB_EXPLODE_2:"".concat(iu,"bomb_explode_2"),CLICKS:"".concat(iu,"clicks"),CLOSE_POPUP_CLICK:"".concat(iu,"close_popup_click"),COLLECT_STARS:"".concat(iu,"collect_stars"),COMBO_1:"".concat(iu,"combo_1"),COMBO_2:"".concat(iu,"combo_2"),COMBO_3:"".concat(iu,"combo_3"),COMBO_4:"".concat(iu,"combo_4"),COMBO_5:"".concat(iu,"combo_5"),DAILY_REWARD:"".concat(iu,"daily_reward"),EXTRA_TIME_SPAWN:"".concat(iu,"extra_time_spawn"),GIFT_CHARGE:"".concat(iu,"gift_charge"),GIFT_EXPLODE:"".concat(iu,"gift_explode"),GIFT_REVEAL:"".concat(iu,"gift_reveal"),HINT_ITEM:"".concat(iu,"hint_item"),INVALID_MATCH:"".concat(iu,"invalid_match"),LEVEL_COMPLETE:"".concat(iu,"level_complete"),LEVEL_FAIL:"".concat(iu,"level_fail"),LEVEL_START:"".concat(iu,"level_start"),PROGRESS_STAR:"".concat(iu,"progress_star"),RESCUE_TIMER:"".concat(iu,"rescue_timer"),ROCKET_FLY:"".concat(iu,"rocket_fly"),SHUFFLE_ITEM:"".concat(iu,"shuffle_item"),THREE_STARS:"".concat(iu,"three_stars"),TICKING_BOMB_BEFORE_EXPLODE:"".concat(iu,"ticking_bomb_before_explode"),TILE_SELECT:"".concat(iu,"tile_select"),USE_ITEM_CLICK:"".concat(iu,"use_item_click"),BG_MUSIC:"".concat(il,"bg_music"),PATCH_SHIFT:"".concat(iu,"patch_shift"),THUNDERBOLT:"".concat(iu,"thunderbolt"),WIND:"".concat(iu,"wind"),COLLECT_COINS:"".concat(iu,"collect_coins"),COLLECT_STOCK_COINS:"".concat(iu,"collect_stock_coins"),LEVEL_FAIL_TIMEOUT:"".concat(iu,"level_fail_timeout"),STAR_CHEST_DRUM_ROLL:"".concat(iu,"star_chest_drum_roll"),STAR_CHEST_OPEN:"".concat(iu,"star_chest_open"),LEADERBOARD_TRIUMPH:"".concat(iu,"leaderboard_triumph"),ITEM_REWARD:"".concat(iu,"item_reward"),COMBO_6:"".concat(iu,"combo_6"),COMBO_7:"".concat(iu,"combo_7"),COMBO_8:"".concat(iu,"combo_8"),COMBO_9:"".concat(iu,"combo_9"),COMBO_10:"".concat(iu,"combo_10"),COMBO_11:"".concat(iu,"combo_11"),COMBO_12:"".concat(iu,"combo_12"),COMBO_13:"".concat(iu,"combo_13"),TILE_MATCH:"".concat(iu,"tile_match"),TOURNAMENT_MUSIC:"".concat(il,"tournament_music")},ip=ic.vals(ih),iy=ip.reduce(function(g,E,_){return g[E]=_,g},{});Z(iy);var iv,ig,im=ip;_._RF.pop(),_._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var ib=function(g){return g[g.RESCUES_SCREEN=0]="RESCUES_SCREEN",g[g.LOADING_SCREEN=1]="LOADING_SCREEN",g[g.GET_ITEM_SCREEN=2]="GET_ITEM_SCREEN",g[g.GET_COIN_SCREEN=3]="GET_COIN_SCREEN",g[g.SETTINGS_SCREEN=4]="SETTINGS_SCREEN",g[g.START_LEVEL_SCREEN=5]="START_LEVEL_SCREEN",g[g.NOTIFICATION_SCREEN=6]="NOTIFICATION_SCREEN",g[g.LEVEL_COMPLETE_SCREEN=7]="LEVEL_COMPLETE_SCREEN",g[g.CONGRATULATION_SCREEN=8]="CONGRATULATION_SCREEN",g[g.QUIT_LEVEL_SCREEN=9]="QUIT_LEVEL_SCREEN",g[g.TOURNAMENT_DETAIL_SCREEN=10]="TOURNAMENT_DETAIL_SCREEN",g[g.DAILY_REWARDS_SCREEN=11]="DAILY_REWARDS_SCREEN",g[g.STAR_CHEST_SCREEN=12]="STAR_CHEST_SCREEN",g[g.START_OVER_SCREEN=13]="START_OVER_SCREEN",g[g.PAUSE_SCREEN=14]="PAUSE_SCREEN",g[g.HARD_LEVEL_SCREEN=15]="HARD_LEVEL_SCREEN",g[g.GET_REWARDS_SCREEN=16]="GET_REWARDS_SCREEN",g}(ib||{}),iw=(Ge(iv={},ib.RESCUES_SCREEN,"RescuesScreen"),Ge(iv,ib.LOADING_SCREEN,"LoadingScreen"),Ge(iv,ib.GET_ITEM_SCREEN,"GetItemScreen"),Ge(iv,ib.GET_COIN_SCREEN,"GetCoinScreen"),Ge(iv,ib.SETTINGS_SCREEN,"SettingsScreen"),Ge(iv,ib.START_LEVEL_SCREEN,"StartLevelScreen"),Ge(iv,ib.NOTIFICATION_SCREEN,"NotificationScreen"),Ge(iv,ib.LEVEL_COMPLETE_SCREEN,"LevelCompleteScreen"),Ge(iv,ib.CONGRATULATION_SCREEN,"CongratulationScreen"),Ge(iv,ib.QUIT_LEVEL_SCREEN,"QuitLevelScreen"),Ge(iv,ib.TOURNAMENT_DETAIL_SCREEN,"TournamentDetailScreen"),Ge(iv,ib.DAILY_REWARDS_SCREEN,"DailyRewardsScreen"),Ge(iv,ib.STAR_CHEST_SCREEN,"StarChestScreen"),Ge(iv,ib.START_OVER_SCREEN,"StartOverScreen"),Ge(iv,ib.PAUSE_SCREEN,"PauseScreen"),Ge(iv,ib.HARD_LEVEL_SCREEN,"HardLevelScreen"),Ge(iv,ib.GET_REWARDS_SCREEN,"GetRewardsScreen"),iv),iS=(Ge(ig={},iw[ib.RESCUES_SCREEN],ib.RESCUES_SCREEN),Ge(ig,iw[ib.LOADING_SCREEN],ib.LOADING_SCREEN),Ge(ig,iw[ib.GET_ITEM_SCREEN],ib.GET_ITEM_SCREEN),Ge(ig,iw[ib.GET_COIN_SCREEN],ib.GET_COIN_SCREEN),Ge(ig,iw[ib.SETTINGS_SCREEN],ib.SETTINGS_SCREEN),Ge(ig,iw[ib.START_LEVEL_SCREEN],ib.START_LEVEL_SCREEN),Ge(ig,iw[ib.NOTIFICATION_SCREEN],ib.NOTIFICATION_SCREEN),Ge(ig,iw[ib.LEVEL_COMPLETE_SCREEN],ib.LEVEL_COMPLETE_SCREEN),Ge(ig,iw[ib.CONGRATULATION_SCREEN],ib.CONGRATULATION_SCREEN),Ge(ig,iw[ib.QUIT_LEVEL_SCREEN],ib.QUIT_LEVEL_SCREEN),Ge(ig,iw[ib.TOURNAMENT_DETAIL_SCREEN],ib.TOURNAMENT_DETAIL_SCREEN),Ge(ig,iw[ib.DAILY_REWARDS_SCREEN],ib.DAILY_REWARDS_SCREEN),Ge(ig,iw[ib.STAR_CHEST_SCREEN],ib.STAR_CHEST_SCREEN),Ge(ig,iw[ib.START_OVER_SCREEN],ib.START_OVER_SCREEN),Ge(ig,iw[ib.PAUSE_SCREEN],ib.PAUSE_SCREEN),Ge(ig,iw[ib.HARD_LEVEL_SCREEN],ib.HARD_LEVEL_SCREEN),Ge(ig,iw[ib.GET_REWARDS_SCREEN],ib.GET_REWARDS_SCREEN),ig),iE=[iw[ib.NOTIFICATION_SCREEN],iw[ib.LOADING_SCREEN]];_._RF.pop(),_._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);var i_=globalThis.game.analytics,ik=GameCore.Utils.Array,iC=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"trackCurrentPage",value:function(g,E){if(!ik.has(iE,g)&&(E||ik.has(this.trackingPages,g))){this.trackingPages=this.trackingPages.filter(function(E){return E!==g}),E&&this.trackingPages.push(g);var _=this.getCurrentPage();i_.pageview(_)}}},{key:"switchSceneTracking",value:function(){this.trackingPages=[];var g=this.getCurrentPage();i_.pageview(g)}},{key:"getCurrentPage",value:function(){var g,E;return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:null!==(g=null===(E=N.getScene())||void 0===E?void 0:E.name)&&void 0!==g?g:"Unknown Scene"}}]),e}();iC.trackingPages=[],_._RF.pop(),_._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);var iA,iT,iR,iI,iP,iL,iO,iB,iN,iM,iD,iF,iU,ix,iz,iG,iV,iK,iH,iq,iW,ij,iX,iY,iJ,iQ,iZ,i$,i0,i1,i2,i4,i3,i5,i6,i8=function(){function e(){Fe(this,e),this.signal=new nM}var g,E,_,k,C;return Ue(e,[{key:"sound",get:function(){var g,E;return null!==(g=null===(E=$("Sound"))||void 0===E?void 0:E.getComponent(tL))&&void 0!==g?g:null}},{key:"music",get:function(){var g,E;return null!==(g=null===(E=$("Music"))||void 0===E?void 0:E.getComponent(tC))&&void 0!==g?g:null}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"muteAudio",value:function(g){this.muteMusic(g),this.muteSound(g)}},{key:"playSound",value:(C=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,null===(_=this.inst.sound)||void 0===_?void 0:_.play(g,E)];case 1:k.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"pauseSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.pause(g)}},{key:"resumeSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.resume(g)}},{key:"stopSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.stop(g)}},{key:"stopAllSounds",value:function(){var g;null===(g=this.inst.sound)||void 0===g||g.stopAll()}},{key:"muteSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.mute(g)}},{key:"playMusic",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E;this.inst.music&&(this.inst.currentMusic!==g&&this.pauseMusic(),this.inst.currentMusic=g,!_&&this.inst.music.playing(g)||(_&&this.inst.music.stop(g),this.inst.music.play(g)))}},{key:"pauseMusic",value:function(){var g;null===(g=this.inst.music)||void 0===g||g.pause(this.inst.currentMusic)}},{key:"muteMusic",value:function(g){var E;null===(E=this.inst.music)||void 0===E||E.mute(g)}},{key:"getCurrentMusic",value:function(){return this.inst.currentMusic}},{key:"turnUpMusic",value:(k=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=(null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0)>.6;if(_)return[3,2];return[4,this.setVolumeMusic(.6,!0)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"turnDownMusic",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=(null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0)<.2;if(_)return[3,2];return[4,this.setVolumeMusic(.2,!0)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"turnOffMusic",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.setVolumeMusic(0)];case 1:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getVolumeMusic",value:function(){var g,E;return null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0}},{key:"setVolumeMusic",value:(g=Be(function(g){var E,_,k,C,A,T;var R=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:E=this,_=R.length>1&&void 0!==R[1]&&R[1];if(!this.inst.music)return[3,3];this.inst.signal.abort();k=new nM;if(this.inst.signal=k,!_)return[3,2];C=this.inst.music.getVolume(),A=C;return[4,tZ.runOnUpdateAsync(this.inst.music.node,1,function(_){E.inst.music&&(A=C+(g-C)*_,E.inst.music.setVolume(A))},k)];case 1:I.sent();return[3,3];case 2:null===(T=this.inst.music)||void 0===T||T.setVolume(g);I.label=3;case 3:return[2]}})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var i9,i7,ae,an,ai=k.ccclass,aa=k.property,ar=k.disallowMultiple,ao=k.executionOrder,as=globalThis.game.analytics,al=GameCore.Plugins.Analytics.Events,au=(iA=ai("ExtendedButton"),iT=ao(111),iR=aa(ec),iI=aa(ec),iP=aa(eh.AnimationController),iL=aa({override:!0,visible:!1}),iO=aa({override:!0,visible:!1}),iB=aa({override:!0,visible:!1}),iN=aa({override:!0,visible:!1}),iM=aa({override:!0,visible:!1}),iD=aa({override:!0,visible:!1}),iF=aa({override:!0,visible:!1}),iU=aa({override:!0,visible:!1}),ix=aa({override:!0,visible:!1}),iz=aa({override:!0,visible:!1}),iG=aa({override:!0,visible:!1}),iV=aa(J),iK=aa(J),iH=aa(J),iq=aa({visible:function(){return this.makeSound},type:iy}),iW=aa({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),ij=aa({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),iX=aa({}),iA(iY=ar(iY=iT((iQ=st((iJ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"clickStartEvents",iQ,Ke(g)),rt(g,"clickEndEvents",iZ,Ke(g)),rt(g,"animationController",i$,Ke(g)),rt(g,"useDesktopHover",i0,Ke(g)),rt(g,"emitAnalyticsEvents",i1,Ke(g)),rt(g,"makeSound",i2,Ke(g)),rt(g,"soundKey",i4,Ke(g)),rt(g,"disableSpamClick",i3,Ke(g)),rt(g,"disableSpamDelay",i5,Ke(g)),rt(g,"isScrollViewCancelInnerEvents",i6,Ke(g)),g.currentClickBoundingBox=null,g.hasDown=!1,g.hasUp=!1,g.hasFinishClickCycle=!1,g.onTouchStart=function(E){g.interactable&&(g.hasDown||(g.currentClickBoundingBox=ns.getBoundingBoxToWorld(g.node),g.handleDown(E)))},g.onTouchEnd=function(E){g.scheduleOnce(function(){g.interactable&&g.hasDown&&(g.hasUp||g.handleUp(E))},0)},g.onTouchCancel=function(E){if(g.interactable&&g.hasDown&&!g.hasUp){if(!g.isScrollViewCancelInnerEvents){var _,k,C=E.getUILocation();if(null!==(_=null===(k=g.currentClickBoundingBox)||void 0===k?void 0:k.contains(C))&&void 0!==_&&_)return void g.handleUp(E)}g.hasUp=!0,g.hasFinishClickCycle=!0,g.handleResetButtonState(),g.emitClickEndEvents(E)}},g.onMouseEnter=function(E){g.useDesktopHover&&g.interactable&&(g.hasDown||(g.hasFinishClickCycle=!1,g.setAnimationState("HOVER")))},g.onMouseLeave=function(E){g.useDesktopHover&&g.interactable&&(g.hasDown||g.hasUp||g.hasFinishClickCycle||g.handleResetButtonState())},g.handleResetButtonState=function(){g.hasDown=!1,g.hasUp=!1,g.setAnimationState("RESET")},g}return Ue(n,[{key:"transition",get:function(){return B.Transition.NONE},set:function(g){$e(Ve(n.prototype),"transition",B.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return Je(Ve(n.prototype),"normalColor",this)},set:function(g){$e(Ve(n.prototype),"normalColor",g,this,!0)}},{key:"pressedColor",get:function(){return Je(Ve(n.prototype),"pressedColor",this)},set:function(g){$e(Ve(n.prototype),"pressedColor",g,this,!0)}},{key:"hoverColor",get:function(){return Je(Ve(n.prototype),"hoverColor",this)},set:function(g){$e(Ve(n.prototype),"hoverColor",g,this,!0)}},{key:"disabledColor",get:function(){return Je(Ve(n.prototype),"disabledColor",this)},set:function(g){$e(Ve(n.prototype),"disabledColor",g,this,!0)}},{key:"normalSprite",get:function(){return Je(Ve(n.prototype),"normalSprite",this)},set:function(g){$e(Ve(n.prototype),"normalSprite",g,this,!0)}},{key:"pressedSprite",get:function(){return Je(Ve(n.prototype),"pressedSprite",this)},set:function(g){$e(Ve(n.prototype),"pressedSprite",g,this,!0)}},{key:"hoverSprite",get:function(){return Je(Ve(n.prototype),"hoverSprite",this)},set:function(g){$e(Ve(n.prototype),"hoverSprite",g,this,!0)}},{key:"disabledSprite",get:function(){return Je(Ve(n.prototype),"disabledSprite",this)},set:function(g){$e(Ve(n.prototype),"disabledSprite",g,this,!0)}},{key:"duration",get:function(){return Je(Ve(n.prototype),"duration",this)},set:function(g){$e(Ve(n.prototype),"duration",g,this,!0)}},{key:"zoomScale",get:function(){return Je(Ve(n.prototype),"zoomScale",this)},set:function(g){$e(Ve(n.prototype),"zoomScale",g,this,!0)}},{key:"__preload",value:function(){Je(Ve(n.prototype),"__preload",this).call(this),nC.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var g;null===(g=Je(Ve(n.prototype),"onDestroy",this))||void 0===g||g.call(this)}},{key:"onEnable",value:function(){var g;null===(g=Je(Ve(n.prototype),"onEnable",this))||void 0===g||g.call(this),this.node.off(ep.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(C.EventType.TOUCH_START,this.onTouchStart),this.node.on(C.EventType.TOUCH_END,this.onTouchEnd),this.node.on(C.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var g;null===(g=Je(Ve(n.prototype),"onDisable",this))||void 0===g||g.call(this),this.node.off(C.EventType.TOUCH_START,this.onTouchStart),this.node.off(C.EventType.TOUCH_END,this.onTouchEnd),this.node.off(C.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(g){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&i8.playSound(im[this.soundKey]),this.emitClickStartEvents(g)}},{key:"emitClickStartEvents",value:function(g){var E,_=at(this.clickStartEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}},{key:"emitClickEndEvents",value:function(g){var E,_=at(this.clickEndEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}},{key:"handleUp",value:function(g){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(g),this.emitClickEndEvents(g)}},{key:"emitButtonEvents",value:function(g){if(this.interactable){this.emitAnalyticsEvents&&as.event(al.BUTTON_CLICK,{button_name:this.node.name,screen_name:iC.getCurrentPage()});var E,_=at(this.clickEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}}},{key:"setAnimationState",value:function(g){this.animationController&&(this.animationController.setValue("DOWN","DOWN"===g),this.animationController.setValue("HOVER","HOVER"===g),this.animationController.setValue("RESET","RESET"===g))}},{key:"fakeClick",value:function(){var g=this;this.setAnimationState("DOWN"),this.scheduleOnce(function(){g.setAnimationState("RESET")},0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),n}(B)).prototype,"clickStartEvents",[iR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iZ=st(iJ.prototype,"clickEndEvents",[iI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),i$=st(iJ.prototype,"animationController",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(iJ.prototype,"transition",[iL],Object.getOwnPropertyDescriptor(iJ.prototype,"transition"),iJ.prototype),st(iJ.prototype,"normalColor",[iO],Object.getOwnPropertyDescriptor(iJ.prototype,"normalColor"),iJ.prototype),st(iJ.prototype,"pressedColor",[iB],Object.getOwnPropertyDescriptor(iJ.prototype,"pressedColor"),iJ.prototype),st(iJ.prototype,"hoverColor",[iN],Object.getOwnPropertyDescriptor(iJ.prototype,"hoverColor"),iJ.prototype),st(iJ.prototype,"disabledColor",[iM],Object.getOwnPropertyDescriptor(iJ.prototype,"disabledColor"),iJ.prototype),st(iJ.prototype,"normalSprite",[iD],Object.getOwnPropertyDescriptor(iJ.prototype,"normalSprite"),iJ.prototype),st(iJ.prototype,"pressedSprite",[iF],Object.getOwnPropertyDescriptor(iJ.prototype,"pressedSprite"),iJ.prototype),st(iJ.prototype,"hoverSprite",[iU],Object.getOwnPropertyDescriptor(iJ.prototype,"hoverSprite"),iJ.prototype),st(iJ.prototype,"disabledSprite",[ix],Object.getOwnPropertyDescriptor(iJ.prototype,"disabledSprite"),iJ.prototype),st(iJ.prototype,"duration",[iz],Object.getOwnPropertyDescriptor(iJ.prototype,"duration"),iJ.prototype),st(iJ.prototype,"zoomScale",[iG],Object.getOwnPropertyDescriptor(iJ.prototype,"zoomScale"),iJ.prototype),i0=st(iJ.prototype,"useDesktopHover",[iV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i1=st(iJ.prototype,"emitAnalyticsEvents",[iK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i2=st(iJ.prototype,"makeSound",[iH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i4=st(iJ.prototype,"soundKey",[iq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iy[ih.BUTTON_CLICK]}}),i3=st(iJ.prototype,"disableSpamClick",[iW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i5=st(iJ.prototype,"disableSpamDelay",[ij],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),i6=st(iJ.prototype,"isScrollViewCancelInnerEvents",[iX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),iY=iJ))||iY)||iY)||iY);_._RF.pop(),_._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var ac=k.ccclass,ah=k.requireComponent,ap=k.property,ad=ac("OpacityToggler")(i9=ah([eu])((ae=st((i7=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"activeValue",ae,Ke(g)),rt(g,"inActiveValue",an,Ke(g)),g.signal=new nM,g}return Ue(i,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"changeState",value:function(g){var E=arguments.length>0&&void 0!==g&&g;this.signal.abort(),this.opacityComponent.opacity=E?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(E=Be(function(){var g,E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:g=k.length>0&&void 0!==k[0]&&k[0],E=k.length>1&&void 0!==k[1]?k[1]:.2;this.signal.abort(),this.signal=new nM;_=g?this.activeValue:this.inActiveValue;return[4,tZ.runTweenAsync(z(this.opacityComponent).to(E,{opacity:_}),this.signal)];case 1:C.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"activeValue",[ap],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),an=st(i7.prototype,"inActiveValue",[ap],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),i9=i7))||i9)||i9;_._RF.pop(),_._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);var af,ay,av,ag={Portrait:"portrait",Landscape:"landscape"},am={Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}};_._RF.pop(),_._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var ab,aw,aS,aE,a_,ak,aC,aA,aT,aR,aI,aP,aL,aO,aB,aN,aM,aD,aF,aU,ax=k.ccclass,az=k.property,aG=k.requireComponent,aV=k.disallowMultiple,aK=k.executeInEditMode,aH=am,aq=aH.Portrait,aW=aH.Landscape;ax("DebugResolution")(af=aV(af=aG([ef])(af=aK(!0)(((av=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleLayoutChange=function(){var E;null===(E=g.graphics)||void 0===E||E.clear(),g.start()},g}return Ue(n,[{key:"drawPortrait",get:function(){return n._drawPortrait},set:function(g){g!==n._drawPortrait&&(g?this.drawPortraitResolution():this.graphics.clear(),n._drawPortrait=g,n._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return n._drawLandscape},set:function(g){g!==n._drawLandscape&&(g?this.drawLandscapeResolution():this.graphics.clear(),n._drawLandscape=g,n._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(ef),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t6,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var g=this.graphics,E=aq.WIDTH,_=aq.HEIGHT,k=-E/2,C=-_/2;g.strokeColor=A.GREEN,g.rect(k,C,E,_),g.stroke()}},{key:"drawLandscapeResolution",value:function(){var g=this.graphics,E=aW.WIDTH,_=aW.HEIGHT,k=-E/2,C=-_/2;g.strokeColor=A.CYAN,g.rect(k,C,E,_),g.stroke()}}]),n}(M))._drawPortrait=!0,av._drawLandscape=!0,st((ay=av).prototype,"drawPortrait",[az],Object.getOwnPropertyDescriptor(ay.prototype,"drawPortrait"),ay.prototype),st(ay.prototype,"drawLandscape",[az],Object.getOwnPropertyDescriptor(ay.prototype,"drawLandscape"),ay.prototype),af=ay))||af)||af)||af);_._RF.pop(),_._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var aj=k.ccclass,aX=k.executionOrder,aY=k.property,aJ=GameCore.Utils.Valid,aQ=A.RED,aZ=A.BLACK,a$=A.MAGENTA;ab=aj("GameStats"),aw=aX(-1e3),aS=aY(P),aE=aY(P),a_=aY(P),ak=aY(P),aC=aY(P),aA=aY(P),aT=aY(P),aR=aY(P),ab(aI=aw((aL=st((aP=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"fpsLabel",aL,Ke(g)),rt(g,"drawCountLabel",aO,Ke(g)),rt(g,"logicTimeLabel",aB,Ke(g)),rt(g,"physicTimeLabel",aN,Ke(g)),rt(g,"renderTimeLabel",aM,Ke(g)),rt(g,"objectMemoryUsageLabel",aD,Ke(g)),rt(g,"textureMemoryUsageLabel",aF,Ke(g)),rt(g,"devicePixelRatioLabel",aU,Ke(g)),g.refreshInterval=.5,g.handleMouseDown=function(){g.bg.enabled=!g.bg.enabled},g.waitForStats=function(){ey.stats&&(g.unschedule(g.waitForStats),g.node.active=!0,g.stats=ey.stats,g.startUpdateStats())},g.updateStats=function(){g.updateFps(),g.updateDrawCalls(),g.updateLogicTime(),g.updatePhysicTime(),g.updateRenderTime(),g.updateObjectMemoryUsage(),g.updateTextureMemoryUsage(),g.updateDevicePixelRatio()},g}return Ue(n,[{key:"__preload",value:function(){this.bg=this.getComponent(eo),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(ep.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,ey&&aJ.isDebugger()&&(ey.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var g=this.getFps();this.updateFpsColor(g),this.fpsLabel.string="FPS: ".concat(g)}},{key:"updateFpsColor",value:function(g){this.fpsLabel.color=g<30?aQ:g<48?a$:aZ}},{key:"updateDrawCalls",value:function(){var g=this.getDrawCalls();this.updateDrawCallsColor(g),this.drawCountLabel.string="Draw Calls: ".concat(g)}},{key:"updateDrawCallsColor",value:function(g){var E=ev.os===ev.OS.IOS,_=E?80:25,k=E?60:15;this.drawCountLabel.color=g>_?aQ:g>k?a$:aZ}},{key:"updateLogicTime",value:function(){var g=this.getLogicTime();this.updateLogicTimeColor(g),this.logicTimeLabel.string="Logic Time: ".concat(g.toFixed(2),"ms")}},{key:"updateLogicTimeColor",value:function(g){this.logicTimeLabel.color=g>10?aQ:g>5?a$:aZ}},{key:"updatePhysicTime",value:function(){var g=this.getPhysicTime();this.updatePhysicTimeColor(g),this.physicTimeLabel.string="Physic Time: ".concat(g.toFixed(2),"ms")}},{key:"updatePhysicTimeColor",value:function(g){this.physicTimeLabel.color=g>10?aQ:g>5?a$:aZ}},{key:"updateRenderTime",value:function(){var g=this.getRenderTime();this.updateRenderTimeColor(g),this.renderTimeLabel.string="Render Time: ".concat(g.toFixed(2),"ms")}},{key:"updateRenderTimeColor",value:function(g){this.renderTimeLabel.color=g>10?aQ:g>5?a$:aZ}},{key:"updateObjectMemoryUsage",value:function(){var g=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(g),this.objectMemoryUsageLabel.string="Object Mem: ".concat(g.toFixed(2),"MB")}},{key:"updateObjectMemoryUsageColor",value:function(g){this.objectMemoryUsageLabel.color=g>40?aQ:g>25?a$:aZ}},{key:"updateTextureMemoryUsage",value:function(){var g=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(g),this.textureMemoryUsageLabel.string="Texture Mem: ".concat(g.toFixed(2),"MB")}},{key:"updateTextureMemoryUsageColor",value:function(g){this.textureMemoryUsageLabel.color=g>50?aQ:g>35?a$:aZ}},{key:"updateDevicePixelRatio",value:function(){var g=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(g),this.devicePixelRatioLabel.string="Device Pixel Ratio: ".concat(g)}},{key:"updateDevicePixelRatioColor",value:function(g){this.devicePixelRatioLabel.color=g>2?aQ:g<=1?a$:aZ}},{key:"getFps",value:function(){var g=this.stats.fps.counter;return Math.floor(g.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var g=this.stats.logic.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getPhysicTime",value:function(){var g=this.stats.physics.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getRenderTime",value:function(){var g=this.stats.render.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var g=this.stats.bufferMemory.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var g=this.stats.textureMemory.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),n}(M)).prototype,"fpsLabel",[aS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aO=st(aP.prototype,"drawCountLabel",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aB=st(aP.prototype,"logicTimeLabel",[a_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aN=st(aP.prototype,"physicTimeLabel",[ak],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aM=st(aP.prototype,"renderTimeLabel",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aD=st(aP.prototype,"objectMemoryUsageLabel",[aA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aF=st(aP.prototype,"textureMemoryUsageLabel",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aU=st(aP.prototype,"devicePixelRatioLabel",[aR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aI=aP))||aI);_._RF.pop(),_._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var a0,a1=function(g){return g.INVITE_FRIENDS="invite-friends",g.REPLAY_FRIENDS="replay-friends",g.SHOW_CHALLENGE_RESULTS="show-challenge-results",g.NEXT_LEVEL="next-level",g.MAX_LEVEL="max-level",g.START_OVER="start-over",g.SELECT_LEVEL="select-level",g.GAME_START="game-start",g.GAME_PAUSE="game-pause",g.GAME_RESUME="game-resume",g.GAME_REPLAY="game-replay",g.GAME_FINISH="game-finish",g.GAME_EXIT="game-exit",g.USE_ITEM="use-item",g.SKIP_LEVEL="skip-level",g.ADD_ITEM="add-item",g.ADD_ITEMS="add-items",g.ADD_COINS="add-coins",g.REMOVE_COINS="remove-coins",g.REMOVE_COINS_SUCCESS="remove-coins-success",g.REMOVE_COINS_FAILED="remove-coins-failed",g.COIN_CHANGED="coin-changed",g.ABORT_COIN_ANIMATION="abort-coin-animation",g.ADD_STARS="add-stars",g.PAUSE_TIME="pause-time",g.RESUME_TIME="resume-time",g.TIME_OUT="time-out",g.HALF_TIME="half-time",g.RESCUE_START="rescue-time",g.RESCUE_FINISHED="clock-animation-finished",g.APPLY_GRAVITY="apply-gravity",g.IDLE_ENTER="idle-enter",g.IDLE_EXIT="idle-exit",g.GRID_MATCH="grid-match",g.GRID_MATCH_SUCCESS="grid-match-success",g.GRID_MATCH_FAIL="grid-match-fail",g.GRID_CLEAR="grid-clear",g.GRID_SPAWN="grid-spawn",g.GRID_CREATE="grid-create",g.GRID_RESIZE="grid-resize",g.TILE_CLICK="tile-click",g.BOMB_EXPLODE="bomb-explode",g.SHOW_HINT="show-hint",g.ADD_COMBO="add-combo",g.COMBO_UPDATED="combo-updated",g.COMBO_ENDED="combo-ended",g.ADD_SCORE="add-score",g.SCORE_UPDATED="score-updated",g.SHOW_UI="show-ui",g.HIDE_UI="hide-ui",g.AUTO_PLAY="auto-play",g.GUIDE_MASK_CLICKED="guide-mask-clicked",g}(a1||{});_._RF.pop(),_._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var a2,a4,a5,a6,a8,a9,a7,re,rn,ri,ra,rr,ro,rs,rl,ru,rc,rh,rp=(0,k.ccclass)("PanelAnimationController")(a0=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).animators=new Set,g.eventTarget=new eg,g.handleRegistration=function(E){if(!E)throw new Error("Invalid event payload.");g.animators.has(E)&&console.warn("Animator already registered."),g.animators.add(E)},g.handleUnregistration=function(E){if(!E)throw new Error("Invalid event payload.");g.animators.has(E)||console.warn("Animator not registered."),g.animators.delete(E)},g.handleShowUIs=function(){var E=Be(function(E){var _,k,C,A,T,R,I,P,L,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:C=!1,A=[],T=at(g.animators);try{for(T.s();!(k=T.n()).done;){R=k.value;A.push(R)}}catch(g){T.e(g)}finally{T.f()}for(I=[],P=0,L=A;P<L.length;P++){B=L[P];if(!B.isReadyForAnimation()&&!C)C=!0,null==E||null===(O=E.fallback)||void 0===O||O.call(E);I.push(B.handleShowUI())}return[4,Promise.all(I)];case 1:N.sent(),null==E||null===(_=E.onComplete)||void 0===_||_.call(E),g.eventTarget.emit(a1.SHOW_UI);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g.handleHideUIs=function(){var E=Be(function(E){var _,k,C,A,T,R,I,P,L,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:C=!1,A=[],T=at(g.animators);try{for(T.s();!(k=T.n()).done;){R=k.value;A.push(R)}}catch(g){T.e(g)}finally{T.f()}for(I=[],P=0,L=A;P<L.length;P++){B=L[P];if(!B.isReadyForAnimation()&&!C)C=!0,null==E||null===(O=E.fallback)||void 0===O||O.call(E);I.push(B.handleHideUI())}return[4,Promise.all(I)];case 1:N.sent(),null==E||null===(_=E.onComplete)||void 0===_||_.call(E),g.eventTarget.emit(a1.HIDE_UI);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(n,[{key:"onEnable",value:function(){this.node.scene.on(a1.SHOW_UI,this.handleShowUIs,this),this.node.scene.on(a1.HIDE_UI,this.handleHideUIs,this)}},{key:"onDisable",value:function(){this.node.scene.off(a1.SHOW_UI,this.handleShowUIs,this),this.node.scene.off(a1.HIDE_UI,this.handleHideUIs,this)}},{key:"showUI",value:function(){return this.handleShowUIs()}},{key:"hideUI",value:function(){return this.handleHideUIs()}},{key:"on",value:function(g,E,_,k){this.eventTarget.on(g,E,_,k)}},{key:"off",value:function(g,E,_){this.eventTarget.off(g,E,_)}}],[{key:"getController",value:function(g){for(var E=null,_=g;null!==_;){if(E=_.getComponent(n))break;_=_.parent}return E}},{key:"registerAnimator",value:function(g){var E=this.getController(g.node);E?E.handleRegistration(g):console.warn("No PanelAnimationController found for animator ".concat(g.node.name))}},{key:"unregisterAnimator",value:function(g){var E=this.getController(g.node);E?E.handleUnregistration(g):console.warn("No PanelAnimationController found for animator ".concat(g.node.name))}}]),n}(M))||a0;_._RF.pop(),_._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var rd,rf,ry,rv,rg,rm,rb,rw,rS=k.ccclass,rE=k.property,r_=GameCore.Utils.Object,rk=(a2=rS("AnimationConfig"),a4=rE({type:[H]}),a2((a8=st((a6=function(){function e(){Fe(this,e),rt(this,"startHidden",a8,this),rt(this,"nodes",a9,this),rt(this,"posOffset",a7,this),rt(this,"showEase",re,this),rt(this,"hideEase",rn,this),rt(this,"showDuration",ri,this),rt(this,"hideDuration",ra,this)}return Ue(e,[{key:"setConfig",value:function(g){g&&r_.assign(this,g)}}]),e}()).prototype,"startHidden",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),a9=st(a6.prototype,"nodes",[a4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),a7=st(a6.prototype,"posOffset",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),re=st(a6.prototype,"showEase",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),rn=st(a6.prototype,"hideEase",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),ri=st(a6.prototype,"showDuration",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ra=st(a6.prototype,"hideDuration",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a5=a6))||a5),rC=(rr=rS("PanelAnimator"),ro=rE({type:rk,displayName:"Top animation nodes"}),rs=rE({type:rk,displayName:"Bottom animation nodes"}),rr((rc=st((ru=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"topConfig",rc,Ke(g)),rt(g,"botConfig",rh,Ke(g)),g.isReady=!1,g}return Ue(a,[{key:"onEnable",value:function(){rp.registerAnimator(this)}},{key:"onDisable",value:function(){rp.unregisterAnimator(this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(_=Be(function(){return _ts_generator(this,function(g){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return _.apply(this,arguments)})},{key:"handleHideUI",value:(E=Be(function(){return _ts_generator(this,function(g){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return E.apply(this,arguments)})},{key:"createAnimator",value:function(g,E){var _=g.nodes,k=g.posOffset,C=g.showEase,A=g.hideEase,T=g.showDuration,R=g.hideDuration,I=_.map(function(g){return"top"===E&&g.isAlignTop?{mode:"top",value:g.top}:"bottom"===E&&g.isAlignBottom?{mode:"bottom",value:g.bottom}:{mode:"position",value:g.node.position.y}}),P=_.map(function(g){return"top"===E&&g.isAlignTop?{mode:"top",value:g.top+k}:"bottom"===E&&g.isAlignBottom?{mode:"bottom",value:g.bottom-k}:{mode:"position",value:g.node.position.y+k}}),L="shown",O=new nM;return{switchState:function(g,E){var k=arguments.length>1&&void 0!==E&&E;if(O.abort(),O=new nM,L===g)return Promise.resolve(null);L=g;var B="hidden"===g?I:P,N="hidden"===g?P:I,M="hidden"===g?R:T,D="hidden"===g?A:C;return k?(_.forEach(function(g,E){var _=B[E],k=N[E].value;"top"===_.mode&&(g.top=k),"bottom"===_.mode&&(g.bottom=k),"position"===_.mode&&(g.node.position=new em(g.node.position.x,k,g.node.position.z))}),Promise.resolve(null)):Promise.all(_.map(function(g,E){var _=B[E],k=N[E].value;return tZ.runTweenAsync(a.getTween({widget:g,config:_,target:k,easing:D,duration:M}),O)}))}}}},{key:"setAnimator",value:function(g){var E=g.topConfig,_=g.botConfig,k=new rk,C=new rk;k.setConfig(E),C.setConfig(_),this.topConfig=k,this.botConfig=C,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(g){var E=g.widget,_=g.config,k=g.target,C=g.easing,A=g.duration;return"top"===_.mode?z(E).call(function(){E.top=_.value}).to(A,{top:k},{easing:C}):"bottom"===_.mode?z(E).call(function(){E.bottom=_.value}).to(A,{bottom:k},{easing:C}):z(E.node.position).call(function(){E.node.position=new em(E.node.position.x,_.value,E.node.position.z)}).to(A,{y:k},{easing:C})}}]),a}(M)).prototype,"topConfig",[ro],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rk}}),rh=st(ru.prototype,"botConfig",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rk}}),rl=ru))||rl);_._RF.pop(),_._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var rA,rT,rR,rI,rP,rL,rO,rB,rN,rM,rD,rF=k.ccclass,rU=k.requireComponent,rx=k.property,rz=globalThis.game,rG=rz.ads,rV=rz.event,rK=GameCore,rH=rK.Events,rq=rK.Configs.Ads.BannerDisplayAdOptions,rW=rK.Plugins.Ads.Types,rj=rK.Utils,rX=rj.Array,rY=rj.Function,rJ=["top","topleft","topright"],rQ=["bottom","bottomleft","bottomright"],rZ=["left","topleft","bottomleft"],r$=["right","topright","bottomright"];rd=rF("ResizeWithBannerAd"),rf=rU(H),ry=rx(J),rv=rx(J),rd(rg=rf((rb=st((rm=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"includeSAB",rb,Ke(g)),rt(g,"includeBanner",rw,Ke(g)),g.handleOnAdShowing=function(E){var _=E.placementId;g.checkValid()&&_&&rG.getAd(rW.BANNER,_)&&(g.resizeWhenBannerAdShow(_),g.emitResizeEvent())},g.handleOnAdClosed=function(E){var _=E.placementId;g.checkValid()&&_&&rG.getAd(rW.BANNER,_)&&(g.resizeWhenBannerAdClose(_),g.emitResizeEvent())},g.handleOnResize=function(){g.checkValid()&&rq.forEach(function(E){var _=E.PlacementId;g.resizeWhenBannerAdShow(_)})},g.resizeWhenBannerAdShow=function(E){var _=void 0,k=void 0,C=void 0,A=void 0,T=ns.cssSizeToWorldSize(1),R=rG.getBannerConfig(E),I=R.PlacementId,P=R.BannerWidth,L=R.Position;if("top"===L)_=rG.getBannerHeight(I,T);else if("bottom"===L)g.includeBanner?k=rG.getBannerHeight(I,T,g.includeSAB):g.includeSAB&&(k=rG.getSafeAreaBottom(T));else if("left"===L||"right"===L){if(void 0===P)return;var O=P;"getBannerOffset"in GameSDK.extra&&(O+=GameSDK.extra.getBannerOffset()),"left"===L?C=O*T:A=O*T}g.updateWidgets({top:_,bottom:k,left:C,right:A})},g.resizeWhenBannerAdClose=function(E){var _=rG.getBannerConfig(E).Position,k=ns.cssSizeToWorldSize(1),C=g.includeSAB?rG.getSafeAreaBottom(k):0;g.updateWidgets({top:rX.has(rJ,_)?0:void 0,bottom:rX.has(rQ,_)?C:void 0,left:rX.has(rZ,_)?0:void 0,right:rX.has(r$,_)?0:void 0})},g.emitResizeEvent=rY.debounce(function(){Q.emit(no)},100),g}return Ue(n,[{key:"__preload",value:function(){this.widget=this.getComponent(H),nC.lazyValidateProperties(this),rV.on(rH.AD_SHOWING,this.handleOnAdShowing),rV.on(rH.AD_CLOSED,this.handleOnAdClosed),Q.on(t3,this.handleOnResize)}},{key:"onDestroy",value:function(){rV.off(rH.AD_SHOWING,this.handleOnAdShowing),rV.off(rH.AD_CLOSED,this.handleOnAdClosed),Q.off(t3,this.handleOnResize)}},{key:"start",value:function(){this.handleOnResize()}},{key:"updateWidgets",value:function(g){var E=g.top,_=g.bottom,k=g.left,C=g.right;this.widget.top=null!=E?E:this.widget.top,this.widget.bottom=null!=_?_:this.widget.bottom,this.widget.left=null!=k?k:this.widget.left,this.widget.right=null!=C?C:this.widget.right,eb.instance.emit("canvas-resize")}},{key:"checkValid",value:function(){return this.node.activeInHierarchy&&null!==this.node.parent&&void 0!==this.node.parent}}]),n}(M)).prototype,"includeSAB",[ry],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rw=st(rm.prototype,"includeBanner",[rv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rg=rm))||rg);_._RF.pop(),_._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var r0,r1,r2,r4,r3,r5,r6,r8=k.ccclass,r9=k.property,r7=k.executeInEditMode,oe=k.requireComponent,on=(rA=r8("TapperedProgressBar"),rT=oe(eu),rR=r9({type:eu,displayName:"Fill opacity"}),rI=r9({type:eo,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),rP=r9({type:eo,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),rL=r9({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),rA(rO=r7(rO=rT((rN=st((rB=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"uiOpacity",rN,Ke(g)),rt(g,"leftCap",rM,Ke(g)),rt(g,"rightCap",rD,Ke(g)),g}return Ue(n,[{key:"progress",get:function(){return Je(Ve(n.prototype),"progress",this)},set:function(g){$e(Ve(n.prototype),"progress",g,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity){if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var g=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=g}}}},{key:"start",value:function(){this.updateAppearance()}}]),n}(ew)).prototype,"uiOpacity",[rR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rM=st(rB.prototype,"leftCap",[rI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rD=st(rB.prototype,"rightCap",[rP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st(rB.prototype,"progress",[rL],Object.getOwnPropertyDescriptor(rB.prototype,"progress"),rB.prototype),rO=rB))||rO)||rO)||rO);_._RF.pop(),_._RF.push({},"aa60frMJLtIlJZh2yJhMp1s","DynamicLabel",void 0);var oi,oa,or,oo,os,ol,ou,oc,oh,op,od=k.ccclass,of=k.property,oy=k.executeInEditMode,ov=k.requireComponent;r0=od("DynamicLabel"),r1=ov(P),r2=oy(!0),r4=of({type:K,min:1,max:200}),r3=of({type:K,min:.1,max:4}),r0(r5=r1(r5=r2((st((r6=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k)))._quality=1,g._size=1,g._outlineWidth=0,g._shadowOffset=new eS(0,0),g}return Ue(n,[{key:"size",get:function(){return this._size},set:function(g){this._size=g,this.label.fontSize=this.size*this.quality}},{key:"quality",get:function(){return this._quality},set:function(g){this._quality=g,this.node.scale=new em(1/this.quality,1/this.quality,1),this.label.fontSize=this.size*this.quality,this.label.outlineWidth=this._outlineWidth*this.quality,this.label.shadowOffset=this._shadowOffset.multiplyScalar(this.quality)}},{key:"__preload",value:function(){this.label=this.getComponent(P)}},{key:"start",value:function(){this._quality=1/this.node.scale.x,this._size=this.label.fontSize/this.quality,this._outlineWidth=this.label.outlineWidth,this._shadowOffset=this.label.shadowOffset,this.quality=window.devicePixelRatio,console.info("\uD83D\uDD20 ".concat(this.node.name,"<Label> quality:"),this.quality)}}]),n}(M)).prototype,"size",[r4],Object.getOwnPropertyDescriptor(r6.prototype,"size"),r6.prototype),st(r6.prototype,"quality",[r3],Object.getOwnPropertyDescriptor(r6.prototype,"quality"),r6.prototype),r5=r6))||r5)||r5);_._RF.pop(),_._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var og,om,ob,ow,oS,oE,o_,ok,oC,oA=k.ccclass,oT=k.property,oR=k.requireComponent,oI=k.executeInEditMode,oP=k.disallowMultiple,oL=globalThis.game.language;oi=oA("Localize"),oa=oR(P),or=oI(!0),oo=oT({visible:!0}),os=oT({group:{name:"Fonts",id:"fonts",displayOrder:1},type:eE}),ol=oT({group:{name:"Fonts",id:"fonts",displayOrder:2},type:eE}),oi(ou=oP(ou=oa(ou=or((st((oc=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"enFont",oh,Ke(g)),rt(g,"ruFont",op,Ke(g)),g.handleLanguageChanged=function(){g.updateTransToNode()},g}return Ue(n,[{key:"key",get:function(){return this._key},set:function(g){g&&(this._key=g,this.updateTransToNode())}},{key:"__preload",value:function(){this.label=this.getComponent(P),this.validateRequiredComponents(),this.updateTransToNode()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"start",value:function(){this.listenEvent()}},{key:"listenEvent",value:function(){Q.on("update-language",this.handleLanguageChanged)}},{key:"updateTransToNode",value:function(){if(this.node.active&&this._key)try{var g=oL.getText(this._key),E=this.getFontByLang();this.label.font=E,this.label.string=g,this.node.emit("update-trans",g)}catch(g){console.warn(g)}}},{key:"getFontByLang",value:function(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(oL.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}]),n}(M)).prototype,"key",[oo],Object.getOwnPropertyDescriptor(oc.prototype,"key"),oc.prototype),oh=st(oc.prototype,"enFont",[os],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),op=st(oc.prototype,"ruFont",[ol],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ou=oc))||ou)||ou)||ou);_._RF.pop(),_._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var oO,oB,oN,oM,oD,oF,oU,ox,oz,oG=k.ccclass,oV=k.property,oK=function(){function e(g,E){Fe(this,e);var _=null!=E?E:{response:1,dampen:1,eager:1};this.k1=e.calcK1(_),this.k2=e.calcK2(_),this.k3=e.calcK3(_),this.xp=g.clone(),this.y=g.clone(),this.yd=new eS(0,0)}return Ue(e,[{key:"update",value:function(g,E,_){var k=arguments.length>2&&void 0!==_?_:null,C=k;null===C&&(C=new eS((E.x-this.xp.x)/g,(E.y-this.xp.y)/g),this.xp.x=E.x,this.xp.y=E.y);var A=Math.max(this.k2,g*g/2+g*this.k1/2,g*this.k1);return this.y.x=this.y.x+g*this.yd.x,this.y.y=this.y.y+g*this.yd.y,this.yd.x=this.yd.x+g*(E.x+this.k3*C.x-this.y.x-this.k1*this.yd.x)/A,this.yd.y=this.yd.y+g*(E.y+this.k3*C.y-this.y.y-this.k1*this.yd.y)/A,this.y}},{key:"setDynamics",value:function(g){this.k1=e.calcK1(g),this.k2=e.calcK2(g),this.k3=e.calcK3(g)}},{key:"reset",value:function(g){this.xp.set(g.x,g.y),this.y.set(g.x,g.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(g){return g.dampen/(Math.PI*g.response)}},{key:"calcK2",value:function(g){return 1/(2*Math.PI*g.response*(2*Math.PI*g.response))}},{key:"calcK3",value:function(g){return g.eager*g.dampen/(2*Math.PI*g.response)}}]),e}(),oH=(og=oG("SODConfig"),om=oV({type:K,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),ob=oV({type:K,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),ow=oV({type:K,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),og((o_=st((oE=Ue(function e(){Fe(this,e),rt(this,"response",o_,this),rt(this,"dampen",ok,this),rt(this,"eager",oC,this)})).prototype,"response",[om],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),ok=st(oE.prototype,"dampen",[ob],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),oC=st(oE.prototype,"eager",[ow],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oS=oE))||oS);_._RF.pop(),_._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var oq,oW,oj,oX,oY,oJ,oQ,oZ,o$,o0,o1,o2,o4,o3,o5,o6,o8,o9,o7,se,sn,si,sa,sr,so,ss,sl=k.ccclass,su=k.property,sc=(oO=sl("Trail"),oB=su({type:C,displayName:"Target"}),oN=su({type:ef,displayName:"Graphics"}),oM=su({type:[oH],displayName:"Trail Nodes"}),oO((oU=st((oF=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"target",oU,Ke(g)),rt(g,"graphics",ox,Ke(g)),rt(g,"trailNodes",oz,Ke(g)),g.trailNodeInstances=[],g}return Ue(n,[{key:"reset",value:function(){var g,E=at(this.trailNodeInstances);try{for(E.s();!(g=E.n()).done;)g.value.reset(new eS(this.node.worldPosition.x,this.node.worldPosition.y))}catch(g){E.e(g)}finally{E.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(g){this.graphics.clear();var E=this.trailNodeInstances[0];this.drawTrail(g,E,this.target.worldPosition.x,this.target.worldPosition.y);for(var _=1;_<this.trailNodeInstances.length;_++){var k=this.trailNodeInstances[_-1],C=this.trailNodeInstances[_];this.drawTrail(g,C,k.currentState.x,k.currentState.y)}}},{key:"drawTrail",value:function(g,E,_,k){var C=this.graphics,A=new eS(_,k),T=E.update(g,A),R=new em(A.x,A.y,0),I=new em(T.x,T.y,0);C.node.inverseTransformPoint(R,R),C.node.inverseTransformPoint(I,I),C.moveTo(R.x,R.y),C.lineTo(I.x,I.y),C.stroke()}},{key:"spawnTrailNodes",value:function(){var g,E=at(this.trailNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value,k=new eS(this.node.worldPosition.x,this.node.worldPosition.y),C=new oK(k,_);this.trailNodeInstances.push(C)}}catch(g){E.e(g)}finally{E.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(M)).prototype,"target",[oB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ox=st(oF.prototype,"graphics",[oN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oz=st(oF.prototype,"trailNodes",[oM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oD=oF))||oD);_._RF.pop(),_._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var sh,sp=k.ccclass,sf=k.executionOrder,sy=k.property,sv=GameCore.Utils.Function,sg="Batch By Name",sm="Batch Label",sb="Batch Sprite",sw=(oq=sp("BatchNodes"),oW=sf(99999),oj=sy({group:{name:sg}}),oX=sy({type:[V],group:{name:sg}}),oY=sy({type:[x],group:{name:sg}}),oJ=sy({group:{name:sm}}),oQ=sy({group:{name:sm}}),oZ=sy({group:{name:sm}}),o$=sy({group:{name:sb}}),o0=sy({group:{name:sb}}),o1=sy({readonly:!0}),o2=sy({readonly:!0}),o4=sy({readonly:!0}),oq(o3=oW((o6=st((o5=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"batchByName",o6,Ke(g)),rt(g,"depthNames",o8,Ke(g)),rt(g,"listName",o9,Ke(g)),rt(g,"batchLabel",o7,Ke(g)),rt(g,"depthLabel",se,Ke(g)),rt(g,"typeLabel",sn,Ke(g)),rt(g,"batchSprite",si,Ke(g)),rt(g,"depthSprite",sa,Ke(g)),rt(g,"batchAllNodes",sr,Ke(g)),rt(g,"batchDepth",so,Ke(g)),rt(g,"checkOverlap",ss,Ke(g)),g.batchNode={},g.labelChildren=[],g.spriteChildren=[],g.allChildren=[],g.nameChildren=[],g.originalParents={},g.isInited=!1,g.handleNodeChange=sv.throttle(function(){g.isInited&&(console.warn("handleNodeChange",g.node.name),g.setupBatchNodes(g.node))},1e3),g.onAfterUpdate=function(){g.isInited&&g.hierarchyChildren()},g.onAfterRender=function(){g.isInited&&g.restoreOriginalChildren()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled&&(N.on(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.on(e_.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){N.off(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.off(e_.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){this.isInited||(N.on(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.on(e_.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"handleActiveChange",value:function(g){g.once(C.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.handleNodeChange)}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),N.off(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.off(e_.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(g){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(g),this.createGlobalNodes(g),this.createGlobalNameNodes(g),this.createGlobalLabelNode(g),this.createGlobalSpriteNode(g),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var g,E,_,k=this;null===(g=this.batchNode.node)||void 0===g||g.setSiblingIndex(0),null===(E=this.batchNode.label)||void 0===E||E.setSiblingIndex(this.depthLabel),null===(_=this.batchNode.sprite)||void 0===_||_.setSiblingIndex(this.depthSprite),this.listName.forEach(function(g,E){var _;console.log("name",g,k.depthNames[E]),null===(_=k.batchNode[g])||void 0===_||_.setSiblingIndex(k.depthNames[E])})}},{key:"createGlobalNodes",value:function(g){if(this.batchAllNodes){var E=new C("GlobalBatchNode");E.active=!0,this.batchNode.node=E,g.addChild(E)}}},{key:"createGlobalNameNodes",value:function(g){if(this.batchByName){var E,_=at(this.listName);try{for(_.s();!(E=_.n()).done;){var k=E.value;if(!this.batchNode[k]){var A=new C(k);A.active=!0,this.batchNode[k]=A,g.addChild(A)}}}catch(g){_.e(g)}finally{_.f()}}}},{key:"createGlobalLabelNode",value:function(g){if(this.batchLabel){var E=new C("GlobalLabelNode");E.active=!0,this.batchNode.label=E,g.addChild(E)}}},{key:"createGlobalSpriteNode",value:function(g){if(this.batchSprite){var E=new C("GlobalSpriteNode");E.active=!0,this.batchNode.sprite=E,g.addChild(E)}}},{key:"saveOriginalParents",value:function(){var g,E=[].concat(tt(this.labelChildren),tt(this.spriteChildren)),_=this.nameChildren,k=at(E);try{for(k.s();!(g=k.n()).done;){var C=g.value;C.node.parent&&(this.handleActiveChange(C.node),this.originalParents[C.uuid]=C.node.parent)}}catch(g){k.e(g)}finally{k.f()}var A,T=at(_);try{for(T.s();!(A=T.n()).done;){var R=A.value;R.parent&&(this.handleActiveChange(R),this.originalParents[R.uuid]=R.parent)}}catch(g){T.e(g)}finally{T.f()}}},{key:"saveOriginalChildren",value:function(g){var E,_=at(g.children);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.saveLabelChildren(k),this.saveSpriteChildren(k),this.saveNodeChildrenByName(k),this.saveNodeChildrenByType(k)}}catch(g){_.e(g)}finally{_.f()}this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(g){var E;if(this.batchLabel){var _=g.getComponentsInChildren(P);"char"===this.typeLabel&&(_=_.filter(function(g){return g.cacheMode===P.CacheMode.CHAR})),0!==_.length&&(E=this.labelChildren).push.apply(E,tt(_))}}},{key:"saveSpriteChildren",value:function(g){var E;if(this.batchSprite){var _=g.getComponentsInChildren(eo);0!==_.length&&(E=this.spriteChildren).push.apply(E,tt(_))}}},{key:"saveNodeChildrenByName",value:function(g){if(this.batchByName){var E,_=at(g.children);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.listName.includes(k.name)?this.nameChildren.push(k):this.saveNodeChildrenByName(k)}}catch(g){_.e(g)}finally{_.f()}}}},{key:"saveNodeChildrenByType",value:function(g,E){var _,k=arguments.length>1&&void 0!==E?E:0;if(this.batchAllNodes){var C=g.getComponentsInChildren(M);if((_=this.allChildren).push.apply(_,tt(C)),!(this.batchDepth<1||k>=this.batchDepth)){var A,T=at(this.allChildren);try{for(T.s();!(A=T.n()).done;){var R=A.value;this.saveNodeChildrenByType(R.node,this.batchDepth)}}catch(g){T.e(g)}finally{T.f()}}}}},{key:"hierarchyChildren",value:function(){var g,t=function(g,E){g.node.isValid&&g.node.activeInHierarchy&&!g.node.isChildOf(E)&&(g.node.setParent(E,!0),g.node.layer=ek.Enum.UI_2D)},E=["GlobalLabelNode","GlobalSpriteNode","GlobalBatchNode"],_=at(this.labelChildren);try{for(_.s();!(g=_.n()).done;)t(g.value,this.batchNode.label)}catch(g){_.e(g)}finally{_.f()}var k,C=at(this.spriteChildren);try{for(C.s();!(k=C.n()).done;)t(k.value,this.batchNode.sprite)}catch(g){C.e(g)}finally{C.f()}var A,T=at(this.allChildren);try{for(T.s();!(A=T.n()).done;)t(A.value,this.batchNode.node)}catch(g){T.e(g)}finally{T.f()}this.allChildren.sort(function(g,E){return g.constructor.name.localeCompare(E.constructor.name)}),this.labelChildren.sort(function(g,E){return g.cacheMode-E.cacheMode});var R,I=at(this.nameChildren);try{for(I.s();!(R=I.n()).done;){var P=R.value;if(P.isValid&&P.activeInHierarchy&&P.isTransformDirty()){var L=P.getComponent(eu);L&&L.opacity<1||E.includes(P.name)||P.isChildOf(this.batchNode[P.name])||(P.setParent(this.batchNode[P.name],!0),P.layer=ek.Enum.UI_2D)}}}catch(g){I.e(g)}finally{I.f()}}},{key:"restoreOriginalChildren",value:function(){var g=[].concat(tt(this.labelChildren),tt(this.spriteChildren));if(g.length>0){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value,C=this.originalParents[k.uuid];C&&(k.node.isChildOf(C)||k.node.setParent(C,!0))}}catch(g){_.e(g)}finally{_.f()}}var A,T=at(this.nameChildren);try{for(T.s();!(A=T.n()).done;){var R=A.value,I=this.originalParents[R.uuid];I&&(R.isChildOf(I)||R.setParent(I,!0))}}catch(g){T.e(g)}finally{T.f()}}}]),n}(M)).prototype,"batchByName",[oj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),o8=st(o5.prototype,"depthNames",[oX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),o9=st(o5.prototype,"listName",[oY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),o7=st(o5.prototype,"batchLabel",[oJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),se=st(o5.prototype,"depthLabel",[oQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),sn=st(o5.prototype,"typeLabel",[oZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),si=st(o5.prototype,"batchSprite",[o$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sa=st(o5.prototype,"depthSprite",[o0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sr=st(o5.prototype,"batchAllNodes",[o1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),so=st(o5.prototype,"batchDepth",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ss=st(o5.prototype,"checkOverlap",[o4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),o3=o5))||o3)||o3);_._RF.pop(),_._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var sS=k.ccclass,sE=GameCore.Utils.Browser,s_=globalThis.game.player,sk=sS("Vibrate")(sh=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"vibrate",value:function(g){if(this.isVibrateEnable()&&!sE.vibrate(g)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!s_.getPlayerSetting("vibrate")}}]),n}(M))||sh;_._RF.pop(),_._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);var sC=1/6;_._RF.pop(),_._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);var sA,sT={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};_._RF.pop(),_._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var sR=10,sI=20,sP=100,sL=(Ge(sA={},sT.HINT,80),Ge(sA,sT.THUNDER,200),Ge(sA,sT.STORM,150),Ge(sA,sT.PLIERS,150),sA),sO=2e3,sB=300;_._RF.pop(),_._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var sN={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};_._RF.pop(),_._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);var sM=Me(Me({},GameCore.Dtos.Match.Data.getDefaultData()),{},{extraData:null});_._RF.pop(),_._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var sD=function(g){return g.UNLOCK_DEV_TOOLS="unlock-dev-tools",g.TRIGGER_UNLOCK_KEY="trigger-unlock-key",g.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",g}(sD||{}),sF={Events:sD,UNLOCK_SEQUENCE:"101013012031"};_._RF.pop(),_._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);var sU;_._RF.pop(),_._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);var sx={level:0,coins:0,stars:0,totalLevel:400,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:(sU={},Ge(sU,sT.HINT,0),Ge(sU,sT.THUNDER,0),Ge(sU,sT.STORM,0),Ge(sU,sT.PLIERS,0),sU)};_._RF.pop(),_._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);var sz="global-leaderboard-key",sG="friends-leaderboard-key",sV="global-leaderboard-id",sK="friends-leaderboard-id";_._RF.pop(),_._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);var sH=Me(Me({},GameCore.Dtos.Match.CustomData.getDefaultData()),{},{score:0});_._RF.pop(),_._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);var sq={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:sx,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};_._RF.pop(),_._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);var sW="BootScene",sj="GameScene",sX="DashboardScene",sY="ChallengeResultScene";_._RF.pop(),_._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var sJ=function(g){return g.RELOAD_TOURNAMENT="reload-tournament",g}(sJ||{});_._RF.pop(),_._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);var sQ=GameCore,sZ=sQ.Configs.FrameCapture,s$=sZ.Enabled,s0=sZ.WideframeConfigs,s1=sQ.Utils.Object,s2=function(){var g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){if(!s$)return[2,(console.warn("FrameCapture is not enabled"),null)];E=mu(g);if(!E)return[2,null];vu(E,s0.CustomResultChallenge);_=window.game.frameCapture,k=s0.CustomResultChallenge,C=k.Width,A=k.Height;return[2,_.captureAsync({name:"CustomResultChallenge",width:C,height:A,renderOptions:E})]})});return function(E){return g.apply(this,arguments)}}(),vu=function(g,E){var _=E.Width,k=E.Height,C=E.Wideframe;g.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:C,size:[_,k],position:[0,0]}},mu=function(g){try{var E=g.playerId,_=void 0===E?"10":E,k=g.playerPhoto,C=void 0===k?"":k,A=g.playerScore,T=void 0===A?0:A,R=g.opponentId,I=void 0===R?"20":R,P=g.opponentPhoto,L=void 0===P?"":P,O=g.opponentScore,B=void 0===O?0:O,N=g.isPlayerFinished,M=g.isOpponentFinished,D=s0.CustomResultChallenge.RenderOptions;if(!D)return null;var F=s1.camelCaseKeys(s1.clone(D)||{}),U=F.playerPhoto,x=F.opponentPhoto,z=T===B,G=T>B,V=null!=N?N:M,K=N&&M;return"image"===U.type&&(U.name="".concat(_),U.image=C),"image"===x.type&&(x.name="".concat(I),x.image=L),V&&gu(F,{playerScore:T,opponentScore:B,isPlayerFinished:N,isOpponentFinished:M}),!K||z?(delete F.leftCrown,delete F.rightCrown,F):(G?delete F.rightCrown:delete F.leftCrown,F)}catch(g){return console.warn("getRenderOptionsShareScore",g),null}},gu=function(g,E){var _=g.leftScore,k=g.rightScore,C=E.playerScore,A=void 0===C?0:C,T=E.opponentScore,R=void 0===T?0:T,I=E.isPlayerFinished,P=E.isOpponentFinished;"text"===_.type&&(_.text=I?"".concat(A):"???"),"text"===k.type&&(k.text=P?"".concat(R):"???")};_._RF.pop(),_._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var s4=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,_)).code=g,k}return Ue(n)}(je(Error));_._RF.pop(),_._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var s3=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=g,k.tournamentId=_,k}return Ue(n)}(s4);_._RF.pop(),_._RF.push({},"e80e4nIcfdLN56j5b9SMhvH","LeaderboardUtils",void 0);var s5=globalThis.game.leaderboard,s6=function(){function e(){Fe(this,e)}var g,E,_;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getAllLeaderboardAsync",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!s5)return[2,null];return[4,s5.getLeaderboardResponseAsync(g)];case 1:E=C.sent();if(!E)return[2,null];_=s5.getLeaderboardName(g);if(!_)return[3,3];return[4,this.requestLeaderboardAsync(_,E.amountPlayer)];case 2:k=(C.sent(),s5.getLeaderboard(_));return[3,4];case 3:k=null;C.label=4;case 4:return[2,k]}})}),function(g){return _.apply(this,arguments)})},{key:"requestLeaderboardAsync",value:(E=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:if(!this.isLeaderboardRequesting(g))return[3,2];return[4,this.waitForLeaderboardFinishAsync(g)];case 1:_.sent();return[3,4];case 2:return[4,s5.requestLeaderboardAsync(g,E)];case 3:_.sent();_.label=4;case 4:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"waitForLeaderboardFinishAsync",value:(g=Be(function(g){var E;return _ts_generator(this,function(_){E=this;return[2,new Promise(function(_){var k=setInterval(function(){E.isLeaderboardRequesting(g)||(clearInterval(k),_())},100)})]})}),function(E){return g.apply(this,arguments)})},{key:"isLeaderboardRequesting",value:function(g){var E;return(null===(E=s5.getLeaderboard(g))||void 0===E?void 0:E.isRequesting)||!1}}]),e}();try{new s6}catch(g){console.error("LeaderboardUtils",g)}_._RF.pop(),_._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var s8={mapOrder:[{id:1,theme:"summer",skins:["fruit"],levelCount:10},{id:2,theme:"autumn",skins:["flower"],levelCount:10},{id:3,theme:"winter",skins:["tool"],levelCount:10},{id:4,theme:"summer",skins:["sport"],levelCount:10},{id:5,theme:"autumn",skins:["cosmetics"],levelCount:10},{id:6,theme:"winter",skins:["ice-cream"],levelCount:10},{id:7,theme:"summer",skins:["cakes"],levelCount:10},{id:8,theme:"autumn",skins:["car"],levelCount:10},{id:9,theme:"spring-festival",skins:["flower","ice-cream"],levelCount:10},{id:10,theme:"tree-planting-festival",skins:["fruit","car","tool"],levelCount:10},{id:11,theme:"blue-sea-festival",skins:["sport","fruit"],levelCount:10},{id:12,theme:"music-festival",skins:["cakes","car","cosmetics"],levelCount:10},{id:13,theme:"harvest-festival",skins:["fruit","car","tool"],levelCount:10},{id:14,theme:"food-festival",skins:["cakes","ice-cream","cosmetics"],levelCount:10},{id:15,theme:"snow-festival",skins:["cakes","sport"],levelCount:10},{id:16,theme:"light-festival",skins:["ice-cream","car"],levelCount:10},{id:17,theme:"peace-festival",skins:["flower","sport","tool"],levelCount:10},{id:18,theme:"flower-festival",skins:["flower","fruit"],levelCount:10},{id:19,theme:"street-festival",skins:["fruit","ice-cream","sport"],levelCount:10},{id:20,theme:"color-garden",skins:["cakes","cosmetics","tool"],levelCount:10},{id:21,theme:"color-festival",skins:["flower","cakes","fruit"],levelCount:10},{id:22,theme:"nature-summer",skins:["flower","sport"],levelCount:10},{id:23,theme:"snow-mountain",skins:["cakes","ice-cream"],levelCount:10},{id:24,theme:"ice-festival",skins:["ice-cream","cosmetics"],levelCount:10},{id:25,theme:"green-grass-festival",skins:["flower","sport","tool"],levelCount:10},{id:26,theme:"community-festival",skins:["cosmetics","cakes","ice-cream"],levelCount:10},{id:27,theme:"water-festival",skins:["sport","ice-cream","flower"],levelCount:10},{id:28,theme:"animal-festival",skins:["flower","fruit","cakes"],levelCount:10},{id:29,theme:"lost-festival",skins:["sport","tool","car"],levelCount:10},{id:30,theme:"halloween-festival",skins:["cakes","car","fruit"],levelCount:10},{id:31,theme:"snow-music-festival",skins:["ice-cream","sport","tool"],levelCount:10},{id:32,theme:"christmas",skins:["cakes","flower","sport"],levelCount:10},{id:33,theme:"spring-flower-festival",skins:["flower","fruit"],levelCount:10},{id:34,theme:"tet-holiday",skins:["flower","cosmetics","fruit"],levelCount:10},{id:35,theme:"sea-festival",skins:["ice-cream","sport"],levelCount:10},{id:36,theme:"firework-festival",skins:["cosmetics","car","tool"],levelCount:10},{id:37,theme:"halloween-horror",skins:["cakes","car","fruit"],levelCount:10},{id:38,theme:"mid-autumn",skins:["flower","fruit","ice-cream"],levelCount:10},{id:39,theme:"christmas-sweet",skins:["cakes","flower","sport"],levelCount:10},{id:40,theme:"new-year-countdown",skins:["cosmetics","car","tool"],levelCount:10}]};_._RF.pop(),_._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);var s9={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter",SPRING_FESTIVAL:"spring-festival",TREE_PLANTING_FESTIVAL:"tree-planting-festival",BLUE_SEA_FESTIVAL:"blue-sea-festival",MUSIC_FESTIVAL:"music-festival",HARVEST_FESTIVAL:"harvest-festival",FOOD_FESTIVAL:"food-festival",SNOW_FESTIVAL:"snow-festival",LIGHT_FESTIVAL:"light-festival",PEACE_FESTIVAL:"peace-festival",FLOWER_FESTIVAL:"flower-festival",STREET_FESTIVAL:"street-festival",COLOR_GARDEN:"color-garden",COLOR_FESTIVAL:"color-festival",NATURE_SUMMER:"nature-summer",SNOW_MOUNTAIN:"snow-mountain",ICE_FESTIVAL:"ice-festival",GREEN_GRASS_FESTIVAL:"green-grass-festival",COMMUNITY_FESTIVAL:"community-festival",WATER_FESTIVAL:"water-festival",ANIMAL_FESTIVAL:"animal-festival",LOST_FESTIVAL:"lost-festival",HALLOWEEN_FESTIVAL:"halloween-festival",SNOW_MUSIC_FESTIVAL:"snow-music-festival",CHRISTMAS:"christmas",SPRING_FLOWER_FESTIVAL:"spring-flower-festival",TET_HOLIDAY:"tet-holiday",SEA_FESTIVAL:"sea-festival",FIREWORK_FESTIVAL:"firework-festival",HALLOWEEN_HORROR:"halloween-horror","MID-AUTUMN":"mid-autumn",CHRISTMAS_SWEET:"christmas-sweet",NEW_YEAR_COUNTDOWN:"new-year-countdown",HAPPY_NEW_YEAR:"happy-new-year"};Z(s9),_._RF.pop(),_._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var s7=globalThis.game,le=s7.player,lt=s7.storage,ln={id:0,currentTheme:s9.SUMMER,nextTheme:null,progress:0,max:10},li={skins:["cakes"],theme:"summer",progress:0,max:10,isLocked:!0},la=function(){function e(){Fe(this,e),this.mapData=s8,this.playerSkinProgress=null}return Ue(e,[{key:"initDashboardSceneStorage",value:function(){var g=lt.getStorage("dashboard");if(null==g){var E=this.getCurrentMapProgressInstance();lt.addStorage("dashboard",{lastMapPayload:E,numOfMapsPassed:0,animateToCurrentLevel:!1});var _=lt.getStorage("collection");if(null==_){lt.addStorage("collection",{lastMapPack:E.id,animateMapPackUnlock:!1});var k=lt.getStorage("leaderboard_content");if(null==k){lt.addStorage("leaderboard_content",{lastTabOpened:"global",previousScore:-1});var C=lt.getStorage("tournament");null==C&&lt.addStorage("tournament",{animateTournamentLeader:!1,previousScore:-1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),ln;for(var g=this.mapData.mapOrder,E=void 0,_=void 0,k=0,C=0,A=0,T=0;T<g.length;T++){var R=this.playerSkinProgress[T];if(R.currentProgress<R.maxProgress){var I,P;A=g[T].id,E=g[T].theme,_=null!==(I=null===(P=g[T+1])||void 0===P?void 0:P.theme)&&void 0!==I?I:E,k=R.currentProgress,C=R.maxProgress;break}}if(void 0===E||void 0===_){var L=g[g.length-1];return A=L.id,E=L.theme,_=L.theme,k=L.levelCount,C=L.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:A,currentTheme:E,nextTheme:_,progress:k,max:C}}return{id:A,currentTheme:E,nextTheme:_,progress:k,max:C}}},{key:"getUnlockedSkinsInstance",value:function(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];var g,E=[],_=at(this.playerSkinProgress);try{for(_.s();!(g=_.n()).done;){var k=g.value;k.isLocked||1!==k.skins.length||E.push(k.skins[0])}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"getLevelSkinsInstance",value:function(g){var E,_=null!=g?g:1,k=this.mapData.mapOrder,C=0,A=at(k);try{for(A.s();!(E=A.n()).done;){var T=E.value;if(C+T.levelCount>=_)return console.log("getMapSkin",T.skins),T.skins;C+=T.levelCount}}catch(g){A.e(g)}finally{A.f()}var R=k[k.length-1];return console.log("getMapSkin",R.skins),R.skins}},{key:"getLevelThemeInstance",value:function(g){var E,_=null!=g?g:1,k=this.mapData.mapOrder,C=0,A=at(k);try{for(A.s();!(E=A.n()).done;){var T=E.value;if(C+T.levelCount>=_)return console.log("getMapTheme",T.theme),T.theme;C+=T.levelCount}}catch(g){A.e(g)}finally{A.f()}var R=k[k.length-1];return console.log("getMapTheme",R.theme),R.theme}},{key:"getThemeSkinsInstance",value:function(g){var E,_=at(this.mapData.mapOrder);try{for(_.s();!(E=_.n()).done;){var k=E.value;if(k.theme===g)return console.log("getThemeSkins",k.skins),k.skins}}catch(g){_.e(g)}finally{_.f()}return console.warn("getThemeSkins: theme not found",g),[]}},{key:"getCollectionUnlockProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[li];var g,E=[],_=at(this.playerSkinProgress);try{for(_.s();!(g=_.n()).done;){var k=g.value;E.push({skins:k.skins,theme:k.themeId,progress:k.currentProgress,max:k.maxProgress,isLocked:k.isLocked})}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"updatePlayerSkinProgress",value:function(){console.log("getPlayerSkinProgress: playerData not found, use data from level");var g=this.mapData.mapOrder;this.playerSkinProgress=[];var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.playerSkinProgress.push({skins:k.skins,themeId:k.theme,currentProgress:0,maxProgress:k.levelCount,isLocked:!0})}}catch(g){_.e(g)}finally{_.f()}this.updatePlayerSkinProgressByLevel()}},{key:"updatePlayerSkinProgressByLevel",value:function(){var g,E=le.getGameData(),_=(null!==(g=null==E?void 0:E.level)&&void 0!==g?g:1)-1,k=this.mapData.mapOrder;this.playerSkinProgress[0].isLocked=!1;for(var C=0;C<k.length;C++){var A=k[C];if(!(_<=0)){var T=_-A.levelCount>=0?A.levelCount:_;_-=T,this.increaseProgress(C,T)}}}},{key:"increaseProgress",value:function(g,E){if(null!==this.playerSkinProgress){if(g>=this.playerSkinProgress.length)console.warn("increaseProgress: index out of range",g);else{var _,k=this.playerSkinProgress[g],C=k.currentProgress,A=k.maxProgress,T=C+E>A?A:C+E;if(T>0&&(this.playerSkinProgress[g].isLocked=!1),T===A)(null===(_=this.mapData.mapOrder[g+1])||void 0===_?void 0:_.skins)&&this.unlockSkin(g+1);this.playerSkinProgress[g].currentProgress=T,this.playerSkinProgress[g].maxProgress=A}}else console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?")}},{key:"unlockSkin",value:function(g){null!==this.playerSkinProgress?g>=this.playerSkinProgress.length?console.warn("unlockSkin: index out of range",g):this.playerSkinProgress[g].isLocked=!1:console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var g=this.getInstance();g.updatePlayerSkinProgress(),g.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkins",value:function(g){return this.getInstance().getLevelSkinsInstance(g)}},{key:"getLevelTheme",value:function(g){return this.getInstance().getLevelThemeInstance(g)}},{key:"getThemeSkins",value:function(g){return this.getInstance().getThemeSkinsInstance(g)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"getCurrentUnlockingThemeIndex",value:function(){var g=this.getCollectionUnlockProgress();if(0===g.length)return null;var E=0;return g.forEach(function(g,_){g.isLocked||(E=_)}),E}}]),e}();_._RF.pop(),_._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var lr=globalThis.game,lo=lr.match,ls=lr.player,ll=lr.leaderboard,lu=lr.frameCapture,lc=GameCore,lh=lc.Utils,lp=lh.Object,lf=lh.Valid,ly=lh.String,lv=lh.Array,lg=lc.Match.Modes,lm=lc.Dtos.Match.Data,lb=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],lw=function(){function e(){Fe(this,e)}var g,E,_,k,C,A,T,R,I,P,L,O,B,N,M,D,F,U,x;return Ue(e,[{key:"processStartSingleModeAsync",value:(x=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=ls.getPlayerId();return[4,lo.single.start.processAsync({playerId:g})];case 1:E.sent();return[2]}})}),function(){return x.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(U=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,lo.single.finish.processAsync()];case 1:g.sent();return[2]}})}),function(){return U.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(F=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=ls.getPlayerId(),E=GameSDK.context.getID();return[4,lo.tournament.continue.processAsync({playerId:g,contextId:E})];case 1:_.sent();return[2]}})}),function(){return F.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(D=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=ls.getPlayerId(),E=ls.getBestScore();return[4,lo.tournament.finish.processAsync({playerId:g,bestScore:E})];case 1:_.sent();return[2]}})}),function(){return D.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(M=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,7]);return[4,this.processContinueChallengeAsync()];case 1:k.sent();return[3,7];case 2:g=k.sent();if(!lp.hasOwn(g,"name")||lf.isString(g.name))throw g;E="PlayerHasFinishedMatch"===g.name;if(!E)return[3,4];return[4,this.processChallengeNewOpponentAsync()];case 3:E=k.sent();k.label=4;case 4:_="PlayerNotJoinInMatch"===g.name;if(!_)return[3,6];return[4,this.processJoinChallengeAsync()];case 5:_=k.sent();k.label=6;case 6:return[3,7];case 7:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(N=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:lu.addWideframeRender("renderResultChallenge",lu.wideframe.renderResultChallenge);return[4,lo.challenge.finish.processAsync(g)];case 1:E.sent();return[2]}})}),function(g){return N.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(B=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=this.getMatchState(),E=g.id,_=g.customData,k=_.playerId,C=_.opponentId;if(!lf.isString(E))throw new Error("Invalid match id");if(!lf.isString(k))throw new Error("Invalid player id");if(!lf.isString(C))throw new Error("Invalid opponent id");A=GameSDK.context.getID();if(!A)throw new Error("Cannot get contextId");return[4,lo.challenge.continue.processAsync({matchId:E,contextId:A,playerId:k,opponentId:C})];case 1:T.sent();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(O=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:g=ls.getConnectedPlayerIds(100,0),E=Math.floor(Math.random()*g.length),_=ls.getPlayerId(),k=g[E];return[4,lo.challenge.friend.processAsync({playerId:_,opponentId:k})];case 1:C.sent();return[2]}})}),function(){return O.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(L=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=this.getMatchState(),E=g.id,_=g.customData,k=_.playerId,C=_.opponentId;if(!lf.isString(E))throw new Error("Invalid match id");if(!lf.isString(k))throw new Error("Invalid player id");if(!lf.isString(C))throw new Error("Invalid opponent id");return[4,lo.challenge.join.processAsync({matchId:E,playerId:k,opponentId:C})];case 1:A.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"getMatchState",value:function(){var g=lo.getMatchState();if(!g)throw new Error("Match state not found");return g}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(P=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,10,,11]);E=null!=g?g:this.getMatchMode();switch(E){case lg.SINGLE:return[3,1];case lg.TOURNAMENT:return[3,3];case lg.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processStartSingleModeAsync()];case 2:k.sent();return[3,9];case 3:return[4,this.inst.processStartTournamentModeAsync()];case 4:k.sent();return[3,9];case 5:return[4,this.inst.processStartChallengeModeAsync()];case 6:k.sent();return[3,9];case 7:return[4,this.inst.processStartSingleModeAsync()];case 8:k.sent();k.label=9;case 9:return[3,11];case 10:_=k.sent();console.warn("startMatchAsync",_);return[3,11];case 11:return[2]}})}),function(g){return P.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(I=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lo.handler.setProfileData(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setProfileMatchDataAsync",E);return[3,3];case 3:return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(R=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lo.handler.setMatchCustomData(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setMatchCustomDataAsync",E);return[3,3];case 3:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lo.handler.setLeaderboardScore(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setLeaderboardScoreAsync",E);return[3,3];case 3:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"finishMatchAsync",value:(A=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,10,,11]);E=this.getMatchMode();switch(E){case lg.SINGLE:return[3,1];case lg.TOURNAMENT:return[3,3];case lg.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processFinishSingleModeAsync()];case 2:k.sent();return[3,9];case 3:return[4,this.inst.processFinishTournamentModeAsync()];case 4:k.sent();return[3,9];case 5:return[4,this.inst.processFinishChallengeModeAsync(g)];case 6:k.sent();return[3,9];case 7:return[4,this.inst.processFinishSingleModeAsync()];case 8:k.sent();k.label=9;case 9:return[3,11];case 10:_=k.sent();console.warn("finishMatchAsync",_);return[3,11];case 11:return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"joinTournamentAsync",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=ls.getPlayerId();return[4,lo.tournament.join.processAsync({tournamentId:g,playerId:E})];case 1:_.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"continueTournamentAsync",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=ls.getPlayerId();return[4,lo.tournament.continue.processAsync({playerId:E,contextId:g})];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"createTournamentName",value:function(){var g=lb[X.randomRangeInt(0,lb.length-1)],E="".concat(g," Tournament"),_=ly.removeDiacritics(E);return"".concat(_)}},{key:"getShortName",value:function(g,E){var _,k=arguments.length>1&&void 0!==E?E:50,C=g.split(" "),A=0,T="",R=at(C);try{for(R.s();!(_=R.n()).done;){var I=_.value;if(A+I.length+1>k)break;T+="".concat(I," "),A+=I.length+1}}catch(g){R.e(g)}finally{R.f()}return T.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var g,E,_,k=ly.generateObjectId(),C=ls.getPlayerId(),A=ls.getPlayer().name,T=ls.getGameData(),R=null!==(g=null==T?void 0:T.level)&&void 0!==g?g:1,I=la.getLevelTheme(R),P=this.inst.getMatchState().profiles;return{score:null!==(E=null===(_=(void 0===P?{}:P)[C])||void 0===_?void 0:_.score)&&void 0!==E?E:0,playerId:C,mode:lg.TOURNAMENT,name:this.createTournamentName(),leaderboardId:k,payload:{playerId:C,playerName:A,leaderboardId:k,themeId:I}}}},{key:"getTournamentsAsync",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,GameSDK.tournament.getTournamentsAsync()];case 1:return[2,E.sent()];case 2:g=E.sent();return[2,(console.error(g),[])];case 3:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(E=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:return[4,this.getTournamentsAsync()];case 1:g=C.sent(),E=lv.search(g,function(g){var E,_=JSON.parse(null!==(E=g.getPayload())&&void 0!==E?E:"{}");return"DEFAULT"===g.getTournamentType()&&_.playerId===ls.getPlayerId()});if(E)throw new s3(ls.getPlayerId(),E.getID());_=this.createTournamentPayload();ls.setGameData({lastCreateTournamentShown:Date.now()});return[4,lo.tournament.create.processAsync(_)];case 2:C.sent();k=_.leaderboardId;ll.addLeaderboard({name:k,type:"tournament",autoSortRank:!0,leaderboardId:k});return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getMatchMode",value:function(){var g=this.inst.getMatchState();return lf.isString(g.mode)?g.mode:null}},{key:"getMatchCustomData",value:function(){var g=this.inst.getMatchState();return lf.isObject(g.customData)?g.customData:null}},{key:"getMatchExtraDataAsync",value:(g=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,lo.api.getMatchAPI().getMatchDetailByIdAsync(g)];case 1:E=_.sent();return[2,new lm(E).toObject().extraData]}})}),function(E){return g.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(g,E){this.setMatchCustomDataAsync({level:g,score:E});var _=ls.getPlayerId();this.setProfileMatchDataAsync({id:_,score:E})}}]),e}();_._RF.pop(),_._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);var lS,lE,l_,lk,lC,lA,lT,lR,lI,lP,lL,lO,lB=globalThis.game.event,lN=GameCore.Events,lM=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"switchScene",value:function(g,E){lB.emit(lN.SWITCH_SCENE,{sceneName:g,sceneData:E})}},{key:"preloadScene",value:function(g){lB.emit(lN.PRELOAD_SCENE,{sceneName:g})}},{key:"preloadDashboardScene",value:function(){this.preloadScene(sX)}},{key:"switchToDashboardScene",value:function(g){this.switchScene(sX,g)}},{key:"preloadGameScene",value:function(){this.preloadScene(sj)}},{key:"switchToGameScene",value:function(g){this.switchScene(sj,g)}},{key:"getSceneData",value:function(g){return"data"in g.scene&&g.scene.data||{}}}]),e}();_._RF.pop(),_._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);var lD,lF,lU,lx,lz,lG=k.ccclass,lV=k.property,lK=["Watch an ad to revive yourself\nKeep playing and don't give up!","Watching an ad doubles your rewards!","Test your skills\nin ranked tournaments","Challenge your friend\nSee who can score higher!","Send a challenge to your friend\nClaim bragging rights!","Clear all tiles to\nwin the level!","Beat the clock before\ntime runs out!","Clear bombs before\nthey explode","A season pack unlock\nnew tile sets!","The more stars you collect\nThe more coins you'll be rewarded!","Compete globally or with friends\nRise to the top in tournaments!","You can challenge a friend\nTest each other's reflexes!","The Thunder power-up\nblasts tiles away","A Hint power-up reveals\nthe next pair","Pliers can remove\nany bomb instantly","The Tornado power-up\nshuffles the board!","Earn coins by completing levels\nWin tournaments for even more!","A new tile set is unlocked\nevery season packs","Log in daily to claim\nbetter rewards!","Level up and earn coins\nwith each victory!","Each season pack offers\nnew tiles!"],lH=(lS=lG("LoadingFullScreen"),lE=nC.required(),l_=lV(ew),lk=nC.required(),lC=nC.getComponent(eu),lA=nC.required(),lT=lV(P),lS((lP=st((lI=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"progressBar",lP,Ke(g)),rt(g,"uiOpacity",lL,Ke(g)),rt(g,"loadingLabel",lO,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){nC.decorateComponent(this)}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0,this.progressBar.progress=0}},{key:"show",value:(_=Be(function(g){var E,_;return _ts_generator(this,function(g){switch(g.label){case 0:this.uiOpacity.opacity=0,this.progressBar.progress=0;E=z(this.uiOpacity).to(.5,{opacity:255},{easing:"cubicOut"}),_=z(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"});this.runLoadingTextAnimation(),tZ.runTweenAsync(E);return[4,tZ.runTweenAsync(_)];case 1:g.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(g){switch(g.label){case 0:if(!(this.uiOpacity&&this.progressBar))return[3,3];this.uiOpacity.opacity=255,this.progressBar.progress=.9;E=z(this.uiOpacity).to(.5,{opacity:0},{easing:"cubicIn"}),_=z(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"});this.runLoadingTextAnimation();return[4,tZ.runTweenAsync(_)];case 1:g.sent(),this.stopLoadingTextAnimation();return[4,tZ.runTweenAsync(E)];case 2:g.sent(),this.node.active=!1;g.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"runLoadingTextAnimation",value:function(){var g=this;this.updateHintText(),this.schedule(function(){return g.updateHintText()},5)}},{key:"updateHintText",value:function(){this.loadingLabel.string=this.getHintText()}},{key:"stopLoadingTextAnimation",value:function(){this.unscheduleAllCallbacks()}},{key:"getHintText",value:function(){return lK[Math.floor(Math.random()*lK.length)]}}]),a}(M)).prototype,"progressBar",[lE,l_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lL=st(lI.prototype,"uiOpacity",[lk,lC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lO=st(lI.prototype,"loadingLabel",[lA,lT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lR=lI))||lR);_._RF.pop(),_._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);var lq=k.ccclass,lW=k.property,lj=(lD=lq("Loading"),lF=lW(ee),lD((lz=st((lx=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"loadingPrefab",lz,Ke(g)),g.loadingNode=null,g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"createLoadingFullScreen",value:function(){var g,E=$("Canvas");if(E&&!E.getChildByName("Loading")){this.loadingNode||(this.loadingNode=I(this.loadingPrefab));var _=I._clone(this.loadingNode);this.loadingFullScreen=_.getComponent(lH),this.node.active=!1,null===(g=$("Canvas"))||void 0===g||g.addChild(_)}}},{key:"show",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:this.createLoadingFullScreen();E=this.node.active;if(E)return[3,2];this.node.active=!0;return[4,this.loadingFullScreen.show(g)];case 1:E=_.sent();_.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=null!==(E=this.node)&&void 0!==E&&E.active&&this.loadingFullScreen;if(!_)return[3,2];return[4,this.loadingFullScreen.hide(g)];case 1:_=(k.sent(),this.node.active=!1);k.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),a}(M)).prototype,"loadingPrefab",[lF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lU=lx))||lU);_._RF.pop(),_._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);var lX=globalThis.game.event,lY=GameCore,lJ=lY.Events,lQ=lY.Utils.Array,lZ=function(){function e(){Fe(this,e),this.showedScreens=[]}var g,E;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"openScreen",value:function(g,E){var _=iw[g];lX.emit(lJ.OPEN_SCREEN,{screenName:_,screenData:E})}},{key:"closeScreen",value:function(g){var E=iw[g];lX.emit(lJ.CLOSE_SCREEN,{screenName:E})}},{key:"openScreenAndWaitForClose",value:function(g,E){var _=this;return new Promise(function(k){_.openScreen(g,E);lX.on(lJ.CLOSE_SCREEN,function t(E){E.screenName===iw[g]&&(lX.off(lJ.CLOSE_SCREEN,t),k(E))})})}},{key:"showLoadingScreen",value:function(g){this.openScreen(ib.LOADING_SCREEN,{duration:g})}},{key:"closeLoadingScreen",value:function(){this.closeScreen(ib.LOADING_SCREEN)}},{key:"showNotificationScreen",value:function(g,E){this.openScreen(ib.NOTIFICATION_SCREEN,{message:g,duration:E})}},{key:"closeNotificationScreen",value:function(){this.closeScreen(ib.NOTIFICATION_SCREEN)}},{key:"addShowedScene",value:function(g){lQ.has(this.inst.showedScreens,g)||this.inst.showedScreens.push(g)}},{key:"showLoadingFullScreen",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!!lQ.has(this.inst.showedScreens,g))return[3,3];this.addShowedScene(g);_=$("Loading");k=_;if(!k)return[3,2];_.active=!0;return[4,null===(E=_.getComponent(lj))||void 0===E?void 0:E.show(g)];case 1:k=C.sent();C.label=2;case 2:C.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"hideLoadingFullScreen",value:(g=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=lQ.has(this.inst.showedScreens,g);if(_)return[3,2];return[4,null===(E=$("Loading"))||void 0===E||null===(E=E.getComponent(lj))||void 0===E?void 0:E.hide(g)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"showLoadingNotificationScreen",value:function(){this.openScreen(ib.NOTIFICATION_SCREEN,{message:"Loading",enableCloseOnTouch:!1})}},{key:"showTournamentDetailScreen",value:function(g,E,_){var k=!(arguments.length>2&&void 0!==_)||_;this.openScreen(ib.TOURNAMENT_DETAIL_SCREEN,{playAnimation:k,tournament:g,tournamentContextType:E})}},{key:"closeTournamentDetailScreen",value:function(){this.closeScreen(ib.TOURNAMENT_DETAIL_SCREEN)}}]),e}();_._RF.pop(),_._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);var l$=GameCore,l0=l$.Utils,l1=l0.String,l2=l0.Valid,l4=l0.Array,l3=l$.Configs.Mockup.Leaderboards,l5=globalThis.game,l6=l5.leaderboard,l8=l5.player,l9=function(){function e(){var g=this;Fe(this,e),this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,3,,4]);E=Date.now()-g.lastFetchGlobalTournament>g.maxTimeRefetch;if(!E)return[3,2];return[4,l6.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"})];case 1:E=(g.globalTournamentLBData=k.sent(),g.globalTournamentLBData.sort(function(g,E){return g.expireTime-E.expireTime}));k.label=2;case 2:return[3,4];case 3:_=k.sent();console.warn("fetchGlobalTournamentLeaderboardAsync",_);return[3,4];case 4:return[2,g.globalTournamentLBData]}})}),this.fetchTournamentsAsync=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,3,,4]);E=Date.now()-g.lastFetchTournamentsData>g.maxTimeRefetch;if(!E)return[3,2];return[4,GameSDK.tournament.getTournamentsAsync()];case 1:E=(g.playerTournaments=k.sent(),g.playerTournaments.sort(function(g,E){return g.getEndTime()-E.getEndTime()}));k.label=2;case 2:return[3,4];case 3:_=k.sent();console.warn("fetchTournamentsAsync",_);return[3,4];case 4:return[2,g.playerTournaments]}})})}var g;return Ue(e,[{key:"processPlayerTournamentData",value:function(){var g,E=[],_=at(this.playerTournaments);try{for(_.s();!(g=_.n()).done;){var k,C,A=g.value,T="".concat(A.getID()),R=A.getContextID(),I=A.getEndTime(),P=this.parseTournamentPayload(A.getPayload());if(this.validateGameSDKTournamentPayload(P)){if(!(I<Date.now()/1e3)&&"PAGE_HOSTED"!==A.getTournamentType()){var L=null!==(k=P.playerName)&&void 0!==k?k:"Player",O={id:T,title:null!==(C=A.getTitle())&&void 0!==C?C:this.createDefaultTournamentName(L),endTime:I,contextId:R,payload:P};E.push(O)}}}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"processGlobalTournamentLeaderboardData",value:function(){var g=[];if(l3.Enabled){for(var E=0;E<this.playerTournaments.length;E++){var _,k=this.playerTournaments[E],C=k.getTournamentType();if("PAGE_HOSTED"===C){var A="".concat(k.getID()),T=k.getContextID(),R=k.getEndTime(),I=this.parseTournamentPayload(k.getPayload()),P={id:A,title:null!==(_=k.getTitle())&&void 0!==_?_:"Global Tournament",endTime:R,contextId:T,payload:I,tournamentType:C};g.push(P)}}return g}for(var L=0;L<this.globalTournamentLBData.length;L++){var O,B={tournamentId:"",contextId:""},N=this.globalTournamentLBData[L];try{B=JSON.parse(N.description)}catch(g){continue}if(this.validateExpireTime(N)&&this.validateGlobalTournamentPayload(B)){var M={id:B.tournamentId,title:N.name,endTime:this.getTournamentEndTime(N),contextId:B.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:N._id,themeId:null!==(O=B.themeId)&&void 0!==O?O:s9.SUMMER}};g.push(M)}}return g}},{key:"validateGlobalTournamentPayload",value:function(g){var E=g.tournamentId,_=g.contextId;return!(!l2.isString(E)||""===E)&&!(!l2.isString(_)||""===_)}},{key:"getTournamentEndTime",value:function(g){var E=new Date(g.createdAt).getTime();return Math.round((1e3*g.expireTime+E)/1e3)}},{key:"validateExpireTime",value:function(g){return 1e3*this.getTournamentEndTime(g)-Date.now()>0}},{key:"validateGameSDKTournamentPayload",value:function(g){return!(!l2.isString(g.playerId)||""===g.playerId)&&!(!l2.isString(g.playerName)||""===g.playerName)&&!(!l2.isString(g.leaderboardId)||""===g.leaderboardId)}},{key:"createDefaultTournamentName",value:function(g){var E=g.substring(0,7),_="".concat(E.split(" ")[0]||E,"'s Tournament"),k=l1.removeDiacritics(_);return"".concat(k)}},{key:"parseTournamentPayload",value:function(g){if("string"!=typeof g)return{};try{return JSON.parse(g)}catch(g){return{}}}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"requestTournamentDataAsync",value:(g=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=e.getInstance();return[4,Promise.all([g.fetchTournamentsAsync(),g.fetchGlobalTournamentLeaderboardAsync()])];case 1:T.sent();E=g.processPlayerTournamentData(),_=g.processGlobalTournamentLeaderboardData();E.sort(function(g,E){return g.endTime-E.endTime}),_.sort(function(g,E){return g.endTime-E.endTime}),g.tournamentData=[].concat(tt(_),tt(E));C=at(g.tournamentData);try{for(C.s();!(k=C.n()).done;){A=k.value.payload.leaderboardId;A&&(l6.isExistLeaderboardId(A)||l6.addLeaderboard({type:"tournament",name:A,autoSortRank:!0,leaderboardId:A}))}}catch(g){C.e(g)}finally{C.f()}return[2,g.tournamentData]}})}),function(){return g.apply(this,arguments)})},{key:"getAllTournamentData",value:function(){return e.getInstance().tournamentData}},{key:"getTournamentDataById",value:function(g){var E=e.getInstance();return l4.search(E.tournamentData,function(E){return E.id===g})}},{key:"getPlayerTournamentData",value:function(){var g=e.getInstance(),E=l8.getPlayerId();return g.tournamentData.filter(function(g){return g.payload.playerId===E})}},{key:"getFriendsTournamentData",value:function(){var g=e.getInstance(),E=l8.getPlayerId();return g.tournamentData.filter(function(g){var _=g.payload;return _.playerId!==E&&"global"!==_.playerId})}},{key:"getGlobalTournamentData",value:function(){return e.getInstance().tournamentData.filter(function(g){return"global"===g.payload.playerId})}},{key:"validateTournamentExpired",value:function(g){var E=e.getTournamentDataById(g);return!!E&&E.endTime<Date.now()/1e3}}]),e}();_._RF.pop(),_._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var l7,ue="time",ut="bomb";_._RF.pop(),_._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var un=(0,k.ccclass)("InputController")(l7=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleElementPointerDown=function(){},g.handleElementPointerUp=function(g){},g}return Ue(n,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){ev.os!==ev.OS.WINDOWS&&ev.os!==ev.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){ev.os!==ev.OS.WINDOWS&&ev.os!==ev.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(M))||l7;_._RF.pop(),_._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var ui={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};_._RF.pop(),_._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var ua="fall-down",ur="fly-up",uo="push-left",us="push-right",ul="put-column-middle",uu="put-row-middle";function Wc(g){for(var E=g.array,_=g.isLighter,k=g.out,C=void 0===k?new Set:k,A=0;A<E.length;A++)if(_(E.get(A))){for(var T=A+1;T<E.length;T++)if(!_(E.get(T))){E.swap(A,T),C.add(E.get(A));break}}return C}_._RF.pop(),_._RF.push({},"bfb989Gr/dArq4M9uSSrF5/","stagger",void 0),_._RF.pop(),_._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var uc=function(){function e(g){var E;Fe(this,e),this.array=[];var _=null!=g?g:{},k=_.width,C=void 0===k?1:k,A=_.height,T=void 0===A?1:A,R=_instanceof(g,e)?g.array:null!==(E=null==g?void 0:g.content)&&void 0!==E?E:[];if(R.length!==C*T)throw new Error("Invalid content length");this.width=C,this.height=T,this.array=tt(R)}return Ue(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(g,E){return this.array[E*this.width+g]}},{key:"set",value:function(g,E,_){this.array[E*this.width+g]=_}},{key:"isInBounds",value:function(g,E){return g>=0&&g<this.width&&E>=0&&E<this.height}},{key:"forEach",value:function(g){for(var E=0;E<this.height;E++)for(var _=0;_<this.width;_++)g(this.get(_,E),_,E)}},{key:"map",value:function(g){for(var E=[],_=0;_<this.height;_++)for(var k=0;k<this.width;k++)E.push(g(this.get(k,_),k,_));return E}},{key:"reduce",value:function(g,E){for(var _=E,k=0;k<this.height;k++)for(var C=0;C<this.width;C++)_=g(_,this.get(C,k),C,k);return _}},{key:"swap",value:function(g,E){var _=et(g,2),k=_[0],C=_[1],A=et(E,2),T=A[0],R=A[1],I=this.get(k,C);this.set(k,C,this.get(T,R)),this.set(T,R,I)}},{key:"shuffle",value:function(g){for(var E=null!=g?g:this.map(function(g,E,_){return[E,_]}),_=tt(E),k=new Set,C=_.length-1;C>0;C--){var A=eC(0,C+1),T=[_[A],_[C]];_[C]=T[0],_[A]=T[1],k.add(this.get(_[C][0],_[C][1])),k.add(this.get(_[A][0],_[A][1]))}for(var R=0;R<_.length;R++){var I=et(E[R],2),P=I[0],L=I[1],O=et(_[R],2),B=O[0],N=O[1];this.swap([P,L],[B,N])}return k}},{key:"toShuffled",value:function(g){var E=new e({width:this.width,height:this.height,content:this.array}),_=E.shuffle(g);return[E,_]}},{key:"gravitate",value:function(g){var E=this,_=et(g.rowRange,2),k=_[0],C=_[1],A=et(g.colRange,2),T=A[0],R=A[1],I=g.direction,P=g.isLighter,L=g.onSwap,O=g.out,B=void 0===O?new Set:O,N=R-T+1,M=C-k+1;switch(I){case ui.Up:for(var f=function(g){Wc({array:{length:M,get:function(_){return E.get(g,C-_)},swap:function(_,k){var A=E.get(g,C-_),T=E.get(g,C-k);E.swap([g,C-_],[g,C-k]),null==L||L(A,T)}},isLighter:P,out:B})},D=T;D<=R;D++)f(D);return B;case ui.Down:for(var m=function(g){Wc({array:{length:M,get:function(_){return E.get(g,k+_)},swap:function(_,C){var A=E.get(g,k+_),T=E.get(g,k+C);E.swap([g,k+_],[g,k+C]),null==L||L(A,T)}},isLighter:P,out:B})},F=T;F<=R;F++)m(F);return B;case ui.Left:for(var b=function(g){Wc({array:{length:N,get:function(_){return E.get(T+_,g)},swap:function(_,k){var C=E.get(T+_,g),A=E.get(T+k,g);E.swap([T+_,g],[T+k,g]),null==L||L(C,A)}},isLighter:P,out:B})},U=k;U<=C;U++)b(U);return B;case ui.Right:for(var w=function(g){Wc({array:{length:N,get:function(_){return E.get(R-_,g)},swap:function(_,k){var C=E.get(R-_,g),A=E.get(R-k,g);E.swap([R-_,g],[R-k,g]),null==L||L(C,A)}},isLighter:P,out:B})},x=k;x<=C;x++)w(x);return B;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var g=new e({width:this.width,height:this.height,content:this.array}),E=g.gravitate.apply(g,arguments);return[g,E]}},{key:"toRotated",value:function(){for(var g=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),E=0;E<this.height;E++)for(var _=0;_<this.width;_++)g.set(this.height-1-E,_,this.get(_,E));return g}}]),e}();_._RF.pop(),_._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),_._RF.pop(),_._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);var uh,up,uf,uy,uv,ug,um,ub,uw,uS,uE,u_,uk,uC,uA,uT,uR,uI,uP,uL,uO,uB,uN,uM,uD,uF,uU,ux,uz,uG={bomb:"bomb",star:"star",none:"none"};_._RF.pop(),_._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var uV=k.ccclass,uK=k.property,uH=k.requireComponent,uq=(uh=uV("Tile"),up=uH([R]),uf=uH([eu]),uy=uK(eo),uv=uK(eo),ug=uK(eo),um=uK(eo),ub=uK({type:R,displayName:"Background's UI Transform"}),uw=uK(er),uS=uK({type:eu,displayName:"This UI Opacity"}),uE=uK(eu),u_=uK(eu),uk=uK(eu),uC=uK(au),uA=uK(G),uh(uT=up(uT=uf((uI=st((uR=function(g){ze(h,g);var E,_,k,C,A,T,R,I,P,L=Xe(h);function h(){var g;Fe(this,h);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=L.call.apply(L,[this].concat(_)),"icon",uI,Ke(g)),rt(g,"bombComponent",uP,Ke(g)),rt(g,"starComponent",uL,Ke(g)),rt(g,"background",uO,Ke(g)),rt(g,"bgUITransform",uB,Ke(g)),rt(g,"defaultBackground",uN,Ke(g)),rt(g,"uiOpacity",uM,Ke(g)),rt(g,"shineOpacity",uD,Ke(g)),rt(g,"glowOpacity",uF,Ke(g)),rt(g,"iconOpacity",uU,Ke(g)),rt(g,"button",ux,Ke(g)),rt(g,"animationComponent",uz,Ke(g)),g.id=null,g.isEmpty=!1,g.coord=new eS,g.signal=new nM,g}return Ue(h,[{key:"onLoad",value:function(){nC.lazyValidateProperties(this),this.special=this.createSpecialHandler(uG.none)}},{key:"update",value:function(g){var E;(null===(E=this.special)||void 0===E?void 0:E.type)===uG.bomb&&this.special.update(g)}},{key:"onDestroy",value:function(){var g,E;(null===(g=this.special)||void 0===g?void 0:g.type)===uG.bomb&&(null===(E=this.special)||void 0===E||E.onDestroy())}},{key:"setIgnoreInput",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.button.interactable=!E}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(g,E){this.coord.set(g,E)}},{key:"isSimilarTo",value:function(g){return this.id===g.id}},{key:"inSamePositionAs",value:function(g,E){return _instanceof(g,h)?this.coord.equals(g.getCoord()):this.coord.x===g&&this.coord.y===E}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(a1.TILE_CLICK,this)}},{key:"setIdentity",value:function(g){this.id=g,this.icon.spriteFrame=g;var E=et(this.getSize(),2),_=E[0],k=E[1],C=g.originalSize,A=C.width,T=C.height,R=Math.max(A/(.7*_),T/(.7*k));R>1&&this.icon.node.setScale(new em(1/R,1/R,1))}},{key:"setSpecialType",value:function(g,E){var _,k=arguments.length>0&&void 0!==g?g:uG.none,C=arguments.length>1?E:void 0;null===(_=this.special)||void 0===_||_.switch(k,C)}},{key:"setFocused",value:(P=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=z(this.shineOpacity).to(.15,{opacity:g?255:0},{easing:"cubicOut"});this.shineOpacity.node.scale=g?em.ZERO:em.ONE;_=z(this.shineOpacity.node).to(.15,{scale:g?em.ONE:em.ZERO},{easing:"cubicOut"});if(g){k=z(this.glowOpacity).to(2,{opacity:150});k.to(2,{opacity:20}),this.glowOpacityTween=z(this.glowOpacity).repeatForever(k).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;return[4,Promise.all([tZ.runTweenAsync(E),tZ.runTweenAsync(_)])];case 1:C.sent();return[2]}})}),function(g){return P.apply(this,arguments)})},{key:"setEmpty",value:function(g){var E,_,k,C=arguments.length>0&&void 0!==g&&g;if(!this.isEmpty){var A;if(this.signal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),C)return this.uiOpacity.opacity=0,void(null===(A=this.special)||void 0===A||A.switch(uG.none));(null===(E=this.special)||void 0===E?void 0:E.type)!==uG.star&&(null===(_=this.special)||void 0===_?void 0:_.type)!==uG.bomb||this.special.clear(),null===(k=this.special)||void 0===k||k.switch(uG.none),this.uiOpacity.opacity=0}}},{key:"setHint",value:(I=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!g)return[3,2];return[4,this.loadShakeClip()];case 1:k.sent(),this.shakeClip&&tZ.runAnimationAsync(this.animationComponent,this.shakeClip.name,this.signal);return[3,4];case 2:if(null===(E=this.animationComponent)||void 0===E||E.stop(),!this.background)return[2];_=z(this.background.node).to(.1,{scale:em.ONE,eulerAngles:em.ZERO});return[4,tZ.runTweenAsync(_,this.signal)];case 3:k.sent();k.label=4;case 4:return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"playClearFX",value:(R=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:this.signal.abort();E=new nM;this.signal=E;_=null;if("clear"!==g)return[3,2];return[4,this.loadClearClip()];case 1:C.sent(),_=this.clearClip;return[3,4];case 2:return[4,this.loadBreakClip()];case 3:C.sent(),_=this.breakClip;C.label=4;case 4:k=null===_||E.aborted;if(k)return[3,6];return[4,tZ.runAnimationAsync(this.animationComponent,_.name,E)];case 5:k=C.sent();C.label=6;case 6:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"restore",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:this.signal.abort();E=new nM;this.signal=E,this.animationComponent.stop(),this.isEmpty=!1,this.setIgnoreInput(!0),g&&this.setIdentity(g),this.uiOpacity.opacity=255,this.iconOpacity.opacity=255,this.node.setScale(em.ZERO),this.background.spriteFrame=this.defaultBackground,this.button.fakeClick();return[4,tZ.runTweenAsync(z(this.node).to(.3,{scale:em.ONE},{easing:"backOut"}),E)];case 1:_.sent(),this.node.setScale(em.ONE),this.setIgnoreInput(!1);return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"sync",value:(A=Be(function(g){var E,_,k,C,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:E=g.duration,_=void 0===E?.3:E,k=g.delay,C=void 0===k?0:k,A=g.easing,T=void 0===A?"cubicOut":A,R=(0,g.getTargetPosition)(this.coord),I=new em(R.x,R.y,this.node.position.z);return[4,tZ.runTweenAsync(z(this.node).delay(C).to(_,{position:I},{easing:T}))];case 1:P.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"fly",value:(C=Be(function(g){var E,_,k,C,A,T,R,I,P,L,O,B,N,M,D,F,U,x;return _ts_generator(this,function(G){E=this,_=300,k=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),C=Math.max(_-.7*k,0),A=k/1e3,T=this.node.position.clone(),R=g.getTilePosition(this.coord),I=new em(R.x,R.y,this.node.position.z),P=this.background.node,L=2,O=1,B=360,N=.0025*C,M=0,D=new em(0,0,0),F=.75-N,U={value:0,prevElapsed:0},x=z(U);return[2,(x.delay(A),x.to(.5,{value:0},{progress:function(g,_,k,C){var A=(L*=-1)*C,R=T.clone();return R.x+=A,E.node.setPosition(R),k}}),x.to(N,{value:1},{progress:function(g,k,A,T){var R=tZ.easeOutExpo(T),I=N*T-U.prevElapsed,L=N*T,M=C*R;E.setHeight(M,_);var D=E.node.position.clone();O+=.1,em.rotateZ(D,D,new em(0,0,0),O*Math.PI*I),E.node.setPosition(new em(D.x,D.y,D.z));var F=(B+=10)*I;return P.angle+=F,U.prevElapsed=L,A}}),x.call(function(){D.set((E.node.position.x+I.x)/2,(E.node.position.y+I.y)/2,0),U.prevElapsed=0,P.angle%=360,P.angle-=360,M=P.angle}),x.to(F,{value:0},{progress:function(g,k,A,T){var R=F*T-U.prevElapsed,I=F*T,L=C*(1-T);E.setHeight(L,_);var O=E.node.position.clone();return em.rotateZ(O,O,D,Math.PI/F*R),E.node.setPosition(new em(O.x,O.y,O.z)),P.angle+=-M/F*R,U.prevElapsed=I,A}}),x.call(function(){E.node.setPosition(I),E.setHeight(0,_),P.angle=0}),tZ.runTweenAsync(x))]})}),function(g){return C.apply(this,arguments)})},{key:"loadBreakClip",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.breakClip)return[3,2];return[4,ie.loadAnimClipAsync(nD.TILE_BREAK_ANIM)];case 1:g=E.sent();g&&this.animationComponent&&(this.breakClip=g,this.animationComponent.addClip(this.breakClip));E.label=2;case 2:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadClearClip",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.clearClip)return[3,2];return[4,ie.loadAnimClipAsync(nD.TILE_CLEAR_ANIM)];case 1:g=E.sent();g&&this.animationComponent&&(this.clearClip=g,this.animationComponent.addClip(this.clearClip));E.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"loadShakeClip",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.shakeClip)return[2,Promise.resolve()];return[4,ie.loadAnimClipAsync(nD.TILE_SHAKE_ANIM)];case 1:g=E.sent();if(!g||!this.animationComponent)return[2,Promise.resolve()];this.shakeClip=g,this.animationComponent.addClip(this.shakeClip);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setHeight",value:function(g,E){if(this.background){var _=this.background.node;_.setPosition(new em(_.position.x,g,0)),_.setScale(new em(1+g/E*.3,1+g/E*.3,1))}}},{key:"createSpecialHandler",value:function(g,E){var _=this;switch(g){case uG.bomb:return this.createBombHandler(null!=E?E:90);case uG.star:return this.createStarHandler();default:return{type:uG.none,switch:function(g,E){_.special=_.createSpecialHandler(g,E)}}}}},{key:"createBombHandler",value:function(g){var E=this,_=!1,k=g,a=function(){_=!0},o=function(){_=!1};this.node.scene.on(a1.TILE_CLICK,a),this.node.scene.on(a1.USE_ITEM,a),this.node.scene.on(a1.RESUME_TIME,a),this.node.scene.on(a1.PAUSE_TIME,o),this.node.scene.on(a1.TIME_OUT,o),this.bombComponent.node.active=!0;var r=function(){_=!1,E.bombComponent.node.active=!1,k=g,E.node.scene.off(a1.TILE_CLICK,a),E.node.scene.off(a1.USE_ITEM,a),E.node.scene.off(a1.GAME_RESUME,a),E.node.scene.off(a1.GAME_PAUSE,o),E.node.scene.off(a1.TIME_OUT,o)};return{type:uG.bomb,update:function(C){_&&(k-=C,E.bombComponent.fillRange=-k/g,k<=0&&(_=!1,E.bombComponent.node.active=!1,E.setEmpty(!0),E.node.scene.emit(a1.BOMB_EXPLODE,E)))},clear:function(){i8.playSound(ih.BOMB_DEFUSE)},cleanup:r,onDestroy:function(){E.node.scene.off(a1.TILE_CLICK,a),E.node.scene.off(a1.USE_ITEM,a),E.node.scene.off(a1.GAME_RESUME,a),E.node.scene.off(a1.GAME_PAUSE,o),E.node.scene.off(a1.TIME_OUT,o)},switch:function(g,_){r(),E.special=E.createSpecialHandler(g,_)},detonateImmediately:function(){k=0}}}},{key:"createStarHandler",value:function(){var g=this;this.starComponent.node.active=!0;var t=function(){g.starComponent.node.active=!1};return{type:uG.star,clear:function(){g.starComponent.node.active=!1,i8.playSound(ih.COLLECT_STARS);var E=g.node.worldPosition,_=E.x,k=E.y;g.node.scene.emit(a1.ADD_STARS,{startAnimationAt:[_,k]})},cleanup:t,switch:function(E){t(),g.special=g.createSpecialHandler(E)}}}}]),h}(M)).prototype,"icon",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uP=st(uR.prototype,"bombComponent",[uv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uL=st(uR.prototype,"starComponent",[ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uO=st(uR.prototype,"background",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uB=st(uR.prototype,"bgUITransform",[ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uN=st(uR.prototype,"defaultBackground",[uw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uM=st(uR.prototype,"uiOpacity",[uS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uD=st(uR.prototype,"shineOpacity",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uF=st(uR.prototype,"glowOpacity",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uU=st(uR.prototype,"iconOpacity",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ux=st(uR.prototype,"button",[uC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uz=st(uR.prototype,"animationComponent",[uA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uT=uR))||uT)||uT)||uT);function _h(g,E,_,k){var C=arguments.length>3&&void 0!==k?k:0,A=_.x,T=_.y,R=et(E,2),I=R[0],P=R[1],L=I*(A-(g.width-1)/2)+C*(A-g.width/2),O=P*(T-(g.height-1)/2)+C*(T-g.height/2);return -1===A&&(L+=E[0]/4),A===g.width&&(L-=E[0]/4),-1===T&&(O+=E[1]/4),T===g.height&&(O-=E[1]/4),{x:L,y:O}}function Rh(g,E){var _=arguments.length>1&&void 0!==E?E:[0,0],k=et(g,2),C=k[0],A=k[1],T=et(_,2),R=T[0],I=T[1],P=1-R,L=1-I,O=C*P,B=A*L;return[O,B]}function Ih(g,E){for(var _=arguments.length>1&&void 0!==E&&E,k=g.split("-"),C=[],A=0;A<k.length;){var T=null,R=k[A];switch(R){case"normal":A+=1;break;case"fall":T=ua,A+=2;break;case"fly":T=ur,A+=2;break;case"push":"left"===k[A+1]?(T=uo,A+=2):(T=us,A+=2);break;case"put":"columns"===k[A+1]?(T=ul,A+=3):(T=uu,A+=3)}T&&(_&&(T=Ph(T)),C.push(T))}return C}function Ph(g){switch(g){case ua:return us;case ur:return uo;case uo:return ua;case us:return ur;case ul:return uu;case uu:return ul}}function Lh(g){return(_instanceof(g,uc)?g.asArray():g).filter(function(g){return!g.isHidden()})}function Oh(g){return(_instanceof(g,uc)?g.asArray():g).filter(function(g){return g.isHidden()})}_._RF.pop(),_._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),_._RF.pop(),_._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),_._RF.pop(),_._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),_._RF.pop(),_._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),_._RF.pop(),_._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),_._RF.pop(),_._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),_._RF.pop(),_._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),_._RF.pop(),_._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),_._RF.pop(),_._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);var uW=GameCore.Utils.Object;function Mh(g,E){var _=E.getCoord(),k=_.x,C=_.y;return uW.vals(ui).reduce(function(E,_){var A=_.x,T=_.y,R=k+A,I=C+T;return g.isInBounds(R,I)&&E.push(g.get(R,I)),E},[])}function Dh(g){return Array.isArray(g)}function Bh(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=Dh(g)?g:g.asArray();return k[eA(_,0,k.length)]}_._RF.pop(),_._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),_._RF.pop(),_._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);var uj=GameCore.Utils.Array;function xh(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=_instanceof(g,uc)?g.asArray():g,C=Bh(k,_),A=uj.search(k,function(g){return g.isSimilarTo(C)&&!g.inSamePositionAs(C)});if(void 0===A)throw new Error("Could not find a matching tile");return[C,A]}_._RF.pop(),_._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var Uh=function(g){return g};function Gh(g,E,_){var k=arguments.length>2&&void 0!==_?_:Uh;return function(){var _,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=g,C=E;_<=0&&(_=Number.POSITIVE_INFINITY);A=0;T.label=1;case 1:if(!(A<_))return[3,4];return[4,k(C)];case 2:T.sent(),C=1e9*eT(C);T.label=3;case 3:A++;return[3,1];case 4:return[2]}})}()}function zh(g){return Array.isArray(g)}function Vh(g,E,_){var k=arguments.length>2&&void 0!==_?_:Date.now(),C=zh(g)?g:g.asArray();if(C.length<E)return new Set(C);for(var A=new Set,T=Gh(-1,k),R=T.next();A.size<E;){if(R.done)throw new Error("RNG exhausted");A.add(Bh(C,R.value)),R=T.next()}return A}_._RF.pop(),_._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),_._RF.pop(),_._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),_._RF.pop(),_._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var uX=[1,4];function qh(g,E,_){var k,C=arguments.length>2&&void 0!==_?_:Date.now(),A=E.specials,T=A.bomb,R=eA.apply(void 0,[C].concat(uX)),I=Vh(g,T,C),P=g.asArray().filter(function(g){return!I.has(g)}),L=Vh(P,R,C),O=at(I);try{for(O.s();!(k=O.n()).done;){var B=k.value,N=2*E.time/3;B.setSpecialType(uG.bomb,N)}}catch(g){O.e(g)}finally{O.f()}var M,D=at(L);try{for(D.s();!(M=D.n()).done;){var F=M.value;F.setSpecialType(uG.star)}}catch(g){D.e(g)}finally{D.f()}}_._RF.pop(),_._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),_._RF.pop(),_._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);var uY=GameCore.Utils.Array;function jh(g){var E=g.levelData,_=E.columns,k=E.rows,C=g.identities,A=g.createTile,T=g.seed,R=(function(g,E,_){var k,C=[],A=at(Gh(E/2,g,function(g){return eA(g,0,_.length)}));try{for(A.s();!(k=A.n()).done;){var T=k.value;C.push(_[T]),C.push(_[T])}}catch(g){A.e(g)}finally{A.f()}return uY.shuffle(C),C})(void 0===T?Date.now():T,_*k,C).map(function(g){var E=A(g);return E.setIdentity(g),E});return new uc({width:_,height:k,content:R})}_._RF.pop(),_._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);var uJ=GameCore.Utils.Array;function Yh(g){var E=g.customFen,_=g.identities,k=g.createTile,C=E.idSize,A=E.cols,T=E.rows,R=E.code;if(_.length<E.idSize)throw new Error("Invalid grid code. There are not enough identities/frames ".concat(_.length," to fill it according to fen code ").concat(C));var I=R.split(":");if(I.length!==T)throw new Error("Invalid grid code");var P=/[a-zA-Z]+\d+|./g,L=/[a-zA-Z]+/,O=/\d+/,B=I.reduceRight(function(g,C){var A,T=[],R=at(C.matchAll(P));try{for(R.s();!(A=R.n()).done;){var I,B,N=A.value[0],M=null===(I=O.exec(N))||void 0===I?void 0:I[0],D=void 0!==M?Number.parseInt(M,10):void 0,F=void 0!==D&&!Number.isNaN(D)&&D<_.length?_[D]:void 0,U=k(void 0!==F?F:_[0]),x=null===(B=L.exec(N))||void 0===B?void 0:B[0],z=void 0!==x?Xh(x,E.encoding):void 0;z&&F?U.setSpecialType(z):U.setEmpty(),T.push(U)}}catch(g){R.e(g)}finally{R.f()}return g.concat(T)},[]);return new uc({width:A,height:T,content:B})}function Xh(g,E){var _=uJ.search(Object.entries(E),function(E){var _=et(E,2);_[0];return _[1]===g});if(void 0===_)throw new Error("Invalid special type ".concat(g));return _[0]}_._RF.pop(),_._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),_._RF.pop(),_._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);var uQ=GameCore.Utils.Array;function Jh(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=g.asArray(),C=Bh(g,_),A=Mh(g,C);if(!A.some(function(g){return g.isSimilarTo(C)})){var T=Bh(A,_),R=uQ.search(k,function(g){return!g.inSamePositionAs(C)&&!g.inSamePositionAs(T)&&g.isSimilarTo(T)});R.setIdentity(C.id),T.setIdentity(C.id)}}_._RF.pop(),_._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),_._RF.pop(),_._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var uZ=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];_._RF.pop(),_._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var u$=GameCore.Utils.Array;function ed(g,E){return g[0]===E[0]&&g[1]===E[1]}function td(g){return new eS(g[0],g[1])}function nd(g,E){return g.x>=-1&&g.x<E.width+1&&g.y>=-1&&g.y<E.height+1}function id(g,E){var _=arguments.length>1&&void 0!==E?E:u1;return _.map(function(E){return[g.tile[0]+E.x,g.tile[1]+E.y]})}var u0,u1=[ui.Up,ui.Down,ui.Left,ui.Right],u2=function(){function e(g,E){var _;if(Fe(this,e),this.f=0,this.g=0,this.h=0,E&&ed(g,E.tile))throw new Error("Tile cannot be its own parent");this.tile=g,this.parent=E;var k=e.calcDirection(this),C=E&&k&&E.cache.direction&&!k.equals(E.cache.direction)?1:0;this.cache={direction:k,turns:C+(null!==(_=null==E?void 0:E.cache.turns)&&void 0!==_?_:0)}}return Ue(e,[{key:"getKey",value:function(){var g;return"x:".concat(this.tile[0],",y:").concat(this.tile[1],",d:").concat(null===(g=this.cache.direction)||void 0===g?void 0:g.toString())}},{key:"equals",value:function(g){return this.getKey()===g.getKey()}}],[{key:"calcDirection",value:function(g){if(g.parent){var E=g.parent.tile,_=g.tile;return new eS(_[0]-E[0],_[1]-E[1])}return null}}]),e}();function sd(g,E,_){var k=cd(g,E),C=cd(g,_);if(0===k.length||0===C.length)return ld(E,_);var A=function(g,E,_){var k=[],C=[],A=new u2(E,null),T=new u2(_,null),R=[T.tile];k.push(A);for(;k.length>0;){var I=k.shift();if(C.push(I),ed(I.tile,T.tile)){for(var P=[],L=I,O=I,B=I.parent;B;)B.cache.turns!==O.cache.turns&&(P.unshift({a:td(B.tile),b:td(L.tile)}),L=B),O=B,B=B.parent;return P.unshift({a:td(O.tile),b:td(L.tile)}),P}var N,M=at(id(I,cd(g,I.tile,R)));try{var f=function(){var g=N.value,E=new u2(g,I);if(E.cache.turns>8)return 0;var _=ed(E.tile,T.tile),A=C.some(function(g){return g.equals(E)});if(k.some(function(g){return g.equals(E)})||A&&!_)return 0;E.g=I.g+1+E.cache.turns,E.h=ud(E,T),E.f=E.g+E.h,k.push(E)};for(M.s();!(N=M.n()).done;)f()}catch(g){M.e(g)}finally{M.f()}k.sort(function(g,E){return g.f-E.f})}return null}(g,E,_);return A||ld(E,_)}function ld(g,E){var _=td(g),k=td(E);return _.x===k.x||_.y===k.y?[{a:_,b:k}]:[{a:_,b:{x:_.x,y:k.y}},{a:{x:_.x,y:k.y},b:k}]}function ud(g,E){var _=g.tile,k=E.tile;return Math.abs(_[0]-k[0])+Math.abs(_[1]-k[1])}function cd(g,E,_){var k,C=arguments.length>2&&void 0!==_?_:[],A=[],T=at(u1);try{var r=function(){var _=k.value,T={x:E[0]+_.x,y:E[1]+_.y};if(g.isInBounds(T.x,T.y))return(g.get(T.x,T.y).isHidden()||u$.search(C,function(g){return ed(g,[T.x,T.y])}))&&A.push(_),1;nd(T,g)&&A.push(_)};for(T.s();!(k=T.n()).done;)r()}catch(g){T.e(g)}finally{T.f()}return A}_._RF.pop(),_._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),_._RF.pop(),_._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var u4=(Ge(u0={},uG.bomb,"b"),Ge(u0,uG.star,"s"),Ge(u0,uG.none,"t"),u0);function dd(g,E){for(var _=arguments.length>1&&void 0!==E?E:u4,k=g.width,C=g.height,A=[],T=new Map,R=C-1;R>=0;R--){for(var I=[],P=0;P<k;P++){var L,O,B=g.get(P,R),N=B.isHidden()?null:B.id;if(null!==N){var M=null!==(L=null===(O=B.special)||void 0===O?void 0:O.type)&&void 0!==L?L:uG.none,D=_[M];if(!T.has(N)){var F=T.size.toString();T.set(N,F)}var U="".concat(D).concat(T.get(N));I.push(U)}else I.push(".")}A.push(I.join(""))}return{code:A.join(":"),idSize:T.size,encoding:_,rows:C,cols:k}}function pd(g){return g.reduce(function(g,E,_,k){return E.inSamePositionAs(_,k)||g.push([E,[_,k]]),g},[])}function yd(g,E){var _,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:_=0,k=g-1,C=0,A=E-1;L.label=1;case 1:if(!(_<=k&&C<=A))return[3,19];T=_;L.label=2;case 2:if(!(T<=k))return[3,5];return[4,{x:T,y:C}];case 3:L.sent();L.label=4;case 4:T++;return[3,2];case 5:R=++C;L.label=6;case 6:if(!(R<=A))return[3,9];return[4,{x:k,y:R}];case 7:L.sent();L.label=8;case 8:R++;return[3,6];case 9:I=--k;L.label=10;case 10:if(!(I>=_))return[3,13];return[4,{x:I,y:A}];case 11:L.sent();L.label=12;case 12:I--;return[3,10];case 13:P=--A;L.label=14;case 14:if(!(P>=C))return[3,17];return[4,{x:_,y:P}];case 15:L.sent();L.label=16;case 16:P--;return[3,14];case 17:_++;L.label=18;case 18:return[3,1];case 19:return[2]}})}_._RF.pop(),_._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),_._RF.pop(),_._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),_._RF.pop(),_._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var u3,u5,u6,u8,u9,u7,ce,ct,cn,ci,ca=GameCore.Utils.Array,cr=function(){function e(g,E){Fe(this,e),this.coord=new eS(g,E)}return Ue(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function _d(g){return new eS(g[0],g[1])}function Rd(g,E,_){if(void 0===E||void 0===_)return function(g,E){var _,k=arguments.length>1&&void 0!==E?E:yd,C=[],A=at(k(g.width,g.height));try{for(A.s();!(_=A.n()).done;){var T=_.value,R=g.get(T.x,T.y);R.isHidden()||C.push([R,[T.x,T.y]])}}catch(g){A.e(g)}finally{A.f()}var I,P=[],u=function(){var E=et(C.shift(),2),_=E[0],k=E[1];if(ca.search(P,function(g){return Ld(g,k)}))return 0;P.push(k);for(var A,r=function(){var E=et(R[T],2),C=E[0],A=E[1];if(!C.isSimilarTo(_)||ca.search(P,function(g){return Ld(g,A)}))return 0;var I=Rd(g,k,A);return null!==I?{v:{v:I}}:void 0},T=0,R=C;T<R.length;T++)if(0!==(A=r())&&A)return A.v};for(;C.length>0;)if(0!==(I=u())&&I)return I.v;return null}(g);var k,C=[E[0]+1,E[1]+1],A=[_[0]+1,_[1]+1],T=function(g){var E=ca.fillWith(g.width+2,function(g){return new cr(g-1,-1)}),_=ca.fillWith(g.width+2,function(E){return new cr(E-1,g.height)}),k=ca.fillWith(g.height,function(g){return new cr(-1,g)}),C=ca.fillWith(g.height,function(E){return new cr(g.width,E)}),o=function(A,T){var R=A-1,I=T-1;return -1===R?k[I]:R===g.width?C[I]:-1===I?E[R]:I===g.height?_[R]:g.get(R,I)};return{get:function(g,E){return o(g,E)},width:g.width+2,height:g.height+2}}(g),R=[C,A];if(C[0]===A[0]&&Nd(T,R,C[1],A[1],C[0])||C[1]===A[1]&&Md(T,R,C[0],A[0],C[1]))return Fd([{a:_d(C),b:_d(A)}],{x:-1,y:-1});var I=C[1]<=A[1]?C:A,P=C[1]<=A[1]?A:C,L=C[0]<=A[0]?C:A,O=C[0]<=A[0]?A:C,B=[],N=[],M=Dd(T,R,1,_d(I),_d(P)),D=Dd(T,R,-1,_d(I),_d(P));-1===M&&-1===D||(k=-1!==M?M:D,B=[{a:_d(C),b:{x:C[0],y:k}},{a:{x:C[0],y:k},b:{x:A[0],y:k}},{a:{x:A[0],y:k},b:_d(A)}]);var F=Bd(T,R,1,_d(L),_d(O)),U=Bd(T,R,-1,_d(L),_d(O));-1===F&&-1===U||(k=-1!==F?F:U,B=[{a:_d(C),b:{x:k,y:C[1]}},{a:{x:k,y:C[1]},b:{x:k,y:A[1]}},{a:{x:k,y:A[1]},b:_d(A)}]);var x=function(g,E,_,k){for(var C=_.y+1;C<k.y;C++)if(Nd(g,E,_.y,C,_.x)&&Md(g,E,_.x,k.x,C)&&Nd(g,E,C,k.y,k.x))return C;return -1}(T,R,_d(I),_d(P));-1!==x&&(k=x,N=[{a:_d(C),b:{x:C[0],y:k}},{a:{x:C[0],y:k},b:{x:A[0],y:k}},{a:{x:A[0],y:k},b:_d(A)}]);var z=function(g,E,_,k){for(var C=_.x+1;C<k.x;C++)if(Md(g,E,_.x,C,_.y)&&Nd(g,E,_.y,k.y,C)&&Md(g,E,C,k.x,k.y))return C;return -1}(T,R,_d(L),_d(O));return -1!==z&&(k=z,N=[{a:_d(C),b:{x:k,y:C[1]}},{a:{x:k,y:C[1]},b:{x:k,y:A[1]}},{a:{x:k,y:A[1]},b:_d(A)}]),B.length>0&&N.length>0?Fd(Id(B)<=Id(N)?B:N,{x:-1,y:-1}):B.length>0?Fd(B,{x:-1,y:-1}):N.length>0?Fd(N,{x:-1,y:-1}):null}function Id(g){var E,_=0,k=at(g);try{for(k.s();!(E=k.n()).done;)_+=Pd(E.value)}catch(g){k.e(g)}finally{k.f()}return _}function Pd(g){return g.a.x===g.b.x?Math.abs(g.a.y-g.b.y):g.a.y===g.b.y?Math.abs(g.a.x-g.b.x):0}function Ld(g,E){return g[0]===E[0]&&g[1]===E[1]}function Od(g,E,_){var k=arguments.length>2&&void 0!==_?_:[],C=g.get.apply(g,tt(E));return C.isHidden()||k.some(function(g){return Ld(g,E)})}function Nd(g,E,_,k,C){for(var A=Math.min(_,k),T=Math.max(_,k),R=A;R<=T;R++)if(!Od(g,[C,R],E))return!1;return!0}function Md(g,E,_,k,C){for(var A=Math.min(_,k),T=Math.max(_,k),R=A;R<=T;R++)if(!Od(g,[R,C],E))return!1;return!0}function Dd(g,E,_,k,C){var A=1===_?C.y:k.y,T=1===_?k.x:C.x;if(Nd(g,E,k.y,C.y,T))for(;A>=0&&A<g.height&&Od(g,[k.x,A],E)&&Od(g,[C.x,A],E);){if(Md(g,E,k.x,C.x,A))return A;A+=_}return -1}function Bd(g,E,_,k,C){var A=1===_?C.x:k.x,T=1===_?k.y:C.y;if(Md(g,E,k.x,C.x,T))for(;A>=0&&A<g.width&&Od(g,[A,k.y],E)&&Od(g,[A,C.y],E);){if(Nd(g,E,k.y,C.y,A))return A;A+=_}return -1}function Fd(g,E){return g.map(function(g){return{a:{x:g.a.x+E.x,y:g.a.y+E.y},b:{x:g.b.x+E.x,y:g.b.y+E.y}}})}_._RF.pop(),_._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var co,cs=k.ccclass,cl=k.property,cu=k.requireComponent,cc=globalThis.game.monitorError,ch=GameCore.Utils,cp=ch.Array,cf=ch.Function,cy=(u3=cs("Board"),u5=cu(R),u6=cl(uq),u8=cl(C),u9=cl({displayName:"Tile Spacing",group:"Create config"}),u3(u7=u5((ct=st((ce=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"tilePrefab",ct,Ke(g)),rt(g,"tilesHolder",cn,Ke(g)),rt(g,"tileTrim",ci,Ke(g)),g.tileSize=[0,0],g.selectedTile=null,g.layoutType="portrait",g.parsedGravityRules=[],g.normalMatches=0,g.normalMatchesSinceLastSpawn=0,g.spawnAttempts=0,g.hintPath=null,g.hintTiles=null,g.animationQueue=[],g.isConsumingAnimation=!1,g.handleViewResized=cf.debounce(function(){g.updateTilesHolderScale()},100),g.onLayoutChanged=function(E){g.layoutType=E},g}return Ue(a,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),nC.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenEvents()}},{key:"onDestroy",value:function(){this.unlistenEvents()}},{key:"create",value:function(g,E,_){var k=this,C=arguments.length>2&&void 0!==_?_:Date.now(),A=tt(g);cp.shuffle(A);var T=A.slice(0,E.colors);null==cc||cc.addMetadata({frames:T.map(function(g){return g.name})}),this.levelData=E,this.parsedGravityRules=Ih(E.mode,this.layoutType===ag.Landscape);var r=function(g){var E=I(k.tilePrefab.node),_=E.getComponent(uq);return _.setIdentity(g),k.tilesHolder.addChild(E),E.active=!0,_},R=!1;if(void 0!==E.customFen)try{R=!0,this.grid=Yh({customFen:E.customFen,identities:T,createTile:r}),this.grid.forEach(function(g,E,_){g.setCoord(E,_),g.setIgnoreInput(!1),g.node.setSiblingIndex(0)})}catch(g){console.error("Error creating grid from custom fen",g,"falling back to random grid"),R=!1}R||(this.grid=jh({levelData:E,seed:C,identities:T,createTile:r}),this.grid.forEach(function(g,E,_){g.setCoord(E,_),g.setIgnoreInput(!1),g.node.setSiblingIndex(0)}),Jh(this.grid,C),qh(this.grid,E,C)),this.handleBoardLayout();var P=[this.tileTrim.x,this.tileTrim.y];this.tileSize=Rh(this.tilePrefab.getSize(),P),this.updateTilesHolderScale(),this.node.scene.emit(a1.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}},{key:"updateTilesHolderScale",value:function(){if(this.grid){var g=[this.grid.width,this.grid.height],E=[this.uiTransform.width,this.uiTransform.height],_=function(g,E,_){var k=et(g,2),C=k[0],A=k[1],T=et(E,2),R=T[0],I=T[1],P=et(_,2),L=P[0]/(C*R),O=P[1]/(A*I);return Math.min(L,O)}(g,this.tilePrefab.getSize(),E);this.tilesHolder.setScale(_,_),this.node.scene.emit(a1.GRID_RESIZE,_)}}},{key:"handleBoardLayout",value:function(){var g,E;this.layoutType===ag.Landscape&&0!==this.levelData.level&&(this.grid=(g=this.grid,(E=g.toRotated()).forEach(function(g,E,_){g.setCoord(E,_)}),E))}},{key:"destroyTiles",value:function(){var g;null===(g=this.grid)||void 0===g||g.forEach(function(g){return g.node.destroy()})}},{key:"animateTilesAppear",value:function(){var g=this;return new Promise(function(E){var _=function(){var _=Be(function(){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Promise.all(g.grid.map(function(E,_,k){var C=eR(0,.5),A=E.node.scale.clone(),T=function(E,_){var k,C=eS.ZERO.clone(),A=at(g.parsedGravityRules);try{for(A.s();!(k=A.n()).done;){var T=k.value,R=g.getPrimitiveDirection(E,_,T);C.subtract2f(R.x,R.y)}}catch(g){A.e(g)}finally{A.f()}return C.normalize()}(_,k),R=_h(g.grid,g.tileSize,{x:_,y:k}),I=T.multiplyScalar(100).add2f(R.x,R.y);return E.node.setPosition(I.x,I.y),E.node.setScale(0,0),Promise.all([tZ.runTweenAsync(z(E.node).delay(C).to(.5,{scale:A},{easing:"elasticOut"})),E.sync({getTargetPosition:function(E){return _h(g.grid,g.tileSize,E)},easing:"backOut",duration:.5,delay:C})])}))];case 1:_.sent(),E();return[2]}})});return function(){return _.apply(this,arguments)}}();g.animationQueue.push(_),g.consumeAnimationQueue()})}},{key:"animateTilesWave",value:function(){var g=this;return new Promise(function(E){var _=function(){var _=Be(function(){var _;return _ts_generator(this,function(k){switch(k.label){case 0:_=function(g,E){for(var _=E.x,k=E.y,C="center"===g?{x:(_-1)/2,y:(k-1)/2}:g,A=C.x,T=C.y,R=[],I=0;I<_;I++){for(var P=[],L=0;L<k;L++){var O=A-I,B=T-L,N=Math.sqrt(O*O+B*B);P.push(N)}R.push(P)}return R}("center",{x:g.grid.width,y:g.grid.height});return[4,Promise.all(g.grid.map(function(g,E,k){var C=.1*_[E][k],A=g.node.scale.clone();return Promise.all([tZ.runTweenAsync(z(g.node).delay(C).to(.25,{scale:A.clone().multiplyScalar(1.2)},{easing:"quadOut"}).to(.25,{scale:A},{easing:"quadIn"}))])}))];case 1:k.sent(),E();return[2]}})});return function(){return _.apply(this,arguments)}}();g.animationQueue.push(_),g.consumeAnimationQueue()})}},{key:"handleTileClick",value:function(g){if(!g.isHidden()){if(this.selectedTile===g)return i8.playSound(ih.TILE_SELECT),this.selectedTile=null,void g.setFocused(!1);if(!this.selectedTile)return i8.playSound(ih.TILE_SELECT),this.selectedTile=g,void g.setFocused(!0);if(!this.selectedTile.isSimilarTo(g))return i8.playSound(ih.TILE_SELECT),this.selectedTile.setFocused(!1),this.selectedTile=g,void g.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,g),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(g,E){var _=[g.getCoord().x,g.getCoord().y],k=[E.getCoord().x,E.getCoord().y],C=Rd(this.grid,_,k);if(null===C){i8.playSound(ih.INVALID_MATCH),this.shakeGrid();var A=0===this.levelData.level,T=function(g,E,_,k){if(k){var C=uZ[4].startTile,A=uZ[4].endTile;if(E[0]===C.x&&E[1]===C.y&&_[0]===A.x&&_[1]===A.y)return[{a:C,b:A}];if(E[0]===A.x&&E[1]===A.y&&_[0]===C.x&&_[1]===C.y)return[{a:C,b:A}]}return sd(g,E,_)}(this.grid,_,k,A);return this.node.scene.emit(a1.GRID_MATCH,[g,E]),void this.node.scene.emit(a1.GRID_MATCH_FAIL,T)}i8.playSound(ih.TILE_MATCH),this.node.scene.emit(a1.GRID_MATCH,[g,E]),this.node.scene.emit(a1.GRID_MATCH_SUCCESS,C,[g,E]),this.clear([[g,E]],"clear")}},{key:"clear",value:function(g,E){var _=arguments.length>1&&void 0!==E?E:"clear";this.normalMatches+=g.length;var k,C=at(g);try{for(C.s();!(k=C.n()).done;){var A=et(k.value,2),T=A[0],R=A[1];T.setEmpty(),R.setEmpty(),T.playClearFX(_),R.playClearFX(_),this.node.scene.emit(a1.GRID_CLEAR,[T,R])}}catch(g){C.e(g)}finally{C.f()}this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var g=this.hintPath[0].a,E=this.hintPath[this.hintPath.length-1].b,_=this.getTileAt(g.x,g.y),k=this.getTileAt(E.x,E.y);_.setHint(!0),k.setHint(!0),this.hintTiles=[_,k]}}},{key:"hideHint",value:function(){if(this.hintTiles){var g=et(this.hintTiles,2),E=g[0],_=g[1];E.setHint(!1),_.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(g,E){return this.grid.isInBounds(g,E)?this.grid.get(g,E):null}},{key:"getAnyTileWorldPosition",value:function(g,E){var _=_h(this.grid,this.tileSize,{x:g,y:E});this.tilePrefab.node.setPosition(_.x,_.y);var k=this.tilePrefab.node.getWorldPosition();return{x:k.x,y:k.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getGridSize",value:function(){return[this.grid.width,this.grid.height]}},{key:"getUncleared",value:function(){return Lh(this.grid)}},{key:"getCleared",value:function(){return Oh(this.grid)}},{key:"getBombTiles",value:function(){var g;return Lh(_instanceof(g=this.grid,uc)?g.asArray():g).filter(function(g){var E;return(null===(E=g.special)||void 0===E?void 0:E.type)===uG.bomb})}},{key:"getPairs",value:function(g,E){for(var _=arguments.length>0&&void 0!==g?g:1,k=!(arguments.length>1&&void 0!==E)||E,C=[],A=k?Lh(this.grid):Oh(this.grid),_$a=function(){var g=et(xh(A),2),E=g[0],_=g[1];C.push([E,_]),A=A.filter(function(g){return g!==E&&g!==_})};C.length<_;)_$a();return C}},{key:"setIgnoreInput",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.grid.forEach(function(g){return g.setIgnoreInput(E)})}},{key:"processShuffleRequest",value:function(g){var E=this.processShuffleStep(this.grid,!0,g);this.grid=E[0],this.hintPath=E[1],this.consumeAnimationQueue()}},{key:"getCurrentFen",value:function(){return dd(this.grid)}},{key:"generateFenFromCurrentLevel",value:function(g){return a.generateFen(null!=g?g:this.levelData)}},{key:"listenEvents",value:function(){Q.on(t6,this.onLayoutChanged),Q.on(no,this.handleViewResized)}},{key:"unlistenEvents",value:function(){Q.off(t6,this.onLayoutChanged),Q.off(no,this.handleViewResized)}},{key:"shakeGrid",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.tilesHolder.position.clone(),E=z(this.tilesHolder).to(.05,{position:g.clone().add3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g.clone().subtract3f(eR(5,10),eR(5,10),0)}),_=z(this.tilesHolder).repeat(2,E).to(.05,{position:g});return[4,tZ.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"processGameplayCycle",value:function(){var g=Lh(this.grid);if(0!==g.length){var E=this.grid,_=g.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,k=this.normalMatchesSinceLastSpawn>=2;_&&(k?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),g.length>14&&(E=this.processGravitationStep(E));var C=this.processShuffleStep(E);this.consumeAnimationQueue(),this.grid=C[0],this.hintPath=C[1]}}},{key:"processSpawnStep",value:function(){var g=et(Vh(Oh(this.grid),2),2),E=g[0],_=g[1];E.restore(),_.restore(E.id),this.node.scene.emit(a1.GRID_SPAWN,[E,_])}},{key:"processGravitationStep",value:function(g){var E,_=this,k=g,C=[],A=at(this.parsedGravityRules);try{var r=function(){var g=E.value,A=pd(k=_.toGravitated(k,g));if(0===A.length)return 1;var T,R=at(A);try{for(R.s();!(T=R.n()).done;){var I=et(T.value,2),P=I[0],L=et(I[1],2),O=L[0],B=L[1];P.setCoord(O,B)}}catch(g){R.e(g)}finally{R.f()}k.forEach(function(g){g.node.setSiblingIndex(0)});var N=function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Promise.all(A.map(function(g){var E=et(g,2),C=E[0],A=et(E[1],2),T=A[0],R=A[1];return C.sync({delay:.25,duration:.25,getTargetPosition:function(){return _h(k,_.tileSize,{x:T,y:R})}})}))];case 1:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}();C.push(N)};for(A.s();!(E=A.n()).done;)r()}catch(g){A.e(g)}finally{A.f()}var T=function(){var g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=0,E=C;k.label=1;case 1:if(!(g<E.length))return[3,4];_=E[g];return[4,_()];case 2:k.sent();k.label=3;case 3:g++;return[3,1];case 4:return[2]}})});return function(){return g.apply(this,arguments)}}();return this.animationQueue.push(T),k}},{key:"toGravitated",value:function(g,E){var _=new uc(g),k=g.height-1,C=g.width-1,A=[0,k],T=[0,C],R=Math.floor(g.height/2),I=Math.floor(g.width/2),u=function(g){return g.isHidden()};switch(E){case ua:_.gravitate({rowRange:A,colRange:T,direction:ui.Down,isLighter:u});break;case ur:_.gravitate({rowRange:A,colRange:T,direction:ui.Up,isLighter:u});break;case uo:_.gravitate({rowRange:A,colRange:T,direction:ui.Left,isLighter:u});break;case us:_.gravitate({rowRange:A,colRange:T,direction:ui.Right,isLighter:u});break;case ul:_.gravitate({rowRange:A,colRange:[I,C],direction:ui.Left,isLighter:u,out:_.gravitate({rowRange:A,colRange:[0,I-1],direction:ui.Right,isLighter:u})});break;case uu:_.gravitate({rowRange:[R,k],colRange:T,direction:ui.Down,isLighter:u,out:_.gravitate({rowRange:[0,R-1],colRange:T,direction:ui.Up,isLighter:u})})}return _}},{key:"getPrimitiveDirection",value:function(g,E,_){var k=Math.floor(this.grid.height/2),C=Math.floor(this.grid.width/2);switch(_){case ua:return ui.Down;case ur:return ui.Up;case uo:return ui.Left;case us:return ui.Right;case ul:return g>=C?ui.Left:ui.Right;case uu:return E>=k?ui.Down:ui.Up}}},{key:"processShuffleStep",value:function(g,E,_){var k,C=arguments.length>1&&void 0!==E&&E,A=arguments.length>2?_:void 0,T=Rd(g),R=Lh(g).map(function(g){var E=g.getCoord();return[E.x,E.y]});if(null!==T&&!C)return[g,T];var I=100;do{var P=g.toShuffled(R),L=et(P,1);T=Rd(k=L[0]),I--}while(null===T&&I>0);if(I<=0){var O=k.asArray().map(function(g){var E,_;return{name:null===(E=g.id)||void 0===E?void 0:E.name,type:null===(_=g.special)||void 0===_?void 0:_.type,active:!g.isHidden()}});return null==cc||cc.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",level:this.levelData.level,gridAsArray:O}),this.node.scene.emit(a1.GAME_EXIT),[g,T]}var B,N=pd(k),M=at(N);try{for(M.s();!(B=M.n()).done;){var D=et(B.value,2),F=D[0],U=et(D[1],2),x=U[0],z=U[1];F.setCoord(x,z)}}catch(g){M.e(g)}finally{M.f()}var G=void 0!==A?function(){return A(g,k)}:this.createShuffleAnimationHandler(g,k);return this.animationQueue.push(G),[k,T]}},{key:"createShuffleAnimationHandler",value:function(g,E){var _=this,k=function(){var k=Be(function(){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,Promise.all(g.map(function(g,k,C){return g.sync({duration:.3,easing:"smooth",getTargetPosition:function(){return _h(E,_.tileSize,{x:k,y:C},10)}})}))];case 1:k.sent();return[2]}})});return function(){return k.apply(this,arguments)}}(),C=function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:E.forEach(function(g){g.node.setSiblingIndex(0)});return[4,Promise.all(E.map(function(g){return g.sync({duration:.4,easing:"smooth",delay:eR(0,.2),getTargetPosition:function(g){return _h(E,_.tileSize,g)}})}))];case 1:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}();return function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,k()];case 1:g.sent();return[4,C()];case 2:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.isConsumingAnimation)return[3,5];this.isConsumingAnimation=!0;E.label=1;case 1:if(!(this.animationQueue.length>0))return[3,4];if(0===this.getUncleared().length){this.animationQueue=[];return[3,4]}g=this.animationQueue.shift();return[4,g()];case 2:E.sent();E.label=3;case 3:return[3,1];case 4:this.isConsumingAnimation=!1;E.label=5;case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"clearAnimationQueue",value:function(){this.isConsumingAnimation=!1,this.animationQueue=[]}}],[{key:"generateFen",value:function(g){for(var E=g,_=[],k=0;k<E.colors;k++)_.push(k+1);var C=Date.now(),A=jh({levelData:E,seed:C,identities:_,createTile:function(g){var E=g,_=void 0,k=new eS(0,0);return{get id(){return E},get special(){return _},get coord(){return k},setIdentity:function(g){E=g},isHidden:function(){return!1},setSpecialType:function(g){_={type:g}},setCoord:function(g,E){return k.set(g,E)},getCoord:function(){return k},isSimilarTo:function(g){return g.id===E},inSamePositionAs:function(g){return g.getCoord().equals(k)}}}});return A.forEach(function(g,E,_){g.setCoord(E,_)}),Jh(A,C),qh(A,E,C),dd(A)}}]),a}(M)).prototype,"tilePrefab",[u6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cn=st(ce.prototype,"tilesHolder",[u8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ci=st(ce.prototype,"tileTrim",[u9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(.025,.1)}}),u7=ce))||u7)||u7);_._RF.pop(),_._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var cv=(0,k.ccclass)("Line")(co=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R)}},{key:"setPoints",value:function(g,E){this.node.setWorldPosition((g.x+E.x)/2,(g.y+E.y)/2,0),this.uiTransform.width=eS.distance(g,E)+10,this.uiTransform.width/=this.node.worldScale.x;var _=180*Math.atan2(E.y-g.y,E.x-g.x)/Math.PI;this.node.eulerAngles=new em(0,0,_)}}]),n}(M))||co;_._RF.pop(),_._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var cg,cm,cb,cw,cS,cE,c_,ck,cC,cA,cT,cR=function(g){ze(n,g);var E=Xe(n);function n(g,_,k,C,A){var T;return Fe(this,n),(T=E.call(this,g,_,A)).ator=k,T.ftor=C,T}return Ue(n,[{key:"alloc",value:function(){var g=Je(Ve(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(g),g}},{key:"free",value:function(g){this.ftor&&this.ftor(g),Je(Ve(n.prototype),"free",this).call(this,g)}}]),n}(eI);_._RF.pop(),_._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var cI,cP,cL,cO,cB,cN,cM,cD,cF,cU=k.ccclass,cx=k.property,cz=(cg=cU("PathDrawer"),cm=cx({group:"Line",displayName:"Prefab",type:ee}),cb=cx({group:"Line",displayName:"Holder",type:C,tooltip:"Line Prefab"}),cw=cx({group:"Point",displayName:"Prefab",type:ee}),cS=cx({group:"Point",displayName:"Holder",type:C}),cg((ck=st((c_=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"linePrefab",ck,Ke(g)),rt(g,"lineHolder",cC,Ke(g)),g.lineNodes=[],rt(g,"pointPrefab",cA,Ke(g)),rt(g,"pointHolder",cT,Ke(g)),g.pointNodes=[],g}return Ue(n,[{key:"start",value:function(){var g=this;this.linePool=new cR(function(){var E=I(g.linePrefab);return g.lineHolder.addChild(E),E.parent=g.lineHolder,E.active=!1,E},0,function(E){g.lineNodes.push(E),E.active=!0},function(g){g.active=!1},function(g){g.isValid&&g.destroy()}),this.pointPool=new cR(function(){var E=I(g.pointPrefab);return g.pointHolder.addChild(E),E.active=!1,E},0,function(E){g.pointNodes.push(E),E.active=!0},function(g){g.active=!1},function(g){g.isValid&&g.destroy()})}},{key:"drawPath",value:function(g){this.clearPath();var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k,C=E.value;null===(k=this.linePool.alloc().getComponent(cv))||void 0===k||k.setPoints(C.a,C.b)}}catch(g){_.e(g)}finally{_.f()}}},{key:"clearPath",value:function(){var g,E=at(this.lineNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value;this.linePool.free(_)}}catch(g){E.e(g)}finally{E.f()}this.lineNodes=[];var k,C=at(this.pointNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value;this.pointPool.free(A)}}catch(g){C.e(g)}finally{C.f()}this.pointNodes=[]}}]),n}(M)).prototype,"linePrefab",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cC=st(c_.prototype,"lineHolder",[cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cA=st(c_.prototype,"pointPrefab",[cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cT=st(c_.prototype,"pointHolder",[cS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cE=c_))||cE);_._RF.pop(),_._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var cG,cV=k.ccclass,cK=k.property,cH=(cI=cV("ErrorDrawer"),cP=cK(er),cL=cK(er),cO=cK(er),cI((cM=st((cN=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"one",cM,Ke(g)),rt(g,"two",cD,Ke(g)),rt(g,"error",cF,Ke(g)),g}return Ue(n,[{key:"start",value:function(){Je(Ve(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(g){var E=this;if(this.clearPath(),g.forEach(function(_,k){var C;if(null===(C=E.linePool.alloc().getComponent(cv))||void 0===C||C.setPoints(_.a,_.b),0!==k){var A=E.pointPool.alloc();A.setWorldPosition(new em(_.a.x,_.a.y,0));var T=A.getComponent(eo);1===k&&g.length>3?T.spriteFrame=E.one:2===k&&g.length>3?T.spriteFrame=E.two:T.spriteFrame=E.error}}),1===g.length){var _=this.pointPool.alloc();_.setWorldPosition(new em(g[0].a.x+g[0].b.x,g[0].a.y+g[0].b.y,0).multiplyScalar(.5)),_.getComponent(eo).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(g){this.pathAppearDuration>0&&(this.pathAppearDuration-=g,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(cz)).prototype,"one",[cP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cD=st(cN.prototype,"two",[cL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cF=st(cN.prototype,"error",[cO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cB=cN))||cB);_._RF.pop(),_._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var cq,cW=(0,k.ccclass)("HintDrawer")(cG=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"drawPath",value:function(g){this.clearPath(),this.createPath(g),this.showPath()}},{key:"createPath",value:function(g){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k,C=E.value;null===(k=this.linePool.alloc().getComponent(cv))||void 0===k||k.setPoints(C.a,C.b),this.pointPool.alloc().setWorldPosition(C.a.x,C.a.y,0)}}catch(g){_.e(g)}finally{_.f()}this.pointPool.alloc().setWorldPosition(g[g.length-1].b.x,g[g.length-1].b.y,0)}},{key:"showPath",value:function(){var g,E=at(this.lineNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value.getComponent(eu);_.opacity=0,z(_).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(g){E.e(g)}finally{E.f()}var k,C=at(this.pointNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value.getComponent(eu);A.opacity=0,z(A).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(g){C.e(g)}finally{C.f()}}},{key:"clearPath",value:function(){var g,E=this,_=at(this.lineNodes);try{var i=function(){var _=g.value,k=_.getComponent(eu);z(k).to(.15,{opacity:0},{onComplete:function(){k.opacity=255,E.linePool.free(_)}}).start()};for(_.s();!(g=_.n()).done;)i()}catch(g){_.e(g)}finally{_.f()}var k,C=at(this.pointNodes);try{var r=function(){var g=k.value,_=g.getComponent(eu);z(_).to(.15,{opacity:0},{onComplete:function(){_.opacity=255,E.pointPool.free(g)}}).start()};for(C.s();!(k=C.n()).done;)r()}catch(g){C.e(g)}finally{C.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(cz))||cG;_._RF.pop(),_._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var cj,cX,cY,cJ,cQ,cZ,c$,c0,c1,c2=(0,k.ccclass)("MatchDrawer")(cq=function(g){ze(a,g);var E,_,k=Xe(a);function a(){return Fe(this,a),k.apply(this,arguments)}return Ue(a,[{key:"drawPath",value:function(g){var E=this;g.forEach(function(g,_){var k,C=E.linePool.alloc();null===(k=C.getComponent(cv))||void 0===k||k.setPoints(g.a,g.b),E.animateLine(C);var A=E.pointPool.alloc();A.setWorldPosition(g.a.x,g.a.y,0),E.animatePoint(A,_)});var _=this.pointPool.alloc();_.setWorldPosition(g[g.length-1].b.x,g[g.length-1].b.y,0),this.animatePoint(_,g.length)}},{key:"animateLine",value:(_=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=g.getComponent(eu);E.opacity=0;_=z(E).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});return[4,tZ.runTweenAsync(_)];case 1:k.sent(),E.opacity=255,this.linePool.free(g);return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"animatePoint",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.scale=em.ZERO;_=z(g).delay(.03*E).to(.2,{scale:em.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:em.ZERO},{easing:"backIn"});return[4,tZ.runTweenAsync(_)];case 1:k.sent(),this.pointPool.free(g);return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),a}(cz))||cq;_._RF.pop(),_._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var c4,c3=k.ccclass,c5=k.property,c6=(cj=c3("PathDraw"),cX=c5({group:{name:"Path Drawer"},type:c2}),cY=c5({group:{name:"Path Drawer"},type:cW}),cJ=c5({group:{name:"Path Drawer"},type:cH}),cj((c$=st((cZ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"matchPath",c$,Ke(g)),rt(g,"hintPath",c0,Ke(g)),rt(g,"errorPath",c1,Ke(g)),g.isDrawingHint=!1,g}return Ue(n,[{key:"onLoad",value:function(){var g=this;this.node.scene.on(a1.GRID_RESIZE,function(E){g.node.setScale(E,E)})}},{key:"drawMatchPath",value:function(g,E){var _,k=g.map(function(g){return Me({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.matchPath.drawPath(k)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(g,E){if(!this.isDrawingHint){this.isDrawingHint=!0;var _,k=g.map(function(g){return Me({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.hintPath.drawPath(k)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(g,E){var _,k=g.map(function(g){return Me({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.errorPath.drawPath(k)}}]),n}(M)).prototype,"matchPath",[cX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c0=st(cZ.prototype,"hintPath",[cY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c1=st(cZ.prototype,"errorPath",[cJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cQ=cZ))||cQ);_._RF.pop(),_._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var c8,c9,c7,he,ht,hn,hi,ha,hr,ho,hs,hl=k.ccclass,hu=[ih.COMBO_1,ih.COMBO_2,ih.COMBO_3,ih.COMBO_4,ih.COMBO_5,ih.COMBO_6,ih.COMBO_7,ih.COMBO_8,ih.COMBO_9,ih.COMBO_10,ih.COMBO_11,ih.COMBO_12,ih.COMBO_13],hc=hl("ComboManager")(c4=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(a1.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(a1.GAME_FINISH,this.resetCombo,this),this.node.scene.on(a1.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(a1.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(a1.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(g){if(this.currentCombo=g,g>0){var E=Math.min(g-1,hu.length-1);i8.playSound(hu[E]),this.vibrate(g)}this.emitEvent&&this.node.scene.emit(a1.COMBO_UPDATED,g)}},{key:"vibrate",value:function(g){var E;null===(E=$("Vibrate"))||void 0===E||null===(E=E.getComponent(sk))||void 0===E||E.vibrate(Math.min(20+20*g,220))}},{key:"setEmitEvent",value:function(g){this.emitEvent=g}}]),n}(M))||c4;_._RF.pop(),_._RF.push({},"78746Q4viBIlbRROK4J1bSl","Burst",void 0);var hh,hp=k.ccclass,hd=k.property,hf=(c8=hp("Burst"),c9=hd(K),c7=hd(V),he=hd(K),ht=hd(V),c8((ha=st((hi=function(){function e(){Fe(this,e),rt(this,"time",ha,this),rt(this,"repeatCount",hr,this),rt(this,"repeatInterval",ho,this),rt(this,"count",hs,this),this.remainingCount=0,this.curTime=0}return Ue(e,[{key:"update",value:function(g,E){if(0===this.remainingCount&&(this.remainingCount=this.repeatCount,this.curTime=this.time),this.remainingCount>0){var _=eP(g.time-g.startDelay.evaluate(0,1),g.duration)-E;_=_>0?_:0;var k=eP(g.time-g.startDelay.evaluate(0,1),g.duration);this.curTime>=_&&this.curTime<k&&(g.emit(this.count,E-(k-this.curTime)),this.curTime+=this.repeatInterval,--this.remainingCount)}}},{key:"reset",value:function(){this.remainingCount=0,this.curTime=0}}]),e}()).prototype,"time",[c9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hr=st(hi.prototype,"repeatCount",[c7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ho=st(hi.prototype,"repeatInterval",[he],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hs=st(hi.prototype,"count",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hn=hi))||hn);_._RF.pop(),_._RF.push({},"726cc2e08FBqpVIg/tPM7H2","Particle",void 0);var hy,hv,hg,hm,hb,hw,hS,hE,h_,hk,hC,hA,hT,hR,hI,hP,hL,hO=k.ccclass,hB=k.executeInEditMode,hN=hO("Particle")(hh=hB(!0)(hh=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).remainingLifetime=0,g.startLifetime=0,g}return Ue(n,[{key:"onLoad",value:function(){this.node.layer=ek.Enum.UI_2D}},{key:"init",value:function(g){this.sprite=this.getComponent(eo),this.particleSystem=g,this.velocity=em.ZERO,this.remainingLifetime=0,this.startLifetime=0,this.startSize=em.ZERO,this.startColor=A.WHITE.clone(),this.randomSeed=0}},{key:"reset",value:function(){this.node.rotation.set(0,0,0)}}]),n}(M))||hh)||hh;_._RF.pop(),_._RF.push({},"00eb3NBo0tM/qcD6ViMjx0A","CurveRange",void 0);var hM,hD,hF,hU,hx,hz,hG,hV,hK,hH,hq,hW,hj,hX,hY,hJ,hQ,hZ=k.ccclass,h$=k.property,h0=es({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),h1=(hy=hZ("CurveRange"),hv=h$({type:es(h0)}),hg=h$({visible:function(){return this.mode===h0.Constant}}),hm=h$({visible:function(){return this.mode===h0.Curve}}),hb=h$({visible:function(){return this.mode===h0.TwoCurves}}),hw=h$({visible:function(){return this.mode===h0.TwoCurves}}),hS=h$({visible:function(){return this.mode===h0.TwoConstants}}),hE=h$({visible:function(){return this.mode===h0.TwoConstants}}),hy((hC=st((hk=function(){function e(){Fe(this,e),rt(this,"mode",hC,this),rt(this,"constant",hA,this),rt(this,"spline",hT,this),rt(this,"splineMin",hR,this),rt(this,"splineMax",hI,this),rt(this,"constantMin",hP,this),rt(this,"constantMax",hL,this),this.spline.assignSorted([0,1],[0,1]),this.splineMin.assignSorted([0,1],[0,1]),this.splineMax.assignSorted([0,1],[0,1])}return Ue(e,[{key:"evaluate",value:function(g,E){switch(this.mode){case h0.Curve:return this.spline.evaluate(g);case h0.TwoCurves:return eL(this.splineMin.evaluate(g),this.splineMax.evaluate(g),E);case h0.TwoConstants:return eL(this.constantMin,this.constantMax,E);default:return this.constant}}},{key:"getMax",value:function(){switch(this.mode){case h0.Curve:return 1;case h0.TwoConstants:return this.constantMax;case h0.TwoCurves:return 1;default:return this.constant}}},{key:"isZero",value:function(){switch(this.mode){case h0.Curve:return eO(1,0,eB);case h0.TwoConstants:return eO(Math.max(Math.abs(this.constantMax),Math.abs(this.constantMin)),0,eB);case h0.TwoCurves:return eO(1,0,eB);default:return eO(this.constant,0,eB)}}}]),e}()).prototype,"mode",[hv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h0.Constant}}),hA=st(hk.prototype,"constant",[hg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hT=st(hk.prototype,"spline",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eN}}),hR=st(hk.prototype,"splineMin",[hb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eN}}),hI=st(hk.prototype,"splineMax",[hw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eN}}),hP=st(hk.prototype,"constantMin",[hS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hL=st(hk.prototype,"constantMax",[hE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),h_=hk))||h_);_._RF.pop(),_._RF.push({},"3fe5eBRNTJFCZgeD7SqFSh5","GradientRange",void 0);var h2=k.ccclass,h4=k.property,h3=es({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),h5=new A,h6=new A,h8=(hM=h2("GradientRange"),hD=h4({type:es(h3)}),hF=h4({visible:function(){return this.mode===h3.Color}}),hU=h4({visible:function(){return this.mode===h3.TwoColors}}),hx=h4({visible:function(){return this.mode===h3.TwoColors}}),hz=h4({visible:function(){return this.mode===h3.Gradient||this.mode===h3.RandomColor}}),hG=h4({visible:function(){return this.mode===h3.TwoGradients}}),hV=h4({visible:function(){return this.mode===h3.TwoGradients}}),hM((hq=st((hH=function(){function e(){Fe(this,e),rt(this,"mode",hq,this),rt(this,"color",hW,this),rt(this,"colorMin",hj,this),rt(this,"colorMax",hX,this),rt(this,"gradient",hY,this),rt(this,"gradientMin",hJ,this),rt(this,"gradientMax",hQ,this),this._color=A.WHITE.clone()}return Ue(e,[{key:"evaluate",value:function(g,E){switch(this.mode){case h3.Color:return this.color;case h3.TwoColors:return A.lerp(this._color,this.colorMin,this.colorMax,E),this._color;case h3.RandomColor:return this.gradient.getRandomColor(this._color);case h3.Gradient:return this.gradient.evaluateFast(this._color,g);case h3.TwoGradients:return A.lerp(this._color,this.gradientMin.evaluateFast(h5,g),this.gradientMax.evaluateFast(h6,g),E),this._color;default:return this.color}}}]),e}()).prototype,"mode",[hD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h3.Color}}),hW=st(hH.prototype,"color",[hF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),hj=st(hH.prototype,"colorMin",[hU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),hX=st(hH.prototype,"colorMax",[hx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),hY=st(hH.prototype,"gradient",[hz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),hJ=st(hH.prototype,"gradientMin",[hG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),hQ=st(hH.prototype,"gradientMax",[hV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),hK=hH))||hK);function Xy(g,E,_,k){!function(g,E){eS.set(g,Math.cos(E),Math.sin(E))}(g,k),g.z=0,em.multiplyScalar(g,g,E+(_-E)*eF())}function Qy(g){var E=h0;switch(g.mode){case E.TwoCurves:case E.TwoConstants:return!0;default:return!1}}_._RF.pop(),_._RF.push({},"1a4c4Z/fWpFuL5b3emrVLug","ParticleFunction",void 0),_._RF.pop(),_._RF.push({},"c2fc2/T2apMGZCPX5a4abo/","ModuleRandSeed",void 0);var h9,h7,pe,pt,pn,pi,pa,pr=23541,po=39825,ps=90794,pl=91041,pu=125292,pc=197866,ph=156497;_._RF.pop(),_._RF.push({},"39785+APfBJU5kvcdjZGiLr","ColorOvertimeModule",void 0);var pp,pf,py,pv,pg,pm,pb,pw,pS,pE=k.ccclass,p_=k.property,pk=pl,pC=(h9=pE("ColorOvertimeModule"),h7=p_({type:J}),pe=p_({type:h8}),h9((pi=st((pn=function(){function e(){Fe(this,e),rt(this,"enable",pi,this),rt(this,"color",pa,this)}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=g.randomSeed+pk,_=function(g){var E=h3;switch(g.mode){case E.TwoGradients:case E.TwoColors:return!0;default:return!1}}(this.color)?eT(E):0,k=1-g.remainingLifetime/g.startLifetime;g.sprite.color=g.startColor.clone().multiply(this.color.evaluate(k,_))}}}]),e}()).prototype,"enable",[h7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pa=st(pn.prototype,"color",[pe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),pt=pn))||pt);_._RF.pop(),_._RF.push({},"c397apirpxFfJTJN1KLAcGi","LimitVelocityOvertimeModule",void 0);var pA,pT,pR,pI,pP,pL,pO,pB=k.ccclass,pN=k.property,pM=pr,pD=(pp=pB("LimitVelocityOvertimeModule"),pf=pN({type:J}),py=pN({type:h1}),pv=pN({type:h1}),pp((pb=st((pm=function(){function e(){Fe(this,e),rt(this,"enable",pb,this),rt(this,"limit",pw,this),rt(this,"dampen",pS,this),this.limit.constant=500,this.dampen.constant=.2}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=g.velocity.clone().normalize(),C=Qy(this.limit)?eT(g.randomSeed+pM):0,A=Qy(this.dampen)?eT(g.randomSeed+pM+1):0,T=g.velocity.length(),R=this.limit.evaluate(_,C),I=this.dampen.evaluate(_,A);g.velocity=k.multiplyScalar(this.dampenBeyondLimit(T,R,I,E))}}},{key:"dampenBeyondLimit",value:function(g,E,_,k){if(g<=E)return g;var C=1-Math.exp(-_*k);return X.lerp(g,E,C)}}]),e}()).prototype,"enable",[pf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pw=st(pm.prototype,"limit",[py],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),pS=st(pm.prototype,"dampen",[pv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),pg=pm))||pg);_._RF.pop(),_._RF.push({},"442c2KaGHdNip4TBoeKOOoY","RendererModule",void 0);var pF,pU,px,pz,pG,pV,pK,pH,pq,pW,pj,pX,pY,pJ,pQ=k.ccclass,pZ=k.property,p$=(pA=pQ("RendererModule"),pT=pZ(eU),pR=pZ(er),pA((pL=st((pP=Ue(function e(){Fe(this,e),rt(this,"material",pL,this),rt(this,"spriteFrame",pO,this)})).prototype,"material",[pT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pO=st(pP.prototype,"spriteFrame",[pR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pI=pP))||pI);_._RF.pop(),_._RF.push({},"c6cfbhYVctHt53aUXC4oSWy","RotationOvertimeModule",void 0);var p0,p1,p2,p4,p3,p5,p6,p8,p9,p7,de,dt,dn,di,da,dr,ds,dl,du,dc,dh,dp,df,dy=k.ccclass,dv=k.property,dg=pu,dm=(pF=dy("RotationOvertimeModule"),pU=dv({type:J}),px=dv(J),pz=dv({type:h1}),pG=dv({type:h1,visible:function(){return this.separateAxes}}),pV=dv({type:h1,visible:function(){return this.separateAxes}}),pK=dv({type:h1}),pF((pW=st((pq=function(){function e(){Fe(this,e),rt(this,"enable",pW,this),rt(this,"separateAxes",pj,this),rt(this,"x",pX,this),rt(this,"y",pY,this),rt(this,"z",pJ,this)}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=g.randomSeed+dg,C=Qy(this.z)?eT(k):0,A=this.z.evaluate(_,C)*E,T=0,R=0;if(this.separateAxes){var I=Qy(this.x)?eT(k):0,P=Qy(this.y)?eT(k):0;T=this.x.evaluate(_,I)*E,R=this.y.evaluate(_,P)*E}g.node.eulerAngles=new em(g.node.eulerAngles.x+T,g.node.eulerAngles.y+R,g.node.eulerAngles.z+A)}}}]),e}()).prototype,"enable",[pU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pj=st(pq.prototype,"separateAxes",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pX=st(pq.prototype,"x",[pz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),pY=st(pq.prototype,"y",[pG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),pJ=st(pq.prototype,"z",[pV,pK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),pH=pq))||pH);_._RF.pop(),_._RF.push({},"f63cd4ScDJFPrnTLNT4+QKu","ShapeModule",void 0);var db,dw,dS,dE,d_,dk,dC,dA=k.ccclass,dT=k.property,dR=es({Circle:0,Rectangle:1}),dI=es({Base:0,Edge:1}),Fv=function(){return this.shape===dR.Circle},xv=function(){return this.shape===dR.Rectangle},dP=[0,0],dL=(p0=dA("ShapeModule"),p1=dT({type:es(dR)}),p2=dT({type:es(dI),visible:xv}),p4=dT({}),p3=dT({}),p5=dT({}),p6=dT({range:[0,360],visible:Fv}),p8=dT({range:[-360,360],visible:Fv}),p9=dT({min:0,visible:Fv}),p7=dT({range:[0,1],step:.01,visible:Fv}),de=dT({visible:xv}),p0((di=st((dn=function(){function e(){Fe(this,e),rt(this,"shape",di,this),rt(this,"emitFrom",da,this),rt(this,"position",dr,this),rt(this,"rotation",ds,this),rt(this,"scale",dl,this),rt(this,"arc",du,this),rt(this,"angle",dc,this),rt(this,"radius",dh,this),rt(this,"radiusThickness",dp,this),rt(this,"rectangleThickness",df,this)}return Ue(e,[{key:"emit",value:function(g){switch(this.shape){case dR.Circle:this.circleEmit(this.radius,this.radiusThickness,ex(this.generateArcAngle()),g);break;case dR.Rectangle:this.rectangleEmit(this.emitFrom,this.rectangleThickness,g)}}},{key:"circleEmit",value:function(g,E,_,k){var C=k.node.position;Xy(C,g*(1-E),g,_+ex(this.angle)),k.velocity=C.clone().normalize()}},{key:"rectangleEmit",value:function(g,E,_){var k,C,A,T=_.node.position;switch(g){case dI.Base:C=T,A=E,eS.set(C,eR(-A.x,A.x),eR(-A.y,A.y));break;case dI.Edge:dP[0]=eR(-1,1),dP[1]=(0===(k=eR(-1,1))&&k++,eD.sign(k)),function(g){for(var E=0;E<g.length;E++){var _=E+eC(0,g.length-E),k=g[_];g[_]=g[E],g[E]=k}}(dP),this.applyRectThickness(dP,E),eS.set(T,dP[0],dP[1])}_.velocity=T.clone().normalize()}},{key:"generateArcAngle",value:function(){return eR(0,this.arc)}},{key:"applyRectThickness",value:function(g,E){E.x>0&&(g[0]*=E.x),E.y>0&&(g[1]*=E.y)}},{key:"gizmo",value:function(g){switch(g.strokeColor.fromHEX("#46C4FFB0"),g.fillColor.fromHEX("#46C4FF77"),g.lineWidth=8,this.shape){case dR.Circle:this.gizmoCircle(g);break;case dR.Rectangle:this.gizmoRectangle(g)}}},{key:"gizmoCircle",value:function(g){g.clear();var E=this.angle,_=this.angle+this.arc;if(this.createArcPath(g,this.radius,E,_),this.createArcPath(g,this.radius*(1-this.radiusThickness),E,_),this.arc<360&&this.radius>0){var k=this.radius*Math.cos(ex(this.angle)),C=this.radius*Math.sin(ex(this.angle)),A=this.radius*Math.cos(ex(this.arc+this.angle)),T=this.radius*Math.sin(ex(this.arc+this.angle));g.moveTo(k,C),g.lineTo(0,0),g.moveTo(A,T),g.lineTo(0,0)}g.stroke()}},{key:"gizmoRectangle",value:function(g){g.clear();var E=this.rectangleThickness.x,_=this.rectangleThickness.y;g.moveTo(E,_),g.lineTo(-E,_),g.lineTo(-E,-_),g.lineTo(E,-_),g.close(),g.stroke()}},{key:"createArcPath",value:function(g,E,_,k){if(!(E<=0))for(var C=(k-_)/48,A=0;A<=48;A++){var T=_+A*C,R=E*Math.cos(ex(T)),I=E*Math.sin(ex(T));0===A?g.moveTo(R,I):g.lineTo(R,I)}}}]),e}()).prototype,"shape",[p1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dR.Circle}}),da=st(dn.prototype,"emitFrom",[p2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dI.Base}}),dr=st(dn.prototype,"position",[p4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(0,0,0)}}),ds=st(dn.prototype,"rotation",[p3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(0,0,0)}}),dl=st(dn.prototype,"scale",[p5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(1,1,1)}}),du=st(dn.prototype,"arc",[p6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 360}}),dc=st(dn.prototype,"angle",[p8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),dh=st(dn.prototype,"radius",[p9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),dp=st(dn.prototype,"radiusThickness",[p7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),df=st(dn.prototype,"rectangleThickness",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(20,50)}}),dt=dn))||dt);_._RF.pop(),_._RF.push({},"1b7c1WztGdLzKO8gh4ulm2c","SizeOvertimeModule",void 0);var dO,dB,dN,dM,dD,dF,dU,dx,dz,dG,dV,dK,dH,dq=k.ccclass,dW=k.property,dj=po,dX=(db=dq("SizeOvertimeModule"),dw=dW({type:J}),dS=dW({type:h1}),db((dk=st((d_=function(){function e(){Fe(this,e),rt(this,"enable",dk,this),rt(this,"size",dC,this),this.size.constant=1}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=1-g.remainingLifetime/g.startLifetime,_=g.randomSeed+dj,k=Qy(this.size)?eT(_):0,C=this.size.evaluate(E,k);g.node.scale=new em(C*g.startSize.x,C*g.startSize.y,1)}}}]),e}()).prototype,"enable",[dw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dC=st(d_.prototype,"size",[dS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),dE=d_))||dE);_._RF.pop(),_._RF.push({},"530341yf3ZOmaqdU+AYM0/U","SpriteAnimationModule",void 0);var dY,dJ,dQ,dZ,d$,d0,d1,d2,d4,d3=k.ccclass,d5=k.property,d6=ps,d8=(dO=d3("SpriteAnimationModule"),dB=d5({type:J}),dN=d5({type:er}),dM=d5({type:h1}),dD=d5({type:h1}),dF=d5({type:V}),dO((dz=st((dx=function(){function e(){Fe(this,e),rt(this,"enable",dz,this),rt(this,"frames",dG,this),rt(this,"frameOverTime",dV,this),rt(this,"startFrame",dK,this),rt(this,"cycleCount",dH,this),this.frameOverTime.constant=0,this.startFrame.constant=0}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=1-g.remainingLifetime/g.startLifetime,_=Qy(this.startFrame)?eT(g.randomSeed+d6):0,k=Qy(this.frameOverTime)?eT(g.randomSeed+d6):0,C=this.startFrame.evaluate(E,_),A=eP(this.cycleCount*(this.frameOverTime.evaluate(E,k)+C),this.frames.length);g.sprite.spriteFrame=this.frames[Math.floor(A)]}}}]),e}()).prototype,"enable",[dB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dG=st(dx.prototype,"frames",[dN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dV=st(dx.prototype,"frameOverTime",[dM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),dK=st(dx.prototype,"startFrame",[dD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),dH=st(dx.prototype,"cycleCount",[dF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dU=dx))||dU);_._RF.pop(),_._RF.push({},"f6ad5Yz6wpE2ZzModn16CYQ","VelocityOvertimeModule",void 0);var d9,d7,fe,ft,fn,fi,fa,fr,fo,fs,fl,fu,fc,fh,fp,fd,ff,fy,fv,fg,fm,fb,fw,fS,fE,f_,fk,fC,fA,fT,fR,fI,fP,fL,fO,fB,fN,fM,fD,fF,fU,fx,fz,fG,fV,fK,fH,fq,fW,fj,fX,fY,fJ=k.ccclass,fQ=k.property,fZ=(dY=fJ("VelocityOvertimeModule"),dJ=fQ({type:J}),dQ=fQ({type:h1}),dZ=fQ({type:h1}),dY((d1=st((d0=function(){function e(){Fe(this,e),rt(this,"enable",d1,this),rt(this,"x",d2,this),rt(this,"y",d4,this),this._temp_v3=new em,this.x.constant=0,this.y.constant=0}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=Qy(this.x)?eT(g.randomSeed+pc):0,C=Qy(this.y)?eT(g.randomSeed+ph):0,A=em.set(this._temp_v3,this.x.evaluate(_,k),this.y.evaluate(_,C),0);em.add(g.velocity,g.velocity,A.multiplyScalar(E))}}}]),e}()).prototype,"enable",[dJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d2=st(d0.prototype,"x",[dQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),d4=st(d0.prototype,"y",[dZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),d$=d0))||d$);_._RF.pop(),_._RF.push({},"10bc3IfFqBLtpSgVri/NVeX","ParticleSystem",void 0);var f$,f0,f1,f2,f4,f3,f5,f6,f8,f9=k.ccclass,f7=k.property,ye=k.executeInEditMode,yt=k.disallowMultiple,yn=(d9=f9("ParticleSystem"),d7=ye(!0),fe=yt(!0),ft=f7({}),fn=f7(J),fi=f7(K),fa=f7(J),fr=f7({type:h1}),fo=f7({type:h1}),fs=f7(h8),fl=f7(J),fu=f7({type:h1,formerlySerializedAs:"startSize"}),fc=f7({type:h1,visible:function(){return this.startSize2D}}),fh=f7({type:h1}),fp=f7(J),fd=f7({type:h1,formerlySerializedAs:"startRotation"}),ff=f7({type:h1}),fy=f7({type:h1}),fv=f7({type:dL}),fg=f7({type:fZ}),fm=f7({type:dX}),fb=f7({type:dm}),fw=f7({type:pC}),fS=f7({type:d8}),fE=f7({type:pD}),f_=f7(hf),fk=f7({type:p$}),d9(fC=d7(fC=fe((st((fA=function(g){ze(n,g);var E=Xe(n);function n(){var g;return Fe(this,n),(g=E.call(this))._preview=!1,rt(g,"playOnAwake",fT,Ke(g)),rt(g,"duration",fR,Ke(g)),rt(g,"loop",fI,Ke(g)),rt(g,"startDelay",fP,Ke(g)),rt(g,"startLifetime",fL,Ke(g)),rt(g,"startColor",fO,Ke(g)),rt(g,"startSize2D",fB,Ke(g)),rt(g,"startSizeX",fN,Ke(g)),rt(g,"startSizeY",fM,Ke(g)),rt(g,"startSpeed",fD,Ke(g)),rt(g,"startRotation3D",fF,Ke(g)),rt(g,"startRotation",fU,Ke(g)),rt(g,"gravityModifier",fx,Ke(g)),rt(g,"rateOverTime",fz,Ke(g)),rt(g,"shapeModule",fG,Ke(g)),rt(g,"velocityOvertimeModule",fV,Ke(g)),rt(g,"sizeOvertimeModule",fK,Ke(g)),rt(g,"rotationOvertimeModule",fH,Ke(g)),rt(g,"colorOvertimeModule",fq,Ke(g)),rt(g,"spriteAnimationModule",fW,Ke(g)),rt(g,"limitVelocityOvertimeModule",fj,Ke(g)),rt(g,"bursts",fX,Ke(g)),rt(g,"rendererModule",fY,Ke(g)),g.particles=[],g.time=0,g.emitRateTimeCounter=0,g.isPlaying=!1,g.isStopped=!0,g.isEmitting=!1,g.needToRestart=!1,g.startLifetime.constant=5,g.startSizeX.constant=1,g.startSpeed.constant=5,g.rateOverTime.constant=10,g}return Ue(n,[{key:"preview",get:function(){return this._preview},set:function(g){this._preview=g,this.graphics&&this.graphics.destroy()}},{key:"onEnable",value:function(){}},{key:"onLoad",value:function(){this.preview=null!==this.getComponent(ef),this.node.removeAllChildren()}},{key:"start",value:function(){this.node.position=new em(this.node.position.x,this.node.position.y,100),this.playOnAwake?this.play():this.preview}},{key:"update",value:function(g){this.isPlaying&&(this.time+=g,this.emitting(g))}},{key:"play",value:function(){this.needToRestart&&(this.needToRestart=!1),this.isStopped&&(this.isStopped=!1),this.time=0,this.isPlaying=!0,this.isEmitting=!0}},{key:"stop",value:function(){this.isPlaying||(this.isPlaying=!1),this.isEmitting||(this.isEmitting=!1),this.isStopped=!0}},{key:"emitting",value:function(g){var E=this,_=this.startDelay.evaluate(0,1);if(this.time>_&&this.time>this.duration+_&&(this.loop||(this.isEmitting=!1)),this.isEmitting){if(this.emitRateTimeCounter+=this.rateOverTime.evaluate(this.time/this.duration,1)*g,this.emitRateTimeCounter>1){var k=Math.floor(this.emitRateTimeCounter);this.emitRateTimeCounter-=k,this.emit(k,g)}var C,A=at(this.bursts);try{for(A.s();!(C=A.n()).done;)C.value.update(this,g)}catch(g){A.e(g)}finally{A.f()}}var T=this.gravityModifier.evaluate(this.time/this.duration,1);this.particles.forEach(function(_,k){_.node.active&&(E.spriteAnimationModule.update(_),E.sizeOvertimeModule.update(_),E.rotationOvertimeModule.update(_,g),E.colorOvertimeModule.update(_),E.velocityOvertimeModule.update(_,g),E.applyGravityModifier(_,T),E.limitVelocityOvertimeModule.update(_,g),_.node.position.add(_.velocity.clone().multiplyScalar(g)),_.remainingLifetime-=g,_.remainingLifetime<=0&&(_.node.active=!1))})}},{key:"emit",value:function(g,E){if(null!==this.rendererModule.spriteFrame)for(var _=this.time%this.duration/this.duration,k=0;k<g;k++){var C=this.getFreeParticle();C.init(this),C.reset(),this.shapeModule.emit(C);var A=this.startSpeed.evaluate(_,this.rand());C.velocity=C.velocity.clone().multiplyScalar(A);var T=this.startSizeX.evaluate(_,this.rand()),R=this.startSize2D?new em(T,this.startSizeY.evaluate(_,this.rand()),1):new em(T,T,1);C.startSize=R.clone(),C.node.scale=R.clone();var I=this.startRotation.evaluate(_,this.rand());C.node.eulerAngles=new em(0,0,I),C.startColor=this.startColor.evaluate(_,this.rand()).clone(),C.sprite.color=C.startColor.clone(),C.startLifetime=this.startLifetime.evaluate(_,this.rand())+E,C.remainingLifetime=C.startLifetime,C.randomSeed=eC(0,233280)}}},{key:"applyGravityModifier",value:function(g,E){g.velocity.add(new em(0,-9.8*E,0))}},{key:"rand",value:function(){return eT(eC(0,eD.INT_MAX))}},{key:"getFreeParticle",value:function(){var g=this.particles.find(function(g){return!g.node.active});return g||(g=this.createParticle()),g.node.active=!0,g}},{key:"createParticle",value:function(){var g=new C,E=I(g),_=E.addComponent(hN),k=E.addComponent(eo);return this.particles.push(_),k.spriteFrame=this.rendererModule.spriteFrame,k.customMaterial=this.rendererModule.material,this.node.addChild(E),_}}]),n}(M)).prototype,"preview",[ft],Object.getOwnPropertyDescriptor(fA.prototype,"preview"),fA.prototype),fT=st(fA.prototype,"playOnAwake",[fn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),fR=st(fA.prototype,"duration",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),fI=st(fA.prototype,"loop",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fP=st(fA.prototype,"startDelay",[fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),fL=st(fA.prototype,"startLifetime",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),fO=st(fA.prototype,"startColor",[fs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),fB=st(fA.prototype,"startSize2D",[fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fN=st(fA.prototype,"startSizeX",[fu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),fM=st(fA.prototype,"startSizeY",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),fD=st(fA.prototype,"startSpeed",[fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),fF=st(fA.prototype,"startRotation3D",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fU=st(fA.prototype,"startRotation",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),fx=st(fA.prototype,"gravityModifier",[ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),fz=st(fA.prototype,"rateOverTime",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h1}}),fG=st(fA.prototype,"shapeModule",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dL}}),fV=st(fA.prototype,"velocityOvertimeModule",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fZ}}),fK=st(fA.prototype,"sizeOvertimeModule",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dX}}),fH=st(fA.prototype,"rotationOvertimeModule",[fb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dm}}),fq=st(fA.prototype,"colorOvertimeModule",[fw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pC}}),fW=st(fA.prototype,"spriteAnimationModule",[fS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d8}}),fj=st(fA.prototype,"limitVelocityOvertimeModule",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pD}}),fX=st(fA.prototype,"bursts",[f7,f_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fY=st(fA.prototype,"rendererModule",[fk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p$}}),fC=fA))||fC)||fC)||fC);_._RF.pop(),_._RF.push({},"a7ff8uVnP1G3ppM9F/A5DYq","Cloud",void 0);var yi,ya,yr,yo,ys,yl,yu,yc,yh,yp,yf,yy,yv,yg,ym,yb,yw,yS=k.ccclass,yE=k.property,y_=(f$=yS("Cloud"),f0=yE({type:C}),f1=yE({type:C}),f2=yE({type:G}),f$((f5=st((f3=function(g){ze(l,g);var E,_,k,C,A,T=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"cloudSprites",f5,Ke(g)),rt(g,"lightnings",f6,Ke(g)),rt(g,"animation",f8,Ke(g)),g}return Ue(l,[{key:"playInitAnimation",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.moveToScreenCenter()];case 1:g.sent();return[2]}})}),function(){return A.apply(this,arguments)})},{key:"playLightningAnimation",value:(C=Be(function(g,E){var _,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=this.lightnings[E],k=g.subtract(_.worldPosition),C=Math.atan2(k.y,k.x)*(180/Math.PI)+180,A=k.length();_.getComponent(R).width=A,_.angle=C,_.active=!0;return[4,tZ.waitTweenAsync(.2)];case 1:T.sent(),_.active=!1;return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"playScaleTween",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.cloudSprites.map(function(g){var E=z(g).to(.1,{scale:new em(1.2,1.2)},{easing:"quadOut"}).to(.1,{scale:new em(1,1)},{easing:"quadOut"});return tZ.runTweenAsync(E)});return[4,Promise.all(g)];case 1:E.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadAnimation",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(null!==this.animation.defaultClip)return[3,2];return[4,ie.loadAnimClipAsync(nD.CLOUD_IDLE_ANIM)];case 1:g=E.sent();g&&this.animation&&(this.animation.defaultClip=g);E.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"moveToScreenCenter",value:(E=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=$("Canvas").getComponent(R),E=g.width,_=g.height,k=0,C=0;switch(Math.floor(4*Math.random())){case 0:k=Math.random()*E-E/2,C=_/2+300;break;case 1:k=Math.random()*E-E/2,C=-_/2-300;break;case 2:k=-E/2-300,C=Math.random()*_-_/2;break;case 3:k=E/2+300,C=Math.random()*_-_/2}this.node.position=new em(k,C);A=z(this.node).to(.8,{position:new em(0,300)},{easing:"quadOut"});return[4,tZ.runTweenAsync(A)];case 1:T.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),l}(M)).prototype,"cloudSprites",[f0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f6=st(f3.prototype,"lightnings",[f1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f8=st(f3.prototype,"animation",[f2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f4=f3))||f4);_._RF.pop(),_._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var yk,yC,yA,yT,yR,yI=k.ccclass,yP=k.property,yL=k.disallowMultiple,yO=(yi=yI("ShiningStar"),ya=yP(eo),yr=yP({serializable:!0,visible:!1}),yo=yP({type:K,displayName:"Scale up duration",min:.001}),ys=yP({serializable:!0,visible:!1}),yl=yP({type:K,displayName:"Bounce and Fall duration",min:.001}),yu=yP({serializable:!0,visible:!1}),yc=yP({type:K,displayName:"Start scale"}),yh=yP({serializable:!0,visible:!1}),yp=yP({type:K,displayName:"End scale"}),yi(yf=yL((yv=st((yy=function(g){ze(u,g);var E,_,k,C,A,T,R,I=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=I.call.apply(I,[this].concat(_)),"shine",yv,Ke(g)),rt(g,"twScaleUpDuration",yg,Ke(g)),rt(g,"twBounceAndFallDuration",ym,Ke(g)),rt(g,"twStartScale",yb,Ke(g)),rt(g,"twEndScale",yw,Ke(g)),g.isBeingAnimated=!1,g}return Ue(u,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(g){this.twScaleUpDuration=g}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(g){this.twBounceAndFallDuration=g}},{key:"startScale",get:function(){return this.twStartScale},set:function(g){this.twStartScale=g}},{key:"endScale",get:function(){return this.twEndScale},set:function(g){this.twEndScale=g}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(eu),this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(R=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0;return[4,this.animateAppear()];case 1:g.sent();return[4,this.animateDisappear()];case 2:g.sent(),this.isBeingAnimated=!1;return[2]}})}),function(){return R.apply(this,arguments)})},{key:"animateAppear",value:(T=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.shineOpacity.opacity=255;return[4,Promise.all([this.animateFadeIn(),this.animateScaleUp()])];case 1:g.sent();return[2]}})}),function(){return T.apply(this,arguments)})},{key:"animateDisappear",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Promise.all([this.animateBounceAndFall(),this.animateScaleDown()])];case 1:g.sent(),this.node.setScale(0,0),this.uiOpacity.opacity=0;return[2]}})}),function(){return A.apply(this,arguments)})},{key:"animateBounceAndFall",value:(C=Be(function(){var g,E,_,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.node.position.x,E=this.node.position.y,_=[60,120],k=(Math.random()*(_[1]-_[0])+_[0])*(Math.PI/180),C=g+200*Math.cos(k),A=E+200*Math.sin(k),T=E-500,R=tZ.runTweenAsync(z(this.node).to(.2*this.twBounceAndFallDuration,{position:new em(C,A,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new em(C,T,this.node.position.z)},{easing:"cubicIn"})),I=[0,360],P=tZ.runTweenAsync(z(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new em(0,0,Math.random()*(I[1]-I[0])*(C>g?-1:1))},{easing:"sineOut"}));return[4,Promise.all([R,P])];case 1:L.sent(),this.node.eulerAngles=new em(0,0,0);return[2]}})}),function(){return C.apply(this,arguments)})},{key:"animateFadeIn",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=Math.max(this.scaleUpDuration/4,.01);return[4,tZ.runTweenAsync(z(this.uiOpacity).to(g,{opacity:255}))];case 1:E.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"animateScaleUp",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.node.setScale(this.startScale,this.startScale);g=new em(this.endScale,this.endScale,1);return[4,tZ.runTweenAsync(z(this.node).to(this.scaleUpDuration,{scale:g},{easing:"cubicOut"}))];case 1:E.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"animateScaleDown",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=new em(0,0,1);return[4,tZ.runTweenAsync(z(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:g},{easing:"cubicIn"}))];case 1:E.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}}]),u}(M)).prototype,"shine",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yg=st(yy.prototype,"twScaleUpDuration",[yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(yy.prototype,"scaleUpDuration",[yo],Object.getOwnPropertyDescriptor(yy.prototype,"scaleUpDuration"),yy.prototype),ym=st(yy.prototype,"twBounceAndFallDuration",[ys],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(yy.prototype,"bounceAndFallDuration",[yl],Object.getOwnPropertyDescriptor(yy.prototype,"bounceAndFallDuration"),yy.prototype),yb=st(yy.prototype,"twStartScale",[yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(yy.prototype,"startScale",[yc],Object.getOwnPropertyDescriptor(yy.prototype,"startScale"),yy.prototype),yw=st(yy.prototype,"twEndScale",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),st(yy.prototype,"endScale",[yp],Object.getOwnPropertyDescriptor(yy.prototype,"endScale"),yy.prototype),yf=yy))||yf)||yf);_._RF.pop(),_._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var yB,yN,yM,yD,yF,yU,yx,yz,yG,yV,yK,yH,yq,yW,yj,yX,yY,yJ,yQ,yZ,y$,y0=k.ccclass,y1=k.property,y2=k.disallowMultiple,y4=GameCore.Utils.Array,y3=(yk=y0("StarParticles"),yC=y1({type:[yO],displayName:"Prebuilt Shining stars"}),yk(yA=y2((yR=st((yT=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"shiningStars",yR,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=this.getFirstAvailableShiningStar();if(void 0===E)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");_=et(g,2),k=_[0],C=_[1],A=new em(k,C,this.node.worldPosition.z);E.node.worldPosition=A;return[4,E.playAnimation()];case 1:T.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return y4.search(this.shiningStars,function(g){return g.isAvailable})}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}}]),i}(M)).prototype,"shiningStars",[yC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yA=yT))||yA)||yA);_._RF.pop(),_._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var y5=k.ccclass,y6=k.property,y8=(yB=y5("EffectManager"),yN=y6({group:"Thunder Effect",type:y_}),yM=y6({group:"Mask Effect",type:ad}),yD=y6({group:"Mask Effect",type:C}),yF=y6({group:"Tornado Effect",type:C}),yU=y6({group:"Clear Particle Effect",type:C,displayName:"Particle holder node"}),yx=y6({group:"Clear Particle Effect",type:yn,displayName:"Emitter 1"}),yz=y6({group:"Clear Particle Effect",type:yn,displayName:"Emitter 2"}),yG=y6({group:"Star Particles Effect",type:y3}),yV=y6({group:"Confetti Effect",type:yn}),yB((yq=st((yH=function(g){ze(p,g);var E,_,k,C,A,T,R,I,P,L,O,B=Xe(p);function p(){var g;Fe(this,p);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=B.call.apply(B,[this].concat(_)),"cloud",yq,Ke(g)),rt(g,"backgroundMask",yW,Ke(g)),rt(g,"masks",yj,Ke(g)),rt(g,"tornado",yX,Ke(g)),g.bombExplosion=null,g.bombExplosionPool=null,g.defuseExplosion=null,g.defuseExplosionPool=null,rt(g,"clearParticleHolder",yY,Ke(g)),rt(g,"clearParticle1",yJ,Ke(g)),rt(g,"clearParticle2",yQ,Ke(g)),rt(g,"starParticle",yZ,Ke(g)),rt(g,"confetti",y$,Ke(g)),g.maskTargets=[],g}return Ue(p,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"update",value:function(){var g=this;this.maskTargets.length>0&&this.maskTargets.forEach(function(E,_){E.isHidden()||(g.masks[_].worldPosition=E.node.worldPosition.clone())})}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(a1.GRID_RESIZE,this.handleBoardResize,this)}},{key:"handleBoardResize",value:function(g){this.clearParticleHolder.setScale(g,g)}},{key:"playClearEffectAt",value:function(g){this.clearParticle1.node.setWorldPosition(new em(g[0].x,g[0].y,1)),this.clearParticle2.node.setWorldPosition(new em(g[1].x,g[1].y,1)),this.clearParticle1.play(),this.clearParticle2.play()}},{key:"playStarEffectAt",value:function(g){this.starParticle.fireShiningStarAt(g)}},{key:"playConfettiEffect",value:function(){var g,E=at(this.confetti);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}}},{key:"playTornadoAnimation",value:(O=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=null===(g=this.tornado.getChildByName("Sprite"))||void 0===g?void 0:g.getComponent(G);if(!(null!==(null==E?void 0:E.defaultClip)))return[3,2];this.tornado.active=!0;_=z(this.tornado);_.set({scale:new em(0,0,0)}),_.delay(.5),_.to(.5,{scale:new em(1,1,1)},{easing:"backOut"}),_.delay(.6),_.to(.3,{scale:new em(0,0,0)},{easing:"quadIn"}),_.set({active:!1}),ie.setBlockInput(!0);return[4,tZ.runTweenAsync(_)];case 1:k.sent(),ie.setBlockInput(!1);return[3,3];case 2:console.warn("EffectManager: Tornado animation is not loaded when animation play request was made.");k.label=3;case 3:return[2]}})}),function(){return O.apply(this,arguments)})},{key:"playThunderAnimation",value:(L=Be(function(g,E){var _,k,C,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:this.resetMasks();_=et(g,2),k=et(_[0],2),C=k[0],A=k[1],T=et(_[1],2),R=T[0],I=T[1];this.setMaskProperties(0,C.node.worldPosition,C.node.worldScale),this.setMaskProperties(1,A.node.worldPosition,A.node.worldScale),this.setMaskProperties(2,R.node.worldPosition,R.node.worldScale),this.setMaskProperties(3,I.node.worldPosition,I.node.worldScale),this.maskTargets=[C,A,R,I];return[4,this.setBackgroundMaskActive(!0)];case 1:P.sent(),this.cloud.node.active=!0;return[4,this.cloud.playInitAnimation()];case 2:P.sent();return[4,tZ.waitTweenAsync(.2)];case 3:P.sent();return[4,this.performCloudEffectToTiles(C,A,E)];case 4:P.sent();return[4,this.performCloudEffectToTiles(R,I,E)];case 5:P.sent(),this.cloud.node.active=!1;return[4,this.setBackgroundMaskActive(!1)];case 6:P.sent(),this.maskTargets=[];return[2]}})}),function(g,E){return L.apply(this,arguments)})},{key:"performCloudEffectToTiles",value:(P=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:this.shakeGame(),null===(k=$("Vibrate"))||void 0===k||null===(k=k.getComponent(sk))||void 0===k||k.vibrate(500),i8.playSound(ih.THUNDERBOLT),_.clear([[g,E]],"break");return[4,Promise.all([this.cloud.playLightningAnimation(g.node.worldPosition.clone(),0),this.cloud.playLightningAnimation(E.node.worldPosition.clone(),1),this.cloud.playScaleTween()])];case 1:C.sent(),this.node.scene.emit(a1.ADD_COMBO),this.node.scene.emit(a1.ADD_SCORE);return[2]}})}),function(g,E,_){return P.apply(this,arguments)})},{key:"createDefuseExplosionAt",value:(I=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.loadDefuseExplosionPrefab()];case 1:k.sent(),this.defuseExplosionPool||(this.defuseExplosionPool=new cR(this.createDefuseExplosion.bind(this),1,y9.getBombDefuseExplosion,y9.returnBombDefuseExplosion,y9.destroyBombDefuseExplosion));E=this.defuseExplosionPool.alloc();E.setWorldPosition(g);_=E.getComponent(G);return[4,tZ.runAnimationAsync(_)];case 2:if(k.sent(),!this.defuseExplosionPool)throw new Error("EffectManager: defuseExplosionPool is null");this.defuseExplosionPool.free(E);return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"createBombExplosionAt",value:(R=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.loadBombExplosionPrefab()];case 1:if(k.sent(),this.bombExplosionPool||(this.bombExplosionPool=new cR(this.createBombExplosion.bind(this),1,y7.getBombExplosion,y7.returnBombExplosion,y7.destroyBombExplosion)),!this.bombExplosionPool)return[3,3];E=this.bombExplosionPool.alloc();E.setWorldPosition(g);_=E.getComponent(G);return[4,tZ.runAnimationAsync(_)];case 2:k.sent(),this.bombExplosionPool&&this.bombExplosionPool.free(E);k.label=3;case 3:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(T=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:g&&(this.backgroundMask.node.active=!0);return[4,this.backgroundMask.changeStateFade(g,.25)];case 1:E.sent(),g||(this.backgroundMask.node.active=!1);return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"resetMasks",value:function(){var g,E=at(this.masks);try{for(E.s();!(g=E.n()).done;)g.value.worldPosition=new em(-9999,-9999,0)}catch(g){E.e(g)}finally{E.f()}}},{key:"setMaskProperties",value:function(g,E,_){_&&(this.masks[g].worldScale=_),this.masks[g].worldPosition=E}},{key:"createDefuseExplosion",value:function(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return y9.createDefuseExplosion(this.defuseExplosion,this.node)}},{key:"createBombExplosion",value:function(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return y7.createBombExplosion(this.bombExplosion,this.node)}},{key:"loadBombExplosionPrefab",value:(A=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.bombExplosion)return[2,Promise.resolve()];return[4,ie.loadPrefabAsync(nD.BOMB_EXPLODE_PREFAB)];case 1:g=E.sent();return[2,(g&&(this.bombExplosion=g),Promise.resolve())]}})}),function(){return A.apply(this,arguments)})},{key:"loadDefuseExplosionPrefab",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.defuseExplosion)return[2,Promise.resolve()];return[4,ie.loadPrefabAsync(nD.BOMB_DEFUSE_PREFAB)];case 1:g=E.sent();return[2,(g&&(this.defuseExplosion=g),Promise.resolve())]}})}),function(){return C.apply(this,arguments)})},{key:"loadThunderAnimation",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.cloud.loadAnimation()];case 1:g.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadTornadoAnimation",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=null===(g=this.tornado.getChildByName("Sprite"))||void 0===g?void 0:g.getComponent(G);if(null!==(null==E?void 0:E.defaultClip))return[2,Promise.resolve()];return[4,ie.loadAnimClipAsync(nD.TORNADO_IDLE_ANIM)];case 1:_=k.sent();return[2,(_&&(E.defaultClip=_),Promise.resolve())]}})}),function(){return _.apply(this,arguments)})},{key:"shakeGame",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.node.position.clone(),E=z(this.node).to(.05,{position:g.clone().add3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g.clone().subtract3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g});return[4,tZ.runTweenAsync(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),p}(M)).prototype,"cloud",[yN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yW=st(yH.prototype,"backgroundMask",[yM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yj=st(yH.prototype,"masks",[yD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yX=st(yH.prototype,"tornado",[yF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yY=st(yH.prototype,"clearParticleHolder",[yU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yJ=st(yH.prototype,"clearParticle1",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yQ=st(yH.prototype,"clearParticle2",[yz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yZ=st(yH.prototype,"starParticle",[yG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y$=st(yH.prototype,"confetti",[yV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yK=yH))||yK),y9=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"createDefuseExplosion",value:function(g,E){var _=I(g);return E.addChild(_),_.active=!1,_}},{key:"destroyBombDefuseExplosion",value:function(g){g.destroy()}},{key:"getBombDefuseExplosion",value:function(g){g.active=!0}},{key:"returnBombDefuseExplosion",value:function(g){g.active=!1}}]),e}(),y7=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"createBombExplosion",value:function(g,E){var _=I(g);return E.addChild(_),_.active=!1,_}},{key:"destroyBombExplosion",value:function(g){g.destroy()}},{key:"getBombExplosion",value:function(g){g.active=!0}},{key:"returnBombExplosion",value:function(g){g.active=!1}}]),e}();_._RF.pop(),_._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);var ve=GameCore,vt=ve.Configs,vn=ve.Plugins.Ads,vi=vn.Types,va=vn.Status,vr=ve.Utils.Array,vo=globalThis.game.ads,vs=function(){function e(){Fe(this,e),this.isAvoidBannerShowed=!1}var g,E,_,k;return Ue(e,[{key:"canbeShowInSDK",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:[],k=arguments.length>1&&void 0!==E?E:[],C=GameSDK.getSDKName();return(null==k||!k.length||!vr.has(k,C))&&!(null!=_&&_.length&&!vr.has(_,C))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"preloadAds",value:(k=Be(function(){var g,E,_,k,C,A,T,R;return _ts_generator(this,function(I){g=vt.Ads,E=g.Enabled,_=g.InterstitialAdOptions,k=g.RewardedVideoAdOptions,C=g.RewardedInterstitialAdOptions;if(E){A=vi.INTERSTITIAL,T=vi.REWARDED_VIDEO,R=vi.REWARDED_INTERSTITIAL;_.forEach(function(g){var E=g.PlacementId;vo.loadAdAsync(A,E).catch(function(){})}),k.forEach(function(g){var E=g.PlacementId;vo.loadAdAsync(T,E).catch(function(){})}),C.forEach(function(g){var E=g.PlacementId;vo.loadAdAsync(R,E).catch(function(){})})}return[2]})}),function(){return k.apply(this,arguments)})},{key:"setAvoidBannerShowed",value:function(g){this._instance.isAvoidBannerShowed=g}},{key:"showBannerAds",value:function(){var g=this,E=vt.Ads,_=E.Enabled,k=E.BannerDisplayAdOptions;if(_&&!this.inst.isAvoidBannerShowed){var C=eb.instance.getVisibleSize(),A=ns.worldSizeToCssSize(C.height*sC);k.forEach(function(E){var _=E.PlacementId,k=E.Position,C=E.BannerHeight;"bottom"===k&&C>A||g.showBannerAd(_)})}}},{key:"hideBannerAds",value:function(){var g=this,E=vt.Ads,_=E.Enabled,k=E.BannerDisplayAdOptions;_&&k.forEach(function(E){var _=E.PlacementId;g.hideBannerAd(_)})}},{key:"showBannerAd",value:function(g){this.inst.isAvoidBannerShowed||vo.showBannerAdAsync(g).catch(function(g){})}},{key:"hideBannerAd",value:function(g){vo.hideBannerAdAsync(g).catch(function(g){})}},{key:"canShowInterstitialAd",value:function(){var g=vo.getAdStatus(vi.INTERSTITIAL)===va.FILLED;return vo.canbeShowInterstitialAd()&&g}},{key:"canShowRewardedVideoAd",value:function(){return vo.getAdStatus(vi.REWARDED_VIDEO)===va.FILLED}},{key:"canShowRewardedInterstitialAd",value:function(){return vo.getAdStatus(vi.REWARDED_INTERSTITIAL)===va.FILLED}},{key:"showInterstitialAdAsync",value:(_=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:E=g.forLevel,_=g.includeSDK,k=g.excludeSDK;if(!this.inst.canbeShowInSDK(_,k))return[2,!1];if(E&&vt.Gameplay.StartAdAtLevel>=E)return[2,!1];if(!vo.canbeShowInterstitialAd())return[2,!1];C=i8.getVolumeMusic();R.label=1;case 1:R.trys.push([1,4,5,6]);i8.muteSound(!0),i8.setVolumeMusic(0,!0);A=vo.getAdStatus(vi.INTERSTITIAL)===va.FILLED;if(!A)return[3,3];return[4,vo.showAdAsync(vi.INTERSTITIAL)];case 2:A=R.sent();R.label=3;case 3:return[2,!0];case 4:T=R.sent();return[2,(console.warn("showInterstitialAdAsync failed",T),!1)];case 5:Q.resume(),i8.muteAudio(!1),i8.setVolumeMusic(C,!0),vo.loadAdAsync(vi.INTERSTITIAL).catch(function(){});return[7];case 6:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"showRewardVideoAdAsync",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=g.includeSDK,_=g.excludeSDK;if(!this.inst.canbeShowInSDK(E,_))return[2,!1];k=i8.getVolumeMusic();T.label=1;case 1:T.trys.push([1,5,6,7]);i8.muteSound(!0),i8.setVolumeMusic(0,!0),lZ.showLoadingScreen();C=vo.getAdStatus(vi.REWARDED_VIDEO)!==va.FILLED;if(!C)return[3,3];return[4,vo.loadAdAsync(vi.REWARDED_VIDEO)];case 2:C=T.sent();T.label=3;case 3:return[4,vo.showAdAsync(vi.REWARDED_VIDEO)];case 4:return[2,(T.sent(),!0)];case 5:A=T.sent();return[2,(console.warn("showRewardVideoAdAsync failed",A),_instanceof(A,Object)&&"code"in A&&"USER_INPUT"===A.code?lZ.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2):lZ.showNotificationScreen("No ads to display.",2),!1)];case 6:Q.resume(),lZ.closeLoadingScreen(),i8.muteAudio(!1),i8.setVolumeMusic(k,!0),vo.loadAdAsync(vi.REWARDED_VIDEO).catch(function(){});return[7];case 7:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"showRewardedInterstitialAdAsync",value:(g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=g.includeSDK,_=g.excludeSDK;if(!this.inst.canbeShowInSDK(E,_))return[2,!1];k=i8.getVolumeMusic();T.label=1;case 1:T.trys.push([1,5,6,7]);i8.muteSound(!0),i8.setVolumeMusic(0,!0),lZ.showLoadingScreen();C=vo.getAdStatus(vi.REWARDED_INTERSTITIAL)!==va.FILLED;if(!C)return[3,3];return[4,vo.loadAdAsync(vi.REWARDED_INTERSTITIAL)];case 2:C=T.sent();T.label=3;case 3:return[4,vo.showAdAsync(vi.REWARDED_INTERSTITIAL)];case 4:return[2,(T.sent(),!0)];case 5:A=T.sent();return[2,(console.warn("showRewardedInterstitialAdAsync failed",A),!1)];case 6:Q.resume(),lZ.closeLoadingScreen(),i8.muteAudio(!1),i8.setVolumeMusic(k,!0),vo.loadAdAsync(vi.REWARDED_INTERSTITIAL).catch(function(){});return[7];case 7:return[2]}})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var vl="newbie",vc="timer",vh="combo",vp="hint-item",vd="thunder-item",vf="storm-item",vy="pliers-item";_._RF.pop(),_._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var vv=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(a1.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(a1.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.on(a1.GRID_RESIZE,this.handleViewResized,this),this.manager.guideSkipButton.active=!0,this.showStep(this.currentStep),this.manager.node.scene.emit(a1.HIDE_UI)}},{key:"showNextStep",value:function(){this.currentStep+1<uZ.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(E=Be(function(g){var E,_,k,C,A,T,R,I,P,L,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:E=this.gameplay,_=E.board,k=E.effectManager,C=uZ[g].startTile,A=uZ[g].endTile,T=_.getTileAt(C.x,C.y),R=_.getTileAt(A.x,A.y);if(!(T&&R))return[3,3];I=T.node.worldPosition,P=R.node.worldPosition;k.resetMasks(),k.setMaskProperties(0,I,T.node.worldScale),k.setMaskProperties(1,P,R.node.worldScale),k.setBackgroundMaskActive(!0);L=this.manager,O=L.guideHand,B=L.guideTextBox;O.node.active=!0,O.playHandAnimation(I,P),this.alignGuideTextBox(),this.alignSkipButton();return[4,B.hide()];case 1:N.sent(),B.setText(uZ[g].description);return[4,B.show()];case 2:N.sent(),_.setIgnoreInput(!0),T.setIgnoreInput(!1),R.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1);N.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.gameplay,E=g.board,_=g.effectManager,k=uZ[this.currentStep].startTile,C=uZ[this.currentStep].endTile,A=E.getTileAt(k.x,k.y),T=E.getTileAt(C.x,C.y);if(A&&T){var R=A.node.worldPosition,I=T.node.worldPosition;_.setMaskProperties(0,R,A.node.worldScale),_.setMaskProperties(1,I,T.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}}},{key:"alignGuideTextBox",value:function(){var g=this.gameplay.board,E=this.manager.guideTextBox,_=g.getTileAt(0,0);if(_){var k=g.tilesHolder.getWorldScale(),C=g.getTileSize()[1]*k.y,A=_.node.worldPosition.y-C/2,T=E.widget.bottom+(A-E.widget.bottom)/2;E.node.setWorldPosition(E.node.worldPosition.x,T,0);var R=Math.max(Math.min(223,.85*(A-E.widget.bottom)),10),I=.7261538461538461*k.x;E.uiTransform.setContentSize(628*I,R)}}},{key:"alignSkipButton",value:function(){var g=this.gameplay.board,E=this.manager.guideSkipButton;if(E){var _=E.parent;if(_){var k=g.getTileAt(g.getGridSize()[0]-1,g.getGridSize()[1]-1);if(k){var C=g.tilesHolder.getWorldScale(),A=g.getTileSize()[1]*C.y,T=k.node.worldPosition.clone().add3f(A/2,A/2,0),I=ns.cssSizeToWorldSize(ns.getScreenHeightCss()),P=T.x-_.getComponent(R).width/2,L=Math.min(T.y+100,I-(I-T.y)/2);_.setWorldPosition(P,L,0)}}}}},{key:"close",value:(g=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=this.gameplay,E=g.board,_=g.effectManager;this.manager.node.scene.off(a1.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(a1.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.off(a1.GRID_RESIZE,this.handleViewResized,this),E.setIgnoreInput(!1);k=Promise.all;return[4,this.manager.guideTextBox.hide()];case 1:C=[A.sent()];return[4,_.setBackgroundMaskActive(!1)];case 2:return[4,k.apply(Promise,[C.concat([A.sent()])])];case 3:A.sent(),this.manager.guideHand.node.active=!1,this.manager.completeGuide(vl);return[2]}})}),function(){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var vg=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.clock,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5;return[4,this.gameplay.handleShowUI()];case 1:P.sent(),E.node.active=!0,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.active=!0,_.string="Remove all tiles before\nthe time end",_.node.setWorldPosition(I.x,I.y-T/2-50,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 2:P.sent(),this.manager.node.scene.once(a1.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a1.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.clock,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.setWorldPosition(I.x,I.y-T/2-50,0)}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideInfoText,_=g.guideMasks;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(a1.RESUME_TIME);return[4,_.hide()];case 1:k.sent(),E.node.active=!1,this.manager.completeGuide(vc),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var vm=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.comboContainer,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.node.active=!0,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.active=!0,_.string="Remove tiles continuously\nto increase combo!",_.node.setWorldPosition(I.x-A/2-10,I.y,0),_.horizontalAlign=ez.RIGHT,_.getComponent(R).setAnchorPoint(1,.5);return[4,E.show()];case 1:P.sent(),this.manager.node.scene.once(a1.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a1.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.comboContainer,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.setWorldPosition(I.x-A/2-10,I.y,0)}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideInfoText,_=g.guideMasks;this.manager.node.scene.emit(a1.RESUME_TIME),_.node.off(C.EventType.TOUCH_START,this.close,this);return[4,_.hide()];case 1:k.sent(),E.node.active=!1,this.manager.completeGuide(vh),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var vb=GameCore.Utils.Array,vw=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vb.search(this.gameplay.itemManager.items,function(g){return g.itemType===sT.HINT});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to reveal a connectable pair",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:P.sent(),this.manager.node.scene.once(a1.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a1.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);P.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vb.search(this.gameplay.itemManager.items,function(g){return g.itemType===sT.HINT});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(a1.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vp),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var vS=GameCore.Utils.Array,vE=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vS.search(this.gameplay.itemManager.items,function(g){return g.itemType===sT.THUNDER});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to remove 2 pairs",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:P.sent(),this.manager.node.scene.once(a1.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a1.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);P.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vS.search(this.gameplay.itemManager.items,function(g){return g.itemType===sT.THUNDER});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(a1.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vd),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var v_=GameCore.Utils.Array,vk=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=v_.search(this.gameplay.itemManager.items,function(g){return g.itemType===sT.STORM});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to rearrange the tiles",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:P.sent(),this.manager.node.scene.once(a1.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a1.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);P.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=v_.search(this.gameplay.itemManager.items,function(g){return g.itemType===sT.STORM});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(a1.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vf),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var vC,vA,vT,vR,vI,vP,vL,vO,vB,vN=GameCore.Utils.Array,vM=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vN.search(this.gameplay.itemManager.items,function(g){return g.itemType===sT.PLIERS});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to remove bomb",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:P.sent(),this.manager.node.scene.once(a1.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a1.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);P.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vN.search(this.gameplay.itemManager.items,function(g){return g.itemType===sT.PLIERS});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(a1.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vy),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var vD,vF,vU,vx,vz,vG,vV,vK=k.ccclass,vH=k.property,vq=(vC=vK("GuideHand"),vA=vH(C),vT=vH(C),vR=vH(eu),vC((vL=st((vP=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"hand",vL,Ke(g)),rt(g,"circleHighlight",vO,Ke(g)),rt(g,"circleHighlightOpacity",vB,Ke(g)),g}return Ue(n,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(g,E){var _=this;this.handTween&&this.handTween.stop();var k=z(this.hand).to(.8,{worldPosition:E},{easing:"quartOut"}).to(.2,{scale:new em(.9,.9,.9),angle:15}).call(function(){_.playHighlightAnimation()}).to(.2,{scale:em.ONE,angle:0}).to(.8,{worldPosition:g},{easing:"quartOut"}).to(.2,{scale:new em(.9,.9,.9),angle:15}).call(function(){_.playHighlightAnimation()}).to(.2,{scale:em.ONE,angle:0});this.handTween=z(this.hand).repeatForever(k).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),z(this.circleHighlight).to(.6,{scale:new em(1.5,1.5)},{easing:"quadOut"}).start(),z(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(M)).prototype,"hand",[vA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vO=st(vP.prototype,"circleHighlight",[vT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vB=st(vP.prototype,"circleHighlightOpacity",[vR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vI=vP))||vI);_._RF.pop(),_._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var vW,vj,vX,vY,vJ,vQ,vZ=k.ccclass,v$=k.property,v0=(vD=vZ("GameMask"),vF=v$(R),vU=v$(eo),vD((vG=st((vz=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"uiTransform",vG,Ke(g)),rt(g,"sprite",vV,Ke(g)),g}return Ue(n,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),n}(M)).prototype,"uiTransform",[vF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vV=st(vz.prototype,"sprite",[vU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vx=vz))||vx);_._RF.pop(),_._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var v1,v2,v4,v3,v5,v6,v8,v9=k.ccclass,v7=k.property,ge=k.executeInEditMode,gt=(vW=v9("AlphaMasks"),vj=ge(!0),vX=v7(v0),vW(vY=vj((vQ=st((vJ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"masks",vQ,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent(R)}},{key:"start",value:function(){this.material=this.getComponent(eo).getMaterialInstance(0)}},{key:"update",value:function(){var g=this,E=this.UITransform,_=E.width,k=E.height;this.masks.forEach(function(E,C){var A=E.uiTransform,T=A.width,R=A.height,I=A.anchorX,P=A.anchorY,L=T*E.node.scale.x,O=R*E.node.scale.y,B=new eS(L/_,O/k),N=new eS(.5+(.5-I)*B.x,.5-(.5-P)*B.y),M=new eS(N.x+(E.node.worldPosition.x-g.node.worldPosition.x)/_,N.y-(E.node.worldPosition.y-g.node.worldPosition.y)/k);g.material.setProperty("mask".concat(C,"Texture"),E.texture),g.material.setProperty("ratio".concat(C),B),g.material.setProperty("center".concat(C),M)})}},{key:"setMaskActive",value:function(g,E){g>=this.masks.length||this.material.setProperty("useMask".concat(g),E?1:0)}}]),n}(M)).prototype,"masks",[vX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vY=vJ))||vY)||vY);_._RF.pop(),_._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var gn,gi,ga,gr,go,gs,gl,gc=k.ccclass,gh=k.property,gp=(v1=gc("GuideMasks"),v2=gh(ad),v4=gh(gt),v1((v6=st((v5=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background",v6,Ke(g)),rt(g,"alphaMasks",v8,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:g.sent(),this.background.node.active=!1;return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(a1.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(g,E,_,k){this.alphaMasks.masks[1].node.worldPosition=new em(-9999,-9999,0);var C=this.alphaMasks.masks[0];this.setMaskTransform(C,g,E,_,k)}},{key:"setItemMaskTransform",value:function(g,E,_,k){this.alphaMasks.masks[0].node.worldPosition=new em(-9999,-9999,0);var C=this.alphaMasks.masks[1];this.setMaskTransform(C,g,E,_,k)}},{key:"setMaskTransform",value:function(g,E,_,k,C){g.uiTransform.setContentSize(k,C),g.node.setWorldPosition(E,_,0)}}]),a}(M)).prototype,"background",[v2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v8=st(v5.prototype,"alphaMasks",[v4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v3=v5))||v3);_._RF.pop(),_._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var gd,gf,gy,gv,gg,gm,gb,gw,gS,gE,g_,gk,gC,gA=k.ccclass,gT=k.property,gR=(gn=gA("GuideTextBox"),gi=gT(P),ga=gT(H),gn((gs=st((go=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"guideText",gs,Ke(g)),rt(g,"widget",gl,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.opacityToggler=this.getComponent(ad),nC.lazyValidateProperties(this)}},{key:"setText",value:function(g){this.guideText.string=g}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.opacityToggler.changeStateFade(!0)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.opacityToggler.changeStateFade(!1)];case 1:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"guideText",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gl=st(go.prototype,"widget",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gr=go))||gr);_._RF.pop(),_._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var gI,gP,gL,gO,gB,gN,gM,gD,gF,gU,gx,gz,gG,gV,gK,gH,gq,gW,gj,gX=game,gY=gX.player,gJ=gX.analytics,gQ=k.ccclass,gZ=k.property,g$=GameCore,g0=g$.Match.Modes,g1=g$.Plugins.Analytics.Events,g2=g$.Utils.Array,g4=new eS(0,10),g3=new eS(0,10),g5="READY",g6="RUNNING",g8=(gd=gQ("GuidelinesManager"),gf=gZ(vq),gy=gZ(gR),gv=gZ(P),gg=gZ(gp),gm=gZ(C),gd((gS=st((gw=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"guideHand",gS,Ke(g)),rt(g,"guideTextBox",gE,Ke(g)),rt(g,"guideInfoText",g_,Ke(g)),rt(g,"guideMasks",gk,Ke(g)),rt(g,"guideSkipButton",gC,Ke(g)),g.guideHintDelay=null,g.guideStormDelay=null,g}return Ue(i,[{key:"init",value:function(g){this.gameplay=g,this.status=g5,this.node.scene.on(a1.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(a1.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(a1.USE_ITEM,this.handleUseItem,this),this.node.scene.on(a1.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(a1.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(a1.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(vl)&&this.resetGuideItemShowed(),this.startGuide(vl)):this.startGuide(vc)}},{key:"startGuide",value:function(g){if(this.status===g6)return!1;if(this.hasGuideItemShowed(g))return!1;switch(this.addGuideItemShowed(g),this.status=g6,g){case vl:gJ.event(g1.TUTORIAL_BEGIN),this.guide1=new vv(this),this.guide1.setup();break;case vc:this.guide2=new vg(this),this.guide2.setup();break;case vh:this.guide3=new vm(this),this.guide3.setup();break;case vp:this.guide4=new vw(this),this.guide4.setup();break;case vd:this.guide5=new vE(this),this.guide5.setup();break;case vf:this.guide6=new vk(this),this.guide6.setup();break;case vy:this.guide7=new vM(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(g){gJ.event(g1.TUTORIAL_STEP,{step:g}),this.status=g5,this.addGuideItemShowed(g),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){var g=this.getCurrentLevel(),E=g4.x,_=g4.y;return g>=E&&g<=_}},{key:"isShowErrorPathLevel",value:function(){if(lw.getMatchMode()===g0.TOURNAMENT)return!1;var g=this.getCurrentLevel(),E=g3.x,_=g3.y;return g>=E&&g<=_}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(g){return g2.has(this.getGuideItemShowed(),g)}},{key:"addGuideItemShowed",value:function(g){if(!this.hasGuideItemShowed(g)){var E=this.getGuideItemShowed();E.push(g),gY.setGameData({guideItemShowed:E})}}},{key:"resetGuideItemShowed",value:function(){gY.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var g,E;return null!==(g=null===(E=gY.getGameData())||void 0===E?void 0:E.guideItemShowed)&&void 0!==g?g:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(g){this.isNewbieGuideLevel()||g<2||(this.startGuide(vh),this.node.scene.off(a1.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var g=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=z(this.node).delay(5).call(function(){g.isNewbieGuideLevel()||(g.hasGuideItemShowed(vp)&&g.status===g5?g.node.scene.emit(a1.SHOW_HINT):g.startGuide(vp),g.startHintGuide())})),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var g=this;null===this.guideStormDelay&&(this.guideStormDelay=new eG(this.node).delay(10).call(function(){if(!g.isNewbieGuideLevel()&&!g.hasGuideItemShowed(vf)){var E=g2.search(g.gameplay.itemManager.items,function(g){return g.itemType===sT.STORM});E&&E.canActivate()&&(g.startGuide(vf)||g.startStormGuide())}})),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(vd)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(vy)}},{key:"handleUseItem",value:function(g){switch(this.startAutoGuides(),g){case sT.HINT:this.addGuideItemShowed(vp);break;case sT.THUNDER:this.addGuideItemShowed(vd);break;case sT.STORM:this.addGuideItemShowed(vf);break;case sT.PLIERS:this.addGuideItemShowed(vy)}}},{key:"skipNewbieGuide",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.guideSkipButton.active=!1;return[4,this.guide1.close()];case 1:E.sent();g=this.getCurrentLevel()+1;gY.setGameData({level:g}),this.node.scene.emit(a1.NEXT_LEVEL),vs.showBannerAds();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onDestroy",value:function(){var g,E,_,k,C,A;null===(g=this.guide2)||void 0===g||g.unlistenEvents(),null===(E=this.guide3)||void 0===E||E.unlistenEvents(),null===(_=this.guide4)||void 0===_||_.unlistenEvents(),null===(k=this.guide5)||void 0===k||k.unlistenEvents(),null===(C=this.guide6)||void 0===C||C.unlistenEvents(),null===(A=this.guide7)||void 0===A||A.unlistenEvents()}}]),i}(M)).prototype,"guideHand",[gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gE=st(gw.prototype,"guideTextBox",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g_=st(gw.prototype,"guideInfoText",[gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gk=st(gw.prototype,"guideMasks",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gC=st(gw.prototype,"guideSkipButton",[gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gb=gw))||gb);_._RF.pop(),_._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var g9,g7=k.ccclass,me=k.property,mt=(gI=g7("SpecialItem"),gP=me({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),gL=me({type:B,tooltip:"The button that activates the item"}),gO=me({type:V,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),gB=me({type:P,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),gN=me({type:C,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),gM=me({type:C,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),gD=me({type:eu,group:"Animation"}),gF=me({type:eu,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),gI((gz=st((gx=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"isDevButton",gz,Ke(g)),rt(g,"button",gG,Ke(g)),rt(g,"quantity",gV,Ke(g)),rt(g,"quantityLabel",gK,Ke(g)),rt(g,"quantityNode",gH,Ke(g)),rt(g,"plusNode",gq,Ke(g)),rt(g,"glowUIOpacity",gW,Ke(g)),rt(g,"uiOpacity",gj,Ke(g)),g.requestItem=null,g.loadQuantity=null,g}return Ue(o,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"init",value:function(g){var E=this;this.node.scene.on(a1.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(a1.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(a1.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(a1.GRID_SPAWN,this.applyActivationStatus,this),this.node.scene.on(a1.BOMB_EXPLODE,this.applyActivationStatus,this),this.node.scene.on(a1.IDLE_EXIT,function(){E.button.interactable=!1,E.applyActivationStatus()}),this.node.scene.on(a1.IDLE_ENTER,function(){E.button.interactable=!0,E.applyActivationStatus()})}},{key:"start",value:function(){var g=this.loadQuantity();this.setQuantity(g)}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"applyActivationStatus",value:(k=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:null===(g=this.signal)||void 0===g||g.abort();E=new nM;this.signal=E;_=this.canActivate();this.button.interactable=_;return[4,tZ.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:_?255:128}),E)];case 1:k.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"activate",value:(_=Be(function(){return _ts_generator(this,function(g){this.quantity<=0?this.requestItem():(this.vibrate(),this.setQuantity(this.quantity-1));return[2]})}),function(){return _.apply(this,arguments)})},{key:"canActivate",value:function(){return!1}},{key:"setQuantity",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=g;if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();k=Math.max(0,k),this.quantity=k,this.quantityLabel.string="".concat(this.quantity),k<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),_&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}},{key:"getQuantity",value:function(){return this.quantity}},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;this.isDevButton||k&&this.setQuantity(_,k.animate)}},{key:"vibrate",value:function(){var g;null===(g=$("Vibrate"))||void 0===g||null===(g=g.getComponent(sk))||void 0===g||g.vibrate(50)}},{key:"animateAddItem",value:(E=Be(function(){return _ts_generator(this,function(g){return[2,(this.glowUIOpacity.opacity=0,Promise.all([tZ.runTweenAsync(z(this.node).to(.1,{scale:new em(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:em.ONE},{easing:"elasticOut"})),tZ.runTweenAsync(z(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))]))]})}),function(){return E.apply(this,arguments)})}]),o}(M)).prototype,"isDevButton",[gP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gG=st(gx.prototype,"button",[gL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gV=st(gx.prototype,"quantity",[gO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gK=st(gx.prototype,"quantityLabel",[gB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gH=st(gx.prototype,"quantityNode",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gq=st(gx.prototype,"plusNode",[gM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gW=st(gx.prototype,"glowUIOpacity",[gD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gj=st(gx.prototype,"uiOpacity",[gF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gU=gx))||gU);_._RF.pop(),_._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var mn,mi=(0,k.ccclass)("ItemManager")(g9=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).sceneItems=new Set,g}return Ue(n,[{key:"items",get:function(){return tt(this.sceneItems)}},{key:"onLoad",value:function(){this.syncItems()}},{key:"syncItems",value:function(){var g=$("Canvas/UI");if(g){var E,_=at(g.getComponentsInChildren(mt));try{for(_.s();!(E=_.n()).done;){var k=E.value;k.node.activeInHierarchy&&this.sceneItems.add(k)}}catch(g){_.e(g)}finally{_.f()}}}}]),n}(M))||g9;_._RF.pop(),_._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var ma,mr=k.ccclass,mo=GameCore.Utils,ms=mo.Device,ml=mo.Array,mc=globalThis.game.monitorError,mh={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},mp=mr("LevelManager")(mn=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){return Fe(this,r),A.apply(this,arguments)}return Ue(r,[{key:"loadLevel",value:(C=Be(function(){var g,E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:g=T.length>0&&void 0!==T[0]?T[0]:1,E=T.length>1?T[1]:void 0;return[4,this.loadLevelData(g)];case 1:_=R.sent();this.levelData=_||this.levelData||mh;k=this.levelData,C=k.rows,A=k.columns;return[2,(ms.isMobile()&&A>=6&&C>=10&&(this.levelData.columns=5,this.levelData.rows=10),null==mc||mc.addMetadata({level:g}),this.getLevelSpriteFrames(g,E))]}})}),function(){return C.apply(this,arguments)})},{key:"loadLevelData",value:(k=Be(function(){var g,E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:g=A.length>0&&void 0!==A[0]?A[0]:1,E=10,_=this.paddingZero("".concat(Math.floor(g/E)+1),3),k=g%E;return[4,ie.loadJsonAsync("".concat(nD.LEVEL_DATA_FOLDER,"/").concat(_))];case 1:C=T.sent();return[2,C?C[k]:null]}})}),function(){return k.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"getLevelSpriteFrames",value:(_=Be(function(g,E){var _,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:if(!(E&&X.random()<=.5))return[3,2];_=la.getThemeSkins(E),k=_[X.randomRangeInt(0,_.length)];return[4,this.loadSkinFrames(k)];case 1:return[2,I.sent()];case 2:C=la.getLevelSkins(g);if(!(C.length>1))return[3,4];return[4,this.loadSkinFrames(C)];case 3:return[2,I.sent()];case 4:A=C[0],T=la.getUnlockedSkins();if(T.length>1&&X.random()<=.5){R=T.filter(function(g){return g!==A});A=R[X.randomRangeInt(0,R.length)]}return[4,this.loadSkinFrames(A)];case 5:return[2,I.sent()]}})}),function(g,E){return _.apply(this,arguments)})},{key:"loadSkinFrames",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!Array.isArray(g))return[3,2];E=g.map(function(){var g=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E="".concat(nD.TILE_SKIN_FOLDER,"/").concat(g);return[4,ie.loadSpriteFramesDirAsync(E)];case 1:return[2,_.sent()]}})});return function(E){return g.apply(this,arguments)}}());_=ml.flatten;return[4,Promise.all(E)];case 1:return[2,_.apply(ml,[C.sent()])];case 2:k="".concat(nD.TILE_SKIN_FOLDER,"/").concat(g);return[4,ie.loadSpriteFramesDirAsync(k)];case 3:return[2,C.sent()]}})}),function(g){return E.apply(this,arguments)})},{key:"paddingZero",value:function(g,E){for(var _="",k=0;k<E-g.length;k++)_+="0";return _+g}}]),r}(M))||mn;_._RF.pop(),_._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var md=k.ccclass,mf=GameCore.Match.Modes,my=md("ScoreManager")(ma=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).currentScore=0,g.tournamentStartScore=0,g}return Ue(i,[{key:"addScore",value:function(g,E,_){var k=this.getLevelMultiplier(g),C=this.getComboMultiplier(E),A=this.getTimeMultiplier(g,_),T=Math.floor(this.currentScore+10*k*C*A),R=10*Math.ceil(T/10);this.setScore(R)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var g=lw.getMatchMode();this.currentScore=g===mf.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(g){this.currentScore=g,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"resetTournamentStartScore",value:function(){this.tournamentStartScore=0}},{key:"updateScore",value:(E=Be(function(){return _ts_generator(this,function(g){this.node.scene.emit(a1.SCORE_UPDATED,this.currentScore);return[2]})}),function(){return E.apply(this,arguments)})},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(g){return 1+.1*(g-1)}},{key:"getComboMultiplier",value:function(g){return 1+.1*(g-1)}},{key:"getTimeMultiplier",value:function(g,E){return g<=2?4:1+.05*E}}]),i}(M))||ma;_._RF.pop(),_._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var mv=function(){function e(g){Fe(this,e),this.game=null,this.data={},this.game=g.getGameplay(),this.manager=g,this.updateStateData(),this.logDebug()}return Ue(e,[{key:"logDebug",value:function(){var g=this.constructor.name;console.info("[STATE] ".concat(g),this.data)}},{key:"updateStateData",value:function(){if(this.game){var g=this.game.getGameData();g&&(this.data=g)}}},{key:"updateGameData",value:function(g){var E;null===(E=this.game)||void 0===E||E.setGameData(g)}}]),e}();_._RF.pop(),_._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var mg=globalThis.game,mm=mg.analytics,mb=mg.match,mw=mg.storage,mS=GameCore,mE=mS.Match.Modes,m_=mS.Dtos.Match.Data,mk=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(g,E){var _;return Fe(this,r),_=A.call(this,g),i8.stopAllSounds(),_.vibrateDevice(),_.pauseCountdown(),_.updateMatchCustomData(),_.handleGameOver(E),_.logLevelFailAnalytics(),_}return Ue(r,[{key:"pauseCountdown",value:function(){var g;null===(g=this.game)||void 0===g||g.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var g;null===(g=$("Vibrate"))||void 0===g||null===(g=g.getComponent(sk))||void 0===g||g.vibrate(500)}},{key:"handleGameOver",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=lw.getMatchMode();if(ie.setBlockInput(!0),E===mE.SINGLE)return[3,5];if(E!==mE.TOURNAMENT)return[3,2];return[4,this.handleTournamentGameOver()];case 1:_.sent();return[3,4];case 2:if(E!==mE.CHALLENGE_FRIEND)return[2,void this.showFailScreen(g)];return[4,this.handleChallengeGameOver()];case 3:_.sent();_.label=4;case 4:ie.setBlockInput(!1);return[3,6];case 5:this.showFailScreen(g);_.label=6;case 6:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(k=Be(function(){var g,E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=this;if(!this.game)return[3,5];k=(null!==(g=lw.getMatchCustomData())&&void 0!==g?g:{}).tournamentId;if(!k)return[3,5];if(l9.validateTournamentExpired(k))return[2,(mw.setStorageData("tournament","animateTournamentLeader",!1),lZ.showNotificationScreen("Tournament has ended",2),void(null===(C=this.game)||void 0===C||C.scheduleOnce(function(){var g;null===(g=_.game)||void 0===g||g.node.scene.emit(a1.GAME_EXIT)},2)))];I.label=1;case 1:I.trys.push([1,3,,4]);A=mw.getStorageData("tournament","previousScore"),T=this.game.scoreManager.getCurrentScore()>A;mw.setStorageData("tournament","animateTournamentLeader",T);return[4,lw.finishMatchAsync()];case 2:I.sent();return[3,4];case 3:R=I.sent();console.warn(R);return[3,4];case 4:null===(E=this.game)||void 0===E||E.node.scene.emit(a1.GAME_EXIT);I.label=5;case 5:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.game)return[3,6];C.label=1;case 1:C.trys.push([1,4,,5]);g=mb.getMatchState().id;return[4,mb.api.getMatchAPI().getMatchDetailByIdAsync(g)];case 2:E=C.sent(),_=new m_(E).toObject().extraData;return[4,lw.finishMatchAsync({extraData:null!=_?_:void 0})];case 3:C.sent();return[3,5];case 4:k=C.sent();console.warn(k);return[3,5];case 5:this.game.node.scene.emit(a1.SHOW_CHALLENGE_RESULTS);C.label=6;case 6:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"showFailScreen",value:(E=Be(function(g){var E;return _ts_generator(this,function(_){E=this.data.level;g===ue&&i8.playSound(ih.LEVEL_FAIL_TIMEOUT),i8.playSound(ih.LEVEL_FAIL),lZ.openScreen(ib.RESCUES_SCREEN,{level:E,failKey:g});return[2]})}),function(g){return E.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var g;if(this.game){var E=this.data.level,_=void 0===E?1:E,k=null===(g=this.game)||void 0===g?void 0:g.scoreManager.getCurrentScore();lw.updateMatchStateAfterLevelFinish(_,k)}}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=this.game.scoreManager.getCurrentScore(),k=lw.getMatchMode()||void 0;mm.levelFail(E,_,k)}}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var g=this.manager.createPlayingState(this.manager);this.manager.change(g)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}},{key:"update",value:function(){}}]),r}(mv);_._RF.pop(),_._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var mC=globalThis.game,mA=mC.analytics,mT=mC.player,mR=mC.leaderboard,mI=mC.match,mP=GameCore,mL=mP.Match.Modes,mO=mP.Utils.Time,mB=function(g){ze(u,g);var E,_,k,C,A,T,R,I=Xe(u);function u(g){var E;return Fe(this,u),(E=I.call(this,g)).handleFinishStateFlow(),E}return Ue(u,[{key:"handleFinishStateFlow",value:(R=Be(function(){var g;return _ts_generator(this,function(E){if(this.game){this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),this.game.uiManager.pauseTime();g=lw.getMatchMode();g!==mL.CHALLENGE_FRIEND&&g!==mL.TOURNAMENT&&this.updatePlayerProgress(),this.updateMatchCustomData(),g===mL.CHALLENGE_FRIEND?this.handleFinishChallenge():g===mL.TOURNAMENT?this.handleFinishTournament():this.handleFinishSingle(),this.logLevelCompleteAnalytics()}return[2]})}),function(){return R.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"attemptCallCreateShortcut",value:function(){var g=this.data.level;(void 0===g?0:g)<2||vs.canShowInterstitialAd()||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(g){console.warn("createShortcutAsync",g)})}},{key:"updatePlayerProgress",value:function(){if(this.game){var g=this.data.level;if(g){var E=g+1,_=mT.getGameData();if(_){var k=_.totalLevel,C=_.level,A=Math.max(C,E),T=Me({},_);A<k&&(T.level=A),mT.setGameData(T)}}}}},{key:"updateMatchCustomData",value:function(){if(this.game){var g=this.data.level,E=void 0===g?1:g,_=this.game.scoreManager.getCurrentScore();lw.updateMatchStateAfterLevelFinish(E,_)}}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=this.game.scoreManager.getCurrentScore(),k=lw.getMatchMode()||void 0;mA.levelComplete(E,_,k)}}},{key:"handleFinishChallenge",value:(T=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!this.game)return[3,7];k.label=1;case 1:k.trys.push([1,4,,6]);g=mI.getMatchState().id;return[4,lw.getMatchExtraDataAsync(g)];case 2:E=k.sent();return[4,lw.finishMatchAsync({extraData:null!=E?E:void 0})];case 3:k.sent();return[3,6];case 4:_=k.sent();console.warn(_);return[4,lw.finishMatchAsync()];case 5:k.sent();return[3,6];case 6:this.game.node.scene.emit(a1.SHOW_CHALLENGE_RESULTS);k.label=7;case 7:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"handleFinishTournament",value:(A=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.handlePostTournamentScore(),!this.game)return[3,4];g=this.data.level,E=void 0===g?1:g;i8.playSound(ih.LEVEL_COMPLETE,{volume:.5}),this.game.effectManager.playConfettiEffect();return[4,mO.sleepAsync(500)];case 1:k.sent();_=vs.canShowInterstitialAd();if(!_)return[3,3];return[4,vs.showInterstitialAdAsync({forLevel:E})];case 2:_=k.sent();k.label=3;case 3:this.game.node.scene.emit(a1.NEXT_LEVEL);k.label=4;case 4:return[2]}})}),function(){return A.apply(this,arguments)})},{key:"handlePostTournamentScore",value:(C=Be(function(){var g,E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:if(!this.game)return[3,7];E=null===(g=this.game)||void 0===g?void 0:g.scoreManager.getCurrentScore();if(!E)return[3,7];R.label=1;case 1:R.trys.push([1,3,,4]);return[4,GameSDK.tournament.postScoreAsync(E)];case 2:R.sent();return[3,4];case 3:_=R.sent();console.warn("GameSDK post score async",_);return[3,4];case 4:k=lw.getMatchCustomData();if(!k)return[3,7];C=k.leaderboardId,A=k.playerId;T=C&&A;if(!T)return[3,6];return[4,mR.setLeaderboardScoreAsync(C,A,E)];case 5:T=R.sent();R.label=6;case 6:R.label=7;case 7:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleFinishSingle",value:(k=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:i8.turnUpMusic();g=this.data.level,E=void 0===g?0:g;if(!(E>0&&E%5==0))return[3,2];return[4,this.handleFinishHardLevel()];case 1:_.sent();return[3,4];case 2:return[4,this.handleFinishNormalLevel()];case 3:_.sent();_.label=4;case 4:this.handleNextLevelSingle();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"handleFinishNormalLevel",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:A=this.data.level,T=void 0===A?0:A,R=null!==(g=null===(E=mT.getGameData())||void 0===E?void 0:E.coins)&&void 0!==g?g:0,I=null!==(_=null===(k=lw.getMatchCustomData())||void 0===k?void 0:k.score)&&void 0!==_?_:0;P=vs.canShowInterstitialAd();if(!P)return[3,3];return[4,null===(C=this.game)||void 0===C?void 0:C.uiManager.interstitialAdIndicator.flash()];case 1:L.sent();return[4,vs.showInterstitialAdAsync({forLevel:T})];case 2:P=L.sent();L.label=3;case 3:i8.playSound(ih.LEVEL_COMPLETE,{volume:.5});return[4,lZ.openScreenAndWaitForClose(ib.LEVEL_COMPLETE_SCREEN,{level:T,coins:R,score:I,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!1})];case 4:L.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleFinishHardLevel",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,P,L,O,B,N,M;return _ts_generator(this,function(D){switch(D.label){case 0:T=this.data.level,R=void 0===T?0:T,I=null!==(g=null===(E=mT.getGameData())||void 0===E?void 0:E.coins)&&void 0!==g?g:0,P=null!==(_=null===(k=lw.getMatchCustomData())||void 0===k?void 0:k.score)&&void 0!==_?_:0;L=vs.canShowInterstitialAd();if(!L)return[3,3];return[4,null===(A=this.game)||void 0===A?void 0:A.uiManager.interstitialAdIndicator.flash()];case 1:D.sent();return[4,vs.showInterstitialAdAsync({forLevel:R})];case 2:L=D.sent();D.label=3;case 3:i8.playSound(ih.LEVEL_COMPLETE,{volume:.5});return[4,lZ.openScreenAndWaitForClose(ib.LEVEL_COMPLETE_SCREEN,{level:R,coins:I,score:P,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!0})];case 4:O=D.sent().screenData,B=(null!=O?O:{}).canShowRewardsAd;if(!(void 0!==B&&B))return[3,7];return[4,lZ.openScreenAndWaitForClose(ib.GET_REWARDS_SCREEN)];case 5:N=D.sent().screenData,M=null!==(C=null==N?void 0:N.getRewardsSuccess)&&void 0!==C&&C;M&&this.getRewardItems();return[4,lZ.openScreenAndWaitForClose(ib.LEVEL_COMPLETE_SCREEN,{level:R,coins:I,score:P,getRewardsSuccess:M,lookingForRewards:!1})];case 6:D.sent();D.label=7;case 7:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleNextLevelSingle",value:function(){var g=this.data.level,E=mT.getGameData();this.game&&g&&E&&(g>=E.totalLevel?this.game.node.scene.emit(a1.MAX_LEVEL):this.game.node.scene.emit(a1.NEXT_LEVEL))}},{key:"getRewardItems",value:function(){this.game&&(this.game.node.scene.emit(a1.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sT.STORM,quantity:1}),this.game.node.scene.emit(a1.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sT.THUNDER,quantity:1}))}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),u}(mv);_._RF.pop(),_._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var mN=globalThis.game,mM=mN.player,mD=mN.match,mF=GameCore.Match.Modes,mU=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(g){var E;return Fe(this,l),(E=R.call(this,g)).clearBoard(),E.loadLevel(),E.initCountdown(),E.initScore(),E}return Ue(l,[{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.board.clearAnimationQueue(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(T=Be(function(){var g,E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:if(!this.game)return[3,8];g=lw.getMatchMode();R.label=1;case 1:R.trys.push([1,6,,8]);if(g!==mF.CHALLENGE_FRIEND)return[3,3];return[4,this.loadChallengeFriendMode()];case 2:E=R.sent(),_=E.frames,k=E.extraData;i8.playSound(ih.LEVEL_START),this.handleChallengeFriendModeStart(_,k);return[3,5];case 3:return[4,this.loadSingleMode()];case 4:C=R.sent();i8.playSound(ih.LEVEL_START),g===mF.SINGLE?this.handleSingleModeStart(C):g===mF.TOURNAMENT&&this.handleTournamentModeStart(C);R.label=5;case 5:return[3,8];case 6:A=R.sent();console.error("Error loading level:",A);return[4,this.loadSingleMode()];case 7:T=R.sent();i8.playSound(ih.LEVEL_START),this.handleSingleModeStart(T);return[3,8];case 8:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"loadChallengeFriendMode",value:(A=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:g=mD.getMatchState().id;return[4,lw.getMatchExtraDataAsync(g)];case 1:E=C.sent();if(!E)throw new Error("Match mode ".concat(mF.CHALLENGE_FRIEND," but no extraData (for opponent initialization) was found in match data."));_=this.game.levelManager;return[4,_.loadLevel(E.level)];case 2:k=C.sent();return[2,(this.updateGameData({level:E.level,levelData:_.getLevelData()}),{frames:k,extraData:E})]}})}),function(){return A.apply(this,arguments)})},{key:"loadSingleMode",value:(C=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.game.levelManager;return[4,g.loadLevel(this.data.level,this.data.themeId)];case 1:E=_.sent();return[2,(this.updateGameData({levelData:g.getLevelData()}),E)]}})}),function(){return C.apply(this,arguments)})},{key:"handleChallengeFriendModeStart",value:(k=Be(function(g,E){var _,k,C,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:if(!this.game)return[3,3];_=this.game.levelManager.getLevelData(),k=E.level,C=E.fen,A=E.gravity,T=E.rules,R=E.time,I=mM.getPlayerId();return[4,Promise.all([lw.setMatchCustomDataAsync({level:k,score:0}),lw.setProfileMatchDataAsync({id:I,score:0})])];case 1:P.sent(),this.game.board.create(g,Me(Me({},_),{},{level:k,customFen:C,mode:A,rules:T,time:R})),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:P.sent(),this.game.board.setIgnoreInput(!1),this.ready();P.label=3;case 3:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleSingleModeStart",value:(_=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:if(!this.game)return[3,6];_=this.game.levelManager.getLevelData(),k=this.data.level,C=mM.getPlayerId();return[4,Promise.all([lw.setMatchCustomDataAsync({level:k,score:0}),lw.setProfileMatchDataAsync({id:C,score:0})])];case 1:T.sent(),this.game.board.create(g,_),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:T.sent(),null!==(E=this.game.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1);A=k&&k>0&&k%5==0;if(!A)return[3,5];lZ.openScreen(ib.HARD_LEVEL_SCREEN);return[4,tZ.waitTweenAsync(1.3)];case 3:T.sent(),lZ.closeScreen(ib.HARD_LEVEL_SCREEN);return[4,this.game.board.animateTilesWave()];case 4:A=T.sent();T.label=5;case 5:this.ready();T.label=6;case 6:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"handleTournamentModeStart",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!this.game)return[3,3];_=this.game.levelManager.getLevelData(),k=this.data.level,C=mM.getPlayerId();return[4,Promise.all([lw.setMatchCustomDataAsync({level:k}),lw.setProfileMatchDataAsync({id:C})])];case 1:A.sent(),this.game.board.create(g,_),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:A.sent(),null!==(E=this.game.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),this.ready();A.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.init()}},{key:"initCountdown",value:function(){this.game&&this.game.uiManager.initCountdown()}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var g=this.manager.createReadyState(this.manager);this.manager.change(g)}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),l}(mv);_._RF.pop(),_._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var mx=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),(_=E.call(this,g)).startCountdown(),_}return Ue(n,[{key:"startCountdown",value:function(){var g;null===(g=this.game)||void 0===g||g.uiManager.startCountdown()}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){var g=this.manager.createReadyState(this.manager);this.manager.change(g)}},{key:"playing",value:function(){}},{key:"fail",value:function(g){var E=this.manager.createFailState(this.manager,g);this.manager.change(E)}},{key:"finish",value:function(){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}},{key:"update",value:function(){this.updateStateData()}}]),n}(mv);_._RF.pop(),_._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var mz,mG=globalThis.game,mV=mG.analytics,mK=(mG.match,GameCore.Utils.Valid),mH=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),_=E.call(this,g),i8.stopAllSounds(),i8.turnDownMusic(),_.handleGuideFlow(),_.setLevelText(),_.setLevelTime(),_.setGridPlayable(),_.logLevelStartAnalytics(),_}return Ue(n,[{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var g=this.manager.createPlayingState(this.manager);this.manager.change(g)}},{key:"fail",value:function(g){if(mK.isDebugger()){var E=this.manager.createFailState(this.manager);this.manager.change(E)}}},{key:"finish",value:function(){if(mK.isDebugger()){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var g;null!==(g=this.manager.getGameplay().guidelinesManager)&&void 0!==g&&g.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var g,E;this.game&&(null!==(g=this.game.guidelinesManager)&&void 0!==g&&g.isNewbieGuideLevel()||this.game.handleShowUI(),null===(E=this.game.guidelinesManager)||void 0===E||E.show())}},{key:"setLevelTime",value:function(){if(this.game){var g=this.data.levelData;g&&this.game.uiManager.setCountdownTime(g.time)}}},{key:"setLevelText",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g;this.game.uiManager.setLevelText(E)}}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=(lw.getMatchCustomData()||{}).score,k=void 0===_?0:_,C=lw.getMatchMode()||void 0;mV.levelStart(E,k,C)}}}]),n}(mv);_._RF.pop(),_._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var mq,mW,mj,mX,mY,mJ,mQ,mZ,m$,m0=(0,k.ccclass)("StateManager")(mz=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(g){this.gameplay=g,this.state=new mU(this)}},{key:"change",value:function(g){this.state=g}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return _instanceof(this.state,mU)}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return _instanceof(this.state,mH)}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return _instanceof(this.state,mx)}},{key:"fail",value:function(g){this.state.fail(g)}},{key:"isFail",value:function(){return _instanceof(this.state,mk)}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return _instanceof(this.state,mB)}},{key:"update",value:function(g){this.state&&this.state.update(g)}},{key:"createInitializeState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mU,E)}},{key:"createReadyState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mH,E)}},{key:"createPlayingState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mx,E)}},{key:"createFailState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mk,E)}},{key:"createFinishState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mB,E)}}]),n}(M))||mz;_._RF.pop(),_._RF.push({},"2b89dXjcudIaZRJFuh5TAAI","InterstitialAdIndicator",void 0);var m1=k.ccclass,m2=k.property,m4=["Short ad break, hang tight!","Back to the game in just a sec!","Quick ad, then more fun!"];var m3,m5,m6,m8,m9,m7=(mq=m1("InterstitialAdIndicator"),mW=nC.required(),mj=m2(eu),mX=nC.required(),mY=m2(P),mq((mZ=st((mQ=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"uiOpacity",mZ,Ke(g)),rt(g,"label",m$,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){nC.decorateComponent(this)}},{key:"flash",value:(E=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:null===(g=this.signal)||void 0===g||g.abort();_=new nM;this.signal=_,this.label.string=(E=Math.floor(Math.random()*m4.length),m4[E]);k=z(this.uiOpacity).to(.25,{opacity:255},{easing:"linear"}).delay(.25).to(.25,{opacity:100},{easing:"linear"}).delay(.125);return[4,tZ.runTweenAsync(z(this.uiOpacity).repeat(2,k).to(.25,{opacity:0},{easing:"linear"}),_)];case 1:C.sent(),this.uiOpacity.opacity=0;return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"uiOpacity",[mW,mj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m$=st(mQ.prototype,"label",[mX,mY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mJ=mQ))||mJ);_._RF.pop(),_._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);var be,bt,bn,bi,ba,br,bo,bs=k.ccclass,bl=k.property,bu=(m3=bs("Digit"),m5=bl(P),m3((m9=st((m8=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"numberLabels",m9,Ke(g)),g.labelUITransforms=[],g.labelUIOpacitys=[],g.previousNumber=0,g}return Ue(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.labelUITransforms=this.numberLabels.map(function(g){return g.getComponent(R)}),this.labelUIOpacitys=this.numberLabels.map(function(g){return g.getComponent(eu)}),nC.lazyValidateProperties(this)}},{key:"setNumber",value:function(g){this.previousNumber!==g&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[g].node.active||(this.numberLabels[g].node.active=!0),this.labelUIOpacitys[g].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[g].contentSize),this.previousNumber=g)}}]),n}(M)).prototype,"numberLabels",[m5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),m6=m8))||m6);_._RF.pop(),_._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var bc,bh=k.ccclass,bp=k.disallowMultiple,bd=k.property,bf=(be=bh("Clock"),bt=bd(C),bn=bd(bu),be(bi=bp((br=st((ba=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"clockIcon",br,Ke(g)),rt(g,"digits",bo,Ke(g)),g.time=0,g.remaining=0,g.running=!1,g.halfTime=!1,g.handleUpdateConfig=function(E){g.enabled&&console.log("Clock: handleUpdateConfig",E)},g.refillTime=function(){var E=Date.now(),_=z(g.node).to(.5,{scale:new em(1.1,1.1,1)}),k=z(g.node).to(.5,{scale:new em(1,1,1)}),C=z(g.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),A=z(g.clockIcon).repeat(5,C),T=z(g.node).to(3,{position:new em(0,0,0)},{onUpdate:function(){var _=Date.now(),k=(_-E)/3e3>1?1:(_-E)/3e3,C=X.lerp(0,120,k);g.setTime(C)}}).call(function(){g.setTime(120),k.start(),g.node.scene.emit(a1.RESCUE_FINISHED)});z(g.node).parallel(_,T).start(),A.start()},g}return Ue(n,[{key:"__preload",value:function(){this.listenEvents()}},{key:"start",value:function(){this.init()}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"listenEvents",value:function(){this.node.scene.on(t8,this.handleUpdateConfig),this.node.scene.on(a1.RESCUE_START,this.refillTime)}},{key:"setTime",value:function(g){this.time=g,this.updateTimeLabel(g),this.remaining=g}},{key:"getRemainingTime",value:function(){return this.remaining}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(a1.TIME_OUT)}},{key:"update",value:function(g){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=g,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(a1.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}},{key:"updateTimeLabel",value:function(g){for(var E=this.convertSecondsToMmSs(g),_=0;_<E.length;_++)this.digits[_].setNumber(Number.parseInt(E[_]))}},{key:"convertSecondsToMmSs",value:function(g){var E=Math.floor(g/60),_=Math.floor(g%60),k=this.padZero(E),C=this.padZero(_);return"".concat(k).concat(C)}},{key:"padZero",value:function(g){return g<10?"0".concat(g):"".concat(g)}}]),n}(M)).prototype,"clockIcon",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bo=st(ba.prototype,"digits",[bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bi=ba))||bi)||bi);_._RF.pop(),_._RF.push({},"dfab8xSeglD/abIKphEhi4g","ComboContainer",void 0);var by,bv=k.ccclass,bg=GameCore.Match.Modes,bm=bv("ComboContainer")(bc=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"__preload",value:function(){this.widget=this.node.getComponent(H)}},{key:"onLoad",value:function(){nC.lazyValidateProperties(this)}},{key:"updateStatus",value:function(){lw.getMatchMode()===bg.TOURNAMENT?this.widget.top=180:this.widget.top=160}}]),n}(M))||bc;_._RF.pop(),_._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var bb=k.ccclass,bw=bb("ComboProgressBar")(by=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"start",value:function(){this.progressBar=this.getComponent(on),this.opacity=this.getComponent(eu),this.comboTimer=0,this.isActive=!1,this.node.scene.on(a1.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(g){this.isActive&&(this.comboTimer>0?(this.comboTimer-=g,this.progressBar.progress=this.comboTimer/2):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(a1.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(g){0===g?this.opacity.opacity=0:g>0&&(this.isActive=!0,this.comboTimer=2),g>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),n}(M))||by;_._RF.pop(),_._RF.push({},"af947t5g91EkZVWXv5upZaV","CacheUtils",void 0);var bS,bE,b_,bk,bC,bA,bT,bR=GameCore.Utils.Image,bI=globalThis.game.frameCapture,bP=function(){function e(){Fe(this,e)}var g,E,_;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getPlayerAvatar",value:(_=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:C=this.playerAvatarCache.get("".concat(E,":").concat(_));A=C;if(A)return[3,2];return[4,this.loadPlayerAvatar(g,E,_,k)];case 1:A=C=T.sent();T.label=2;case 2:return[2,C]}})}),function(g,E,k,C){return _.apply(this,arguments)})},{key:"loadPlayerAvatar",value:(E=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:return[4,this.loadImage(g,_,_,"".concat(E,":").concat(_))];case 1:C=T.sent();if((null==k||!k.aborted)&&C){A=er.createWithImage(C);return[2,(this.playerAvatarCache.set("".concat(E,":").concat(_),A),A)]}return[2]}})}),function(g,_,k,C){return E.apply(this,arguments)})},{key:"isAvatarCached",value:function(g,E){return this.playerAvatarCache.has("".concat(g,":").concat(E))}},{key:"loadImage",value:(g=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:T.trys.push([0,5,,6]);return[4,bI.captureAsync({width:E,height:_,name:"LeaderAvatar",renderOptions:Ge({},k,{name:k,type:"image",depth:0,position:[0,0],size:[E,_],image:g})})];case 1:C=T.sent();if(!C)return[3,3];return[4,bR.loadImage(C)];case 2:A=T.sent();return[3,4];case 3:A=null;T.label=4;case 4:return[2,A];case 5:T.sent();return[2,null];case 6:return[2]}})}),function(E,_,k,C){return g.apply(this,arguments)})}]),e}();bP.playerAvatarCache=new Map;try{new bP}catch(g){console.error("CacheUtils",g)}_._RF.pop(),_._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var bL,bO,bB,bN,bM,bD,bF,bU=k.ccclass,bx=k.property,bz=k.disallowMultiple,bG=(bS=bU("ScoreBlock"),bE=bx(P),b_=bx(K),bS(bk=bz((bA=st((bC=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"scoreText",bA,Ke(g)),rt(g,"maxScoreWidth",bT,Ke(g)),g.panelWidthDiff=0,g}return Ue(a,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(R),this.scoreUITransform=this.scoreText.node.getComponent(R),this.panelWidthDiff=this.uiTransform.width-this.maxScoreWidth,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateScore",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=g-this.score,k=z(this.node).to(.1,{},{onUpdate:function(g,k){if(k){var C=Math.floor(_*k)+E.score;E.scoreText.string=C.toString(),E.resizeWidth()}}});return[4,tZ.runTweenAsync(k)];case 1:C.sent(),this.setScore(g);return[4,this.resizeWidth()];case 2:C.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"setScore",value:function(g){var E=null!=g?g:0;this.score=E,this.scoreText.string=E.toString()}},{key:"resizeWidth",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this,E=this.uiTransform.width,_=(this.scoreUITransform.width>this.maxScoreWidth?this.scoreUITransform.width:this.maxScoreWidth)+this.panelWidthDiff;this.uiTween&&this.uiTween.stop(),this.uiTween=z(this.node).to(.05,{},{easing:"sineOut",onUpdate:function(k,C){C&&(g.uiTransform.width=X.lerp(E,_,C))}});return[4,tZ.runTweenAsync(this.uiTween)];case 1:k.sent(),this.uiTransform.width=_;return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"scoreText",[bE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bT=st(bC.prototype,"maxScoreWidth",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bk=bC))||bk)||bk);_._RF.pop(),_._RF.push({},"424745QWUlDPabdCe8UcRwy","ChallengeScoreBlock",void 0);var bV,bK,bH,bq,bW,bj,bX,bY,bJ,bQ=k.ccclass,bZ=k.property,b$=(bL=bQ("ChallengeScoreBlock"),bO=bZ(eo),bB=bZ(er),bL((bD=st((bM=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"avatar",bD,Ke(g)),rt(g,"defaultAvatar",bF,Ke(g)),g}return Ue(i,[{key:"updateInfo",value:(E=Be(function(g,E,_){var k,C;return _ts_generator(this,function(A){switch(A.label){case 0:k=this;this.setScore(_),this.scheduleOnce(function(){return k.resizeWidth()},0);A.label=1;case 1:A.trys.push([1,3,,4]);return[4,bP.getPlayerAvatar(g,E,50)];case 2:C=A.sent();if(!C)return[2];C.packable=!0,this.avatar.spriteFrame=C;return[3,4];case 3:A.sent();this.avatar.spriteFrame=this.defaultAvatar;return[3,4];case 4:return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),i}(bG)).prototype,"avatar",[bO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bF=st(bM.prototype,"defaultAvatar",[bB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bN=bM))||bN);_._RF.pop(),_._RF.push({},"f963aJjCvtD0Y2LplwjDer1","ScoreContainer",void 0);var b0,b1,b2,b4,b3,b5,b6,b8,b9,b7,we,wt=k.ccclass,wn=k.property,wi=GameCore.Match.Modes,wa=globalThis.game.match,wr=(bV=wt("ScoreContainer"),bK=wn(bG),bH=wn(b$),bq=wn(b$),bV((bX=st((bj=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"scoreBlock",bX,Ke(g)),rt(g,"playerScoreBlock",bY,Ke(g)),rt(g,"opponentScoreBlock",bJ,Ke(g)),g.scoreBlockShown=!1,g.challengeScoreBlockShown=!1,g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}},{key:"listenGameEvents",value:function(){this.node.scene.on(a1.SCORE_UPDATED,this.updateScore,this)}},{key:"unlistenGameEvents",value:function(){this.node.scene.off(a1.SCORE_UPDATED,this.updateScore,this)}},{key:"updateStatus",value:function(){var g=wa.getMatchState().mode;g===wi.CHALLENGE_FRIEND?(this.showChallengeScoreBlock(),this.hideScoreBlock()):g===wi.SINGLE&&(this.hideChallengeScoreBlock(),this.showScoreBlock())}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"showChallengeScoreBlock",value:function(){var g;if(!this.challengeScoreBlockShown){this.challengeScoreBlockShown=!0;var E=wa.getMatchState(),_=null!==(g=lw.getMatchCustomData())&&void 0!==g?g:{},k=_.playerId,C=_.opponentId;if(k&&C){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var A=E.profiles[k],T=E.profiles[C];this.playerScoreBlock.updateInfo(A.photo,k,A.score),this.opponentScoreBlock.updateInfo(T.photo,C,T.score)}}}},{key:"hideChallengeScoreBlock",value:function(){this.challengeScoreBlockShown&&(this.challengeScoreBlockShown=!1,this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1)}},{key:"showScoreBlock",value:function(){var g;if(!this.scoreBlockShown){this.scoreBlockShown=!0;var E=(null!==(g=lw.getMatchCustomData())&&void 0!==g?g:{}).score;this.scoreBlock.node.active=!0,this.scoreBlock.setScore(E)}}},{key:"hideScoreBlock",value:function(){this.scoreBlockShown&&(this.scoreBlockShown=!1,this.scoreBlock.node.active=!1)}},{key:"updateScore",value:function(g){this.challengeScoreBlockShown?this.playerScoreBlock.updateScore(g):this.scoreBlockShown&&this.scoreBlock.updateScore(g)}}]),n}(M)).prototype,"scoreBlock",[bK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bY=st(bj.prototype,"playerScoreBlock",[bH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bJ=st(bj.prototype,"opponentScoreBlock",[bq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bW=bj))||bW);_._RF.pop(),_._RF.push({},"540108ucKBPYbN9gW5TFh/q","LeaderRail",void 0);var wo,ws,wl,wu,wc,wh=k.ccclass,wp=k.property,wd=(b0=wh("LeaderRail"),b1=wp(P),b2=wp(C),b4=wp(eo),b3=wp(yn),b0((b8=st((b6=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"scoreLabel",b8,Ke(g)),rt(g,"crown",b9,Ke(g)),rt(g,"avatar",b7,Ke(g)),rt(g,"spark",we,Ke(g)),g.score=0,g}return Ue(a,[{key:"__preload",value:function(){this.defaultAvatar=this.avatar.spriteFrame,this.uiOpacity=this.getComponent(eu)}},{key:"updateScore",value:(_=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this,k=g-this.score,C=z(this.node).to(.5,{},{onUpdate:function(g,E){if(E){var C=Math.floor(k*E)+_.score;_.scoreLabel.string=C.toString()}}});return[4,tZ.runTweenAsync(C,E)];case 1:A.sent(),this.score=g,this.scoreLabel.string=g.toString();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"updatePhoto",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=GameSDK.player.getPhoto(),E=GameSDK.player.getID();if(!(g&&E))return[3,2];return[4,bP.getPlayerAvatar(g,E,50)];case 1:_=k.sent();_?(_.packable=!0,this.avatar.spriteFrame=_):this.avatar.spriteFrame=this.defaultAvatar;k.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setCrown",value:function(g){this.crown.active=g}},{key:"setOpacity",value:function(g){this.uiOpacity.opacity=g}},{key:"playSparkParticle",value:function(){this.spark.play()}},{key:"stopSparkParticle",value:function(){this.spark.stop()}}]),a}(M)).prototype,"scoreLabel",[b1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b9=st(b6.prototype,"crown",[b2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b7=st(b6.prototype,"avatar",[b4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),we=st(b6.prototype,"spark",[b3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b5=b6))||b5);_._RF.pop(),_._RF.push({},"00759vwS/dHS6GvHKvVE5Q1","TournamentProgressBar",void 0);var wf,wy,wv,wg,wm,wb,ww,wS,wE,w_,wk,wC,wA,wT,wR,wI=k.ccclass,wP=k.property,wL=474,wO=(wo=wI("TournamentProgressBar"),ws=wP(wd),wo((wc=st((wu=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"playerLeader",wc,Ke(g)),g.onUpdate=function(){g.playerLeader&&g.playerLeader.node&&(g.playerLeader.node.position=new em(g.progressBar.progress*wL-237,0,0))},g}return Ue(i,[{key:"__preload",value:function(){this.progressBar=this.getComponent(ew)}},{key:"updateProgress",value:(E=Be(function(g,E){var _,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:_=A.length>2&&void 0!==A[2]?A[2]:.5,k=A.length>3&&void 0!==A[3]?A[3]:"cubicOut",C=z(this.progressBar).to(_,{progress:g},{easing:k,onUpdate:this.onUpdate});return[4,tZ.runTweenAsync(C,E)];case 1:T.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"getProgress",value:function(){return this.progressBar.progress}}]),i}(M)).prototype,"playerLeader",[ws],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl=wu))||wl);_._RF.pop(),_._RF.push({},"16d68fBLT1Ha7lXADThDtfC","TournamentRail",void 0);var wB,wN,wM,wD,wF,wU,wx,wz,wG,wV,wK,wH,wq,wW,wj,wX,wY,wJ=k.ccclass,wQ=k.property,wZ=GameCore,w$=wZ.Utils,w0=w$.Array,w1=w$.Object,w2=wZ.Match.Modes,w4=globalThis.game.player,w3=(wf=wJ("TournamentRail"),wy=wQ(wO),wv=wQ(wd),wg=wQ(C),wm=wQ(C),wb=wQ(P),ww=wQ(P),wf((w_=st((wE=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"progressBar",w_,Ke(g)),rt(g,"playerLeader",wk,Ke(g)),rt(g,"flag",wC,Ke(g)),rt(g,"sword",wA,Ke(g)),rt(g,"currentRank",wT,Ke(g)),rt(g,"nextRank",wR,Ke(g)),g.nextLeaderIndex=0,g.leaderData=[],g.score=0,g.minScore=0,g.maxScore=0,g.signal=new nM,g.isInited=!1,g}return Ue(s,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu)}},{key:"init",value:function(g){var E=this,_=w4.getPlayerId();this.leaderData=w1.vals(g.leaders).reduce(function(g,E){if(E.playerId!==_&&E.score>0){var k={score:E.score,rank:E.rank};g.push(k)}return g},[]),this.leaderData.sort(function(g,E){return g.score-E.score}),this.leaderData.forEach(function(g,_){g.rank=E.leaderData.length-_}),this.playerLeader.updatePhoto(),this.isInited=!0}},{key:"updateStatus",value:(A=Be(function(){var g;return _ts_generator(this,function(E){if(lw.getMatchMode()===w2.TOURNAMENT){this.signal.abort();g=new nM;this.signal=g,this.uiOpacity.opacity=255,this.node.scene.on(a1.SCORE_UPDATED,this.handleScoreUpdated,this),this.nextLeaderIndex=this.getScoreReachedLeaderIndex(this.score),this.syncRail(g,!0)}else this.uiOpacity.opacity=0;return[2]})}),function(){return A.apply(this,arguments)})},{key:"syncRail",value:(C=Be(function(g){var E,_,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:E=I.length>1&&void 0!==I[1]&&I[1],_=this.leaderData[this.nextLeaderIndex-1],k=this.leaderData[this.nextLeaderIndex],C=_?_.rank:k?k.rank+1:1;this.setRankLabel(C,this.currentRank);A=!k;this.nextRank.node.active=!A,this.runActiveAnimation(this.sword,!A,g),this.playerLeader.setCrown(A),this.playerLeader.updateScore(this.score,g);T=E?0:void 0;if(!A)return[3,2];this.playerLeader.playSparkParticle();return[4,this.progressBar.updateProgress(1,g,T)];case 1:P.sent();return[3,4];case 2:this.playerLeader.stopSparkParticle(),this.setRankLabel(k.rank,this.nextRank),this.minScore=_?_.score:0,this.maxScore=k.score;R=(this.score-this.minScore)/(this.maxScore-this.minScore);R=.8*R+.1;return[4,this.progressBar.updateProgress(R,g,T)];case 3:P.sent();P.label=4;case 4:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"handleScoreUpdated",value:(k=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(this.score!==g))return[3,4];this.signal.abort();E=new nM;if(this.signal=E,this.score=g,!this.isInited)return[3,4];_=this.getScoreReachedLeaderIndex(g);if(!(_>this.nextLeaderIndex))return[3,3];this.nextLeaderIndex=_;k=(1-this.progressBar.getProgress())/1.5;k=Math.min(k,.5);return[4,this.progressBar.updateProgress(1,E,k,"cubicIn")];case 1:C.sent(),this.runBubbleAnimation(this.sword,E);return[4,this.progressBar.updateProgress(0,E,0)];case 2:C.sent(),this.runBubbleAnimation(this.flag,E);C.label=3;case 3:this.syncRail(E);C.label=4;case 4:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"runBubbleAnimation",value:(_=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.scale=em.ONE;_=z(g).to(.1,{scale:new em(1.2,1.2,1.2)}).to(.2,{scale:em.ONE},{easing:"backOut"});return[4,tZ.runTweenAsync(_,E)];case 1:k.sent(),g.scale=em.ONE;return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"runActiveAnimation",value:(E=Be(function(g,E,_){var k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:k=E?em.ZERO:em.ONE,C=E?em.ONE:em.ZERO;if(!!g.scale.equals(C))return[3,2];A=E?"backOut":"quadOut";g.scale=k;T=z(g).to(.1,{scale:new em(1.2,1.2,1.2)}).to(.2,{scale:C},{easing:A});return[4,tZ.runTweenAsync(T,_)];case 1:R.sent(),g.scale=C;R.label=2;case 2:return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"getScoreReachedLeaderIndex",value:function(g){var E=w0.searchIndex(this.leaderData,function(E){return E.score>=g});return -1===E?this.leaderData.length:E}},{key:"setRankLabel",value:function(g,E){var _="";_=1===g?"No.1":2===g?"2nd":3===g?"3rd":"".concat(g,"th"),E.string=_}}]),s}(M)).prototype,"progressBar",[wy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wk=st(wE.prototype,"playerLeader",[wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wC=st(wE.prototype,"flag",[wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wA=st(wE.prototype,"sword",[wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wT=st(wE.prototype,"currentRank",[wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wR=st(wE.prototype,"nextRank",[ww],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wS=wE))||wS);_._RF.pop(),_._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var w5,w6,w8,w9,w7,Se=k.ccclass,St=k.property,Sn=(wB=Se("Header"),wN=St(P),wM=St(C),wD=St(C),wF=St(C),wU=St(C),wx=St(wr),wz=St(w3),wB((wK=st((wV=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"levelText",wK,Ke(g)),rt(g,"settingNode",wH,Ke(g)),rt(g,"homeNode",wq,Ke(g)),rt(g,"leftNode",wW,Ke(g)),rt(g,"coinNode",wj,Ke(g)),rt(g,"scoreContainer",wX,Ke(g)),rt(g,"tournamentRail",wY,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateStatus",value:function(){this.scoreContainer.updateStatus(),this.tournamentRail.updateStatus()}},{key:"handleClickedPauseGame",value:function(){this.showPauseScreen(),this.node.scene.emit(a1.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){lZ.openScreen(ib.QUIT_LEVEL_SCREEN),this.node.scene.emit(a1.GAME_PAUSE)}},{key:"highlightCoinContainer",value:function(){var g=$("Canvas/Screens");if(g){var E=this.coinNode.worldPosition.clone();this.coinNode.parent=g,this.coinNode.worldPosition=E}}},{key:"removeCoinContainerHighlight",value:function(){var g=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=g}},{key:"showPauseScreen",value:function(){lZ.openScreen(ib.PAUSE_SCREEN,{})}},{key:"setLevelText",value:function(g){this.levelText.string="Level ".concat(g)}},{key:"setButtonsSelectable",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.enableBtnNode(this.settingNode,E,!0),this.enableBtnNode(this.homeNode,E,!0)}},{key:"enableBtnNode",value:function(g,E,_){var k=g.getComponent(B);if(k&&(k.interactable=E),g.active=_,_)g.getComponent(ad)}},{key:"setActive",value:function(g){this.uiOpacity.opacity=g?255:0}}]),n}(M)).prototype,"levelText",[wN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wH=st(wV.prototype,"settingNode",[wM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wq=st(wV.prototype,"homeNode",[wD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wW=st(wV.prototype,"leftNode",[wF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wj=st(wV.prototype,"coinNode",[wU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wX=st(wV.prototype,"scoreContainer",[wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wY=st(wV.prototype,"tournamentRail",[wz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wG=wV))||wG);_._RF.pop(),_._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var Si=k.ccclass,Sa=k.property,Sr=(w5=Si("UIMasks"),w6=Sa(ad),w5((w7=st((w9=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background",w7,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:g.sent(),this.background.node.active=!1;return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"background",[w6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w8=w9))||w8);_._RF.pop(),_._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var So,Ss,Sl,Su,Sc,Sh="bomb";_._RF.pop(),_._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var Sp,Sd,Sf,Sy,Sv,Sg,Sm,Sb,Sw,SS,SE,S_,Sk,SC,SA,ST,SR,SI,SP,SL,SO,SB=GameCore,SN=SB.Dtos.Player,SM=SB.Utils.Function,SD=k.ccclass,SF=k.property,SU=globalThis.game.player,Sx=(So=SD("DevToolsContainer"),Ss=SF(C),So((Sc=st((Su=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"devToolsToggle",Sc,Ke(g)),g.isActive=!0,g.game=null,g.bundleName="lowest",g.debouncedStarsNotification=SM.debounce(function(){var g=SU.getGameData();g&&lZ.showNotificationScreen("Stars added. Current stars: ".concat(g.stars))},700),g}return Ue(o,[{key:"injectGameplay",value:function(g){this.game=g}},{key:"hideAllButtons",value:function(){var g,E=at(this.getComponentsInChildren(B));try{for(E.s();!(g=E.n()).done;){var _=g.value.node.parent;_&&_.name!==this.devToolsToggle.name&&(_.active=!1)}}catch(g){E.e(g)}finally{E.f()}}},{key:"showAllButtons",value:function(){var g,E=at(this.getComponentsInChildren(B));try{for(E.s();!(g=E.n()).done;){var _=g.value.node.parent;_&&_.name!==this.devToolsToggle.name&&(_.active=!0)}}catch(g){E.e(g)}finally{E.f()}}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){SU.setPlayerData(SN.Data.getDefaultData()),lZ.openScreen(ib.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(a1.START_OVER,0)}},{key:"handleNextLevel",value:(k=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){k=(null!==(g=null===(E=this.game)||void 0===E||null===(E=E.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:1)+1;null===(_=this.game)||void 0===_||_.setGameData({level:k-1}),SU.setGameData({level:k}),this.node.scene.emit(a1.NEXT_LEVEL);return[2]})}),function(){return k.apply(this,arguments)})},{key:"handlePrevLevel",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){k=Math.max((null!==(g=null===(E=this.game)||void 0===E||null===(E=E.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:2)-1,1);null===(_=this.game)||void 0===_||_.setGameData({level:k-1}),SU.setGameData({level:k}),this.node.scene.emit(a1.NEXT_LEVEL);return[2]})}),function(){return _.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(k){_=Number(g.string);null===(E=this.game)||void 0===E||E.setGameData({level:_-1}),SU.setGameData({level:_}),this.node.scene.emit(a1.NEXT_LEVEL);return[2]})}),function(g){return E.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var g=globalThis.game.getBuildVersion();lZ.showNotificationScreen("Build version: ".concat(g))}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(a1.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){this.node.scene.emit(a1.TIME_OUT)}},{key:"handleClickExplodeButton",value:function(){var g,E,_=this.game;if(_){var k=null===(g=_.getGameData())||void 0===g||null===(g=g.levelData)||void 0===g?void 0:g.specials.bomb;if(k&&!(k<=0)){var C=_.board.getBombTiles();if(0!==C.length){var A=C[0];if((null===(E=A.special)||void 0===E?void 0:E.type)!==Sh)throw new Error("Invalid bomb tile");A.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(a1.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sT.HINT,quantity:2}),this.node.scene.emit(a1.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sT.STORM,quantity:2}),this.node.scene.emit(a1.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sT.THUNDER,quantity:2}),this.node.scene.emit(a1.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sT.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(a1.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var g=SU.getGameData();g&&(SU.setGameData({stars:g.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchQualityAssets",value:function(){switch(this.bundleName){case"lowest":this.bundleName="highest";break;case"highest":this.bundleName="lowest"}Q.emit(nr,{quality:this.bundleName})}}]),o}(M)).prototype,"devToolsToggle",[Ss],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sl=Su))||Sl);_._RF.pop(),_._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var Sz,SG,SV,SK,SH,Sq,SW,Sj,SX=k.ccclass,SY=k.property,SJ=GameCore.Utils.Valid,SQ=(Sp=SX("UIManager"),Sd=SY(m7),Sf=SY(bf),Sy=SY(Sn),Sv=SY(Sx),Sg=SY(bw),Sm=SY(bm),Sb=SY(Sr),Sw=SY([C]),SS=SY([C]),Sp((Sk=st((S_=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"interstitialAdIndicator",Sk,Ke(g)),rt(g,"clock",SC,Ke(g)),rt(g,"header",SA,Ke(g)),rt(g,"devTools",ST,Ke(g)),rt(g,"comboProgressBar",SR,Ke(g)),rt(g,"comboContainer",SI,Ke(g)),rt(g,"uiMasks",SP,Ke(g)),rt(g,"topAnimNodes",SL,Ke(g)),g.originTopNodesPos=[],rt(g,"botAnimNodes",SO,Ke(g)),g.originBotNodesPos=[],g.hideBotWorldY=-80,g.entranceSignal=new nM,g.exitSignal=new nM,g.showDevTools=function(){g.devTools&&(g.devTools.node.active=!0)},g}return Ue(r,[{key:"onLoad",value:function(){var g=this;this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),N.once(e_.EVENT_AFTER_UPDATE,function(){g.saveOriginPos(),g.initUIPos()})}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var g,E=at(this.topAnimNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value;this.originTopNodesPos.push(_.position.clone())}}catch(g){E.e(g)}finally{E.f()}var k,C=at(this.botAnimNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value;this.originBotNodesPos.push(A.position.clone())}}catch(g){C.e(g)}finally{C.f()}}},{key:"initUIPos",value:function(){var g=this;this.topAnimNodes.forEach(function(E,_){var k=g.originTopNodesPos[_].clone();k.y+=200,E.setPosition(k)});var E=new em(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(function(_,k){var C,A,T=g.originBotNodesPos[k].clone();E.y=g.hideBotWorldY;var R=null!==(C=null===(A=_.parent)||void 0===A?void 0:A.inverseTransformPoint(E,E).y)&&void 0!==C?C:200;T.y=R,_.setPosition(T)})}},{key:"listensDevToolsEvents",value:function(){this.node.scene.on(sF.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}},{key:"listenRescueEvents",value:function(){this.node.scene.on(a1.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(a1.RESCUE_FINISHED,this.hideRescueAnimation,this)}},{key:"initDevTools",value:function(g){var E=this;window.addEventListener("reset-game-data",function(){var g;null===(g=E.devTools)||void 0===g||g.handleResetData()}),this.devTools&&(this.devTools.node.active=SJ.isDebugger(),this.devTools.injectGameplay(g))}},{key:"setLevelText",value:function(g){this.header.setLevelText(g)}},{key:"initCountdown",value:function(){this.clock.init()}},{key:"setCountdownTime",value:function(g){this.clock.setTime(g)}},{key:"startCountdown",value:function(){this.clock.startCountdown(),this.comboProgressBar.resume()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause(),this.clock.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume(),this.clock.resume()}},{key:"setComboUI",value:function(g){this.comboContainer.getComponent(ad).changeStateFade(g,.1)}},{key:"disableHeader",value:function(){this.header.setButtonsSelectable(!1)}},{key:"enableHeader",value:function(){this.header.setButtonsSelectable()}},{key:"updateStatus",value:function(){this.header.updateStatus(),this.comboContainer.updateStatus()}},{key:"showRescueAnimation",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.uiMasks.show()];case 1:g.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"hideRescueAnimation",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.uiMasks.hide()];case 1:g.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"playExitAnimUI",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I,P,L;return _ts_generator(this,function(O){switch(O.label){case 0:g=this;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new nM;E=[];this.topAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originTopNodesPos[k].y+200,0),A=z(_);A.to(.17,{position:C},{easing:"backIn"}),E.push(tZ.runTweenAsync(A,g.exitSignal))});k=new em(0,this.hideBotWorldY,0),C=at(this.botAnimNodes);try{for(C.s();!(_=C.n()).done;){R=_.value;k.y=this.hideBotWorldY;I=null!==(A=null===(T=R.parent)||void 0===T?void 0:T.inverseTransformPoint(k,k).y)&&void 0!==A?A:200,P=new em(R.position.x,I,0),L=z(R);L.to(.17,{position:P},{easing:"backIn"}),E.push(tZ.runTweenAsync(L,this.exitSignal))}}catch(g){C.e(g)}finally{C.f()}return[4,Promise.all(E)];case 1:O.sent(),this.exitSignal.aborted||this.header.setActive(!1);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new nM,this.header.setActive(!0);E=[];this.topAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originTopNodesPos[k].y,0),A=z(_);A.to(.2,{position:C},{easing:"backOut"}),E.push(tZ.runTweenAsync(A,g.entranceSignal))}),this.botAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originBotNodesPos[k].y,0),A=z(_);A.to(.2,{position:C},{easing:"backOut"}),E.push(tZ.runTweenAsync(A,g.entranceSignal))});return[4,Promise.all(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"setInteractableItemButtons",value:function(g){var E,_=!(arguments.length>0&&void 0!==g)||g,k=at(this.botAnimNodes);try{for(k.s();!(E=k.n()).done;){var C=E.value,A=C.getComponent(mt);if(A){if(!_){A.button.interactable=!1;continue}A.canActivate()&&(A.button.interactable=!0)}}}catch(g){k.e(g)}finally{k.f()}}}]),r}(M)).prototype,"interstitialAdIndicator",[Sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SC=st(S_.prototype,"clock",[Sf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SA=st(S_.prototype,"header",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ST=st(S_.prototype,"devTools",[Sv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SR=st(S_.prototype,"comboProgressBar",[Sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SI=st(S_.prototype,"comboContainer",[Sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SP=st(S_.prototype,"uiMasks",[Sb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SL=st(S_.prototype,"topAnimNodes",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SO=st(S_.prototype,"botAnimNodes",[SS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SE=S_))||SE);_._RF.pop(),_._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var SZ=globalThis.game,S$=SZ.player,S0=SZ.ads,S1=SZ.event,S2=SZ.match,S4=SZ.storage,S3=SZ.analytics,S5=SZ.monitorError,S6=SZ.frameCapture,S8=SZ.leaderboard,S9=GameCore,S7=S9.Events,Ee=S9.Utils,Et=Ee.Time,En=Ee.Array,Ei=S9.Configs.Gameplay,Ea=S9.Match.Modes,Er=k.ccclass,Eo=k.property,Es=[];Sz=Er("Gameplay"),SG=Eo(cy),SV=Eo(ad),SK=Eo(c6),Sz((Sq=st((SH=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"board",Sq,Ke(g)),rt(g,"opacityToggler",SW,Ke(g)),rt(g,"pathDraw",Sj,Ke(g)),g.gameData=null,g.defaultData={level:1,isFromLoader:!1},g.rescueTiles=[],g.isAutoPlayEnabled=!1,g.handleOpenScreen=function(E){E.screenName===iw[ib.GET_ITEM_SCREEN]&&g.uiManager.highlightCoinContainer()},g.handleShowUI=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.uiManager.updateStatus(),g.uiManager.disableHeader(),g.uiManager.setInteractableItemButtons(!1);return[4,g.uiManager.playEntranceAnimUI()];case 1:E.sent(),g.uiManager.enableHeader(),g.uiManager.setInteractableItemButtons(!0);return[2]}})}),g.handleHideUI=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.uiManager.disableHeader(),g.uiManager.setInteractableItemButtons(!1);return[4,g.uiManager.playExitAnimUI()];case 1:E.sent();return[2]}})}),g.handleCloseScreen=function(E){E.screenName===iw[ib.GET_ITEM_SCREEN]&&g.uiManager.unHighlightCoinContainer()},g.handlePauseGame=function(){g.node.scene.emit(a1.PAUSE_TIME),g.node.pauseSystemEvents(!0),g.opacityToggler.changeStateFade(!1,.1),g.uiManager.setComboUI(!1),g.processCrazyGamesGameplayStop()},g.handleResumeGame=function(){var E;g.node.resumeSystemEvents(!0),g.stateManager.isPlaying()&&g.node.scene.emit(a1.RESUME_TIME),g.processCrazyGamesGameplayStart(),g.opacityToggler.changeStateFade(!0,.1),g.uiManager.setComboUI(!0),null===(E=g.guidelinesManager)||void 0===E||E.startAutoGuides()},g.handleReplayGame=Be(function(){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g.handleHideHint();A.label=1;case 1:A.trys.push([1,6,,7]);E=lw.getMatchMode();_=E===Ea.SINGLE;if(!_)return[3,3];return[4,lw.finishMatchAsync()];case 2:_=A.sent();A.label=3;case 3:k=E!==Ea.CHALLENGE_FRIEND;if(!k)return[3,5];return[4,lw.startMatchAsync()];case 4:k=A.sent();A.label=5;case 5:E===Ea.TOURNAMENT&&(g.scoreManager.resetTournamentStartScore(),g.setGameData({level:1}));return[3,7];case 6:C=A.sent();console.warn("handleReplayGame",C);return[3,7];case 7:g.stateManager.initialize();return[2]}})}),g.handleFinishGame=function(){var E;g.attemptCallCreateShortcut(),null!==(E=g.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()?(g.guidelinesManager.guideSkipButton.active=!1,g.handleNextLevel()):g.stateManager.finish()},g.handleNextLevel=Be(function(){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!g.gameData)return[3,12];_=lw.getMatchMode();A.label=1;case 1:A.trys.push([1,5,,6]);if(_!==Ea.SINGLE)return[3,3];return[4,lw.finishMatchAsync()];case 2:A.sent();return[3,4];case 3:_===Ea.TOURNAMENT&&g.scoreManager.updateTournamentStartScore();A.label=4;case 4:return[3,6];case 5:k=A.sent();console.warn("handleNextLevel",k);return[3,6];case 6:C=(null!==(E=g.gameData.level)&&void 0!==E?E:1)+1;g.setGameData({level:C});if(_!==Ea.TOURNAMENT)return[3,8];return[4,lw.setMatchCustomDataAsync({level:C})];case 7:A.sent();return[3,11];case 8:return[4,lw.setMatchCustomDataAsync({level:C,score:0})];case 9:A.sent();return[4,lw.startMatchAsync()];case 10:A.sent();A.label=11;case 11:g.stateManager.initialize(),console.log("Next level",g.gameData.level);A.label=12;case 12:return[2]}})}),g.handleStartOver=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){S$.setGameData({level:null!=E?E:1}),g.gameData=S$.getGameData(),g.stateManager.initialize(),console.info("Start over",null===(_=g.gameData)||void 0===_?void 0:_.level);return[2]})});return function(g){return E.apply(this,arguments)}}(),g.handleMaxLevel=function(){g.gameData&&(g.initData(),lZ.openScreen(ib.CONGRATULATION_SCREEN,{level:g.gameData.level}),console.info("Max level",g.gameData.level))},g.handleExitGame=Be(function(){return _ts_generator(this,function(g){try{S4.setStorageData("dashboard","animateToCurrentLevel",!0),S4.setStorageData("collection","animateMapPackUnlock",!0)}catch(g){console.warn("handleExitGame",g)}return[2]})}),g.handleTileClick=function(E){g.stateManager.playing(),g.board.handleTileClick(E),g.handleHideHint()},g.handleGridMatchSuccess=function(E,_){g.pathDraw.drawMatchPath(E,function(E){var _=E.x,k=E.y;return g.board.getAnyTileWorldPosition(_,k)}),g.comboManager.addCombo(),g.handleAddScore(),g.effectManager.playClearEffectAt([_[0].node.worldPosition,_[1].node.worldPosition])},g.handleGridMatchFail=function(E){var _;null!==(_=g.guidelinesManager)&&void 0!==_&&_.isShowErrorPathLevel()&&g.pathDraw.drawErrorPath(E,function(E){var _=E.x,k=E.y;return g.board.getAnyTileWorldPosition(_,k)})},g.checkIfGameIsFinish=function(){0===g.board.getUncleared().length&&g.node.scene.emit(a1.GAME_FINISH)},g.handlePauseTime=function(){g.uiManager.pauseTime()},g.handleResumeTime=function(){g.uiManager.resumeTime()},g.handleClockTimeout=function(){g.stateManager.fail(ue)},g.handleHalfTime=function(){void 0!==g.guidelinesManager&&(g.board.getUncleared().length>=g.board.getCleared().length&&g.guidelinesManager.startThunderGuide()||g.board.getBombTiles().length>0&&g.guidelinesManager.startPliersGuide())},g.handleStartRescue=function(){var E,_;for(i8.turnDownMusic(),ie.setBlockInput(!0),g.board.setIgnoreInput(!0);g.rescueTiles.length>0;){var k=g.rescueTiles.pop();null==k||k.restore()}var C=lw.getMatchMode()||void 0;S3.levelRescue(null!==(E=null===(_=g.gameData)||void 0===_?void 0:_.level)&&void 0!==E?E:1,void 0,C)},g.handleFinishRescue=function(){ie.setBlockInput(!1),g.board.setIgnoreInput(!1)},g.handleBombExplode=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.rescueTiles.push(E),g.board.setIgnoreInput(!0),ie.getBlockInput()||(i8.playSound(ih.BOMB_EXPLODE_1),ie.setBlockInput(!0));_=E.node.worldPosition;return[4,g.effectManager.createBombExplosionAt(new em(_.x,_.y,0))];case 1:k.sent(),ie.setBlockInput(!1),g.stateManager.isFail()||g.stateManager.fail(ut);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g.handleShowHint=function(){if(!g.pathDraw.isDrawingHint){var E=g.board.getHintPath();E&&(i8.playSound(ih.HINT_ITEM),g.pathDraw.drawHintPath(E,function(E){return g.board.getAnyTileWorldPosition(E.x,E.y)}),g.board.showHint())}},g.handleHideHint=function(){g.pathDraw.isDrawingHint&&(g.pathDraw.clearHintPath(),g.board.hideHint())},g.handleAddScore=function(){var E=g.levelManager.getLevelData().level,_=g.comboManager.getCombo(),k=g.uiManager.clock.getRemainingTime();g.scoreManager.addScore(E,_,k)},g.handleUseItem=function(E){g.stateManager.playing(),E!==sT.HINT&&g.handleHideHint()},g.handleAutoPlay=function(){g.isAutoPlayEnabled?g.disableAutoPlay():g.enableAutoPlay()},g.enableAutoPlay=function(){g.isAutoPlayEnabled=!0;g.node.scene.once(a1.GAME_FINISH,function(){g.disableAutoPlay()}),g.schedule(g.autoPlay,.5)},g.disableAutoPlay=function(){g.isAutoPlayEnabled=!1,g.unschedule(g.autoPlay)},g.autoPlay=function(){var E=g.board.getHintPath();if(!E)throw new Error("No path found");var _=E[0].a,k=E.slice(-1)[0].b,C=g.board.getTileAt(_.x,_.y),A=g.board.getTileAt(k.x,k.y);if(!C||!A)throw new Error("Tile is null");C.onClick(),A.onClick()},g.handleAddStars=function(E){var _=S$.getGameData();if(!_)return Promise.resolve([]);S$.setGameData({stars:_.stars+1});var k=E.startAnimationAt;k&&g.effectManager.playStarEffectAt(k)},g.handleInviteFriends=Be(function(){var E,_,k,C,A,T,R,I,P,L,O,B,N,M;return _ts_generator(this,function(D){switch(D.label){case 0:D.trys.push([0,2,,3]);lZ.showLoadingScreen();C=g.board.generateFenFromCurrentLevel(),A=(null!==(E=S$.getGameData())&&void 0!==E?E:{}).level,T=void 0===A?1:A;T=Math.max(1,T);R=null!==(_=null===(k=g.gameData)||void 0===k?void 0:k.levelData)&&void 0!==_?_:{},I=R.mode,P=void 0===I?"":I,L=R.rules,O=void 0===L?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:L,B=R.time,N=void 0===B?0:B;S6.addWideframeRender("renderResultChallenge",s2);return[4,S2.context.choose.processAsync({playerId:S$.getPlayerId(),fallbackSingleMode:!1,extraData:{level:T,fen:C,gravity:P,rules:O,time:N}})];case 1:D.sent(),lZ.closeLoadingScreen(),g.node.scene.emit(a1.GAME_RESUME),g.node.scene.emit(a1.GAME_REPLAY,{level:T});return[3,3];case 2:M=D.sent();if(console.warn("Unable to invite friends",M),lZ.closeLoadingScreen(),lZ.showNotificationScreen("Sorry, please try again later"),!_instanceof(M,Error))return[2];null==S5||S5.sendException(M),g.node.scene.emit(a1.GAME_RESUME),g.node.scene.emit(a1.SHOW_UI);return[3,3];case 3:return[2]}})}),g.handleAdShow=function(E){var _=E.placementId;_&&-1!==Es.indexOf(_)&&(Es.splice(Es.indexOf(_),1),S0.hideBannerAdAsync(_).catch(function(){}),0===Es.length&&S1.off(S7.AD_SHOWING,g.handleAdShow))},g.handleAddItem=function(){var E=Be(function(E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=E.animate,k=E.item,C=E.quantity,A=En.search(g.itemManager.items,function(g){return g.itemType===k});if(!(void 0!==A))return[3,2];T=A.getQuantity()+C;A.saveQuantity(T),g.uiManager.setInteractableItemButtons(!1),g.handlePauseGame();return[4,_()];case 1:R.sent(),A.setQuantity(T,!0),g.uiManager.setInteractableItemButtons(!0),g.handleResumeGame();return[3,3];case 2:console.warn("Item ".concat(k," not found"));R.label=3;case 3:return[2]}})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(a,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function(){la.init()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}},{key:"initUIManager",value:function(){var g;this.uiManager=null===(g=this.node.parent)||void 0===g?void 0:g.getComponentInChildren(SQ),this.uiManager.initDevTools(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(mp)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(m0)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(un)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(y8)}},{key:"initItemManager",value:function(){this.itemManager=this.getComponent(mi),this.itemManager.syncItems();var g,E=at(this.itemManager.items);try{for(E.s();!(g=E.n()).done;)g.value.init(this)}catch(g){E.e(g)}finally{E.f()}}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(hc),this.comboManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(my),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){Ei.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(g8),this.guidelinesManager.init(this))}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){Es=[],S1.off(S7.AD_SHOWING,this.handleAdShow),S1.clear(S7.OPENING_SCREEN),S1.clear(S7.CLOSING_SCREEN),S1.on(S7.OPENING_SCREEN,this.handleOpenScreen),S1.on(S7.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(a1.SHOW_UI,this.handleShowUI),this.node.scene.on(a1.HIDE_UI,this.handleHideUI),this.node.scene.on(a1.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(a1.GAME_RESUME,this.handleResumeGame),this.node.scene.on(a1.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(a1.GAME_FINISH,this.handleFinishGame),this.node.scene.on(a1.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(a1.START_OVER,this.handleStartOver),this.node.scene.on(a1.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(a1.GAME_EXIT,this.handleExitGame),this.node.scene.on(a1.TILE_CLICK,this.handleTileClick),this.node.scene.on(a1.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(a1.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(a1.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(a1.RESUME_TIME,this.handleResumeTime),this.node.scene.on(a1.TIME_OUT,this.handleClockTimeout),this.node.scene.on(a1.HALF_TIME,this.handleHalfTime),this.node.scene.on(a1.RESCUE_START,this.handleStartRescue),this.node.scene.on(a1.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(a1.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(a1.SHOW_HINT,this.handleShowHint),this.node.scene.on(a1.ADD_SCORE,this.handleAddScore),this.node.scene.on(a1.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(a1.USE_ITEM,this.handleUseItem),this.node.scene.on(a1.ADD_ITEM,this.handleAddItem),this.node.scene.on(a1.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(a1.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(a1.INVITE_FRIENDS,this.handleInviteFriends)}},{key:"start",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.initDataFirstTime();return[4,this.tryInitTournamentMode()];case 1:g.sent(),this.initGame();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"initDataFirstTime",value:function(){var g,E,_=this.getSceneData(),k=(null!=_?_:{}).isFromLoader,C=void 0!==k&&k,A=(null!=_?_:{}).level;void 0===A&&(A=lw.getMatchMode()===Ea.TOURNAMENT?1:null!==(g=null===(E=S$.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:0);this.initData(),this.setGameData({level:A,isFromLoader:C})}},{key:"initData",value:function(){var g,E=this.getSceneData(),_=(null!=E?E:{}).isFromLoader,k=void 0!==_&&_,C=null!==(g=S$.getGameData())&&void 0!==g?g:{},A=C.level,T=void 0===A?1:A,R=C.items;0===T&&k&&R?(R.hint=2,R.thunder=1,R.storm=1,R.pliers=0,S$.setGameData({items:R,coins:500,lastRewardedItems:Date.now()}),this.node.scene.emit(a1.ADD_COINS,{coins:500,playSound:!1})):R&&this.checkItemsRewardable()&&(R.hint<5&&(R.hint+=1),R.thunder<5&&(R.thunder+=1),R.storm<5&&(R.storm+=1),R.pliers<5&&(R.pliers+=1),S$.setGameData({items:R,lastRewardedItems:Date.now()})),this.setGameData(Me(Me({},this.defaultData),{},{level:T}))}},{key:"checkItemsRewardable",value:function(){var g,E=(null!==(g=S$.getGameData())&&void 0!==g?g:{}).lastRewardedItems,_=void 0===E?0:E;return!Et.isToday(_)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"tryInitTournamentMode",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,P,L,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:if(lw.getMatchMode()!==Ea.TOURNAMENT)return[3,8];_=null!==(g=lw.getMatchCustomData())&&void 0!==g?g:{},k=_.leaderboardId,C=_.tournamentId;if(!(k&&C))return[3,8];return[4,l9.requestTournamentDataAsync()];case 1:N.sent();A=l9.getTournamentDataById(C);if(!A)return[3,8];T=A.payload.themeId;this.setGameData({themeId:T});R=S8.getLeaderboardName(k);if(!R)return[3,8];I=null;if(!(null!==(E=this.gameData)&&void 0!==E&&E.isFromLoader))return[3,3];return[4,s6.getAllLeaderboardAsync(k)];case 2:I=N.sent();return[3,5];case 3:return[4,s6.waitForLeaderboardFinishAsync(R)];case 4:N.sent(),I=S8.getLeaderboard(R);N.label=5;case 5:if(!I)return[3,8];this.uiManager.header.tournamentRail.init(I);P=S$.getPlayerId(),L=I.leaders[P];if(!!L)return[3,7];return[4,S8.getLeadersByPlayerIdsAsync(R,[P])];case 6:O=N.sent();if(0===O.length)return[2];L=O[0];N.label=7;case 7:B=L.score;S4.setStorageData("tournament","previousScore",B);N.label=8;case 8:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setGameData",value:function(g){var E,_,k,C=null!==(E=null!==(_=g.level)&&void 0!==_?_:null===(k=this.gameData)||void 0===k?void 0:k.level)&&void 0!==E?E:1;this.gameData=Me(Me(Me({},this.gameData),g),{},{level:C})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return lM.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var g,E=null!==(g=this.getGameData())&&void 0!==g?g:{},_=E.level,k=void 0===_?0:_,C=E.nextLevelCount;k<2||(void 0===C?0:C)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(g){console.warn("checkAndCreateShortcutAsync",g)})}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),a}(M)).prototype,"board",[SG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SW=st(SH.prototype,"opacityToggler",[SV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sj=st(SH.prototype,"pathDraw",[SK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SH));_._RF.pop(),_._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var El=function(g){return g[g.STAR_CHEST=0]="STAR_CHEST",g[g.BALLOON=1]="BALLOON",g}(El||{});Z(El),_._RF.pop(),_._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var Eu=function(g){return g.WORLD_TAB_SELECTED="world-tab-selected",g.FRIENDS_TAB_SELECTED="friends-tab-selected",g}(Eu||{}),Ec="#AE4212",Eh="#3D5172",Ep="#92200C",Ed="#8F5542",Ef="#8A4733",Ey="#3e7110",Ev="#3e7110";_._RF.pop(),_._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),_._RF.pop(),_._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);_._RF.pop(),_._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),_._RF.pop(),_._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),_._RF.pop(),_._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var Eg=k.ccclass,Em=globalThis.game,Eb=Em.player,Ew=Em.analytics,ES=GameCore.Plugins.Analytics.Events;Eg("HintItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){lZ.openScreen(ib.GET_ITEM_SCREEN,{item:sT.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},g.loadQuantity=function(){var g=Eb.getGameData();return null!=g&&g.items&&g?g.items[sT.HINT]:0},g}return Ue(i,[{key:"itemType",get:function(){return sT.HINT}},{key:"init",value:function(g){this.boardInstance=g.board,this.pathDrawer=g.pathDraw,this.setQuantity(this.loadQuantity()),Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nC.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>0}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.pathDrawer.isDrawingHint;if(g)return[3,5];if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:E=_.sent();return[3,4];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:E=(_.sent(),Ew.event(ES.USE_ITEM,{item_name:sT.HINT}),this.node.scene.emit(a1.USE_ITEM,sT.HINT),this.node.scene.emit(a1.SHOW_HINT));_.label=4;case 4:g=E;_.label=5;case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=Eb.getGameData();C&&Eb.setGameData({items:Me(Me({},C.items),{},Ge({},sT.HINT,_))})}}]),i}(mt));_._RF.pop(),_._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var EE=k.ccclass,E_=globalThis.game,Ek=E_.player,EC=E_.analytics,EA=GameCore.Plugins.Analytics.Events;EE("PliersItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){lZ.openScreen(ib.GET_ITEM_SCREEN,{item:sT.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},g.loadQuantity=function(){var g=Ek.getGameData();return null!=g&&g.items&&g?g.items[sT.PLIERS]:0},g}return Ue(i,[{key:"itemType",get:function(){return sT.PLIERS}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nC.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getBombTiles().length>0}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:_.sent();return[3,4];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:_.sent(),EC.event(EA.USE_ITEM,{item_name:sT.PLIERS}),this.node.scene.emit(a1.USE_ITEM,sT.PLIERS);g=Bh(this.boardInstance.getBombTiles()),E=g.node.worldPosition;this.effectManager.createDefuseExplosionAt(new em(E.x,E.y,0)),i8.playSound(ih.BOMB_DEFUSE),g.special.switch(uG.none),this.applyActivationStatus();_.label=4;case 4:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=Ek.getGameData();C&&Ek.setGameData({items:Me(Me({},C.items),{},Ge({},sT.PLIERS,_))})}}]),i}(mt));_._RF.pop(),_._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var ET=k.ccclass,ER=globalThis.game,EI=ER.player,EP=ER.analytics,EL=GameCore.Plugins.Analytics.Events;ET("StormItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){lZ.openScreen(ib.GET_ITEM_SCREEN,{item:sT.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},g.loadQuantity=function(){var g=EI.getGameData();return null!=g&&g.items&&g?g.items[sT.STORM]:0},g}return Ue(i,[{key:"itemType",get:function(){return sT.STORM}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nC.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>2}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this;if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:k.sent();return[3,6];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:if(k.sent(),EP.event(EL.USE_ITEM,{item_name:sT.STORM}),this.node.scene.emit(a1.USE_ITEM,sT.STORM),this.node.scene.emit(a1.HIDE_UI),!this.effectManager)return[3,6];return[4,tZ.waitTweenAsync(.5)];case 4:E=k.sent();return[4,Promise.race([this.effectManager.loadTornadoAnimation(),E])];case 5:if(k.sent(),this.effectManager){_=function(){var E=Be(function(E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:i8.setVolumeMusic(0,!0),i8.playSound(ih.SHUFFLE_ITEM),i8.playSound(ih.WIND);k=function(){var E=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:_.forEach(function(g,E,k){g.node.setSiblingIndex(_.asArray().length-1-(E+k*_.width))});return[4,Promise.all(_.map(function(E){return E.fly({getTilePosition:function(E){return _h(_,g.boardInstance.getTileSize(),E)}})}))];case 1:E.sent();return[2]}})});return function(){return E.apply(this,arguments)}}();return[4,Promise.all(E.map(function(_,k,C){return _.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return _h(E,g.boardInstance.getTileSize(),{x:k,y:C},10)}})}))];case 1:C.sent(),g.effectManager.playTornadoAnimation();return[4,k()];case 2:C.sent(),g.node.scene.emit(a1.SHOW_UI),i8.setVolumeMusic(.3,!0);return[2]}})});return function(g,_){return E.apply(this,arguments)}}();this.boardInstance.processShuffleRequest(_)}k.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=EI.getGameData();C&&EI.setGameData({items:Me(Me({},C.items),{},Ge({},sT.STORM,_))})}}]),i}(mt));_._RF.pop(),_._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var EO,EB,EN,EM,ED,EF,EU,Ex,Ez,EG,EV,EK,EH,Eq,EW,Ej,EX,EY,EJ=k.ccclass,EQ=globalThis.game,EZ=EQ.player,E$=EQ.analytics,E0=GameCore.Plugins.Analytics.Events;EJ("ThunderItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){lZ.openScreen(ib.GET_ITEM_SCREEN,{item:sT.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},g.loadQuantity=function(){var g=EZ.getGameData();return null!=g&&g.items&&g?g.items[sT.THUNDER]:0},g}return Ue(i,[{key:"itemType",get:function(){return sT.THUNDER}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nC.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>=4}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:_.sent();return[3,6];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:_.sent(),E$.event(E0.USE_ITEM,{item_name:sT.THUNDER}),this.node.scene.emit(a1.USE_ITEM,sT.THUNDER),this.node.scene.emit(a1.HIDE_UI);return[4,this.effectManager.loadThunderAnimation()];case 4:_.sent();g=this.boardInstance.getUncleared();if(g.length<4)return[3,6];i8.setVolumeMusic(0,!0);E=this.boardInstance.getPairs(2);ie.setBlockInput(!0),this.boardInstance.clearSelectedTile();return[4,this.effectManager.playThunderAnimation(E,this.boardInstance)];case 5:_.sent(),(g=this.boardInstance.getUncleared()).length>0&&this.node.scene.emit(a1.SHOW_UI),i8.setVolumeMusic(.3,!0),ie.setBlockInput(!1);_.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=EZ.getGameData();C&&EZ.setGameData({items:Me(Me({},C.items),{},Ge({},sT.THUNDER,_))})}}]),i}(mt));_._RF.pop(),_._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var E1,E2,E4,E3,E5,E6,E8,E9,E7,_e,_t,_n=k.ccclass,_i=k.property,_a=(EO=_n("Coin"),EB=_i(eV),EN=_i(G),EM=_i(ei),ED=_i(ei),EF=nC.onlyRunInLifeCycle,EU=nC.onlyRunInLifeCycle,Ex=nC.onlyRunInLifeCycle,Ez=nC.onlyRunInLifeCycle,EG=nC.onlyRunInLifeCycleAsync,EV=nC.onlyRunInLifeCycleAsync,EK=nC.onlyRunInLifeCycle,EO((EW=st((Eq=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"emittingParticles",EW,Ke(g)),rt(g,"animation",Ej,Ke(g)),rt(g,"spin",EX,Ke(g)),rt(g,"rest",EY,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){nC.lazyValidateProperties(this)}},{key:"resetDisabled",value:function(){this.stopParticles(),this.stopAnimation(),this.hide(),this.node.active=!1,this.node.setPosition(0,0,this.node.position.z)}},{key:"hide",value:function(){this.node.setScale(em.ZERO)}},{key:"stopParticles",value:function(){this.emittingParticles.stopSystem()}},{key:"playTrailParticles",value:function(){this.emittingParticles.resetSystem()}},{key:"playSpinAnimationAfterDelay",value:(E=Be(function(){var g,E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:g=k.length>0&&void 0!==k[0]?k[0]:0,E=k.length>1?k[1]:void 0;_=g>0;if(!_)return[3,2];return[4,tZ.waitTweenAsync(g)];case 1:_=C.sent();C.label=2;case 2:return[4,this.playSpinAnimation(E)];case 3:C.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"playSpinAnimation",value:function(g){return tZ.runAnimationAsync(this.animation,this.spin.name,g)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),i}(M)).prototype,"emittingParticles",[EB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ej=st(Eq.prototype,"animation",[EN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EX=st(Eq.prototype,"spin",[EM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EY=st(Eq.prototype,"rest",[ED],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Eq.prototype,"resetDisabled",[EF],Object.getOwnPropertyDescriptor(Eq.prototype,"resetDisabled"),Eq.prototype),st(Eq.prototype,"hide",[EU],Object.getOwnPropertyDescriptor(Eq.prototype,"hide"),Eq.prototype),st(Eq.prototype,"stopParticles",[Ex],Object.getOwnPropertyDescriptor(Eq.prototype,"stopParticles"),Eq.prototype),st(Eq.prototype,"playTrailParticles",[Ez],Object.getOwnPropertyDescriptor(Eq.prototype,"playTrailParticles"),Eq.prototype),st(Eq.prototype,"playSpinAnimationAfterDelay",[EG],Object.getOwnPropertyDescriptor(Eq.prototype,"playSpinAnimationAfterDelay"),Eq.prototype),st(Eq.prototype,"playSpinAnimation",[EV],Object.getOwnPropertyDescriptor(Eq.prototype,"playSpinAnimation"),Eq.prototype),st(Eq.prototype,"stopAnimation",[EK],Object.getOwnPropertyDescriptor(Eq.prototype,"stopAnimation"),Eq.prototype),EH=Eq))||EH);_._RF.pop(),_._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var _r,_o,_s,_l,_u,_c,_p,_f,_y,_v,_g,_m,_b,_w,_S,_E,__,_k,_C=k.ccclass,_A=k.property,_T=em.ZERO.clone().add3f(0,-100,0),_R=em.ZERO.clone().add3f(0,100,0),_I=GameCore.Utils.Number,_P=(E1=_C("CoinTextPopup"),E2=_A(P),E4=_A(eu),E3=nC.onlyRunInLifeCycle,E5=nC.onlyRunInLifeCycle,E6=nC.onlyRunInLifeCycleAsync,E8=nC.onlyRunInLifeCycleAsync,E1((_e=st((E7=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"label",_e,Ke(g)),rt(g,"uiOpacity",_t,Ke(g)),g}return Ue(o,[{key:"__preload",value:function(){nC.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(k=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:this.enableNode(),this.initializePopup(g);return[4,this.showTextPopupAnimation(E)];case 1:_.sent();return[4,this.hidePopup()];case 2:_.sent(),this.disableNode();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"enableNode",value:function(){this.node.active=!0}},{key:"disableNode",value:function(){this.node.active=!1}},{key:"initializePopup",value:function(g){var E=_I.getShortNumber(g,3);this.label.string=E,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(_T)}},{key:"hidePopup",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.node.setScale(em.ONE),this.node.setPosition(_R);return[4,tZ.runTweenAsync(z(this.uiOpacity).to(.5,{opacity:0}))];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"showTextPopupAnimation",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all([tZ.runTweenAsync(z(this.node).to(1.5,{position:_R},{easing:"sineOut"}),g),tZ.runTweenAsync(z(this.node).to(.5,{scale:em.ONE},{easing:"backOut"}),g)])];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})}]),o}(M)).prototype,"label",[E2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_t=st(E7.prototype,"uiOpacity",[E4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(E7.prototype,"disableNode",[E3],Object.getOwnPropertyDescriptor(E7.prototype,"disableNode"),E7.prototype),st(E7.prototype,"initializePopup",[E5],Object.getOwnPropertyDescriptor(E7.prototype,"initializePopup"),E7.prototype),st(E7.prototype,"hidePopup",[E6],Object.getOwnPropertyDescriptor(E7.prototype,"hidePopup"),E7.prototype),st(E7.prototype,"showTextPopupAnimation",[E8],Object.getOwnPropertyDescriptor(E7.prototype,"showTextPopupAnimation"),E7.prototype),E9=E7))||E9);_._RF.pop(),_._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var _L,_O=k.ccclass,_B=k.disallowMultiple,_N=k.property,_M=globalThis.game,_D=_M.player,_F=_M.monitorError,_U=999999999,_x=10,_z=1,_G=1,_V=(_r=_O("CoinManager"),_o=nC.required(),_s=_N(ee),_l=nC.required(),_u=_N(ee),_c=nC.required(),_p=_N(C),_f=nC.onlyRunInLifeCycleAsync,_y=nC.onlyRunInLifeCycleAsync,_v=nC.onlyRunInLifeCycleAsync,_g=nC.onlyRunInLifeCycleAsync,_m=nC.onlyRunInLifeCycleAsync,_b=nC.onlyRunInLifeCycleAsync,_r(_w=_B((_E=st((_S=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=A.call.apply(A,[this].concat(_))).coins=0,rt(g,"coinPrefab",_E,Ke(g)),rt(g,"coinTextPopup",__,Ke(g)),rt(g,"coinAnimContainer",_k,Ke(g)),g.coinObjects=[],g}return Ue(r,[{key:"onLoad",value:function(){nC.decorateComponent(this),this.getCoinsFromPlayerData(),this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(){this.updateCoins({coins:this.coins})}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(a1.ADD_COINS,this.addCoins,this),this.node.scene.on(a1.REMOVE_COINS,this.removeCoins,this),this.node.scene.on(a1.ABORT_COIN_ANIMATION,this.abortCoinAnimation,this)}},{key:"prepareCoinCollection",value:function(){for(var g=0;g<_x;g++){var E=I(this.coinPrefab);E.setParent(this.coinAnimContainer),E.setPosition(0,0),E.active=!1,this.coinObjects.push(E.getComponent(_a))}}},{key:"prepareCoinTextPopup",value:function(){var g=I(this.coinTextPopup);g.setParent(this.node),g.active=!1,this.coinTextPopupNode=g.getComponent(_P)}},{key:"handleCollectionAnim",value:(C=Be(function(g,E,_,k,C){var A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this;if(!E)return[3,2];T=this.coinObjects.slice(0,this.getShortAmount(g));if(0===T.length)return[2,(console.warn("Requested coins amount is ".concat(g,". Shortened to ").concat(this.getShortAmount(g),". No coin objects was found to animate collection.")),void(null==_F||_F.sendException(new Error("Requested coins amount is ".concat(g,". Shortened to ").concat(this.getShortAmount(g),". No coin objects was found to animate collection.")),{coins:g,animatedCoins:T.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!E,coinCollectionCount:this.coinObjects.length})))];i8.playSound(ih.COLLECT_STOCK_COINS);return[4,Promise.all([this.playCoinFlyAndexplodeAnimation(E,T,_,k,C),tZ.waitTweenAsync(_+k/2,C).then(function(){return A.animateCoinTextPopup(g,C)})])];case 1:R.sent(),C.abort();return[3,3];case 2:console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played");R.label=3;case 3:return[2]}})}),function(g,E,_,k,A){return C.apply(this,arguments)})},{key:"playCoinFlyAndexplodeAnimation",value:(k=Be(function(g,E,_,k,C){var A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this,T=_+k;return[4,Promise.all([].concat(tt(E.flatMap(function(E){E.node.active=!0,E.stopParticles();var T=[0,.5*Math.min(_,k)],R=eR.apply(void 0,T),I=_-R,P=k+R;return[A.animateCoinExplode(E.node,I,C),tZ.waitTweenAsync(I,C).then(function(){return A.animateCoinFlyBack(g,E,P,C)})]})),[tZ.waitTweenAsync(T,C).then(function(){return g.emitExplodeEffect(C)})]))];case 1:R.sent();return[2]}})}),function(g,E,_,C,A){return k.apply(this,arguments)})},{key:"animateCoinTextPopup",value:function(g,E){return this.coinTextPopupNode.show(g,E)}},{key:"animateCoinFlyBack",value:(_=Be(function(g,E,_,k){var C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:C=E.node.worldPosition.clone(),A=em.ZERO.clone(),T=g.getCoinIconWorldScale();return[4,tZ.runTweenAsync(z(E.node).to(_,{scale:T},{onStart:function(){E.playSpinAnimationAfterDelay(0,k),E.playTrailParticles()},onUpdate:function(_,k){if(void 0!==k){var T=el.cubicIn(k),R=g.getCoinIconWorldPosition();E.node.worldPosition=em.lerp(A,C,R,T)}},onComplete:function(){E.emittingParticles.stopSystem(),E.stopAnimation(),E.hide()}}),k)];case 1:R.sent();return[4,tZ.waitTweenAsync(1,k)];case 2:R.sent(),E.resetDisabled();return[2]}})}),function(g,E,k,C){return _.apply(this,arguments)})},{key:"animateCoinExplode",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=[-200,200],C=[-200,200],A=eR(k[0],k[1]),T=eR(C[0],C[1]);g.setPosition(0,0,g.position.z),g.setScale(em.ZERO);R=new em(A,T,g.position.z);return[4,Promise.all([tZ.runTweenAsync(z(g).delay(.1*E).to(.8*E,{scale:em.ONE},{easing:"elasticOut"}),_),tZ.runTweenAsync(z(g).to(E,{position:R},{easing:"circOut"}),_)])];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var g=_D.getGameData();this.coins=g?g.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(g){var E,_;if(this.coins>_U&&(this.coins=_U),g.coins!==this.coins){var k=Math.max(0,g.coins-this.coins);this.coins=g.coins,_D.setGameData({coins:this.coins});var C=g.collectionAnimation;null===(E=this.collectionAnimSignal)||void 0===E||E.abort();var A=new nM;if(this.collectionAnimSignal=A,null==C||null===(_=C.signal)||void 0===_||_.chain(A),void 0===C||C.animateTextOnly)this.node.scene.emit(a1.COIN_CHANGED,Me(Me({},g),{},{collectionAnimation:{animateTextOnly:!0,signal:null==C?void 0:C.signal}}));else{var T=C.floatDuration,R=void 0===T?_z:T,I=C.flyDuration,P=void 0===I?_G:I,L=C.target,O=void 0===L?this.targetContainer:L;this.collectionAnimSignal=A,this.targetContainer=O;var B=Me(Me({},g),{},{collectionAnimation:{floatDuration:R,flyDuration:P,animateTextOnly:!1,signal:A,target:O}});this.node.scene.emit(a1.COIN_CHANGED,B),this.handleCollectionAnim(k,this.targetContainer,R,P,A)}}}},{key:"addCoins",value:function(g){this.updateCoins(Me(Me({},g),{},{coins:this.coins+g.coins}))}},{key:"removeCoins",value:function(g){this.coins<g.coins?this.node.scene.emit(a1.REMOVE_COINS_FAILED):(this.updateCoins(Me(Me({},g),{},{coins:this.coins-g.coins})),this.node.scene.emit(a1.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(a1.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(g){return Math.min(g,_x)}},{key:"abortCoinAnimation",value:function(){var g;null===(g=this.collectionAnimSignal)||void 0===g||g.abort()}},{key:"untilFinishesCollectAnim",value:function(){return void 0===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(g){this.targetContainer=g}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var g;null===(g=this.collectionAnimSignal)||void 0===g||g.abort()}}]),r}(M)).prototype,"coinPrefab",[_o,_s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),__=st(_S.prototype,"coinTextPopup",[_l,_u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_k=st(_S.prototype,"coinAnimContainer",[_c,_p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(_S.prototype,"handleCollectionAnim",[_f],Object.getOwnPropertyDescriptor(_S.prototype,"handleCollectionAnim"),_S.prototype),st(_S.prototype,"playCoinFlyAndexplodeAnimation",[_y],Object.getOwnPropertyDescriptor(_S.prototype,"playCoinFlyAndexplodeAnimation"),_S.prototype),st(_S.prototype,"animateCoinTextPopup",[_v],Object.getOwnPropertyDescriptor(_S.prototype,"animateCoinTextPopup"),_S.prototype),st(_S.prototype,"animateCoinFlyBack",[_g],Object.getOwnPropertyDescriptor(_S.prototype,"animateCoinFlyBack"),_S.prototype),st(_S.prototype,"animateCoinExplode",[_m],Object.getOwnPropertyDescriptor(_S.prototype,"animateCoinExplode"),_S.prototype),st(_S.prototype,"untilFinishesCollectAnim",[_b],Object.getOwnPropertyDescriptor(_S.prototype,"untilFinishesCollectAnim"),_S.prototype),_w=_S))||_w)||_w);_._RF.pop(),_._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),_._RF.pop(),_._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),_._RF.pop(),_._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),_._RF.pop(),_._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),_._RF.pop(),_._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var _K,_H,_q,_W,_j,_X,_Y,_J,_Q,_Z,_$,_0=k.ccclass,_1=k.disallowMultiple,_2=GameCore,_4=_2.Events,_3=_2.Configs,_5=_2.Utils.Valid,_6=globalThis.game,_8=_6.ads,_9=_6.player,_7=_6.event;_0("BootScene")(_L=_1(_L=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).processWhenGameSdkStarted=function(){g.setupGameData(),g.processPreloadAssets()},g.processPreloadAssets=function(){g.loadCurrentPlayerTheme().catch(function(g){return console.error("loadCurrentPlayerTheme",g)})},g.handlePauseAudio=function(){_7.on(_4.VISIBILITY_HIDDEN,g.handleMuteAudio),_7.on(_4.VISIBILITY_VISIBLE,g.handleUnMuteAudio)},g.handleMuteAudio=function(){i8.muteAudio(!0)},g.handleUnMuteAudio=function(){_8.isAdFullSizeShowing()||i8.muteAudio(!1)},g}return Ue(n,[{key:"__preload",value:function(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.listenEvents()}},{key:"onLoad",value:function(){this.handlePauseAudio(),_3.Core.StartSDKAfterLoadGame||lZ.showLoadingFullScreen(sW)}},{key:"start",value:function(){this.processCrazyGamesLoadingStop()}},{key:"listenEvents",value:function(){_7.getEventEmitCount(_4.GAME_SDK_STARTED)>0?this.processWhenGameSdkStarted():_7.once(_4.GAME_SDK_STARTED,this.processWhenGameSdkStarted)}},{key:"setupGameData",value:function(){var g=_9.getGameData();if(g){var E=g.totalLevel,_=Math.max(E,400),k=Me(Me({},g),{},{totalLevel:_});_9.setGameData(k)}}},{key:"loadCurrentPlayerTheme",value:function(){var g=s8.mapOrder,E=g[0],_=_9.getGameData(),k=null==_?void 0:_.level;if(!_5.isNumber(k))return ie.loadThemeAsync(E.theme);var C,A=at(g);try{for(A.s();!(C=A.n()).done;){var T=C.value;if((k-=T.levelCount)<=0){E=T;break}}}catch(g){A.e(g)}finally{A.f()}return ie.loadThemeAsync(E.theme)}},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}}]),n}(M))||_L);_._RF.pop(),_._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var ke,kt,kn,ki,ka,kr,ko,ks,kl,ku,kc,kh,kp=k.ccclass,kd=k.property,kf=(_K=kp("RigidBodyObject"),_H=kd(K),_q=kd(eS),_W=kd(K),_j=kd(J),_K((_J=st((_Y=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"gravityScale",_J,Ke(g)),rt(g,"linearVelocity",_Q,Ke(g)),rt(g,"bounce",_Z,Ke(g)),rt(g,"simulate",_$,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(T).getComponent(R),this.uiTransform=this.node.getComponent(R)}},{key:"update",value:function(g){if(this.simulate){this.applyGravity();var E=this.node.worldPosition.clone();E.add(new em(this.linearVelocity.x*g,this.linearVelocity.y*g,0)),E=this.applyBounce(E),this.node.setWorldPosition(E)}}},{key:"applyForce",value:function(g){this.linearVelocity.add(g)}},{key:"applyGravity",value:function(){var g=new eS(0,-9.8*this.gravityScale);this.applyForce(g)}},{key:"applyBounce",value:function(g){var E=this.uiTransform.getBoundingBoxToWorld();E.yMin<0&&(g.y=E.height/2,this.linearVelocity.y*=-this.bounce),E.xMin<0&&(g.x=E.width/2,this.linearVelocity.x*=-1);var _=this.canvas.width;return E.xMax>_&&(g.x=_-E.width/2,this.linearVelocity.x*=-1),g}}]),n}(M)).prototype,"gravityScale",[_H],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_Q=st(_Y.prototype,"linearVelocity",[_q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(0,0)}}),_Z=st(_Y.prototype,"bounce",[_W],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_$=st(_Y.prototype,"simulate",[_j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_X=_Y))||_X);_._RF.pop(),_._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var ky,kv,kg,km,kb,kw,kS,kE,k_,kk,kC,kA,kT,kR,kI,kP,kL=k.ccclass,kO=k.property,kB=k.disallowMultiple,qI=function(){},kN=(ke=kL("AnimSkipOverlay"),kt=kO(eu),kn=kO(eu),ki=kO(B),ka=nC.onlyRunInLifeCycleAsync,kr=nC.onlyRunInLifeCycleAsync,ko=nC.onlyRunInLifeCycleAsync,ke(ks=kB((ku=st((kl=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"containerUIOpacity",ku,Ke(g)),rt(g,"maskUIOpacity",kc,Ke(g)),rt(g,"skipButton",kh,Ke(g)),g.isOpened=!1,g.currentCallback=qI,g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"open",value:(_=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.containerUIOpacity.node.active=!0;E=g.onSkip,_=g.opacity,k=void 0===_?255:_,C=g.transitionDuration,A=void 0===C?.2:C;this.maskUIOpacity.opacity=k;return[4,this.animateUIOpacity(0,255,A)];case 1:T.sent(),this.currentCallback=E,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(t9,g);return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"close",value:(E=Be(function(){var g;var E=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:g=E.length>0&&void 0!==E[0]?E[0]:.2;this.skipButton.interactable=!1,this.currentCallback=qI;return[4,this.animateUIOpacity(255,0,g)];case 1:_.sent(),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(t7);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"animateUIOpacity",value:function(g,E,_){return this.containerUIOpacity.opacity=g,tZ.runTweenAsync(z(this.containerUIOpacity).to(_,{opacity:E}))}},{key:"untilClosed",value:function(){var g=this;return!1===this.isOpened?Promise.resolve():new Promise(function(E){g.node.scene.once(t7,E)})}}]),a}(M)).prototype,"containerUIOpacity",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kc=st(kl.prototype,"maskUIOpacity",[kn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kh=st(kl.prototype,"skipButton",[ki],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(kl.prototype,"open",[ka],Object.getOwnPropertyDescriptor(kl.prototype,"open"),kl.prototype),st(kl.prototype,"close",[kr],Object.getOwnPropertyDescriptor(kl.prototype,"close"),kl.prototype),st(kl.prototype,"untilClosed",[ko],Object.getOwnPropertyDescriptor(kl.prototype,"untilClosed"),kl.prototype),ks=kl))||ks)||ks);_._RF.pop(),_._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var kM,kD,kF,kU,kx,kz,kG,kV,kK,kH,kq,kW,kj,kX,kY,kJ,kQ=k.ccclass,kZ=k.property,k$=GameCore.Utils.Number,k0=(ky=kQ("CoinContainer"),kv=kZ(P),kg=kZ(eo),km=kZ(eu),kb=kZ(eV),kw=nC.onlyRunInLifeCycle,kS=nC.onlyRunInLifeCycleAsync,kE=nC.onlyRunInLifeCycleAsync,k_=nC.onlyRunInLifeCycle,kk=nC.onlyRunInLifeCycle,ky((kT=st((kA=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"coinLabel",kT,Ke(g)),rt(g,"coinIcon",kR,Ke(g)),rt(g,"explosionCircle",kI,Ke(g)),rt(g,"explosionParticles",kP,Ke(g)),g.currentCoin=0,g}return Ue(o,[{key:"setCoinText",value:function(g){this.coinLabel.string=g}},{key:"handleAddCoinButton",value:function(){lZ.openScreen(ib.GET_COIN_SCREEN,{quantity:sB})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(a1.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(k=Be(function(g){var E,_,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:C=g.coins,A=g.collectionAnimation,T=g.playSound;if(!(void 0!==A&&!1!==this.node.activeInHierarchy))return[3,4];R=A.signal;if(null===(E=this.animAbortSignal)||void 0===E||E.abort(),this.animAbortSignal=null!=R?R:new nM,!A.animateTextOnly)return[3,2];return[4,this.animateCoinText(C,0,T,R)];case 1:return[2,(L.sent(),void this.setCoins(C))];case 2:I=null!==(_=A.flyDuration)&&void 0!==_?_:0,P=(null!==(k=A.floatDuration)&&void 0!==k?k:0)+I;return[4,this.animateCoinText(C,P,T,R)];case 3:L.sent(),this.setCoins(C);return[3,5];case 4:this.setCoins(C);L.label=5;case 5:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setCoins",value:function(g){this.setCoinText(k$.getShortNumber(g,3)),this.currentCoin=g}},{key:"animateCoinText",value:(_=Be(function(g,E){var _,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:_=this,k=!(T.length>2&&void 0!==T[2])||T[2],C=T.length>3?T[3]:void 0,A=this.currentCoin;return[4,tZ.waitTweenAsync(E,C)];case 1:R.sent(),k&&i8.playSound(ih.COLLECT_COINS);return[4,tZ.runOnUpdateAsync(this.node,1,function(E){var k=Math.round(A+(g-A)*E);_.setCoinText(k$.getShortNumber(k,3))},C)];case 2:R.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"emitExplodeEffect",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.initializeExplosionCircle(),this.explosionParticles.resetSystem();return[4,Promise.all([tZ.runTweenAsync(z(this.explosionCircle.node).to(.4,{scale:new em(3,3,3)},{easing:"quadOut"}),g),tZ.runTweenAsync(z(this.explosionCircle).delay(.2).to(.2,{opacity:0}),g)])];case 1:E.sent(),this.resetExplosionCircle();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"resetExplosionCircle",value:function(){this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0}},{key:"initializeExplosionCircle",value:function(){this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0)}},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var g;null===(g=this.animAbortSignal)||void 0===g||g.abort()}}]),o}(M)).prototype,"coinLabel",[kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kR=st(kA.prototype,"coinIcon",[kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kI=st(kA.prototype,"explosionCircle",[km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kP=st(kA.prototype,"explosionParticles",[kb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(kA.prototype,"setCoins",[kw],Object.getOwnPropertyDescriptor(kA.prototype,"setCoins"),kA.prototype),st(kA.prototype,"animateCoinText",[kS],Object.getOwnPropertyDescriptor(kA.prototype,"animateCoinText"),kA.prototype),st(kA.prototype,"emitExplodeEffect",[kE],Object.getOwnPropertyDescriptor(kA.prototype,"emitExplodeEffect"),kA.prototype),st(kA.prototype,"resetExplosionCircle",[k_],Object.getOwnPropertyDescriptor(kA.prototype,"resetExplosionCircle"),kA.prototype),st(kA.prototype,"initializeExplosionCircle",[kk],Object.getOwnPropertyDescriptor(kA.prototype,"initializeExplosionCircle"),kA.prototype),kC=kA))||kC);_._RF.pop(),_._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);var k1,k2=k.ccclass,k4=k.property,k3=globalThis.game.player,k5=[1e3,1500];kM=k2("ItemContainer"),kD=k4({type:C,group:"Hint"}),kF=k4({type:P,group:"Hint"}),kU=k4({type:C,group:"Thunder"}),kx=k4({type:P,group:"Thunder"}),kz=k4({type:C,group:"Storm"}),kG=k4({type:P,group:"Storm"}),kV=k4(ee),kM((kH=st((kK=function(g){ze(u,g);var E,_,k,C,A,R=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"hintNode",kH,Ke(g)),rt(g,"hintLabel",kq,Ke(g)),g.hintCollection=[],rt(g,"thunderNode",kW,Ke(g)),rt(g,"thunderLabel",kj,Ke(g)),g.thunderCollection=[],rt(g,"stormNode",kX,Ke(g)),rt(g,"stormLabel",kY,Ke(g)),g.stormCollection=[],rt(g,"itemPrefab",kJ,Ke(g)),g}return Ue(u,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(T).node,this.widget=this.getComponent(H),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents(),this.listenToEvents()}},{key:"start",value:function(){this.prepareItemCollection()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(a1.ADD_ITEMS,this.handleAddItems,this)}},{key:"prepareItemCollection",value:function(){for(var g=0;g<9;g++){var E=I(this.itemPrefab),_=I(this.itemPrefab),k=I(this.itemPrefab);E.parent=this.canvas,_.parent=this.canvas,k.parent=this.canvas,E.active=!1,_.active=!1,k.active=!1,this.hintCollection.push(E.getComponent(kf)),this.thunderCollection.push(_.getComponent(kf)),this.stormCollection.push(k.getComponent(kf))}}},{key:"updateStatus",value:function(g){var E=g.items;this.hintLabel.string="".concat(E.hint),this.thunderLabel.string="".concat(E.thunder),this.stormLabel.string="".concat(E.storm)}},{key:"show",value:(A=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.uiOpacity.opacity=255;g=z(this.widget).to(1.5,{right:0},{easing:"quadOut"});return[4,tZ.runTweenAsync(g,this.animAbortSignal)];case 1:E.sent(),this.widget.right=0;return[2]}})}),function(){return A.apply(this,arguments)})},{key:"hide",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=z(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"});return[4,tZ.runTweenAsync(g)];case 1:E.sent(),this.uiOpacity.opacity=0;return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleAddItems",value:(k=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=this;this.animAbortSignal=null!==(E=g.signal)&&void 0!==E?E:new nM;k=k3.getGameData();if(!k)return[3,3];this.updateStatus(k);C=this.show(),A=g.items.map(function(g){return _.animateItemCollection(g.item,g.quantity,1.5)});return[4,Promise.all([C].concat(tt(A)))];case 1:T.sent(),k.items=Me(Me({},k.items),{},{hint:k.items.hint+g.items[0].quantity,thunder:k.items.thunder+g.items[1].quantity,storm:k.items.storm+g.items[2].quantity}),k3.setGameData(k),this.updateStatus(k);return[4,this.hide()];case 2:T.sent();T.label=3;case 3:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"animateItemCollection",value:(_=Be(function(g,E,_){var k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:k=this,C=this.getItemCollection(g).slice(0,E);if(!(0!==C.length))return[3,2];A=C.map(function(E,C){E.node.active=!0,E.node.position=new em(0,0,E.node.position.z),E.linearVelocity=new eS(0,0),E.simulate=!0;var A=eR(Math.PI/3,2*Math.PI/3),T=eR(k5[0],k5[1])*Math.cos(A),R=eR(k5[0],k5[1])*Math.sin(A);E.applyForce(new eS(T,R));var I=k.getTargetNode(g);if(I)return E.getComponent(eo).spriteFrame=I.getComponent(eo).spriteFrame,k.getItemAnimation(E,I,_+.03*C)});return[4,Promise.all(A)];case 1:T.sent();T.label=2;case 2:return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"getItemCollection",value:function(g){switch(g){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}},{key:"getTargetNode",value:function(g){switch(g){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}},{key:"getItemAnimation",value:(E=Be(function(g,E){var _,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:_=A.length>2&&void 0!==A[2]?A[2]:0;g.node.scale=new em(2,2,2);return[4,tZ.waitTweenAsync(_,this.animAbortSignal)];case 1:T.sent();k=g.node.worldPosition.clone(),C=z(g.node).to(1,{scale:E.scale},{onUpdate:function(_,C){if(_&&C){var A=el.cubicIn(C);E&&(g.node.worldPosition=k.lerp(E.worldPosition,A))}},onComplete:function(){g.node.setPosition(0,0),g.node.active=!1}});return[4,tZ.runTweenAsync(C,this.animAbortSignal)];case 2:T.sent(),g.node.scale=E.scale.clone(),g.node.setPosition(0,0),g.node.active=!1;return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"onDestroy",value:function(){var g;null===(g=this.animAbortSignal)||void 0===g||g.abort()}}]),u}(M)).prototype,"hintNode",[kD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kq=st(kK.prototype,"hintLabel",[kF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kW=st(kK.prototype,"thunderNode",[kU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kj=st(kK.prototype,"thunderLabel",[kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kX=st(kK.prototype,"stormNode",[kz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kY=st(kK.prototype,"stormLabel",[kG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kJ=st(kK.prototype,"itemPrefab",[kV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kK));_._RF.pop(),_._RF.push({},"904917NfYBJy781QxKjEPIO","ViewNode",void 0);var k6,k8,k9,k7,Ce,Ct,Cn,Ci,Ca,Cr,Co,Cs,Cl,Cu,Cc,Ch,Cp,Cd,Cf,Cy,Cv,Cg,Cm=k.ccclass,Cb=k.requireComponent,Cw=Cm("ViewNode")(k1=Cb(eu)(k1=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).order=0,g}return Ue(n,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"setVisible",value:function(g){this.uiOpacity.opacity=g?255:0}},{key:"isVisible",value:function(){return this.uiOpacity.opacity>0}}]),n}(M))||k1)||k1;_._RF.pop(),_._RF.push({},"0b250nSw/RHRq8vKigzgfhs","ScrollViewLayout",void 0);var CS,CE,C_,Ck,CC,CA,CT,CR,CI,CP,CL,CO,CB,CN,CM,CD,CF,CU,Cx,Cz,CG,CV,CK,CH,Cq,CW,Cj,CX,CY,CJ,CQ,CZ,C$,C0,C1=k.ccclass,C2=k.property,C4=k.requireComponent,C3=GameCore.Utils.Array,C5=(k6=C1("ScrollViewLayout"),k8=C4(eK),k9=C2(R),k7=C2(K),Ce=C2(ee),Ct=C2(V),Cn=C2(V),Ci=C2(),Ca=nC.onlyRunInLifeCycleAsync,Cr=nC.onlyRunInLifeCycleAsync,Co=nC.onlyRunInLifeCycleAsync,Cs=nC.onlyRunInLifeCycle,Cl=nC.onlyRunInLifeCycle,Cu=nC.onlyRunInLifeCycle,k6(Cc=k8((Cp=st((Ch=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"viewport",Cp,Ke(g)),rt(g,"spacing",Cd,Ke(g)),rt(g,"nodePrefab",Cf,Ke(g)),rt(g,"maxNodeCount",Cy,Ke(g)),rt(g,"extendCount",Cv,Ke(g)),rt(g,"scrollView",Cg,Ke(g)),g.nodePool=[],g.recycling=!1,g.direction=0,g.oldOffset=0,g.nodeHeight=0,g.scrollSignal=new nM,g.onNodeData=function(){},g.onNodeInvisible=function(){},g}return Ue(o,[{key:"__preload",value:function(){this.scrollView=this.getComponent(eK),this.uiTransform=this.getComponent(R)}},{key:"start",value:function(){var g=I(this.nodePrefab);this.nodeHeight=g.getComponent(R).height,g.destroy(),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"init",value:function(g,E){this.createNodePool(),this.currentNodeCount=this.nodePool.length,this.topMostNodeIndex=0,this.bottomMostNodeIndex=this.nodePool.length-1,this.onNodeData=null!=g?g:this.onNodeData,this.onNodeInvisible=null!=E?E:this.onNodeInvisible;for(var _=this.viewport.getBoundingBoxToWorld(),k=_.yMax,C=_.yMin,A=0;A<this.nodePool.length;A++)if(A<this.maxNodeCount){var T=this.nodePool[A];T.setVisible(!0),this.onNodeData(T);var R=this.getNodeBoundingBoxWorld(A),I=R.top,P=R.bot;(I<C||P>k)&&(T.setVisible(!1),this.onNodeInvisible(T))}else this.nodePool[A].setVisible(!1),this.onNodeInvisible(this.nodePool[A])}},{key:"updateNodeVisibility",value:function(){for(var g=0;g<this.nodePool.length;g++)this.nodePool[g].isVisible()&&this.onNodeData(this.nodePool[g])}},{key:"listenEvents",value:function(){this.scrollView.node.on(eK.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.on(eH.TOUCH_MOVE,this.abortScrollSignal,this)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(eK.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.off(eH.TOUCH_MOVE,this.abortScrollSignal,this)}},{key:"scrollToOrder",value:(k=Be(function(g,E){var _,k,C,A,T;var R=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:_=R.length>2&&void 0!==R[2]?R[2]:2,k=this.getNodeScrollOffset(g),C=this.scrollView.getScrollOffset().y,A=(k=Math.max(k,0))-(C=Math.max(C,0));T=Math.abs(A)<5;if(T)return[3,2];return[4,this.scrollToOffset(new eS(0,k),_,E)];case 1:T=I.sent();I.label=2;case 2:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"scrollToTop",value:(_=Be(function(g){var E;var _=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:E=_.length>1&&void 0!==_[1]?_[1]:2;return[4,this.scrollToOffset(new eS(0,0),E,g)];case 1:k.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"scrollToOffset",value:(E=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=new nM;this.scrollSignal=k,this.scrollView.scrollToOffset(g,E),k.addAbortListener(this.handleScrollSignalAborted.bind(this)),_.addAbortListener(this.handleExternalSignalAborted.bind(this,g,k));return[4,tZ.waitTweenAsync(E,_)];case 1:C.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"updateVisibility",value:function(){var g=this;if(this.direction=this.scrollView.getScrollOffset().y-this.oldOffset,this.oldOffset=this.scrollView.getScrollOffset().y,!this.recycling){var E=this.viewport.getBoundingBoxToWorld(),_=E.yMax,k=E.yMin;this.nodePool.forEach(function(E,C){var A=g.getNodeBoundingBoxWorld(C),T=A.top,R=A.bot;T<k||R>_?(E.setVisible(!1),g.onNodeInvisible(E)):E.setVisible(!0)}),this.direction>0&&this.validateNodeIndex(this.bottomMostNodeIndex)&&this.getNodeBoundingBoxWorld(this.bottomMostNodeIndex).top>k?this.recycleTopToBottom():this.direction<0&&this.validateNodeIndex(this.topMostNodeIndex)&&this.getNodeBoundingBoxWorld(this.topMostNodeIndex).bot<_&&this.recycleBottomToTop()}}},{key:"createNodePool",value:function(){if(0===this.nodePool.length){var g=Math.ceil(this.viewport.height/this.nodeHeight)+1+this.extendCount;this.setMaxNodeCount(this.maxNodeCount);for(var E=0;E<g;E++){var _,k=I(this.nodePrefab);null===(_=this.scrollView.content)||void 0===_||_.addChild(k),k.setPosition(this.getNodePosition(E));var C=k.addComponent(Cw);C.order=E,this.nodePool.push(C)}}else for(var A=0;A<this.nodePool.length;A++)this.nodePool[A].order=A,this.nodePool[A].node.setPosition(this.getNodePosition(A))}},{key:"recycleTopToBottom",value:function(){for(this.recycling=!0;this.getNodeBoundingBoxWorld(this.topMostNodeIndex).bot>this.viewport.getBoundingBoxToWorld().yMax&&this.currentNodeCount<this.maxNodeCount;)this.nodePool[this.topMostNodeIndex].node.setPosition(this.getNodePosition(this.nodePool[this.bottomMostNodeIndex].order+1)),this.nodePool[this.topMostNodeIndex].order=this.nodePool[this.bottomMostNodeIndex].order+1,this.onNodeData(this.nodePool[this.topMostNodeIndex]),this.bottomMostNodeIndex=this.topMostNodeIndex,this.topMostNodeIndex=(this.topMostNodeIndex+1)%this.nodePool.length,this.currentNodeCount++;this.recycling=!1}},{key:"recycleBottomToTop",value:function(){for(this.recycling=!0;this.getNodeBoundingBoxWorld(this.bottomMostNodeIndex).top<this.viewport.getBoundingBoxToWorld().yMin&&this.currentNodeCount>this.nodePool.length;)this.nodePool[this.bottomMostNodeIndex].node.setPosition(this.getNodePosition(this.nodePool[this.topMostNodeIndex].order-1)),this.nodePool[this.bottomMostNodeIndex].order=this.nodePool[this.topMostNodeIndex].order-1,this.onNodeData(this.nodePool[this.bottomMostNodeIndex]),this.topMostNodeIndex=this.bottomMostNodeIndex,this.bottomMostNodeIndex=(this.bottomMostNodeIndex-1+this.nodePool.length)%this.nodePool.length,this.currentNodeCount--;this.recycling=!1}},{key:"updateLayout",value:function(){var g,E=at(this.getVisibleNodes());try{for(E.s();!(g=E.n()).done;){var _=g.value;_.node.setPosition(this.getNodePosition(_.order))}}catch(g){E.e(g)}finally{E.f()}}},{key:"setMaxNodeCount",value:function(g){this.maxNodeCount=g,this.scrollView.content.getComponent(R).height=(this.nodeHeight+this.spacing)*this.maxNodeCount}},{key:"getAllNodes",value:function(){return this.nodePool}},{key:"getVisibleNodes",value:function(){return this.nodePool.filter(function(g){return g.isVisible()})}},{key:"getNodePosition",value:function(g){return new em(0,-(this.nodeHeight+this.spacing)*g-this.nodeHeight/2,0)}},{key:"getNodeScrollOffset",value:function(g){return-this.getNodePosition(g).y-this.uiTransform.node.worldPosition.y-this.uiTransform.height/2+this.viewport.node.worldPosition.y}},{key:"getNodeByOrder",value:function(g){return C3.search(this.nodePool,function(E){return E.order===g})}},{key:"getNodeBoundingBoxWorld",value:function(g){var E=this.nodePool[g].node.worldPosition.y;return{top:E+this.nodeHeight/2,bot:E-this.nodeHeight/2}}},{key:"validateNodeIndex",value:function(g){return g>=0&&g<this.nodePool.length}},{key:"abortScrollSignal",value:function(){this.scrollSignal.abort()}},{key:"handleScrollSignalAborted",value:function(){this.scrollView.stopAutoScroll(),this.updateVisibility()}},{key:"handleExternalSignalAborted",value:function(g,E){E.aborted||(this.scrollView.stopAutoScroll(),this.scrollView.scrollToOffset(g,0))}}]),o}(M)).prototype,"viewport",[k9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd=st(Ch.prototype,"spacing",[k7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Cf=st(Ch.prototype,"nodePrefab",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cy=st(Ch.prototype,"maxNodeCount",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Cv=st(Ch.prototype,"extendCount",[Cn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Cg=st(Ch.prototype,"scrollView",[Ci],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Ch.prototype,"scrollToOrder",[Ca],Object.getOwnPropertyDescriptor(Ch.prototype,"scrollToOrder"),Ch.prototype),st(Ch.prototype,"scrollToTop",[Cr],Object.getOwnPropertyDescriptor(Ch.prototype,"scrollToTop"),Ch.prototype),st(Ch.prototype,"scrollToOffset",[Co],Object.getOwnPropertyDescriptor(Ch.prototype,"scrollToOffset"),Ch.prototype),st(Ch.prototype,"updateVisibility",[Cs],Object.getOwnPropertyDescriptor(Ch.prototype,"updateVisibility"),Ch.prototype),st(Ch.prototype,"handleScrollSignalAborted",[Cl],Object.getOwnPropertyDescriptor(Ch.prototype,"handleScrollSignalAborted"),Ch.prototype),st(Ch.prototype,"handleExternalSignalAborted",[Cu],Object.getOwnPropertyDescriptor(Ch.prototype,"handleExternalSignalAborted"),Ch.prototype),Cc=Ch))||Cc)||Cc);_._RF.pop(),_._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var C6,C8,C9,C7,Ae,At,An,Ai,Aa,Ar,Ao,As=k.ccclass,Al=k.property,Au=k.disallowMultiple,Ac=k.requireComponent,Ah=(CS=As("DashboardPage"),CE=Ac(H),C_=Ac(eu),Ck=nC.required(),CC=Al({type:C,displayName:"Page's container"}),CA=nC.required(),CT=nC.required(),CR=Al({type:C,displayName:"Placeholder"}),CI=nC.required(),CP=Al({displayName:"Don't create prefab",tooltip:"Tell the component to not create the prefab even if it hasn't create yet"}),CL=Al({displayName:"Darken background"}),CO=Al({type:V,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),CB=Al({displayName:"Use navbar shadow"}),CN=Al({type:V,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),CM=nC.required(),CD=nC.getComponent(eu),CF=nC.required(),CU=nC.getComponent(H),Cx=nC.onlyRunInLifeCycleAsync,Cz=nC.onlyRunInLifeCycle,CG=nC.onlyRunInLifeCycleAsync,CS(CV=Au(CV=CE(CV=C_((CH=st((CK=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",CH,Ke(g)),rt(g,"containerUIOpacity",Cq,Ke(g)),rt(g,"placeholder",CW,Ke(g)),rt(g,"placeholderUIOpacity",Cj,Ke(g)),rt(g,"hasCreated",CX,Ke(g)),g.pagePrefab=null,rt(g,"darkenBackground",CY,Ke(g)),rt(g,"backgroundOpacity",CJ,Ke(g)),rt(g,"useNavbarShadow",CQ,Ke(g)),rt(g,"navbarShadowOpacity",CZ,Ke(g)),rt(g,"uiOpacity",C$,Ke(g)),rt(g,"widgetComponent",C0,Ke(g)),g}return Ue(a,[{key:"onLoad",value:function(){this.containerUIOpacity=this.container.getComponent(eu),this.placeholderUIOpacity=this.placeholder.getComponent(eu),nC.decorateComponent(this);var g=this.container.getComponent(q);this.layoutComponents=g?[g]:[],this.widgetComponents=[this.widgetComponent].concat(tt(this.container.getComponentsInChildren(H)))}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"updateWidgets",value:function(){var g,E=at(this.widgetComponents);try{for(E.s();!(g=E.n()).done;)g.value.updateAlignment()}catch(g){E.e(g)}finally{E.f()}}},{key:"updateLayouts",value:function(){var g,E=at(this.layoutComponents);try{for(E.s();!(g=E.n()).done;)g.value.updateLayout()}catch(g){E.e(g)}finally{E.f()}}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.hasCreated;if(g)return[3,2];return[4,this.create()];case 1:g=E.sent();E.label=2;case 2:this.mountInLifeCycle();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"mountInLifeCycle",value:function(){this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,iC.trackCurrentPage(this.node.name,!0)}},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return!0}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(E=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!(this.pagePrefab&&!this.hasCreated))return[3,2];_=I(this.pagePrefab),k=_.getComponentsInChildren(H);(g=this.widgetComponents).push.apply(g,tt(k));C=_.getComponentsInChildren(q);(E=this.layoutComponents).push.apply(E,tt(C)),this.container.addChild(_);return[4,tZ.waitTweenAsync(0)];case 1:A.sent(),this.hasCreated=!0;A.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"container",[Ck,CC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cq=st(CK.prototype,"containerUIOpacity",[CA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CW=st(CK.prototype,"placeholder",[CT,CR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cj=st(CK.prototype,"placeholderUIOpacity",[CI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CX=st(CK.prototype,"hasCreated",[CP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),CY=st(CK.prototype,"darkenBackground",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),CJ=st(CK.prototype,"backgroundOpacity",[CO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),CQ=st(CK.prototype,"useNavbarShadow",[CB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),CZ=st(CK.prototype,"navbarShadowOpacity",[CN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),C$=st(CK.prototype,"uiOpacity",[CM,CD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C0=st(CK.prototype,"widgetComponent",[CF,CU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(CK.prototype,"mount",[Cx],Object.getOwnPropertyDescriptor(CK.prototype,"mount"),CK.prototype),st(CK.prototype,"mountInLifeCycle",[Cz],Object.getOwnPropertyDescriptor(CK.prototype,"mountInLifeCycle"),CK.prototype),st(CK.prototype,"create",[CG],Object.getOwnPropertyDescriptor(CK.prototype,"create"),CK.prototype),CV=CK))||CV)||CV)||CV)||CV);_._RF.pop(),_._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var Ap,Ad,Af,Ay,Av,Ag,Am,Ab,Aw,AS,AE,A_,Ak,AC,AA,AT,AR,AI=k.ccclass,AP=k.property,AL=(C6=AI("ThemeProgressBar"),C8=AP(C),C9=AP(C),C7=AP(C),Ae=AP(C),C6((Ai=st((An=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"progressBar",Ai,Ke(g)),rt(g,"progressText",Aa,Ke(g)),rt(g,"leftCap",Ar,Ke(g)),rt(g,"rightCap",Ao,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(g,E){g<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var _=this.progressBar.getComponent(ew);if(!_)throw new Error("ThemeProgressBar: progressBarComponent not found");_.progress=g/E;var k=this.progressText.getComponent(P);if(!k)throw new Error("ThemeProgressBar: progressTextComponent not found");k.string="".concat(g,"/").concat(E)}}]),n}(M)).prototype,"progressBar",[C8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa=st(An.prototype,"progressText",[C9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ar=st(An.prototype,"leftCap",[C7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ao=st(An.prototype,"rightCap",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),At=An))||At);_._RF.pop(),_._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var AO,AB,AN,AM,AD,AF,AU,Ax,Az,AG,AV,AK,AH,Aq,AW,Aj,AX,AY,AJ,AQ,AZ,A$,A0,A1,A2,A4,A3,A5=k.ccclass,A6=k.disallowMultiple,A8=k.property,A9=[50,160],A7=(Ap=A5("LockAnimator"),Ad=A8(eV),Af=A8(G),Ay=A8(ei),Av=A8(ei),Ag=A8(ei),Am=A8(sc),Ab=A8({type:V,min:0}),Ap(Aw=A6((AE=st((AS=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"floatingParticles",AE,Ke(g)),rt(g,"iconAnimation",A_,Ke(g)),rt(g,"lockClip",Ak,Ke(g)),rt(g,"unlockClip",AC,Ke(g)),rt(g,"tryToUnlockClip",AA,Ke(g)),rt(g,"trailTemplate",AT,Ke(g)),rt(g,"trailCount",AR,Ke(g)),g.trails=[],g}return Ue(o,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(k=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem();return[4,this.playAnimation(this.unlockClip.name,g)];case 1:E.sent(),this.floatingParticles.stopSystem();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var g=this;return Promise.all(this.trails.map(function(E){return tZ.runTweenAsync(g.getExplodeTrail(E))}))}},{key:"getExplodeTrail",value:function(g,E){var _=arguments.length>1&&void 0!==E?E:0,k=eR(0,2*Math.PI),C=eR(A9[0],A9[1])*Math.cos(k),A=eR(A9[0],A9[1])*Math.sin(k),T=new em(C,A,g.node.position.z),R=g.node.scale.clone();return z(g.node).delay(_).call(function(){g.node.setPosition(0,0),g.reset(),g.node.active=!0}).to(.5,{position:T.clone()},{easing:"expoOut"}).to(.5,{scale:new em(0,0,1)},{easing:"expoIn"}).call(function(){g.node.setPosition(0,0),g.node.scale=R,g.reset(),g.node.active=!1})}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var g=0;g<this.trailCount;g++){var E=I(this.trailTemplate.node);E.setParent(this.node),E.active=!1,this.trails.push(E.getComponent(sc))}}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"playAnimation",value:(_=Be(function(g,E){var _;return _ts_generator(this,function(k){_=this;return[2,null!=E&&E.aborted?Promise.resolve():new Promise(function(k){_.iconAnimation.once(G.EventType.FINISHED,function(){k()}),null==E||E.addAbortListener(function(){_.iconAnimation.off(G.EventType.FINISHED),_.iconAnimation.stop(),k()}),_.iconAnimation.play(g)})]})}),function(g,E){return _.apply(this,arguments)})},{key:"playTryToUnlockAnimation",value:(E=Be(function(){return _ts_generator(this,function(g){return[2,this.playAnimation(this.tryToUnlockClip.name)]})}),function(){return E.apply(this,arguments)})}]),o}(M)).prototype,"floatingParticles",[Ad],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A_=st(AS.prototype,"iconAnimation",[Af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ak=st(AS.prototype,"lockClip",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AC=st(AS.prototype,"unlockClip",[Av],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AA=st(AS.prototype,"tryToUnlockClip",[Ag],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AT=st(AS.prototype,"trailTemplate",[Am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AR=st(AS.prototype,"trailCount",[Ab],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Aw=AS))||Aw)||Aw);_._RF.pop(),_._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var Te,Tt,Tn,Ti,Ta,Tr,To,Ts,Tl,Tu,Tc,Th,Tp,Td=k.ccclass,Tf=k.property,Ty={progress:0,max:10,isLocked:!0,theme:s9.SUMMER,skins:["fruit"]},Tv=GameCore.Utils.Array,Tg=(AO=Td("ThemeBlock"),AB=Tf(C),AN=Tf(eu),AM=Tf(C),AD=Tf(eu),AF=Tf(A7),AU=Tf(C),Ax=Tf(eo),Az=Tf([eo]),AG=Tf(P),AV=Tf(eu),AK=Tf(eu),AH=Tf(J),Aq=nC.onlyRunInLifeCycleAsync,AO((AX=st((Aj=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"mask",AX,Ke(g)),rt(g,"nodeUIOpacity",AY,Ke(g)),rt(g,"progressBar",AJ,Ke(g)),rt(g,"backgroundUI",AQ,Ke(g)),rt(g,"lockAnimator",AZ,Ke(g)),rt(g,"themeLoadingRing",A$,Ke(g)),rt(g,"themeSprite",A0,Ke(g)),rt(g,"tileBlockIconSprite",A1,Ke(g)),rt(g,"titleLabel",A2,Ke(g)),rt(g,"titleOpacity",A4,Ke(g)),rt(g,"newTilesOpacity",A3,Ke(g)),g.signal=new nM,g.payload=Ty,g}return Ue(r,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(g){this.payload.isLocked=g,this.updateInfo()}},{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){var E=arguments.length>0&&void 0!==g?g:Ty;this.payload=E;var _=E.progress,k=E.max,C=E.isLocked,A=E.theme,T=E.skins;this.signal.abort();var R=new nM;this.signal=R,this.updateTitle(A),this.updateSkinAsync(T,R),this.updateThemeAsync(A,R);var I=this.progressBar.getComponent(AL);if(!I)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=C,this.progressBar.active=!C,this.lockAnimator.node.active=C,C||I.setProgress(_,k)}},{key:"playUnlockAnim",value:(C=Be(function(g){var E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:E=A.length>1&&void 0!==A[1]?A[1]:Ty;this.payload=Me(Me({},E),{},{isLocked:!1});_=E.progress,k=E.max,C=this.progressBar.getComponent(AL);if(!C)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,C.setProgress(_,k);return[4,this.animateUnlockedState(g)];case 1:T.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"updateTitle",value:function(g){var E=g.replace(/-/g," ").replace(/\b\w/g,function(g){return g.toUpperCase()});this.titleLabel.string="".concat(E," levels")}},{key:"updateSkinAsync",value:(k=Be(function(g,E){var _,k,C,A,T,R,I,P,L,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:_=this.tileBlockIconSprite.length,k=g.length,C=g.map(function(){var g=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,ie.loadSkinPreviewAsync(g)];case 1:return[2,E.sent()]}})});return function(E){return g.apply(this,arguments)}}());return[4,Promise.all(C)];case 1:A=N.sent();if(!E.aborted&&this.tileBlockIconSprite){if(k<=_){for(T=Math.floor(_/k),R=_%k,I=tt(Tv.fillWith(k,function(){return T})),P=0;P<R;P++)I[P]++;for(L=0,O=0;O<k;O++)for(B=0;B<I[O]&&L<_;B++,L++)this.tileBlockIconSprite[L].spriteFrame=A[O][B]}else this.tileBlockIconSprite.forEach(function(g,E){g.spriteFrame=A[E%k][0]})}return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"updateThemeAsync",value:(_=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.themeSprite.spriteFrame=null;_=ie.getAsset("".concat(nU[g],"/spriteFrame"),er);k=_;if(k)return[3,2];this.themeLoadingRing.active=!0;return[4,ie.loadThemePreviewAsync(g)];case 1:k=_=A.sent();A.label=2;case 2:C=_;if(C)return[3,4];return[4,ie.loadThemePreviewAsync(s9.SUMMER)];case 3:C=_=A.sent();A.label=4;case 4:this.themeSprite&&_&&!E.aborted&&(this.themeSprite.spriteFrame=_,this.themeLoadingRing.active=!1);return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"animateUnlockedState",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this.mask.getComponent(eu),k=this.progressBar.getComponent(eu);if(!_)throw new Error("ThemeBlock: maskUIOpacity not found");if(!k)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,_.opacity=null!==(E=_.opacity)&&void 0!==E?E:255,this.progressBar.active=!0,k.opacity=0;return[4,this.lockAnimator.unlock(g)];case 1:C.sent(),this.lockAnimator.node.active=!1;return[4,Promise.all([tZ.runTweenAsync(z(_).to(.25,{opacity:0}),g),tZ.runTweenAsync(z(k).to(.25,{opacity:255}),g)])];case 2:C.sent(),this.mask.active=!1,_.opacity=0,k.opacity=255;return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"getUITransform",value:function(){return this.uiTransform}},{key:"setVisible",value:function(g){this.nodeUIOpacity.opacity=g?255:0,this.titleOpacity.opacity=g?255:0,this.newTilesOpacity.opacity=g?255:0}}]),r}(M)).prototype,"mask",[AB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AY=st(Aj.prototype,"nodeUIOpacity",[AN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AJ=st(Aj.prototype,"progressBar",[AM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AQ=st(Aj.prototype,"backgroundUI",[AD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AZ=st(Aj.prototype,"lockAnimator",[AF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A$=st(Aj.prototype,"themeLoadingRing",[AU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A0=st(Aj.prototype,"themeSprite",[Ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A1=st(Aj.prototype,"tileBlockIconSprite",[Az],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),A2=st(Aj.prototype,"titleLabel",[AG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A4=st(Aj.prototype,"titleOpacity",[AV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A3=st(Aj.prototype,"newTilesOpacity",[AK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Aj.prototype,"isLocked",[AH],Object.getOwnPropertyDescriptor(Aj.prototype,"isLocked"),Aj.prototype),st(Aj.prototype,"updateSkinAsync",[Aq],Object.getOwnPropertyDescriptor(Aj.prototype,"updateSkinAsync"),Aj.prototype),AW=Aj))||AW);_._RF.pop(),_._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var Tm,Tb,Tw,TS,TE,T_,Tk,TC,TA,TT,TR=k.ccclass,TI=k.property,TP=globalThis.game.storage,TL=(Te=TR("CollectionsContent"),Tt=TI(rC),Tn=TI(C5),Ti=TI(ad),Ta=TI({type:K,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),Tr=nC.onlyRunInLifeCycleAsync,To=nC.onlyRunInLifeCycleAsync,Te((Tu=st((Tl=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return(g=k.call.apply(k,[this].concat(_))).animateThemeBlockUnlockIndex=null,rt(g,"panelAnimator",Tu,Ke(g)),rt(g,"themeScrollView",Tc,Ke(g)),rt(g,"contentOpacity",Th,Ke(g)),g.themeScrollViewInited=!1,g.payloads=[],g.preservedScrollPosition=new eS,rt(g,"offsetFromTopOfScrollView",Tp,Ke(g)),g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.node.scene.on(a1.HIDE_UI,this.hideContent),this.node.scene.on(a1.SHOW_UI,this.showContent),this.themeScrollView.listenEvents()}},{key:"unlistenEvents",value:function(){this.unlistenUIEvents(),this.themeScrollView.unlistenEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(a1.HIDE_UI,this.hideContent),this.node.scene.off(a1.SHOW_UI,this.showContent)}},{key:"init",value:function(g){var E=this;this.payloads=g,this.themeScrollViewInited||(this.themeScrollViewInited=!0,this.themeScrollView.init(function(g){var _=E.animateThemeBlockUnlockIndex===g.order,k=E.payloads[g.order],C=g.getComponent(Tg);C.updateInfo(Me(Me({},k),{},{isLocked:!!_||k.isLocked})),C.setVisible(!0)}))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.scrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.scrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(g){var E=this,_=TP.getStorageData("collection","animateMapPackUnlock"),k=TP.getStorageData("collection","lastMapPack");g.forEach(function(g,C){var A=g.progress,T=g.max,R=g.isLocked;if(A<T&&!R&&_&&k!==C+1)return E.animateThemeBlockUnlockIndex=C,TP.setStorageData("collection","animateMapPackUnlock",!1),void TP.setStorageData("collection","lastMapPack",C+1)})}},{key:"shouldAnimateThemeBlockUnlock",value:function(){return null!==this.animateThemeBlockUnlockIndex}},{key:"playThemeTabUnlockAnim",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.animateThemeBlockUnlockIndex)return[3,2];E=this.themeScrollView.getNodeByOrder(this.animateThemeBlockUnlockIndex);if(!(E&&E.isVisible()))return[3,2];_=E.getComponent(Tg);if(!_)return[3,2];k=la.getCollectionUnlockProgress()[this.animateThemeBlockUnlockIndex];return[4,_.playUnlockAnim(g,Me(Me({},k),{},{isLocked:!0}))];case 1:C.sent(),this.animateThemeBlockUnlockIndex=null;C.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(E=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,this.themeScrollView.scrollToOrder(g,E)];case 1:_.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}}]),a}(M)).prototype,"panelAnimator",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tc=st(Tl.prototype,"themeScrollView",[Tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Th=st(Tl.prototype,"contentOpacity",[Ti],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tp=st(Tl.prototype,"offsetFromTopOfScrollView",[Ta],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),st(Tl.prototype,"playThemeTabUnlockAnim",[Tr],Object.getOwnPropertyDescriptor(Tl.prototype,"playThemeTabUnlockAnim"),Tl.prototype),st(Tl.prototype,"scrollToCurrentUnlockingTheme",[To],Object.getOwnPropertyDescriptor(Tl.prototype,"scrollToCurrentUnlockingTheme"),Tl.prototype),Ts=Tl))||Ts);_._RF.pop(),_._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var TO,TB,TN,TM,TD,TF,TU,Tx,Tz,TG,TV,TK,TH,Tq,TW,Tj,TX,TY,TJ,TQ,TZ,T$,T0,T1,T2,T4,T3,T5,T6,T8,T9,T7,Re,Rt,Rn,Ri,Ra,Rr,Ro,Rs,Rl=(Tm=(0,k.ccclass)("CollectionsPage"),Tb=nC.required(),Tw=nC.getComponent(rp),TS=nC.onlyRunInLifeCycleAsync,TE=nC.onlyRunInLifeCycle,T_=nC.onlyRunInLifeCycleAsync,Tk=nC.onlyRunInLifeCycleAsync,Tm((TT=st((TA=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=A.call.apply(A,[this].concat(_))).payload=null,rt(g,"panelAnimationController",TT,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nC.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"setPayload",value:function(g){this.payload=g}},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(TL),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload);var g=la.getCollectionUnlockProgress();this.themeContent.updateUnlockedProgress(g)}},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent(),this.themeContent.restoreScrollPosition(),this.themeContent.listenEvents();g=tZ.runTweenAsync(z(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent(),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents();return[4,this.panelAnimationController.hideUI()];case 2:g.sent(),this.themeContent.unlistenEvents();return[2]}})}),function(){return E.apply(this,arguments)})}]),r}(Ah)).prototype,"panelAnimationController",[Tb,Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(TA.prototype,"mount",[TS],Object.getOwnPropertyDescriptor(TA.prototype,"mount"),TA.prototype),st(TA.prototype,"onMount",[TE],Object.getOwnPropertyDescriptor(TA.prototype,"onMount"),TA.prototype),st(TA.prototype,"transitionIn",[T_],Object.getOwnPropertyDescriptor(TA.prototype,"transitionIn"),TA.prototype),st(TA.prototype,"transitionOut",[Tk],Object.getOwnPropertyDescriptor(TA.prototype,"transitionOut"),TA.prototype),TC=TA))||TC);_._RF.pop(),_._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var Ru,Rc,Rp,Rf,Ry,Rv,Rg,Rm,Rb,Rw,RS,RE,R_,Rk=k.ccclass,RC=k.property,RA=k.disallowMultiple,RT=k.requireComponent,RR=GameCore.Utils.Array,RI=(TO=Rk("PageManagerItem"),TB=RC(Ah),TN=RC({type:es(nB)}),TO((TF=st((TD=Ue(function e(){Fe(this,e),rt(this,"page",TF,this),rt(this,"pageType",TU,this)})).prototype,"page",[TB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TU=st(TD.prototype,"pageType",[TN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TM=TD))||TM),RP=(Tx=Rk("PageManager"),Tz=RT(R),TG=nC.required(),TV=RC({type:eu,displayName:"Background Mask",group:"Background Mask"}),TK=RC({type:K,displayName:"Transition duration",group:"Background Mask"}),TH=RC({type:K,displayName:"Transition delay",group:"Background Mask"}),Tq=nC.required(),TW=RC({type:eu,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),Tj=RC({type:K,displayName:"Transition duration",group:"Nav Bar Shadow"}),TX=RC({type:K,displayName:"Transition delay",group:"Nav Bar Shadow"}),TY=RC({type:[RI]}),TJ=RC({type:es(nB)}),TQ=nC.required(),TZ=nC.getComponent(R),T$=nC.onlyRunInLifeCycleAsync,T0=nC.onlyRunInLifeCycleAsync,T1=nC.onlyRunInLifeCycle,T2=nC.onlyRunInLifeCycle,T4=nC.onlyRunInLifeCycle,T3=nC.onlyRunInLifeCycleAsync,T5=nC.onlyRunInLifeCycleAsync,T6=nC.onlyRunInLifeCycleAsync,Tx(T8=RA(T8=Tz((T7=st((T9=function(g){ze(h,g);var E,_,k,C,A,T,R,I,P,L=Xe(h);function h(){var g;Fe(this,h);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=L.call.apply(L,[this].concat(_)),"backgroundMask",T7,Ke(g)),rt(g,"backgroundMaskTransitionDuration",Re,Ke(g)),rt(g,"backgroundMaskTransitionDelay",Rt,Ke(g)),rt(g,"navBarShadow",Rn,Ke(g)),rt(g,"navBarShadowTransitionDuration",Ri,Ke(g)),rt(g,"navBarShadowTransitionDelay",Ra,Ke(g)),rt(g,"pageItems",Rr,Ke(g)),rt(g,"currentScreen",Ro,Ke(g)),rt(g,"uiTransform",Rs,Ke(g)),g}return Ue(h,[{key:"unmountAndHideAll",value:function(){var g=this;this.pageItems.forEach(function(E){var _=E.page;E.pageType!==g.currentScreen&&(_.unmount(),_.hide())})}},{key:"onLoad",value:function(){nC.decorateComponent(this)}},{key:"updateCollectionsContentPayload",value:function(g){var E=this.getPage(nB.collections);E&&_instanceof(E,Rl)&&E.setPayload(g)}},{key:"navigate",value:(P=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:C=g.from,A=g.to;if(!(null!==C))return[3,2];return[4,this.navigateFromPage(C,A,E,_,k)];case 1:T.sent();return[3,4];case 2:return[4,this.navigateFromNull(A,_,k)];case 3:T.sent();T.label=4;case 4:return[2]}})}),function(g,E,_,k){return P.apply(this,arguments)})},{key:"navigateFromPage",value:(I=Be(function(g,E,_,k,C){var A,T,R,I,P,L,O,B,N,M,D,F,U;return _ts_generator(this,function(x){switch(x.label){case 0:A=this,T=this.validateNavigationRequest(g,E),R=T.toPage,I=T.fromPage;this.currentScreen=E;P=this.uiTransform.width,L=this.getPageIndex(g),O=this.getPageIndex(E),B=Math.min(L,O),N=Math.max(L,O),M=(N-B)*P,D=L<O?1:-1,F=this.pageItems.slice(B,N+1);F.forEach(function(g,E){var _=g.page;_.show(),_.getWidget().enabled=!1,_.node.position=new em((E+B-L)*P,_.node.position.y,_.node.position.z)});U=!R.hasLoadedPage();U&&this.showLoadingScreen();return[4,this.mountPage(R,k)];case 1:x.sent();return[4,_.callAsync(function(){return A.performFullTransition({from:g,to:E,fromPage:I,toPage:R,distance:M,direction:D,items:F})})];case 2:x.sent(),_.call(function(){return A.cleanupPages(R,F.filter(function(g){return g.pageType!==E}))});return[4,_.callAsync(function(){return A.transitionInPage(R,C)})];case 3:x.sent(),U&&this.hideLoadingScreen();return[2]}})}),function(g,E,_,k,C){return I.apply(this,arguments)})},{key:"hideLoadingScreen",value:function(){lZ.closeLoadingScreen()}},{key:"showLoadingScreen",value:function(){lZ.showLoadingScreen()}},{key:"cleanupPages",value:function(g,E){var _=g.getWidget();_.enabled=!0,_.left=0,_.right=0,g.updateWidgets(),g.updateLayouts(),E.forEach(function(g){g.page.unmount(),g.page.hide()})}},{key:"performFullTransition",value:(R=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:E=g.from,_=g.to,k=g.fromPage,C=g.distance,A=g.direction,T=g.items,R=g.toPage;this.node.scene.emit(nL,{from:E,to:_});return[4,Promise.all([k.transitionOut(),this.transition(C,A,T),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,R.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,R.getNavbarShadow())])];case 1:I.sent();return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"mountPage",value:(T=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,g.mount()];case 1:_.sent();return[4,null==E?void 0:E(g)];case 2:_.sent();return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"validateNavigationRequest",value:function(g,E){if(g!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");var _=this.getPage(this.currentScreen),k=this.getPage(E);if(!k||!_)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");return{toPage:k,fromPage:_}}},{key:"navigateFromNull",value:(A=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=this.getPage(this.currentScreen);k.show(),this.currentScreen=g;return[4,this.mountPage(k,E)];case 1:C.sent(),this.node.scene.emit(nL,{from:null,to:g});return[4,this.transitionInPage(k,_)];case 2:C.sent();return[2]}})}),function(g,E,_){return A.apply(this,arguments)})},{key:"transitionInPage",value:(C=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,g.transitionIn()];case 1:_.sent();return[4,null==E?void 0:E(g)];case 2:_.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"getPage",value:function(g){var E=this.getPageIndex(g);return -1!==E?this.pageItems[E].page:null}},{key:"handleBackgroundMask",value:(k=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,tZ.runTweenAsync(z(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(g,{opacity:E}).start())];case 1:_.sent();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleNavBarShadow",value:(_=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,tZ.runTweenAsync(z(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(g,{opacity:E}).start())];case 1:_.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"getPageIndex",value:function(g){return RR.searchIndex(this.pageItems,function(E){return E.pageType===g})}},{key:"transition",value:(E=Be(function(g,E,_){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,Promise.all(_.map(function(_){var k=_.page;return tZ.runTweenAsync(z(k.node).to(.5,{position:new em(k.node.position.x-g*E,k.node.position.y,k.node.position.z)},{easing:el.quintInOut}))}))];case 1:k.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),h}(M)).prototype,"backgroundMask",[TG,TV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Re=st(T9.prototype,"backgroundMaskTransitionDuration",[TK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Rt=st(T9.prototype,"backgroundMaskTransitionDelay",[TH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),Rn=st(T9.prototype,"navBarShadow",[Tq,TW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ri=st(T9.prototype,"navBarShadowTransitionDuration",[Tj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Ra=st(T9.prototype,"navBarShadowTransitionDelay",[TX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),Rr=st(T9.prototype,"pageItems",[TY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ro=st(T9.prototype,"currentScreen",[TJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nB.home}}),Rs=st(T9.prototype,"uiTransform",[TQ,TZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(T9.prototype,"navigate",[T$],Object.getOwnPropertyDescriptor(T9.prototype,"navigate"),T9.prototype),st(T9.prototype,"navigateFromPage",[T0],Object.getOwnPropertyDescriptor(T9.prototype,"navigateFromPage"),T9.prototype),st(T9.prototype,"hideLoadingScreen",[T1],Object.getOwnPropertyDescriptor(T9.prototype,"hideLoadingScreen"),T9.prototype),st(T9.prototype,"showLoadingScreen",[T2],Object.getOwnPropertyDescriptor(T9.prototype,"showLoadingScreen"),T9.prototype),st(T9.prototype,"cleanupPages",[T4],Object.getOwnPropertyDescriptor(T9.prototype,"cleanupPages"),T9.prototype),st(T9.prototype,"performFullTransition",[T3],Object.getOwnPropertyDescriptor(T9.prototype,"performFullTransition"),T9.prototype),st(T9.prototype,"mountPage",[T5],Object.getOwnPropertyDescriptor(T9.prototype,"mountPage"),T9.prototype),st(T9.prototype,"navigateFromNull",[T6],Object.getOwnPropertyDescriptor(T9.prototype,"navigateFromNull"),T9.prototype),T8=T9))||T8)||T8)||T8);_._RF.pop(),_._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var RL,RO,RB,RN,RM,RD,RF=k.ccclass,RU=k.property,Rx=(Ru=RF("StarProgressBar"),Rc=RU(on),Rp=RU(P),Rf=RU(V),Ry=RU(V),Rv=RU(x),Ru((Rb=st((Rm=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"progressBar",Rb,Ke(g)),rt(g,"progressLabel",Rw,Ke(g)),rt(g,"current",RS,Ke(g)),rt(g,"total",RE,Ke(g)),rt(g,"separator",R_,Ke(g)),g}return Ue(i,[{key:"setRange",value:function(g,E){this.total=E,this.current=g,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string="".concat(this.current).concat(this.separator).concat(this.total)}},{key:"animateTo",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=this,C=Math.min(g,this.total)/this.total,A=this.current,T=1,R=z(this.progressBar).to(3,{progress:C},{easing:"quadOut",onUpdate:function(E,C){C&&(k.current=A+Math.floor((g-A)*C),null==_||_(k.current),k.current===A-T&&(T++,z(k.progressLabel.node).to(.05,{scale:new em(1.2,1.2,1.2)}).to(.05,{scale:em.ONE}).start()),k.updateProgressLabel())}});null==E||E.addAbortListener(function(){k.current=g,k.updateProgress()});return[4,tZ.runTweenAsync(R,E)];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(M)).prototype,"progressBar",[Rc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rw=st(Rm.prototype,"progressLabel",[Rp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RS=st(Rm.prototype,"current",[Rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RE=st(Rm.prototype,"total",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R_=st(Rm.prototype,"separator",[Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rg=Rm))||Rg);_._RF.pop(),_._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var Rz,RG,RV,RK,RH,Rq,RW,Rj,RX,RY,RJ,RQ=k.ccclass,RZ=k.property,R$=(RL=RQ("EventButton"),RO=RZ({type:es(El)}),RB=RZ(J),RL((RD=st((RM=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"eventType",RD,Ke(g)),g._isAvailable=!1,g}return Ue(n,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(g){this._isAvailable=g,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(nO,{type:this.eventType})}},{key:"setAnimationState",value:function(g){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),Je(Ve(n.prototype),"setAnimationState",this).call(this,g)}}]),n}(au)).prototype,"eventType",[RO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return El.STAR_CHEST}}),st(RM.prototype,"isAvailable",[RB],Object.getOwnPropertyDescriptor(RM.prototype,"isAvailable"),RM.prototype),RN=RM))||RN);_._RF.pop(),_._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var R0,R1,R2,R4,R3,R5,R6,R8,R9,R7,Ie,It,In,Ii,Ia,Ir,Io,Is,Il=k.ccclass,Iu=k.property,Ic=globalThis.game.player,Ip=(Rz=Il("DashboardHeader"),RG=Iu({type:Rx,displayName:"Progress bar",group:"Star Chest"}),RV=Iu({type:R$,displayName:"Button Component",group:"Star Chest"}),RK=Iu({type:ei,displayName:"Default Rest animation",group:"Star Chest"}),RH=Iu({type:ei,displayName:"Special Rest animation",group:"Star Chest"}),Rz((Rj=st((RW=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"starProgressBar",Rj,Ke(g)),rt(g,"chestButton",RX,Ke(g)),rt(g,"defaultRestAnimation",RY,Ke(g)),rt(g,"specialRestAnimation",RJ,Ke(g)),g.handleStarsUpdateEvent=function(E){var _,k=null!=E?E:null===(_=Ic.getGameData())||void 0===_?void 0:_.stars;void 0!==k&&(g.starProgressBar.setRange(k,20),g.updateStarChestButtonAnimation(k))},g}return Ue(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),Q.on(nR,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function(){Q.off(nR,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function(g){this.handleStarsUpdateEvent(g)}},{key:"updateStarChestButtonAnimation",value:function(g){this.chestButton.isAvailable=g>=20}},{key:"validateRequiredComponents",value:function(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}},{key:"handleClickedSettingsButton",value:function(){lZ.openScreen(ib.SETTINGS_SCREEN)}}]),n}(M)).prototype,"starProgressBar",[RG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RX=st(RW.prototype,"chestButton",[RV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RY=st(RW.prototype,"defaultRestAnimation",[RK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RJ=st(RW.prototype,"specialRestAnimation",[RH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rq=RW))||Rq);_._RF.pop(),_._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var If,Iy,Iv,Ig,Im,Ib,Iw,IS,IE,I_,Ik,IC,IA=k.ccclass,IT=k.property,IR=k.executeInEditMode,II=(R0=IA("JourneyLevelAvatar"),R1=IT({type:eo,displayName:"Avatar node"}),R2=IT(C),R4=IT(G),R3=IT(eu),R5=IT({type:ei,group:"Animation"}),R6=IT({type:ei,group:"Animation"}),R8=IT({type:ei,group:"Animation"}),R9=IT({type:er,displayName:"Avatar sprite"}),R0(R7=IR((It=st((Ie=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"sprite",It,Ke(g)),rt(g,"lockIcon",In,Ke(g)),rt(g,"animation",Ii,Ke(g)),rt(g,"opacity",Ia,Ke(g)),rt(g,"flashAnimation",Ir,Ke(g)),rt(g,"unlockAnimation",Io,Ke(g)),rt(g,"spawnAnimation",Is,Ke(g)),g}return Ue(o,[{key:"avatarSprite",get:function(){var g,E;return null!==(g=null===(E=this.sprite)||void 0===E?void 0:E.spriteFrame)&&void 0!==g?g:null},set:function(g){this.sprite&&(this.sprite.spriteFrame=g)}},{key:"playUnlockAnimation",value:(k=Be(function(){var g,E,_,k,C,A,T,R,I,P,L;return _ts_generator(this,function(O){switch(O.label){case 0:g=this.playAnimation(this.unlockAnimation),E=this.lockIcon.position.x,_=this.lockIcon.position.y,k=[45,135],C=(Math.random()*(k[1]-k[0])+k[0])*(Math.PI/180),A=this.lockIcon.position.x+150*Math.cos(C),T=this.lockIcon.position.y+150*Math.sin(C),R=_-400,I=tZ.runTweenAsync(z(this.lockIcon).delay(.3).to(.2,{position:new em(A,T,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new em(A,R,this.lockIcon.position.z)},{easing:"cubicIn"})),P=[0,360],L=tZ.runTweenAsync(z(this.lockIcon).delay(.3).to(.6,{eulerAngles:new em(0,0,Math.random()*(P[1]-P[0])*(A>E?-1:1))},{easing:"sineOut"}));return[4,Promise.all([g,I,L])];case 1:O.sent(),this.lockIcon.position=new em(E,_,this.lockIcon.position.z),this.lockIcon.eulerAngles=new em(0,0,0);return[2]}})}),function(){return k.apply(this,arguments)})},{key:"playFlashAnimation",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=this.node.position.y,_=this.playAnimation(this.flashAnimation),k=tZ.runTweenAsync(z(this.node).to(.1,{position:new em(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new em(this.node.position.x,E,this.node.position.z)},{easing:"sineIn"}),g);return[4,Promise.all([_,k])];case 1:C.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(em.ZERO)}},{key:"playAnimation",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runAnimationAsync(this.animation,g.name)];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var g=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some(function(E){return null!==E&&(E.name===g.flashAnimation.name||E.name===g.unlockAnimation.name||E.name===g.spawnAnimation.name)}))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),o}(M)).prototype,"sprite",[R1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),In=st(Ie.prototype,"lockIcon",[R2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ii=st(Ie.prototype,"animation",[R4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ia=st(Ie.prototype,"opacity",[R3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ir=st(Ie.prototype,"flashAnimation",[R5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Io=st(Ie.prototype,"unlockAnimation",[R6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Is=st(Ie.prototype,"spawnAnimation",[R8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Ie.prototype,"avatarSprite",[R9],Object.getOwnPropertyDescriptor(Ie.prototype,"avatarSprite"),Ie.prototype),R7=Ie))||R7)||R7);_._RF.pop(),_._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var IP,IL,IO,IB,IN,IM,ID,IF,IU,Ix,Iz,IG,IV,IK,IH,Iq,IW,Ij,IX,IY,IJ,IQ=k.ccclass,IZ=k.property,I$=k.executeInEditMode,I0=(If=IQ("JourneyProgressBar"),Iy=IZ(on),Iv=IZ(P),Ig=IZ(eu),Im=IZ(V),Ib=IZ(V),Iw=IZ(x),If(IS=I$((I_=st((IE=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"progressBar",I_,Ke(g)),rt(g,"progressLabel",Ik,Ke(g)),rt(g,"labelUIOpacity",IC,Ke(g)),g.currentProgress=10,g.totalProgress=10,g.labelSeparator="/",g}return Ue(i,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(g){this.labelSeparator=g,this.updateProgress()}},{key:"setRange",value:function(g,E){this.totalProgress=E;var _=g;_>E&&(_=E),this.currentProgress=_,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(E=Be(function(g){var E,_,k,C,A,T,R,I,P,L,O,B,N,M,D,F;return _ts_generator(this,function(U){switch(U.label){case 0:E=this,_=g.nextCurr,k=g.nextTotal,C=g.numberOfProgressBar,A=void 0===C?0:C,T=g.onProgressBarPassed,R=g.signal,I=_/k,P=z(this.labelUIOpacity).to(.2,{opacity:0}),L=z(this.labelUIOpacity).to(.2,{opacity:255}),O=A<1?1:Math.sqrt(A)+1,B=0===A?I:A+I,N=1,M=this.progressBar.progress,D=B,F=tZ.runOnUpdateAsync(this.node,O,function(g){var _=el.sineInOut(g),k=eL(M,D,_);E.progressBar.progress=k%1,k>N&&(N=0===k?1:Math.ceil(k),null==T||T())},R);return[4,Promise.all([tZ.runTweenAsync(P,R),F])];case 1:U.sent(),this.currentProgress=_,this.totalProgress=k,this.updateProgress();return[4,tZ.runTweenAsync(L,R)];case 2:return[2,(U.sent(),this.labelUIOpacity.opacity=255,I)]}})}),function(g){return E.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string="".concat(this.currentProgress).concat(this.separator).concat(this.totalProgress)}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(M)).prototype,"progressBar",[Iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ik=st(IE.prototype,"progressLabel",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IC=st(IE.prototype,"labelUIOpacity",[Ig],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(IE.prototype,"total",[Im],Object.getOwnPropertyDescriptor(IE.prototype,"total"),IE.prototype),st(IE.prototype,"current",[Ib],Object.getOwnPropertyDescriptor(IE.prototype,"current"),IE.prototype),st(IE.prototype,"separator",[Iw],Object.getOwnPropertyDescriptor(IE.prototype,"separator"),IE.prototype),IS=IE))||IS)||IS);_._RF.pop(),_._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var I1,I2,I4,I3,I5,I6,I8,I9,I7,Pe,Pt,Pn,Pi,Pa,Pr,Po,Ps,Pl,Pu,Pc,Pp,Pf,Py,Pv,Pg,Pm,Pb,Pw,PS,PE,P_,Pk,PC=k.ccclass,PA=k.property,PT=(IP=PC("ProgressConfiguration"),IL=PA(er),IO=PA(x),IP((IN=st((IB=Ue(function e(){Fe(this,e),rt(this,"avatar",IN,this),rt(this,"themeId",IM,this)})).prototype,"avatar",[IL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IM=st(IB.prototype,"themeId",[IO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IB)),ID=PC("JourneyProgressAnimator"),IF=PA(I0),IU=PA(C),Ix=PA(eo),Iz=PA(II),IG=PA({type:K,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),IV=nC.onlyRunInLifeCycleAsync,IK=nC.onlyRunInLifeCycle,ID((IW=st((Iq=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"progressBar",IW,Ke(g)),rt(g,"currentLevelAvatarNode",Ij,Ke(g)),rt(g,"currentLevelAvatar",IX,Ke(g)),rt(g,"nextLevelAvatar",IY,Ke(g)),rt(g,"nextLevelYOffset",IJ,Ke(g)),g.isAnimating=!1,g}return Ue(l,[{key:"setRange",value:function(g,E){this.progressBar.setRange(g,E)}},{key:"animateTo",value:(T=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.isAnimating)return[2,(console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve())];this.isAnimating=!0;_=g!==this.progressBar.current;if(!_)return[3,2];return[4,this.progressBar.animateTo({nextCurr:g,nextTotal:this.progressBar.total,signal:E})];case 1:_=k.sent();k.label=2;case 2:this.isAnimating=!1;return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"animateToNextLevel",value:(A=Be(function(g){var E,_,k,C,A,T,R,I,P,L;return _ts_generator(this,function(O){switch(O.label){case 0:E=this,_=g.nextCurr,k=g.nextTotal,C=g.mapsPassed,A=g.signal;if(!this.isAnimating)return[3,1];console.warn("JourneyProgressAnimator: animation already in progress");return[3,8];case 1:this.isAnimating=!0;T=C.length-2;if(0!==T)return[3,3];return[4,this.progressBar.animateTo({nextCurr:_,nextTotal:k,signal:A})];case 2:return[2,(O.sent(),void(this.isAnimating=!1))];case 3:return[4,this.animateTargetAvaToCenter(A)];case 4:O.sent();R=1;return[4,this.progressBar.animateTo({signal:A,nextCurr:_,nextTotal:k,numberOfProgressBar:T,onProgressBarPassed:function(){if(1===R)return E.nextLevelAvatar.playUnlockAnimation(),void(R+=1);if(R>=C.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");E.nextLevelAvatar.playFlashAnimation(A),E.setNextLevelAvatar(C[R].theme),R+=1}})];case 5:O.sent();return[4,this.animateTargetAvaToPrev(A)];case 6:O.sent();I=C[C.length-1].theme,P=C[C.length-2].theme;this.setCurrentLevelAvatar(P),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal();L=this.nextLevelAvatar;return[4,this.getSpriteFrameByThemeId(I)];case 7:L.avatarSprite=O.sent(),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1;O.label=8;case 8:return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=new em(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);return[4,tZ.runTweenAsync(z(this.nextLevelAvatar.node).to(1,{position:E},{easing:"cubicInOut"}),g)];case 1:_.sent(),this.nextLevelAvatar.node.position=E;return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this.currentLevelAvatarNode.position.clone();return[4,tZ.runTweenAsync(z(this.nextLevelAvatar.node).to(1,{position:E},{easing:"cubicInOut"}),g)];case 1:_.sent(),this.nextLevelAvatar.node.position=E;return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:(_=Be(function(g){return _ts_generator(this,function(E){return[2,ie.loadThemeThumbnailAsync(g)]})}),function(g){return _.apply(this,arguments)})},{key:"loadAndSetAvatar",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.getSpriteFrameByThemeId(g)];case 1:_=k.sent();_?this.setAvatar(_,E):console.warn("JourneyProgressAnimator: ".concat(g," is null"));return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"setAvatar",value:function(g,E){_instanceof(E,II)?E.avatarSprite=g:E.spriteFrame=g}},{key:"setCurrentLevelAvatar",value:function(g){this.loadAndSetAvatar(g,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(g){this.loadAndSetAvatar(g,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}}]),l}(M)).prototype,"progressBar",[IF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ij=st(Iq.prototype,"currentLevelAvatarNode",[IU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IX=st(Iq.prototype,"currentLevelAvatar",[Ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IY=st(Iq.prototype,"nextLevelAvatar",[Iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IJ=st(Iq.prototype,"nextLevelYOffset",[IG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),st(Iq.prototype,"loadAndSetAvatar",[IV],Object.getOwnPropertyDescriptor(Iq.prototype,"loadAndSetAvatar"),Iq.prototype),st(Iq.prototype,"setAvatar",[IK],Object.getOwnPropertyDescriptor(Iq.prototype,"setAvatar"),Iq.prototype),IH=Iq))||IH);_._RF.pop(),_._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var PR,PI,PP,PL,PO,PB,PN,PM,PD,PF=k.ccclass,PU=k.property,Px=globalThis.game,Pz=Px.storage,PG=Px.monitorError,PV=GameCore.Utils,PK=PV.Array,PH=PV.Json,Pq=(I1=PF("HomeContent"),I2=nC.required(),I4=PU({type:P,group:"Play Button"}),I3=nC.required(),I5=PU({type:B,group:"Play Button"}),I6=nC.required(),I8=PU({type:C,group:"Play Button"}),I9=nC.required(),I7=PU({type:C,group:"Play Button"}),Pe=nC.required(),Pt=PU(PT),Pn=nC.required(),Pi=PU(Ip),Pa=nC.required(),Pr=PU(eu),Po=nC.required(),Ps=PU(k0),Pl=nC.onlyRunInLifeCycleAsync,Pu=nC.onlyRunInLifeCycleAsync,Pc=nC.onlyRunInLifeCycleAsync,Pp=nC.onlyRunInLifeCycleAsync,Pf=nC.onlyRunInLifeCycleAsync,I1((Pg=st((Pv=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"playButtonLabel",Pg,Ke(g)),rt(g,"playButton",Pm,Ke(g)),rt(g,"playBackground",Pb,Ke(g)),rt(g,"hardLevelBackground",Pw,Ke(g)),rt(g,"journeyProgressAnimator",PS,Ke(g)),rt(g,"dashboardHeader",PE,Ke(g)),rt(g,"overlayDuringAnim",P_,Ke(g)),rt(g,"coinContainer",Pk,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){nC.decorateComponent(this)}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(nI)}},{key:"setPlayButton",value:function(g){var E="Level ".concat(g);this.playButtonLabel.string=E;var _=g%5==0;this.playBackground.active=!_,this.hardLevelBackground.active=_}},{key:"updateStarProgress",value:function(g){this.dashboardHeader.updateStarProgress(g)}},{key:"setUnlockProgress",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E;this.setProgress(g),this.updateCurrentMapInStorage(g,_)}},{key:"shouldPlayUnlockAnimation",value:function(){var g,E,_=Pz.getStorage("dashboard");if(null==_)return null==PG||PG.sendException(new Error("DashboardScene: dashboardStorage not found")),!1;if(!(null!==(g=_.animateToCurrentLevel)&&void 0!==g&&g))return!1;var k=Pz.getStorage("tournament");if(null==k)return null==PG||PG.sendException(new Error("DashboardScene: tournamentStorage not found")),!1;if(null!==(E=k.animateTournamentLeader)&&void 0!==E&&E)return!1;var C=_.lastMapPayload,A=la.getCurrentMapProgress();return PH.encode(C)!==PH.encode(A)&&!(PK.searchIndex(s8.mapOrder,function(g){return g.id===C.id})>PK.searchIndex(s8.mapOrder,function(g){return g.id===A.id}))}},{key:"playUnlockProgressAnimation",value:function(g){var E=Pz.getStorage("dashboard");if(null==E)throw new Error("DashboardScene: dashboardStorage not found");var _=E.lastMapPayload,k=la.getCurrentMapProgress(),C=PK.searchIndex(s8.mapOrder,function(g){return g.id===_.id}),A=PK.searchIndex(s8.mapOrder,function(g){return g.id===k.id}),T=s8.mapOrder.slice(C,A+2);return _.id===k.id?this.playUnlockProgressAnimationOnly(k,_,g):this.playUnlockProgressAndPackAnimation(_,k,T,g)}},{key:"playUnlockProgressAndPackAnimation",value:(C=Be(function(g,E,_,k){return _ts_generator(this,function(C){switch(C.label){case 0:this.setProgress(Me({},g)),this.updateCurrentMapInStorage(Me({},E),!0),this.playButton.interactable=!1;return[4,this.showOwnOverlay(k)];case 1:C.sent();return[4,this.journeyProgressAnimator.animateToNextLevel({nextCurr:E.progress,nextTotal:E.max,mapsPassed:_,signal:k})];case 2:C.sent();return[4,this.hideOwnOverlay(k)];case 3:C.sent(),this.playButton.interactable=!0;return[2]}})}),function(g,E,_,k){return C.apply(this,arguments)})},{key:"playUnlockProgressAnimationOnly",value:(k=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:this.setProgress(Me(Me({},g),{},{progress:E.progress})),this.updateCurrentMapInStorage(Me({},g),!0);k=g.progress;return[4,this.showOwnOverlay(_)];case 1:C.sent();return[4,this.journeyProgressAnimator.animateTo(k,_)];case 2:C.sent();return[4,this.hideOwnOverlay(_)];case 3:C.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"hideOwnOverlay",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runTweenAsync(z(this.overlayDuringAnim).to(.3,{opacity:0}),g)];case 1:E.sent(),this.overlayDuringAnim.opacity=0;return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"showOwnOverlay",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runTweenAsync(z(this.overlayDuringAnim).to(.3,{opacity:150}),g)];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setProgress",value:function(g){var E=g.currentTheme,_=g.nextTheme,k=g.progress,C=g.max;this.journeyProgressAnimator.setCurrentLevelAvatar(E),this.journeyProgressAnimator.setNextLevelAvatar(null!=_?_:E),this.journeyProgressAnimator.setRange(k,C)}},{key:"updateCurrentMapInStorage",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=Pz.getStorage("dashboard");if(null!=k){var C=k.animateToCurrentLevel;Pz.setStorageData("dashboard","animateToCurrentLevel",!_&&C),Pz.setStorageData("dashboard","lastMapPayload",g)}else null==PG||PG.sendException(new Error("DashboardScene: dashboardStorage not found"))}}]),r}(M)).prototype,"playButtonLabel",[I2,I4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm=st(Pv.prototype,"playButton",[I3,I5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pb=st(Pv.prototype,"playBackground",[I6,I8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pw=st(Pv.prototype,"hardLevelBackground",[I9,I7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PS=st(Pv.prototype,"journeyProgressAnimator",[Pe,Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PE=st(Pv.prototype,"dashboardHeader",[Pn,Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P_=st(Pv.prototype,"overlayDuringAnim",[Pa,Pr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pk=st(Pv.prototype,"coinContainer",[Po,Ps],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Pv.prototype,"playUnlockProgressAnimation",[Pl],Object.getOwnPropertyDescriptor(Pv.prototype,"playUnlockProgressAnimation"),Pv.prototype),st(Pv.prototype,"playUnlockProgressAndPackAnimation",[Pu],Object.getOwnPropertyDescriptor(Pv.prototype,"playUnlockProgressAndPackAnimation"),Pv.prototype),st(Pv.prototype,"playUnlockProgressAnimationOnly",[Pc],Object.getOwnPropertyDescriptor(Pv.prototype,"playUnlockProgressAnimationOnly"),Pv.prototype),st(Pv.prototype,"hideOwnOverlay",[Pp],Object.getOwnPropertyDescriptor(Pv.prototype,"hideOwnOverlay"),Pv.prototype),st(Pv.prototype,"showOwnOverlay",[Pf],Object.getOwnPropertyDescriptor(Pv.prototype,"showOwnOverlay"),Pv.prototype),Py=Pv))||Py);_._RF.pop(),_._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var PW,Pj,PX,PY,PJ,PQ,PZ,P$,P0,P1,P2,P4,P3,P5,P6,P8,P9,P7,Le,Lt,Ln,Li,La,Lr,Lo,Ls,Ll,Lu,Lc,Lp,Lf,Ly,Lv,Lg=k.ccclass,Lm=k.property,Lb=GameCore.Utils.Array,Lw=(PR=Lg("NavManager"),PI=Lm(C),PP=Lm(C),PL=Lm(t2),PR((PN=st((PB=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"selectorNode",PN,Ke(g)),rt(g,"selectedButtonNode",PM,Ke(g)),rt(g,"autoLayout",PD,Ke(g)),g.navButtons=[],g.isNavigating=!1,g}return Ue(s,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var g;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(g=this.selectedButtonNode)||void 0===g?void 0:g.getComponentInChildren("NavButton"),nC.lazyValidateProperties(this)}},{key:"select",value:(A=Be(function(g){var E;return _ts_generator(this,function(_){E=this;if(!this.isNavigating){if(!Lb.has(this.navButtons,g))throw new Error("NavManager: Button not found");if(g!==this.selectedButton){if(!g.isWIP)return[2,(this.isNavigating=!0,this.node.scene.emit(nP,{from:this.selectedButton.buttonType,to:g.buttonType}),new Promise(function(_){E.node.scene.once(nL,function(){var k=E.selectedButton.deselect();E.autoLayout.selectedIndex=E.navButtons.indexOf(g),E.selectedButton=g;var C=E.autoLayout.getSelectedWorldX()-g.getSelectedWorldDistanceX(),A=E.playSelectorAnimation(C),T=g.select();Promise.all([k,T,A]).then(function(){E.isNavigating=!1,_()})})}))];this.handleWIPButton()}}return[2]})}),function(g){return A.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(C=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=this.isNavigating;if(E)return[3,4];if(!Lb.has([nB.store],g.buttonType))return[3,1];_=this.handleWIPButton();return[3,3];case 1:return[4,this.select(g)];case 2:_=k.sent();k.label=3;case 3:E=_;k.label=4;case 4:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"selectByType",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=Lb.search(this.navButtons,function(E){return E.buttonType===g});if(!E)throw new Error("NavManager: Button not found");return[4,this.selectUsingSceneTransition(E)];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"handleWIPButton",value:function(){lZ.openScreen(ib.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){g=this;if(!this.currentButton||!Lb.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");E=this.currentButton.buttonType;return[2,(this.node.scene.emit(nP,{from:null,to:E}),new Promise(function(E){g.node.scene.once(nL,function(){g.autoLayout.selectedIndex=g.navButtons.indexOf(g.currentButton);var _=g.navButtons.map(function(E){return E===g.currentButton?E.select(!1):E.deselect(!1,!0)}),k=g.autoLayout.getSelectedWorldX()-g.currentButton.getSelectedWorldDistanceX();g.selectorNode.worldPosition=new em(k,g.selectorNode.worldPosition.y,0),Promise.all(_).then(function(){E()})})}))]})}),function(){return _.apply(this,arguments)})},{key:"playSelectorAnimation",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=new em(1,1,1),k=this.selectorNode.worldPosition.clone(),C=new em(1.2*_.x,.8*_.y,1);return[4,tZ.runTweenAsync(z(this.selectorNode).to(.3,{worldPosition:new em(g,k.y,0)},{easing:"quintInOut",onUpdate:function(g,k){if(void 0!==k){var A=E.calculateCurrentSquashScale(_,C,k);E.selectorNode.scale=A}}}))];case 1:A.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setIgnoreInput",value:function(g){var E,_=!(arguments.length>0&&void 0!==g)||g,k=at(this.navButtons);try{for(k.s();!(E=k.n()).done;){var C=E.value,A=C.getComponentInChildren(B);A&&(A.interactable=!_)}}catch(g){k.e(g)}finally{k.f()}}},{key:"calculateCurrentSquashScale",value:function(g,E,_){var k=this.splitIntoSquashRatio(_);return g.clone().lerp(E,k)}},{key:"splitIntoSquashRatio",value:function(g){return g<.5?2*g:1-2*(g-.5)}}]),s}(M)).prototype,"selectorNode",[PI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PM=st(PB.prototype,"selectedButtonNode",[PP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PD=st(PB.prototype,"autoLayout",[PL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PO=PB))||PO);_._RF.pop(),_._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var LS,LE,L_,Lk,LC,LA,LT,LR,LI,LP,LL,LO,LB=k.ccclass,LN=k.disallowMultiple,LM=k.property,LD=globalThis.game,LF=LD.event,LU=LD.storage,Lx=LD.player,Lz=LD.leaderboard,LG=GameCore,LV=LG.Events,LK=LG.Match.Modes,LH=LG.Configs.DailyRewards,Lq=LG.Utils,LW=Lq.Time,Lj=Lq.Array;PW=LB("DashboardScene"),Pj=nC.required(),PX=LM(_V),PY=nC.required(),PJ=LM(Lw),PQ=nC.required(),PZ=LM(is),P$=nC.required(),P0=LM(RP),P1=nC.required(),P2=LM(kN),P4=nC.onlyRunInLifeCycle,P3=nC.onlyRunInLifeCycle,P5=nC.onlyRunInLifeCycleAsync,P6=nC.onlyRunInLifeCycleAsync,P8=nC.onlyRunInLifeCycleAsync,P9=nC.onlyRunInLifeCycleAsync,P7=nC.onlyRunInLifeCycle,Le=nC.onlyRunInLifeCycleAsync,Lt=nC.onlyRunInLifeCycleAsync,Ln=nC.onlyRunInLifeCycleAsync,Li=nC.onlyRunInLifeCycleAsync,La=nC.onlyRunInLifeCycleAsync,Lr=nC.onlyRunInLifeCycleAsync,Lo=nC.onlyRunInLifeCycleAsync,Ls=nC.onlyRunInLifeCycle,PW(Ll=LN((Lc=st((Lu=function(g){ze(v,g);var E,_,k,C,A,T,R,I,P,L,O,B,N,M,D=Xe(v);function v(){var g;Fe(this,v);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=D.call.apply(D,[this].concat(_)),"coinManager",Lc,Ke(g)),rt(g,"navManager",Lp,Ke(g)),rt(g,"bgComp",Lf,Ke(g)),rt(g,"pageManager",Ly,Ke(g)),rt(g,"pageAnimSkipOverlay",Lv,Ke(g)),g.firstNavigation=!0,g.isFirstNavToCollections=!0,g.isFirstNavToTournament=!0,g.navigationSignal=null,g.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch(function(g){console.warn("subscribeBotAsync",g)})},g.playBgAnim=Be(function(){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=LU.getStorage("dashboard");if(null==_)throw new Error("DashboardScene: dashboardStorage not found");k=null!==(E=_.animateToCurrentLevel)&&void 0!==E&&E,C=Me({},_.lastMapPayload),A=la.getCurrentMapProgress(),T=C.currentTheme===A.currentTheme&&C.nextTheme===A.nextTheme,R=A.currentTheme;if(!(k&&!T))return[3,5];return[4,tZ.waitTweenAsync(2)];case 1:I.sent();I.label=2;case 2:I.trys.push([2,4,,5]);return[4,g.bgComp.animateToNextTheme(R)];case 3:I.sent();return[3,5];case 4:I.sent();return[3,5];case 5:return[2]}})}),g}return Ue(v,[{key:"__preload",value:function(){}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(nP,this.onNavigate,this)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(nI,this.handlePlayButtonPress,this),this.node.scene.on(nO,this.handleEventButtonPress,this)}},{key:"onLoad",value:function(){nC.decorateComponent(this),this.listenNavigationEvents(),this.listenDashboardEvents(),this.coinManager.init(),la.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(la.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var g,E=(null!==(g=Lx.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;_=0===_?1:_,Lx.setGameData({level:_})}},{key:"start",value:function(){Lx.getPlayerSetting("music")&&this.updateMusic(),this.playBgAnim(),this.navManager.selectDefaultNavBtn(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadScenes",value:function(){lM.preloadGameScene()}},{key:"initBgComp",value:function(){var g,E=LU.getStorage("dashboard");if(null==E)throw new Error("DashboardScene: dashboardStorage not found");var _=null!==(g=E.animateToCurrentLevel)&&void 0!==g&&g,k=Me({},E.lastMapPayload),C=la.getCurrentMapProgress(),A=k.currentTheme===C.currentTheme&&k.nextTheme===C.nextTheme,T=C.currentTheme;_&&!A?this.bgComp.setCurrentTheme(k.currentTheme):this.bgComp.setCurrentTheme(T)}},{key:"handlePlayButtonPress",value:(M=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:T.trys.push([0,3,,4]);E=la.getCurrentMapProgress(),_=(null!==(g=Lx.getGameData())&&void 0!==g?g:{}).level,k=void 0===_?1:_;return[4,lw.setMatchCustomDataAsync({level:k})];case 1:T.sent();return[4,lw.startMatchAsync(LK.SINGLE)];case 2:T.sent(),this.updateCurrentMapInStorage(E),LU.setStorageData("collection","lastMapPack",E.id),LU.setStorageData("collection","animateMapPackUnlock",!1);C=LU.getStorage("leaderboard_content").lastTabOpened;this.getPlayerLeader(C).then(function(g){if(g){var E=g.score;LU.setStorageData("leaderboard_content","previousScore",E)}}),lM.switchScene(sj,{level:k});return[3,4];case 3:A=T.sent();return[2,void console.error(A)];case 4:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"getPlayerLeader",value:(N=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E="global"===g?sz:sG;if(!E)return[2,null];_=Lx.getPlayerId();return[4,Lz.getLeadersByPlayerIdsAsync(E,[_])];case 1:k=C.sent();return[2,0===k.length?null:k[0]]}})}),function(g){return N.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(g){LU.setStorageData("dashboard","animateToCurrentLevel",!1),LU.setStorageData("dashboard","lastMapPayload",g)}},{key:"updateMusic",value:(B=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=i8.getCurrentMusic()!==ih.BG_MUSIC;if(!g)return[3,3];return[4,i8.setVolumeMusic(0,!0)];case 1:E.sent();return[4,tZ.waitTweenAsync(1)];case 2:g=E.sent();E.label=3;case 3:i8.playMusic(ih.BG_MUSIC),i8.turnUpMusic();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"checkDailyRewardsOpenable",value:function(){var g=Lx.getPlayerData().dailyRewarded,E=g.logDays,_=void 0===E?[]:E,k=g.lastRewarded,C=void 0===k?0:k;if(_.length>LH.MaxDays)return!0;if(LH.MockTime>0&&Date.now()-C>=1e3*LH.MockTime)return!0;return!LW.isToday(C)}},{key:"onNavigate",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=(this.firstNavigation&&(this.firstNavigation=!1,this.pageManager.unmountAndHideAll()),g.to);switch(E){case nB.store:return[3,1];case nB.collections:return[3,2];case nB.tournaments:return[3,5];case nB.leaderboard:return[3,5];case nB.home:return[3,7]}return[3,9];case 1:return[3,10];case 2:return[4,this.triggerPageNavigation(g)];case 3:_.sent();return[4,this.handleLogicAfterNavigateToCollections()];case 4:_.sent(),this.cleanupAfterPageNavigation();return[3,10];case 5:return[4,this.triggerPageNavigation(g)];case 6:_.sent(),this.cleanupAfterPageNavigation();return[3,10];case 7:return[4,this.handleNavigateToHome(g)];case 8:_.sent();return[3,10];case 9:throw new Error("DashboardScene: Unhandled page name");case 10:return[2]}})}),function(g){return O.apply(this,arguments)})},{key:"handleLogicAfterNavigateToCollections",value:(L=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=null===(g=this.pageManager.getPage(nB.collections))||void 0===g?void 0:g.getContainer().getComponentInChildren(TL);if(null==E)throw new Error("CollectionsContent not found");_=new nM,k=E.shouldAnimateThemeBlockUnlock();C=k;if(!C)return[3,2];return[4,this.openSkipOverlay(_)];case 1:C=T.sent();T.label=2;case 2:return[4,this.tryPlayScrollToCollectionAnim(E,_)];case 3:T.sent();return[4,E.playThemeTabUnlockAnim(_)];case 4:T.sent();A=k;if(!A)return[3,6];return[4,this.closeSkipOverlay()];case 5:A=T.sent();T.label=6;case 6:_.abort();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"closeSkipOverlay",value:(P=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.pageAnimSkipOverlay.close()];case 1:g.sent();return[2]}})}),function(){return P.apply(this,arguments)})},{key:"openSkipOverlay",value:(I=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,this.pageAnimSkipOverlay.open({onSkip:function(){return g.abort()},opacity:200})];case 1:E.sent();return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"tryPlayScrollToCollectionAnim",value:(R=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=la.getCurrentUnlockingThemeIndex();k=this.isFirstNavToCollections&&null!==_;if(!k)return[3,2];return[4,g.scrollToCurrentUnlockingTheme(_,E)];case 1:k=(C.sent(),this.isFirstNavToCollections=!1);C.label=2;case 2:return[2]}})}),function(g,E){return R.apply(this,arguments)})},{key:"cleanupAfterPageNavigation",value:function(){this.navManager.setIgnoreInput(!1)}},{key:"triggerPageNavigation",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:null===(E=this.navigationSignal)||void 0===E||E.abort(),this.navigationSignal=new nM;return[4,this.pageManager.navigate(g,this.navigationSignal)];case 1:_.sent();return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"handleNavigateToHome",value:(A=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=this;null===(E=this.navigationSignal)||void 0===E||E.abort(),this.navigationSignal=new nM;return[4,this.pageManager.navigate(g,this.navigationSignal,Be(function(){return _ts_generator(this,function(g){_.initializeHomepageCoinManager();return[2]})}))];case 1:k.sent();return[4,this.handleLogicAfterNavigateToHome()];case 2:k.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"handleLogicAfterNavigateToHome",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.tryOpenDailyRewardsScreen()];case 1:g.sent(),this.attemptCallSubscribeBot();return[4,this.waitUntilCoinManagerFinishesAnyAnimation()];case 2:g.sent();return[4,this.waitUntilPageAnimSkipOverlayCloses()];case 3:g.sent();return[4,this.tryNavigateToTournament()];case 4:g.sent();return[4,this.tryPlayLevelUpAnimation()];case 5:g.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"waitUntilCoinManagerFinishesAnyAnimation",value:function(){return this.coinManager.untilFinishesCollectAnim()}},{key:"waitUntilPageAnimSkipOverlayCloses",value:function(){return this.pageAnimSkipOverlay.untilClosed()}},{key:"tryNavigateToTournament",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if(!LU.getStorage("tournament").animateTournamentLeader)return[3,2];return[4,this.navManager.selectByType(nB.tournaments)];case 1:return[2,g.sent()];case 2:if(!this.isFirstNavToTournament)return[3,8];this.isFirstNavToTournament=!1;g.label=3;case 3:g.trys.push([3,7,,8]);if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");return[4,GameSDK.getTournamentAsync()];case 4:if(!(g.sent().getEndTime()<Date.now()/1e3))return[3,6];return[4,this.navManager.selectByType(nB.tournaments)];case 5:return[2,g.sent()];case 6:return[3,8];case 7:g.sent();return[3,8];case 8:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"tryPlayLevelUpAnimation",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:E=this,_=null===(g=this.pageManager.getPage(nB.home))||void 0===g?void 0:g.getContainer().getComponentInChildren(Pq);if(null==_)throw new Error("DashboardScene: Homepage not found");k=new nM;k.chain(this.navigationSignal);C=_.shouldPlayUnlockAnimation(),A=this.shouldPlayPackUnlockAnimation();T=C;if(!T)return[3,7];R=A;if(!R)return[3,2];return[4,this.pageAnimSkipOverlay.open({onSkip:function(){return k.abort()},opacity:150})];case 1:R=P.sent();P.label=2;case 2:return[4,_.playUnlockProgressAnimation(k)];case 3:P.sent();I=A;if(!I)return[3,6];return[4,this.pageAnimSkipOverlay.close()];case 4:P.sent();return[4,k.callAsync(function(){return E.navManager.selectByType(nB.collections)})];case 5:I=P.sent();P.label=6;case 6:T=I;P.label=7;case 7:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"shouldPlayPackUnlockAnimation",value:function(){var g=LU.getStorage("dashboard");if(null==g)throw new Error("DashboardScene: dashboardStorage not found");var E=g.lastMapPayload,_=la.getCurrentMapProgress();return Lj.searchIndex(s8.mapOrder,function(g){return g.id===E.id})!==Lj.searchIndex(s8.mapOrder,function(g){return g.id===_.id})}},{key:"initializeHomepageCoinManager",value:function(){var g,E=null===(g=this.pageManager.getPage(nB.home))||void 0===g?void 0:g.getContainer().getComponentInChildren(Pq);if(null==E)throw new Error("DashboardScene: Homepage not found");this.coinManager.setTargetContainer(E.getCoinContainer()),this.coinManager.emitCoinAmount()}},{key:"tryOpenDailyRewardsScreen",value:(E=Be(function(){return _ts_generator(this,function(g){if(this.checkDailyRewardsOpenable())return[2,(lZ.openScreen(ib.DAILY_REWARDS_SCREEN),new Promise(function(g){LF.on(LV.CLOSED_SCREEN,function t(E){E.screenName===iw[ib.DAILY_REWARDS_SCREEN]&&(g(),LF.off(LV.CLOSED_SCREEN,t))})}))];return[2]})}),function(){return E.apply(this,arguments)})},{key:"handleEventButtonPress",value:function(g){switch(g.type){case El.STAR_CHEST:lZ.openScreen(ib.STAR_CHEST_SCREEN);break;case El.BALLOON:lZ.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}}}]),v}(M)).prototype,"coinManager",[Pj,PX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lp=st(Lu.prototype,"navManager",[PY,PJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lf=st(Lu.prototype,"bgComp",[PQ,PZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ly=st(Lu.prototype,"pageManager",[P$,P0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lv=st(Lu.prototype,"pageAnimSkipOverlay",[P1,P2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Lu.prototype,"preloadScenes",[P4],Object.getOwnPropertyDescriptor(Lu.prototype,"preloadScenes"),Lu.prototype),st(Lu.prototype,"initBgComp",[P3],Object.getOwnPropertyDescriptor(Lu.prototype,"initBgComp"),Lu.prototype),st(Lu.prototype,"handlePlayButtonPress",[P5],Object.getOwnPropertyDescriptor(Lu.prototype,"handlePlayButtonPress"),Lu.prototype),st(Lu.prototype,"onNavigate",[P6],Object.getOwnPropertyDescriptor(Lu.prototype,"onNavigate"),Lu.prototype),st(Lu.prototype,"handleLogicAfterNavigateToCollections",[P8],Object.getOwnPropertyDescriptor(Lu.prototype,"handleLogicAfterNavigateToCollections"),Lu.prototype),st(Lu.prototype,"tryPlayScrollToCollectionAnim",[P9],Object.getOwnPropertyDescriptor(Lu.prototype,"tryPlayScrollToCollectionAnim"),Lu.prototype),st(Lu.prototype,"cleanupAfterPageNavigation",[P7],Object.getOwnPropertyDescriptor(Lu.prototype,"cleanupAfterPageNavigation"),Lu.prototype),st(Lu.prototype,"triggerPageNavigation",[Le],Object.getOwnPropertyDescriptor(Lu.prototype,"triggerPageNavigation"),Lu.prototype),st(Lu.prototype,"handleNavigateToHome",[Lt],Object.getOwnPropertyDescriptor(Lu.prototype,"handleNavigateToHome"),Lu.prototype),st(Lu.prototype,"waitUntilCoinManagerFinishesAnyAnimation",[Ln],Object.getOwnPropertyDescriptor(Lu.prototype,"waitUntilCoinManagerFinishesAnyAnimation"),Lu.prototype),st(Lu.prototype,"waitUntilPageAnimSkipOverlayCloses",[Li],Object.getOwnPropertyDescriptor(Lu.prototype,"waitUntilPageAnimSkipOverlayCloses"),Lu.prototype),st(Lu.prototype,"tryNavigateToTournament",[La],Object.getOwnPropertyDescriptor(Lu.prototype,"tryNavigateToTournament"),Lu.prototype),st(Lu.prototype,"tryPlayLevelUpAnimation",[Lr],Object.getOwnPropertyDescriptor(Lu.prototype,"tryPlayLevelUpAnimation"),Lu.prototype),st(Lu.prototype,"tryOpenDailyRewardsScreen",[Lo],Object.getOwnPropertyDescriptor(Lu.prototype,"tryOpenDailyRewardsScreen"),Lu.prototype),st(Lu.prototype,"handleEventButtonPress",[Ls],Object.getOwnPropertyDescriptor(Lu.prototype,"handleEventButtonPress"),Lu.prototype),Ll=Lu))||Ll);_._RF.pop(),_._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var LX,LY=k.ccclass,LJ=k.property,LQ=globalThis.game,LZ=LQ.player,L$=LQ.storage,L0=LQ.monitorError,L1=GameCore.Utils.Number;LS=LY("HomePage"),LE=nC.required(),L_=LJ({type:P,group:"Placeholders"}),Lk=nC.required(),LC=nC.getComponent(rp),LA=nC.onlyRunInLifeCycleAsync,LT=nC.onlyRunInLifeCycle,LR=nC.onlyRunInLifeCycleAsync,LI=nC.onlyRunInLifeCycleAsync,LS((LL=st((LP=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"coinLabel",LL,Ke(g)),rt(g,"panelAnimationController",LO,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nC.decorateComponent(this)}},{key:"onEnable",value:function(){this.node.scene.on(a1.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"onDisable",value:function(){this.node.scene.off(a1.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"updatePlaceholderCoins",value:(C=Be(function(g){return _ts_generator(this,function(E){this.coinLabel.string=L1.getShortNumber(g.coins,3);return[2]})}),function(g){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){var g,E,_;if(!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(Pq),!this.homeContent))throw new Error("HomePage: homeContent not found");var k=LZ.getGameData(),C=null!==(g=null==k?void 0:k.coins)&&void 0!==g?g:0;this.updatePlaceholderCoins({coins:C});var A=null!==(E=null==k?void 0:k.level)&&void 0!==E?E:1;this.homeContent.setPlayButton(A);var T=null!==(_=null==k?void 0:k.stars)&&void 0!==_?_:0;this.homeContent.updateStarProgress(T),this.initUnlockProgressData()}},{key:"initUnlockProgressData",value:function(){var g=this.homeContent.shouldPlayUnlockAnimation(),E=Me({},la.getCurrentMapProgress()),_=L$.getStorage("dashboard");if(null==_)return null==L0||L0.sendException(new Error("DashboardScene: dashboardStorage not found")),void(g||this.homeContent.setUnlockProgress(E));var k=Me({},_.lastMapPayload);g?this.homeContent.setUnlockProgress(k):this.homeContent.setUnlockProgress(E)}},{key:"transitionIn",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:g.sent();return[4,this.panelAnimationController.showUI()];case 2:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent();return[4,this.panelAnimationController.hideUI()];case 2:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hasLoadedPage",value:function(){return!0}}]),r}(Ah)).prototype,"coinLabel",[LE,L_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LO=st(LP.prototype,"panelAnimationController",[Lk,LC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(LP.prototype,"mount",[LA],Object.getOwnPropertyDescriptor(LP.prototype,"mount"),LP.prototype),st(LP.prototype,"onMount",[LT],Object.getOwnPropertyDescriptor(LP.prototype,"onMount"),LP.prototype),st(LP.prototype,"transitionIn",[LR],Object.getOwnPropertyDescriptor(LP.prototype,"transitionIn"),LP.prototype),st(LP.prototype,"transitionOut",[LI],Object.getOwnPropertyDescriptor(LP.prototype,"transitionOut"),LP.prototype),LP));_._RF.pop(),_._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var L2,L4,L3,L5,L6,L8,L9,L7,Oe,Ot,On,Oi,Oa,Or,Oo,Os,Ol,Ou,Oc,Op,Of=(0,k.ccclass)("LeaderboardIsEmpty")(LX=function(g){ze(i,g);var E,_=Xe(i);function i(){return Fe(this,i),_.apply(this,arguments)}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.uiOpacity.opacity=255;g=this.node.position.clone(),E=z(this.node);E.to(.05,{position:g.clone().add3f(5,0,0)}),E.to(.05,{position:g.clone().add3f(-5,0,0)});_=z(this.node).repeat(2,E);_.to(.05,{position:g});return[4,tZ.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),i}(M))||LX;_._RF.pop(),_._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var Oy,Ov,Og,Om,Ob,Ow,OS,OE=k.ccclass,O_=k.property,Ok=k.requireComponent,OC=globalThis.game.analytics,OA=GameCore,OT=OA.Utils.Array,OR=OA.Plugins.Analytics.Events,OI=(L2=OE("SwitchButton"),L4=Ok([B,G]),L3=O_(J),L5=O_(C),L6=O_(C),L8=O_(J),L9=O_({visible:function(){return this.useSound},type:iy}),L7=O_(J),Oe=O_({visible:function(){return this.useDesktopHover},type:ei}),Ot=O_({visible:function(){return this.useDesktopHover},type:ei}),L2(On=L4((Oa=st((Oi=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"enable",Oa,Ke(g)),rt(g,"nodeOn",Or,Ke(g)),rt(g,"nodeOff",Oo,Ke(g)),rt(g,"useSound",Os,Ke(g)),rt(g,"soundKey",Ol,Ke(g)),rt(g,"useDesktopHover",Ou,Ke(g)),rt(g,"mouseEnterClip",Oc,Ke(g)),rt(g,"mouseLeaveClip",Op,Ke(g)),g.isMouseLeaved=!1,g.onMouseEnter=function(E){g.useDesktopHover&&g.buttonComponent.interactable&&(g.isMouseLeaved=!1,g.animationComponent.play(g.mouseEnterClip.name))},g.onMouseLeave=function(E){g.useDesktopHover&&g.buttonComponent.interactable&&(g.isMouseLeaved||(g.isMouseLeaved=!0,g.animationComponent.play(g.mouseLeaveClip.name)))},g}return Ue(n,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(B),this.animationComponent=this.getComponent(G),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var g=this.animationComponent.clips.map(function(g){return null==g?void 0:g.name}).filter(function(g){return null!=g&&"string"==typeof g});this.useDesktopHover&&(OT.has(g,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),OT.has(g,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(OC.event(OR.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&i8.playSound(im[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(g){this.node.active&&this.updateStatus(g)}},{key:"updateStatus",value:function(g){return this.enable===g||(this.onMouseLeave(null),this.enable=g,this.nodeOn.active=g,this.nodeOff.active=!g),this.enable}}]),n}(M)).prototype,"enable",[L3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Or=st(Oi.prototype,"nodeOn",[L5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oo=st(Oi.prototype,"nodeOff",[L6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Os=st(Oi.prototype,"useSound",[L8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ol=st(Oi.prototype,"soundKey",[L9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iy[ih.BUTTON_CLICK]}}),Ou=st(Oi.prototype,"useDesktopHover",[L7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Oc=st(Oi.prototype,"mouseEnterClip",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Op=st(Oi.prototype,"mouseLeaveClip",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),On=Oi))||On)||On);_._RF.pop(),_._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var OP,OL,OO,OB,ON,OM,OD,OF,OU,Ox=k.ccclass,Oz=k.property,OG=globalThis.game.analytics,OV=GameCore.Plugins.Analytics.Events,OK=(Oy=Ox("Tabs"),Ov=Oz(OI),Og=Oz(OI),Oy((Ow=st((Ob=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"tabWorld",Ow,Ke(g)),rt(g,"tabFriends",OS,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents(),"MsGames"===GameSDK.getSDKName()&&(this.tabWorld.node.active=!1,this.tabFriends.node.active=!1)}},{key:"validateRequiredComponents",value:function(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}},{key:"setInteractableButtons",value:function(g){this.tabWorld.getComponent(B).interactable=g,this.tabFriends.getComponent(B).interactable=g}},{key:"updateStatus",value:function(g){this.tabWorld.setEnabled("global"===g),this.tabFriends.setEnabled("friends"===g)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),i8.playSound(ih.BUTTON_CLICK),OG.event(OV.BUTTON_CLICK,{button_name:this.node.name,screen_name:iC.getCurrentPage()}),this.node.scene.emit(Eu.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),i8.playSound(ih.BUTTON_CLICK),OG.event(OV.BUTTON_CLICK,{button_name:this.node.name,screen_name:iC.getCurrentPage()}),this.node.scene.emit(Eu.FRIENDS_TAB_SELECTED)}}]),n}(M)).prototype,"tabWorld",[Ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OS=st(Ob.prototype,"tabFriends",[Og],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Om=Ob))||Om);_._RF.pop(),_._RF.push({},"91613SO4bxPDq9dH9zxyIef","LeaderboardTimer",void 0);var OH,Oq,OW,Oj,OX,OY=k.ccclass,OJ=k.property,OQ=GameCore.Utils.Time,OZ=(OP=OY("LeaderboardTimer"),OL=OJ(R),OO=OJ(C),OB=OJ(P),OP((OD=st((OM=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"background",OD,Ke(g)),rt(g,"calendar",OF,Ke(g)),rt(g,"timerLabel",OU,Ke(g)),g.alreadyShown=!1,g}return Ue(i,[{key:"onLoad",value:function(){this.timerOpacity=this.timerLabel.node.getComponent(eu),this.validateRequiredComponents(),this.backgroundDefaultWidth=this.background.width,this.calendarDefaultPosition=this.calendar.position.clone()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(!this.alreadyShown&&!g.aborted))return[3,3];this.alreadyShown=!0;E=z(this.calendar).to(.3,{scale:em.ONE},{easing:"backOut"}).to(.3,{position:this.calendarDefaultPosition.clone()},{easing:"quadOut"}),_=z(this.background).delay(.3).to(.3,{width:this.backgroundDefaultWidth},{easing:"quadOut"}),k=z(this.timerOpacity).to(.3,{opacity:255});return[4,Promise.all([tZ.runTweenAsync(E,g),tZ.runTweenAsync(_,g)])];case 1:C.sent(),this.calendar.scale=em.ONE,this.calendar.position=this.calendarDefaultPosition.clone(),this.background.width=this.backgroundDefaultWidth;return[4,tZ.runTweenAsync(k,g)];case 2:C.sent(),this.timerOpacity.opacity=255;C.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"reset",value:function(){this.alreadyShown||(this.calendar.position=this.background.node.position.clone(),this.calendar.scale=em.ZERO,this.background.width=0,this.timerOpacity.opacity=0)}},{key:"setTimeLabel",value:function(g){if(g){var E=new Date,_=0;if("manually"===g)_=0;else if("daily"===g)_=Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+1);else if("weekly"===g){var k=E.getUTCDay(),C=0===k?1:8-k;_=Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+C)}else _="monthly"===g?Date.UTC(E.getUTCFullYear(),E.getUTCMonth()+1):Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+1);this.timerLabel.string="Ends ".concat(OQ.getRelativeTime(_/1e3))}else this.timerLabel.string="Ends soon"}}]),i}(M)).prototype,"background",[OL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OF=st(OM.prototype,"calendar",[OO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OU=st(OM.prototype,"timerLabel",[OB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ON=OM))||ON);_._RF.pop(),_._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var O$,O0,O1,O2,O4,O3,O5,O6,O8,O9,O7,Bt,Bn,Bi,Ba,Br,Bo,Bs,Bl,Bu,Bc,Bp,Bf,By,Bv,Bg,Bm,Bb,Bw,BS,BE,B_,Bk,BC,BA,BT,BR,BI,BP,BL,BO,BB,BN,BM,BD=k.ccclass,BF=k.disallowMultiple,BU=k.property,Bx=(OH=BD("LeaderSkeleton"),Oq=BU(C),OH(OW=BF((OX=st((Oj=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",OX,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,tZ.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=this;this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;k=this.container.position.clone();this.container.position=new em(k.x,k.y-100,k.z);C=z(this.node).delay(g);C.to(.2,{scale:em.ONE},{easing:"cubicOut"});A=z(this.container).delay(g);A.to(.2,{position:k},{easing:"cubicOut"});T=z(this.uiOpacity).delay(g);T.to(.2,{opacity:255},{easing:"cubicOut"}),E.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=k,_.uiOpacity.opacity=255});return[4,Promise.all([tZ.runTweenAsync(C,E),tZ.runTweenAsync(A,E),tZ.runTweenAsync(T,E)])];case 1:R.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(M)).prototype,"container",[Oq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OW=Oj))||OW)||OW);_._RF.pop(),_._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var Bz,BG,BV,BK,BH,Bq,BW,Bj,BX,BY,BJ,BQ,BZ,B$=k.ccclass,B0=k.property,B1=GameCore.Utils.Number,B2=(O$=B$("Leader"),O0=B0(P),O1=B0(eu),O2=B0({type:C,group:"Container"}),O4=B0({type:eo,group:"Background"}),O3=B0({type:er,group:"Background"}),O5=B0({type:eo,group:"Rank"}),O6=B0({type:P,group:"Rank"}),O8=B0({type:er,group:"Rank"}),O9=B0({type:er,group:"Rank"}),O7=B0({type:er,group:"Rank"}),Bt=B0({type:er,group:"Rank"}),Bn=B0({type:eo,group:"Avatar"}),Bi=B0({type:eu,group:"Avatar"}),Ba=B0({type:eo,group:"Score"}),Br=B0({type:P,group:"Score"}),Bo=B0({type:er,group:"Score"}),Bs=B0({type:eu,group:"Score"}),Bl=B0({type:eu}),Bu=B0({type:R}),Bc=nC.onlyRunInLifeCycle,Bp=nC.onlyRunInLifeCycleAsync,Bf=nC.onlyRunInLifeCycle,O$((Bg=st((Bv=function(g){ze(l,g);var E,_,k,C,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"nameLabel",Bg,Ke(g)),rt(g,"nameOpacity",Bm,Ke(g)),rt(g,"container",Bb,Ke(g)),rt(g,"background",Bw,Ke(g)),rt(g,"highlightBackground",BS,Ke(g)),rt(g,"rankSprite",BE,Ke(g)),rt(g,"rankLabel",B_,Ke(g)),rt(g,"goldRank",Bk,Ke(g)),rt(g,"silverRank",BC,Ke(g)),rt(g,"bronzeRank",BA,Ke(g)),rt(g,"highlightRank",BT,Ke(g)),rt(g,"avatar",BR,Ke(g)),rt(g,"avatarOpacity",BI,Ke(g)),rt(g,"scoreBackground",BP,Ke(g)),rt(g,"scoreLabel",BL,Ke(g)),rt(g,"highlightScoreBackground",BO,Ke(g)),rt(g,"scoreOpacity",BB,Ke(g)),rt(g,"uiOpacity",BN,Ke(g)),rt(g,"uiTransform",BM,Ke(g)),g.signal=new nM,g}return Ue(l,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.defaultAvatar=this.avatar.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g,E){this.updateBackground(g),this.updateRank(g,E),this.updatePhoto(g),this.updateUsername(g),this.updateScore(g)}},{key:"updateBackground",value:function(g){this.background.spriteFrame=g.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(g,E){var _=g.rank;this.rankLabel.string=E&&_>E?"".concat(E,"+"):_.toString(),this.rankSprite.spriteFrame=this.defaultRank;var k=new A(Ef);switch(g.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,k=new A(Ev)),_){case 1:this.rankSprite.spriteFrame=this.goldRank,k=new A(Ec);break;case 2:this.rankSprite.spriteFrame=this.silverRank,k=new A(Eh);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,k=new A(Ep)}this.rankLabel.shadowColor=k,this.rankLabel.outlineColor=k}},{key:"updatePhoto",value:(T=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.signal.abort();E=new nM;if(this.signal=E,!this.avatar)return[3,5];_=g.playerId,k=g.photo;if(!bP.isAvatarCached(g.playerId,70))return[3,2];return[4,bP.getPlayerAvatar(k,_,70,E)];case 1:C=T.sent();if(!C||E.aborted)return[2];this.setPhoto(C);return[3,5];case 2:this.avatar.spriteFrame=this.defaultAvatar;return[4,tZ.waitTweenAsync(.1,E)];case 3:if(T.sent(),!!E.aborted)return[3,5];return[4,bP.getPlayerAvatar(k,_,70,E)];case 4:A=T.sent();A&&!E.aborted&&this.setPhoto(A);T.label=5;case 5:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"setPhoto",value:function(g){this.node.active&&(g.packable=!0,this.avatar.spriteFrame=g)}},{key:"updateUsername",value:function(g){this.nameLabel.string=g.name,this.nameLabel.color=new A(g.isHighlight?Ey:Ed)}},{key:"updateScore",value:function(g){var E=Math.floor(g.score);this.scoreLabel.string=B1.getShortNumber(E,7);var _=this.scoreLabel.getComponent(P);_.outlineColor=new A(g.isHighlight?Ev:Ef),_.shadowColor=new A(g.isHighlight?Ev:Ef),this.scoreBackground.spriteFrame=g.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(C=Be(function(g,E){var _,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:_=this,k=I.length>2&&void 0!==I[2]?I[2]:.3;this.node.scale=new em(.8,.8,.8),this.setVisible(!1);C=this.container.position.clone();this.container.position=new em(C.x,C.y-100,C.z);A=z(this.node).delay(E);A.to(k,{scale:em.ONE},{easing:"elasticOut"});T=z(this.container).delay(E);T.to(k,{position:C},{easing:"backOut"});R=z(this.uiOpacity).delay(E);R.to(k,{opacity:255},{easing:"cubicOut",onUpdate:function(){_.nameOpacity.opacity=_.uiOpacity.opacity,_.scoreOpacity.opacity=_.uiOpacity.opacity,_.avatarOpacity.opacity=_.uiOpacity.opacity}}),g.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=C,_.uiOpacity.opacity=255,_.avatar.node.active=!0});return[4,Promise.all([tZ.runTweenAsync(A,g),tZ.runTweenAsync(T,g),tZ.runTweenAsync(R,g)])];case 1:P.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(k=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=z(this.node).to(E,{worldPosition:g},{easing:"quadOut"});return[4,tZ.runTweenAsync(k,_)];case 1:C.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"runScaleAnimation",value:(_=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=z(this.node).to(E,{scale:new em(g,g,g)},{easing:"backOut"});return[4,tZ.runTweenAsync(k,_)];case 1:C.sent();return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(E=Be(function(g,E,_,k,C,A){var T;return _ts_generator(this,function(R){switch(R.label){case 0:T=this;return[4,tZ.runOnUpdateAsync(this.node,C,function(C){var A=Math.floor(g+(E-g)*C),R=Math.floor(_+(k-_)*C);T.updateRank({rank:A,isHighlight:!0}),T.updateScore({score:R,isHighlight:!0})},A)];case 1:R.sent();return[2]}})}),function(g,_,k,C,A,T){return E.apply(this,arguments)})},{key:"setVisible",value:function(g){var E=g?255:0;this.uiOpacity.opacity=E,this.nameOpacity.opacity=E,this.scoreOpacity.opacity=E,this.avatarOpacity.opacity=E}}]),l}(M)).prototype,"nameLabel",[O0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bm=st(Bv.prototype,"nameOpacity",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bb=st(Bv.prototype,"container",[O2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bw=st(Bv.prototype,"background",[O4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BS=st(Bv.prototype,"highlightBackground",[O3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BE=st(Bv.prototype,"rankSprite",[O5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=st(Bv.prototype,"rankLabel",[O6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bk=st(Bv.prototype,"goldRank",[O8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BC=st(Bv.prototype,"silverRank",[O9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BA=st(Bv.prototype,"bronzeRank",[O7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BT=st(Bv.prototype,"highlightRank",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BR=st(Bv.prototype,"avatar",[Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=st(Bv.prototype,"avatarOpacity",[Bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BP=st(Bv.prototype,"scoreBackground",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BL=st(Bv.prototype,"scoreLabel",[Br],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BO=st(Bv.prototype,"highlightScoreBackground",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BB=st(Bv.prototype,"scoreOpacity",[Bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BN=st(Bv.prototype,"uiOpacity",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=st(Bv.prototype,"uiTransform",[Bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Bv.prototype,"updateInfo",[Bc],Object.getOwnPropertyDescriptor(Bv.prototype,"updateInfo"),Bv.prototype),st(Bv.prototype,"updatePhoto",[Bp],Object.getOwnPropertyDescriptor(Bv.prototype,"updatePhoto"),Bv.prototype),st(Bv.prototype,"setPhoto",[Bf],Object.getOwnPropertyDescriptor(Bv.prototype,"setPhoto"),Bv.prototype),By=Bv))||By);_._RF.pop(),_._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var B4,B3,B5,B6,B8,B9,B7,Ne,Nt,Nn,Ni,Na,Nr,No,Ns,Nl,Nu,Nc,Nh,Np,Nf,Ny,Nv,Ng,Nm,Nb,Nw=k.ccclass,NS=k.property,NE=globalThis.game.player,N_=GameCore.Utils.Array,Nk=(Bz=Nw("Leaders"),BG=NS(C5),BV=NS(B2),BK=NS(V),BH=nC.onlyRunInLifeCycleAsync,Bq=nC.onlyRunInLifeCycleAsync,BW=nC.onlyRunInLifeCycleAsync,Bj=nC.onlyRunInLifeCycleAsync,Bz((BJ=st((BY=function(g){ze(u,g);var E,_,k,C,A,T,I=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=I.call.apply(I,[this].concat(_)),"scrollView",BJ,Ke(g)),rt(g,"tempLeader",BQ,Ke(g)),rt(g,"maxLeader",BZ,Ke(g)),g.leaderData=[],g.displayLeaderData=[],g.displayPlayerLeader=null,g.isHidden=!0,g}return Ue(u,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.batchNodes=this.getComponents(sw),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=NE.getPlayerId()}},{key:"updateData",value:(T=Be(function(g){return _ts_generator(this,function(E){this.isHidden=!1,this.leaderData=g,this.leaderData.forEach(function(g,E){g.rank=E+1}),this.setupDisplayLeadersData();return[2]})}),function(g){return T.apply(this,arguments)})},{key:"initScrollViews",value:function(){var g=this;this.scrollView.setMaxNodeCount(this.leaderData.length),this.scrollView.init(function(E){var _=E.getComponent(B2),k=g.displayLeaderData[E.order],C=k.playerId,A=k.photo,T=k.name,R=k.score;_.setVisible(!0),_.updateInfo({playerId:C,isHighlight:g.currentPlayerId===C,name:T,photo:A,rank:E.order+1,score:R},g.maxLeader)}),this.setBatchNodes(!0)}},{key:"playRankChangeAnimation",value:(A=Be(function(g,E,_,k){var C,A,T,R,I,P,L,O,B,N,M,D;return _ts_generator(this,function(F){switch(F.label){case 0:if(E>=_)return[3,4];C=this.displayLeaderData,A=N_.search(C,function(g){return g.playerId===NE.getPlayerId()});if(!A)return[3,4];T=A.rank;if(!C[k-1])return[3,4];R=this.scrollView.getNodeByOrder(A.rank-1);if(!R)return[3,4];I=null==R?void 0:R.getComponent(B2);if(!I)return[3,4];I.setVisible(!1),this.tempLeader.setVisible(!0),this.tempLeader.updatePhoto({playerId:NE.getPlayerId(),photo:A.photo}),this.tempLeader.node.worldPosition=R.node.worldPosition.clone();return[4,this.tempLeader.runScaleAnimation(1.1,.5,g)];case 1:F.sent();P=Math.min(.5*(T-k),2),L=[this.tempLeader.runUpdateDataAnimation(T,k,E,_,P,g),this.scrollToLeaderRank(k,P,g)],O=this.scrollView.scrollView.getMaxScrollOffset().y,B=this.scrollView.getNodeScrollOffset(k-1),N=em.ZERO;if(B<0)N=new em(this.tempLeader.node.worldPosition.x,this.node.worldPosition.y+this.scrollView.getNodePosition(k-1).y+this.uiTransform.height/2,this.tempLeader.node.worldPosition.z);else if(this.scrollView.scrollView.getScrollOffset().y>=O-5){if(B<O)N=new em(this.tempLeader.node.worldPosition.x,this.scrollView.viewport.node.worldPosition.y,this.tempLeader.node.worldPosition.z);else{D=this.scrollView.getNodeByOrder(k-1);N=null!==(M=null==D?void 0:D.node.worldPosition.clone())&&void 0!==M?M:em.ZERO}}N.equals(em.ZERO)||L.push(this.tempLeader.runWorldPositionAnimation(N,P,g));return[4,Promise.all(L)];case 2:F.sent();return[4,Promise.all([this.tempLeader.runScaleAnimation(1,.25,g),this.playPostRankChangeAnimation(k,T,g)])];case 3:F.sent(),this.tempLeader.setVisible(!1),R.node.worldPosition=this.tempLeader.node.worldPosition.clone(),this.setupDisplayLeadersData(),this.scrollView.updateNodeVisibility(),this.scrollView.updateLayout();F.label=4;case 4:return[2]}})}),function(g,E,_,k){return A.apply(this,arguments)})},{key:"playShowLeadersAnimation",value:(C=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:E=this,_=T.length>1&&void 0!==T[1]?T[1]:.1;if(!!this.isHidden)return[3,2];k=[],C=this.scrollView.getAllNodes();if(C.sort(function(g,E){return g.order-E.order}).forEach(function(g,_){var C=g.getComponent(B2);C.setVisible(_<E.leaderData.length),g.isVisible()&&k.push(C)}),k.length<1)return[3,2];k=k.slice(0,C.length-1);A=.3;return[4,Promise.all(k.map(function(){var k=Be(function(k,C){var T;return _ts_generator(this,function(R){switch(R.label){case 0:T=E.isHidden;if(T)return[3,2];return[4,k.runShowUpAnimation(g,C*_,A)];case 1:T=R.sent();R.label=2;case 2:return[2]}})});return function(g,E){return k.apply(this,arguments)}}()))];case 1:R.sent();R.label=2;case 2:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"scrollToPlayerLeader",value:(k=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:_=this.displayPlayerLeader;if(!_)return[3,2];return[4,this.scrollToLeaderRank(this.displayPlayerLeader.rank,g,E)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"updateDisplayPlayerLeaderForRankChanging",value:function(g,E,_){if(!this.displayPlayerLeader)return!1;this.displayPlayerLeader.score=g,this.displayLeaderData.sort(function(g,E){return E.score-g.score});var k=this.displayLeaderData.indexOf(this.displayPlayerLeader)+1;return _===k?(this.displayPlayerLeader.score=E,this.displayPlayerLeader.rank=_,!1):(this.displayPlayerLeader.rank=k,this.tempLeader.updateInfo({playerId:NE.getPlayerId(),isHighlight:!0,name:this.displayPlayerLeader.name,photo:this.displayPlayerLeader.photo,rank:this.displayPlayerLeader.rank,score:g}),!0)}},{key:"hideLeaders",value:function(){this.isHidden=!0;var g,E=at(this.scrollView.getAllNodes().map(function(g){return g.getComponent(B2)}));try{for(E.s();!(g=E.n()).done;){var _=g.value;null==_||_.setVisible(!1)}}catch(g){E.e(g)}finally{E.f()}this.setBatchNodes(!1)}},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"setBatchNodes",value:function(g){this.batchNodes.every(function(E){E.enabled=g})}},{key:"setupDisplayLeadersData",value:function(){var g=this,E=N_.search(this.leaderData,function(E){return E.playerId===g.currentPlayerId});E?(this.displayLeaderData=this.leaderData.filter(function(E){return E.playerId!==g.currentPlayerId}),this.displayPlayerLeader=Me({},E),this.displayLeaderData.splice(E.rank-1,0,this.displayPlayerLeader)):(this.displayPlayerLeader=null,this.displayLeaderData=this.leaderData)}},{key:"playPostRankChangeAnimation",value:(_=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=null!=g?g:0,C=this.scrollView.getVisibleNodes().filter(function(g){return g.order>=k-1&&g.order<E}),A=C.map(function(g){return g.getComponent(B2)}),T=this.scrollView.nodeHeight+this.scrollView.spacing,R=[];A.forEach(function(g,E){g.updateRank({rank:C[E].order+2,isHighlight:!1});var k=g.node.worldPosition.clone();R.push(g.runWorldPositionAnimation(k.add3f(0,-T,0),.25,_))});return[4,Promise.all(R)];case 1:I.sent();return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"scrollToLeaderRank",value:(E=Be(function(g,E,_){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.scrollView.scrollToOrder(g-1,_,E)];case 1:k.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),u}(M)).prototype,"scrollView",[BG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BQ=st(BY.prototype,"tempLeader",[BV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BZ=st(BY.prototype,"maxLeader",[BK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(BY.prototype,"updateData",[BH],Object.getOwnPropertyDescriptor(BY.prototype,"updateData"),BY.prototype),st(BY.prototype,"playRankChangeAnimation",[Bq],Object.getOwnPropertyDescriptor(BY.prototype,"playRankChangeAnimation"),BY.prototype),st(BY.prototype,"scrollToPlayerLeader",[BW],Object.getOwnPropertyDescriptor(BY.prototype,"scrollToPlayerLeader"),BY.prototype),st(BY.prototype,"scrollToLeaderRank",[Bj],Object.getOwnPropertyDescriptor(BY.prototype,"scrollToLeaderRank"),BY.prototype),BX=BY))||BX);_._RF.pop(),_._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var NC,NA,NT,NR,NI,NP,NL,NO,NB=k.ccclass,NN=k.property,NM=globalThis.game,ND=NM.storage,NF=NM.leaderboard,NU=NM.player,Nx=NM.monitorError,Nz=GameCore,NG=Nz.Utils.Object,NV=Nz.Configs.Leaderboards,NK=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),(_=E.call(this,g)).name="EmptyLeaderboardError",_}return Ue(n)}(je(Error)),NH=(B4=NB("LeaderboardContent"),B3=nC.required(),B5=NN(OK),B6=nC.required(),B8=NN(OZ),B9=nC.required(),B7=NN(Nk),Ne=NN({type:[Bx]}),Nt=nC.required(),Nn=NN(Of),Ni=nC.required(),Na=NN(ad),Nr=nC.onlyRunInLifeCycleAsync,No=nC.onlyRunInLifeCycleAsync,Ns=nC.onlyRunInLifeCycleAsync,Nl=nC.onlyRunInLifeCycleAsync,Nu=nC.onlyRunInLifeCycleAsync,Nc=nC.onlyRunInLifeCycleAsync,B4((Nf=st((Np=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"tabs",Nf,Ke(g)),rt(g,"timer",Ny,Ke(g)),rt(g,"leaders",Nv,Ke(g)),rt(g,"leaderSkeletons",Ng,Ke(g)),rt(g,"leaderboardIsEmpty",Nm,Ke(g)),rt(g,"contentOpacity",Nb,Ke(g)),g.isHidden=!0,g.currentLb=null,g.animAbortSignal=new nM,g.hasPlayedAppearAnim={friends:!1,global:!1,tournament:!1},g.handleFriendsTabSelected=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:ND.setStorageData("leaderboard_content","lastTabOpened","friends"),g.cleanupSideEffects();E=g.animAbortSignal;k.label=1;case 1:k.trys.push([1,3,,4]);return[4,g.updateStatus(E,"friends")];case 2:k.sent();return[3,4];case 3:_=k.sent();E.call(function(){var g=_instanceof(_,Error)?_:new Error("Unknown error during loading friends leaderboard.");console.error("LeaderboardContent",g),null==Nx||Nx.sendException(g),lZ.showNotificationScreen("Unable to load friends leaderboard. Please try again later.",2)});return[3,4];case 4:return[2]}})}),g.handleWorldTabSelected=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:ND.setStorageData("leaderboard_content","lastTabOpened","global"),g.cleanupSideEffects();E=g.animAbortSignal;k.label=1;case 1:k.trys.push([1,3,,4]);return[4,g.updateStatus(E,"global")];case 2:k.sent();return[3,4];case 3:_=k.sent();E.call(function(){var g=_instanceof(_,Error)?_:new Error("Unknown error during loading global leaderboard.");console.error("LeaderboardContent",g),null==Nx||Nx.sendException(g),lZ.showNotificationScreen("Unable to load global leaderboard. Please try again later.",2)});return[3,4];case 4:return[2]}})}),g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(l,[{key:"__preload",value:function(){this.leaders.maxLeader=NV.Limit}},{key:"onLoad",value:function(){nC.decorateComponent(this)}},{key:"listenEvents",value:function(){this.node.scene.on(Eu.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(Eu.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(a1.HIDE_UI,this.hideContent),this.node.scene.on(a1.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.node.scene.off(Eu.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(Eu.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(a1.HIDE_UI,this.hideContent),this.node.scene.off(a1.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(T=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this,k=this.getLeaderboardName(g);C=null!==k;if(!C)return[3,3];return[4,E.callAsync(function(){return NF.requestLeaderboardAsync(k,NV.Limit)})];case 1:A.sent(),E.call(function(){var g=NF.getLeaderboard(k);_.currentLb=null!=g?g:_.currentLb});return[4,E.callAsync(Be(function(){return _ts_generator(this,function(E){return[2,_.loadPlayerLeaderData(g)]})}))];case 2:C=A.sent();A.label=3;case 3:return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"getLeaderboardName",value:function(g){return"friends"===g?sG:sz}},{key:"showLoading",value:(A=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=k.length>1&&void 0!==k[1]?k[1]:0;return[4,Promise.all([this.leaders.scrollView.unlistenEvents(),this.leaders.scrollView.scrollToTop(g).then(function(){E.leaders&&(E.leaders.scrollView.scrollView.enabled=!1,E.leaders.scrollView.listenEvents())}),this.leaderSkeletons.map(function(E,k){return E.show(k*_,g)})])];case 1:C.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"hideLoading",value:(C=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(E){return E.hide(g)}))];case 1:E.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"entering",value:function(){this.timer.reset(),this.isHidden=!1;var g=ND.getStorageData("leaderboard_content","lastTabOpened");"friends"===g?this.handleFriendsTabSelected():"global"===g&&this.handleWorldTabSelected()}},{key:"enter",value:function(){this.listenEvents()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){this.animAbortSignal.abort(),this.animAbortSignal=new nM,this.leaders.hideLeaders(),this.leaderboardIsEmpty.hide()}},{key:"updateStatus",value:(k=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this;if(!(void 0!==g&&!this.isHidden))return[3,7];this.tabs.updateStatus(E);return[4,this.showLoading(g)];case 1:R.sent();R.label=2;case 2:R.trys.push([2,4,,5]);return[4,this.loadLeaderboard(E,g)];case 3:R.sent();return[3,5];case 4:T=R.sent();if(!_instanceof(T,NK))throw T;return[2,void g.call(function(){A.leaderboardIsEmpty.show(),A.hideLoading(g)})];case 5:null===(_=this.timer)||void 0===_||_.setTimeLabel(null===(k=this.currentLb)||void 0===k?void 0:k.resettable),null===(C=this.timer)||void 0===C||C.show(g),this.hideLoading(g);return[4,g.callAsync(function(g){return A.playLeadersShowupAnimation(E,g)})];case 6:R.sent();R.label=7;case 7:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"playLeadersShowupAnimation",value:(_=Be(function(g,E){var _,k,C,A,T,R,I,P,L,O,B,N,M;return _ts_generator(this,function(D){switch(D.label){case 0:_=this;if(!this.currentLb)return[3,6];k=NU.getPlayerId(),C=this.currentLb.leaders[k],A=ND.getStorage("leaderboard_content").previousScore,T=null!=C?C:{},R=T.score,I=T.rank,P=NG.vals(this.currentLb.leaders);P.sort(function(g,E){return E.score-g.score});L=-1!==A&&A<R&&I<=NV.Limit;this.leaders.updateData(P);O=!1;C&&L&&(O=this.leaders.updateDisplayPlayerLeaderForRankChanging(A,R,I)),this.leaders.initScrollViews(),this.leaders.scrollView.scrollView.enabled=!0;B=this.hasPlayedAppearAnim[g]?0:.1;return[4,E.callAsync(function(){return _.leaders.playShowLeadersAnimation(E,B)})];case 1:D.sent(),this.hasPlayedAppearAnim[g]=!0;N=C;if(!N)return[3,5];return[4,E.callAsync(function(){return _.leaders.scrollToPlayerLeader(1,E)})];case 2:D.sent();M=O&&-1!==A;if(!M)return[3,4];return[4,E.callAsync(function(g){return _.leaders.playRankChangeAnimation(g,A,R,I)})];case 3:M=(D.sent(),ND.setStorageData("leaderboard_content","previousScore",R));D.label=4;case 4:N=M;D.label=5;case 5:D.label=6;case 6:return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"loadPlayerLeaderData",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=NU.getPlayerId();if(null===this.currentLb)throw new Error("LeaderboardContent: Leaderboard is not found.");_=this.currentLb.leaders;if(0===Object.keys(_).length)throw new NK("LeaderboardContent: Leaderboard is empty.");if(!!_[E])return[3,2];k=this.getLeaderboardName(g);if(null===k)throw new Error("LeaderboardContent: Leaderboard name is not found.");return[4,NF.getLeadersByPlayerIdsAsync(k,[E])];case 1:C=T.sent();if(0!==C.length){A=C[0];_[E]=A}T.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),l}(M)).prototype,"tabs",[B3,B5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ny=st(Np.prototype,"timer",[B6,B8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv=st(Np.prototype,"leaders",[B9,B7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ng=st(Np.prototype,"leaderSkeletons",[Ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nm=st(Np.prototype,"leaderboardIsEmpty",[Nt,Nn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nb=st(Np.prototype,"contentOpacity",[Ni,Na],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Np.prototype,"loadLeaderboard",[Nr],Object.getOwnPropertyDescriptor(Np.prototype,"loadLeaderboard"),Np.prototype),st(Np.prototype,"showLoading",[No],Object.getOwnPropertyDescriptor(Np.prototype,"showLoading"),Np.prototype),st(Np.prototype,"hideLoading",[Ns],Object.getOwnPropertyDescriptor(Np.prototype,"hideLoading"),Np.prototype),st(Np.prototype,"updateStatus",[Nl],Object.getOwnPropertyDescriptor(Np.prototype,"updateStatus"),Np.prototype),st(Np.prototype,"playLeadersShowupAnimation",[Nu],Object.getOwnPropertyDescriptor(Np.prototype,"playLeadersShowupAnimation"),Np.prototype),st(Np.prototype,"loadPlayerLeaderData",[Nc],Object.getOwnPropertyDescriptor(Np.prototype,"loadPlayerLeaderData"),Np.prototype),Nh=Np))||Nh);_._RF.pop(),_._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var Nq,NW,Nj,NX,NY,NJ,NQ,NZ,N$,N0,N1,N2,N4,N3,N5,N6,N8,N9;NC=(0,k.ccclass)("LeaderboardPage"),NA=nC.required(),NT=nC.getComponent(rp),NR=nC.onlyRunInLifeCycleAsync,NI=nC.onlyRunInLifeCycleAsync,NP=nC.onlyRunInLifeCycleAsync,NC((NO=st((NL=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimationController",NO,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nC.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:if(g.sent(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(NH),!this.content)throw new Error("LeaderboardPage: Leaders not found");return[2]}})}),function(){return k.apply(this,arguments)})},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:this.content.entering();return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent();g=tZ.runTweenAsync(z(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent(),this.content.enter();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent(),this.content.unlistenUIEvents(),this.content.leaders.setBatchNodes(!1);return[4,this.panelAnimationController.hideUI()];case 2:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"unmount",value:function(){var g,E;null===(g=this.content)||void 0===g||g.hide(),null===(E=this.content)||void 0===E||E.cleanup(),Je(Ve(r.prototype),"unmount",this).call(this)}}]),r}(Ah)).prototype,"panelAnimationController",[NA,NT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(NL.prototype,"mount",[NR],Object.getOwnPropertyDescriptor(NL.prototype,"mount"),NL.prototype),st(NL.prototype,"transitionIn",[NI],Object.getOwnPropertyDescriptor(NL.prototype,"transitionIn"),NL.prototype),st(NL.prototype,"transitionOut",[NP],Object.getOwnPropertyDescriptor(NL.prototype,"transitionOut"),NL.prototype),NL));_._RF.pop(),_._RF.push({},"0d1c02Npp9IXrjlFdl8co2L","TopLeader",void 0);var N7,Mt,Mn,Mi,Ma,Mr,Mo,Ms,Ml,Mu,Mc,Mp,Mf,My,Mv,Mg,Mm,Mb,Mw,MS,ME,M_,Mk,MC,MA,MT=k.ccclass,MR=k.property,MI=GameCore.Utils.Number,MP=(Nq=MT("TopLeader"),NW=MR(P),Nj=MR(C),NX=MR({type:eo}),NY=MR({type:eu}),NJ=MR({type:P}),NQ=MR({type:eu}),NZ=nC.onlyRunInLifeCycle,N$=nC.onlyRunInLifeCycleAsync,N0=nC.onlyRunInLifeCycleAsync,Nq((N4=st((N2=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"nameLabel",N4,Ke(g)),rt(g,"defaultAvatar",N3,Ke(g)),rt(g,"avatar",N5,Ke(g)),rt(g,"avatarOpacity",N6,Ke(g)),rt(g,"scoreLabel",N8,Ke(g)),rt(g,"uiOpacity",N9,Ke(g)),g.signal=new nM,g}return Ue(o,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){this.updateUsername(g),this.updatePhoto(g),this.updateScore(g)}},{key:"updateUsername",value:function(g){this.nameLabel&&(this.nameLabel.string=g.name)}},{key:"updatePhoto",value:(k=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.signal.abort();E=new nM;this.signal=E,this.defaultAvatar.active=!bP.isAvatarCached(g.playerId,128),this.avatar.spriteFrame=null;_=g.playerId,k=g.photo;return[4,bP.getPlayerAvatar(k,_,128,E)];case 1:C=A.sent();C&&!E.aborted&&this.setPhoto(C);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setPhoto",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!this.node.active)return[3,2];g.packable=!0,this.avatar.spriteFrame=g;E=z(this.avatarOpacity).to(.2,{opacity:255});return[4,tZ.runTweenAsync(E,this.signal)];case 1:_.sent(),this.defaultAvatar.active=!1;_.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"updateScore",value:function(g){if(this.scoreLabel){var E=Math.floor(g.score);this.scoreLabel.string=MI.getShortNumber(E,7)}}},{key:"runShowUpAnimation",value:(E=Be(function(g){var E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:E=A.length>1&&void 0!==A[1]?A[1]:.3,_=A.length>2?A[2]:void 0;this.node.scale=em.ZERO;k=z(this.node).delay(g).to(E,{scale:new em(1,1,1)},{easing:"backOut"}),C=z(this.uiOpacity).delay(g).to(E,{opacity:255});return[4,Promise.all([tZ.runTweenAsync(k,_),tZ.runTweenAsync(C,_)])];case 1:T.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setVisible",value:function(g){var E=g?255:0;this.uiOpacity.opacity=E,this.avatarOpacity.opacity=E}}]),o}(M)).prototype,"nameLabel",[NW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N3=st(N2.prototype,"defaultAvatar",[Nj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N5=st(N2.prototype,"avatar",[NX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N6=st(N2.prototype,"avatarOpacity",[NY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N8=st(N2.prototype,"scoreLabel",[NJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N9=st(N2.prototype,"uiOpacity",[NQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(N2.prototype,"updateInfo",[NZ],Object.getOwnPropertyDescriptor(N2.prototype,"updateInfo"),N2.prototype),st(N2.prototype,"updatePhoto",[N$],Object.getOwnPropertyDescriptor(N2.prototype,"updatePhoto"),N2.prototype),st(N2.prototype,"setPhoto",[N0],Object.getOwnPropertyDescriptor(N2.prototype,"setPhoto"),N2.prototype),N1=N2))||N1);_._RF.pop(),_._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var ML,MO,MB,MN,MM,MD=k.ccclass,MF=k.property,MU=globalThis.game,Mx=MU.leaderboard,Mz=MU.player,MG=GameCore.Utils,MV=MG.Time,MK=MG.Object,MH=MG.Array,Mq=(N7=MD("TournamentBlock"),Mt=MF(C),Mn=MF(P),Mi=MF(P),Ma=MF(P),Mr=MF(P),Mo=MF(R),Ms=MF({type:eo}),Ml=MF(C),Mu=MF(C),Mc=MF(MP),Mp=nC.onlyRunInLifeCycleAsync,Mf=nC.onlyRunInLifeCycle,N7((Mg=st((Mv=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"container",Mg,Ke(g)),rt(g,"titleLabel",Mm,Ke(g)),rt(g,"timeLabel",Mb,Ke(g)),rt(g,"playerCountLabel",Mw,Ke(g)),rt(g,"playButtonLabel",MS,Ke(g)),rt(g,"uiTransform",ME,Ke(g)),rt(g,"banner",M_,Ke(g)),rt(g,"bannerMask",Mk,Ke(g)),rt(g,"bannerLoadingRing",MC,Ke(g)),rt(g,"topLeader",MA,Ke(g)),g.hasPlayedAnimation=!1,g}return Ue(l,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateInfo",value:(T=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:this.payload=g;E=g.endTime,_=g.title,k=g.payload,C=k.leaderboardId,A=k.themeId;T=C;if(!T)return[3,2];this.topLeader.setVisible(!1),this.topLeader.node.active=!1,this.setPlayerCountWaiting(),this.updateTitle(_),this.updateEndTime(E),this.updateTournamentBanner(A);return[4,this.fetchAndUpdateLeadersPayload(C,{leaders:[],amountPlayer:0},_)];case 1:T=R.sent();R.label=2;case 2:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"fetchAndUpdateLeadersPayload",value:(A=Be(function(g,E,_){var k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:k=E;T.label=1;case 1:T.trys.push([1,3,,4]);return[4,this.getLeadersPayload(g)];case 2:C=T.sent();C&&(k=C);return[3,4];case 3:A=T.sent();console.error("Fetch lb for tournament ".concat(_),A);return[3,4];case 4:this.updateLeadersPayload(k);return[2]}})}),function(g,E,_){return A.apply(this,arguments)})},{key:"updateLeadersPayload",value:function(g){this.leadersPayload=g;var E=this.leadersPayload,_=E.player,k=E.amountPlayer,C=E.leaders;this.updatePlayerCount(k),this.updatePlayButtonLabel(void 0!==_),this.updateTopLeader(null!=C?C:[])}},{key:"updateTitle",value:function(g){g&&(this.titleLabel.string=g)}},{key:"updateEndTime",value:function(g){var E=MV.getRelativeTime(g);this.timeLabel.string="Ends ".concat(E)}},{key:"updatePlayerCount",value:function(g){this.playerCountLabel.string="".concat(g," ").concat(g>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"updateTopLeader",value:(C=Be(function(g){var E,_;return _ts_generator(this,function(k){if(0!==g.length){_=g[0];GameCore.Configs.Mockup.Leaderboards.Enabled&&(_=null!==(E=MH.search(g,function(g){return 1===g.rank}))&&void 0!==E?E:_),this.topLeader.node.active=!0,this.topLeader.updateInfo(_),this.topLeader.runShowUpAnimation(0,.2)}return[2]})}),function(g){return C.apply(this,arguments)})},{key:"updateTournamentBanner",value:(k=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=ie.getAsset("".concat(nU[g],"/spriteFrame"),er);_=E;if(_)return[3,2];this.bannerMask.active=!0,this.bannerLoadingRing.active=!0;return[4,ie.loadThemePreviewAsync(g)];case 1:_=E=C.sent();C.label=2;case 2:k=E;if(k)return[3,4];return[4,ie.loadThemePreviewAsync(s9.SUMMER)];case 3:k=E=C.sent();C.label=4;case 4:this.banner&&E&&(this.banner.spriteFrame=E,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"updatePlayButtonLabel",value:function(g){this.playButtonLabel.string=g?"Continue":"Join"}},{key:"getLeadersPayload",value:(_=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=Mx.getLeaderboardName(g);if(!_)return[2,null];return[4,s6.getAllLeaderboardAsync(g)];case 1:k=I.sent();if(!k)return[2,null];C=MK.vals(k.leaders);C.sort(function(g,E){return g.rank-E.rank});A=Mz.getPlayerId();return[4,Mx.getLeadersByPlayerIdsAsync(_,[A])];case 2:T=I.sent(),R={leaders:C,amountPlayer:null!==(E=k.amountPlayer)&&void 0!==E?E:0};return[2,(T.length>0&&(R.player=T[0]),R)]}})}),function(g){return _.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=this;this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;C=this.container.position.clone();this.container.position=new em(C.x,C.y-100,C.z);A=z(this.node).delay(g);A.to(E,{scale:em.ONE},{easing:"elasticOut"});T=z(this.container).delay(g);T.to(E,{position:C},{easing:"backOut"});R=z(this.uiOpacity).delay(g);R.to(E,{opacity:255},{easing:"cubicOut"}),_.addAbortListener(function(){k.node.scale=em.ONE,k.container.position=C,k.uiOpacity.opacity=255});return[4,Promise.all([tZ.runTweenAsync(A,_),tZ.runTweenAsync(T,_),tZ.runTweenAsync(R,_)])];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var g=this.payload.id||"";if(l9.validateTournamentExpired(g))return this.node.scene.emit(sJ.RELOAD_TOURNAMENT),void lZ.showNotificationScreen("Tournament has ended",2);try{var E=JSON.stringify(this.payload);lZ.showTournamentDetailScreen(E,"tournament_start",this.hasPlayedAnimation),this.hasPlayedAnimation=!0}catch(g){console.warn("handleOnTournamentClicked",g)}}}]),l}(M)).prototype,"container",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mm=st(Mv.prototype,"titleLabel",[Mn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mb=st(Mv.prototype,"timeLabel",[Mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mw=st(Mv.prototype,"playerCountLabel",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MS=st(Mv.prototype,"playButtonLabel",[Mr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=st(Mv.prototype,"uiTransform",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=st(Mv.prototype,"banner",[Ms],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mk=st(Mv.prototype,"bannerMask",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MC=st(Mv.prototype,"bannerLoadingRing",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MA=st(Mv.prototype,"topLeader",[Mc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Mv.prototype,"fetchAndUpdateLeadersPayload",[Mp],Object.getOwnPropertyDescriptor(Mv.prototype,"fetchAndUpdateLeadersPayload"),Mv.prototype),st(Mv.prototype,"updateLeadersPayload",[Mf],Object.getOwnPropertyDescriptor(Mv.prototype,"updateLeadersPayload"),Mv.prototype),My=Mv))||My);_._RF.pop(),_._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var MW,Mj,MX,MY,MJ,MQ,MZ,M$,M0,M1,M2,M4,M3,M5=k.ccclass,M6=k.property,M8=(ML=M5("TournamentBlockSkeleton"),MO=M6(C),ML((MM=st((MN=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",MM,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,tZ.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=this;this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;k=this.container.position.clone();this.container.position=new em(k.x,k.y-100,k.z);C=z(this.node).delay(g);C.to(.2,{scale:em.ONE},{easing:"elasticOut"});A=z(this.container).delay(g);A.to(.2,{position:k},{easing:"backOut"});T=z(this.uiOpacity).delay(g);T.to(.2,{opacity:255},{easing:"cubicOut"}),E.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=k,_.uiOpacity.opacity=255});return[4,Promise.all([tZ.runTweenAsync(C,E),tZ.runTweenAsync(A,E),tZ.runTweenAsync(T,E)])];case 1:R.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})}]),a}(M)).prototype,"container",[MO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MB=MN))||MB);_._RF.pop(),_._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var M9,M7,Dt,Dn,Di,Da=k.ccclass,Dr=k.property,Do=globalThis.game.player,Ds=(MW=Da("TournamentsBoard"),Mj=Dr(ee),MX=Dr(C),MY=Dr(q),MJ=Dr(C),MQ=Dr(R),MW((M0=st((M$=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"tournamentBlockPrefab",M0,Ke(g)),g.tournamentBlockArray=[],rt(g,"inactiveNodeContainer",M1,Ke(g)),rt(g,"layout",M2,Ke(g)),rt(g,"createTournamentButton",M4,Ke(g)),rt(g,"viewport",M3,Ke(g)),g}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"start",value:function(){for(var g=0;g<20;g++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateData",value:function(g){var E=this,_=!1;g.forEach(function(g,k){var C=E.tournamentBlockArray[k];g.payload.playerId===Do.getPlayerId()&&(_=!0),C||(C=E.addTournamentBlock()),E.layout.node.addChild(C.node),C.updateInfo(g)}),_||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var g=I(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(g);var E=g.getComponent(Mq);return this.tournamentBlockArray.push(E),E}},{key:"removeTournamentBlocks",value:function(){var g,E=at(this.getActiveTournamentBlocks());try{for(E.s();!(g=E.n()).done;){var _=g.value;this.inactiveNodeContainer.addChild(_.node)}}catch(g){E.e(g)}finally{E.f()}this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var g=this;return this.tournamentBlockArray.filter(function(E){return E.node.parent===g.layout.node})}},{key:"setCreateTournamentButtonActive",value:function(g){g?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=g}},{key:"showTournamentBlocks",value:(E=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this.getActiveTournamentBlocks();if(_.length<1)return[3,2];k=Math.ceil(g/this.tournamentBlockContentHeight),C=Math.min(_.length,k);return[4,Promise.all(_.map(function(){var g=Be(function(g,_){return _ts_generator(this,function(k){switch(k.label){case 0:if(!(_<C))return[3,2];return[4,g.runShowPopUpAnimation(.1*_,.3,E)];case 1:k.sent();return[3,3];case 2:g.uiOpacity.opacity=255;k.label=3;case 3:return[2]}})});return function(E,_){return g.apply(this,arguments)}}()))];case 1:A.sent();A.label=2;case 2:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"updateVisibility",value:function(){var g,E=this.viewport.getBoundingBoxToWorld(),_=E.yMax,k=E.yMin,C=at(this.getActiveTournamentBlocks());try{for(C.s();!(g=C.n()).done;){var A=g.value,T=A.uiTransform;if(void 0!==T){var R=T.getBoundingBoxToWorld(),I=R.yMax,P=R.yMin,L=I<k||P>_;A.uiOpacity.opacity=L?0:255}}}catch(g){C.e(g)}finally{C.f()}}}]),i}(M)).prototype,"tournamentBlockPrefab",[Mj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M1=st(M$.prototype,"inactiveNodeContainer",[MX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M2=st(M$.prototype,"layout",[MY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M4=st(M$.prototype,"createTournamentButton",[MJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M3=st(M$.prototype,"viewport",[MQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MZ=M$))||MZ);_._RF.pop(),_._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var Dl,Du,Dc,Dp,Df,Dy,Dv,Dg,Dm,Db,Dw,DS,DE,D_,Dk,DC=k.ccclass,DA=k.property,DT=(M9=DC("TournamentsNotAvailable"),M7=DA(C),M9((Di=st((Dn=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"createButton",Di,Ke(g)),g}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.createButton.active=!0,this.uiOpacity.opacity=255;g=this.node.position.clone(),E=z(this.node);E.to(.05,{position:g.clone().add3f(5,0,0)}),E.to(.05,{position:g.clone().add3f(-5,0,0)});_=z(this.node).repeat(2,E);_.to(.05,{position:g});return[4,tZ.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hide",value:function(){this.createButton.active=!1,this.uiOpacity.opacity=0}}]),i}(M)).prototype,"createButton",[M7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dt=Dn))||Dt);_._RF.pop(),_._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var DR,DI,DP,DL,DO,DB,DN,DM,DD,DF=k.ccclass,DU=k.property,Dx=globalThis.game,Dz=Dx.storage,DG=Dx.match,DV=GameCore.Utils,DK=DV.Object,DH=DV.Array,Dq=(Dl=DF("TournamentContent"),Du=DU({type:rC}),Dc=DU(Ds),Dp=DU(DT),Df=DU(eK),Dy=DU({type:[M8]}),Dv=DU(ad),Dl((Db=st((Dm=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimator",Db,Ke(g)),rt(g,"tournamentsBoard",Dw,Ke(g)),rt(g,"tournamentsNotAvailable",DS,Ke(g)),rt(g,"scrollView",DE,Ke(g)),rt(g,"skeletons",D_,Ke(g)),rt(g,"contentOpacity",Dk,Ke(g)),g.animAbortSignal=null,g.softAbortSignal=null,g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(r,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(eK.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(sJ.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(a1.HIDE_UI,this.hideContent),this.node.scene.on(a1.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(eK.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(sJ.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(a1.HIDE_UI,this.hideContent),this.node.scene.off(a1.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(C=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.listenEvents();E=null===this.animAbortSignal&&null===this.softAbortSignal;if(!E)return[3,2];this.animAbortSignal=new nM,this.softAbortSignal=new nM;return[4,this.showLoading(this.animAbortSignal)];case 1:E=(T.sent(),!this.isAborted());T.label=2;case 2:if(!E)return[3,10];return[4,l9.requestTournamentDataAsync()];case 3:_=T.sent();k=this.isAborted();if(k)return[3,9];return[4,this.hideLoading(this.animAbortSignal)];case 4:T.sent();C=this.isAborted();if(C)return[3,8];if(!(0!==_.length||null!==(g=this.softAbortSignal)&&void 0!==g&&g.aborted))return[3,6];this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(_);return[4,this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal)];case 5:A=(T.sent(),this.tournamentsBoard.updateVisibility());return[3,7];case 6:A=this.tournamentsNotAvailable.show();T.label=7;case 7:C=A;T.label=8;case 8:k=C;T.label=9;case 9:T.label=10;case 10:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"showLoading",value:(k=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.scrollView.scrollToTop(0),this.scrollView.enabled=!1;return[4,Promise.all([this.skeletons.map(function(E){return E.show(0,g)})])];case 1:E.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"hideLoading",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all([this.skeletons.map(function(E){return E.hide(g)})])];case 1:E.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!Dz.getStorage("tournament").animateTournamentLeader)return;var g=l9.getAllTournamentData(),E=DG.getMatchState().customData.tournamentId;if(!E)throw new Error("Tournament ID not found");var _=DH.search(g,function(g){return g.id===E});if(!_)throw new Error("Tournament not found");var k=JSON.stringify(_);lZ.showTournamentDetailScreen(k,"tournament_end")}catch(g){Dz.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",g)}}},{key:"processCreateTournament",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lw.processCreateTournamentAsync()];case 1:_.sent();return[3,3];case 2:g=_.sent();if(!DK.hasOwn(g,"code"))return[2,void lZ.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament",2)];if("USER_INPUT"===g.code)return[2];if("PLAYER_HAS_TOURNAMENT"===g.code)return[2,void lZ.showNotificationScreen("You already have a tournament",2)];if("INVALID_OPERATION"===g.code&&DK.hasOwn(g,"message")){E="string"==typeof g.message?g.message:"Failed to Create Tournament";return[2,void lZ.showNotificationScreen(E,2)]}lZ.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament",2);return[3,3];case 3:this.reload();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"isAborted",value:function(){var g,E;return null===(g=null===(E=this.animAbortSignal)||void 0===E?void 0:E.aborted)||void 0===g||g}},{key:"cleanup",value:function(){var g;this.unlistenEvents(),null===(g=this.animAbortSignal)||void 0===g||g.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var g;null===(g=this.softAbortSignal)||void 0===g||g.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.enter()}}]),r}(M)).prototype,"panelAnimator",[Du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dw=st(Dm.prototype,"tournamentsBoard",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DS=st(Dm.prototype,"tournamentsNotAvailable",[Dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DE=st(Dm.prototype,"scrollView",[Df],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_=st(Dm.prototype,"skeletons",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Dk=st(Dm.prototype,"contentOpacity",[Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dg=Dm))||Dg);_._RF.pop(),_._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var DW,Dj,DX,DY,DJ;DR=(0,k.ccclass)("TournamentPage"),DI=nC.required(),DP=nC.getComponent(rp),DL=nC.onlyRunInLifeCycleAsync,DO=nC.onlyRunInLifeCycle,DB=nC.onlyRunInLifeCycleAsync,DN=nC.onlyRunInLifeCycleAsync,DR((DD=st((DM=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimationController",DD,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nC.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(Dq),!this.content)throw new Error("LeaderboardPage: Leaders not found")}},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent();g=tZ.runTweenAsync(z(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent(),this.content.enter();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:null===(g=this.content)||void 0===g||g.softAbort(),this.content.unlistenUIEvents();return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:E.sent();return[4,this.panelAnimationController.hideUI()];case 2:E.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"unmount",value:function(){var g;null===(g=this.content)||void 0===g||g.cleanup(),Je(Ve(r.prototype),"unmount",this).call(this)}}]),r}(Ah)).prototype,"panelAnimationController",[DI,DP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(DM.prototype,"mount",[DL],Object.getOwnPropertyDescriptor(DM.prototype,"mount"),DM.prototype),st(DM.prototype,"onMount",[DO],Object.getOwnPropertyDescriptor(DM.prototype,"onMount"),DM.prototype),st(DM.prototype,"transitionIn",[DB],Object.getOwnPropertyDescriptor(DM.prototype,"transitionIn"),DM.prototype),st(DM.prototype,"transitionOut",[DN],Object.getOwnPropertyDescriptor(DM.prototype,"transitionOut"),DM.prototype),DM));_._RF.pop(),_._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var DQ,DZ,D$,D0,D1,D2,D4,D3,D5=k.ccclass,D6=k.property;DW=D5("EventBadge"),Dj=D6(P),DX=D6(x),DW((DJ=st((DY=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"label",DJ,Ke(g)),g}return Ue(n,[{key:"text",get:function(){return this.label.string},set:function(g){this.label.string=g}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(M)).prototype,"label",[Dj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(DY.prototype,"text",[DX],Object.getOwnPropertyDescriptor(DY.prototype,"text"),DY.prototype),DY));_._RF.pop(),_._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var D8,D9,D7,Ft,Fn,Fi,Fa,Fr,Fo,Fs,Fl,Fu,Fc,Fh,Fp,Ff,Fy,Fg,Fm,Fb,Fw,FS,FE,F_,Fk,FC,FA,FT,FR,FI,FP,FL,FO,FB,FN,FM,FD,FF,FU,Fx,Fz,FG,FV,FK,FH,Fq,FW,Fj=k.ccclass,FX=k.property;DQ=Fj("EventProgressBar"),DZ=FX(on),D$=FX(P),D0=FX(x),D1=FX({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),DQ((D4=st((D2=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"progressBar",D4,Ke(g)),rt(g,"progressLabel",D3,Ke(g)),g}return Ue(n,[{key:"text",get:function(){return this.progressLabel.string},set:function(g){this.progressLabel.string=g}},{key:"progress",get:function(){return this.progressBar.progress},set:function(g){this.progressBar.progress=g}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(M)).prototype,"progressBar",[DZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D3=st(D2.prototype,"progressLabel",[D$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(D2.prototype,"text",[D0],Object.getOwnPropertyDescriptor(D2.prototype,"text"),D2.prototype),st(D2.prototype,"progress",[D1],Object.getOwnPropertyDescriptor(D2.prototype,"progress"),D2.prototype),D2));_._RF.pop(),_._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var FY,FJ,FQ,FZ,F$,F0=k.ccclass,F1=k.property,F2=k.executeInEditMode,F4=globalThis.game.analytics,F3=GameCore.Plugins.Analytics.Events;D8=F0("NavButton"),D9=F1(J),D7=F1({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),Ft=F1({type:K,group:{name:"Animation"}}),Fn=F1({type:K,group:{name:"Animation"}}),Fi=F1({type:K,group:{name:"Animation"}}),Fa=F1({type:K,group:{name:"Animation"}}),Fr=F1({type:K,group:{name:"Animation"}}),Fo=F1({group:{name:"Animation"}}),Fs=F1({type:K,group:{name:"Animation"}}),Fl=F1({type:K,group:{name:"Animation"}}),Fu=F1({group:{name:"Animation"}}),Fc=F1({type:K,group:{name:"Animation"}}),Fh=F1({type:K,group:{name:"Animation"}}),Fp=F1({type:K,group:{name:"Animation"}}),Ff=F1({type:K,group:{name:"Animation"}}),Fy=F1({type:K,group:{name:"Animation"}}),Fg=F1({type:R}),Fm=F1(C),Fb=F1(eu),Fw=F1({type:R}),FS=F1({type:es(nB)}),FE=F1(Lw),D8(F_=F2((FC=st((Fk=function(g){ze(o,g);var E,_,k=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"wip",FC,Ke(g)),rt(g,"isSelectedInEditor",FA,Ke(g)),rt(g,"animationDuration",FT,Ke(g)),rt(g,"selectedSpacing",FR,Ke(g)),rt(g,"deselectedSpacing",FI,Ke(g)),rt(g,"selectedIconY",FP,Ke(g)),rt(g,"selectedIconX",FL,Ke(g)),rt(g,"selectedIconScale",FO,Ke(g)),rt(g,"deselectedIconY",FB,Ke(g)),rt(g,"deselectedIconX",FN,Ke(g)),rt(g,"deselectedIconScale",FM,Ke(g)),rt(g,"initTextY",FD,Ke(g)),rt(g,"selectedTextY",FF,Ke(g)),rt(g,"selectedTextX",FU,Ke(g)),rt(g,"deselectedTextY",Fx,Ke(g)),rt(g,"deselectedTextX",Fz,Ke(g)),rt(g,"spacer",FG,Ke(g)),rt(g,"icon",FV,Ke(g)),rt(g,"text",FK,Ke(g)),rt(g,"uiTransform",FH,Ke(g)),rt(g,"screenType",Fq,Ke(g)),rt(g,"navManager",FW,Ke(g)),g.isSelected=!1,g.onMouseEnter=function(E){g.isSelected||g.playHoverOnAnimation()},g.onMouseLeave=function(E){g.isSelected||g.playHoverOffAnimation()},g}return Ue(o,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.initTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var g,E;this.isSelected||(i8.playSound(ih.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),F4.event(F3.BUTTON_CLICK,{button_name:null!==(g=null===(E=this.node.parent)||void 0===E?void 0:E.name)&&void 0!==g?g:this.node.name,screen_name:iC.getCurrentPage()}))}},{key:"select",value:(_=Be(function(){var g;var E=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:g=!(E.length>0&&void 0!==E[0])||E[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0;if(!g)return[3,2];return[4,tZ.runTweenAsync(this.playSelectAnimation())];case 1:_.sent();return[3,3];case 2:this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255;_.label=3;case 3:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"deselect",value:(E=Be(function(){var g,E;var _=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:g=!(_.length>0&&void 0!==_[0])||_[0],E=_.length>1&&void 0!==_[1]&&_[1];if(!this.isSelected&&!E)throw new Error("NavButton: Already deselected");this.isSelected=!1;if(!g)return[3,2];return[4,tZ.runTweenAsync(this.deselectAnimation())];case 1:k.sent();return[3,3];case 2:this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0;k.label=3;case 3:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var g=new em(this.selectedIconX,this.selectedIconY,0),E=new em(this.deselectedIconX,this.deselectedIconY,0),_=this.node.scale.clone();this.node.scale=this.selectedIconScale;var k=this.uiTransform.convertToWorldSpaceAR(g),C=this.uiTransform.convertToWorldSpaceAR(E);return this.node.scale=_,C.x-k.x}},{key:"playHoverOnAnimation",value:function(){var g=z(this.icon);return g.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),tZ.runTweenAsync(g)}},{key:"playHoverOffAnimation",value:function(){var g=z(this.icon);return g.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),tZ.runTweenAsync(g)}},{key:"playSelectAnimation",value:function(){var g=this;return z(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(E,_){if(void 0!==_){var k=el.quintInOut(_),C=el.backOut(_),A=el.linear(_),T=_<.5?2*_:1,R=g.deselectedIconY+(g.selectedIconY-g.deselectedIconY)*C,I=g.deselectedIconX+(g.selectedIconX-g.deselectedIconX)*A;g.icon.setPosition(I,R,0);var P=g.deselectedIconScale.clone().lerp(g.selectedIconScale,k);g.icon.setScale(P.x,P.y,g.icon.scale.z);var L=255*T,O=g.deselectedTextY+(g.selectedTextY-g.deselectedTextY)*A,B=g.deselectedTextX+(g.selectedTextX-g.deselectedTextX)*A;g.text.opacity=L,g.text.node.setPosition(B,O,0)}}})}},{key:"deselectAnimation",value:function(){var g=this;return z(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(E,_){if(void 0!==_){var k=eL(g.selectedIconY,g.deselectedIconY,_),C=eL(g.selectedIconX,g.deselectedIconX,_);g.icon.setPosition(C,k,0);var A=eL(255,0,_<.5?2*_:1);g.text.opacity=A;var T=eL(g.selectedTextY,g.deselectedTextY,_),R=eL(g.selectedTextX,g.deselectedTextX,_);g.text.node.setPosition(R,T,0);var I=g.selectedIconScale.clone().lerp(g.deselectedIconScale,el.quintInOut(_));g.icon.setScale(I.x,I.y,g.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}}]),o}(M)).prototype,"wip",[D9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),FA=st(Fk.prototype,"isSelectedInEditor",[D7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),FT=st(Fk.prototype,"animationDuration",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),FR=st(Fk.prototype,"selectedSpacing",[Fn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),FI=st(Fk.prototype,"deselectedSpacing",[Fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),FP=st(Fk.prototype,"selectedIconY",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),FL=st(Fk.prototype,"selectedIconX",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FO=st(Fk.prototype,"selectedIconScale",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(1,1,1)}}),FB=st(Fk.prototype,"deselectedIconY",[Fs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FN=st(Fk.prototype,"deselectedIconX",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FM=st(Fk.prototype,"deselectedIconScale",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(.8,.8,1)}}),FD=st(Fk.prototype,"initTextY",[Fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -100}}),FF=st(Fk.prototype,"selectedTextY",[Fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -10}}),FU=st(Fk.prototype,"selectedTextX",[Fp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fx=st(Fk.prototype,"deselectedTextY",[Ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fz=st(Fk.prototype,"deselectedTextX",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FG=st(Fk.prototype,"spacer",[Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FV=st(Fk.prototype,"icon",[Fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FK=st(Fk.prototype,"text",[Fb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FH=st(Fk.prototype,"uiTransform",[Fw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fq=st(Fk.prototype,"screenType",[FS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FW=st(Fk.prototype,"navManager",[FE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F_=Fk))||F_);_._RF.pop(),_._RF.push({},"091aai5+ANDeZfFN8JFkbyi","TournamentButton",void 0);var F5,F6,F8,F9,F7,Ut=k.ccclass,Un=k.property,Ui=globalThis.game.leaderboard;FY=Ut("TournamentButton"),FJ=Un(C),FQ=nC.onlyRunInLifeCycle,FY((F$=st((FZ=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"hotIcon",F$,Ke(g)),g}return Ue(i,[{key:"onLoad",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:P.trys.push([0,11,,12]);return[4,l9.requestTournamentDataAsync()];case 1:E=at.apply(void 0,[P.sent()]);P.label=2;case 2:P.trys.push([2,8,9,10]);E.s();P.label=3;case 3:if(!!(g=E.n()).done)return[3,7];_=g.value.payload,k=_.leaderboardId,C=_.playerId;if(!(k&&"global"===C))return[3,6];A=Ui.getLeaderboardName(k);T=A;if(!T)return[3,5];return[4,Ui.requestLeaderboardAsync(A,0)];case 4:T=(P.sent(),this.checkAndShowHotIcon(A));P.label=5;case 5:P.label=6;case 6:return[3,3];case 7:return[3,10];case 8:R=P.sent();E.e(R);return[3,10];case 9:E.f();return[7];case 10:return[3,12];case 11:I=P.sent();console.info("Error in TournamentButton",I);return[3,12];case 12:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"checkAndShowHotIcon",value:function(g){var E=Ui.getLeaderboard(g);E&&E.amountPlayer>=30&&(this.hotIcon.active=!0)}}]),i}(M)).prototype,"hotIcon",[FJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(FZ.prototype,"checkAndShowHotIcon",[FQ],Object.getOwnPropertyDescriptor(FZ.prototype,"checkAndShowHotIcon"),FZ.prototype),FZ));_._RF.pop(),_._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var Ua,Ur,Uo,Us,Ul,Uu,Uc,Up,Ud,Uf,Uy,Uv,Ug,Um,Ub=k.ccclass,Uw=k.property,US=k.disallowMultiple,UE=globalThis.game.player,U_=ag,Uk=GameCore.Match.Modes,UC=[ih.COMBO_1,ih.COMBO_2,ih.COMBO_3,ih.COMBO_4,ih.COMBO_5,ih.COMBO_6,ih.COMBO_7,ih.COMBO_8,ih.COMBO_9,ih.COMBO_10,ih.COMBO_11,ih.COMBO_12,ih.COMBO_13,ih.TILE_MATCH,ih.BOMB_DEFUSE,ih.BOMB_EXPLODE_1,ih.BOMB_EXPLODE_2,ih.TILE_SELECT,ih.THUNDERBOLT,ih.SHUFFLE_ITEM,ih.LEVEL_START,ih.LEVEL_COMPLETE,ih.LEVEL_FAIL];F5=Ub("GameScene"),F6=Uw(_V),F5(F8=US((F7=st((F9=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"coinManager",F7,Ke(g)),g.handleGameExit=function(){lM.switchScene(sX)},g.handleShowResults=function(){lM.switchScene(sY)},g.handleGameMaskWhenLayoutChanged=function(g){var E=$("Canvas/Game/GameObjects");if(E){var _=E.getComponent(eq);_&&(_.enabled=g===U_.Landscape)}},g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onLoad",value:function(){this.coinManager.init()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t6,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(a1.GAME_EXIT,this.handleGameExit),this.node.scene.on(a1.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}},{key:"start",value:function(){UE.getPlayerSetting("music")&&this.updateMusic(),this.preloadSounds(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadSounds",value:function(){for(var g=0,E=UC;g<E.length;g++){var _=E[g];ie.loadAudioClipAsync(_)}}},{key:"preloadScenes",value:function(){lM.preloadDashboardScene()}},{key:"updateMusic",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=lw.getMatchMode()===Uk.TOURNAMENT,E=g?ih.TOURNAMENT_MUSIC:ih.BG_MUSIC;_=i8.getCurrentMusic()!==E;if(!_)return[3,3];return[4,i8.setVolumeMusic(0,!0)];case 1:k.sent();return[4,tZ.waitTweenAsync(1)];case 2:_=k.sent();k.label=3;case 3:i8.playMusic(E,g),i8.setVolumeMusic(g?.4:.3,!0);return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"coinManager",[F6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F8=F9))||F8);_._RF.pop(),_._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);var UA,UT,UR,UI,UP,UL,UO=k.ccclass,UB=k.property;Ua=UO("ItemButton"),Ur=UB(J),Uo=UB(B),Us=UB({type:V}),Ul=UB(P),Uu=UB(C),Uc=UB(C),Ua((Ud=st((Up=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"isDebug",Ud,Ke(g)),rt(g,"button",Uf,Ke(g)),rt(g,"quantity",Uy,Ke(g)),rt(g,"quantityLabel",Uv,Ke(g)),rt(g,"plusNode",Ug,Ke(g)),rt(g,"quantityNode",Um,Ke(g)),g}return Ue(n,[{key:"__preload",value:function(){this.item=this.getComponent(mt),this.validateRequiredComponents()}},{key:"start",value:function(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string="".concat(this.quantity),this.validateButton(),this.node.scene.on(a1.GRID_CREATE,this.validateButton,this),this.node.scene.on(a1.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(a1.GRID_CLEAR,this.validateButton,this)}},{key:"validateRequiredComponents",value:function(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}},{key:"validateButton",value:function(){var g=this;console.log("VALIDATE BUTTON"),this.canActivate().then(function(E){g.button.interactable=!0,g.plusNode.active=0===g.quantity,g.quantityNode.active=g.quantity>0})}},{key:"activate",value:function(){var g=this;return new Promise(function(E){if(g.quantity<=0)return g.handleShowAddItemScreen(),void E();g.item.activate().then(function(){g.isDebug||(g.quantity--,g.quantityLabel.string="".concat(g.quantity),g.item.saveQuantity()),g.validateButton(),E()})})}},{key:"canActivate",value:function(){return Promise.resolve(!0)}},{key:"addQuantity",value:function(g){this.quantity+=g,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"clearQuantity",value:function(){this.quantity=0,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"handleShowAddItemScreen",value:function(){lZ.openScreen(ib.GET_ITEM_SCREEN,{item:sT.HINT,quantity:1})}}]),n}(M)).prototype,"isDebug",[Ur],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Uf=st(Up.prototype,"button",[Uo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uy=st(Up.prototype,"quantity",[Us],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Uv=st(Up.prototype,"quantityLabel",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ug=st(Up.prototype,"plusNode",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Um=st(Up.prototype,"quantityNode",[Uc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Up));_._RF.pop(),_._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var UN,UM,UD,UF,UU,Ux,Uz=k.ccclass,UG=k.property;UA=Uz("ComboEffect"),UT=UG(eu),UR=UG(eV),UA((UP=st((UI=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"circleOpacity",UP,Ke(g)),rt(g,"particle",UL,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(a1.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(g){g>1&&(this.circleOpacity.node.scale=em.ZERO,this.circleOpacity.opacity=60,this.particle.resetSystem(),z(this.circleOpacity.node).to(.2,{scale:new em(1.3,1.3,1.3)},{easing:"quadOut"}).start(),z(this.circleOpacity).delay(.3).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),n}(M)).prototype,"circleOpacity",[UT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UL=st(UI.prototype,"particle",[UR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UI));_._RF.pop(),_._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var UV,UK,UH,Uq,UW,Uj,UX,UY,UJ=k.ccclass,UQ=k.property;UN=UJ("ComboLabel"),UM=UQ(P),UD=UQ(C),UN((UU=st((UF=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"comboNumber",UU,Ke(g)),rt(g,"comboContainer",Ux,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.opacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(a1.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(g){0===g?this.opacity.opacity=0:g>1?(this.opacity.opacity=255,this.comboNumber.string="".concat(g),z(this.comboContainer).to(.1,{scale:new em(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:em.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),n}(M)).prototype,"comboNumber",[UM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ux=st(UF.prototype,"comboContainer",[UD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UF));_._RF.pop(),_._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var UZ,U$,U0,U1,U2,U4,U3,U5,U6,U8=k.ccclass,U9=k.property;UV=U8("ComboPopup"),UK=U9(eo),UH=U9(er),Uq=U9(G),UV((Uj=st((UW=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"textSprite",Uj,Ke(g)),rt(g,"comboSprites",UX,Ke(g)),rt(g,"animation",UY,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"start",value:function(){this.node.scene.on(a1.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"validateRequiredComponents",value:function(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}},{key:"handleOnComboUpdated",value:function(g){if(!(g<2)){for(var E=this.comboSprites.length-1;E>=0;E--)if(g>=E+2){this.textSprite.spriteFrame=this.comboSprites[E],this.animation.play();break}}}}]),n}(M)).prototype,"textSprite",[UK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UX=st(UW.prototype,"comboSprites",[UH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),UY=st(UW.prototype,"animation",[Uq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UW));_._RF.pop(),_._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var U7,xt,xn,xi,xa,xr,xo,xs,xl,xu,xc,xp,xd,xf,xy,xg=k.ccclass,xm=k.property,xb=(UZ=xg("PlayerScore"),U$=xm(C),U0=xm(P),U1=xm(eo),UZ((U3=st((U4=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"crown",U3,Ke(g)),rt(g,"playerScore",U5,Ke(g)),rt(g,"avatar",U6,Ke(g)),g}return Ue(i,[{key:"showCrown",value:function(g){this.crown.active=g}},{key:"setPlayerScore",value:function(g){this.playerScore.string=g.toString()}},{key:"playWaitingAnimation",value:function(){var g=this,E=0;this.playerScore.schedule(function(){E=(E+1)%4;var _=Array(E+1).join(".");g.playerScore.string="Waiting"+_},.5);var _=this.playerScore.getComponent(eu),k=z(_).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=z(_).repeatForever(k).start()}},{key:"stopWaitingAnimation",value:function(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(eu).opacity=255}},{key:"loadPhoto",value:(E=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,2,,3]);return[4,bP.getPlayerAvatar(g,E,128)];case 1:_=C.sent();if(!_)throw new Error("Failed to create sprite frame");_.packable=!0,this.avatar.spriteFrame=_;return[3,3];case 2:k=C.sent();return[2,void console.error(k)];case 3:return[2]}})}),function(g,_){return E.apply(this,arguments)})}]),i}(M)).prototype,"crown",[U$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U5=st(U4.prototype,"playerScore",[U0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U6=st(U4.prototype,"avatar",[U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U2=U4))||U2);_._RF.pop(),_._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var xw,xS,xE,x_,xk,xC,xA,xT,xR,xI=k.ccclass,xP=k.disallowMultiple,xL=k.property,xO=globalThis.game,xB=xO.match,xN=xO.player,xM=xO.monitorError,xD="Waiting",xF=GameCore,xU=xF.Dtos.Match.Data,xx=xF.Utils.Object;U7=xI("ChallengeResultScene"),xt=xL(V),xn=xL({type:xb,group:"Score"}),xi=xL({type:xb,group:"Score"}),xa=xL(yn),xr=xL(P),xo=xL(mp),U7(xs=xP((xu=st((xl=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"pollingInterval",xu,Ke(g)),rt(g,"playerScore",xc,Ke(g)),rt(g,"opponentScore",xp,Ke(g)),rt(g,"paperConfetti",xd,Ke(g)),rt(g,"titleText",xf,Ke(g)),rt(g,"levelManager",xy,Ke(g)),g.goToDashboardScene=function(){lM.switchScene(sX)},g.pollMatchState=Be(function(){var E,_,k,C,A,T,R,I,P,L,O,B,N,M,D,F,U,x;return _ts_generator(this,function(z){switch(z.label){case 0:z.trys.push([0,2,,3]);E=xB.getMatchState().id;if(null===E)throw new Error("Match id is not found");_=xN.getPlayerId(),k=Date.now();return[4,xB.api.getMatchAPI().getMatchDetailByIdAsync(E)];case 1:C=z.sent(),A=Date.now(),T=Math.max(0,A-k,g.pollingInterval),R=new xU(C).toObject(),I=R.blackPlayerId,P=R.blackPlayerScore,L=R.whitePlayerScore,O=R.blackPlayerFinish,B=R.whitePlayerFinish,N=_===I?P:L,M=_===I?L:P,D=_===I?O:B,F=_===I?B:O,U=O&&B;if(g.playerScore.setPlayerScore(N),g.opponentScore.setPlayerScore(M),g.playerScore.showCrown(U&&N>M),g.opponentScore.showCrown(U&&M>N),g.stopWaitingAnimation(),g.playerScore.stopWaitingAnimation(),g.opponentScore.stopWaitingAnimation(),U){if(N===M)g.titleText.string="Draw";else if(N>M)g.titleText.string="You Win";else{if(!(N<M))return[2];g.titleText.string="You Lose"}}else g.titleText.string=xD,g.playWaitingAnimation(),D||g.playerScore.playWaitingAnimation(),F||g.opponentScore.playWaitingAnimation();g.scheduleOnce(g.pollMatchState,T);return[3,3];case 2:x=z.sent();console.warn("ResultScene: Error on pollMatchState",x),g.scheduleOnce(g.pollMatchState,g.pollingInterval);return[3,3];case 3:return[2]}})}),g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"onLoad",value:function(){try{var g=xB.getMatchState(),E=g.customData,_=E.playerId,k=E.opponentId;if(null===_||null===k)throw new Error("ResultScene: playerId is ".concat(_," and opponentId is ").concat(k,". Expected to not be null."));var C=xN.getPlayer().photo,A=g.profiles[_],T=A.score,R=void 0===T?0:T,I=A.finished,P=void 0!==I&&I,L=g.profiles[k],O=L.photo,B=L.score,N=void 0===B?0:B,M=L.finished,D=void 0!==M&&M,F=P&&D,U=F&&R>N,x=F&&N>R;this.playerScore.loadPhoto(C,_),this.opponentScore.loadPhoto(O,k),this.playerScore.setPlayerScore(R),this.opponentScore.setPlayerScore(N),this.playerScore.showCrown(U),this.opponentScore.showCrown(x),P&&D?R===N?this.titleText.string="Draw":U?this.titleText.string="You Win":x&&(this.titleText.string="You Lose"):(this.titleText.string=xD,this.playWaitingAnimation(),P||this.playerScore.playWaitingAnimation(),D||this.opponentScore.playWaitingAnimation())}catch(g){console.warn("ResultScene: Error on load",g),this.goToDashboardScene()}}},{key:"listenEvents",value:function(){this.node.scene.on(nn,this.goToDashboardScene),this.node.scene.on(ne,this.onReplayButtonPressed,this)}},{key:"start",value:function(){var g=this;this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce(function(){var E,_=at(g.paperConfetti);try{for(_.s();!(E=_.n()).done;)E.value.play()}catch(g){_.e(g)}finally{_.f()}},.2),i8.playSound(ih.LEVEL_COMPLETE),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadScenes",value:function(){lM.preloadDashboardScene()}},{key:"onDestroy",value:function(){this.unschedule(this.pollMatchState)}},{key:"onReplayButtonPressed",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,P,L,O,B,N;return _ts_generator(this,function(M){switch(M.label){case 0:E=(null!==(g=xN.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;_=Math.max(1,_);return[4,this.levelManager.loadLevelData(_)];case 1:k=M.sent();M.label=2;case 2:M.trys.push([2,4,,5]);if(!k)throw new Error("Level data is not found");C=xB.getMatchState().customData.opponentId;if(!C)throw new Error("Opponent id is not found");lZ.showLoadingScreen();A=cy.generateFen(k),T=k.mode,R=void 0===T?"":T,I=k.rules,P=void 0===I?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:I,L=k.time,O=void 0===L?0:L,B=k.level;return[4,xB.challenge.friend.processAsync({playerId:xN.getPlayerId(),opponentId:C,extraData:{level:B,fen:A,gravity:R,rules:P,time:O}})];case 3:M.sent(),lZ.closeLoadingScreen(),this.goToGameScene();return[3,5];case 4:N=M.sent();if(xx.hasOwn(N,"code")&&"USER_INPUT"===N.code)return[2];console.warn("ReplayChallengeFriend",N),lZ.closeLoadingScreen(),lZ.showNotificationScreen("Sorry, you cannot replay\nat this time.",2),null==xM||xM.sendException(_instanceof(N,Error)?N:new Error("ReplayChallengeFriend"+JSON.stringify(N))),this.scheduleOnce(this.goToDashboardScene,2);return[3,5];case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onHomeButtonPressed",value:function(){this.goToDashboardScene()}},{key:"goToGameScene",value:function(){lM.switchScene(sj)}},{key:"playWaitingAnimation",value:function(){var g=this,E=0;this.titleText.schedule(function(){E=(E+1)%4;var _=Array(E+1).join(".");g.titleText.string=xD+_},.5);var _=this.titleText.getComponent(eu),k=z(_).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=z(_).repeatForever(k).start()}},{key:"stopWaitingAnimation",value:function(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(eu).opacity=255}}]),i}(M)).prototype,"pollingInterval",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),xc=st(xl.prototype,"playerScore",[xn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xp=st(xl.prototype,"opponentScore",[xi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd=st(xl.prototype,"paperConfetti",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xf=st(xl.prototype,"titleText",[xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xy=st(xl.prototype,"levelManager",[xo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xs=xl))||xs);_._RF.pop(),_._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var xz,xG=k.ccclass,xV=k.property,xK=k.disallowMultiple,xH=GameCore.Events,xq=globalThis.game.event,xW=(xw=xG("BaseScreen"),xS=xV(C),xE=xV(C),x_=xV(eu),xw(xk=xK((xA=st((xC=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"container",xA,Ke(g)),rt(g,"backgroundMask",xT,Ke(g)),rt(g,"screenOpacity",xR,Ke(g)),g.data={},g}return Ue(n,[{key:"__preload",value:function(){this.animation=this.getComponent(G),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function(){var g=this.getMaskOpacity(),E=this.getContainerOpacity();g&&E&&(g.opacity=0,E.opacity=0)}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function(g){this.screenOpacity.opacity=g}},{key:"open",value:function(g){var E,_;g&&(this.data=g),this.show(),this.runAnimation(null!==(E=null===(_=this.data.overrideAnimation)||void 0===_?void 0:_.openScreen)&&void 0!==E?E:"OpenScreen")}},{key:"close",value:function(){var g,E,_=this;this.node.active&&(this.animation.once(G.EventType.FINISHED,function(){xq.emit(xH.CLOSED_SCREEN,{screenName:_.node.name}),_.hide()}),this.runAnimation(null!==(g=null===(E=this.data.overrideAnimation)||void 0===E?void 0:E.closeScreen)&&void 0!==g?g:"CloseScreen"))}},{key:"runAnimation",value:function(g){if(!this.isAnimationExist(g))throw new Error("".concat(this.node.name,": Animation component must have ").concat(g," clip"));this.animation.play(g)}},{key:"isAnimationExist",value:function(g){return this.animation.clips.some(function(E){return!(!E||E.name!==g)})}},{key:"getMaskOpacity",value:function(){var g=this.backgroundMask.getComponent(eu);return g||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function(){var g=this.container.getComponent(eu);return g||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function(){this.setScreenOpacity(255);var g=this.node.getComponent(H);if(g){g.enabled=!0,g.updateAlignment();var E,_=at(this.node.getComponentsInChildren(H));try{for(_.s();!(E=_.n()).done;)E.value.updateAlignment()}catch(g){_.e(g)}finally{_.f()}}}},{key:"hide",value:function(){this.setScreenOpacity(0),this.node.setWorldPosition(new em(-1e3,-1e3,0));var g=this.node.getComponent(H);g&&(g.enabled=!1)}}]),n}(M)).prototype,"container",[xS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xT=st(xC.prototype,"backgroundMask",[xE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xR=st(xC.prototype,"screenOpacity",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xk=xC))||xk)||xk);_._RF.pop(),_._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var xj,xX,xY,xJ,xQ,xZ=k.ccclass,x$=k.requireComponent;xZ("BackgroundMask")(xz=x$([eu])(xz=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"onLoad",value:function(){var g=this.getComponent(eu);g?(this.opacity=g,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var g,E,_=this.opacity.opacity/255;g=_,(E=document.getElementById("app-mask"))&&(E.style.background="rgb(0 0 0 / ".concat(g,")"))}}]),n}(M))||xz);_._RF.pop(),_._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);var x0,x1,x2,x4,x3,x5,x6,x8,x9,x7,zt,zn,zi,za,zr=k.ccclass,zo=k.property,zs=(xj=zr("Screens"),xX=zo({type:es(ib)}),xj((xQ=st((xJ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"screenKeys",xQ,Ke(g)),g}return Ue(n)}(M)).prototype,"screenKeys",[xX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xY=xJ))||xY);_._RF.pop(),_._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var zl,zu,zc,zp,zd,zf,zy,zv,zg,zm,zb,zw,zS,zE,z_,zk,zC,zA,zT,zR,zI,zP=k.ccclass,zL=k.property,zO=k.disallowMultiple,zB=k.requireComponent,zN=GameCore.Events,zM=globalThis.game.event;x0=zP("CongratulationScreen"),x1=zB(xW),x2=zL(C),x4=zL(C),x3=zL(B),x5=zL(B),x6=zL(B),x0(x8=zO(x8=x1((x7=st((x9=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"congratulation",x7,Ke(g)),rt(g,"confirmation",zt,Ke(g)),rt(g,"closeButtonComponent",zn,Ke(g)),rt(g,"yesButtonComponent",zi,Ke(g)),rt(g,"noButtonComponent",za,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("CongratulationScreen: screen not found");g.validateEventPayload(E)&&(g.closeButtonComponent.interactable=!0,g.yesButtonComponent.interactable=!0,g.noButtonComponent.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.confirmationUIOpacity=this.confirmation.getComponent(eu),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){zM.on(zN.OPENING_SCREEN,this.handleOpeningScreen),zM.on(zN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){zM.off(zN.OPENING_SCREEN,this.handleOpeningScreen),zM.off(zN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,lZ.closeScreen(iS[this.node.name])}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,z(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),z(this.confirmation).set({scale:new em(.8,.8,.8)}).to(.2,{scale:new em(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(a1.START_OVER,1)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(a1.GAME_REPLAY,{level:this.screen.data.level})}}]),n}(M)).prototype,"congratulation",[x2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zt=st(x9.prototype,"confirmation",[x4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zn=st(x9.prototype,"closeButtonComponent",[x3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zi=st(x9.prototype,"yesButtonComponent",[x5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),za=st(x9.prototype,"noButtonComponent",[x6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x8=x9))||x8)||x8);_._RF.pop(),_._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var zD,zF,zU,zx,zz,zG,zV,zK,zH,zq,zW,zj,zX,zY,zJ,zQ,zZ,z$,z0,z1,z2,z4,z3=k.ccclass,z5=k.property,z6=(zl=z3("DayBlock"),zu=z5({type:eo,group:"Background"}),zc=z5({type:eo,group:"Background"}),zp=z5({type:er,group:"Background"}),zd=z5({type:er,group:"Background"}),zf=z5(P),zy=z5(P),zv=z5(C),zg=z5(C),zm=z5(C),zl((zS=st((zw=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"background",zS,Ke(g)),rt(g,"topBackground",zE,Ke(g)),rt(g,"blueBackground",z_,Ke(g)),rt(g,"blueTopBackground",zk,Ke(g)),rt(g,"dayLabel",zC,Ke(g)),rt(g,"coinLabel",zA,Ke(g)),rt(g,"rewardItemsNode",zT,Ke(g)),rt(g,"checkNode",zR,Ke(g)),rt(g,"glowNodes",zI,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new A(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new A("#3469bf")}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){this.updateBackground(g),this.updateDayLabel(g),this.coinLabel.string=g.value.toString(),this.updateRewardItems(g)}},{key:"updateBackground",value:function(g){if(this.blueTopBackground&&this.blueBackground)switch(g.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(g){this.dayLabel.string="Day ".concat(g.day.toString());var E=this.defaultDayLabelOutlineColor;"rewarded"!==g.status&&(E=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=E,this.dayLabel.shadowColor=E}},{key:"updateRewardItems",value:function(g){switch(g.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(g){this.glowNodes&&this.glowNodes.forEach(function(E){E.active=g})}}]),n}(M)).prototype,"background",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zE=st(zw.prototype,"topBackground",[zc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z_=st(zw.prototype,"blueBackground",[zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zk=st(zw.prototype,"blueTopBackground",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zC=st(zw.prototype,"dayLabel",[zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zA=st(zw.prototype,"coinLabel",[zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zT=st(zw.prototype,"rewardItemsNode",[zv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zR=st(zw.prototype,"checkNode",[zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zI=st(zw.prototype,"glowNodes",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zb=zw))||zb);_._RF.pop(),_._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var z8=k.ccclass,z9=k.property,z7=k.requireComponent,Gt=GameCore,Gn=Gt.Events,Gi=Gt.Utils,Ga=Gi.Object,Gr=Gi.Array,Go=Gt.Configs.DailyRewards,Gs=globalThis.game,Gl=Gs.event,Gu=Gs.dailyRewards,Gc=Gs.player,Gp=Gs.monitorError;zD=z8("DailyRewardsScreen"),zF=z7(xW),zU=nC.required(),zx=nC.getComponent(xW),zz=nC.required(),zG=z9(C),zV=nC.required(),zK=z9(B),zH=nC.required(),zq=z9(B),zW=z9([z6]),zj=nC.onlyRunInLifeCycleAsync,zX=nC.onlyRunInLifeCycle,zY=nC.onlyRunInLifeCycleAsync,zJ=nC.onlyRunInLifeCycle,zD(zQ=zF((z$=st((zZ=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"screen",z$,Ke(g)),g.rewardsData=[],g.debugScreenOpened=!1,g.debugUpdatedRewardsData=!1,rt(g,"loadingRing",z0,Ke(g)),rt(g,"claimButton",z1,Ke(g)),rt(g,"claimX2Button",z2,Ke(g)),rt(g,"dailyBlocks",z4,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(){var E=Be(function(E){return _ts_generator(this,function(_){g.validateEventPayload(E)&&g.open();return[2]})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,nC.decorateComponent(this),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"listenScreenEvents",value:function(){Gl.on(Gn.OPENING_SCREEN,this.handleOpeningScreen),Gl.on(Gn.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Gl.off(Gn.OPENING_SCREEN,this.handleOpeningScreen),Gl.off(Gn.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.prepareScreen(),this.openAsync()}},{key:"openAsync",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.updateRewardsData()];case 1:g.sent();return[4,this.updateScreenToMatchData()];case 2:g.sent();return[2]}})}),function(){return A.apply(this,arguments)})},{key:"updateScreenToMatchData",value:function(){return this.loginDailyRewards(),this.updateDayBlocks(),this.loadingRing.active=!1,this.setInteractableButtons(!0),this.runPopUpAnimation()}},{key:"prepareScreen",value:function(){this.debugScreenOpened=!0,this.loadingRing.active=!0,this.setInteractableButtons(!1),this.node.scene.emit(a1.HIDE_UI),this.resetState()}},{key:"close",value:function(){Gl.emit(Gn.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(a1.SHOW_UI)}},{key:"resetState",value:function(){var g,E=at(this.dailyBlocks);try{for(E.s();!(g=E.n()).done;){var _=g.value;_.uiOpacity.opacity=0,_.node.scale=new em(1.2,1.2,1.2)}}catch(g){E.e(g)}finally{E.f()}}},{key:"runPopUpAnimation",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;this.screen.container||console.warn("DailyRewardScreen: screen not found");return[4,Promise.all(this.dailyBlocks.map(function(E,_){return g.runAppearTween(E,.15*_)}))];case 1:E.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"runAppearTween",value:(k=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=z(g.uiOpacity).delay(E).to(.3,{opacity:255},{easing:"quadOut"}),k=z(g.node).delay(E).to(.3,{scale:em.ONE},{easing:"backOut"});return[4,Promise.all([tZ.runTweenAsync(_),tZ.runTweenAsync(k)])];case 1:C.sent();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleOnClaim",value:function(){this.setInteractableButtons(!1);var g=this.getCurrentRewardData();if(!g)return null==Gp||Gp.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),lZ.showNotificationScreen("Unable to validate rewards. Please try again later...",2),void this.setInteractableButtons(!0);this.claimReward(g)}},{key:"handleOnClaimX2",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.setInteractableButtons(!1);g=this.getCurrentRewardData();if(!g)return[2,(null==Gp||Gp.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),lZ.showNotificationScreen("Unable to validate rewards. Please try again later...",2),void this.setInteractableButtons(!0))];return[4,vs.showRewardVideoAdAsync({})];case 1:E.sent()?this.claimReward(g,!0):this.setInteractableButtons(!0);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return Gr.search(this.rewardsData,function(g){return"ready"===g.status})}},{key:"claimReward",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=g.value*(_?2:1),C=new nM;if(this.node.scene.emit(a1.ADD_COINS,{coins:k,collectionAnimation:{animateTextOnly:!1,signal:C}}),g.items){var A=g.items.hint*(_?2:1),T=g.items.thunder*(_?2:1),R=g.items.storm*(_?2:1),I=Gc.getGameData();I?(Gc.setGameData({items:{hint:I.items.hint+A,thunder:I.items.thunder+T,storm:I.items.storm+R,pliers:I.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Gu.requestDailyRewardsAsync()];case 1:_.sent();for(g=Me({},Gu.getDailyRewards()),E=0;E<Go.MaxDays;E++)g[E]=Me(Me({},g[E]),{},{value:sN[E].value,items:sN[E].items});g&&(this.rewardsData=Ga.vals(g),this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData));return[2]}})}),function(){return E.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){Gu.logLoginReward()}},{key:"updateDayBlocks",value:function(){var g=this;this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),null==Gp||Gp.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach(function(E,_){if(!(_>=g.rewardsData.length)){var k=g.rewardsData[_],C=k.id,A=k.type,T=k.value,R=k.status;E.updateInfo({day:C,type:A,value:T,status:R})}})}},{key:"setInteractableButtons",value:function(g){this.claimButton.interactable=g,this.claimX2Button.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),s}(M)).prototype,"screen",[zU,zx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z0=st(zZ.prototype,"loadingRing",[zz,zG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z1=st(zZ.prototype,"claimButton",[zV,zK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z2=st(zZ.prototype,"claimX2Button",[zH,zq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z4=st(zZ.prototype,"dailyBlocks",[zW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),st(zZ.prototype,"updateScreenToMatchData",[zj],Object.getOwnPropertyDescriptor(zZ.prototype,"updateScreenToMatchData"),zZ.prototype),st(zZ.prototype,"claimReward",[zX],Object.getOwnPropertyDescriptor(zZ.prototype,"claimReward"),zZ.prototype),st(zZ.prototype,"updateRewardsData",[zY],Object.getOwnPropertyDescriptor(zZ.prototype,"updateRewardsData"),zZ.prototype),st(zZ.prototype,"setInteractableButtons",[zJ],Object.getOwnPropertyDescriptor(zZ.prototype,"setInteractableButtons"),zZ.prototype),zQ=zZ))||zQ);_._RF.pop(),_._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var Gd,Gf,Gy,Gv,Gg,Gm,Gb,Gw,GS,GE;(0,k.ccclass)("DayBlockRed")(function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"updateBackground",value:function(g){if(this.blueTopBackground&&this.blueBackground)switch(g.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(g){this.dayLabel.string="Day ".concat(g.day.toString());var E=this.defaultDayLabelOutlineColor;"ready"===g.status&&(E=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=E,this.dayLabel.outlineColor=E}}]),n}(z6));_._RF.pop(),_._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var G_,Gk,GC,GA,GT,GR,GI,GP=k.ccclass,GL=k.property,GO=k.requireComponent,GB=globalThis.game.event,GN=GameCore.Events;Gd=GP("GetCoinScreen"),Gf=GO(xW),Gy=GL(P),Gv=GL(B),Gg=GL(B),Gd(Gm=Gf((Gw=st((Gb=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"quantityLabel",Gw,Ke(g)),rt(g,"closeButtonComponent",GS,Ke(g)),rt(g,"getNowButtonComponent",GE,Ke(g)),g.handleOpeningScreen=function(E){console.log("GetCoinScreen.OPENING_SCREEN",E),g.validateEventPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){GB.on(GN.OPENING_SCREEN,this.handleOpeningScreen),GB.on(GN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){GB.off(GN.OPENING_SCREEN,this.handleOpeningScreen),GB.off(GN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return"screenName"in g&&g.screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(a1.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),GB.emit(GN.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(a1.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var g=this.getQuantity();g&&this.updateQuantityLabel(g)}},{key:"updateQuantityLabel",value:function(g){this.quantityLabel.string="x".concat(g.toString())}},{key:"getQuantity",value:function(){var g=this.payload.screenData;return g&&"quantity"in g&&g.quantity&&"number"==typeof g.quantity?g.quantity:0}},{key:"handleAddCoin",value:function(){var g=this.getQuantity();this.node.scene.emit(a1.ADD_COINS,{coins:g,collectionAnimation:{animateTextOnly:!1},skipAnimation:!0}),this.close()}},{key:"handleGetNowButtonClicked",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:i8.stopAllSounds();return[4,vs.showRewardVideoAdAsync({})];case 1:g.sent()&&this.handleAddCoin();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.getNowButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),i}(M)).prototype,"quantityLabel",[Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GS=st(Gb.prototype,"closeButtonComponent",[Gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GE=st(Gb.prototype,"getNowButtonComponent",[Gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gm=Gb))||Gm);_._RF.pop(),_._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var GM,GD,GF,GU,Gx,Gz,GG,GV,GK,GH,Gq,GW,Gj,GX,GY,GJ,GQ,GZ,G$,G0,G1,G2,G4,G3,G5=k.ccclass,G6=k.property,G8=(G_=G5("ItemCollectionFX"),Gk=G6(eo),GC=G6(yn),G_((GR=st((GT=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"sprite",GR,Ke(g)),rt(g,"particles",GI,Ke(g)),g}return Ue(n,[{key:"__preload",value:function(){nC.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}}}]),n}(M)).prototype,"sprite",[Gk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GI=st(GT.prototype,"particles",[GC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GA=GT))||GA);_._RF.pop(),_._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var G9,G7,Vt,Vn,Vi,Va,Vr,Vo,Vs=k.ccclass,Vl=k.property,Vu=globalThis.game,Vc=Vu.event,Vp=Vu.player,Vd=Vu.analytics,Vf=GameCore,Vy=Vf.Events,Vv=Vf.Utils,Vg=Vv.Object,Vm=Vv.Array,Vb=Vf.Plugins.Analytics.Events;GM=Vs("GetItemScreen"),GD=Vl(ee),GF=Vl(eo),GU=Vl(eo),Gx=Vl(eo),Gz=Vl(eo),GG=Vl(P),GV=Vl(P),GK=Vl(P),GH=Vl(B),Gq=Vl(B),GW=Vl(B),GM((GX=st((Gj=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"itemFxPrefab",GX,Ke(g)),rt(g,"hintSprite",GY,Ke(g)),rt(g,"stormSprite",GJ,Ke(g)),rt(g,"pliersSprite",GQ,Ke(g)),rt(g,"thunderSprite",GZ,Ke(g)),rt(g,"titleLabel",G$,Ke(g)),rt(g,"descriptionLabel",G0,Ke(g)),rt(g,"coinLabel",G1,Ke(g)),rt(g,"closeButtonComponent",G2,Ke(g)),rt(g,"buyItemButtonComponent",G4,Ke(g)),rt(g,"getNowButtonComponent",G3,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("GetItemScreen: screen not found");if(g.validateEventPayload(E)){g.setInteractableButtons(!0);var _=g.getItemType();_&&g.updateStatus(_)}},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Vc.on(Vy.OPENING_SCREEN,this.handleOpeningScreen),Vc.on(Vy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Vc.off(Vy.OPENING_SCREEN,this.handleOpeningScreen),Vc.off(Vy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.node.scene.emit(a1.GAME_PAUSE)}},{key:"close",value:function(){this.setInteractableButtons(!1),Vc.emit(Vy.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(a1.GAME_RESUME)}},{key:"updateStatus",value:function(g){this.updateItemIcon(g),this.updateTitle(g),this.updateDescription(),this.updateButtons(g)}},{key:"updateItemIcon",value:function(g){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach(function(g){g.node.active=!1}),g){case sT.HINT:this.activeIcon=this.hintSprite;break;case sT.STORM:this.activeIcon=this.stormSprite;break;case sT.THUNDER:this.activeIcon=this.thunderSprite;break;case sT.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}},{key:"updateTitle",value:function(g){var E=g.charAt(0).toUpperCase()+g.slice(1);this.titleLabel.string=E}},{key:"updateDescription",value:function(){var g,E=null===(g=this.payload.screenData)||void 0===g?void 0:g.message;E&&(this.descriptionLabel.string=E)}},{key:"updateButtons",value:function(g){var E=this.canBuyItem(g);this.buyItemButtonComponent.node.active=E,this.getNowButtonComponent.node.active=!E,E&&(this.coinLabel.string="".concat(3*sL[g]))}},{key:"canBuyItem",value:function(g){var E=Vp.getGameData();return!!E&&E.coins>=3*sL[g]}},{key:"getItemType",value:function(){var g=this.payload.screenData;return g&&g.item&&Vm.has(Vg.vals(sT),g.item)?g.item:null}},{key:"handleAddItem",value:(A=Be(function(){var g,E;return _ts_generator(this,function(_){g=this,E=this.getItemType();E&&(Vd.event(Vb.EARN_ITEM,{item_name:E,value:3}),this.node.scene.emit(a1.ADD_ITEM,{animate:function(){return g.animateAddItem(E)},item:E,quantity:3}));return[2]})}),function(){return A.apply(this,arguments)})},{key:"animateAddItem",value:(C=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:E=this.activeIcon.spriteFrame,_=et(this.createItemCollectionNode(E),2),k=_[0],C=_[1],A=this.getItemButtonWorldPosition(g),T=new em(.5,.5,.5);return[4,this.playScaleUpItemAnim(k,C)];case 1:R.sent();return[4,tZ.waitTweenAsync(.8)];case 2:R.sent();return[4,this.playMoveCloseToItemButtonAnim(k,A,T)];case 3:R.sent();return[4,this.playJumpAnim(k,T,A)];case 4:R.sent(),i8.playSound("sounds/clicks"),k.destroy();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"playJumpAnim",value:(k=Be(function(g,E,_){var k,C;return _ts_generator(this,function(A){switch(A.label){case 0:k=_.clone().add3f(0,70,0),C=E.clone().multiplyScalar(1.3);return[4,Promise.all([tZ.runTweenAsync(z(g).to(.3,{worldPosition:k},{easing:"cubicOut"})),tZ.runTweenAsync(z(g).to(.3,{scale:C},{easing:"cubicOut"}))])];case 1:A.sent();return[4,tZ.runTweenAsync(z(g).to(.5,{worldPosition:_},{easing:"cubicIn"}))];case 2:A.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"playMoveCloseToItemButtonAnim",value:function(g,E,_){var k=E.clone().add3f(0,30,0);return tZ.runTweenAsync(z(g).to(1,{worldPosition:k,scale:_},{easing:"cubicInOut"}))}},{key:"createItemCollectionNode",value:function(g){var E=I(this.itemFxPrefab),_=E.getComponent(G8);return E.setParent(this.node.parent),_.sprite.spriteFrame=g,E.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[E,_]}},{key:"playScaleUpItemAnim",value:function(g,E){return g.setScale(em.ZERO),tZ.runTweenAsync(z(g).delay(.2).call(function(){E.playExplosionParticles(),i8.playSound("sounds/item_reward")}).to(.1,{scale:new em(.8,1.2,1)}).to(.1,{scale:new em(1.2,.8,1)}).to(.1,{scale:new em(1,1,1)}))}},{key:"getItemButtonWorldPosition",value:function(g){return this.getItemButton(g).worldPosition.clone()}},{key:"handleGetNowButtonClicked",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.stopAllSounds();return[4,vs.showRewardVideoAdAsync({})];case 1:g.sent()&&(this.handleAddItem(),this.close());return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(E=Be(function(){return _ts_generator(this,function(g){this.node.scene.emit(a1.REMOVE_COINS,{coins:3*sL[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close();return[2]})}),function(){return E.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var g;null===(g=$("Sound"))||void 0===g||null===(g=g.getComponent(tL))||void 0===g||g.stopAll()}},{key:"getItemButton",value:function(g){switch(g){case sT.HINT:return $("Canvas/UI/Footer/HintItemButton");case sT.STORM:return $("Canvas/UI/Footer/StormItemButton");case sT.THUNDER:return $("Canvas/UI/Footer/ThunderItemButton");case sT.PLIERS:return $("Canvas/UI/Footer/PliersItemButton")}}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.buyItemButtonComponent.interactable=g,this.getNowButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),s}(M)).prototype,"itemFxPrefab",[GD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GY=st(Gj.prototype,"hintSprite",[GF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GJ=st(Gj.prototype,"stormSprite",[GU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GQ=st(Gj.prototype,"pliersSprite",[Gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GZ=st(Gj.prototype,"thunderSprite",[Gz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G$=st(Gj.prototype,"titleLabel",[GG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G0=st(Gj.prototype,"descriptionLabel",[GV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G1=st(Gj.prototype,"coinLabel",[GK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G2=st(Gj.prototype,"closeButtonComponent",[GH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G4=st(Gj.prototype,"buyItemButtonComponent",[Gq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G3=st(Gj.prototype,"getNowButtonComponent",[GW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gj));_._RF.pop(),_._RF.push({},"4d6710xA7hAk65cGA4Dgdrc","GetRewardsScreen",void 0);var Vw,VS=k.ccclass,VE=k.requireComponent,V_=k.property,Vk=GameCore.Events,VC=globalThis.game.event;G9=VS("GetRewardsScreen"),G7=VE(xW),Vt=V_(P),Vn=V_(B),G9(Vi=G7((Vr=st((Va=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"adStartingLabel",Vr,Ke(g)),rt(g,"skipButton",Vo,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){VC.on(Vk.OPENING_SCREEN,this.handleOpeningScreen),VC.on(Vk.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){VC.off(Vk.OPENING_SCREEN,this.handleOpeningScreen),VC.off(Vk.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.runAdStartingAnimation()}},{key:"close",value:function(g){this.setInteractableButtons(!1),VC.emit(Vk.CLOSE_SCREEN,{screenName:this.node.name,screenData:{getRewardsSuccess:g}})}},{key:"runAdStartingAnimation",value:function(){var g=this,E=5;this.adStartingLabel.string="AD starting in ".concat(E,"...");this.schedule(function(){E<=0?g.stopAdStartingAnimation():(E--,g.adStartingLabel.string="AD starting in ".concat(E,"..."))},1,6)}},{key:"stopAdStartingAnimation",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.unscheduleAllCallbacks();return[4,vs.showRewardedInterstitialAdAsync({})];case 1:g=E.sent();this.close(g);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleClickedSkip",value:function(){this.unscheduleAllCallbacks(),this.close(!1)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.skipButton.interactable=g}}]),i}(M)).prototype,"adStartingLabel",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vo=st(Va.prototype,"skipButton",[Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vi=Va))||Vi);_._RF.pop(),_._RF.push({},"bfe1eXch0ZMKIz1ofLKc2Iv","HardLevelScreen",void 0);var VA,VT,VR,VI,VP,VL,VO,VB,VN,VM,VD,VF,VU,Vx=k.ccclass,Vz=k.requireComponent,VG=GameCore.Events,VV=globalThis.game.event;Vx("HardLevelScreen")(Vw=Vz(xW)(Vw=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleOpeningScreen=function(E){g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){VV.on(VG.OPENING_SCREEN,this.handleOpeningScreen),VV.on(VG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){VV.off(VG.OPENING_SCREEN,this.handleOpeningScreen),VV.off(VG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation()}},{key:"close",value:function(){lZ.closeScreen(iS[this.node.name])}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}}]),n}(M))||Vw);_._RF.pop(),_._RF.push({},"2db0dg4dI9GCKCdFOMrBFsQ","GetRewardsEffect",void 0);var VK,VH,Vq,VW,Vj,VX,VY,VJ,VQ,VZ,V$,V0,V1,V2,V4,V3,V5,V6,V8,V9,V7,Kt,Kn,Ki,Ka,Kr,Ko,Ks,Kl,Ku,Kc,Kh,Kp,Kd,Kf,Ky,Kv=k.ccclass,Kg=k.property,Km=(VA=Kv("GetRewardsEffect"),VT=Kg(er),VR=Kg(er),VI=Kg(er),VP=Kg(er),VL=Kg(yn),VA((VN=st((VB=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"hint",VN,Ke(g)),rt(g,"thunder",VM,Ke(g)),rt(g,"storm",VD,Ke(g)),rt(g,"pliers",VF,Ke(g)),rt(g,"particles",VU,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"playAnimation",value:(E=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this,k=-30*(g.length-1)/2+90;return[4,Promise.all(g.map(function(g,C){var A=_.createSprite(g),T=k+30*C,R=.15*C;A.node.position=new em(300*Math.cos(Math.PI/180*T),300*Math.sin(Math.PI/180*T),0);var I=z(A.node);return I.delay(R),I.to(.6,{position:em.ZERO,scale:new em(.7,.7,.7)},{easing:"backIn"}),tZ.runTweenAsync(I).then(function(){E(),i8.playSound(ih.COLLECT_STARS),_.playExplodeEffect(),A.node.destroy()})}))];case 1:C.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"playExplodeEffect",value:function(){var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;){var _=g.value;_.stop(),_.play()}}catch(g){E.e(g)}finally{E.f()}}},{key:"createSprite",value:function(g){var E=this.getSpriteFrame(g),_=(new C).addComponent(eo);return _.spriteFrame=E,_.node.parent=this.node,_.node.scale=new em(1.5,1.5,1.5),_}},{key:"getSpriteFrame",value:function(g){switch(g){case"hint":return this.hint;case"thunder":return this.thunder;case"storm":return this.storm;case"pliers":return this.pliers;default:return null}}}]),i}(M)).prototype,"hint",[VT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VM=st(VB.prototype,"thunder",[VR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VD=st(VB.prototype,"storm",[VI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VF=st(VB.prototype,"pliers",[VP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VU=st(VB.prototype,"particles",[VL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),VO=VB))||VO);_._RF.pop(),_._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var Kb,Kw=k.ccclass,KS=k.property,KE=k.requireComponent,K_=GameCore,Kk=K_.Events,KC=K_.Utils.Valid,KA=globalThis.game,KT=KA.event,KR=KA.player,KI="Coin Container";VK=Kw("LevelCompleteScreen"),VH=KE(xW),Vq=KS(P),VW=KS(P),Vj=KS(eu),VX=KS(Km),VY=KS({type:P,group:"Play Button"}),VJ=KS({type:B,group:"Play Button"}),VQ=KS({type:C,group:"Play Button"}),VZ=KS({type:eu,group:"Play Button"}),V$=KS({type:C,group:"Play Button"}),V0=KS({type:C,group:"Play Button"}),V1=KS({type:G,group:KI}),V2=KS({type:k0,group:KI}),V4=KS({type:G,group:KI}),V3=KS({type:ei,group:KI}),V5=KS({type:ei,group:KI}),V6=KS(yn),VK(V8=VH((V7=st((V9=function(g){ze(c,g);var E,_,k,C,A,T,R,I,P=Xe(c);function c(){var g;Fe(this,c);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=P.call.apply(P,[this].concat(_))).level=1,g.coins=40,g.currentCoins=0,g.score=0,g.playAnimation=!1,g.getRewardsSuccess=!1,g.lookingForRewards=!1,g.playButtonSignal=new nM,rt(g,"coinText",V7,Ke(g)),rt(g,"scoreText",Kt,Ke(g)),rt(g,"lookingForRewardsText",Kn,Ke(g)),rt(g,"getRewardsEffect",Ki,Ke(g)),rt(g,"playButtonLabel",Ka,Ke(g)),rt(g,"playButton",Kr,Ke(g)),rt(g,"playBackground",Ko,Ke(g)),rt(g,"shineBackground",Ks,Ke(g)),rt(g,"hardLevelBackground",Kl,Ke(g)),rt(g,"playButtonContainer",Ku,Ke(g)),rt(g,"coinAnimation",Kc,Ke(g)),rt(g,"coinContainer",Kh,Ke(g)),rt(g,"coinContainerAnimation",Kp,Ke(g)),rt(g,"coinContainerEnterClip",Kd,Ke(g)),rt(g,"coinContainerExitClip",Kf,Ke(g)),rt(g,"particles",Ky,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StarChestScreen: screen not found");g.validateEventPayload(E)&&(g.playButton.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g.handleParticleEnd=Be(function(){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=g.level;if(!E)return[3,2];return[4,tZ.waitTweenAsync(.15)];case 1:E=_.sent();_.label=2;case 2:return[4,Promise.all([g.animateCoin(),g.animateScore()])];case 3:_.sent();if(!g.lookingForRewards)return[3,5];return[4,g.handleLookingForRewards()];case 4:_.sent();return[3,7];case 5:return[4,g.animateVisiblePlayButton(!0)];case 6:_.sent();_.label=7;case 7:return[2]}})}),g}return Ue(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){KT.on(Kk.OPENING_SCREEN,this.handleOpeningScreen),KT.on(Kk.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){KT.off(Kk.OPENING_SCREEN,this.handleOpeningScreen),KT.off(Kk.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){var E=null!=g?g:{},_=E.screenName,k=E.screenData;return _===this.node.name&&!!KC.isObject(k)&&(KC.isNumber(k.level)&&(this.level=k.level,this.coins=this.level<5?sR:sI),KC.isNumber(k.coins)&&(this.currentCoins=k.coins),KC.isNumber(k.score)&&(this.score=k.score),this.playAnimation=!1,KC.isObject(k.overrideAnimation)&&(this.playAnimation="LevelCompleteOpenScreen"===k.overrideAnimation.openScreen),this.lookingForRewards=!1,KC.isBoolean(k.lookingForRewards)&&(this.lookingForRewards=k.lookingForRewards),this.getRewardsSuccess=!1,KC.isBoolean(k.getRewardsSuccess)&&(this.getRewardsSuccess=k.getRewardsSuccess),!0)}},{key:"open",value:function(){this.updateStatus(),this.node.scene.emit(a1.HIDE_UI),this.tryPlayAnimation()}},{key:"close",value:(I=Be(function(){var g,E,_,k;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:E=C.length>0&&void 0!==C[0]&&C[0],_=at(this.particles);try{for(_.s();!(g=_.n()).done;){k=g.value;k.stop()}}catch(g){_.e(g)}finally{_.f()}return[4,tZ.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name)];case 1:A.sent(),KT.emit(Kk.CLOSE_SCREEN,{screenName:this.node.name,screenData:{canShowRewardsAd:E}}),this.node.scene.emit(a1.ABORT_COIN_ANIMATION);return[2]}})}),function(){return I.apply(this,arguments)})},{key:"updateStatus",value:function(){this.updateCoinContainer(),this.updatePlayButton(),this.lookingForRewardsText.opacity=0}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoins})}},{key:"updatePlayButton",value:function(){var g=KR.getGameData();if(g){var E=(this.level+1>g.totalLevel?this.level:this.level+1)%5==0;this.playBackground.active=!E,this.hardLevelBackground.active=E}}},{key:"tryPlayAnimation",value:function(){if(this.playAnimation){this.screen.setScreenOpacity(255),this.coinText.string="x0",this.scoreText.string="0",this.animateVisiblePlayButton(!1,!1);var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}var _=this.screen.getComponent(G);_?_.once(G.EventType.FINISHED,this.handleParticleEnd):this.handleParticleEnd()}else{if(this.animateVisiblePlayButton(!0,!1),!this.getRewardsSuccess)return;this.getRewardsEffect.playAnimation(["storm","thunder"],this.animateCollectItemPlayButton.bind(this))}}},{key:"handleLookingForRewards",value:(R=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.animateLookingForRewards()];case 1:g.sent(),vs.canShowRewardedInterstitialAd()?this.close(!0):this.animateVisiblePlayButton(!0);return[2]}})}),function(){return R.apply(this,arguments)})},{key:"animateCoin",value:(T=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;if(!this.screen.container)return[3,3];this.coinAnimation.play();return[4,tZ.runOnUpdateAsync(this.node,.8,function(E){var _=eL(0,g.coins,E),k=Math.floor(_);g.coinText.string="x".concat(k)})];case 1:E.sent();return[4,this.animateCoinCollection()];case 2:E.sent(),this.coinText.string="x".concat(this.coins);return[3,4];case 3:console.warn("LevelCompleteScreen: screen not found");E.label=4;case 4:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"animateScore",value:(A=Be(function(){var g;return _ts_generator(this,function(E){g=this;tZ.runOnUpdateAsync(this.scoreText.node,.8,function(E){var _=eL(0,g.score,E);g.scoreText.string="".concat(Math.floor(_))}),this.scoreText.node.setScale(1,1,1),this.scoreText.string="".concat(this.score);return[2]})}),function(){return A.apply(this,arguments)})},{key:"animateCoinCollection",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,tZ.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name)];case 1:g.sent(),this.node.scene.emit(a1.ADD_COINS,{coins:this.coins,collectionAnimation:{floatDuration:.5,flyDuration:.5,animateTextOnly:!1,target:this.coinContainer}});return[2]}})}),function(){return C.apply(this,arguments)})},{key:"animateLookingForRewards",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=z(this.lookingForRewardsText);g.to(.25,{opacity:255},{easing:"linear"}).delay(.25),g.to(.25,{opacity:100},{easing:"linear"}).delay(.125);return[4,tZ.runTweenAsync(z(this.lookingForRewardsText).repeat(2,g).to(.25,{opacity:0},{easing:"linear"}))];case 1:E.sent(),this.lookingForRewardsText.opacity=0;return[2]}})}),function(){return k.apply(this,arguments)})},{key:"animateVisiblePlayButton",value:(_=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:E=!(T.length>1&&void 0!==T[1])||T[1],_=g?1:0;if(!E)return[3,2];this.playButtonSignal.abort();k=new nM;this.playButtonSignal=k;C=g?0:1;this.playButtonContainer.setScale(C,C,this.playButtonContainer.scale.z);A=z(this.playButtonContainer).to(.5,{scale:new em(_,_,1)},{easing:"backOut"});g||(this.playButton.interactable=!1);return[4,tZ.runTweenAsync(A,k)];case 1:R.sent(),g&&(this.playButton.interactable=!0);return[3,3];case 2:this.playButton.interactable=g,this.playButtonContainer.setScale(_,_,this.playButtonContainer.scale.z);R.label=3;case 3:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"animateCollectItemPlayButton",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.playButtonSignal.abort();g=new nM;this.playButtonSignal=g;E=z(this.playButtonContainer).to(.08,{scale:new em(.95,1.05,1)}).to(.08,{scale:new em(1.05,.95,1)}).to(.08,{scale:new em(1,1,1)}),_=z(this.shineBackground).to(.08,{opacity:50},{easing:"quadOut"}).to(.08,{opacity:0},{easing:"quadIn"});return[4,Promise.all([tZ.runTweenAsync(E,g),tZ.runTweenAsync(_,g)])];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleClickedPlay",value:function(){this.playButton.interactable=!1,this.close()}}]),c}(M)).prototype,"coinText",[Vq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kt=st(V9.prototype,"scoreText",[VW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kn=st(V9.prototype,"lookingForRewardsText",[Vj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ki=st(V9.prototype,"getRewardsEffect",[VX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ka=st(V9.prototype,"playButtonLabel",[VY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kr=st(V9.prototype,"playButton",[VJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ko=st(V9.prototype,"playBackground",[VQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ks=st(V9.prototype,"shineBackground",[VZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kl=st(V9.prototype,"hardLevelBackground",[V$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=st(V9.prototype,"playButtonContainer",[V0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kc=st(V9.prototype,"coinAnimation",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kh=st(V9.prototype,"coinContainer",[V2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kp=st(V9.prototype,"coinContainerAnimation",[V4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kd=st(V9.prototype,"coinContainerEnterClip",[V3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kf=st(V9.prototype,"coinContainerExitClip",[V5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ky=st(V9.prototype,"particles",[V6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),V8=V9))||V8);_._RF.pop(),_._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var KP,KL,KO,KB,KN,KM,KD,KF,KU=k.ccclass,Kx=k.disallowMultiple,Kz=k.requireComponent,KG=GameCore.Events,KV=globalThis.game.event;KU("LoadingScreen")(Kb=Kx(Kb=Kz(xW)(Kb=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleOpeningScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g.handleClosingScreen=function(E){g.validateEventPayload(E)&&g.unscheduleAllCallbacks()},g.handleClosedScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!1)},g.handleOnCloseScreen=function(){lZ.closeScreen(iS[g.node.name])},g}return Ue(n,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){KV.on(KG.OPENING_SCREEN,this.handleOpeningScreen),KV.on(KG.OPENED_SCREEN,this.handleOpenedScreen),KV.on(KG.CLOSING_SCREEN,this.handleClosingScreen),KV.on(KG.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){KV.off(KG.OPENING_SCREEN,this.handleOpeningScreen),KV.off(KG.OPENED_SCREEN,this.handleOpenedScreen),KV.off(KG.CLOSING_SCREEN,this.handleClosingScreen),KV.off(KG.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var g=this.screen.data.duration;g&&g>0&&this.scheduleOnce(this.handleOnCloseScreen,g)}}}]),n}(M))||Kb)||Kb);_._RF.pop(),_._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var KK,KH,Kq,KW,Kj,KX,KY,KJ,KQ,KZ,K$,K0,K1,K2,K4,K3,K5=k.ccclass,K6=k.disallowMultiple,K8=k.requireComponent,K9=k.property,K7=GameCore,Ht=K7.Events,Hn=K7.Utils.Valid,Hi=globalThis.game.event;KP=K5("NotificationScreen"),KL=K8(xW),KO=K9(P),KB=K9(B),KP(KN=K6(KN=KL((KD=st((KM=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"message",KD,Ke(g)),rt(g,"touchZone",KF,Ke(g)),g.enableCloseOnTouch=!0,g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.updateScreenData(E)},g.handleClosingScreen=function(E){g.validateEventPayload(E)&&g.unscheduleAllCallbacks()},g}return Ue(n,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Hi.on(Ht.OPENING_SCREEN,this.handleOpeningScreen),Hi.on(Ht.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){Hi.off(Ht.OPENING_SCREEN,this.handleOpeningScreen),Hi.off(Ht.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"updateScreenData",value:function(g){var E=this,_=g.screenData;Hn.isObject(_)?(_.message&&(this.message.string=_.message),_.duration&&_.duration>0&&this.scheduleOnce(function(){lZ.closeScreen(iS[E.node.name])},_.duration),!1===_.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),lZ.closeScreen(iS[this.node.name])}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),n}(M)).prototype,"message",[KO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KF=st(KM.prototype,"touchZone",[KB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KN=KM))||KN)||KN);_._RF.pop(),_._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var Ha,Hr,Ho,Hs,Hl,Hu,Hc,Hh,Hp,Hd,Hf,Hy,Hv,Hg,Hm,Hb,Hw,HS,HE,H_,Hk,HC,HA=k.ccclass,HT=k.property,HR=k.requireComponent,HI=GameCore,HP=HI.Events,HL=HI.Match.Modes,HO=globalThis.game,HB=HO.event,HN=HO.storage;KK=HA("QuitLevelScreen"),KH=HR(xW),Kq=HT(P),KW=HT(P),Kj=HT(B),KX=HT(P),KY=HT(P),KJ=HT(B),KK(KQ=KH((K$=st((KZ=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"singleDescription",K$,Ke(g)),rt(g,"tournamentDescription",K0,Ke(g)),rt(g,"quitButton",K1,Ke(g)),rt(g,"quitLabel",K2,Ke(g)),rt(g,"endLabel",K4,Ke(g)),rt(g,"continueButton",K3,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){HB.on(HP.OPENING_SCREEN,this.handleOpeningScreen),HB.on(HP.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){HB.off(HP.OPENING_SCREEN,this.handleOpeningScreen),HB.off(HP.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(a1.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),lZ.closeScreen(iS[this.node.name]),this.node.scene.emit(a1.SHOW_UI),this.node.scene.emit(a1.GAME_RESUME)}},{key:"updateStatus",value:function(){var g=lw.getMatchMode()===HL.TOURNAMENT;this.singleDescription.node.active=!g,this.tournamentDescription.node.active=g,this.quitLabel.node.active=!g,this.endLabel.node.active=g}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.quitButton.interactable=g,this.continueButton.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"handleClickedContinue",value:function(){this.close()}},{key:"handleClickedQuit",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.setInteractableButtons(!1),lw.getMatchMode()!==HL.TOURNAMENT)return[3,2];E=(null!==(g=lw.getMatchCustomData())&&void 0!==g?g:{}).score,_=(void 0===E?0:E)>HN.getStorageData("tournament","previousScore");HN.setStorageData("tournament","animateTournamentLeader",_);return[4,lw.finishMatchAsync()];case 1:k.sent();k.label=2;case 2:this.node.scene.emit(a1.GAME_EXIT);return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"singleDescription",[Kq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K0=st(KZ.prototype,"tournamentDescription",[KW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K1=st(KZ.prototype,"quitButton",[Kj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K2=st(KZ.prototype,"quitLabel",[KX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K4=st(KZ.prototype,"endLabel",[KY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K3=st(KZ.prototype,"continueButton",[KJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KQ=KZ))||KQ);_._RF.pop(),_._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var HM,HD,HF,HU,Hx,Hz,HG,HV,HK,HH,Hq,HW,Hj,HX,HY,HJ,HQ,HZ,H$,H0,H1,H2,H4,H3,H5,H6,H8=k.ccclass,H9=k.property,H7=k.disallowMultiple,qt=k.requireComponent,qn=GameCore.Events,qi=globalThis.game,qa=qi.event,qr=qi.player;Ha=H8("RescuesScreen"),Hr=qt(xW),Ho=H9(eu),Hs=H9([C]),Hl=H9(P),Hu=H9(P),Hc=H9(C),Hh=H9(C),Hp=H9(G),Hd=H9(C),Hf=H9(C),Ha(Hy=H7(Hy=Hr((Hg=st((Hv=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"adOpacity",Hg,Ke(g)),rt(g,"animNodes",Hm,Ke(g)),rt(g,"titleLabel",Hb,Ke(g)),rt(g,"descriptionLabel",Hw,Ke(g)),rt(g,"timer",HS,Ke(g)),rt(g,"bomb",HE,Ke(g)),rt(g,"bombAnim",H_,Ke(g)),rt(g,"replayButton",Hk,Ke(g)),rt(g,"buyTimeButton",HC,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("RescuesScreen: screen not found");g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){qa.on(qn.OPENING_SCREEN,this.handleOpeningScreen),qa.on(qn.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){qa.off(qn.OPENING_SCREEN,this.handleOpeningScreen),qa.off(qn.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:i8.turnOffMusic();return[4,this.resetState()];case 1:g.sent(),this.runOpenAnimation(),this.node.scene.emit(a1.HIDE_UI);return[2]}})}),function(){return A.apply(this,arguments)})},{key:"close",value:function(){i8.turnUpMusic(),qa.emit(qn.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(C=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){E=(null===(g=this.payload.screenData)||void 0===g?void 0:g.failKey)===ut;this.titleLabel.string=E?"Boom!":"Time's Up!",this.descriptionLabel.string=E?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!E,this.bomb.active=E,E&&this.bombAnim.play();_=qr.getGameData();if(_){k=_.coins>=sO;this.replayButton.active=!k,this.buyTimeButton.active=k,this.adOpacity.opacity=0}return[2]})}),function(){return C.apply(this,arguments)})},{key:"runOpenAnimation",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;if(!this.screen.container)return[3,3];return[4,Promise.all(this.animNodes.map(function(E,_){g.runAppearTween(E,.1*_)}))];case 1:E.sent();return[4,this.runShowAdContainer()];case 2:E.sent();return[3,4];case 3:console.warn("TimeUpScreen: screen not found");E.label=4;case 4:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"runAppearTween",value:(_=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,tZ.runTweenAsync(z(g).set({scale:new em(0,0,0)}).delay(E).to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*tZ.elasticOut(k,.1,.45)}}))];case 1:_.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var g=z(this.adOpacity);return g.delay(1),g.to(.5,{opacity:255}),tZ.runTweenAsync(g)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit(a1.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit(a1.REMOVE_COINS,{coins:sO,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,vs.showRewardVideoAdAsync({})];case 1:g.sent()&&this.startRescue();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit(a1.SHOW_UI),this.node.scene.emit(a1.RESCUE_START),this.close()}}]),s}(M)).prototype,"adOpacity",[Ho],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hm=st(Hv.prototype,"animNodes",[Hs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Hb=st(Hv.prototype,"titleLabel",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hw=st(Hv.prototype,"descriptionLabel",[Hu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HS=st(Hv.prototype,"timer",[Hc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HE=st(Hv.prototype,"bomb",[Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H_=st(Hv.prototype,"bombAnim",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hk=st(Hv.prototype,"replayButton",[Hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HC=st(Hv.prototype,"buyTimeButton",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hy=Hv))||Hy)||Hy);_._RF.pop(),_._RF.push({},"726c9oCUUBDpboDnHRz7SGZ","PauseScreen",void 0);var qo,qs,ql,qu,qc,qp,qd,qf,qy,qv,qg,qm,qb,qw,qS,qE,q_,qk,qC,qA,qT,qR,qP,qL,qO,qB,qN=k.ccclass,qM=k.property,qD=k.requireComponent,qF=GameCore,qU=qF.Events,qx=qF.Utils.Device,qz=qF.Match.Modes,qG=globalThis.game,qV=qG.player,qK=qG.event;HM=qN("PauseScreen"),HD=qD(xW),HF=qM(C),HU=qM(C),Hx=qM(C),Hz=qM(OI),HG=qM(OI),HV=qM(OI),HK=qM(B),HH=qM(B),Hq=qM(B),HW=qM(B),Hj=qM(C),HM(HX=HD((HJ=st((HY=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"musicSetting",HJ,Ke(g)),rt(g,"soundSetting",HQ,Ke(g)),rt(g,"vibrateSetting",HZ,Ke(g)),rt(g,"musicSwitch",H$,Ke(g)),rt(g,"soundSwitch",H0,Ke(g)),rt(g,"vibrateSwitch",H1,Ke(g)),rt(g,"closeButtonComponent",H2,Ke(g)),rt(g,"continueButtonComponent",H4,Ke(g)),rt(g,"restartButtonComponent",H3,Ke(g)),rt(g,"challengeFriendsButtonComponent",H5,Ke(g)),rt(g,"animNodes",H6,Ke(g)),g.triggerSequence="",g.handleOpeningScreen=function(E){g.validateSwitchScreenPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateSwitchScreenPayload(E)&&g.open()},g.handleResetSequence=function(){g.triggerSequence=""},g.handleTriggerUnlockKey=function(E){if("code"in E){var _=E.code,k=sF.UNLOCK_SEQUENCE;"number"==typeof _&&-1!==k.indexOf(_.toString())&&(g.triggerSequence+=_.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",_,g.triggerSequence,g.triggerSequence===k),g.triggerSequence===k&&(g.node.scene.emit(sF.Events.UNLOCK_DEV_TOOLS),g.node.off(sF.Events.TRIGGER_UNLOCK_KEY)))}},g.updateVibrateButton=function(){var E=g.vibrateSetting.getComponentInChildren(B),_=g.vibrateSetting.getComponentInChildren(OI),k=g.vibrateSetting.getComponentInChildren(ad);if(E&&_&&k){if(qx.isMobile()){var C,A=null!==(C=qV.getPlayerSetting("vibrate"))&&void 0!==C&&C;_.setEnabled(A)}else E.interactable=!1,_.setEnabled(!1),k.changeState(!1)}else console.warn("SettingsScreen: vibrate button missing components")},g}return Ue(a,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){qK.on(qU.OPENING_SCREEN,this.handleOpeningScreen),qK.on(qU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){qK.off(qU.OPENING_SCREEN,this.handleOpeningScreen),qK.off(qU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(g){return g.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(sF.Events.TRIGGER_UNLOCK_KEY),this.node.on(sF.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(sF.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(sF.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(sF.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(sF.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(a1.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(sF.Events.TRIGGER_RESET_SEQUENCE),lZ.closeScreen(iS[this.node.name])}},{key:"updateStatus",value:function(){var g,E,_,k={music:null!==(g=qV.getPlayerSetting("music"))&&void 0!==g&&g,sound:null!==(E=qV.getPlayerSetting("sound"))&&void 0!==E&&E,vibrate:null!==(_=qV.getPlayerSetting("vibrate"))&&void 0!==_&&_};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(k.music),this.soundSwitch.setEnabled(k.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var g=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(E,_){g.runAppearTween(E,.1*_)})}},{key:"runAppearTween",value:function(g,E){var _=z(g);_.set({scale:new em(0,0,0)}),_.delay(E),_.to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*tZ.elasticOut(k,.1,.45)}}),_.start()}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.continueButtonComponent.interactable=g,this.restartButtonComponent.interactable=g,this.challengeFriendsButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var g=this.musicSwitch.switch();if(qV.setSetting("music",g),this.node.emit(sF.Events.TRIGGER_UNLOCK_KEY,{code:g?1:0}),g){var E=lw.getMatchMode();i8.playMusic(E===qz.TOURNAMENT?ih.TOURNAMENT_MUSIC:ih.BG_MUSIC)}else i8.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var g=this.soundSwitch.switch();qV.setSetting("sound",g),this.node.emit(sF.Events.TRIGGER_UNLOCK_KEY,{code:g?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var g=this.vibrateSwitch.switch();qV.setSetting("vibrate",g)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:this.close();E=(null!==(g=qV.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;k=vs.canShowInterstitialAd();if(!k)return[3,2];return[4,vs.showInterstitialAdAsync({forLevel:_})];case 1:k=C.sent();C.label=2;case 2:lw.getMatchMode()!==qz.TOURNAMENT?(this.node.scene.emit(a1.GAME_RESUME),this.node.scene.emit(a1.GAME_REPLAY,{level:_})):lZ.openScreen(ib.START_OVER_SCREEN);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleClickedChallengeFriends",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if("MsGames"!==GameSDK.getSDKName())return[3,2];lZ.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 1:return[2,(g.sent(),void lZ.closeLoadingScreen())];case 2:this.close(),this.node.scene.emit(a1.INVITE_FRIENDS);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(a1.GAME_RESUME),this.node.scene.emit(a1.SHOW_UI)}}]),a}(M)).prototype,"musicSetting",[HF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HQ=st(HY.prototype,"soundSetting",[HU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HZ=st(HY.prototype,"vibrateSetting",[Hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H$=st(HY.prototype,"musicSwitch",[Hz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H0=st(HY.prototype,"soundSwitch",[HG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H1=st(HY.prototype,"vibrateSwitch",[HV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H2=st(HY.prototype,"closeButtonComponent",[HK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H4=st(HY.prototype,"continueButtonComponent",[HH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H3=st(HY.prototype,"restartButtonComponent",[Hq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H5=st(HY.prototype,"challengeFriendsButtonComponent",[HW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H6=st(HY.prototype,"animNodes",[Hj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HX=HY))||HX);_._RF.pop(),_._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var qH,qq,qW,qj,qX,qY,qJ,qQ,qZ,q$,q0,q1,q2,q4,q3,q5,q6,q8,q9,q7,Wt,Wn,Wi,Wa=k.ccclass,Wr=k.property,Wo=k.requireComponent,Ws=GameCore,Wl=Ws.Events,Wu=Ws.Utils.Device,Wh=Ws.Match.Modes,Wp=Ws.Configs.Debugger.MonitorError,Wd=globalThis.game,Wf=Wd.player,Wy=Wd.event,Wv=Wd.monitorError;qo=Wa("SettingsScreen"),qs=Wo(xW),ql=Wr(C),qu=Wr(C),qc=Wr(C),qp=Wr(OI),qd=Wr(OI),qf=Wr(OI),qy=Wr(B),qv=Wr(B),qg=Wr(B),qm=Wr(B),qb=Wr(C),qo(qw=qs((qE=st((qS=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"musicSetting",qE,Ke(g)),rt(g,"soundSetting",q_,Ke(g)),rt(g,"vibrateSetting",qk,Ke(g)),rt(g,"musicSwitch",qC,Ke(g)),rt(g,"soundSwitch",qA,Ke(g)),rt(g,"vibrateSwitch",qT,Ke(g)),rt(g,"closeButtonComponent",qR,Ke(g)),rt(g,"reportButtonComponent",qP,Ke(g)),rt(g,"shareButtonComponent",qL,Ke(g)),rt(g,"inviteFriendsButtonComponent",qO,Ke(g)),rt(g,"animNodes",qB,Ke(g)),g.triggerSequence="",g.handleOpeningScreen=function(E){g.validateSwitchScreenPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateSwitchScreenPayload(E)&&g.open()},g.handleResetSequence=function(){g.triggerSequence=""},g.handleTriggerUnlockKey=function(E){if("code"in E){var _=E.code,k=sF.UNLOCK_SEQUENCE;"number"==typeof _&&-1!==k.indexOf(_.toString())&&(g.triggerSequence+=_.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",_,g.triggerSequence,g.triggerSequence===k),g.triggerSequence===k&&(g.node.scene.emit(sF.Events.UNLOCK_DEV_TOOLS),g.node.off(sF.Events.TRIGGER_UNLOCK_KEY)))}},g.updateVibrateButton=function(){var E=g.vibrateSetting.getComponentInChildren(B),_=g.vibrateSetting.getComponentInChildren(OI),k=g.vibrateSetting.getComponentInChildren(ad);if(E&&_&&k){if(Wu.isMobile()){var C,A=null!==(C=Wf.getPlayerSetting("vibrate"))&&void 0!==C&&C;_.setEnabled(A)}else E.interactable=!1,_.setEnabled(!1),k.changeState(!1)}else console.warn("SettingsScreen: vibrate button missing components")},g}return Ue(a,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools(),this.reportButtonComponent.node.parent.active=Wp.Feedback}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Wy.on(Wl.OPENING_SCREEN,this.handleOpeningScreen),Wy.on(Wl.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Wy.off(Wl.OPENING_SCREEN,this.handleOpeningScreen),Wy.off(Wl.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(g){return g.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(sF.Events.TRIGGER_UNLOCK_KEY),this.node.on(sF.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(sF.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(sF.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(sF.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(sF.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(a1.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(sF.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(a1.SHOW_UI),lZ.closeScreen(iS[this.node.name])}},{key:"updateStatus",value:function(){var g,E,_,k={music:null!==(g=Wf.getPlayerSetting("music"))&&void 0!==g&&g,sound:null!==(E=Wf.getPlayerSetting("sound"))&&void 0!==E&&E,vibrate:null!==(_=Wf.getPlayerSetting("vibrate"))&&void 0!==_&&_};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(k.music),this.soundSwitch.setEnabled(k.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var g=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(E,_){("ReportButton"!==E.name||Wp.Feedback)&&g.runAppearTween(E,.1*_)})}},{key:"runAppearTween",value:function(g,E){var _=z(g);_.set({scale:new em(0,0,0)}),_.delay(E),_.to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*tZ.elasticOut(k,.1,.45)}}),_.start()}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.reportButtonComponent.interactable=g,this.shareButtonComponent.interactable=g,this.inviteFriendsButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var g=this.musicSwitch.switch();if(Wf.setSetting("music",g),this.node.emit(sF.Events.TRIGGER_UNLOCK_KEY,{code:g?1:0}),g){var E=lw.getMatchMode();i8.playMusic(E===Wh.TOURNAMENT?ih.TOURNAMENT_MUSIC:ih.BG_MUSIC)}else i8.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var g=this.soundSwitch.switch();Wf.setSetting("sound",g),this.node.emit(sF.Events.TRIGGER_UNLOCK_KEY,{code:g?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var g=this.vibrateSwitch.switch();Wf.setSetting("vibrate",g)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedClose",value:function(){this.close()}},{key:"handleClickedReport",value:function(){null==Wv||Wv.feedbackAsync()}},{key:"handleClickedShare",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if("FacebookInstant"!==GameSDK.getSDKName())return[3,2];lZ.showLoadingScreen();return[4,GameSDK.extra.shareBestScoreAsync()];case 1:return[2,(g.sent(),void lZ.closeLoadingScreen())];case 2:this.close();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleClickedInviteFriends",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=GameSDK.getSDKName();switch(g){case"MsGames":return[3,1];case"FacebookInstant":return[3,3]}return[3,5];case 1:lZ.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 2:E.sent(),lZ.closeLoadingScreen();return[3,6];case 3:lZ.showLoadingScreen();return[4,GameSDK.extra.inviteWithBestScoreAsync()];case 4:E.sent(),lZ.closeLoadingScreen();return[3,6];case 5:this.close();E.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"musicSetting",[ql],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q_=st(qS.prototype,"soundSetting",[qu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qk=st(qS.prototype,"vibrateSetting",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qC=st(qS.prototype,"musicSwitch",[qp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qA=st(qS.prototype,"soundSwitch",[qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qT=st(qS.prototype,"vibrateSwitch",[qf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qR=st(qS.prototype,"closeButtonComponent",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qP=st(qS.prototype,"reportButtonComponent",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qL=st(qS.prototype,"shareButtonComponent",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qO=st(qS.prototype,"inviteFriendsButtonComponent",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qB=st(qS.prototype,"animNodes",[qb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qw=qS))||qw);_._RF.pop(),_._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var Wg,Wm,Wb,Ww,WS,WE,W_,Wk,WC,WA,WT,WR,WI,WP,WL,WO,WB,WN,WM,WD,WF=k.ccclass,WU=k.property,Wx=(qH=WF("StarChest"),qq=WU(eo),qW=WU(eu),qj=WU(eV),qX=WU(eu),qY=WU(eu),qJ=WU({type:K,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),qQ=WU({type:K,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),qZ=WU({type:K,displayName:"Centered Offset X",group:"Reward Animations"}),q$=WU({type:K,displayName:"Centered Offset Y",group:"Reward Animations"}),q0=WU({type:K,min:0,displayName:"Starting Scale",group:"Reward Animations"}),q1=WU({type:K,min:0,displayName:"Ending Scale",group:"Reward Animations"}),qH((q3=st((q4=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"sprite",q3,Ke(g)),rt(g,"glowOpacity",q5,Ke(g)),rt(g,"explosionParticles",q6,Ke(g)),rt(g,"circle",q8,Ke(g)),rt(g,"uiOpacity",q9,Ke(g)),g.ogCenterX=0,g.ogCenterY=0,rt(g,"endingOffsetX",q7,Ke(g)),rt(g,"endingOffsetY",Wt,Ke(g)),rt(g,"startingScale",Wn,Ke(g)),rt(g,"endingScale",Wi,Ke(g)),g}return Ue(s,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"moveToCenter",value:(A=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=new em(this.endingOffsetX,this.endingOffsetY,this.node.position.z);return[4,tZ.runTweenAsync(z(this.node).to(.7,{position:E},{easing:"quintInOut"}),g)];case 1:_.sent(),this.node.position=E;return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new em(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(C=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this.startingScale+(this.endingScale-this.startingScale)*g,k=new em(_,_,_);return[4,Promise.all([tZ.runTweenAsync(z(this.sprite.node).to(.2,{scale:k},{easing:"backOut"}),E),tZ.runTweenAsync(z(this.glowOpacity.node).to(.2,{scale:k},{easing:"backOut"}),E)])];case 1:C.sent(),this.sprite.node.setScale(k),this.glowOpacity.node.setScale(k);return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"startShaking",value:function(){var g=this,E=this.node.position.clone();this.shakingTween={ogPos:E,tw:z(this.node).to(.1,{},{onUpdate:function(_,k){if(k){var C=E.x+10*(k-.5);g.node.position=new em(C,E.y,E.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this.sprite.node.scale.clone().multiplyScalar(1.1);return[4,Promise.all([tZ.runTweenAsync(z(this.sprite.node).to(.2,{scale:E},{easing:"cubicInOut"}),g),tZ.runTweenAsync(z(this.glowOpacity.node).to(.2,{scale:E}),g),tZ.runTweenAsync(z(this.glowOpacity).to(.5,{opacity:255}),g)])];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"explode",value:(_=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=new em(8,8,8),k=function(){var k=Be(function(){return _ts_generator(this,function(k){switch(k.label){case 0:E.circle.opacity=255,E.circle.node.setScale(em.ZERO);return[4,Promise.all([tZ.runTweenAsync(z(E.circle).to(.3,{opacity:0}),g),tZ.runTweenAsync(z(E.circle.node).to(.3,{scale:_},{easing:"cubicOut"}),g)])];case 1:k.sent(),E.circle.opacity=0,E.circle.node.scale=_;return[2]}})});return function(){return k.apply(this,arguments)}}(),C=function(){var _=Be(function(){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Promise.all([tZ.runTweenAsync(z(E.glowOpacity.node).to(.3,{scale:em.ZERO},{easing:"cubicOut"}),g),tZ.runTweenAsync(z(E.sprite.node).to(.3,{scale:em.ZERO},{easing:"cubicOut"}),g)])];case 1:_.sent(),E.sprite.node.setScale(em.ZERO),E.glowOpacity.node.setScale(em.ZERO);return[2]}})});return function(){return _.apply(this,arguments)}}();return[4,Promise.all([this.explodeParticles(g),k(),C()])];case 1:A.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"explodeParticles",value:(E=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=g.aborted;if(E)return[3,2];this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem();return[4,tZ.waitTweenAsync(1)];case 1:E=(_.sent(),this.explosionParticles.node.active=!1);_.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),s}(M)).prototype,"sprite",[qq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q5=st(q4.prototype,"glowOpacity",[qW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q6=st(q4.prototype,"explosionParticles",[qj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q8=st(q4.prototype,"circle",[qX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q9=st(q4.prototype,"uiOpacity",[qY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(q4.prototype,"startingOffsetX",[qJ],Object.getOwnPropertyDescriptor(q4.prototype,"startingOffsetX"),q4.prototype),st(q4.prototype,"startingOffsetY",[qQ],Object.getOwnPropertyDescriptor(q4.prototype,"startingOffsetY"),q4.prototype),q7=st(q4.prototype,"endingOffsetX",[qZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wt=st(q4.prototype,"endingOffsetY",[q$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wn=st(q4.prototype,"startingScale",[q0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Wi=st(q4.prototype,"endingScale",[q1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),q2=q4))||q2);_._RF.pop(),_._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var Wz,WG,WV,WK,WH,Wq,WW,Wj,WX,WY,WJ,WQ,WZ,W$,W0=k.ccclass,W1=k.property,W2=k.requireComponent,W4=GameCore.Events,W3=globalThis.game,W5=W3.event,W6=W3.player;Wg=W0("StarChestScreen"),Wm=W2(xW),Wb=W1(Rx),Ww=W1(B),WS=W1(B),WE=W1(G),W_=W1(Wx),Wk=W1(eu),WC=W1(kN),WA=W1(P),Wg(WT=Wm((WI=st((WR=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"starProgressBar",WI,Ke(g)),rt(g,"openButton",WP,Ke(g)),rt(g,"continueButton",WL,Ke(g)),rt(g,"chestAnimation",WO,Ke(g)),rt(g,"starChest",WB,Ke(g)),rt(g,"chestUnlockFXMask",WN,Ke(g)),rt(g,"skipOverlay",WM,Ke(g)),rt(g,"messageLabel",WD,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StarChestScreen: screen not found");g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){W5.on(W4.OPENING_SCREEN,this.handleOpeningScreen),W5.on(W4.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){W5.off(W4.OPENING_SCREEN,this.handleOpeningScreen),W5.off(W4.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(a1.HIDE_UI);var g=W6.getGameData();if(g){var E=g.stars;this.numChestAvailable=Math.floor(E/20),this.starProgressBar.setRange(E,20);var _=this.numChestAvailable>0;this.setInteractableButtons(!0),this.openButton.node.active=_,this.openButton.interactable=_,this.continueButton.node.active=!_,this.continueButton.interactable=!_,this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){W5.emit(W4.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(a1.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(C=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!(0!==this.numChestAvailable))return[3,5];i8.turnDownMusic();g=W6.getGameData();if(!g)return[3,4];this.setInteractableButtons(!1);E=g.stars;W6.setGameData({stars:g.stars-20*this.numChestAvailable});_=new nM;return[4,this.skipOverlay.open({opacity:200,onSkip:function(){return _.abort()}})];case 1:k.sent();return[4,this.handleUnlockAnimation(E,g.stars,_)];case 2:k.sent();return[4,this.skipOverlay.close()];case 3:k.sent(),i8.turnUpMusic(),Q.emit(nR),this.close();k.label=4;case 4:return[3,6];case 5:this.close();k.label=6;case 6:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(k=Be(function(g,E,_){var k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:k=this;return[4,Promise.all([this.starChest.moveToCenter(_),this.fadeInChestUnlockFX(_)])];case 1:R.sent(),this.chestAnimation.stop(),this.starChest.startShaking();return[4,i8.playSound(ih.STAR_CHEST_DRUM_ROLL,{loop:!0})];case 2:R.sent();return[4,tZ.waitTweenAsync(0)];case 3:R.sent();C=g,A=this.numChestAvailable;return[4,Promise.all([this.starProgressBar.animateTo(E,_,function(g){var E;C-g>=20&&(C=g,A--,k.starChest.scale((E=A,k.numChestAvailable>2?1-E/k.numChestAvailable:.35*(1-E/k.numChestAvailable)),_),i8.playSound(ih.STAR_CHEST_OPEN))})])];case 4:R.sent();return[4,tZ.waitTweenAsync(1,_)];case 5:R.sent(),this.starChest.stopShaking();return[4,this.starChest.glow(_)];case 6:R.sent(),i8.stopSound(ih.STAR_CHEST_DRUM_ROLL);T=sP*this.numChestAvailable;this.node.scene.emit(a1.ADD_COINS,{coins:T,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:_},skipAnimation:!0});return[4,this.starChest.explode(_)];case 7:R.sent();return[4,tZ.waitTweenAsync(1,_)];case 8:R.sent();return[4,Promise.all([this.fadeOutChestUnlockFX(_)])];case 9:R.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.chestUnlockFXMask.node.active=!0;return[4,tZ.runTweenAsync(z(this.chestUnlockFXMask).to(.5,{opacity:150}),g)];case 1:E.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runTweenAsync(z(this.chestUnlockFXMask).to(.3,{opacity:0}),g)];case 1:E.sent(),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1;return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setInteractableButtons",value:function(g){this.openButton.interactable=g,this.continueButton.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),r}(M)).prototype,"starProgressBar",[Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WP=st(WR.prototype,"openButton",[Ww],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WL=st(WR.prototype,"continueButton",[WS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WO=st(WR.prototype,"chestAnimation",[WE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WB=st(WR.prototype,"starChest",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WN=st(WR.prototype,"chestUnlockFXMask",[Wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WM=st(WR.prototype,"skipOverlay",[WC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WD=st(WR.prototype,"messageLabel",[WA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WT=WR))||WT);_._RF.pop(),_._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);var W8,W9,W7,jt,ji,ja,jr,jo,js=k.ccclass,jl=k.property,ju=k.requireComponent,jc=GameCore.Events,jp=globalThis.game.event;Wz=js("StartLevelScreen"),WG=ju(xW),WV=jl(C),WK=jl(C),WH=jl(C),Wq=jl(C),WW=jl(B),Wz(Wj=WG((WY=st((WX=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"playButton",WY,Ke(g)),rt(g,"goalText",WJ,Ke(g)),rt(g,"levelText",WQ,Ke(g)),rt(g,"missionText",WZ,Ke(g)),rt(g,"playButtonComponent",W$,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StartLevelScreen: screen not found");g.validateEventPayload(E)&&(g.playButtonComponent.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){jp.on(jc.OPENING_SCREEN,this.handleOpeningScreen),jp.on(jc.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){jp.off(jc.OPENING_SCREEN,this.handleOpeningScreen),jp.off(jc.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){var E=null!=g?g:{},_=E.screenName,k=E.screenData;return _===this.node.name&&(null!=k&&k.level&&(this.levelId=k.level),null!=k&&k.mission&&(this.mission=k.mission),!0)}},{key:"open",value:function(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(a1.HIDE_UI)}},{key:"close",value:function(){this.playButtonComponent.interactable=!1,jp.emit(jc.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(a1.SHOW_UI)}},{key:"updateComponents",value:function(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}},{key:"updateGoalText",value:function(){var g=this.mission.mission;this.goalText.getComponent(P).string=g>1?"Goals":"Goal"}},{key:"updateLevelText",value:function(){this.levelText.getComponent(P).string="Level ".concat(this.levelId)}},{key:"updateDescriptionText",value:function(){this.missionText.getComponent(P).string=this.mission.description}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedPlay",value:function(){this.node.scene.emit(a1.GAME_START),this.close()}}]),n}(M)).prototype,"playButton",[WV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WJ=st(WX.prototype,"goalText",[WK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WQ=st(WX.prototype,"levelText",[WH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WZ=st(WX.prototype,"missionText",[Wq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W$=st(WX.prototype,"playButtonComponent",[WW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wj=WX))||Wj);_._RF.pop(),_._RF.push({},"2f7694kcVZNWq3iTCp1piqI","StartOverScreen",void 0);var jd,jf,jy,jv,jg,jm=k.ccclass,jb=k.property,jw=k.requireComponent,jS=GameCore.Events,jE=globalThis.game,j_=jE.event,jk=jE.player;W8=jm("StartOverScreen"),W9=jw(xW),W7=jb(B),jt=jb(B),W8(ji=W9((jr=st((ja=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"restartButton",jr,Ke(g)),rt(g,"cancelButton",jo,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){j_.on(jS.OPENING_SCREEN,this.handleOpeningScreen),j_.on(jS.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){j_.off(jS.OPENING_SCREEN,this.handleOpeningScreen),j_.off(jS.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(a1.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),lZ.closeScreen(iS[this.node.name])}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.restartButton.interactable=g,this.cancelButton.interactable=g}},{key:"handleClickedCancel",value:function(){this.close(),this.node.scene.emit(a1.GAME_RESUME),this.node.scene.emit(a1.SHOW_UI)}},{key:"handleClickedRestart",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){this.close();E=(null!==(g=jk.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;this.node.scene.emit(a1.GAME_RESUME),this.node.scene.emit(a1.GAME_REPLAY,{level:_});return[2]})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"restartButton",[W7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jo=st(ja.prototype,"cancelButton",[jt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ji=ja))||ji);_._RF.pop(),_._RF.push({},"d6d78U+W5xDwqln9pXXQOaF","TopLeaders",void 0);var jC,jA,jT,jR,jI,jP=k.ccclass,jL=k.property,jO=(jd=jP("TopLeaders"),jf=jL(MP),jd((jg=st((jv=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"topLeaders",jg,Ke(g)),g.leaderData=[],g}return Ue(i,[{key:"updateData",value:function(g){var E=this;this.leaderData=g.slice(0,3),this.leaderData.slice(0,3).forEach(function(g,_){E.topLeaders[_].updateInfo({playerId:g.playerId,name:g.name,photo:g.photo,score:g.score})})}},{key:"playShowLeadersAnimation",value:(E=Be(function(g){var E,_,k;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=C.length>1&&void 0!==C[1]?C[1]:.1,k=.3;return[4,Promise.all(this.leaderData.map(function(){var C=Be(function(C,A){var T;return _ts_generator(this,function(C){switch(C.label){case 0:T=E.topLeaders[A];return[4,T.runShowUpAnimation(A*_,k,g)];case 1:C.sent();return[2]}})});return function(g,E){return C.apply(this,arguments)}}()))];case 1:A.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"hideLeaders",value:function(){var g,E=at(this.topLeaders);try{for(E.s();!(g=E.n()).done;)g.value.setVisible(!1)}catch(g){E.e(g)}finally{E.f()}}}]),i}(M)).prototype,"topLeaders",[jf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jy=jv))||jy);_._RF.pop(),_._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var jB,jN,jM,jD,jF,jU,jx,jz,jG,jV,jK,jH,jq,jW,jj,jX,jY,jJ,jQ,jZ,j$,j0,j1,j2,j4,j3,j5,j6,j8,j9,j7,Xt,Xn,Xi,Xa,Xr,Xo,Xs,Xl,Xu,Xc,Xp=k.ccclass,Xd=k.property,Xf=(jC=Xp("TournamentLeaderSkeleton"),jA=Xd(C),jC((jI=st((jR=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",jI,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,tZ.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;_=this.container.position.clone();this.container.position=new em(_.x,_.y-100,_.z);k=z(this.node).delay(g);k.to(.2,{scale:em.ONE},{easing:"elasticOut"});C=z(this.container).delay(g);C.to(.2,{position:_},{easing:"backOut"});A=z(this.uiOpacity).delay(g);A.to(.2,{opacity:255},{easing:"cubicOut"});return[4,Promise.all([tZ.runTweenAsync(k,E),tZ.runTweenAsync(C,E),tZ.runTweenAsync(A,E)])];case 1:T.sent(),this.node.scale=em.ONE,this.container.position=_,this.uiOpacity.opacity=255;return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(M)).prototype,"container",[jA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jT=jR))||jT);_._RF.pop(),_._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var Xv=k.ccclass,Xg=k.property,Xm=k.requireComponent,Xb=GameCore,Xw=Xb.Events,XS=Xb.Utils,XE=XS.Object,X_=XS.Time,Xk=XS.Number,XC=globalThis.game,XA=XC.event,XT=XC.storage,XR=XC.player,XI=XC.leaderboard,XP=1166;jB=Xv("TournamentDetailScreen"),jN=Xm(xW),jM=Xg(P),jD=Xg(P),jF=Xg(P),jU=Xg(Nk),jx=Xg(jO),jz=Xg({type:C,group:"Buttons"}),jG=Xg({type:C,group:"Buttons"}),jV=Xg({type:C,group:"Buttons"}),jK=Xg({type:eo}),jH=Xg({type:C}),jq=Xg({type:C}),jW=Xg({type:[Xf]}),jj=Xg(yn),jX=Xg({type:R,group:"Container"}),jY=Xg({type:R,group:"Container"}),jJ=nC.onlyRunInLifeCycleAsync,jQ=nC.onlyRunInLifeCycleAsync,jZ=nC.onlyRunInLifeCycleAsync,j$=nC.onlyRunInLifeCycleAsync,j0=nC.onlyRunInLifeCycleAsync,j1=nC.onlyRunInLifeCycle,j2=nC.onlyRunInLifeCycle,jB(j4=jN((j5=st((j3=function(g){ze(v,g);var E,_,k,C,A,T,R,I,P,L,O,N,M,D=Xe(v);function v(){var g;Fe(this,v);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=D.call.apply(D,[this].concat(_)),"titleLabel",j5,Ke(g)),rt(g,"timeLabel",j6,Ke(g)),rt(g,"playerCountLabel",j8,Ke(g)),rt(g,"tournamentLeaders",j9,Ke(g)),rt(g,"topLeaders",j7,Ke(g)),rt(g,"playButton",Xt,Ke(g)),rt(g,"continueButton",Xn,Ke(g)),rt(g,"replayButton",Xi,Ke(g)),rt(g,"banner",Xa,Ke(g)),rt(g,"bannerLoadingRing",Xr,Ke(g)),rt(g,"bannerMask",Xo,Ke(g)),rt(g,"leaderSkeletons",Xs,Ke(g)),rt(g,"paperConfetti",Xl,Ke(g)),rt(g,"container",Xu,Ke(g)),rt(g,"tempContainer",Xc,Ke(g)),g.signal=new nM,g.leadersPayload=null,g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("TournamentDetailScreen: screen not found");g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(v,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xW),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){XA.on(Xw.OPENING_SCREEN,this.handleOpeningScreen),XA.on(Xw.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){XA.off(Xw.OPENING_SCREEN,this.handleOpeningScreen),XA.off(Xw.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.updateContainer(),this.setInteractableButtons(!0),this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders(),this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(a1.HIDE_UI),this.updateInfo()}},{key:"close",value:function(){lZ.closeTournamentDetailScreen(),this.setInteractableButtons(!1),this.node.scene.emit(a1.SHOW_UI),this.cleanup()}},{key:"cleanup",value:function(){var g;null===(g=this.signal)||void 0===g||g.abort(),this.signal=new nM,this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(M=Be(function(){var g,E,_,k,C,A,T,R,I,P,L,O,B,N,M,D,F,U,x,z,G,V,K,H,q,W,j,X,Y,J;return _ts_generator(this,function(Q){switch(Q.label){case 0:T=this,R=this.signal,I=null===(g=this.payload)||void 0===g||null===(g=g.screenData)||void 0===g?void 0:g.tournament;if(!I)return[3,9];P=null===(E=null===(_=this.payload.screenData)||void 0===_?void 0:_.playAnimation)||void 0===E||E,L=JSON.parse(I);L.id=L.id.toString(),this.tournamentPayload=L;O=this.tournamentPayload,B=O.endTime,N=O.payload,M=O.title,D=N.leaderboardId,F=void 0===D?"":D,U=N.themeId;this.updateTitle(M),this.updateEndTime(B),this.updateTournamentBanner(U,R);x=XT.getStorage("tournament"),z=x.previousScore,G=x.animateTournamentLeader;XT.setStorageData("tournament","animateTournamentLeader",!1),this.updateButtonsVisibility(G);return[4,this.showLoading(R)];case 1:Q.sent();return[4,this.loadLeaders(F)];case 2:if(Q.sent(),!!this.leadersPayload&&0!==this.leadersPayload.leaders.length&&!R.aborted)return[3,4];this.updatePlayerCount(0);return[4,this.hideLoading(R)];case 3:return[2,void Q.sent()];case 4:V=this.leadersPayload,K=V.player,H=V.amountPlayer,q=null!==(k=this.leadersPayload.leaders)&&void 0!==k?k:[];q.sort(function(g,E){return g.rank-E.rank});return[4,this.hideLoading(R)];case 5:if(Q.sent(),!this.topLeaders||!this.tournamentLeaders||!!R.aborted)return[3,9];this.updatePlayerCount(H),this.topLeaders.updateData(q),this.topLeaders.playShowLeadersAnimation(R);W=null!==(C=null==K?void 0:K.score)&&void 0!==C?C:0,j=null!==(A=null==K?void 0:K.rank)&&void 0!==A?A:0,X=G&&-1!==z&&z<W;this.tournamentLeaders.updateData(q);Y=!1;K&&X&&(Y=this.tournamentLeaders.updateDisplayPlayerLeaderForRankChanging(z,W,j)),this.tournamentLeaders.initScrollViews(),this.tournamentLeaders.scrollView.scrollView.enabled=!0;return[4,R.callAsync(function(g){return T.runShowUpAnimation(g,P)})];case 6:Q.sent();J=G&&Y&&-1!==z&&this.tournamentLeaders;if(!J)return[3,8];return[4,R.callAsync(function(g){return T.tournamentLeaders.playRankChangeAnimation(g,z,W,j)})];case 7:J=(Q.sent(),this.tryPlayConfettiEffect(j));Q.label=8;case 8:Q.label=9;case 9:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"updateContainer",value:(N=Be(function(){var g;return _ts_generator(this,function(E){g=this.tempContainer.height;this.container.node.position=this.tempContainer.node.position.clone(),g<XP&&this.container.height!==g?(this.container.height=g,eb.instance.emit("canvas-resize")):g>XP&&this.container.height<XP&&(this.container.height=XP,eb.instance.emit("canvas-resize"));return[2]})}),function(){return N.apply(this,arguments)})},{key:"loadLeaders",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,this.getLeadersPayload(g)];case 1:E.leadersPayload=_.sent();return[2]}})}),function(g){return O.apply(this,arguments)})},{key:"showLoading",value:(L=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=k.length>1&&void 0!==k[1]?k[1]:0;return[4,Promise.all([this.tournamentLeaders.scrollView.unlistenEvents(),this.tournamentLeaders.scrollView.scrollToTop(g,.1).then(function(){E.tournamentLeaders.scrollView.scrollView.enabled=!1,E.tournamentLeaders.scrollView.listenEvents()}),this.leaderSkeletons.map(function(E,k){return E.show(k*_,g)})])];case 1:C.sent();return[2]}})}),function(g){return L.apply(this,arguments)})},{key:"hideLoading",value:(P=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(E){return E.hide(g)}))];case 1:E.sent();return[2]}})}),function(g){return P.apply(this,arguments)})},{key:"runShowUpAnimation",value:(I=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=!(k.length>1&&void 0!==k[1])||k[1],_=E?0:.1;return[4,this.tournamentLeaders.playShowLeadersAnimation(g,_)];case 1:C.sent();return[4,this.tournamentLeaders.scrollToPlayerLeader(1.5,g)];case 2:C.sent();return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"tryPlayConfettiEffect",value:function(g){if(!(g>10)){var E,_=at(this.paperConfetti);try{for(_.s();!(E=_.n()).done;)E.value.play()}catch(g){_.e(g)}finally{_.f()}i8.playSound(ih.LEADERBOARD_TRIUMPH)}}},{key:"updateTitle",value:function(g){g&&(this.titleLabel.string=g)}},{key:"updateEndTime",value:function(g){var E=X_.getRelativeTime(g);E=(E=E.replace("seconds","secs").replace("second","sec")).replace("minutes","mins").replace("minute","min"),this.timeLabel.string="Ends ".concat(E)}},{key:"updateTournamentBanner",value:(R=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.banner.spriteFrame=null;_=ie.getAsset("".concat(nx[g],"/spriteFrame"),er);k=_;if(k)return[3,2];this.bannerMask.active=!0,this.bannerLoadingRing.active=!0;return[4,ie.loadThemeTournamentAsync(g)];case 1:k=_=A.sent();A.label=2;case 2:C=_;if(C)return[3,4];return[4,ie.loadThemeTournamentAsync(s9.SUMMER)];case 3:C=_=A.sent();A.label=4;case 4:this.banner&&_&&!E.aborted&&(this.banner.spriteFrame=_,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1);return[2]}})}),function(g,E){return R.apply(this,arguments)})},{key:"updatePlayerCount",value:function(g){var E=Xk.getShortNumber(g,3);this.playerCountLabel.string="".concat(E," ").concat(g>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"getLeadersPayload",value:(T=Be(function(g){var E,_,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:E=XI.getLeaderboardName(g);if(!E)return[2,null];return[4,s6.getAllLeaderboardAsync(g)];case 1:_=L.sent();if(!_)return[2,null];C=XE.vals(_.leaders),A=XR.getPlayerId(),T={leaders:[],amountPlayer:_.amountPlayer},R=at(C);try{for(R.s();!(k=R.n()).done;){I=k.value;I.playerId===A?(T.player=I,T.leaders.push(I)):T.leaders.push(I)}}catch(g){R.e(g)}finally{R.f()}if(!!T.player)return[3,3];return[4,XI.getLeadersByPlayerIdsAsync(E,[A])];case 2:P=L.sent();P&&P.length>0&&(T.player=P[0],T.leaders.push(P[0]));L.label=3;case 3:return[2,T]}})}),function(g){return T.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(g){this.playButton.active=!g,this.continueButton.active=g,this.replayButton.active=g}},{key:"handleOnPlay",value:(A=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.tournamentPayload.id||"";if(l9.validateTournamentExpired(g))return[2,(this.close(),this.node.scene.emit(sJ.RELOAD_TOURNAMENT),void lZ.showNotificationScreen("Tournament has ended",2))];k.label=1;case 1:k.trys.push([1,4,9,10]);lZ.showLoadingScreen();return[4,lw.setMatchCustomDataAsync({level:1,score:0})];case 2:k.sent();return[4,this.processJoinTournament()];case 3:k.sent();return[3,10];case 4:E=k.sent();if(XE.hasOwn(E,"code")&&"USER_INPUT"===E.code)return[2];k.label=5;case 5:k.trys.push([5,7,,8]);return[4,this.processContinueTournament()];case 6:k.sent();return[3,8];case 7:_=k.sent();if(XE.hasOwn(_,"code")&&"USER_INPUT"===_.code)return[2];console.error("processPlayButtonPressed",_),lZ.showNotificationScreen("Sorry, you cannot join\nat this time.",2);return[3,8];case 8:return[3,10];case 9:lZ.closeLoadingScreen();return[7];case 10:return[2]}})}),function(){return A.apply(this,arguments)})},{key:"processJoinTournament",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,this.joinTournamentAsync()];case 1:E.sent(),lM.switchScene(sj,{level:1});return[3,3];case 2:g=E.sent();throw console.warn("processJoinTournament",g),g;case 3:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"processContinueTournament",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,this.continueTournamentAsync()];case 1:E.sent(),lM.switchScene(sj,{level:1});return[3,3];case 2:g=E.sent();throw console.warn("processContinueTournament",g),g;case 3:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"joinTournamentAsync",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.tournamentPayload.id||"";return[4,lw.joinTournamentAsync(g)];case 1:E.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"continueTournamentAsync",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:E=null!==(g=GameSDK.context.getID())&&void 0!==g?g:"";return[4,lw.continueTournamentAsync(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var g,E,_=(null!==(g=null===(E=this.payload)||void 0===E?void 0:E.screenData)&&void 0!==g?g:{}).tournamentContextType;switch(void 0===_?"tournament_start":_){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}},{key:"setInteractableButtons",value:function(g){this.screen.backgroundMask.getComponent(B).interactable=g}}]),v}(M)).prototype,"titleLabel",[jM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j6=st(j3.prototype,"timeLabel",[jD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j8=st(j3.prototype,"playerCountLabel",[jF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j9=st(j3.prototype,"tournamentLeaders",[jU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j7=st(j3.prototype,"topLeaders",[jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xt=st(j3.prototype,"playButton",[jz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xn=st(j3.prototype,"continueButton",[jG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xi=st(j3.prototype,"replayButton",[jV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xa=st(j3.prototype,"banner",[jK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xr=st(j3.prototype,"bannerLoadingRing",[jH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xo=st(j3.prototype,"bannerMask",[jq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xs=st(j3.prototype,"leaderSkeletons",[jW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xl=st(j3.prototype,"paperConfetti",[jj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xu=st(j3.prototype,"container",[jX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xc=st(j3.prototype,"tempContainer",[jY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(j3.prototype,"updateInfo",[jJ],Object.getOwnPropertyDescriptor(j3.prototype,"updateInfo"),j3.prototype),st(j3.prototype,"loadLeaders",[jQ],Object.getOwnPropertyDescriptor(j3.prototype,"loadLeaders"),j3.prototype),st(j3.prototype,"showLoading",[jZ],Object.getOwnPropertyDescriptor(j3.prototype,"showLoading"),j3.prototype),st(j3.prototype,"hideLoading",[j$],Object.getOwnPropertyDescriptor(j3.prototype,"hideLoading"),j3.prototype),st(j3.prototype,"runShowUpAnimation",[j0],Object.getOwnPropertyDescriptor(j3.prototype,"runShowUpAnimation"),j3.prototype),st(j3.prototype,"tryPlayConfettiEffect",[j1],Object.getOwnPropertyDescriptor(j3.prototype,"tryPlayConfettiEffect"),j3.prototype),st(j3.prototype,"updatePlayerCount",[j2],Object.getOwnPropertyDescriptor(j3.prototype,"updatePlayerCount"),j3.prototype),j4=j3))||j4);_._RF.pop(),_._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,k.ccclass)("TournamentLeader")(function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n)}(B2));_._RF.pop(),_._RF.push({},"0b4bc6YT6ZGg4lnXfh/zL6J","AdsManager",void 0);var XL=GameCore,XO=XL.Events,XB=XL.Configs,XN=XL.Utils.Time,XM=globalThis.game,XD=XM.ads,XF=XM.player,XU=XM.event,Xx=function(){function e(){var g=this;Fe(this,e),this.currentLayout="",this.handleShowBannerAds=function(E){E.sceneName!==sW&&(XF.isFirstLogin()||(vs.showBannerAds(),XU.off(XO.SCENE_LAUNCHED,g.handleShowBannerAds)))},this.handleWhenGameReady=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,g.handleShowInterstitialAdWhenGameReady()];case 1:E.sent();return[4,XN.sleepAsync(2e3)];case 2:E.sent(),vs.preloadAds();return[2]}})}),this.handleShowInterstitialAdWhenGameReady=Be(function(){var E,_,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:E=XB.Ads,_=E.Enabled,k=E.ShowAdOnLoad;if(!_)return[3,6];C=k.Enabled,A=k.DelaySeconds,T=k.PlacementId;if(!C)return[3,6];L.label=1;case 1:L.trys.push([1,5,,6]);R=A>0;if(!R)return[3,3];return[4,XN.sleepAsync(1e3*A)];case 2:R=L.sent();L.label=3;case 3:I=XD.getAdByPlacementId(T);if(!I)return[2];return[4,g.showAdByConfig(I)];case 4:L.sent();return[3,6];case 5:P=L.sent();console.warn("handleShowAdWhenLoadGame failed",P);return[3,6];case 6:return[2]}})}),this.handleLayoutChanged=function(E){if(g.currentLayout!==E){g.currentLayout=E;var _=XB.Ads.BannerDisplayAdOptions;E!==ag.Landscape?_.forEach(function(g){var E=g.PlacementId,_=g.Position;"bottom"===_||"top"===_?vs.showBannerAd(E):vs.hideBannerAd(E)}):vs.showBannerAds()}}}var g;return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Ads Manager: Initialized")}},{key:"listenEvents",value:function(){Q.on(t6,this.handleLayoutChanged),XU.on(XO.SCENE_LAUNCHED,this.handleShowBannerAds),XU.once(XO.GAME_READY,this.handleWhenGameReady)}},{key:"showAdByConfig",value:(g=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,3,4,5]);E=g.type,_=g.placementId;return[4,XD.loadAdAsync(E,_)];case 1:C.sent(),i8.muteAudio(!0);return[4,XD.showAdAsync(E,_)];case 2:C.sent();return[3,5];case 3:k=C.sent();console.warn("showAdByConfig failed",k);return[3,5];case 4:Q.resume(),i8.muteAudio(!1);return[7];case 5:return[2]}})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var Xz=GameCore.Events,XG=globalThis.game,XV=XG.event,XK=XG.monitorError,XH=function(){function e(){var g=this;Fe(this,e),this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=function(){if(!g.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void(null==XK||XK.sendException(new Error("Core: Booting callback is not set")));console.info("\uD83D\uDE80 Core: Boot"),g.callbackCoreBooting(),g.callbackCoreBooting=null},this.handleWhenCoreStarting=function(){if(!g.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void(null==XK||XK.sendException(new Error("Core: Starting callback is not set")));console.info("\uD83D\uDE80 Core: Starting"),g.callbackCoreStarting(),g.callbackCoreStarting=null},this.handleWhenCoreReady=function(){if(!g.callbackCoreReady)return console.error("Core: Ready callback is not set"),void(null==XK||XK.sendException(new Error("Core: Ready callback is not set")));console.info("\uD83D\uDE80 Core: Ready"),g.callbackCoreReady(),g.callbackCoreReady=null}}return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Core Manager: Initialized")}},{key:"listenEvents",value:function(){XV.once(Xz.CORE_BOOTING,this.handleWhenCoreBooting),XV.once(Xz.CORE_STARTING,this.handleWhenCoreStarting),XV.once(Xz.CORE_READY,this.handleWhenCoreReady)}},{key:"requestStart",value:function(){XV.emit(Xz.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(g){this.callbackCoreBooting=g,XV.getEventEmitCount(Xz.CORE_BOOTING)>0&&(XV.off(Xz.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}},{key:"onCoreStart",value:function(g){this.callbackCoreStarting=g,XV.getEventEmitCount(Xz.CORE_STARTING)>0&&(XV.off(Xz.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}},{key:"onCoreReady",value:function(g){this.callbackCoreReady=g,XV.getEventEmitCount(Xz.CORE_READY)>0&&(XV.off(Xz.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}]),e}();_._RF.pop(),_._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var Xq=GameCore,XW=Xq.Events,Xj=Xq.Configs.GameEngine.DynamicAtlas,XX=Xq.Utils,XY=XX.Valid,XJ=XX.Device,XQ=globalThis.game.event,XZ=function(){function e(){var g=this;Fe(this,e),this.handlePauseEngine=Be(function(){return _ts_generator(this,function(g){console.info("Engine: Paused",Q.isPaused()),Q.isPaused();return[2]})}),this.handleResumeEngine=Be(function(){return _ts_generator(this,function(g){console.info("Engine: Resumed",Q.isPaused()),Q.isPaused();return[2]})}),this.handleResizeView=function(E){eb.instance.resizeWithBrowserSize(!1);var _=E.width,k=E.height;g.resizeView(_,k)},this.handleViewResized=function(g){var E=g.width,_=g.height;eb.instance.resizeWithBrowserSize(!0),console.info(" New View Size",{width:E,height:_})}}var g;return Ue(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.setupAssetDownloader(),this.setupOptimalPipelines(),this.setupEngineRunningState(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){Q.on(t4,this.handleResizeView),Q.on(t3,this.handleViewResized)}},{key:"overrideSettings",value:function(){eW.overrideSettings(ej.Category.ENGINE,"debug",XY.isDebugger()),Q.frameRate=XJ.isDesktop()?60:48}},{key:"setupAutoAtlas",value:function(){eX.instance.cacheAsset=!0}},{key:"setupAssetDownloader",value:function(){var g=eX.instance.downloader;g.maxConcurrency=10,g.maxRequestsPerFrame=6}},{key:"getPipelineFlows",value:function(){var g,E;return null!==(g=null===(E=N.root)||void 0===E||null===(E=E.pipeline)||void 0===E?void 0:E.flows)&&void 0!==g?g:[]}},{key:"getRenderQueues",value:function(g){var E=this.getPipelineFlows()[0];return null!=E&&E.stages?E.stages[g].renderQueues:[]}},{key:"setupOptimalPipelines",value:(g=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:eX.instance.transformPipeline.remove(1);return[4,XY.isValueChangeAsync(function(){return!!N.root},!0,{timeout:1e4})];case 1:_.sent();g=this.getPipelineFlows();g.shift(),g.shift();E=this.getRenderQueues(0);E.shift(),E.shift();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"setupEngineRunningState",value:function(){var g=this;eY.on(ep.EventType.TOUCH_START,this.handleResumeEngine),XQ.once(XW.GAME_READY,function(){XQ.on(XW.VISIBILITY_HIDDEN,g.handlePauseEngine),XQ.on(XW.VISIBILITY_VISIBLE,g.handleResumeEngine)})}},{key:"setupDynamicAtlas",value:function(){switch(ev.os){case ev.OS.IOS:this.setupDynamicAtlasForIOS();break;case ev.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(g){var E=g.Enabled,_=g.AutoAtlasSize,k=g.MaxAtlasCount,C=g.MaxAtlasSize,A=g.MaxFrameSize;if(eJ.CLEANUP_IMAGE_CACHE=!1,eQ.instance.enabled=E,eQ.instance.textureSize=C,eQ.instance.maxFrameSize=A,eQ.instance.maxAtlasCount=k,eQ.instance.textureBleeding=!0,_){var T=this.getMaxTextureSize();if(!T)return;eQ.instance.maxAtlasCount=1,eQ.instance.textureSize=T}}},{key:"getMaxTextureSize",value:function(){if(!N.root)return -1;var g=N.root.device.capabilities.maxTextureSize,E=1024;return g-E<=eQ.instance.maxFrameSize?-1:g>8192?7168:g-E}},{key:"setupDynamicAtlasForIOS",value:function(){var g=Xj.IOS;this.setDynamicAtlas(g)}},{key:"setupDynamicAtlasForAndroid",value:function(){var g=Xj.Android;this.setDynamicAtlas(g)}},{key:"setupDynamicAtlasForDesktop",value:function(){var g=Xj.Desktop;this.setDynamicAtlas(g)}},{key:"setupBatcherLimit",value:function(){eJ.BATCHER2D_MEM_INCREMENT=288,eJ.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(g,E){var _,k=window.devicePixelRatio,C=k>=2?2/k:1,A=g*k*C,T=E*k*C;null===(_=N.root)||void 0===_||_.resize(A,T),j.windowSize=new X.Size(A,T),N.once(e_.EVENT_AFTER_UPDATE,function(){Q.emit(t3,{width:A,height:T})})}}]),e}();_._RF.pop();var X$,X0=new(function(){function e(){Fe(this,e),this._registry={},this._moduleCache={}}return Ue(e,[{key:"define",value:function(g,E,_){this._registry[g]={factory:E,resolveMap:_}}},{key:"require",value:function(g){return this._require(g)}},{key:"throwInvalidWrapper",value:function(g,E){throw new Error("Module '".concat(g,"' imported from '").concat(E,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(g,E){var _=this._moduleCache[g];if(_)return _.exports;var k={id:g,exports:{}};return this._moduleCache[g]=k,this._tryModuleLoad(k,g),k.exports}},{key:"_resolve",value:function(g,E){return this._resolveFromInfos(g,E)||this._throwUnresolved(g,E)}},{key:"_resolveFromInfos",value:function(g,E){var _,k;return g in cjsInfos?g:E&&null!==(_=null===(k=cjsInfos[E])||void 0===k?void 0:k.resolveCache[g])&&void 0!==_?_:void 0}},{key:"_tryModuleLoad",value:function(g,E){var _=!0;try{this._load(g,E),_=!1}finally{_&&delete this._moduleCache[E]}}},{key:"_load",value:function(g,E){var _=this._loadWrapper(E),k=_.factory,C=_.resolveMap,A=this._createRequire(g),T=C?this._createRequireWithResolveMap("function"==typeof C?C():C,A):A;k(g.exports,T,g)}},{key:"_loadWrapper",value:function(g){return g in this._registry?this._registry[g]:this._loadHostProvidedModules(g)}},{key:"_loadHostProvidedModules",value:function(g){return{factory:function(E,_,k){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(g,"'."));try{k.exports=require(g)}catch(E){throw new Error("Exception thrown when calling host defined require('".concat(g,"')."),{cause:E})}}}}},{key:"_createRequire",value:function(g){var E=this;return function(_){return E._require(_,g)}}},{key:"_createRequireWithResolveMap",value:function(g,E){return function(_){var k=g[_];if(k)return E(k);throw new Error("Unresolved specifier "+_)}}},{key:"_throwUnresolved",value:function(g,E){throw new Error("Unable to resolve ".concat(g," from ").concat(parent,"."))}}]),e}());function a3(g){return(a3="function"==typeof Symbol&&"symbol"==_type_of(Symbol.iterator)?function(g){return void 0===g?"undefined":_type_of(g)}:function(g){return g&&"function"==typeof Symbol&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":void 0===g?"undefined":_type_of(g)})(g)}var X1="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";X0.define(X1,function(g,E,_,k,C){(function(E,k){"object"===a3(g)&&void 0!==_?_.exports=k():"function"==typeof define&&define.amd?define(k):E.ResizeObserver=k()})(this,function(){var g=function(){if("undefined"!=typeof Map)return Map;function e(g,E){var _=-1;return g.some(function(g,k){return g[0]===E&&(_=k,!0)}),_}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(g){var E=e(this.__entries__,g),_=this.__entries__[E];return _&&_[1]},t.prototype.set=function(g,E){var _=e(this.__entries__,g);~_?this.__entries__[_][1]=E:this.__entries__.push([g,E])},t.prototype.delete=function(g){var E=this.__entries__,_=e(E,g);~_&&E.splice(_,1)},t.prototype.has=function(g){return!!~e(this.__entries__,g)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(g,E){void 0===E&&(E=null);for(var _=0,k=this.__entries__;_<k.length;_++){var C=k[_];g.call(E,C[1],C[0])}},t}()}(),E="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,_="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),k="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(_):function(g){return setTimeout(function(){return g(Date.now())},1e3/60)};var C=["top","right","bottom","left","width","height","size","weight"],A="undefined"!=typeof MutationObserver,T=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(g,E){var _=!1,C=!1,A=0;function r(){_&&(_=!1,g()),C&&l()}function s(){k(r)}function l(){var g=Date.now();if(_){if(g-A<2)return;C=!0}else _=!0,C=!1,setTimeout(s,E);A=g}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(g){~this.observers_.indexOf(g)||this.observers_.push(g),this.connected_||this.connect_()},e.prototype.removeObserver=function(g){var E=this.observers_,_=E.indexOf(g);~_&&E.splice(_,1),!E.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var g=this.observers_.filter(function(g){return g.gatherActive(),g.hasActive()});return g.forEach(function(g){return g.broadcastActive()}),g.length>0},e.prototype.connect_=function(){E&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),A?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){E&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(g){var E=g.propertyName,_=void 0===E?"":E;C.some(function(g){return!!~_.indexOf(g)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(g,E){for(var _=0,k=Object.keys(E);_<k.length;_++){var C=k[_];Object.defineProperty(g,C,{value:E[C],enumerable:!1,writable:!1,configurable:!0})}return g},l=function(g){return g&&g.ownerDocument&&g.ownerDocument.defaultView||_},R=f(0,0,0,0);function c(g){return parseFloat(g)||0}function h(g){for(var E=[],_=1;_<arguments.length;_++)E[_-1]=arguments[_];return E.reduce(function(E,_){return E+c(g["border-"+_+"-width"])},0)}function d(g){var E=g.clientWidth,_=g.clientHeight;if(!E&&!_)return R;var k=l(g).getComputedStyle(g),C=function(g){for(var E={},_=0,k=["top","right","bottom","left"];_<k.length;_++){var C=k[_],A=g["padding-"+C];E[C]=c(A)}return E}(k),A=C.left+C.right,T=C.top+C.bottom,I=c(k.width),P=c(k.height);if("border-box"===k.boxSizing&&(Math.round(I+A)!==E&&(I-=h(k,"left","right")+A),Math.round(P+T)!==_&&(P-=h(k,"top","bottom")+T)),!function(g){return g===l(g).document.documentElement}(g)){var L=Math.round(I+A)-E,O=Math.round(P+T)-_;1!==Math.abs(L)&&(I-=L),1!==Math.abs(O)&&(P-=O)}return f(C.left,C.top,I,P)}var I="undefined"!=typeof SVGGraphicsElement?function(g){return _instanceof(g,l(g).SVGGraphicsElement)}:function(g){return _instanceof(g,l(g).SVGElement)&&"function"==typeof g.getBBox};function y(g){return E?I(g)?function(g){var E=g.getBBox();return f(0,0,E.width,E.height)}(g):d(g):R}function f(g,E,_,k){return{x:g,y:E,width:_,height:k}}var P=function(){function e(g){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=f(0,0,0,0),this.target=g}return e.prototype.isActive=function(){var g=y(this.target);return this.contentRect_=g,g.width!==this.broadcastWidth||g.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var g=this.contentRect_;return this.broadcastWidth=g.width,this.broadcastHeight=g.height,g},e}(),m=function(g,E){var _,k,C,A,T,R,I,P=(k=(_=E).x,C=_.y,A=_.width,T=_.height,R="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,I=Object.create(R.prototype),s(I,{x:k,y:C,width:A,height:T,top:C,right:k+A,bottom:T+C,left:k}),I);s(this,{target:g,contentRect:P})},L=function(){function t(E,_,k){if(this.activeObservations_=[],this.observations_=new g,"function"!=typeof E)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=E,this.controller_=_,this.callbackCtx_=k}return t.prototype.observe=function(g){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(g,l(g).Element))throw new TypeError('parameter 1 is not of type "Element".');var E=this.observations_;E.has(g)||(E.set(g,new P(g)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(g){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(g,l(g).Element))throw new TypeError('parameter 1 is not of type "Element".');var E=this.observations_;E.has(g)&&(E.delete(g),E.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var g=this;this.clearActive(),this.observations_.forEach(function(E){E.isActive()&&g.activeObservations_.push(E)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var g=this.callbackCtx_,E=this.activeObservations_.map(function(g){return new m(g.target,g.broadcastRect())});this.callback_.call(g,E,g),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),O="undefined"!=typeof WeakMap?new WeakMap:new g,S=function e(g){if(!_instanceof(this,e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var E=T.getInstance(),_=new L(g,E,this);O.set(this,_)};return["observe","unobserve","disconnect"].forEach(function(g){S.prototype[g]=function(){var E;return(E=O.get(this))[g].apply(E,arguments)}}),void 0!==_.ResizeObserver?_.ResizeObserver:S}),X$=_.exports},{}),X0.require(X1),_._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var X2=ag,X4=am,X3=X4.Portrait,X5=X4.Landscape,X6=GameCore,X8=X6.Utils.Function,X9=X6.Configs.GameEngine,X7=X9.AutoResizeCanvas,Yt=X9.AutoChangeOrientation,Yn=function(){function e(){var g=this;Fe(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(E){console.info("\uD83D\uDCF1 View resize by system"),window.devicePixelRatio=E||window.devicePixelRatio,g.setupOrientationByScreenSize(),g.resizeGameView()},this.handleViewResize=X8.debounce(function(){console.info("\uD83D\uDCF1 View resize by window"),g.setupOrientationByScreenSize(),g.resizeGameView()},200),this.handleBodyResize=X8.debounce(function(){g.resizeGameDiv()&&(console.info("\uD83D\uDCF1 View resize by body"),g.setupOrientationByScreenSize(),g.resizeGameView())},200)}return Ue(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){X7&&(j.on("window-resize",this.handleViewResize,this),j.on("orientation-change",this.handleViewResize,this)),Q.on(t5,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){X7&&new X$(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){Yt&&(eb.instance.resizeWithBrowserSize(!0),eb.instance.setOrientation(eJ.ORIENTATION_AUTO),eb.instance.setResolutionPolicy(eZ.ContentStrategy.FIXED_WIDTH),eb.instance.setResolutionPolicy(eZ.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=eb.instance.getResolutionPolicy())}},{key:"setupOrientationByScreenSize",value:function(){if(Yt){var g=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(eZ.ContentStrategy.FIXED_WIDTH),g<1?this.setPortraitView():this.setLandscapeView()}}},{key:"resizeGameDiv",value:function(){var g=document.getElementById("GameDiv");if(!g)return!1;var E=ns.getScreenWidthCss(),_=ns.getScreenHeightCss(),k=g.getBoundingClientRect(),C=k.width,A=k.height;return(E!==C||_!==A)&&(g.style.width="".concat(E,"px"),g.style.height="".concat(_,"px"),!0)}},{key:"resizeGameView",value:function(){var g=ns.getScreenWidthCss(),E=ns.getScreenHeightCss();Q.emit(t4,{width:g,height:E})}},{key:"setPortraitView",value:function(){var g=X3.WIDTH,E=X3.HEIGHT;this.currentLayout=X2.Portrait,this.changeDesignResolutionSize(g,E)}},{key:"setLandscapeView",value:function(){var g=X5.WIDTH,E=X5.HEIGHT;this.currentLayout=X2.Landscape,this.changeDesignResolutionSize(g,E)}},{key:"changeDesignResolutionSize",value:function(g,E){eb.instance.setDesignResolutionSize(g,E,this.resolutionPolicy),Q.emit(t6,this.currentLayout),console.info("\uD83D\uDCF1 Change layout to",this.currentLayout)}},{key:"getScreenRatio",value:function(){return ns.getScreenWidthCss()/ns.getScreenHeightCss()}}]),e}();_._RF.pop(),_._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var Yi=GameCore,Ya=Yi.Utils,Yr=Ya.Valid,Yo=Ya.Object,Ys=Ya.Array,Yl=Yi.Dtos.Match,Yu=Yl.CustomData,Yc=Yl.Data,Yp=["code","cols","encoding","idSize","rows"],Yd=["addRandomTilesPerMove","maxSpaceOfPair"],Yf=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function(){Yu.addDefaultData(sH),Yu.addValidateFunction("score",function(g){if(!Yr.isNumber(g)||g<0)throw new Error("score ".concat(g," is invalid"))})}},{key:"setupMatchData",value:function(){var g=this;Yc.addDefaultData(sM),Yc.addValidateFunction("extraData",function(E){if(null!=E){if(!Yr.isObject(E))throw new Error("extraData ".concat(E," must be a record of string keys"));var _=E,k=Object.keys(_);if(!Ys.has(k,"level"))throw new Error("extraData.level is missing");if(!Yr.isNumber(_.level))throw new Error("extraData.level ".concat(_.level," must be a number"));if(!Ys.has(k,"fen"))throw new Error("extraData.fen is missing");if(g.validateFen(_.fen),!Ys.has(k,"gravity"))throw new Error("extraData.gravity is missing");if(!Yr.isString(_.gravity))throw new Error("extraData.gravity ".concat(_.gravity," must be a string"));if(!Ys.has(k,"rules"))throw new Error("extraData.rules is missing");if(g.validateLevelRules(_.rules),!Ys.has(k,"time"))throw new Error("extraData.time is missing");if(!Yr.isNumber(_.time))throw new Error("extraData.time ".concat(_.time," must be a number"))}})}},{key:"validateFen",value:function(g){if(!Yr.isObject(g))throw new Error("extraData.fen ".concat(g," must be a record of string keys"));var E=this.validateKeys(g,Yp);if(!Yr.isNumber(E.idSize))throw new Error("fen.idSize must be a number");if(!Yr.isString(E.code))throw new Error("fen.code must be a string");if(!Yr.isNumber(E.rows))throw new Error("fen.rows must be a number");if(!Yr.isNumber(E.cols))throw new Error("fen.cols must be a number");if(!Yr.isObject(E.encoding))throw new Error("fen.encoding must be a record of string keys");var _=this.validateKeys(E.encoding,Yo.vals(uG));Object.entries(_).forEach(function(g){var E=et(g,2),_=E[0],k=E[1];if(!Yr.isString(k))throw new Error("fen.encoding.".concat(_," ").concat(k," must be a string"))})}},{key:"validateLevelRules",value:function(g){if(!Yr.isObject(g))throw new Error("extraData.rules ".concat(g," must be a record of string keys"));var E=this.validateKeys(g,Yd);if(!Yr.isNumber(E.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!Yr.isNumber(E.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function(g,E){return Object.keys(g).forEach(function(g){if(!Ys.has(E,g))throw new Error("Key ".concat(g," is missing"))}),g}}]),e}();_._RF.pop(),_._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var Yy=GameCore,Yv=Yy.Utils,Yg=Yv.Valid,Ym=Yv.Array,Yb=Yv.Object,Yw=Yy.Dtos,YS=globalThis.game.player,YE=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var g=Yw.Player;g.Data.addDefaultData(sq),g.GameData.addDefaultData(sx),g.GameData.addValidateFunction("stars",function(g){if(!Yg.isNumber(g)||g<0)throw new Error("stars ".concat(g," is invalid"))}),g.GameData.addValidateFunction("totalLevel",function(g){if(!Yg.isNumber(g)||g<1)throw new Error("totalLevel ".concat(g," is invalid"))}),g.GameData.addValidateFunction("levelVersion",function(g){if(!Yg.isNumber(g)||g<0)throw new Error("levelVersion ".concat(g," is invalid"))}),g.GameData.addValidateFunction("lastRewardedItems",function(g){if(!Yg.isNumber(g)||g<0)throw new Error("lastRewardedItems ".concat(g," is invalid"))}),g.GameData.addValidateFunction("lastCreateTournamentShown",function(g){if(!Yg.isNumber(g)||g<0)throw new Error("lastCreateTournamentShown ".concat(g," is invalid"))}),g.GameData.addValidateFunction("guideItemShowed",function(g){if(!Array.isArray(g))throw new Error("guideItemShowed ".concat(g," is invalid"))}),g.GameData.addValidateFunction("items",function(g){if(!Yg.isObject(g))throw new Error("items ".concat(g," is invalid"));var E=Object.keys(g),_=Yb.vals(g);if(!Ym.has(E,sT.HINT))throw new Error("item ".concat(sT.HINT," not found"));if(!Ym.has(E,sT.THUNDER))throw new Error("item ".concat(sT.THUNDER," not found"));if(!Ym.has(E,sT.STORM))throw new Error("item ".concat(sT.STORM," not found"));if(!Ym.has(E,sT.PLIERS))throw new Error("item ".concat(sT.PLIERS," not found"));_.forEach(function(g){if(!Yg.isNumber(g)||g<0)throw new Error("item ".concat(g," is invalid"))})}),g.GameData.addValidateFunction("skins",function(g){if(!Yg.isObject(g))throw new Error("skins ".concat(g," is invalid"))})}},{key:"requestConnectedPlayers",value:function(){YS.requestConnectedPlayers().catch(function(g){console.warn("player.requestConnectedPlayers",g)})}}]),e}();_._RF.pop(),_._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var Y_=GameCore,Yk=Y_.Events,YC=Y_.Utils.Valid,YA=globalThis.game,YT=YA.event,YR=YA.adaptivePerformance,YI=function(){function e(){var g=this;Fe(this,e),this.handleBeginFrame=function(){N.on(e_.EVENT_AFTER_UPDATE,g.lateUpdate),N.on(e_.EVENT_BEFORE_UPDATE,g.updateActualFPS)},this.handleAfterSceneLaunch=function(g){YR&&YR.trackingScene(g.name)},this.handleRequestResizeGame=function(g){var E=g.forcePixelRatio;YC.isNumber(E)&&Q.emit(t5,E)},this.lateUpdate=function(){var g=1e3*Q.deltaTime;null==YR||YR.updatePostStepDeltaTime(g)},this.updateActualFPS=function(){var g,E=null===(g=N.root)||void 0===g?void 0:g.fps;YC.isNumber(E)&&(null==YR||YR.updateActualFPS(E))}}return Ue(e,[{key:"init",value:function(){YR&&this.listenEvents()}},{key:"listenEvents",value:function(){YT.on(Yk.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),N.once(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.on(e_.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();_._RF.pop(),_._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var YP=globalThis.game.canvasRecorder,YL=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){if(Q.canvas&&YP){YP.setCanvas(Q.canvas);var g=YP.getOptions(),E=YP.waitNextFrame;YP.waitNextFrame=Be(function(){var _;return _ts_generator(this,function(k){switch(k.label){case 0:if(!g.syncFps)return[3,1];_=new Promise(function(g){N.once(e_.EVENT_AFTER_RENDER,g),Q.pause(),Q.step()});return[3,3];case 1:Q.resume();return[4,E.call(YP)];case 2:_=(k.sent(),Promise.resolve());k.label=3;case 3:return[2,_]}})})}}}]),e}();_._RF.pop(),_._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var YO=function(){function e(){var g=this;Fe(this,e),this.hideCocosStats=function(){clearInterval(g.waiter),g.waiter=setInterval(g.checkProfilerReady,100)},this.checkProfilerReady=function(){if(ey){ey._showFPS=!1;var E=ey._rootNode;E&&(E.active=!1,E.isValid&&(E.destroyAllChildren(),E.removeAllChildren(),E.destroy(),clearInterval(g.waiter)))}}}return Ue(e,[{key:"init",value:function(){ey&&N.on(e_.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();_._RF.pop(),_._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var YB=GameCore,YN=YB.Configs.GameEngine.DynamicAssets,YM=YB.Events,YD=YB.Utils.Array,YF=globalThis.game,YU=YF.event,Yx=YF.storage,Yz=[".png",".jpg",".jpeg",".webp"],YG=function(){function e(){var g=this;Fe(this,e),this.isProcessing=!1,this.useHighQuality=!1,this.upgradableAssets=new Map,this.handleSceneLaunched=function(g){var E=g.sceneName,_=[sW];YD.has(_,E)||Q.emit(nr,{quality:"highest"})},this.requestUpdateDynamicAssets=function(){Q.emit(ni,{force:!0})},this.collectUpgradableAssets=function(E){var _,k=E.output=E.input,C=YN.Resolution,A=C.Adjust,T=C.Original,R=at(k);try{for(R.s();!(_=R.n()).done;){var I=_.value;if(YD.has(Yz,I.ext)&&!g.upgradableAssets.has(I.uuid)){g.useHighQuality?(I.url=g.replaceAssetUrl(I.url),I.resolution=T,I.upgradeOnNextRequest=!0):A<T&&(I.resolution=A);var P={ext:I.ext,url:I.url,uuid:I.uuid,options:I.options,upgraded:I.upgraded,resolution:I.resolution,upgradeOnNextRequest:I.upgradeOnNextRequest};g.upgradableAssets.set(I.uuid,P)}}}catch(g){R.e(g)}finally{R.f()}},this.replaceAssetUrl=function(E){return g.useHighQuality?E.replace("native/","native32/"):E},this.handleChangeQuality=Be(function(){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:g.isProcessing=!0;_=[],k=at(g.upgradableAssets.values());try{for(k.s();!(E=k.n()).done;){C=E.value,A=g.processUpgradeQualityAsync(C);_.push(A)}}catch(g){k.e(g)}finally{k.f()}return[4,Promise.all(_)];case 1:T=I.sent();g.isProcessing=!1;R=T.filter(function(g){return g}).length;g.requestUpdateDynamicAssets(),console.warn("DynamicAssets: Upgradable Assets Info",{total:R,results:T});return[2]}})})}var g;return Ue(e,[{key:"init",value:function(){var g=YN.Enabled,E=YN.Resolution;console.info("DynamicAssets: init",{EDITOR:tf,Enabled:g}),g&&(eX.instance.transformPipeline.insert(this.collectUpgradableAssets,2),this.initState(),this.listenEvents(),window.requestIdleCallback=window.requestIdleCallback||function(g){g()},E.Adjust,E.Original)}},{key:"initState",value:function(){var g=globalThis.game.getBuildVersion().toString();Yx.addStorage("DynamicAssets",{useHighQuality:!1,buildVersion:"0"},!0);var E=Yx.getStorage("DynamicAssets"),_=null!=E?E:{},k=_.buildVersion,C=_.useHighQuality;"boolean"==typeof C&&(this.useHighQuality=C&&k===g),Yx.setStorageData("DynamicAssets","buildVersion",g)}},{key:"listenEvents",value:function(){var g=this;Q.on(nr,this.handleChangeQuality),setTimeout(function(){g.useHighQuality=!0,g.autoUpgradeQuality(),YU.on(YM.SCENE_LAUNCHED,g.handleSceneLaunched)},4e3)}},{key:"autoUpgradeQuality",value:function(){var g=this;requestIdleCallback(Be(function(){var E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(!g.isProcessing&&!Q.isPaused()))return[3,2];E=tt(g.upgradableAssets.values()).find(function(g){return!g.upgraded&&!g.upgradeOnNextRequest});if(!E)return[2,(Yx.setStorageData("DynamicAssets","useHighQuality",!0),void g.requestUpdateDynamicAssets())];console.info("DynamicAssets: Auto upgrade quality",E),g.isProcessing=!0;return[4,g.processUpgradeQualityAsync(E)];case 1:_.sent(),g.isProcessing=!1,g.autoUpgradeQuality();_.label=2;case 2:return[2]}})}),{timeout:1e3})}},{key:"processUpgradeQualityAsync",value:(g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){E=this;if(g.upgraded||g.upgradeOnNextRequest)return[2,!0];_=eX.instance,k=_.assets,C=_.loadAny,A=k.get(g.uuid);return[2,_instanceof(A,ea)?(g.url=this.replaceAssetUrl(g.url),new Promise(function(_){C(g,g.options,function(k,C){if(k)return console.warn("DynamicAssets: Upgrade error",k),void _(!1);A.reset(C),g.upgraded=!0,E.upgradableAssets.set(g.uuid,g),Q.emit(na,{asset:A,item:g}),_(!0)})})):(console.warn("DynamicAssets: Asset not found",g.uuid),!1)]})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var YV=GameCore,YK=YV.Events,YH=YV.Configs.GameEngine.DynamicAtlas,Yq=YH.UsePowerOfTwo,YW=YH.TextureAtlasOptimize,Yj=YV.Utils,YX=Yj.Array,YY=Yj.Json,YJ=Yj.Object,YQ=Yj.Function,YZ=globalThis.game.event,Y$=function(){function e(){var g=this;Fe(this,e),this.atlasTexId=null,this.drawInfo=[],this.atlasInfo=null,this.lastAtlasInfo=null,this.renderTimes=[],this.lastRenderTime=0,this.renderTimeInterval=5e3,this.isEffective=!0,this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1,this.collectInfo={},this.pendingSprites={},this.checkRenderTimeHighers=function(){var E=g.getMeanRenderTime();E>8&&g.handleLaggyFrame(E),N.once(e_.EVENT_AFTER_RENDER,function(){setTimeout(g.checkRenderTimeHighers,g.renderTimeInterval)})},this.resetPendingSprites=function(){g.pendingSprites={}},this.updateBeforeRenderTime=function(){g.lastRenderTime=performance.now()},this.updateAfterRenderTime=function(){g.renderTimes.push(performance.now()-g.lastRenderTime)},this.requestUpdateDynamicAtlas=YQ.throttle(function(E){g.isProcessing||(g.isProcessing=!0,g.forceUpdateDynamicAtlas=(null==E?void 0:E.force)||!1,N.once(e_.EVENT_AFTER_RENDER,g.updateDynamicAtlas))},5e3),this.updateDynamicAtlas=function(){try{var E=N.getScene();if(!E)return;var _=g.collectPackageInfo();if(Object.keys(_).length<1)return;if(g.drawInfo=[],g.atlasInfo=null,g.generateDrawInfo(YJ.vals(_)),!g.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found");if(!g.updateAtlasData()&&!g.forceUpdateDynamicAtlas)return;var k=E.getComponentsInChildren(e0);g.refreshComponents(k)}catch(g){console.error("DynamicAtlas: Error updating dynamic atlas",g)}finally{g.isProcessing=!1,g.forceUpdateDynamicAtlas=!1}},this.generateDrawInfo=function(E){if(!(E.length<1)){console.info("DynamicAtlas: generate draw info",E);var _=E.sort(function(g,E){return E.usageCount-g.usageCount}),k=eQ.instance.textureSize;if(g.calculateOptimizedAtlas(_,k),g.atlasInfo){var C,A=g.atlasInfo.textures,T=at(A);try{for(T.s();!(C=T.n()).done;){var R=C.value;g.drawInfo.push(R)}}catch(g){T.e(g)}finally{T.f()}var I=_.filter(function(g){return!A.some(function(E){return E.id===g.id})});I.length>0&&(console.warn("DynamicAtlas: Missing textures",I),g.generateDrawInfo(I))}else console.warn("DynamicAtlas: Atlas info not found",{textures:_})}},this.calculateOptimizedAtlas=function(E,_){var k=function(g){var E,_=0,k=0,C=at(g);try{for(C.s();!(E=C.n()).done;){var A=E.value;_+=A.w*A.h,k=Math.max(k,A.w)}}catch(g){C.e(g)}finally{C.f()}g.sort(function(g,E){return E.h-g.h});var T,R=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(_/.95)),k),h:1/0}],I=0,P=0,L=at(g);try{for(L.s();!(T=L.n()).done;)for(var O=T.value,B=R.length-1;B>=0;B--){var N=R[B];if(!(O.w>N.w||O.h>N.h)){if(O.x=N.x,O.y=N.y,P=Math.max(P,O.y+O.h),I=Math.max(I,O.x+O.w),O.w===N.w&&O.h===N.h){var M=R.pop();B<R.length&&(R[B]=M)}else O.h===N.h?(N.x+=O.w,N.w-=O.w):O.w===N.w?(N.y+=O.h,N.h-=O.h):(R.push({x:N.x+O.w,y:N.y,w:N.w-O.w,h:O.h}),N.y+=O.h,N.h-=O.h);break}}}catch(g){L.e(g)}finally{L.f()}return{w:I,h:P,fill:_/(I*P)||0}}(E),C=k.w,A=k.h,T=k.fill;if(T<.6)console.warn("DynamicAtlas: Fill rate is too low",T,tt(E));else{if(C>_||A>_)return console.warn("DynamicAtlas: Packed size is bigger than atlas size",C,A,_),void(E.pop()?g.calculateOptimizedAtlas(E,_):console.warn("DynamicAtlas: Texture size is too big",C,A,_));g.atlasInfo={textures:E,atlasSize:_,packedInfo:{width:Math.round(C),height:Math.round(A),fillRate:T}}}},this.drawTexture=function(E,_,k){var C=_.texture,A=C.image;if(!A||A.width<1||A.height<1)console.warn("DynamicAtlas: Texture image not found",C);else if(!A.data||A.data.width<1||A.data.height<1)console.warn("DynamicAtlas: Texture image data not found",A);else{var T=C.getId(),R=YX.search(tt(g.drawInfo),function(g){return g.id===T})||{x:-1,y:-1},I=R.x,P=R.y;if(!(I<0||P<0)){var L=E._innerTextureInfos[T];L||(k&&(E._texture.drawTextureAt(A,I-1,P),E._texture.drawTextureAt(A,I+1,P),E._texture.drawTextureAt(A,I,P-1),E._texture.drawTextureAt(A,I,P+1)),E._texture.drawTextureAt(A,I,P),E._count++,E._innerTextureInfos[T]={texture:C,x:I,y:P});var O=_.rect,B=O.x,N=O.y;B+=(null==L?void 0:L.x)||I,N+=(null==L?void 0:L.y)||P;var M={texture:E._texture,x:B,y:N};return E._innerSpriteFrames.push(_),M}g.pendingSprites[_.uuid]=_}},this.refreshComponents=function(g){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.node.active&&(k.node.active=!1,k.node.active=!0)}}catch(g){_.e(g)}finally{_.f()}},this.isSameAtlas=function(g,E){if(!g||!E)return!1;var _=g.packedInfo,k=g.textures,C=E.packedInfo,A=E.textures;return _.width===C.width&&_.height===C.height&&k.length===A.length&&k.every(function(g,E){var _=g.id,k=g.w,C=g.h,T=A[E],R=T.id,I=T.w,P=T.h;return _===R&&k===I&&C===P})}}return Ue(e,[{key:"init",value:function(){YW&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:YW}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){var g=this;Q.on(ni,this.requestUpdateDynamicAtlas),N.on(e_.EVENT_BEFORE_SCENE_LAUNCH,this.resetPendingSprites),YZ.once(YK.GAME_READY,function(){g.setupRenderListeners()})}},{key:"setupRenderListeners",value:function(){var g=this;N.on(e_.EVENT_BEFORE_RENDER,this.updateBeforeRenderTime),N.on(e_.EVENT_AFTER_RENDER,this.updateAfterRenderTime),YZ.once(YK.SCENE_LAUNCHED,function(){N.once(e_.EVENT_AFTER_RENDER,g.checkRenderTimeHighers)})}},{key:"handleLaggyFrame",value:function(g){console.warn("DynamicAtlas: Laggy frame detected, render time: ".concat(g.toFixed(2),"ms")),this.isEffective||(this.renderTimeInterval=Math.min(this.renderTimeInterval+1e3,1e4),console.warn("DynamicAtlas: Atlas update not effective. Increased interval: ".concat(this.renderTimeInterval,"ms"))),this.requestUpdateDynamicAtlas()}},{key:"getMeanRenderTime",value:function(){var g,E=0,_=at(this.renderTimes);try{for(_.s();!(g=_.n()).done;)E+=g.value}catch(g){_.e(g)}finally{_.f()}return E/=this.renderTimes.length,this.renderTimes=[],E}},{key:"overrideDynamicAtlas",value:function(){var g=this,E=eQ.instance;eQ.instance.insertSpriteFrame=function(_){if(E._atlasIndex>=E._maxAtlasCount)return null;if(!_||_.original)return console.warn("DynamicAtlas: Skip original texture",_),null;if(!_.packable)return console.warn("DynamicAtlas: Skip non-packable texture",_),null;var k=g.getAtlas(),C=k?k.insertSpriteFrame(_):null;return!C&&E._atlasIndex<E._maxAtlasCount&&(C=(k=g.getAtlas())?k.insertSpriteFrame(_):null),C}}},{key:"createAtlas",value:function(){return eQ.instance.newAtlas()}},{key:"getAtlas",value:function(){var g=this,E=eQ.instance,_=E._atlases,k=void 0===_?[]:_,C=E._atlasIndex,A=E.textureBleeding,T=k[C];return T||(T=this.createAtlas()),T?(T.originalInsertSpriteFrame||(T.originalInsertSpriteFrame=T.insertSpriteFrame,T.insertSpriteFrame=function(E){return g.drawTexture(T,E,A)}),this.atlasTexId=T._texture.getId(),T):null}},{key:"collectPackageInfo",value:function(){var g,E={},_=at(YJ.vals(this.pendingSprites));try{for(_.s();!(g=_.n()).done;){var k=g.value;if(this.isValidSpriteFrame(k)){var C=k.texture,A=k.original,T=C.getId(),R=null==A?void 0:A._texture.getId();T!==R?(R&&(T=R),this.collectInfo[T]||this.initializeCollectInfo(T,k),this.collectInfo[T].usageCount++,E[T]=this.collectInfo[T]):console.warn("DynamicAtlas: Skip original texture",{texId:T,oriTexId:R})}}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"isValidSpriteFrame",value:function(g){var E=g.packable,_=g.texture,k=g.original,C=g.name,A=g.uuid;if(!E)return console.warn("DynamicAtlas: Skip non-packable texture",C,A),!1;if(!_instanceof(_,e$))return console.warn("DynamicAtlas: Skip non-texture2d texture",C,A),!1;var T=null==k?void 0:k._texture.getId();return this.atlasTexId!==T||(console.warn("DynamicAtlas: Skip texture in atlas",C,A),!1)}},{key:"initializeCollectInfo",value:function(g,E){var _=E.texture,k=E.original,C=E.uuid,A=_.width,T=_.height,R=(null==k?void 0:k._texture)||{width:0,height:0},I=R.width,P=R.height,L=Math.max(A,I)+2,O=Math.max(T,P)+2;L<=1||O<=1?console.warn("DynamicAtlas: Skip invalid texture size",C,{w:L,h:O}):this.collectInfo[g]={id:g,w:L,h:O,x:-1,y:-1,usageCount:0,name:C}}},{key:"updateAtlasData",value:function(){if(!this.atlasInfo)return!1;if(this.lastAtlasInfo&&!this.forceUpdateDynamicAtlas){var g=this.isSameAtlas(this.lastAtlasInfo,this.atlasInfo);if(this.isEffective=!g,g)return console.warn("DynamicAtlas: Last update dynamic atlas is not effective"),!1}console.info("DynamicAtlas: atlas info",this.atlasInfo);var E=this.getAtlas();if(!E||!E._texture)return!1;var _=this.atlasInfo.packedInfo,k=E._texture,C=k.width,A=k.height,T=_.width+20,R=_.height+20,I=Math.max(T,R),P=Yq?I:T;return(C!==P||A!==P)&&(eQ.instance.reset(),!(!(E=this.getAtlas())||!E._texture)&&(Yq?(E._texture.initWithSize(P,P),console.info("DynamicAtlas: Resize atlas (PO2)",P,E)):(E._texture.initWithSize(T,R),console.info("DynamicAtlas: Resize atlas",T,R,E)),this.lastAtlasInfo=YY.clone(this.atlasInfo),!0))}}]),e}();_._RF.pop();var Y0={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};_._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var Y1=GameCore.Events,Y2=globalThis.game,Y4=Y2.event,Y3=Y2.language,Y5=function(){function e(){var g=this;Fe(this,e),this.handleLanguageChanged=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){_=E.locale;Q.emit("update-language",_),g.updateComponentInEditor();return[2]})});return function(g){return E.apply(this,arguments)}}()}var g,_,k;return Ue(e,[{key:"init",value:function(){var g=this;this.addLanguage("en").then(function(){g.setLanguage("en"),g.listenEvent()})}},{key:"listenEvent",value:function(){Y4.on(Y1.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,this.getLangData(g)];case 1:E=_.sent();Y3.add(g,E);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setLanguage",value:function(g){Y3.choose(g)}},{key:"getLangData",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(g){case"en":return[2,Y0];case"ru":return[2,this.loadLanguageAsync(g)];default:throw new Error("Language ".concat(g," not supported"))}return[2]})}),function(g){return _.apply(this,arguments)})},{key:"loadLanguageAsync",value:(g=Be(function(g){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,E.import("db://assets/resources/locales/".concat(g,".json"))];case 1:_=k.sent().default;Y3.add(g,_);return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"updateComponentInEditor",value:function(){}}]),e}();_._RF.pop(),_._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var Y6=GameCore,Y8=Y6.Configs,Y9=Y8.Mockup,Y7=Y9.Leaderboards,Jt=Y9.GameSDK.Player,Jn=Y8.Leaderboards,Ji=Y6.Utils.Number,Ja=globalThis.game.leaderboard,Jr=function(){function e(){var g=this;Fe(this,e),this.handleWhenGameSDKStarted=function(){Y7.Enabled?g.setupLeaderboardsMockup():g.setupLeaderboards()}}var g,E,_,k,C;return Ue(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(C=Be(function(){return _ts_generator(this,function(g){this.setupLeaderboardByConfigs();return[2]})}),function(){return C.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var g=Jn.LeaderboardId;g?(Ja.addLeaderboard({name:sz,type:"global",autoSortRank:!0,leaderboardId:g}),Ja.addLeaderboard({name:sG,type:"friends",autoSortRank:!0,leaderboardId:g})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(k=Be(function(){return _ts_generator(this,function(g){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard();return[2]})}),function(){return k.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(_=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=sz,E=sV,_=Y7.NumOfLeaders;return[4,Ja.createLeaderboardAsync({_id:E,name:g,numberOfLeaders:Ji.random(_.Max-_.Min)+_.Min})];case 1:k=A.sent();Ja.addLeaderboard({name:g,type:"global",autoSortRank:!0,leaderboardId:k});return[4,Ja.requestLeaderboardAsync(g,10)];case 2:A.sent();C=Ja.getLeaderboard(g);console.info("setupGlobalLeaderboard fetch new",C,C&&Object.keys(C.leaders).length),C=Ja.getLeaderboard(g),console.info("setupGlobalLeaderboard load more",C,C&&Object.keys(C.leaders).length);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(E=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=sG,E=sK,_=0,k=Jt.ConnectedPlayers;k.Enabled&&(_=Ji.random(k.NumOfPlayers-1)+1);return[4,Ja.createLeaderboardAsync({_id:E,name:g,numberOfLeaders:_})];case 1:C=T.sent();Ja.addLeaderboard({name:g,type:"friends",autoSortRank:!0,leaderboardId:C});return[4,Ja.requestLeaderboardAsync(g,10)];case 2:T.sent();A=Ja.getLeaderboard(g);console.info("setupFriendsLeaderboard done",A);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(g=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:return[4,l9.requestTournamentDataAsync()];case 1:g=E.sent();g.forEach(function(g){var E=g.payload.leaderboardId;E&&(Ja.isExistLeaderboardId(E)||Ja.addLeaderboard({type:"tournament",name:E,autoSortRank:!0,leaderboardId:E}))}),console.info("setupGlobalTournamentLeaderboard done",g);return[2]}})}),function(){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var Jo=GameCore,Js=Jo.Utils,Jl=Jo.Events,Ju=Jo.Configs.PerformanceMonitor.FpsTracking,Jc=globalThis.game.event,Jp=function(){function e(){var g=this;Fe(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){g.startTraceFps(),N.on(e_.EVENT_AFTER_UPDATE,g.handleLateUpdate)},this.handleLateUpdate=function(){if(g.mark){if(g.fpsTraceDuration-=Q.deltaTime,g.fpsTraceDuration<=0&&!g.traceStopped)return g.traceStopped=!0,g.unListenEvents(),g.updateFPS(),void g.mark.stop(g.markName);g.fpsTraceIntervalTimer-=Q.deltaTime,g.fpsTraceIntervalTimer>0||(g.fpsTraceIntervalTimer=g.fpsTraceInterval,g.updateFPS(),g.mark.stop(g.markName),g.startTraceFps())}}}return Ue(e,[{key:"mark",get:function(){return Ju.Enabled?Js.Mark:null}},{key:"init",value:function(){var g=Ju.TrackingDuration,E=Ju.TrackingInterval;this.fpsTraceDuration=null!=g?g:60,this.fpsTraceInterval=null!=E?E:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){Jc.once(Jl.GAME_READY,this.handleStartTraceFps)}},{key:"unListenEvents",value:function(){N.off(e_.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var g,E;if(this.mark){var _=this.getFPS(),k=this.getDrawCalls(),C=this.getDeviceRender(),A=this.getTextureMemory();this.minFps=Math.min(null!==(g=this.minFps)&&void 0!==g?g:_,_),this.maxFps=Math.max(null!==(E=this.maxFps)&&void 0!==E?E:0,_),this.mark.putMetric(this.markName,"FPS Metric",_),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",C),this.mark.putAttr(this.markName,"Draw Calls",k.toString()),this.mark.putAttr(this.markName,"Texture Memory",A.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info("FPS: ".concat(_," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(k,", texture memory: ").concat(A.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!N.root)return 0;var g=N.root.fps;return Math.floor(g)||0}},{key:"getDrawCalls",value:function(){return N.root&&N.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return N.root&&N.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return N.root&&N.root.device.memoryStatus.textureSize/1048576||0}}]),e}();_._RF.pop(),_._RF.push({},"d5789HUcoJBYr7E3NOGuQyN","Profiler",void 0);var Jd=GameCore,Jf=Jd.Utils.Valid,Jy=Jd.Configs.Debugger.Profiler,Jv=globalThis.game.event,Jg=function(){function e(){var g=this;Fe(this,e),this.isUpdated=!1,this.isPost=!1,this.isDrawn=!1,this.isCommitted=!1,this.isRendered=!1,this.isFramed=!1,this.waitOptions={timeout:0,checkInterval:1},this.initState=function(){g.isFramed=!1,g.isUpdated=!1,g.isDrawn=!1,g.isCommitted=!1,g.isRendered=!1,g.isPost=!1},this.startTraceLoop=function(){g.clearLoopEvents(),g.initState(),g.useTickAsync(),g.listenLoopEvents()},this.handleBeginFrame=function(){g.measure("Frame",g.processBeginFrame)},this.processBeginFrame=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isFramed=!1,console.time("Frame");return[4,Jf.isValueChangeAsync(function(){return g.isFramed},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Frame");return[2]}})}),this.handleBeforeUpdate=function(){g.measure("Update",g.processBeforeUpdate)},this.processBeforeUpdate=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isUpdated=!1,console.time("Update");return[4,Jf.isValueChangeAsync(function(){return g.isUpdated},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Update");return[2]}})}),this.handleAfterUpdate=function(){g.isUpdated=!0},this.handleBeforeDraw=function(){g.measure("Draw",g.processBeforeDraw)},this.processBeforeDraw=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isDrawn=!1,console.time("Draw");return[4,Jf.isValueChangeAsync(function(){return g.isDrawn},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Draw");return[2]}})}),this.handleBeforeCommit=function(){g.measure("Commit",g.processBeforeCommit)},this.processBeforeCommit=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isCommitted=!1,console.time("Commit");return[4,Jf.isValueChangeAsync(function(){return g.isCommitted},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Commit");return[2]}})}),this.handleBeforeRender=function(){g.isCommitted=!0,g.measure("Render",g.processBeforeRender)},this.processBeforeRender=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isRendered=!1,console.time("Render");return[4,Jf.isValueChangeAsync(function(){return g.isRendered},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Render");return[2]}})}),this.handleAfterRender=function(){g.isRendered=!0},this.handleAfterDraw=function(){g.isDrawn=!0,g.measure("Post",g.processPost)},this.processPost=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isPost=!1,console.time("Post");return[4,Jf.isValueChangeAsync(function(){return g.isPost},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Post");return[2]}})}),this.handleEndFrame=function(){g.isPost=!0,g.isFramed=!0,g.restoreTick()}}var g,E;return Ue(e,[{key:"profiler",get:function(){return globalThis.game.profiler}},{key:"init",value:function(){Jy.Enabled&&(this.initState(),this.addTickAsync(),this.listenEvents())}},{key:"addTickAsync",value:function(){var g=this;N.originalTick=N.tick,N.tickAsync=function(){var E=Be(function(E){var _,k,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:if(!!this._invalid)return[3,8];return[4,g.emitAsync(e_.EVENT_BEGIN_FRAME)];case 1:if(P.sent(),!!this._paused)return[3,4];return[4,g.emitAsync(e_.EVENT_BEFORE_UPDATE)];case 2:P.sent(),this._compScheduler.startPhase(),this._compScheduler.updatePhase(E);for(k=0;k<this._systems.length;++k)this._systems[k].update(E);this._compScheduler.lateUpdatePhase(E);return[4,g.emitAsync(e_.EVENT_AFTER_UPDATE)];case 3:P.sent(),e1._deferredDestroy();for(A=0;A<this._systems.length;++A)this._systems[A].postUpdate(E);P.label=4;case 4:return[4,g.emitAsync(e_.EVENT_BEFORE_DRAW)];case 5:P.sent();T=null===(_=N.getScene())||void 0===_?void 0:_.getComponentsInChildren("UIRenderer");if(!T)return[3,8];I=at(T);try{for(I.s();!(R=I.n()).done;)R.value.updateRenderer()}catch(g){I.e(g)}finally{I.f()}this._root.frameMove(E);return[4,g.emitAsync(e_.EVENT_AFTER_DRAW)];case 6:P.sent(),C.resetHasChangedFlags(),C.clearNodeArray();return[4,g.emitAsync(e_.EVENT_END_FRAME)];case 7:P.sent(),this._totalFrames++;P.label=8;case 8:return[2]}})});return function(g){return E.apply(this,arguments)}}()}},{key:"emitAsync",value:(E=Be(function(g){var E,_,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:for(E=I.length,_=new Array(E>1?E-1:0),k=1;k<E;k++)_[k-1]=I[k];return[4,this.waitEvent.apply(this,[g].concat(_))];case 1:P.sent(),N.emit.apply(N,[g].concat(_));A=this.getListeners(g),T=at(A);try{for(T.s();!(C=T.n()).done;){R=C.value;R.check=R.originalCheck}}catch(g){T.e(g)}finally{T.f()}return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"useTickAsync",value:function(){N.tick=N.tickAsync}},{key:"restoreTick",value:function(){N.tick=N.originalTick}},{key:"getListeners",value:function(g){return N._callbackTable[g].callbackInfos||[]}},{key:"waitEvent",value:(g=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){for(E=T.length,_=new Array(E>1?E-1:0),k=1;k<E;k++)_[k-1]=T[k];C=this.getListeners(g);if(0!==C.length){A=C.map(function(E){var k=E.target,C=E.callback;return E.originalCheck||(E.originalCheck=E.check),E.check=function(){return!1},new Promise(function(E){var A="Wait ".concat(g," (").concat(k,":").concat(C.name,")");console.time(A),k?C.call.apply(C,[k].concat(_)):C.apply(void 0,_),E(!0),console.timeEnd(A)})});return[2,Promise.all(A)]}return[2]})}),function(E){return g.apply(this,arguments)})},{key:"listenEvents",value:function(){Jv.on("render",this.startTraceLoop)}},{key:"listenLoopEvents",value:function(){N.once(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.once(e_.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),N.once(e_.EVENT_AFTER_UPDATE,this.handleAfterUpdate),N.once(e_.EVENT_BEFORE_DRAW,this.handleBeforeDraw),N.once(e_.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),N.once(e_.EVENT_BEFORE_RENDER,this.handleBeforeRender),N.once(e_.EVENT_AFTER_RENDER,this.handleAfterRender),N.once(e_.EVENT_AFTER_DRAW,this.handleAfterDraw),N.once(e_.EVENT_END_FRAME,this.handleEndFrame)}},{key:"clearLoopEvents",value:function(){N.off(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.off(e_.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),N.off(e_.EVENT_AFTER_UPDATE,this.handleAfterUpdate),N.off(e_.EVENT_BEFORE_DRAW,this.handleBeforeDraw),N.off(e_.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),N.off(e_.EVENT_BEFORE_RENDER,this.handleBeforeRender),N.off(e_.EVENT_AFTER_RENDER,this.handleAfterRender),N.off(e_.EVENT_AFTER_DRAW,this.handleAfterDraw),N.off(e_.EVENT_END_FRAME,this.handleEndFrame)}},{key:"measure",value:function(g,E,_){var k,C=!(arguments.length>2&&void 0!==_)||_;null===(k=this.profiler)||void 0===k||k.measureCode({name:g,isAsync:C,profile:g,callback:E})}}]),e}();_._RF.pop(),_._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var Jm=GameCore.Events,Jb=globalThis.game.event,Jw=function(){function e(){Fe(this,e),this.handleHotReload=function(){Q.restart()},this.handleUpdateConfig=function(g){if("Gameplay"===g.type){Q.emit(t8,g.config);var E=g.id,_=g.type;Jb.emit(Jm.REMOTE_CONFIG_UPDATED,{id:E,type:_})}}}return Ue(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){Jb.on(Jm.REQUEST_HOT_RELOAD,this.handleHotReload),Jb.on(Jm.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();_._RF.pop(),_._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var JS=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}},{key:"initProfiler",value:function(){(new Jg).init()}},{key:"initLanguages",value:function(){(new Y5).init()}},{key:"initCocosStats",value:function(){(new YO).init()}},{key:"initLeaderboards",value:function(){(new Jr).init()}},{key:"initRemoteConfig",value:function(){(new Jw).init()}},{key:"initDynamicAtlas",value:function(){(new Y$).init()}},{key:"initDynamicAssets",value:function(){(new YG).init()}},{key:"initCanvasRecorder",value:function(){(new YL).init()}},{key:"initPerformanceMonitor",value:function(){(new Jp).init()}},{key:"initAdaptivePerformance",value:function(){(new YI).init()}}]),e}();_._RF.pop(),_._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var JE=globalThis.game,J_=JE.event,Jk=JE.monitorError,JC=GameCore,JA=JC.Events,JT=JC.Configs.PerformanceMonitor,JR=JC.Utils.Mark,JI=function(){function e(){var g=this;Fe(this,e),this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var E=Be(function(E){var _,k,C;return _ts_generator(this,function(A){_=E.sceneName,k=E.sceneData,C=g.correctSceneName(_);console.info("Switching",C,null!=k?k:{}),C&&(lZ.showLoadingFullScreen(C),g.startScene({sceneName:C,sceneData:k}));return[2]})});return function(g){return E.apply(this,arguments)}}(),this.preloadScene=function(E,_){var k=E.sceneName;g.startMeasure(k),N.preloadScene(k,g.onSceneProgress,g.onScenePreloaded(k,_))},this.startMeasure=function(E){g.mark&&(g.queueLoadScene[E]&&(g.mark.putAttr(g.markName,"Canceled","true"),g.stopMeasure(E)),console.groupCollapsed("\uD83D\uDCE6 ".concat(E,": loading progress")),g.mark.measure(g.markName),g.mark.putAttr(g.markName,"Cancel","false"),g.mark.putAttr(g.markName,"Success","false"),g.mark.putMetric(g.markName,E),g.mark.start(g.markName),g.queueLoadScene[E]=!0)},this.stopMeasure=function(E){g.mark&&g.queueLoadScene[E]&&(g.mark.rmAttr(g.markName,"File"),g.mark.putAttr(g.markName,"Success","true"),g.mark.stop(g.markName),g.queueLoadScene[E]=!1,console.groupEnd())},this.onSceneProgress=function(E,_,k){var C=E/_;g.mark&&g.mark.putAttr(g.markName,"Last File","".concat(k.id," (").concat(k.ext,")"));var A=Math.floor(70*C+30);GameSDK.setLoadingProgress(A)},this.onScenePreloaded=function(g,E){return function(_){_?console.warn("SceneManager.onScenePreloaded",{sceneName:g,error:_}):(E&&E(g,_),J_.emit(JA.SCENE_LOADED,{sceneName:g,isPreload:!0}))}},this.onDirectorLoadScene=function(E){return function(_,k){if(_)console.warn("SceneManager.onSceneLoaded",_);else if(null!=k&&k.scene){var C=k.name;g.handleBeforeSceneLaunch(k,E)(),N.once(e_.EVENT_AFTER_SCENE_LAUNCH,g.handleSceneLaunched(C,E))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(E,_){return function(){g.setSceneData(E,null!=_?_:{}),Q.emit(t5),J_.emit(JA.SCENE_LOADED,{sceneName:E.name})}},this.handleSceneLaunched=function(E,_){return function(){var k;lZ.hideLoadingFullScreen(E),iC.switchSceneTracking(),null==Jk||Jk.addMetadata({currentScene:E}),null===(k=g.callbackSwitchScene)||void 0===k||k.call(g,{sceneName:E,sceneData:_}),J_.emit(JA.SCENE_LAUNCHED,{sceneName:E})}},this.handleSceneLoaded=function(E){var _=E.sceneName;g.stopMeasure(_)}}return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){J_.on(JA.SWITCH_SCENE,this.switchScene),J_.on(JA.PRELOAD_SCENE,this.preloadScene),J_.on(JA.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(g){var E=this.getCurrentScene();return E&&g===E.name?null:g}},{key:"startScene",value:function(g){var E=this,_=g.sceneName,k=g.sceneData;this.preloadScene({sceneName:_},function(g,C){g===_&&(C?console.warn("SceneManager.startScene",{sceneName:_,error:C}):N.loadScene(_,E.onDirectorLoadScene(k)))})}},{key:"mark",get:function(){return JT.LoadResources?JR:null}},{key:"getCurrentScene",value:function(){return N.getScene()}},{key:"getLoadedScenes",value:function(){var g=this,E=[];return Object.keys(this.queueLoadScene).map(function(_){g.queueLoadScene[_]||E.push(_)}),E}},{key:"onSwitchScene",value:function(g){this.callbackSwitchScene=g}},{key:"setSceneData",value:function(g,E){if(E&&("data"in g||g.scene.attr({data:{}}),"data"in g)){var _=g.data||{};g.scene.attr({data:Me(Me({},_),E)}),console.info("SceneManager.setSceneData",{sceneName:g.name,sceneData:E,currentData:_})}}}]),e}();_._RF.pop(),_._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var JP=globalThis.game,JL=JP.event,JO=JP.monitorError,JB=GameCore,JN=JB.Events,JM=JB.Utils.Object,JD=function(){function e(){var g=this;Fe(this,e),this.screens={},this.handleOpenScreen=function(E){var _=E.screenName,k=E.screenData;g.openScreen(_,k)},this.handleCloseScreen=function(E){var _=E.screenName;g.closeScreen(_)}}var g,E,_,k;return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){JL.on(JN.OPEN_SCREEN,this.handleOpenScreen),JL.on(JN.CLOSE_SCREEN,this.handleCloseScreen)}},{key:"reorderScreens",value:function(){var g=JM.vals(this.screens).filter(function(g){return"ready"===g.state});g.sort(function(g,E){return g.order-E.order});for(var E=0;E<g.length;E++){var _=g[E];_.order=E,_.comp.node.setSiblingIndex(_.order)}}},{key:"addScreenKeys",value:function(g,E){var _=this;g.forEach(function(g,k){_.screens[iw[g]]&&(_.screens[iw[g]].order=k),_.screens[iw[g]]={state:"key",parent:E,key:g,order:k}})}},{key:"addScreens",value:function(g){var E=this;g.forEach(function(g,_){E.screens[g.node.name]={state:"ready",comp:g,order:_}})}},{key:"preloadScreens",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=JM.vals(this.screens).reduce(function(g,E){if("key"===E.state){var _=ie.loadPrefabAsync("screens/".concat(iw[E.key]));g.push(_)}return g},[]);return[4,Promise.all(g)];case 1:return[2,E.sent()]}})}),function(){return k.apply(this,arguments)})},{key:"getScreen",value:(_=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(P){switch(P.label){case 0:E=this.screens[g];if(null==E)return[2,(null==JO||JO.sendException(new Error("ScreenManager.openScreen Screen ".concat(g," not found")),{screenName:g,screens:this.getScreensAsMetadata()}),null)];if("ready"===E.state)return[2,E.comp];console.info("ScreenManager.getScreen","Screen ".concat(g," not found in cache, instantiating it..."));_=E.parent,k=E.key,C=E.order;return[4,ie.loadPrefabAsync("screens/".concat(iw[k]))];case 1:A=P.sent();if(!A)return[2,(null==JO||JO.sendException(new Error("ScreenManager.getScreen: Failed to load Screen ".concat(g," prefab...")),{screenName:g,screens:this.getScreensAsMetadata()}),null)];T=I(A);T.name=g,_.addChild(T),T.active=!1;R=T.getComponent(xW);return[2,R?(this.screens[g]={state:"ready",comp:R,order:C},this.reorderScreens(),R):(null==JO||JO.sendException(new Error("ScreenManager.getScreen: Screen ".concat(g," prefab doesn't have BaseScreen component...")),{screenName:g,screens:this.getScreensAsMetadata()}),null)]}})}),function(g){return _.apply(this,arguments)})},{key:"getScreensAsMetadata",value:function(){var g=this;return Object.keys(this.screens).map(function(E){var _=g.screens[E];return"ready"===_.state?"".concat(_.comp.node.name,"(loaded)"):"".concat(iw[_.key],"(not-loaded)")}).join(", ")}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:(E=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,3,,4]);ie.setBlockInput(!0);return[4,this.getScreen(g)];case 1:_=A.sent();if(ie.setBlockInput(!1),null==_||!_.node)return[2,void console.warn("ScreenManager.openScreen","Screen ".concat(g," not found"))];_.node.active=!0,_.node.setPosition(new em(0,0,0));k={screenName:g,screenData:E};JL.emit(JN.OPENING_SCREEN,k),iC.trackCurrentPage(g,!0),null==JO||JO.addMetadata({currentScreen:g});return[4,tZ.waitTweenAsync(0)];case 2:A.sent(),_.open(E),JL.emit(JN.OPENED_SCREEN,k);return[3,4];case 3:C=A.sent();console.error("ScreenManager.openScreen",C);return[3,4];case 4:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"closeScreen",value:(g=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,2,,3]);return[4,this.getScreen(g)];case 1:_=A.sent();if(!_)return[2,void console.warn("ScreenManager.closeScreen","Screen ".concat(g," not found"))];if(null===(E=_.node)||void 0===E||!E.active)return[2];k={screenName:g};JL.emit(JN.CLOSING_SCREEN,k),_.close(),iC.trackCurrentPage(g,!1),null==JO||JO.removeMetadata("currentScreen");return[3,3];case 2:C=A.sent();console.error("ScreenManager.closeScreen",C);return[3,3];case 3:return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"closeAllScreens",value:function(){for(var g in this.screens)"ready"===this.screens[g].state&&this.closeScreen(g)}}]),e}();_._RF.pop(),_._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var JF=GameCore,JU=JF.Configs.Core,Jx=JF.Events,Jz=JF.Plugins.Analytics.Events,JG=globalThis.game,JV=JG.context,JK=JG.storage,JH=JG.event,Jq=JG.analytics,JW=JG.monitorError;new(function(){function e(){var g=this;Fe(this,e),this.coreManager=new XH,this.adsManager=new Xx,this.matchManager=new Yf,this.sceneManager=new JI,this.screenManager=new JD,this.engineManager=new XZ,this.layoutManager=new Yn,this.playerManager=new YE,this.pluginsManager=new JS,this.handleWhenCoreBoot=function(){Q.inited?g.handleCocosInit():Q.once(e2.EVENT_POST_PROJECT_INIT,g.handleCocosInit)},this.handleCocosInit=function(){g.coreManager.requestStart()},this.handleWhenCoreStart=function(){g.playerManager.setupDefaultGameData(),g.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){g.initPlugins(),console.groupEnd(),Jq.event(Jz.LOAD_START),JU.StartSDKAfterLoadGame?JH.once(Jx.SCENE_LOADED,g.handleStartGameWhenMainSceneReady):g.processStartGame(),g.preloadScenes()},this.handleStartGameWhenMainSceneReady=function(){g.processStartGame()},this.handleSwitchScene=function(E){var _=E.sceneName,k=g.sceneManager.getCurrentScene();if((null==k?void 0:k.name)===_){g.screenManager.closeAllScreens(),g.screenManager.clearScreens();var C=null==k?void 0:k.getComponentsInChildren(xW);if(C.length>0){var A=C.map(function(g){return g.node.name}).join(", ");console.info("\uD83D\uDCFA Loaded Screens in ".concat(_,": ").concat(A)),g.screenManager.addScreens(C)}var T=null==k?void 0:k.getComponentInChildren(zs);if(T){var R=T.screenKeys.filter(function(g){return!C.some(function(E){return E.node.name===iw[g]})});if(0!==R.length){var I=R.map(function(g){return iw[g]}).join(", ");console.info("\uD83D\uDCFA Lazy-loading Screens in ".concat(_,": ").concat(I)),g.screenManager.addScreenKeys(R,T.node),g.screenManager.preloadScreens()}}}},console.groupCollapsed("\uD83D\uDCE6 Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}var g,E,_;return Ue(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.adsManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"preloadScenes",value:function(){"solo"===JK.getStorageData("context","sessionContextType")?lM.preloadDashboardScene():lM.preloadGameScene()}},{key:"processStartGame",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:console.groupEnd(),Jq.event(Jz.LOAD_COMPLETE);return[4,this.startGameAsync()];case 1:g.sent(),this.startProcessContextData();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"startGameAsync",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,GameSDK.startGameAsync()];case 1:E.sent();return[3,3];case 2:g=E.sent();console.warn("GameSDK.startGameAsync",g),_instanceof(g,Error)&&(null==JW||JW.sendException(g));return[3,3];case 3:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"startProcessContextData",value:(g=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!JH.getEventEmitCount(Jx.PLAYER_INFO_LOADED))return[3,6];Jq.event(Jz.APP_READY);E.label=1;case 1:E.trys.push([1,3,4,5]);this.playerManager.requestConnectedPlayers();return[4,JV.processContextData()];case 2:E.sent();return[3,5];case 3:g=E.sent();console.error("startProcessContextData",g),_instanceof(g,Error)&&(null==JW||JW.sendException(g));return[3,5];case 4:JH.emit(Jx.GAME_READY);return[7];case 5:return[3,7];case 6:JH.once(Jx.PLAYER_INFO_LOADED,this.startProcessContextData);E.label=7;case 7:return[2]}})}),function(){return g.apply(this,arguments)})},{key:"initPlugins",value:function(){this.pluginsManager.initProfiler(),this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),_._RF.pop()}}});(function(g){g("virtual:///prerequisite-imports/main","chunks:///main.js")})(function(g,E){System.register(g,[E],function(g,E){return{setters:[function(E){var _={};for(var k in E)if("default"!==k&&"__esModule"!==k)_[k]=E[k];g(_)}],execute:function(){}}})});