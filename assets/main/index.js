function _instanceof(g,E){if(null!=E&&"undefined"!=typeof Symbol&&E[Symbol.hasInstance])return!!E[Symbol.hasInstance](g);return g instanceof E}function _type_of(g){return g&&"undefined"!=typeof Symbol&&g.constructor===Symbol?"symbol":typeof g}function _ts_generator(g,E){var _,k,C,A,T={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return A={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(A[Symbol.iterator]=function(){return this}),A;function verb(g){return function(E){return step([g,E])}}function step(A){if(_)throw new TypeError("Generator is already executing.");while(T)try{if(_=1,k&&(C=2&A[0]?k.return:A[0]?k.throw||((C=k.return)&&C.call(k),0):k.next)&&!(C=C.call(k,A[1])).done)return C;if(k=0,C)A=[2&A[0],C.value];switch(A[0]){case 0:case 1:C=A;break;case 4:T.label++;return{value:A[1],done:false};case 5:T.label++;k=A[1];A=[0];continue;case 7:A=T.ops.pop();T.trys.pop();continue;default:if(C=T.trys,!(C=C.length>0&&C[C.length-1])&&(6===A[0]||2===A[0])){T=0;continue}if(3===A[0]&&(!C||A[1]>C[0]&&A[1]<C[3])){T.label=A[1];break}if(6===A[0]&&T.label<C[1]){T.label=C[1];C=A;break}if(C&&T.label<C[2]){T.label=C[2];T.ops.push(A);break}if(C[2])T.ops.pop();T.trys.pop();continue}A=E.call(g,T)}catch(g){A=[6,g];k=0}finally{_=C=0}if(5&A[0])throw A[1];return{value:A[0]?A[1]:void 0,done:true}}}System.register("chunks:///main.js",["cc"],function(g,E){var _,k,C,A,T,R,I,P,L,O,B,N,M,D,F,U,x,z,G,V,K,H,q,W,j,X,Y,J,Q,Z,$,ee,en,ei,er,ea,eo,es,el,eu,ec,eh,ep,ef,ey,ev,eg,em,eb,ew,eS,eE,e_,ek,eC,eA,eT,eR,eI,eP,eL,eO,eB,eN,eM,eD,eF,eU,ex,ez,eG,eV,eK,eH,eq,eW,ej,eX,eY,eJ,eQ,eZ,e$,e0,e1,e2;return{setters:[function(g){_=g.cclegacy,k=g._decorator,C=g.Node,A=g.Color,T=g.Canvas,R=g.UITransform,I=g.instantiate,P=g.Label,L=g.RichText,O=g.Toggle,B=g.Button,N=g.director,M=g.Component,D=g.AudioSource,F=g.resources,U=g.AudioClip,x=g.CCString,z=g.tween,G=g.Animation,V=g.CCInteger,K=g.CCFloat,H=g.Widget,q=g.Layout,W=g.view,j=g.screen,X=g.math,Y=g.isCCObject,J=g.CCBoolean,Q=g.game,Z=g.ccenum,$=g.find,ee=g.Prefab,en=g.JsonAsset,ei=g.AnimationClip,er=g.ImageAsset,ea=g.SpriteFrame,eo=g.Sprite,es=g.Enum,el=g.easing,eu=g.UIOpacity,ec=g.EventHandler,eh=g.animation,ep=g.Input,ef=g.Graphics,ey=g.profiler,ev=g.sys,eg=g.EventTarget,em=g.Vec3,eb=g.View,ew=g.ProgressBar,eS=g.Vec2,eE=g.Font,e_=g.Director,ek=g.Layers,eC=g.randomRangeInt,eA=g.pseudoRandomRangeInt,eT=g.pseudoRandom,eR=g.randomRange,eI=g.Pool,eP=g.repeat,eL=g.lerp,eO=g.approx,eB=g.EPSILON,eN=g.RealCurve,eM=g.Gradient,eD=g.bits,eF=g.random,eU=g.Material,ex=g.toRadian,ez=g.HorizontalTextAlignment,eG=g.Tween,eV=g.ParticleSystem2D,eK=g.ScrollView,eH=g.NodeEventType,eq=g.Mask,eW=g.settings,ej=g.Settings,eX=g.AssetManager,eY=g.input,eJ=g.macro,eQ=g.DynamicAtlasManager,eZ=g.ResolutionPolicy,e$=g.Texture2D,e0=g.UIRenderer,e1=g.CCObject,e2=g.Game}],execute:function(){function e(g,E){var _=Object.keys(g);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(g);E&&(k=k.filter(function(E){return Object.getOwnPropertyDescriptor(g,E).enumerable})),_.push.apply(_,k)}return _}function Me(g){for(var E=1;E<arguments.length;E++){var _=null!=arguments[E]?arguments[E]:{};E%2?e(Object(_),!0).forEach(function(E){Ge(g,E,_[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(_)):e(Object(_)).forEach(function(E){Object.defineProperty(g,E,Object.getOwnPropertyDescriptor(_,E))})}return g}function De(g,E,_,k,C,A,T){try{var R=g[A](T),I=R.value}catch(g){return void _(g)}R.done?E(I):Promise.resolve(I).then(k,C)}function Be(g){return function(){var E=this,_=arguments;return new Promise(function(k,C){var A=g.apply(E,_);function r(g){De(A,k,C,r,s,"next",g)}function s(g){De(A,k,C,r,s,"throw",g)}r(void 0)})}}function Fe(g,E){if(!_instanceof(g,E))throw new TypeError("Cannot call a class as a function")}function xe(g,E){for(var _=0;_<E.length;_++){var k=E[_];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(g,ot(k.key),k)}}function Ue(g,E,_){return E&&xe(g.prototype,E),_&&xe(g,_),Object.defineProperty(g,"prototype",{writable:!1}),g}function Ge(g,E,_){return(E=ot(E))in g?Object.defineProperty(g,E,{value:_,enumerable:!0,configurable:!0,writable:!0}):g[E]=_,g}function ze(g,E){if("function"!=typeof E&&null!==E)throw new TypeError("Super expression must either be null or a function");g.prototype=Object.create(E&&E.prototype,{constructor:{value:g,writable:!0,configurable:!0}}),Object.defineProperty(g,"prototype",{writable:!1}),E&&He(g,E)}function Ve(g){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)})(g)}function He(g,E){return(He=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,E){return g.__proto__=E,g})(g,E)}function qe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(g){return!1}}function We(){return(We=qe()?Reflect.construct.bind():function(g,E,_){var k=[null];k.push.apply(k,E);var C=new(Function.bind.apply(g,k));return _&&He(C,_.prototype),C}).apply(null,arguments)}function je(g){var E="function"==typeof Map?new Map:void 0;return(je=function(g){if(null===g||(_=g,-1===Function.toString.call(_).indexOf("[native code]")))return g;var _;if("function"!=typeof g)throw new TypeError("Super expression must either be null or a function");if(void 0!==E){if(E.has(g))return E.get(g);E.set(g,i)}function i(){return We(g,arguments,Ve(this).constructor)}return i.prototype=Object.create(g.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),He(i,g)})(g)}function Ke(g){if(void 0===g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function Ye(g,E){if(E&&("object"==(void 0===E?"undefined":_type_of(E))||"function"==typeof E))return E;if(void 0!==E)throw new TypeError("Derived constructors may only return object or undefined");return Ke(g)}function Xe(g){var E=qe();return function(){var _,k=Ve(g);if(E){var C=Ve(this).constructor;_=Reflect.construct(k,arguments,C)}else _=k.apply(this,arguments);return Ye(this,_)}}function Qe(g,E){for(;!Object.prototype.hasOwnProperty.call(g,E)&&null!==(g=Ve(g)););return g}function Je(){return(Je="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(g,E,_){var k=Qe(g,E);if(k){var C=Object.getOwnPropertyDescriptor(k,E);return C.get?C.get.call(arguments.length<3?g:_):C.value}}).apply(this,arguments)}function Ze(g,E,_,k){return(Ze="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(g,E,_,k){var C,A=Qe(g,E);if(A){if((C=Object.getOwnPropertyDescriptor(A,E)).set)return C.set.call(k,_),!0;if(!C.writable)return!1}if(C=Object.getOwnPropertyDescriptor(k,E)){if(!C.writable)return!1;C.value=_,Object.defineProperty(k,E,C)}else Ge(k,E,_);return!0})(g,E,_,k)}function $e(g,E,_,k,C){if(!Ze(g,E,_,k||g)&&C)throw new TypeError("failed to set property");return _}function et(g,E){return function(g){if(Array.isArray(g))return g}(g)||function(g,E){var _=null==g?null:"undefined"!=typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(null!=_){var k,C,A,T,R=[],I=!0,P=!1;try{if(A=(_=_.call(g)).next,0===E){if(Object(_)!==_)return;I=!1}else for(;!(I=(k=A.call(_)).done)&&(R.push(k.value),R.length!==E);I=!0);}catch(g){P=!0,C=g}finally{try{if(!I&&null!=_.return&&(T=_.return(),Object(T)!==T))return}finally{if(P)throw C}}return R}}(g,E)||nt(g,E)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(g){return function(g){if(Array.isArray(g))return it(g)}(g)||function(g){if("undefined"!=typeof Symbol&&null!=g[Symbol.iterator]||null!=g["@@iterator"])return Array.from(g)}(g)||nt(g)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nt(g,E){if(g){if("string"==typeof g)return it(g,E);var _=Object.prototype.toString.call(g).slice(8,-1);return"Object"===_&&g.constructor&&(_=g.constructor.name),"Map"===_||"Set"===_?Array.from(g):"Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_)?it(g,E):void 0}}function it(g,E){(null==E||E>g.length)&&(E=g.length);for(var _=0,k=new Array(E);_<E;_++)k[_]=g[_];return k}function at(g,E){var _="undefined"!=typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(!_){if(Array.isArray(g)||(_=nt(g))||E&&g&&"number"==typeof g.length){_&&(g=_);var k=0,a=function(){};return{s:a,n:function(){return k>=g.length?{done:!0}:{done:!1,value:g[k++]}},e:function(g){throw g},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var C,A=!0,T=!1;return{s:function(){_=_.call(g)},n:function(){var g=_.next();return A=g.done,g},e:function(g){T=!0,C=g},f:function(){try{A||null==_.return||_.return()}finally{if(T)throw C}}}}function ot(g){var E=function(g,E){if("object"!=(void 0===g?"undefined":_type_of(g))||null===g)return g;var _=g[Symbol.toPrimitive];if(void 0!==_){var k=_.call(g,E||"default");if("object"!=(void 0===k?"undefined":_type_of(k)))return k;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===E?String:Number)(g)}(g,"string");return"symbol"==(void 0===E?"undefined":_type_of(E))?E:String(E)}function rt(g,E,_,k){_&&Object.defineProperty(g,E,{enumerable:_.enumerable,configurable:_.configurable,writable:_.writable,value:_.initializer?_.initializer.call(k):void 0})}function st(g,E,_,k,C){var A={};return Object.keys(k).forEach(function(g){A[g]=k[g]}),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=_.slice().reverse().reduce(function(_,k){return k(g,E,_)||_},A),C&&void 0!==A.initializer&&(A.value=A.initializer?A.initializer.call(C):void 0,A.initializer=void 0),void 0===A.initializer&&(Object.defineProperty(g,E,A),A=null),A}var g,e4,e3,e5,e6,e8,e9,e7;_._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var te=k.ccclass,tn=k.property;g=te("internal.DebugViewRuntimeControl"),e4=tn(C),e3=tn(C),e5=tn(C),g((e8=st((e6=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"compositeModeToggle",e8,Ke(g)),rt(g,"singleModeToggle",e9,Ke(g)),rt(g,"EnableAllCompositeModeButton",e7,Ke(g)),g._single=0,g.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],g.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],g.strMisc=["CSM Layer Coloration","Lighting With Albedo"],g.compositeModeToggleList=[],g.singleModeToggleList=[],g.miscModeToggleList=[],g.textComponentList=[],g.labelComponentList=[],g.textContentList=[],g._currentColorIndex=0,g.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],g.color=[A.WHITE,A.BLACK,A.RED,A.GREEN,A.BLUE],g}return Ue(n,[{key:"start",value:function(){if(this.node.parent.getComponent(T)){var g=this.node.parent.getComponent(R),E=.5*g.width,_=.5*g.height,k=.1*E-E,C=_-.1*_,N=this.node.getChildByName("MiscMode"),M=I(N);M.parent=this.node,M.name="Buttons";var D=I(N);D.parent=this.node,D.name="Titles";for(var F=0;F<2;F++){var U=I(this.EnableAllCompositeModeButton.getChildByName("Label"));U.setPosition(k+(F>0?450:150),C,0),U.setScale(.75,.75,.75),U.parent=D;var x=U.getComponent(P);x.string=F?"----------Composite Mode----------":"----------Single Mode----------",x.color=A.WHITE,x.overflow=0,this.labelComponentList[this.labelComponentList.length]=x}C-=20;for(var z=0,G=0;G<this.strSingle.length;G++,z++){G===this.strSingle.length>>1&&(k+=200,z=0);var V=G?I(this.singleModeToggle):this.singleModeToggle;V.setPosition(k,C-20*z,0),V.setScale(.5,.5,.5),V.parent=this.singleModeToggle.parent;var K=V.getComponentInChildren(L);K.string=this.strSingle[G],this.textComponentList[this.textComponentList.length]=K,this.textContentList[this.textContentList.length]=K.string,V.on(O.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[G]=V}k+=200,this.EnableAllCompositeModeButton.setPosition(k+15,C,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(B.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=M;var H=this.EnableAllCompositeModeButton.getComponentInChildren(P);this.labelComponentList[this.labelComponentList.length]=H;var q=I(this.EnableAllCompositeModeButton);q.setPosition(k+90,C,0),q.setScale(.5,.5,.5),q.on(B.EventType.CLICK,this.changeTextColor,this),q.parent=M,(H=q.getComponentInChildren(P)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=H;var W=I(this.EnableAllCompositeModeButton);W.setPosition(k+200,C,0),W.setScale(.5,.5,.5),W.on(B.EventType.CLICK,this.hideUI,this),W.parent=this.node.parent,(H=W.getComponentInChildren(P)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=H,this.hideButtonLabel=H,C-=40;for(var j=0;j<this.strMisc.length;j++){var X=I(this.compositeModeToggle);X.setPosition(k,C-20*j,0),X.setScale(.5,.5,.5),X.parent=N;var Y=X.getComponentInChildren(L);Y.string=this.strMisc[j],this.textComponentList[this.textComponentList.length]=Y,this.textContentList[this.textContentList.length]=Y.string,X.getComponent(O).isChecked=!!j,X.on(O.EventType.TOGGLE,j?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[j]=X}C-=150;for(var J=0;J<this.strComposite.length;J++){var Q=J?I(this.compositeModeToggle):this.compositeModeToggle;Q.setPosition(k,C-20*J,0),Q.setScale(.5,.5,.5),Q.parent=this.compositeModeToggle.parent;var Z=Q.getComponentInChildren(L);Z.string=this.strComposite[J],this.textComponentList[this.textComponentList.length]=Z,this.textContentList[this.textContentList.length]=Z.string,Q.on(O.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[J]=Q}}else console.error("debug-view-runtime-control should be child of Canvas")}},{key:"isTextMatched",value:function(g,E){var _=new String(g),k=_.search(">");return -1===k?g===E:(_=(_=_.substr(k+1)).substr(0,_.search("<")))===E}},{key:"toggleSingleMode",value:function(g){for(var E=N.root.debugView,_=g.getComponentInChildren(L),k=0;k<this.strSingle.length;k++)this.isTextMatched(_.string,this.strSingle[k])&&(E.singleMode=k)}},{key:"toggleCompositeMode",value:function(g){for(var E=N.root.debugView,_=g.getComponentInChildren(L),k=0;k<this.strComposite.length;k++)this.isTextMatched(_.string,this.strComposite[k])&&E.enableCompositeMode(k,g.isChecked)}},{key:"toggleLightingWithAlbedo",value:function(g){N.root.debugView.lightingWithAlbedo=g.isChecked}},{key:"toggleCSMColoration",value:function(g){N.root.debugView.csmLayerColoration=g.isChecked}},{key:"enableAllCompositeMode",value:function(g){var E=N.root.debugView;E.enableAllCompositeMode(!0);for(var _=0;_<this.compositeModeToggleList.length;_++)this.compositeModeToggleList[_].getComponent(O).isChecked=!0;var k=this.miscModeToggleList[0].getComponent(O);k.isChecked=!1,E.csmLayerColoration=!1,(k=this.miscModeToggleList[1].getComponent(O)).isChecked=!0,E.lightingWithAlbedo=!0}},{key:"hideUI",value:function(g){var E=this.node.getChildByName("Titles"),_=!E.active;this.singleModeToggleList[0].parent.active=_,this.miscModeToggleList[0].parent.active=_,this.compositeModeToggleList[0].parent.active=_,this.EnableAllCompositeModeButton.parent.active=_,E.active=_,this.hideButtonLabel.string=_?"Hide UI":"Show UI"}},{key:"changeTextColor",value:function(g){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var E=0;E<this.textComponentList.length;E++)this.textComponentList[E].string=this.strColor[this._currentColorIndex]+this.textContentList[E]+"</color>";for(var _=0;_<this.labelComponentList.length;_++)this.labelComponentList[_].color=this.color[this._currentColorIndex]}},{key:"onLoad",value:function(){}},{key:"update",value:function(g){}}]),n}(M)).prototype,"compositeModeToggle",[e4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e9=st(e6.prototype,"singleModeToggle",[e3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e7=st(e6.prototype,"EnableAllCompositeModeButton",[e5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e6));_._RF.pop(),_._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var ti=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,g)).audioSource=_,k}return Ue(n,[{key:"play",value:function(g){if(g){var E=g.volume,_=void 0===E?1:E,k=g.loop,C=void 0!==k&&k;this.audioSource.volume=_,this.audioSource.loop=C}this.audioSource.play()}},{key:"pause",value:function(){this.audioSource.pause()}},{key:"resume",value:function(){this.audioSource.state===D.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function(){this.audioSource.stop()}},{key:"setVolume",value:function(g){this.audioSource.volume=g}},{key:"getVolume",value:function(){return this.audioSource.volume}},{key:"getAudioSource",value:function(){return this.audioSource}}]),n}(GameCore.Plugins.Audio.BaseAudioPlayer);_._RF.pop(),_._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var tr=GameCore,ta=tr.Plugins.Audio.BaseChannelManager,to=tr.Utils.Array,ts=function(g){ze(i,g);var E,_=Xe(i);function i(g,E){var k;return Fe(this,i),(k=_.call(this,E)).allowMultipleTracking={},k.handleLoadedAudio=function(g,E){var _=k.node.addComponent(D);return _.clip=E,_.playOnAwake=!1,new ti(g,_)},k.node=g,k}return Ue(i,[{key:"playing",value:function(g){var E,_=null===(E=this.getAudioClip(g))||void 0===E?void 0:E.audioPlayer;return!!_&&_.getAudioSource().state===D.AudioState.PLAYING}},{key:"onLoadAudio",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(E){_=this;return[2,new Promise(function(E,k){F.load(g,U,function(C,A){try{if(C)throw new Error(C.message);if(!_.node.isValid)return;var T=_.handleLoadedAudio(g,A);E(T)}catch(g){_instanceof(g,Error)?k(g):k(new Error("Audio load: Unknown error"))}})})]})}),function(g,_){return E.apply(this,arguments)})},{key:"playWithRealConfig",value:function(g,E){if(this.isCanPlay(E)){if(E){var _=E.volume,k=void 0===_?1:_,C=E.allowMultiple,A=void 0!==C&&C;if(E.volume=this.getVolume()*k,A){var T=g.getAudioSource().clip;if(!T)return;return void this.requestDuplicateAudioPlayer(g.getKey(),T,E).play(E)}}g.play(E)}}},{key:"isCanPlay",value:function(g){var E=this;if(g){var _=g.checkList;if((void 0===_?[]:_).some(function(g){var _=E.getAudioClip(g);return!!_&&_.audioPlayer.getAudioSource().state===D.AudioState.PLAYING}))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function(g,E,_){var k=this.getDuplicateAudioFromPool(g);if(k){if(_){var C=k.key,A=_.volume,T=void 0===A?1:A;this.setAudioClip(C,{volume:T})}return k.audioPlayer}var R="".concat(g,"_").concat(this.allowMultipleTracking[g].currentPostFix),I=this.handleLoadedAudio(R,E);return this.allowMultipleTracking[g].list.push({audioPlayer:I,key:R}),this.allowMultipleTracking[g].currentPostFix+=1,this.setAudioClip(R,{audioPlayer:I,volume:1}),I}},{key:"getDuplicateAudioFromPool",value:function(g){if(this.allowMultipleTracking[g]){var E=this.allowMultipleTracking[g].list,_=to.search(E,function(g){return g.audioPlayer.getAudioSource().state!==D.AudioState.PLAYING});if(_)return _}else this.allowMultipleTracking[g]={currentPostFix:1,list:[]};return null}}]),i}(ta);_._RF.pop();var tl,tu,tc,th,tp,ty=!1;_._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var tv,tg,tm,tb,tw,tS=k.ccclass,tE=k.property,t_=globalThis.game,tk=t_.audio,tC=t_.player,tA=(tl=tS("Music"),tu=tE(x),tl((tp=st((th=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"channelId",tp,Ke(g)),g.channel=null,g.isMute=!1,g.volume=1,g}return Ue(n,[{key:"__preload",value:function(){this.makePersistent(),this.channel=new ts(this.node,this.channelId),tk.addChannel(this.channel)}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"playing",value:function(g){var E,_;return null!==(E=null===(_=this.channel)||void 0===_?void 0:_.playing(g))&&void 0!==E&&E}},{key:"play",value:function(g,E){if(!this.isMusicEnable())return Promise.resolve();var _=null!=E?E:{};return _.loop||(_.loop=!0),tk.play(g,_,this.channelId)}},{key:"isMusicEnable",value:function(){return!!tC.getPlayerSetting("music")}},{key:"setVolume",value:function(g){this.volume=g,this.isMute||tk.setVolume(g,this.channelId)}},{key:"getVolume",value:function(){return tk.getVolume(this.channelId)}},{key:"pause",value:function(g){tk.pause(g,this.channelId)}},{key:"resume",value:function(g){this.isMusicEnable()&&tk.resume(g,this.channelId)}},{key:"stop",value:function(g){tk.stop(g,this.channelId)}},{key:"mute",value:function(g){this.isMute=g,g?tk.mute(this.channelId):(this.setVolume(this.volume),tk.unmute(this.channelId))}}]),n}(M)).prototype,"channelId",[tu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),tc=th))||tc);_._RF.pop(),_._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var tT=k.ccclass,tR=k.property,tI=globalThis.game,tP=tI.audio,tL=tI.player,tO=(tv=tT("Sound"),tg=tR(x),tv((tw=st((tb=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"channelId",tw,Ke(g)),g.channel=null,g}return Ue(n,[{key:"__preload",value:function(){this.channel=new ts(this.node,this.channelId),tP.addChannel(this.channel)}},{key:"onLoad",value:function(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"removePersistent",value:function(){N.removePersistRootNode(this.node)}},{key:"play",value:function(g,E){return this.isSoundEnable()?tP.play(g,E,this.channelId):Promise.resolve()}},{key:"isSoundEnable",value:function(){return!!tL.getPlayerSetting("sound")}},{key:"setVolume",value:function(g){tP.setVolume(g,this.channelId)}},{key:"pause",value:function(g){tP.pause(g,this.channelId)}},{key:"resume",value:function(g){this.isSoundEnable()&&tP.resume(g,this.channelId)}},{key:"stop",value:function(g){tP.stop(g,this.channelId)}},{key:"stopAll",value:function(){tP.stopAll(this.channelId)}},{key:"mute",value:function(g){g?tP.mute(this.channelId):tP.unmute(this.channelId)}}]),n}(M)).prototype,"channelId",[tg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),tm=tb))||tm);_._RF.pop(),_._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);var tB,tN,tM,tD,tF,tU,tx,tz,tG,tV,tK,tH,tq,tW,tj,tX,tY,tJ,tQ,tZ,t$=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"elasticOut",value:function(g,E,_){var k=E||.1,C=_||.1;if(0===g)return 0;if(1===g)return 1;var A=C/4;return k<1?k=1:A=C*Math.asin(1/k)/(2*Math.PI),k*Math.pow(2,-10*g)*Math.sin(2*Math.PI*(g-A)/C)+1}},{key:"easeOutExpo",value:function(g){return 1===g?1:1-Math.pow(2,-10*g)}},{key:"easeInExpo",value:function(g){return 0===g?0:Math.pow(2,10*g-10)}},{key:"runTweenAsync",value:function(g,E){return new Promise(function(_){var k=g.call(function(){_({tween:g})}).start();E&&(E.aborted?(k.stop(),_({tween:g})):E.addAbortListener(function(){k.stop(),_({tween:g})}))})}},{key:"runOnUpdateAsync",value:function(g,E,_,k){return new Promise(function(C,A){var T=z(g).to(E,{},{onUpdate:function(g,E){if(void 0!==E)try{_(E)}catch(g){A(_instanceof(g,Error)?g:new Error(JSON.stringify(g)))}}}).call(function(){C({tween:T})}).start();k&&(k.aborted?(T.stop(),C({tween:T})):k.addAbortListener(function(){T.stop(),C({tween:T})}))})}},{key:"waitTweenAsync",value:function(g,E){return new Promise(function(_){var k=z({});k.delay(g),k.call(function(){_()}),k.start(),E&&(E.aborted?(k.stop(),_()):E.addAbortListener(function(){k.stop(),_()}))})}},{key:"runAnimationAsync",value:function(g,E,_){return void 0===_?new Promise(function(_){g.play(E),g.once(G.EventType.FINISHED,_)}):_.aborted?Promise.resolve():new Promise(function(k){_.addAbortListener(function(){g.off(G.EventType.FINISHED,k),g.stop(),k()}),g.play(E),g.once(G.EventType.FINISHED,k)})}}]),e}();_._RF.pop(),_._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var t0=k.ccclass,t1=k.property,t2=(tB=t0("AutoLayoutWrappee"),tN=t1({type:R}),tM=t1({type:R}),tB((tU=st((tF=Ue(function e(){Fe(this,e),rt(this,"wrapeeContainer",tU,this),rt(this,"wrapee",tx,this)})).prototype,"wrapeeContainer",[tN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tx=st(tF.prototype,"wrapee",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tD=tF))||tD),t4=(tz=t0("AutoLayout"),tG=t1({displayName:"Use Auto Layout"}),tV=t1({type:[t2],displayName:"Children",visible:function(){return this.useAutoLayout}}),tK=t1({visible:!1,serializable:!0}),tH=t1({type:V,displayName:"Selected Index",visible:function(){return this.useAutoLayout}}),tq=t1({type:K,displayName:"Deselected Icon Width",group:"Edge Icons",visible:function(){return this.useAutoLayout}}),tW=t1({visible:!1,serializable:!0}),tz((tY=st((tX=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"useAutoLayout",tY,Ke(g)),rt(g,"children",tJ,Ke(g)),g.mappedChildren=[],rt(g,"selected",tQ,Ke(g)),rt(g,"deselectedIconW",tZ,Ke(g)),g.tweens=[],g}return Ue(i,[{key:"selectedIndex",get:function(){return this.selected},set:function(g){this.selected=g,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(g){this.deselectedIconW=g,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map(function(g){var E=g.wrapeeContainer.getComponent(H);if(!E)throw new Error("AutoLayout: Widget component not found");return Me(Me({},g),{},{wrapeeContainerWidget:E})})}},{key:"updateLayout",value:function(g){var E=arguments.length>0&&void 0!==g&&g;if(this._layoutDirty||E){this.updateChildrenAnchors();var _,k=at(this.mappedChildren);try{for(k.s();!(_=k.n()).done;){var C=_.value;C.wrapeeContainerWidget.updateAlignment()}}catch(g){k.e(g)}finally{k.f()}}Je(Ve(i.prototype),"updateLayout",this).call(this,E)}},{key:"getSelectedWorldX",value:function(){var g=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?g.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*g.width:g.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(g){if(g<this.selectedIndex)return 0;if(g>this.selectedIndex)return 1;if(0===g){var E=this.mappedChildren[g].wrapeeContainer.width,_=this.deselectedIconWidth/2,k=this.paddingLeft;return((k+E+(E-_+this.spacingX))/2-k)/E}if(g===this.children.length-1){var C=this.mappedChildren[g].wrapeeContainer.width,A=C-this.deselectedIconWidth/2+this.spacingX;return((A+C+this.paddingRight)/2-A)/C}return .5}},{key:"updateChildrenAnchors",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=this,_=at(this.tweens);try{for(_.s();!(g=_.n()).done;)g.value.stop()}catch(g){_.e(g)}finally{_.f()}this.tweens=[];return[4,Promise.all([this.children.flatMap(function(g,_){return E.getChildrenAnchorsTweens(g,E.getAnchorX(_))}).map(function(g){return t$.runTweenAsync(g)})])];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var g=this;this.children.forEach(function(E,_){var k=g.getAnchorX(_);E.wrapee.setAnchorPoint(k,E.wrapee.anchorY),E.wrapeeContainer.setAnchorPoint(k,E.wrapeeContainer.anchorY)})}},{key:"getChildrenAnchorsTweens",value:function(g,E){return[z(g.wrapee).to(.3,{anchorX:E},{easing:"sineInOut"}).call(function(){g.wrapee.setAnchorPoint(E,g.wrapee.anchorY)}),z(g.wrapeeContainer).to(.3,{anchorX:E},{easing:"sineInOut"}).call(function(){g.wrapeeContainer.setAnchorPoint(E,g.wrapeeContainer.anchorY)})]}}]),i}(q)).prototype,"useAutoLayout",[tG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),tJ=st(tX.prototype,"children",[tV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tQ=st(tX.prototype,"selected",[tK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),st(tX.prototype,"selectedIndex",[tH],Object.getOwnPropertyDescriptor(tX.prototype,"selectedIndex"),tX.prototype),st(tX.prototype,"deselectedIconWidth",[tq],Object.getOwnPropertyDescriptor(tX.prototype,"deselectedIconWidth"),tX.prototype),tZ=st(tX.prototype,"deselectedIconW",[tW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tj=tX))||tj);_._RF.pop(),_._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);var t3="view-resize",t5="view-resized",t6="request-view-resize",t8="layout-changed",t9="gameplay-update-config",t7="opened-skip-overlay",ne="closed-skip-overlay",nn="result-scene-replay",ni="result-scene-home",nr="upgrade-dynamic-atlas",na="asset-quality-change",no="change-quality-assets",ns="widget-resized";_._RF.pop(),_._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);var nl=function(){function e(){Fe(this,e)}return Ue(e,[{key:"getWindowSizeVsWorldGameRatio",value:function(){var g=W.getVisibleSize(),E=j.windowSize.width,_=window.devicePixelRatio;return E/(_=_>2?2:_)/g.width}},{key:"getBoundingBoxTo",value:function(g,E){var _=X.mat4();X.Mat4.fromSRT(_,E.getRotation(),E.getPosition(),E.getScale());var k=E.getComponent(R);if(!k)throw new Error("Node must have UITransform component");var C=k.anchorPoint,A=k.contentSize,T=A.width,I=A.height,P=new X.Rect(-C.x*T,-C.y*I,T,I),L=X.mat4();if(X.Mat4.multiply(L,g,_),P.transformMat4(L),!E.children||0===E.children.length)return P;var O,B=E.children,N=E.getWorldMatrix(),M=at(B);try{for(M.s();!(O=M.n()).done;){var D=O.value;if(null!=D&&D.active){if(D.getComponent(R)){var F=this.getBoundingBoxTo(N,D);F&&X.Rect.union(P,P,F)}}}}catch(g){M.e(g)}finally{M.f()}return P}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getBoundingBoxToWorld",value:function(g){if(g.parent){var E=g.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(E,g)}var _=g.getComponent(R);if(!_)throw new Error("Node must have UITransform component");return _.getBoundingBox()}},{key:"worldSizeToCssSize",value:function(g){return g*this.inst.getWindowSizeVsWorldGameRatio()}},{key:"cssSizeToWorldSize",value:function(g){return g/this.inst.getWindowSizeVsWorldGameRatio()}},{key:"getScreenWidthCss",value:function(){var g=document,E=g.body,_=g.documentElement,k=E.clientWidth,C=_.clientWidth;return Math.max(C,k)||0}},{key:"getScreenHeightCss",value:function(){var g=document,E=g.body,_=g.documentElement,k=E.clientHeight,C=_.clientHeight;return Math.max(C,k)||0}}]),e}();_._RF.pop(),_._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);var nu,nc,nh,np,nd=GameCore.Utils,ny=nd.Array,nv=nd.Object,ng=nd.Valid,nm=nd.String,nb=globalThis.game.monitorError,nw="compUtils",nS="".concat(nw,"_validateProperty"),jn=function(g){return"".concat(nS,"_").concat(nm.capitalize(g))},nE="".concat(nw,"_getComponent"),n_=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"".concat(g," is missing the required property: <").concat(_,">"))).className=g,k.propertyName=_,k}return Ue(n)}(je(Error)),nk=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"".concat(g," is missing these required properties: [").concat(_.map(function(g){return g.propertyName}).join(", "),"]"))).className=g,k.errors=_,k}return Ue(n)}(je(Error)),nC=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"],nA=function(){function e(){Fe(this,e),this.validComponentCalled={}}return Ue(e,[{key:"validateRequiredComponents",value:function(g){var E,_=g.name,k=g.constructor,C=at(this.getRequiredComponentNames(k));try{for(C.s();!(E=C.n()).done;){var A=E.value;if(!g.getComponent(A))throw new Error("".concat(_,": Missing required ").concat(A," component"))}}catch(g){C.e(g)}finally{C.f()}}},{key:"validateRequiredProperties",value:function(g){var E,_=g.name,k=g.constructor,C=at(this.getRequiredPropNames(k));try{for(C.s();!(E=C.n()).done;){var A=E.value;if(!nv.hasOwn(g,A))throw new Error("".concat(_,": Missing required ").concat(A," property"));var T=this.getProperty(A,g);if(!Y(T))throw new Error("".concat(_,": ").concat(A," property is not a cc object"))}}catch(g){C.e(g)}finally{C.f()}}},{key:"validateCustomProperties",value:function(g){var E,_=g.name,k=at(this.getCustomPropNames(g));try{for(k.s();!(E=k.n()).done;){var C=E.value;if(!nv.hasOwn(g,C))throw new Error("".concat(_,": Missing required ").concat(C," property"));var A=this.getProperty(C,g);if(!Y(A))throw new Error("".concat(_,": ").concat(C," property is not a cc object"))}}catch(g){k.e(g)}finally{k.f()}}},{key:"getProperty",value:function(g,E){var _;if(nv.hasOwn(E,g))return(null!==(_=Object.getOwnPropertyDescriptor(E,g))&&void 0!==_?_:{}).value}},{key:"getProps",value:function(g){if(!nv.hasOwn(g,"__props__"))return[];var E=g.__props__;return Array.isArray(E)?E:[]}},{key:"getRequiredPropNames",value:function(g){return this.getProps(g).filter(function(E){return"node"!==E&&!!nv.hasOwn(g,E)&&!!Y(g[E])&&!E.startsWith("_")})}},{key:"getBaseComponentName",value:function(g){for(var E=0,_=nC;E<_.length;E++){var k=_[E];if(k.indexOf(g)>=0)return k}return g}},{key:"getRequiredComponentNames",value:function(g){var E=this;if(!nv.hasOwn(g,"_requireComponent"))return[];var _=g._requireComponent;return Array.isArray(_)?_.map(function(g){return E.getBaseComponentName(g)}):[]}},{key:"getCustomPropNames",value:function(g){var E=this,_=Object.keys(g),k=this.getProps(g.constructor);return ny.difference(_,k).filter(function(g){return g.indexOf("_")<0}).filter(function(_){if(!nv.hasOwn(g,_))return!1;var k=E.getProperty(_,g);return!(!ng.isObject(k)||!Y(k))})}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"required",value:function(g){var E=arguments.length>0&&void 0!==g?g:"both",t=function(g){if("function"==typeof E)return E(g);switch(E){case"null-check":return null!==g;case"undefined-check":return void 0!==g;case"both":return null!=g;default:return!1}};return function(g,E){if("function"==typeof g)throw new Error("The required decorator can only be applied to non-static class properties.");var _=jn(E);if(void 0!==g[_])throw new Error("The required decorator found that property name ".concat(_," already exists. The reserved method name ").concat(_," is used already or the decorator was applied multiple times."));g[_]=function(g){if(!t(this[E]))throw new n_(g,E)}}}},{key:"validateDecoratedProperties",value:function(g){var E,_=g.constructor.name,k=[],C=g;for(var A in C)if("function"==typeof C[A]&&(E=A,nm.matchStart(E,nS)))try{C[A]()}catch(g){if(_instanceof(g,n_)){k.push(g);continue}throw g}if(0!==k.length){var T=new nk(_,k);if(ng.isDebugger())throw T;console.error(T),null==nb||nb.sendException(T,{componentName:T.className,missingProperties:T.errors.map(function(g){return g.propertyName})})}}},{key:"getComponent",value:function(g){return function(E,_){if("function"==typeof E)throw new Error("The getComponent decorator can only be applied to non-static class properties.");var k,C=(k=_,"".concat(nE,"_").concat(nm.capitalize(k)));if(void 0!==E[C])throw new Error("The getComponent decorator found that property name ".concat(C," already exists. The reserved method name ").concat(C," is used already or the decorator was applied multiple times."));E[C]=function(E){E[_]=E.getComponent(g)}}}},{key:"getDecoratedComponent",value:function(g){var E,_=g;for(var k in _)"function"==typeof _[k]&&(E=k,nm.matchStart(E,nE)&&_[k](g))}},{key:"onlyRunInLifeCycle",value:function(g,E,_){var k=_.value;_.value=function(){if(this.enabledInHierarchy){for(var g=arguments.length,_=new Array(g),C=0;C<g;C++)_[C]=arguments[C];return k.apply(this,_)}console.info("Skipping method call ".concat(String(E)," because component ").concat(this.constructor.name," is not enabled in hierarchy"))}}},{key:"onlyRunInLifeCycleAsync",value:function(g,E,_){var k=_.value,C=function(){var g=Be(function(){var g,_,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:if(!this.enabledInHierarchy)return[3,2];for(g=A.length,_=new Array(g),C=0;C<g;C++)_[C]=A[C];return[4,k.apply(this,_)];case 1:return[2,T.sent()];case 2:return[2,(console.info("Skipping method call ".concat(String(E)," because component ").concat(this.constructor.name," is not enabled in hierarchy")),Promise.resolve())]}})});return function(){return g.apply(this,arguments)}}();_.value=C}},{key:"decorateComponent",value:function(g){this.getDecoratedComponent(g),this.validateDecoratedProperties(g)}},{key:"lazyValidateProperties",value:function(g,E){var _=!(arguments.length>1&&void 0!==E)||E;if(_){var k=g.constructor,C=k.name;if(!this.inst.validComponentCalled[C])try{this.inst.validateRequiredComponents(g),this.inst.validateRequiredProperties(g),this.inst.validateCustomProperties(g)}catch(E){g.enabled=!1,console.error(E)}finally{this.inst.validComponentCalled[C]=!0}}}}]),e}();_._RF.pop(),_._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);var nT=k.ccclass,nR=k.property;nu=nT("Background"),nc=nR(J),nu((np=st((nh=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"fitHeight",np,Ke(g)),g.resize=function(){if(g.fitHeight){var E=nl.cssSizeToWorldSize(nl.getScreenHeightCss());g.uiTransform.width=E*g.ratio,g.uiTransform.height=E}},g}return Ue(n,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.ratio=this.uiTransform.width/this.uiTransform.height,this.validateRequiredComponents(),this.listenGameEvents(),this.resize()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t5,this.resize)}},{key:"unlistenGameEvents",value:function(){Q.off(t5,this.resize)}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}}]),n}(M)).prototype,"fitHeight",[nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nh));_._RF.pop(),_._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var nI="STARS_UPDATED",nP="PLAY_BUTTON_PRESS",nL="REQUEST_NAVIGATION",nO="REQUEST_NAVIGATION_ANIMATION",nB="DASHBOARD_EVENTS_BUTTON_PRESS";_._RF.pop(),_._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var nN=function(g){return g[g.store=0]="store",g[g.collections=1]="collections",g[g.home=2]="home",g[g.leaderboard=3]="leaderboard",g[g.tournaments=4]="tournaments",g}(nN||{});Z(nN),_._RF.pop(),_._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);var nM=GameCore.Utils.Array,nD=function(){function e(){Fe(this,e),this.callbacks=[],this.isAborted=!1,this.abortReason="",this.callbacks=[]}var g;return Ue(e,[{key:"aborted",get:function(){return this.isAborted}},{key:"reason",get:function(){return this.abortReason}},{key:"addAbortListener",value:function(g){this.callbacks.push(g)}},{key:"removeAbortListener",value:function(g){var E=nM.searchIndex(this.callbacks,function(E){return E===g});-1!==E?this.callbacks.splice(E,1):console.warn("Abort listener not found")}},{key:"abort",value:function(g){if(!this.isAborted){this.isAborted=!0,this.abortReason=g;var E,_=at(this.callbacks);try{for(_.s();!(E=_.n()).done;){var k=E.value;"function"==typeof k&&k()}}catch(g){_.e(g)}finally{_.f()}this.callbacks=[]}}},{key:"untilAborted",value:(g=Be(function(){var g;return _ts_generator(this,function(E){g=this;if(!this.isAborted)return[2,new Promise(function(E){g.addAbortListener(function(){return E()})})];return[2]})}),function(){return g.apply(this,arguments)})},{key:"call",value:function(g){this.aborted||g(this)}},{key:"callAsync",value:function(g){return this.aborted?Promise.resolve():g(this)}},{key:"chain",value:function(g){var E=this;_instanceof(g,e)?g.addAbortListener(function(){return E.abort()}):g.addEventListener("abort",function(){return E.abort()})}}],[{key:"hasBeenAborted",value:function(g){return null==g||g.aborted}}]),e}();_._RF.pop(),_._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var nF=function(g){return g.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",g.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",g.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",g.CLOUD_IDLE_ANIM="animations/CloudIdle",g.TORNADO_IDLE_ANIM="animations/TornadoIdle",g.TILE_BREAK_ANIM="animations/TileBreak",g.TILE_CLEAR_ANIM="animations/TileClear",g.TILE_SHAKE_ANIM="animations/TileShake",g.TILE_SKIN_FOLDER="loadable/tiles",g.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",g.ITEM_POPUP_FOLDER="loadable/item-popup",g.SUMMER_BG="images/bg/summer",g.AUTUMN_BG="images/bg/autumn",g.WINTER_BG="images/bg/winter",g.FLOWER_FIELD_BG="images/bg/flower-field",g.TREE_PLANTING_FESTIVAL_BG="images/bg/tree-planting-festival",g.MUSIC_FESTIVAL_BG="images/bg/music-festival",g.HARVEST_FESTIVAL_BG="images/bg/harvest-festival",g.FOOD_FESTIVAL_BG="images/bg/food-festival",g.LIGHT_FESTIVAL_BG="images/bg/light-festival",g.PEACE_FESTIVAL_BG="images/bg/peace-festival",g.FLOWER_FESTIVAL_BG="images/bg/flower-festival",g.STREET_FESTIVAL_BG="images/bg/street-festival",g.COLOR_GARDEN_BG="images/bg/color-garden",g.COLOR_FESTIVAL_BG="images/bg/color-festival",g.NATURE_SUMMER_BG="images/bg/nature-summer",g.SNOW_MOUNTAIN_BG="images/bg/snow-mountain",g.ICE_FESTIVAL_BG="images/bg/ice-festival",g.NIGHT_FESTIVAL_BG="images/bg/night-festival",g.LOST_FESTIVAL_BG="images/bg/lost-festival",g.HALLOWEEN_BG="images/bg/halloween",g.CHRISTMAS_BG="images/bg/christmas",g.SPRING_FLOWER_FESTIVAL_BG="images/bg/spring-flower-festival",g.TET_HOLIDAY_BG="images/bg/tet-holiday",g.SEA_FESTIVAL_BG="images/bg/sea-festival",g.FIREWORK_FESTIVAL_BG="images/bg/firework-festival",g.SUMMER_BG_PREVIEW="images/preview/summer",g.AUTUMN_BG_PREVIEW="images/preview/autumn",g.WINTER_BG_PREVIEW="images/preview/winter",g.FLOWER_FIELD_BG_PREVIEW="images/preview/flower-field",g.TREE_PLANTING_FESTIVAL_BG_PREVIEW="images/preview/tree-planting-festival",g.MUSIC_FESTIVAL_BG_PREVIEW="images/preview/music-festival",g.HARVEST_FESTIVAL_BG_PREVIEW="images/preview/harvest-festival",g.FOOD_FESTIVAL_BG_PREVIEW="images/preview/food-festival",g.LIGHT_FESTIVAL_BG_PREVIEW="images/preview/light-festival",g.PEACE_FESTIVAL_BG_PREVIEW="images/preview/peace-festival",g.FLOWER_FESTIVAL_BG_PREVIEW="images/preview/flower-festival",g.STREET_FESTIVAL_BG_PREVIEW="images/preview/street-festival",g.COLOR_GARDEN_BG_PREVIEW="images/preview/color-garden",g.COLOR_FESTIVAL_BG_PREVIEW="images/preview/color-festival",g.NATURE_SUMMER_BG_PREVIEW="images/preview/nature-summer",g.SNOW_MOUNTAIN_BG_PREVIEW="images/preview/snow-mountain",g.ICE_FESTIVAL_BG_PREVIEW="images/preview/ice-festival",g.NIGHT_FESTIVAL_BG_PREVIEW="images/preview/night-festival",g.LOST_FESTIVAL_BG_PREVIEW="images/preview/lost-festival",g.HALLOWEEN_BG_PREVIEW="images/preview/halloween",g.CHRISTMAS_BG_PREVIEW="images/preview/christmas",g.SPRING_FLOWER_FESTIVAL_BG_PREVIEW="images/preview/spring-flower-festival",g.TET_HOLIDAY_BG_PREVIEW="images/preview/tet-holiday",g.SEA_FESTIVAL_BG_PREVIEW="images/preview/sea-festival",g.FIREWORK_FESTIVAL_BG_PREVIEW="images/preview/firework-festival",g.SUMMER_BG_TOURNAMENT="images/tournament/summer",g.AUTUMN_BG_TOURNAMENT="images/tournament/autumn",g.WINTER_BG_TOURNAMENT="images/tournament/winter",g.FLOWER_FIELD_BG_TOURNAMENT="images/tournament/flower-field",g.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT="images/tournament/tree-planting-festival",g.MUSIC_FESTIVAL_BG_TOURNAMENT="images/tournament/music-festival",g.HARVEST_FESTIVAL_BG_TOURNAMENT="images/tournament/harvest-festival",g.FOOD_FESTIVAL_BG_TOURNAMENT="images/tournament/food-festival",g.LIGHT_FESTIVAL_BG_TOURNAMENT="images/tournament/light-festival",g.PEACE_FESTIVAL_BG_TOURNAMENT="images/tournament/peace-festival",g.FLOWER_FESTIVAL_BG_TOURNAMENT="images/tournament/flower-festival",g.STREET_FESTIVAL_BG_TOURNAMENT="images/tournament/street-festival",g.COLOR_GARDEN_BG_TOURNAMENT="images/tournament/color-garden",g.COLOR_FESTIVAL_BG_TOURNAMENT="images/tournament/color-festival",g.NATURE_SUMMER_BG_TOURNAMENT="images/tournament/nature-summer",g.SNOW_MOUNTAIN_BG_TOURNAMENT="images/tournament/snow-mountain",g.ICE_FESTIVAL_BG_TOURNAMENT="images/tournament/ice-festival",g.NIGHT_FESTIVAL_BG_TOURNAMENT="images/tournament/night-festival",g.LOST_FESTIVAL_BG_TOURNAMENT="images/tournament/lost-festival",g.HALLOWEEN_BG_TOURNAMENT="images/tournament/halloween",g.CHRISTMAS_BG_TOURNAMENT="images/tournament/christmas",g.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT="images/tournament/spring-flower-festival",g.TET_HOLIDAY_BG_TOURNAMENT="images/tournament/tet-holiday",g.SEA_FESTIVAL_BG_TOURNAMENT="images/tournament/sea-festival",g.FIREWORK_FESTIVAL_BG_TOURNAMENT="images/tournament/firework-festival",g.SUMMER_BG_THUMBNAIL="images/thumbnail/summer",g.AUTUMN_BG_THUMBNAIL="images/thumbnail/autumn",g.WINTER_BG_THUMBNAIL="images/thumbnail/winter",g.FLOWER_FIELD_BG_THUMBNAIL="images/thumbnail/flower-field",g.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL="images/thumbnail/tree-planting-festival",g.MUSIC_FESTIVAL_BG_THUMBNAIL="images/thumbnail/music-festival",g.HARVEST_FESTIVAL_BG_THUMBNAIL="images/thumbnail/harvest-festival",g.FOOD_FESTIVAL_BG_THUMBNAIL="images/thumbnail/food-festival",g.LIGHT_FESTIVAL_BG_THUMBNAIL="images/thumbnail/light-festival",g.PEACE_FESTIVAL_BG_THUMBNAIL="images/thumbnail/peace-festival",g.FLOWER_FESTIVAL_BG_THUMBNAIL="images/thumbnail/flower-festival",g.STREET_FESTIVAL_BG_THUMBNAIL="images/thumbnail/street-festival",g.COLOR_GARDEN_BG_THUMBNAIL="images/thumbnail/color-garden",g.COLOR_FESTIVAL_BG_THUMBNAIL="images/thumbnail/color-festival",g.NATURE_SUMMER_BG_THUMBNAIL="images/thumbnail/nature-summer",g.SNOW_MOUNTAIN_BG_THUMBNAIL="images/thumbnail/snow-mountain",g.ICE_FESTIVAL_BG_THUMBNAIL="images/thumbnail/ice-festival",g.NIGHT_FESTIVAL_BG_THUMBNAIL="images/thumbnail/night-festival",g.LOST_FESTIVAL_BG_THUMBNAIL="images/thumbnail/lost-festival",g.HALLOWEEN_BG_THUMBNAIL="images/thumbnail/halloween",g.CHRISTMAS_BG_THUMBNAIL="images/thumbnail/christmas",g.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL="images/thumbnail/spring-flower-festival",g.TET_HOLIDAY_BG_THUMBNAIL="images/thumbnail/tet-holiday",g.SEA_FESTIVAL_BG_THUMBNAIL="images/thumbnail/sea-festival",g.FIREWORK_FESTIVAL_BG_THUMBNAIL="images/thumbnail/firework-festival",g.COLLECTIONS_PAGE="pages/CollectionsContent",g.LEADERBOARD_PAGE="pages/LeaderboardContent",g.TOURNAMENTS_PAGE="pages/TournamentsContent",g.LEVEL_DATA_FOLDER="levels-json",g}(nF||{});_._RF.pop(),_._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);var nU={summer:nF.SUMMER_BG,autumn:nF.AUTUMN_BG,winter:nF.WINTER_BG,"spring-festival":nF.FLOWER_FIELD_BG,"tree-planting-festival":nF.TREE_PLANTING_FESTIVAL_BG,"blue-sea-festival":nF.SEA_FESTIVAL_BG,"music-festival":nF.MUSIC_FESTIVAL_BG,"harvest-festival":nF.HARVEST_FESTIVAL_BG,"food-festival":nF.FOOD_FESTIVAL_BG,"snow-festival":nF.WINTER_BG,"light-festival":nF.LIGHT_FESTIVAL_BG,"peace-festival":nF.PEACE_FESTIVAL_BG,"flower-festival":nF.FLOWER_FESTIVAL_BG,"street-festival":nF.STREET_FESTIVAL_BG,"color-garden":nF.COLOR_GARDEN_BG,"color-festival":nF.COLOR_FESTIVAL_BG,"nature-summer":nF.NATURE_SUMMER_BG,"snow-mountain":nF.SNOW_MOUNTAIN_BG,"ice-festival":nF.ICE_FESTIVAL_BG,"green-grass-festival":nF.FLOWER_FIELD_BG,"community-festival":nF.NIGHT_FESTIVAL_BG,"water-festival":nF.SEA_FESTIVAL_BG,"animal-festival":nF.TREE_PLANTING_FESTIVAL_BG,"lost-festival":nF.LOST_FESTIVAL_BG,"halloween-festival":nF.HALLOWEEN_BG,"snow-music-festival":nF.MUSIC_FESTIVAL_BG,christmas:nF.CHRISTMAS_BG,"spring-flower-festival":nF.SPRING_FLOWER_FESTIVAL_BG,"tet-holiday":nF.TET_HOLIDAY_BG,"sea-festival":nF.SEA_FESTIVAL_BG,"firework-festival":nF.FIREWORK_FESTIVAL_BG,"halloween-horror":nF.HALLOWEEN_BG,"mid-autumn":nF.SPRING_FLOWER_FESTIVAL_BG,"christmas-sweet":nF.CHRISTMAS_BG,"new-year-countdown":nF.TET_HOLIDAY_BG},nx={summer:nF.SUMMER_BG_PREVIEW,autumn:nF.AUTUMN_BG_PREVIEW,winter:nF.WINTER_BG_PREVIEW,"spring-festival":nF.FLOWER_FIELD_BG_PREVIEW,"tree-planting-festival":nF.TREE_PLANTING_FESTIVAL_BG_PREVIEW,"blue-sea-festival":nF.SEA_FESTIVAL_BG_PREVIEW,"music-festival":nF.MUSIC_FESTIVAL_BG_PREVIEW,"harvest-festival":nF.HARVEST_FESTIVAL_BG_PREVIEW,"food-festival":nF.FOOD_FESTIVAL_BG_PREVIEW,"snow-festival":nF.WINTER_BG_PREVIEW,"light-festival":nF.LIGHT_FESTIVAL_BG_PREVIEW,"peace-festival":nF.PEACE_FESTIVAL_BG_PREVIEW,"flower-festival":nF.FLOWER_FESTIVAL_BG_PREVIEW,"street-festival":nF.STREET_FESTIVAL_BG_PREVIEW,"color-garden":nF.COLOR_GARDEN_BG_PREVIEW,"color-festival":nF.COLOR_FESTIVAL_BG_PREVIEW,"nature-summer":nF.NATURE_SUMMER_BG_PREVIEW,"snow-mountain":nF.SNOW_MOUNTAIN_BG_PREVIEW,"ice-festival":nF.ICE_FESTIVAL_BG_PREVIEW,"green-grass-festival":nF.FLOWER_FIELD_BG_PREVIEW,"community-festival":nF.NIGHT_FESTIVAL_BG_PREVIEW,"water-festival":nF.SEA_FESTIVAL_BG_PREVIEW,"animal-festival":nF.TREE_PLANTING_FESTIVAL_BG_PREVIEW,"lost-festival":nF.LOST_FESTIVAL_BG_PREVIEW,"halloween-festival":nF.HALLOWEEN_BG_PREVIEW,"snow-music-festival":nF.MUSIC_FESTIVAL_BG_PREVIEW,christmas:nF.CHRISTMAS_BG_PREVIEW,"spring-flower-festival":nF.SPRING_FLOWER_FESTIVAL_BG_PREVIEW,"tet-holiday":nF.TET_HOLIDAY_BG_PREVIEW,"sea-festival":nF.SEA_FESTIVAL_BG_PREVIEW,"firework-festival":nF.FIREWORK_FESTIVAL_BG_PREVIEW,"halloween-horror":nF.HALLOWEEN_BG_PREVIEW,"mid-autumn":nF.SPRING_FLOWER_FESTIVAL_BG_PREVIEW,"christmas-sweet":nF.CHRISTMAS_BG_PREVIEW,"new-year-countdown":nF.TET_HOLIDAY_BG_PREVIEW},nz={summer:nF.SUMMER_BG_TOURNAMENT,autumn:nF.AUTUMN_BG_TOURNAMENT,winter:nF.WINTER_BG_TOURNAMENT,"spring-festival":nF.FLOWER_FIELD_BG_TOURNAMENT,"tree-planting-festival":nF.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT,"blue-sea-festival":nF.SEA_FESTIVAL_BG_TOURNAMENT,"music-festival":nF.MUSIC_FESTIVAL_BG_TOURNAMENT,"harvest-festival":nF.HARVEST_FESTIVAL_BG_TOURNAMENT,"food-festival":nF.FOOD_FESTIVAL_BG_TOURNAMENT,"snow-festival":nF.WINTER_BG_TOURNAMENT,"light-festival":nF.LIGHT_FESTIVAL_BG_TOURNAMENT,"peace-festival":nF.PEACE_FESTIVAL_BG_TOURNAMENT,"flower-festival":nF.FLOWER_FESTIVAL_BG_TOURNAMENT,"street-festival":nF.STREET_FESTIVAL_BG_TOURNAMENT,"color-garden":nF.COLOR_GARDEN_BG_TOURNAMENT,"color-festival":nF.COLOR_FESTIVAL_BG_TOURNAMENT,"nature-summer":nF.NATURE_SUMMER_BG_TOURNAMENT,"snow-mountain":nF.SNOW_MOUNTAIN_BG_TOURNAMENT,"ice-festival":nF.ICE_FESTIVAL_BG_TOURNAMENT,"green-grass-festival":nF.FLOWER_FIELD_BG_TOURNAMENT,"community-festival":nF.NIGHT_FESTIVAL_BG_TOURNAMENT,"water-festival":nF.SEA_FESTIVAL_BG_TOURNAMENT,"animal-festival":nF.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT,"lost-festival":nF.LOST_FESTIVAL_BG_TOURNAMENT,"halloween-festival":nF.HALLOWEEN_BG_TOURNAMENT,"snow-music-festival":nF.MUSIC_FESTIVAL_BG_TOURNAMENT,christmas:nF.CHRISTMAS_BG_TOURNAMENT,"spring-flower-festival":nF.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT,"tet-holiday":nF.TET_HOLIDAY_BG_TOURNAMENT,"sea-festival":nF.SEA_FESTIVAL_BG_TOURNAMENT,"firework-festival":nF.FIREWORK_FESTIVAL_BG_TOURNAMENT,"halloween-horror":nF.HALLOWEEN_BG_TOURNAMENT,"mid-autumn":nF.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT,"christmas-sweet":nF.CHRISTMAS_BG_TOURNAMENT,"new-year-countdown":nF.TET_HOLIDAY_BG_TOURNAMENT},nG={summer:nF.SUMMER_BG_THUMBNAIL,autumn:nF.AUTUMN_BG_THUMBNAIL,winter:nF.WINTER_BG_THUMBNAIL,"spring-festival":nF.FLOWER_FIELD_BG_THUMBNAIL,"tree-planting-festival":nF.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL,"blue-sea-festival":nF.SEA_FESTIVAL_BG_THUMBNAIL,"music-festival":nF.MUSIC_FESTIVAL_BG_THUMBNAIL,"harvest-festival":nF.HARVEST_FESTIVAL_BG_THUMBNAIL,"food-festival":nF.FOOD_FESTIVAL_BG_THUMBNAIL,"snow-festival":nF.WINTER_BG_THUMBNAIL,"light-festival":nF.LIGHT_FESTIVAL_BG_THUMBNAIL,"peace-festival":nF.PEACE_FESTIVAL_BG_THUMBNAIL,"flower-festival":nF.FLOWER_FESTIVAL_BG_THUMBNAIL,"street-festival":nF.STREET_FESTIVAL_BG_THUMBNAIL,"color-garden":nF.COLOR_GARDEN_BG_THUMBNAIL,"color-festival":nF.COLOR_FESTIVAL_BG_THUMBNAIL,"nature-summer":nF.NATURE_SUMMER_BG_THUMBNAIL,"snow-mountain":nF.SNOW_MOUNTAIN_BG_THUMBNAIL,"ice-festival":nF.ICE_FESTIVAL_BG_THUMBNAIL,"green-grass-festival":nF.FLOWER_FIELD_BG_THUMBNAIL,"community-festival":nF.NIGHT_FESTIVAL_BG_THUMBNAIL,"water-festival":nF.SEA_FESTIVAL_BG_THUMBNAIL,"animal-festival":nF.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL,"lost-festival":nF.LOST_FESTIVAL_BG_THUMBNAIL,"halloween-festival":nF.HALLOWEEN_BG_THUMBNAIL,"snow-music-festival":nF.MUSIC_FESTIVAL_BG_THUMBNAIL,christmas:nF.CHRISTMAS_BG_THUMBNAIL,"spring-flower-festival":nF.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL,"tet-holiday":nF.TET_HOLIDAY_BG_THUMBNAIL,"sea-festival":nF.SEA_FESTIVAL_BG_THUMBNAIL,"firework-festival":nF.FIREWORK_FESTIVAL_BG_THUMBNAIL,"halloween-horror":nF.HALLOWEEN_BG_THUMBNAIL,"mid-autumn":nF.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL,"christmas-sweet":nF.CHRISTMAS_BG_THUMBNAIL,"new-year-countdown":nF.TET_HOLIDAY_BG_THUMBNAIL};_._RF.pop(),_._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);var nV,nK,nH,nq,nW,nj,nX,nY,nJ,nQ,nZ,n$,n0,n1,n2,n4,n3,n5,n6,n8,n9,n7,ie,ii=function(){function e(){Fe(this,e)}var g,E,_,k,C,A,T,R,I,P,L,O;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"setBlockInput",value:function(g){var E=$("Canvas/InputBlocker");E?E.active=g:console.warn("InputBlocker not found")}},{key:"getBlockInput",value:function(){var g=$("Canvas/InputBlocker");return g?g.active:(console.warn("InputBlocker not found"),!1)}},{key:"loadPrefabAsync",value:function(g){var E=this.getAsset(g,ee);return null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,ee,function(g,_){E(g?null:_)})})}},{key:"loadJsonAsync",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){E=this;return[2,new Promise(function(_){var k=E.getAsset(g,en);null===k?F.load(g,en,function(g,E){g?_(null):E&&E.json?_(E.json):_(null)}):_(k.json)})]})}),function(g){return O.apply(this,arguments)})},{key:"loadAudioClipAsync",value:(L=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,U);return[2,null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,U,function(g,_){E(g?null:_)})})]})}),function(g){return L.apply(this,arguments)})},{key:"loadAnimClipAsync",value:(P=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,ei);return[2,null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,ei,function(g,_){E(g?null:_)})})]})}),function(g){return P.apply(this,arguments)})},{key:"loadImageSpriteFrameAsync",value:(I=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,er);return[2,null!==E?Promise.resolve(ea.createWithImage(E)):new Promise(function(E){F.load(g,er,function(g,_){E(g?null:ea.createWithImage(_))})})]})}),function(g){return I.apply(this,arguments)})},{key:"loadSpriteFrameAsync",value:(R=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){E=!(k.length>1&&void 0!==k[1])||k[1],_=this.getAsset(g,ea);return[2,null!==_?(_.packable=E,Promise.resolve(_)):new Promise(function(_){F.load(g,ea,function(g,k){!g&&k?(k.packable=E,_(k)):_(null)})})]})}),function(g){return R.apply(this,arguments)})},{key:"loadSpriteFramesDirAsync",value:(T=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){E=F.getDirWithPath(g,ea);if(E.length>0){k=[],C=at(E);try{for(C.s();!(_=C.n()).done;){A=_.value,T=F.get(A.path,ea);if(!T)return[2,this.loadSpriteFramesFromDirAsync(g)];k.push(T)}}catch(g){C.e(g)}finally{C.f()}return[2,k]}return[2,this.loadSpriteFramesFromDirAsync(g)]})}),function(g){return T.apply(this,arguments)})},{key:"loadSpriteFramesFromDirAsync",value:(A=Be(function(g){return _ts_generator(this,function(E){return[2,new Promise(function(E){F.loadDir(g,ea,function(g,_){E(g?[]:_)})})]})}),function(g){return A.apply(this,arguments)})},{key:"loadThemeAsync",value:(C=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nU[g],"/spriteFrame"))]})}),function(g){return C.apply(this,arguments)})},{key:"loadThemePreviewAsync",value:(k=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nx[g],"/spriteFrame"))]})}),function(g){return k.apply(this,arguments)})},{key:"loadThemeTournamentAsync",value:(_=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nz[g],"/spriteFrame"))]})}),function(g){return _.apply(this,arguments)})},{key:"loadThemeThumbnailAsync",value:(E=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nG[g],"/spriteFrame"))]})}),function(g){return E.apply(this,arguments)})},{key:"loadSkinPreviewAsync",value:(g=Be(function(g){var E,_,k;return _ts_generator(this,function(C){for(E=[],_=1;_<=4;_++){k="".concat(nF.TILE_SKIN_PREVIEW_FOLDER,"/").concat(g.replace(/-/g,"_"),"_").concat(_,"/spriteFrame");E.push(this.loadSpriteFrameAsync(k))}return[2,Promise.all(E)]})}),function(E){return g.apply(this,arguments)})},{key:"getAsset",value:function(g,E){var _=F.getInfoWithPath(g,E);return _?F.get(_.path,E):null}}]),e}();_._RF.pop(),_._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var ir=k.ccclass,ia=k.property,io=globalThis.game.monitorError,is=GameCore.Utils.Number,il=(nV=ir("MultiBackground"),nK=ia({type:eo}),nH=ia({type:eo}),nq=ia({type:R}),nW=ia({type:R}),nj=ia({type:R}),nX=ia(V),nY=ia(H),nJ=ia({type:es(nN)}),nQ=ia({type:es(nN)}),nZ=nA.onlyRunInLifeCycleAsync,n$=nA.onlyRunInLifeCycle,nV((n2=st((n1=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background1",n2,Ke(g)),rt(g,"background2",n4,Ke(g)),rt(g,"screenUiTransform",n3,Ke(g)),rt(g,"background1UiTransform",n5,Ke(g)),rt(g,"background2UiTransform",n6,Ke(g)),rt(g,"backgroundNudgeAmount",n8,Ke(g)),rt(g,"nudgeableWidget",n9,Ke(g)),rt(g,"pageOrder",n7,Ke(g)),rt(g,"homePage",ie,Ke(g)),g.currentThemeId="",g.tryNudgeBackground=function(E){var _=E.to,k=g.getDirection(g.homePage,_),C=is.sign(k),A=Math.abs(k),T=g.backgroundNudgeAmount*A,R=Math.min(g.background1UiTransform.width,g.background2UiTransform.width),I=Math.max(0,(R-g.screenUiTransform.width)/2),P=Math.min(I,T)*C;z(g.nudgeableWidget).to(.5,{horizontalCenter:P},{easing:el.cubicInOut}).start()},g}return Ue(a,[{key:"onLoad",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,nA.lazyValidateProperties(this),this.listenToNavigationEvents()}},{key:"onDestroy",value:function(){var g;null===(g=this.tweenSignal)||void 0===g||g.abort(),this.unlistenToNavigationEvents()}},{key:"listenToNavigationEvents",value:function(){this.node.scene.on(nO,this.tryNudgeBackground)}},{key:"unlistenToNavigationEvents",value:function(){this.node.scene.off(nO,this.tryNudgeBackground)}},{key:"getDirection",value:function(g,E){var _=this.pageOrder.indexOf(g),k=this.pageOrder.indexOf(E);return -1===_||-1===k?(null==io||io.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):_-k}},{key:"setCurrentTheme",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,ii.loadThemeAsync(g)];case 1:E=_.sent();E?this.updateBackgroundSprites(E,g):null==io||io.sendException(new Error("MultiBackground.setCurrentTheme: Failed to load theme ".concat(g,"'s sprite.")));return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"updateBackgroundSprites",value:function(g,E){g.packable=!1,this.background1.spriteFrame=g,this.background2.spriteFrame=g,this.currentThemeId=E}},{key:"animateToNextTheme",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(this.currentThemeId===g)return[2,Promise.resolve()];return[4,ii.loadThemeAsync(g)];case 1:_=A.sent();if(!_)return[3,3];_.packable=!1,this.currentThemeId=g,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=_,this.nextBackground.node.setSiblingIndex(1);k=this.nextBackground.getComponent(eu);if(!k)throw new Error("".concat(this.nextBackground.node.name," UIOpacity is required"));k.opacity=0,null===(E=this.tweenSignal)||void 0===E||E.abort(),this.tweenSignal=new nD;return[4,t$.runTweenAsync(z(k).to(1,{opacity:255}),this.tweenSignal)];case 2:if(A.sent(),!this.tweenSignal.aborted){this.currentBackground.node.active=!1;C=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=C}return[3,4];case 3:null==io||io.sendException(new Error("MultiBackground.animateToNextTheme: Failed to load theme ".concat(g,"'s sprite.")));A.label=4;case 4:return[2]}})}),function(g){return E.apply(this,arguments)})}]),a}(M)).prototype,"background1",[nK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n4=st(n1.prototype,"background2",[nH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n3=st(n1.prototype,"screenUiTransform",[nq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n5=st(n1.prototype,"background1UiTransform",[nW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n6=st(n1.prototype,"background2UiTransform",[nj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n8=st(n1.prototype,"backgroundNudgeAmount",[nX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),n9=st(n1.prototype,"nudgeableWidget",[nY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n7=st(n1.prototype,"pageOrder",[nJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ie=st(n1.prototype,"homePage",[nQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nN.home}}),st(n1.prototype,"setCurrentTheme",[nZ],Object.getOwnPropertyDescriptor(n1.prototype,"setCurrentTheme"),n1.prototype),st(n1.prototype,"updateBackgroundSprites",[n$],Object.getOwnPropertyDescriptor(n1.prototype,"updateBackgroundSprites"),n1.prototype),n0=n1))||n0);_._RF.pop(),_._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var iu="musics/",ic="sounds/",ih=GameCore.Utils.Object,ip={BUTTON_CLICK:"".concat(ic,"use_item_click"),BOMB_DEFUSE:"".concat(ic,"bomb_defuse"),BOMB_EXPLODE_1:"".concat(ic,"bomb_explode_1"),BOMB_EXPLODE_2:"".concat(ic,"bomb_explode_2"),CLICKS:"".concat(ic,"clicks"),CLOSE_POPUP_CLICK:"".concat(ic,"close_popup_click"),COLLECT_STARS:"".concat(ic,"collect_stars"),COMBO_1:"".concat(ic,"combo_1"),COMBO_2:"".concat(ic,"combo_2"),COMBO_3:"".concat(ic,"combo_3"),COMBO_4:"".concat(ic,"combo_4"),COMBO_5:"".concat(ic,"combo_5"),DAILY_REWARD:"".concat(ic,"daily_reward"),EXTRA_TIME_SPAWN:"".concat(ic,"extra_time_spawn"),GIFT_CHARGE:"".concat(ic,"gift_charge"),GIFT_EXPLODE:"".concat(ic,"gift_explode"),GIFT_REVEAL:"".concat(ic,"gift_reveal"),HINT_ITEM:"".concat(ic,"hint_item"),INVALID_MATCH:"".concat(ic,"invalid_match"),LEVEL_COMPLETE:"".concat(ic,"level_complete"),LEVEL_FAIL:"".concat(ic,"level_fail"),LEVEL_START:"".concat(ic,"level_start"),PROGRESS_STAR:"".concat(ic,"progress_star"),RESCUE_TIMER:"".concat(ic,"rescue_timer"),ROCKET_FLY:"".concat(ic,"rocket_fly"),SHUFFLE_ITEM:"".concat(ic,"shuffle_item"),THREE_STARS:"".concat(ic,"three_stars"),TICKING_BOMB_BEFORE_EXPLODE:"".concat(ic,"ticking_bomb_before_explode"),TILE_SELECT:"".concat(ic,"tile_select"),USE_ITEM_CLICK:"".concat(ic,"use_item_click"),BG_MUSIC:"".concat(iu,"bg_music"),PATCH_SHIFT:"".concat(ic,"patch_shift"),THUNDERBOLT:"".concat(ic,"thunderbolt"),WIND:"".concat(ic,"wind"),COLLECT_COINS:"".concat(ic,"collect_coins"),COLLECT_STOCK_COINS:"".concat(ic,"collect_stock_coins"),LEVEL_FAIL_TIMEOUT:"".concat(ic,"level_fail_timeout"),STAR_CHEST_DRUM_ROLL:"".concat(ic,"star_chest_drum_roll"),STAR_CHEST_OPEN:"".concat(ic,"star_chest_open"),LEADERBOARD_TRIUMPH:"".concat(ic,"leaderboard_triumph"),ITEM_REWARD:"".concat(ic,"item_reward"),COMBO_6:"".concat(ic,"combo_6"),COMBO_7:"".concat(ic,"combo_7"),COMBO_8:"".concat(ic,"combo_8"),COMBO_9:"".concat(ic,"combo_9"),COMBO_10:"".concat(ic,"combo_10"),COMBO_11:"".concat(ic,"combo_11"),COMBO_12:"".concat(ic,"combo_12"),COMBO_13:"".concat(ic,"combo_13"),TILE_MATCH:"".concat(ic,"tile_match"),TOURNAMENT_MUSIC:"".concat(iu,"tournament_music")},iy=ih.vals(ip),iv=iy.reduce(function(g,E,_){return g[E]=_,g},{});Z(iv);var ig,im,ib=iy;_._RF.pop(),_._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var iw=function(g){return g[g.RESCUES_SCREEN=0]="RESCUES_SCREEN",g[g.LOADING_SCREEN=1]="LOADING_SCREEN",g[g.GET_ITEM_SCREEN=2]="GET_ITEM_SCREEN",g[g.GET_COIN_SCREEN=3]="GET_COIN_SCREEN",g[g.SETTINGS_SCREEN=4]="SETTINGS_SCREEN",g[g.START_LEVEL_SCREEN=5]="START_LEVEL_SCREEN",g[g.NOTIFICATION_SCREEN=6]="NOTIFICATION_SCREEN",g[g.LEVEL_COMPLETE_SCREEN=7]="LEVEL_COMPLETE_SCREEN",g[g.CONGRATULATION_SCREEN=8]="CONGRATULATION_SCREEN",g[g.QUIT_LEVEL_SCREEN=9]="QUIT_LEVEL_SCREEN",g[g.TOURNAMENT_DETAIL_SCREEN=10]="TOURNAMENT_DETAIL_SCREEN",g[g.DAILY_REWARDS_SCREEN=11]="DAILY_REWARDS_SCREEN",g[g.STAR_CHEST_SCREEN=12]="STAR_CHEST_SCREEN",g[g.START_OVER_SCREEN=13]="START_OVER_SCREEN",g[g.PAUSE_SCREEN=14]="PAUSE_SCREEN",g[g.HARD_LEVEL_SCREEN=15]="HARD_LEVEL_SCREEN",g[g.GET_REWARDS_SCREEN=16]="GET_REWARDS_SCREEN",g}(iw||{}),iS=(Ge(ig={},iw.RESCUES_SCREEN,"RescuesScreen"),Ge(ig,iw.LOADING_SCREEN,"LoadingScreen"),Ge(ig,iw.GET_ITEM_SCREEN,"GetItemScreen"),Ge(ig,iw.GET_COIN_SCREEN,"GetCoinScreen"),Ge(ig,iw.SETTINGS_SCREEN,"SettingsScreen"),Ge(ig,iw.START_LEVEL_SCREEN,"StartLevelScreen"),Ge(ig,iw.NOTIFICATION_SCREEN,"NotificationScreen"),Ge(ig,iw.LEVEL_COMPLETE_SCREEN,"LevelCompleteScreen"),Ge(ig,iw.CONGRATULATION_SCREEN,"CongratulationScreen"),Ge(ig,iw.QUIT_LEVEL_SCREEN,"QuitLevelScreen"),Ge(ig,iw.TOURNAMENT_DETAIL_SCREEN,"TournamentDetailScreen"),Ge(ig,iw.DAILY_REWARDS_SCREEN,"DailyRewardsScreen"),Ge(ig,iw.STAR_CHEST_SCREEN,"StarChestScreen"),Ge(ig,iw.START_OVER_SCREEN,"StartOverScreen"),Ge(ig,iw.PAUSE_SCREEN,"PauseScreen"),Ge(ig,iw.HARD_LEVEL_SCREEN,"HardLevelScreen"),Ge(ig,iw.GET_REWARDS_SCREEN,"GetRewardsScreen"),ig),iE=(Ge(im={},iS[iw.RESCUES_SCREEN],iw.RESCUES_SCREEN),Ge(im,iS[iw.LOADING_SCREEN],iw.LOADING_SCREEN),Ge(im,iS[iw.GET_ITEM_SCREEN],iw.GET_ITEM_SCREEN),Ge(im,iS[iw.GET_COIN_SCREEN],iw.GET_COIN_SCREEN),Ge(im,iS[iw.SETTINGS_SCREEN],iw.SETTINGS_SCREEN),Ge(im,iS[iw.START_LEVEL_SCREEN],iw.START_LEVEL_SCREEN),Ge(im,iS[iw.NOTIFICATION_SCREEN],iw.NOTIFICATION_SCREEN),Ge(im,iS[iw.LEVEL_COMPLETE_SCREEN],iw.LEVEL_COMPLETE_SCREEN),Ge(im,iS[iw.CONGRATULATION_SCREEN],iw.CONGRATULATION_SCREEN),Ge(im,iS[iw.QUIT_LEVEL_SCREEN],iw.QUIT_LEVEL_SCREEN),Ge(im,iS[iw.TOURNAMENT_DETAIL_SCREEN],iw.TOURNAMENT_DETAIL_SCREEN),Ge(im,iS[iw.DAILY_REWARDS_SCREEN],iw.DAILY_REWARDS_SCREEN),Ge(im,iS[iw.STAR_CHEST_SCREEN],iw.STAR_CHEST_SCREEN),Ge(im,iS[iw.START_OVER_SCREEN],iw.START_OVER_SCREEN),Ge(im,iS[iw.PAUSE_SCREEN],iw.PAUSE_SCREEN),Ge(im,iS[iw.HARD_LEVEL_SCREEN],iw.HARD_LEVEL_SCREEN),Ge(im,iS[iw.GET_REWARDS_SCREEN],iw.GET_REWARDS_SCREEN),im),i_=[iS[iw.NOTIFICATION_SCREEN],iS[iw.LOADING_SCREEN]];_._RF.pop(),_._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);var ik=globalThis.game.analytics,iC=GameCore.Utils.Array,iA=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"trackCurrentPage",value:function(g,E){if(!iC.has(i_,g)&&(E||iC.has(this.trackingPages,g))){this.trackingPages=this.trackingPages.filter(function(E){return E!==g}),E&&this.trackingPages.push(g);var _=this.getCurrentPage();ik.pageview(_)}}},{key:"switchSceneTracking",value:function(){this.trackingPages=[];var g=this.getCurrentPage();ik.pageview(g)}},{key:"getCurrentPage",value:function(){var g,E;return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:null!==(g=null===(E=N.getScene())||void 0===E?void 0:E.name)&&void 0!==g?g:"Unknown Scene"}}]),e}();iA.trackingPages=[],_._RF.pop(),_._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);var iT,iR,iI,iP,iL,iO,iB,iN,iM,iD,iF,iU,ix,iz,iG,iV,iK,iH,iq,iW,ij,iX,iY,iJ,iQ,iZ,i$,i0,i1,i2,i4,i3,i5,i6,i8,i9=function(){function e(){Fe(this,e),this.signal=new nD}var g,E,_,k,C;return Ue(e,[{key:"sound",get:function(){var g,E;return null!==(g=null===(E=$("Sound"))||void 0===E?void 0:E.getComponent(tO))&&void 0!==g?g:null}},{key:"music",get:function(){var g,E;return null!==(g=null===(E=$("Music"))||void 0===E?void 0:E.getComponent(tA))&&void 0!==g?g:null}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"muteAudio",value:function(g){this.muteMusic(g),this.muteSound(g)}},{key:"playSound",value:(C=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,null===(_=this.inst.sound)||void 0===_?void 0:_.play(g,E)];case 1:k.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"pauseSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.pause(g)}},{key:"resumeSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.resume(g)}},{key:"stopSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.stop(g)}},{key:"stopAllSounds",value:function(){var g;null===(g=this.inst.sound)||void 0===g||g.stopAll()}},{key:"muteSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.mute(g)}},{key:"playMusic",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E;this.inst.music&&(this.inst.currentMusic!==g&&this.pauseMusic(),this.inst.currentMusic=g,!_&&this.inst.music.playing(g)||(_&&this.inst.music.stop(g),this.inst.music.play(g)))}},{key:"pauseMusic",value:function(){var g;null===(g=this.inst.music)||void 0===g||g.pause(this.inst.currentMusic)}},{key:"muteMusic",value:function(g){var E;null===(E=this.inst.music)||void 0===E||E.mute(g)}},{key:"getCurrentMusic",value:function(){return this.inst.currentMusic}},{key:"turnUpMusic",value:(k=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=(null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0)>.6;if(_)return[3,2];return[4,this.setVolumeMusic(.6,!0)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"turnDownMusic",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=(null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0)<.2;if(_)return[3,2];return[4,this.setVolumeMusic(.2,!0)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"turnOffMusic",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.setVolumeMusic(0)];case 1:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getVolumeMusic",value:function(){var g,E;return null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0}},{key:"setVolumeMusic",value:(g=Be(function(g){var E,_,k,C,A,T;var R=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:E=this,_=R.length>1&&void 0!==R[1]&&R[1];if(!this.inst.music)return[3,3];this.inst.signal.abort();k=new nD;if(this.inst.signal=k,!_)return[3,2];C=this.inst.music.getVolume(),A=C;return[4,t$.runOnUpdateAsync(this.inst.music.node,1,function(_){E.inst.music&&(A=C+(g-C)*_,E.inst.music.setVolume(A))},k)];case 1:I.sent();return[3,3];case 2:null===(T=this.inst.music)||void 0===T||T.setVolume(g);I.label=3;case 3:return[2]}})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var i7,re,rn,ri,rr=k.ccclass,ra=k.property,ro=k.disallowMultiple,rs=k.executionOrder,rl=globalThis.game.analytics,ru=GameCore.Plugins.Analytics.Events,rc=(iT=rr("ExtendedButton"),iR=rs(111),iI=ra(ec),iP=ra(ec),iL=ra(eh.AnimationController),iO=ra({override:!0,visible:!1}),iB=ra({override:!0,visible:!1}),iN=ra({override:!0,visible:!1}),iM=ra({override:!0,visible:!1}),iD=ra({override:!0,visible:!1}),iF=ra({override:!0,visible:!1}),iU=ra({override:!0,visible:!1}),ix=ra({override:!0,visible:!1}),iz=ra({override:!0,visible:!1}),iG=ra({override:!0,visible:!1}),iV=ra({override:!0,visible:!1}),iK=ra(J),iH=ra(J),iq=ra(J),iW=ra({visible:function(){return this.makeSound},type:iv}),ij=ra({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),iX=ra({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),iY=ra({}),iT(iJ=ro(iJ=iR((iZ=st((iQ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"clickStartEvents",iZ,Ke(g)),rt(g,"clickEndEvents",i$,Ke(g)),rt(g,"animationController",i0,Ke(g)),rt(g,"useDesktopHover",i1,Ke(g)),rt(g,"emitAnalyticsEvents",i2,Ke(g)),rt(g,"makeSound",i4,Ke(g)),rt(g,"soundKey",i3,Ke(g)),rt(g,"disableSpamClick",i5,Ke(g)),rt(g,"disableSpamDelay",i6,Ke(g)),rt(g,"isScrollViewCancelInnerEvents",i8,Ke(g)),g.currentClickBoundingBox=null,g.hasDown=!1,g.hasUp=!1,g.hasFinishClickCycle=!1,g.onTouchStart=function(E){g.interactable&&(g.hasDown||(g.currentClickBoundingBox=nl.getBoundingBoxToWorld(g.node),g.handleDown(E)))},g.onTouchEnd=function(E){g.scheduleOnce(function(){g.interactable&&g.hasDown&&(g.hasUp||g.handleUp(E))},0)},g.onTouchCancel=function(E){if(g.interactable&&g.hasDown&&!g.hasUp){if(!g.isScrollViewCancelInnerEvents){var _,k,C=E.getUILocation();if(null!==(_=null===(k=g.currentClickBoundingBox)||void 0===k?void 0:k.contains(C))&&void 0!==_&&_)return void g.handleUp(E)}g.hasUp=!0,g.hasFinishClickCycle=!0,g.handleResetButtonState(),g.emitClickEndEvents(E)}},g.onMouseEnter=function(E){g.useDesktopHover&&g.interactable&&(g.hasDown||(g.hasFinishClickCycle=!1,g.setAnimationState("HOVER")))},g.onMouseLeave=function(E){g.useDesktopHover&&g.interactable&&(g.hasDown||g.hasUp||g.hasFinishClickCycle||g.handleResetButtonState())},g.handleResetButtonState=function(){g.hasDown=!1,g.hasUp=!1,g.setAnimationState("RESET")},g}return Ue(n,[{key:"transition",get:function(){return B.Transition.NONE},set:function(g){$e(Ve(n.prototype),"transition",B.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return Je(Ve(n.prototype),"normalColor",this)},set:function(g){$e(Ve(n.prototype),"normalColor",g,this,!0)}},{key:"pressedColor",get:function(){return Je(Ve(n.prototype),"pressedColor",this)},set:function(g){$e(Ve(n.prototype),"pressedColor",g,this,!0)}},{key:"hoverColor",get:function(){return Je(Ve(n.prototype),"hoverColor",this)},set:function(g){$e(Ve(n.prototype),"hoverColor",g,this,!0)}},{key:"disabledColor",get:function(){return Je(Ve(n.prototype),"disabledColor",this)},set:function(g){$e(Ve(n.prototype),"disabledColor",g,this,!0)}},{key:"normalSprite",get:function(){return Je(Ve(n.prototype),"normalSprite",this)},set:function(g){$e(Ve(n.prototype),"normalSprite",g,this,!0)}},{key:"pressedSprite",get:function(){return Je(Ve(n.prototype),"pressedSprite",this)},set:function(g){$e(Ve(n.prototype),"pressedSprite",g,this,!0)}},{key:"hoverSprite",get:function(){return Je(Ve(n.prototype),"hoverSprite",this)},set:function(g){$e(Ve(n.prototype),"hoverSprite",g,this,!0)}},{key:"disabledSprite",get:function(){return Je(Ve(n.prototype),"disabledSprite",this)},set:function(g){$e(Ve(n.prototype),"disabledSprite",g,this,!0)}},{key:"duration",get:function(){return Je(Ve(n.prototype),"duration",this)},set:function(g){$e(Ve(n.prototype),"duration",g,this,!0)}},{key:"zoomScale",get:function(){return Je(Ve(n.prototype),"zoomScale",this)},set:function(g){$e(Ve(n.prototype),"zoomScale",g,this,!0)}},{key:"__preload",value:function(){Je(Ve(n.prototype),"__preload",this).call(this),nA.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var g;null===(g=Je(Ve(n.prototype),"onDestroy",this))||void 0===g||g.call(this)}},{key:"onEnable",value:function(){var g;null===(g=Je(Ve(n.prototype),"onEnable",this))||void 0===g||g.call(this),this.node.off(ep.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(C.EventType.TOUCH_START,this.onTouchStart),this.node.on(C.EventType.TOUCH_END,this.onTouchEnd),this.node.on(C.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var g;null===(g=Je(Ve(n.prototype),"onDisable",this))||void 0===g||g.call(this),this.node.off(C.EventType.TOUCH_START,this.onTouchStart),this.node.off(C.EventType.TOUCH_END,this.onTouchEnd),this.node.off(C.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(g){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&i9.playSound(ib[this.soundKey]),this.emitClickStartEvents(g)}},{key:"emitClickStartEvents",value:function(g){var E,_=at(this.clickStartEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}},{key:"emitClickEndEvents",value:function(g){var E,_=at(this.clickEndEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}},{key:"handleUp",value:function(g){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(g),this.emitClickEndEvents(g)}},{key:"emitButtonEvents",value:function(g){if(this.interactable){this.emitAnalyticsEvents&&rl.event(ru.BUTTON_CLICK,{button_name:this.node.name,screen_name:iA.getCurrentPage()});var E,_=at(this.clickEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}}},{key:"setAnimationState",value:function(g){this.animationController&&(this.animationController.setValue("DOWN","DOWN"===g),this.animationController.setValue("HOVER","HOVER"===g),this.animationController.setValue("RESET","RESET"===g))}},{key:"fakeClick",value:function(){var g=this;this.setAnimationState("DOWN"),this.scheduleOnce(function(){g.setAnimationState("RESET")},0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),n}(B)).prototype,"clickStartEvents",[iI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),i$=st(iQ.prototype,"clickEndEvents",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),i0=st(iQ.prototype,"animationController",[iL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(iQ.prototype,"transition",[iO],Object.getOwnPropertyDescriptor(iQ.prototype,"transition"),iQ.prototype),st(iQ.prototype,"normalColor",[iB],Object.getOwnPropertyDescriptor(iQ.prototype,"normalColor"),iQ.prototype),st(iQ.prototype,"pressedColor",[iN],Object.getOwnPropertyDescriptor(iQ.prototype,"pressedColor"),iQ.prototype),st(iQ.prototype,"hoverColor",[iM],Object.getOwnPropertyDescriptor(iQ.prototype,"hoverColor"),iQ.prototype),st(iQ.prototype,"disabledColor",[iD],Object.getOwnPropertyDescriptor(iQ.prototype,"disabledColor"),iQ.prototype),st(iQ.prototype,"normalSprite",[iF],Object.getOwnPropertyDescriptor(iQ.prototype,"normalSprite"),iQ.prototype),st(iQ.prototype,"pressedSprite",[iU],Object.getOwnPropertyDescriptor(iQ.prototype,"pressedSprite"),iQ.prototype),st(iQ.prototype,"hoverSprite",[ix],Object.getOwnPropertyDescriptor(iQ.prototype,"hoverSprite"),iQ.prototype),st(iQ.prototype,"disabledSprite",[iz],Object.getOwnPropertyDescriptor(iQ.prototype,"disabledSprite"),iQ.prototype),st(iQ.prototype,"duration",[iG],Object.getOwnPropertyDescriptor(iQ.prototype,"duration"),iQ.prototype),st(iQ.prototype,"zoomScale",[iV],Object.getOwnPropertyDescriptor(iQ.prototype,"zoomScale"),iQ.prototype),i1=st(iQ.prototype,"useDesktopHover",[iK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i2=st(iQ.prototype,"emitAnalyticsEvents",[iH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i4=st(iQ.prototype,"makeSound",[iq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i3=st(iQ.prototype,"soundKey",[iW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iv[ip.BUTTON_CLICK]}}),i5=st(iQ.prototype,"disableSpamClick",[ij],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i6=st(iQ.prototype,"disableSpamDelay",[iX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),i8=st(iQ.prototype,"isScrollViewCancelInnerEvents",[iY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),iJ=iQ))||iJ)||iJ)||iJ);_._RF.pop(),_._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var rh=k.ccclass,rp=k.requireComponent,rf=k.property,ry=rh("OpacityToggler")(i7=rp([eu])((rn=st((re=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"activeValue",rn,Ke(g)),rt(g,"inActiveValue",ri,Ke(g)),g.signal=new nD,g}return Ue(i,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"changeState",value:function(g){var E=arguments.length>0&&void 0!==g&&g;this.signal.abort(),this.opacityComponent.opacity=E?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(E=Be(function(){var g,E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:g=k.length>0&&void 0!==k[0]&&k[0],E=k.length>1&&void 0!==k[1]?k[1]:.2;this.signal.abort(),this.signal=new nD;_=g?this.activeValue:this.inActiveValue;return[4,t$.runTweenAsync(z(this.opacityComponent).to(E,{opacity:_}),this.signal)];case 1:C.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"activeValue",[rf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),ri=st(re.prototype,"inActiveValue",[rf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),i7=re))||i7)||i7;_._RF.pop(),_._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);var rv,rg,rm,rb={Portrait:"portrait",Landscape:"landscape"},rw={Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}};_._RF.pop(),_._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var rS,rE,r_,rk,rC,rA,rT,rR,rI,rP,rL,rO,rB,rN,rM,rD,rF,rU,rx,rz,rG=k.ccclass,rV=k.property,rK=k.requireComponent,rH=k.disallowMultiple,rq=k.executeInEditMode,rW=rw,rj=rW.Portrait,rX=rW.Landscape;rG("DebugResolution")(rv=rH(rv=rK([ef])(rv=rq(!0)(((rm=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleLayoutChange=function(){var E;null===(E=g.graphics)||void 0===E||E.clear(),g.start()},g}return Ue(n,[{key:"drawPortrait",get:function(){return n._drawPortrait},set:function(g){g!==n._drawPortrait&&(g?this.drawPortraitResolution():this.graphics.clear(),n._drawPortrait=g,n._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return n._drawLandscape},set:function(g){g!==n._drawLandscape&&(g?this.drawLandscapeResolution():this.graphics.clear(),n._drawLandscape=g,n._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(ef),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t8,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var g=this.graphics,E=rj.WIDTH,_=rj.HEIGHT,k=-E/2,C=-_/2;g.strokeColor=A.GREEN,g.rect(k,C,E,_),g.stroke()}},{key:"drawLandscapeResolution",value:function(){var g=this.graphics,E=rX.WIDTH,_=rX.HEIGHT,k=-E/2,C=-_/2;g.strokeColor=A.CYAN,g.rect(k,C,E,_),g.stroke()}}]),n}(M))._drawPortrait=!0,rm._drawLandscape=!0,st((rg=rm).prototype,"drawPortrait",[rV],Object.getOwnPropertyDescriptor(rg.prototype,"drawPortrait"),rg.prototype),st(rg.prototype,"drawLandscape",[rV],Object.getOwnPropertyDescriptor(rg.prototype,"drawLandscape"),rg.prototype),rv=rg))||rv)||rv)||rv);_._RF.pop(),_._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var rY=k.ccclass,rJ=k.executionOrder,rQ=k.property,rZ=GameCore.Utils.Valid,r$=A.RED,r0=A.BLACK,r1=A.MAGENTA;rS=rY("GameStats"),rE=rJ(-1e3),r_=rQ(P),rk=rQ(P),rC=rQ(P),rA=rQ(P),rT=rQ(P),rR=rQ(P),rI=rQ(P),rP=rQ(P),rS(rL=rE((rB=st((rO=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"fpsLabel",rB,Ke(g)),rt(g,"drawCountLabel",rN,Ke(g)),rt(g,"logicTimeLabel",rM,Ke(g)),rt(g,"physicTimeLabel",rD,Ke(g)),rt(g,"renderTimeLabel",rF,Ke(g)),rt(g,"objectMemoryUsageLabel",rU,Ke(g)),rt(g,"textureMemoryUsageLabel",rx,Ke(g)),rt(g,"devicePixelRatioLabel",rz,Ke(g)),g.refreshInterval=.5,g.handleMouseDown=function(){g.bg.enabled=!g.bg.enabled},g.waitForStats=function(){ey.stats&&(g.unschedule(g.waitForStats),g.node.active=!0,g.stats=ey.stats,g.startUpdateStats())},g.updateStats=function(){g.updateFps(),g.updateDrawCalls(),g.updateLogicTime(),g.updatePhysicTime(),g.updateRenderTime(),g.updateObjectMemoryUsage(),g.updateTextureMemoryUsage(),g.updateDevicePixelRatio()},g}return Ue(n,[{key:"__preload",value:function(){this.bg=this.getComponent(eo),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(ep.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,ey&&rZ.isDebugger()&&(ey.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var g=this.getFps();this.updateFpsColor(g),this.fpsLabel.string="FPS: ".concat(g)}},{key:"updateFpsColor",value:function(g){this.fpsLabel.color=g<30?r$:g<48?r1:r0}},{key:"updateDrawCalls",value:function(){var g=this.getDrawCalls();this.updateDrawCallsColor(g),this.drawCountLabel.string="Draw Calls: ".concat(g)}},{key:"updateDrawCallsColor",value:function(g){var E=ev.os===ev.OS.IOS,_=E?80:25,k=E?60:15;this.drawCountLabel.color=g>_?r$:g>k?r1:r0}},{key:"updateLogicTime",value:function(){var g=this.getLogicTime();this.updateLogicTimeColor(g),this.logicTimeLabel.string="Logic Time: ".concat(g.toFixed(2),"ms")}},{key:"updateLogicTimeColor",value:function(g){this.logicTimeLabel.color=g>10?r$:g>5?r1:r0}},{key:"updatePhysicTime",value:function(){var g=this.getPhysicTime();this.updatePhysicTimeColor(g),this.physicTimeLabel.string="Physic Time: ".concat(g.toFixed(2),"ms")}},{key:"updatePhysicTimeColor",value:function(g){this.physicTimeLabel.color=g>10?r$:g>5?r1:r0}},{key:"updateRenderTime",value:function(){var g=this.getRenderTime();this.updateRenderTimeColor(g),this.renderTimeLabel.string="Render Time: ".concat(g.toFixed(2),"ms")}},{key:"updateRenderTimeColor",value:function(g){this.renderTimeLabel.color=g>10?r$:g>5?r1:r0}},{key:"updateObjectMemoryUsage",value:function(){var g=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(g),this.objectMemoryUsageLabel.string="Object Mem: ".concat(g.toFixed(2),"MB")}},{key:"updateObjectMemoryUsageColor",value:function(g){this.objectMemoryUsageLabel.color=g>40?r$:g>25?r1:r0}},{key:"updateTextureMemoryUsage",value:function(){var g=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(g),this.textureMemoryUsageLabel.string="Texture Mem: ".concat(g.toFixed(2),"MB")}},{key:"updateTextureMemoryUsageColor",value:function(g){this.textureMemoryUsageLabel.color=g>50?r$:g>35?r1:r0}},{key:"updateDevicePixelRatio",value:function(){var g=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(g),this.devicePixelRatioLabel.string="Device Pixel Ratio: ".concat(g)}},{key:"updateDevicePixelRatioColor",value:function(g){this.devicePixelRatioLabel.color=g>2?r$:g<=1?r1:r0}},{key:"getFps",value:function(){var g=this.stats.fps.counter;return Math.floor(g.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var g=this.stats.logic.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getPhysicTime",value:function(){var g=this.stats.physics.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getRenderTime",value:function(){var g=this.stats.render.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var g=this.stats.bufferMemory.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var g=this.stats.textureMemory.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),n}(M)).prototype,"fpsLabel",[r_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rN=st(rO.prototype,"drawCountLabel",[rk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rM=st(rO.prototype,"logicTimeLabel",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rD=st(rO.prototype,"physicTimeLabel",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rF=st(rO.prototype,"renderTimeLabel",[rT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rU=st(rO.prototype,"objectMemoryUsageLabel",[rR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rx=st(rO.prototype,"textureMemoryUsageLabel",[rI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rz=st(rO.prototype,"devicePixelRatioLabel",[rP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rL=rO))||rL);_._RF.pop(),_._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var r2,r4=function(g){return g.INVITE_FRIENDS="invite-friends",g.REPLAY_FRIENDS="replay-friends",g.SHOW_CHALLENGE_RESULTS="show-challenge-results",g.NEXT_LEVEL="next-level",g.MAX_LEVEL="max-level",g.START_OVER="start-over",g.SELECT_LEVEL="select-level",g.GAME_START="game-start",g.GAME_PAUSE="game-pause",g.GAME_RESUME="game-resume",g.GAME_REPLAY="game-replay",g.GAME_FINISH="game-finish",g.GAME_EXIT="game-exit",g.USE_ITEM="use-item",g.SKIP_LEVEL="skip-level",g.ADD_ITEM="add-item",g.ADD_ITEMS="add-items",g.ADD_COINS="add-coins",g.REMOVE_COINS="remove-coins",g.REMOVE_COINS_SUCCESS="remove-coins-success",g.REMOVE_COINS_FAILED="remove-coins-failed",g.COIN_CHANGED="coin-changed",g.ABORT_COIN_ANIMATION="abort-coin-animation",g.ADD_STARS="add-stars",g.PAUSE_TIME="pause-time",g.RESUME_TIME="resume-time",g.TIME_OUT="time-out",g.HALF_TIME="half-time",g.RESCUE_START="rescue-time",g.RESCUE_FINISHED="clock-animation-finished",g.APPLY_GRAVITY="apply-gravity",g.IDLE_ENTER="idle-enter",g.IDLE_EXIT="idle-exit",g.GRID_MATCH="grid-match",g.GRID_MATCH_SUCCESS="grid-match-success",g.GRID_MATCH_FAIL="grid-match-fail",g.GRID_CLEAR="grid-clear",g.GRID_SPAWN="grid-spawn",g.GRID_CREATE="grid-create",g.GRID_RESIZE="grid-resize",g.TILE_CLICK="tile-click",g.BOMB_EXPLODE="bomb-explode",g.SHOW_HINT="show-hint",g.ADD_COMBO="add-combo",g.COMBO_UPDATED="combo-updated",g.COMBO_ENDED="combo-ended",g.ADD_SCORE="add-score",g.SCORE_UPDATED="score-updated",g.SHOW_UI="show-ui",g.HIDE_UI="hide-ui",g.AUTO_PLAY="auto-play",g.GUIDE_MASK_CLICKED="guide-mask-clicked",g}(r4||{});_._RF.pop(),_._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var r3,r5,r6,r8,r9,r7,ae,an,ai,ar,aa,ao,as,al,au,ac,ah,ap,ad=(0,k.ccclass)("PanelAnimationController")(r2=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).animators=new Set,g.eventTarget=new eg,g.handleRegistration=function(E){if(!E)throw new Error("Invalid event payload.");g.animators.has(E)&&console.warn("Animator already registered."),g.animators.add(E)},g.handleUnregistration=function(E){if(!E)throw new Error("Invalid event payload.");g.animators.has(E)||console.warn("Animator not registered."),g.animators.delete(E)},g.handleShowUIs=function(){var E=Be(function(E){var _,k,C,A,T,R,I,P,L,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:C=!1,A=[],T=at(g.animators);try{for(T.s();!(k=T.n()).done;){R=k.value;A.push(R)}}catch(g){T.e(g)}finally{T.f()}for(I=[],P=0,L=A;P<L.length;P++){B=L[P];if(!B.isReadyForAnimation()&&!C)C=!0,null==E||null===(O=E.fallback)||void 0===O||O.call(E);I.push(B.handleShowUI())}return[4,Promise.all(I)];case 1:N.sent(),null==E||null===(_=E.onComplete)||void 0===_||_.call(E),g.eventTarget.emit(r4.SHOW_UI);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g.handleHideUIs=function(){var E=Be(function(E){var _,k,C,A,T,R,I,P,L,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:C=!1,A=[],T=at(g.animators);try{for(T.s();!(k=T.n()).done;){R=k.value;A.push(R)}}catch(g){T.e(g)}finally{T.f()}for(I=[],P=0,L=A;P<L.length;P++){B=L[P];if(!B.isReadyForAnimation()&&!C)C=!0,null==E||null===(O=E.fallback)||void 0===O||O.call(E);I.push(B.handleHideUI())}return[4,Promise.all(I)];case 1:N.sent(),null==E||null===(_=E.onComplete)||void 0===_||_.call(E),g.eventTarget.emit(r4.HIDE_UI);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(n,[{key:"onEnable",value:function(){this.node.scene.on(r4.SHOW_UI,this.handleShowUIs,this),this.node.scene.on(r4.HIDE_UI,this.handleHideUIs,this)}},{key:"onDisable",value:function(){this.node.scene.off(r4.SHOW_UI,this.handleShowUIs,this),this.node.scene.off(r4.HIDE_UI,this.handleHideUIs,this)}},{key:"showUI",value:function(){return this.handleShowUIs()}},{key:"hideUI",value:function(){return this.handleHideUIs()}},{key:"on",value:function(g,E,_,k){this.eventTarget.on(g,E,_,k)}},{key:"off",value:function(g,E,_){this.eventTarget.off(g,E,_)}}],[{key:"getController",value:function(g){for(var E=null,_=g;null!==_;){if(E=_.getComponent(n))break;_=_.parent}return E}},{key:"registerAnimator",value:function(g){var E=this.getController(g.node);E?E.handleRegistration(g):console.warn("No PanelAnimationController found for animator ".concat(g.node.name))}},{key:"unregisterAnimator",value:function(g){var E=this.getController(g.node);E?E.handleUnregistration(g):console.warn("No PanelAnimationController found for animator ".concat(g.node.name))}}]),n}(M))||r2;_._RF.pop(),_._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var af,ay,av,ag,am,ab,aw,aS,aE,a_,ak,aC,aA=k.ccclass,aT=k.property,aR=GameCore.Utils.Object,aI=(r3=aA("AnimationConfig"),r5=aT({type:[H]}),r3((r9=st((r8=function(){function e(){Fe(this,e),rt(this,"startHidden",r9,this),rt(this,"nodes",r7,this),rt(this,"posOffset",ae,this),rt(this,"showEase",an,this),rt(this,"hideEase",ai,this),rt(this,"showDuration",ar,this),rt(this,"hideDuration",aa,this)}return Ue(e,[{key:"setConfig",value:function(g){g&&aR.assign(this,g)}}]),e}()).prototype,"startHidden",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),r7=st(r8.prototype,"nodes",[r5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ae=st(r8.prototype,"posOffset",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),an=st(r8.prototype,"showEase",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),ai=st(r8.prototype,"hideEase",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),ar=st(r8.prototype,"showDuration",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),aa=st(r8.prototype,"hideDuration",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),r6=r8))||r6),aP=(ao=aA("PanelAnimator"),as=aT({type:aI,displayName:"Top animation nodes"}),al=aT({type:aI,displayName:"Bottom animation nodes"}),ao((ah=st((ac=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"topConfig",ah,Ke(g)),rt(g,"botConfig",ap,Ke(g)),g.isReady=!1,g}return Ue(a,[{key:"onEnable",value:function(){ad.registerAnimator(this)}},{key:"onDisable",value:function(){ad.unregisterAnimator(this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(_=Be(function(){return _ts_generator(this,function(g){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return _.apply(this,arguments)})},{key:"handleHideUI",value:(E=Be(function(){return _ts_generator(this,function(g){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return E.apply(this,arguments)})},{key:"createAnimator",value:function(g,E){var _=g.nodes,k=g.posOffset,C=g.showEase,A=g.hideEase,T=g.showDuration,R=g.hideDuration,I=_.map(function(g){return"top"===E&&g.isAlignTop?{mode:"top",value:g.top}:"bottom"===E&&g.isAlignBottom?{mode:"bottom",value:g.bottom}:{mode:"position",value:g.node.position.y}}),P=_.map(function(g){return"top"===E&&g.isAlignTop?{mode:"top",value:g.top+k}:"bottom"===E&&g.isAlignBottom?{mode:"bottom",value:g.bottom-k}:{mode:"position",value:g.node.position.y+k}}),L="shown",O=new nD;return{switchState:function(g,E){var k=arguments.length>1&&void 0!==E&&E;if(O.abort(),O=new nD,L===g)return Promise.resolve(null);L=g;var B="hidden"===g?I:P,N="hidden"===g?P:I,M="hidden"===g?R:T,D="hidden"===g?A:C;return k?(_.forEach(function(g,E){var _=B[E],k=N[E].value;"top"===_.mode&&(g.top=k),"bottom"===_.mode&&(g.bottom=k),"position"===_.mode&&(g.node.position=new em(g.node.position.x,k,g.node.position.z))}),Promise.resolve(null)):Promise.all(_.map(function(g,E){var _=B[E],k=N[E].value;return t$.runTweenAsync(a.getTween({widget:g,config:_,target:k,easing:D,duration:M}),O)}))}}}},{key:"setAnimator",value:function(g){var E=g.topConfig,_=g.botConfig,k=new aI,C=new aI;k.setConfig(E),C.setConfig(_),this.topConfig=k,this.botConfig=C,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(g){var E=g.widget,_=g.config,k=g.target,C=g.easing,A=g.duration;return"top"===_.mode?z(E).call(function(){E.top=_.value}).to(A,{top:k},{easing:C}):"bottom"===_.mode?z(E).call(function(){E.bottom=_.value}).to(A,{bottom:k},{easing:C}):z(E.node.position).call(function(){E.node.position=new em(E.node.position.x,_.value,E.node.position.z)}).to(A,{y:k},{easing:C})}}]),a}(M)).prototype,"topConfig",[as],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new aI}}),ap=st(ac.prototype,"botConfig",[al],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new aI}}),au=ac))||au);_._RF.pop(),_._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var aL,aO,aB,aN,aM,aD,aF,aU,ax,az,aG,aV=k.ccclass,aK=k.requireComponent,aH=k.property,aq=globalThis.game,aW=aq.ads,aj=aq.event,aX=GameCore,aY=aX.Events,aJ=aX.Configs.Ads.BannerDisplayAdOptions,aQ=aX.Plugins.Ads,aZ=aQ.Types,a$=aQ.Status,a0=aX.Utils,a1=a0.Array,a2=a0.Function,a4=["top","topleft","topright"],a3=["bottom","bottomleft","bottomright"],a5=["left","topleft","bottomleft"],a6=["right","topright","bottomright"];af=aV("ResizeWithBannerAd"),ay=aK(H),av=aH(J),ag=aH(J),am=aH(J),ab=aH(J),af(aw=ay((aE=st((aS=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"includeSAB",aE,Ke(g)),rt(g,"includeRightBanner",a_,Ke(g)),rt(g,"includeBottomBanner",ak,Ke(g)),rt(g,"includeLeftBanner",aC,Ke(g)),g.handleOnAdShowing=function(E){var _=E.placementId;g.checkValid()&&_&&aW.getAd(aZ.BANNER,_)&&(g.resizeWhenBannerAdShow(_),g.emitResizeEvent())},g.handleOnAdClosed=function(E){var _=E.placementId;g.checkValid()&&_&&aW.getAd(aZ.BANNER,_)&&(g.resizeWhenBannerAdClose(_),g.emitResizeEvent())},g.handleOnResize=function(){g.checkValid()&&aJ.forEach(function(E){var _=E.PlacementId,k=aW.getAdStatus(aZ.BANNER,_);k&&(k===a$.SHOWING?g.resizeWhenBannerAdShow(_):k===a$.IDLE&&g.resizeWhenBannerAdClose(_))})},g.resizeWhenBannerAdShow=function(E){var _=void 0,k=void 0,C=void 0,A=void 0,T=nl.cssSizeToWorldSize(1),R=aW.getBannerConfig(E),I=R.PlacementId,P=R.BannerWidth,L=R.Position;if("top"===L)_=aW.getBannerHeight(I,T);else if("bottom"===L)g.includeBottomBanner?k=aW.getBannerHeight(I,T,g.includeSAB):g.includeSAB&&(k=aW.getSafeAreaBottom(T));else if("left"===L||"right"===L){if(void 0===P)return;var O=P;"getBannerOffset"in GameSDK.extra&&(O+=GameSDK.extra.getBannerOffset()),"left"===L&&g.includeLeftBanner?C=O*T:"right"===L&&g.includeRightBanner&&(A=O*T)}g.updateWidgets({top:_,bottom:k,left:C,right:A})},g.resizeWhenBannerAdClose=function(E){var _=aW.getBannerConfig(E).Position,k=nl.cssSizeToWorldSize(1),C=g.includeSAB?aW.getSafeAreaBottom(k):0;g.updateWidgets({top:a1.has(a4,_)?0:void 0,bottom:a1.has(a3,_)?C:void 0,left:a1.has(a5,_)?0:void 0,right:a1.has(a6,_)?0:void 0})},g.emitResizeEvent=a2.debounce(function(){Q.emit(ns)},100),g}return Ue(n,[{key:"__preload",value:function(){this.widget=this.getComponent(H),nA.lazyValidateProperties(this),aj.on(aY.AD_SHOWING,this.handleOnAdShowing),aj.on(aY.AD_CLOSED,this.handleOnAdClosed),Q.on(t5,this.handleOnResize)}},{key:"onDestroy",value:function(){aj.off(aY.AD_SHOWING,this.handleOnAdShowing),aj.off(aY.AD_CLOSED,this.handleOnAdClosed),Q.off(t5,this.handleOnResize)}},{key:"start",value:function(){this.handleOnResize()}},{key:"updateWidgets",value:function(g){var E=g.top,_=g.bottom,k=g.left,C=g.right;this.widget.top=null!=E?E:this.widget.top,this.widget.bottom=null!=_?_:this.widget.bottom,this.widget.left=null!=k?k:this.widget.left,this.widget.right=null!=C?C:this.widget.right,eb.instance.emit("canvas-resize")}},{key:"checkValid",value:function(){return this.node.activeInHierarchy&&null!==this.node.parent&&void 0!==this.node.parent}}]),n}(M)).prototype,"includeSAB",[av],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),a_=st(aS.prototype,"includeRightBanner",[ag],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ak=st(aS.prototype,"includeBottomBanner",[am],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),aC=st(aS.prototype,"includeLeftBanner",[ab],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),aw=aS))||aw);_._RF.pop(),_._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var a8,a9,a7,oe,on,oi,or,oa=k.ccclass,oo=k.property,os=k.executeInEditMode,ol=k.requireComponent,ou=(aL=oa("TapperedProgressBar"),aO=ol(eu),aB=oo({type:eu,displayName:"Fill opacity"}),aN=oo({type:eo,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),aM=oo({type:eo,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),aD=oo({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),aL(aF=os(aF=aO((ax=st((aU=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"uiOpacity",ax,Ke(g)),rt(g,"leftCap",az,Ke(g)),rt(g,"rightCap",aG,Ke(g)),g}return Ue(n,[{key:"progress",get:function(){return Je(Ve(n.prototype),"progress",this)},set:function(g){$e(Ve(n.prototype),"progress",g,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity){if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var g=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=g}}}},{key:"start",value:function(){this.updateAppearance()}}]),n}(ew)).prototype,"uiOpacity",[aB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),az=st(aU.prototype,"leftCap",[aN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aG=st(aU.prototype,"rightCap",[aM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st(aU.prototype,"progress",[aD],Object.getOwnPropertyDescriptor(aU.prototype,"progress"),aU.prototype),aF=aU))||aF)||aF)||aF);_._RF.pop(),_._RF.push({},"aa60frMJLtIlJZh2yJhMp1s","DynamicLabel",void 0);var oc,oh,op,od,of,oy,ov,og,om,ob,ow=k.ccclass,oS=k.property,oE=k.executeInEditMode,o_=k.requireComponent;a8=ow("DynamicLabel"),a9=o_(P),a7=oE(!0),oe=oS({type:K,min:1,max:200}),on=oS({type:K,min:.1,max:4}),a8(oi=a9(oi=a7((st((or=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k)))._quality=1,g._size=1,g._outlineWidth=0,g._shadowOffset=new eS(0,0),g}return Ue(n,[{key:"size",get:function(){return this._size},set:function(g){this._size=g,this.label.fontSize=this.size*this.quality}},{key:"quality",get:function(){return this._quality},set:function(g){this._quality=g,this.node.scale=new em(1/this.quality,1/this.quality,1),this.label.fontSize=this.size*this.quality,this.label.outlineWidth=this._outlineWidth*this.quality,this.label.shadowOffset=this._shadowOffset.multiplyScalar(this.quality)}},{key:"__preload",value:function(){this.label=this.getComponent(P)}},{key:"start",value:function(){this._quality=1/this.node.scale.x,this._size=this.label.fontSize/this.quality,this._outlineWidth=this.label.outlineWidth,this._shadowOffset=this.label.shadowOffset,this.quality=window.devicePixelRatio,console.info("\uD83D\uDD20 ".concat(this.node.name,"<Label> quality:"),this.quality)}}]),n}(M)).prototype,"size",[oe],Object.getOwnPropertyDescriptor(or.prototype,"size"),or.prototype),st(or.prototype,"quality",[on],Object.getOwnPropertyDescriptor(or.prototype,"quality"),or.prototype),oi=or))||oi)||oi);_._RF.pop(),_._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var ok,oC,oA,oT,oR,oI,oP,oL,oO,oB=k.ccclass,oN=k.property,oM=k.requireComponent,oD=k.executeInEditMode,oF=k.disallowMultiple,oU=globalThis.game.language;oc=oB("Localize"),oh=oM(P),op=oD(!0),od=oN({visible:!0}),of=oN({group:{name:"Fonts",id:"fonts",displayOrder:1},type:eE}),oy=oN({group:{name:"Fonts",id:"fonts",displayOrder:2},type:eE}),oc(ov=oF(ov=oh(ov=op((st((og=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"enFont",om,Ke(g)),rt(g,"ruFont",ob,Ke(g)),g.handleLanguageChanged=function(){g.updateTransToNode()},g}return Ue(n,[{key:"key",get:function(){return this._key},set:function(g){g&&(this._key=g,this.updateTransToNode())}},{key:"__preload",value:function(){this.label=this.getComponent(P),this.validateRequiredComponents(),this.updateTransToNode()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"start",value:function(){this.listenEvent()}},{key:"listenEvent",value:function(){Q.on("update-language",this.handleLanguageChanged)}},{key:"updateTransToNode",value:function(){if(this.node.active&&this._key)try{var g=oU.getText(this._key),E=this.getFontByLang();this.label.font=E,this.label.string=g,this.node.emit("update-trans",g)}catch(g){console.warn(g)}}},{key:"getFontByLang",value:function(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(oU.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}]),n}(M)).prototype,"key",[od],Object.getOwnPropertyDescriptor(og.prototype,"key"),og.prototype),om=st(og.prototype,"enFont",[of],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ob=st(og.prototype,"ruFont",[oy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ov=og))||ov)||ov)||ov);_._RF.pop(),_._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var ox,oz,oG,oV,oK,oH,oq,oW,oj,oX=k.ccclass,oY=k.property,oJ=function(){function e(g,E){Fe(this,e);var _=null!=E?E:{response:1,dampen:1,eager:1};this.k1=e.calcK1(_),this.k2=e.calcK2(_),this.k3=e.calcK3(_),this.xp=g.clone(),this.y=g.clone(),this.yd=new eS(0,0)}return Ue(e,[{key:"update",value:function(g,E,_){var k=arguments.length>2&&void 0!==_?_:null,C=k;null===C&&(C=new eS((E.x-this.xp.x)/g,(E.y-this.xp.y)/g),this.xp.x=E.x,this.xp.y=E.y);var A=Math.max(this.k2,g*g/2+g*this.k1/2,g*this.k1);return this.y.x=this.y.x+g*this.yd.x,this.y.y=this.y.y+g*this.yd.y,this.yd.x=this.yd.x+g*(E.x+this.k3*C.x-this.y.x-this.k1*this.yd.x)/A,this.yd.y=this.yd.y+g*(E.y+this.k3*C.y-this.y.y-this.k1*this.yd.y)/A,this.y}},{key:"setDynamics",value:function(g){this.k1=e.calcK1(g),this.k2=e.calcK2(g),this.k3=e.calcK3(g)}},{key:"reset",value:function(g){this.xp.set(g.x,g.y),this.y.set(g.x,g.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(g){return g.dampen/(Math.PI*g.response)}},{key:"calcK2",value:function(g){return 1/(2*Math.PI*g.response*(2*Math.PI*g.response))}},{key:"calcK3",value:function(g){return g.eager*g.dampen/(2*Math.PI*g.response)}}]),e}(),oQ=(ok=oX("SODConfig"),oC=oY({type:K,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),oA=oY({type:K,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),oT=oY({type:K,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),ok((oP=st((oI=Ue(function e(){Fe(this,e),rt(this,"response",oP,this),rt(this,"dampen",oL,this),rt(this,"eager",oO,this)})).prototype,"response",[oC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),oL=st(oI.prototype,"dampen",[oA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),oO=st(oI.prototype,"eager",[oT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oR=oI))||oR);_._RF.pop(),_._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var oZ,o$,o0,o1,o2,o4,o3,o5,o6,o8,o9,o7,se,sn,si,sr,sa,so,ss,sl,su,sc,sh,sp,sf,sy,sv=k.ccclass,sg=k.property,sm=(ox=sv("Trail"),oz=sg({type:C,displayName:"Target"}),oG=sg({type:ef,displayName:"Graphics"}),oV=sg({type:[oQ],displayName:"Trail Nodes"}),ox((oq=st((oH=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"target",oq,Ke(g)),rt(g,"graphics",oW,Ke(g)),rt(g,"trailNodes",oj,Ke(g)),g.trailNodeInstances=[],g}return Ue(n,[{key:"reset",value:function(){var g,E=at(this.trailNodeInstances);try{for(E.s();!(g=E.n()).done;)g.value.reset(new eS(this.node.worldPosition.x,this.node.worldPosition.y))}catch(g){E.e(g)}finally{E.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(g){this.graphics.clear();var E=this.trailNodeInstances[0];this.drawTrail(g,E,this.target.worldPosition.x,this.target.worldPosition.y);for(var _=1;_<this.trailNodeInstances.length;_++){var k=this.trailNodeInstances[_-1],C=this.trailNodeInstances[_];this.drawTrail(g,C,k.currentState.x,k.currentState.y)}}},{key:"drawTrail",value:function(g,E,_,k){var C=this.graphics,A=new eS(_,k),T=E.update(g,A),R=new em(A.x,A.y,0),I=new em(T.x,T.y,0);C.node.inverseTransformPoint(R,R),C.node.inverseTransformPoint(I,I),C.moveTo(R.x,R.y),C.lineTo(I.x,I.y),C.stroke()}},{key:"spawnTrailNodes",value:function(){var g,E=at(this.trailNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value,k=new eS(this.node.worldPosition.x,this.node.worldPosition.y),C=new oJ(k,_);this.trailNodeInstances.push(C)}}catch(g){E.e(g)}finally{E.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(M)).prototype,"target",[oz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oW=st(oH.prototype,"graphics",[oG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oj=st(oH.prototype,"trailNodes",[oV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oK=oH))||oK);_._RF.pop(),_._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var sb,sw=k.ccclass,sS=k.executionOrder,sE=k.property,s_=GameCore.Utils.Function,sk="Batch By Name",sC="Batch Label",sA="Batch Sprite",sT=(oZ=sw("BatchNodes"),o$=sS(99999),o0=sE({group:{name:sk}}),o1=sE({type:[V],group:{name:sk}}),o2=sE({type:[x],group:{name:sk}}),o4=sE({group:{name:sC}}),o3=sE({group:{name:sC}}),o5=sE({group:{name:sC}}),o6=sE({group:{name:sA}}),o8=sE({group:{name:sA}}),o9=sE({readonly:!0}),o7=sE({readonly:!0}),se=sE({readonly:!0}),oZ(sn=o$((sr=st((si=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"batchByName",sr,Ke(g)),rt(g,"depthNames",sa,Ke(g)),rt(g,"listName",so,Ke(g)),rt(g,"batchLabel",ss,Ke(g)),rt(g,"depthLabel",sl,Ke(g)),rt(g,"typeLabel",su,Ke(g)),rt(g,"batchSprite",sc,Ke(g)),rt(g,"depthSprite",sh,Ke(g)),rt(g,"batchAllNodes",sp,Ke(g)),rt(g,"batchDepth",sf,Ke(g)),rt(g,"checkOverlap",sy,Ke(g)),g.batchNode={},g.labelChildren=[],g.spriteChildren=[],g.allChildren=[],g.nameChildren=[],g.originalParents={},g.isInited=!1,g.handleNodeChange=s_.throttle(function(){g.isInited&&(console.warn("handleNodeChange",g.node.name),g.setupBatchNodes(g.node))},1e3),g.onAfterUpdate=function(){g.isInited&&g.hierarchyChildren()},g.onAfterRender=function(){g.isInited&&g.restoreOriginalChildren()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled&&(N.on(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.on(e_.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){N.off(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.off(e_.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){this.isInited||(N.on(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.on(e_.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"handleActiveChange",value:function(g){g.once(C.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.handleNodeChange)}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),N.off(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.off(e_.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(g){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(g),this.createGlobalNodes(g),this.createGlobalNameNodes(g),this.createGlobalLabelNode(g),this.createGlobalSpriteNode(g),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var g,E,_,k=this;null===(g=this.batchNode.node)||void 0===g||g.setSiblingIndex(0),null===(E=this.batchNode.label)||void 0===E||E.setSiblingIndex(this.depthLabel),null===(_=this.batchNode.sprite)||void 0===_||_.setSiblingIndex(this.depthSprite),this.listName.forEach(function(g,E){var _;console.log("name",g,k.depthNames[E]),null===(_=k.batchNode[g])||void 0===_||_.setSiblingIndex(k.depthNames[E])})}},{key:"createGlobalNodes",value:function(g){if(this.batchAllNodes){var E=new C("GlobalBatchNode");E.active=!0,this.batchNode.node=E,g.addChild(E)}}},{key:"createGlobalNameNodes",value:function(g){if(this.batchByName){var E,_=at(this.listName);try{for(_.s();!(E=_.n()).done;){var k=E.value;if(!this.batchNode[k]){var A=new C(k);A.active=!0,this.batchNode[k]=A,g.addChild(A)}}}catch(g){_.e(g)}finally{_.f()}}}},{key:"createGlobalLabelNode",value:function(g){if(this.batchLabel){var E=new C("GlobalLabelNode");E.active=!0,this.batchNode.label=E,g.addChild(E)}}},{key:"createGlobalSpriteNode",value:function(g){if(this.batchSprite){var E=new C("GlobalSpriteNode");E.active=!0,this.batchNode.sprite=E,g.addChild(E)}}},{key:"saveOriginalParents",value:function(){var g,E=[].concat(tt(this.labelChildren),tt(this.spriteChildren)),_=this.nameChildren,k=at(E);try{for(k.s();!(g=k.n()).done;){var C=g.value;C.node.parent&&(this.handleActiveChange(C.node),this.originalParents[C.uuid]=C.node.parent)}}catch(g){k.e(g)}finally{k.f()}var A,T=at(_);try{for(T.s();!(A=T.n()).done;){var R=A.value;R.parent&&(this.handleActiveChange(R),this.originalParents[R.uuid]=R.parent)}}catch(g){T.e(g)}finally{T.f()}}},{key:"saveOriginalChildren",value:function(g){var E,_=at(g.children);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.saveLabelChildren(k),this.saveSpriteChildren(k),this.saveNodeChildrenByName(k),this.saveNodeChildrenByType(k)}}catch(g){_.e(g)}finally{_.f()}this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(g){var E;if(this.batchLabel){var _=g.getComponentsInChildren(P);"char"===this.typeLabel&&(_=_.filter(function(g){return g.cacheMode===P.CacheMode.CHAR})),0!==_.length&&(E=this.labelChildren).push.apply(E,tt(_))}}},{key:"saveSpriteChildren",value:function(g){var E;if(this.batchSprite){var _=g.getComponentsInChildren(eo);0!==_.length&&(E=this.spriteChildren).push.apply(E,tt(_))}}},{key:"saveNodeChildrenByName",value:function(g){if(this.batchByName){var E,_=at(g.children);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.listName.includes(k.name)?this.nameChildren.push(k):this.saveNodeChildrenByName(k)}}catch(g){_.e(g)}finally{_.f()}}}},{key:"saveNodeChildrenByType",value:function(g,E){var _,k=arguments.length>1&&void 0!==E?E:0;if(this.batchAllNodes){var C=g.getComponentsInChildren(M);if((_=this.allChildren).push.apply(_,tt(C)),!(this.batchDepth<1||k>=this.batchDepth)){var A,T=at(this.allChildren);try{for(T.s();!(A=T.n()).done;){var R=A.value;this.saveNodeChildrenByType(R.node,this.batchDepth)}}catch(g){T.e(g)}finally{T.f()}}}}},{key:"hierarchyChildren",value:function(){var g,t=function(g,E){g.node.isValid&&g.node.activeInHierarchy&&!g.node.isChildOf(E)&&(g.node.setParent(E,!0),g.node.layer=ek.Enum.UI_2D)},E=["GlobalLabelNode","GlobalSpriteNode","GlobalBatchNode"],_=at(this.labelChildren);try{for(_.s();!(g=_.n()).done;)t(g.value,this.batchNode.label)}catch(g){_.e(g)}finally{_.f()}var k,C=at(this.spriteChildren);try{for(C.s();!(k=C.n()).done;)t(k.value,this.batchNode.sprite)}catch(g){C.e(g)}finally{C.f()}var A,T=at(this.allChildren);try{for(T.s();!(A=T.n()).done;)t(A.value,this.batchNode.node)}catch(g){T.e(g)}finally{T.f()}this.allChildren.sort(function(g,E){return g.constructor.name.localeCompare(E.constructor.name)}),this.labelChildren.sort(function(g,E){return g.cacheMode-E.cacheMode});var R,I=at(this.nameChildren);try{for(I.s();!(R=I.n()).done;){var P=R.value;if(P.isValid&&P.activeInHierarchy&&P.isTransformDirty()){var L=P.getComponent(eu);L&&L.opacity<1||E.includes(P.name)||P.isChildOf(this.batchNode[P.name])||(P.setParent(this.batchNode[P.name],!0),P.layer=ek.Enum.UI_2D)}}}catch(g){I.e(g)}finally{I.f()}}},{key:"restoreOriginalChildren",value:function(){var g=[].concat(tt(this.labelChildren),tt(this.spriteChildren));if(g.length>0){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value,C=this.originalParents[k.uuid];C&&(k.node.isChildOf(C)||k.node.setParent(C,!0))}}catch(g){_.e(g)}finally{_.f()}}var A,T=at(this.nameChildren);try{for(T.s();!(A=T.n()).done;){var R=A.value,I=this.originalParents[R.uuid];I&&(R.isChildOf(I)||R.setParent(I,!0))}}catch(g){T.e(g)}finally{T.f()}}}]),n}(M)).prototype,"batchByName",[o0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sa=st(si.prototype,"depthNames",[o1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),so=st(si.prototype,"listName",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ss=st(si.prototype,"batchLabel",[o4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sl=st(si.prototype,"depthLabel",[o3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),su=st(si.prototype,"typeLabel",[o5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),sc=st(si.prototype,"batchSprite",[o6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sh=st(si.prototype,"depthSprite",[o8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sp=st(si.prototype,"batchAllNodes",[o9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sf=st(si.prototype,"batchDepth",[o7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sy=st(si.prototype,"checkOverlap",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sn=si))||sn)||sn);_._RF.pop(),_._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var sR=k.ccclass,sI=GameCore.Utils.Browser,sP=globalThis.game.player,sL=sR("Vibrate")(sb=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"vibrate",value:function(g){if(this.isVibrateEnable()&&!sI.vibrate(g)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!sP.getPlayerSetting("vibrate")}}]),n}(M))||sb;_._RF.pop(),_._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);var sO=1/6;_._RF.pop(),_._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);var sB,sN={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};_._RF.pop(),_._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var sM=10,sD=20,sF=100,sU=(Ge(sB={},sN.HINT,80),Ge(sB,sN.THUNDER,200),Ge(sB,sN.STORM,150),Ge(sB,sN.PLIERS,150),sB),sx=2e3,sz=300;_._RF.pop(),_._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var sG={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};_._RF.pop(),_._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);var sV=Me(Me({},GameCore.Dtos.Match.Data.getDefaultData()),{},{extraData:null});_._RF.pop(),_._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var sK=function(g){return g.UNLOCK_DEV_TOOLS="unlock-dev-tools",g.TRIGGER_UNLOCK_KEY="trigger-unlock-key",g.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",g}(sK||{}),sH={Events:sK,UNLOCK_SEQUENCE:"101013012031"};_._RF.pop(),_._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);var sq;_._RF.pop(),_._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);var sW={level:0,coins:0,stars:0,totalLevel:400,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:(sq={},Ge(sq,sN.HINT,0),Ge(sq,sN.THUNDER,0),Ge(sq,sN.STORM,0),Ge(sq,sN.PLIERS,0),sq)};_._RF.pop(),_._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);var sj="global-leaderboard-key",sX="friends-leaderboard-key",sY="global-leaderboard-id",sJ="friends-leaderboard-id";_._RF.pop(),_._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);var sQ=Me(Me({},GameCore.Dtos.Match.CustomData.getDefaultData()),{},{score:0});_._RF.pop(),_._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);var sZ={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:sW,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};_._RF.pop(),_._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);var s$="BootScene",s0="GameScene",s1="DashboardScene",s2="ChallengeResultScene";_._RF.pop(),_._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var s4=function(g){return g.RELOAD_TOURNAMENT="reload-tournament",g}(s4||{});_._RF.pop(),_._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);var s3=GameCore,s5=s3.Configs.FrameCapture,s6=s5.Enabled,s8=s5.WideframeConfigs,s9=s3.Utils.Object,s7=function(){var g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){if(!s6)return[2,(console.warn("FrameCapture is not enabled"),null)];E=ku(g);if(!E)return[2,null];Eu(E,s8.CustomResultChallenge);_=window.game.frameCapture,k=s8.CustomResultChallenge,C=k.Width,A=k.Height;return[2,_.captureAsync({name:"CustomResultChallenge",width:C,height:A,renderOptions:E})]})});return function(E){return g.apply(this,arguments)}}(),Eu=function(g,E){var _=E.Width,k=E.Height,C=E.Wideframe;g.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:C,size:[_,k],position:[0,0]}},ku=function(g){try{var E=g.playerId,_=void 0===E?"10":E,k=g.playerPhoto,C=void 0===k?"":k,A=g.playerScore,T=void 0===A?0:A,R=g.opponentId,I=void 0===R?"20":R,P=g.opponentPhoto,L=void 0===P?"":P,O=g.opponentScore,B=void 0===O?0:O,N=g.isPlayerFinished,M=g.isOpponentFinished,D=s8.CustomResultChallenge.RenderOptions;if(!D)return null;var F=s9.camelCaseKeys(s9.clone(D)||{}),U=F.playerPhoto,x=F.opponentPhoto,z=T===B,G=T>B,V=null!=N?N:M,K=N&&M;return"image"===U.type&&(U.name="".concat(_),U.image=C),"image"===x.type&&(x.name="".concat(I),x.image=L),V&&Cu(F,{playerScore:T,opponentScore:B,isPlayerFinished:N,isOpponentFinished:M}),!K||z?(delete F.leftCrown,delete F.rightCrown,F):(G?delete F.rightCrown:delete F.leftCrown,F)}catch(g){return console.warn("getRenderOptionsShareScore",g),null}},Cu=function(g,E){var _=g.leftScore,k=g.rightScore,C=E.playerScore,A=void 0===C?0:C,T=E.opponentScore,R=void 0===T?0:T,I=E.isPlayerFinished,P=E.isOpponentFinished;"text"===_.type&&(_.text=I?"".concat(A):"???"),"text"===k.type&&(k.text=P?"".concat(R):"???")};_._RF.pop(),_._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var le=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,_)).code=g,k}return Ue(n)}(je(Error));_._RF.pop(),_._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var lt=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=g,k.tournamentId=_,k}return Ue(n)}(le);_._RF.pop(),_._RF.push({},"e80e4nIcfdLN56j5b9SMhvH","LeaderboardUtils",void 0);var ln=globalThis.game.leaderboard,li=function(){function e(){Fe(this,e)}var g,E,_;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getAllLeaderboardAsync",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!ln)return[2,null];return[4,ln.getLeaderboardResponseAsync(g)];case 1:E=C.sent();if(!E)return[2,null];_=ln.getLeaderboardName(g);if(!_)return[3,3];return[4,this.requestLeaderboardAsync(_,E.amountPlayer)];case 2:k=(C.sent(),ln.getLeaderboard(_));return[3,4];case 3:k=null;C.label=4;case 4:return[2,k]}})}),function(g){return _.apply(this,arguments)})},{key:"requestLeaderboardAsync",value:(E=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:if(!this.isLeaderboardRequesting(g))return[3,2];return[4,this.waitForLeaderboardFinishAsync(g)];case 1:_.sent();return[3,4];case 2:return[4,ln.requestLeaderboardAsync(g,E)];case 3:_.sent();_.label=4;case 4:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"waitForLeaderboardFinishAsync",value:(g=Be(function(g){var E;return _ts_generator(this,function(_){E=this;return[2,new Promise(function(_){var k=setInterval(function(){E.isLeaderboardRequesting(g)||(clearInterval(k),_())},100)})]})}),function(E){return g.apply(this,arguments)})},{key:"isLeaderboardRequesting",value:function(g){var E;return(null===(E=ln.getLeaderboard(g))||void 0===E?void 0:E.isRequesting)||!1}}]),e}();try{new li}catch(g){console.error("LeaderboardUtils",g)}_._RF.pop(),_._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var lr={mapOrder:[{id:1,theme:"summer",skins:["fruit"],levelCount:10},{id:2,theme:"autumn",skins:["flower"],levelCount:10},{id:3,theme:"winter",skins:["tool"],levelCount:10},{id:4,theme:"summer",skins:["sport"],levelCount:10},{id:5,theme:"autumn",skins:["cosmetics"],levelCount:10},{id:6,theme:"winter",skins:["ice-cream"],levelCount:10},{id:7,theme:"summer",skins:["cakes"],levelCount:10},{id:8,theme:"autumn",skins:["car"],levelCount:10},{id:9,theme:"spring-festival",skins:["flower","ice-cream"],levelCount:10},{id:10,theme:"tree-planting-festival",skins:["fruit","car","tool"],levelCount:10},{id:11,theme:"blue-sea-festival",skins:["sport","fruit"],levelCount:10},{id:12,theme:"music-festival",skins:["cakes","car","cosmetics"],levelCount:10},{id:13,theme:"harvest-festival",skins:["fruit","car","tool"],levelCount:10},{id:14,theme:"food-festival",skins:["cakes","ice-cream","cosmetics"],levelCount:10},{id:15,theme:"snow-festival",skins:["cakes","sport"],levelCount:10},{id:16,theme:"light-festival",skins:["ice-cream","car"],levelCount:10},{id:17,theme:"peace-festival",skins:["flower","sport","tool"],levelCount:10},{id:18,theme:"flower-festival",skins:["flower","fruit"],levelCount:10},{id:19,theme:"street-festival",skins:["fruit","ice-cream","sport"],levelCount:10},{id:20,theme:"color-garden",skins:["cakes","cosmetics","tool"],levelCount:10},{id:21,theme:"color-festival",skins:["flower","cakes","fruit"],levelCount:10},{id:22,theme:"nature-summer",skins:["flower","sport"],levelCount:10},{id:23,theme:"snow-mountain",skins:["cakes","ice-cream"],levelCount:10},{id:24,theme:"ice-festival",skins:["ice-cream","cosmetics"],levelCount:10},{id:25,theme:"green-grass-festival",skins:["flower","sport","tool"],levelCount:10},{id:26,theme:"community-festival",skins:["cosmetics","cakes","ice-cream"],levelCount:10},{id:27,theme:"water-festival",skins:["sport","ice-cream","flower"],levelCount:10},{id:28,theme:"animal-festival",skins:["flower","fruit","cakes"],levelCount:10},{id:29,theme:"lost-festival",skins:["sport","tool","car"],levelCount:10},{id:30,theme:"halloween-festival",skins:["cakes","car","fruit"],levelCount:10},{id:31,theme:"snow-music-festival",skins:["ice-cream","sport","tool"],levelCount:10},{id:32,theme:"christmas",skins:["cakes","flower","sport"],levelCount:10},{id:33,theme:"spring-flower-festival",skins:["flower","fruit"],levelCount:10},{id:34,theme:"tet-holiday",skins:["flower","cosmetics","fruit"],levelCount:10},{id:35,theme:"sea-festival",skins:["ice-cream","sport"],levelCount:10},{id:36,theme:"firework-festival",skins:["cosmetics","car","tool"],levelCount:10},{id:37,theme:"halloween-horror",skins:["cakes","car","fruit"],levelCount:10},{id:38,theme:"mid-autumn",skins:["flower","fruit","ice-cream"],levelCount:10},{id:39,theme:"christmas-sweet",skins:["cakes","flower","sport"],levelCount:10},{id:40,theme:"new-year-countdown",skins:["cosmetics","car","tool"],levelCount:10}]};_._RF.pop(),_._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);var la={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter",SPRING_FESTIVAL:"spring-festival",TREE_PLANTING_FESTIVAL:"tree-planting-festival",BLUE_SEA_FESTIVAL:"blue-sea-festival",MUSIC_FESTIVAL:"music-festival",HARVEST_FESTIVAL:"harvest-festival",FOOD_FESTIVAL:"food-festival",SNOW_FESTIVAL:"snow-festival",LIGHT_FESTIVAL:"light-festival",PEACE_FESTIVAL:"peace-festival",FLOWER_FESTIVAL:"flower-festival",STREET_FESTIVAL:"street-festival",COLOR_GARDEN:"color-garden",COLOR_FESTIVAL:"color-festival",NATURE_SUMMER:"nature-summer",SNOW_MOUNTAIN:"snow-mountain",ICE_FESTIVAL:"ice-festival",GREEN_GRASS_FESTIVAL:"green-grass-festival",COMMUNITY_FESTIVAL:"community-festival",WATER_FESTIVAL:"water-festival",ANIMAL_FESTIVAL:"animal-festival",LOST_FESTIVAL:"lost-festival",HALLOWEEN_FESTIVAL:"halloween-festival",SNOW_MUSIC_FESTIVAL:"snow-music-festival",CHRISTMAS:"christmas",SPRING_FLOWER_FESTIVAL:"spring-flower-festival",TET_HOLIDAY:"tet-holiday",SEA_FESTIVAL:"sea-festival",FIREWORK_FESTIVAL:"firework-festival",HALLOWEEN_HORROR:"halloween-horror","MID-AUTUMN":"mid-autumn",CHRISTMAS_SWEET:"christmas-sweet",NEW_YEAR_COUNTDOWN:"new-year-countdown",HAPPY_NEW_YEAR:"happy-new-year"};Z(la),_._RF.pop(),_._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var lo=globalThis.game,ls=lo.player,ll=lo.storage,lu={id:0,currentTheme:la.SUMMER,nextTheme:null,progress:0,max:10},lc={skins:["cakes"],theme:"summer",progress:0,max:10,isLocked:!0},lh=function(){function e(){Fe(this,e),this.mapData=lr,this.playerSkinProgress=null}return Ue(e,[{key:"initDashboardSceneStorage",value:function(){var g=ll.getStorage("dashboard");if(null==g){var E=this.getCurrentMapProgressInstance();ll.addStorage("dashboard",{lastMapPayload:E,numOfMapsPassed:0,animateToCurrentLevel:!1});var _=ll.getStorage("collection");if(null==_){ll.addStorage("collection",{lastMapPack:E.id,animateMapPackUnlock:!1});var k=ll.getStorage("leaderboard_content");if(null==k){ll.addStorage("leaderboard_content",{lastTabOpened:"global",previousScore:-1});var C=ll.getStorage("tournament");null==C&&ll.addStorage("tournament",{animateTournamentLeader:!1,previousScore:-1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),lu;for(var g=this.mapData.mapOrder,E=void 0,_=void 0,k=0,C=0,A=0,T=0;T<g.length;T++){var R=this.playerSkinProgress[T];if(R.currentProgress<R.maxProgress){var I,P;A=g[T].id,E=g[T].theme,_=null!==(I=null===(P=g[T+1])||void 0===P?void 0:P.theme)&&void 0!==I?I:E,k=R.currentProgress,C=R.maxProgress;break}}if(void 0===E||void 0===_){var L=g[g.length-1];return A=L.id,E=L.theme,_=L.theme,k=L.levelCount,C=L.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:A,currentTheme:E,nextTheme:_,progress:k,max:C}}return{id:A,currentTheme:E,nextTheme:_,progress:k,max:C}}},{key:"getUnlockedSkinsInstance",value:function(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];var g,E=[],_=at(this.playerSkinProgress);try{for(_.s();!(g=_.n()).done;){var k=g.value;k.isLocked||1!==k.skins.length||E.push(k.skins[0])}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"getLevelSkinsInstance",value:function(g){var E,_=null!=g?g:1,k=this.mapData.mapOrder,C=0,A=at(k);try{for(A.s();!(E=A.n()).done;){var T=E.value;if(C+T.levelCount>=_)return console.log("getMapSkin",T.skins),T.skins;C+=T.levelCount}}catch(g){A.e(g)}finally{A.f()}var R=k[k.length-1];return console.log("getMapSkin",R.skins),R.skins}},{key:"getLevelThemeInstance",value:function(g){var E,_=null!=g?g:1,k=this.mapData.mapOrder,C=0,A=at(k);try{for(A.s();!(E=A.n()).done;){var T=E.value;if(C+T.levelCount>=_)return console.log("getMapTheme",T.theme),T.theme;C+=T.levelCount}}catch(g){A.e(g)}finally{A.f()}var R=k[k.length-1];return console.log("getMapTheme",R.theme),R.theme}},{key:"getThemeSkinsInstance",value:function(g){var E,_=at(this.mapData.mapOrder);try{for(_.s();!(E=_.n()).done;){var k=E.value;if(k.theme===g)return console.log("getThemeSkins",k.skins),k.skins}}catch(g){_.e(g)}finally{_.f()}return console.warn("getThemeSkins: theme not found",g),[]}},{key:"getCollectionUnlockProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[lc];var g,E=[],_=at(this.playerSkinProgress);try{for(_.s();!(g=_.n()).done;){var k=g.value;E.push({skins:k.skins,theme:k.themeId,progress:k.currentProgress,max:k.maxProgress,isLocked:k.isLocked})}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"updatePlayerSkinProgress",value:function(){console.log("getPlayerSkinProgress: playerData not found, use data from level");var g=this.mapData.mapOrder;this.playerSkinProgress=[];var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.playerSkinProgress.push({skins:k.skins,themeId:k.theme,currentProgress:0,maxProgress:k.levelCount,isLocked:!0})}}catch(g){_.e(g)}finally{_.f()}this.updatePlayerSkinProgressByLevel()}},{key:"updatePlayerSkinProgressByLevel",value:function(){var g,E=ls.getGameData(),_=(null!==(g=null==E?void 0:E.level)&&void 0!==g?g:1)-1,k=this.mapData.mapOrder;this.playerSkinProgress[0].isLocked=!1;for(var C=0;C<k.length;C++){var A=k[C];if(!(_<=0)){var T=_-A.levelCount>=0?A.levelCount:_;_-=T,this.increaseProgress(C,T)}}}},{key:"increaseProgress",value:function(g,E){if(null!==this.playerSkinProgress){if(g>=this.playerSkinProgress.length)console.warn("increaseProgress: index out of range",g);else{var _,k=this.playerSkinProgress[g],C=k.currentProgress,A=k.maxProgress,T=C+E>A?A:C+E;if(T>0&&(this.playerSkinProgress[g].isLocked=!1),T===A)(null===(_=this.mapData.mapOrder[g+1])||void 0===_?void 0:_.skins)&&this.unlockSkin(g+1);this.playerSkinProgress[g].currentProgress=T,this.playerSkinProgress[g].maxProgress=A}}else console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?")}},{key:"unlockSkin",value:function(g){null!==this.playerSkinProgress?g>=this.playerSkinProgress.length?console.warn("unlockSkin: index out of range",g):this.playerSkinProgress[g].isLocked=!1:console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var g=this.getInstance();g.updatePlayerSkinProgress(),g.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkins",value:function(g){return this.getInstance().getLevelSkinsInstance(g)}},{key:"getLevelTheme",value:function(g){return this.getInstance().getLevelThemeInstance(g)}},{key:"getThemeSkins",value:function(g){return this.getInstance().getThemeSkinsInstance(g)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"getCurrentUnlockingThemeIndex",value:function(){var g=this.getCollectionUnlockProgress();if(0===g.length)return null;var E=0;return g.forEach(function(g,_){g.isLocked||(E=_)}),E}}]),e}();_._RF.pop(),_._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var lp=globalThis.game,lf=lp.match,ly=lp.player,lv=lp.leaderboard,lg=lp.frameCapture,lm=GameCore,lb=lm.Utils,lw=lb.Object,lS=lb.Valid,lE=lb.String,l_=lb.Array,lk=lm.Match.Modes,lC=lm.Dtos.Match.Data,lA=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],lT=function(){function e(){Fe(this,e)}var g,E,_,k,C,A,T,R,I,P,L,O,B,N,M,D,F,U,x;return Ue(e,[{key:"processStartSingleModeAsync",value:(x=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=ly.getPlayerId();return[4,lf.single.start.processAsync({playerId:g})];case 1:E.sent();return[2]}})}),function(){return x.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(U=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,lf.single.finish.processAsync()];case 1:g.sent();return[2]}})}),function(){return U.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(F=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=ly.getPlayerId(),E=GameSDK.context.getID();return[4,lf.tournament.continue.processAsync({playerId:g,contextId:E})];case 1:_.sent();return[2]}})}),function(){return F.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(D=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=ly.getPlayerId(),E=ly.getBestScore();return[4,lf.tournament.finish.processAsync({playerId:g,bestScore:E})];case 1:_.sent();return[2]}})}),function(){return D.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(M=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,7]);return[4,this.processContinueChallengeAsync()];case 1:k.sent();return[3,7];case 2:g=k.sent();if(!lw.hasOwn(g,"name")||lS.isString(g.name))throw g;E="PlayerHasFinishedMatch"===g.name;if(!E)return[3,4];return[4,this.processChallengeNewOpponentAsync()];case 3:E=k.sent();k.label=4;case 4:_="PlayerNotJoinInMatch"===g.name;if(!_)return[3,6];return[4,this.processJoinChallengeAsync()];case 5:_=k.sent();k.label=6;case 6:return[3,7];case 7:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(N=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:lg.addWideframeRender("renderResultChallenge",lg.wideframe.renderResultChallenge);return[4,lf.challenge.finish.processAsync(g)];case 1:E.sent();return[2]}})}),function(g){return N.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(B=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=this.getMatchState(),E=g.id,_=g.customData,k=_.playerId,C=_.opponentId;if(!lS.isString(E))throw new Error("Invalid match id");if(!lS.isString(k))throw new Error("Invalid player id");if(!lS.isString(C))throw new Error("Invalid opponent id");A=GameSDK.context.getID();if(!A)throw new Error("Cannot get contextId");return[4,lf.challenge.continue.processAsync({matchId:E,contextId:A,playerId:k,opponentId:C})];case 1:T.sent();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(O=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:g=ly.getConnectedPlayerIds(100,0),E=Math.floor(Math.random()*g.length),_=ly.getPlayerId(),k=g[E];return[4,lf.challenge.friend.processAsync({playerId:_,opponentId:k})];case 1:C.sent();return[2]}})}),function(){return O.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(L=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=this.getMatchState(),E=g.id,_=g.customData,k=_.playerId,C=_.opponentId;if(!lS.isString(E))throw new Error("Invalid match id");if(!lS.isString(k))throw new Error("Invalid player id");if(!lS.isString(C))throw new Error("Invalid opponent id");return[4,lf.challenge.join.processAsync({matchId:E,playerId:k,opponentId:C})];case 1:A.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"getMatchState",value:function(){var g=lf.getMatchState();if(!g)throw new Error("Match state not found");return g}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(P=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,10,,11]);E=null!=g?g:this.getMatchMode();switch(E){case lk.SINGLE:return[3,1];case lk.TOURNAMENT:return[3,3];case lk.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processStartSingleModeAsync()];case 2:k.sent();return[3,9];case 3:return[4,this.inst.processStartTournamentModeAsync()];case 4:k.sent();return[3,9];case 5:return[4,this.inst.processStartChallengeModeAsync()];case 6:k.sent();return[3,9];case 7:return[4,this.inst.processStartSingleModeAsync()];case 8:k.sent();k.label=9;case 9:return[3,11];case 10:_=k.sent();console.warn("startMatchAsync",_);return[3,11];case 11:return[2]}})}),function(g){return P.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(I=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lf.handler.setProfileData(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setProfileMatchDataAsync",E);return[3,3];case 3:return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(R=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lf.handler.setMatchCustomData(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setMatchCustomDataAsync",E);return[3,3];case 3:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lf.handler.setLeaderboardScore(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setLeaderboardScoreAsync",E);return[3,3];case 3:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"finishMatchAsync",value:(A=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,10,,11]);E=this.getMatchMode();switch(E){case lk.SINGLE:return[3,1];case lk.TOURNAMENT:return[3,3];case lk.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processFinishSingleModeAsync()];case 2:k.sent();return[3,9];case 3:return[4,this.inst.processFinishTournamentModeAsync()];case 4:k.sent();return[3,9];case 5:return[4,this.inst.processFinishChallengeModeAsync(g)];case 6:k.sent();return[3,9];case 7:return[4,this.inst.processFinishSingleModeAsync()];case 8:k.sent();k.label=9;case 9:return[3,11];case 10:_=k.sent();console.warn("finishMatchAsync",_);return[3,11];case 11:return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"joinTournamentAsync",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=ly.getPlayerId();return[4,lf.tournament.join.processAsync({tournamentId:g,playerId:E})];case 1:_.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"continueTournamentAsync",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=ly.getPlayerId();return[4,lf.tournament.continue.processAsync({playerId:E,contextId:g})];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"createTournamentName",value:function(){var g=lA[X.randomRangeInt(0,lA.length-1)],E="".concat(g," Tournament"),_=lE.removeDiacritics(E);return"".concat(_)}},{key:"getShortName",value:function(g,E){var _,k=arguments.length>1&&void 0!==E?E:50,C=g.split(" "),A=0,T="",R=at(C);try{for(R.s();!(_=R.n()).done;){var I=_.value;if(A+I.length+1>k)break;T+="".concat(I," "),A+=I.length+1}}catch(g){R.e(g)}finally{R.f()}return T.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var g,E,_,k=lE.generateObjectId(),C=ly.getPlayerId(),A=ly.getPlayer().name,T=ly.getGameData(),R=null!==(g=null==T?void 0:T.level)&&void 0!==g?g:1,I=lh.getLevelTheme(R),P=this.inst.getMatchState().profiles;return{score:null!==(E=null===(_=(void 0===P?{}:P)[C])||void 0===_?void 0:_.score)&&void 0!==E?E:0,playerId:C,mode:lk.TOURNAMENT,name:this.createTournamentName(),leaderboardId:k,payload:{playerId:C,playerName:A,leaderboardId:k,themeId:I}}}},{key:"getTournamentsAsync",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,GameSDK.tournament.getTournamentsAsync()];case 1:return[2,E.sent()];case 2:g=E.sent();return[2,(console.error(g),[])];case 3:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(E=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:return[4,this.getTournamentsAsync()];case 1:g=C.sent(),E=l_.search(g,function(g){var E,_=JSON.parse(null!==(E=g.getPayload())&&void 0!==E?E:"{}");return"DEFAULT"===g.getTournamentType()&&_.playerId===ly.getPlayerId()});if(E)throw new lt(ly.getPlayerId(),E.getID());_=this.createTournamentPayload();ly.setGameData({lastCreateTournamentShown:Date.now()});return[4,lf.tournament.create.processAsync(_)];case 2:C.sent();k=_.leaderboardId;lv.addLeaderboard({name:k,type:"tournament",autoSortRank:!0,leaderboardId:k});return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getMatchMode",value:function(){var g=this.inst.getMatchState();return lS.isString(g.mode)?g.mode:null}},{key:"getMatchCustomData",value:function(){var g=this.inst.getMatchState();return lS.isObject(g.customData)?g.customData:null}},{key:"getMatchExtraDataAsync",value:(g=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,lf.api.getMatchAPI().getMatchDetailByIdAsync(g)];case 1:E=_.sent();return[2,new lC(E).toObject().extraData]}})}),function(E){return g.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(g,E){this.setMatchCustomDataAsync({level:g,score:E});var _=ly.getPlayerId();this.setProfileMatchDataAsync({id:_,score:E})}}]),e}();_._RF.pop(),_._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);var lR,lI,lP,lL,lO,lB,lN,lM,lD,lF,lU,lx,lz=globalThis.game.event,lG=GameCore.Events,lV=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"switchScene",value:function(g,E){lz.emit(lG.SWITCH_SCENE,{sceneName:g,sceneData:E})}},{key:"preloadScene",value:function(g){lz.emit(lG.PRELOAD_SCENE,{sceneName:g})}},{key:"preloadDashboardScene",value:function(){this.preloadScene(s1)}},{key:"switchToDashboardScene",value:function(g){this.switchScene(s1,g)}},{key:"preloadGameScene",value:function(){this.preloadScene(s0)}},{key:"switchToGameScene",value:function(g){this.switchScene(s0,g)}},{key:"getSceneData",value:function(g){return"data"in g.scene&&g.scene.data||{}}}]),e}();_._RF.pop(),_._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);var lK,lH,lq,lW,lj,lX=k.ccclass,lY=k.property,lJ=["Watch an ad to revive yourself\nKeep playing and don't give up!","Watching an ad doubles your rewards!","Test your skills\nin ranked tournaments","Challenge your friend\nSee who can score higher!","Send a challenge to your friend\nClaim bragging rights!","Clear all tiles to\nwin the level!","Beat the clock before\ntime runs out!","Clear bombs before\nthey explode","A season pack unlock\nnew tile sets!","The more stars you collect\nThe more coins you'll be rewarded!","Compete globally or with friends\nRise to the top in tournaments!","You can challenge a friend\nTest each other's reflexes!","The Thunder power-up\nblasts tiles away","A Hint power-up reveals\nthe next pair","Pliers can remove\nany bomb instantly","The Tornado power-up\nshuffles the board!","Earn coins by completing levels\nWin tournaments for even more!","A new tile set is unlocked\nevery season packs","Log in daily to claim\nbetter rewards!","Level up and earn coins\nwith each victory!","Each season pack offers\nnew tiles!"],lQ=(lR=lX("LoadingFullScreen"),lI=nA.required(),lP=lY(ew),lL=nA.required(),lO=nA.getComponent(eu),lB=nA.required(),lN=lY(P),lR((lF=st((lD=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"progressBar",lF,Ke(g)),rt(g,"uiOpacity",lU,Ke(g)),rt(g,"loadingLabel",lx,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){nA.decorateComponent(this)}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0,this.progressBar.progress=0}},{key:"show",value:(_=Be(function(g){var E,_;return _ts_generator(this,function(g){switch(g.label){case 0:this.uiOpacity.opacity=0,this.progressBar.progress=0;E=z(this.uiOpacity).to(.5,{opacity:255},{easing:"cubicOut"}),_=z(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"});this.runLoadingTextAnimation(),t$.runTweenAsync(E);return[4,t$.runTweenAsync(_)];case 1:g.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(g){switch(g.label){case 0:if(!(this.uiOpacity&&this.progressBar))return[3,3];this.uiOpacity.opacity=255,this.progressBar.progress=.9;E=z(this.uiOpacity).to(.5,{opacity:0},{easing:"cubicIn"}),_=z(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"});this.runLoadingTextAnimation();return[4,t$.runTweenAsync(_)];case 1:g.sent(),this.stopLoadingTextAnimation();return[4,t$.runTweenAsync(E)];case 2:g.sent(),this.node.active=!1;g.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"runLoadingTextAnimation",value:function(){var g=this;this.updateHintText(),this.schedule(function(){return g.updateHintText()},5)}},{key:"updateHintText",value:function(){this.loadingLabel.string=this.getHintText()}},{key:"stopLoadingTextAnimation",value:function(){this.unscheduleAllCallbacks()}},{key:"getHintText",value:function(){return lJ[Math.floor(Math.random()*lJ.length)]}}]),a}(M)).prototype,"progressBar",[lI,lP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lU=st(lD.prototype,"uiOpacity",[lL,lO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lx=st(lD.prototype,"loadingLabel",[lB,lN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lM=lD))||lM);_._RF.pop(),_._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);var lZ=k.ccclass,l$=k.property,l0=(lK=lZ("Loading"),lH=l$(ee),lK((lj=st((lW=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"loadingPrefab",lj,Ke(g)),g.loadingNode=null,g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"createLoadingFullScreen",value:function(){var g,E=$("Canvas");if(E&&!E.getChildByName("Loading")){this.loadingNode||(this.loadingNode=I(this.loadingPrefab));var _=I._clone(this.loadingNode);this.loadingFullScreen=_.getComponent(lQ),this.node.active=!1,null===(g=$("Canvas"))||void 0===g||g.addChild(_)}}},{key:"show",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:this.createLoadingFullScreen();E=this.node.active;if(E)return[3,2];this.node.active=!0;return[4,this.loadingFullScreen.show(g)];case 1:E=_.sent();_.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=null!==(E=this.node)&&void 0!==E&&E.active&&this.loadingFullScreen;if(!_)return[3,2];return[4,this.loadingFullScreen.hide(g)];case 1:_=(k.sent(),this.node.active=!1);k.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),a}(M)).prototype,"loadingPrefab",[lH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lq=lW))||lq);_._RF.pop(),_._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);var l1=globalThis.game.event,l2=GameCore,l4=l2.Events,l3=l2.Utils.Array,l5=function(){function e(){Fe(this,e),this.showedScreens=[]}var g,E;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"openScreen",value:function(g,E){var _=iS[g];l1.emit(l4.OPEN_SCREEN,{screenName:_,screenData:E})}},{key:"closeScreen",value:function(g){var E=iS[g];l1.emit(l4.CLOSE_SCREEN,{screenName:E})}},{key:"openScreenAndWaitForClose",value:function(g,E){var _=this;return new Promise(function(k){_.openScreen(g,E);l1.on(l4.CLOSE_SCREEN,function t(E){E.screenName===iS[g]&&(l1.off(l4.CLOSE_SCREEN,t),k(E))})})}},{key:"showLoadingScreen",value:function(g){this.openScreen(iw.LOADING_SCREEN,{duration:g})}},{key:"closeLoadingScreen",value:function(){this.closeScreen(iw.LOADING_SCREEN)}},{key:"showNotificationScreen",value:function(g,E){this.openScreen(iw.NOTIFICATION_SCREEN,{message:g,duration:E})}},{key:"closeNotificationScreen",value:function(){this.closeScreen(iw.NOTIFICATION_SCREEN)}},{key:"addShowedScene",value:function(g){l3.has(this.inst.showedScreens,g)||this.inst.showedScreens.push(g)}},{key:"showLoadingFullScreen",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!!l3.has(this.inst.showedScreens,g))return[3,3];this.addShowedScene(g);_=$("Loading");k=_;if(!k)return[3,2];_.active=!0;return[4,null===(E=_.getComponent(l0))||void 0===E?void 0:E.show(g)];case 1:k=C.sent();C.label=2;case 2:C.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"hideLoadingFullScreen",value:(g=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=l3.has(this.inst.showedScreens,g);if(_)return[3,2];return[4,null===(E=$("Loading"))||void 0===E||null===(E=E.getComponent(l0))||void 0===E?void 0:E.hide(g)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"showLoadingNotificationScreen",value:function(){this.openScreen(iw.NOTIFICATION_SCREEN,{message:"Loading",enableCloseOnTouch:!1})}},{key:"showTournamentDetailScreen",value:function(g,E,_){var k=!(arguments.length>2&&void 0!==_)||_;this.openScreen(iw.TOURNAMENT_DETAIL_SCREEN,{playAnimation:k,tournament:g,tournamentContextType:E})}},{key:"closeTournamentDetailScreen",value:function(){this.closeScreen(iw.TOURNAMENT_DETAIL_SCREEN)}}]),e}();_._RF.pop(),_._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);var l6=GameCore,l8=l6.Utils,l9=l8.String,l7=l8.Valid,ue=l8.Array,ut=l6.Configs.Mockup.Leaderboards,un=globalThis.game,ui=un.leaderboard,ur=un.player,ua=function(){function e(){var g=this;Fe(this,e),this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,3,,4]);E=Date.now()-g.lastFetchGlobalTournament>g.maxTimeRefetch;if(!E)return[3,2];return[4,ui.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"})];case 1:E=(g.globalTournamentLBData=k.sent(),g.globalTournamentLBData.sort(function(g,E){return g.expireTime-E.expireTime}));k.label=2;case 2:return[3,4];case 3:_=k.sent();console.warn("fetchGlobalTournamentLeaderboardAsync",_);return[3,4];case 4:return[2,g.globalTournamentLBData]}})}),this.fetchTournamentsAsync=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,3,,4]);E=Date.now()-g.lastFetchTournamentsData>g.maxTimeRefetch;if(!E)return[3,2];return[4,GameSDK.tournament.getTournamentsAsync()];case 1:E=(g.playerTournaments=k.sent(),g.playerTournaments.sort(function(g,E){return g.getEndTime()-E.getEndTime()}));k.label=2;case 2:return[3,4];case 3:_=k.sent();console.warn("fetchTournamentsAsync",_);return[3,4];case 4:return[2,g.playerTournaments]}})})}var g;return Ue(e,[{key:"processPlayerTournamentData",value:function(){var g,E=[],_=at(this.playerTournaments);try{for(_.s();!(g=_.n()).done;){var k,C,A=g.value,T="".concat(A.getID()),R=A.getContextID(),I=A.getEndTime(),P=this.parseTournamentPayload(A.getPayload());if(this.validateGameSDKTournamentPayload(P)){if(!(I<Date.now()/1e3)&&"PAGE_HOSTED"!==A.getTournamentType()){var L=null!==(k=P.playerName)&&void 0!==k?k:"Player",O={id:T,title:null!==(C=A.getTitle())&&void 0!==C?C:this.createDefaultTournamentName(L),endTime:I,contextId:R,payload:P};E.push(O)}}}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"processGlobalTournamentLeaderboardData",value:function(){var g=[];if(ut.Enabled){for(var E=0;E<this.playerTournaments.length;E++){var _,k=this.playerTournaments[E],C=k.getTournamentType();if("PAGE_HOSTED"===C){var A="".concat(k.getID()),T=k.getContextID(),R=k.getEndTime(),I=this.parseTournamentPayload(k.getPayload()),P={id:A,title:null!==(_=k.getTitle())&&void 0!==_?_:"Global Tournament",endTime:R,contextId:T,payload:I,tournamentType:C};g.push(P)}}return g}for(var L=0;L<this.globalTournamentLBData.length;L++){var O,B={tournamentId:"",contextId:""},N=this.globalTournamentLBData[L];try{B=JSON.parse(N.description)}catch(g){continue}if(this.validateExpireTime(N)&&this.validateGlobalTournamentPayload(B)){var M={id:B.tournamentId,title:N.name,endTime:this.getTournamentEndTime(N),contextId:B.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:N._id,themeId:null!==(O=B.themeId)&&void 0!==O?O:la.SUMMER}};g.push(M)}}return g}},{key:"validateGlobalTournamentPayload",value:function(g){var E=g.tournamentId,_=g.contextId;return!(!l7.isString(E)||""===E)&&!(!l7.isString(_)||""===_)}},{key:"getTournamentEndTime",value:function(g){var E=new Date(g.createdAt).getTime();return Math.round((1e3*g.expireTime+E)/1e3)}},{key:"validateExpireTime",value:function(g){return 1e3*this.getTournamentEndTime(g)-Date.now()>0}},{key:"validateGameSDKTournamentPayload",value:function(g){return!(!l7.isString(g.playerId)||""===g.playerId)&&!(!l7.isString(g.playerName)||""===g.playerName)&&!(!l7.isString(g.leaderboardId)||""===g.leaderboardId)}},{key:"createDefaultTournamentName",value:function(g){var E=g.substring(0,7),_="".concat(E.split(" ")[0]||E,"'s Tournament"),k=l9.removeDiacritics(_);return"".concat(k)}},{key:"parseTournamentPayload",value:function(g){if("string"!=typeof g)return{};try{return JSON.parse(g)}catch(g){return{}}}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"requestTournamentDataAsync",value:(g=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=e.getInstance();return[4,Promise.all([g.fetchTournamentsAsync(),g.fetchGlobalTournamentLeaderboardAsync()])];case 1:T.sent();E=g.processPlayerTournamentData(),_=g.processGlobalTournamentLeaderboardData();E.sort(function(g,E){return g.endTime-E.endTime}),_.sort(function(g,E){return g.endTime-E.endTime}),g.tournamentData=[].concat(tt(_),tt(E));C=at(g.tournamentData);try{for(C.s();!(k=C.n()).done;){A=k.value.payload.leaderboardId;A&&(ui.isExistLeaderboardId(A)||ui.addLeaderboard({type:"tournament",name:A,autoSortRank:!0,leaderboardId:A}))}}catch(g){C.e(g)}finally{C.f()}return[2,g.tournamentData]}})}),function(){return g.apply(this,arguments)})},{key:"getAllTournamentData",value:function(){return e.getInstance().tournamentData}},{key:"getTournamentDataById",value:function(g){var E=e.getInstance();return ue.search(E.tournamentData,function(E){return E.id===g})}},{key:"getPlayerTournamentData",value:function(){var g=e.getInstance(),E=ur.getPlayerId();return g.tournamentData.filter(function(g){return g.payload.playerId===E})}},{key:"getFriendsTournamentData",value:function(){var g=e.getInstance(),E=ur.getPlayerId();return g.tournamentData.filter(function(g){var _=g.payload;return _.playerId!==E&&"global"!==_.playerId})}},{key:"getGlobalTournamentData",value:function(){return e.getInstance().tournamentData.filter(function(g){return"global"===g.payload.playerId})}},{key:"validateTournamentExpired",value:function(g){var E=e.getTournamentDataById(g);return!!E&&E.endTime<Date.now()/1e3}}]),e}();_._RF.pop(),_._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var uo,us="time",ul="bomb";_._RF.pop(),_._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var uu=(0,k.ccclass)("InputController")(uo=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleElementPointerDown=function(){},g.handleElementPointerUp=function(g){},g}return Ue(n,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){ev.os!==ev.OS.WINDOWS&&ev.os!==ev.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){ev.os!==ev.OS.WINDOWS&&ev.os!==ev.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(M))||uo;_._RF.pop(),_._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var uc={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};_._RF.pop(),_._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var uh="fall-down",up="fly-up",uf="push-left",uy="push-right",uv="put-column-middle",ug="put-row-middle";function Jc(g){for(var E=g.array,_=g.isLighter,k=g.out,C=void 0===k?new Set:k,A=0;A<E.length;A++)if(_(E.get(A))){for(var T=A+1;T<E.length;T++)if(!_(E.get(T))){E.swap(A,T),C.add(E.get(A));break}}return C}_._RF.pop(),_._RF.push({},"bfb989Gr/dArq4M9uSSrF5/","stagger",void 0),_._RF.pop(),_._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var um=function(){function e(g){var E;Fe(this,e),this.array=[];var _=null!=g?g:{},k=_.width,C=void 0===k?1:k,A=_.height,T=void 0===A?1:A,R=_instanceof(g,e)?g.array:null!==(E=null==g?void 0:g.content)&&void 0!==E?E:[];if(R.length!==C*T)throw new Error("Invalid content length");this.width=C,this.height=T,this.array=tt(R)}return Ue(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(g,E){return this.array[E*this.width+g]}},{key:"set",value:function(g,E,_){this.array[E*this.width+g]=_}},{key:"isInBounds",value:function(g,E){return g>=0&&g<this.width&&E>=0&&E<this.height}},{key:"forEach",value:function(g){for(var E=0;E<this.height;E++)for(var _=0;_<this.width;_++)g(this.get(_,E),_,E)}},{key:"map",value:function(g){for(var E=[],_=0;_<this.height;_++)for(var k=0;k<this.width;k++)E.push(g(this.get(k,_),k,_));return E}},{key:"reduce",value:function(g,E){for(var _=E,k=0;k<this.height;k++)for(var C=0;C<this.width;C++)_=g(_,this.get(C,k),C,k);return _}},{key:"swap",value:function(g,E){var _=et(g,2),k=_[0],C=_[1],A=et(E,2),T=A[0],R=A[1],I=this.get(k,C);this.set(k,C,this.get(T,R)),this.set(T,R,I)}},{key:"shuffle",value:function(g){for(var E=null!=g?g:this.map(function(g,E,_){return[E,_]}),_=tt(E),k=new Set,C=_.length-1;C>0;C--){var A=eC(0,C+1),T=[_[A],_[C]];_[C]=T[0],_[A]=T[1],k.add(this.get(_[C][0],_[C][1])),k.add(this.get(_[A][0],_[A][1]))}for(var R=0;R<_.length;R++){var I=et(E[R],2),P=I[0],L=I[1],O=et(_[R],2),B=O[0],N=O[1];this.swap([P,L],[B,N])}return k}},{key:"toShuffled",value:function(g){var E=new e({width:this.width,height:this.height,content:this.array}),_=E.shuffle(g);return[E,_]}},{key:"gravitate",value:function(g){var E=this,_=et(g.rowRange,2),k=_[0],C=_[1],A=et(g.colRange,2),T=A[0],R=A[1],I=g.direction,P=g.isLighter,L=g.onSwap,O=g.out,B=void 0===O?new Set:O,N=R-T+1,M=C-k+1;switch(I){case uc.Up:for(var f=function(g){Jc({array:{length:M,get:function(_){return E.get(g,C-_)},swap:function(_,k){var A=E.get(g,C-_),T=E.get(g,C-k);E.swap([g,C-_],[g,C-k]),null==L||L(A,T)}},isLighter:P,out:B})},D=T;D<=R;D++)f(D);return B;case uc.Down:for(var m=function(g){Jc({array:{length:M,get:function(_){return E.get(g,k+_)},swap:function(_,C){var A=E.get(g,k+_),T=E.get(g,k+C);E.swap([g,k+_],[g,k+C]),null==L||L(A,T)}},isLighter:P,out:B})},F=T;F<=R;F++)m(F);return B;case uc.Left:for(var b=function(g){Jc({array:{length:N,get:function(_){return E.get(T+_,g)},swap:function(_,k){var C=E.get(T+_,g),A=E.get(T+k,g);E.swap([T+_,g],[T+k,g]),null==L||L(C,A)}},isLighter:P,out:B})},U=k;U<=C;U++)b(U);return B;case uc.Right:for(var w=function(g){Jc({array:{length:N,get:function(_){return E.get(R-_,g)},swap:function(_,k){var C=E.get(R-_,g),A=E.get(R-k,g);E.swap([R-_,g],[R-k,g]),null==L||L(C,A)}},isLighter:P,out:B})},x=k;x<=C;x++)w(x);return B;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var g=new e({width:this.width,height:this.height,content:this.array}),E=g.gravitate.apply(g,arguments);return[g,E]}},{key:"toRotated",value:function(){for(var g=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),E=0;E<this.height;E++)for(var _=0;_<this.width;_++)g.set(this.height-1-E,_,this.get(_,E));return g}}]),e}();_._RF.pop(),_._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),_._RF.pop(),_._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);var ub,uw,uS,uE,u_,uk,uC,uA,uT,uR,uI,uP,uL,uO,uB,uN,uM,uD,uF,uU,ux,uz,uG,uV,uK,uH,uq,uW,uj,uX={bomb:"bomb",star:"star",none:"none"};_._RF.pop(),_._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var uY=k.ccclass,uJ=k.property,uQ=k.requireComponent,uZ=(ub=uY("Tile"),uw=uQ([R]),uS=uQ([eu]),uE=uJ(eo),u_=uJ(eo),uk=uJ(eo),uC=uJ(eo),uA=uJ({type:R,displayName:"Background's UI Transform"}),uT=uJ(ea),uR=uJ({type:eu,displayName:"This UI Opacity"}),uI=uJ(eu),uP=uJ(eu),uL=uJ(eu),uO=uJ(rc),uB=uJ(G),ub(uN=uw(uN=uS((uD=st((uM=function(g){ze(h,g);var E,_,k,C,A,T,R,I,P,L=Xe(h);function h(){var g;Fe(this,h);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=L.call.apply(L,[this].concat(_)),"icon",uD,Ke(g)),rt(g,"bombComponent",uF,Ke(g)),rt(g,"starComponent",uU,Ke(g)),rt(g,"background",ux,Ke(g)),rt(g,"bgUITransform",uz,Ke(g)),rt(g,"defaultBackground",uG,Ke(g)),rt(g,"uiOpacity",uV,Ke(g)),rt(g,"shineOpacity",uK,Ke(g)),rt(g,"glowOpacity",uH,Ke(g)),rt(g,"iconOpacity",uq,Ke(g)),rt(g,"button",uW,Ke(g)),rt(g,"animationComponent",uj,Ke(g)),g.id=null,g.isEmpty=!1,g.coord=new eS,g.signal=new nD,g}return Ue(h,[{key:"onLoad",value:function(){nA.lazyValidateProperties(this),this.special=this.createSpecialHandler(uX.none)}},{key:"update",value:function(g){var E;(null===(E=this.special)||void 0===E?void 0:E.type)===uX.bomb&&this.special.update(g)}},{key:"onDestroy",value:function(){var g,E;(null===(g=this.special)||void 0===g?void 0:g.type)===uX.bomb&&(null===(E=this.special)||void 0===E||E.onDestroy())}},{key:"setIgnoreInput",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.button.interactable=!E}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(g,E){this.coord.set(g,E)}},{key:"isSimilarTo",value:function(g){return this.id===g.id}},{key:"inSamePositionAs",value:function(g,E){return _instanceof(g,h)?this.coord.equals(g.getCoord()):this.coord.x===g&&this.coord.y===E}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(r4.TILE_CLICK,this)}},{key:"setIdentity",value:function(g){this.id=g,this.icon.spriteFrame=g;var E=et(this.getSize(),2),_=E[0],k=E[1],C=g.originalSize,A=C.width,T=C.height,R=Math.max(A/(.7*_),T/(.7*k));R>1&&this.icon.node.setScale(new em(1/R,1/R,1))}},{key:"setSpecialType",value:function(g,E){var _,k=arguments.length>0&&void 0!==g?g:uX.none,C=arguments.length>1?E:void 0;null===(_=this.special)||void 0===_||_.switch(k,C)}},{key:"setFocused",value:(P=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=z(this.shineOpacity).to(.15,{opacity:g?255:0},{easing:"cubicOut"});this.shineOpacity.node.scale=g?em.ZERO:em.ONE;_=z(this.shineOpacity.node).to(.15,{scale:g?em.ONE:em.ZERO},{easing:"cubicOut"});if(g){k=z(this.glowOpacity).to(2,{opacity:150});k.to(2,{opacity:20}),this.glowOpacityTween=z(this.glowOpacity).repeatForever(k).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;return[4,Promise.all([t$.runTweenAsync(E),t$.runTweenAsync(_)])];case 1:C.sent();return[2]}})}),function(g){return P.apply(this,arguments)})},{key:"setEmpty",value:function(g){var E,_,k,C=arguments.length>0&&void 0!==g&&g;if(!this.isEmpty){var A;if(this.signal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),C)return this.uiOpacity.opacity=0,void(null===(A=this.special)||void 0===A||A.switch(uX.none));(null===(E=this.special)||void 0===E?void 0:E.type)!==uX.star&&(null===(_=this.special)||void 0===_?void 0:_.type)!==uX.bomb||this.special.clear(),null===(k=this.special)||void 0===k||k.switch(uX.none),this.uiOpacity.opacity=0}}},{key:"setHint",value:(I=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!g)return[3,2];return[4,this.loadShakeClip()];case 1:k.sent(),this.shakeClip&&t$.runAnimationAsync(this.animationComponent,this.shakeClip.name,this.signal);return[3,4];case 2:if(null===(E=this.animationComponent)||void 0===E||E.stop(),!this.background)return[2];_=z(this.background.node).to(.1,{scale:em.ONE,eulerAngles:em.ZERO});return[4,t$.runTweenAsync(_,this.signal)];case 3:k.sent();k.label=4;case 4:return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"playClearFX",value:(R=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:this.signal.abort();E=new nD;this.signal=E;_=null;if("clear"!==g)return[3,2];return[4,this.loadClearClip()];case 1:C.sent(),_=this.clearClip;return[3,4];case 2:return[4,this.loadBreakClip()];case 3:C.sent(),_=this.breakClip;C.label=4;case 4:k=null===_||E.aborted;if(k)return[3,6];return[4,t$.runAnimationAsync(this.animationComponent,_.name,E)];case 5:k=C.sent();C.label=6;case 6:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"restore",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:this.signal.abort();E=new nD;this.signal=E,this.animationComponent.stop(),this.isEmpty=!1,this.setIgnoreInput(!0),g&&this.setIdentity(g),this.uiOpacity.opacity=255,this.iconOpacity.opacity=255,this.node.setScale(em.ZERO),this.background.spriteFrame=this.defaultBackground,this.button.fakeClick();return[4,t$.runTweenAsync(z(this.node).to(.3,{scale:em.ONE},{easing:"backOut"}),E)];case 1:_.sent(),this.node.setScale(em.ONE),this.setIgnoreInput(!1);return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"sync",value:(A=Be(function(g){var E,_,k,C,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:E=g.duration,_=void 0===E?.3:E,k=g.delay,C=void 0===k?0:k,A=g.easing,T=void 0===A?"cubicOut":A,R=(0,g.getTargetPosition)(this.coord),I=new em(R.x,R.y,this.node.position.z);return[4,t$.runTweenAsync(z(this.node).delay(C).to(_,{position:I},{easing:T}))];case 1:P.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"fly",value:(C=Be(function(g){var E,_,k,C,A,T,R,I,P,L,O,B,N,M,D,F,U,x;return _ts_generator(this,function(G){E=this,_=300,k=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),C=Math.max(_-.7*k,0),A=k/1e3,T=this.node.position.clone(),R=g.getTilePosition(this.coord),I=new em(R.x,R.y,this.node.position.z),P=this.background.node,L=2,O=1,B=360,N=.0025*C,M=0,D=new em(0,0,0),F=.75-N,U={value:0,prevElapsed:0},x=z(U);return[2,(x.delay(A),x.to(.5,{value:0},{progress:function(g,_,k,C){var A=(L*=-1)*C,R=T.clone();return R.x+=A,E.node.setPosition(R),k}}),x.to(N,{value:1},{progress:function(g,k,A,T){var R=t$.easeOutExpo(T),I=N*T-U.prevElapsed,L=N*T,M=C*R;E.setHeight(M,_);var D=E.node.position.clone();O+=.1,em.rotateZ(D,D,new em(0,0,0),O*Math.PI*I),E.node.setPosition(new em(D.x,D.y,D.z));var F=(B+=10)*I;return P.angle+=F,U.prevElapsed=L,A}}),x.call(function(){D.set((E.node.position.x+I.x)/2,(E.node.position.y+I.y)/2,0),U.prevElapsed=0,P.angle%=360,P.angle-=360,M=P.angle}),x.to(F,{value:0},{progress:function(g,k,A,T){var R=F*T-U.prevElapsed,I=F*T,L=C*(1-T);E.setHeight(L,_);var O=E.node.position.clone();return em.rotateZ(O,O,D,Math.PI/F*R),E.node.setPosition(new em(O.x,O.y,O.z)),P.angle+=-M/F*R,U.prevElapsed=I,A}}),x.call(function(){E.node.setPosition(I),E.setHeight(0,_),P.angle=0}),t$.runTweenAsync(x))]})}),function(g){return C.apply(this,arguments)})},{key:"loadBreakClip",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.breakClip)return[3,2];return[4,ii.loadAnimClipAsync(nF.TILE_BREAK_ANIM)];case 1:g=E.sent();g&&this.animationComponent&&(this.breakClip=g,this.animationComponent.addClip(this.breakClip));E.label=2;case 2:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadClearClip",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.clearClip)return[3,2];return[4,ii.loadAnimClipAsync(nF.TILE_CLEAR_ANIM)];case 1:g=E.sent();g&&this.animationComponent&&(this.clearClip=g,this.animationComponent.addClip(this.clearClip));E.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"loadShakeClip",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.shakeClip)return[2,Promise.resolve()];return[4,ii.loadAnimClipAsync(nF.TILE_SHAKE_ANIM)];case 1:g=E.sent();if(!g||!this.animationComponent)return[2,Promise.resolve()];this.shakeClip=g,this.animationComponent.addClip(this.shakeClip);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setHeight",value:function(g,E){if(this.background){var _=this.background.node;_.setPosition(new em(_.position.x,g,0)),_.setScale(new em(1+g/E*.3,1+g/E*.3,1))}}},{key:"createSpecialHandler",value:function(g,E){var _=this;switch(g){case uX.bomb:return this.createBombHandler(null!=E?E:90);case uX.star:return this.createStarHandler();default:return{type:uX.none,switch:function(g,E){_.special=_.createSpecialHandler(g,E)}}}}},{key:"createBombHandler",value:function(g){var E=this,_=!1,k=g,a=function(){_=!0},o=function(){_=!1};this.node.scene.on(r4.TILE_CLICK,a),this.node.scene.on(r4.USE_ITEM,a),this.node.scene.on(r4.RESUME_TIME,a),this.node.scene.on(r4.PAUSE_TIME,o),this.node.scene.on(r4.TIME_OUT,o),this.bombComponent.node.active=!0;var r=function(){_=!1,E.bombComponent.node.active=!1,k=g,E.node.scene.off(r4.TILE_CLICK,a),E.node.scene.off(r4.USE_ITEM,a),E.node.scene.off(r4.GAME_RESUME,a),E.node.scene.off(r4.GAME_PAUSE,o),E.node.scene.off(r4.TIME_OUT,o)};return{type:uX.bomb,update:function(C){_&&(k-=C,E.bombComponent.fillRange=-k/g,k<=0&&(_=!1,E.bombComponent.node.active=!1,E.setEmpty(!0),E.node.scene.emit(r4.BOMB_EXPLODE,E)))},clear:function(){i9.playSound(ip.BOMB_DEFUSE)},cleanup:r,onDestroy:function(){E.node.scene.off(r4.TILE_CLICK,a),E.node.scene.off(r4.USE_ITEM,a),E.node.scene.off(r4.GAME_RESUME,a),E.node.scene.off(r4.GAME_PAUSE,o),E.node.scene.off(r4.TIME_OUT,o)},switch:function(g,_){r(),E.special=E.createSpecialHandler(g,_)},detonateImmediately:function(){k=0}}}},{key:"createStarHandler",value:function(){var g=this;this.starComponent.node.active=!0;var t=function(){g.starComponent.node.active=!1};return{type:uX.star,clear:function(){g.starComponent.node.active=!1,i9.playSound(ip.COLLECT_STARS);var E=g.node.worldPosition,_=E.x,k=E.y;g.node.scene.emit(r4.ADD_STARS,{startAnimationAt:[_,k]})},cleanup:t,switch:function(E){t(),g.special=g.createSpecialHandler(E)}}}}]),h}(M)).prototype,"icon",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uF=st(uM.prototype,"bombComponent",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uU=st(uM.prototype,"starComponent",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ux=st(uM.prototype,"background",[uC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uz=st(uM.prototype,"bgUITransform",[uA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uG=st(uM.prototype,"defaultBackground",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uV=st(uM.prototype,"uiOpacity",[uR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uK=st(uM.prototype,"shineOpacity",[uI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uH=st(uM.prototype,"glowOpacity",[uP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uq=st(uM.prototype,"iconOpacity",[uL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uW=st(uM.prototype,"button",[uO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uj=st(uM.prototype,"animationComponent",[uB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uN=uM))||uN)||uN)||uN);function Nh(g,E,_,k){var C=arguments.length>3&&void 0!==k?k:0,A=_.x,T=_.y,R=et(E,2),I=R[0],P=R[1],L=I*(A-(g.width-1)/2)+C*(A-g.width/2),O=P*(T-(g.height-1)/2)+C*(T-g.height/2);return -1===A&&(L+=E[0]/4),A===g.width&&(L-=E[0]/4),-1===T&&(O+=E[1]/4),T===g.height&&(O-=E[1]/4),{x:L,y:O}}function Mh(g,E){var _=arguments.length>1&&void 0!==E?E:[0,0],k=et(g,2),C=k[0],A=k[1],T=et(_,2),R=T[0],I=T[1],P=1-R,L=1-I,O=C*P,B=A*L;return[O,B]}function Dh(g,E){for(var _=arguments.length>1&&void 0!==E&&E,k=g.split("-"),C=[],A=0;A<k.length;){var T=null,R=k[A];switch(R){case"normal":A+=1;break;case"fall":T=uh,A+=2;break;case"fly":T=up,A+=2;break;case"push":"left"===k[A+1]?(T=uf,A+=2):(T=uy,A+=2);break;case"put":"columns"===k[A+1]?(T=uv,A+=3):(T=ug,A+=3)}T&&(_&&(T=Bh(T)),C.push(T))}return C}function Bh(g){switch(g){case uh:return uy;case up:return uf;case uf:return uh;case uy:return up;case uv:return ug;case ug:return uv}}function Fh(g){return(_instanceof(g,um)?g.asArray():g).filter(function(g){return!g.isHidden()})}function xh(g){return(_instanceof(g,um)?g.asArray():g).filter(function(g){return g.isHidden()})}_._RF.pop(),_._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),_._RF.pop(),_._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),_._RF.pop(),_._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),_._RF.pop(),_._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),_._RF.pop(),_._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),_._RF.pop(),_._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),_._RF.pop(),_._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),_._RF.pop(),_._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),_._RF.pop(),_._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);var u$=GameCore.Utils.Object;function Gh(g,E){var _=E.getCoord(),k=_.x,C=_.y;return u$.vals(uc).reduce(function(E,_){var A=_.x,T=_.y,R=k+A,I=C+T;return g.isInBounds(R,I)&&E.push(g.get(R,I)),E},[])}function zh(g){return Array.isArray(g)}function Vh(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=zh(g)?g:g.asArray();return k[eA(_,0,k.length)]}_._RF.pop(),_._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),_._RF.pop(),_._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);var u0=GameCore.Utils.Array;function qh(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=_instanceof(g,um)?g.asArray():g,C=Vh(k,_),A=u0.search(k,function(g){return g.isSimilarTo(C)&&!g.inSamePositionAs(C)});if(void 0===A)throw new Error("Could not find a matching tile");return[C,A]}_._RF.pop(),_._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var Wh=function(g){return g};function jh(g,E,_){var k=arguments.length>2&&void 0!==_?_:Wh;return function(){var _,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=g,C=E;_<=0&&(_=Number.POSITIVE_INFINITY);A=0;T.label=1;case 1:if(!(A<_))return[3,4];return[4,k(C)];case 2:T.sent(),C=1e9*eT(C);T.label=3;case 3:A++;return[3,1];case 4:return[2]}})}()}function Kh(g){return Array.isArray(g)}function Yh(g,E,_){var k=arguments.length>2&&void 0!==_?_:Date.now(),C=Kh(g)?g:g.asArray();if(C.length<E)return new Set(C);for(var A=new Set,T=jh(-1,k),R=T.next();A.size<E;){if(R.done)throw new Error("RNG exhausted");A.add(Vh(C,R.value)),R=T.next()}return A}_._RF.pop(),_._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),_._RF.pop(),_._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),_._RF.pop(),_._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var u1=[1,4];function Qh(g,E,_){var k,C=arguments.length>2&&void 0!==_?_:Date.now(),A=E.specials,T=A.bomb,R=eA.apply(void 0,[C].concat(u1)),I=Yh(g,T,C),P=g.asArray().filter(function(g){return!I.has(g)}),L=Yh(P,R,C),O=at(I);try{for(O.s();!(k=O.n()).done;){var B=k.value,N=2*E.time/3;B.setSpecialType(uX.bomb,N)}}catch(g){O.e(g)}finally{O.f()}var M,D=at(L);try{for(D.s();!(M=D.n()).done;){var F=M.value;F.setSpecialType(uX.star)}}catch(g){D.e(g)}finally{D.f()}}_._RF.pop(),_._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),_._RF.pop(),_._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);var u2=GameCore.Utils.Array;function Zh(g){var E=g.levelData,_=E.columns,k=E.rows,C=g.identities,A=g.createTile,T=g.seed,R=(function(g,E,_){var k,C=[],A=at(jh(E/2,g,function(g){return eA(g,0,_.length)}));try{for(A.s();!(k=A.n()).done;){var T=k.value;C.push(_[T]),C.push(_[T])}}catch(g){A.e(g)}finally{A.f()}return u2.shuffle(C),C})(void 0===T?Date.now():T,_*k,C).map(function(g){var E=A(g);return E.setIdentity(g),E});return new um({width:_,height:k,content:R})}_._RF.pop(),_._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);var u4=GameCore.Utils.Array;function ed(g){var E=g.customFen,_=g.identities,k=g.createTile,C=E.idSize,A=E.cols,T=E.rows,R=E.code;if(_.length<E.idSize)throw new Error("Invalid grid code. There are not enough identities/frames ".concat(_.length," to fill it according to fen code ").concat(C));var I=R.split(":");if(I.length!==T)throw new Error("Invalid grid code");var P=/[a-zA-Z]+\d+|./g,L=/[a-zA-Z]+/,O=/\d+/,B=I.reduceRight(function(g,C){var A,T=[],R=at(C.matchAll(P));try{for(R.s();!(A=R.n()).done;){var I,B,N=A.value[0],M=null===(I=O.exec(N))||void 0===I?void 0:I[0],D=void 0!==M?Number.parseInt(M,10):void 0,F=void 0!==D&&!Number.isNaN(D)&&D<_.length?_[D]:void 0,U=k(void 0!==F?F:_[0]),x=null===(B=L.exec(N))||void 0===B?void 0:B[0],z=void 0!==x?td(x,E.encoding):void 0;z&&F?U.setSpecialType(z):U.setEmpty(),T.push(U)}}catch(g){R.e(g)}finally{R.f()}return g.concat(T)},[]);return new um({width:A,height:T,content:B})}function td(g,E){var _=u4.search(Object.entries(E),function(E){var _=et(E,2);_[0];return _[1]===g});if(void 0===_)throw new Error("Invalid special type ".concat(g));return _[0]}_._RF.pop(),_._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),_._RF.pop(),_._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);var u3=GameCore.Utils.Array;function id(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=g.asArray(),C=Vh(g,_),A=Gh(g,C);if(!A.some(function(g){return g.isSimilarTo(C)})){var T=Vh(A,_),R=u3.search(k,function(g){return!g.inSamePositionAs(C)&&!g.inSamePositionAs(T)&&g.isSimilarTo(T)});R.setIdentity(C.id),T.setIdentity(C.id)}}_._RF.pop(),_._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),_._RF.pop(),_._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var u5=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];_._RF.pop(),_._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var u6=GameCore.Utils.Array;function rd(g,E){return g[0]===E[0]&&g[1]===E[1]}function sd(g){return new eS(g[0],g[1])}function ld(g,E){return g.x>=-1&&g.x<E.width+1&&g.y>=-1&&g.y<E.height+1}function ud(g,E){var _=arguments.length>1&&void 0!==E?E:u9;return _.map(function(E){return[g.tile[0]+E.x,g.tile[1]+E.y]})}var u8,u9=[uc.Up,uc.Down,uc.Left,uc.Right],u7=function(){function e(g,E){var _;if(Fe(this,e),this.f=0,this.g=0,this.h=0,E&&rd(g,E.tile))throw new Error("Tile cannot be its own parent");this.tile=g,this.parent=E;var k=e.calcDirection(this),C=E&&k&&E.cache.direction&&!k.equals(E.cache.direction)?1:0;this.cache={direction:k,turns:C+(null!==(_=null==E?void 0:E.cache.turns)&&void 0!==_?_:0)}}return Ue(e,[{key:"getKey",value:function(){var g;return"x:".concat(this.tile[0],",y:").concat(this.tile[1],",d:").concat(null===(g=this.cache.direction)||void 0===g?void 0:g.toString())}},{key:"equals",value:function(g){return this.getKey()===g.getKey()}}],[{key:"calcDirection",value:function(g){if(g.parent){var E=g.parent.tile,_=g.tile;return new eS(_[0]-E[0],_[1]-E[1])}return null}}]),e}();function pd(g,E,_){var k=vd(g,E),C=vd(g,_);if(0===k.length||0===C.length)return yd(E,_);var A=function(g,E,_){var k=[],C=[],A=new u7(E,null),T=new u7(_,null),R=[T.tile];k.push(A);for(;k.length>0;){var I=k.shift();if(C.push(I),rd(I.tile,T.tile)){for(var P=[],L=I,O=I,B=I.parent;B;)B.cache.turns!==O.cache.turns&&(P.unshift({a:sd(B.tile),b:sd(L.tile)}),L=B),O=B,B=B.parent;return P.unshift({a:sd(O.tile),b:sd(L.tile)}),P}var N,M=at(ud(I,vd(g,I.tile,R)));try{var f=function(){var g=N.value,E=new u7(g,I);if(E.cache.turns>8)return 0;var _=rd(E.tile,T.tile),A=C.some(function(g){return g.equals(E)});if(k.some(function(g){return g.equals(E)})||A&&!_)return 0;E.g=I.g+1+E.cache.turns,E.h=fd(E,T),E.f=E.g+E.h,k.push(E)};for(M.s();!(N=M.n()).done;)f()}catch(g){M.e(g)}finally{M.f()}k.sort(function(g,E){return g.f-E.f})}return null}(g,E,_);return A||yd(E,_)}function yd(g,E){var _=sd(g),k=sd(E);return _.x===k.x||_.y===k.y?[{a:_,b:k}]:[{a:_,b:{x:_.x,y:k.y}},{a:{x:_.x,y:k.y},b:k}]}function fd(g,E){var _=g.tile,k=E.tile;return Math.abs(_[0]-k[0])+Math.abs(_[1]-k[1])}function vd(g,E,_){var k,C=arguments.length>2&&void 0!==_?_:[],A=[],T=at(u9);try{var r=function(){var _=k.value,T={x:E[0]+_.x,y:E[1]+_.y};if(g.isInBounds(T.x,T.y))return(g.get(T.x,T.y).isHidden()||u6.search(C,function(g){return rd(g,[T.x,T.y])}))&&A.push(_),1;ld(T,g)&&A.push(_)};for(T.s();!(k=T.n()).done;)r()}catch(g){T.e(g)}finally{T.f()}return A}_._RF.pop(),_._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),_._RF.pop(),_._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var ce=(Ge(u8={},uX.bomb,"b"),Ge(u8,uX.star,"s"),Ge(u8,uX.none,"t"),u8);function gd(g,E){for(var _=arguments.length>1&&void 0!==E?E:ce,k=g.width,C=g.height,A=[],T=new Map,R=C-1;R>=0;R--){for(var I=[],P=0;P<k;P++){var L,O,B=g.get(P,R),N=B.isHidden()?null:B.id;if(null!==N){var M=null!==(L=null===(O=B.special)||void 0===O?void 0:O.type)&&void 0!==L?L:uX.none,D=_[M];if(!T.has(N)){var F=T.size.toString();T.set(N,F)}var U="".concat(D).concat(T.get(N));I.push(U)}else I.push(".")}A.push(I.join(""))}return{code:A.join(":"),idSize:T.size,encoding:_,rows:C,cols:k}}function bd(g){return g.reduce(function(g,E,_,k){return E.inSamePositionAs(_,k)||g.push([E,[_,k]]),g},[])}function Sd(g,E){var _,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:_=0,k=g-1,C=0,A=E-1;L.label=1;case 1:if(!(_<=k&&C<=A))return[3,19];T=_;L.label=2;case 2:if(!(T<=k))return[3,5];return[4,{x:T,y:C}];case 3:L.sent();L.label=4;case 4:T++;return[3,2];case 5:R=++C;L.label=6;case 6:if(!(R<=A))return[3,9];return[4,{x:k,y:R}];case 7:L.sent();L.label=8;case 8:R++;return[3,6];case 9:I=--k;L.label=10;case 10:if(!(I>=_))return[3,13];return[4,{x:I,y:A}];case 11:L.sent();L.label=12;case 12:I--;return[3,10];case 13:P=--A;L.label=14;case 14:if(!(P>=C))return[3,17];return[4,{x:_,y:P}];case 15:L.sent();L.label=16;case 16:P--;return[3,14];case 17:_++;L.label=18;case 18:return[3,1];case 19:return[2]}})}_._RF.pop(),_._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),_._RF.pop(),_._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),_._RF.pop(),_._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var ct,cn,ci,cr,ca,co,cs,cl,cu,cc,ch=GameCore.Utils.Array,cp=function(){function e(g,E){Fe(this,e),this.coord=new eS(g,E)}return Ue(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function Nd(g){return new eS(g[0],g[1])}function Md(g,E,_){if(void 0===E||void 0===_)return function(g,E){var _,k=arguments.length>1&&void 0!==E?E:Sd,C=[],A=at(k(g.width,g.height));try{for(A.s();!(_=A.n()).done;){var T=_.value,R=g.get(T.x,T.y);R.isHidden()||C.push([R,[T.x,T.y]])}}catch(g){A.e(g)}finally{A.f()}var I,P=[],u=function(){var E=et(C.shift(),2),_=E[0],k=E[1];if(ch.search(P,function(g){return Fd(g,k)}))return 0;P.push(k);for(var A,r=function(){var E=et(R[T],2),C=E[0],A=E[1];if(!C.isSimilarTo(_)||ch.search(P,function(g){return Fd(g,A)}))return 0;var I=Md(g,k,A);return null!==I?{v:{v:I}}:void 0},T=0,R=C;T<R.length;T++)if(0!==(A=r())&&A)return A.v};for(;C.length>0;)if(0!==(I=u())&&I)return I.v;return null}(g);var k,C=[E[0]+1,E[1]+1],A=[_[0]+1,_[1]+1],T=function(g){var E=ch.fillWith(g.width+2,function(g){return new cp(g-1,-1)}),_=ch.fillWith(g.width+2,function(E){return new cp(E-1,g.height)}),k=ch.fillWith(g.height,function(g){return new cp(-1,g)}),C=ch.fillWith(g.height,function(E){return new cp(g.width,E)}),o=function(A,T){var R=A-1,I=T-1;return -1===R?k[I]:R===g.width?C[I]:-1===I?E[R]:I===g.height?_[R]:g.get(R,I)};return{get:function(g,E){return o(g,E)},width:g.width+2,height:g.height+2}}(g),R=[C,A];if(C[0]===A[0]&&Ud(T,R,C[1],A[1],C[0])||C[1]===A[1]&&Gd(T,R,C[0],A[0],C[1]))return Hd([{a:Nd(C),b:Nd(A)}],{x:-1,y:-1});var I=C[1]<=A[1]?C:A,P=C[1]<=A[1]?A:C,L=C[0]<=A[0]?C:A,O=C[0]<=A[0]?A:C,B=[],N=[],M=zd(T,R,1,Nd(I),Nd(P)),D=zd(T,R,-1,Nd(I),Nd(P));-1===M&&-1===D||(k=-1!==M?M:D,B=[{a:Nd(C),b:{x:C[0],y:k}},{a:{x:C[0],y:k},b:{x:A[0],y:k}},{a:{x:A[0],y:k},b:Nd(A)}]);var F=Vd(T,R,1,Nd(L),Nd(O)),U=Vd(T,R,-1,Nd(L),Nd(O));-1===F&&-1===U||(k=-1!==F?F:U,B=[{a:Nd(C),b:{x:k,y:C[1]}},{a:{x:k,y:C[1]},b:{x:k,y:A[1]}},{a:{x:k,y:A[1]},b:Nd(A)}]);var x=function(g,E,_,k){for(var C=_.y+1;C<k.y;C++)if(Ud(g,E,_.y,C,_.x)&&Gd(g,E,_.x,k.x,C)&&Ud(g,E,C,k.y,k.x))return C;return -1}(T,R,Nd(I),Nd(P));-1!==x&&(k=x,N=[{a:Nd(C),b:{x:C[0],y:k}},{a:{x:C[0],y:k},b:{x:A[0],y:k}},{a:{x:A[0],y:k},b:Nd(A)}]);var z=function(g,E,_,k){for(var C=_.x+1;C<k.x;C++)if(Gd(g,E,_.x,C,_.y)&&Ud(g,E,_.y,k.y,C)&&Gd(g,E,C,k.x,k.y))return C;return -1}(T,R,Nd(L),Nd(O));return -1!==z&&(k=z,N=[{a:Nd(C),b:{x:k,y:C[1]}},{a:{x:k,y:C[1]},b:{x:k,y:A[1]}},{a:{x:k,y:A[1]},b:Nd(A)}]),B.length>0&&N.length>0?Hd(Dd(B)<=Dd(N)?B:N,{x:-1,y:-1}):B.length>0?Hd(B,{x:-1,y:-1}):N.length>0?Hd(N,{x:-1,y:-1}):null}function Dd(g){var E,_=0,k=at(g);try{for(k.s();!(E=k.n()).done;)_+=Bd(E.value)}catch(g){k.e(g)}finally{k.f()}return _}function Bd(g){return g.a.x===g.b.x?Math.abs(g.a.y-g.b.y):g.a.y===g.b.y?Math.abs(g.a.x-g.b.x):0}function Fd(g,E){return g[0]===E[0]&&g[1]===E[1]}function xd(g,E,_){var k=arguments.length>2&&void 0!==_?_:[],C=g.get.apply(g,tt(E));return C.isHidden()||k.some(function(g){return Fd(g,E)})}function Ud(g,E,_,k,C){for(var A=Math.min(_,k),T=Math.max(_,k),R=A;R<=T;R++)if(!xd(g,[C,R],E))return!1;return!0}function Gd(g,E,_,k,C){for(var A=Math.min(_,k),T=Math.max(_,k),R=A;R<=T;R++)if(!xd(g,[R,C],E))return!1;return!0}function zd(g,E,_,k,C){var A=1===_?C.y:k.y,T=1===_?k.x:C.x;if(Ud(g,E,k.y,C.y,T))for(;A>=0&&A<g.height&&xd(g,[k.x,A],E)&&xd(g,[C.x,A],E);){if(Gd(g,E,k.x,C.x,A))return A;A+=_}return -1}function Vd(g,E,_,k,C){var A=1===_?C.x:k.x,T=1===_?k.y:C.y;if(Gd(g,E,k.x,C.x,T))for(;A>=0&&A<g.width&&xd(g,[A,k.y],E)&&xd(g,[A,C.y],E);){if(Ud(g,E,k.y,C.y,A))return A;A+=_}return -1}function Hd(g,E){return g.map(function(g){return{a:{x:g.a.x+E.x,y:g.a.y+E.y},b:{x:g.b.x+E.x,y:g.b.y+E.y}}})}_._RF.pop(),_._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var cd,cf=k.ccclass,cy=k.property,cv=k.requireComponent,cg=globalThis.game.monitorError,cm=GameCore.Utils,cb=cm.Array,cw=cm.Function,cS=(ct=cf("Board"),cn=cv(R),ci=cy(uZ),cr=cy(C),ca=cy({displayName:"Tile Spacing",group:"Create config"}),ct(co=cn((cl=st((cs=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"tilePrefab",cl,Ke(g)),rt(g,"tilesHolder",cu,Ke(g)),rt(g,"tileTrim",cc,Ke(g)),g.tileSize=[0,0],g.selectedTile=null,g.layoutType="portrait",g.parsedGravityRules=[],g.normalMatches=0,g.normalMatchesSinceLastSpawn=0,g.spawnAttempts=0,g.hintPath=null,g.hintTiles=null,g.animationQueue=[],g.isConsumingAnimation=!1,g.handleViewResized=cw.debounce(function(){g.updateTilesHolderScale()},100),g.onLayoutChanged=function(E){g.layoutType=E},g}return Ue(a,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),nA.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenEvents()}},{key:"onDestroy",value:function(){this.unlistenEvents()}},{key:"create",value:function(g,E,_){var k=this,C=arguments.length>2&&void 0!==_?_:Date.now(),A=tt(g);cb.shuffle(A);var T=A.slice(0,E.colors);null==cg||cg.addMetadata({frames:T.map(function(g){return g.name})}),this.levelData=E,this.parsedGravityRules=Dh(E.mode,this.layoutType===rb.Landscape);var r=function(g){var E=I(k.tilePrefab.node),_=E.getComponent(uZ);return _.setIdentity(g),k.tilesHolder.addChild(E),E.active=!0,_},R=!1;if(void 0!==E.customFen)try{R=!0,this.grid=ed({customFen:E.customFen,identities:T,createTile:r}),this.grid.forEach(function(g,E,_){g.setCoord(E,_),g.setIgnoreInput(!1),g.node.setSiblingIndex(0)})}catch(g){console.error("Error creating grid from custom fen",g,"falling back to random grid"),R=!1}R||(this.grid=Zh({levelData:E,seed:C,identities:T,createTile:r}),this.grid.forEach(function(g,E,_){g.setCoord(E,_),g.setIgnoreInput(!1),g.node.setSiblingIndex(0)}),id(this.grid,C),Qh(this.grid,E,C)),this.handleBoardLayout();var P=[this.tileTrim.x,this.tileTrim.y];this.tileSize=Mh(this.tilePrefab.getSize(),P),this.updateTilesHolderScale(),this.node.scene.emit(r4.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}},{key:"updateTilesHolderScale",value:function(){if(this.grid){var g=[this.grid.width,this.grid.height],E=[this.uiTransform.width,this.uiTransform.height],_=function(g,E,_){var k=et(g,2),C=k[0],A=k[1],T=et(E,2),R=T[0],I=T[1],P=et(_,2),L=P[0]/(C*R),O=P[1]/(A*I);return Math.min(L,O)}(g,this.tilePrefab.getSize(),E);this.tilesHolder.setScale(_,_),this.node.scene.emit(r4.GRID_RESIZE,_)}}},{key:"handleBoardLayout",value:function(){var g,E;this.layoutType===rb.Landscape&&0!==this.levelData.level&&(this.grid=(g=this.grid,(E=g.toRotated()).forEach(function(g,E,_){g.setCoord(E,_)}),E))}},{key:"destroyTiles",value:function(){var g;null===(g=this.grid)||void 0===g||g.forEach(function(g){return g.node.destroy()})}},{key:"animateTilesAppear",value:function(){var g=this;return new Promise(function(E){var _=function(){var _=Be(function(){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Promise.all(g.grid.map(function(E,_,k){var C=eR(0,.5),A=E.node.scale.clone(),T=function(E,_){var k,C=eS.ZERO.clone(),A=at(g.parsedGravityRules);try{for(A.s();!(k=A.n()).done;){var T=k.value,R=g.getPrimitiveDirection(E,_,T);C.subtract2f(R.x,R.y)}}catch(g){A.e(g)}finally{A.f()}return C.normalize()}(_,k),R=Nh(g.grid,g.tileSize,{x:_,y:k}),I=T.multiplyScalar(100).add2f(R.x,R.y);return E.node.setPosition(I.x,I.y),E.node.setScale(0,0),Promise.all([t$.runTweenAsync(z(E.node).delay(C).to(.5,{scale:A},{easing:"elasticOut"})),E.sync({getTargetPosition:function(E){return Nh(g.grid,g.tileSize,E)},easing:"backOut",duration:.5,delay:C})])}))];case 1:_.sent(),E();return[2]}})});return function(){return _.apply(this,arguments)}}();g.animationQueue.push(_),g.consumeAnimationQueue()})}},{key:"animateTilesWave",value:function(){var g=this;return new Promise(function(E){var _=function(){var _=Be(function(){var _;return _ts_generator(this,function(k){switch(k.label){case 0:_=function(g,E){for(var _=E.x,k=E.y,C="center"===g?{x:(_-1)/2,y:(k-1)/2}:g,A=C.x,T=C.y,R=[],I=0;I<_;I++){for(var P=[],L=0;L<k;L++){var O=A-I,B=T-L,N=Math.sqrt(O*O+B*B);P.push(N)}R.push(P)}return R}("center",{x:g.grid.width,y:g.grid.height});return[4,Promise.all(g.grid.map(function(g,E,k){var C=.1*_[E][k],A=g.node.scale.clone();return Promise.all([t$.runTweenAsync(z(g.node).delay(C).to(.25,{scale:A.clone().multiplyScalar(1.2)},{easing:"quadOut"}).to(.25,{scale:A},{easing:"quadIn"}))])}))];case 1:k.sent(),E();return[2]}})});return function(){return _.apply(this,arguments)}}();g.animationQueue.push(_),g.consumeAnimationQueue()})}},{key:"handleTileClick",value:function(g){if(!g.isHidden()){if(this.selectedTile===g)return i9.playSound(ip.TILE_SELECT),this.selectedTile=null,void g.setFocused(!1);if(!this.selectedTile)return i9.playSound(ip.TILE_SELECT),this.selectedTile=g,void g.setFocused(!0);if(!this.selectedTile.isSimilarTo(g))return i9.playSound(ip.TILE_SELECT),this.selectedTile.setFocused(!1),this.selectedTile=g,void g.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,g),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(g,E){var _=[g.getCoord().x,g.getCoord().y],k=[E.getCoord().x,E.getCoord().y],C=Md(this.grid,_,k);if(null===C){i9.playSound(ip.INVALID_MATCH),this.shakeGrid();var A=0===this.levelData.level,T=function(g,E,_,k){if(k){var C=u5[4].startTile,A=u5[4].endTile;if(E[0]===C.x&&E[1]===C.y&&_[0]===A.x&&_[1]===A.y)return[{a:C,b:A}];if(E[0]===A.x&&E[1]===A.y&&_[0]===C.x&&_[1]===C.y)return[{a:C,b:A}]}return pd(g,E,_)}(this.grid,_,k,A);return this.node.scene.emit(r4.GRID_MATCH,[g,E]),void this.node.scene.emit(r4.GRID_MATCH_FAIL,T)}i9.playSound(ip.TILE_MATCH),this.node.scene.emit(r4.GRID_MATCH,[g,E]),this.node.scene.emit(r4.GRID_MATCH_SUCCESS,C,[g,E]),this.clear([[g,E]],"clear")}},{key:"clear",value:function(g,E){var _=arguments.length>1&&void 0!==E?E:"clear";this.normalMatches+=g.length;var k,C=at(g);try{for(C.s();!(k=C.n()).done;){var A=et(k.value,2),T=A[0],R=A[1];T.setEmpty(),R.setEmpty(),T.playClearFX(_),R.playClearFX(_),this.node.scene.emit(r4.GRID_CLEAR,[T,R])}}catch(g){C.e(g)}finally{C.f()}this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var g=this.hintPath[0].a,E=this.hintPath[this.hintPath.length-1].b,_=this.getTileAt(g.x,g.y),k=this.getTileAt(E.x,E.y);_.setHint(!0),k.setHint(!0),this.hintTiles=[_,k]}}},{key:"hideHint",value:function(){if(this.hintTiles){var g=et(this.hintTiles,2),E=g[0],_=g[1];E.setHint(!1),_.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(g,E){return this.grid.isInBounds(g,E)?this.grid.get(g,E):null}},{key:"getAnyTileWorldPosition",value:function(g,E){var _=Nh(this.grid,this.tileSize,{x:g,y:E});this.tilePrefab.node.setPosition(_.x,_.y);var k=this.tilePrefab.node.getWorldPosition();return{x:k.x,y:k.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getGridSize",value:function(){return[this.grid.width,this.grid.height]}},{key:"getUncleared",value:function(){return Fh(this.grid)}},{key:"getCleared",value:function(){return xh(this.grid)}},{key:"getBombTiles",value:function(){var g;return Fh(_instanceof(g=this.grid,um)?g.asArray():g).filter(function(g){var E;return(null===(E=g.special)||void 0===E?void 0:E.type)===uX.bomb})}},{key:"getPairs",value:function(g,E){for(var _=arguments.length>0&&void 0!==g?g:1,k=!(arguments.length>1&&void 0!==E)||E,C=[],A=k?Fh(this.grid):xh(this.grid),_$a=function(){var g=et(qh(A),2),E=g[0],_=g[1];C.push([E,_]),A=A.filter(function(g){return g!==E&&g!==_})};C.length<_;)_$a();return C}},{key:"setIgnoreInput",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.grid.forEach(function(g){return g.setIgnoreInput(E)})}},{key:"processShuffleRequest",value:function(g){var E=this.processShuffleStep(this.grid,!0,g);this.grid=E[0],this.hintPath=E[1],this.consumeAnimationQueue()}},{key:"getCurrentFen",value:function(){return gd(this.grid)}},{key:"generateFenFromCurrentLevel",value:function(g){return a.generateFen(null!=g?g:this.levelData)}},{key:"listenEvents",value:function(){Q.on(t8,this.onLayoutChanged),Q.on(ns,this.handleViewResized)}},{key:"unlistenEvents",value:function(){Q.off(t8,this.onLayoutChanged),Q.off(ns,this.handleViewResized)}},{key:"shakeGrid",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.tilesHolder.position.clone(),E=z(this.tilesHolder).to(.05,{position:g.clone().add3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g.clone().subtract3f(eR(5,10),eR(5,10),0)}),_=z(this.tilesHolder).repeat(2,E).to(.05,{position:g});return[4,t$.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"processGameplayCycle",value:function(){var g=Fh(this.grid);if(0!==g.length){var E=this.grid,_=g.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,k=this.normalMatchesSinceLastSpawn>=2;_&&(k?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),g.length>14&&(E=this.processGravitationStep(E));var C=this.processShuffleStep(E);this.consumeAnimationQueue(),this.grid=C[0],this.hintPath=C[1]}}},{key:"processSpawnStep",value:function(){var g=et(Yh(xh(this.grid),2),2),E=g[0],_=g[1];E.restore(),_.restore(E.id),this.node.scene.emit(r4.GRID_SPAWN,[E,_])}},{key:"processGravitationStep",value:function(g){var E,_=this,k=g,C=[],A=at(this.parsedGravityRules);try{var r=function(){var g=E.value,A=bd(k=_.toGravitated(k,g));if(0===A.length)return 1;var T,R=at(A);try{for(R.s();!(T=R.n()).done;){var I=et(T.value,2),P=I[0],L=et(I[1],2),O=L[0],B=L[1];P.setCoord(O,B)}}catch(g){R.e(g)}finally{R.f()}k.forEach(function(g){g.node.setSiblingIndex(0)});var N=function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Promise.all(A.map(function(g){var E=et(g,2),C=E[0],A=et(E[1],2),T=A[0],R=A[1];return C.sync({delay:.25,duration:.25,getTargetPosition:function(){return Nh(k,_.tileSize,{x:T,y:R})}})}))];case 1:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}();C.push(N)};for(A.s();!(E=A.n()).done;)r()}catch(g){A.e(g)}finally{A.f()}var T=function(){var g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=0,E=C;k.label=1;case 1:if(!(g<E.length))return[3,4];_=E[g];return[4,_()];case 2:k.sent();k.label=3;case 3:g++;return[3,1];case 4:return[2]}})});return function(){return g.apply(this,arguments)}}();return this.animationQueue.push(T),k}},{key:"toGravitated",value:function(g,E){var _=new um(g),k=g.height-1,C=g.width-1,A=[0,k],T=[0,C],R=Math.floor(g.height/2),I=Math.floor(g.width/2),u=function(g){return g.isHidden()};switch(E){case uh:_.gravitate({rowRange:A,colRange:T,direction:uc.Down,isLighter:u});break;case up:_.gravitate({rowRange:A,colRange:T,direction:uc.Up,isLighter:u});break;case uf:_.gravitate({rowRange:A,colRange:T,direction:uc.Left,isLighter:u});break;case uy:_.gravitate({rowRange:A,colRange:T,direction:uc.Right,isLighter:u});break;case uv:_.gravitate({rowRange:A,colRange:[I,C],direction:uc.Left,isLighter:u,out:_.gravitate({rowRange:A,colRange:[0,I-1],direction:uc.Right,isLighter:u})});break;case ug:_.gravitate({rowRange:[R,k],colRange:T,direction:uc.Down,isLighter:u,out:_.gravitate({rowRange:[0,R-1],colRange:T,direction:uc.Up,isLighter:u})})}return _}},{key:"getPrimitiveDirection",value:function(g,E,_){var k=Math.floor(this.grid.height/2),C=Math.floor(this.grid.width/2);switch(_){case uh:return uc.Down;case up:return uc.Up;case uf:return uc.Left;case uy:return uc.Right;case uv:return g>=C?uc.Left:uc.Right;case ug:return E>=k?uc.Down:uc.Up}}},{key:"processShuffleStep",value:function(g,E,_){var k,C=arguments.length>1&&void 0!==E&&E,A=arguments.length>2?_:void 0,T=Md(g),R=Fh(g).map(function(g){var E=g.getCoord();return[E.x,E.y]});if(null!==T&&!C)return[g,T];var I=100;do{var P=g.toShuffled(R),L=et(P,1);T=Md(k=L[0]),I--}while(null===T&&I>0);if(I<=0){var O=k.asArray().map(function(g){var E,_;return{name:null===(E=g.id)||void 0===E?void 0:E.name,type:null===(_=g.special)||void 0===_?void 0:_.type,active:!g.isHidden()}});return null==cg||cg.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",level:this.levelData.level,gridAsArray:O}),this.node.scene.emit(r4.GAME_EXIT),[g,T]}var B,N=bd(k),M=at(N);try{for(M.s();!(B=M.n()).done;){var D=et(B.value,2),F=D[0],U=et(D[1],2),x=U[0],z=U[1];F.setCoord(x,z)}}catch(g){M.e(g)}finally{M.f()}var G=void 0!==A?function(){return A(g,k)}:this.createShuffleAnimationHandler(g,k);return this.animationQueue.push(G),[k,T]}},{key:"createShuffleAnimationHandler",value:function(g,E){var _=this,k=function(){var k=Be(function(){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,Promise.all(g.map(function(g,k,C){return g.sync({duration:.3,easing:"smooth",getTargetPosition:function(){return Nh(E,_.tileSize,{x:k,y:C},10)}})}))];case 1:k.sent();return[2]}})});return function(){return k.apply(this,arguments)}}(),C=function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:E.forEach(function(g){g.node.setSiblingIndex(0)});return[4,Promise.all(E.map(function(g){return g.sync({duration:.4,easing:"smooth",delay:eR(0,.2),getTargetPosition:function(g){return Nh(E,_.tileSize,g)}})}))];case 1:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}();return function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,k()];case 1:g.sent();return[4,C()];case 2:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.isConsumingAnimation)return[3,5];this.isConsumingAnimation=!0;E.label=1;case 1:if(!(this.animationQueue.length>0))return[3,4];if(0===this.getUncleared().length){this.animationQueue=[];return[3,4]}g=this.animationQueue.shift();return[4,g()];case 2:E.sent();E.label=3;case 3:return[3,1];case 4:this.isConsumingAnimation=!1;E.label=5;case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"clearAnimationQueue",value:function(){this.isConsumingAnimation=!1,this.animationQueue=[]}}],[{key:"generateFen",value:function(g){for(var E=g,_=[],k=0;k<E.colors;k++)_.push(k+1);var C=Date.now(),A=Zh({levelData:E,seed:C,identities:_,createTile:function(g){var E=g,_=void 0,k=new eS(0,0);return{get id(){return E},get special(){return _},get coord(){return k},setIdentity:function(g){E=g},isHidden:function(){return!1},setSpecialType:function(g){_={type:g}},setCoord:function(g,E){return k.set(g,E)},getCoord:function(){return k},isSimilarTo:function(g){return g.id===E},inSamePositionAs:function(g){return g.getCoord().equals(k)}}}});return A.forEach(function(g,E,_){g.setCoord(E,_)}),id(A,C),Qh(A,E,C),gd(A)}}]),a}(M)).prototype,"tilePrefab",[ci],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cu=st(cs.prototype,"tilesHolder",[cr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cc=st(cs.prototype,"tileTrim",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(.025,.1)}}),co=cs))||co)||co);_._RF.pop(),_._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var cE=(0,k.ccclass)("Line")(cd=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R)}},{key:"setPoints",value:function(g,E){this.node.setWorldPosition((g.x+E.x)/2,(g.y+E.y)/2,0),this.uiTransform.width=eS.distance(g,E)+10,this.uiTransform.width/=this.node.worldScale.x;var _=180*Math.atan2(E.y-g.y,E.x-g.x)/Math.PI;this.node.eulerAngles=new em(0,0,_)}}]),n}(M))||cd;_._RF.pop(),_._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var c_,ck,cC,cA,cT,cR,cI,cP,cL,cO,cB,cN=function(g){ze(n,g);var E=Xe(n);function n(g,_,k,C,A){var T;return Fe(this,n),(T=E.call(this,g,_,A)).ator=k,T.ftor=C,T}return Ue(n,[{key:"alloc",value:function(){var g=Je(Ve(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(g),g}},{key:"free",value:function(g){this.ftor&&this.ftor(g),Je(Ve(n.prototype),"free",this).call(this,g)}}]),n}(eI);_._RF.pop(),_._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var cM,cD,cF,cU,cx,cz,cG,cV,cK,cH=k.ccclass,cq=k.property,cW=(c_=cH("PathDrawer"),ck=cq({group:"Line",displayName:"Prefab",type:ee}),cC=cq({group:"Line",displayName:"Holder",type:C,tooltip:"Line Prefab"}),cA=cq({group:"Point",displayName:"Prefab",type:ee}),cT=cq({group:"Point",displayName:"Holder",type:C}),c_((cP=st((cI=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"linePrefab",cP,Ke(g)),rt(g,"lineHolder",cL,Ke(g)),g.lineNodes=[],rt(g,"pointPrefab",cO,Ke(g)),rt(g,"pointHolder",cB,Ke(g)),g.pointNodes=[],g}return Ue(n,[{key:"start",value:function(){var g=this;this.linePool=new cN(function(){var E=I(g.linePrefab);return g.lineHolder.addChild(E),E.parent=g.lineHolder,E.active=!1,E},0,function(E){g.lineNodes.push(E),E.active=!0},function(g){g.active=!1},function(g){g.isValid&&g.destroy()}),this.pointPool=new cN(function(){var E=I(g.pointPrefab);return g.pointHolder.addChild(E),E.active=!1,E},0,function(E){g.pointNodes.push(E),E.active=!0},function(g){g.active=!1},function(g){g.isValid&&g.destroy()})}},{key:"drawPath",value:function(g){this.clearPath();var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k,C=E.value;null===(k=this.linePool.alloc().getComponent(cE))||void 0===k||k.setPoints(C.a,C.b)}}catch(g){_.e(g)}finally{_.f()}}},{key:"clearPath",value:function(){var g,E=at(this.lineNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value;this.linePool.free(_)}}catch(g){E.e(g)}finally{E.f()}this.lineNodes=[];var k,C=at(this.pointNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value;this.pointPool.free(A)}}catch(g){C.e(g)}finally{C.f()}this.pointNodes=[]}}]),n}(M)).prototype,"linePrefab",[ck],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cL=st(cI.prototype,"lineHolder",[cC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cO=st(cI.prototype,"pointPrefab",[cA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cB=st(cI.prototype,"pointHolder",[cT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cR=cI))||cR);_._RF.pop(),_._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var cj,cX=k.ccclass,cY=k.property,cJ=(cM=cX("ErrorDrawer"),cD=cY(ea),cF=cY(ea),cU=cY(ea),cM((cG=st((cz=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"one",cG,Ke(g)),rt(g,"two",cV,Ke(g)),rt(g,"error",cK,Ke(g)),g}return Ue(n,[{key:"start",value:function(){Je(Ve(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(g){var E=this;if(this.clearPath(),g.forEach(function(_,k){var C;if(null===(C=E.linePool.alloc().getComponent(cE))||void 0===C||C.setPoints(_.a,_.b),0!==k){var A=E.pointPool.alloc();A.setWorldPosition(new em(_.a.x,_.a.y,0));var T=A.getComponent(eo);1===k&&g.length>3?T.spriteFrame=E.one:2===k&&g.length>3?T.spriteFrame=E.two:T.spriteFrame=E.error}}),1===g.length){var _=this.pointPool.alloc();_.setWorldPosition(new em(g[0].a.x+g[0].b.x,g[0].a.y+g[0].b.y,0).multiplyScalar(.5)),_.getComponent(eo).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(g){this.pathAppearDuration>0&&(this.pathAppearDuration-=g,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(cW)).prototype,"one",[cD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cV=st(cz.prototype,"two",[cF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cK=st(cz.prototype,"error",[cU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cx=cz))||cx);_._RF.pop(),_._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var cQ,cZ=(0,k.ccclass)("HintDrawer")(cj=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"drawPath",value:function(g){this.clearPath(),this.createPath(g),this.showPath()}},{key:"createPath",value:function(g){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k,C=E.value;null===(k=this.linePool.alloc().getComponent(cE))||void 0===k||k.setPoints(C.a,C.b),this.pointPool.alloc().setWorldPosition(C.a.x,C.a.y,0)}}catch(g){_.e(g)}finally{_.f()}this.pointPool.alloc().setWorldPosition(g[g.length-1].b.x,g[g.length-1].b.y,0)}},{key:"showPath",value:function(){var g,E=at(this.lineNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value.getComponent(eu);_.opacity=0,z(_).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(g){E.e(g)}finally{E.f()}var k,C=at(this.pointNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value.getComponent(eu);A.opacity=0,z(A).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(g){C.e(g)}finally{C.f()}}},{key:"clearPath",value:function(){var g,E=this,_=at(this.lineNodes);try{var i=function(){var _=g.value,k=_.getComponent(eu);z(k).to(.15,{opacity:0},{onComplete:function(){k.opacity=255,E.linePool.free(_)}}).start()};for(_.s();!(g=_.n()).done;)i()}catch(g){_.e(g)}finally{_.f()}var k,C=at(this.pointNodes);try{var r=function(){var g=k.value,_=g.getComponent(eu);z(_).to(.15,{opacity:0},{onComplete:function(){_.opacity=255,E.pointPool.free(g)}}).start()};for(C.s();!(k=C.n()).done;)r()}catch(g){C.e(g)}finally{C.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(cW))||cj;_._RF.pop(),_._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var c$,c0,c1,c2,c4,c3,c5,c6,c8,c9=(0,k.ccclass)("MatchDrawer")(cQ=function(g){ze(a,g);var E,_,k=Xe(a);function a(){return Fe(this,a),k.apply(this,arguments)}return Ue(a,[{key:"drawPath",value:function(g){var E=this;g.forEach(function(g,_){var k,C=E.linePool.alloc();null===(k=C.getComponent(cE))||void 0===k||k.setPoints(g.a,g.b),E.animateLine(C);var A=E.pointPool.alloc();A.setWorldPosition(g.a.x,g.a.y,0),E.animatePoint(A,_)});var _=this.pointPool.alloc();_.setWorldPosition(g[g.length-1].b.x,g[g.length-1].b.y,0),this.animatePoint(_,g.length)}},{key:"animateLine",value:(_=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=g.getComponent(eu);E.opacity=0;_=z(E).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});return[4,t$.runTweenAsync(_)];case 1:k.sent(),E.opacity=255,this.linePool.free(g);return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"animatePoint",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.scale=em.ZERO;_=z(g).delay(.03*E).to(.2,{scale:em.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:em.ZERO},{easing:"backIn"});return[4,t$.runTweenAsync(_)];case 1:k.sent(),this.pointPool.free(g);return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),a}(cW))||cQ;_._RF.pop(),_._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var c7,he=k.ccclass,ht=k.property,hn=(c$=he("PathDraw"),c0=ht({group:{name:"Path Drawer"},type:c9}),c1=ht({group:{name:"Path Drawer"},type:cZ}),c2=ht({group:{name:"Path Drawer"},type:cJ}),c$((c5=st((c3=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"matchPath",c5,Ke(g)),rt(g,"hintPath",c6,Ke(g)),rt(g,"errorPath",c8,Ke(g)),g.isDrawingHint=!1,g}return Ue(n,[{key:"onLoad",value:function(){var g=this;this.node.scene.on(r4.GRID_RESIZE,function(E){g.node.setScale(E,E)})}},{key:"drawMatchPath",value:function(g,E){var _,k=g.map(function(g){return Me({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.matchPath.drawPath(k)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(g,E){if(!this.isDrawingHint){this.isDrawingHint=!0;var _,k=g.map(function(g){return Me({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.hintPath.drawPath(k)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(g,E){var _,k=g.map(function(g){return Me({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.errorPath.drawPath(k)}}]),n}(M)).prototype,"matchPath",[c0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c6=st(c3.prototype,"hintPath",[c1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c8=st(c3.prototype,"errorPath",[c2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c4=c3))||c4);_._RF.pop(),_._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var hi,hr,ha,ho,hs,hl,hu,hc,hh,hp,hd,hf=k.ccclass,hy=[ip.COMBO_1,ip.COMBO_2,ip.COMBO_3,ip.COMBO_4,ip.COMBO_5,ip.COMBO_6,ip.COMBO_7,ip.COMBO_8,ip.COMBO_9,ip.COMBO_10,ip.COMBO_11,ip.COMBO_12,ip.COMBO_13],hv=hf("ComboManager")(c7=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(r4.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(r4.GAME_FINISH,this.resetCombo,this),this.node.scene.on(r4.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(r4.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(r4.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(g){if(this.currentCombo=g,g>0){var E=Math.min(g-1,hy.length-1);i9.playSound(hy[E]),this.vibrate(g)}this.emitEvent&&this.node.scene.emit(r4.COMBO_UPDATED,g)}},{key:"vibrate",value:function(g){var E;null===(E=$("Vibrate"))||void 0===E||null===(E=E.getComponent(sL))||void 0===E||E.vibrate(Math.min(20+20*g,220))}},{key:"setEmitEvent",value:function(g){this.emitEvent=g}}]),n}(M))||c7;_._RF.pop(),_._RF.push({},"78746Q4viBIlbRROK4J1bSl","Burst",void 0);var hg,hm=k.ccclass,hb=k.property,hw=(hi=hm("Burst"),hr=hb(K),ha=hb(V),ho=hb(K),hs=hb(V),hi((hc=st((hu=function(){function e(){Fe(this,e),rt(this,"time",hc,this),rt(this,"repeatCount",hh,this),rt(this,"repeatInterval",hp,this),rt(this,"count",hd,this),this.remainingCount=0,this.curTime=0}return Ue(e,[{key:"update",value:function(g,E){if(0===this.remainingCount&&(this.remainingCount=this.repeatCount,this.curTime=this.time),this.remainingCount>0){var _=eP(g.time-g.startDelay.evaluate(0,1),g.duration)-E;_=_>0?_:0;var k=eP(g.time-g.startDelay.evaluate(0,1),g.duration);this.curTime>=_&&this.curTime<k&&(g.emit(this.count,E-(k-this.curTime)),this.curTime+=this.repeatInterval,--this.remainingCount)}}},{key:"reset",value:function(){this.remainingCount=0,this.curTime=0}}]),e}()).prototype,"time",[hr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hh=st(hu.prototype,"repeatCount",[ha],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hp=st(hu.prototype,"repeatInterval",[ho],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hd=st(hu.prototype,"count",[hs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hl=hu))||hl);_._RF.pop(),_._RF.push({},"726cc2e08FBqpVIg/tPM7H2","Particle",void 0);var hS,hE,h_,hk,hC,hA,hT,hR,hI,hP,hL,hO,hB,hN,hM,hD,hF,hU=k.ccclass,hx=k.executeInEditMode,hz=hU("Particle")(hg=hx(!0)(hg=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).remainingLifetime=0,g.startLifetime=0,g}return Ue(n,[{key:"onLoad",value:function(){this.node.layer=ek.Enum.UI_2D}},{key:"init",value:function(g){this.sprite=this.getComponent(eo),this.particleSystem=g,this.velocity=em.ZERO,this.remainingLifetime=0,this.startLifetime=0,this.startSize=em.ZERO,this.startColor=A.WHITE.clone(),this.randomSeed=0}},{key:"reset",value:function(){this.node.rotation.set(0,0,0)}}]),n}(M))||hg)||hg;_._RF.pop(),_._RF.push({},"00eb3NBo0tM/qcD6ViMjx0A","CurveRange",void 0);var hG,hV,hK,hH,hq,hW,hj,hX,hY,hJ,hQ,hZ,h$,h0,h1,h2,h4,h3=k.ccclass,h5=k.property,h6=es({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),h8=(hS=h3("CurveRange"),hE=h5({type:es(h6)}),h_=h5({visible:function(){return this.mode===h6.Constant}}),hk=h5({visible:function(){return this.mode===h6.Curve}}),hC=h5({visible:function(){return this.mode===h6.TwoCurves}}),hA=h5({visible:function(){return this.mode===h6.TwoCurves}}),hT=h5({visible:function(){return this.mode===h6.TwoConstants}}),hR=h5({visible:function(){return this.mode===h6.TwoConstants}}),hS((hL=st((hP=function(){function e(){Fe(this,e),rt(this,"mode",hL,this),rt(this,"constant",hO,this),rt(this,"spline",hB,this),rt(this,"splineMin",hN,this),rt(this,"splineMax",hM,this),rt(this,"constantMin",hD,this),rt(this,"constantMax",hF,this),this.spline.assignSorted([0,1],[0,1]),this.splineMin.assignSorted([0,1],[0,1]),this.splineMax.assignSorted([0,1],[0,1])}return Ue(e,[{key:"evaluate",value:function(g,E){switch(this.mode){case h6.Curve:return this.spline.evaluate(g);case h6.TwoCurves:return eL(this.splineMin.evaluate(g),this.splineMax.evaluate(g),E);case h6.TwoConstants:return eL(this.constantMin,this.constantMax,E);default:return this.constant}}},{key:"getMax",value:function(){switch(this.mode){case h6.Curve:return 1;case h6.TwoConstants:return this.constantMax;case h6.TwoCurves:return 1;default:return this.constant}}},{key:"isZero",value:function(){switch(this.mode){case h6.Curve:return eO(1,0,eB);case h6.TwoConstants:return eO(Math.max(Math.abs(this.constantMax),Math.abs(this.constantMin)),0,eB);case h6.TwoCurves:return eO(1,0,eB);default:return eO(this.constant,0,eB)}}}]),e}()).prototype,"mode",[hE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h6.Constant}}),hO=st(hP.prototype,"constant",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hB=st(hP.prototype,"spline",[hk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eN}}),hN=st(hP.prototype,"splineMin",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eN}}),hM=st(hP.prototype,"splineMax",[hA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eN}}),hD=st(hP.prototype,"constantMin",[hT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hF=st(hP.prototype,"constantMax",[hR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hI=hP))||hI);_._RF.pop(),_._RF.push({},"3fe5eBRNTJFCZgeD7SqFSh5","GradientRange",void 0);var h9=k.ccclass,h7=k.property,pe=es({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),pt=new A,pn=new A,pi=(hG=h9("GradientRange"),hV=h7({type:es(pe)}),hK=h7({visible:function(){return this.mode===pe.Color}}),hH=h7({visible:function(){return this.mode===pe.TwoColors}}),hq=h7({visible:function(){return this.mode===pe.TwoColors}}),hW=h7({visible:function(){return this.mode===pe.Gradient||this.mode===pe.RandomColor}}),hj=h7({visible:function(){return this.mode===pe.TwoGradients}}),hX=h7({visible:function(){return this.mode===pe.TwoGradients}}),hG((hQ=st((hJ=function(){function e(){Fe(this,e),rt(this,"mode",hQ,this),rt(this,"color",hZ,this),rt(this,"colorMin",h$,this),rt(this,"colorMax",h0,this),rt(this,"gradient",h1,this),rt(this,"gradientMin",h2,this),rt(this,"gradientMax",h4,this),this._color=A.WHITE.clone()}return Ue(e,[{key:"evaluate",value:function(g,E){switch(this.mode){case pe.Color:return this.color;case pe.TwoColors:return A.lerp(this._color,this.colorMin,this.colorMax,E),this._color;case pe.RandomColor:return this.gradient.getRandomColor(this._color);case pe.Gradient:return this.gradient.evaluateFast(this._color,g);case pe.TwoGradients:return A.lerp(this._color,this.gradientMin.evaluateFast(pt,g),this.gradientMax.evaluateFast(pn,g),E),this._color;default:return this.color}}}]),e}()).prototype,"mode",[hV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pe.Color}}),hZ=st(hJ.prototype,"color",[hK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),h$=st(hJ.prototype,"colorMin",[hH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),h0=st(hJ.prototype,"colorMax",[hq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),h1=st(hJ.prototype,"gradient",[hW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),h2=st(hJ.prototype,"gradientMin",[hj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),h4=st(hJ.prototype,"gradientMax",[hX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),hY=hJ))||hY);function tf(g,E,_,k){!function(g,E){eS.set(g,Math.cos(E),Math.sin(E))}(g,k),g.z=0,em.multiplyScalar(g,g,E+(_-E)*eF())}function nf(g){var E=h6;switch(g.mode){case E.TwoCurves:case E.TwoConstants:return!0;default:return!1}}_._RF.pop(),_._RF.push({},"1a4c4Z/fWpFuL5b3emrVLug","ParticleFunction",void 0),_._RF.pop(),_._RF.push({},"c2fc2/T2apMGZCPX5a4abo/","ModuleRandSeed",void 0);var pr,pa,po,ps,pl,pu,pc,ph=23541,pp=39825,pf=90794,py=91041,pv=125292,pg=197866,pm=156497;_._RF.pop(),_._RF.push({},"39785+APfBJU5kvcdjZGiLr","ColorOvertimeModule",void 0);var pb,pw,pS,pE,p_,pk,pC,pA,pT,pR=k.ccclass,pI=k.property,pP=py,pL=(pr=pR("ColorOvertimeModule"),pa=pI({type:J}),po=pI({type:pi}),pr((pu=st((pl=function(){function e(){Fe(this,e),rt(this,"enable",pu,this),rt(this,"color",pc,this)}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=g.randomSeed+pP,_=function(g){var E=pe;switch(g.mode){case E.TwoGradients:case E.TwoColors:return!0;default:return!1}}(this.color)?eT(E):0,k=1-g.remainingLifetime/g.startLifetime;g.sprite.color=g.startColor.clone().multiply(this.color.evaluate(k,_))}}}]),e}()).prototype,"enable",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pc=st(pl.prototype,"color",[po],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pi}}),ps=pl))||ps);_._RF.pop(),_._RF.push({},"c397apirpxFfJTJN1KLAcGi","LimitVelocityOvertimeModule",void 0);var pO,pB,pN,pM,pD,pF,pU,px=k.ccclass,pz=k.property,pG=ph,pV=(pb=px("LimitVelocityOvertimeModule"),pw=pz({type:J}),pS=pz({type:h8}),pE=pz({type:h8}),pb((pC=st((pk=function(){function e(){Fe(this,e),rt(this,"enable",pC,this),rt(this,"limit",pA,this),rt(this,"dampen",pT,this),this.limit.constant=500,this.dampen.constant=.2}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=g.velocity.clone().normalize(),C=nf(this.limit)?eT(g.randomSeed+pG):0,A=nf(this.dampen)?eT(g.randomSeed+pG+1):0,T=g.velocity.length(),R=this.limit.evaluate(_,C),I=this.dampen.evaluate(_,A);g.velocity=k.multiplyScalar(this.dampenBeyondLimit(T,R,I,E))}}},{key:"dampenBeyondLimit",value:function(g,E,_,k){if(g<=E)return g;var C=1-Math.exp(-_*k);return X.lerp(g,E,C)}}]),e}()).prototype,"enable",[pw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pA=st(pk.prototype,"limit",[pS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),pT=st(pk.prototype,"dampen",[pE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),p_=pk))||p_);_._RF.pop(),_._RF.push({},"442c2KaGHdNip4TBoeKOOoY","RendererModule",void 0);var pK,pH,pq,pW,pj,pX,pY,pJ,pQ,pZ,p$,p0,p1,p2,p4=k.ccclass,p3=k.property,p5=(pO=p4("RendererModule"),pB=p3(eU),pN=p3(ea),pO((pF=st((pD=Ue(function e(){Fe(this,e),rt(this,"material",pF,this),rt(this,"spriteFrame",pU,this)})).prototype,"material",[pB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pU=st(pD.prototype,"spriteFrame",[pN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pM=pD))||pM);_._RF.pop(),_._RF.push({},"c6cfbhYVctHt53aUXC4oSWy","RotationOvertimeModule",void 0);var p6,p8,p9,p7,de,dt,dn,di,dr,da,ds,dl,du,dc,dh,dp,dd,df,dy,dv,dg,dm,db,dw=k.ccclass,dS=k.property,dE=pv,d_=(pK=dw("RotationOvertimeModule"),pH=dS({type:J}),pq=dS(J),pW=dS({type:h8}),pj=dS({type:h8,visible:function(){return this.separateAxes}}),pX=dS({type:h8,visible:function(){return this.separateAxes}}),pY=dS({type:h8}),pK((pZ=st((pQ=function(){function e(){Fe(this,e),rt(this,"enable",pZ,this),rt(this,"separateAxes",p$,this),rt(this,"x",p0,this),rt(this,"y",p1,this),rt(this,"z",p2,this)}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=g.randomSeed+dE,C=nf(this.z)?eT(k):0,A=this.z.evaluate(_,C)*E,T=0,R=0;if(this.separateAxes){var I=nf(this.x)?eT(k):0,P=nf(this.y)?eT(k):0;T=this.x.evaluate(_,I)*E,R=this.y.evaluate(_,P)*E}g.node.eulerAngles=new em(g.node.eulerAngles.x+T,g.node.eulerAngles.y+R,g.node.eulerAngles.z+A)}}}]),e}()).prototype,"enable",[pH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p$=st(pQ.prototype,"separateAxes",[pq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),p0=st(pQ.prototype,"x",[pW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),p1=st(pQ.prototype,"y",[pj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),p2=st(pQ.prototype,"z",[pX,pY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),pJ=pQ))||pJ);_._RF.pop(),_._RF.push({},"f63cd4ScDJFPrnTLNT4+QKu","ShapeModule",void 0);var dk,dC,dA,dT,dR,dI,dP,dL=k.ccclass,dO=k.property,dB=es({Circle:0,Rectangle:1}),dN=es({Base:0,Edge:1}),Hv=function(){return this.shape===dB.Circle},qv=function(){return this.shape===dB.Rectangle},dM=[0,0],dD=(p6=dL("ShapeModule"),p8=dO({type:es(dB)}),p9=dO({type:es(dN),visible:qv}),p7=dO({}),de=dO({}),dt=dO({}),dn=dO({range:[0,360],visible:Hv}),di=dO({range:[-360,360],visible:Hv}),dr=dO({min:0,visible:Hv}),da=dO({range:[0,1],step:.01,visible:Hv}),ds=dO({visible:qv}),p6((dc=st((du=function(){function e(){Fe(this,e),rt(this,"shape",dc,this),rt(this,"emitFrom",dh,this),rt(this,"position",dp,this),rt(this,"rotation",dd,this),rt(this,"scale",df,this),rt(this,"arc",dy,this),rt(this,"angle",dv,this),rt(this,"radius",dg,this),rt(this,"radiusThickness",dm,this),rt(this,"rectangleThickness",db,this)}return Ue(e,[{key:"emit",value:function(g){switch(this.shape){case dB.Circle:this.circleEmit(this.radius,this.radiusThickness,ex(this.generateArcAngle()),g);break;case dB.Rectangle:this.rectangleEmit(this.emitFrom,this.rectangleThickness,g)}}},{key:"circleEmit",value:function(g,E,_,k){var C=k.node.position;tf(C,g*(1-E),g,_+ex(this.angle)),k.velocity=C.clone().normalize()}},{key:"rectangleEmit",value:function(g,E,_){var k,C,A,T=_.node.position;switch(g){case dN.Base:C=T,A=E,eS.set(C,eR(-A.x,A.x),eR(-A.y,A.y));break;case dN.Edge:dM[0]=eR(-1,1),dM[1]=(0===(k=eR(-1,1))&&k++,eD.sign(k)),function(g){for(var E=0;E<g.length;E++){var _=E+eC(0,g.length-E),k=g[_];g[_]=g[E],g[E]=k}}(dM),this.applyRectThickness(dM,E),eS.set(T,dM[0],dM[1])}_.velocity=T.clone().normalize()}},{key:"generateArcAngle",value:function(){return eR(0,this.arc)}},{key:"applyRectThickness",value:function(g,E){E.x>0&&(g[0]*=E.x),E.y>0&&(g[1]*=E.y)}},{key:"gizmo",value:function(g){switch(g.strokeColor.fromHEX("#46C4FFB0"),g.fillColor.fromHEX("#46C4FF77"),g.lineWidth=8,this.shape){case dB.Circle:this.gizmoCircle(g);break;case dB.Rectangle:this.gizmoRectangle(g)}}},{key:"gizmoCircle",value:function(g){g.clear();var E=this.angle,_=this.angle+this.arc;if(this.createArcPath(g,this.radius,E,_),this.createArcPath(g,this.radius*(1-this.radiusThickness),E,_),this.arc<360&&this.radius>0){var k=this.radius*Math.cos(ex(this.angle)),C=this.radius*Math.sin(ex(this.angle)),A=this.radius*Math.cos(ex(this.arc+this.angle)),T=this.radius*Math.sin(ex(this.arc+this.angle));g.moveTo(k,C),g.lineTo(0,0),g.moveTo(A,T),g.lineTo(0,0)}g.stroke()}},{key:"gizmoRectangle",value:function(g){g.clear();var E=this.rectangleThickness.x,_=this.rectangleThickness.y;g.moveTo(E,_),g.lineTo(-E,_),g.lineTo(-E,-_),g.lineTo(E,-_),g.close(),g.stroke()}},{key:"createArcPath",value:function(g,E,_,k){if(!(E<=0))for(var C=(k-_)/48,A=0;A<=48;A++){var T=_+A*C,R=E*Math.cos(ex(T)),I=E*Math.sin(ex(T));0===A?g.moveTo(R,I):g.lineTo(R,I)}}}]),e}()).prototype,"shape",[p8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dB.Circle}}),dh=st(du.prototype,"emitFrom",[p9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dN.Base}}),dp=st(du.prototype,"position",[p7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(0,0,0)}}),dd=st(du.prototype,"rotation",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(0,0,0)}}),df=st(du.prototype,"scale",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(1,1,1)}}),dy=st(du.prototype,"arc",[dn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 360}}),dv=st(du.prototype,"angle",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),dg=st(du.prototype,"radius",[dr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),dm=st(du.prototype,"radiusThickness",[da],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),db=st(du.prototype,"rectangleThickness",[ds],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(20,50)}}),dl=du))||dl);_._RF.pop(),_._RF.push({},"1b7c1WztGdLzKO8gh4ulm2c","SizeOvertimeModule",void 0);var dF,dU,dx,dz,dG,dV,dK,dH,dq,dW,dj,dX,dY,dJ=k.ccclass,dQ=k.property,dZ=pp,d$=(dk=dJ("SizeOvertimeModule"),dC=dQ({type:J}),dA=dQ({type:h8}),dk((dI=st((dR=function(){function e(){Fe(this,e),rt(this,"enable",dI,this),rt(this,"size",dP,this),this.size.constant=1}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=1-g.remainingLifetime/g.startLifetime,_=g.randomSeed+dZ,k=nf(this.size)?eT(_):0,C=this.size.evaluate(E,k);g.node.scale=new em(C*g.startSize.x,C*g.startSize.y,1)}}}]),e}()).prototype,"enable",[dC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dP=st(dR.prototype,"size",[dA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),dT=dR))||dT);_._RF.pop(),_._RF.push({},"530341yf3ZOmaqdU+AYM0/U","SpriteAnimationModule",void 0);var d0,d1,d2,d4,d5,d6,d8,d9,d7,fe=k.ccclass,ft=k.property,fn=pf,fi=(dF=fe("SpriteAnimationModule"),dU=ft({type:J}),dx=ft({type:ea}),dz=ft({type:h8}),dG=ft({type:h8}),dV=ft({type:V}),dF((dq=st((dH=function(){function e(){Fe(this,e),rt(this,"enable",dq,this),rt(this,"frames",dW,this),rt(this,"frameOverTime",dj,this),rt(this,"startFrame",dX,this),rt(this,"cycleCount",dY,this),this.frameOverTime.constant=0,this.startFrame.constant=0}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=1-g.remainingLifetime/g.startLifetime,_=nf(this.startFrame)?eT(g.randomSeed+fn):0,k=nf(this.frameOverTime)?eT(g.randomSeed+fn):0,C=this.startFrame.evaluate(E,_),A=eP(this.cycleCount*(this.frameOverTime.evaluate(E,k)+C),this.frames.length);g.sprite.spriteFrame=this.frames[Math.floor(A)]}}}]),e}()).prototype,"enable",[dU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dW=st(dH.prototype,"frames",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dj=st(dH.prototype,"frameOverTime",[dz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),dX=st(dH.prototype,"startFrame",[dG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),dY=st(dH.prototype,"cycleCount",[dV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dK=dH))||dK);_._RF.pop(),_._RF.push({},"f6ad5Yz6wpE2ZzModn16CYQ","VelocityOvertimeModule",void 0);var fr,fa,fo,fs,fl,fu,fc,fh,fp,ff,fy,fv,fg,fm,fb,fw,fS,fE,f_,fk,fC,fA,fT,fR,fI,fP,fL,fO,fB,fN,fM,fD,fF,fU,fx,fz,fG,fV,fK,fH,fq,fW,fj,fX,fY,fJ,fQ,fZ,f$,f0,f1,f2,f4=k.ccclass,f3=k.property,f5=(d0=f4("VelocityOvertimeModule"),d1=f3({type:J}),d2=f3({type:h8}),d4=f3({type:h8}),d0((d8=st((d6=function(){function e(){Fe(this,e),rt(this,"enable",d8,this),rt(this,"x",d9,this),rt(this,"y",d7,this),this._temp_v3=new em,this.x.constant=0,this.y.constant=0}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=nf(this.x)?eT(g.randomSeed+pg):0,C=nf(this.y)?eT(g.randomSeed+pm):0,A=em.set(this._temp_v3,this.x.evaluate(_,k),this.y.evaluate(_,C),0);em.add(g.velocity,g.velocity,A.multiplyScalar(E))}}}]),e}()).prototype,"enable",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d9=st(d6.prototype,"x",[d2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),d7=st(d6.prototype,"y",[d4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),d5=d6))||d5);_._RF.pop(),_._RF.push({},"10bc3IfFqBLtpSgVri/NVeX","ParticleSystem",void 0);var f6,f8,f9,f7,ye,yt,yn,yi,yr,ya=k.ccclass,yo=k.property,ys=k.executeInEditMode,yl=k.disallowMultiple,yu=(fr=ya("ParticleSystem"),fa=ys(!0),fo=yl(!0),fs=yo({}),fl=yo(J),fu=yo(K),fc=yo(J),fh=yo({type:h8}),fp=yo({type:h8}),ff=yo(pi),fy=yo(J),fv=yo({type:h8,formerlySerializedAs:"startSize"}),fg=yo({type:h8,visible:function(){return this.startSize2D}}),fm=yo({type:h8}),fb=yo(J),fw=yo({type:h8,formerlySerializedAs:"startRotation"}),fS=yo({type:h8}),fE=yo({type:h8}),f_=yo({type:dD}),fk=yo({type:f5}),fC=yo({type:d$}),fA=yo({type:d_}),fT=yo({type:pL}),fR=yo({type:fi}),fI=yo({type:pV}),fP=yo(hw),fL=yo({type:p5}),fr(fO=fa(fO=fo((st((fB=function(g){ze(n,g);var E=Xe(n);function n(){var g;return Fe(this,n),(g=E.call(this))._preview=!1,rt(g,"playOnAwake",fN,Ke(g)),rt(g,"duration",fM,Ke(g)),rt(g,"loop",fD,Ke(g)),rt(g,"startDelay",fF,Ke(g)),rt(g,"startLifetime",fU,Ke(g)),rt(g,"startColor",fx,Ke(g)),rt(g,"startSize2D",fz,Ke(g)),rt(g,"startSizeX",fG,Ke(g)),rt(g,"startSizeY",fV,Ke(g)),rt(g,"startSpeed",fK,Ke(g)),rt(g,"startRotation3D",fH,Ke(g)),rt(g,"startRotation",fq,Ke(g)),rt(g,"gravityModifier",fW,Ke(g)),rt(g,"rateOverTime",fj,Ke(g)),rt(g,"shapeModule",fX,Ke(g)),rt(g,"velocityOvertimeModule",fY,Ke(g)),rt(g,"sizeOvertimeModule",fJ,Ke(g)),rt(g,"rotationOvertimeModule",fQ,Ke(g)),rt(g,"colorOvertimeModule",fZ,Ke(g)),rt(g,"spriteAnimationModule",f$,Ke(g)),rt(g,"limitVelocityOvertimeModule",f0,Ke(g)),rt(g,"bursts",f1,Ke(g)),rt(g,"rendererModule",f2,Ke(g)),g.particles=[],g.time=0,g.emitRateTimeCounter=0,g.isPlaying=!1,g.isStopped=!0,g.isEmitting=!1,g.needToRestart=!1,g.startLifetime.constant=5,g.startSizeX.constant=1,g.startSpeed.constant=5,g.rateOverTime.constant=10,g}return Ue(n,[{key:"preview",get:function(){return this._preview},set:function(g){this._preview=g,this.graphics&&this.graphics.destroy()}},{key:"onEnable",value:function(){}},{key:"onLoad",value:function(){this.preview=null!==this.getComponent(ef),this.node.removeAllChildren()}},{key:"start",value:function(){this.node.position=new em(this.node.position.x,this.node.position.y,100),this.playOnAwake?this.play():this.preview}},{key:"update",value:function(g){this.isPlaying&&(this.time+=g,this.emitting(g))}},{key:"play",value:function(){this.needToRestart&&(this.needToRestart=!1),this.isStopped&&(this.isStopped=!1),this.time=0,this.isPlaying=!0,this.isEmitting=!0}},{key:"stop",value:function(){this.isPlaying||(this.isPlaying=!1),this.isEmitting||(this.isEmitting=!1),this.isStopped=!0}},{key:"emitting",value:function(g){var E=this,_=this.startDelay.evaluate(0,1);if(this.time>_&&this.time>this.duration+_&&(this.loop||(this.isEmitting=!1)),this.isEmitting){if(this.emitRateTimeCounter+=this.rateOverTime.evaluate(this.time/this.duration,1)*g,this.emitRateTimeCounter>1){var k=Math.floor(this.emitRateTimeCounter);this.emitRateTimeCounter-=k,this.emit(k,g)}var C,A=at(this.bursts);try{for(A.s();!(C=A.n()).done;)C.value.update(this,g)}catch(g){A.e(g)}finally{A.f()}}var T=this.gravityModifier.evaluate(this.time/this.duration,1);this.particles.forEach(function(_,k){_.node.active&&(E.spriteAnimationModule.update(_),E.sizeOvertimeModule.update(_),E.rotationOvertimeModule.update(_,g),E.colorOvertimeModule.update(_),E.velocityOvertimeModule.update(_,g),E.applyGravityModifier(_,T),E.limitVelocityOvertimeModule.update(_,g),_.node.position.add(_.velocity.clone().multiplyScalar(g)),_.remainingLifetime-=g,_.remainingLifetime<=0&&(_.node.active=!1))})}},{key:"emit",value:function(g,E){if(null!==this.rendererModule.spriteFrame)for(var _=this.time%this.duration/this.duration,k=0;k<g;k++){var C=this.getFreeParticle();C.init(this),C.reset(),this.shapeModule.emit(C);var A=this.startSpeed.evaluate(_,this.rand());C.velocity=C.velocity.clone().multiplyScalar(A);var T=this.startSizeX.evaluate(_,this.rand()),R=this.startSize2D?new em(T,this.startSizeY.evaluate(_,this.rand()),1):new em(T,T,1);C.startSize=R.clone(),C.node.scale=R.clone();var I=this.startRotation.evaluate(_,this.rand());C.node.eulerAngles=new em(0,0,I),C.startColor=this.startColor.evaluate(_,this.rand()).clone(),C.sprite.color=C.startColor.clone(),C.startLifetime=this.startLifetime.evaluate(_,this.rand())+E,C.remainingLifetime=C.startLifetime,C.randomSeed=eC(0,233280)}}},{key:"applyGravityModifier",value:function(g,E){g.velocity.add(new em(0,-9.8*E,0))}},{key:"rand",value:function(){return eT(eC(0,eD.INT_MAX))}},{key:"getFreeParticle",value:function(){var g=this.particles.find(function(g){return!g.node.active});return g||(g=this.createParticle()),g.node.active=!0,g}},{key:"createParticle",value:function(){var g=new C,E=I(g),_=E.addComponent(hz),k=E.addComponent(eo);return this.particles.push(_),k.spriteFrame=this.rendererModule.spriteFrame,k.customMaterial=this.rendererModule.material,this.node.addChild(E),_}}]),n}(M)).prototype,"preview",[fs],Object.getOwnPropertyDescriptor(fB.prototype,"preview"),fB.prototype),fN=st(fB.prototype,"playOnAwake",[fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),fM=st(fB.prototype,"duration",[fu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),fD=st(fB.prototype,"loop",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fF=st(fB.prototype,"startDelay",[fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),fU=st(fB.prototype,"startLifetime",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),fx=st(fB.prototype,"startColor",[ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pi}}),fz=st(fB.prototype,"startSize2D",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fG=st(fB.prototype,"startSizeX",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),fV=st(fB.prototype,"startSizeY",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),fK=st(fB.prototype,"startSpeed",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),fH=st(fB.prototype,"startRotation3D",[fb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fq=st(fB.prototype,"startRotation",[fw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),fW=st(fB.prototype,"gravityModifier",[fS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),fj=st(fB.prototype,"rateOverTime",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h8}}),fX=st(fB.prototype,"shapeModule",[f_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dD}}),fY=st(fB.prototype,"velocityOvertimeModule",[fk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f5}}),fJ=st(fB.prototype,"sizeOvertimeModule",[fC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d$}}),fQ=st(fB.prototype,"rotationOvertimeModule",[fA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d_}}),fZ=st(fB.prototype,"colorOvertimeModule",[fT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pL}}),f$=st(fB.prototype,"spriteAnimationModule",[fR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fi}}),f0=st(fB.prototype,"limitVelocityOvertimeModule",[fI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pV}}),f1=st(fB.prototype,"bursts",[yo,fP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f2=st(fB.prototype,"rendererModule",[fL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p5}}),fO=fB))||fO)||fO)||fO);_._RF.pop(),_._RF.push({},"a7ff8uVnP1G3ppM9F/A5DYq","Cloud",void 0);var yc,yh,yp,yf,yy,yv,yg,ym,yb,yw,yS,yE,y_,yk,yC,yA,yT,yR=k.ccclass,yI=k.property,yP=(f6=yR("Cloud"),f8=yI({type:C}),f9=yI({type:C}),f7=yI({type:G}),f6((yn=st((yt=function(g){ze(l,g);var E,_,k,C,A,T=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"cloudSprites",yn,Ke(g)),rt(g,"lightnings",yi,Ke(g)),rt(g,"animation",yr,Ke(g)),g}return Ue(l,[{key:"playInitAnimation",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.moveToScreenCenter()];case 1:g.sent();return[2]}})}),function(){return A.apply(this,arguments)})},{key:"playLightningAnimation",value:(C=Be(function(g,E){var _,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=this.lightnings[E],k=g.subtract(_.worldPosition),C=Math.atan2(k.y,k.x)*(180/Math.PI)+180,A=k.length();_.getComponent(R).width=A,_.angle=C,_.active=!0;return[4,t$.waitTweenAsync(.2)];case 1:T.sent(),_.active=!1;return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"playScaleTween",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.cloudSprites.map(function(g){var E=z(g).to(.1,{scale:new em(1.2,1.2)},{easing:"quadOut"}).to(.1,{scale:new em(1,1)},{easing:"quadOut"});return t$.runTweenAsync(E)});return[4,Promise.all(g)];case 1:E.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadAnimation",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(null!==this.animation.defaultClip)return[3,2];return[4,ii.loadAnimClipAsync(nF.CLOUD_IDLE_ANIM)];case 1:g=E.sent();g&&this.animation&&(this.animation.defaultClip=g);E.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"moveToScreenCenter",value:(E=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=$("Canvas").getComponent(R),E=g.width,_=g.height,k=0,C=0;switch(Math.floor(4*Math.random())){case 0:k=Math.random()*E-E/2,C=_/2+300;break;case 1:k=Math.random()*E-E/2,C=-_/2-300;break;case 2:k=-E/2-300,C=Math.random()*_-_/2;break;case 3:k=E/2+300,C=Math.random()*_-_/2}this.node.position=new em(k,C);A=z(this.node).to(.8,{position:new em(0,300)},{easing:"quadOut"});return[4,t$.runTweenAsync(A)];case 1:T.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),l}(M)).prototype,"cloudSprites",[f8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yi=st(yt.prototype,"lightnings",[f9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yr=st(yt.prototype,"animation",[f7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ye=yt))||ye);_._RF.pop(),_._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var yL,yO,yB,yN,yM,yD=k.ccclass,yF=k.property,yU=k.disallowMultiple,yx=(yc=yD("ShiningStar"),yh=yF(eo),yp=yF({serializable:!0,visible:!1}),yf=yF({type:K,displayName:"Scale up duration",min:.001}),yy=yF({serializable:!0,visible:!1}),yv=yF({type:K,displayName:"Bounce and Fall duration",min:.001}),yg=yF({serializable:!0,visible:!1}),ym=yF({type:K,displayName:"Start scale"}),yb=yF({serializable:!0,visible:!1}),yw=yF({type:K,displayName:"End scale"}),yc(yS=yU((y_=st((yE=function(g){ze(u,g);var E,_,k,C,A,T,R,I=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=I.call.apply(I,[this].concat(_)),"shine",y_,Ke(g)),rt(g,"twScaleUpDuration",yk,Ke(g)),rt(g,"twBounceAndFallDuration",yC,Ke(g)),rt(g,"twStartScale",yA,Ke(g)),rt(g,"twEndScale",yT,Ke(g)),g.isBeingAnimated=!1,g}return Ue(u,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(g){this.twScaleUpDuration=g}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(g){this.twBounceAndFallDuration=g}},{key:"startScale",get:function(){return this.twStartScale},set:function(g){this.twStartScale=g}},{key:"endScale",get:function(){return this.twEndScale},set:function(g){this.twEndScale=g}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(eu),this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(R=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0;return[4,this.animateAppear()];case 1:g.sent();return[4,this.animateDisappear()];case 2:g.sent(),this.isBeingAnimated=!1;return[2]}})}),function(){return R.apply(this,arguments)})},{key:"animateAppear",value:(T=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.shineOpacity.opacity=255;return[4,Promise.all([this.animateFadeIn(),this.animateScaleUp()])];case 1:g.sent();return[2]}})}),function(){return T.apply(this,arguments)})},{key:"animateDisappear",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Promise.all([this.animateBounceAndFall(),this.animateScaleDown()])];case 1:g.sent(),this.node.setScale(0,0),this.uiOpacity.opacity=0;return[2]}})}),function(){return A.apply(this,arguments)})},{key:"animateBounceAndFall",value:(C=Be(function(){var g,E,_,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.node.position.x,E=this.node.position.y,_=[60,120],k=(Math.random()*(_[1]-_[0])+_[0])*(Math.PI/180),C=g+200*Math.cos(k),A=E+200*Math.sin(k),T=E-500,R=t$.runTweenAsync(z(this.node).to(.2*this.twBounceAndFallDuration,{position:new em(C,A,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new em(C,T,this.node.position.z)},{easing:"cubicIn"})),I=[0,360],P=t$.runTweenAsync(z(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new em(0,0,Math.random()*(I[1]-I[0])*(C>g?-1:1))},{easing:"sineOut"}));return[4,Promise.all([R,P])];case 1:L.sent(),this.node.eulerAngles=new em(0,0,0);return[2]}})}),function(){return C.apply(this,arguments)})},{key:"animateFadeIn",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=Math.max(this.scaleUpDuration/4,.01);return[4,t$.runTweenAsync(z(this.uiOpacity).to(g,{opacity:255}))];case 1:E.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"animateScaleUp",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.node.setScale(this.startScale,this.startScale);g=new em(this.endScale,this.endScale,1);return[4,t$.runTweenAsync(z(this.node).to(this.scaleUpDuration,{scale:g},{easing:"cubicOut"}))];case 1:E.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"animateScaleDown",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=new em(0,0,1);return[4,t$.runTweenAsync(z(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:g},{easing:"cubicIn"}))];case 1:E.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}}]),u}(M)).prototype,"shine",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yk=st(yE.prototype,"twScaleUpDuration",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(yE.prototype,"scaleUpDuration",[yf],Object.getOwnPropertyDescriptor(yE.prototype,"scaleUpDuration"),yE.prototype),yC=st(yE.prototype,"twBounceAndFallDuration",[yy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(yE.prototype,"bounceAndFallDuration",[yv],Object.getOwnPropertyDescriptor(yE.prototype,"bounceAndFallDuration"),yE.prototype),yA=st(yE.prototype,"twStartScale",[yg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(yE.prototype,"startScale",[ym],Object.getOwnPropertyDescriptor(yE.prototype,"startScale"),yE.prototype),yT=st(yE.prototype,"twEndScale",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),st(yE.prototype,"endScale",[yw],Object.getOwnPropertyDescriptor(yE.prototype,"endScale"),yE.prototype),yS=yE))||yS)||yS);_._RF.pop(),_._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var yz,yG,yV,yK,yH,yq,yW,yj,yX,yY,yJ,yQ,yZ,y$,y0,y1,y2,y4,y3,y5,y6,y8=k.ccclass,y9=k.property,y7=k.disallowMultiple,ve=GameCore.Utils.Array,vt=(yL=y8("StarParticles"),yO=y9({type:[yx],displayName:"Prebuilt Shining stars"}),yL(yB=y7((yM=st((yN=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"shiningStars",yM,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=this.getFirstAvailableShiningStar();if(void 0===E)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");_=et(g,2),k=_[0],C=_[1],A=new em(k,C,this.node.worldPosition.z);E.node.worldPosition=A;return[4,E.playAnimation()];case 1:T.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return ve.search(this.shiningStars,function(g){return g.isAvailable})}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}}]),i}(M)).prototype,"shiningStars",[yO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yB=yN))||yB)||yB);_._RF.pop(),_._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var vn=k.ccclass,vi=k.property,vr=(yz=vn("EffectManager"),yG=vi({group:"Thunder Effect",type:yP}),yV=vi({group:"Mask Effect",type:ry}),yK=vi({group:"Mask Effect",type:C}),yH=vi({group:"Tornado Effect",type:C}),yq=vi({group:"Clear Particle Effect",type:C,displayName:"Particle holder node"}),yW=vi({group:"Clear Particle Effect",type:yu,displayName:"Emitter 1"}),yj=vi({group:"Clear Particle Effect",type:yu,displayName:"Emitter 2"}),yX=vi({group:"Star Particles Effect",type:vt}),yY=vi({group:"Confetti Effect",type:yu}),yz((yZ=st((yQ=function(g){ze(p,g);var E,_,k,C,A,T,R,I,P,L,O,B=Xe(p);function p(){var g;Fe(this,p);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=B.call.apply(B,[this].concat(_)),"cloud",yZ,Ke(g)),rt(g,"backgroundMask",y$,Ke(g)),rt(g,"masks",y0,Ke(g)),rt(g,"tornado",y1,Ke(g)),g.bombExplosion=null,g.bombExplosionPool=null,g.defuseExplosion=null,g.defuseExplosionPool=null,rt(g,"clearParticleHolder",y2,Ke(g)),rt(g,"clearParticle1",y4,Ke(g)),rt(g,"clearParticle2",y3,Ke(g)),rt(g,"starParticle",y5,Ke(g)),rt(g,"confetti",y6,Ke(g)),g.maskTargets=[],g}return Ue(p,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"update",value:function(){var g=this;this.maskTargets.length>0&&this.maskTargets.forEach(function(E,_){E.isHidden()||(g.masks[_].worldPosition=E.node.worldPosition.clone())})}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(r4.GRID_RESIZE,this.handleBoardResize,this)}},{key:"handleBoardResize",value:function(g){this.clearParticleHolder.setScale(g,g)}},{key:"playClearEffectAt",value:function(g){this.clearParticle1.node.setWorldPosition(new em(g[0].x,g[0].y,1)),this.clearParticle2.node.setWorldPosition(new em(g[1].x,g[1].y,1)),this.clearParticle1.play(),this.clearParticle2.play()}},{key:"playStarEffectAt",value:function(g){this.starParticle.fireShiningStarAt(g)}},{key:"playConfettiEffect",value:function(){var g,E=at(this.confetti);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}}},{key:"playTornadoAnimation",value:(O=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=null===(g=this.tornado.getChildByName("Sprite"))||void 0===g?void 0:g.getComponent(G);if(!(null!==(null==E?void 0:E.defaultClip)))return[3,2];this.tornado.active=!0;_=z(this.tornado);_.set({scale:new em(0,0,0)}),_.delay(.5),_.to(.5,{scale:new em(1,1,1)},{easing:"backOut"}),_.delay(.6),_.to(.3,{scale:new em(0,0,0)},{easing:"quadIn"}),_.set({active:!1}),ii.setBlockInput(!0);return[4,t$.runTweenAsync(_)];case 1:k.sent(),ii.setBlockInput(!1);return[3,3];case 2:console.warn("EffectManager: Tornado animation is not loaded when animation play request was made.");k.label=3;case 3:return[2]}})}),function(){return O.apply(this,arguments)})},{key:"playThunderAnimation",value:(L=Be(function(g,E){var _,k,C,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:this.resetMasks();_=et(g,2),k=et(_[0],2),C=k[0],A=k[1],T=et(_[1],2),R=T[0],I=T[1];this.setMaskProperties(0,C.node.worldPosition,C.node.worldScale),this.setMaskProperties(1,A.node.worldPosition,A.node.worldScale),this.setMaskProperties(2,R.node.worldPosition,R.node.worldScale),this.setMaskProperties(3,I.node.worldPosition,I.node.worldScale),this.maskTargets=[C,A,R,I];return[4,this.setBackgroundMaskActive(!0)];case 1:P.sent(),this.cloud.node.active=!0;return[4,this.cloud.playInitAnimation()];case 2:P.sent();return[4,t$.waitTweenAsync(.2)];case 3:P.sent();return[4,this.performCloudEffectToTiles(C,A,E)];case 4:P.sent();return[4,this.performCloudEffectToTiles(R,I,E)];case 5:P.sent(),this.cloud.node.active=!1;return[4,this.setBackgroundMaskActive(!1)];case 6:P.sent(),this.maskTargets=[];return[2]}})}),function(g,E){return L.apply(this,arguments)})},{key:"performCloudEffectToTiles",value:(P=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:this.shakeGame(),null===(k=$("Vibrate"))||void 0===k||null===(k=k.getComponent(sL))||void 0===k||k.vibrate(500),i9.playSound(ip.THUNDERBOLT),_.clear([[g,E]],"break");return[4,Promise.all([this.cloud.playLightningAnimation(g.node.worldPosition.clone(),0),this.cloud.playLightningAnimation(E.node.worldPosition.clone(),1),this.cloud.playScaleTween()])];case 1:C.sent(),this.node.scene.emit(r4.ADD_COMBO),this.node.scene.emit(r4.ADD_SCORE);return[2]}})}),function(g,E,_){return P.apply(this,arguments)})},{key:"createDefuseExplosionAt",value:(I=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.loadDefuseExplosionPrefab()];case 1:k.sent(),this.defuseExplosionPool||(this.defuseExplosionPool=new cN(this.createDefuseExplosion.bind(this),1,va.getBombDefuseExplosion,va.returnBombDefuseExplosion,va.destroyBombDefuseExplosion));E=this.defuseExplosionPool.alloc();E.setWorldPosition(g);_=E.getComponent(G);return[4,t$.runAnimationAsync(_)];case 2:if(k.sent(),!this.defuseExplosionPool)throw new Error("EffectManager: defuseExplosionPool is null");this.defuseExplosionPool.free(E);return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"createBombExplosionAt",value:(R=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.loadBombExplosionPrefab()];case 1:if(k.sent(),this.bombExplosionPool||(this.bombExplosionPool=new cN(this.createBombExplosion.bind(this),1,vo.getBombExplosion,vo.returnBombExplosion,vo.destroyBombExplosion)),!this.bombExplosionPool)return[3,3];E=this.bombExplosionPool.alloc();E.setWorldPosition(g);_=E.getComponent(G);return[4,t$.runAnimationAsync(_)];case 2:k.sent(),this.bombExplosionPool&&this.bombExplosionPool.free(E);k.label=3;case 3:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(T=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:g&&(this.backgroundMask.node.active=!0);return[4,this.backgroundMask.changeStateFade(g,.25)];case 1:E.sent(),g||(this.backgroundMask.node.active=!1);return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"resetMasks",value:function(){var g,E=at(this.masks);try{for(E.s();!(g=E.n()).done;)g.value.worldPosition=new em(-9999,-9999,0)}catch(g){E.e(g)}finally{E.f()}}},{key:"setMaskProperties",value:function(g,E,_){_&&(this.masks[g].worldScale=_),this.masks[g].worldPosition=E}},{key:"createDefuseExplosion",value:function(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return va.createDefuseExplosion(this.defuseExplosion,this.node)}},{key:"createBombExplosion",value:function(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return vo.createBombExplosion(this.bombExplosion,this.node)}},{key:"loadBombExplosionPrefab",value:(A=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.bombExplosion)return[2,Promise.resolve()];return[4,ii.loadPrefabAsync(nF.BOMB_EXPLODE_PREFAB)];case 1:g=E.sent();return[2,(g&&(this.bombExplosion=g),Promise.resolve())]}})}),function(){return A.apply(this,arguments)})},{key:"loadDefuseExplosionPrefab",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.defuseExplosion)return[2,Promise.resolve()];return[4,ii.loadPrefabAsync(nF.BOMB_DEFUSE_PREFAB)];case 1:g=E.sent();return[2,(g&&(this.defuseExplosion=g),Promise.resolve())]}})}),function(){return C.apply(this,arguments)})},{key:"loadThunderAnimation",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.cloud.loadAnimation()];case 1:g.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadTornadoAnimation",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=null===(g=this.tornado.getChildByName("Sprite"))||void 0===g?void 0:g.getComponent(G);if(null!==(null==E?void 0:E.defaultClip))return[2,Promise.resolve()];return[4,ii.loadAnimClipAsync(nF.TORNADO_IDLE_ANIM)];case 1:_=k.sent();return[2,(_&&(E.defaultClip=_),Promise.resolve())]}})}),function(){return _.apply(this,arguments)})},{key:"shakeGame",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.node.position.clone(),E=z(this.node).to(.05,{position:g.clone().add3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g.clone().subtract3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g});return[4,t$.runTweenAsync(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),p}(M)).prototype,"cloud",[yG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y$=st(yQ.prototype,"backgroundMask",[yV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y0=st(yQ.prototype,"masks",[yK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),y1=st(yQ.prototype,"tornado",[yH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y2=st(yQ.prototype,"clearParticleHolder",[yq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y4=st(yQ.prototype,"clearParticle1",[yW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y3=st(yQ.prototype,"clearParticle2",[yj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y5=st(yQ.prototype,"starParticle",[yX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y6=st(yQ.prototype,"confetti",[yY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yJ=yQ))||yJ),va=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"createDefuseExplosion",value:function(g,E){var _=I(g);return E.addChild(_),_.active=!1,_}},{key:"destroyBombDefuseExplosion",value:function(g){g.destroy()}},{key:"getBombDefuseExplosion",value:function(g){g.active=!0}},{key:"returnBombDefuseExplosion",value:function(g){g.active=!1}}]),e}(),vo=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"createBombExplosion",value:function(g,E){var _=I(g);return E.addChild(_),_.active=!1,_}},{key:"destroyBombExplosion",value:function(g){g.destroy()}},{key:"getBombExplosion",value:function(g){g.active=!0}},{key:"returnBombExplosion",value:function(g){g.active=!1}}]),e}();_._RF.pop(),_._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);var vs=GameCore,vl=vs.Configs,vu=vs.Plugins.Ads,vc=vu.Types,vh=vu.Status,vp=vs.Utils.Array,vf=globalThis.game.ads,vy=function(){function e(){Fe(this,e),this.isAvoidBannerShowed=!1}var g,E,_,k;return Ue(e,[{key:"canbeShowInSDK",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:[],k=arguments.length>1&&void 0!==E?E:[],C=GameSDK.getSDKName();return(null==k||!k.length||!vp.has(k,C))&&!(null!=_&&_.length&&!vp.has(_,C))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"preloadAds",value:(k=Be(function(){var g,E,_,k,C,A,T,R;return _ts_generator(this,function(I){g=vl.Ads,E=g.Enabled,_=g.InterstitialAdOptions,k=g.RewardedVideoAdOptions,C=g.RewardedInterstitialAdOptions;if(E){A=vc.INTERSTITIAL,T=vc.REWARDED_VIDEO,R=vc.REWARDED_INTERSTITIAL;_.forEach(function(g){var E=g.PlacementId;vf.loadAdAsync(A,E).catch(function(){})}),k.forEach(function(g){var E=g.PlacementId;vf.loadAdAsync(T,E).catch(function(){})}),C.forEach(function(g){var E=g.PlacementId;vf.loadAdAsync(R,E).catch(function(){})})}return[2]})}),function(){return k.apply(this,arguments)})},{key:"setAvoidBannerShowed",value:function(g){this._instance.isAvoidBannerShowed=g}},{key:"showBannerAds",value:function(){var g=this,E=vl.Ads,_=E.Enabled,k=E.BannerDisplayAdOptions;if(_&&!this.inst.isAvoidBannerShowed){var C=eb.instance.getVisibleSize(),A=nl.worldSizeToCssSize(C.height*sO);k.forEach(function(E){var _=E.PlacementId,k=E.Position,C=E.BannerHeight;"bottom"===k&&C>A||g.showBannerAd(_)})}}},{key:"hideBannerAds",value:function(){var g=this,E=vl.Ads,_=E.Enabled,k=E.BannerDisplayAdOptions;_&&k.forEach(function(E){var _=E.PlacementId;g.hideBannerAd(_)})}},{key:"showBannerAd",value:function(g){this.inst.isAvoidBannerShowed||vf.showBannerAdAsync(g).catch(function(g){})}},{key:"hideBannerAd",value:function(g){vf.hideBannerAdAsync(g).catch(function(g){})}},{key:"canShowInterstitialAd",value:function(){var g=vf.getAdStatus(vc.INTERSTITIAL)===vh.FILLED;return vf.canbeShowInterstitialAd()&&g}},{key:"canShowRewardedVideoAd",value:function(){return vf.getAdStatus(vc.REWARDED_VIDEO)===vh.FILLED}},{key:"canShowRewardedInterstitialAd",value:function(){return vf.getAdStatus(vc.REWARDED_INTERSTITIAL)===vh.FILLED}},{key:"showInterstitialAdAsync",value:(_=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:E=g.forLevel,_=g.includeSDK,k=g.excludeSDK;if(!this.inst.canbeShowInSDK(_,k))return[2,!1];if(E&&vl.Gameplay.StartAdAtLevel>=E)return[2,!1];if(!vf.canbeShowInterstitialAd())return[2,!1];C=i9.getVolumeMusic();R.label=1;case 1:R.trys.push([1,4,5,6]);i9.muteSound(!0),i9.setVolumeMusic(0,!0);A=vf.getAdStatus(vc.INTERSTITIAL)===vh.FILLED;if(!A)return[3,3];return[4,vf.showAdAsync(vc.INTERSTITIAL)];case 2:A=R.sent();R.label=3;case 3:return[2,!0];case 4:T=R.sent();return[2,(console.warn("showInterstitialAdAsync failed",T),!1)];case 5:Q.resume(),i9.muteAudio(!1),i9.setVolumeMusic(C,!0),vf.loadAdAsync(vc.INTERSTITIAL).catch(function(){});return[7];case 6:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"showRewardVideoAdAsync",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=g.includeSDK,_=g.excludeSDK;if(!this.inst.canbeShowInSDK(E,_))return[2,!1];k=i9.getVolumeMusic();T.label=1;case 1:T.trys.push([1,5,6,7]);i9.muteSound(!0),i9.setVolumeMusic(0,!0),l5.showLoadingScreen();C=vf.getAdStatus(vc.REWARDED_VIDEO)!==vh.FILLED;if(!C)return[3,3];return[4,vf.loadAdAsync(vc.REWARDED_VIDEO)];case 2:C=T.sent();T.label=3;case 3:return[4,vf.showAdAsync(vc.REWARDED_VIDEO)];case 4:return[2,(T.sent(),!0)];case 5:A=T.sent();return[2,(console.warn("showRewardVideoAdAsync failed",A),_instanceof(A,Object)&&"code"in A&&"USER_INPUT"===A.code?l5.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2):l5.showNotificationScreen("No ads to display.",2),!1)];case 6:Q.resume(),l5.closeLoadingScreen(),i9.muteAudio(!1),i9.setVolumeMusic(k,!0),vf.loadAdAsync(vc.REWARDED_VIDEO).catch(function(){});return[7];case 7:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"showRewardedInterstitialAdAsync",value:(g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=g.includeSDK,_=g.excludeSDK;if(!this.inst.canbeShowInSDK(E,_))return[2,!1];k=i9.getVolumeMusic();T.label=1;case 1:T.trys.push([1,5,6,7]);i9.muteSound(!0),i9.setVolumeMusic(0,!0),l5.showLoadingScreen();C=vf.getAdStatus(vc.REWARDED_INTERSTITIAL)!==vh.FILLED;if(!C)return[3,3];return[4,vf.loadAdAsync(vc.REWARDED_INTERSTITIAL)];case 2:C=T.sent();T.label=3;case 3:return[4,vf.showAdAsync(vc.REWARDED_INTERSTITIAL)];case 4:return[2,(T.sent(),!0)];case 5:A=T.sent();return[2,(console.warn("showRewardedInterstitialAdAsync failed",A),!1)];case 6:Q.resume(),l5.closeLoadingScreen(),i9.muteAudio(!1),i9.setVolumeMusic(k,!0),vf.loadAdAsync(vc.REWARDED_INTERSTITIAL).catch(function(){});return[7];case 7:return[2]}})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var vv="newbie",vg="timer",vm="combo",vb="hint-item",vw="thunder-item",vS="storm-item",vE="pliers-item";_._RF.pop(),_._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var v_=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(r4.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(r4.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.on(r4.GRID_RESIZE,this.handleViewResized,this),this.manager.guideSkipButton.active=!0,this.showStep(this.currentStep),this.manager.node.scene.emit(r4.HIDE_UI)}},{key:"showNextStep",value:function(){this.currentStep+1<u5.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(E=Be(function(g){var E,_,k,C,A,T,R,I,P,L,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:E=this.gameplay,_=E.board,k=E.effectManager,C=u5[g].startTile,A=u5[g].endTile,T=_.getTileAt(C.x,C.y),R=_.getTileAt(A.x,A.y);if(!(T&&R))return[3,3];I=T.node.worldPosition,P=R.node.worldPosition;k.resetMasks(),k.setMaskProperties(0,I,T.node.worldScale),k.setMaskProperties(1,P,R.node.worldScale),k.setBackgroundMaskActive(!0);L=this.manager,O=L.guideHand,B=L.guideTextBox;O.node.active=!0,O.playHandAnimation(I,P),this.alignGuideTextBox(),this.alignSkipButton();return[4,B.hide()];case 1:N.sent(),B.setText(u5[g].description);return[4,B.show()];case 2:N.sent(),_.setIgnoreInput(!0),T.setIgnoreInput(!1),R.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1);N.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.gameplay,E=g.board,_=g.effectManager,k=u5[this.currentStep].startTile,C=u5[this.currentStep].endTile,A=E.getTileAt(k.x,k.y),T=E.getTileAt(C.x,C.y);if(A&&T){var R=A.node.worldPosition,I=T.node.worldPosition;_.setMaskProperties(0,R,A.node.worldScale),_.setMaskProperties(1,I,T.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}}},{key:"alignGuideTextBox",value:function(){var g=this.gameplay.board,E=this.manager.guideTextBox,_=g.getTileAt(0,0);if(_){var k=g.tilesHolder.getWorldScale(),C=g.getTileSize()[1]*k.y,A=_.node.worldPosition.y-C/2,T=E.widget.bottom+(A-E.widget.bottom)/2;E.node.setWorldPosition(E.node.worldPosition.x,T,0);var R=Math.max(Math.min(223,.85*(A-E.widget.bottom)),10),I=.7261538461538461*k.x;E.uiTransform.setContentSize(628*I,R)}}},{key:"alignSkipButton",value:function(){var g=this.gameplay.board,E=this.manager.guideSkipButton;if(E){var _=E.parent;if(_){var k=g.getTileAt(g.getGridSize()[0]-1,g.getGridSize()[1]-1);if(k){var C=g.tilesHolder.getWorldScale(),A=g.getTileSize()[1]*C.y,T=k.node.worldPosition.clone().add3f(A/2,A/2,0),I=nl.cssSizeToWorldSize(nl.getScreenHeightCss()),P=T.x-_.getComponent(R).width/2,L=Math.min(T.y+100,I-(I-T.y)/2);_.setWorldPosition(P,L,0)}}}}},{key:"close",value:(g=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=this.gameplay,E=g.board,_=g.effectManager;this.manager.node.scene.off(r4.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(r4.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.off(r4.GRID_RESIZE,this.handleViewResized,this),E.setIgnoreInput(!1);k=Promise.all;return[4,this.manager.guideTextBox.hide()];case 1:C=[A.sent()];return[4,_.setBackgroundMaskActive(!1)];case 2:return[4,k.apply(Promise,[C.concat([A.sent()])])];case 3:A.sent(),this.manager.guideHand.node.active=!1,this.manager.completeGuide(vv);return[2]}})}),function(){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var vk=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.clock,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5;return[4,this.gameplay.handleShowUI()];case 1:P.sent(),E.node.active=!0,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.active=!0,_.string="Remove all tiles before\nthe time end",_.node.setWorldPosition(I.x,I.y-T/2-50,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 2:P.sent(),this.manager.node.scene.once(r4.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r4.PAUSE_TIME),Q.on(t5,this.handleViewResized,this),Q.on(t8,this.handleViewResized,this);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.clock,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.setWorldPosition(I.x,I.y-T/2-50,0)}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideInfoText,_=g.guideMasks;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(r4.RESUME_TIME);return[4,_.hide()];case 1:k.sent(),E.node.active=!1,this.manager.completeGuide(vg),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t5,this.handleViewResized,this),Q.off(t8,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var vC=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.comboContainer,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.node.active=!0,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.active=!0,_.string="Remove tiles continuously\nto increase combo!",_.node.setWorldPosition(I.x-A/2-10,I.y,0),_.horizontalAlign=ez.RIGHT,_.getComponent(R).setAnchorPoint(1,.5);return[4,E.show()];case 1:P.sent(),this.manager.node.scene.once(r4.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r4.PAUSE_TIME),Q.on(t5,this.handleViewResized,this),Q.on(t8,this.handleViewResized,this);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.comboContainer,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.setWorldPosition(I.x-A/2-10,I.y,0)}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideInfoText,_=g.guideMasks;this.manager.node.scene.emit(r4.RESUME_TIME),_.node.off(C.EventType.TOUCH_START,this.close,this);return[4,_.hide()];case 1:k.sent(),E.node.active=!1,this.manager.completeGuide(vm),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t5,this.handleViewResized,this),Q.off(t8,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var vA=GameCore.Utils.Array,vT=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vA.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.HINT});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to reveal a connectable pair",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:P.sent(),this.manager.node.scene.once(r4.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r4.PAUSE_TIME),Q.on(t5,this.handleViewResized,this),Q.on(t8,this.handleViewResized,this);P.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vA.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.HINT});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(r4.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vb),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t5,this.handleViewResized,this),Q.off(t8,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var vR=GameCore.Utils.Array,vI=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vR.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.THUNDER});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to remove 2 pairs",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:P.sent(),this.manager.node.scene.once(r4.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r4.PAUSE_TIME),Q.on(t5,this.handleViewResized,this),Q.on(t8,this.handleViewResized,this);P.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vR.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.THUNDER});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(r4.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vw),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t5,this.handleViewResized,this),Q.off(t8,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var vP=GameCore.Utils.Array,vL=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vP.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.STORM});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to rearrange the tiles",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:P.sent(),this.manager.node.scene.once(r4.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r4.PAUSE_TIME),Q.on(t5,this.handleViewResized,this),Q.on(t8,this.handleViewResized,this);P.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vP.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.STORM});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(r4.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vS),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t5,this.handleViewResized,this),Q.off(t8,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var vO,vB,vN,vM,vD,vF,vU,vx,vz,vG=GameCore.Utils.Array,vV=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vG.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.PLIERS});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to remove bomb",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:P.sent(),this.manager.node.scene.once(r4.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r4.PAUSE_TIME),Q.on(t5,this.handleViewResized,this),Q.on(t8,this.handleViewResized,this);P.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vG.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.PLIERS});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(r4.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vE),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t5,this.handleViewResized,this),Q.off(t8,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var vK,vH,vq,vW,vj,vX,vY,vJ=k.ccclass,vQ=k.property,vZ=(vO=vJ("GuideHand"),vB=vQ(C),vN=vQ(C),vM=vQ(eu),vO((vU=st((vF=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"hand",vU,Ke(g)),rt(g,"circleHighlight",vx,Ke(g)),rt(g,"circleHighlightOpacity",vz,Ke(g)),g}return Ue(n,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(g,E){var _=this;this.handTween&&this.handTween.stop();var k=z(this.hand).to(.8,{worldPosition:E},{easing:"quartOut"}).to(.2,{scale:new em(.9,.9,.9),angle:15}).call(function(){_.playHighlightAnimation()}).to(.2,{scale:em.ONE,angle:0}).to(.8,{worldPosition:g},{easing:"quartOut"}).to(.2,{scale:new em(.9,.9,.9),angle:15}).call(function(){_.playHighlightAnimation()}).to(.2,{scale:em.ONE,angle:0});this.handTween=z(this.hand).repeatForever(k).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),z(this.circleHighlight).to(.6,{scale:new em(1.5,1.5)},{easing:"quadOut"}).start(),z(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(M)).prototype,"hand",[vB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vx=st(vF.prototype,"circleHighlight",[vN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vz=st(vF.prototype,"circleHighlightOpacity",[vM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vD=vF))||vD);_._RF.pop(),_._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var v$,v0,v1,v2,v4,v3,v5=k.ccclass,v6=k.property,v8=(vK=v5("GameMask"),vH=v6(R),vq=v6(eo),vK((vX=st((vj=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"uiTransform",vX,Ke(g)),rt(g,"sprite",vY,Ke(g)),g}return Ue(n,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),n}(M)).prototype,"uiTransform",[vH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vY=st(vj.prototype,"sprite",[vq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vW=vj))||vW);_._RF.pop(),_._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var v9,v7,ge,gt,gn,gi,gr,ga=k.ccclass,go=k.property,gs=k.executeInEditMode,gl=(v$=ga("AlphaMasks"),v0=gs(!0),v1=go(v8),v$(v2=v0((v3=st((v4=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"masks",v3,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent(R)}},{key:"start",value:function(){this.material=this.getComponent(eo).getMaterialInstance(0)}},{key:"update",value:function(){var g=this,E=this.UITransform,_=E.width,k=E.height;this.masks.forEach(function(E,C){var A=E.uiTransform,T=A.width,R=A.height,I=A.anchorX,P=A.anchorY,L=T*E.node.scale.x,O=R*E.node.scale.y,B=new eS(L/_,O/k),N=new eS(.5+(.5-I)*B.x,.5-(.5-P)*B.y),M=new eS(N.x+(E.node.worldPosition.x-g.node.worldPosition.x)/_,N.y-(E.node.worldPosition.y-g.node.worldPosition.y)/k);g.material.setProperty("mask".concat(C,"Texture"),E.texture),g.material.setProperty("ratio".concat(C),B),g.material.setProperty("center".concat(C),M)})}},{key:"setMaskActive",value:function(g,E){g>=this.masks.length||this.material.setProperty("useMask".concat(g),E?1:0)}}]),n}(M)).prototype,"masks",[v1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),v2=v4))||v2)||v2);_._RF.pop(),_._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var gu,gc,gh,gp,gf,gy,gv,gg=k.ccclass,gm=k.property,gb=(v9=gg("GuideMasks"),v7=gm(ry),ge=gm(gl),v9((gi=st((gn=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background",gi,Ke(g)),rt(g,"alphaMasks",gr,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:g.sent(),this.background.node.active=!1;return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(r4.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(g,E,_,k){this.alphaMasks.masks[1].node.worldPosition=new em(-9999,-9999,0);var C=this.alphaMasks.masks[0];this.setMaskTransform(C,g,E,_,k)}},{key:"setItemMaskTransform",value:function(g,E,_,k){this.alphaMasks.masks[0].node.worldPosition=new em(-9999,-9999,0);var C=this.alphaMasks.masks[1];this.setMaskTransform(C,g,E,_,k)}},{key:"setMaskTransform",value:function(g,E,_,k,C){g.uiTransform.setContentSize(k,C),g.node.setWorldPosition(E,_,0)}}]),a}(M)).prototype,"background",[v7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gr=st(gn.prototype,"alphaMasks",[ge],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gt=gn))||gt);_._RF.pop(),_._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var gw,gS,gE,g_,gk,gC,gA,gT,gR,gI,gP,gL,gO,gB=k.ccclass,gN=k.property,gM=(gu=gB("GuideTextBox"),gc=gN(P),gh=gN(H),gu((gy=st((gf=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"guideText",gy,Ke(g)),rt(g,"widget",gv,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.opacityToggler=this.getComponent(ry),nA.lazyValidateProperties(this)}},{key:"setText",value:function(g){this.guideText.string=g}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.opacityToggler.changeStateFade(!0)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.opacityToggler.changeStateFade(!1)];case 1:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"guideText",[gc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gv=st(gf.prototype,"widget",[gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gp=gf))||gp);_._RF.pop(),_._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var gD,gF,gU,gx,gz,gG,gV,gK,gH,gq,gW,gj,gX,gY,gJ,gQ,gZ,g$,g0,g1=game,g2=g1.player,g4=g1.analytics,g3=k.ccclass,g5=k.property,g6=GameCore,g8=g6.Match.Modes,g9=g6.Plugins.Analytics.Events,g7=g6.Utils.Array,me=new eS(0,10),mt=new eS(0,10),mn="READY",mi="RUNNING",mr=(gw=g3("GuidelinesManager"),gS=g5(vZ),gE=g5(gM),g_=g5(P),gk=g5(gb),gC=g5(C),gw((gR=st((gT=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"guideHand",gR,Ke(g)),rt(g,"guideTextBox",gI,Ke(g)),rt(g,"guideInfoText",gP,Ke(g)),rt(g,"guideMasks",gL,Ke(g)),rt(g,"guideSkipButton",gO,Ke(g)),g.guideHintDelay=null,g.guideStormDelay=null,g}return Ue(i,[{key:"init",value:function(g){this.gameplay=g,this.status=mn,this.node.scene.on(r4.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(r4.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(r4.USE_ITEM,this.handleUseItem,this),this.node.scene.on(r4.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(r4.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(r4.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(vv)&&this.resetGuideItemShowed(),this.startGuide(vv)):this.startGuide(vg)}},{key:"startGuide",value:function(g){if(this.status===mi)return!1;if(this.hasGuideItemShowed(g))return!1;switch(this.addGuideItemShowed(g),this.status=mi,g){case vv:g4.event(g9.TUTORIAL_BEGIN),this.guide1=new v_(this),this.guide1.setup();break;case vg:this.guide2=new vk(this),this.guide2.setup();break;case vm:this.guide3=new vC(this),this.guide3.setup();break;case vb:this.guide4=new vT(this),this.guide4.setup();break;case vw:this.guide5=new vI(this),this.guide5.setup();break;case vS:this.guide6=new vL(this),this.guide6.setup();break;case vE:this.guide7=new vV(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(g){g4.event(g9.TUTORIAL_STEP,{step:g}),this.status=mn,this.addGuideItemShowed(g),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){var g=this.getCurrentLevel(),E=me.x,_=me.y;return g>=E&&g<=_}},{key:"isShowErrorPathLevel",value:function(){if(lT.getMatchMode()===g8.TOURNAMENT)return!1;var g=this.getCurrentLevel(),E=mt.x,_=mt.y;return g>=E&&g<=_}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(g){return g7.has(this.getGuideItemShowed(),g)}},{key:"addGuideItemShowed",value:function(g){if(!this.hasGuideItemShowed(g)){var E=this.getGuideItemShowed();E.push(g),g2.setGameData({guideItemShowed:E})}}},{key:"resetGuideItemShowed",value:function(){g2.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var g,E;return null!==(g=null===(E=g2.getGameData())||void 0===E?void 0:E.guideItemShowed)&&void 0!==g?g:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(g){this.isNewbieGuideLevel()||g<2||(this.startGuide(vm),this.node.scene.off(r4.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var g=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=z(this.node).delay(5).call(function(){g.isNewbieGuideLevel()||(g.hasGuideItemShowed(vb)&&g.status===mn?g.node.scene.emit(r4.SHOW_HINT):g.startGuide(vb),g.startHintGuide())})),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var g=this;null===this.guideStormDelay&&(this.guideStormDelay=new eG(this.node).delay(10).call(function(){if(!g.isNewbieGuideLevel()&&!g.hasGuideItemShowed(vS)){var E=g7.search(g.gameplay.itemManager.items,function(g){return g.itemType===sN.STORM});E&&E.canActivate()&&(g.startGuide(vS)||g.startStormGuide())}})),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(vw)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(vE)}},{key:"handleUseItem",value:function(g){switch(this.startAutoGuides(),g){case sN.HINT:this.addGuideItemShowed(vb);break;case sN.THUNDER:this.addGuideItemShowed(vw);break;case sN.STORM:this.addGuideItemShowed(vS);break;case sN.PLIERS:this.addGuideItemShowed(vE)}}},{key:"skipNewbieGuide",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.guideSkipButton.active=!1;return[4,this.guide1.close()];case 1:E.sent();g=this.getCurrentLevel()+1;g2.setGameData({level:g}),this.node.scene.emit(r4.NEXT_LEVEL),vy.showBannerAds();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onDestroy",value:function(){var g,E,_,k,C,A;null===(g=this.guide2)||void 0===g||g.unlistenEvents(),null===(E=this.guide3)||void 0===E||E.unlistenEvents(),null===(_=this.guide4)||void 0===_||_.unlistenEvents(),null===(k=this.guide5)||void 0===k||k.unlistenEvents(),null===(C=this.guide6)||void 0===C||C.unlistenEvents(),null===(A=this.guide7)||void 0===A||A.unlistenEvents()}}]),i}(M)).prototype,"guideHand",[gS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gI=st(gT.prototype,"guideTextBox",[gE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gP=st(gT.prototype,"guideInfoText",[g_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gL=st(gT.prototype,"guideMasks",[gk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gO=st(gT.prototype,"guideSkipButton",[gC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gA=gT))||gA);_._RF.pop(),_._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var ma,mo=k.ccclass,ms=k.property,ml=(gD=mo("SpecialItem"),gF=ms({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),gU=ms({type:B,tooltip:"The button that activates the item"}),gx=ms({type:V,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),gz=ms({type:P,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),gG=ms({type:C,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),gV=ms({type:C,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),gK=ms({type:eu,group:"Animation"}),gH=ms({type:eu,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),gD((gj=st((gW=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"isDevButton",gj,Ke(g)),rt(g,"button",gX,Ke(g)),rt(g,"quantity",gY,Ke(g)),rt(g,"quantityLabel",gJ,Ke(g)),rt(g,"quantityNode",gQ,Ke(g)),rt(g,"plusNode",gZ,Ke(g)),rt(g,"glowUIOpacity",g$,Ke(g)),rt(g,"uiOpacity",g0,Ke(g)),g.requestItem=null,g.loadQuantity=null,g}return Ue(o,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"init",value:function(g){var E=this;this.node.scene.on(r4.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(r4.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(r4.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(r4.GRID_SPAWN,this.applyActivationStatus,this),this.node.scene.on(r4.BOMB_EXPLODE,this.applyActivationStatus,this),this.node.scene.on(r4.IDLE_EXIT,function(){E.button.interactable=!1,E.applyActivationStatus()}),this.node.scene.on(r4.IDLE_ENTER,function(){E.button.interactable=!0,E.applyActivationStatus()})}},{key:"start",value:function(){var g=this.loadQuantity();this.setQuantity(g)}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"applyActivationStatus",value:(k=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:null===(g=this.signal)||void 0===g||g.abort();E=new nD;this.signal=E;_=this.canActivate();this.button.interactable=_;return[4,t$.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:_?255:128}),E)];case 1:k.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"activate",value:(_=Be(function(){return _ts_generator(this,function(g){this.quantity<=0?this.requestItem():(this.vibrate(),this.setQuantity(this.quantity-1));return[2]})}),function(){return _.apply(this,arguments)})},{key:"canActivate",value:function(){return!1}},{key:"setQuantity",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=g;if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();k=Math.max(0,k),this.quantity=k,this.quantityLabel.string="".concat(this.quantity),k<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),_&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}},{key:"getQuantity",value:function(){return this.quantity}},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;this.isDevButton||k&&this.setQuantity(_,k.animate)}},{key:"vibrate",value:function(){var g;null===(g=$("Vibrate"))||void 0===g||null===(g=g.getComponent(sL))||void 0===g||g.vibrate(50)}},{key:"animateAddItem",value:(E=Be(function(){return _ts_generator(this,function(g){return[2,(this.glowUIOpacity.opacity=0,Promise.all([t$.runTweenAsync(z(this.node).to(.1,{scale:new em(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:em.ONE},{easing:"elasticOut"})),t$.runTweenAsync(z(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))]))]})}),function(){return E.apply(this,arguments)})}]),o}(M)).prototype,"isDevButton",[gF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gX=st(gW.prototype,"button",[gU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gY=st(gW.prototype,"quantity",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gJ=st(gW.prototype,"quantityLabel",[gz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gQ=st(gW.prototype,"quantityNode",[gG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gZ=st(gW.prototype,"plusNode",[gV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g$=st(gW.prototype,"glowUIOpacity",[gK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g0=st(gW.prototype,"uiOpacity",[gH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gq=gW))||gq);_._RF.pop(),_._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var mu,mc=(0,k.ccclass)("ItemManager")(ma=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).sceneItems=new Set,g}return Ue(n,[{key:"items",get:function(){return tt(this.sceneItems)}},{key:"onLoad",value:function(){this.syncItems()}},{key:"syncItems",value:function(){var g=$("Canvas/UI");if(g){var E,_=at(g.getComponentsInChildren(ml));try{for(_.s();!(E=_.n()).done;){var k=E.value;k.node.activeInHierarchy&&this.sceneItems.add(k)}}catch(g){_.e(g)}finally{_.f()}}}}]),n}(M))||ma;_._RF.pop(),_._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var mh,mp=k.ccclass,md=GameCore.Utils,mf=md.Device,my=md.Array,mv=globalThis.game.monitorError,mg={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},mm=mp("LevelManager")(mu=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){return Fe(this,r),A.apply(this,arguments)}return Ue(r,[{key:"loadLevel",value:(C=Be(function(){var g,E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:g=T.length>0&&void 0!==T[0]?T[0]:1,E=T.length>1?T[1]:void 0;return[4,this.loadLevelData(g)];case 1:_=R.sent();this.levelData=_||this.levelData||mg;k=this.levelData,C=k.rows,A=k.columns;return[2,(mf.isMobile()&&A>=6&&C>=10&&(this.levelData.columns=5,this.levelData.rows=10),null==mv||mv.addMetadata({level:g}),this.getLevelSpriteFrames(g,E))]}})}),function(){return C.apply(this,arguments)})},{key:"loadLevelData",value:(k=Be(function(){var g,E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:g=A.length>0&&void 0!==A[0]?A[0]:1,E=10,_=this.paddingZero("".concat(Math.floor(g/E)+1),3),k=g%E;return[4,ii.loadJsonAsync("".concat(nF.LEVEL_DATA_FOLDER,"/").concat(_))];case 1:C=T.sent();return[2,C?C[k]:null]}})}),function(){return k.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"getLevelSpriteFrames",value:(_=Be(function(g,E){var _,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:if(!(E&&X.random()<=.5))return[3,2];_=lh.getThemeSkins(E),k=_[X.randomRangeInt(0,_.length)];return[4,this.loadSkinFrames(k)];case 1:return[2,I.sent()];case 2:C=lh.getLevelSkins(g);if(!(C.length>1))return[3,4];return[4,this.loadSkinFrames(C)];case 3:return[2,I.sent()];case 4:A=C[0],T=lh.getUnlockedSkins();if(T.length>1&&X.random()<=.5){R=T.filter(function(g){return g!==A});A=R[X.randomRangeInt(0,R.length)]}return[4,this.loadSkinFrames(A)];case 5:return[2,I.sent()]}})}),function(g,E){return _.apply(this,arguments)})},{key:"loadSkinFrames",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!Array.isArray(g))return[3,2];E=g.map(function(){var g=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E="".concat(nF.TILE_SKIN_FOLDER,"/").concat(g);return[4,ii.loadSpriteFramesDirAsync(E)];case 1:return[2,_.sent()]}})});return function(E){return g.apply(this,arguments)}}());_=my.flatten;return[4,Promise.all(E)];case 1:return[2,_.apply(my,[C.sent()])];case 2:k="".concat(nF.TILE_SKIN_FOLDER,"/").concat(g);return[4,ii.loadSpriteFramesDirAsync(k)];case 3:return[2,C.sent()]}})}),function(g){return E.apply(this,arguments)})},{key:"paddingZero",value:function(g,E){for(var _="",k=0;k<E-g.length;k++)_+="0";return _+g}}]),r}(M))||mu;_._RF.pop(),_._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var mb=k.ccclass,mw=GameCore.Match.Modes,mS=mb("ScoreManager")(mh=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).currentScore=0,g.tournamentStartScore=0,g}return Ue(i,[{key:"addScore",value:function(g,E,_){var k=this.getLevelMultiplier(g),C=this.getComboMultiplier(E),A=this.getTimeMultiplier(g,_),T=Math.floor(this.currentScore+10*k*C*A),R=10*Math.ceil(T/10);this.setScore(R)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var g=lT.getMatchMode();this.currentScore=g===mw.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(g){this.currentScore=g,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"resetTournamentStartScore",value:function(){this.tournamentStartScore=0}},{key:"updateScore",value:(E=Be(function(){return _ts_generator(this,function(g){this.node.scene.emit(r4.SCORE_UPDATED,this.currentScore);return[2]})}),function(){return E.apply(this,arguments)})},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(g){return 1+.1*(g-1)}},{key:"getComboMultiplier",value:function(g){return 1+.1*(g-1)}},{key:"getTimeMultiplier",value:function(g,E){return g<=2?4:1+.05*E}}]),i}(M))||mh;_._RF.pop(),_._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var mE=function(){function e(g){Fe(this,e),this.game=null,this.data={},this.game=g.getGameplay(),this.manager=g,this.updateStateData(),this.logDebug()}return Ue(e,[{key:"logDebug",value:function(){var g=this.constructor.name;console.info("[STATE] ".concat(g),this.data)}},{key:"updateStateData",value:function(){if(this.game){var g=this.game.getGameData();g&&(this.data=g)}}},{key:"updateGameData",value:function(g){var E;null===(E=this.game)||void 0===E||E.setGameData(g)}}]),e}();_._RF.pop(),_._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var m_=globalThis.game,mk=m_.analytics,mC=m_.match,mA=m_.storage,mT=GameCore,mR=mT.Match.Modes,mI=mT.Dtos.Match.Data,mP=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(g,E){var _;return Fe(this,r),_=A.call(this,g),i9.stopAllSounds(),_.vibrateDevice(),_.pauseCountdown(),_.updateMatchCustomData(),_.handleGameOver(E),_.logLevelFailAnalytics(),_}return Ue(r,[{key:"pauseCountdown",value:function(){var g;null===(g=this.game)||void 0===g||g.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var g;null===(g=$("Vibrate"))||void 0===g||null===(g=g.getComponent(sL))||void 0===g||g.vibrate(500)}},{key:"handleGameOver",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=lT.getMatchMode();if(ii.setBlockInput(!0),E===mR.SINGLE)return[3,5];if(E!==mR.TOURNAMENT)return[3,2];return[4,this.handleTournamentGameOver()];case 1:_.sent();return[3,4];case 2:if(E!==mR.CHALLENGE_FRIEND)return[2,void this.showFailScreen(g)];return[4,this.handleChallengeGameOver()];case 3:_.sent();_.label=4;case 4:ii.setBlockInput(!1);return[3,6];case 5:this.showFailScreen(g);_.label=6;case 6:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(k=Be(function(){var g,E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=this;if(!this.game)return[3,5];k=(null!==(g=lT.getMatchCustomData())&&void 0!==g?g:{}).tournamentId;if(!k)return[3,5];if(ua.validateTournamentExpired(k))return[2,(mA.setStorageData("tournament","animateTournamentLeader",!1),l5.showNotificationScreen("Tournament has ended",2),void(null===(C=this.game)||void 0===C||C.scheduleOnce(function(){var g;null===(g=_.game)||void 0===g||g.node.scene.emit(r4.GAME_EXIT)},2)))];I.label=1;case 1:I.trys.push([1,3,,4]);A=mA.getStorageData("tournament","previousScore"),T=this.game.scoreManager.getCurrentScore()>A;mA.setStorageData("tournament","animateTournamentLeader",T);return[4,lT.finishMatchAsync()];case 2:I.sent();return[3,4];case 3:R=I.sent();console.warn(R);return[3,4];case 4:null===(E=this.game)||void 0===E||E.node.scene.emit(r4.GAME_EXIT);I.label=5;case 5:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.game)return[3,6];C.label=1;case 1:C.trys.push([1,4,,5]);g=mC.getMatchState().id;return[4,mC.api.getMatchAPI().getMatchDetailByIdAsync(g)];case 2:E=C.sent(),_=new mI(E).toObject().extraData;return[4,lT.finishMatchAsync({extraData:null!=_?_:void 0})];case 3:C.sent();return[3,5];case 4:k=C.sent();console.warn(k);return[3,5];case 5:this.game.node.scene.emit(r4.SHOW_CHALLENGE_RESULTS);C.label=6;case 6:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"showFailScreen",value:(E=Be(function(g){var E;return _ts_generator(this,function(_){E=this.data.level;g===us&&i9.playSound(ip.LEVEL_FAIL_TIMEOUT),i9.playSound(ip.LEVEL_FAIL),l5.openScreen(iw.RESCUES_SCREEN,{level:E,failKey:g});return[2]})}),function(g){return E.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var g;if(this.game){var E=this.data.level,_=void 0===E?1:E,k=null===(g=this.game)||void 0===g?void 0:g.scoreManager.getCurrentScore();lT.updateMatchStateAfterLevelFinish(_,k)}}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=this.game.scoreManager.getCurrentScore(),k=lT.getMatchMode()||void 0;mk.levelFail(E,_,k)}}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var g=this.manager.createPlayingState(this.manager);this.manager.change(g)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}},{key:"update",value:function(){}}]),r}(mE);_._RF.pop(),_._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var mL=globalThis.game,mO=mL.analytics,mB=mL.player,mN=mL.leaderboard,mM=mL.match,mD=GameCore,mF=mD.Match.Modes,mU=mD.Utils.Time,mx=function(g){ze(u,g);var E,_,k,C,A,T,R,I=Xe(u);function u(g){var E;return Fe(this,u),(E=I.call(this,g)).handleFinishStateFlow(),E}return Ue(u,[{key:"handleFinishStateFlow",value:(R=Be(function(){var g;return _ts_generator(this,function(E){if(this.game){this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),this.game.uiManager.pauseTime();g=lT.getMatchMode();g!==mF.CHALLENGE_FRIEND&&g!==mF.TOURNAMENT&&this.updatePlayerProgress(),this.updateMatchCustomData(),g===mF.CHALLENGE_FRIEND?this.handleFinishChallenge():g===mF.TOURNAMENT?this.handleFinishTournament():this.handleFinishSingle(),this.logLevelCompleteAnalytics()}return[2]})}),function(){return R.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"attemptCallCreateShortcut",value:function(){var g=this.data.level;(void 0===g?0:g)<2||vy.canShowInterstitialAd()||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(g){console.warn("createShortcutAsync",g)})}},{key:"updatePlayerProgress",value:function(){if(this.game){var g=this.data.level;if(g){var E=g+1,_=mB.getGameData();if(_){var k=_.totalLevel,C=_.level,A=Math.max(C,E),T=Me({},_);A<k&&(T.level=A),mB.setGameData(T)}}}}},{key:"updateMatchCustomData",value:function(){if(this.game){var g=this.data.level,E=void 0===g?1:g,_=this.game.scoreManager.getCurrentScore();lT.updateMatchStateAfterLevelFinish(E,_)}}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=this.game.scoreManager.getCurrentScore(),k=lT.getMatchMode()||void 0;mO.levelComplete(E,_,k)}}},{key:"handleFinishChallenge",value:(T=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!this.game)return[3,7];k.label=1;case 1:k.trys.push([1,4,,6]);g=mM.getMatchState().id;return[4,lT.getMatchExtraDataAsync(g)];case 2:E=k.sent();return[4,lT.finishMatchAsync({extraData:null!=E?E:void 0})];case 3:k.sent();return[3,6];case 4:_=k.sent();console.warn(_);return[4,lT.finishMatchAsync()];case 5:k.sent();return[3,6];case 6:this.game.node.scene.emit(r4.SHOW_CHALLENGE_RESULTS);k.label=7;case 7:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"handleFinishTournament",value:(A=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.handlePostTournamentScore(),!this.game)return[3,4];g=this.data.level,E=void 0===g?1:g;i9.playSound(ip.LEVEL_COMPLETE,{volume:.5}),this.game.effectManager.playConfettiEffect();return[4,mU.sleepAsync(500)];case 1:k.sent();_=vy.canShowInterstitialAd();if(!_)return[3,3];return[4,vy.showInterstitialAdAsync({forLevel:E})];case 2:_=k.sent();k.label=3;case 3:this.game.node.scene.emit(r4.NEXT_LEVEL);k.label=4;case 4:return[2]}})}),function(){return A.apply(this,arguments)})},{key:"handlePostTournamentScore",value:(C=Be(function(){var g,E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:if(!this.game)return[3,7];E=null===(g=this.game)||void 0===g?void 0:g.scoreManager.getCurrentScore();if(!E)return[3,7];R.label=1;case 1:R.trys.push([1,3,,4]);return[4,GameSDK.tournament.postScoreAsync(E)];case 2:R.sent();return[3,4];case 3:_=R.sent();console.warn("GameSDK post score async",_);return[3,4];case 4:k=lT.getMatchCustomData();if(!k)return[3,7];C=k.leaderboardId,A=k.playerId;T=C&&A;if(!T)return[3,6];return[4,mN.setLeaderboardScoreAsync(C,A,E)];case 5:T=R.sent();R.label=6;case 6:R.label=7;case 7:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleFinishSingle",value:(k=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:i9.turnUpMusic();g=this.data.level,E=void 0===g?0:g;if(!(E>0&&E%5==0))return[3,2];return[4,this.handleFinishHardLevel()];case 1:_.sent();return[3,4];case 2:return[4,this.handleFinishNormalLevel()];case 3:_.sent();_.label=4;case 4:this.handleNextLevelSingle();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"handleFinishNormalLevel",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:A=this.data.level,T=void 0===A?0:A,R=null!==(g=null===(E=mB.getGameData())||void 0===E?void 0:E.coins)&&void 0!==g?g:0,I=null!==(_=null===(k=lT.getMatchCustomData())||void 0===k?void 0:k.score)&&void 0!==_?_:0;P=vy.canShowInterstitialAd();if(!P)return[3,3];return[4,null===(C=this.game)||void 0===C?void 0:C.uiManager.interstitialAdIndicator.flash()];case 1:L.sent();return[4,vy.showInterstitialAdAsync({forLevel:T})];case 2:P=L.sent();L.label=3;case 3:i9.playSound(ip.LEVEL_COMPLETE,{volume:.5});return[4,l5.openScreenAndWaitForClose(iw.LEVEL_COMPLETE_SCREEN,{level:T,coins:R,score:I,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!1})];case 4:L.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleFinishHardLevel",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,P,L,O,B,N,M;return _ts_generator(this,function(D){switch(D.label){case 0:T=this.data.level,R=void 0===T?0:T,I=null!==(g=null===(E=mB.getGameData())||void 0===E?void 0:E.coins)&&void 0!==g?g:0,P=null!==(_=null===(k=lT.getMatchCustomData())||void 0===k?void 0:k.score)&&void 0!==_?_:0;L=vy.canShowInterstitialAd();if(!L)return[3,3];return[4,null===(A=this.game)||void 0===A?void 0:A.uiManager.interstitialAdIndicator.flash()];case 1:D.sent();return[4,vy.showInterstitialAdAsync({forLevel:R})];case 2:L=D.sent();D.label=3;case 3:i9.playSound(ip.LEVEL_COMPLETE,{volume:.5});return[4,l5.openScreenAndWaitForClose(iw.LEVEL_COMPLETE_SCREEN,{level:R,coins:I,score:P,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!0})];case 4:O=D.sent().screenData,B=(null!=O?O:{}).canShowRewardsAd;if(!(void 0!==B&&B))return[3,7];return[4,l5.openScreenAndWaitForClose(iw.GET_REWARDS_SCREEN)];case 5:N=D.sent().screenData,M=null!==(C=null==N?void 0:N.getRewardsSuccess)&&void 0!==C&&C;M&&this.getRewardItems();return[4,l5.openScreenAndWaitForClose(iw.LEVEL_COMPLETE_SCREEN,{level:R,coins:I,score:P,getRewardsSuccess:M,lookingForRewards:!1})];case 6:D.sent();D.label=7;case 7:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleNextLevelSingle",value:function(){var g=this.data.level,E=mB.getGameData();this.game&&g&&E&&(g>=E.totalLevel?this.game.node.scene.emit(r4.MAX_LEVEL):this.game.node.scene.emit(r4.NEXT_LEVEL))}},{key:"getRewardItems",value:function(){this.game&&(this.game.node.scene.emit(r4.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.STORM,quantity:1}),this.game.node.scene.emit(r4.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.THUNDER,quantity:1}))}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),u}(mE);_._RF.pop(),_._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var mz=globalThis.game,mG=mz.player,mV=mz.match,mK=GameCore.Match.Modes,mH=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(g){var E;return Fe(this,l),(E=R.call(this,g)).clearBoard(),E.loadLevel(),E.initCountdown(),E.initScore(),E}return Ue(l,[{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.board.clearAnimationQueue(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(T=Be(function(){var g,E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:if(!this.game)return[3,8];g=lT.getMatchMode();R.label=1;case 1:R.trys.push([1,6,,8]);if(g!==mK.CHALLENGE_FRIEND)return[3,3];return[4,this.loadChallengeFriendMode()];case 2:E=R.sent(),_=E.frames,k=E.extraData;i9.playSound(ip.LEVEL_START),this.handleChallengeFriendModeStart(_,k);return[3,5];case 3:return[4,this.loadSingleMode()];case 4:C=R.sent();i9.playSound(ip.LEVEL_START),g===mK.SINGLE?this.handleSingleModeStart(C):g===mK.TOURNAMENT&&this.handleTournamentModeStart(C);R.label=5;case 5:return[3,8];case 6:A=R.sent();console.error("Error loading level:",A);return[4,this.loadSingleMode()];case 7:T=R.sent();i9.playSound(ip.LEVEL_START),this.handleSingleModeStart(T);return[3,8];case 8:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"loadChallengeFriendMode",value:(A=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:g=mV.getMatchState().id;return[4,lT.getMatchExtraDataAsync(g)];case 1:E=C.sent();if(!E)throw new Error("Match mode ".concat(mK.CHALLENGE_FRIEND," but no extraData (for opponent initialization) was found in match data."));_=this.game.levelManager;return[4,_.loadLevel(E.level)];case 2:k=C.sent();return[2,(this.updateGameData({level:E.level,levelData:_.getLevelData()}),{frames:k,extraData:E})]}})}),function(){return A.apply(this,arguments)})},{key:"loadSingleMode",value:(C=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.game.levelManager;return[4,g.loadLevel(this.data.level,this.data.themeId)];case 1:E=_.sent();return[2,(this.updateGameData({levelData:g.getLevelData()}),E)]}})}),function(){return C.apply(this,arguments)})},{key:"handleChallengeFriendModeStart",value:(k=Be(function(g,E){var _,k,C,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:if(!this.game)return[3,3];_=this.game.levelManager.getLevelData(),k=E.level,C=E.fen,A=E.gravity,T=E.rules,R=E.time,I=mG.getPlayerId();return[4,Promise.all([lT.setMatchCustomDataAsync({level:k,score:0}),lT.setProfileMatchDataAsync({id:I,score:0})])];case 1:P.sent(),this.game.board.create(g,Me(Me({},_),{},{level:k,customFen:C,mode:A,rules:T,time:R})),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:P.sent(),this.game.board.setIgnoreInput(!1),this.ready();P.label=3;case 3:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleSingleModeStart",value:(_=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:if(!this.game)return[3,6];_=this.game.levelManager.getLevelData(),k=this.data.level,C=mG.getPlayerId();return[4,Promise.all([lT.setMatchCustomDataAsync({level:k,score:0}),lT.setProfileMatchDataAsync({id:C,score:0})])];case 1:T.sent(),this.game.board.create(g,_),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:T.sent(),null!==(E=this.game.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1);A=k&&k>0&&k%5==0;if(!A)return[3,5];l5.openScreen(iw.HARD_LEVEL_SCREEN);return[4,t$.waitTweenAsync(1.3)];case 3:T.sent(),l5.closeScreen(iw.HARD_LEVEL_SCREEN);return[4,this.game.board.animateTilesWave()];case 4:A=T.sent();T.label=5;case 5:this.ready();T.label=6;case 6:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"handleTournamentModeStart",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!this.game)return[3,3];_=this.game.levelManager.getLevelData(),k=this.data.level,C=mG.getPlayerId();return[4,Promise.all([lT.setMatchCustomDataAsync({level:k}),lT.setProfileMatchDataAsync({id:C})])];case 1:A.sent(),this.game.board.create(g,_),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:A.sent(),null!==(E=this.game.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),this.ready();A.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.init()}},{key:"initCountdown",value:function(){this.game&&this.game.uiManager.initCountdown()}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var g=this.manager.createReadyState(this.manager);this.manager.change(g)}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),l}(mE);_._RF.pop(),_._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var mq=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),(_=E.call(this,g)).startCountdown(),_}return Ue(n,[{key:"startCountdown",value:function(){var g;null===(g=this.game)||void 0===g||g.uiManager.startCountdown()}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){var g=this.manager.createReadyState(this.manager);this.manager.change(g)}},{key:"playing",value:function(){}},{key:"fail",value:function(g){var E=this.manager.createFailState(this.manager,g);this.manager.change(E)}},{key:"finish",value:function(){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}},{key:"update",value:function(){this.updateStateData()}}]),n}(mE);_._RF.pop(),_._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var mW,mj=globalThis.game,mX=mj.analytics,mY=(mj.match,GameCore.Utils.Valid),mJ=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),_=E.call(this,g),i9.stopAllSounds(),i9.turnDownMusic(),_.handleGuideFlow(),_.setLevelText(),_.setLevelTime(),_.setGridPlayable(),_.logLevelStartAnalytics(),_}return Ue(n,[{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var g=this.manager.createPlayingState(this.manager);this.manager.change(g)}},{key:"fail",value:function(g){if(mY.isDebugger()){var E=this.manager.createFailState(this.manager);this.manager.change(E)}}},{key:"finish",value:function(){if(mY.isDebugger()){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var g;null!==(g=this.manager.getGameplay().guidelinesManager)&&void 0!==g&&g.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var g,E;this.game&&(null!==(g=this.game.guidelinesManager)&&void 0!==g&&g.isNewbieGuideLevel()||this.game.handleShowUI(),null===(E=this.game.guidelinesManager)||void 0===E||E.show())}},{key:"setLevelTime",value:function(){if(this.game){var g=this.data.levelData;g&&this.game.uiManager.setCountdownTime(g.time)}}},{key:"setLevelText",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g;this.game.uiManager.setLevelText(E)}}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=(lT.getMatchCustomData()||{}).score,k=void 0===_?0:_,C=lT.getMatchMode()||void 0;mX.levelStart(E,k,C)}}}]),n}(mE);_._RF.pop(),_._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var mQ,mZ,m$,m0,m1,m2,m4,m3,m5,m6=(0,k.ccclass)("StateManager")(mW=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(g){this.gameplay=g,this.state=new mH(this)}},{key:"change",value:function(g){this.state=g}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return _instanceof(this.state,mH)}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return _instanceof(this.state,mJ)}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return _instanceof(this.state,mq)}},{key:"fail",value:function(g){this.state.fail(g)}},{key:"isFail",value:function(){return _instanceof(this.state,mP)}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return _instanceof(this.state,mx)}},{key:"update",value:function(g){this.state&&this.state.update(g)}},{key:"createInitializeState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mH,E)}},{key:"createReadyState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mJ,E)}},{key:"createPlayingState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mq,E)}},{key:"createFailState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mP,E)}},{key:"createFinishState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mx,E)}}]),n}(M))||mW;_._RF.pop(),_._RF.push({},"2b89dXjcudIaZRJFuh5TAAI","InterstitialAdIndicator",void 0);var m8=k.ccclass,m9=k.property,m7=["Short ad break, hang tight!","Back to the game in just a sec!","Quick ad, then more fun!"];var be,bt,bn,bi,br,ba=(mQ=m8("InterstitialAdIndicator"),mZ=nA.required(),m$=m9(eu),m0=nA.required(),m1=m9(P),mQ((m3=st((m4=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"uiOpacity",m3,Ke(g)),rt(g,"label",m5,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){nA.decorateComponent(this)}},{key:"flash",value:(E=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:null===(g=this.signal)||void 0===g||g.abort();_=new nD;this.signal=_,this.label.string=(E=Math.floor(Math.random()*m7.length),m7[E]);k=z(this.uiOpacity).to(.25,{opacity:255},{easing:"linear"}).delay(.25).to(.25,{opacity:100},{easing:"linear"}).delay(.125);return[4,t$.runTweenAsync(z(this.uiOpacity).repeat(2,k).to(.25,{opacity:0},{easing:"linear"}),_)];case 1:C.sent(),this.uiOpacity.opacity=0;return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"uiOpacity",[mZ,m$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m5=st(m4.prototype,"label",[m0,m1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m2=m4))||m2);_._RF.pop(),_._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);var bo,bs,bl,bu,bc,bh,bp,bf=k.ccclass,by=k.property,bv=(be=bf("Digit"),bt=by(P),be((br=st((bi=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"numberLabels",br,Ke(g)),g.labelUITransforms=[],g.labelUIOpacitys=[],g.previousNumber=0,g}return Ue(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.labelUITransforms=this.numberLabels.map(function(g){return g.getComponent(R)}),this.labelUIOpacitys=this.numberLabels.map(function(g){return g.getComponent(eu)}),nA.lazyValidateProperties(this)}},{key:"setNumber",value:function(g){this.previousNumber!==g&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[g].node.active||(this.numberLabels[g].node.active=!0),this.labelUIOpacitys[g].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[g].contentSize),this.previousNumber=g)}}]),n}(M)).prototype,"numberLabels",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bn=bi))||bn);_._RF.pop(),_._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var bg,bm=k.ccclass,bb=k.disallowMultiple,bw=k.property,bS=(bo=bm("Clock"),bs=bw(C),bl=bw(bv),bo(bu=bb((bh=st((bc=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"clockIcon",bh,Ke(g)),rt(g,"digits",bp,Ke(g)),g.time=0,g.remaining=0,g.running=!1,g.halfTime=!1,g.handleUpdateConfig=function(E){g.enabled&&console.log("Clock: handleUpdateConfig",E)},g.refillTime=function(){var E=Date.now(),_=z(g.node).to(.5,{scale:new em(1.1,1.1,1)}),k=z(g.node).to(.5,{scale:new em(1,1,1)}),C=z(g.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),A=z(g.clockIcon).repeat(5,C),T=z(g.node).to(3,{position:new em(0,0,0)},{onUpdate:function(){var _=Date.now(),k=(_-E)/3e3>1?1:(_-E)/3e3,C=X.lerp(0,120,k);g.setTime(C)}}).call(function(){g.setTime(120),k.start(),g.node.scene.emit(r4.RESCUE_FINISHED)});z(g.node).parallel(_,T).start(),A.start()},g}return Ue(n,[{key:"__preload",value:function(){this.listenEvents()}},{key:"start",value:function(){this.init()}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"listenEvents",value:function(){this.node.scene.on(t9,this.handleUpdateConfig),this.node.scene.on(r4.RESCUE_START,this.refillTime)}},{key:"setTime",value:function(g){this.time=g,this.updateTimeLabel(g),this.remaining=g}},{key:"getRemainingTime",value:function(){return this.remaining}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(r4.TIME_OUT)}},{key:"update",value:function(g){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=g,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(r4.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}},{key:"updateTimeLabel",value:function(g){for(var E=this.convertSecondsToMmSs(g),_=0;_<E.length;_++)this.digits[_].setNumber(Number.parseInt(E[_]))}},{key:"convertSecondsToMmSs",value:function(g){var E=Math.floor(g/60),_=Math.floor(g%60),k=this.padZero(E),C=this.padZero(_);return"".concat(k).concat(C)}},{key:"padZero",value:function(g){return g<10?"0".concat(g):"".concat(g)}}]),n}(M)).prototype,"clockIcon",[bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bp=st(bc.prototype,"digits",[bl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bu=bc))||bu)||bu);_._RF.pop(),_._RF.push({},"dfab8xSeglD/abIKphEhi4g","ComboContainer",void 0);var bE,b_=k.ccclass,bk=GameCore.Match.Modes,bC=b_("ComboContainer")(bg=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"__preload",value:function(){this.widget=this.node.getComponent(H)}},{key:"onLoad",value:function(){nA.lazyValidateProperties(this)}},{key:"updateStatus",value:function(){lT.getMatchMode()===bk.TOURNAMENT?this.widget.top=180:this.widget.top=160}}]),n}(M))||bg;_._RF.pop(),_._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var bA=k.ccclass,bT=bA("ComboProgressBar")(bE=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"start",value:function(){this.progressBar=this.getComponent(ou),this.opacity=this.getComponent(eu),this.comboTimer=0,this.isActive=!1,this.node.scene.on(r4.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(g){this.isActive&&(this.comboTimer>0?(this.comboTimer-=g,this.progressBar.progress=this.comboTimer/2):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(r4.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(g){0===g?this.opacity.opacity=0:g>0&&(this.isActive=!0,this.comboTimer=2),g>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),n}(M))||bE;_._RF.pop(),_._RF.push({},"af947t5g91EkZVWXv5upZaV","CacheUtils",void 0);var bR,bI,bP,bL,bO,bB,bN,bM=GameCore.Utils.Image,bD=globalThis.game.frameCapture,bF=function(){function e(){Fe(this,e)}var g,E,_;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getPlayerAvatar",value:(_=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:C=this.playerAvatarCache.get("".concat(E,":").concat(_));A=C;if(A)return[3,2];return[4,this.loadPlayerAvatar(g,E,_,k)];case 1:A=C=T.sent();T.label=2;case 2:return[2,C]}})}),function(g,E,k,C){return _.apply(this,arguments)})},{key:"loadPlayerAvatar",value:(E=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:return[4,this.loadImage(g,_,_,"".concat(E,":").concat(_))];case 1:C=T.sent();if((null==k||!k.aborted)&&C){A=ea.createWithImage(C);return[2,(this.playerAvatarCache.set("".concat(E,":").concat(_),A),A)]}return[2]}})}),function(g,_,k,C){return E.apply(this,arguments)})},{key:"isAvatarCached",value:function(g,E){return this.playerAvatarCache.has("".concat(g,":").concat(E))}},{key:"loadImage",value:(g=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:T.trys.push([0,5,,6]);return[4,bD.captureAsync({width:E,height:_,name:"LeaderAvatar",renderOptions:Ge({},k,{name:k,type:"image",depth:0,position:[0,0],size:[E,_],image:g})})];case 1:C=T.sent();if(!C)return[3,3];return[4,bM.loadImage(C)];case 2:A=T.sent();return[3,4];case 3:A=null;T.label=4;case 4:return[2,A];case 5:T.sent();return[2,null];case 6:return[2]}})}),function(E,_,k,C){return g.apply(this,arguments)})}]),e}();bF.playerAvatarCache=new Map;try{new bF}catch(g){console.error("CacheUtils",g)}_._RF.pop(),_._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var bU,bx,bz,bG,bV,bK,bH,bq=k.ccclass,bW=k.property,bj=k.disallowMultiple,bX=(bR=bq("ScoreBlock"),bI=bW(P),bP=bW(K),bR(bL=bj((bB=st((bO=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"scoreText",bB,Ke(g)),rt(g,"maxScoreWidth",bN,Ke(g)),g.panelWidthDiff=0,g}return Ue(a,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(R),this.scoreUITransform=this.scoreText.node.getComponent(R),this.panelWidthDiff=this.uiTransform.width-this.maxScoreWidth,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"updateScore",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=g-this.score,k=z(this.node).to(.1,{},{onUpdate:function(g,k){if(k){var C=Math.floor(_*k)+E.score;E.scoreText.string=C.toString(),E.resizeWidth()}}});return[4,t$.runTweenAsync(k)];case 1:C.sent(),this.setScore(g);return[4,this.resizeWidth()];case 2:C.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"setScore",value:function(g){var E=null!=g?g:0;this.score=E,this.scoreText.string=E.toString()}},{key:"resizeWidth",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this,E=this.uiTransform.width,_=(this.scoreUITransform.width>this.maxScoreWidth?this.scoreUITransform.width:this.maxScoreWidth)+this.panelWidthDiff;this.uiTween&&this.uiTween.stop(),this.uiTween=z(this.node).to(.05,{},{easing:"sineOut",onUpdate:function(k,C){C&&(g.uiTransform.width=X.lerp(E,_,C))}});return[4,t$.runTweenAsync(this.uiTween)];case 1:k.sent(),this.uiTransform.width=_;return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"scoreText",[bI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bN=st(bO.prototype,"maxScoreWidth",[bP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bL=bO))||bL)||bL);_._RF.pop(),_._RF.push({},"424745QWUlDPabdCe8UcRwy","ChallengeScoreBlock",void 0);var bY,bJ,bQ,bZ,b$,b0,b1,b2,b4,b3=k.ccclass,b5=k.property,b6=(bU=b3("ChallengeScoreBlock"),bx=b5(eo),bz=b5(ea),bU((bK=st((bV=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"avatar",bK,Ke(g)),rt(g,"defaultAvatar",bH,Ke(g)),g}return Ue(i,[{key:"updateInfo",value:(E=Be(function(g,E,_){var k,C;return _ts_generator(this,function(A){switch(A.label){case 0:k=this;this.setScore(_),this.scheduleOnce(function(){return k.resizeWidth()},0);A.label=1;case 1:A.trys.push([1,3,,4]);return[4,bF.getPlayerAvatar(g,E,50)];case 2:C=A.sent();if(!C)return[2];C.packable=!0,this.avatar.spriteFrame=C;return[3,4];case 3:A.sent();this.avatar.spriteFrame=this.defaultAvatar;return[3,4];case 4:return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),i}(bX)).prototype,"avatar",[bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bH=st(bV.prototype,"defaultAvatar",[bz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bG=bV))||bG);_._RF.pop(),_._RF.push({},"f963aJjCvtD0Y2LplwjDer1","ScoreContainer",void 0);var b8,b9,b7,we,wt,wn,wi,wr,wa,wo,ws,wl=k.ccclass,wu=k.property,wc=GameCore.Match.Modes,wh=globalThis.game.match,wp=(bY=wl("ScoreContainer"),bJ=wu(bX),bQ=wu(b6),bZ=wu(b6),bY((b1=st((b0=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"scoreBlock",b1,Ke(g)),rt(g,"playerScoreBlock",b2,Ke(g)),rt(g,"opponentScoreBlock",b4,Ke(g)),g.scoreBlockShown=!1,g.challengeScoreBlockShown=!1,g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}},{key:"listenGameEvents",value:function(){this.node.scene.on(r4.SCORE_UPDATED,this.updateScore,this)}},{key:"unlistenGameEvents",value:function(){this.node.scene.off(r4.SCORE_UPDATED,this.updateScore,this)}},{key:"updateStatus",value:function(){var g=wh.getMatchState().mode;g===wc.CHALLENGE_FRIEND?(this.showChallengeScoreBlock(),this.hideScoreBlock()):g===wc.SINGLE&&(this.hideChallengeScoreBlock(),this.showScoreBlock())}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"showChallengeScoreBlock",value:function(){var g;if(!this.challengeScoreBlockShown){this.challengeScoreBlockShown=!0;var E=wh.getMatchState(),_=null!==(g=lT.getMatchCustomData())&&void 0!==g?g:{},k=_.playerId,C=_.opponentId;if(k&&C){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var A=E.profiles[k],T=E.profiles[C];this.playerScoreBlock.updateInfo(A.photo,k,A.score),this.opponentScoreBlock.updateInfo(T.photo,C,T.score)}}}},{key:"hideChallengeScoreBlock",value:function(){this.challengeScoreBlockShown&&(this.challengeScoreBlockShown=!1,this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1)}},{key:"showScoreBlock",value:function(){var g;if(!this.scoreBlockShown){this.scoreBlockShown=!0;var E=(null!==(g=lT.getMatchCustomData())&&void 0!==g?g:{}).score;this.scoreBlock.node.active=!0,this.scoreBlock.setScore(E)}}},{key:"hideScoreBlock",value:function(){this.scoreBlockShown&&(this.scoreBlockShown=!1,this.scoreBlock.node.active=!1)}},{key:"updateScore",value:function(g){this.challengeScoreBlockShown?this.playerScoreBlock.updateScore(g):this.scoreBlockShown&&this.scoreBlock.updateScore(g)}}]),n}(M)).prototype,"scoreBlock",[bJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b2=st(b0.prototype,"playerScoreBlock",[bQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b4=st(b0.prototype,"opponentScoreBlock",[bZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b$=b0))||b$);_._RF.pop(),_._RF.push({},"540108ucKBPYbN9gW5TFh/q","LeaderRail",void 0);var wd,wf,wy,wv,wg,wm=k.ccclass,wb=k.property,ww=(b8=wm("LeaderRail"),b9=wb(P),b7=wb(C),we=wb(eo),wt=wb(yu),b8((wr=st((wi=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"scoreLabel",wr,Ke(g)),rt(g,"crown",wa,Ke(g)),rt(g,"avatar",wo,Ke(g)),rt(g,"spark",ws,Ke(g)),g.score=0,g}return Ue(a,[{key:"__preload",value:function(){this.defaultAvatar=this.avatar.spriteFrame,this.uiOpacity=this.getComponent(eu)}},{key:"updateScore",value:(_=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this,k=g-this.score,C=z(this.node).to(.5,{},{onUpdate:function(g,E){if(E){var C=Math.floor(k*E)+_.score;_.scoreLabel.string=C.toString()}}});return[4,t$.runTweenAsync(C,E)];case 1:A.sent(),this.score=g,this.scoreLabel.string=g.toString();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"updatePhoto",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=GameSDK.player.getPhoto(),E=GameSDK.player.getID();if(!(g&&E))return[3,2];return[4,bF.getPlayerAvatar(g,E,50)];case 1:_=k.sent();_?(_.packable=!0,this.avatar.spriteFrame=_):this.avatar.spriteFrame=this.defaultAvatar;k.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setCrown",value:function(g){this.crown.active=g}},{key:"setOpacity",value:function(g){this.uiOpacity.opacity=g}},{key:"playSparkParticle",value:function(){this.spark.play()}},{key:"stopSparkParticle",value:function(){this.spark.stop()}}]),a}(M)).prototype,"scoreLabel",[b9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wa=st(wi.prototype,"crown",[b7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wo=st(wi.prototype,"avatar",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ws=st(wi.prototype,"spark",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wn=wi))||wn);_._RF.pop(),_._RF.push({},"00759vwS/dHS6GvHKvVE5Q1","TournamentProgressBar",void 0);var wS,wE,w_,wk,wC,wA,wT,wR,wI,wP,wL,wO,wB,wN,wM,wD=k.ccclass,wF=k.property,wU=474,wx=(wd=wD("TournamentProgressBar"),wf=wF(ww),wd((wg=st((wv=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"playerLeader",wg,Ke(g)),g.onUpdate=function(){g.playerLeader&&g.playerLeader.node&&(g.playerLeader.node.position=new em(g.progressBar.progress*wU-237,0,0))},g}return Ue(i,[{key:"__preload",value:function(){this.progressBar=this.getComponent(ew)}},{key:"updateProgress",value:(E=Be(function(g,E){var _,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:_=A.length>2&&void 0!==A[2]?A[2]:.5,k=A.length>3&&void 0!==A[3]?A[3]:"cubicOut",C=z(this.progressBar).to(_,{progress:g},{easing:k,onUpdate:this.onUpdate});return[4,t$.runTweenAsync(C,E)];case 1:T.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"getProgress",value:function(){return this.progressBar.progress}}]),i}(M)).prototype,"playerLeader",[wf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wy=wv))||wy);_._RF.pop(),_._RF.push({},"16d68fBLT1Ha7lXADThDtfC","TournamentRail",void 0);var wz,wG,wV,wK,wH,wq,wW,wj,wX,wY,wJ,wQ,wZ,w$,w0,w1,w2,w4=k.ccclass,w3=k.property,w5=GameCore,w6=w5.Utils,w8=w6.Array,w9=w6.Object,w7=w5.Match.Modes,Se=globalThis.game.player,St=(wS=w4("TournamentRail"),wE=w3(wx),w_=w3(ww),wk=w3(C),wC=w3(C),wA=w3(P),wT=w3(P),wS((wP=st((wI=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"progressBar",wP,Ke(g)),rt(g,"playerLeader",wL,Ke(g)),rt(g,"flag",wO,Ke(g)),rt(g,"sword",wB,Ke(g)),rt(g,"currentRank",wN,Ke(g)),rt(g,"nextRank",wM,Ke(g)),g.nextLeaderIndex=0,g.leaderData=[],g.score=0,g.minScore=0,g.maxScore=0,g.signal=new nD,g.isInited=!1,g}return Ue(s,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu)}},{key:"init",value:function(g){var E=this,_=Se.getPlayerId();this.leaderData=w9.vals(g.leaders).reduce(function(g,E){if(E.playerId!==_&&E.score>0){var k={score:E.score,rank:E.rank};g.push(k)}return g},[]),this.leaderData.sort(function(g,E){return g.score-E.score}),this.leaderData.forEach(function(g,_){g.rank=E.leaderData.length-_}),this.playerLeader.updatePhoto(),this.isInited=!0}},{key:"updateStatus",value:(A=Be(function(){var g;return _ts_generator(this,function(E){if(lT.getMatchMode()===w7.TOURNAMENT){this.signal.abort();g=new nD;this.signal=g,this.uiOpacity.opacity=255,this.node.scene.on(r4.SCORE_UPDATED,this.handleScoreUpdated,this),this.nextLeaderIndex=this.getScoreReachedLeaderIndex(this.score),this.syncRail(g,!0)}else this.uiOpacity.opacity=0;return[2]})}),function(){return A.apply(this,arguments)})},{key:"syncRail",value:(C=Be(function(g){var E,_,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:E=I.length>1&&void 0!==I[1]&&I[1],_=this.leaderData[this.nextLeaderIndex-1],k=this.leaderData[this.nextLeaderIndex],C=_?_.rank:k?k.rank+1:1;this.setRankLabel(C,this.currentRank);A=!k;this.nextRank.node.active=!A,this.runActiveAnimation(this.sword,!A,g),this.playerLeader.setCrown(A),this.playerLeader.updateScore(this.score,g);T=E?0:void 0;if(!A)return[3,2];this.playerLeader.playSparkParticle();return[4,this.progressBar.updateProgress(1,g,T)];case 1:P.sent();return[3,4];case 2:this.playerLeader.stopSparkParticle(),this.setRankLabel(k.rank,this.nextRank),this.minScore=_?_.score:0,this.maxScore=k.score;R=(this.score-this.minScore)/(this.maxScore-this.minScore);R=.8*R+.1;return[4,this.progressBar.updateProgress(R,g,T)];case 3:P.sent();P.label=4;case 4:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"handleScoreUpdated",value:(k=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(this.score!==g))return[3,4];this.signal.abort();E=new nD;if(this.signal=E,this.score=g,!this.isInited)return[3,4];_=this.getScoreReachedLeaderIndex(g);if(!(_>this.nextLeaderIndex))return[3,3];this.nextLeaderIndex=_;k=(1-this.progressBar.getProgress())/1.5;k=Math.min(k,.5);return[4,this.progressBar.updateProgress(1,E,k,"cubicIn")];case 1:C.sent(),this.runBubbleAnimation(this.sword,E);return[4,this.progressBar.updateProgress(0,E,0)];case 2:C.sent(),this.runBubbleAnimation(this.flag,E);C.label=3;case 3:this.syncRail(E);C.label=4;case 4:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"runBubbleAnimation",value:(_=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.scale=em.ONE;_=z(g).to(.1,{scale:new em(1.2,1.2,1.2)}).to(.2,{scale:em.ONE},{easing:"backOut"});return[4,t$.runTweenAsync(_,E)];case 1:k.sent(),g.scale=em.ONE;return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"runActiveAnimation",value:(E=Be(function(g,E,_){var k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:k=E?em.ZERO:em.ONE,C=E?em.ONE:em.ZERO;if(!!g.scale.equals(C))return[3,2];A=E?"backOut":"quadOut";g.scale=k;T=z(g).to(.1,{scale:new em(1.2,1.2,1.2)}).to(.2,{scale:C},{easing:A});return[4,t$.runTweenAsync(T,_)];case 1:R.sent(),g.scale=C;R.label=2;case 2:return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"getScoreReachedLeaderIndex",value:function(g){var E=w8.searchIndex(this.leaderData,function(E){return E.score>=g});return -1===E?this.leaderData.length:E}},{key:"setRankLabel",value:function(g,E){var _="";_=1===g?"No.1":2===g?"2nd":3===g?"3rd":"".concat(g,"th"),E.string=_}}]),s}(M)).prototype,"progressBar",[wE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wL=st(wI.prototype,"playerLeader",[w_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wO=st(wI.prototype,"flag",[wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wB=st(wI.prototype,"sword",[wC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wN=st(wI.prototype,"currentRank",[wA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wM=st(wI.prototype,"nextRank",[wT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wR=wI))||wR);_._RF.pop(),_._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var Sn,Si,Sr,Sa,So,Ss=k.ccclass,Sl=k.property,Su=(wz=Ss("Header"),wG=Sl(P),wV=Sl(C),wK=Sl(C),wH=Sl(C),wq=Sl(C),wW=Sl(wp),wj=Sl(St),wz((wJ=st((wY=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"levelText",wJ,Ke(g)),rt(g,"settingNode",wQ,Ke(g)),rt(g,"homeNode",wZ,Ke(g)),rt(g,"leftNode",w$,Ke(g)),rt(g,"coinNode",w0,Ke(g)),rt(g,"scoreContainer",w1,Ke(g)),rt(g,"tournamentRail",w2,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"updateStatus",value:function(){this.scoreContainer.updateStatus(),this.tournamentRail.updateStatus()}},{key:"handleClickedPauseGame",value:function(){this.showPauseScreen(),this.node.scene.emit(r4.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){l5.openScreen(iw.QUIT_LEVEL_SCREEN),this.node.scene.emit(r4.GAME_PAUSE)}},{key:"highlightCoinContainer",value:function(){var g=$("Canvas/Screens");if(g){var E=this.coinNode.worldPosition.clone();this.coinNode.parent=g,this.coinNode.worldPosition=E}}},{key:"removeCoinContainerHighlight",value:function(){var g=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=g}},{key:"showPauseScreen",value:function(){l5.openScreen(iw.PAUSE_SCREEN,{})}},{key:"setLevelText",value:function(g){this.levelText.string="Level ".concat(g)}},{key:"setButtonsSelectable",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.enableBtnNode(this.settingNode,E,!0),this.enableBtnNode(this.homeNode,E,!0)}},{key:"enableBtnNode",value:function(g,E,_){var k=g.getComponent(B);if(k&&(k.interactable=E),g.active=_,_)g.getComponent(ry)}},{key:"setActive",value:function(g){this.uiOpacity.opacity=g?255:0}}]),n}(M)).prototype,"levelText",[wG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wQ=st(wY.prototype,"settingNode",[wV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wZ=st(wY.prototype,"homeNode",[wK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w$=st(wY.prototype,"leftNode",[wH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w0=st(wY.prototype,"coinNode",[wq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w1=st(wY.prototype,"scoreContainer",[wW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w2=st(wY.prototype,"tournamentRail",[wj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wX=wY))||wX);_._RF.pop(),_._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var Sc=k.ccclass,Sh=k.property,Sp=(Sn=Sc("UIMasks"),Si=Sh(ry),Sn((So=st((Sa=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background",So,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:g.sent(),this.background.node.active=!1;return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"background",[Si],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sr=Sa))||Sr);_._RF.pop(),_._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var Sf,Sy,Sv,Sg,Sm,Sb="bomb";_._RF.pop(),_._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var Sw,SS,SE,S_,Sk,SC,SA,ST,SR,SI,SP,SL,SO,SB,SN,SM,SD,SF,SU,Sx,Sz,SG=GameCore,SV=SG.Dtos.Player,SK=SG.Utils.Function,SH=k.ccclass,Sq=k.property,SW=globalThis.game.player,Sj=(Sf=SH("DevToolsContainer"),Sy=Sq(C),Sf((Sm=st((Sg=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"devToolsToggle",Sm,Ke(g)),g.isActive=!0,g.game=null,g.bundleName="lowest",g.debouncedStarsNotification=SK.debounce(function(){var g=SW.getGameData();g&&l5.showNotificationScreen("Stars added. Current stars: ".concat(g.stars))},700),g}return Ue(o,[{key:"injectGameplay",value:function(g){this.game=g}},{key:"hideAllButtons",value:function(){var g,E=at(this.getComponentsInChildren(B));try{for(E.s();!(g=E.n()).done;){var _=g.value.node.parent;_&&_.name!==this.devToolsToggle.name&&(_.active=!1)}}catch(g){E.e(g)}finally{E.f()}}},{key:"showAllButtons",value:function(){var g,E=at(this.getComponentsInChildren(B));try{for(E.s();!(g=E.n()).done;){var _=g.value.node.parent;_&&_.name!==this.devToolsToggle.name&&(_.active=!0)}}catch(g){E.e(g)}finally{E.f()}}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){SW.setPlayerData(SV.Data.getDefaultData()),l5.openScreen(iw.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(r4.START_OVER,0)}},{key:"handleNextLevel",value:(k=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){k=(null!==(g=null===(E=this.game)||void 0===E||null===(E=E.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:1)+1;null===(_=this.game)||void 0===_||_.setGameData({level:k-1}),SW.setGameData({level:k}),this.node.scene.emit(r4.NEXT_LEVEL);return[2]})}),function(){return k.apply(this,arguments)})},{key:"handlePrevLevel",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){k=Math.max((null!==(g=null===(E=this.game)||void 0===E||null===(E=E.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:2)-1,1);null===(_=this.game)||void 0===_||_.setGameData({level:k-1}),SW.setGameData({level:k}),this.node.scene.emit(r4.NEXT_LEVEL);return[2]})}),function(){return _.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(k){_=Number(g.string);null===(E=this.game)||void 0===E||E.setGameData({level:_-1}),SW.setGameData({level:_}),this.node.scene.emit(r4.NEXT_LEVEL);return[2]})}),function(g){return E.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var g=globalThis.game.getBuildVersion();l5.showNotificationScreen("Build version: ".concat(g))}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(r4.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){this.node.scene.emit(r4.TIME_OUT)}},{key:"handleClickExplodeButton",value:function(){var g,E,_=this.game;if(_){var k=null===(g=_.getGameData())||void 0===g||null===(g=g.levelData)||void 0===g?void 0:g.specials.bomb;if(k&&!(k<=0)){var C=_.board.getBombTiles();if(0!==C.length){var A=C[0];if((null===(E=A.special)||void 0===E?void 0:E.type)!==Sb)throw new Error("Invalid bomb tile");A.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(r4.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.HINT,quantity:2}),this.node.scene.emit(r4.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.STORM,quantity:2}),this.node.scene.emit(r4.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.THUNDER,quantity:2}),this.node.scene.emit(r4.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(r4.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var g=SW.getGameData();g&&(SW.setGameData({stars:g.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchQualityAssets",value:function(){switch(this.bundleName){case"lowest":this.bundleName="highest";break;case"highest":this.bundleName="lowest"}Q.emit(no,{quality:this.bundleName})}}]),o}(M)).prototype,"devToolsToggle",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sv=Sg))||Sv);_._RF.pop(),_._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var SX,SY,SJ,SQ,SZ,S$,S0,S1,S2=k.ccclass,S4=k.property,S3=GameCore.Utils.Valid,S5=(Sw=S2("UIManager"),SS=S4(ba),SE=S4(bS),S_=S4(Su),Sk=S4(Sj),SC=S4(bT),SA=S4(bC),ST=S4(Sp),SR=S4([C]),SI=S4([C]),Sw((SO=st((SL=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"interstitialAdIndicator",SO,Ke(g)),rt(g,"clock",SB,Ke(g)),rt(g,"header",SN,Ke(g)),rt(g,"devTools",SM,Ke(g)),rt(g,"comboProgressBar",SD,Ke(g)),rt(g,"comboContainer",SF,Ke(g)),rt(g,"uiMasks",SU,Ke(g)),rt(g,"topAnimNodes",Sx,Ke(g)),g.originTopNodesPos=[],rt(g,"botAnimNodes",Sz,Ke(g)),g.originBotNodesPos=[],g.hideBotWorldY=-80,g.entranceSignal=new nD,g.exitSignal=new nD,g.showDevTools=function(){g.devTools&&(g.devTools.node.active=!0)},g}return Ue(r,[{key:"onLoad",value:function(){var g=this;this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),N.once(e_.EVENT_AFTER_UPDATE,function(){g.saveOriginPos(),g.initUIPos()})}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var g,E=at(this.topAnimNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value;this.originTopNodesPos.push(_.position.clone())}}catch(g){E.e(g)}finally{E.f()}var k,C=at(this.botAnimNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value;this.originBotNodesPos.push(A.position.clone())}}catch(g){C.e(g)}finally{C.f()}}},{key:"initUIPos",value:function(){var g=this;this.topAnimNodes.forEach(function(E,_){var k=g.originTopNodesPos[_].clone();k.y+=200,E.setPosition(k)});var E=new em(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(function(_,k){var C,A,T=g.originBotNodesPos[k].clone();E.y=g.hideBotWorldY;var R=null!==(C=null===(A=_.parent)||void 0===A?void 0:A.inverseTransformPoint(E,E).y)&&void 0!==C?C:200;T.y=R,_.setPosition(T)})}},{key:"listensDevToolsEvents",value:function(){this.node.scene.on(sH.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}},{key:"listenRescueEvents",value:function(){this.node.scene.on(r4.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(r4.RESCUE_FINISHED,this.hideRescueAnimation,this)}},{key:"initDevTools",value:function(g){var E=this;window.addEventListener("reset-game-data",function(){var g;null===(g=E.devTools)||void 0===g||g.handleResetData()}),this.devTools&&(this.devTools.node.active=S3.isDebugger(),this.devTools.injectGameplay(g))}},{key:"setLevelText",value:function(g){this.header.setLevelText(g)}},{key:"initCountdown",value:function(){this.clock.init()}},{key:"setCountdownTime",value:function(g){this.clock.setTime(g)}},{key:"startCountdown",value:function(){this.clock.startCountdown(),this.comboProgressBar.resume()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause(),this.clock.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume(),this.clock.resume()}},{key:"setComboUI",value:function(g){this.comboContainer.getComponent(ry).changeStateFade(g,.1)}},{key:"disableHeader",value:function(){this.header.setButtonsSelectable(!1)}},{key:"enableHeader",value:function(){this.header.setButtonsSelectable()}},{key:"updateStatus",value:function(){this.header.updateStatus(),this.comboContainer.updateStatus()}},{key:"showRescueAnimation",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.uiMasks.show()];case 1:g.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"hideRescueAnimation",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.uiMasks.hide()];case 1:g.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"playExitAnimUI",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I,P,L;return _ts_generator(this,function(O){switch(O.label){case 0:g=this;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new nD;E=[];this.topAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originTopNodesPos[k].y+200,0),A=z(_);A.to(.17,{position:C},{easing:"backIn"}),E.push(t$.runTweenAsync(A,g.exitSignal))});k=new em(0,this.hideBotWorldY,0),C=at(this.botAnimNodes);try{for(C.s();!(_=C.n()).done;){R=_.value;k.y=this.hideBotWorldY;I=null!==(A=null===(T=R.parent)||void 0===T?void 0:T.inverseTransformPoint(k,k).y)&&void 0!==A?A:200,P=new em(R.position.x,I,0),L=z(R);L.to(.17,{position:P},{easing:"backIn"}),E.push(t$.runTweenAsync(L,this.exitSignal))}}catch(g){C.e(g)}finally{C.f()}return[4,Promise.all(E)];case 1:O.sent(),this.exitSignal.aborted||this.header.setActive(!1);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new nD,this.header.setActive(!0);E=[];this.topAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originTopNodesPos[k].y,0),A=z(_);A.to(.2,{position:C},{easing:"backOut"}),E.push(t$.runTweenAsync(A,g.entranceSignal))}),this.botAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originBotNodesPos[k].y,0),A=z(_);A.to(.2,{position:C},{easing:"backOut"}),E.push(t$.runTweenAsync(A,g.entranceSignal))});return[4,Promise.all(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"setInteractableItemButtons",value:function(g){var E,_=!(arguments.length>0&&void 0!==g)||g,k=at(this.botAnimNodes);try{for(k.s();!(E=k.n()).done;){var C=E.value,A=C.getComponent(ml);if(A){if(!_){A.button.interactable=!1;continue}A.canActivate()&&(A.button.interactable=!0)}}}catch(g){k.e(g)}finally{k.f()}}}]),r}(M)).prototype,"interstitialAdIndicator",[SS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SB=st(SL.prototype,"clock",[SE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SN=st(SL.prototype,"header",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SM=st(SL.prototype,"devTools",[Sk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SD=st(SL.prototype,"comboProgressBar",[SC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SF=st(SL.prototype,"comboContainer",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SU=st(SL.prototype,"uiMasks",[ST],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sx=st(SL.prototype,"topAnimNodes",[SR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Sz=st(SL.prototype,"botAnimNodes",[SI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SP=SL))||SP);_._RF.pop(),_._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var S6=globalThis.game,S8=S6.player,S9=S6.ads,S7=S6.event,Ee=S6.match,Et=S6.storage,En=S6.analytics,Ei=S6.monitorError,Er=S6.frameCapture,Ea=S6.leaderboard,Eo=GameCore,Es=Eo.Events,El=Eo.Utils,Ec=El.Time,Eh=El.Array,Ep=Eo.Configs.Gameplay,Ed=Eo.Match.Modes,Ef=k.ccclass,Ey=k.property,Ev=[];SX=Ef("Gameplay"),SY=Ey(cS),SJ=Ey(ry),SQ=Ey(hn),SX((S$=st((SZ=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"board",S$,Ke(g)),rt(g,"opacityToggler",S0,Ke(g)),rt(g,"pathDraw",S1,Ke(g)),g.gameData=null,g.defaultData={level:1,isFromLoader:!1},g.rescueTiles=[],g.isAutoPlayEnabled=!1,g.handleOpenScreen=function(E){E.screenName===iS[iw.GET_ITEM_SCREEN]&&g.uiManager.highlightCoinContainer()},g.handleShowUI=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.uiManager.updateStatus(),g.uiManager.disableHeader(),g.uiManager.setInteractableItemButtons(!1);return[4,g.uiManager.playEntranceAnimUI()];case 1:E.sent(),g.uiManager.enableHeader(),g.uiManager.setInteractableItemButtons(!0);return[2]}})}),g.handleHideUI=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.uiManager.disableHeader(),g.uiManager.setInteractableItemButtons(!1);return[4,g.uiManager.playExitAnimUI()];case 1:E.sent();return[2]}})}),g.handleCloseScreen=function(E){E.screenName===iS[iw.GET_ITEM_SCREEN]&&g.uiManager.unHighlightCoinContainer()},g.handlePauseGame=function(){g.node.scene.emit(r4.PAUSE_TIME),g.node.pauseSystemEvents(!0),g.opacityToggler.changeStateFade(!1,.1),g.uiManager.setComboUI(!1),g.processCrazyGamesGameplayStop()},g.handleResumeGame=function(){var E;g.node.resumeSystemEvents(!0),g.stateManager.isPlaying()&&g.node.scene.emit(r4.RESUME_TIME),g.processCrazyGamesGameplayStart(),g.opacityToggler.changeStateFade(!0,.1),g.uiManager.setComboUI(!0),null===(E=g.guidelinesManager)||void 0===E||E.startAutoGuides()},g.handleReplayGame=Be(function(){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g.handleHideHint();A.label=1;case 1:A.trys.push([1,6,,7]);E=lT.getMatchMode();_=E===Ed.SINGLE;if(!_)return[3,3];return[4,lT.finishMatchAsync()];case 2:_=A.sent();A.label=3;case 3:k=E!==Ed.CHALLENGE_FRIEND;if(!k)return[3,5];return[4,lT.startMatchAsync()];case 4:k=A.sent();A.label=5;case 5:E===Ed.TOURNAMENT&&(g.scoreManager.resetTournamentStartScore(),g.setGameData({level:1}));return[3,7];case 6:C=A.sent();console.warn("handleReplayGame",C);return[3,7];case 7:g.stateManager.initialize();return[2]}})}),g.handleFinishGame=function(){var E;g.attemptCallCreateShortcut(),null!==(E=g.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()?(g.guidelinesManager.guideSkipButton.active=!1,g.handleNextLevel()):g.stateManager.finish()},g.handleNextLevel=Be(function(){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!g.gameData)return[3,12];_=lT.getMatchMode();A.label=1;case 1:A.trys.push([1,5,,6]);if(_!==Ed.SINGLE)return[3,3];return[4,lT.finishMatchAsync()];case 2:A.sent();return[3,4];case 3:_===Ed.TOURNAMENT&&g.scoreManager.updateTournamentStartScore();A.label=4;case 4:return[3,6];case 5:k=A.sent();console.warn("handleNextLevel",k);return[3,6];case 6:C=(null!==(E=g.gameData.level)&&void 0!==E?E:1)+1;g.setGameData({level:C});if(_!==Ed.TOURNAMENT)return[3,8];return[4,lT.setMatchCustomDataAsync({level:C})];case 7:A.sent();return[3,11];case 8:return[4,lT.setMatchCustomDataAsync({level:C,score:0})];case 9:A.sent();return[4,lT.startMatchAsync()];case 10:A.sent();A.label=11;case 11:g.stateManager.initialize(),console.log("Next level",g.gameData.level);A.label=12;case 12:return[2]}})}),g.handleStartOver=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){S8.setGameData({level:null!=E?E:1}),g.gameData=S8.getGameData(),g.stateManager.initialize(),console.info("Start over",null===(_=g.gameData)||void 0===_?void 0:_.level);return[2]})});return function(g){return E.apply(this,arguments)}}(),g.handleMaxLevel=function(){g.gameData&&(g.initData(),l5.openScreen(iw.CONGRATULATION_SCREEN,{level:g.gameData.level}),console.info("Max level",g.gameData.level))},g.handleExitGame=Be(function(){return _ts_generator(this,function(g){try{Et.setStorageData("dashboard","animateToCurrentLevel",!0),Et.setStorageData("collection","animateMapPackUnlock",!0)}catch(g){console.warn("handleExitGame",g)}return[2]})}),g.handleTileClick=function(E){g.stateManager.playing(),g.board.handleTileClick(E),g.handleHideHint()},g.handleGridMatchSuccess=function(E,_){g.pathDraw.drawMatchPath(E,function(E){var _=E.x,k=E.y;return g.board.getAnyTileWorldPosition(_,k)}),g.comboManager.addCombo(),g.handleAddScore(),g.effectManager.playClearEffectAt([_[0].node.worldPosition,_[1].node.worldPosition])},g.handleGridMatchFail=function(E){var _;null!==(_=g.guidelinesManager)&&void 0!==_&&_.isShowErrorPathLevel()&&g.pathDraw.drawErrorPath(E,function(E){var _=E.x,k=E.y;return g.board.getAnyTileWorldPosition(_,k)})},g.checkIfGameIsFinish=function(){0===g.board.getUncleared().length&&g.node.scene.emit(r4.GAME_FINISH)},g.handlePauseTime=function(){g.uiManager.pauseTime()},g.handleResumeTime=function(){g.uiManager.resumeTime()},g.handleClockTimeout=function(){g.stateManager.fail(us)},g.handleHalfTime=function(){void 0!==g.guidelinesManager&&(g.board.getUncleared().length>=g.board.getCleared().length&&g.guidelinesManager.startThunderGuide()||g.board.getBombTiles().length>0&&g.guidelinesManager.startPliersGuide())},g.handleStartRescue=function(){var E,_;for(i9.turnDownMusic(),ii.setBlockInput(!0),g.board.setIgnoreInput(!0);g.rescueTiles.length>0;){var k=g.rescueTiles.pop();null==k||k.restore()}var C=lT.getMatchMode()||void 0;En.levelRescue(null!==(E=null===(_=g.gameData)||void 0===_?void 0:_.level)&&void 0!==E?E:1,void 0,C)},g.handleFinishRescue=function(){ii.setBlockInput(!1),g.board.setIgnoreInput(!1)},g.handleBombExplode=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.rescueTiles.push(E),g.board.setIgnoreInput(!0),ii.getBlockInput()||(i9.playSound(ip.BOMB_EXPLODE_1),ii.setBlockInput(!0));_=E.node.worldPosition;return[4,g.effectManager.createBombExplosionAt(new em(_.x,_.y,0))];case 1:k.sent(),ii.setBlockInput(!1),g.stateManager.isFail()||g.stateManager.fail(ul);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g.handleShowHint=function(){if(!g.pathDraw.isDrawingHint){var E=g.board.getHintPath();E&&(i9.playSound(ip.HINT_ITEM),g.pathDraw.drawHintPath(E,function(E){return g.board.getAnyTileWorldPosition(E.x,E.y)}),g.board.showHint())}},g.handleHideHint=function(){g.pathDraw.isDrawingHint&&(g.pathDraw.clearHintPath(),g.board.hideHint())},g.handleAddScore=function(){var E=g.levelManager.getLevelData().level,_=g.comboManager.getCombo(),k=g.uiManager.clock.getRemainingTime();g.scoreManager.addScore(E,_,k)},g.handleUseItem=function(E){g.stateManager.playing(),E!==sN.HINT&&g.handleHideHint()},g.handleAutoPlay=function(){g.isAutoPlayEnabled?g.disableAutoPlay():g.enableAutoPlay()},g.enableAutoPlay=function(){g.isAutoPlayEnabled=!0;g.node.scene.once(r4.GAME_FINISH,function(){g.disableAutoPlay()}),g.schedule(g.autoPlay,.5)},g.disableAutoPlay=function(){g.isAutoPlayEnabled=!1,g.unschedule(g.autoPlay)},g.autoPlay=function(){var E=g.board.getHintPath();if(!E)throw new Error("No path found");var _=E[0].a,k=E.slice(-1)[0].b,C=g.board.getTileAt(_.x,_.y),A=g.board.getTileAt(k.x,k.y);if(!C||!A)throw new Error("Tile is null");C.onClick(),A.onClick()},g.handleAddStars=function(E){var _=S8.getGameData();if(!_)return Promise.resolve([]);S8.setGameData({stars:_.stars+1});var k=E.startAnimationAt;k&&g.effectManager.playStarEffectAt(k)},g.handleInviteFriends=Be(function(){var E,_,k,C,A,T,R,I,P,L,O,B,N,M;return _ts_generator(this,function(D){switch(D.label){case 0:D.trys.push([0,2,,3]);l5.showLoadingScreen();C=g.board.generateFenFromCurrentLevel(),A=(null!==(E=S8.getGameData())&&void 0!==E?E:{}).level,T=void 0===A?1:A;T=Math.max(1,T);R=null!==(_=null===(k=g.gameData)||void 0===k?void 0:k.levelData)&&void 0!==_?_:{},I=R.mode,P=void 0===I?"":I,L=R.rules,O=void 0===L?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:L,B=R.time,N=void 0===B?0:B;Er.addWideframeRender("renderResultChallenge",s7);return[4,Ee.context.choose.processAsync({playerId:S8.getPlayerId(),fallbackSingleMode:!1,extraData:{level:T,fen:C,gravity:P,rules:O,time:N}})];case 1:D.sent(),l5.closeLoadingScreen(),g.node.scene.emit(r4.GAME_RESUME),g.node.scene.emit(r4.GAME_REPLAY,{level:T});return[3,3];case 2:M=D.sent();if(console.warn("Unable to invite friends",M),l5.closeLoadingScreen(),l5.showNotificationScreen("Sorry, please try again later"),!_instanceof(M,Error))return[2];null==Ei||Ei.sendException(M),g.node.scene.emit(r4.GAME_RESUME),g.node.scene.emit(r4.SHOW_UI);return[3,3];case 3:return[2]}})}),g.handleAdShow=function(E){var _=E.placementId;_&&-1!==Ev.indexOf(_)&&(Ev.splice(Ev.indexOf(_),1),S9.hideBannerAdAsync(_).catch(function(){}),0===Ev.length&&S7.off(Es.AD_SHOWING,g.handleAdShow))},g.handleAddItem=function(){var E=Be(function(E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=E.animate,k=E.item,C=E.quantity,A=Eh.search(g.itemManager.items,function(g){return g.itemType===k});if(!(void 0!==A))return[3,2];T=A.getQuantity()+C;A.saveQuantity(T),g.uiManager.setInteractableItemButtons(!1),g.handlePauseGame();return[4,_()];case 1:R.sent(),A.setQuantity(T,!0),g.uiManager.setInteractableItemButtons(!0),g.handleResumeGame();return[3,3];case 2:console.warn("Item ".concat(k," not found"));R.label=3;case 3:return[2]}})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(a,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function(){lh.init()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}},{key:"initUIManager",value:function(){var g;this.uiManager=null===(g=this.node.parent)||void 0===g?void 0:g.getComponentInChildren(S5),this.uiManager.initDevTools(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(mm)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(m6)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(uu)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(vr)}},{key:"initItemManager",value:function(){this.itemManager=this.getComponent(mc),this.itemManager.syncItems();var g,E=at(this.itemManager.items);try{for(E.s();!(g=E.n()).done;)g.value.init(this)}catch(g){E.e(g)}finally{E.f()}}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(hv),this.comboManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(mS),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){Ep.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(mr),this.guidelinesManager.init(this))}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){Ev=[],S7.off(Es.AD_SHOWING,this.handleAdShow),S7.clear(Es.OPENING_SCREEN),S7.clear(Es.CLOSING_SCREEN),S7.on(Es.OPENING_SCREEN,this.handleOpenScreen),S7.on(Es.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(r4.SHOW_UI,this.handleShowUI),this.node.scene.on(r4.HIDE_UI,this.handleHideUI),this.node.scene.on(r4.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(r4.GAME_RESUME,this.handleResumeGame),this.node.scene.on(r4.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(r4.GAME_FINISH,this.handleFinishGame),this.node.scene.on(r4.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(r4.START_OVER,this.handleStartOver),this.node.scene.on(r4.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(r4.GAME_EXIT,this.handleExitGame),this.node.scene.on(r4.TILE_CLICK,this.handleTileClick),this.node.scene.on(r4.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(r4.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(r4.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(r4.RESUME_TIME,this.handleResumeTime),this.node.scene.on(r4.TIME_OUT,this.handleClockTimeout),this.node.scene.on(r4.HALF_TIME,this.handleHalfTime),this.node.scene.on(r4.RESCUE_START,this.handleStartRescue),this.node.scene.on(r4.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(r4.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(r4.SHOW_HINT,this.handleShowHint),this.node.scene.on(r4.ADD_SCORE,this.handleAddScore),this.node.scene.on(r4.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(r4.USE_ITEM,this.handleUseItem),this.node.scene.on(r4.ADD_ITEM,this.handleAddItem),this.node.scene.on(r4.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(r4.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(r4.INVITE_FRIENDS,this.handleInviteFriends)}},{key:"start",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.initDataFirstTime();return[4,this.tryInitTournamentMode()];case 1:g.sent(),this.initGame();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"initDataFirstTime",value:function(){var g,E,_=this.getSceneData(),k=(null!=_?_:{}).isFromLoader,C=void 0!==k&&k,A=(null!=_?_:{}).level;void 0===A&&(A=lT.getMatchMode()===Ed.TOURNAMENT?1:null!==(g=null===(E=S8.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:0);this.initData(),this.setGameData({level:A,isFromLoader:C})}},{key:"initData",value:function(){var g,E=this.getSceneData(),_=(null!=E?E:{}).isFromLoader,k=void 0!==_&&_,C=null!==(g=S8.getGameData())&&void 0!==g?g:{},A=C.level,T=void 0===A?1:A,R=C.items;0===T&&k&&R?(R.hint=2,R.thunder=1,R.storm=1,R.pliers=0,S8.setGameData({items:R,coins:500,lastRewardedItems:Date.now()}),this.node.scene.emit(r4.ADD_COINS,{coins:500,playSound:!1})):R&&this.checkItemsRewardable()&&(R.hint<5&&(R.hint+=1),R.thunder<5&&(R.thunder+=1),R.storm<5&&(R.storm+=1),R.pliers<5&&(R.pliers+=1),S8.setGameData({items:R,lastRewardedItems:Date.now()})),this.setGameData(Me(Me({},this.defaultData),{},{level:T}))}},{key:"checkItemsRewardable",value:function(){var g,E=(null!==(g=S8.getGameData())&&void 0!==g?g:{}).lastRewardedItems,_=void 0===E?0:E;return!Ec.isToday(_)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"tryInitTournamentMode",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,P,L,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:if(lT.getMatchMode()!==Ed.TOURNAMENT)return[3,8];_=null!==(g=lT.getMatchCustomData())&&void 0!==g?g:{},k=_.leaderboardId,C=_.tournamentId;if(!(k&&C))return[3,8];return[4,ua.requestTournamentDataAsync()];case 1:N.sent();A=ua.getTournamentDataById(C);if(!A)return[3,8];T=A.payload.themeId;this.setGameData({themeId:T});R=Ea.getLeaderboardName(k);if(!R)return[3,8];I=null;if(!(null!==(E=this.gameData)&&void 0!==E&&E.isFromLoader))return[3,3];return[4,li.getAllLeaderboardAsync(k)];case 2:I=N.sent();return[3,5];case 3:return[4,li.waitForLeaderboardFinishAsync(R)];case 4:N.sent(),I=Ea.getLeaderboard(R);N.label=5;case 5:if(!I)return[3,8];this.uiManager.header.tournamentRail.init(I);P=S8.getPlayerId(),L=I.leaders[P];if(!!L)return[3,7];return[4,Ea.getLeadersByPlayerIdsAsync(R,[P])];case 6:O=N.sent();if(0===O.length)return[2];L=O[0];N.label=7;case 7:B=L.score;Et.setStorageData("tournament","previousScore",B);N.label=8;case 8:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setGameData",value:function(g){var E,_,k,C=null!==(E=null!==(_=g.level)&&void 0!==_?_:null===(k=this.gameData)||void 0===k?void 0:k.level)&&void 0!==E?E:1;this.gameData=Me(Me(Me({},this.gameData),g),{},{level:C})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return lV.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var g,E=null!==(g=this.getGameData())&&void 0!==g?g:{},_=E.level,k=void 0===_?0:_,C=E.nextLevelCount;k<2||(void 0===C?0:C)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(g){console.warn("checkAndCreateShortcutAsync",g)})}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),a}(M)).prototype,"board",[SY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S0=st(SZ.prototype,"opacityToggler",[SJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S1=st(SZ.prototype,"pathDraw",[SQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SZ));_._RF.pop(),_._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var Eg=function(g){return g[g.STAR_CHEST=0]="STAR_CHEST",g[g.BALLOON=1]="BALLOON",g}(Eg||{});Z(Eg),_._RF.pop(),_._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var Em=function(g){return g.WORLD_TAB_SELECTED="world-tab-selected",g.FRIENDS_TAB_SELECTED="friends-tab-selected",g}(Em||{}),Eb="#AE4212",Ew="#3D5172",ES="#92200C",EE="#8F5542",E_="#8A4733",Ek="#3e7110",EC="#3e7110";_._RF.pop(),_._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),_._RF.pop(),_._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);_._RF.pop(),_._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),_._RF.pop(),_._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),_._RF.pop(),_._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var EA=k.ccclass,ET=globalThis.game,ER=ET.player,EI=ET.analytics,EP=GameCore.Plugins.Analytics.Events;EA("HintItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l5.openScreen(iw.GET_ITEM_SCREEN,{item:sN.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},g.loadQuantity=function(){var g=ER.getGameData();return null!=g&&g.items&&g?g.items[sN.HINT]:0},g}return Ue(i,[{key:"itemType",get:function(){return sN.HINT}},{key:"init",value:function(g){this.boardInstance=g.board,this.pathDrawer=g.pathDraw,this.setQuantity(this.loadQuantity()),Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nA.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>0}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.pathDrawer.isDrawingHint;if(g)return[3,5];if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:E=_.sent();return[3,4];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:E=(_.sent(),EI.event(EP.USE_ITEM,{item_name:sN.HINT}),this.node.scene.emit(r4.USE_ITEM,sN.HINT),this.node.scene.emit(r4.SHOW_HINT));_.label=4;case 4:g=E;_.label=5;case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=ER.getGameData();C&&ER.setGameData({items:Me(Me({},C.items),{},Ge({},sN.HINT,_))})}}]),i}(ml));_._RF.pop(),_._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var EL=k.ccclass,EO=globalThis.game,EB=EO.player,EN=EO.analytics,EM=GameCore.Plugins.Analytics.Events;EL("PliersItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l5.openScreen(iw.GET_ITEM_SCREEN,{item:sN.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},g.loadQuantity=function(){var g=EB.getGameData();return null!=g&&g.items&&g?g.items[sN.PLIERS]:0},g}return Ue(i,[{key:"itemType",get:function(){return sN.PLIERS}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nA.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getBombTiles().length>0}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:_.sent();return[3,4];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:_.sent(),EN.event(EM.USE_ITEM,{item_name:sN.PLIERS}),this.node.scene.emit(r4.USE_ITEM,sN.PLIERS);g=Vh(this.boardInstance.getBombTiles()),E=g.node.worldPosition;this.effectManager.createDefuseExplosionAt(new em(E.x,E.y,0)),i9.playSound(ip.BOMB_DEFUSE),g.special.switch(uX.none),this.applyActivationStatus();_.label=4;case 4:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=EB.getGameData();C&&EB.setGameData({items:Me(Me({},C.items),{},Ge({},sN.PLIERS,_))})}}]),i}(ml));_._RF.pop(),_._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var ED=k.ccclass,EF=globalThis.game,EU=EF.player,Ex=EF.analytics,Ez=GameCore.Plugins.Analytics.Events;ED("StormItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l5.openScreen(iw.GET_ITEM_SCREEN,{item:sN.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},g.loadQuantity=function(){var g=EU.getGameData();return null!=g&&g.items&&g?g.items[sN.STORM]:0},g}return Ue(i,[{key:"itemType",get:function(){return sN.STORM}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nA.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>2}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this;if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:k.sent();return[3,6];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:if(k.sent(),Ex.event(Ez.USE_ITEM,{item_name:sN.STORM}),this.node.scene.emit(r4.USE_ITEM,sN.STORM),this.node.scene.emit(r4.HIDE_UI),!this.effectManager)return[3,6];return[4,t$.waitTweenAsync(.5)];case 4:E=k.sent();return[4,Promise.race([this.effectManager.loadTornadoAnimation(),E])];case 5:if(k.sent(),this.effectManager){_=function(){var E=Be(function(E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:i9.setVolumeMusic(0,!0),i9.playSound(ip.SHUFFLE_ITEM),i9.playSound(ip.WIND);k=function(){var E=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:_.forEach(function(g,E,k){g.node.setSiblingIndex(_.asArray().length-1-(E+k*_.width))});return[4,Promise.all(_.map(function(E){return E.fly({getTilePosition:function(E){return Nh(_,g.boardInstance.getTileSize(),E)}})}))];case 1:E.sent();return[2]}})});return function(){return E.apply(this,arguments)}}();return[4,Promise.all(E.map(function(_,k,C){return _.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return Nh(E,g.boardInstance.getTileSize(),{x:k,y:C},10)}})}))];case 1:C.sent(),g.effectManager.playTornadoAnimation();return[4,k()];case 2:C.sent(),g.node.scene.emit(r4.SHOW_UI),i9.setVolumeMusic(.3,!0);return[2]}})});return function(g,_){return E.apply(this,arguments)}}();this.boardInstance.processShuffleRequest(_)}k.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=EU.getGameData();C&&EU.setGameData({items:Me(Me({},C.items),{},Ge({},sN.STORM,_))})}}]),i}(ml));_._RF.pop(),_._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var EG,EV,EK,EH,Eq,EW,Ej,EX,EY,EJ,EQ,EZ,E$,E0,E1,E2,E4,E3,E5=k.ccclass,E6=globalThis.game,E8=E6.player,E9=E6.analytics,E7=GameCore.Plugins.Analytics.Events;E5("ThunderItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l5.openScreen(iw.GET_ITEM_SCREEN,{item:sN.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},g.loadQuantity=function(){var g=E8.getGameData();return null!=g&&g.items&&g?g.items[sN.THUNDER]:0},g}return Ue(i,[{key:"itemType",get:function(){return sN.THUNDER}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nA.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>=4}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:_.sent();return[3,6];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:_.sent(),E9.event(E7.USE_ITEM,{item_name:sN.THUNDER}),this.node.scene.emit(r4.USE_ITEM,sN.THUNDER),this.node.scene.emit(r4.HIDE_UI);return[4,this.effectManager.loadThunderAnimation()];case 4:_.sent();g=this.boardInstance.getUncleared();if(g.length<4)return[3,6];i9.setVolumeMusic(0,!0);E=this.boardInstance.getPairs(2);ii.setBlockInput(!0),this.boardInstance.clearSelectedTile();return[4,this.effectManager.playThunderAnimation(E,this.boardInstance)];case 5:_.sent(),(g=this.boardInstance.getUncleared()).length>0&&this.node.scene.emit(r4.SHOW_UI),i9.setVolumeMusic(.3,!0),ii.setBlockInput(!1);_.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=E8.getGameData();C&&E8.setGameData({items:Me(Me({},C.items),{},Ge({},sN.THUNDER,_))})}}]),i}(ml));_._RF.pop(),_._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var _e,_t,_n,_i,_r,_a,_o,_s,_l,_u,_c,_h=k.ccclass,_p=k.property,_d=(EG=_h("Coin"),EV=_p(eV),EK=_p(G),EH=_p(ei),Eq=_p(ei),EW=nA.onlyRunInLifeCycle,Ej=nA.onlyRunInLifeCycle,EX=nA.onlyRunInLifeCycle,EY=nA.onlyRunInLifeCycle,EJ=nA.onlyRunInLifeCycleAsync,EQ=nA.onlyRunInLifeCycleAsync,EZ=nA.onlyRunInLifeCycle,EG((E1=st((E0=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"emittingParticles",E1,Ke(g)),rt(g,"animation",E2,Ke(g)),rt(g,"spin",E4,Ke(g)),rt(g,"rest",E3,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){nA.lazyValidateProperties(this)}},{key:"resetDisabled",value:function(){this.stopParticles(),this.stopAnimation(),this.hide(),this.node.active=!1,this.node.setPosition(0,0,this.node.position.z)}},{key:"hide",value:function(){this.node.setScale(em.ZERO)}},{key:"stopParticles",value:function(){this.emittingParticles.stopSystem()}},{key:"playTrailParticles",value:function(){this.emittingParticles.resetSystem()}},{key:"playSpinAnimationAfterDelay",value:(E=Be(function(){var g,E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:g=k.length>0&&void 0!==k[0]?k[0]:0,E=k.length>1?k[1]:void 0;_=g>0;if(!_)return[3,2];return[4,t$.waitTweenAsync(g)];case 1:_=C.sent();C.label=2;case 2:return[4,this.playSpinAnimation(E)];case 3:C.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"playSpinAnimation",value:function(g){return t$.runAnimationAsync(this.animation,this.spin.name,g)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),i}(M)).prototype,"emittingParticles",[EV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E2=st(E0.prototype,"animation",[EK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E4=st(E0.prototype,"spin",[EH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E3=st(E0.prototype,"rest",[Eq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(E0.prototype,"resetDisabled",[EW],Object.getOwnPropertyDescriptor(E0.prototype,"resetDisabled"),E0.prototype),st(E0.prototype,"hide",[Ej],Object.getOwnPropertyDescriptor(E0.prototype,"hide"),E0.prototype),st(E0.prototype,"stopParticles",[EX],Object.getOwnPropertyDescriptor(E0.prototype,"stopParticles"),E0.prototype),st(E0.prototype,"playTrailParticles",[EY],Object.getOwnPropertyDescriptor(E0.prototype,"playTrailParticles"),E0.prototype),st(E0.prototype,"playSpinAnimationAfterDelay",[EJ],Object.getOwnPropertyDescriptor(E0.prototype,"playSpinAnimationAfterDelay"),E0.prototype),st(E0.prototype,"playSpinAnimation",[EQ],Object.getOwnPropertyDescriptor(E0.prototype,"playSpinAnimation"),E0.prototype),st(E0.prototype,"stopAnimation",[EZ],Object.getOwnPropertyDescriptor(E0.prototype,"stopAnimation"),E0.prototype),E$=E0))||E$);_._RF.pop(),_._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var _f,_y,_v,_g,_m,_b,_w,_S,_E,__,_k,_C,_A,_T,_R,_I,_P,_L,_O=k.ccclass,_B=k.property,_N=em.ZERO.clone().add3f(0,-100,0),_M=em.ZERO.clone().add3f(0,100,0),_D=GameCore.Utils.Number,_F=(_e=_O("CoinTextPopup"),_t=_B(P),_n=_B(eu),_i=nA.onlyRunInLifeCycle,_r=nA.onlyRunInLifeCycle,_a=nA.onlyRunInLifeCycleAsync,_o=nA.onlyRunInLifeCycleAsync,_e((_u=st((_l=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"label",_u,Ke(g)),rt(g,"uiOpacity",_c,Ke(g)),g}return Ue(o,[{key:"__preload",value:function(){nA.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(k=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:this.enableNode(),this.initializePopup(g);return[4,this.showTextPopupAnimation(E)];case 1:_.sent();return[4,this.hidePopup()];case 2:_.sent(),this.disableNode();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"enableNode",value:function(){this.node.active=!0}},{key:"disableNode",value:function(){this.node.active=!1}},{key:"initializePopup",value:function(g){var E=_D.getShortNumber(g,3);this.label.string=E,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(_N)}},{key:"hidePopup",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.node.setScale(em.ONE),this.node.setPosition(_M);return[4,t$.runTweenAsync(z(this.uiOpacity).to(.5,{opacity:0}))];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"showTextPopupAnimation",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all([t$.runTweenAsync(z(this.node).to(1.5,{position:_M},{easing:"sineOut"}),g),t$.runTweenAsync(z(this.node).to(.5,{scale:em.ONE},{easing:"backOut"}),g)])];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})}]),o}(M)).prototype,"label",[_t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_c=st(_l.prototype,"uiOpacity",[_n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(_l.prototype,"disableNode",[_i],Object.getOwnPropertyDescriptor(_l.prototype,"disableNode"),_l.prototype),st(_l.prototype,"initializePopup",[_r],Object.getOwnPropertyDescriptor(_l.prototype,"initializePopup"),_l.prototype),st(_l.prototype,"hidePopup",[_a],Object.getOwnPropertyDescriptor(_l.prototype,"hidePopup"),_l.prototype),st(_l.prototype,"showTextPopupAnimation",[_o],Object.getOwnPropertyDescriptor(_l.prototype,"showTextPopupAnimation"),_l.prototype),_s=_l))||_s);_._RF.pop(),_._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var _U,_x=k.ccclass,_z=k.disallowMultiple,_G=k.property,_V=globalThis.game,_K=_V.player,_H=_V.monitorError,_q=999999999,_W=10,_j=1,_X=1,_Y=(_f=_x("CoinManager"),_y=nA.required(),_v=_G(ee),_g=nA.required(),_m=_G(ee),_b=nA.required(),_w=_G(C),_S=nA.onlyRunInLifeCycleAsync,_E=nA.onlyRunInLifeCycleAsync,__=nA.onlyRunInLifeCycleAsync,_k=nA.onlyRunInLifeCycleAsync,_C=nA.onlyRunInLifeCycleAsync,_A=nA.onlyRunInLifeCycleAsync,_f(_T=_z((_I=st((_R=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=A.call.apply(A,[this].concat(_))).coins=0,rt(g,"coinPrefab",_I,Ke(g)),rt(g,"coinTextPopup",_P,Ke(g)),rt(g,"coinAnimContainer",_L,Ke(g)),g.coinObjects=[],g}return Ue(r,[{key:"onLoad",value:function(){nA.decorateComponent(this),this.getCoinsFromPlayerData(),this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(){this.updateCoins({coins:this.coins})}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(r4.ADD_COINS,this.addCoins,this),this.node.scene.on(r4.REMOVE_COINS,this.removeCoins,this),this.node.scene.on(r4.ABORT_COIN_ANIMATION,this.abortCoinAnimation,this)}},{key:"prepareCoinCollection",value:function(){for(var g=0;g<_W;g++){var E=I(this.coinPrefab);E.setParent(this.coinAnimContainer),E.setPosition(0,0),E.active=!1,this.coinObjects.push(E.getComponent(_d))}}},{key:"prepareCoinTextPopup",value:function(){var g=I(this.coinTextPopup);g.setParent(this.node),g.active=!1,this.coinTextPopupNode=g.getComponent(_F)}},{key:"handleCollectionAnim",value:(C=Be(function(g,E,_,k,C){var A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this;if(!E)return[3,2];T=this.coinObjects.slice(0,this.getShortAmount(g));if(0===T.length)return[2,(console.warn("Requested coins amount is ".concat(g,". Shortened to ").concat(this.getShortAmount(g),". No coin objects was found to animate collection.")),void(null==_H||_H.sendException(new Error("Requested coins amount is ".concat(g,". Shortened to ").concat(this.getShortAmount(g),". No coin objects was found to animate collection.")),{coins:g,animatedCoins:T.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!E,coinCollectionCount:this.coinObjects.length})))];i9.playSound(ip.COLLECT_STOCK_COINS);return[4,Promise.all([this.playCoinFlyAndexplodeAnimation(E,T,_,k,C),t$.waitTweenAsync(_+k/2,C).then(function(){return A.animateCoinTextPopup(g,C)})])];case 1:R.sent(),C.abort();return[3,3];case 2:console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played");R.label=3;case 3:return[2]}})}),function(g,E,_,k,A){return C.apply(this,arguments)})},{key:"playCoinFlyAndexplodeAnimation",value:(k=Be(function(g,E,_,k,C){var A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this,T=_+k;return[4,Promise.all([].concat(tt(E.flatMap(function(E){E.node.active=!0,E.stopParticles();var T=[0,.5*Math.min(_,k)],R=eR.apply(void 0,T),I=_-R,P=k+R;return[A.animateCoinExplode(E.node,I,C),t$.waitTweenAsync(I,C).then(function(){return A.animateCoinFlyBack(g,E,P,C)})]})),[t$.waitTweenAsync(T,C).then(function(){return g.emitExplodeEffect(C)})]))];case 1:R.sent();return[2]}})}),function(g,E,_,C,A){return k.apply(this,arguments)})},{key:"animateCoinTextPopup",value:function(g,E){return this.coinTextPopupNode.show(g,E)}},{key:"animateCoinFlyBack",value:(_=Be(function(g,E,_,k){var C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:C=E.node.worldPosition.clone(),A=em.ZERO.clone(),T=g.getCoinIconWorldScale();return[4,t$.runTweenAsync(z(E.node).to(_,{scale:T},{onStart:function(){E.playSpinAnimationAfterDelay(0,k),E.playTrailParticles()},onUpdate:function(_,k){if(void 0!==k){var T=el.cubicIn(k),R=g.getCoinIconWorldPosition();E.node.worldPosition=em.lerp(A,C,R,T)}},onComplete:function(){E.emittingParticles.stopSystem(),E.stopAnimation(),E.hide()}}),k)];case 1:R.sent();return[4,t$.waitTweenAsync(1,k)];case 2:R.sent(),E.resetDisabled();return[2]}})}),function(g,E,k,C){return _.apply(this,arguments)})},{key:"animateCoinExplode",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=[-200,200],C=[-200,200],A=eR(k[0],k[1]),T=eR(C[0],C[1]);g.setPosition(0,0,g.position.z),g.setScale(em.ZERO);R=new em(A,T,g.position.z);return[4,Promise.all([t$.runTweenAsync(z(g).delay(.1*E).to(.8*E,{scale:em.ONE},{easing:"elasticOut"}),_),t$.runTweenAsync(z(g).to(E,{position:R},{easing:"circOut"}),_)])];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var g=_K.getGameData();this.coins=g?g.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(g){var E,_;if(this.coins>_q&&(this.coins=_q),g.coins!==this.coins){var k=Math.max(0,g.coins-this.coins);this.coins=g.coins,_K.setGameData({coins:this.coins});var C=g.collectionAnimation;null===(E=this.collectionAnimSignal)||void 0===E||E.abort();var A=new nD;if(this.collectionAnimSignal=A,null==C||null===(_=C.signal)||void 0===_||_.chain(A),void 0===C||C.animateTextOnly)this.node.scene.emit(r4.COIN_CHANGED,Me(Me({},g),{},{collectionAnimation:{animateTextOnly:!0,signal:null==C?void 0:C.signal}}));else{var T=C.floatDuration,R=void 0===T?_j:T,I=C.flyDuration,P=void 0===I?_X:I,L=C.target,O=void 0===L?this.targetContainer:L;this.collectionAnimSignal=A,this.targetContainer=O;var B=Me(Me({},g),{},{collectionAnimation:{floatDuration:R,flyDuration:P,animateTextOnly:!1,signal:A,target:O}});this.node.scene.emit(r4.COIN_CHANGED,B),this.handleCollectionAnim(k,this.targetContainer,R,P,A)}}}},{key:"addCoins",value:function(g){this.updateCoins(Me(Me({},g),{},{coins:this.coins+g.coins}))}},{key:"removeCoins",value:function(g){this.coins<g.coins?this.node.scene.emit(r4.REMOVE_COINS_FAILED):(this.updateCoins(Me(Me({},g),{},{coins:this.coins-g.coins})),this.node.scene.emit(r4.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(r4.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(g){return Math.min(g,_W)}},{key:"abortCoinAnimation",value:function(){var g;null===(g=this.collectionAnimSignal)||void 0===g||g.abort()}},{key:"untilFinishesCollectAnim",value:function(){return void 0===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(g){this.targetContainer=g}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var g;null===(g=this.collectionAnimSignal)||void 0===g||g.abort()}}]),r}(M)).prototype,"coinPrefab",[_y,_v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_P=st(_R.prototype,"coinTextPopup",[_g,_m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_L=st(_R.prototype,"coinAnimContainer",[_b,_w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(_R.prototype,"handleCollectionAnim",[_S],Object.getOwnPropertyDescriptor(_R.prototype,"handleCollectionAnim"),_R.prototype),st(_R.prototype,"playCoinFlyAndexplodeAnimation",[_E],Object.getOwnPropertyDescriptor(_R.prototype,"playCoinFlyAndexplodeAnimation"),_R.prototype),st(_R.prototype,"animateCoinTextPopup",[__],Object.getOwnPropertyDescriptor(_R.prototype,"animateCoinTextPopup"),_R.prototype),st(_R.prototype,"animateCoinFlyBack",[_k],Object.getOwnPropertyDescriptor(_R.prototype,"animateCoinFlyBack"),_R.prototype),st(_R.prototype,"animateCoinExplode",[_C],Object.getOwnPropertyDescriptor(_R.prototype,"animateCoinExplode"),_R.prototype),st(_R.prototype,"untilFinishesCollectAnim",[_A],Object.getOwnPropertyDescriptor(_R.prototype,"untilFinishesCollectAnim"),_R.prototype),_T=_R))||_T)||_T);_._RF.pop(),_._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),_._RF.pop(),_._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),_._RF.pop(),_._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),_._RF.pop(),_._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),_._RF.pop(),_._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var _J,_Q,_Z,_$,_0,_1,_2,_4,_3,_5,_6,_8=k.ccclass,_9=k.disallowMultiple,_7=GameCore,ke=_7.Events,kt=_7.Configs,kn=_7.Utils.Valid,ki=globalThis.game,kr=ki.ads,ka=ki.player,ko=ki.event;_8("BootScene")(_U=_9(_U=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).processWhenGameSdkStarted=function(){g.setupGameData(),g.processPreloadAssets()},g.processPreloadAssets=function(){g.loadCurrentPlayerTheme().catch(function(g){return console.error("loadCurrentPlayerTheme",g)})},g.handlePauseAudio=function(){ko.on(ke.VISIBILITY_HIDDEN,g.handleMuteAudio),ko.on(ke.VISIBILITY_VISIBLE,g.handleUnMuteAudio)},g.handleMuteAudio=function(){i9.muteAudio(!0)},g.handleUnMuteAudio=function(){kr.isAdFullSizeShowing()||i9.muteAudio(!1)},g}return Ue(n,[{key:"__preload",value:function(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.listenEvents()}},{key:"onLoad",value:function(){this.handlePauseAudio(),kt.Core.StartSDKAfterLoadGame||l5.showLoadingFullScreen(s$)}},{key:"start",value:function(){this.processCrazyGamesLoadingStop()}},{key:"listenEvents",value:function(){ko.getEventEmitCount(ke.GAME_SDK_STARTED)>0?this.processWhenGameSdkStarted():ko.once(ke.GAME_SDK_STARTED,this.processWhenGameSdkStarted)}},{key:"setupGameData",value:function(){var g=ka.getGameData();if(g){var E=g.totalLevel,_=Math.max(E,400),k=Me(Me({},g),{},{totalLevel:_});ka.setGameData(k)}}},{key:"loadCurrentPlayerTheme",value:function(){var g=lr.mapOrder,E=g[0],_=ka.getGameData(),k=null==_?void 0:_.level;if(!kn.isNumber(k))return ii.loadThemeAsync(E.theme);var C,A=at(g);try{for(A.s();!(C=A.n()).done;){var T=C.value;if((k-=T.levelCount)<=0){E=T;break}}}catch(g){A.e(g)}finally{A.f()}return ii.loadThemeAsync(E.theme)}},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}}]),n}(M))||_U);_._RF.pop(),_._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var ks,kl,kc,kh,kp,kd,kf,ky,kv,kg,km,kb,kw=k.ccclass,kS=k.property,kE=(_J=kw("RigidBodyObject"),_Q=kS(K),_Z=kS(eS),_$=kS(K),_0=kS(J),_J((_4=st((_2=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"gravityScale",_4,Ke(g)),rt(g,"linearVelocity",_3,Ke(g)),rt(g,"bounce",_5,Ke(g)),rt(g,"simulate",_6,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(T).getComponent(R),this.uiTransform=this.node.getComponent(R)}},{key:"update",value:function(g){if(this.simulate){this.applyGravity();var E=this.node.worldPosition.clone();E.add(new em(this.linearVelocity.x*g,this.linearVelocity.y*g,0)),E=this.applyBounce(E),this.node.setWorldPosition(E)}}},{key:"applyForce",value:function(g){this.linearVelocity.add(g)}},{key:"applyGravity",value:function(){var g=new eS(0,-9.8*this.gravityScale);this.applyForce(g)}},{key:"applyBounce",value:function(g){var E=this.uiTransform.getBoundingBoxToWorld();E.yMin<0&&(g.y=E.height/2,this.linearVelocity.y*=-this.bounce),E.xMin<0&&(g.x=E.width/2,this.linearVelocity.x*=-1);var _=this.canvas.width;return E.xMax>_&&(g.x=_-E.width/2,this.linearVelocity.x*=-1),g}}]),n}(M)).prototype,"gravityScale",[_Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_3=st(_2.prototype,"linearVelocity",[_Z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(0,0)}}),_5=st(_2.prototype,"bounce",[_$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_6=st(_2.prototype,"simulate",[_0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_1=_2))||_1);_._RF.pop(),_._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var k_,kk,kC,kA,kT,kR,kI,kP,kL,kO,kB,kN,kM,kD,kF,kU,kx=k.ccclass,kz=k.property,kG=k.disallowMultiple,QI=function(){},kV=(ks=kx("AnimSkipOverlay"),kl=kz(eu),kc=kz(eu),kh=kz(B),kp=nA.onlyRunInLifeCycleAsync,kd=nA.onlyRunInLifeCycleAsync,kf=nA.onlyRunInLifeCycleAsync,ks(ky=kG((kg=st((kv=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"containerUIOpacity",kg,Ke(g)),rt(g,"maskUIOpacity",km,Ke(g)),rt(g,"skipButton",kb,Ke(g)),g.isOpened=!1,g.currentCallback=QI,g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"open",value:(_=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.containerUIOpacity.node.active=!0;E=g.onSkip,_=g.opacity,k=void 0===_?255:_,C=g.transitionDuration,A=void 0===C?.2:C;this.maskUIOpacity.opacity=k;return[4,this.animateUIOpacity(0,255,A)];case 1:T.sent(),this.currentCallback=E,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(t7,g);return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"close",value:(E=Be(function(){var g;var E=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:g=E.length>0&&void 0!==E[0]?E[0]:.2;this.skipButton.interactable=!1,this.currentCallback=QI;return[4,this.animateUIOpacity(255,0,g)];case 1:_.sent(),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(ne);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"animateUIOpacity",value:function(g,E,_){return this.containerUIOpacity.opacity=g,t$.runTweenAsync(z(this.containerUIOpacity).to(_,{opacity:E}))}},{key:"untilClosed",value:function(){var g=this;return!1===this.isOpened?Promise.resolve():new Promise(function(E){g.node.scene.once(ne,E)})}}]),a}(M)).prototype,"containerUIOpacity",[kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),km=st(kv.prototype,"maskUIOpacity",[kc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kb=st(kv.prototype,"skipButton",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(kv.prototype,"open",[kp],Object.getOwnPropertyDescriptor(kv.prototype,"open"),kv.prototype),st(kv.prototype,"close",[kd],Object.getOwnPropertyDescriptor(kv.prototype,"close"),kv.prototype),st(kv.prototype,"untilClosed",[kf],Object.getOwnPropertyDescriptor(kv.prototype,"untilClosed"),kv.prototype),ky=kv))||ky)||ky);_._RF.pop(),_._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var kK,kH,kq,kW,kj,kX,kY,kJ,kQ,kZ,k$,k0,k1,k2,k4,k3,k5=k.ccclass,k6=k.property,k8=GameCore.Utils.Number,k9=(k_=k5("CoinContainer"),kk=k6(P),kC=k6(eo),kA=k6(eu),kT=k6(eV),kR=nA.onlyRunInLifeCycle,kI=nA.onlyRunInLifeCycleAsync,kP=nA.onlyRunInLifeCycleAsync,kL=nA.onlyRunInLifeCycle,kO=nA.onlyRunInLifeCycle,k_((kM=st((kN=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"coinLabel",kM,Ke(g)),rt(g,"coinIcon",kD,Ke(g)),rt(g,"explosionCircle",kF,Ke(g)),rt(g,"explosionParticles",kU,Ke(g)),g.currentCoin=0,g}return Ue(o,[{key:"setCoinText",value:function(g){this.coinLabel.string=g}},{key:"handleAddCoinButton",value:function(){l5.openScreen(iw.GET_COIN_SCREEN,{quantity:sz})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(r4.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(k=Be(function(g){var E,_,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:C=g.coins,A=g.collectionAnimation,T=g.playSound;if(!(void 0!==A&&!1!==this.node.activeInHierarchy))return[3,4];R=A.signal;if(null===(E=this.animAbortSignal)||void 0===E||E.abort(),this.animAbortSignal=null!=R?R:new nD,!A.animateTextOnly)return[3,2];return[4,this.animateCoinText(C,0,T,R)];case 1:return[2,(L.sent(),void this.setCoins(C))];case 2:I=null!==(_=A.flyDuration)&&void 0!==_?_:0,P=(null!==(k=A.floatDuration)&&void 0!==k?k:0)+I;return[4,this.animateCoinText(C,P,T,R)];case 3:L.sent(),this.setCoins(C);return[3,5];case 4:this.setCoins(C);L.label=5;case 5:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setCoins",value:function(g){this.setCoinText(k8.getShortNumber(g,3)),this.currentCoin=g}},{key:"animateCoinText",value:(_=Be(function(g,E){var _,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:_=this,k=!(T.length>2&&void 0!==T[2])||T[2],C=T.length>3?T[3]:void 0,A=this.currentCoin;return[4,t$.waitTweenAsync(E,C)];case 1:R.sent(),k&&i9.playSound(ip.COLLECT_COINS);return[4,t$.runOnUpdateAsync(this.node,1,function(E){var k=Math.round(A+(g-A)*E);_.setCoinText(k8.getShortNumber(k,3))},C)];case 2:R.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"emitExplodeEffect",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.initializeExplosionCircle(),this.explosionParticles.resetSystem();return[4,Promise.all([t$.runTweenAsync(z(this.explosionCircle.node).to(.4,{scale:new em(3,3,3)},{easing:"quadOut"}),g),t$.runTweenAsync(z(this.explosionCircle).delay(.2).to(.2,{opacity:0}),g)])];case 1:E.sent(),this.resetExplosionCircle();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"resetExplosionCircle",value:function(){this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0}},{key:"initializeExplosionCircle",value:function(){this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0)}},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var g;null===(g=this.animAbortSignal)||void 0===g||g.abort()}}]),o}(M)).prototype,"coinLabel",[kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kD=st(kN.prototype,"coinIcon",[kC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kF=st(kN.prototype,"explosionCircle",[kA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kU=st(kN.prototype,"explosionParticles",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(kN.prototype,"setCoins",[kR],Object.getOwnPropertyDescriptor(kN.prototype,"setCoins"),kN.prototype),st(kN.prototype,"animateCoinText",[kI],Object.getOwnPropertyDescriptor(kN.prototype,"animateCoinText"),kN.prototype),st(kN.prototype,"emitExplodeEffect",[kP],Object.getOwnPropertyDescriptor(kN.prototype,"emitExplodeEffect"),kN.prototype),st(kN.prototype,"resetExplosionCircle",[kL],Object.getOwnPropertyDescriptor(kN.prototype,"resetExplosionCircle"),kN.prototype),st(kN.prototype,"initializeExplosionCircle",[kO],Object.getOwnPropertyDescriptor(kN.prototype,"initializeExplosionCircle"),kN.prototype),kB=kN))||kB);_._RF.pop(),_._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);var k7,Ce=k.ccclass,Ct=k.property,Cn=globalThis.game.player,Ci=[1e3,1500];kK=Ce("ItemContainer"),kH=Ct({type:C,group:"Hint"}),kq=Ct({type:P,group:"Hint"}),kW=Ct({type:C,group:"Thunder"}),kj=Ct({type:P,group:"Thunder"}),kX=Ct({type:C,group:"Storm"}),kY=Ct({type:P,group:"Storm"}),kJ=Ct(ee),kK((kZ=st((kQ=function(g){ze(u,g);var E,_,k,C,A,R=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"hintNode",kZ,Ke(g)),rt(g,"hintLabel",k$,Ke(g)),g.hintCollection=[],rt(g,"thunderNode",k0,Ke(g)),rt(g,"thunderLabel",k1,Ke(g)),g.thunderCollection=[],rt(g,"stormNode",k2,Ke(g)),rt(g,"stormLabel",k4,Ke(g)),g.stormCollection=[],rt(g,"itemPrefab",k3,Ke(g)),g}return Ue(u,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(T).node,this.widget=this.getComponent(H),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents(),this.listenToEvents()}},{key:"start",value:function(){this.prepareItemCollection()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(r4.ADD_ITEMS,this.handleAddItems,this)}},{key:"prepareItemCollection",value:function(){for(var g=0;g<9;g++){var E=I(this.itemPrefab),_=I(this.itemPrefab),k=I(this.itemPrefab);E.parent=this.canvas,_.parent=this.canvas,k.parent=this.canvas,E.active=!1,_.active=!1,k.active=!1,this.hintCollection.push(E.getComponent(kE)),this.thunderCollection.push(_.getComponent(kE)),this.stormCollection.push(k.getComponent(kE))}}},{key:"updateStatus",value:function(g){var E=g.items;this.hintLabel.string="".concat(E.hint),this.thunderLabel.string="".concat(E.thunder),this.stormLabel.string="".concat(E.storm)}},{key:"show",value:(A=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.uiOpacity.opacity=255;g=z(this.widget).to(1.5,{right:0},{easing:"quadOut"});return[4,t$.runTweenAsync(g,this.animAbortSignal)];case 1:E.sent(),this.widget.right=0;return[2]}})}),function(){return A.apply(this,arguments)})},{key:"hide",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=z(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"});return[4,t$.runTweenAsync(g)];case 1:E.sent(),this.uiOpacity.opacity=0;return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleAddItems",value:(k=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=this;this.animAbortSignal=null!==(E=g.signal)&&void 0!==E?E:new nD;k=Cn.getGameData();if(!k)return[3,3];this.updateStatus(k);C=this.show(),A=g.items.map(function(g){return _.animateItemCollection(g.item,g.quantity,1.5)});return[4,Promise.all([C].concat(tt(A)))];case 1:T.sent(),k.items=Me(Me({},k.items),{},{hint:k.items.hint+g.items[0].quantity,thunder:k.items.thunder+g.items[1].quantity,storm:k.items.storm+g.items[2].quantity}),Cn.setGameData(k),this.updateStatus(k);return[4,this.hide()];case 2:T.sent();T.label=3;case 3:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"animateItemCollection",value:(_=Be(function(g,E,_){var k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:k=this,C=this.getItemCollection(g).slice(0,E);if(!(0!==C.length))return[3,2];A=C.map(function(E,C){E.node.active=!0,E.node.position=new em(0,0,E.node.position.z),E.linearVelocity=new eS(0,0),E.simulate=!0;var A=eR(Math.PI/3,2*Math.PI/3),T=eR(Ci[0],Ci[1])*Math.cos(A),R=eR(Ci[0],Ci[1])*Math.sin(A);E.applyForce(new eS(T,R));var I=k.getTargetNode(g);if(I)return E.getComponent(eo).spriteFrame=I.getComponent(eo).spriteFrame,k.getItemAnimation(E,I,_+.03*C)});return[4,Promise.all(A)];case 1:T.sent();T.label=2;case 2:return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"getItemCollection",value:function(g){switch(g){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}},{key:"getTargetNode",value:function(g){switch(g){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}},{key:"getItemAnimation",value:(E=Be(function(g,E){var _,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:_=A.length>2&&void 0!==A[2]?A[2]:0;g.node.scale=new em(2,2,2);return[4,t$.waitTweenAsync(_,this.animAbortSignal)];case 1:T.sent();k=g.node.worldPosition.clone(),C=z(g.node).to(1,{scale:E.scale},{onUpdate:function(_,C){if(_&&C){var A=el.cubicIn(C);E&&(g.node.worldPosition=k.lerp(E.worldPosition,A))}},onComplete:function(){g.node.setPosition(0,0),g.node.active=!1}});return[4,t$.runTweenAsync(C,this.animAbortSignal)];case 2:T.sent(),g.node.scale=E.scale.clone(),g.node.setPosition(0,0),g.node.active=!1;return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"onDestroy",value:function(){var g;null===(g=this.animAbortSignal)||void 0===g||g.abort()}}]),u}(M)).prototype,"hintNode",[kH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k$=st(kQ.prototype,"hintLabel",[kq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k0=st(kQ.prototype,"thunderNode",[kW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k1=st(kQ.prototype,"thunderLabel",[kj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k2=st(kQ.prototype,"stormNode",[kX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k4=st(kQ.prototype,"stormLabel",[kY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k3=st(kQ.prototype,"itemPrefab",[kJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kQ));_._RF.pop(),_._RF.push({},"904917NfYBJy781QxKjEPIO","ViewNode",void 0);var Cr,Ca,Co,Cs,Cl,Cc,Ch,Cp,Cd,Cf,Cy,Cv,Cg,Cm,Cb,Cw,CS,CE,C_,Ck,CC,CA,CT,CR,CI=k.ccclass,CP=k.requireComponent,CL=CI("ViewNode")(k7=CP(eu)(k7=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).order=0,g}return Ue(n,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"setVisible",value:function(g){this.uiOpacity.opacity=g?255:0}},{key:"isVisible",value:function(){return this.uiOpacity.opacity>0}}]),n}(M))||k7)||k7;_._RF.pop(),_._RF.push({},"0b250nSw/RHRq8vKigzgfhs","ScrollViewLayout",void 0);var CO,CB,CN,CM,CD,CF,CU,Cx,Cz,CG,CV,CK,CH,Cq,CW,Cj,CX,CY,CJ,CQ,CZ,C$,C0,C1,C2,C4,C3,C5,C6,C8,C9,C7,Ae,At,An=k.ccclass,Ai=k.property,Ar=k.requireComponent,Aa=GameCore.Utils.Array,Ao=(Cr=An("ScrollViewLayout"),Ca=Ar(eK),Co=Ai(R),Cs=Ai(K),Cl=Ai(ee),Cc=Ai(V),Ch=Ai(V),Cp=Ai(),Cd=nA.onlyRunInLifeCycle,Cf=nA.onlyRunInLifeCycle,Cy=nA.onlyRunInLifeCycleAsync,Cv=nA.onlyRunInLifeCycleAsync,Cg=nA.onlyRunInLifeCycleAsync,Cm=nA.onlyRunInLifeCycle,Cb=nA.onlyRunInLifeCycle,Cw=nA.onlyRunInLifeCycle,Cr(CS=Ca((C_=st((CE=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"viewport",C_,Ke(g)),rt(g,"spacing",Ck,Ke(g)),rt(g,"nodePrefab",CC,Ke(g)),rt(g,"maxNodeCount",CA,Ke(g)),rt(g,"extendCount",CT,Ke(g)),rt(g,"scrollView",CR,Ke(g)),g.nodePool=[],g.recycling=!1,g.direction=0,g.oldOffset=0,g.nodeHeight=0,g.scrollSignal=new nD,g.onNodeData=function(){},g.onNodeInvisible=function(){},g}return Ue(o,[{key:"__preload",value:function(){this.scrollView=this.getComponent(eK),this.uiTransform=this.getComponent(R)}},{key:"start",value:function(){var g=I(this.nodePrefab);this.nodeHeight=g.getComponent(R).height,g.destroy(),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"init",value:function(g,E){this.createNodePool(),this.currentNodeCount=this.nodePool.length,this.topMostNodeIndex=0,this.bottomMostNodeIndex=this.nodePool.length-1,this.onNodeData=null!=g?g:this.onNodeData,this.onNodeInvisible=null!=E?E:this.onNodeInvisible;for(var _=this.viewport.getBoundingBoxToWorld(),k=_.yMax,C=_.yMin,A=0;A<this.nodePool.length;A++)if(A<this.maxNodeCount){var T=this.nodePool[A];T.setVisible(!0),this.onNodeData(T);var R=this.getNodeBoundingBoxWorld(A),I=R.top,P=R.bot;(I<C||P>k)&&(T.setVisible(!1),this.onNodeInvisible(T))}else this.nodePool[A].setVisible(!1),this.onNodeInvisible(this.nodePool[A])}},{key:"updateNodeVisibility",value:function(){for(var g=0;g<this.nodePool.length;g++)this.nodePool[g].isVisible()&&this.onNodeData(this.nodePool[g])}},{key:"listenEvents",value:function(){this.scrollView.node.on(eK.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.on(eH.TOUCH_MOVE,this.abortScrollSignal,this)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(eK.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.off(eH.TOUCH_MOVE,this.abortScrollSignal,this)}},{key:"scrollToOrder",value:(k=Be(function(g,E){var _,k,C,A,T;var R=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:_=R.length>2&&void 0!==R[2]?R[2]:2,k=this.getNodeScrollOffset(g),C=this.scrollView.getScrollOffset().y,A=(k=Math.max(k,0))-(C=Math.max(C,0));T=Math.abs(A)<5;if(T)return[3,2];return[4,this.scrollToOffset(new eS(0,k),_,E)];case 1:T=I.sent();I.label=2;case 2:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"scrollToTop",value:(_=Be(function(g){var E;var _=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:E=_.length>1&&void 0!==_[1]?_[1]:2;return[4,this.scrollToOffset(new eS(0,0),E,g)];case 1:k.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"scrollToOffset",value:(E=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=new nD;this.scrollSignal=k,this.scrollView.scrollToOffset(g,E),k.addAbortListener(this.handleScrollSignalAborted.bind(this)),_.addAbortListener(this.handleExternalSignalAborted.bind(this,g,k));return[4,t$.waitTweenAsync(E,_)];case 1:C.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"updateVisibility",value:function(){var g=this;if(this.direction=this.scrollView.getScrollOffset().y-this.oldOffset,this.oldOffset=this.scrollView.getScrollOffset().y,!this.recycling){var E=this.viewport.getBoundingBoxToWorld(),_=E.yMax,k=E.yMin;this.nodePool.forEach(function(E,C){var A=g.getNodeBoundingBoxWorld(C),T=A.top,R=A.bot;T<k||R>_?(E.setVisible(!1),g.onNodeInvisible(E)):E.setVisible(!0)}),this.direction>0&&this.validateNodeIndex(this.bottomMostNodeIndex)&&this.getNodeBoundingBoxWorld(this.bottomMostNodeIndex).top>k?this.recycleTopToBottom():this.direction<0&&this.validateNodeIndex(this.topMostNodeIndex)&&this.getNodeBoundingBoxWorld(this.topMostNodeIndex).bot<_&&this.recycleBottomToTop()}}},{key:"createNodePool",value:function(){if(0===this.nodePool.length){var g=Math.ceil(this.viewport.height/this.nodeHeight)+1+this.extendCount;this.setMaxNodeCount(this.maxNodeCount);for(var E=0;E<g;E++){var _,k=I(this.nodePrefab);null===(_=this.scrollView.content)||void 0===_||_.addChild(k),k.setPosition(this.getNodePosition(E));var C=k.addComponent(CL);C.order=E,this.nodePool.push(C)}}else for(var A=0;A<this.nodePool.length;A++)this.nodePool[A].order=A,this.nodePool[A].node.setPosition(this.getNodePosition(A))}},{key:"recycleTopToBottom",value:function(){for(this.recycling=!0;this.getNodeBoundingBoxWorld(this.topMostNodeIndex).bot>this.viewport.getBoundingBoxToWorld().yMax&&this.currentNodeCount<this.maxNodeCount;)this.nodePool[this.topMostNodeIndex].node.setPosition(this.getNodePosition(this.nodePool[this.bottomMostNodeIndex].order+1)),this.nodePool[this.topMostNodeIndex].order=this.nodePool[this.bottomMostNodeIndex].order+1,this.onNodeData(this.nodePool[this.topMostNodeIndex]),this.bottomMostNodeIndex=this.topMostNodeIndex,this.topMostNodeIndex=(this.topMostNodeIndex+1)%this.nodePool.length,this.currentNodeCount++;this.recycling=!1}},{key:"recycleBottomToTop",value:function(){for(this.recycling=!0;this.getNodeBoundingBoxWorld(this.bottomMostNodeIndex).top<this.viewport.getBoundingBoxToWorld().yMin&&this.currentNodeCount>this.nodePool.length;)this.nodePool[this.bottomMostNodeIndex].node.setPosition(this.getNodePosition(this.nodePool[this.topMostNodeIndex].order-1)),this.nodePool[this.bottomMostNodeIndex].order=this.nodePool[this.topMostNodeIndex].order-1,this.onNodeData(this.nodePool[this.bottomMostNodeIndex]),this.topMostNodeIndex=this.bottomMostNodeIndex,this.bottomMostNodeIndex=(this.bottomMostNodeIndex-1+this.nodePool.length)%this.nodePool.length,this.currentNodeCount--;this.recycling=!1}},{key:"updateLayout",value:function(){var g,E=at(this.getVisibleNodes());try{for(E.s();!(g=E.n()).done;){var _=g.value;_.node.setPosition(this.getNodePosition(_.order))}}catch(g){E.e(g)}finally{E.f()}}},{key:"setMaxNodeCount",value:function(g){this.maxNodeCount=g,this.scrollView.content.getComponent(R).height=(this.nodeHeight+this.spacing)*this.maxNodeCount}},{key:"getAllNodes",value:function(){return this.nodePool}},{key:"getVisibleNodes",value:function(){return this.nodePool.filter(function(g){return g.isVisible()})}},{key:"getNodePosition",value:function(g){return new em(0,-(this.nodeHeight+this.spacing)*g-this.nodeHeight/2,0)}},{key:"getNodeScrollOffset",value:function(g){return-this.getNodePosition(g).y-this.uiTransform.node.worldPosition.y-this.uiTransform.height/2+this.viewport.node.worldPosition.y}},{key:"getNodeByOrder",value:function(g){return Aa.search(this.nodePool,function(E){return E.order===g})}},{key:"getNodeBoundingBoxWorld",value:function(g){var E=this.nodePool[g].node.worldPosition.y;return{top:E+this.nodeHeight/2,bot:E-this.nodeHeight/2}}},{key:"validateNodeIndex",value:function(g){return g>=0&&g<this.nodePool.length}},{key:"abortScrollSignal",value:function(){this.scrollSignal.abort()}},{key:"handleScrollSignalAborted",value:function(){this.scrollView.stopAutoScroll(),this.updateVisibility()}},{key:"handleExternalSignalAborted",value:function(g,E){E.aborted||(this.scrollView.stopAutoScroll(),this.scrollView.scrollToOffset(g,0))}}]),o}(M)).prototype,"viewport",[Co],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ck=st(CE.prototype,"spacing",[Cs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),CC=st(CE.prototype,"nodePrefab",[Cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CA=st(CE.prototype,"maxNodeCount",[Cc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),CT=st(CE.prototype,"extendCount",[Ch],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),CR=st(CE.prototype,"scrollView",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(CE.prototype,"listenEvents",[Cd],Object.getOwnPropertyDescriptor(CE.prototype,"listenEvents"),CE.prototype),st(CE.prototype,"unlistenEvents",[Cf],Object.getOwnPropertyDescriptor(CE.prototype,"unlistenEvents"),CE.prototype),st(CE.prototype,"scrollToOrder",[Cy],Object.getOwnPropertyDescriptor(CE.prototype,"scrollToOrder"),CE.prototype),st(CE.prototype,"scrollToTop",[Cv],Object.getOwnPropertyDescriptor(CE.prototype,"scrollToTop"),CE.prototype),st(CE.prototype,"scrollToOffset",[Cg],Object.getOwnPropertyDescriptor(CE.prototype,"scrollToOffset"),CE.prototype),st(CE.prototype,"updateVisibility",[Cm],Object.getOwnPropertyDescriptor(CE.prototype,"updateVisibility"),CE.prototype),st(CE.prototype,"handleScrollSignalAborted",[Cb],Object.getOwnPropertyDescriptor(CE.prototype,"handleScrollSignalAborted"),CE.prototype),st(CE.prototype,"handleExternalSignalAborted",[Cw],Object.getOwnPropertyDescriptor(CE.prototype,"handleExternalSignalAborted"),CE.prototype),CS=CE))||CS)||CS);_._RF.pop(),_._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var As,Al,Au,Ac,Ah,Ap,Ad,Af,Ay,Av,Ag,Am=k.ccclass,Ab=k.property,Aw=k.disallowMultiple,AS=k.requireComponent,AE=(CO=Am("DashboardPage"),CB=AS(H),CN=AS(eu),CM=nA.required(),CD=Ab({type:C,displayName:"Page's container"}),CF=nA.required(),CU=nA.required(),Cx=Ab({type:C,displayName:"Placeholder"}),Cz=nA.required(),CG=Ab({displayName:"Don't create prefab",tooltip:"Tell the component to not create the prefab even if it hasn't create yet"}),CV=Ab({displayName:"Darken background"}),CK=Ab({type:V,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),CH=Ab({displayName:"Use navbar shadow"}),Cq=Ab({type:V,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),CW=nA.required(),Cj=nA.getComponent(eu),CX=nA.required(),CY=nA.getComponent(H),CJ=nA.onlyRunInLifeCycleAsync,CQ=nA.onlyRunInLifeCycle,CZ=nA.onlyRunInLifeCycleAsync,CO(C$=Aw(C$=CB(C$=CN((C1=st((C0=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",C1,Ke(g)),rt(g,"containerUIOpacity",C2,Ke(g)),rt(g,"placeholder",C4,Ke(g)),rt(g,"placeholderUIOpacity",C3,Ke(g)),rt(g,"hasCreated",C5,Ke(g)),g.pagePrefab=null,rt(g,"darkenBackground",C6,Ke(g)),rt(g,"backgroundOpacity",C8,Ke(g)),rt(g,"useNavbarShadow",C9,Ke(g)),rt(g,"navbarShadowOpacity",C7,Ke(g)),rt(g,"uiOpacity",Ae,Ke(g)),rt(g,"widgetComponent",At,Ke(g)),g}return Ue(a,[{key:"onLoad",value:function(){this.containerUIOpacity=this.container.getComponent(eu),this.placeholderUIOpacity=this.placeholder.getComponent(eu),nA.decorateComponent(this);var g=this.container.getComponent(q);this.layoutComponents=g?[g]:[],this.widgetComponents=[this.widgetComponent].concat(tt(this.container.getComponentsInChildren(H)))}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"updateWidgets",value:function(){var g,E=at(this.widgetComponents);try{for(E.s();!(g=E.n()).done;)g.value.updateAlignment()}catch(g){E.e(g)}finally{E.f()}}},{key:"updateLayouts",value:function(){var g,E=at(this.layoutComponents);try{for(E.s();!(g=E.n()).done;)g.value.updateLayout()}catch(g){E.e(g)}finally{E.f()}}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.hasCreated;if(g)return[3,2];return[4,this.create()];case 1:g=E.sent();E.label=2;case 2:this.mountInLifeCycle();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"mountInLifeCycle",value:function(){this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,iA.trackCurrentPage(this.node.name,!0)}},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return!0}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(E=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!(this.pagePrefab&&!this.hasCreated))return[3,2];_=I(this.pagePrefab),k=_.getComponentsInChildren(H);(g=this.widgetComponents).push.apply(g,tt(k));C=_.getComponentsInChildren(q);(E=this.layoutComponents).push.apply(E,tt(C)),this.container.addChild(_);return[4,t$.waitTweenAsync(0)];case 1:A.sent(),this.hasCreated=!0;A.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"container",[CM,CD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C2=st(C0.prototype,"containerUIOpacity",[CF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C4=st(C0.prototype,"placeholder",[CU,Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C3=st(C0.prototype,"placeholderUIOpacity",[Cz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C5=st(C0.prototype,"hasCreated",[CG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C6=st(C0.prototype,"darkenBackground",[CV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C8=st(C0.prototype,"backgroundOpacity",[CK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),C9=st(C0.prototype,"useNavbarShadow",[CH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C7=st(C0.prototype,"navbarShadowOpacity",[Cq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),Ae=st(C0.prototype,"uiOpacity",[CW,Cj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),At=st(C0.prototype,"widgetComponent",[CX,CY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(C0.prototype,"mount",[CJ],Object.getOwnPropertyDescriptor(C0.prototype,"mount"),C0.prototype),st(C0.prototype,"mountInLifeCycle",[CQ],Object.getOwnPropertyDescriptor(C0.prototype,"mountInLifeCycle"),C0.prototype),st(C0.prototype,"create",[CZ],Object.getOwnPropertyDescriptor(C0.prototype,"create"),C0.prototype),C$=C0))||C$)||C$)||C$)||C$);_._RF.pop(),_._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var A_,Ak,AC,AA,AT,AR,AI,AP,AL,AO,AB,AN,AM,AD,AF,AU,Ax,Az=k.ccclass,AG=k.property,AV=(As=Az("ThemeProgressBar"),Al=AG(C),Au=AG(C),Ac=AG(C),Ah=AG(C),As((Af=st((Ad=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"progressBar",Af,Ke(g)),rt(g,"progressText",Ay,Ke(g)),rt(g,"leftCap",Av,Ke(g)),rt(g,"rightCap",Ag,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(g,E){g<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var _=this.progressBar.getComponent(ew);if(!_)throw new Error("ThemeProgressBar: progressBarComponent not found");_.progress=g/E;var k=this.progressText.getComponent(P);if(!k)throw new Error("ThemeProgressBar: progressTextComponent not found");k.string="".concat(g,"/").concat(E)}}]),n}(M)).prototype,"progressBar",[Al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ay=st(Ad.prototype,"progressText",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Av=st(Ad.prototype,"leftCap",[Ac],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ag=st(Ad.prototype,"rightCap",[Ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ap=Ad))||Ap);_._RF.pop(),_._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var AK,AH,Aq,AW,Aj,AX,AY,AJ,AQ,AZ,A$,A0,A1,A2,A4,A3,A5,A6,A8,A9,A7,Te,Tt,Tn,Ti,Tr,Ta,To=k.ccclass,Ts=k.disallowMultiple,Tl=k.property,Tu=[50,160],Tc=(A_=To("LockAnimator"),Ak=Tl(eV),AC=Tl(G),AA=Tl(ei),AT=Tl(ei),AR=Tl(ei),AI=Tl(sm),AP=Tl({type:V,min:0}),A_(AL=Ts((AB=st((AO=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"floatingParticles",AB,Ke(g)),rt(g,"iconAnimation",AN,Ke(g)),rt(g,"lockClip",AM,Ke(g)),rt(g,"unlockClip",AD,Ke(g)),rt(g,"tryToUnlockClip",AF,Ke(g)),rt(g,"trailTemplate",AU,Ke(g)),rt(g,"trailCount",Ax,Ke(g)),g.trails=[],g}return Ue(o,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(k=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem();return[4,this.playAnimation(this.unlockClip.name,g)];case 1:E.sent(),this.floatingParticles.stopSystem();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var g=this;return Promise.all(this.trails.map(function(E){return t$.runTweenAsync(g.getExplodeTrail(E))}))}},{key:"getExplodeTrail",value:function(g,E){var _=arguments.length>1&&void 0!==E?E:0,k=eR(0,2*Math.PI),C=eR(Tu[0],Tu[1])*Math.cos(k),A=eR(Tu[0],Tu[1])*Math.sin(k),T=new em(C,A,g.node.position.z),R=g.node.scale.clone();return z(g.node).delay(_).call(function(){g.node.setPosition(0,0),g.reset(),g.node.active=!0}).to(.5,{position:T.clone()},{easing:"expoOut"}).to(.5,{scale:new em(0,0,1)},{easing:"expoIn"}).call(function(){g.node.setPosition(0,0),g.node.scale=R,g.reset(),g.node.active=!1})}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var g=0;g<this.trailCount;g++){var E=I(this.trailTemplate.node);E.setParent(this.node),E.active=!1,this.trails.push(E.getComponent(sm))}}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"playAnimation",value:(_=Be(function(g,E){var _;return _ts_generator(this,function(k){_=this;return[2,null!=E&&E.aborted?Promise.resolve():new Promise(function(k){_.iconAnimation.once(G.EventType.FINISHED,function(){k()}),null==E||E.addAbortListener(function(){_.iconAnimation.off(G.EventType.FINISHED),_.iconAnimation.stop(),k()}),_.iconAnimation.play(g)})]})}),function(g,E){return _.apply(this,arguments)})},{key:"playTryToUnlockAnimation",value:(E=Be(function(){return _ts_generator(this,function(g){return[2,this.playAnimation(this.tryToUnlockClip.name)]})}),function(){return E.apply(this,arguments)})}]),o}(M)).prototype,"floatingParticles",[Ak],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AN=st(AO.prototype,"iconAnimation",[AC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AM=st(AO.prototype,"lockClip",[AA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AD=st(AO.prototype,"unlockClip",[AT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AF=st(AO.prototype,"tryToUnlockClip",[AR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AU=st(AO.prototype,"trailTemplate",[AI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ax=st(AO.prototype,"trailCount",[AP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),AL=AO))||AL)||AL);_._RF.pop(),_._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var Th,Tp,Td,Tf,Ty,Tv,Tg,Tm,Tb,Tw,TS,TE,T_,Tk=k.ccclass,TC=k.property,TA={progress:0,max:10,isLocked:!0,theme:la.SUMMER,skins:["fruit"]},TT=GameCore.Utils.Array,TR=(AK=Tk("ThemeBlock"),AH=TC(C),Aq=TC(eu),AW=TC(C),Aj=TC(eu),AX=TC(Tc),AY=TC(C),AJ=TC(eo),AQ=TC([eo]),AZ=TC(P),A$=TC(eu),A0=TC(eu),A1=TC(J),A2=nA.onlyRunInLifeCycleAsync,AK((A5=st((A3=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"mask",A5,Ke(g)),rt(g,"nodeUIOpacity",A6,Ke(g)),rt(g,"progressBar",A8,Ke(g)),rt(g,"backgroundUI",A9,Ke(g)),rt(g,"lockAnimator",A7,Ke(g)),rt(g,"themeLoadingRing",Te,Ke(g)),rt(g,"themeSprite",Tt,Ke(g)),rt(g,"tileBlockIconSprite",Tn,Ke(g)),rt(g,"titleLabel",Ti,Ke(g)),rt(g,"titleOpacity",Tr,Ke(g)),rt(g,"newTilesOpacity",Ta,Ke(g)),g.signal=new nD,g.payload=TA,g}return Ue(r,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(g){this.payload.isLocked=g,this.updateInfo()}},{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){var E=arguments.length>0&&void 0!==g?g:TA;this.payload=E;var _=E.progress,k=E.max,C=E.isLocked,A=E.theme,T=E.skins;this.signal.abort();var R=new nD;this.signal=R,this.updateTitle(A),this.updateSkinAsync(T,R),this.updateThemeAsync(A,R);var I=this.progressBar.getComponent(AV);if(!I)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=C,this.progressBar.active=!C,this.lockAnimator.node.active=C,C||I.setProgress(_,k)}},{key:"playUnlockAnim",value:(C=Be(function(g){var E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:E=A.length>1&&void 0!==A[1]?A[1]:TA;this.payload=Me(Me({},E),{},{isLocked:!1});_=E.progress,k=E.max,C=this.progressBar.getComponent(AV);if(!C)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,C.setProgress(_,k);return[4,this.animateUnlockedState(g)];case 1:T.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"updateTitle",value:function(g){var E=g.replace(/-/g," ").replace(/\b\w/g,function(g){return g.toUpperCase()});this.titleLabel.string="".concat(E," levels")}},{key:"updateSkinAsync",value:(k=Be(function(g,E){var _,k,C,A,T,R,I,P,L,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:_=this.tileBlockIconSprite.length,k=g.length,C=g.map(function(){var g=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,ii.loadSkinPreviewAsync(g)];case 1:return[2,E.sent()]}})});return function(E){return g.apply(this,arguments)}}());return[4,Promise.all(C)];case 1:A=N.sent();if(!E.aborted&&this.tileBlockIconSprite){if(k<=_){for(T=Math.floor(_/k),R=_%k,I=tt(TT.fillWith(k,function(){return T})),P=0;P<R;P++)I[P]++;for(L=0,O=0;O<k;O++)for(B=0;B<I[O]&&L<_;B++,L++)this.tileBlockIconSprite[L].spriteFrame=A[O][B]}else this.tileBlockIconSprite.forEach(function(g,E){g.spriteFrame=A[E%k][0]})}return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"updateThemeAsync",value:(_=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.themeSprite.spriteFrame=null;_=ii.getAsset("".concat(nx[g],"/spriteFrame"),ea);k=_;if(k)return[3,2];this.themeLoadingRing.active=!0;return[4,ii.loadThemePreviewAsync(g)];case 1:k=_=A.sent();A.label=2;case 2:C=_;if(C)return[3,4];return[4,ii.loadThemePreviewAsync(la.SUMMER)];case 3:C=_=A.sent();A.label=4;case 4:this.themeSprite&&_&&!E.aborted&&(this.themeSprite.spriteFrame=_,this.themeLoadingRing.active=!1);return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"animateUnlockedState",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this.mask.getComponent(eu),k=this.progressBar.getComponent(eu);if(!_)throw new Error("ThemeBlock: maskUIOpacity not found");if(!k)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,_.opacity=null!==(E=_.opacity)&&void 0!==E?E:255,this.progressBar.active=!0,k.opacity=0;return[4,this.lockAnimator.unlock(g)];case 1:C.sent(),this.lockAnimator.node.active=!1;return[4,Promise.all([t$.runTweenAsync(z(_).to(.25,{opacity:0}),g),t$.runTweenAsync(z(k).to(.25,{opacity:255}),g)])];case 2:C.sent(),this.mask.active=!1,_.opacity=0,k.opacity=255;return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"getUITransform",value:function(){return this.uiTransform}},{key:"setVisible",value:function(g){this.nodeUIOpacity.opacity=g?255:0,this.titleOpacity.opacity=g?255:0,this.newTilesOpacity.opacity=g?255:0}}]),r}(M)).prototype,"mask",[AH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A6=st(A3.prototype,"nodeUIOpacity",[Aq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A8=st(A3.prototype,"progressBar",[AW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A9=st(A3.prototype,"backgroundUI",[Aj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A7=st(A3.prototype,"lockAnimator",[AX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te=st(A3.prototype,"themeLoadingRing",[AY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tt=st(A3.prototype,"themeSprite",[AJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tn=st(A3.prototype,"tileBlockIconSprite",[AQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ti=st(A3.prototype,"titleLabel",[AZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tr=st(A3.prototype,"titleOpacity",[A$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta=st(A3.prototype,"newTilesOpacity",[A0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(A3.prototype,"isLocked",[A1],Object.getOwnPropertyDescriptor(A3.prototype,"isLocked"),A3.prototype),st(A3.prototype,"updateSkinAsync",[A2],Object.getOwnPropertyDescriptor(A3.prototype,"updateSkinAsync"),A3.prototype),A4=A3))||A4);_._RF.pop(),_._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var TI,TP,TL,TO,TB,TN,TM,TD,TF,TU,Tx=k.ccclass,Tz=k.property,TG=globalThis.game.storage,TV=(Th=Tx("CollectionsContent"),Tp=Tz(aP),Td=Tz(Ao),Tf=Tz(ry),Ty=Tz({type:K,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),Tv=nA.onlyRunInLifeCycleAsync,Tg=nA.onlyRunInLifeCycleAsync,Th((Tw=st((Tb=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return(g=k.call.apply(k,[this].concat(_))).animateThemeBlockUnlockIndex=null,rt(g,"panelAnimator",Tw,Ke(g)),rt(g,"themeScrollView",TS,Ke(g)),rt(g,"contentOpacity",TE,Ke(g)),g.themeScrollViewInited=!1,g.payloads=[],g.preservedScrollPosition=new eS,rt(g,"offsetFromTopOfScrollView",T_,Ke(g)),g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.node.scene.on(r4.HIDE_UI,this.hideContent),this.node.scene.on(r4.SHOW_UI,this.showContent),this.themeScrollView.listenEvents()}},{key:"unlistenEvents",value:function(){this.unlistenUIEvents(),this.themeScrollView.unlistenEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(r4.HIDE_UI,this.hideContent),this.node.scene.off(r4.SHOW_UI,this.showContent)}},{key:"init",value:function(g){var E=this;this.payloads=g,this.themeScrollViewInited||(this.themeScrollViewInited=!0,this.themeScrollView.init(function(g){var _=E.animateThemeBlockUnlockIndex===g.order,k=E.payloads[g.order],C=g.getComponent(TR);C.updateInfo(Me(Me({},k),{},{isLocked:!!_||k.isLocked})),C.setVisible(!0)}))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.scrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.scrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(g){var E=this,_=TG.getStorageData("collection","animateMapPackUnlock"),k=TG.getStorageData("collection","lastMapPack");g.forEach(function(g,C){var A=g.progress,T=g.max,R=g.isLocked;if(A<T&&!R&&_&&k!==C+1)return E.animateThemeBlockUnlockIndex=C,TG.setStorageData("collection","animateMapPackUnlock",!1),void TG.setStorageData("collection","lastMapPack",C+1)})}},{key:"shouldAnimateThemeBlockUnlock",value:function(){return null!==this.animateThemeBlockUnlockIndex}},{key:"playThemeTabUnlockAnim",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.animateThemeBlockUnlockIndex)return[3,2];E=this.themeScrollView.getNodeByOrder(this.animateThemeBlockUnlockIndex);if(!(E&&E.isVisible()))return[3,2];_=E.getComponent(TR);if(!_)return[3,2];k=lh.getCollectionUnlockProgress()[this.animateThemeBlockUnlockIndex];return[4,_.playUnlockAnim(g,Me(Me({},k),{},{isLocked:!0}))];case 1:C.sent(),this.animateThemeBlockUnlockIndex=null;C.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(E=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,this.themeScrollView.scrollToOrder(g,E)];case 1:_.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}}]),a}(M)).prototype,"panelAnimator",[Tp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TS=st(Tb.prototype,"themeScrollView",[Td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TE=st(Tb.prototype,"contentOpacity",[Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T_=st(Tb.prototype,"offsetFromTopOfScrollView",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),st(Tb.prototype,"playThemeTabUnlockAnim",[Tv],Object.getOwnPropertyDescriptor(Tb.prototype,"playThemeTabUnlockAnim"),Tb.prototype),st(Tb.prototype,"scrollToCurrentUnlockingTheme",[Tg],Object.getOwnPropertyDescriptor(Tb.prototype,"scrollToCurrentUnlockingTheme"),Tb.prototype),Tm=Tb))||Tm);_._RF.pop(),_._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var TK,TH,Tq,TW,Tj,TX,TY,TJ,TQ,TZ,T$,T0,T1,T2,T4,T3,T5,T6,T8,T9,T7,Re,Rt,Rn,Ri,Rr,Ra,Ro,Rs,Rl,Ru,Rc,Rh,Rp,Rd,Rf,Ry,Rv,Rg,Rm,Rb=(TI=(0,k.ccclass)("CollectionsPage"),TP=nA.required(),TL=nA.getComponent(ad),TO=nA.onlyRunInLifeCycleAsync,TB=nA.onlyRunInLifeCycle,TN=nA.onlyRunInLifeCycleAsync,TM=nA.onlyRunInLifeCycleAsync,TI((TU=st((TF=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=A.call.apply(A,[this].concat(_))).payload=null,rt(g,"panelAnimationController",TU,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nA.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"setPayload",value:function(g){this.payload=g}},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(TV),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload);var g=lh.getCollectionUnlockProgress();this.themeContent.updateUnlockedProgress(g)}},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent(),this.themeContent.restoreScrollPosition(),this.themeContent.listenEvents();g=t$.runTweenAsync(z(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent(),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents();return[4,this.panelAnimationController.hideUI()];case 2:g.sent(),this.themeContent.unlistenEvents();return[2]}})}),function(){return E.apply(this,arguments)})}]),r}(AE)).prototype,"panelAnimationController",[TP,TL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(TF.prototype,"mount",[TO],Object.getOwnPropertyDescriptor(TF.prototype,"mount"),TF.prototype),st(TF.prototype,"onMount",[TB],Object.getOwnPropertyDescriptor(TF.prototype,"onMount"),TF.prototype),st(TF.prototype,"transitionIn",[TN],Object.getOwnPropertyDescriptor(TF.prototype,"transitionIn"),TF.prototype),st(TF.prototype,"transitionOut",[TM],Object.getOwnPropertyDescriptor(TF.prototype,"transitionOut"),TF.prototype),TD=TF))||TD);_._RF.pop(),_._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var Rw,RS,RE,R_,Rk,RC,RA,RT,RR,RI,RP,RL,RO,RB=k.ccclass,RN=k.property,RM=k.disallowMultiple,RD=k.requireComponent,RF=GameCore.Utils.Array,RU=(TK=RB("PageManagerItem"),TH=RN(AE),Tq=RN({type:es(nN)}),TK((TX=st((Tj=Ue(function e(){Fe(this,e),rt(this,"page",TX,this),rt(this,"pageType",TY,this)})).prototype,"page",[TH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TY=st(Tj.prototype,"pageType",[Tq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TW=Tj))||TW),Rx=(TJ=RB("PageManager"),TQ=RD(R),TZ=nA.required(),T$=RN({type:eu,displayName:"Background Mask",group:"Background Mask"}),T0=RN({type:K,displayName:"Transition duration",group:"Background Mask"}),T1=RN({type:K,displayName:"Transition delay",group:"Background Mask"}),T2=nA.required(),T4=RN({type:eu,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),T3=RN({type:K,displayName:"Transition duration",group:"Nav Bar Shadow"}),T5=RN({type:K,displayName:"Transition delay",group:"Nav Bar Shadow"}),T6=RN({type:[RU]}),T8=RN({type:es(nN)}),T9=nA.required(),T7=nA.getComponent(R),Re=nA.onlyRunInLifeCycleAsync,Rt=nA.onlyRunInLifeCycleAsync,Rn=nA.onlyRunInLifeCycle,Ri=nA.onlyRunInLifeCycle,Rr=nA.onlyRunInLifeCycle,Ra=nA.onlyRunInLifeCycleAsync,Ro=nA.onlyRunInLifeCycleAsync,Rs=nA.onlyRunInLifeCycleAsync,TJ(Rl=RM(Rl=TQ((Rc=st((Ru=function(g){ze(h,g);var E,_,k,C,A,T,R,I,P,L=Xe(h);function h(){var g;Fe(this,h);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=L.call.apply(L,[this].concat(_)),"backgroundMask",Rc,Ke(g)),rt(g,"backgroundMaskTransitionDuration",Rh,Ke(g)),rt(g,"backgroundMaskTransitionDelay",Rp,Ke(g)),rt(g,"navBarShadow",Rd,Ke(g)),rt(g,"navBarShadowTransitionDuration",Rf,Ke(g)),rt(g,"navBarShadowTransitionDelay",Ry,Ke(g)),rt(g,"pageItems",Rv,Ke(g)),rt(g,"currentScreen",Rg,Ke(g)),rt(g,"uiTransform",Rm,Ke(g)),g}return Ue(h,[{key:"unmountAndHideAll",value:function(){var g=this;this.pageItems.forEach(function(E){var _=E.page;E.pageType!==g.currentScreen&&(_.unmount(),_.hide())})}},{key:"onLoad",value:function(){nA.decorateComponent(this)}},{key:"init",value:function(){var g=this;this.pageItems.forEach(function(E,_){var k=E.page.getWidget();k.right=-(_-1)*g.uiTransform.width,k.left=(_-1)*g.uiTransform.width})}},{key:"updateCollectionsContentPayload",value:function(g){var E=this.getPage(nN.collections);E&&_instanceof(E,Rb)&&E.setPayload(g)}},{key:"navigate",value:(P=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:C=g.from,A=g.to;if(!(null!==C))return[3,2];return[4,this.navigateFromPage(C,A,E,_,k)];case 1:T.sent();return[3,4];case 2:return[4,this.navigateFromNull(A,_,k)];case 3:T.sent();T.label=4;case 4:return[2]}})}),function(g,E,_,k){return P.apply(this,arguments)})},{key:"navigateFromPage",value:(I=Be(function(g,E,_,k,C){var A,T,R,I,P,L,O,B,N,M,D,F,U;return _ts_generator(this,function(x){switch(x.label){case 0:A=this,T=this.validateNavigationRequest(g,E),R=T.toPage,I=T.fromPage;this.currentScreen=E;P=this.uiTransform.width,L=this.getPageIndex(g),O=this.getPageIndex(E),B=Math.min(L,O),N=Math.max(L,O),M=(N-B)*P,D=L<O?1:-1,F=this.pageItems.slice(B,N+1);F.forEach(function(g,E){var _=g.page;_.show(),_.getWidget().enabled=!1,_.node.position=new em((E+B-L)*P,_.node.position.y,_.node.position.z)});U=!R.hasLoadedPage();U&&this.showLoadingScreen();return[4,this.mountPage(R,k)];case 1:x.sent();return[4,_.callAsync(function(){return A.performFullTransition({from:g,to:E,fromPage:I,toPage:R,distance:M,direction:D,items:F})})];case 2:x.sent(),_.call(function(){return A.cleanupPages(R,F.filter(function(g){return g.pageType!==E}))});return[4,_.callAsync(function(){return A.transitionInPage(R,C)})];case 3:x.sent(),U&&this.hideLoadingScreen();return[2]}})}),function(g,E,_,k,C){return I.apply(this,arguments)})},{key:"hideLoadingScreen",value:function(){l5.closeLoadingScreen()}},{key:"showLoadingScreen",value:function(){l5.showLoadingScreen()}},{key:"cleanupPages",value:function(g,E){var _=g.getWidget();_.enabled=!0,_.left=0,_.right=0,g.updateWidgets(),g.updateLayouts(),E.forEach(function(g){g.page.unmount(),g.page.hide()})}},{key:"performFullTransition",value:(R=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:E=g.from,_=g.to,k=g.fromPage,C=g.distance,A=g.direction,T=g.items,R=g.toPage;this.node.scene.emit(nO,{from:E,to:_});return[4,Promise.all([k.transitionOut(),this.transition(C,A,T),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,R.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,R.getNavbarShadow())])];case 1:I.sent();return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"mountPage",value:(T=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,g.mount()];case 1:_.sent();return[4,null==E?void 0:E(g)];case 2:_.sent();return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"validateNavigationRequest",value:function(g,E){if(g!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");var _=this.getPage(this.currentScreen),k=this.getPage(E);if(!k||!_)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");return{toPage:k,fromPage:_}}},{key:"navigateFromNull",value:(A=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=this.getPage(this.currentScreen);k.show(),this.currentScreen=g;return[4,this.mountPage(k,E)];case 1:C.sent(),this.node.scene.emit(nO,{from:null,to:g});return[4,this.transitionInPage(k,_)];case 2:C.sent();return[2]}})}),function(g,E,_){return A.apply(this,arguments)})},{key:"transitionInPage",value:(C=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,g.transitionIn()];case 1:_.sent();return[4,null==E?void 0:E(g)];case 2:_.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"getPage",value:function(g){var E=this.getPageIndex(g);return -1!==E?this.pageItems[E].page:null}},{key:"handleBackgroundMask",value:(k=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,t$.runTweenAsync(z(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(g,{opacity:E}).start())];case 1:_.sent();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleNavBarShadow",value:(_=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,t$.runTweenAsync(z(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(g,{opacity:E}).start())];case 1:_.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"getPageIndex",value:function(g){return RF.searchIndex(this.pageItems,function(E){return E.pageType===g})}},{key:"transition",value:(E=Be(function(g,E,_){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,Promise.all(_.map(function(_){var k=_.page;return t$.runTweenAsync(z(k.node).to(.5,{position:new em(k.node.position.x-g*E,k.node.position.y,k.node.position.z)},{easing:el.quintInOut}))}))];case 1:k.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),h}(M)).prototype,"backgroundMask",[TZ,T$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rh=st(Ru.prototype,"backgroundMaskTransitionDuration",[T0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Rp=st(Ru.prototype,"backgroundMaskTransitionDelay",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),Rd=st(Ru.prototype,"navBarShadow",[T2,T4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rf=st(Ru.prototype,"navBarShadowTransitionDuration",[T3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Ry=st(Ru.prototype,"navBarShadowTransitionDelay",[T5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),Rv=st(Ru.prototype,"pageItems",[T6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Rg=st(Ru.prototype,"currentScreen",[T8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nN.home}}),Rm=st(Ru.prototype,"uiTransform",[T9,T7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Ru.prototype,"navigate",[Re],Object.getOwnPropertyDescriptor(Ru.prototype,"navigate"),Ru.prototype),st(Ru.prototype,"navigateFromPage",[Rt],Object.getOwnPropertyDescriptor(Ru.prototype,"navigateFromPage"),Ru.prototype),st(Ru.prototype,"hideLoadingScreen",[Rn],Object.getOwnPropertyDescriptor(Ru.prototype,"hideLoadingScreen"),Ru.prototype),st(Ru.prototype,"showLoadingScreen",[Ri],Object.getOwnPropertyDescriptor(Ru.prototype,"showLoadingScreen"),Ru.prototype),st(Ru.prototype,"cleanupPages",[Rr],Object.getOwnPropertyDescriptor(Ru.prototype,"cleanupPages"),Ru.prototype),st(Ru.prototype,"performFullTransition",[Ra],Object.getOwnPropertyDescriptor(Ru.prototype,"performFullTransition"),Ru.prototype),st(Ru.prototype,"mountPage",[Ro],Object.getOwnPropertyDescriptor(Ru.prototype,"mountPage"),Ru.prototype),st(Ru.prototype,"navigateFromNull",[Rs],Object.getOwnPropertyDescriptor(Ru.prototype,"navigateFromNull"),Ru.prototype),Rl=Ru))||Rl)||Rl)||Rl);_._RF.pop(),_._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var Rz,RG,RV,RK,RH,Rq,RW=k.ccclass,Rj=k.property,RX=(Rw=RW("StarProgressBar"),RS=Rj(ou),RE=Rj(P),R_=Rj(V),Rk=Rj(V),RC=Rj(x),Rw((RR=st((RT=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"progressBar",RR,Ke(g)),rt(g,"progressLabel",RI,Ke(g)),rt(g,"current",RP,Ke(g)),rt(g,"total",RL,Ke(g)),rt(g,"separator",RO,Ke(g)),g}return Ue(i,[{key:"setRange",value:function(g,E){this.total=E,this.current=g,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string="".concat(this.current).concat(this.separator).concat(this.total)}},{key:"animateTo",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=this,C=Math.min(g,this.total)/this.total,A=this.current,T=1,R=z(this.progressBar).to(3,{progress:C},{easing:"quadOut",onUpdate:function(E,C){C&&(k.current=A+Math.floor((g-A)*C),null==_||_(k.current),k.current===A-T&&(T++,z(k.progressLabel.node).to(.05,{scale:new em(1.2,1.2,1.2)}).to(.05,{scale:em.ONE}).start()),k.updateProgressLabel())}});null==E||E.addAbortListener(function(){k.current=g,k.updateProgress()});return[4,t$.runTweenAsync(R,E)];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(M)).prototype,"progressBar",[RS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RI=st(RT.prototype,"progressLabel",[RE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RP=st(RT.prototype,"current",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RL=st(RT.prototype,"total",[Rk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RO=st(RT.prototype,"separator",[RC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RA=RT))||RA);_._RF.pop(),_._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var RY,RJ,RQ,RZ,R$,R0,R1,R2,R4,R3,R5,R6=k.ccclass,R8=k.property,R9=(Rz=R6("EventButton"),RG=R8({type:es(Eg)}),RV=R8(J),Rz((Rq=st((RH=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"eventType",Rq,Ke(g)),g._isAvailable=!1,g}return Ue(n,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(g){this._isAvailable=g,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(nB,{type:this.eventType})}},{key:"setAnimationState",value:function(g){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),Je(Ve(n.prototype),"setAnimationState",this).call(this,g)}}]),n}(rc)).prototype,"eventType",[RG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Eg.STAR_CHEST}}),st(RH.prototype,"isAvailable",[RV],Object.getOwnPropertyDescriptor(RH.prototype,"isAvailable"),RH.prototype),RK=RH))||RK);_._RF.pop(),_._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var R7,Ie,It,In,Ii,Ir,Ia,Io,Is,Il,Iu,Ic,Ih,Ip,Id,If,Iy,Iv,Ig=k.ccclass,Im=k.property,Ib=globalThis.game.player,Iw=(RY=Ig("DashboardHeader"),RJ=Im({type:RX,displayName:"Progress bar",group:"Star Chest"}),RQ=Im({type:R9,displayName:"Button Component",group:"Star Chest"}),RZ=Im({type:ei,displayName:"Default Rest animation",group:"Star Chest"}),R$=Im({type:ei,displayName:"Special Rest animation",group:"Star Chest"}),RY((R2=st((R1=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"starProgressBar",R2,Ke(g)),rt(g,"chestButton",R4,Ke(g)),rt(g,"defaultRestAnimation",R3,Ke(g)),rt(g,"specialRestAnimation",R5,Ke(g)),g.handleStarsUpdateEvent=function(E){var _,k=null!=E?E:null===(_=Ib.getGameData())||void 0===_?void 0:_.stars;void 0!==k&&(g.starProgressBar.setRange(k,20),g.updateStarChestButtonAnimation(k))},g}return Ue(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),Q.on(nI,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function(){Q.off(nI,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function(g){this.handleStarsUpdateEvent(g)}},{key:"updateStarChestButtonAnimation",value:function(g){this.chestButton.isAvailable=g>=20}},{key:"validateRequiredComponents",value:function(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}},{key:"handleClickedSettingsButton",value:function(){l5.openScreen(iw.SETTINGS_SCREEN)}}]),n}(M)).prototype,"starProgressBar",[RJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R4=st(R1.prototype,"chestButton",[RQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R3=st(R1.prototype,"defaultRestAnimation",[RZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R5=st(R1.prototype,"specialRestAnimation",[R$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R0=R1))||R0);_._RF.pop(),_._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var IS,IE,I_,Ik,IC,IA,IT,IR,II,IP,IL,IO,IB=k.ccclass,IN=k.property,IM=k.executeInEditMode,ID=(R7=IB("JourneyLevelAvatar"),Ie=IN({type:eo,displayName:"Avatar node"}),It=IN(C),In=IN(G),Ii=IN(eu),Ir=IN({type:ei,group:"Animation"}),Ia=IN({type:ei,group:"Animation"}),Io=IN({type:ei,group:"Animation"}),Is=IN({type:ea,displayName:"Avatar sprite"}),R7(Il=IM((Ic=st((Iu=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"sprite",Ic,Ke(g)),rt(g,"lockIcon",Ih,Ke(g)),rt(g,"animation",Ip,Ke(g)),rt(g,"opacity",Id,Ke(g)),rt(g,"flashAnimation",If,Ke(g)),rt(g,"unlockAnimation",Iy,Ke(g)),rt(g,"spawnAnimation",Iv,Ke(g)),g}return Ue(o,[{key:"avatarSprite",get:function(){var g,E;return null!==(g=null===(E=this.sprite)||void 0===E?void 0:E.spriteFrame)&&void 0!==g?g:null},set:function(g){this.sprite&&(this.sprite.spriteFrame=g)}},{key:"playUnlockAnimation",value:(k=Be(function(){var g,E,_,k,C,A,T,R,I,P,L;return _ts_generator(this,function(O){switch(O.label){case 0:g=this.playAnimation(this.unlockAnimation),E=this.lockIcon.position.x,_=this.lockIcon.position.y,k=[45,135],C=(Math.random()*(k[1]-k[0])+k[0])*(Math.PI/180),A=this.lockIcon.position.x+150*Math.cos(C),T=this.lockIcon.position.y+150*Math.sin(C),R=_-400,I=t$.runTweenAsync(z(this.lockIcon).delay(.3).to(.2,{position:new em(A,T,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new em(A,R,this.lockIcon.position.z)},{easing:"cubicIn"})),P=[0,360],L=t$.runTweenAsync(z(this.lockIcon).delay(.3).to(.6,{eulerAngles:new em(0,0,Math.random()*(P[1]-P[0])*(A>E?-1:1))},{easing:"sineOut"}));return[4,Promise.all([g,I,L])];case 1:O.sent(),this.lockIcon.position=new em(E,_,this.lockIcon.position.z),this.lockIcon.eulerAngles=new em(0,0,0);return[2]}})}),function(){return k.apply(this,arguments)})},{key:"playFlashAnimation",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=this.node.position.y,_=this.playAnimation(this.flashAnimation),k=t$.runTweenAsync(z(this.node).to(.1,{position:new em(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new em(this.node.position.x,E,this.node.position.z)},{easing:"sineIn"}),g);return[4,Promise.all([_,k])];case 1:C.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(em.ZERO)}},{key:"playAnimation",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,t$.runAnimationAsync(this.animation,g.name)];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var g=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some(function(E){return null!==E&&(E.name===g.flashAnimation.name||E.name===g.unlockAnimation.name||E.name===g.spawnAnimation.name)}))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),o}(M)).prototype,"sprite",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ih=st(Iu.prototype,"lockIcon",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ip=st(Iu.prototype,"animation",[In],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Id=st(Iu.prototype,"opacity",[Ii],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),If=st(Iu.prototype,"flashAnimation",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iy=st(Iu.prototype,"unlockAnimation",[Ia],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv=st(Iu.prototype,"spawnAnimation",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Iu.prototype,"avatarSprite",[Is],Object.getOwnPropertyDescriptor(Iu.prototype,"avatarSprite"),Iu.prototype),Il=Iu))||Il)||Il);_._RF.pop(),_._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var IF,IU,Ix,Iz,IG,IV,IK,IH,Iq,IW,Ij,IX,IY,IJ,IQ,IZ,I$,I0,I1,I2,I4,I3=k.ccclass,I5=k.property,I6=k.executeInEditMode,I8=(IS=I3("JourneyProgressBar"),IE=I5(ou),I_=I5(P),Ik=I5(eu),IC=I5(V),IA=I5(V),IT=I5(x),IS(IR=I6((IP=st((II=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"progressBar",IP,Ke(g)),rt(g,"progressLabel",IL,Ke(g)),rt(g,"labelUIOpacity",IO,Ke(g)),g.currentProgress=10,g.totalProgress=10,g.labelSeparator="/",g}return Ue(i,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(g){this.labelSeparator=g,this.updateProgress()}},{key:"setRange",value:function(g,E){this.totalProgress=E;var _=g;_>E&&(_=E),this.currentProgress=_,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(E=Be(function(g){var E,_,k,C,A,T,R,I,P,L,O,B,N,M,D,F;return _ts_generator(this,function(U){switch(U.label){case 0:E=this,_=g.nextCurr,k=g.nextTotal,C=g.numberOfProgressBar,A=void 0===C?0:C,T=g.onProgressBarPassed,R=g.signal,I=_/k,P=z(this.labelUIOpacity).to(.2,{opacity:0}),L=z(this.labelUIOpacity).to(.2,{opacity:255}),O=A<1?1:Math.sqrt(A)+1,B=0===A?I:A+I,N=1,M=this.progressBar.progress,D=B,F=t$.runOnUpdateAsync(this.node,O,function(g){var _=el.sineInOut(g),k=eL(M,D,_);E.progressBar.progress=k%1,k>N&&(N=0===k?1:Math.ceil(k),null==T||T())},R);return[4,Promise.all([t$.runTweenAsync(P,R),F])];case 1:U.sent(),this.currentProgress=_,this.totalProgress=k,this.updateProgress();return[4,t$.runTweenAsync(L,R)];case 2:return[2,(U.sent(),this.labelUIOpacity.opacity=255,I)]}})}),function(g){return E.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string="".concat(this.currentProgress).concat(this.separator).concat(this.totalProgress)}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(M)).prototype,"progressBar",[IE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IL=st(II.prototype,"progressLabel",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IO=st(II.prototype,"labelUIOpacity",[Ik],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(II.prototype,"total",[IC],Object.getOwnPropertyDescriptor(II.prototype,"total"),II.prototype),st(II.prototype,"current",[IA],Object.getOwnPropertyDescriptor(II.prototype,"current"),II.prototype),st(II.prototype,"separator",[IT],Object.getOwnPropertyDescriptor(II.prototype,"separator"),II.prototype),IR=II))||IR)||IR);_._RF.pop(),_._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var I9,I7,Pe,Pt,Pn,Pi,Pr,Pa,Po,Ps,Pl,Pu,Pc,Ph,Pp,Pd,Pf,Py,Pv,Pg,Pm,Pb,Pw,PS,PE,P_,Pk,PC,PA,PT,PR,PI,PP=k.ccclass,PL=k.property,PO=(IF=PP("ProgressConfiguration"),IU=PL(ea),Ix=PL(x),IF((IG=st((Iz=Ue(function e(){Fe(this,e),rt(this,"avatar",IG,this),rt(this,"themeId",IV,this)})).prototype,"avatar",[IU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IV=st(Iz.prototype,"themeId",[Ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iz)),IK=PP("JourneyProgressAnimator"),IH=PL(I8),Iq=PL(C),IW=PL(eo),Ij=PL(ID),IX=PL({type:K,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),IY=nA.onlyRunInLifeCycleAsync,IJ=nA.onlyRunInLifeCycle,IK((I$=st((IZ=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"progressBar",I$,Ke(g)),rt(g,"currentLevelAvatarNode",I0,Ke(g)),rt(g,"currentLevelAvatar",I1,Ke(g)),rt(g,"nextLevelAvatar",I2,Ke(g)),rt(g,"nextLevelYOffset",I4,Ke(g)),g.isAnimating=!1,g}return Ue(l,[{key:"setRange",value:function(g,E){this.progressBar.setRange(g,E)}},{key:"animateTo",value:(T=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.isAnimating)return[2,(console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve())];this.isAnimating=!0;_=g!==this.progressBar.current;if(!_)return[3,2];return[4,this.progressBar.animateTo({nextCurr:g,nextTotal:this.progressBar.total,signal:E})];case 1:_=k.sent();k.label=2;case 2:this.isAnimating=!1;return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"animateToNextLevel",value:(A=Be(function(g){var E,_,k,C,A,T,R,I,P,L;return _ts_generator(this,function(O){switch(O.label){case 0:E=this,_=g.nextCurr,k=g.nextTotal,C=g.mapsPassed,A=g.signal;if(!this.isAnimating)return[3,1];console.warn("JourneyProgressAnimator: animation already in progress");return[3,8];case 1:this.isAnimating=!0;T=C.length-2;if(0!==T)return[3,3];return[4,this.progressBar.animateTo({nextCurr:_,nextTotal:k,signal:A})];case 2:return[2,(O.sent(),void(this.isAnimating=!1))];case 3:return[4,this.animateTargetAvaToCenter(A)];case 4:O.sent();R=1;return[4,this.progressBar.animateTo({signal:A,nextCurr:_,nextTotal:k,numberOfProgressBar:T,onProgressBarPassed:function(){if(1===R)return E.nextLevelAvatar.playUnlockAnimation(),void(R+=1);if(R>=C.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");E.nextLevelAvatar.playFlashAnimation(A),E.setNextLevelAvatar(C[R].theme),R+=1}})];case 5:O.sent();return[4,this.animateTargetAvaToPrev(A)];case 6:O.sent();I=C[C.length-1].theme,P=C[C.length-2].theme;this.setCurrentLevelAvatar(P),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal();L=this.nextLevelAvatar;return[4,this.getSpriteFrameByThemeId(I)];case 7:L.avatarSprite=O.sent(),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1;O.label=8;case 8:return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=new em(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);return[4,t$.runTweenAsync(z(this.nextLevelAvatar.node).to(1,{position:E},{easing:"cubicInOut"}),g)];case 1:_.sent(),this.nextLevelAvatar.node.position=E;return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this.currentLevelAvatarNode.position.clone();return[4,t$.runTweenAsync(z(this.nextLevelAvatar.node).to(1,{position:E},{easing:"cubicInOut"}),g)];case 1:_.sent(),this.nextLevelAvatar.node.position=E;return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:(_=Be(function(g){return _ts_generator(this,function(E){return[2,ii.loadThemeThumbnailAsync(g)]})}),function(g){return _.apply(this,arguments)})},{key:"loadAndSetAvatar",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.getSpriteFrameByThemeId(g)];case 1:_=k.sent();_?this.setAvatar(_,E):console.warn("JourneyProgressAnimator: ".concat(g," is null"));return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"setAvatar",value:function(g,E){_instanceof(E,ID)?E.avatarSprite=g:E.spriteFrame=g}},{key:"setCurrentLevelAvatar",value:function(g){this.loadAndSetAvatar(g,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(g){this.loadAndSetAvatar(g,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}}]),l}(M)).prototype,"progressBar",[IH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I0=st(IZ.prototype,"currentLevelAvatarNode",[Iq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I1=st(IZ.prototype,"currentLevelAvatar",[IW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I2=st(IZ.prototype,"nextLevelAvatar",[Ij],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I4=st(IZ.prototype,"nextLevelYOffset",[IX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),st(IZ.prototype,"loadAndSetAvatar",[IY],Object.getOwnPropertyDescriptor(IZ.prototype,"loadAndSetAvatar"),IZ.prototype),st(IZ.prototype,"setAvatar",[IJ],Object.getOwnPropertyDescriptor(IZ.prototype,"setAvatar"),IZ.prototype),IQ=IZ))||IQ);_._RF.pop(),_._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var PB,PN,PM,PD,PF,PU,Px,Pz,PG,PV=k.ccclass,PK=k.property,PH=globalThis.game,Pq=PH.storage,PW=PH.monitorError,Pj=GameCore.Utils,PX=Pj.Array,PY=Pj.Json,PJ=(I9=PV("HomeContent"),I7=nA.required(),Pe=PK({type:P,group:"Play Button"}),Pt=nA.required(),Pn=PK({type:B,group:"Play Button"}),Pi=nA.required(),Pr=PK({type:C,group:"Play Button"}),Pa=nA.required(),Po=PK({type:C,group:"Play Button"}),Ps=nA.required(),Pl=PK(PO),Pu=nA.required(),Pc=PK(Iw),Ph=nA.required(),Pp=PK(eu),Pd=nA.required(),Pf=PK(k9),Py=nA.onlyRunInLifeCycleAsync,Pv=nA.onlyRunInLifeCycleAsync,Pg=nA.onlyRunInLifeCycleAsync,Pm=nA.onlyRunInLifeCycleAsync,Pb=nA.onlyRunInLifeCycleAsync,I9((PE=st((PS=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"playButtonLabel",PE,Ke(g)),rt(g,"playButton",P_,Ke(g)),rt(g,"playBackground",Pk,Ke(g)),rt(g,"hardLevelBackground",PC,Ke(g)),rt(g,"journeyProgressAnimator",PA,Ke(g)),rt(g,"dashboardHeader",PT,Ke(g)),rt(g,"overlayDuringAnim",PR,Ke(g)),rt(g,"coinContainer",PI,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){nA.decorateComponent(this)}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(nP)}},{key:"setPlayButton",value:function(g){var E="Level ".concat(g);this.playButtonLabel.string=E;var _=g%5==0;this.playBackground.active=!_,this.hardLevelBackground.active=_}},{key:"updateStarProgress",value:function(g){this.dashboardHeader.updateStarProgress(g)}},{key:"setUnlockProgress",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E;this.setProgress(g),this.updateCurrentMapInStorage(g,_)}},{key:"shouldPlayUnlockAnimation",value:function(){var g,E,_=Pq.getStorage("dashboard");if(null==_)return null==PW||PW.sendException(new Error("DashboardScene: dashboardStorage not found")),!1;if(!(null!==(g=_.animateToCurrentLevel)&&void 0!==g&&g))return!1;var k=Pq.getStorage("tournament");if(null==k)return null==PW||PW.sendException(new Error("DashboardScene: tournamentStorage not found")),!1;if(null!==(E=k.animateTournamentLeader)&&void 0!==E&&E)return!1;var C=_.lastMapPayload,A=lh.getCurrentMapProgress();return PY.encode(C)!==PY.encode(A)&&!(PX.searchIndex(lr.mapOrder,function(g){return g.id===C.id})>PX.searchIndex(lr.mapOrder,function(g){return g.id===A.id}))}},{key:"playUnlockProgressAnimation",value:function(g){var E=Pq.getStorage("dashboard");if(null==E)throw new Error("DashboardScene: dashboardStorage not found");var _=E.lastMapPayload,k=lh.getCurrentMapProgress(),C=PX.searchIndex(lr.mapOrder,function(g){return g.id===_.id}),A=PX.searchIndex(lr.mapOrder,function(g){return g.id===k.id}),T=lr.mapOrder.slice(C,A+2);return _.id===k.id?this.playUnlockProgressAnimationOnly(k,_,g):this.playUnlockProgressAndPackAnimation(_,k,T,g)}},{key:"playUnlockProgressAndPackAnimation",value:(C=Be(function(g,E,_,k){return _ts_generator(this,function(C){switch(C.label){case 0:this.setProgress(Me({},g)),this.updateCurrentMapInStorage(Me({},E),!0),this.playButton.interactable=!1;return[4,this.showOwnOverlay(k)];case 1:C.sent();return[4,this.journeyProgressAnimator.animateToNextLevel({nextCurr:E.progress,nextTotal:E.max,mapsPassed:_,signal:k})];case 2:C.sent();return[4,this.hideOwnOverlay(k)];case 3:C.sent(),this.playButton.interactable=!0;return[2]}})}),function(g,E,_,k){return C.apply(this,arguments)})},{key:"playUnlockProgressAnimationOnly",value:(k=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:this.setProgress(Me(Me({},g),{},{progress:E.progress})),this.updateCurrentMapInStorage(Me({},g),!0);k=g.progress;return[4,this.showOwnOverlay(_)];case 1:C.sent();return[4,this.journeyProgressAnimator.animateTo(k,_)];case 2:C.sent();return[4,this.hideOwnOverlay(_)];case 3:C.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"hideOwnOverlay",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,t$.runTweenAsync(z(this.overlayDuringAnim).to(.3,{opacity:0}),g)];case 1:E.sent(),this.overlayDuringAnim.opacity=0;return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"showOwnOverlay",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,t$.runTweenAsync(z(this.overlayDuringAnim).to(.3,{opacity:150}),g)];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setProgress",value:function(g){var E=g.currentTheme,_=g.nextTheme,k=g.progress,C=g.max;this.journeyProgressAnimator.setCurrentLevelAvatar(E),this.journeyProgressAnimator.setNextLevelAvatar(null!=_?_:E),this.journeyProgressAnimator.setRange(k,C)}},{key:"updateCurrentMapInStorage",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=Pq.getStorage("dashboard");if(null!=k){var C=k.animateToCurrentLevel;Pq.setStorageData("dashboard","animateToCurrentLevel",!_&&C),Pq.setStorageData("dashboard","lastMapPayload",g)}else null==PW||PW.sendException(new Error("DashboardScene: dashboardStorage not found"))}}]),r}(M)).prototype,"playButtonLabel",[I7,Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P_=st(PS.prototype,"playButton",[Pt,Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pk=st(PS.prototype,"playBackground",[Pi,Pr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PC=st(PS.prototype,"hardLevelBackground",[Pa,Po],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PA=st(PS.prototype,"journeyProgressAnimator",[Ps,Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PT=st(PS.prototype,"dashboardHeader",[Pu,Pc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PR=st(PS.prototype,"overlayDuringAnim",[Ph,Pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PI=st(PS.prototype,"coinContainer",[Pd,Pf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(PS.prototype,"playUnlockProgressAnimation",[Py],Object.getOwnPropertyDescriptor(PS.prototype,"playUnlockProgressAnimation"),PS.prototype),st(PS.prototype,"playUnlockProgressAndPackAnimation",[Pv],Object.getOwnPropertyDescriptor(PS.prototype,"playUnlockProgressAndPackAnimation"),PS.prototype),st(PS.prototype,"playUnlockProgressAnimationOnly",[Pg],Object.getOwnPropertyDescriptor(PS.prototype,"playUnlockProgressAnimationOnly"),PS.prototype),st(PS.prototype,"hideOwnOverlay",[Pm],Object.getOwnPropertyDescriptor(PS.prototype,"hideOwnOverlay"),PS.prototype),st(PS.prototype,"showOwnOverlay",[Pb],Object.getOwnPropertyDescriptor(PS.prototype,"showOwnOverlay"),PS.prototype),Pw=PS))||Pw);_._RF.pop(),_._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var PQ,PZ,P$,P0,P1,P2,P4,P3,P5,P6,P8,P9,P7,Le,Lt,Ln,Li,Lr,La,Lo,Ls,Ll,Lu,Lc,Lh,Lp,Ld,Lf,Ly,Lv,Lg,Lm,Lb,Lw=k.ccclass,LS=k.property,LE=GameCore.Utils.Array,L_=(PB=Lw("NavManager"),PN=LS(C),PM=LS(C),PD=LS(t4),PB((Px=st((PU=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"selectorNode",Px,Ke(g)),rt(g,"selectedButtonNode",Pz,Ke(g)),rt(g,"autoLayout",PG,Ke(g)),g.navButtons=[],g.isNavigating=!1,g}return Ue(s,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var g;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(g=this.selectedButtonNode)||void 0===g?void 0:g.getComponentInChildren("NavButton"),nA.lazyValidateProperties(this)}},{key:"select",value:(A=Be(function(g){var E;return _ts_generator(this,function(_){E=this;if(!this.isNavigating){if(!LE.has(this.navButtons,g))throw new Error("NavManager: Button not found");if(g!==this.selectedButton){if(!g.isWIP)return[2,(this.isNavigating=!0,this.node.scene.emit(nL,{from:this.selectedButton.buttonType,to:g.buttonType}),new Promise(function(_){E.node.scene.once(nO,function(){var k=E.selectedButton.deselect();E.autoLayout.selectedIndex=E.navButtons.indexOf(g),E.selectedButton=g;var C=E.autoLayout.getSelectedWorldX()-g.getSelectedWorldDistanceX(),A=E.playSelectorAnimation(C),T=g.select();Promise.all([k,T,A]).then(function(){E.isNavigating=!1,_()})})}))];this.handleWIPButton()}}return[2]})}),function(g){return A.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(C=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=this.isNavigating;if(E)return[3,4];if(!LE.has([nN.store],g.buttonType))return[3,1];_=this.handleWIPButton();return[3,3];case 1:return[4,this.select(g)];case 2:_=k.sent();k.label=3;case 3:E=_;k.label=4;case 4:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"selectByType",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=LE.search(this.navButtons,function(E){return E.buttonType===g});if(!E)throw new Error("NavManager: Button not found");return[4,this.selectUsingSceneTransition(E)];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"handleWIPButton",value:function(){l5.openScreen(iw.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){g=this;if(!this.currentButton||!LE.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");E=this.currentButton.buttonType;return[2,(this.node.scene.emit(nL,{from:null,to:E}),new Promise(function(E){g.node.scene.once(nO,function(){g.autoLayout.selectedIndex=g.navButtons.indexOf(g.currentButton);var _=g.navButtons.map(function(E){return E===g.currentButton?E.select(!1):E.deselect(!1,!0)}),k=g.autoLayout.getSelectedWorldX()-g.currentButton.getSelectedWorldDistanceX();g.selectorNode.worldPosition=new em(k,g.selectorNode.worldPosition.y,0),Promise.all(_).then(function(){E()})})}))]})}),function(){return _.apply(this,arguments)})},{key:"playSelectorAnimation",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=new em(1,1,1),k=this.selectorNode.worldPosition.clone(),C=new em(1.2*_.x,.8*_.y,1);return[4,t$.runTweenAsync(z(this.selectorNode).to(.3,{worldPosition:new em(g,k.y,0)},{easing:"quintInOut",onUpdate:function(g,k){if(void 0!==k){var A=E.calculateCurrentSquashScale(_,C,k);E.selectorNode.scale=A}}}))];case 1:A.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setIgnoreInput",value:function(g){var E,_=!(arguments.length>0&&void 0!==g)||g,k=at(this.navButtons);try{for(k.s();!(E=k.n()).done;){var C=E.value,A=C.getComponentInChildren(B);A&&(A.interactable=!_)}}catch(g){k.e(g)}finally{k.f()}}},{key:"calculateCurrentSquashScale",value:function(g,E,_){var k=this.splitIntoSquashRatio(_);return g.clone().lerp(E,k)}},{key:"splitIntoSquashRatio",value:function(g){return g<.5?2*g:1-2*(g-.5)}}]),s}(M)).prototype,"selectorNode",[PN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pz=st(PU.prototype,"selectedButtonNode",[PM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PG=st(PU.prototype,"autoLayout",[PD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PF=PU))||PF);_._RF.pop(),_._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var Lk,LC,LA,LT,LR,LI,LP,LL,LO,LB,LN,LM,LD=k.ccclass,LF=k.disallowMultiple,LU=k.property,Lx=globalThis.game,Lz=Lx.event,LG=Lx.storage,LV=Lx.player,LK=Lx.leaderboard,LH=GameCore,Lq=LH.Events,LW=LH.Match.Modes,Lj=LH.Configs.DailyRewards,LX=LH.Utils,LY=LX.Time,LJ=LX.Array;PQ=LD("DashboardScene"),PZ=nA.required(),P$=LU(_Y),P0=nA.required(),P1=LU(L_),P2=nA.required(),P4=LU(il),P3=nA.required(),P5=LU(Rx),P6=nA.required(),P8=LU(kV),P9=nA.onlyRunInLifeCycle,P7=nA.onlyRunInLifeCycle,Le=nA.onlyRunInLifeCycleAsync,Lt=nA.onlyRunInLifeCycleAsync,Ln=nA.onlyRunInLifeCycleAsync,Li=nA.onlyRunInLifeCycleAsync,Lr=nA.onlyRunInLifeCycle,La=nA.onlyRunInLifeCycleAsync,Lo=nA.onlyRunInLifeCycleAsync,Ls=nA.onlyRunInLifeCycleAsync,Ll=nA.onlyRunInLifeCycleAsync,Lu=nA.onlyRunInLifeCycleAsync,Lc=nA.onlyRunInLifeCycleAsync,Lh=nA.onlyRunInLifeCycleAsync,Lp=nA.onlyRunInLifeCycle,PQ(Ld=LF((Ly=st((Lf=function(g){ze(v,g);var E,_,k,C,A,T,R,I,P,L,O,B,N,M,D=Xe(v);function v(){var g;Fe(this,v);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=D.call.apply(D,[this].concat(_)),"coinManager",Ly,Ke(g)),rt(g,"navManager",Lv,Ke(g)),rt(g,"bgComp",Lg,Ke(g)),rt(g,"pageManager",Lm,Ke(g)),rt(g,"pageAnimSkipOverlay",Lb,Ke(g)),g.firstNavigation=!0,g.isFirstNavToCollections=!0,g.isFirstNavToTournament=!0,g.navigationSignal=null,g.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch(function(g){console.warn("subscribeBotAsync",g)})},g.playBgAnim=Be(function(){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=LG.getStorage("dashboard");if(null==_)throw new Error("DashboardScene: dashboardStorage not found");k=null!==(E=_.animateToCurrentLevel)&&void 0!==E&&E,C=Me({},_.lastMapPayload),A=lh.getCurrentMapProgress(),T=C.currentTheme===A.currentTheme&&C.nextTheme===A.nextTheme,R=A.currentTheme;if(!(k&&!T))return[3,5];return[4,t$.waitTweenAsync(2)];case 1:I.sent();I.label=2;case 2:I.trys.push([2,4,,5]);return[4,g.bgComp.animateToNextTheme(R)];case 3:I.sent();return[3,5];case 4:I.sent();return[3,5];case 5:return[2]}})}),g}return Ue(v,[{key:"__preload",value:function(){}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(nL,this.onNavigate,this)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(nP,this.handlePlayButtonPress,this),this.node.scene.on(nB,this.handleEventButtonPress,this)}},{key:"onLoad",value:function(){nA.decorateComponent(this),this.listenNavigationEvents(),this.listenDashboardEvents(),this.coinManager.init(),lh.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(lh.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var g,E=(null!==(g=LV.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;_=0===_?1:_,LV.setGameData({level:_})}},{key:"start",value:function(){LV.getPlayerSetting("music")&&this.updateMusic(),this.playBgAnim(),this.pageManager.init(),this.navManager.selectDefaultNavBtn(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadScenes",value:function(){lV.preloadGameScene()}},{key:"initBgComp",value:function(){var g,E=LG.getStorage("dashboard");if(null==E)throw new Error("DashboardScene: dashboardStorage not found");var _=null!==(g=E.animateToCurrentLevel)&&void 0!==g&&g,k=Me({},E.lastMapPayload),C=lh.getCurrentMapProgress(),A=k.currentTheme===C.currentTheme&&k.nextTheme===C.nextTheme,T=C.currentTheme;_&&!A?this.bgComp.setCurrentTheme(k.currentTheme):this.bgComp.setCurrentTheme(T)}},{key:"handlePlayButtonPress",value:(M=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:T.trys.push([0,3,,4]);E=lh.getCurrentMapProgress(),_=(null!==(g=LV.getGameData())&&void 0!==g?g:{}).level,k=void 0===_?1:_;return[4,lT.setMatchCustomDataAsync({level:k})];case 1:T.sent();return[4,lT.startMatchAsync(LW.SINGLE)];case 2:T.sent(),this.updateCurrentMapInStorage(E),LG.setStorageData("collection","lastMapPack",E.id),LG.setStorageData("collection","animateMapPackUnlock",!1);C=LG.getStorage("leaderboard_content").lastTabOpened;this.getPlayerLeader(C).then(function(g){if(g){var E=g.score;LG.setStorageData("leaderboard_content","previousScore",E)}}),lV.switchScene(s0,{level:k});return[3,4];case 3:A=T.sent();return[2,void console.error(A)];case 4:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"getPlayerLeader",value:(N=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E="global"===g?sj:sX;if(!E)return[2,null];_=LV.getPlayerId();return[4,LK.getLeadersByPlayerIdsAsync(E,[_])];case 1:k=C.sent();return[2,0===k.length?null:k[0]]}})}),function(g){return N.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(g){LG.setStorageData("dashboard","animateToCurrentLevel",!1),LG.setStorageData("dashboard","lastMapPayload",g)}},{key:"updateMusic",value:(B=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=i9.getCurrentMusic()!==ip.BG_MUSIC;if(!g)return[3,3];return[4,i9.setVolumeMusic(0,!0)];case 1:E.sent();return[4,t$.waitTweenAsync(1)];case 2:g=E.sent();E.label=3;case 3:i9.playMusic(ip.BG_MUSIC),i9.turnUpMusic();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"checkDailyRewardsOpenable",value:function(){var g=LV.getPlayerData().dailyRewarded,E=g.logDays,_=void 0===E?[]:E,k=g.lastRewarded,C=void 0===k?0:k;if(_.length>Lj.MaxDays)return!0;if(Lj.MockTime>0&&Date.now()-C>=1e3*Lj.MockTime)return!0;return!LY.isToday(C)}},{key:"onNavigate",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=(this.firstNavigation&&(this.firstNavigation=!1,this.pageManager.unmountAndHideAll()),g.to);switch(E){case nN.store:return[3,1];case nN.collections:return[3,2];case nN.tournaments:return[3,5];case nN.leaderboard:return[3,5];case nN.home:return[3,7]}return[3,9];case 1:return[3,10];case 2:return[4,this.triggerPageNavigation(g)];case 3:_.sent();return[4,this.handleLogicAfterNavigateToCollections()];case 4:_.sent(),this.cleanupAfterPageNavigation();return[3,10];case 5:return[4,this.triggerPageNavigation(g)];case 6:_.sent(),this.cleanupAfterPageNavigation();return[3,10];case 7:return[4,this.handleNavigateToHome(g)];case 8:_.sent();return[3,10];case 9:throw new Error("DashboardScene: Unhandled page name");case 10:return[2]}})}),function(g){return O.apply(this,arguments)})},{key:"handleLogicAfterNavigateToCollections",value:(L=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=null===(g=this.pageManager.getPage(nN.collections))||void 0===g?void 0:g.getContainer().getComponentInChildren(TV);if(null==E)throw new Error("CollectionsContent not found");_=new nD,k=E.shouldAnimateThemeBlockUnlock();C=k;if(!C)return[3,2];return[4,this.openSkipOverlay(_)];case 1:C=T.sent();T.label=2;case 2:return[4,this.tryPlayScrollToCollectionAnim(E,_)];case 3:T.sent();return[4,E.playThemeTabUnlockAnim(_)];case 4:T.sent();A=k;if(!A)return[3,6];return[4,this.closeSkipOverlay()];case 5:A=T.sent();T.label=6;case 6:_.abort();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"closeSkipOverlay",value:(P=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.pageAnimSkipOverlay.close()];case 1:g.sent();return[2]}})}),function(){return P.apply(this,arguments)})},{key:"openSkipOverlay",value:(I=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,this.pageAnimSkipOverlay.open({onSkip:function(){return g.abort()},opacity:200})];case 1:E.sent();return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"tryPlayScrollToCollectionAnim",value:(R=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=lh.getCurrentUnlockingThemeIndex();k=this.isFirstNavToCollections&&null!==_;if(!k)return[3,2];return[4,g.scrollToCurrentUnlockingTheme(_,E)];case 1:k=(C.sent(),this.isFirstNavToCollections=!1);C.label=2;case 2:return[2]}})}),function(g,E){return R.apply(this,arguments)})},{key:"cleanupAfterPageNavigation",value:function(){this.navManager.setIgnoreInput(!1)}},{key:"triggerPageNavigation",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:null===(E=this.navigationSignal)||void 0===E||E.abort(),this.navigationSignal=new nD;return[4,this.pageManager.navigate(g,this.navigationSignal)];case 1:_.sent();return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"handleNavigateToHome",value:(A=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=this;null===(E=this.navigationSignal)||void 0===E||E.abort(),this.navigationSignal=new nD;return[4,this.pageManager.navigate(g,this.navigationSignal,Be(function(){return _ts_generator(this,function(g){_.initializeHomepageCoinManager();return[2]})}))];case 1:k.sent();return[4,this.handleLogicAfterNavigateToHome()];case 2:k.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"handleLogicAfterNavigateToHome",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.tryOpenDailyRewardsScreen()];case 1:g.sent(),this.attemptCallSubscribeBot();return[4,this.waitUntilCoinManagerFinishesAnyAnimation()];case 2:g.sent();return[4,this.waitUntilPageAnimSkipOverlayCloses()];case 3:g.sent();return[4,this.tryNavigateToTournament()];case 4:g.sent();return[4,this.tryPlayLevelUpAnimation()];case 5:g.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"waitUntilCoinManagerFinishesAnyAnimation",value:function(){return this.coinManager.untilFinishesCollectAnim()}},{key:"waitUntilPageAnimSkipOverlayCloses",value:function(){return this.pageAnimSkipOverlay.untilClosed()}},{key:"tryNavigateToTournament",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if(!LG.getStorage("tournament").animateTournamentLeader)return[3,2];return[4,this.navManager.selectByType(nN.tournaments)];case 1:return[2,g.sent()];case 2:if(!this.isFirstNavToTournament)return[3,8];this.isFirstNavToTournament=!1;g.label=3;case 3:g.trys.push([3,7,,8]);if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");return[4,GameSDK.getTournamentAsync()];case 4:if(!(g.sent().getEndTime()<Date.now()/1e3))return[3,6];return[4,this.navManager.selectByType(nN.tournaments)];case 5:return[2,g.sent()];case 6:return[3,8];case 7:g.sent();return[3,8];case 8:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"tryPlayLevelUpAnimation",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:E=this,_=null===(g=this.pageManager.getPage(nN.home))||void 0===g?void 0:g.getContainer().getComponentInChildren(PJ);if(null==_)throw new Error("DashboardScene: Homepage not found");k=new nD;k.chain(this.navigationSignal);C=_.shouldPlayUnlockAnimation(),A=this.shouldPlayPackUnlockAnimation();T=C;if(!T)return[3,7];R=A;if(!R)return[3,2];return[4,this.pageAnimSkipOverlay.open({onSkip:function(){return k.abort()},opacity:150})];case 1:R=P.sent();P.label=2;case 2:return[4,_.playUnlockProgressAnimation(k)];case 3:P.sent();I=A;if(!I)return[3,6];return[4,this.pageAnimSkipOverlay.close()];case 4:P.sent();return[4,k.callAsync(function(){return E.navManager.selectByType(nN.collections)})];case 5:I=P.sent();P.label=6;case 6:T=I;P.label=7;case 7:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"shouldPlayPackUnlockAnimation",value:function(){var g=LG.getStorage("dashboard");if(null==g)throw new Error("DashboardScene: dashboardStorage not found");var E=g.lastMapPayload,_=lh.getCurrentMapProgress();return LJ.searchIndex(lr.mapOrder,function(g){return g.id===E.id})!==LJ.searchIndex(lr.mapOrder,function(g){return g.id===_.id})}},{key:"initializeHomepageCoinManager",value:function(){var g,E=null===(g=this.pageManager.getPage(nN.home))||void 0===g?void 0:g.getContainer().getComponentInChildren(PJ);if(null==E)throw new Error("DashboardScene: Homepage not found");this.coinManager.setTargetContainer(E.getCoinContainer()),this.coinManager.emitCoinAmount()}},{key:"tryOpenDailyRewardsScreen",value:(E=Be(function(){return _ts_generator(this,function(g){if(this.checkDailyRewardsOpenable())return[2,(l5.openScreen(iw.DAILY_REWARDS_SCREEN),new Promise(function(g){Lz.on(Lq.CLOSED_SCREEN,function t(E){E.screenName===iS[iw.DAILY_REWARDS_SCREEN]&&(g(),Lz.off(Lq.CLOSED_SCREEN,t))})}))];return[2]})}),function(){return E.apply(this,arguments)})},{key:"handleEventButtonPress",value:function(g){switch(g.type){case Eg.STAR_CHEST:l5.openScreen(iw.STAR_CHEST_SCREEN);break;case Eg.BALLOON:l5.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}}}]),v}(M)).prototype,"coinManager",[PZ,P$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lv=st(Lf.prototype,"navManager",[P0,P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lg=st(Lf.prototype,"bgComp",[P2,P4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lm=st(Lf.prototype,"pageManager",[P3,P5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lb=st(Lf.prototype,"pageAnimSkipOverlay",[P6,P8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Lf.prototype,"preloadScenes",[P9],Object.getOwnPropertyDescriptor(Lf.prototype,"preloadScenes"),Lf.prototype),st(Lf.prototype,"initBgComp",[P7],Object.getOwnPropertyDescriptor(Lf.prototype,"initBgComp"),Lf.prototype),st(Lf.prototype,"handlePlayButtonPress",[Le],Object.getOwnPropertyDescriptor(Lf.prototype,"handlePlayButtonPress"),Lf.prototype),st(Lf.prototype,"onNavigate",[Lt],Object.getOwnPropertyDescriptor(Lf.prototype,"onNavigate"),Lf.prototype),st(Lf.prototype,"handleLogicAfterNavigateToCollections",[Ln],Object.getOwnPropertyDescriptor(Lf.prototype,"handleLogicAfterNavigateToCollections"),Lf.prototype),st(Lf.prototype,"tryPlayScrollToCollectionAnim",[Li],Object.getOwnPropertyDescriptor(Lf.prototype,"tryPlayScrollToCollectionAnim"),Lf.prototype),st(Lf.prototype,"cleanupAfterPageNavigation",[Lr],Object.getOwnPropertyDescriptor(Lf.prototype,"cleanupAfterPageNavigation"),Lf.prototype),st(Lf.prototype,"triggerPageNavigation",[La],Object.getOwnPropertyDescriptor(Lf.prototype,"triggerPageNavigation"),Lf.prototype),st(Lf.prototype,"handleNavigateToHome",[Lo],Object.getOwnPropertyDescriptor(Lf.prototype,"handleNavigateToHome"),Lf.prototype),st(Lf.prototype,"waitUntilCoinManagerFinishesAnyAnimation",[Ls],Object.getOwnPropertyDescriptor(Lf.prototype,"waitUntilCoinManagerFinishesAnyAnimation"),Lf.prototype),st(Lf.prototype,"waitUntilPageAnimSkipOverlayCloses",[Ll],Object.getOwnPropertyDescriptor(Lf.prototype,"waitUntilPageAnimSkipOverlayCloses"),Lf.prototype),st(Lf.prototype,"tryNavigateToTournament",[Lu],Object.getOwnPropertyDescriptor(Lf.prototype,"tryNavigateToTournament"),Lf.prototype),st(Lf.prototype,"tryPlayLevelUpAnimation",[Lc],Object.getOwnPropertyDescriptor(Lf.prototype,"tryPlayLevelUpAnimation"),Lf.prototype),st(Lf.prototype,"tryOpenDailyRewardsScreen",[Lh],Object.getOwnPropertyDescriptor(Lf.prototype,"tryOpenDailyRewardsScreen"),Lf.prototype),st(Lf.prototype,"handleEventButtonPress",[Lp],Object.getOwnPropertyDescriptor(Lf.prototype,"handleEventButtonPress"),Lf.prototype),Ld=Lf))||Ld);_._RF.pop(),_._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var LQ,LZ=k.ccclass,L$=k.property,L0=globalThis.game,L1=L0.player,L2=L0.storage,L4=L0.monitorError,L3=GameCore.Utils.Number;Lk=LZ("HomePage"),LC=nA.required(),LA=L$({type:P,group:"Placeholders"}),LT=nA.required(),LR=nA.getComponent(ad),LI=nA.onlyRunInLifeCycleAsync,LP=nA.onlyRunInLifeCycle,LL=nA.onlyRunInLifeCycleAsync,LO=nA.onlyRunInLifeCycleAsync,Lk((LN=st((LB=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"coinLabel",LN,Ke(g)),rt(g,"panelAnimationController",LM,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nA.decorateComponent(this)}},{key:"onEnable",value:function(){this.node.scene.on(r4.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"onDisable",value:function(){this.node.scene.off(r4.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"updatePlaceholderCoins",value:(C=Be(function(g){return _ts_generator(this,function(E){this.coinLabel.string=L3.getShortNumber(g.coins,3);return[2]})}),function(g){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){var g,E,_;if(!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(PJ),!this.homeContent))throw new Error("HomePage: homeContent not found");var k=L1.getGameData(),C=null!==(g=null==k?void 0:k.coins)&&void 0!==g?g:0;this.updatePlaceholderCoins({coins:C});var A=null!==(E=null==k?void 0:k.level)&&void 0!==E?E:1;this.homeContent.setPlayButton(A);var T=null!==(_=null==k?void 0:k.stars)&&void 0!==_?_:0;this.homeContent.updateStarProgress(T),this.initUnlockProgressData()}},{key:"initUnlockProgressData",value:function(){var g=this.homeContent.shouldPlayUnlockAnimation(),E=Me({},lh.getCurrentMapProgress()),_=L2.getStorage("dashboard");if(null==_)return null==L4||L4.sendException(new Error("DashboardScene: dashboardStorage not found")),void(g||this.homeContent.setUnlockProgress(E));var k=Me({},_.lastMapPayload);g?this.homeContent.setUnlockProgress(k):this.homeContent.setUnlockProgress(E)}},{key:"transitionIn",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:g.sent();return[4,this.panelAnimationController.showUI()];case 2:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent();return[4,this.panelAnimationController.hideUI()];case 2:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hasLoadedPage",value:function(){return!0}}]),r}(AE)).prototype,"coinLabel",[LC,LA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LM=st(LB.prototype,"panelAnimationController",[LT,LR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(LB.prototype,"mount",[LI],Object.getOwnPropertyDescriptor(LB.prototype,"mount"),LB.prototype),st(LB.prototype,"onMount",[LP],Object.getOwnPropertyDescriptor(LB.prototype,"onMount"),LB.prototype),st(LB.prototype,"transitionIn",[LL],Object.getOwnPropertyDescriptor(LB.prototype,"transitionIn"),LB.prototype),st(LB.prototype,"transitionOut",[LO],Object.getOwnPropertyDescriptor(LB.prototype,"transitionOut"),LB.prototype),LB));_._RF.pop(),_._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var L5,L6,L8,L9,L7,Oe,Ot,On,Oi,Or,Oa,Oo,Os,Ol,Ou,Oc,Oh,Op,Od,Of,Oy=(0,k.ccclass)("LeaderboardIsEmpty")(LQ=function(g){ze(i,g);var E,_=Xe(i);function i(){return Fe(this,i),_.apply(this,arguments)}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.uiOpacity.opacity=255;g=this.node.position.clone(),E=z(this.node);E.to(.05,{position:g.clone().add3f(5,0,0)}),E.to(.05,{position:g.clone().add3f(-5,0,0)});_=z(this.node).repeat(2,E);_.to(.05,{position:g});return[4,t$.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),i}(M))||LQ;_._RF.pop(),_._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var Ov,Og,Om,Ob,Ow,OS,OE,O_=k.ccclass,Ok=k.property,OC=k.requireComponent,OA=globalThis.game.analytics,OT=GameCore,OR=OT.Utils.Array,OI=OT.Plugins.Analytics.Events,OP=(L5=O_("SwitchButton"),L6=OC([B,G]),L8=Ok(J),L9=Ok(C),L7=Ok(C),Oe=Ok(J),Ot=Ok({visible:function(){return this.useSound},type:iv}),On=Ok(J),Oi=Ok({visible:function(){return this.useDesktopHover},type:ei}),Or=Ok({visible:function(){return this.useDesktopHover},type:ei}),L5(Oa=L6((Os=st((Oo=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"enable",Os,Ke(g)),rt(g,"nodeOn",Ol,Ke(g)),rt(g,"nodeOff",Ou,Ke(g)),rt(g,"useSound",Oc,Ke(g)),rt(g,"soundKey",Oh,Ke(g)),rt(g,"useDesktopHover",Op,Ke(g)),rt(g,"mouseEnterClip",Od,Ke(g)),rt(g,"mouseLeaveClip",Of,Ke(g)),g.isMouseLeaved=!1,g.onMouseEnter=function(E){g.useDesktopHover&&g.buttonComponent.interactable&&(g.isMouseLeaved=!1,g.animationComponent.play(g.mouseEnterClip.name))},g.onMouseLeave=function(E){g.useDesktopHover&&g.buttonComponent.interactable&&(g.isMouseLeaved||(g.isMouseLeaved=!0,g.animationComponent.play(g.mouseLeaveClip.name)))},g}return Ue(n,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(B),this.animationComponent=this.getComponent(G),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var g=this.animationComponent.clips.map(function(g){return null==g?void 0:g.name}).filter(function(g){return null!=g&&"string"==typeof g});this.useDesktopHover&&(OR.has(g,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),OR.has(g,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(OA.event(OI.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&i9.playSound(ib[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(g){this.node.active&&this.updateStatus(g)}},{key:"updateStatus",value:function(g){return this.enable===g||(this.onMouseLeave(null),this.enable=g,this.nodeOn.active=g,this.nodeOff.active=!g),this.enable}}]),n}(M)).prototype,"enable",[L8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ol=st(Oo.prototype,"nodeOn",[L9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ou=st(Oo.prototype,"nodeOff",[L7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oc=st(Oo.prototype,"useSound",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Oh=st(Oo.prototype,"soundKey",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iv[ip.BUTTON_CLICK]}}),Op=st(Oo.prototype,"useDesktopHover",[On],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Od=st(Oo.prototype,"mouseEnterClip",[Oi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Of=st(Oo.prototype,"mouseLeaveClip",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oa=Oo))||Oa)||Oa);_._RF.pop(),_._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var OL,OO,OB,ON,OM,OD,OF,OU,Ox,Oz=k.ccclass,OG=k.property,OV=globalThis.game.analytics,OK=GameCore.Plugins.Analytics.Events,OH=(Ov=Oz("Tabs"),Og=OG(OP),Om=OG(OP),Ov((OS=st((Ow=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"tabWorld",OS,Ke(g)),rt(g,"tabFriends",OE,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents(),"MsGames"===GameSDK.getSDKName()&&(this.tabWorld.node.active=!1,this.tabFriends.node.active=!1)}},{key:"validateRequiredComponents",value:function(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}},{key:"setInteractableButtons",value:function(g){this.tabWorld.getComponent(B).interactable=g,this.tabFriends.getComponent(B).interactable=g}},{key:"updateStatus",value:function(g){this.tabWorld.setEnabled("global"===g),this.tabFriends.setEnabled("friends"===g)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),i9.playSound(ip.BUTTON_CLICK),OV.event(OK.BUTTON_CLICK,{button_name:this.node.name,screen_name:iA.getCurrentPage()}),this.node.scene.emit(Em.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),i9.playSound(ip.BUTTON_CLICK),OV.event(OK.BUTTON_CLICK,{button_name:this.node.name,screen_name:iA.getCurrentPage()}),this.node.scene.emit(Em.FRIENDS_TAB_SELECTED)}}]),n}(M)).prototype,"tabWorld",[Og],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OE=st(Ow.prototype,"tabFriends",[Om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ob=Ow))||Ob);_._RF.pop(),_._RF.push({},"91613SO4bxPDq9dH9zxyIef","LeaderboardTimer",void 0);var Oq,OW,Oj,OX,OY,OJ=k.ccclass,OQ=k.property,OZ=GameCore.Utils.Time,O$=(OL=OJ("LeaderboardTimer"),OO=OQ(R),OB=OQ(C),ON=OQ(P),OL((OF=st((OD=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"background",OF,Ke(g)),rt(g,"calendar",OU,Ke(g)),rt(g,"timerLabel",Ox,Ke(g)),g.alreadyShown=!1,g}return Ue(i,[{key:"onLoad",value:function(){this.timerOpacity=this.timerLabel.node.getComponent(eu),this.validateRequiredComponents(),this.backgroundDefaultWidth=this.background.width,this.calendarDefaultPosition=this.calendar.position.clone()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(!this.alreadyShown&&!g.aborted))return[3,3];this.alreadyShown=!0;E=z(this.calendar).to(.3,{scale:em.ONE},{easing:"backOut"}).to(.3,{position:this.calendarDefaultPosition.clone()},{easing:"quadOut"}),_=z(this.background).delay(.3).to(.3,{width:this.backgroundDefaultWidth},{easing:"quadOut"}),k=z(this.timerOpacity).to(.3,{opacity:255});return[4,Promise.all([t$.runTweenAsync(E,g),t$.runTweenAsync(_,g)])];case 1:C.sent(),this.calendar.scale=em.ONE,this.calendar.position=this.calendarDefaultPosition.clone(),this.background.width=this.backgroundDefaultWidth;return[4,t$.runTweenAsync(k,g)];case 2:C.sent(),this.timerOpacity.opacity=255;C.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"reset",value:function(){this.alreadyShown||(this.calendar.position=this.background.node.position.clone(),this.calendar.scale=em.ZERO,this.background.width=0,this.timerOpacity.opacity=0)}},{key:"setTimeLabel",value:function(g){if(g){var E=new Date,_=0;if("manually"===g)_=0;else if("daily"===g)_=Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+1);else if("weekly"===g){var k=E.getUTCDay(),C=0===k?1:8-k;_=Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+C)}else _="monthly"===g?Date.UTC(E.getUTCFullYear(),E.getUTCMonth()+1):Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+1);this.timerLabel.string="Ends ".concat(OZ.getRelativeTime(_/1e3))}else this.timerLabel.string="Ends soon"}}]),i}(M)).prototype,"background",[OO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OU=st(OD.prototype,"calendar",[OB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ox=st(OD.prototype,"timerLabel",[ON],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OM=OD))||OM);_._RF.pop(),_._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var O0,O1,O2,O4,O3,O5,O6,O8,O9,O7,Bt,Bn,Bi,Br,Ba,Bo,Bs,Bl,Bu,Bc,Bp,Bf,By,Bv,Bg,Bm,Bb,Bw,BS,BE,B_,Bk,BC,BA,BT,BR,BI,BP,BL,BO,BB,BN,BM,BD,BF=k.ccclass,BU=k.disallowMultiple,Bx=k.property,Bz=(Oq=BF("LeaderSkeleton"),OW=Bx(C),Oq(Oj=BU((OY=st((OX=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",OY,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,t$.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=this;this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;k=this.container.position.clone();this.container.position=new em(k.x,k.y-100,k.z);C=z(this.node).delay(g);C.to(.2,{scale:em.ONE},{easing:"cubicOut"});A=z(this.container).delay(g);A.to(.2,{position:k},{easing:"cubicOut"});T=z(this.uiOpacity).delay(g);T.to(.2,{opacity:255},{easing:"cubicOut"}),E.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=k,_.uiOpacity.opacity=255});return[4,Promise.all([t$.runTweenAsync(C,E),t$.runTweenAsync(A,E),t$.runTweenAsync(T,E)])];case 1:R.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(M)).prototype,"container",[OW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oj=OX))||Oj)||Oj);_._RF.pop(),_._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var BG,BV,BK,BH,Bq,BW,Bj,BX,BY,BJ,BQ,BZ,B$,B0=k.ccclass,B1=k.property,B2=GameCore.Utils.Number,B4=(O0=B0("Leader"),O1=B1(P),O2=B1(eu),O4=B1({type:C,group:"Container"}),O3=B1({type:eo,group:"Background"}),O5=B1({type:ea,group:"Background"}),O6=B1({type:eo,group:"Rank"}),O8=B1({type:P,group:"Rank"}),O9=B1({type:ea,group:"Rank"}),O7=B1({type:ea,group:"Rank"}),Bt=B1({type:ea,group:"Rank"}),Bn=B1({type:ea,group:"Rank"}),Bi=B1({type:eo,group:"Avatar"}),Br=B1({type:eu,group:"Avatar"}),Ba=B1({type:eo,group:"Score"}),Bo=B1({type:P,group:"Score"}),Bs=B1({type:ea,group:"Score"}),Bl=B1({type:eu,group:"Score"}),Bu=B1({type:eu}),Bc=B1({type:R}),Bp=nA.onlyRunInLifeCycle,Bf=nA.onlyRunInLifeCycleAsync,By=nA.onlyRunInLifeCycle,O0((Bm=st((Bg=function(g){ze(l,g);var E,_,k,C,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"nameLabel",Bm,Ke(g)),rt(g,"nameOpacity",Bb,Ke(g)),rt(g,"container",Bw,Ke(g)),rt(g,"background",BS,Ke(g)),rt(g,"highlightBackground",BE,Ke(g)),rt(g,"rankSprite",B_,Ke(g)),rt(g,"rankLabel",Bk,Ke(g)),rt(g,"goldRank",BC,Ke(g)),rt(g,"silverRank",BA,Ke(g)),rt(g,"bronzeRank",BT,Ke(g)),rt(g,"highlightRank",BR,Ke(g)),rt(g,"avatar",BI,Ke(g)),rt(g,"avatarOpacity",BP,Ke(g)),rt(g,"scoreBackground",BL,Ke(g)),rt(g,"scoreLabel",BO,Ke(g)),rt(g,"highlightScoreBackground",BB,Ke(g)),rt(g,"scoreOpacity",BN,Ke(g)),rt(g,"uiOpacity",BM,Ke(g)),rt(g,"uiTransform",BD,Ke(g)),g.signal=new nD,g}return Ue(l,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.defaultAvatar=this.avatar.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g,E){this.updateBackground(g),this.updateRank(g,E),this.updatePhoto(g),this.updateUsername(g),this.updateScore(g)}},{key:"updateBackground",value:function(g){this.background.spriteFrame=g.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(g,E){var _=g.rank;this.rankLabel.string=E&&_>E?"".concat(E,"+"):_.toString(),this.rankSprite.spriteFrame=this.defaultRank;var k=new A(E_);switch(g.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,k=new A(EC)),_){case 1:this.rankSprite.spriteFrame=this.goldRank,k=new A(Eb);break;case 2:this.rankSprite.spriteFrame=this.silverRank,k=new A(Ew);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,k=new A(ES)}this.rankLabel.shadowColor=k,this.rankLabel.outlineColor=k}},{key:"updatePhoto",value:(T=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.signal.abort();E=new nD;if(this.signal=E,!this.avatar)return[3,5];_=g.playerId,k=g.photo;if(!bF.isAvatarCached(g.playerId,70))return[3,2];return[4,bF.getPlayerAvatar(k,_,70,E)];case 1:C=T.sent();if(!C||E.aborted)return[2];this.setPhoto(C);return[3,5];case 2:this.avatar.spriteFrame=this.defaultAvatar;return[4,t$.waitTweenAsync(.1,E)];case 3:if(T.sent(),!!E.aborted)return[3,5];return[4,bF.getPlayerAvatar(k,_,70,E)];case 4:A=T.sent();A&&!E.aborted&&this.setPhoto(A);T.label=5;case 5:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"setPhoto",value:function(g){this.node.active&&(g.packable=!0,this.avatar.spriteFrame=g)}},{key:"updateUsername",value:function(g){this.nameLabel.string=g.name,this.nameLabel.color=new A(g.isHighlight?Ek:EE)}},{key:"updateScore",value:function(g){var E=Math.floor(g.score);this.scoreLabel.string=B2.getShortNumber(E,7);var _=this.scoreLabel.getComponent(P);_.outlineColor=new A(g.isHighlight?EC:E_),_.shadowColor=new A(g.isHighlight?EC:E_),this.scoreBackground.spriteFrame=g.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(C=Be(function(g,E){var _,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:_=this,k=I.length>2&&void 0!==I[2]?I[2]:.3;this.node.scale=new em(.8,.8,.8),this.setVisible(!1);C=this.container.position.clone();this.container.position=new em(C.x,C.y-100,C.z);A=z(this.node).delay(E);A.to(k,{scale:em.ONE},{easing:"elasticOut"});T=z(this.container).delay(E);T.to(k,{position:C},{easing:"backOut"});R=z(this.uiOpacity).delay(E);R.to(k,{opacity:255},{easing:"cubicOut",onUpdate:function(){_.nameOpacity.opacity=_.uiOpacity.opacity,_.scoreOpacity.opacity=_.uiOpacity.opacity,_.avatarOpacity.opacity=_.uiOpacity.opacity}}),g.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=C,_.uiOpacity.opacity=255,_.avatar.node.active=!0});return[4,Promise.all([t$.runTweenAsync(A,g),t$.runTweenAsync(T,g),t$.runTweenAsync(R,g)])];case 1:P.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(k=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=z(this.node).to(E,{worldPosition:g},{easing:"quadOut"});return[4,t$.runTweenAsync(k,_)];case 1:C.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"runScaleAnimation",value:(_=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=z(this.node).to(E,{scale:new em(g,g,g)},{easing:"backOut"});return[4,t$.runTweenAsync(k,_)];case 1:C.sent();return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(E=Be(function(g,E,_,k,C,A){var T;return _ts_generator(this,function(R){switch(R.label){case 0:T=this;return[4,t$.runOnUpdateAsync(this.node,C,function(C){var A=Math.floor(g+(E-g)*C),R=Math.floor(_+(k-_)*C);T.updateRank({rank:A,isHighlight:!0}),T.updateScore({score:R,isHighlight:!0})},A)];case 1:R.sent();return[2]}})}),function(g,_,k,C,A,T){return E.apply(this,arguments)})},{key:"setVisible",value:function(g){var E=g?255:0;this.uiOpacity.opacity=E,this.nameOpacity.opacity=E,this.scoreOpacity.opacity=E,this.avatarOpacity.opacity=E}}]),l}(M)).prototype,"nameLabel",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bb=st(Bg.prototype,"nameOpacity",[O2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bw=st(Bg.prototype,"container",[O4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BS=st(Bg.prototype,"background",[O3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BE=st(Bg.prototype,"highlightBackground",[O5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=st(Bg.prototype,"rankSprite",[O6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bk=st(Bg.prototype,"rankLabel",[O8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BC=st(Bg.prototype,"goldRank",[O9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BA=st(Bg.prototype,"silverRank",[O7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BT=st(Bg.prototype,"bronzeRank",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BR=st(Bg.prototype,"highlightRank",[Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=st(Bg.prototype,"avatar",[Bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BP=st(Bg.prototype,"avatarOpacity",[Br],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BL=st(Bg.prototype,"scoreBackground",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BO=st(Bg.prototype,"scoreLabel",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BB=st(Bg.prototype,"highlightScoreBackground",[Bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BN=st(Bg.prototype,"scoreOpacity",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=st(Bg.prototype,"uiOpacity",[Bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BD=st(Bg.prototype,"uiTransform",[Bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Bg.prototype,"updateInfo",[Bp],Object.getOwnPropertyDescriptor(Bg.prototype,"updateInfo"),Bg.prototype),st(Bg.prototype,"updatePhoto",[Bf],Object.getOwnPropertyDescriptor(Bg.prototype,"updatePhoto"),Bg.prototype),st(Bg.prototype,"setPhoto",[By],Object.getOwnPropertyDescriptor(Bg.prototype,"setPhoto"),Bg.prototype),Bv=Bg))||Bv);_._RF.pop(),_._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var B3,B5,B6,B8,B9,B7,Ne,Nt,Nn,Ni,Nr,Na,No,Ns,Nl,Nu,Nc,Np,Nf,Ny,Nv,Ng,Nm,Nb,Nw,NS,NE=k.ccclass,N_=k.property,Nk=globalThis.game.player,NC=GameCore.Utils.Array,NA=(BG=NE("Leaders"),BV=N_(Ao),BK=N_(B4),BH=N_(V),Bq=nA.onlyRunInLifeCycleAsync,BW=nA.onlyRunInLifeCycleAsync,Bj=nA.onlyRunInLifeCycleAsync,BX=nA.onlyRunInLifeCycleAsync,BG((BQ=st((BJ=function(g){ze(u,g);var E,_,k,C,A,T,I=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=I.call.apply(I,[this].concat(_)),"scrollView",BQ,Ke(g)),rt(g,"tempLeader",BZ,Ke(g)),rt(g,"maxLeader",B$,Ke(g)),g.leaderData=[],g.displayLeaderData=[],g.displayPlayerLeader=null,g.isHidden=!0,g}return Ue(u,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.batchNodes=this.getComponents(sT),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=Nk.getPlayerId()}},{key:"updateData",value:(T=Be(function(g){return _ts_generator(this,function(E){this.isHidden=!1,this.leaderData=g,this.leaderData.forEach(function(g,E){g.rank=E+1}),this.setupDisplayLeadersData();return[2]})}),function(g){return T.apply(this,arguments)})},{key:"initScrollViews",value:function(){var g=this;this.scrollView.setMaxNodeCount(this.leaderData.length),this.scrollView.init(function(E){var _=E.getComponent(B4),k=g.displayLeaderData[E.order],C=k.playerId,A=k.photo,T=k.name,R=k.score;_.setVisible(!0),_.updateInfo({playerId:C,isHighlight:g.currentPlayerId===C,name:T,photo:A,rank:E.order+1,score:R},g.maxLeader)}),this.setBatchNodes(!0)}},{key:"playRankChangeAnimation",value:(A=Be(function(g,E,_,k){var C,A,T,R,I,P,L,O,B,N,M,D;return _ts_generator(this,function(F){switch(F.label){case 0:if(E>=_)return[3,4];C=this.displayLeaderData,A=NC.search(C,function(g){return g.playerId===Nk.getPlayerId()});if(!A)return[3,4];T=A.rank;if(!C[k-1])return[3,4];R=this.scrollView.getNodeByOrder(A.rank-1);if(!R)return[3,4];I=null==R?void 0:R.getComponent(B4);if(!I)return[3,4];I.setVisible(!1),this.tempLeader.setVisible(!0),this.tempLeader.updatePhoto({playerId:Nk.getPlayerId(),photo:A.photo}),this.tempLeader.node.worldPosition=R.node.worldPosition.clone();return[4,this.tempLeader.runScaleAnimation(1.1,.5,g)];case 1:F.sent();P=Math.min(.5*(T-k),2),L=[this.tempLeader.runUpdateDataAnimation(T,k,E,_,P,g),this.scrollToLeaderRank(k,P,g)],O=this.scrollView.scrollView.getMaxScrollOffset().y,B=this.scrollView.getNodeScrollOffset(k-1),N=em.ZERO;if(B<0)N=new em(this.tempLeader.node.worldPosition.x,this.node.worldPosition.y+this.scrollView.getNodePosition(k-1).y+this.uiTransform.height/2,this.tempLeader.node.worldPosition.z);else if(this.scrollView.scrollView.getScrollOffset().y>=O-5){if(B<O)N=new em(this.tempLeader.node.worldPosition.x,this.scrollView.viewport.node.worldPosition.y,this.tempLeader.node.worldPosition.z);else{D=this.scrollView.getNodeByOrder(k-1);N=null!==(M=null==D?void 0:D.node.worldPosition.clone())&&void 0!==M?M:em.ZERO}}N.equals(em.ZERO)||L.push(this.tempLeader.runWorldPositionAnimation(N,P,g));return[4,Promise.all(L)];case 2:F.sent();return[4,Promise.all([this.tempLeader.runScaleAnimation(1,.25,g),this.playPostRankChangeAnimation(k,T,g)])];case 3:F.sent(),this.tempLeader.setVisible(!1),R.node.worldPosition=this.tempLeader.node.worldPosition.clone(),this.setupDisplayLeadersData(),this.scrollView.updateNodeVisibility(),this.scrollView.updateLayout();F.label=4;case 4:return[2]}})}),function(g,E,_,k){return A.apply(this,arguments)})},{key:"playShowLeadersAnimation",value:(C=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:E=this,_=T.length>1&&void 0!==T[1]?T[1]:.1;if(!!this.isHidden)return[3,2];k=[],C=this.scrollView.getAllNodes();if(C.sort(function(g,E){return g.order-E.order}).forEach(function(g,_){var C=g.getComponent(B4);C.setVisible(_<E.leaderData.length),g.isVisible()&&k.push(C)}),k.length<1)return[3,2];k=k.slice(0,C.length-1);A=.3;return[4,Promise.all(k.map(function(){var k=Be(function(k,C){var T;return _ts_generator(this,function(R){switch(R.label){case 0:T=E.isHidden;if(T)return[3,2];return[4,k.runShowUpAnimation(g,C*_,A)];case 1:T=R.sent();R.label=2;case 2:return[2]}})});return function(g,E){return k.apply(this,arguments)}}()))];case 1:R.sent();R.label=2;case 2:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"scrollToPlayerLeader",value:(k=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:_=this.displayPlayerLeader;if(!_)return[3,2];return[4,this.scrollToLeaderRank(this.displayPlayerLeader.rank,g,E)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"updateDisplayPlayerLeaderForRankChanging",value:function(g,E,_){if(!this.displayPlayerLeader)return!1;this.displayPlayerLeader.score=g,this.displayLeaderData.sort(function(g,E){return E.score-g.score});var k=this.displayLeaderData.indexOf(this.displayPlayerLeader)+1;return _===k?(this.displayPlayerLeader.score=E,this.displayPlayerLeader.rank=_,!1):(this.displayPlayerLeader.rank=k,this.tempLeader.updateInfo({playerId:Nk.getPlayerId(),isHighlight:!0,name:this.displayPlayerLeader.name,photo:this.displayPlayerLeader.photo,rank:this.displayPlayerLeader.rank,score:g}),!0)}},{key:"hideLeaders",value:function(){this.isHidden=!0;var g,E=at(this.scrollView.getAllNodes().map(function(g){return g.getComponent(B4)}));try{for(E.s();!(g=E.n()).done;){var _=g.value;null==_||_.setVisible(!1)}}catch(g){E.e(g)}finally{E.f()}this.setBatchNodes(!1)}},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"setBatchNodes",value:function(g){this.batchNodes.every(function(E){E.enabled=g})}},{key:"setupDisplayLeadersData",value:function(){var g=this,E=NC.search(this.leaderData,function(E){return E.playerId===g.currentPlayerId});E?(this.displayLeaderData=this.leaderData.filter(function(E){return E.playerId!==g.currentPlayerId}),this.displayPlayerLeader=Me({},E),this.displayLeaderData.splice(E.rank-1,0,this.displayPlayerLeader)):(this.displayPlayerLeader=null,this.displayLeaderData=this.leaderData)}},{key:"playPostRankChangeAnimation",value:(_=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=null!=g?g:0,C=this.scrollView.getVisibleNodes().filter(function(g){return g.order>=k-1&&g.order<E}),A=C.map(function(g){return g.getComponent(B4)}),T=this.scrollView.nodeHeight+this.scrollView.spacing,R=[];A.forEach(function(g,E){g.updateRank({rank:C[E].order+2,isHighlight:!1});var k=g.node.worldPosition.clone();R.push(g.runWorldPositionAnimation(k.add3f(0,-T,0),.25,_))});return[4,Promise.all(R)];case 1:I.sent();return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"scrollToLeaderRank",value:(E=Be(function(g,E,_){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.scrollView.scrollToOrder(g-1,_,E)];case 1:k.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),u}(M)).prototype,"scrollView",[BV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BZ=st(BJ.prototype,"tempLeader",[BK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B$=st(BJ.prototype,"maxLeader",[BH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(BJ.prototype,"updateData",[Bq],Object.getOwnPropertyDescriptor(BJ.prototype,"updateData"),BJ.prototype),st(BJ.prototype,"playRankChangeAnimation",[BW],Object.getOwnPropertyDescriptor(BJ.prototype,"playRankChangeAnimation"),BJ.prototype),st(BJ.prototype,"scrollToPlayerLeader",[Bj],Object.getOwnPropertyDescriptor(BJ.prototype,"scrollToPlayerLeader"),BJ.prototype),st(BJ.prototype,"scrollToLeaderRank",[BX],Object.getOwnPropertyDescriptor(BJ.prototype,"scrollToLeaderRank"),BJ.prototype),BY=BJ))||BY);_._RF.pop(),_._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var NT,NR,NI,NP,NL,NO,NB,NN,NM=k.ccclass,ND=k.property,NF=globalThis.game,NU=NF.storage,Nx=NF.leaderboard,Nz=NF.player,NG=NF.monitorError,NV=GameCore,NK=NV.Utils.Object,NH=NV.Configs.Leaderboards,Nq=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),(_=E.call(this,g)).name="EmptyLeaderboardError",_}return Ue(n)}(je(Error)),NW=(B3=NM("LeaderboardContent"),B5=nA.required(),B6=ND(OH),B8=nA.required(),B9=ND(O$),B7=nA.required(),Ne=ND(NA),Nt=ND({type:[Bz]}),Nn=nA.required(),Ni=ND(Oy),Nr=nA.required(),Na=ND(ry),No=nA.onlyRunInLifeCycleAsync,Ns=nA.onlyRunInLifeCycleAsync,Nl=nA.onlyRunInLifeCycleAsync,Nu=nA.onlyRunInLifeCycleAsync,Nc=nA.onlyRunInLifeCycleAsync,Np=nA.onlyRunInLifeCycleAsync,B3((Nv=st((Ny=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"tabs",Nv,Ke(g)),rt(g,"timer",Ng,Ke(g)),rt(g,"leaders",Nm,Ke(g)),rt(g,"leaderSkeletons",Nb,Ke(g)),rt(g,"leaderboardIsEmpty",Nw,Ke(g)),rt(g,"contentOpacity",NS,Ke(g)),g.isHidden=!0,g.currentLb=null,g.animAbortSignal=new nD,g.hasPlayedAppearAnim={friends:!1,global:!1,tournament:!1},g.handleFriendsTabSelected=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:NU.setStorageData("leaderboard_content","lastTabOpened","friends"),g.cleanupSideEffects();E=g.animAbortSignal;k.label=1;case 1:k.trys.push([1,3,,4]);return[4,g.updateStatus(E,"friends")];case 2:k.sent();return[3,4];case 3:_=k.sent();E.call(function(){var g=_instanceof(_,Error)?_:new Error("Unknown error during loading friends leaderboard.");console.error("LeaderboardContent",g),null==NG||NG.sendException(g),l5.showNotificationScreen("Unable to load friends leaderboard. Please try again later.",2)});return[3,4];case 4:return[2]}})}),g.handleWorldTabSelected=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:NU.setStorageData("leaderboard_content","lastTabOpened","global"),g.cleanupSideEffects();E=g.animAbortSignal;k.label=1;case 1:k.trys.push([1,3,,4]);return[4,g.updateStatus(E,"global")];case 2:k.sent();return[3,4];case 3:_=k.sent();E.call(function(){var g=_instanceof(_,Error)?_:new Error("Unknown error during loading global leaderboard.");console.error("LeaderboardContent",g),null==NG||NG.sendException(g),l5.showNotificationScreen("Unable to load global leaderboard. Please try again later.",2)});return[3,4];case 4:return[2]}})}),g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(l,[{key:"__preload",value:function(){this.leaders.maxLeader=NH.Limit}},{key:"onLoad",value:function(){nA.decorateComponent(this)}},{key:"listenEvents",value:function(){this.node.scene.on(Em.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(Em.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(r4.HIDE_UI,this.hideContent),this.node.scene.on(r4.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.node.scene.off(Em.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(Em.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(r4.HIDE_UI,this.hideContent),this.node.scene.off(r4.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(T=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this,k=this.getLeaderboardName(g);C=null!==k;if(!C)return[3,3];return[4,E.callAsync(function(){return Nx.requestLeaderboardAsync(k,NH.Limit)})];case 1:A.sent(),E.call(function(){var g=Nx.getLeaderboard(k);_.currentLb=null!=g?g:_.currentLb});return[4,E.callAsync(Be(function(){return _ts_generator(this,function(E){return[2,_.loadPlayerLeaderData(g)]})}))];case 2:C=A.sent();A.label=3;case 3:return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"getLeaderboardName",value:function(g){return"friends"===g?sX:sj}},{key:"showLoading",value:(A=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=k.length>1&&void 0!==k[1]?k[1]:0;return[4,Promise.all([this.leaders.scrollView.unlistenEvents(),this.leaders.scrollView.scrollToTop(g).then(function(){E.leaders&&(E.leaders.scrollView.scrollView.enabled=!1,E.leaders.scrollView.listenEvents())}),this.leaderSkeletons.map(function(E,k){return E.show(k*_,g)})])];case 1:C.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"hideLoading",value:(C=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(E){return E.hide(g)}))];case 1:E.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"entering",value:function(){this.timer.reset(),this.isHidden=!1;var g=NU.getStorageData("leaderboard_content","lastTabOpened");"friends"===g?this.handleFriendsTabSelected():"global"===g&&this.handleWorldTabSelected()}},{key:"enter",value:function(){this.listenEvents()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){this.animAbortSignal.abort(),this.animAbortSignal=new nD,this.leaders.hideLeaders(),this.leaderboardIsEmpty.hide()}},{key:"updateStatus",value:(k=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this;if(!(void 0!==g&&!this.isHidden))return[3,7];this.tabs.updateStatus(E);return[4,this.showLoading(g)];case 1:R.sent();R.label=2;case 2:R.trys.push([2,4,,5]);return[4,this.loadLeaderboard(E,g)];case 3:R.sent();return[3,5];case 4:T=R.sent();if(!_instanceof(T,Nq))throw T;return[2,void g.call(function(){A.leaderboardIsEmpty.show(),A.hideLoading(g)})];case 5:null===(_=this.timer)||void 0===_||_.setTimeLabel(null===(k=this.currentLb)||void 0===k?void 0:k.resettable),null===(C=this.timer)||void 0===C||C.show(g),this.hideLoading(g);return[4,g.callAsync(function(g){return A.playLeadersShowupAnimation(E,g)})];case 6:R.sent();R.label=7;case 7:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"playLeadersShowupAnimation",value:(_=Be(function(g,E){var _,k,C,A,T,R,I,P,L,O,B,N,M;return _ts_generator(this,function(D){switch(D.label){case 0:_=this;if(!this.currentLb)return[3,6];k=Nz.getPlayerId(),C=this.currentLb.leaders[k],A=NU.getStorage("leaderboard_content").previousScore,T=null!=C?C:{},R=T.score,I=T.rank,P=NK.vals(this.currentLb.leaders);P.sort(function(g,E){return E.score-g.score});L=-1!==A&&A<R&&I<=NH.Limit;this.leaders.updateData(P);O=!1;C&&L&&(O=this.leaders.updateDisplayPlayerLeaderForRankChanging(A,R,I)),this.leaders.initScrollViews(),this.leaders.scrollView.scrollView.enabled=!0;B=this.hasPlayedAppearAnim[g]?0:.1;return[4,E.callAsync(function(){return _.leaders.playShowLeadersAnimation(E,B)})];case 1:D.sent(),this.hasPlayedAppearAnim[g]=!0;N=C;if(!N)return[3,5];return[4,E.callAsync(function(){return _.leaders.scrollToPlayerLeader(1,E)})];case 2:D.sent();M=O&&-1!==A;if(!M)return[3,4];return[4,E.callAsync(function(g){return _.leaders.playRankChangeAnimation(g,A,R,I)})];case 3:M=(D.sent(),NU.setStorageData("leaderboard_content","previousScore",R));D.label=4;case 4:N=M;D.label=5;case 5:D.label=6;case 6:return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"loadPlayerLeaderData",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=Nz.getPlayerId();if(null===this.currentLb)throw new Error("LeaderboardContent: Leaderboard is not found.");_=this.currentLb.leaders;if(0===Object.keys(_).length)throw new Nq("LeaderboardContent: Leaderboard is empty.");if(!!_[E])return[3,2];k=this.getLeaderboardName(g);if(null===k)throw new Error("LeaderboardContent: Leaderboard name is not found.");return[4,Nx.getLeadersByPlayerIdsAsync(k,[E])];case 1:C=T.sent();if(0!==C.length){A=C[0];_[E]=A}T.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),l}(M)).prototype,"tabs",[B5,B6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ng=st(Ny.prototype,"timer",[B8,B9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nm=st(Ny.prototype,"leaders",[B7,Ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nb=st(Ny.prototype,"leaderSkeletons",[Nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nw=st(Ny.prototype,"leaderboardIsEmpty",[Nn,Ni],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NS=st(Ny.prototype,"contentOpacity",[Nr,Na],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Ny.prototype,"loadLeaderboard",[No],Object.getOwnPropertyDescriptor(Ny.prototype,"loadLeaderboard"),Ny.prototype),st(Ny.prototype,"showLoading",[Ns],Object.getOwnPropertyDescriptor(Ny.prototype,"showLoading"),Ny.prototype),st(Ny.prototype,"hideLoading",[Nl],Object.getOwnPropertyDescriptor(Ny.prototype,"hideLoading"),Ny.prototype),st(Ny.prototype,"updateStatus",[Nu],Object.getOwnPropertyDescriptor(Ny.prototype,"updateStatus"),Ny.prototype),st(Ny.prototype,"playLeadersShowupAnimation",[Nc],Object.getOwnPropertyDescriptor(Ny.prototype,"playLeadersShowupAnimation"),Ny.prototype),st(Ny.prototype,"loadPlayerLeaderData",[Np],Object.getOwnPropertyDescriptor(Ny.prototype,"loadPlayerLeaderData"),Ny.prototype),Nf=Ny))||Nf);_._RF.pop(),_._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var Nj,NX,NY,NJ,NQ,NZ,N$,N0,N1,N2,N4,N3,N5,N6,N8,N9,N7,Mt;NT=(0,k.ccclass)("LeaderboardPage"),NR=nA.required(),NI=nA.getComponent(ad),NP=nA.onlyRunInLifeCycleAsync,NL=nA.onlyRunInLifeCycleAsync,NO=nA.onlyRunInLifeCycleAsync,NT((NN=st((NB=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimationController",NN,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nA.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:if(g.sent(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(NW),!this.content)throw new Error("LeaderboardPage: Leaders not found");return[2]}})}),function(){return k.apply(this,arguments)})},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:this.content.entering();return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent();g=t$.runTweenAsync(z(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent(),this.content.enter();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent(),this.content.unlistenUIEvents(),this.content.leaders.setBatchNodes(!1);return[4,this.panelAnimationController.hideUI()];case 2:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"unmount",value:function(){var g,E;null===(g=this.content)||void 0===g||g.hide(),null===(E=this.content)||void 0===E||E.cleanup(),Je(Ve(r.prototype),"unmount",this).call(this)}}]),r}(AE)).prototype,"panelAnimationController",[NR,NI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(NB.prototype,"mount",[NP],Object.getOwnPropertyDescriptor(NB.prototype,"mount"),NB.prototype),st(NB.prototype,"transitionIn",[NL],Object.getOwnPropertyDescriptor(NB.prototype,"transitionIn"),NB.prototype),st(NB.prototype,"transitionOut",[NO],Object.getOwnPropertyDescriptor(NB.prototype,"transitionOut"),NB.prototype),NB));_._RF.pop(),_._RF.push({},"0d1c02Npp9IXrjlFdl8co2L","TopLeader",void 0);var Mn,Mi,Mr,Ma,Mo,Ms,Ml,Mu,Mc,Mp,Mf,My,Mv,Mg,Mm,Mb,Mw,MS,ME,M_,Mk,MC,MA,MT,MR,MI=k.ccclass,MP=k.property,ML=GameCore.Utils.Number,MO=(Nj=MI("TopLeader"),NX=MP(P),NY=MP(C),NJ=MP({type:eo}),NQ=MP({type:eu}),NZ=MP({type:P}),N$=MP({type:eu}),N0=nA.onlyRunInLifeCycle,N1=nA.onlyRunInLifeCycleAsync,N2=nA.onlyRunInLifeCycleAsync,Nj((N5=st((N3=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"nameLabel",N5,Ke(g)),rt(g,"defaultAvatar",N6,Ke(g)),rt(g,"avatar",N8,Ke(g)),rt(g,"avatarOpacity",N9,Ke(g)),rt(g,"scoreLabel",N7,Ke(g)),rt(g,"uiOpacity",Mt,Ke(g)),g.signal=new nD,g}return Ue(o,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){this.updateUsername(g),this.updatePhoto(g),this.updateScore(g)}},{key:"updateUsername",value:function(g){this.nameLabel&&(this.nameLabel.string=g.name)}},{key:"updatePhoto",value:(k=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.signal.abort();E=new nD;this.signal=E,this.defaultAvatar.active=!bF.isAvatarCached(g.playerId,128),this.avatar.spriteFrame=null;_=g.playerId,k=g.photo;return[4,bF.getPlayerAvatar(k,_,128,E)];case 1:C=A.sent();C&&!E.aborted&&this.setPhoto(C);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setPhoto",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!this.node.active)return[3,2];g.packable=!0,this.avatar.spriteFrame=g;E=z(this.avatarOpacity).to(.2,{opacity:255});return[4,t$.runTweenAsync(E,this.signal)];case 1:_.sent(),this.defaultAvatar.active=!1;_.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"updateScore",value:function(g){if(this.scoreLabel){var E=Math.floor(g.score);this.scoreLabel.string=ML.getShortNumber(E,7)}}},{key:"runShowUpAnimation",value:(E=Be(function(g){var E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:E=A.length>1&&void 0!==A[1]?A[1]:.3,_=A.length>2?A[2]:void 0;this.node.scale=em.ZERO;k=z(this.node).delay(g).to(E,{scale:new em(1,1,1)},{easing:"backOut"}),C=z(this.uiOpacity).delay(g).to(E,{opacity:255});return[4,Promise.all([t$.runTweenAsync(k,_),t$.runTweenAsync(C,_)])];case 1:T.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setVisible",value:function(g){var E=g?255:0;this.uiOpacity.opacity=E,this.avatarOpacity.opacity=E}}]),o}(M)).prototype,"nameLabel",[NX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N6=st(N3.prototype,"defaultAvatar",[NY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N8=st(N3.prototype,"avatar",[NJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N9=st(N3.prototype,"avatarOpacity",[NQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N7=st(N3.prototype,"scoreLabel",[NZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mt=st(N3.prototype,"uiOpacity",[N$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(N3.prototype,"updateInfo",[N0],Object.getOwnPropertyDescriptor(N3.prototype,"updateInfo"),N3.prototype),st(N3.prototype,"updatePhoto",[N1],Object.getOwnPropertyDescriptor(N3.prototype,"updatePhoto"),N3.prototype),st(N3.prototype,"setPhoto",[N2],Object.getOwnPropertyDescriptor(N3.prototype,"setPhoto"),N3.prototype),N4=N3))||N4);_._RF.pop(),_._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var MB,MN,MM,MD,MF,MU=k.ccclass,Mx=k.property,Mz=globalThis.game,MG=Mz.leaderboard,MV=Mz.player,MK=GameCore.Utils,MH=MK.Time,Mq=MK.Object,MW=MK.Array,Mj=(Mn=MU("TournamentBlock"),Mi=Mx(C),Mr=Mx(P),Ma=Mx(P),Mo=Mx(P),Ms=Mx(P),Ml=Mx(R),Mu=Mx({type:eo}),Mc=Mx(C),Mp=Mx(C),Mf=Mx(MO),My=nA.onlyRunInLifeCycleAsync,Mv=nA.onlyRunInLifeCycle,Mn((Mb=st((Mm=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"container",Mb,Ke(g)),rt(g,"titleLabel",Mw,Ke(g)),rt(g,"timeLabel",MS,Ke(g)),rt(g,"playerCountLabel",ME,Ke(g)),rt(g,"playButtonLabel",M_,Ke(g)),rt(g,"uiTransform",Mk,Ke(g)),rt(g,"banner",MC,Ke(g)),rt(g,"bannerMask",MA,Ke(g)),rt(g,"bannerLoadingRing",MT,Ke(g)),rt(g,"topLeader",MR,Ke(g)),g.hasPlayedAnimation=!1,g}return Ue(l,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"updateInfo",value:(T=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:this.payload=g;E=g.endTime,_=g.title,k=g.payload,C=k.leaderboardId,A=k.themeId;T=C;if(!T)return[3,2];this.topLeader.setVisible(!1),this.topLeader.node.active=!1,this.setPlayerCountWaiting(),this.updateTitle(_),this.updateEndTime(E),this.updateTournamentBanner(A);return[4,this.fetchAndUpdateLeadersPayload(C,{leaders:[],amountPlayer:0},_)];case 1:T=R.sent();R.label=2;case 2:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"fetchAndUpdateLeadersPayload",value:(A=Be(function(g,E,_){var k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:k=E;T.label=1;case 1:T.trys.push([1,3,,4]);return[4,this.getLeadersPayload(g)];case 2:C=T.sent();C&&(k=C);return[3,4];case 3:A=T.sent();console.error("Fetch lb for tournament ".concat(_),A);return[3,4];case 4:this.updateLeadersPayload(k);return[2]}})}),function(g,E,_){return A.apply(this,arguments)})},{key:"updateLeadersPayload",value:function(g){this.leadersPayload=g;var E=this.leadersPayload,_=E.player,k=E.amountPlayer,C=E.leaders;this.updatePlayerCount(k),this.updatePlayButtonLabel(void 0!==_),this.updateTopLeader(null!=C?C:[])}},{key:"updateTitle",value:function(g){g&&(this.titleLabel.string=g)}},{key:"updateEndTime",value:function(g){var E=MH.getRelativeTime(g);this.timeLabel.string="Ends ".concat(E)}},{key:"updatePlayerCount",value:function(g){this.playerCountLabel.string="".concat(g," ").concat(g>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"updateTopLeader",value:(C=Be(function(g){var E,_;return _ts_generator(this,function(k){if(0!==g.length){_=g[0];GameCore.Configs.Mockup.Leaderboards.Enabled&&(_=null!==(E=MW.search(g,function(g){return 1===g.rank}))&&void 0!==E?E:_),this.topLeader.node.active=!0,this.topLeader.updateInfo(_),this.topLeader.runShowUpAnimation(0,.2)}return[2]})}),function(g){return C.apply(this,arguments)})},{key:"updateTournamentBanner",value:(k=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=ii.getAsset("".concat(nx[g],"/spriteFrame"),ea);_=E;if(_)return[3,2];this.bannerMask.active=!0,this.bannerLoadingRing.active=!0;return[4,ii.loadThemePreviewAsync(g)];case 1:_=E=C.sent();C.label=2;case 2:k=E;if(k)return[3,4];return[4,ii.loadThemePreviewAsync(la.SUMMER)];case 3:k=E=C.sent();C.label=4;case 4:this.banner&&E&&(this.banner.spriteFrame=E,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"updatePlayButtonLabel",value:function(g){this.playButtonLabel.string=g?"Continue":"Join"}},{key:"getLeadersPayload",value:(_=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=MG.getLeaderboardName(g);if(!_)return[2,null];return[4,li.getAllLeaderboardAsync(g)];case 1:k=I.sent();if(!k)return[2,null];C=Mq.vals(k.leaders);C.sort(function(g,E){return g.rank-E.rank});A=MV.getPlayerId();return[4,MG.getLeadersByPlayerIdsAsync(_,[A])];case 2:T=I.sent(),R={leaders:C,amountPlayer:null!==(E=k.amountPlayer)&&void 0!==E?E:0};return[2,(T.length>0&&(R.player=T[0]),R)]}})}),function(g){return _.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=this;this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;C=this.container.position.clone();this.container.position=new em(C.x,C.y-100,C.z);A=z(this.node).delay(g);A.to(E,{scale:em.ONE},{easing:"elasticOut"});T=z(this.container).delay(g);T.to(E,{position:C},{easing:"backOut"});R=z(this.uiOpacity).delay(g);R.to(E,{opacity:255},{easing:"cubicOut"}),_.addAbortListener(function(){k.node.scale=em.ONE,k.container.position=C,k.uiOpacity.opacity=255});return[4,Promise.all([t$.runTweenAsync(A,_),t$.runTweenAsync(T,_),t$.runTweenAsync(R,_)])];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var g=this.payload.id||"";if(ua.validateTournamentExpired(g))return this.node.scene.emit(s4.RELOAD_TOURNAMENT),void l5.showNotificationScreen("Tournament has ended",2);try{var E=JSON.stringify(this.payload);l5.showTournamentDetailScreen(E,"tournament_start",this.hasPlayedAnimation),this.hasPlayedAnimation=!0}catch(g){console.warn("handleOnTournamentClicked",g)}}}]),l}(M)).prototype,"container",[Mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mw=st(Mm.prototype,"titleLabel",[Mr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MS=st(Mm.prototype,"timeLabel",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=st(Mm.prototype,"playerCountLabel",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=st(Mm.prototype,"playButtonLabel",[Ms],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mk=st(Mm.prototype,"uiTransform",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MC=st(Mm.prototype,"banner",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MA=st(Mm.prototype,"bannerMask",[Mc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MT=st(Mm.prototype,"bannerLoadingRing",[Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MR=st(Mm.prototype,"topLeader",[Mf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Mm.prototype,"fetchAndUpdateLeadersPayload",[My],Object.getOwnPropertyDescriptor(Mm.prototype,"fetchAndUpdateLeadersPayload"),Mm.prototype),st(Mm.prototype,"updateLeadersPayload",[Mv],Object.getOwnPropertyDescriptor(Mm.prototype,"updateLeadersPayload"),Mm.prototype),Mg=Mm))||Mg);_._RF.pop(),_._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var MX,MY,MJ,MQ,MZ,M$,M0,M1,M2,M4,M3,M5,M6,M8=k.ccclass,M9=k.property,M7=(MB=M8("TournamentBlockSkeleton"),MN=M9(C),MB((MF=st((MD=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",MF,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,t$.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=this;this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;k=this.container.position.clone();this.container.position=new em(k.x,k.y-100,k.z);C=z(this.node).delay(g);C.to(.2,{scale:em.ONE},{easing:"elasticOut"});A=z(this.container).delay(g);A.to(.2,{position:k},{easing:"backOut"});T=z(this.uiOpacity).delay(g);T.to(.2,{opacity:255},{easing:"cubicOut"}),E.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=k,_.uiOpacity.opacity=255});return[4,Promise.all([t$.runTweenAsync(C,E),t$.runTweenAsync(A,E),t$.runTweenAsync(T,E)])];case 1:R.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})}]),a}(M)).prototype,"container",[MN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MM=MD))||MM);_._RF.pop(),_._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var Dt,Dn,Di,Dr,Da,Do=k.ccclass,Ds=k.property,Dl=globalThis.game.player,Du=(MX=Do("TournamentsBoard"),MY=Ds(ee),MJ=Ds(C),MQ=Ds(q),MZ=Ds(C),M$=Ds(R),MX((M2=st((M1=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"tournamentBlockPrefab",M2,Ke(g)),g.tournamentBlockArray=[],rt(g,"inactiveNodeContainer",M4,Ke(g)),rt(g,"layout",M3,Ke(g)),rt(g,"createTournamentButton",M5,Ke(g)),rt(g,"viewport",M6,Ke(g)),g}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"start",value:function(){for(var g=0;g<20;g++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"updateData",value:function(g){var E=this,_=!1;g.forEach(function(g,k){var C=E.tournamentBlockArray[k];g.payload.playerId===Dl.getPlayerId()&&(_=!0),C||(C=E.addTournamentBlock()),E.layout.node.addChild(C.node),C.updateInfo(g)}),_||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var g=I(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(g);var E=g.getComponent(Mj);return this.tournamentBlockArray.push(E),E}},{key:"removeTournamentBlocks",value:function(){var g,E=at(this.getActiveTournamentBlocks());try{for(E.s();!(g=E.n()).done;){var _=g.value;this.inactiveNodeContainer.addChild(_.node)}}catch(g){E.e(g)}finally{E.f()}this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var g=this;return this.tournamentBlockArray.filter(function(E){return E.node.parent===g.layout.node})}},{key:"setCreateTournamentButtonActive",value:function(g){g?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=g}},{key:"showTournamentBlocks",value:(E=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this.getActiveTournamentBlocks();if(_.length<1)return[3,2];k=Math.ceil(g/this.tournamentBlockContentHeight),C=Math.min(_.length,k);return[4,Promise.all(_.map(function(){var g=Be(function(g,_){return _ts_generator(this,function(k){switch(k.label){case 0:if(!(_<C))return[3,2];return[4,g.runShowPopUpAnimation(.1*_,.3,E)];case 1:k.sent();return[3,3];case 2:g.uiOpacity.opacity=255;k.label=3;case 3:return[2]}})});return function(E,_){return g.apply(this,arguments)}}()))];case 1:A.sent();A.label=2;case 2:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"updateVisibility",value:function(){var g,E=this.viewport.getBoundingBoxToWorld(),_=E.yMax,k=E.yMin,C=at(this.getActiveTournamentBlocks());try{for(C.s();!(g=C.n()).done;){var A=g.value,T=A.uiTransform;if(void 0!==T){var R=T.getBoundingBoxToWorld(),I=R.yMax,P=R.yMin,L=I<k||P>_;A.uiOpacity.opacity=L?0:255}}}catch(g){C.e(g)}finally{C.f()}}}]),i}(M)).prototype,"tournamentBlockPrefab",[MY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M4=st(M1.prototype,"inactiveNodeContainer",[MJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M3=st(M1.prototype,"layout",[MQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M5=st(M1.prototype,"createTournamentButton",[MZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M6=st(M1.prototype,"viewport",[M$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M0=M1))||M0);_._RF.pop(),_._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var Dc,Dp,Df,Dy,Dv,Dg,Dm,Db,Dw,DS,DE,D_,Dk,DC,DA,DT=k.ccclass,DR=k.property,DI=(Dt=DT("TournamentsNotAvailable"),Dn=DR(C),Dt((Da=st((Dr=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"createButton",Da,Ke(g)),g}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.createButton.active=!0,this.uiOpacity.opacity=255;g=this.node.position.clone(),E=z(this.node);E.to(.05,{position:g.clone().add3f(5,0,0)}),E.to(.05,{position:g.clone().add3f(-5,0,0)});_=z(this.node).repeat(2,E);_.to(.05,{position:g});return[4,t$.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hide",value:function(){this.createButton.active=!1,this.uiOpacity.opacity=0}}]),i}(M)).prototype,"createButton",[Dn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Di=Dr))||Di);_._RF.pop(),_._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var DP,DL,DO,DB,DN,DM,DD,DF,DU,Dx=k.ccclass,Dz=k.property,DG=globalThis.game,DV=DG.storage,DK=DG.match,DH=GameCore.Utils,Dq=DH.Object,DW=DH.Array,Dj=(Dc=Dx("TournamentContent"),Dp=Dz({type:aP}),Df=Dz(Du),Dy=Dz(DI),Dv=Dz(eK),Dg=Dz({type:[M7]}),Dm=Dz(ry),Dc((DS=st((Dw=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimator",DS,Ke(g)),rt(g,"tournamentsBoard",DE,Ke(g)),rt(g,"tournamentsNotAvailable",D_,Ke(g)),rt(g,"scrollView",Dk,Ke(g)),rt(g,"skeletons",DC,Ke(g)),rt(g,"contentOpacity",DA,Ke(g)),g.animAbortSignal=null,g.softAbortSignal=null,g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(r,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(eK.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(s4.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(r4.HIDE_UI,this.hideContent),this.node.scene.on(r4.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(eK.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(s4.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(r4.HIDE_UI,this.hideContent),this.node.scene.off(r4.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(C=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.listenEvents();E=null===this.animAbortSignal&&null===this.softAbortSignal;if(!E)return[3,2];this.animAbortSignal=new nD,this.softAbortSignal=new nD;return[4,this.showLoading(this.animAbortSignal)];case 1:E=(T.sent(),!this.isAborted());T.label=2;case 2:if(!E)return[3,10];return[4,ua.requestTournamentDataAsync()];case 3:_=T.sent();k=this.isAborted();if(k)return[3,9];return[4,this.hideLoading(this.animAbortSignal)];case 4:T.sent();C=this.isAborted();if(C)return[3,8];if(!(0!==_.length||null!==(g=this.softAbortSignal)&&void 0!==g&&g.aborted))return[3,6];this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(_);return[4,this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal)];case 5:A=(T.sent(),this.tournamentsBoard.updateVisibility());return[3,7];case 6:A=this.tournamentsNotAvailable.show();T.label=7;case 7:C=A;T.label=8;case 8:k=C;T.label=9;case 9:T.label=10;case 10:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"showLoading",value:(k=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.scrollView.scrollToTop(0),this.scrollView.enabled=!1;return[4,Promise.all([this.skeletons.map(function(E){return E.show(0,g)})])];case 1:E.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"hideLoading",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all([this.skeletons.map(function(E){return E.hide(g)})])];case 1:E.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!DV.getStorage("tournament").animateTournamentLeader)return;var g=ua.getAllTournamentData(),E=DK.getMatchState().customData.tournamentId;if(!E)throw new Error("Tournament ID not found");var _=DW.search(g,function(g){return g.id===E});if(!_)throw new Error("Tournament not found");var k=JSON.stringify(_);l5.showTournamentDetailScreen(k,"tournament_end")}catch(g){DV.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",g)}}},{key:"processCreateTournament",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lT.processCreateTournamentAsync()];case 1:_.sent();return[3,3];case 2:g=_.sent();if(!Dq.hasOwn(g,"code"))return[2,void l5.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament",2)];if("USER_INPUT"===g.code)return[2];if("PLAYER_HAS_TOURNAMENT"===g.code)return[2,void l5.showNotificationScreen("You already have a tournament",2)];if("INVALID_OPERATION"===g.code&&Dq.hasOwn(g,"message")){E="string"==typeof g.message?g.message:"Failed to Create Tournament";return[2,void l5.showNotificationScreen(E,2)]}l5.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament",2);return[3,3];case 3:this.reload();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"isAborted",value:function(){var g,E;return null===(g=null===(E=this.animAbortSignal)||void 0===E?void 0:E.aborted)||void 0===g||g}},{key:"cleanup",value:function(){var g;this.unlistenEvents(),null===(g=this.animAbortSignal)||void 0===g||g.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var g;null===(g=this.softAbortSignal)||void 0===g||g.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.enter()}}]),r}(M)).prototype,"panelAnimator",[Dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DE=st(Dw.prototype,"tournamentsBoard",[Df],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_=st(Dw.prototype,"tournamentsNotAvailable",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dk=st(Dw.prototype,"scrollView",[Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DC=st(Dw.prototype,"skeletons",[Dg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DA=st(Dw.prototype,"contentOpacity",[Dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Db=Dw))||Db);_._RF.pop(),_._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var DX,DY,DJ,DQ,DZ;DP=(0,k.ccclass)("TournamentPage"),DL=nA.required(),DO=nA.getComponent(ad),DB=nA.onlyRunInLifeCycleAsync,DN=nA.onlyRunInLifeCycle,DM=nA.onlyRunInLifeCycleAsync,DD=nA.onlyRunInLifeCycleAsync,DP((DU=st((DF=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimationController",DU,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nA.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(Dj),!this.content)throw new Error("LeaderboardPage: Leaders not found")}},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent();g=t$.runTweenAsync(z(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent(),this.content.enter();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:null===(g=this.content)||void 0===g||g.softAbort(),this.content.unlistenUIEvents();return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:E.sent();return[4,this.panelAnimationController.hideUI()];case 2:E.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"unmount",value:function(){var g;null===(g=this.content)||void 0===g||g.cleanup(),Je(Ve(r.prototype),"unmount",this).call(this)}}]),r}(AE)).prototype,"panelAnimationController",[DL,DO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(DF.prototype,"mount",[DB],Object.getOwnPropertyDescriptor(DF.prototype,"mount"),DF.prototype),st(DF.prototype,"onMount",[DN],Object.getOwnPropertyDescriptor(DF.prototype,"onMount"),DF.prototype),st(DF.prototype,"transitionIn",[DM],Object.getOwnPropertyDescriptor(DF.prototype,"transitionIn"),DF.prototype),st(DF.prototype,"transitionOut",[DD],Object.getOwnPropertyDescriptor(DF.prototype,"transitionOut"),DF.prototype),DF));_._RF.pop(),_._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var D$,D0,D1,D2,D4,D3,D5,D6,D8=k.ccclass,D9=k.property;DX=D8("EventBadge"),DY=D9(P),DJ=D9(x),DX((DZ=st((DQ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"label",DZ,Ke(g)),g}return Ue(n,[{key:"text",get:function(){return this.label.string},set:function(g){this.label.string=g}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(M)).prototype,"label",[DY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(DQ.prototype,"text",[DJ],Object.getOwnPropertyDescriptor(DQ.prototype,"text"),DQ.prototype),DQ));_._RF.pop(),_._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var D7,Ft,Fn,Fi,Fr,Fa,Fo,Fs,Fl,Fu,Fc,Fp,Ff,Fy,Fv,Fg,Fm,Fb,Fw,FS,FE,F_,Fk,FC,FA,FT,FR,FI,FP,FL,FO,FB,FN,FM,FD,FF,FU,Fx,Fz,FG,FV,FK,FH,Fq,FW,Fj,FX,FY=k.ccclass,FJ=k.property;D$=FY("EventProgressBar"),D0=FJ(ou),D1=FJ(P),D2=FJ(x),D4=FJ({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),D$((D5=st((D3=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"progressBar",D5,Ke(g)),rt(g,"progressLabel",D6,Ke(g)),g}return Ue(n,[{key:"text",get:function(){return this.progressLabel.string},set:function(g){this.progressLabel.string=g}},{key:"progress",get:function(){return this.progressBar.progress},set:function(g){this.progressBar.progress=g}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(M)).prototype,"progressBar",[D0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D6=st(D3.prototype,"progressLabel",[D1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(D3.prototype,"text",[D2],Object.getOwnPropertyDescriptor(D3.prototype,"text"),D3.prototype),st(D3.prototype,"progress",[D4],Object.getOwnPropertyDescriptor(D3.prototype,"progress"),D3.prototype),D3));_._RF.pop(),_._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var FQ,FZ,F$,F0,F1,F2=k.ccclass,F4=k.property,F3=k.executeInEditMode,F5=globalThis.game.analytics,F6=GameCore.Plugins.Analytics.Events;D7=F2("NavButton"),Ft=F4(J),Fn=F4({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),Fi=F4({type:K,group:{name:"Animation"}}),Fr=F4({type:K,group:{name:"Animation"}}),Fa=F4({type:K,group:{name:"Animation"}}),Fo=F4({type:K,group:{name:"Animation"}}),Fs=F4({type:K,group:{name:"Animation"}}),Fl=F4({group:{name:"Animation"}}),Fu=F4({type:K,group:{name:"Animation"}}),Fc=F4({type:K,group:{name:"Animation"}}),Fp=F4({group:{name:"Animation"}}),Ff=F4({type:K,group:{name:"Animation"}}),Fy=F4({type:K,group:{name:"Animation"}}),Fv=F4({type:K,group:{name:"Animation"}}),Fg=F4({type:K,group:{name:"Animation"}}),Fm=F4({type:K,group:{name:"Animation"}}),Fb=F4({type:R}),Fw=F4(C),FS=F4(eu),FE=F4({type:R}),F_=F4({type:es(nN)}),Fk=F4(L_),D7(FC=F3((FT=st((FA=function(g){ze(o,g);var E,_,k=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"wip",FT,Ke(g)),rt(g,"isSelectedInEditor",FR,Ke(g)),rt(g,"animationDuration",FI,Ke(g)),rt(g,"selectedSpacing",FP,Ke(g)),rt(g,"deselectedSpacing",FL,Ke(g)),rt(g,"selectedIconY",FO,Ke(g)),rt(g,"selectedIconX",FB,Ke(g)),rt(g,"selectedIconScale",FN,Ke(g)),rt(g,"deselectedIconY",FM,Ke(g)),rt(g,"deselectedIconX",FD,Ke(g)),rt(g,"deselectedIconScale",FF,Ke(g)),rt(g,"initTextY",FU,Ke(g)),rt(g,"selectedTextY",Fx,Ke(g)),rt(g,"selectedTextX",Fz,Ke(g)),rt(g,"deselectedTextY",FG,Ke(g)),rt(g,"deselectedTextX",FV,Ke(g)),rt(g,"spacer",FK,Ke(g)),rt(g,"icon",FH,Ke(g)),rt(g,"text",Fq,Ke(g)),rt(g,"uiTransform",FW,Ke(g)),rt(g,"screenType",Fj,Ke(g)),rt(g,"navManager",FX,Ke(g)),g.isSelected=!1,g.onMouseEnter=function(E){g.isSelected||g.playHoverOnAnimation()},g.onMouseLeave=function(E){g.isSelected||g.playHoverOffAnimation()},g}return Ue(o,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.initTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var g,E;this.isSelected||(i9.playSound(ip.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),F5.event(F6.BUTTON_CLICK,{button_name:null!==(g=null===(E=this.node.parent)||void 0===E?void 0:E.name)&&void 0!==g?g:this.node.name,screen_name:iA.getCurrentPage()}))}},{key:"select",value:(_=Be(function(){var g;var E=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:g=!(E.length>0&&void 0!==E[0])||E[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0;if(!g)return[3,2];return[4,t$.runTweenAsync(this.playSelectAnimation())];case 1:_.sent();return[3,3];case 2:this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255;_.label=3;case 3:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"deselect",value:(E=Be(function(){var g,E;var _=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:g=!(_.length>0&&void 0!==_[0])||_[0],E=_.length>1&&void 0!==_[1]&&_[1];if(!this.isSelected&&!E)throw new Error("NavButton: Already deselected");this.isSelected=!1;if(!g)return[3,2];return[4,t$.runTweenAsync(this.deselectAnimation())];case 1:k.sent();return[3,3];case 2:this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0;k.label=3;case 3:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var g=new em(this.selectedIconX,this.selectedIconY,0),E=new em(this.deselectedIconX,this.deselectedIconY,0),_=this.node.scale.clone();this.node.scale=this.selectedIconScale;var k=this.uiTransform.convertToWorldSpaceAR(g),C=this.uiTransform.convertToWorldSpaceAR(E);return this.node.scale=_,C.x-k.x}},{key:"playHoverOnAnimation",value:function(){var g=z(this.icon);return g.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),t$.runTweenAsync(g)}},{key:"playHoverOffAnimation",value:function(){var g=z(this.icon);return g.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),t$.runTweenAsync(g)}},{key:"playSelectAnimation",value:function(){var g=this;return z(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(E,_){if(void 0!==_){var k=el.quintInOut(_),C=el.backOut(_),A=el.linear(_),T=_<.5?2*_:1,R=g.deselectedIconY+(g.selectedIconY-g.deselectedIconY)*C,I=g.deselectedIconX+(g.selectedIconX-g.deselectedIconX)*A;g.icon.setPosition(I,R,0);var P=g.deselectedIconScale.clone().lerp(g.selectedIconScale,k);g.icon.setScale(P.x,P.y,g.icon.scale.z);var L=255*T,O=g.deselectedTextY+(g.selectedTextY-g.deselectedTextY)*A,B=g.deselectedTextX+(g.selectedTextX-g.deselectedTextX)*A;g.text.opacity=L,g.text.node.setPosition(B,O,0)}}})}},{key:"deselectAnimation",value:function(){var g=this;return z(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(E,_){if(void 0!==_){var k=eL(g.selectedIconY,g.deselectedIconY,_),C=eL(g.selectedIconX,g.deselectedIconX,_);g.icon.setPosition(C,k,0);var A=eL(255,0,_<.5?2*_:1);g.text.opacity=A;var T=eL(g.selectedTextY,g.deselectedTextY,_),R=eL(g.selectedTextX,g.deselectedTextX,_);g.text.node.setPosition(R,T,0);var I=g.selectedIconScale.clone().lerp(g.deselectedIconScale,el.quintInOut(_));g.icon.setScale(I.x,I.y,g.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}}]),o}(M)).prototype,"wip",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),FR=st(FA.prototype,"isSelectedInEditor",[Fn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),FI=st(FA.prototype,"animationDuration",[Fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),FP=st(FA.prototype,"selectedSpacing",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),FL=st(FA.prototype,"deselectedSpacing",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),FO=st(FA.prototype,"selectedIconY",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),FB=st(FA.prototype,"selectedIconX",[Fs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FN=st(FA.prototype,"selectedIconScale",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(1,1,1)}}),FM=st(FA.prototype,"deselectedIconY",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FD=st(FA.prototype,"deselectedIconX",[Fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FF=st(FA.prototype,"deselectedIconScale",[Fp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(.8,.8,1)}}),FU=st(FA.prototype,"initTextY",[Ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -100}}),Fx=st(FA.prototype,"selectedTextY",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -10}}),Fz=st(FA.prototype,"selectedTextX",[Fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FG=st(FA.prototype,"deselectedTextY",[Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FV=st(FA.prototype,"deselectedTextX",[Fm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FK=st(FA.prototype,"spacer",[Fb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FH=st(FA.prototype,"icon",[Fw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fq=st(FA.prototype,"text",[FS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FW=st(FA.prototype,"uiTransform",[FE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fj=st(FA.prototype,"screenType",[F_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FX=st(FA.prototype,"navManager",[Fk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FC=FA))||FC);_._RF.pop(),_._RF.push({},"091aai5+ANDeZfFN8JFkbyi","TournamentButton",void 0);var F8,F9,F7,Ut,Un,Ui=k.ccclass,Ur=k.property,Ua=globalThis.game.leaderboard;FQ=Ui("TournamentButton"),FZ=Ur(C),F$=nA.onlyRunInLifeCycle,FQ((F1=st((F0=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"hotIcon",F1,Ke(g)),g}return Ue(i,[{key:"onLoad",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:P.trys.push([0,11,,12]);return[4,ua.requestTournamentDataAsync()];case 1:E=at.apply(void 0,[P.sent()]);P.label=2;case 2:P.trys.push([2,8,9,10]);E.s();P.label=3;case 3:if(!!(g=E.n()).done)return[3,7];_=g.value.payload,k=_.leaderboardId,C=_.playerId;if(!(k&&"global"===C))return[3,6];A=Ua.getLeaderboardName(k);T=A;if(!T)return[3,5];return[4,Ua.requestLeaderboardAsync(A,0)];case 4:T=(P.sent(),this.checkAndShowHotIcon(A));P.label=5;case 5:P.label=6;case 6:return[3,3];case 7:return[3,10];case 8:R=P.sent();E.e(R);return[3,10];case 9:E.f();return[7];case 10:return[3,12];case 11:I=P.sent();console.info("Error in TournamentButton",I);return[3,12];case 12:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"checkAndShowHotIcon",value:function(g){var E=Ua.getLeaderboard(g);E&&E.amountPlayer>=30&&(this.hotIcon.active=!0)}}]),i}(M)).prototype,"hotIcon",[FZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(F0.prototype,"checkAndShowHotIcon",[F$],Object.getOwnPropertyDescriptor(F0.prototype,"checkAndShowHotIcon"),F0.prototype),F0));_._RF.pop(),_._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var Uo,Us,Ul,Uu,Uc,Uh,Up,Uf,Uy,Uv,Ug,Um,Ub,Uw,US=k.ccclass,UE=k.property,U_=k.disallowMultiple,Uk=globalThis.game.player,UC=rb,UA=GameCore.Match.Modes,UT=[ip.COMBO_1,ip.COMBO_2,ip.COMBO_3,ip.COMBO_4,ip.COMBO_5,ip.COMBO_6,ip.COMBO_7,ip.COMBO_8,ip.COMBO_9,ip.COMBO_10,ip.COMBO_11,ip.COMBO_12,ip.COMBO_13,ip.TILE_MATCH,ip.BOMB_DEFUSE,ip.BOMB_EXPLODE_1,ip.BOMB_EXPLODE_2,ip.TILE_SELECT,ip.THUNDERBOLT,ip.SHUFFLE_ITEM,ip.LEVEL_START,ip.LEVEL_COMPLETE,ip.LEVEL_FAIL];F8=US("GameScene"),F9=UE(_Y),F8(F7=U_((Un=st((Ut=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"coinManager",Un,Ke(g)),g.handleGameExit=function(){lV.switchScene(s1)},g.handleShowResults=function(){lV.switchScene(s2)},g.handleGameMaskWhenLayoutChanged=function(g){var E=$("Canvas/Game/GameObjects");if(E){var _=E.getComponent(eq);_&&(_.enabled=g===UC.Landscape)}},g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onLoad",value:function(){this.coinManager.init()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t8,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(r4.GAME_EXIT,this.handleGameExit),this.node.scene.on(r4.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}},{key:"start",value:function(){Uk.getPlayerSetting("music")&&this.updateMusic(),this.preloadSounds(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadSounds",value:function(){for(var g=0,E=UT;g<E.length;g++){var _=E[g];ii.loadAudioClipAsync(_)}}},{key:"preloadScenes",value:function(){lV.preloadDashboardScene()}},{key:"updateMusic",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=lT.getMatchMode()===UA.TOURNAMENT,E=g?ip.TOURNAMENT_MUSIC:ip.BG_MUSIC;_=i9.getCurrentMusic()!==E;if(!_)return[3,3];return[4,i9.setVolumeMusic(0,!0)];case 1:k.sent();return[4,t$.waitTweenAsync(1)];case 2:_=k.sent();k.label=3;case 3:i9.playMusic(E,g),i9.setVolumeMusic(g?.4:.3,!0);return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"coinManager",[F9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F7=Ut))||F7);_._RF.pop(),_._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);var UR,UI,UP,UL,UO,UB,UN=k.ccclass,UM=k.property;Uo=UN("ItemButton"),Us=UM(J),Ul=UM(B),Uu=UM({type:V}),Uc=UM(P),Uh=UM(C),Up=UM(C),Uo((Uy=st((Uf=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"isDebug",Uy,Ke(g)),rt(g,"button",Uv,Ke(g)),rt(g,"quantity",Ug,Ke(g)),rt(g,"quantityLabel",Um,Ke(g)),rt(g,"plusNode",Ub,Ke(g)),rt(g,"quantityNode",Uw,Ke(g)),g}return Ue(n,[{key:"__preload",value:function(){this.item=this.getComponent(ml),this.validateRequiredComponents()}},{key:"start",value:function(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string="".concat(this.quantity),this.validateButton(),this.node.scene.on(r4.GRID_CREATE,this.validateButton,this),this.node.scene.on(r4.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(r4.GRID_CLEAR,this.validateButton,this)}},{key:"validateRequiredComponents",value:function(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}},{key:"validateButton",value:function(){var g=this;console.log("VALIDATE BUTTON"),this.canActivate().then(function(E){g.button.interactable=!0,g.plusNode.active=0===g.quantity,g.quantityNode.active=g.quantity>0})}},{key:"activate",value:function(){var g=this;return new Promise(function(E){if(g.quantity<=0)return g.handleShowAddItemScreen(),void E();g.item.activate().then(function(){g.isDebug||(g.quantity--,g.quantityLabel.string="".concat(g.quantity),g.item.saveQuantity()),g.validateButton(),E()})})}},{key:"canActivate",value:function(){return Promise.resolve(!0)}},{key:"addQuantity",value:function(g){this.quantity+=g,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"clearQuantity",value:function(){this.quantity=0,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"handleShowAddItemScreen",value:function(){l5.openScreen(iw.GET_ITEM_SCREEN,{item:sN.HINT,quantity:1})}}]),n}(M)).prototype,"isDebug",[Us],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Uv=st(Uf.prototype,"button",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ug=st(Uf.prototype,"quantity",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Um=st(Uf.prototype,"quantityLabel",[Uc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ub=st(Uf.prototype,"plusNode",[Uh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uw=st(Uf.prototype,"quantityNode",[Up],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uf));_._RF.pop(),_._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var UD,UF,UU,Ux,Uz,UG,UV=k.ccclass,UK=k.property;UR=UV("ComboEffect"),UI=UK(eu),UP=UK(eV),UR((UO=st((UL=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"circleOpacity",UO,Ke(g)),rt(g,"particle",UB,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(r4.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(g){g>1&&(this.circleOpacity.node.scale=em.ZERO,this.circleOpacity.opacity=60,this.particle.resetSystem(),z(this.circleOpacity.node).to(.2,{scale:new em(1.3,1.3,1.3)},{easing:"quadOut"}).start(),z(this.circleOpacity).delay(.3).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),n}(M)).prototype,"circleOpacity",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UB=st(UL.prototype,"particle",[UP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UL));_._RF.pop(),_._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var UH,Uq,UW,Uj,UX,UY,UJ,UQ,UZ=k.ccclass,U$=k.property;UD=UZ("ComboLabel"),UF=U$(P),UU=U$(C),UD((Uz=st((Ux=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"comboNumber",Uz,Ke(g)),rt(g,"comboContainer",UG,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.opacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(r4.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(g){0===g?this.opacity.opacity=0:g>1?(this.opacity.opacity=255,this.comboNumber.string="".concat(g),z(this.comboContainer).to(.1,{scale:new em(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:em.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),n}(M)).prototype,"comboNumber",[UF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UG=st(Ux.prototype,"comboContainer",[UU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ux));_._RF.pop(),_._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var U0,U1,U2,U4,U3,U5,U6,U8,U9,U7=k.ccclass,xt=k.property;UH=U7("ComboPopup"),Uq=xt(eo),UW=xt(ea),Uj=xt(G),UH((UY=st((UX=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"textSprite",UY,Ke(g)),rt(g,"comboSprites",UJ,Ke(g)),rt(g,"animation",UQ,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"start",value:function(){this.node.scene.on(r4.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"validateRequiredComponents",value:function(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}},{key:"handleOnComboUpdated",value:function(g){if(!(g<2)){for(var E=this.comboSprites.length-1;E>=0;E--)if(g>=E+2){this.textSprite.spriteFrame=this.comboSprites[E],this.animation.play();break}}}}]),n}(M)).prototype,"textSprite",[Uq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UJ=st(UX.prototype,"comboSprites",[UW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),UQ=st(UX.prototype,"animation",[Uj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UX));_._RF.pop(),_._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var xn,xi,xr,xa,xo,xs,xl,xu,xc,xp,xf,xy,xv,xg,xm,xb=k.ccclass,xw=k.property,xS=(U0=xb("PlayerScore"),U1=xw(C),U2=xw(P),U4=xw(eo),U0((U6=st((U5=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"crown",U6,Ke(g)),rt(g,"playerScore",U8,Ke(g)),rt(g,"avatar",U9,Ke(g)),g}return Ue(i,[{key:"showCrown",value:function(g){this.crown.active=g}},{key:"setPlayerScore",value:function(g){this.playerScore.string=g.toString()}},{key:"playWaitingAnimation",value:function(){var g=this,E=0;this.playerScore.schedule(function(){E=(E+1)%4;var _=Array(E+1).join(".");g.playerScore.string="Waiting"+_},.5);var _=this.playerScore.getComponent(eu),k=z(_).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=z(_).repeatForever(k).start()}},{key:"stopWaitingAnimation",value:function(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(eu).opacity=255}},{key:"loadPhoto",value:(E=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,2,,3]);return[4,bF.getPlayerAvatar(g,E,128)];case 1:_=C.sent();if(!_)throw new Error("Failed to create sprite frame");_.packable=!0,this.avatar.spriteFrame=_;return[3,3];case 2:k=C.sent();return[2,void console.error(k)];case 3:return[2]}})}),function(g,_){return E.apply(this,arguments)})}]),i}(M)).prototype,"crown",[U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U8=st(U5.prototype,"playerScore",[U2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U9=st(U5.prototype,"avatar",[U4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U3=U5))||U3);_._RF.pop(),_._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var xE,x_,xk,xC,xA,xT,xR,xI,xP,xL=k.ccclass,xO=k.disallowMultiple,xB=k.property,xN=globalThis.game,xM=xN.match,xD=xN.player,xF=xN.monitorError,xU="Waiting",xx=GameCore,xz=xx.Dtos.Match.Data,xG=xx.Utils.Object;xn=xL("ChallengeResultScene"),xi=xB(V),xr=xB({type:xS,group:"Score"}),xa=xB({type:xS,group:"Score"}),xo=xB(yu),xs=xB(P),xl=xB(mm),xn(xu=xO((xp=st((xc=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"pollingInterval",xp,Ke(g)),rt(g,"playerScore",xf,Ke(g)),rt(g,"opponentScore",xy,Ke(g)),rt(g,"paperConfetti",xv,Ke(g)),rt(g,"titleText",xg,Ke(g)),rt(g,"levelManager",xm,Ke(g)),g.goToDashboardScene=function(){lV.switchScene(s1)},g.pollMatchState=Be(function(){var E,_,k,C,A,T,R,I,P,L,O,B,N,M,D,F,U,x;return _ts_generator(this,function(z){switch(z.label){case 0:z.trys.push([0,2,,3]);E=xM.getMatchState().id;if(null===E)throw new Error("Match id is not found");_=xD.getPlayerId(),k=Date.now();return[4,xM.api.getMatchAPI().getMatchDetailByIdAsync(E)];case 1:C=z.sent(),A=Date.now(),T=Math.max(0,A-k,g.pollingInterval),R=new xz(C).toObject(),I=R.blackPlayerId,P=R.blackPlayerScore,L=R.whitePlayerScore,O=R.blackPlayerFinish,B=R.whitePlayerFinish,N=_===I?P:L,M=_===I?L:P,D=_===I?O:B,F=_===I?B:O,U=O&&B;if(g.playerScore.setPlayerScore(N),g.opponentScore.setPlayerScore(M),g.playerScore.showCrown(U&&N>M),g.opponentScore.showCrown(U&&M>N),g.stopWaitingAnimation(),g.playerScore.stopWaitingAnimation(),g.opponentScore.stopWaitingAnimation(),U){if(N===M)g.titleText.string="Draw";else if(N>M)g.titleText.string="You Win";else{if(!(N<M))return[2];g.titleText.string="You Lose"}}else g.titleText.string=xU,g.playWaitingAnimation(),D||g.playerScore.playWaitingAnimation(),F||g.opponentScore.playWaitingAnimation();g.scheduleOnce(g.pollMatchState,T);return[3,3];case 2:x=z.sent();console.warn("ResultScene: Error on pollMatchState",x),g.scheduleOnce(g.pollMatchState,g.pollingInterval);return[3,3];case 3:return[2]}})}),g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"onLoad",value:function(){try{var g=xM.getMatchState(),E=g.customData,_=E.playerId,k=E.opponentId;if(null===_||null===k)throw new Error("ResultScene: playerId is ".concat(_," and opponentId is ").concat(k,". Expected to not be null."));var C=xD.getPlayer().photo,A=g.profiles[_],T=A.score,R=void 0===T?0:T,I=A.finished,P=void 0!==I&&I,L=g.profiles[k],O=L.photo,B=L.score,N=void 0===B?0:B,M=L.finished,D=void 0!==M&&M,F=P&&D,U=F&&R>N,x=F&&N>R;this.playerScore.loadPhoto(C,_),this.opponentScore.loadPhoto(O,k),this.playerScore.setPlayerScore(R),this.opponentScore.setPlayerScore(N),this.playerScore.showCrown(U),this.opponentScore.showCrown(x),P&&D?R===N?this.titleText.string="Draw":U?this.titleText.string="You Win":x&&(this.titleText.string="You Lose"):(this.titleText.string=xU,this.playWaitingAnimation(),P||this.playerScore.playWaitingAnimation(),D||this.opponentScore.playWaitingAnimation())}catch(g){console.warn("ResultScene: Error on load",g),this.goToDashboardScene()}}},{key:"listenEvents",value:function(){this.node.scene.on(ni,this.goToDashboardScene),this.node.scene.on(nn,this.onReplayButtonPressed,this)}},{key:"start",value:function(){var g=this;this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce(function(){var E,_=at(g.paperConfetti);try{for(_.s();!(E=_.n()).done;)E.value.play()}catch(g){_.e(g)}finally{_.f()}},.2),i9.playSound(ip.LEVEL_COMPLETE),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadScenes",value:function(){lV.preloadDashboardScene()}},{key:"onDestroy",value:function(){this.unschedule(this.pollMatchState)}},{key:"onReplayButtonPressed",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,P,L,O,B,N;return _ts_generator(this,function(M){switch(M.label){case 0:E=(null!==(g=xD.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;_=Math.max(1,_);return[4,this.levelManager.loadLevelData(_)];case 1:k=M.sent();M.label=2;case 2:M.trys.push([2,4,,5]);if(!k)throw new Error("Level data is not found");C=xM.getMatchState().customData.opponentId;if(!C)throw new Error("Opponent id is not found");l5.showLoadingScreen();A=cS.generateFen(k),T=k.mode,R=void 0===T?"":T,I=k.rules,P=void 0===I?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:I,L=k.time,O=void 0===L?0:L,B=k.level;return[4,xM.challenge.friend.processAsync({playerId:xD.getPlayerId(),opponentId:C,extraData:{level:B,fen:A,gravity:R,rules:P,time:O}})];case 3:M.sent(),l5.closeLoadingScreen(),this.goToGameScene();return[3,5];case 4:N=M.sent();if(xG.hasOwn(N,"code")&&"USER_INPUT"===N.code)return[2];console.warn("ReplayChallengeFriend",N),l5.closeLoadingScreen(),l5.showNotificationScreen("Sorry, you cannot replay\nat this time.",2),null==xF||xF.sendException(_instanceof(N,Error)?N:new Error("ReplayChallengeFriend"+JSON.stringify(N))),this.scheduleOnce(this.goToDashboardScene,2);return[3,5];case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onHomeButtonPressed",value:function(){this.goToDashboardScene()}},{key:"goToGameScene",value:function(){lV.switchScene(s0)}},{key:"playWaitingAnimation",value:function(){var g=this,E=0;this.titleText.schedule(function(){E=(E+1)%4;var _=Array(E+1).join(".");g.titleText.string=xU+_},.5);var _=this.titleText.getComponent(eu),k=z(_).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=z(_).repeatForever(k).start()}},{key:"stopWaitingAnimation",value:function(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(eu).opacity=255}}]),i}(M)).prototype,"pollingInterval",[xi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),xf=st(xc.prototype,"playerScore",[xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xy=st(xc.prototype,"opponentScore",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xv=st(xc.prototype,"paperConfetti",[xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xg=st(xc.prototype,"titleText",[xs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xm=st(xc.prototype,"levelManager",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xu=xc))||xu);_._RF.pop(),_._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var xV,xK=k.ccclass,xH=k.property,xq=k.disallowMultiple,xW=GameCore.Events,xj=globalThis.game.event,xX=(xE=xK("BaseScreen"),x_=xH(C),xk=xH(C),xC=xH(eu),xE(xA=xq((xR=st((xT=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"container",xR,Ke(g)),rt(g,"backgroundMask",xI,Ke(g)),rt(g,"screenOpacity",xP,Ke(g)),g.data={},g}return Ue(n,[{key:"__preload",value:function(){this.animation=this.getComponent(G),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function(){var g=this.getMaskOpacity(),E=this.getContainerOpacity();g&&E&&(g.opacity=0,E.opacity=0)}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function(g){this.screenOpacity.opacity=g}},{key:"open",value:function(g){var E,_;g&&(this.data=g),this.show(),this.runAnimation(null!==(E=null===(_=this.data.overrideAnimation)||void 0===_?void 0:_.openScreen)&&void 0!==E?E:"OpenScreen")}},{key:"close",value:function(){var g,E,_=this;this.node.active&&(this.animation.once(G.EventType.FINISHED,function(){xj.emit(xW.CLOSED_SCREEN,{screenName:_.node.name}),_.hide()}),this.runAnimation(null!==(g=null===(E=this.data.overrideAnimation)||void 0===E?void 0:E.closeScreen)&&void 0!==g?g:"CloseScreen"))}},{key:"runAnimation",value:function(g){if(!this.isAnimationExist(g))throw new Error("".concat(this.node.name,": Animation component must have ").concat(g," clip"));this.animation.play(g)}},{key:"isAnimationExist",value:function(g){return this.animation.clips.some(function(E){return!(!E||E.name!==g)})}},{key:"getMaskOpacity",value:function(){var g=this.backgroundMask.getComponent(eu);return g||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function(){var g=this.container.getComponent(eu);return g||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function(){this.setScreenOpacity(255);var g=this.node.getComponent(H);if(g){g.enabled=!0,g.updateAlignment();var E,_=at(this.node.getComponentsInChildren(H));try{for(_.s();!(E=_.n()).done;)E.value.updateAlignment()}catch(g){_.e(g)}finally{_.f()}}}},{key:"hide",value:function(){this.setScreenOpacity(0),this.node.setWorldPosition(new em(-1e3,-1e3,0));var g=this.node.getComponent(H);g&&(g.enabled=!1)}}]),n}(M)).prototype,"container",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xI=st(xT.prototype,"backgroundMask",[xk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xP=st(xT.prototype,"screenOpacity",[xC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xA=xT))||xA)||xA);_._RF.pop(),_._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var xY,xJ,xQ,xZ,x$,x0=k.ccclass,x1=k.requireComponent;x0("BackgroundMask")(xV=x1([eu])(xV=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"onLoad",value:function(){var g=this.getComponent(eu);g?(this.opacity=g,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var g,E,_=this.opacity.opacity/255;g=_,(E=document.getElementById("app-mask"))&&(E.style.background="rgb(0 0 0 / ".concat(g,")"))}}]),n}(M))||xV);_._RF.pop(),_._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);var x2,x4,x3,x5,x6,x8,x9,x7,zt,zn,zi,zr,za,zo,zs=k.ccclass,zl=k.property,zu=(xY=zs("Screens"),xJ=zl({type:es(iw)}),xY((x$=st((xZ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"screenKeys",x$,Ke(g)),g}return Ue(n)}(M)).prototype,"screenKeys",[xJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xQ=xZ))||xQ);_._RF.pop(),_._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var zc,zp,zf,zy,zv,zg,zm,zb,zw,zS,zE,z_,zk,zC,zA,zT,zR,zI,zP,zL,zO,zB=k.ccclass,zN=k.property,zM=k.disallowMultiple,zD=k.requireComponent,zF=GameCore.Events,zU=globalThis.game.event;x2=zB("CongratulationScreen"),x4=zD(xX),x3=zN(C),x5=zN(C),x6=zN(B),x8=zN(B),x9=zN(B),x2(x7=zM(x7=x4((zn=st((zt=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"congratulation",zn,Ke(g)),rt(g,"confirmation",zi,Ke(g)),rt(g,"closeButtonComponent",zr,Ke(g)),rt(g,"yesButtonComponent",za,Ke(g)),rt(g,"noButtonComponent",zo,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("CongratulationScreen: screen not found");g.validateEventPayload(E)&&(g.closeButtonComponent.interactable=!0,g.yesButtonComponent.interactable=!0,g.noButtonComponent.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.confirmationUIOpacity=this.confirmation.getComponent(eu),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){zU.on(zF.OPENING_SCREEN,this.handleOpeningScreen),zU.on(zF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){zU.off(zF.OPENING_SCREEN,this.handleOpeningScreen),zU.off(zF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,l5.closeScreen(iE[this.node.name])}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,z(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),z(this.confirmation).set({scale:new em(.8,.8,.8)}).to(.2,{scale:new em(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(r4.START_OVER,1)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(r4.GAME_REPLAY,{level:this.screen.data.level})}}]),n}(M)).prototype,"congratulation",[x3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zi=st(zt.prototype,"confirmation",[x5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zr=st(zt.prototype,"closeButtonComponent",[x6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),za=st(zt.prototype,"yesButtonComponent",[x8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zo=st(zt.prototype,"noButtonComponent",[x9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x7=zt))||x7)||x7);_._RF.pop(),_._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var zx,zz,zG,zV,zK,zH,zq,zW,zj,zX,zY,zJ,zQ,zZ,z$,z0,z1,z2,z4,z3,z5,z6,z8=k.ccclass,z9=k.property,z7=(zc=z8("DayBlock"),zp=z9({type:eo,group:"Background"}),zf=z9({type:eo,group:"Background"}),zy=z9({type:ea,group:"Background"}),zv=z9({type:ea,group:"Background"}),zg=z9(P),zm=z9(P),zb=z9(C),zw=z9(C),zS=z9(C),zc((zk=st((z_=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"background",zk,Ke(g)),rt(g,"topBackground",zC,Ke(g)),rt(g,"blueBackground",zA,Ke(g)),rt(g,"blueTopBackground",zT,Ke(g)),rt(g,"dayLabel",zR,Ke(g)),rt(g,"coinLabel",zI,Ke(g)),rt(g,"rewardItemsNode",zP,Ke(g)),rt(g,"checkNode",zL,Ke(g)),rt(g,"glowNodes",zO,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new A(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new A("#3469bf")}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){this.updateBackground(g),this.updateDayLabel(g),this.coinLabel.string=g.value.toString(),this.updateRewardItems(g)}},{key:"updateBackground",value:function(g){if(this.blueTopBackground&&this.blueBackground)switch(g.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(g){this.dayLabel.string="Day ".concat(g.day.toString());var E=this.defaultDayLabelOutlineColor;"rewarded"!==g.status&&(E=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=E,this.dayLabel.shadowColor=E}},{key:"updateRewardItems",value:function(g){switch(g.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(g){this.glowNodes&&this.glowNodes.forEach(function(E){E.active=g})}}]),n}(M)).prototype,"background",[zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zC=st(z_.prototype,"topBackground",[zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zA=st(z_.prototype,"blueBackground",[zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zT=st(z_.prototype,"blueTopBackground",[zv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zR=st(z_.prototype,"dayLabel",[zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zI=st(z_.prototype,"coinLabel",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zP=st(z_.prototype,"rewardItemsNode",[zb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zL=st(z_.prototype,"checkNode",[zw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zO=st(z_.prototype,"glowNodes",[zS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zE=z_))||zE);_._RF.pop(),_._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var Gt=k.ccclass,Gn=k.property,Gi=k.requireComponent,Gr=GameCore,Ga=Gr.Events,Go=Gr.Utils,Gs=Go.Object,Gl=Go.Array,Gu=Gr.Configs.DailyRewards,Gc=globalThis.game,Gp=Gc.event,Gf=Gc.dailyRewards,Gy=Gc.player,Gv=Gc.monitorError;zx=Gt("DailyRewardsScreen"),zz=Gi(xX),zG=nA.required(),zV=nA.getComponent(xX),zK=nA.required(),zH=Gn(C),zq=nA.required(),zW=Gn(B),zj=nA.required(),zX=Gn(B),zY=Gn([z7]),zJ=nA.onlyRunInLifeCycleAsync,zQ=nA.onlyRunInLifeCycle,zZ=nA.onlyRunInLifeCycleAsync,z$=nA.onlyRunInLifeCycle,zx(z0=zz((z2=st((z1=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"screen",z2,Ke(g)),g.rewardsData=[],g.debugScreenOpened=!1,g.debugUpdatedRewardsData=!1,rt(g,"loadingRing",z4,Ke(g)),rt(g,"claimButton",z3,Ke(g)),rt(g,"claimX2Button",z5,Ke(g)),rt(g,"dailyBlocks",z6,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(){var E=Be(function(E){return _ts_generator(this,function(_){g.validateEventPayload(E)&&g.open();return[2]})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,nA.decorateComponent(this),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"listenScreenEvents",value:function(){Gp.on(Ga.OPENING_SCREEN,this.handleOpeningScreen),Gp.on(Ga.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Gp.off(Ga.OPENING_SCREEN,this.handleOpeningScreen),Gp.off(Ga.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.prepareScreen(),this.openAsync()}},{key:"openAsync",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.updateRewardsData()];case 1:g.sent();return[4,this.updateScreenToMatchData()];case 2:g.sent();return[2]}})}),function(){return A.apply(this,arguments)})},{key:"updateScreenToMatchData",value:function(){return this.loginDailyRewards(),this.updateDayBlocks(),this.loadingRing.active=!1,this.setInteractableButtons(!0),this.runPopUpAnimation()}},{key:"prepareScreen",value:function(){this.debugScreenOpened=!0,this.loadingRing.active=!0,this.setInteractableButtons(!1),this.node.scene.emit(r4.HIDE_UI),this.resetState()}},{key:"close",value:function(){Gp.emit(Ga.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(r4.SHOW_UI)}},{key:"resetState",value:function(){var g,E=at(this.dailyBlocks);try{for(E.s();!(g=E.n()).done;){var _=g.value;_.uiOpacity.opacity=0,_.node.scale=new em(1.2,1.2,1.2)}}catch(g){E.e(g)}finally{E.f()}}},{key:"runPopUpAnimation",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;this.screen.container||console.warn("DailyRewardScreen: screen not found");return[4,Promise.all(this.dailyBlocks.map(function(E,_){return g.runAppearTween(E,.15*_)}))];case 1:E.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"runAppearTween",value:(k=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=z(g.uiOpacity).delay(E).to(.3,{opacity:255},{easing:"quadOut"}),k=z(g.node).delay(E).to(.3,{scale:em.ONE},{easing:"backOut"});return[4,Promise.all([t$.runTweenAsync(_),t$.runTweenAsync(k)])];case 1:C.sent();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleOnClaim",value:function(){this.setInteractableButtons(!1);var g=this.getCurrentRewardData();if(!g)return null==Gv||Gv.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),l5.showNotificationScreen("Unable to validate rewards. Please try again later...",2),void this.setInteractableButtons(!0);this.claimReward(g)}},{key:"handleOnClaimX2",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.setInteractableButtons(!1);g=this.getCurrentRewardData();if(!g)return[2,(null==Gv||Gv.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),l5.showNotificationScreen("Unable to validate rewards. Please try again later...",2),void this.setInteractableButtons(!0))];return[4,vy.showRewardVideoAdAsync({})];case 1:E.sent()?this.claimReward(g,!0):this.setInteractableButtons(!0);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return Gl.search(this.rewardsData,function(g){return"ready"===g.status})}},{key:"claimReward",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=g.value*(_?2:1),C=new nD;if(this.node.scene.emit(r4.ADD_COINS,{coins:k,collectionAnimation:{animateTextOnly:!1,signal:C}}),g.items){var A=g.items.hint*(_?2:1),T=g.items.thunder*(_?2:1),R=g.items.storm*(_?2:1),I=Gy.getGameData();I?(Gy.setGameData({items:{hint:I.items.hint+A,thunder:I.items.thunder+T,storm:I.items.storm+R,pliers:I.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Gf.requestDailyRewardsAsync()];case 1:_.sent();for(g=Me({},Gf.getDailyRewards()),E=0;E<Gu.MaxDays;E++)g[E]=Me(Me({},g[E]),{},{value:sG[E].value,items:sG[E].items});g&&(this.rewardsData=Gs.vals(g),this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData));return[2]}})}),function(){return E.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){Gf.logLoginReward()}},{key:"updateDayBlocks",value:function(){var g=this;this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),null==Gv||Gv.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach(function(E,_){if(!(_>=g.rewardsData.length)){var k=g.rewardsData[_],C=k.id,A=k.type,T=k.value,R=k.status;E.updateInfo({day:C,type:A,value:T,status:R})}})}},{key:"setInteractableButtons",value:function(g){this.claimButton.interactable=g,this.claimX2Button.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),s}(M)).prototype,"screen",[zG,zV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z4=st(z1.prototype,"loadingRing",[zK,zH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z3=st(z1.prototype,"claimButton",[zq,zW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z5=st(z1.prototype,"claimX2Button",[zj,zX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z6=st(z1.prototype,"dailyBlocks",[zY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),st(z1.prototype,"updateScreenToMatchData",[zJ],Object.getOwnPropertyDescriptor(z1.prototype,"updateScreenToMatchData"),z1.prototype),st(z1.prototype,"claimReward",[zQ],Object.getOwnPropertyDescriptor(z1.prototype,"claimReward"),z1.prototype),st(z1.prototype,"updateRewardsData",[zZ],Object.getOwnPropertyDescriptor(z1.prototype,"updateRewardsData"),z1.prototype),st(z1.prototype,"setInteractableButtons",[z$],Object.getOwnPropertyDescriptor(z1.prototype,"setInteractableButtons"),z1.prototype),z0=z1))||z0);_._RF.pop(),_._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var Gg,Gm,Gb,Gw,GS,GE,G_,Gk,GC,GA;(0,k.ccclass)("DayBlockRed")(function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"updateBackground",value:function(g){if(this.blueTopBackground&&this.blueBackground)switch(g.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(g){this.dayLabel.string="Day ".concat(g.day.toString());var E=this.defaultDayLabelOutlineColor;"ready"===g.status&&(E=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=E,this.dayLabel.outlineColor=E}}]),n}(z7));_._RF.pop(),_._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var GT,GR,GI,GP,GL,GO,GB,GN=k.ccclass,GM=k.property,GD=k.requireComponent,GF=globalThis.game.event,GU=GameCore.Events;Gg=GN("GetCoinScreen"),Gm=GD(xX),Gb=GM(P),Gw=GM(B),GS=GM(B),Gg(GE=Gm((Gk=st((G_=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"quantityLabel",Gk,Ke(g)),rt(g,"closeButtonComponent",GC,Ke(g)),rt(g,"getNowButtonComponent",GA,Ke(g)),g.handleOpeningScreen=function(E){console.log("GetCoinScreen.OPENING_SCREEN",E),g.validateEventPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){GF.on(GU.OPENING_SCREEN,this.handleOpeningScreen),GF.on(GU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){GF.off(GU.OPENING_SCREEN,this.handleOpeningScreen),GF.off(GU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return"screenName"in g&&g.screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(r4.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),GF.emit(GU.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(r4.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var g=this.getQuantity();g&&this.updateQuantityLabel(g)}},{key:"updateQuantityLabel",value:function(g){this.quantityLabel.string="x".concat(g.toString())}},{key:"getQuantity",value:function(){var g=this.payload.screenData;return g&&"quantity"in g&&g.quantity&&"number"==typeof g.quantity?g.quantity:0}},{key:"handleAddCoin",value:function(){var g=this.getQuantity();this.node.scene.emit(r4.ADD_COINS,{coins:g,collectionAnimation:{animateTextOnly:!1},skipAnimation:!0}),this.close()}},{key:"handleGetNowButtonClicked",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:i9.stopAllSounds();return[4,vy.showRewardVideoAdAsync({})];case 1:g.sent()&&this.handleAddCoin();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.getNowButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),i}(M)).prototype,"quantityLabel",[Gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GC=st(G_.prototype,"closeButtonComponent",[Gw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GA=st(G_.prototype,"getNowButtonComponent",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GE=G_))||GE);_._RF.pop(),_._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var Gx,Gz,GG,GV,GK,GH,Gq,GW,Gj,GX,GY,GJ,GQ,GZ,G$,G0,G1,G2,G4,G3,G5,G6,G8,G9,G7=k.ccclass,Vt=k.property,Vn=(GT=G7("ItemCollectionFX"),GR=Vt(eo),GI=Vt(yu),GT((GO=st((GL=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"sprite",GO,Ke(g)),rt(g,"particles",GB,Ke(g)),g}return Ue(n,[{key:"__preload",value:function(){nA.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}}}]),n}(M)).prototype,"sprite",[GR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GB=st(GL.prototype,"particles",[GI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GP=GL))||GP);_._RF.pop(),_._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var Vi,Vr,Va,Vo,Vs,Vl,Vu,Vc,Vp=k.ccclass,Vf=k.property,Vy=globalThis.game,Vv=Vy.event,Vg=Vy.player,Vm=Vy.analytics,Vb=GameCore,Vw=Vb.Events,VS=Vb.Utils,VE=VS.Object,V_=VS.Array,Vk=Vb.Plugins.Analytics.Events;Gx=Vp("GetItemScreen"),Gz=Vf(ee),GG=Vf(eo),GV=Vf(eo),GK=Vf(eo),GH=Vf(eo),Gq=Vf(P),GW=Vf(P),Gj=Vf(P),GX=Vf(B),GY=Vf(B),GJ=Vf(B),Gx((GZ=st((GQ=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"itemFxPrefab",GZ,Ke(g)),rt(g,"hintSprite",G$,Ke(g)),rt(g,"stormSprite",G0,Ke(g)),rt(g,"pliersSprite",G1,Ke(g)),rt(g,"thunderSprite",G2,Ke(g)),rt(g,"titleLabel",G4,Ke(g)),rt(g,"descriptionLabel",G3,Ke(g)),rt(g,"coinLabel",G5,Ke(g)),rt(g,"closeButtonComponent",G6,Ke(g)),rt(g,"buyItemButtonComponent",G8,Ke(g)),rt(g,"getNowButtonComponent",G9,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("GetItemScreen: screen not found");if(g.validateEventPayload(E)){g.setInteractableButtons(!0);var _=g.getItemType();_&&g.updateStatus(_)}},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Vv.on(Vw.OPENING_SCREEN,this.handleOpeningScreen),Vv.on(Vw.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Vv.off(Vw.OPENING_SCREEN,this.handleOpeningScreen),Vv.off(Vw.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.node.scene.emit(r4.GAME_PAUSE)}},{key:"close",value:function(){this.setInteractableButtons(!1),Vv.emit(Vw.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(r4.GAME_RESUME)}},{key:"updateStatus",value:function(g){this.updateItemIcon(g),this.updateTitle(g),this.updateDescription(),this.updateButtons(g)}},{key:"updateItemIcon",value:function(g){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach(function(g){g.node.active=!1}),g){case sN.HINT:this.activeIcon=this.hintSprite;break;case sN.STORM:this.activeIcon=this.stormSprite;break;case sN.THUNDER:this.activeIcon=this.thunderSprite;break;case sN.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}},{key:"updateTitle",value:function(g){var E=g.charAt(0).toUpperCase()+g.slice(1);this.titleLabel.string=E}},{key:"updateDescription",value:function(){var g,E=null===(g=this.payload.screenData)||void 0===g?void 0:g.message;E&&(this.descriptionLabel.string=E)}},{key:"updateButtons",value:function(g){var E=this.canBuyItem(g);this.buyItemButtonComponent.node.active=E,this.getNowButtonComponent.node.active=!E,E&&(this.coinLabel.string="".concat(3*sU[g]))}},{key:"canBuyItem",value:function(g){var E=Vg.getGameData();return!!E&&E.coins>=3*sU[g]}},{key:"getItemType",value:function(){var g=this.payload.screenData;return g&&g.item&&V_.has(VE.vals(sN),g.item)?g.item:null}},{key:"handleAddItem",value:(A=Be(function(){var g,E;return _ts_generator(this,function(_){g=this,E=this.getItemType();E&&(Vm.event(Vk.EARN_ITEM,{item_name:E,value:3}),this.node.scene.emit(r4.ADD_ITEM,{animate:function(){return g.animateAddItem(E)},item:E,quantity:3}));return[2]})}),function(){return A.apply(this,arguments)})},{key:"animateAddItem",value:(C=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:E=this.activeIcon.spriteFrame,_=et(this.createItemCollectionNode(E),2),k=_[0],C=_[1],A=this.getItemButtonWorldPosition(g),T=new em(.5,.5,.5);return[4,this.playScaleUpItemAnim(k,C)];case 1:R.sent();return[4,t$.waitTweenAsync(.8)];case 2:R.sent();return[4,this.playMoveCloseToItemButtonAnim(k,A,T)];case 3:R.sent();return[4,this.playJumpAnim(k,T,A)];case 4:R.sent(),i9.playSound("sounds/clicks"),k.destroy();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"playJumpAnim",value:(k=Be(function(g,E,_){var k,C;return _ts_generator(this,function(A){switch(A.label){case 0:k=_.clone().add3f(0,70,0),C=E.clone().multiplyScalar(1.3);return[4,Promise.all([t$.runTweenAsync(z(g).to(.3,{worldPosition:k},{easing:"cubicOut"})),t$.runTweenAsync(z(g).to(.3,{scale:C},{easing:"cubicOut"}))])];case 1:A.sent();return[4,t$.runTweenAsync(z(g).to(.5,{worldPosition:_},{easing:"cubicIn"}))];case 2:A.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"playMoveCloseToItemButtonAnim",value:function(g,E,_){var k=E.clone().add3f(0,30,0);return t$.runTweenAsync(z(g).to(1,{worldPosition:k,scale:_},{easing:"cubicInOut"}))}},{key:"createItemCollectionNode",value:function(g){var E=I(this.itemFxPrefab),_=E.getComponent(Vn);return E.setParent(this.node.parent),_.sprite.spriteFrame=g,E.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[E,_]}},{key:"playScaleUpItemAnim",value:function(g,E){return g.setScale(em.ZERO),t$.runTweenAsync(z(g).delay(.2).call(function(){E.playExplosionParticles(),i9.playSound("sounds/item_reward")}).to(.1,{scale:new em(.8,1.2,1)}).to(.1,{scale:new em(1.2,.8,1)}).to(.1,{scale:new em(1,1,1)}))}},{key:"getItemButtonWorldPosition",value:function(g){return this.getItemButton(g).worldPosition.clone()}},{key:"handleGetNowButtonClicked",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.stopAllSounds();return[4,vy.showRewardVideoAdAsync({})];case 1:g.sent()&&(this.handleAddItem(),this.close());return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(E=Be(function(){return _ts_generator(this,function(g){this.node.scene.emit(r4.REMOVE_COINS,{coins:3*sU[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close();return[2]})}),function(){return E.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var g;null===(g=$("Sound"))||void 0===g||null===(g=g.getComponent(tO))||void 0===g||g.stopAll()}},{key:"getItemButton",value:function(g){switch(g){case sN.HINT:return $("Canvas/UI/Footer/HintItemButton");case sN.STORM:return $("Canvas/UI/Footer/StormItemButton");case sN.THUNDER:return $("Canvas/UI/Footer/ThunderItemButton");case sN.PLIERS:return $("Canvas/UI/Footer/PliersItemButton")}}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.buyItemButtonComponent.interactable=g,this.getNowButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),s}(M)).prototype,"itemFxPrefab",[Gz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G$=st(GQ.prototype,"hintSprite",[GG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G0=st(GQ.prototype,"stormSprite",[GV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G1=st(GQ.prototype,"pliersSprite",[GK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G2=st(GQ.prototype,"thunderSprite",[GH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G4=st(GQ.prototype,"titleLabel",[Gq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G3=st(GQ.prototype,"descriptionLabel",[GW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G5=st(GQ.prototype,"coinLabel",[Gj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G6=st(GQ.prototype,"closeButtonComponent",[GX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G8=st(GQ.prototype,"buyItemButtonComponent",[GY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G9=st(GQ.prototype,"getNowButtonComponent",[GJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GQ));_._RF.pop(),_._RF.push({},"4d6710xA7hAk65cGA4Dgdrc","GetRewardsScreen",void 0);var VC,VA=k.ccclass,VT=k.requireComponent,VR=k.property,VI=GameCore.Events,VP=globalThis.game.event;Vi=VA("GetRewardsScreen"),Vr=VT(xX),Va=VR(P),Vo=VR(B),Vi(Vs=Vr((Vu=st((Vl=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"adStartingLabel",Vu,Ke(g)),rt(g,"skipButton",Vc,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){VP.on(VI.OPENING_SCREEN,this.handleOpeningScreen),VP.on(VI.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){VP.off(VI.OPENING_SCREEN,this.handleOpeningScreen),VP.off(VI.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.runAdStartingAnimation()}},{key:"close",value:function(g){this.setInteractableButtons(!1),VP.emit(VI.CLOSE_SCREEN,{screenName:this.node.name,screenData:{getRewardsSuccess:g}})}},{key:"runAdStartingAnimation",value:function(){var g=this,E=5;this.adStartingLabel.string="AD starting in ".concat(E,"...");this.schedule(function(){E<=0?g.stopAdStartingAnimation():(E--,g.adStartingLabel.string="AD starting in ".concat(E,"..."))},1,6)}},{key:"stopAdStartingAnimation",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.unscheduleAllCallbacks();return[4,vy.showRewardedInterstitialAdAsync({})];case 1:g=E.sent();this.close(g);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleClickedSkip",value:function(){this.unscheduleAllCallbacks(),this.close(!1)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.skipButton.interactable=g}}]),i}(M)).prototype,"adStartingLabel",[Va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vc=st(Vl.prototype,"skipButton",[Vo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vs=Vl))||Vs);_._RF.pop(),_._RF.push({},"bfe1eXch0ZMKIz1ofLKc2Iv","HardLevelScreen",void 0);var VL,VO,VB,VN,VM,VD,VF,VU,Vx,Vz,VG,VV,VK,VH=k.ccclass,Vq=k.requireComponent,VW=GameCore.Events,Vj=globalThis.game.event;VH("HardLevelScreen")(VC=Vq(xX)(VC=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleOpeningScreen=function(E){g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Vj.on(VW.OPENING_SCREEN,this.handleOpeningScreen),Vj.on(VW.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Vj.off(VW.OPENING_SCREEN,this.handleOpeningScreen),Vj.off(VW.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation()}},{key:"close",value:function(){l5.closeScreen(iE[this.node.name])}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}}]),n}(M))||VC);_._RF.pop(),_._RF.push({},"2db0dg4dI9GCKCdFOMrBFsQ","GetRewardsEffect",void 0);var VX,VY,VJ,VQ,VZ,V$,V0,V1,V2,V4,V3,V5,V6,V8,V9,V7,Kt,Kn,Ki,Kr,Ka,Ko,Ks,Kl,Ku,Kc,Kp,Kd,Kf,Ky,Kv,Kg,Km,Kb,Kw,KS,KE=k.ccclass,K_=k.property,Kk=(VL=KE("GetRewardsEffect"),VO=K_(ea),VB=K_(ea),VN=K_(ea),VM=K_(ea),VD=K_(yu),VL((Vx=st((VU=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"hint",Vx,Ke(g)),rt(g,"thunder",Vz,Ke(g)),rt(g,"storm",VG,Ke(g)),rt(g,"pliers",VV,Ke(g)),rt(g,"particles",VK,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"playAnimation",value:(E=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this,k=-30*(g.length-1)/2+90;return[4,Promise.all(g.map(function(g,C){var A=_.createSprite(g),T=k+30*C,R=.15*C;A.node.position=new em(300*Math.cos(Math.PI/180*T),300*Math.sin(Math.PI/180*T),0);var I=z(A.node);return I.delay(R),I.to(.6,{position:em.ZERO,scale:new em(.7,.7,.7)},{easing:"backIn"}),t$.runTweenAsync(I).then(function(){E(),i9.playSound(ip.COLLECT_STARS),_.playExplodeEffect(),A.node.destroy()})}))];case 1:C.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"playExplodeEffect",value:function(){var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;){var _=g.value;_.stop(),_.play()}}catch(g){E.e(g)}finally{E.f()}}},{key:"createSprite",value:function(g){var E=this.getSpriteFrame(g),_=(new C).addComponent(eo);return _.spriteFrame=E,_.node.parent=this.node,_.node.scale=new em(1.5,1.5,1.5),_}},{key:"getSpriteFrame",value:function(g){switch(g){case"hint":return this.hint;case"thunder":return this.thunder;case"storm":return this.storm;case"pliers":return this.pliers;default:return null}}}]),i}(M)).prototype,"hint",[VO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vz=st(VU.prototype,"thunder",[VB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VG=st(VU.prototype,"storm",[VN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VV=st(VU.prototype,"pliers",[VM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VK=st(VU.prototype,"particles",[VD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),VF=VU))||VF);_._RF.pop(),_._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var KC,KA=k.ccclass,KT=k.property,KR=k.requireComponent,KI=GameCore,KP=KI.Events,KL=KI.Utils.Valid,KO=globalThis.game,KB=KO.event,KN=KO.player,KM="Coin Container";VX=KA("LevelCompleteScreen"),VY=KR(xX),VJ=KT(P),VQ=KT(P),VZ=KT(eu),V$=KT(Kk),V0=KT({type:P,group:"Play Button"}),V1=KT({type:B,group:"Play Button"}),V2=KT({type:C,group:"Play Button"}),V4=KT({type:eu,group:"Play Button"}),V3=KT({type:C,group:"Play Button"}),V5=KT({type:C,group:"Play Button"}),V6=KT({type:G,group:KM}),V8=KT({type:k9,group:KM}),V9=KT({type:G,group:KM}),V7=KT({type:ei,group:KM}),Kt=KT({type:ei,group:KM}),Kn=KT(yu),VX(Ki=VY((Ka=st((Kr=function(g){ze(c,g);var E,_,k,C,A,T,R,I,P=Xe(c);function c(){var g;Fe(this,c);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=P.call.apply(P,[this].concat(_))).level=1,g.coins=40,g.currentCoins=0,g.score=0,g.playAnimation=!1,g.getRewardsSuccess=!1,g.lookingForRewards=!1,g.playButtonSignal=new nD,rt(g,"coinText",Ka,Ke(g)),rt(g,"scoreText",Ko,Ke(g)),rt(g,"lookingForRewardsText",Ks,Ke(g)),rt(g,"getRewardsEffect",Kl,Ke(g)),rt(g,"playButtonLabel",Ku,Ke(g)),rt(g,"playButton",Kc,Ke(g)),rt(g,"playBackground",Kp,Ke(g)),rt(g,"shineBackground",Kd,Ke(g)),rt(g,"hardLevelBackground",Kf,Ke(g)),rt(g,"playButtonContainer",Ky,Ke(g)),rt(g,"coinAnimation",Kv,Ke(g)),rt(g,"coinContainer",Kg,Ke(g)),rt(g,"coinContainerAnimation",Km,Ke(g)),rt(g,"coinContainerEnterClip",Kb,Ke(g)),rt(g,"coinContainerExitClip",Kw,Ke(g)),rt(g,"particles",KS,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StarChestScreen: screen not found");g.validateEventPayload(E)&&(g.playButton.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g.handleParticleEnd=Be(function(){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=g.level;if(!E)return[3,2];return[4,t$.waitTweenAsync(.15)];case 1:E=_.sent();_.label=2;case 2:return[4,Promise.all([g.animateCoin(),g.animateScore()])];case 3:_.sent();if(!g.lookingForRewards)return[3,5];return[4,g.handleLookingForRewards()];case 4:_.sent();return[3,7];case 5:return[4,g.animateVisiblePlayButton(!0)];case 6:_.sent();_.label=7;case 7:return[2]}})}),g}return Ue(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){KB.on(KP.OPENING_SCREEN,this.handleOpeningScreen),KB.on(KP.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){KB.off(KP.OPENING_SCREEN,this.handleOpeningScreen),KB.off(KP.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){var E=null!=g?g:{},_=E.screenName,k=E.screenData;return _===this.node.name&&!!KL.isObject(k)&&(KL.isNumber(k.level)&&(this.level=k.level,this.coins=this.level<5?sM:sD),KL.isNumber(k.coins)&&(this.currentCoins=k.coins),KL.isNumber(k.score)&&(this.score=k.score),this.playAnimation=!1,KL.isObject(k.overrideAnimation)&&(this.playAnimation="LevelCompleteOpenScreen"===k.overrideAnimation.openScreen),this.lookingForRewards=!1,KL.isBoolean(k.lookingForRewards)&&(this.lookingForRewards=k.lookingForRewards),this.getRewardsSuccess=!1,KL.isBoolean(k.getRewardsSuccess)&&(this.getRewardsSuccess=k.getRewardsSuccess),!0)}},{key:"open",value:function(){this.updateStatus(),this.node.scene.emit(r4.HIDE_UI),this.tryPlayAnimation()}},{key:"close",value:(I=Be(function(){var g,E,_,k;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:E=C.length>0&&void 0!==C[0]&&C[0],_=at(this.particles);try{for(_.s();!(g=_.n()).done;){k=g.value;k.stop()}}catch(g){_.e(g)}finally{_.f()}return[4,t$.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name)];case 1:A.sent(),KB.emit(KP.CLOSE_SCREEN,{screenName:this.node.name,screenData:{canShowRewardsAd:E}}),this.node.scene.emit(r4.ABORT_COIN_ANIMATION);return[2]}})}),function(){return I.apply(this,arguments)})},{key:"updateStatus",value:function(){this.updateCoinContainer(),this.updatePlayButton(),this.lookingForRewardsText.opacity=0}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoins})}},{key:"updatePlayButton",value:function(){var g=KN.getGameData();if(g){var E=(this.level+1>g.totalLevel?this.level:this.level+1)%5==0;this.playBackground.active=!E,this.hardLevelBackground.active=E}}},{key:"tryPlayAnimation",value:function(){if(this.playAnimation){this.screen.setScreenOpacity(255),this.coinText.string="x0",this.scoreText.string="0",this.animateVisiblePlayButton(!1,!1);var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}var _=this.screen.getComponent(G);_?_.once(G.EventType.FINISHED,this.handleParticleEnd):this.handleParticleEnd()}else{if(this.animateVisiblePlayButton(!0,!1),!this.getRewardsSuccess)return;this.getRewardsEffect.playAnimation(["storm","thunder"],this.animateCollectItemPlayButton.bind(this))}}},{key:"handleLookingForRewards",value:(R=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.animateLookingForRewards()];case 1:g.sent(),vy.canShowRewardedInterstitialAd()?this.close(!0):this.animateVisiblePlayButton(!0);return[2]}})}),function(){return R.apply(this,arguments)})},{key:"animateCoin",value:(T=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;if(!this.screen.container)return[3,3];this.coinAnimation.play();return[4,t$.runOnUpdateAsync(this.node,.8,function(E){var _=eL(0,g.coins,E),k=Math.floor(_);g.coinText.string="x".concat(k)})];case 1:E.sent();return[4,this.animateCoinCollection()];case 2:E.sent(),this.coinText.string="x".concat(this.coins);return[3,4];case 3:console.warn("LevelCompleteScreen: screen not found");E.label=4;case 4:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"animateScore",value:(A=Be(function(){var g;return _ts_generator(this,function(E){g=this;t$.runOnUpdateAsync(this.scoreText.node,.8,function(E){var _=eL(0,g.score,E);g.scoreText.string="".concat(Math.floor(_))}),this.scoreText.node.setScale(1,1,1),this.scoreText.string="".concat(this.score);return[2]})}),function(){return A.apply(this,arguments)})},{key:"animateCoinCollection",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,t$.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name)];case 1:g.sent(),this.node.scene.emit(r4.ADD_COINS,{coins:this.coins,collectionAnimation:{floatDuration:.5,flyDuration:.5,animateTextOnly:!1,target:this.coinContainer}});return[2]}})}),function(){return C.apply(this,arguments)})},{key:"animateLookingForRewards",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=z(this.lookingForRewardsText);g.to(.25,{opacity:255},{easing:"linear"}).delay(.25),g.to(.25,{opacity:100},{easing:"linear"}).delay(.125);return[4,t$.runTweenAsync(z(this.lookingForRewardsText).repeat(2,g).to(.25,{opacity:0},{easing:"linear"}))];case 1:E.sent(),this.lookingForRewardsText.opacity=0;return[2]}})}),function(){return k.apply(this,arguments)})},{key:"animateVisiblePlayButton",value:(_=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:E=!(T.length>1&&void 0!==T[1])||T[1],_=g?1:0;if(!E)return[3,2];this.playButtonSignal.abort();k=new nD;this.playButtonSignal=k;C=g?0:1;this.playButtonContainer.setScale(C,C,this.playButtonContainer.scale.z);A=z(this.playButtonContainer).to(.5,{scale:new em(_,_,1)},{easing:"backOut"});g||(this.playButton.interactable=!1);return[4,t$.runTweenAsync(A,k)];case 1:R.sent(),g&&(this.playButton.interactable=!0);return[3,3];case 2:this.playButton.interactable=g,this.playButtonContainer.setScale(_,_,this.playButtonContainer.scale.z);R.label=3;case 3:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"animateCollectItemPlayButton",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.playButtonSignal.abort();g=new nD;this.playButtonSignal=g;E=z(this.playButtonContainer).to(.08,{scale:new em(.95,1.05,1)}).to(.08,{scale:new em(1.05,.95,1)}).to(.08,{scale:new em(1,1,1)}),_=z(this.shineBackground).to(.08,{opacity:50},{easing:"quadOut"}).to(.08,{opacity:0},{easing:"quadIn"});return[4,Promise.all([t$.runTweenAsync(E,g),t$.runTweenAsync(_,g)])];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleClickedPlay",value:function(){this.playButton.interactable=!1,this.close()}}]),c}(M)).prototype,"coinText",[VJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ko=st(Kr.prototype,"scoreText",[VQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ks=st(Kr.prototype,"lookingForRewardsText",[VZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kl=st(Kr.prototype,"getRewardsEffect",[V$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=st(Kr.prototype,"playButtonLabel",[V0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kc=st(Kr.prototype,"playButton",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kp=st(Kr.prototype,"playBackground",[V2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kd=st(Kr.prototype,"shineBackground",[V4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kf=st(Kr.prototype,"hardLevelBackground",[V3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ky=st(Kr.prototype,"playButtonContainer",[V5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kv=st(Kr.prototype,"coinAnimation",[V6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kg=st(Kr.prototype,"coinContainer",[V8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Km=st(Kr.prototype,"coinContainerAnimation",[V9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kb=st(Kr.prototype,"coinContainerEnterClip",[V7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kw=st(Kr.prototype,"coinContainerExitClip",[Kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KS=st(Kr.prototype,"particles",[Kn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ki=Kr))||Ki);_._RF.pop(),_._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var KD,KF,KU,Kx,Kz,KG,KV,KK,KH=k.ccclass,Kq=k.disallowMultiple,KW=k.requireComponent,Kj=GameCore.Events,KX=globalThis.game.event;KH("LoadingScreen")(KC=Kq(KC=KW(xX)(KC=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleOpeningScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g.handleClosingScreen=function(E){g.validateEventPayload(E)&&g.unscheduleAllCallbacks()},g.handleClosedScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!1)},g.handleOnCloseScreen=function(){l5.closeScreen(iE[g.node.name])},g}return Ue(n,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){KX.on(Kj.OPENING_SCREEN,this.handleOpeningScreen),KX.on(Kj.OPENED_SCREEN,this.handleOpenedScreen),KX.on(Kj.CLOSING_SCREEN,this.handleClosingScreen),KX.on(Kj.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){KX.off(Kj.OPENING_SCREEN,this.handleOpeningScreen),KX.off(Kj.OPENED_SCREEN,this.handleOpenedScreen),KX.off(Kj.CLOSING_SCREEN,this.handleClosingScreen),KX.off(Kj.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var g=this.screen.data.duration;g&&g>0&&this.scheduleOnce(this.handleOnCloseScreen,g)}}}]),n}(M))||KC)||KC);_._RF.pop(),_._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var KY,KJ,KQ,KZ,K$,K0,K1,K2,K4,K3,K5,K6,K8,K9,K7,Ht,Hn=k.ccclass,Hi=k.disallowMultiple,Hr=k.requireComponent,Ha=k.property,Ho=GameCore,Hs=Ho.Events,Hl=Ho.Utils.Valid,Hu=globalThis.game.event;KD=Hn("NotificationScreen"),KF=Hr(xX),KU=Ha(P),Kx=Ha(B),KD(Kz=Hi(Kz=KF((KV=st((KG=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"message",KV,Ke(g)),rt(g,"touchZone",KK,Ke(g)),g.enableCloseOnTouch=!0,g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.updateScreenData(E)},g.handleClosingScreen=function(E){g.validateEventPayload(E)&&g.unscheduleAllCallbacks()},g}return Ue(n,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Hu.on(Hs.OPENING_SCREEN,this.handleOpeningScreen),Hu.on(Hs.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){Hu.off(Hs.OPENING_SCREEN,this.handleOpeningScreen),Hu.off(Hs.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"updateScreenData",value:function(g){var E=this,_=g.screenData;Hl.isObject(_)?(_.message&&(this.message.string=_.message),_.duration&&_.duration>0&&this.scheduleOnce(function(){l5.closeScreen(iE[E.node.name])},_.duration),!1===_.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),l5.closeScreen(iE[this.node.name])}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),n}(M)).prototype,"message",[KU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KK=st(KG.prototype,"touchZone",[Kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kz=KG))||Kz)||Kz);_._RF.pop(),_._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var Hc,Hh,Hp,Hf,Hy,Hg,Hm,Hb,Hw,HS,HE,H_,Hk,HC,HA,HT,HR,HI,HP,HL,HO,HB,HN=k.ccclass,HM=k.property,HD=k.requireComponent,HF=GameCore,HU=HF.Events,Hx=HF.Match.Modes,Hz=globalThis.game,HG=Hz.event,HV=Hz.storage;KY=HN("QuitLevelScreen"),KJ=HD(xX),KQ=HM(P),KZ=HM(P),K$=HM(B),K0=HM(P),K1=HM(P),K2=HM(B),KY(K4=KJ((K5=st((K3=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"singleDescription",K5,Ke(g)),rt(g,"tournamentDescription",K6,Ke(g)),rt(g,"quitButton",K8,Ke(g)),rt(g,"quitLabel",K9,Ke(g)),rt(g,"endLabel",K7,Ke(g)),rt(g,"continueButton",Ht,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){HG.on(HU.OPENING_SCREEN,this.handleOpeningScreen),HG.on(HU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){HG.off(HU.OPENING_SCREEN,this.handleOpeningScreen),HG.off(HU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(r4.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),l5.closeScreen(iE[this.node.name]),this.node.scene.emit(r4.SHOW_UI),this.node.scene.emit(r4.GAME_RESUME)}},{key:"updateStatus",value:function(){var g=lT.getMatchMode()===Hx.TOURNAMENT;this.singleDescription.node.active=!g,this.tournamentDescription.node.active=g,this.quitLabel.node.active=!g,this.endLabel.node.active=g}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.quitButton.interactable=g,this.continueButton.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"handleClickedContinue",value:function(){this.close()}},{key:"handleClickedQuit",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.setInteractableButtons(!1),lT.getMatchMode()!==Hx.TOURNAMENT)return[3,2];E=(null!==(g=lT.getMatchCustomData())&&void 0!==g?g:{}).score,_=(void 0===E?0:E)>HV.getStorageData("tournament","previousScore");HV.setStorageData("tournament","animateTournamentLeader",_);return[4,lT.finishMatchAsync()];case 1:k.sent();k.label=2;case 2:this.node.scene.emit(r4.GAME_EXIT);return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"singleDescription",[KQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K6=st(K3.prototype,"tournamentDescription",[KZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K8=st(K3.prototype,"quitButton",[K$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K9=st(K3.prototype,"quitLabel",[K0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K7=st(K3.prototype,"endLabel",[K1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ht=st(K3.prototype,"continueButton",[K2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K4=K3))||K4);_._RF.pop(),_._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var HK,HH,Hq,HW,Hj,HX,HY,HJ,HQ,HZ,H$,H0,H1,H2,H4,H3,H5,H6,H8,H9,H7,qt,qn,qi,qr,qa,qo=k.ccclass,qs=k.property,ql=k.disallowMultiple,qu=k.requireComponent,qc=GameCore.Events,qp=globalThis.game,qd=qp.event,qf=qp.player;Hc=qo("RescuesScreen"),Hh=qu(xX),Hp=qs(eu),Hf=qs([C]),Hy=qs(P),Hg=qs(P),Hm=qs(C),Hb=qs(C),Hw=qs(G),HS=qs(C),HE=qs(C),Hc(H_=ql(H_=Hh((HC=st((Hk=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"adOpacity",HC,Ke(g)),rt(g,"animNodes",HA,Ke(g)),rt(g,"titleLabel",HT,Ke(g)),rt(g,"descriptionLabel",HR,Ke(g)),rt(g,"timer",HI,Ke(g)),rt(g,"bomb",HP,Ke(g)),rt(g,"bombAnim",HL,Ke(g)),rt(g,"replayButton",HO,Ke(g)),rt(g,"buyTimeButton",HB,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("RescuesScreen: screen not found");g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){qd.on(qc.OPENING_SCREEN,this.handleOpeningScreen),qd.on(qc.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){qd.off(qc.OPENING_SCREEN,this.handleOpeningScreen),qd.off(qc.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:i9.turnOffMusic();return[4,this.resetState()];case 1:g.sent(),this.runOpenAnimation(),this.node.scene.emit(r4.HIDE_UI);return[2]}})}),function(){return A.apply(this,arguments)})},{key:"close",value:function(){i9.turnUpMusic(),qd.emit(qc.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(C=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){E=(null===(g=this.payload.screenData)||void 0===g?void 0:g.failKey)===ul;this.titleLabel.string=E?"Boom!":"Time's Up!",this.descriptionLabel.string=E?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!E,this.bomb.active=E,E&&this.bombAnim.play();_=qf.getGameData();if(_){k=_.coins>=sx;this.replayButton.active=!k,this.buyTimeButton.active=k,this.adOpacity.opacity=0}return[2]})}),function(){return C.apply(this,arguments)})},{key:"runOpenAnimation",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;if(!this.screen.container)return[3,3];return[4,Promise.all(this.animNodes.map(function(E,_){g.runAppearTween(E,.1*_)}))];case 1:E.sent();return[4,this.runShowAdContainer()];case 2:E.sent();return[3,4];case 3:console.warn("TimeUpScreen: screen not found");E.label=4;case 4:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"runAppearTween",value:(_=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,t$.runTweenAsync(z(g).set({scale:new em(0,0,0)}).delay(E).to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*t$.elasticOut(k,.1,.45)}}))];case 1:_.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var g=z(this.adOpacity);return g.delay(1),g.to(.5,{opacity:255}),t$.runTweenAsync(g)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit(r4.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit(r4.REMOVE_COINS,{coins:sx,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,vy.showRewardVideoAdAsync({})];case 1:g.sent()&&this.startRescue();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit(r4.SHOW_UI),this.node.scene.emit(r4.RESCUE_START),this.close()}}]),s}(M)).prototype,"adOpacity",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HA=st(Hk.prototype,"animNodes",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HT=st(Hk.prototype,"titleLabel",[Hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HR=st(Hk.prototype,"descriptionLabel",[Hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HI=st(Hk.prototype,"timer",[Hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HP=st(Hk.prototype,"bomb",[Hb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HL=st(Hk.prototype,"bombAnim",[Hw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HO=st(Hk.prototype,"replayButton",[HS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HB=st(Hk.prototype,"buyTimeButton",[HE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H_=Hk))||H_)||H_);_._RF.pop(),_._RF.push({},"726c9oCUUBDpboDnHRz7SGZ","PauseScreen",void 0);var qy,qg,qm,qb,qw,qS,qE,q_,qk,qC,qA,qT,qR,qI,qP,qL,qO,qB,qN,qM,qD,qF,qU,qx,qz,qG,qV=k.ccclass,qK=k.property,qH=k.requireComponent,qq=GameCore,qW=qq.Events,qj=qq.Utils.Device,qX=qq.Match.Modes,qY=globalThis.game,qJ=qY.player,qQ=qY.event;HK=qV("PauseScreen"),HH=qH(xX),Hq=qK(C),HW=qK(C),Hj=qK(C),HX=qK(OP),HY=qK(OP),HJ=qK(OP),HQ=qK(B),HZ=qK(B),H$=qK(B),H0=qK(B),H1=qK(C),HK(H2=HH((H3=st((H4=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"musicSetting",H3,Ke(g)),rt(g,"soundSetting",H5,Ke(g)),rt(g,"vibrateSetting",H6,Ke(g)),rt(g,"musicSwitch",H8,Ke(g)),rt(g,"soundSwitch",H9,Ke(g)),rt(g,"vibrateSwitch",H7,Ke(g)),rt(g,"closeButtonComponent",qt,Ke(g)),rt(g,"continueButtonComponent",qn,Ke(g)),rt(g,"restartButtonComponent",qi,Ke(g)),rt(g,"challengeFriendsButtonComponent",qr,Ke(g)),rt(g,"animNodes",qa,Ke(g)),g.triggerSequence="",g.handleOpeningScreen=function(E){g.validateSwitchScreenPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateSwitchScreenPayload(E)&&g.open()},g.handleResetSequence=function(){g.triggerSequence=""},g.handleTriggerUnlockKey=function(E){if("code"in E){var _=E.code,k=sH.UNLOCK_SEQUENCE;"number"==typeof _&&-1!==k.indexOf(_.toString())&&(g.triggerSequence+=_.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",_,g.triggerSequence,g.triggerSequence===k),g.triggerSequence===k&&(g.node.scene.emit(sH.Events.UNLOCK_DEV_TOOLS),g.node.off(sH.Events.TRIGGER_UNLOCK_KEY)))}},g.updateVibrateButton=function(){var E=g.vibrateSetting.getComponentInChildren(B),_=g.vibrateSetting.getComponentInChildren(OP),k=g.vibrateSetting.getComponentInChildren(ry);if(E&&_&&k){if(qj.isMobile()){var C,A=null!==(C=qJ.getPlayerSetting("vibrate"))&&void 0!==C&&C;_.setEnabled(A)}else E.interactable=!1,_.setEnabled(!1),k.changeState(!1)}else console.warn("SettingsScreen: vibrate button missing components")},g}return Ue(a,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){qQ.on(qW.OPENING_SCREEN,this.handleOpeningScreen),qQ.on(qW.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){qQ.off(qW.OPENING_SCREEN,this.handleOpeningScreen),qQ.off(qW.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(g){return g.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(sH.Events.TRIGGER_UNLOCK_KEY),this.node.on(sH.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(sH.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(sH.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(sH.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(sH.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(r4.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(sH.Events.TRIGGER_RESET_SEQUENCE),l5.closeScreen(iE[this.node.name])}},{key:"updateStatus",value:function(){var g,E,_,k={music:null!==(g=qJ.getPlayerSetting("music"))&&void 0!==g&&g,sound:null!==(E=qJ.getPlayerSetting("sound"))&&void 0!==E&&E,vibrate:null!==(_=qJ.getPlayerSetting("vibrate"))&&void 0!==_&&_};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(k.music),this.soundSwitch.setEnabled(k.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var g=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(E,_){g.runAppearTween(E,.1*_)})}},{key:"runAppearTween",value:function(g,E){var _=z(g);_.set({scale:new em(0,0,0)}),_.delay(E),_.to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*t$.elasticOut(k,.1,.45)}}),_.start()}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.continueButtonComponent.interactable=g,this.restartButtonComponent.interactable=g,this.challengeFriendsButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var g=this.musicSwitch.switch();if(qJ.setSetting("music",g),this.node.emit(sH.Events.TRIGGER_UNLOCK_KEY,{code:g?1:0}),g){var E=lT.getMatchMode();i9.playMusic(E===qX.TOURNAMENT?ip.TOURNAMENT_MUSIC:ip.BG_MUSIC)}else i9.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var g=this.soundSwitch.switch();qJ.setSetting("sound",g),this.node.emit(sH.Events.TRIGGER_UNLOCK_KEY,{code:g?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var g=this.vibrateSwitch.switch();qJ.setSetting("vibrate",g)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:this.close();E=(null!==(g=qJ.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;k=vy.canShowInterstitialAd();if(!k)return[3,2];return[4,vy.showInterstitialAdAsync({forLevel:_})];case 1:k=C.sent();C.label=2;case 2:lT.getMatchMode()!==qX.TOURNAMENT?(this.node.scene.emit(r4.GAME_RESUME),this.node.scene.emit(r4.GAME_REPLAY,{level:_})):l5.openScreen(iw.START_OVER_SCREEN);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleClickedChallengeFriends",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if("MsGames"!==GameSDK.getSDKName())return[3,2];l5.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 1:return[2,(g.sent(),void l5.closeLoadingScreen())];case 2:this.close(),this.node.scene.emit(r4.INVITE_FRIENDS);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(r4.GAME_RESUME),this.node.scene.emit(r4.SHOW_UI)}}]),a}(M)).prototype,"musicSetting",[Hq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H5=st(H4.prototype,"soundSetting",[HW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H6=st(H4.prototype,"vibrateSetting",[Hj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H8=st(H4.prototype,"musicSwitch",[HX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H9=st(H4.prototype,"soundSwitch",[HY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H7=st(H4.prototype,"vibrateSwitch",[HJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qt=st(H4.prototype,"closeButtonComponent",[HQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qn=st(H4.prototype,"continueButtonComponent",[HZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qi=st(H4.prototype,"restartButtonComponent",[H$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qr=st(H4.prototype,"challengeFriendsButtonComponent",[H0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qa=st(H4.prototype,"animNodes",[H1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),H2=H4))||H2);_._RF.pop(),_._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var qZ,q$,q0,q1,q2,q4,q3,q5,q6,q8,q9,q7,Wt,Wn,Wi,Wr,Wa,Wo,Ws,Wl,Wu,Wc,Wp,Wd=k.ccclass,Wf=k.property,Wy=k.requireComponent,Wv=GameCore,Wg=Wv.Events,Wm=Wv.Utils.Device,Wb=Wv.Match.Modes,Ww=Wv.Configs.Debugger.MonitorError,WS=globalThis.game,WE=WS.player,W_=WS.event,Wk=WS.monitorError;qy=Wd("SettingsScreen"),qg=Wy(xX),qm=Wf(C),qb=Wf(C),qw=Wf(C),qS=Wf(OP),qE=Wf(OP),q_=Wf(OP),qk=Wf(B),qC=Wf(B),qA=Wf(B),qT=Wf(B),qR=Wf(C),qy(qI=qg((qL=st((qP=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"musicSetting",qL,Ke(g)),rt(g,"soundSetting",qO,Ke(g)),rt(g,"vibrateSetting",qB,Ke(g)),rt(g,"musicSwitch",qN,Ke(g)),rt(g,"soundSwitch",qM,Ke(g)),rt(g,"vibrateSwitch",qD,Ke(g)),rt(g,"closeButtonComponent",qF,Ke(g)),rt(g,"reportButtonComponent",qU,Ke(g)),rt(g,"shareButtonComponent",qx,Ke(g)),rt(g,"inviteFriendsButtonComponent",qz,Ke(g)),rt(g,"animNodes",qG,Ke(g)),g.triggerSequence="",g.handleOpeningScreen=function(E){g.validateSwitchScreenPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateSwitchScreenPayload(E)&&g.open()},g.handleResetSequence=function(){g.triggerSequence=""},g.handleTriggerUnlockKey=function(E){if("code"in E){var _=E.code,k=sH.UNLOCK_SEQUENCE;"number"==typeof _&&-1!==k.indexOf(_.toString())&&(g.triggerSequence+=_.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",_,g.triggerSequence,g.triggerSequence===k),g.triggerSequence===k&&(g.node.scene.emit(sH.Events.UNLOCK_DEV_TOOLS),g.node.off(sH.Events.TRIGGER_UNLOCK_KEY)))}},g.updateVibrateButton=function(){var E=g.vibrateSetting.getComponentInChildren(B),_=g.vibrateSetting.getComponentInChildren(OP),k=g.vibrateSetting.getComponentInChildren(ry);if(E&&_&&k){if(Wm.isMobile()){var C,A=null!==(C=WE.getPlayerSetting("vibrate"))&&void 0!==C&&C;_.setEnabled(A)}else E.interactable=!1,_.setEnabled(!1),k.changeState(!1)}else console.warn("SettingsScreen: vibrate button missing components")},g}return Ue(a,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools(),this.reportButtonComponent.node.parent.active=Ww.Feedback}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){W_.on(Wg.OPENING_SCREEN,this.handleOpeningScreen),W_.on(Wg.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){W_.off(Wg.OPENING_SCREEN,this.handleOpeningScreen),W_.off(Wg.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(g){return g.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(sH.Events.TRIGGER_UNLOCK_KEY),this.node.on(sH.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(sH.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(sH.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(sH.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(sH.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(r4.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(sH.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(r4.SHOW_UI),l5.closeScreen(iE[this.node.name])}},{key:"updateStatus",value:function(){var g,E,_,k={music:null!==(g=WE.getPlayerSetting("music"))&&void 0!==g&&g,sound:null!==(E=WE.getPlayerSetting("sound"))&&void 0!==E&&E,vibrate:null!==(_=WE.getPlayerSetting("vibrate"))&&void 0!==_&&_};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(k.music),this.soundSwitch.setEnabled(k.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var g=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(E,_){("ReportButton"!==E.name||Ww.Feedback)&&g.runAppearTween(E,.1*_)})}},{key:"runAppearTween",value:function(g,E){var _=z(g);_.set({scale:new em(0,0,0)}),_.delay(E),_.to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*t$.elasticOut(k,.1,.45)}}),_.start()}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.reportButtonComponent.interactable=g,this.shareButtonComponent.interactable=g,this.inviteFriendsButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var g=this.musicSwitch.switch();if(WE.setSetting("music",g),this.node.emit(sH.Events.TRIGGER_UNLOCK_KEY,{code:g?1:0}),g){var E=lT.getMatchMode();i9.playMusic(E===Wb.TOURNAMENT?ip.TOURNAMENT_MUSIC:ip.BG_MUSIC)}else i9.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var g=this.soundSwitch.switch();WE.setSetting("sound",g),this.node.emit(sH.Events.TRIGGER_UNLOCK_KEY,{code:g?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var g=this.vibrateSwitch.switch();WE.setSetting("vibrate",g)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedClose",value:function(){this.close()}},{key:"handleClickedReport",value:function(){null==Wk||Wk.feedbackAsync()}},{key:"handleClickedShare",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if("FacebookInstant"!==GameSDK.getSDKName())return[3,2];l5.showLoadingScreen();return[4,GameSDK.extra.shareBestScoreAsync()];case 1:return[2,(g.sent(),void l5.closeLoadingScreen())];case 2:this.close();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleClickedInviteFriends",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=GameSDK.getSDKName();switch(g){case"MsGames":return[3,1];case"FacebookInstant":return[3,3]}return[3,5];case 1:l5.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 2:E.sent(),l5.closeLoadingScreen();return[3,6];case 3:l5.showLoadingScreen();return[4,GameSDK.extra.inviteWithBestScoreAsync()];case 4:E.sent(),l5.closeLoadingScreen();return[3,6];case 5:this.close();E.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"musicSetting",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qO=st(qP.prototype,"soundSetting",[qb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qB=st(qP.prototype,"vibrateSetting",[qw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qN=st(qP.prototype,"musicSwitch",[qS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qM=st(qP.prototype,"soundSwitch",[qE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qD=st(qP.prototype,"vibrateSwitch",[q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qF=st(qP.prototype,"closeButtonComponent",[qk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qU=st(qP.prototype,"reportButtonComponent",[qC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qx=st(qP.prototype,"shareButtonComponent",[qA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qz=st(qP.prototype,"inviteFriendsButtonComponent",[qT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qG=st(qP.prototype,"animNodes",[qR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qI=qP))||qI);_._RF.pop(),_._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var WC,WA,WT,WR,WI,WP,WL,WO,WB,WN,WM,WD,WF,WU,Wx,Wz,WG,WV,WK,WH,Wq=k.ccclass,WW=k.property,Wj=(qZ=Wq("StarChest"),q$=WW(eo),q0=WW(eu),q1=WW(eV),q2=WW(eu),q4=WW(eu),q3=WW({type:K,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),q5=WW({type:K,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),q6=WW({type:K,displayName:"Centered Offset X",group:"Reward Animations"}),q8=WW({type:K,displayName:"Centered Offset Y",group:"Reward Animations"}),q9=WW({type:K,min:0,displayName:"Starting Scale",group:"Reward Animations"}),q7=WW({type:K,min:0,displayName:"Ending Scale",group:"Reward Animations"}),qZ((Wi=st((Wn=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"sprite",Wi,Ke(g)),rt(g,"glowOpacity",Wr,Ke(g)),rt(g,"explosionParticles",Wa,Ke(g)),rt(g,"circle",Wo,Ke(g)),rt(g,"uiOpacity",Ws,Ke(g)),g.ogCenterX=0,g.ogCenterY=0,rt(g,"endingOffsetX",Wl,Ke(g)),rt(g,"endingOffsetY",Wu,Ke(g)),rt(g,"startingScale",Wc,Ke(g)),rt(g,"endingScale",Wp,Ke(g)),g}return Ue(s,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"moveToCenter",value:(A=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=new em(this.endingOffsetX,this.endingOffsetY,this.node.position.z);return[4,t$.runTweenAsync(z(this.node).to(.7,{position:E},{easing:"quintInOut"}),g)];case 1:_.sent(),this.node.position=E;return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new em(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(C=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this.startingScale+(this.endingScale-this.startingScale)*g,k=new em(_,_,_);return[4,Promise.all([t$.runTweenAsync(z(this.sprite.node).to(.2,{scale:k},{easing:"backOut"}),E),t$.runTweenAsync(z(this.glowOpacity.node).to(.2,{scale:k},{easing:"backOut"}),E)])];case 1:C.sent(),this.sprite.node.setScale(k),this.glowOpacity.node.setScale(k);return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"startShaking",value:function(){var g=this,E=this.node.position.clone();this.shakingTween={ogPos:E,tw:z(this.node).to(.1,{},{onUpdate:function(_,k){if(k){var C=E.x+10*(k-.5);g.node.position=new em(C,E.y,E.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this.sprite.node.scale.clone().multiplyScalar(1.1);return[4,Promise.all([t$.runTweenAsync(z(this.sprite.node).to(.2,{scale:E},{easing:"cubicInOut"}),g),t$.runTweenAsync(z(this.glowOpacity.node).to(.2,{scale:E}),g),t$.runTweenAsync(z(this.glowOpacity).to(.5,{opacity:255}),g)])];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"explode",value:(_=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=new em(8,8,8),k=function(){var k=Be(function(){return _ts_generator(this,function(k){switch(k.label){case 0:E.circle.opacity=255,E.circle.node.setScale(em.ZERO);return[4,Promise.all([t$.runTweenAsync(z(E.circle).to(.3,{opacity:0}),g),t$.runTweenAsync(z(E.circle.node).to(.3,{scale:_},{easing:"cubicOut"}),g)])];case 1:k.sent(),E.circle.opacity=0,E.circle.node.scale=_;return[2]}})});return function(){return k.apply(this,arguments)}}(),C=function(){var _=Be(function(){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Promise.all([t$.runTweenAsync(z(E.glowOpacity.node).to(.3,{scale:em.ZERO},{easing:"cubicOut"}),g),t$.runTweenAsync(z(E.sprite.node).to(.3,{scale:em.ZERO},{easing:"cubicOut"}),g)])];case 1:_.sent(),E.sprite.node.setScale(em.ZERO),E.glowOpacity.node.setScale(em.ZERO);return[2]}})});return function(){return _.apply(this,arguments)}}();return[4,Promise.all([this.explodeParticles(g),k(),C()])];case 1:A.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"explodeParticles",value:(E=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=g.aborted;if(E)return[3,2];this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem();return[4,t$.waitTweenAsync(1)];case 1:E=(_.sent(),this.explosionParticles.node.active=!1);_.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),s}(M)).prototype,"sprite",[q$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wr=st(Wn.prototype,"glowOpacity",[q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wa=st(Wn.prototype,"explosionParticles",[q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wo=st(Wn.prototype,"circle",[q2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ws=st(Wn.prototype,"uiOpacity",[q4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Wn.prototype,"startingOffsetX",[q3],Object.getOwnPropertyDescriptor(Wn.prototype,"startingOffsetX"),Wn.prototype),st(Wn.prototype,"startingOffsetY",[q5],Object.getOwnPropertyDescriptor(Wn.prototype,"startingOffsetY"),Wn.prototype),Wl=st(Wn.prototype,"endingOffsetX",[q6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wu=st(Wn.prototype,"endingOffsetY",[q8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wc=st(Wn.prototype,"startingScale",[q9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Wp=st(Wn.prototype,"endingScale",[q7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Wt=Wn))||Wt);_._RF.pop(),_._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var WX,WY,WJ,WQ,WZ,W$,W0,W1,W2,W4,W3,W5,W6,W8,W9=k.ccclass,W7=k.property,jt=k.requireComponent,ji=GameCore.Events,jr=globalThis.game,ja=jr.event,jo=jr.player;WC=W9("StarChestScreen"),WA=jt(xX),WT=W7(RX),WR=W7(B),WI=W7(B),WP=W7(G),WL=W7(Wj),WO=W7(eu),WB=W7(kV),WN=W7(P),WC(WM=WA((WF=st((WD=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"starProgressBar",WF,Ke(g)),rt(g,"openButton",WU,Ke(g)),rt(g,"continueButton",Wx,Ke(g)),rt(g,"chestAnimation",Wz,Ke(g)),rt(g,"starChest",WG,Ke(g)),rt(g,"chestUnlockFXMask",WV,Ke(g)),rt(g,"skipOverlay",WK,Ke(g)),rt(g,"messageLabel",WH,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StarChestScreen: screen not found");g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){ja.on(ji.OPENING_SCREEN,this.handleOpeningScreen),ja.on(ji.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){ja.off(ji.OPENING_SCREEN,this.handleOpeningScreen),ja.off(ji.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(r4.HIDE_UI);var g=jo.getGameData();if(g){var E=g.stars;this.numChestAvailable=Math.floor(E/20),this.starProgressBar.setRange(E,20);var _=this.numChestAvailable>0;this.setInteractableButtons(!0),this.openButton.node.active=_,this.openButton.interactable=_,this.continueButton.node.active=!_,this.continueButton.interactable=!_,this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){ja.emit(ji.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(r4.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(C=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!(0!==this.numChestAvailable))return[3,5];i9.turnDownMusic();g=jo.getGameData();if(!g)return[3,4];this.setInteractableButtons(!1);E=g.stars;jo.setGameData({stars:g.stars-20*this.numChestAvailable});_=new nD;return[4,this.skipOverlay.open({opacity:200,onSkip:function(){return _.abort()}})];case 1:k.sent();return[4,this.handleUnlockAnimation(E,g.stars,_)];case 2:k.sent();return[4,this.skipOverlay.close()];case 3:k.sent(),i9.turnUpMusic(),Q.emit(nI),this.close();k.label=4;case 4:return[3,6];case 5:this.close();k.label=6;case 6:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(k=Be(function(g,E,_){var k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:k=this;return[4,Promise.all([this.starChest.moveToCenter(_),this.fadeInChestUnlockFX(_)])];case 1:R.sent(),this.chestAnimation.stop(),this.starChest.startShaking();return[4,i9.playSound(ip.STAR_CHEST_DRUM_ROLL,{loop:!0})];case 2:R.sent();return[4,t$.waitTweenAsync(0)];case 3:R.sent();C=g,A=this.numChestAvailable;return[4,Promise.all([this.starProgressBar.animateTo(E,_,function(g){var E;C-g>=20&&(C=g,A--,k.starChest.scale((E=A,k.numChestAvailable>2?1-E/k.numChestAvailable:.35*(1-E/k.numChestAvailable)),_),i9.playSound(ip.STAR_CHEST_OPEN))})])];case 4:R.sent();return[4,t$.waitTweenAsync(1,_)];case 5:R.sent(),this.starChest.stopShaking();return[4,this.starChest.glow(_)];case 6:R.sent(),i9.stopSound(ip.STAR_CHEST_DRUM_ROLL);T=sF*this.numChestAvailable;this.node.scene.emit(r4.ADD_COINS,{coins:T,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:_},skipAnimation:!0});return[4,this.starChest.explode(_)];case 7:R.sent();return[4,t$.waitTweenAsync(1,_)];case 8:R.sent();return[4,Promise.all([this.fadeOutChestUnlockFX(_)])];case 9:R.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.chestUnlockFXMask.node.active=!0;return[4,t$.runTweenAsync(z(this.chestUnlockFXMask).to(.5,{opacity:150}),g)];case 1:E.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,t$.runTweenAsync(z(this.chestUnlockFXMask).to(.3,{opacity:0}),g)];case 1:E.sent(),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1;return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setInteractableButtons",value:function(g){this.openButton.interactable=g,this.continueButton.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),r}(M)).prototype,"starProgressBar",[WT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WU=st(WD.prototype,"openButton",[WR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wx=st(WD.prototype,"continueButton",[WI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wz=st(WD.prototype,"chestAnimation",[WP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WG=st(WD.prototype,"starChest",[WL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WV=st(WD.prototype,"chestUnlockFXMask",[WO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WK=st(WD.prototype,"skipOverlay",[WB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WH=st(WD.prototype,"messageLabel",[WN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WM=WD))||WM);_._RF.pop(),_._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);var js,jl,ju,jc,jp,jd,jf,jy,jv=k.ccclass,jg=k.property,jm=k.requireComponent,jb=GameCore.Events,jw=globalThis.game.event;WX=jv("StartLevelScreen"),WY=jm(xX),WJ=jg(C),WQ=jg(C),WZ=jg(C),W$=jg(C),W0=jg(B),WX(W1=WY((W4=st((W2=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"playButton",W4,Ke(g)),rt(g,"goalText",W3,Ke(g)),rt(g,"levelText",W5,Ke(g)),rt(g,"missionText",W6,Ke(g)),rt(g,"playButtonComponent",W8,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StartLevelScreen: screen not found");g.validateEventPayload(E)&&(g.playButtonComponent.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){jw.on(jb.OPENING_SCREEN,this.handleOpeningScreen),jw.on(jb.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){jw.off(jb.OPENING_SCREEN,this.handleOpeningScreen),jw.off(jb.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){var E=null!=g?g:{},_=E.screenName,k=E.screenData;return _===this.node.name&&(null!=k&&k.level&&(this.levelId=k.level),null!=k&&k.mission&&(this.mission=k.mission),!0)}},{key:"open",value:function(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(r4.HIDE_UI)}},{key:"close",value:function(){this.playButtonComponent.interactable=!1,jw.emit(jb.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(r4.SHOW_UI)}},{key:"updateComponents",value:function(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}},{key:"updateGoalText",value:function(){var g=this.mission.mission;this.goalText.getComponent(P).string=g>1?"Goals":"Goal"}},{key:"updateLevelText",value:function(){this.levelText.getComponent(P).string="Level ".concat(this.levelId)}},{key:"updateDescriptionText",value:function(){this.missionText.getComponent(P).string=this.mission.description}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedPlay",value:function(){this.node.scene.emit(r4.GAME_START),this.close()}}]),n}(M)).prototype,"playButton",[WJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W3=st(W2.prototype,"goalText",[WQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W5=st(W2.prototype,"levelText",[WZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W6=st(W2.prototype,"missionText",[W$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W8=st(W2.prototype,"playButtonComponent",[W0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W1=W2))||W1);_._RF.pop(),_._RF.push({},"2f7694kcVZNWq3iTCp1piqI","StartOverScreen",void 0);var jS,jE,j_,jk,jC,jA=k.ccclass,jT=k.property,jR=k.requireComponent,jI=GameCore.Events,jP=globalThis.game,jL=jP.event,jO=jP.player;js=jA("StartOverScreen"),jl=jR(xX),ju=jT(B),jc=jT(B),js(jp=jl((jf=st((jd=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"restartButton",jf,Ke(g)),rt(g,"cancelButton",jy,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){jL.on(jI.OPENING_SCREEN,this.handleOpeningScreen),jL.on(jI.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){jL.off(jI.OPENING_SCREEN,this.handleOpeningScreen),jL.off(jI.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(r4.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),l5.closeScreen(iE[this.node.name])}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.restartButton.interactable=g,this.cancelButton.interactable=g}},{key:"handleClickedCancel",value:function(){this.close(),this.node.scene.emit(r4.GAME_RESUME),this.node.scene.emit(r4.SHOW_UI)}},{key:"handleClickedRestart",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){this.close();E=(null!==(g=jO.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;this.node.scene.emit(r4.GAME_RESUME),this.node.scene.emit(r4.GAME_REPLAY,{level:_});return[2]})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"restartButton",[ju],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jy=st(jd.prototype,"cancelButton",[jc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jp=jd))||jp);_._RF.pop(),_._RF.push({},"d6d78U+W5xDwqln9pXXQOaF","TopLeaders",void 0);var jB,jN,jM,jD,jF,jU=k.ccclass,jx=k.property,jz=(jS=jU("TopLeaders"),jE=jx(MO),jS((jC=st((jk=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"topLeaders",jC,Ke(g)),g.leaderData=[],g}return Ue(i,[{key:"updateData",value:function(g){var E=this;this.leaderData=g.slice(0,3),this.leaderData.slice(0,3).forEach(function(g,_){E.topLeaders[_].updateInfo({playerId:g.playerId,name:g.name,photo:g.photo,score:g.score})})}},{key:"playShowLeadersAnimation",value:(E=Be(function(g){var E,_,k;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=C.length>1&&void 0!==C[1]?C[1]:.1,k=.3;return[4,Promise.all(this.leaderData.map(function(){var C=Be(function(C,A){var T;return _ts_generator(this,function(C){switch(C.label){case 0:T=E.topLeaders[A];return[4,T.runShowUpAnimation(A*_,k,g)];case 1:C.sent();return[2]}})});return function(g,E){return C.apply(this,arguments)}}()))];case 1:A.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"hideLeaders",value:function(){var g,E=at(this.topLeaders);try{for(E.s();!(g=E.n()).done;)g.value.setVisible(!1)}catch(g){E.e(g)}finally{E.f()}}}]),i}(M)).prototype,"topLeaders",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),j_=jk))||j_);_._RF.pop(),_._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var jG,jV,jK,jH,jq,jW,jj,jX,jY,jJ,jQ,jZ,j$,j0,j1,j2,j4,j3,j5,j6,j8,j9,j7,Xt,Xn,Xi,Xr,Xa,Xo,Xs,Xl,Xu,Xc,Xh,Xp,Xd,Xf,Xy,Xv,Xg,Xm,Xb=k.ccclass,Xw=k.property,XS=(jB=Xb("TournamentLeaderSkeleton"),jN=Xw(C),jB((jF=st((jD=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",jF,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,t$.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;_=this.container.position.clone();this.container.position=new em(_.x,_.y-100,_.z);k=z(this.node).delay(g);k.to(.2,{scale:em.ONE},{easing:"elasticOut"});C=z(this.container).delay(g);C.to(.2,{position:_},{easing:"backOut"});A=z(this.uiOpacity).delay(g);A.to(.2,{opacity:255},{easing:"cubicOut"});return[4,Promise.all([t$.runTweenAsync(k,E),t$.runTweenAsync(C,E),t$.runTweenAsync(A,E)])];case 1:T.sent(),this.node.scale=em.ONE,this.container.position=_,this.uiOpacity.opacity=255;return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(M)).prototype,"container",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jM=jD))||jM);_._RF.pop(),_._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var XE=k.ccclass,X_=k.property,Xk=k.requireComponent,XC=GameCore,XA=XC.Events,XT=XC.Utils,XR=XT.Object,XI=XT.Time,XP=XT.Number,XL=globalThis.game,XO=XL.event,XB=XL.storage,XN=XL.player,XM=XL.leaderboard,XD=1166;jG=XE("TournamentDetailScreen"),jV=Xk(xX),jK=X_(P),jH=X_(P),jq=X_(P),jW=X_(NA),jj=X_(jz),jX=X_({type:C,group:"Buttons"}),jY=X_({type:C,group:"Buttons"}),jJ=X_({type:C,group:"Buttons"}),jQ=X_({type:eo}),jZ=X_({type:C}),j$=X_({type:C}),j0=X_({type:[XS]}),j1=X_(yu),j2=X_({type:R,group:"Container"}),j4=X_({type:R,group:"Container"}),j3=nA.onlyRunInLifeCycleAsync,j5=nA.onlyRunInLifeCycleAsync,j6=nA.onlyRunInLifeCycleAsync,j8=nA.onlyRunInLifeCycleAsync,j9=nA.onlyRunInLifeCycleAsync,j7=nA.onlyRunInLifeCycle,Xt=nA.onlyRunInLifeCycle,jG(Xn=jV((Xr=st((Xi=function(g){ze(v,g);var E,_,k,C,A,T,R,I,P,L,O,N,M,D=Xe(v);function v(){var g;Fe(this,v);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=D.call.apply(D,[this].concat(_)),"titleLabel",Xr,Ke(g)),rt(g,"timeLabel",Xa,Ke(g)),rt(g,"playerCountLabel",Xo,Ke(g)),rt(g,"tournamentLeaders",Xs,Ke(g)),rt(g,"topLeaders",Xl,Ke(g)),rt(g,"playButton",Xu,Ke(g)),rt(g,"continueButton",Xc,Ke(g)),rt(g,"replayButton",Xh,Ke(g)),rt(g,"banner",Xp,Ke(g)),rt(g,"bannerLoadingRing",Xd,Ke(g)),rt(g,"bannerMask",Xf,Ke(g)),rt(g,"leaderSkeletons",Xy,Ke(g)),rt(g,"paperConfetti",Xv,Ke(g)),rt(g,"container",Xg,Ke(g)),rt(g,"tempContainer",Xm,Ke(g)),g.signal=new nD,g.leadersPayload=null,g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("TournamentDetailScreen: screen not found");g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(v,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nA.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){XO.on(XA.OPENING_SCREEN,this.handleOpeningScreen),XO.on(XA.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){XO.off(XA.OPENING_SCREEN,this.handleOpeningScreen),XO.off(XA.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.updateContainer(),this.setInteractableButtons(!0),this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders(),this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(r4.HIDE_UI),this.updateInfo()}},{key:"close",value:function(){l5.closeTournamentDetailScreen(),this.setInteractableButtons(!1),this.node.scene.emit(r4.SHOW_UI),this.cleanup()}},{key:"cleanup",value:function(){var g;null===(g=this.signal)||void 0===g||g.abort(),this.signal=new nD,this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(M=Be(function(){var g,E,_,k,C,A,T,R,I,P,L,O,B,N,M,D,F,U,x,z,G,V,K,H,q,W,j,X,Y,J;return _ts_generator(this,function(Q){switch(Q.label){case 0:T=this,R=this.signal,I=null===(g=this.payload)||void 0===g||null===(g=g.screenData)||void 0===g?void 0:g.tournament;if(!I)return[3,9];P=null===(E=null===(_=this.payload.screenData)||void 0===_?void 0:_.playAnimation)||void 0===E||E,L=JSON.parse(I);L.id=L.id.toString(),this.tournamentPayload=L;O=this.tournamentPayload,B=O.endTime,N=O.payload,M=O.title,D=N.leaderboardId,F=void 0===D?"":D,U=N.themeId;this.updateTitle(M),this.updateEndTime(B),this.updateTournamentBanner(U,R);x=XB.getStorage("tournament"),z=x.previousScore,G=x.animateTournamentLeader;XB.setStorageData("tournament","animateTournamentLeader",!1),this.updateButtonsVisibility(G);return[4,this.showLoading(R)];case 1:Q.sent();return[4,this.loadLeaders(F)];case 2:if(Q.sent(),!!this.leadersPayload&&0!==this.leadersPayload.leaders.length&&!R.aborted)return[3,4];this.updatePlayerCount(0);return[4,this.hideLoading(R)];case 3:return[2,void Q.sent()];case 4:V=this.leadersPayload,K=V.player,H=V.amountPlayer,q=null!==(k=this.leadersPayload.leaders)&&void 0!==k?k:[];q.sort(function(g,E){return g.rank-E.rank});return[4,this.hideLoading(R)];case 5:if(Q.sent(),!this.topLeaders||!this.tournamentLeaders||!!R.aborted)return[3,9];this.updatePlayerCount(H),this.topLeaders.updateData(q),this.topLeaders.playShowLeadersAnimation(R);W=null!==(C=null==K?void 0:K.score)&&void 0!==C?C:0,j=null!==(A=null==K?void 0:K.rank)&&void 0!==A?A:0,X=G&&-1!==z&&z<W;this.tournamentLeaders.updateData(q);Y=!1;K&&X&&(Y=this.tournamentLeaders.updateDisplayPlayerLeaderForRankChanging(z,W,j)),this.tournamentLeaders.initScrollViews(),this.tournamentLeaders.scrollView.scrollView.enabled=!0;return[4,R.callAsync(function(g){return T.runShowUpAnimation(g,P)})];case 6:Q.sent();J=G&&Y&&-1!==z&&this.tournamentLeaders;if(!J)return[3,8];return[4,R.callAsync(function(g){return T.tournamentLeaders.playRankChangeAnimation(g,z,W,j)})];case 7:J=(Q.sent(),this.tryPlayConfettiEffect(j));Q.label=8;case 8:Q.label=9;case 9:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"updateContainer",value:(N=Be(function(){var g;return _ts_generator(this,function(E){g=this.tempContainer.height;this.container.node.position=this.tempContainer.node.position.clone(),g<XD&&this.container.height!==g?(this.container.height=g,eb.instance.emit("canvas-resize")):g>XD&&this.container.height<XD&&(this.container.height=XD,eb.instance.emit("canvas-resize"));return[2]})}),function(){return N.apply(this,arguments)})},{key:"loadLeaders",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,this.getLeadersPayload(g)];case 1:E.leadersPayload=_.sent();return[2]}})}),function(g){return O.apply(this,arguments)})},{key:"showLoading",value:(L=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=k.length>1&&void 0!==k[1]?k[1]:0;return[4,Promise.all([this.tournamentLeaders.scrollView.unlistenEvents(),this.tournamentLeaders.scrollView.scrollToTop(g,.1).then(function(){E.tournamentLeaders.scrollView.scrollView.enabled=!1,E.tournamentLeaders.scrollView.listenEvents()}),this.leaderSkeletons.map(function(E,k){return E.show(k*_,g)})])];case 1:C.sent();return[2]}})}),function(g){return L.apply(this,arguments)})},{key:"hideLoading",value:(P=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(E){return E.hide(g)}))];case 1:E.sent();return[2]}})}),function(g){return P.apply(this,arguments)})},{key:"runShowUpAnimation",value:(I=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=!(k.length>1&&void 0!==k[1])||k[1],_=E?0:.1;return[4,this.tournamentLeaders.playShowLeadersAnimation(g,_)];case 1:C.sent();return[4,this.tournamentLeaders.scrollToPlayerLeader(1.5,g)];case 2:C.sent();return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"tryPlayConfettiEffect",value:function(g){if(!(g>10)){var E,_=at(this.paperConfetti);try{for(_.s();!(E=_.n()).done;)E.value.play()}catch(g){_.e(g)}finally{_.f()}i9.playSound(ip.LEADERBOARD_TRIUMPH)}}},{key:"updateTitle",value:function(g){g&&(this.titleLabel.string=g)}},{key:"updateEndTime",value:function(g){var E=XI.getRelativeTime(g);E=(E=E.replace("seconds","secs").replace("second","sec")).replace("minutes","mins").replace("minute","min"),this.timeLabel.string="Ends ".concat(E)}},{key:"updateTournamentBanner",value:(R=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.banner.spriteFrame=null;_=ii.getAsset("".concat(nz[g],"/spriteFrame"),ea);k=_;if(k)return[3,2];this.bannerMask.active=!0,this.bannerLoadingRing.active=!0;return[4,ii.loadThemeTournamentAsync(g)];case 1:k=_=A.sent();A.label=2;case 2:C=_;if(C)return[3,4];return[4,ii.loadThemeTournamentAsync(la.SUMMER)];case 3:C=_=A.sent();A.label=4;case 4:this.banner&&_&&!E.aborted&&(this.banner.spriteFrame=_,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1);return[2]}})}),function(g,E){return R.apply(this,arguments)})},{key:"updatePlayerCount",value:function(g){var E=XP.getShortNumber(g,3);this.playerCountLabel.string="".concat(E," ").concat(g>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"getLeadersPayload",value:(T=Be(function(g){var E,_,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:E=XM.getLeaderboardName(g);if(!E)return[2,null];return[4,li.getAllLeaderboardAsync(g)];case 1:_=L.sent();if(!_)return[2,null];C=XR.vals(_.leaders),A=XN.getPlayerId(),T={leaders:[],amountPlayer:_.amountPlayer},R=at(C);try{for(R.s();!(k=R.n()).done;){I=k.value;I.playerId===A?(T.player=I,T.leaders.push(I)):T.leaders.push(I)}}catch(g){R.e(g)}finally{R.f()}if(!!T.player)return[3,3];return[4,XM.getLeadersByPlayerIdsAsync(E,[A])];case 2:P=L.sent();P&&P.length>0&&(T.player=P[0],T.leaders.push(P[0]));L.label=3;case 3:return[2,T]}})}),function(g){return T.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(g){this.playButton.active=!g,this.continueButton.active=g,this.replayButton.active=g}},{key:"handleOnPlay",value:(A=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.tournamentPayload.id||"";if(ua.validateTournamentExpired(g))return[2,(this.close(),this.node.scene.emit(s4.RELOAD_TOURNAMENT),void l5.showNotificationScreen("Tournament has ended",2))];k.label=1;case 1:k.trys.push([1,4,9,10]);l5.showLoadingScreen();return[4,lT.setMatchCustomDataAsync({level:1,score:0})];case 2:k.sent();return[4,this.processJoinTournament()];case 3:k.sent();return[3,10];case 4:E=k.sent();if(XR.hasOwn(E,"code")&&"USER_INPUT"===E.code)return[2];k.label=5;case 5:k.trys.push([5,7,,8]);return[4,this.processContinueTournament()];case 6:k.sent();return[3,8];case 7:_=k.sent();if(XR.hasOwn(_,"code")&&"USER_INPUT"===_.code)return[2];console.error("processPlayButtonPressed",_),l5.showNotificationScreen("Sorry, you cannot join\nat this time.",2);return[3,8];case 8:return[3,10];case 9:l5.closeLoadingScreen();return[7];case 10:return[2]}})}),function(){return A.apply(this,arguments)})},{key:"processJoinTournament",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,this.joinTournamentAsync()];case 1:E.sent(),lV.switchScene(s0,{level:1});return[3,3];case 2:g=E.sent();throw console.warn("processJoinTournament",g),g;case 3:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"processContinueTournament",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,this.continueTournamentAsync()];case 1:E.sent(),lV.switchScene(s0,{level:1});return[3,3];case 2:g=E.sent();throw console.warn("processContinueTournament",g),g;case 3:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"joinTournamentAsync",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.tournamentPayload.id||"";return[4,lT.joinTournamentAsync(g)];case 1:E.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"continueTournamentAsync",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:E=null!==(g=GameSDK.context.getID())&&void 0!==g?g:"";return[4,lT.continueTournamentAsync(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var g,E,_=(null!==(g=null===(E=this.payload)||void 0===E?void 0:E.screenData)&&void 0!==g?g:{}).tournamentContextType;switch(void 0===_?"tournament_start":_){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}},{key:"setInteractableButtons",value:function(g){this.screen.backgroundMask.getComponent(B).interactable=g}}]),v}(M)).prototype,"titleLabel",[jK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xa=st(Xi.prototype,"timeLabel",[jH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xo=st(Xi.prototype,"playerCountLabel",[jq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xs=st(Xi.prototype,"tournamentLeaders",[jW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xl=st(Xi.prototype,"topLeaders",[jj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xu=st(Xi.prototype,"playButton",[jX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xc=st(Xi.prototype,"continueButton",[jY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xh=st(Xi.prototype,"replayButton",[jJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=st(Xi.prototype,"banner",[jQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xd=st(Xi.prototype,"bannerLoadingRing",[jZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xf=st(Xi.prototype,"bannerMask",[j$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xy=st(Xi.prototype,"leaderSkeletons",[j0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xv=st(Xi.prototype,"paperConfetti",[j1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xg=st(Xi.prototype,"container",[j2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xm=st(Xi.prototype,"tempContainer",[j4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Xi.prototype,"updateInfo",[j3],Object.getOwnPropertyDescriptor(Xi.prototype,"updateInfo"),Xi.prototype),st(Xi.prototype,"loadLeaders",[j5],Object.getOwnPropertyDescriptor(Xi.prototype,"loadLeaders"),Xi.prototype),st(Xi.prototype,"showLoading",[j6],Object.getOwnPropertyDescriptor(Xi.prototype,"showLoading"),Xi.prototype),st(Xi.prototype,"hideLoading",[j8],Object.getOwnPropertyDescriptor(Xi.prototype,"hideLoading"),Xi.prototype),st(Xi.prototype,"runShowUpAnimation",[j9],Object.getOwnPropertyDescriptor(Xi.prototype,"runShowUpAnimation"),Xi.prototype),st(Xi.prototype,"tryPlayConfettiEffect",[j7],Object.getOwnPropertyDescriptor(Xi.prototype,"tryPlayConfettiEffect"),Xi.prototype),st(Xi.prototype,"updatePlayerCount",[Xt],Object.getOwnPropertyDescriptor(Xi.prototype,"updatePlayerCount"),Xi.prototype),Xn=Xi))||Xn);_._RF.pop(),_._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,k.ccclass)("TournamentLeader")(function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n)}(B4));_._RF.pop(),_._RF.push({},"0b4bc6YT6ZGg4lnXfh/zL6J","AdsManager",void 0);var XF=GameCore,XU=XF.Events,Xx=XF.Configs,Xz=XF.Utils.Time,XG=globalThis.game,XV=XG.ads,XK=XG.player,XH=XG.event,Xq=function(){function e(){var g=this;Fe(this,e),this.currentLayout="",this.handleShowBannerAds=function(E){E.sceneName!==s$&&(XK.isFirstLogin()||(g.showBannerAdsByLayout(g.currentLayout),XH.off(XU.SCENE_LAUNCHED,g.handleShowBannerAds)))},this.handleWhenGameReady=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,g.handleShowInterstitialAdWhenGameReady()];case 1:E.sent();return[4,Xz.sleepAsync(2e3)];case 2:E.sent(),vy.preloadAds();return[2]}})}),this.handleShowInterstitialAdWhenGameReady=Be(function(){var E,_,k,C,A,T,R,I,P;return _ts_generator(this,function(L){switch(L.label){case 0:E=Xx.Ads,_=E.Enabled,k=E.ShowAdOnLoad;if(!_)return[3,6];C=k.Enabled,A=k.DelaySeconds,T=k.PlacementId;if(!C)return[3,6];L.label=1;case 1:L.trys.push([1,5,,6]);R=A>0;if(!R)return[3,3];return[4,Xz.sleepAsync(1e3*A)];case 2:R=L.sent();L.label=3;case 3:I=XV.getAdByPlacementId(T);if(!I)return[2];return[4,g.showAdByConfig(I)];case 4:L.sent();return[3,6];case 5:P=L.sent();console.warn("handleShowAdWhenLoadGame failed",P);return[3,6];case 6:return[2]}})}),this.handleLayoutChanged=function(E){g.currentLayout!==E&&(g.currentLayout=E,g.showBannerAdsByLayout(E))}}var g;return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Ads Manager: Initialized")}},{key:"listenEvents",value:function(){Q.on(t8,this.handleLayoutChanged),XH.on(XU.SCENE_LAUNCHED,this.handleShowBannerAds),XH.once(XU.GAME_READY,this.handleWhenGameReady)}},{key:"showAdByConfig",value:(g=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,3,4,5]);E=g.type,_=g.placementId;return[4,XV.loadAdAsync(E,_)];case 1:C.sent(),i9.muteAudio(!0);return[4,XV.showAdAsync(E,_)];case 2:C.sent();return[3,5];case 3:k=C.sent();console.warn("showAdByConfig failed",k);return[3,5];case 4:Q.resume(),i9.muteAudio(!1);return[7];case 5:return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"showBannerAdsByLayout",value:function(g){var E=Xx.Ads.BannerDisplayAdOptions;g!==rb.Landscape?E.forEach(function(g){var E=g.PlacementId,_=g.Position;"bottom"===_||"top"===_?vy.showBannerAd(E):vy.hideBannerAd(E)}):vy.showBannerAds()}}]),e}();_._RF.pop(),_._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var XW=GameCore.Events,Xj=globalThis.game,XX=Xj.event,XY=Xj.monitorError,XJ=function(){function e(){var g=this;Fe(this,e),this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=function(){if(!g.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void(null==XY||XY.sendException(new Error("Core: Booting callback is not set")));console.info("\uD83D\uDE80 Core: Boot"),g.callbackCoreBooting(),g.callbackCoreBooting=null},this.handleWhenCoreStarting=function(){if(!g.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void(null==XY||XY.sendException(new Error("Core: Starting callback is not set")));console.info("\uD83D\uDE80 Core: Starting"),g.callbackCoreStarting(),g.callbackCoreStarting=null},this.handleWhenCoreReady=function(){if(!g.callbackCoreReady)return console.error("Core: Ready callback is not set"),void(null==XY||XY.sendException(new Error("Core: Ready callback is not set")));console.info("\uD83D\uDE80 Core: Ready"),g.callbackCoreReady(),g.callbackCoreReady=null}}return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Core Manager: Initialized")}},{key:"listenEvents",value:function(){XX.once(XW.CORE_BOOTING,this.handleWhenCoreBooting),XX.once(XW.CORE_STARTING,this.handleWhenCoreStarting),XX.once(XW.CORE_READY,this.handleWhenCoreReady)}},{key:"requestStart",value:function(){XX.emit(XW.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(g){this.callbackCoreBooting=g,XX.getEventEmitCount(XW.CORE_BOOTING)>0&&(XX.off(XW.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}},{key:"onCoreStart",value:function(g){this.callbackCoreStarting=g,XX.getEventEmitCount(XW.CORE_STARTING)>0&&(XX.off(XW.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}},{key:"onCoreReady",value:function(g){this.callbackCoreReady=g,XX.getEventEmitCount(XW.CORE_READY)>0&&(XX.off(XW.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}]),e}();_._RF.pop(),_._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var XQ=GameCore,XZ=XQ.Events,X$=XQ.Configs.GameEngine.DynamicAtlas,X0=XQ.Utils,X1=X0.Valid,X2=X0.Device,X4=globalThis.game.event,X3=function(){function e(){var g=this;Fe(this,e),this.handlePauseEngine=Be(function(){return _ts_generator(this,function(g){console.info("Engine: Paused",Q.isPaused()),Q.isPaused();return[2]})}),this.handleResumeEngine=Be(function(){return _ts_generator(this,function(g){console.info("Engine: Resumed",Q.isPaused()),Q.isPaused();return[2]})}),this.handleResizeView=function(E){eb.instance.resizeWithBrowserSize(!1);var _=E.width,k=E.height;g.resizeView(_,k)},this.handleViewResized=function(g){var E=g.width,_=g.height;eb.instance.resizeWithBrowserSize(!0),console.info("✨ New View Size",{width:E,height:_})}}var g;return Ue(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.setupAssetDownloader(),this.setupOptimalPipelines(),this.setupEngineRunningState(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){Q.on(t3,this.handleResizeView),Q.on(t5,this.handleViewResized)}},{key:"overrideSettings",value:function(){eW.overrideSettings(ej.Category.ENGINE,"debug",X1.isDebugger()),Q.frameRate=X2.isDesktop()?60:48}},{key:"setupAutoAtlas",value:function(){eX.instance.cacheAsset=!0}},{key:"setupAssetDownloader",value:function(){var g=eX.instance.downloader;g.maxConcurrency=10,g.maxRequestsPerFrame=6}},{key:"getPipelineFlows",value:function(){var g,E;return null!==(g=null===(E=N.root)||void 0===E||null===(E=E.pipeline)||void 0===E?void 0:E.flows)&&void 0!==g?g:[]}},{key:"getRenderQueues",value:function(g){var E=this.getPipelineFlows()[0];return null!=E&&E.stages?E.stages[g].renderQueues:[]}},{key:"setupOptimalPipelines",value:(g=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:eX.instance.transformPipeline.remove(1);return[4,X1.isValueChangeAsync(function(){return!!N.root},!0,{timeout:1e4})];case 1:_.sent();g=this.getPipelineFlows();g.shift(),g.shift();E=this.getRenderQueues(0);E.shift(),E.shift();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"setupEngineRunningState",value:function(){var g=this;eY.on(ep.EventType.TOUCH_START,this.handleResumeEngine),X4.once(XZ.GAME_READY,function(){X4.on(XZ.VISIBILITY_HIDDEN,g.handlePauseEngine),X4.on(XZ.VISIBILITY_VISIBLE,g.handleResumeEngine)})}},{key:"setupDynamicAtlas",value:function(){switch(ev.os){case ev.OS.IOS:this.setupDynamicAtlasForIOS();break;case ev.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(g){var E=g.Enabled,_=g.AutoAtlasSize,k=g.MaxAtlasCount,C=g.MaxAtlasSize,A=g.MaxFrameSize;if(eJ.CLEANUP_IMAGE_CACHE=!1,eQ.instance.enabled=E,eQ.instance.textureSize=C,eQ.instance.maxFrameSize=A,eQ.instance.maxAtlasCount=k,eQ.instance.textureBleeding=!0,_){var T=this.getMaxTextureSize();if(!T)return;eQ.instance.maxAtlasCount=1,eQ.instance.textureSize=T}}},{key:"getMaxTextureSize",value:function(){if(!N.root)return -1;var g=N.root.device.capabilities.maxTextureSize,E=1024;return g-E<=eQ.instance.maxFrameSize?-1:g>8192?7168:g-E}},{key:"setupDynamicAtlasForIOS",value:function(){var g=X$.IOS;this.setDynamicAtlas(g)}},{key:"setupDynamicAtlasForAndroid",value:function(){var g=X$.Android;this.setDynamicAtlas(g)}},{key:"setupDynamicAtlasForDesktop",value:function(){var g=X$.Desktop;this.setDynamicAtlas(g)}},{key:"setupBatcherLimit",value:function(){eJ.BATCHER2D_MEM_INCREMENT=288,eJ.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(g,E){var _,k=window.devicePixelRatio,C=k>=2?2/k:1,A=g*k*C,T=E*k*C;null===(_=N.root)||void 0===_||_.resize(A,T),j.windowSize=new X.Size(A,T),N.once(e_.EVENT_AFTER_UPDATE,function(){Q.emit(t5,{width:A,height:T})})}}]),e}();_._RF.pop();var X5,X6=new(function(){function e(){Fe(this,e),this._registry={},this._moduleCache={}}return Ue(e,[{key:"define",value:function(g,E,_){this._registry[g]={factory:E,resolveMap:_}}},{key:"require",value:function(g){return this._require(g)}},{key:"throwInvalidWrapper",value:function(g,E){throw new Error("Module '".concat(g,"' imported from '").concat(E,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(g,E){var _=this._moduleCache[g];if(_)return _.exports;var k={id:g,exports:{}};return this._moduleCache[g]=k,this._tryModuleLoad(k,g),k.exports}},{key:"_resolve",value:function(g,E){return this._resolveFromInfos(g,E)||this._throwUnresolved(g,E)}},{key:"_resolveFromInfos",value:function(g,E){var _,k;return g in cjsInfos?g:E&&null!==(_=null===(k=cjsInfos[E])||void 0===k?void 0:k.resolveCache[g])&&void 0!==_?_:void 0}},{key:"_tryModuleLoad",value:function(g,E){var _=!0;try{this._load(g,E),_=!1}finally{_&&delete this._moduleCache[E]}}},{key:"_load",value:function(g,E){var _=this._loadWrapper(E),k=_.factory,C=_.resolveMap,A=this._createRequire(g),T=C?this._createRequireWithResolveMap("function"==typeof C?C():C,A):A;k(g.exports,T,g)}},{key:"_loadWrapper",value:function(g){return g in this._registry?this._registry[g]:this._loadHostProvidedModules(g)}},{key:"_loadHostProvidedModules",value:function(g){return{factory:function(E,_,k){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(g,"'."));try{k.exports=require(g)}catch(E){throw new Error("Exception thrown when calling host defined require('".concat(g,"')."),{cause:E})}}}}},{key:"_createRequire",value:function(g){var E=this;return function(_){return E._require(_,g)}}},{key:"_createRequireWithResolveMap",value:function(g,E){return function(_){var k=g[_];if(k)return E(k);throw new Error("Unresolved specifier "+_)}}},{key:"_throwUnresolved",value:function(g,E){throw new Error("Unable to resolve ".concat(g," from ").concat(parent,"."))}}]),e}());function d3(g){return(d3="function"==typeof Symbol&&"symbol"==_type_of(Symbol.iterator)?function(g){return void 0===g?"undefined":_type_of(g)}:function(g){return g&&"function"==typeof Symbol&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":void 0===g?"undefined":_type_of(g)})(g)}var X8="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";X6.define(X8,function(g,E,_,k,C){(function(E,k){"object"===d3(g)&&void 0!==_?_.exports=k():"function"==typeof define&&define.amd?define(k):E.ResizeObserver=k()})(this,function(){var g=function(){if("undefined"!=typeof Map)return Map;function e(g,E){var _=-1;return g.some(function(g,k){return g[0]===E&&(_=k,!0)}),_}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(g){var E=e(this.__entries__,g),_=this.__entries__[E];return _&&_[1]},t.prototype.set=function(g,E){var _=e(this.__entries__,g);~_?this.__entries__[_][1]=E:this.__entries__.push([g,E])},t.prototype.delete=function(g){var E=this.__entries__,_=e(E,g);~_&&E.splice(_,1)},t.prototype.has=function(g){return!!~e(this.__entries__,g)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(g,E){void 0===E&&(E=null);for(var _=0,k=this.__entries__;_<k.length;_++){var C=k[_];g.call(E,C[1],C[0])}},t}()}(),E="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,_="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),k="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(_):function(g){return setTimeout(function(){return g(Date.now())},1e3/60)};var C=["top","right","bottom","left","width","height","size","weight"],A="undefined"!=typeof MutationObserver,T=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(g,E){var _=!1,C=!1,A=0;function r(){_&&(_=!1,g()),C&&l()}function s(){k(r)}function l(){var g=Date.now();if(_){if(g-A<2)return;C=!0}else _=!0,C=!1,setTimeout(s,E);A=g}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(g){~this.observers_.indexOf(g)||this.observers_.push(g),this.connected_||this.connect_()},e.prototype.removeObserver=function(g){var E=this.observers_,_=E.indexOf(g);~_&&E.splice(_,1),!E.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var g=this.observers_.filter(function(g){return g.gatherActive(),g.hasActive()});return g.forEach(function(g){return g.broadcastActive()}),g.length>0},e.prototype.connect_=function(){E&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),A?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){E&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(g){var E=g.propertyName,_=void 0===E?"":E;C.some(function(g){return!!~_.indexOf(g)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(g,E){for(var _=0,k=Object.keys(E);_<k.length;_++){var C=k[_];Object.defineProperty(g,C,{value:E[C],enumerable:!1,writable:!1,configurable:!0})}return g},l=function(g){return g&&g.ownerDocument&&g.ownerDocument.defaultView||_},R=f(0,0,0,0);function c(g){return parseFloat(g)||0}function h(g){for(var E=[],_=1;_<arguments.length;_++)E[_-1]=arguments[_];return E.reduce(function(E,_){return E+c(g["border-"+_+"-width"])},0)}function d(g){var E=g.clientWidth,_=g.clientHeight;if(!E&&!_)return R;var k=l(g).getComputedStyle(g),C=function(g){for(var E={},_=0,k=["top","right","bottom","left"];_<k.length;_++){var C=k[_],A=g["padding-"+C];E[C]=c(A)}return E}(k),A=C.left+C.right,T=C.top+C.bottom,I=c(k.width),P=c(k.height);if("border-box"===k.boxSizing&&(Math.round(I+A)!==E&&(I-=h(k,"left","right")+A),Math.round(P+T)!==_&&(P-=h(k,"top","bottom")+T)),!function(g){return g===l(g).document.documentElement}(g)){var L=Math.round(I+A)-E,O=Math.round(P+T)-_;1!==Math.abs(L)&&(I-=L),1!==Math.abs(O)&&(P-=O)}return f(C.left,C.top,I,P)}var I="undefined"!=typeof SVGGraphicsElement?function(g){return _instanceof(g,l(g).SVGGraphicsElement)}:function(g){return _instanceof(g,l(g).SVGElement)&&"function"==typeof g.getBBox};function y(g){return E?I(g)?function(g){var E=g.getBBox();return f(0,0,E.width,E.height)}(g):d(g):R}function f(g,E,_,k){return{x:g,y:E,width:_,height:k}}var P=function(){function e(g){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=f(0,0,0,0),this.target=g}return e.prototype.isActive=function(){var g=y(this.target);return this.contentRect_=g,g.width!==this.broadcastWidth||g.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var g=this.contentRect_;return this.broadcastWidth=g.width,this.broadcastHeight=g.height,g},e}(),m=function(g,E){var _,k,C,A,T,R,I,P=(k=(_=E).x,C=_.y,A=_.width,T=_.height,R="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,I=Object.create(R.prototype),s(I,{x:k,y:C,width:A,height:T,top:C,right:k+A,bottom:T+C,left:k}),I);s(this,{target:g,contentRect:P})},L=function(){function t(E,_,k){if(this.activeObservations_=[],this.observations_=new g,"function"!=typeof E)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=E,this.controller_=_,this.callbackCtx_=k}return t.prototype.observe=function(g){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(g,l(g).Element))throw new TypeError('parameter 1 is not of type "Element".');var E=this.observations_;E.has(g)||(E.set(g,new P(g)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(g){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(g,l(g).Element))throw new TypeError('parameter 1 is not of type "Element".');var E=this.observations_;E.has(g)&&(E.delete(g),E.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var g=this;this.clearActive(),this.observations_.forEach(function(E){E.isActive()&&g.activeObservations_.push(E)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var g=this.callbackCtx_,E=this.activeObservations_.map(function(g){return new m(g.target,g.broadcastRect())});this.callback_.call(g,E,g),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),O="undefined"!=typeof WeakMap?new WeakMap:new g,S=function e(g){if(!_instanceof(this,e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var E=T.getInstance(),_=new L(g,E,this);O.set(this,_)};return["observe","unobserve","disconnect"].forEach(function(g){S.prototype[g]=function(){var E;return(E=O.get(this))[g].apply(E,arguments)}}),void 0!==_.ResizeObserver?_.ResizeObserver:S}),X5=_.exports},{}),X6.require(X8),_._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var X9=rb,X7=rw,Yt=X7.Portrait,Yn=X7.Landscape,Yi=GameCore,Yr=Yi.Utils.Function,Ya=Yi.Configs.GameEngine,Yo=Ya.AutoResizeCanvas,Ys=Ya.AutoChangeOrientation,Yl=function(){function e(){var g=this;Fe(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(E){console.info("\uD83D\uDCF1 View resize by system"),window.devicePixelRatio=E||window.devicePixelRatio,g.setupOrientationByScreenSize(),g.resizeGameView()},this.handleViewResize=Yr.debounce(function(){console.info("\uD83D\uDCF1 View resize by window"),g.setupOrientationByScreenSize(),g.resizeGameView()},200),this.handleBodyResize=Yr.debounce(function(){g.resizeGameDiv()&&(console.info("\uD83D\uDCF1 View resize by body"),g.setupOrientationByScreenSize(),g.resizeGameView())},200)}return Ue(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){Yo&&(j.on("window-resize",this.handleViewResize,this),j.on("orientation-change",this.handleViewResize,this)),Q.on(t6,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){Yo&&new X5(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){Ys&&(eb.instance.resizeWithBrowserSize(!0),eb.instance.setOrientation(eJ.ORIENTATION_AUTO),eb.instance.setResolutionPolicy(eZ.ContentStrategy.FIXED_WIDTH),eb.instance.setResolutionPolicy(eZ.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=eb.instance.getResolutionPolicy())}},{key:"setupOrientationByScreenSize",value:function(){if(Ys){var g=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(eZ.ContentStrategy.FIXED_WIDTH),g<1?this.setPortraitView():this.setLandscapeView()}}},{key:"resizeGameDiv",value:function(){var g=document.getElementById("GameDiv");if(!g)return!1;var E=nl.getScreenWidthCss(),_=nl.getScreenHeightCss(),k=g.getBoundingClientRect(),C=k.width,A=k.height;return(E!==C||_!==A)&&(g.style.width="".concat(E,"px"),g.style.height="".concat(_,"px"),!0)}},{key:"resizeGameView",value:function(){var g=nl.getScreenWidthCss(),E=nl.getScreenHeightCss();Q.emit(t3,{width:g,height:E})}},{key:"setPortraitView",value:function(){var g=Yt.WIDTH,E=Yt.HEIGHT;this.currentLayout=X9.Portrait,this.changeDesignResolutionSize(g,E)}},{key:"setLandscapeView",value:function(){var g=Yn.WIDTH,E=Yn.HEIGHT;this.currentLayout=X9.Landscape,this.changeDesignResolutionSize(g,E)}},{key:"changeDesignResolutionSize",value:function(g,E){eb.instance.setDesignResolutionSize(g,E,this.resolutionPolicy),Q.emit(t8,this.currentLayout),console.info("\uD83D\uDCF1 Change layout to",this.currentLayout)}},{key:"getScreenRatio",value:function(){return nl.getScreenWidthCss()/nl.getScreenHeightCss()}}]),e}();_._RF.pop(),_._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var Yu=GameCore,Yc=Yu.Utils,Yp=Yc.Valid,Yd=Yc.Object,Yf=Yc.Array,Yy=Yu.Dtos.Match,Yv=Yy.CustomData,Yg=Yy.Data,Ym=["code","cols","encoding","idSize","rows"],Yb=["addRandomTilesPerMove","maxSpaceOfPair"],Yw=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function(){Yv.addDefaultData(sQ),Yv.addValidateFunction("score",function(g){if(!Yp.isNumber(g)||g<0)throw new Error("score ".concat(g," is invalid"))})}},{key:"setupMatchData",value:function(){var g=this;Yg.addDefaultData(sV),Yg.addValidateFunction("extraData",function(E){if(null!=E){if(!Yp.isObject(E))throw new Error("extraData ".concat(E," must be a record of string keys"));var _=E,k=Object.keys(_);if(!Yf.has(k,"level"))throw new Error("extraData.level is missing");if(!Yp.isNumber(_.level))throw new Error("extraData.level ".concat(_.level," must be a number"));if(!Yf.has(k,"fen"))throw new Error("extraData.fen is missing");if(g.validateFen(_.fen),!Yf.has(k,"gravity"))throw new Error("extraData.gravity is missing");if(!Yp.isString(_.gravity))throw new Error("extraData.gravity ".concat(_.gravity," must be a string"));if(!Yf.has(k,"rules"))throw new Error("extraData.rules is missing");if(g.validateLevelRules(_.rules),!Yf.has(k,"time"))throw new Error("extraData.time is missing");if(!Yp.isNumber(_.time))throw new Error("extraData.time ".concat(_.time," must be a number"))}})}},{key:"validateFen",value:function(g){if(!Yp.isObject(g))throw new Error("extraData.fen ".concat(g," must be a record of string keys"));var E=this.validateKeys(g,Ym);if(!Yp.isNumber(E.idSize))throw new Error("fen.idSize must be a number");if(!Yp.isString(E.code))throw new Error("fen.code must be a string");if(!Yp.isNumber(E.rows))throw new Error("fen.rows must be a number");if(!Yp.isNumber(E.cols))throw new Error("fen.cols must be a number");if(!Yp.isObject(E.encoding))throw new Error("fen.encoding must be a record of string keys");var _=this.validateKeys(E.encoding,Yd.vals(uX));Object.entries(_).forEach(function(g){var E=et(g,2),_=E[0],k=E[1];if(!Yp.isString(k))throw new Error("fen.encoding.".concat(_," ").concat(k," must be a string"))})}},{key:"validateLevelRules",value:function(g){if(!Yp.isObject(g))throw new Error("extraData.rules ".concat(g," must be a record of string keys"));var E=this.validateKeys(g,Yb);if(!Yp.isNumber(E.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!Yp.isNumber(E.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function(g,E){return Object.keys(g).forEach(function(g){if(!Yf.has(E,g))throw new Error("Key ".concat(g," is missing"))}),g}}]),e}();_._RF.pop(),_._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var YS=GameCore,YE=YS.Utils,Y_=YE.Valid,Yk=YE.Array,YC=YE.Object,YA=YS.Dtos,YT=globalThis.game.player,YR=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var g=YA.Player;g.Data.addDefaultData(sZ),g.GameData.addDefaultData(sW),g.GameData.addValidateFunction("stars",function(g){if(!Y_.isNumber(g)||g<0)throw new Error("stars ".concat(g," is invalid"))}),g.GameData.addValidateFunction("totalLevel",function(g){if(!Y_.isNumber(g)||g<1)throw new Error("totalLevel ".concat(g," is invalid"))}),g.GameData.addValidateFunction("levelVersion",function(g){if(!Y_.isNumber(g)||g<0)throw new Error("levelVersion ".concat(g," is invalid"))}),g.GameData.addValidateFunction("lastRewardedItems",function(g){if(!Y_.isNumber(g)||g<0)throw new Error("lastRewardedItems ".concat(g," is invalid"))}),g.GameData.addValidateFunction("lastCreateTournamentShown",function(g){if(!Y_.isNumber(g)||g<0)throw new Error("lastCreateTournamentShown ".concat(g," is invalid"))}),g.GameData.addValidateFunction("guideItemShowed",function(g){if(!Array.isArray(g))throw new Error("guideItemShowed ".concat(g," is invalid"))}),g.GameData.addValidateFunction("items",function(g){if(!Y_.isObject(g))throw new Error("items ".concat(g," is invalid"));var E=Object.keys(g),_=YC.vals(g);if(!Yk.has(E,sN.HINT))throw new Error("item ".concat(sN.HINT," not found"));if(!Yk.has(E,sN.THUNDER))throw new Error("item ".concat(sN.THUNDER," not found"));if(!Yk.has(E,sN.STORM))throw new Error("item ".concat(sN.STORM," not found"));if(!Yk.has(E,sN.PLIERS))throw new Error("item ".concat(sN.PLIERS," not found"));_.forEach(function(g){if(!Y_.isNumber(g)||g<0)throw new Error("item ".concat(g," is invalid"))})}),g.GameData.addValidateFunction("skins",function(g){if(!Y_.isObject(g))throw new Error("skins ".concat(g," is invalid"))})}},{key:"requestConnectedPlayers",value:function(){YT.requestConnectedPlayers().catch(function(g){console.warn("player.requestConnectedPlayers",g)})}}]),e}();_._RF.pop(),_._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var YI=GameCore,YP=YI.Events,YL=YI.Utils.Valid,YO=globalThis.game,YB=YO.event,YN=YO.adaptivePerformance,YM=function(){function e(){var g=this;Fe(this,e),this.handleBeginFrame=function(){N.on(e_.EVENT_AFTER_UPDATE,g.lateUpdate),N.on(e_.EVENT_BEFORE_UPDATE,g.updateActualFPS)},this.handleAfterSceneLaunch=function(g){YN&&YN.trackingScene(g.name)},this.handleRequestResizeGame=function(g){var E=g.forcePixelRatio;YL.isNumber(E)&&Q.emit(t6,E)},this.lateUpdate=function(){var g=1e3*Q.deltaTime;null==YN||YN.updatePostStepDeltaTime(g)},this.updateActualFPS=function(){var g,E=null===(g=N.root)||void 0===g?void 0:g.fps;YL.isNumber(E)&&(null==YN||YN.updateActualFPS(E))}}return Ue(e,[{key:"init",value:function(){YN&&this.listenEvents()}},{key:"listenEvents",value:function(){YB.on(YP.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),N.once(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.on(e_.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();_._RF.pop(),_._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var YD=globalThis.game.canvasRecorder,YF=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){if(Q.canvas&&YD){YD.setCanvas(Q.canvas);var g=YD.getOptions(),E=YD.waitNextFrame;YD.waitNextFrame=Be(function(){var _;return _ts_generator(this,function(k){switch(k.label){case 0:if(!g.syncFps)return[3,1];_=new Promise(function(g){N.once(e_.EVENT_AFTER_RENDER,g),Q.pause(),Q.step()});return[3,3];case 1:Q.resume();return[4,E.call(YD)];case 2:_=(k.sent(),Promise.resolve());k.label=3;case 3:return[2,_]}})})}}}]),e}();_._RF.pop(),_._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var YU=function(){function e(){var g=this;Fe(this,e),this.hideCocosStats=function(){clearInterval(g.waiter),g.waiter=setInterval(g.checkProfilerReady,100)},this.checkProfilerReady=function(){if(ey){ey._showFPS=!1;var E=ey._rootNode;E&&(E.active=!1,E.isValid&&(E.destroyAllChildren(),E.removeAllChildren(),E.destroy(),clearInterval(g.waiter)))}}}return Ue(e,[{key:"init",value:function(){ey&&N.on(e_.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();_._RF.pop(),_._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var Yx=GameCore,Yz=Yx.Configs.GameEngine.DynamicAssets,YG=Yx.Events,YV=Yx.Utils.Array,YK=globalThis.game,YH=YK.event,Yq=YK.storage,YW=[".png",".jpg",".jpeg",".webp"],Yj=function(){function e(){var g=this;Fe(this,e),this.isProcessing=!1,this.useHighQuality=!1,this.upgradableAssets=new Map,this.handleSceneLaunched=function(g){var E=g.sceneName,_=[s$];YV.has(_,E)||Q.emit(no,{quality:"highest"})},this.requestUpdateDynamicAssets=function(){Q.emit(nr,{force:!0})},this.collectUpgradableAssets=function(E){var _,k=E.output=E.input,C=Yz.Resolution,A=C.Adjust,T=C.Original,R=at(k);try{for(R.s();!(_=R.n()).done;){var I=_.value;if(YV.has(YW,I.ext)&&!g.upgradableAssets.has(I.uuid)){g.useHighQuality?(I.url=g.replaceAssetUrl(I.url),I.resolution=T,I.upgradeOnNextRequest=!0):A<T&&(I.resolution=A);var P={ext:I.ext,url:I.url,uuid:I.uuid,options:I.options,upgraded:I.upgraded,resolution:I.resolution,upgradeOnNextRequest:I.upgradeOnNextRequest};g.upgradableAssets.set(I.uuid,P)}}}catch(g){R.e(g)}finally{R.f()}},this.replaceAssetUrl=function(E){return g.useHighQuality?E.replace("native/","native32/"):E},this.handleChangeQuality=Be(function(){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:g.isProcessing=!0;_=[],k=at(g.upgradableAssets.values());try{for(k.s();!(E=k.n()).done;){C=E.value,A=g.processUpgradeQualityAsync(C);_.push(A)}}catch(g){k.e(g)}finally{k.f()}return[4,Promise.all(_)];case 1:T=I.sent();g.isProcessing=!1;R=T.filter(function(g){return g}).length;g.requestUpdateDynamicAssets(),console.warn("DynamicAssets: Upgradable Assets Info",{total:R,results:T});return[2]}})})}var g;return Ue(e,[{key:"init",value:function(){var g=Yz.Enabled,E=Yz.Resolution;console.info("DynamicAssets: init",{EDITOR:ty,Enabled:g}),g&&(eX.instance.transformPipeline.insert(this.collectUpgradableAssets,2),this.initState(),this.listenEvents(),window.requestIdleCallback=window.requestIdleCallback||function(g){g()},E.Adjust,E.Original)}},{key:"initState",value:function(){var g=globalThis.game.getBuildVersion().toString();Yq.addStorage("DynamicAssets",{useHighQuality:!1,buildVersion:"0"},!0);var E=Yq.getStorage("DynamicAssets"),_=null!=E?E:{},k=_.buildVersion,C=_.useHighQuality;"boolean"==typeof C&&(this.useHighQuality=C&&k===g),Yq.setStorageData("DynamicAssets","buildVersion",g)}},{key:"listenEvents",value:function(){var g=this;Q.on(no,this.handleChangeQuality),setTimeout(function(){g.useHighQuality=!0,g.autoUpgradeQuality(),YH.on(YG.SCENE_LAUNCHED,g.handleSceneLaunched)},4e3)}},{key:"autoUpgradeQuality",value:function(){var g=this;requestIdleCallback(Be(function(){var E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(!g.isProcessing&&!Q.isPaused()))return[3,2];E=tt(g.upgradableAssets.values()).find(function(g){return!g.upgraded&&!g.upgradeOnNextRequest});if(!E)return[2,(Yq.setStorageData("DynamicAssets","useHighQuality",!0),void g.requestUpdateDynamicAssets())];console.info("DynamicAssets: Auto upgrade quality",E),g.isProcessing=!0;return[4,g.processUpgradeQualityAsync(E)];case 1:_.sent(),g.isProcessing=!1,g.autoUpgradeQuality();_.label=2;case 2:return[2]}})}),{timeout:1e3})}},{key:"processUpgradeQualityAsync",value:(g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){E=this;if(g.upgraded||g.upgradeOnNextRequest)return[2,!0];_=eX.instance,k=_.assets,C=_.loadAny,A=k.get(g.uuid);return[2,_instanceof(A,er)?(g.url=this.replaceAssetUrl(g.url),new Promise(function(_){C(g,g.options,function(k,C){if(k)return console.warn("DynamicAssets: Upgrade error",k),void _(!1);A.reset(C),g.upgraded=!0,E.upgradableAssets.set(g.uuid,g),Q.emit(na,{asset:A,item:g}),_(!0)})})):(console.warn("DynamicAssets: Asset not found",g.uuid),!1)]})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var YX=GameCore,YY=YX.Events,YJ=YX.Configs.GameEngine.DynamicAtlas,YQ=YJ.UsePowerOfTwo,YZ=YJ.TextureAtlasOptimize,Y$=YX.Utils,Y0=Y$.Array,Y1=Y$.Json,Y2=Y$.Object,Y4=Y$.Function,Y3=globalThis.game.event,Y5=function(){function e(){var g=this;Fe(this,e),this.atlasTexId=null,this.drawInfo=[],this.atlasInfo=null,this.lastAtlasInfo=null,this.renderTimes=[],this.lastRenderTime=0,this.renderTimeInterval=5e3,this.isEffective=!0,this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1,this.collectInfo={},this.pendingSprites={},this.checkRenderTimeHighers=function(){var E=g.getMeanRenderTime();E>8&&g.handleLaggyFrame(E),N.once(e_.EVENT_AFTER_RENDER,function(){setTimeout(g.checkRenderTimeHighers,g.renderTimeInterval)})},this.resetPendingSprites=function(){g.pendingSprites={}},this.updateBeforeRenderTime=function(){g.lastRenderTime=performance.now()},this.updateAfterRenderTime=function(){g.renderTimes.push(performance.now()-g.lastRenderTime)},this.requestUpdateDynamicAtlas=Y4.throttle(function(E){g.isProcessing||(g.isProcessing=!0,g.forceUpdateDynamicAtlas=(null==E?void 0:E.force)||!1,N.once(e_.EVENT_AFTER_RENDER,g.updateDynamicAtlas))},5e3),this.updateDynamicAtlas=function(){try{var E=N.getScene();if(!E)return;var _=g.collectPackageInfo();if(Object.keys(_).length<1)return;if(g.drawInfo=[],g.atlasInfo=null,g.generateDrawInfo(Y2.vals(_)),!g.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found");if(!g.updateAtlasData()&&!g.forceUpdateDynamicAtlas)return;var k=E.getComponentsInChildren(e0);g.refreshComponents(k)}catch(g){console.error("DynamicAtlas: Error updating dynamic atlas",g)}finally{g.isProcessing=!1,g.forceUpdateDynamicAtlas=!1}},this.generateDrawInfo=function(E){if(!(E.length<1)){console.info("DynamicAtlas: generate draw info",E);var _=E.sort(function(g,E){return E.usageCount-g.usageCount}),k=eQ.instance.textureSize;if(g.calculateOptimizedAtlas(_,k),g.atlasInfo){var C,A=g.atlasInfo.textures,T=at(A);try{for(T.s();!(C=T.n()).done;){var R=C.value;g.drawInfo.push(R)}}catch(g){T.e(g)}finally{T.f()}var I=_.filter(function(g){return!A.some(function(E){return E.id===g.id})});I.length>0&&(console.warn("DynamicAtlas: Missing textures",I),g.generateDrawInfo(I))}else console.warn("DynamicAtlas: Atlas info not found",{textures:_})}},this.calculateOptimizedAtlas=function(E,_){var k=function(g){var E,_=0,k=0,C=at(g);try{for(C.s();!(E=C.n()).done;){var A=E.value;_+=A.w*A.h,k=Math.max(k,A.w)}}catch(g){C.e(g)}finally{C.f()}g.sort(function(g,E){return E.h-g.h});var T,R=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(_/.95)),k),h:1/0}],I=0,P=0,L=at(g);try{for(L.s();!(T=L.n()).done;)for(var O=T.value,B=R.length-1;B>=0;B--){var N=R[B];if(!(O.w>N.w||O.h>N.h)){if(O.x=N.x,O.y=N.y,P=Math.max(P,O.y+O.h),I=Math.max(I,O.x+O.w),O.w===N.w&&O.h===N.h){var M=R.pop();B<R.length&&(R[B]=M)}else O.h===N.h?(N.x+=O.w,N.w-=O.w):O.w===N.w?(N.y+=O.h,N.h-=O.h):(R.push({x:N.x+O.w,y:N.y,w:N.w-O.w,h:O.h}),N.y+=O.h,N.h-=O.h);break}}}catch(g){L.e(g)}finally{L.f()}return{w:I,h:P,fill:_/(I*P)||0}}(E),C=k.w,A=k.h,T=k.fill;if(T<.6)console.warn("DynamicAtlas: Fill rate is too low",T,tt(E));else{if(C>_||A>_)return console.warn("DynamicAtlas: Packed size is bigger than atlas size",C,A,_),void(E.pop()?g.calculateOptimizedAtlas(E,_):console.warn("DynamicAtlas: Texture size is too big",C,A,_));g.atlasInfo={textures:E,atlasSize:_,packedInfo:{width:Math.round(C),height:Math.round(A),fillRate:T}}}},this.drawTexture=function(E,_,k){var C=_.texture,A=C.image;if(!A||A.width<1||A.height<1)console.warn("DynamicAtlas: Texture image not found",C);else if(!A.data||A.data.width<1||A.data.height<1)console.warn("DynamicAtlas: Texture image data not found",A);else{var T=C.getId(),R=Y0.search(tt(g.drawInfo),function(g){return g.id===T})||{x:-1,y:-1},I=R.x,P=R.y;if(!(I<0||P<0)){var L=E._innerTextureInfos[T];L||(k&&(E._texture.drawTextureAt(A,I-1,P),E._texture.drawTextureAt(A,I+1,P),E._texture.drawTextureAt(A,I,P-1),E._texture.drawTextureAt(A,I,P+1)),E._texture.drawTextureAt(A,I,P),E._count++,E._innerTextureInfos[T]={texture:C,x:I,y:P});var O=_.rect,B=O.x,N=O.y;B+=(null==L?void 0:L.x)||I,N+=(null==L?void 0:L.y)||P;var M={texture:E._texture,x:B,y:N};return E._innerSpriteFrames.push(_),M}g.pendingSprites[_.uuid]=_}},this.refreshComponents=function(g){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.node.active&&(k.node.active=!1,k.node.active=!0)}}catch(g){_.e(g)}finally{_.f()}},this.isSameAtlas=function(g,E){if(!g||!E)return!1;var _=g.packedInfo,k=g.textures,C=E.packedInfo,A=E.textures;return _.width===C.width&&_.height===C.height&&k.length===A.length&&k.every(function(g,E){var _=g.id,k=g.w,C=g.h,T=A[E],R=T.id,I=T.w,P=T.h;return _===R&&k===I&&C===P})}}return Ue(e,[{key:"init",value:function(){YZ&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:YZ}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){var g=this;Q.on(nr,this.requestUpdateDynamicAtlas),N.on(e_.EVENT_BEFORE_SCENE_LAUNCH,this.resetPendingSprites),Y3.once(YY.GAME_READY,function(){g.setupRenderListeners()})}},{key:"setupRenderListeners",value:function(){var g=this;N.on(e_.EVENT_BEFORE_RENDER,this.updateBeforeRenderTime),N.on(e_.EVENT_AFTER_RENDER,this.updateAfterRenderTime),Y3.once(YY.SCENE_LAUNCHED,function(){N.once(e_.EVENT_AFTER_RENDER,g.checkRenderTimeHighers)})}},{key:"handleLaggyFrame",value:function(g){console.warn("DynamicAtlas: Laggy frame detected, render time: ".concat(g.toFixed(2),"ms")),this.isEffective||(this.renderTimeInterval=Math.min(this.renderTimeInterval+1e3,1e4),console.warn("DynamicAtlas: Atlas update not effective. Increased interval: ".concat(this.renderTimeInterval,"ms"))),this.requestUpdateDynamicAtlas()}},{key:"getMeanRenderTime",value:function(){var g,E=0,_=at(this.renderTimes);try{for(_.s();!(g=_.n()).done;)E+=g.value}catch(g){_.e(g)}finally{_.f()}return E/=this.renderTimes.length,this.renderTimes=[],E}},{key:"overrideDynamicAtlas",value:function(){var g=this,E=eQ.instance;eQ.instance.insertSpriteFrame=function(_){if(E._atlasIndex>=E._maxAtlasCount)return null;if(!_||_.original)return console.warn("DynamicAtlas: Skip original texture",_),null;if(!_.packable)return console.warn("DynamicAtlas: Skip non-packable texture",_),null;var k=g.getAtlas(),C=k?k.insertSpriteFrame(_):null;return!C&&E._atlasIndex<E._maxAtlasCount&&(C=(k=g.getAtlas())?k.insertSpriteFrame(_):null),C}}},{key:"createAtlas",value:function(){return eQ.instance.newAtlas()}},{key:"getAtlas",value:function(){var g=this,E=eQ.instance,_=E._atlases,k=void 0===_?[]:_,C=E._atlasIndex,A=E.textureBleeding,T=k[C];return T||(T=this.createAtlas()),T?(T.originalInsertSpriteFrame||(T.originalInsertSpriteFrame=T.insertSpriteFrame,T.insertSpriteFrame=function(E){return g.drawTexture(T,E,A)}),this.atlasTexId=T._texture.getId(),T):null}},{key:"collectPackageInfo",value:function(){var g,E={},_=at(Y2.vals(this.pendingSprites));try{for(_.s();!(g=_.n()).done;){var k=g.value;if(this.isValidSpriteFrame(k)){var C=k.texture,A=k.original,T=C.getId(),R=null==A?void 0:A._texture.getId();T!==R?(R&&(T=R),this.collectInfo[T]||this.initializeCollectInfo(T,k),this.collectInfo[T].usageCount++,E[T]=this.collectInfo[T]):console.warn("DynamicAtlas: Skip original texture",{texId:T,oriTexId:R})}}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"isValidSpriteFrame",value:function(g){var E=g.packable,_=g.texture,k=g.original,C=g.name,A=g.uuid;if(!E)return console.warn("DynamicAtlas: Skip non-packable texture",C,A),!1;if(!_instanceof(_,e$))return console.warn("DynamicAtlas: Skip non-texture2d texture",C,A),!1;var T=null==k?void 0:k._texture.getId();return this.atlasTexId!==T||(console.warn("DynamicAtlas: Skip texture in atlas",C,A),!1)}},{key:"initializeCollectInfo",value:function(g,E){var _=E.texture,k=E.original,C=E.uuid,A=_.width,T=_.height,R=(null==k?void 0:k._texture)||{width:0,height:0},I=R.width,P=R.height,L=Math.max(A,I)+2,O=Math.max(T,P)+2;L<=1||O<=1?console.warn("DynamicAtlas: Skip invalid texture size",C,{w:L,h:O}):this.collectInfo[g]={id:g,w:L,h:O,x:-1,y:-1,usageCount:0,name:C}}},{key:"updateAtlasData",value:function(){if(!this.atlasInfo)return!1;if(this.lastAtlasInfo&&!this.forceUpdateDynamicAtlas){var g=this.isSameAtlas(this.lastAtlasInfo,this.atlasInfo);if(this.isEffective=!g,g)return console.warn("DynamicAtlas: Last update dynamic atlas is not effective"),!1}console.info("DynamicAtlas: atlas info",this.atlasInfo);var E=this.getAtlas();if(!E||!E._texture)return!1;var _=this.atlasInfo.packedInfo,k=E._texture,C=k.width,A=k.height,T=_.width+20,R=_.height+20,I=Math.max(T,R),P=YQ?I:T;return(C!==P||A!==P)&&(eQ.instance.reset(),!(!(E=this.getAtlas())||!E._texture)&&(YQ?(E._texture.initWithSize(P,P),console.info("DynamicAtlas: Resize atlas (PO2)",P,E)):(E._texture.initWithSize(T,R),console.info("DynamicAtlas: Resize atlas",T,R,E)),this.lastAtlasInfo=Y1.clone(this.atlasInfo),!0))}}]),e}();_._RF.pop();var Y6={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};_._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var Y8=GameCore.Events,Y9=globalThis.game,Y7=Y9.event,Jt=Y9.language,Jn=function(){function e(){var g=this;Fe(this,e),this.handleLanguageChanged=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){_=E.locale;Q.emit("update-language",_),g.updateComponentInEditor();return[2]})});return function(g){return E.apply(this,arguments)}}()}var g,_,k;return Ue(e,[{key:"init",value:function(){var g=this;this.addLanguage("en").then(function(){g.setLanguage("en"),g.listenEvent()})}},{key:"listenEvent",value:function(){Y7.on(Y8.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,this.getLangData(g)];case 1:E=_.sent();Jt.add(g,E);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setLanguage",value:function(g){Jt.choose(g)}},{key:"getLangData",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(g){case"en":return[2,Y6];case"ru":return[2,this.loadLanguageAsync(g)];default:throw new Error("Language ".concat(g," not supported"))}return[2]})}),function(g){return _.apply(this,arguments)})},{key:"loadLanguageAsync",value:(g=Be(function(g){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,E.import("db://assets/resources/locales/".concat(g,".json"))];case 1:_=k.sent().default;Jt.add(g,_);return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"updateComponentInEditor",value:function(){}}]),e}();_._RF.pop(),_._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var Ji=GameCore,Jr=Ji.Configs,Ja=Jr.Mockup,Jo=Ja.Leaderboards,Js=Ja.GameSDK.Player,Jl=Jr.Leaderboards,Ju=Ji.Utils.Number,Jh=globalThis.game.leaderboard,Jp=function(){function e(){var g=this;Fe(this,e),this.handleWhenGameSDKStarted=function(){Jo.Enabled?g.setupLeaderboardsMockup():g.setupLeaderboards()}}var g,E,_,k,C;return Ue(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(C=Be(function(){return _ts_generator(this,function(g){this.setupLeaderboardByConfigs();return[2]})}),function(){return C.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var g=Jl.LeaderboardId;g?(Jh.addLeaderboard({name:sj,type:"global",autoSortRank:!0,leaderboardId:g}),Jh.addLeaderboard({name:sX,type:"friends",autoSortRank:!0,leaderboardId:g})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(k=Be(function(){return _ts_generator(this,function(g){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard();return[2]})}),function(){return k.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(_=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=sj,E=sY,_=Jo.NumOfLeaders;return[4,Jh.createLeaderboardAsync({_id:E,name:g,numberOfLeaders:Ju.random(_.Max-_.Min)+_.Min})];case 1:k=A.sent();Jh.addLeaderboard({name:g,type:"global",autoSortRank:!0,leaderboardId:k});return[4,Jh.requestLeaderboardAsync(g,10)];case 2:A.sent();C=Jh.getLeaderboard(g);console.info("setupGlobalLeaderboard fetch new",C,C&&Object.keys(C.leaders).length),C=Jh.getLeaderboard(g),console.info("setupGlobalLeaderboard load more",C,C&&Object.keys(C.leaders).length);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(E=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=sX,E=sJ,_=0,k=Js.ConnectedPlayers;k.Enabled&&(_=Ju.random(k.NumOfPlayers-1)+1);return[4,Jh.createLeaderboardAsync({_id:E,name:g,numberOfLeaders:_})];case 1:C=T.sent();Jh.addLeaderboard({name:g,type:"friends",autoSortRank:!0,leaderboardId:C});return[4,Jh.requestLeaderboardAsync(g,10)];case 2:T.sent();A=Jh.getLeaderboard(g);console.info("setupFriendsLeaderboard done",A);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(g=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:return[4,ua.requestTournamentDataAsync()];case 1:g=E.sent();g.forEach(function(g){var E=g.payload.leaderboardId;E&&(Jh.isExistLeaderboardId(E)||Jh.addLeaderboard({type:"tournament",name:E,autoSortRank:!0,leaderboardId:E}))}),console.info("setupGlobalTournamentLeaderboard done",g);return[2]}})}),function(){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var Jd=GameCore,Jf=Jd.Utils,Jy=Jd.Events,Jv=Jd.Configs.PerformanceMonitor.FpsTracking,Jg=globalThis.game.event,Jm=function(){function e(){var g=this;Fe(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){g.startTraceFps(),N.on(e_.EVENT_AFTER_UPDATE,g.handleLateUpdate)},this.handleLateUpdate=function(){if(g.mark){if(g.fpsTraceDuration-=Q.deltaTime,g.fpsTraceDuration<=0&&!g.traceStopped)return g.traceStopped=!0,g.unListenEvents(),g.updateFPS(),void g.mark.stop(g.markName);g.fpsTraceIntervalTimer-=Q.deltaTime,g.fpsTraceIntervalTimer>0||(g.fpsTraceIntervalTimer=g.fpsTraceInterval,g.updateFPS(),g.mark.stop(g.markName),g.startTraceFps())}}}return Ue(e,[{key:"mark",get:function(){return Jv.Enabled?Jf.Mark:null}},{key:"init",value:function(){var g=Jv.TrackingDuration,E=Jv.TrackingInterval;this.fpsTraceDuration=null!=g?g:60,this.fpsTraceInterval=null!=E?E:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){Jg.once(Jy.GAME_READY,this.handleStartTraceFps)}},{key:"unListenEvents",value:function(){N.off(e_.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var g,E;if(this.mark){var _=this.getFPS(),k=this.getDrawCalls(),C=this.getDeviceRender(),A=this.getTextureMemory();this.minFps=Math.min(null!==(g=this.minFps)&&void 0!==g?g:_,_),this.maxFps=Math.max(null!==(E=this.maxFps)&&void 0!==E?E:0,_),this.mark.putMetric(this.markName,"FPS Metric",_),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",C),this.mark.putAttr(this.markName,"Draw Calls",k.toString()),this.mark.putAttr(this.markName,"Texture Memory",A.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info("FPS: ".concat(_," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(k,", texture memory: ").concat(A.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!N.root)return 0;var g=N.root.fps;return Math.floor(g)||0}},{key:"getDrawCalls",value:function(){return N.root&&N.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return N.root&&N.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return N.root&&N.root.device.memoryStatus.textureSize/1048576||0}}]),e}();_._RF.pop(),_._RF.push({},"d5789HUcoJBYr7E3NOGuQyN","Profiler",void 0);var Jb=GameCore,Jw=Jb.Utils.Valid,JS=Jb.Configs.Debugger.Profiler,JE=globalThis.game.event,J_=function(){function e(){var g=this;Fe(this,e),this.isUpdated=!1,this.isPost=!1,this.isDrawn=!1,this.isCommitted=!1,this.isRendered=!1,this.isFramed=!1,this.waitOptions={timeout:0,checkInterval:1},this.initState=function(){g.isFramed=!1,g.isUpdated=!1,g.isDrawn=!1,g.isCommitted=!1,g.isRendered=!1,g.isPost=!1},this.startTraceLoop=function(){g.clearLoopEvents(),g.initState(),g.useTickAsync(),g.listenLoopEvents()},this.handleBeginFrame=function(){g.measure("Frame",g.processBeginFrame)},this.processBeginFrame=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isFramed=!1,console.time("Frame");return[4,Jw.isValueChangeAsync(function(){return g.isFramed},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Frame");return[2]}})}),this.handleBeforeUpdate=function(){g.measure("Update",g.processBeforeUpdate)},this.processBeforeUpdate=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isUpdated=!1,console.time("Update");return[4,Jw.isValueChangeAsync(function(){return g.isUpdated},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Update");return[2]}})}),this.handleAfterUpdate=function(){g.isUpdated=!0},this.handleBeforeDraw=function(){g.measure("Draw",g.processBeforeDraw)},this.processBeforeDraw=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isDrawn=!1,console.time("Draw");return[4,Jw.isValueChangeAsync(function(){return g.isDrawn},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Draw");return[2]}})}),this.handleBeforeCommit=function(){g.measure("Commit",g.processBeforeCommit)},this.processBeforeCommit=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isCommitted=!1,console.time("Commit");return[4,Jw.isValueChangeAsync(function(){return g.isCommitted},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Commit");return[2]}})}),this.handleBeforeRender=function(){g.isCommitted=!0,g.measure("Render",g.processBeforeRender)},this.processBeforeRender=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isRendered=!1,console.time("Render");return[4,Jw.isValueChangeAsync(function(){return g.isRendered},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Render");return[2]}})}),this.handleAfterRender=function(){g.isRendered=!0},this.handleAfterDraw=function(){g.isDrawn=!0,g.measure("Post",g.processPost)},this.processPost=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isPost=!1,console.time("Post");return[4,Jw.isValueChangeAsync(function(){return g.isPost},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Post");return[2]}})}),this.handleEndFrame=function(){g.isPost=!0,g.isFramed=!0,g.restoreTick()}}var g,E;return Ue(e,[{key:"profiler",get:function(){return globalThis.game.profiler}},{key:"init",value:function(){JS.Enabled&&(this.initState(),this.addTickAsync(),this.listenEvents())}},{key:"addTickAsync",value:function(){var g=this;N.originalTick=N.tick,N.tickAsync=function(){var E=Be(function(E){var _,k,A,T,R,I;return _ts_generator(this,function(P){switch(P.label){case 0:if(!!this._invalid)return[3,8];return[4,g.emitAsync(e_.EVENT_BEGIN_FRAME)];case 1:if(P.sent(),!!this._paused)return[3,4];return[4,g.emitAsync(e_.EVENT_BEFORE_UPDATE)];case 2:P.sent(),this._compScheduler.startPhase(),this._compScheduler.updatePhase(E);for(k=0;k<this._systems.length;++k)this._systems[k].update(E);this._compScheduler.lateUpdatePhase(E);return[4,g.emitAsync(e_.EVENT_AFTER_UPDATE)];case 3:P.sent(),e1._deferredDestroy();for(A=0;A<this._systems.length;++A)this._systems[A].postUpdate(E);P.label=4;case 4:return[4,g.emitAsync(e_.EVENT_BEFORE_DRAW)];case 5:P.sent();T=null===(_=N.getScene())||void 0===_?void 0:_.getComponentsInChildren("UIRenderer");if(!T)return[3,8];I=at(T);try{for(I.s();!(R=I.n()).done;)R.value.updateRenderer()}catch(g){I.e(g)}finally{I.f()}this._root.frameMove(E);return[4,g.emitAsync(e_.EVENT_AFTER_DRAW)];case 6:P.sent(),C.resetHasChangedFlags(),C.clearNodeArray();return[4,g.emitAsync(e_.EVENT_END_FRAME)];case 7:P.sent(),this._totalFrames++;P.label=8;case 8:return[2]}})});return function(g){return E.apply(this,arguments)}}()}},{key:"emitAsync",value:(E=Be(function(g){var E,_,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(P){switch(P.label){case 0:for(E=I.length,_=new Array(E>1?E-1:0),k=1;k<E;k++)_[k-1]=I[k];return[4,this.waitEvent.apply(this,[g].concat(_))];case 1:P.sent(),N.emit.apply(N,[g].concat(_));A=this.getListeners(g),T=at(A);try{for(T.s();!(C=T.n()).done;){R=C.value;R.check=R.originalCheck}}catch(g){T.e(g)}finally{T.f()}return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"useTickAsync",value:function(){N.tick=N.tickAsync}},{key:"restoreTick",value:function(){N.tick=N.originalTick}},{key:"getListeners",value:function(g){return N._callbackTable[g].callbackInfos||[]}},{key:"waitEvent",value:(g=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){for(E=T.length,_=new Array(E>1?E-1:0),k=1;k<E;k++)_[k-1]=T[k];C=this.getListeners(g);if(0!==C.length){A=C.map(function(E){var k=E.target,C=E.callback;return E.originalCheck||(E.originalCheck=E.check),E.check=function(){return!1},new Promise(function(E){var A="Wait ".concat(g," (").concat(k,":").concat(C.name,")");console.time(A),k?C.call.apply(C,[k].concat(_)):C.apply(void 0,_),E(!0),console.timeEnd(A)})});return[2,Promise.all(A)]}return[2]})}),function(E){return g.apply(this,arguments)})},{key:"listenEvents",value:function(){JE.on("render",this.startTraceLoop)}},{key:"listenLoopEvents",value:function(){N.once(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.once(e_.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),N.once(e_.EVENT_AFTER_UPDATE,this.handleAfterUpdate),N.once(e_.EVENT_BEFORE_DRAW,this.handleBeforeDraw),N.once(e_.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),N.once(e_.EVENT_BEFORE_RENDER,this.handleBeforeRender),N.once(e_.EVENT_AFTER_RENDER,this.handleAfterRender),N.once(e_.EVENT_AFTER_DRAW,this.handleAfterDraw),N.once(e_.EVENT_END_FRAME,this.handleEndFrame)}},{key:"clearLoopEvents",value:function(){N.off(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.off(e_.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),N.off(e_.EVENT_AFTER_UPDATE,this.handleAfterUpdate),N.off(e_.EVENT_BEFORE_DRAW,this.handleBeforeDraw),N.off(e_.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),N.off(e_.EVENT_BEFORE_RENDER,this.handleBeforeRender),N.off(e_.EVENT_AFTER_RENDER,this.handleAfterRender),N.off(e_.EVENT_AFTER_DRAW,this.handleAfterDraw),N.off(e_.EVENT_END_FRAME,this.handleEndFrame)}},{key:"measure",value:function(g,E,_){var k,C=!(arguments.length>2&&void 0!==_)||_;null===(k=this.profiler)||void 0===k||k.measureCode({name:g,isAsync:C,profile:g,callback:E})}}]),e}();_._RF.pop(),_._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var Jk=GameCore.Events,JC=globalThis.game.event,JA=function(){function e(){Fe(this,e),this.handleHotReload=function(){Q.restart()},this.handleUpdateConfig=function(g){if("Gameplay"===g.type){Q.emit(t9,g.config);var E=g.id,_=g.type;JC.emit(Jk.REMOTE_CONFIG_UPDATED,{id:E,type:_})}}}return Ue(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){JC.on(Jk.REQUEST_HOT_RELOAD,this.handleHotReload),JC.on(Jk.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();_._RF.pop(),_._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var JT=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}},{key:"initProfiler",value:function(){(new J_).init()}},{key:"initLanguages",value:function(){(new Jn).init()}},{key:"initCocosStats",value:function(){(new YU).init()}},{key:"initLeaderboards",value:function(){(new Jp).init()}},{key:"initRemoteConfig",value:function(){(new JA).init()}},{key:"initDynamicAtlas",value:function(){(new Y5).init()}},{key:"initDynamicAssets",value:function(){(new Yj).init()}},{key:"initCanvasRecorder",value:function(){(new YF).init()}},{key:"initPerformanceMonitor",value:function(){(new Jm).init()}},{key:"initAdaptivePerformance",value:function(){(new YM).init()}}]),e}();_._RF.pop(),_._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var JR=globalThis.game,JI=JR.event,JP=JR.monitorError,JL=GameCore,JO=JL.Events,JB=JL.Configs.PerformanceMonitor,JN=JL.Utils.Mark,JM=function(){function e(){var g=this;Fe(this,e),this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var E=Be(function(E){var _,k,C;return _ts_generator(this,function(A){_=E.sceneName,k=E.sceneData,C=g.correctSceneName(_);console.info("Switching",C,null!=k?k:{}),C&&(l5.showLoadingFullScreen(C),g.startScene({sceneName:C,sceneData:k}));return[2]})});return function(g){return E.apply(this,arguments)}}(),this.preloadScene=function(E,_){var k=E.sceneName;g.startMeasure(k),N.preloadScene(k,g.onSceneProgress,g.onScenePreloaded(k,_))},this.startMeasure=function(E){g.mark&&(g.queueLoadScene[E]&&(g.mark.putAttr(g.markName,"Canceled","true"),g.stopMeasure(E)),console.groupCollapsed("\uD83D\uDCE6 ".concat(E,": loading progress")),g.mark.measure(g.markName),g.mark.putAttr(g.markName,"Cancel","false"),g.mark.putAttr(g.markName,"Success","false"),g.mark.putMetric(g.markName,E),g.mark.start(g.markName),g.queueLoadScene[E]=!0)},this.stopMeasure=function(E){g.mark&&g.queueLoadScene[E]&&(g.mark.rmAttr(g.markName,"File"),g.mark.putAttr(g.markName,"Success","true"),g.mark.stop(g.markName),g.queueLoadScene[E]=!1,console.groupEnd())},this.onSceneProgress=function(E,_,k){var C=E/_;g.mark&&g.mark.putAttr(g.markName,"Last File","".concat(k.id," (").concat(k.ext,")"));var A=Math.floor(70*C+30);GameSDK.setLoadingProgress(A)},this.onScenePreloaded=function(g,E){return function(_){_?console.warn("SceneManager.onScenePreloaded",{sceneName:g,error:_}):(E&&E(g,_),JI.emit(JO.SCENE_LOADED,{sceneName:g,isPreload:!0}))}},this.onDirectorLoadScene=function(E){return function(_,k){if(_)console.warn("SceneManager.onSceneLoaded",_);else if(null!=k&&k.scene){var C=k.name;g.handleBeforeSceneLaunch(k,E)(),N.once(e_.EVENT_AFTER_SCENE_LAUNCH,g.handleSceneLaunched(C,E))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(E,_){return function(){g.setSceneData(E,null!=_?_:{}),Q.emit(t6),JI.emit(JO.SCENE_LOADED,{sceneName:E.name})}},this.handleSceneLaunched=function(E,_){return function(){var k;l5.hideLoadingFullScreen(E),iA.switchSceneTracking(),null==JP||JP.addMetadata({currentScene:E}),null===(k=g.callbackSwitchScene)||void 0===k||k.call(g,{sceneName:E,sceneData:_}),JI.emit(JO.SCENE_LAUNCHED,{sceneName:E})}},this.handleSceneLoaded=function(E){var _=E.sceneName;g.stopMeasure(_)}}return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){JI.on(JO.SWITCH_SCENE,this.switchScene),JI.on(JO.PRELOAD_SCENE,this.preloadScene),JI.on(JO.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(g){var E=this.getCurrentScene();return E&&g===E.name?null:g}},{key:"startScene",value:function(g){var E=this,_=g.sceneName,k=g.sceneData;this.preloadScene({sceneName:_},function(g,C){g===_&&(C?console.warn("SceneManager.startScene",{sceneName:_,error:C}):N.loadScene(_,E.onDirectorLoadScene(k)))})}},{key:"mark",get:function(){return JB.LoadResources?JN:null}},{key:"getCurrentScene",value:function(){return N.getScene()}},{key:"getLoadedScenes",value:function(){var g=this,E=[];return Object.keys(this.queueLoadScene).map(function(_){g.queueLoadScene[_]||E.push(_)}),E}},{key:"onSwitchScene",value:function(g){this.callbackSwitchScene=g}},{key:"setSceneData",value:function(g,E){if(E&&("data"in g||g.scene.attr({data:{}}),"data"in g)){var _=g.data||{};g.scene.attr({data:Me(Me({},_),E)}),console.info("SceneManager.setSceneData",{sceneName:g.name,sceneData:E,currentData:_})}}}]),e}();_._RF.pop(),_._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var JD=globalThis.game,JF=JD.event,JU=JD.monitorError,Jx=GameCore,Jz=Jx.Events,JG=Jx.Utils.Object,JV=function(){function e(){var g=this;Fe(this,e),this.screens={},this.handleOpenScreen=function(E){var _=E.screenName,k=E.screenData;g.openScreen(_,k)},this.handleCloseScreen=function(E){var _=E.screenName;g.closeScreen(_)}}var g,E,_,k;return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){JF.on(Jz.OPEN_SCREEN,this.handleOpenScreen),JF.on(Jz.CLOSE_SCREEN,this.handleCloseScreen)}},{key:"reorderScreens",value:function(){var g=JG.vals(this.screens).filter(function(g){return"ready"===g.state});g.sort(function(g,E){return g.order-E.order});for(var E=0;E<g.length;E++){var _=g[E];_.order=E,_.comp.node.setSiblingIndex(_.order)}}},{key:"addScreenKeys",value:function(g,E){var _=this;g.forEach(function(g,k){_.screens[iS[g]]&&(_.screens[iS[g]].order=k),_.screens[iS[g]]={state:"key",parent:E,key:g,order:k}})}},{key:"addScreens",value:function(g){var E=this;g.forEach(function(g,_){E.screens[g.node.name]={state:"ready",comp:g,order:_}})}},{key:"preloadScreens",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=JG.vals(this.screens).reduce(function(g,E){if("key"===E.state){var _=ii.loadPrefabAsync("screens/".concat(iS[E.key]));g.push(_)}return g},[]);return[4,Promise.all(g)];case 1:return[2,E.sent()]}})}),function(){return k.apply(this,arguments)})},{key:"getScreen",value:(_=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(P){switch(P.label){case 0:E=this.screens[g];if(null==E)return[2,(null==JU||JU.sendException(new Error("ScreenManager.openScreen Screen ".concat(g," not found")),{screenName:g,screens:this.getScreensAsMetadata()}),null)];if("ready"===E.state)return[2,E.comp];console.info("ScreenManager.getScreen","Screen ".concat(g," not found in cache, instantiating it..."));_=E.parent,k=E.key,C=E.order;return[4,ii.loadPrefabAsync("screens/".concat(iS[k]))];case 1:A=P.sent();if(!A)return[2,(null==JU||JU.sendException(new Error("ScreenManager.getScreen: Failed to load Screen ".concat(g," prefab...")),{screenName:g,screens:this.getScreensAsMetadata()}),null)];T=I(A);T.name=g,_.addChild(T),T.active=!1;R=T.getComponent(xX);return[2,R?(this.screens[g]={state:"ready",comp:R,order:C},this.reorderScreens(),R):(null==JU||JU.sendException(new Error("ScreenManager.getScreen: Screen ".concat(g," prefab doesn't have BaseScreen component...")),{screenName:g,screens:this.getScreensAsMetadata()}),null)]}})}),function(g){return _.apply(this,arguments)})},{key:"getScreensAsMetadata",value:function(){var g=this;return Object.keys(this.screens).map(function(E){var _=g.screens[E];return"ready"===_.state?"".concat(_.comp.node.name,"(loaded)"):"".concat(iS[_.key],"(not-loaded)")}).join(", ")}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:(E=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,3,,4]);ii.setBlockInput(!0);return[4,this.getScreen(g)];case 1:_=A.sent();if(ii.setBlockInput(!1),null==_||!_.node)return[2,void console.warn("ScreenManager.openScreen","Screen ".concat(g," not found"))];_.node.active=!0,_.node.setPosition(new em(0,0,0));k={screenName:g,screenData:E};JF.emit(Jz.OPENING_SCREEN,k),iA.trackCurrentPage(g,!0),null==JU||JU.addMetadata({currentScreen:g});return[4,t$.waitTweenAsync(0)];case 2:A.sent(),_.open(E),JF.emit(Jz.OPENED_SCREEN,k);return[3,4];case 3:C=A.sent();console.error("ScreenManager.openScreen",C);return[3,4];case 4:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"closeScreen",value:(g=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,2,,3]);return[4,this.getScreen(g)];case 1:_=A.sent();if(!_)return[2,void console.warn("ScreenManager.closeScreen","Screen ".concat(g," not found"))];if(null===(E=_.node)||void 0===E||!E.active)return[2];k={screenName:g};JF.emit(Jz.CLOSING_SCREEN,k),_.close(),iA.trackCurrentPage(g,!1),null==JU||JU.removeMetadata("currentScreen");return[3,3];case 2:C=A.sent();console.error("ScreenManager.closeScreen",C);return[3,3];case 3:return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"closeAllScreens",value:function(){for(var g in this.screens)"ready"===this.screens[g].state&&this.closeScreen(g)}}]),e}();_._RF.pop(),_._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var JK=GameCore,JH=JK.Configs.Core,Jq=JK.Events,JW=JK.Plugins.Analytics.Events,Jj=globalThis.game,JX=Jj.context,JY=Jj.storage,JJ=Jj.event,JQ=Jj.analytics,JZ=Jj.monitorError;new(function(){function e(){var g=this;Fe(this,e),this.coreManager=new XJ,this.adsManager=new Xq,this.matchManager=new Yw,this.sceneManager=new JM,this.screenManager=new JV,this.engineManager=new X3,this.layoutManager=new Yl,this.playerManager=new YR,this.pluginsManager=new JT,this.handleWhenCoreBoot=function(){Q.inited?g.handleCocosInit():Q.once(e2.EVENT_POST_PROJECT_INIT,g.handleCocosInit)},this.handleCocosInit=function(){g.coreManager.requestStart()},this.handleWhenCoreStart=function(){g.playerManager.setupDefaultGameData(),g.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){g.initPlugins(),console.groupEnd(),JQ.event(JW.LOAD_START),JH.StartSDKAfterLoadGame?JJ.once(Jq.SCENE_LOADED,g.handleStartGameWhenMainSceneReady):g.processStartGame(),g.preloadScenes()},this.handleStartGameWhenMainSceneReady=function(){g.processStartGame()},this.handleSwitchScene=function(E){var _=E.sceneName,k=g.sceneManager.getCurrentScene();if((null==k?void 0:k.name)===_){g.screenManager.closeAllScreens(),g.screenManager.clearScreens();var C=null==k?void 0:k.getComponentsInChildren(xX);if(C.length>0){var A=C.map(function(g){return g.node.name}).join(", ");console.info("\uD83D\uDCFA Loaded Screens in ".concat(_,": ").concat(A)),g.screenManager.addScreens(C)}var T=null==k?void 0:k.getComponentInChildren(zu);if(T){var R=T.screenKeys.filter(function(g){return!C.some(function(E){return E.node.name===iS[g]})});if(0!==R.length){var I=R.map(function(g){return iS[g]}).join(", ");console.info("\uD83D\uDCFA Lazy-loading Screens in ".concat(_,": ").concat(I)),g.screenManager.addScreenKeys(R,T.node),g.screenManager.preloadScreens()}}}},console.groupCollapsed("\uD83D\uDCE6 Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}var g,E,_;return Ue(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.adsManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"preloadScenes",value:function(){"solo"===JY.getStorageData("context","sessionContextType")?lV.preloadDashboardScene():lV.preloadGameScene()}},{key:"processStartGame",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:console.groupEnd(),JQ.event(JW.LOAD_COMPLETE);return[4,this.startGameAsync()];case 1:g.sent(),this.startProcessContextData();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"startGameAsync",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,GameSDK.startGameAsync()];case 1:E.sent();return[3,3];case 2:g=E.sent();console.warn("GameSDK.startGameAsync",g),_instanceof(g,Error)&&(null==JZ||JZ.sendException(g));return[3,3];case 3:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"startProcessContextData",value:(g=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!JJ.getEventEmitCount(Jq.PLAYER_INFO_LOADED))return[3,6];JQ.event(JW.APP_READY);E.label=1;case 1:E.trys.push([1,3,4,5]);this.playerManager.requestConnectedPlayers();return[4,JX.processContextData()];case 2:E.sent();return[3,5];case 3:g=E.sent();console.error("startProcessContextData",g),_instanceof(g,Error)&&(null==JZ||JZ.sendException(g));return[3,5];case 4:JJ.emit(Jq.GAME_READY);return[7];case 5:return[3,7];case 6:JJ.once(Jq.PLAYER_INFO_LOADED,this.startProcessContextData);E.label=7;case 7:return[2]}})}),function(){return g.apply(this,arguments)})},{key:"initPlugins",value:function(){this.pluginsManager.initProfiler(),this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),_._RF.pop()}}});(function(g){g("virtual:///prerequisite-imports/main","chunks:///main.js")})(function(g,E){System.register(g,[E],function(g,E){return{setters:[function(E){var _={};for(var k in E)if("default"!==k&&"__esModule"!==k)_[k]=E[k];g(_)}],execute:function(){}}})});