function _instanceof(g,E){if(null!=E&&"undefined"!=typeof Symbol&&E[Symbol.hasInstance])return!!E[Symbol.hasInstance](g);return g instanceof E}function _type_of(g){return g&&"undefined"!=typeof Symbol&&g.constructor===Symbol?"symbol":typeof g}function _ts_generator(g,E){var _,k,C,A,T={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return A={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(A[Symbol.iterator]=function(){return this}),A;function verb(g){return function(E){return step([g,E])}}function step(A){if(_)throw new TypeError("Generator is already executing.");while(T)try{if(_=1,k&&(C=2&A[0]?k.return:A[0]?k.throw||((C=k.return)&&C.call(k),0):k.next)&&!(C=C.call(k,A[1])).done)return C;if(k=0,C)A=[2&A[0],C.value];switch(A[0]){case 0:case 1:C=A;break;case 4:T.label++;return{value:A[1],done:false};case 5:T.label++;k=A[1];A=[0];continue;case 7:A=T.ops.pop();T.trys.pop();continue;default:if(C=T.trys,!(C=C.length>0&&C[C.length-1])&&(6===A[0]||2===A[0])){T=0;continue}if(3===A[0]&&(!C||A[1]>C[0]&&A[1]<C[3])){T.label=A[1];break}if(6===A[0]&&T.label<C[1]){T.label=C[1];C=A;break}if(C&&T.label<C[2]){T.label=C[2];T.ops.push(A);break}if(C[2])T.ops.pop();T.trys.pop();continue}A=E.call(g,T)}catch(g){A=[6,g];k=0}finally{_=C=0}if(5&A[0])throw A[1];return{value:A[0]?A[1]:void 0,done:true}}}System.register("chunks:///main.js",["cc"],function(g,E){var _,k,C,A,T,R,I,L,P,O,B,N,M,D,F,U,x,z,G,V,K,H,q,W,j,X,Y,J,Q,Z,$,ee,en,ei,er,ea,eo,es,el,eu,ec,eh,ep,ed,ey,ev,eg,em,eb,ew,eS,eE,e_,ek,eC,eA,eT,eR,eI,eL,eP,eO,eB,eN,eM,eD,eF,eU,ex,ez,eG,eV,eK,eH,eq,eW,ej,eX,eY,eJ,eQ,eZ,e$,e0,e1,e2;return{setters:[function(g){_=g.cclegacy,k=g._decorator,C=g.Node,A=g.Color,T=g.Canvas,R=g.UITransform,I=g.instantiate,L=g.Label,P=g.RichText,O=g.Toggle,B=g.Button,N=g.director,M=g.Component,D=g.AudioSource,F=g.resources,U=g.AudioClip,x=g.CCString,z=g.tween,G=g.Animation,V=g.CCInteger,K=g.CCFloat,H=g.Widget,q=g.Layout,W=g.view,j=g.screen,X=g.math,Y=g.isCCObject,J=g.CCBoolean,Q=g.game,Z=g.ccenum,$=g.find,ee=g.Prefab,en=g.JsonAsset,ei=g.AnimationClip,er=g.ImageAsset,ea=g.SpriteFrame,eo=g.Sprite,es=g.Enum,el=g.easing,eu=g.UIOpacity,ec=g.EventHandler,eh=g.animation,ep=g.Input,ed=g.Graphics,ey=g.profiler,ev=g.sys,eg=g.EventTarget,em=g.Vec3,eb=g.View,ew=g.ProgressBar,eS=g.Vec2,eE=g.Font,e_=g.Director,ek=g.Layers,eC=g.randomRangeInt,eA=g.pseudoRandomRangeInt,eT=g.pseudoRandom,eR=g.randomRange,eI=g.Pool,eL=g.repeat,eP=g.lerp,eO=g.approx,eB=g.EPSILON,eN=g.RealCurve,eM=g.Gradient,eD=g.bits,eF=g.random,eU=g.Material,ex=g.toRadian,ez=g.HorizontalTextAlignment,eG=g.Tween,eV=g.ParticleSystem2D,eK=g.ScrollView,eH=g.NodeEventType,eq=g.Mask,eW=g.settings,ej=g.Settings,eX=g.AssetManager,eY=g.input,eJ=g.macro,eQ=g.DynamicAtlasManager,eZ=g.ResolutionPolicy,e$=g.Texture2D,e0=g.UIRenderer,e1=g.CCObject,e2=g.Game}],execute:function(){function e(g,E){var _=Object.keys(g);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(g);E&&(k=k.filter(function(E){return Object.getOwnPropertyDescriptor(g,E).enumerable})),_.push.apply(_,k)}return _}function Me(g){for(var E=1;E<arguments.length;E++){var _=null!=arguments[E]?arguments[E]:{};E%2?e(Object(_),!0).forEach(function(E){Ge(g,E,_[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(_)):e(Object(_)).forEach(function(E){Object.defineProperty(g,E,Object.getOwnPropertyDescriptor(_,E))})}return g}function De(g,E,_,k,C,A,T){try{var R=g[A](T),I=R.value}catch(g){return void _(g)}R.done?E(I):Promise.resolve(I).then(k,C)}function Be(g){return function(){var E=this,_=arguments;return new Promise(function(k,C){var A=g.apply(E,_);function r(g){De(A,k,C,r,s,"next",g)}function s(g){De(A,k,C,r,s,"throw",g)}r(void 0)})}}function Fe(g,E){if(!_instanceof(g,E))throw new TypeError("Cannot call a class as a function")}function xe(g,E){for(var _=0;_<E.length;_++){var k=E[_];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(g,ot(k.key),k)}}function Ue(g,E,_){return E&&xe(g.prototype,E),_&&xe(g,_),Object.defineProperty(g,"prototype",{writable:!1}),g}function Ge(g,E,_){return(E=ot(E))in g?Object.defineProperty(g,E,{value:_,enumerable:!0,configurable:!0,writable:!0}):g[E]=_,g}function ze(g,E){if("function"!=typeof E&&null!==E)throw new TypeError("Super expression must either be null or a function");g.prototype=Object.create(E&&E.prototype,{constructor:{value:g,writable:!0,configurable:!0}}),Object.defineProperty(g,"prototype",{writable:!1}),E&&He(g,E)}function Ve(g){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)})(g)}function He(g,E){return(He=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,E){return g.__proto__=E,g})(g,E)}function qe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(g){return!1}}function We(){return(We=qe()?Reflect.construct.bind():function(g,E,_){var k=[null];k.push.apply(k,E);var C=new(Function.bind.apply(g,k));return _&&He(C,_.prototype),C}).apply(null,arguments)}function je(g){var E="function"==typeof Map?new Map:void 0;return(je=function(g){if(null===g||(_=g,-1===Function.toString.call(_).indexOf("[native code]")))return g;var _;if("function"!=typeof g)throw new TypeError("Super expression must either be null or a function");if(void 0!==E){if(E.has(g))return E.get(g);E.set(g,i)}function i(){return We(g,arguments,Ve(this).constructor)}return i.prototype=Object.create(g.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),He(i,g)})(g)}function Ke(g){if(void 0===g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function Ye(g,E){if(E&&("object"==(void 0===E?"undefined":_type_of(E))||"function"==typeof E))return E;if(void 0!==E)throw new TypeError("Derived constructors may only return object or undefined");return Ke(g)}function Xe(g){var E=qe();return function(){var _,k=Ve(g);if(E){var C=Ve(this).constructor;_=Reflect.construct(k,arguments,C)}else _=k.apply(this,arguments);return Ye(this,_)}}function Qe(g,E){for(;!Object.prototype.hasOwnProperty.call(g,E)&&null!==(g=Ve(g)););return g}function Je(){return(Je="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(g,E,_){var k=Qe(g,E);if(k){var C=Object.getOwnPropertyDescriptor(k,E);return C.get?C.get.call(arguments.length<3?g:_):C.value}}).apply(this,arguments)}function Ze(g,E,_,k){return(Ze="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(g,E,_,k){var C,A=Qe(g,E);if(A){if((C=Object.getOwnPropertyDescriptor(A,E)).set)return C.set.call(k,_),!0;if(!C.writable)return!1}if(C=Object.getOwnPropertyDescriptor(k,E)){if(!C.writable)return!1;C.value=_,Object.defineProperty(k,E,C)}else Ge(k,E,_);return!0})(g,E,_,k)}function $e(g,E,_,k,C){if(!Ze(g,E,_,k||g)&&C)throw new TypeError("failed to set property");return _}function et(g,E){return function(g){if(Array.isArray(g))return g}(g)||function(g,E){var _=null==g?null:"undefined"!=typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(null!=_){var k,C,A,T,R=[],I=!0,L=!1;try{if(A=(_=_.call(g)).next,0===E){if(Object(_)!==_)return;I=!1}else for(;!(I=(k=A.call(_)).done)&&(R.push(k.value),R.length!==E);I=!0);}catch(g){L=!0,C=g}finally{try{if(!I&&null!=_.return&&(T=_.return(),Object(T)!==T))return}finally{if(L)throw C}}return R}}(g,E)||nt(g,E)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(g){return function(g){if(Array.isArray(g))return it(g)}(g)||function(g){if("undefined"!=typeof Symbol&&null!=g[Symbol.iterator]||null!=g["@@iterator"])return Array.from(g)}(g)||nt(g)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nt(g,E){if(g){if("string"==typeof g)return it(g,E);var _=Object.prototype.toString.call(g).slice(8,-1);return"Object"===_&&g.constructor&&(_=g.constructor.name),"Map"===_||"Set"===_?Array.from(g):"Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_)?it(g,E):void 0}}function it(g,E){(null==E||E>g.length)&&(E=g.length);for(var _=0,k=new Array(E);_<E;_++)k[_]=g[_];return k}function at(g,E){var _="undefined"!=typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(!_){if(Array.isArray(g)||(_=nt(g))||E&&g&&"number"==typeof g.length){_&&(g=_);var k=0,a=function(){};return{s:a,n:function(){return k>=g.length?{done:!0}:{done:!1,value:g[k++]}},e:function(g){throw g},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var C,A=!0,T=!1;return{s:function(){_=_.call(g)},n:function(){var g=_.next();return A=g.done,g},e:function(g){T=!0,C=g},f:function(){try{A||null==_.return||_.return()}finally{if(T)throw C}}}}function ot(g){var E=function(g,E){if("object"!=(void 0===g?"undefined":_type_of(g))||null===g)return g;var _=g[Symbol.toPrimitive];if(void 0!==_){var k=_.call(g,E||"default");if("object"!=(void 0===k?"undefined":_type_of(k)))return k;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===E?String:Number)(g)}(g,"string");return"symbol"==(void 0===E?"undefined":_type_of(E))?E:String(E)}function rt(g,E,_,k){_&&Object.defineProperty(g,E,{enumerable:_.enumerable,configurable:_.configurable,writable:_.writable,value:_.initializer?_.initializer.call(k):void 0})}function st(g,E,_,k,C){var A={};return Object.keys(k).forEach(function(g){A[g]=k[g]}),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=_.slice().reverse().reduce(function(_,k){return k(g,E,_)||_},A),C&&void 0!==A.initializer&&(A.value=A.initializer?A.initializer.call(C):void 0,A.initializer=void 0),void 0===A.initializer&&(Object.defineProperty(g,E,A),A=null),A}var g,e4,e3,e5,e6,e8,e9,e7;_._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var te=k.ccclass,tn=k.property;g=te("internal.DebugViewRuntimeControl"),e4=tn(C),e3=tn(C),e5=tn(C),g((e8=st((e6=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"compositeModeToggle",e8,Ke(g)),rt(g,"singleModeToggle",e9,Ke(g)),rt(g,"EnableAllCompositeModeButton",e7,Ke(g)),g._single=0,g.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],g.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],g.strMisc=["CSM Layer Coloration","Lighting With Albedo"],g.compositeModeToggleList=[],g.singleModeToggleList=[],g.miscModeToggleList=[],g.textComponentList=[],g.labelComponentList=[],g.textContentList=[],g._currentColorIndex=0,g.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],g.color=[A.WHITE,A.BLACK,A.RED,A.GREEN,A.BLUE],g}return Ue(n,[{key:"start",value:function(){if(this.node.parent.getComponent(T)){var g=this.node.parent.getComponent(R),E=.5*g.width,_=.5*g.height,k=.1*E-E,C=_-.1*_,N=this.node.getChildByName("MiscMode"),M=I(N);M.parent=this.node,M.name="Buttons";var D=I(N);D.parent=this.node,D.name="Titles";for(var F=0;F<2;F++){var U=I(this.EnableAllCompositeModeButton.getChildByName("Label"));U.setPosition(k+(F>0?450:150),C,0),U.setScale(.75,.75,.75),U.parent=D;var x=U.getComponent(L);x.string=F?"----------Composite Mode----------":"----------Single Mode----------",x.color=A.WHITE,x.overflow=0,this.labelComponentList[this.labelComponentList.length]=x}C-=20;for(var z=0,G=0;G<this.strSingle.length;G++,z++){G===this.strSingle.length>>1&&(k+=200,z=0);var V=G?I(this.singleModeToggle):this.singleModeToggle;V.setPosition(k,C-20*z,0),V.setScale(.5,.5,.5),V.parent=this.singleModeToggle.parent;var K=V.getComponentInChildren(P);K.string=this.strSingle[G],this.textComponentList[this.textComponentList.length]=K,this.textContentList[this.textContentList.length]=K.string,V.on(O.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[G]=V}k+=200,this.EnableAllCompositeModeButton.setPosition(k+15,C,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(B.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=M;var H=this.EnableAllCompositeModeButton.getComponentInChildren(L);this.labelComponentList[this.labelComponentList.length]=H;var q=I(this.EnableAllCompositeModeButton);q.setPosition(k+90,C,0),q.setScale(.5,.5,.5),q.on(B.EventType.CLICK,this.changeTextColor,this),q.parent=M,(H=q.getComponentInChildren(L)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=H;var W=I(this.EnableAllCompositeModeButton);W.setPosition(k+200,C,0),W.setScale(.5,.5,.5),W.on(B.EventType.CLICK,this.hideUI,this),W.parent=this.node.parent,(H=W.getComponentInChildren(L)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=H,this.hideButtonLabel=H,C-=40;for(var j=0;j<this.strMisc.length;j++){var X=I(this.compositeModeToggle);X.setPosition(k,C-20*j,0),X.setScale(.5,.5,.5),X.parent=N;var Y=X.getComponentInChildren(P);Y.string=this.strMisc[j],this.textComponentList[this.textComponentList.length]=Y,this.textContentList[this.textContentList.length]=Y.string,X.getComponent(O).isChecked=!!j,X.on(O.EventType.TOGGLE,j?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[j]=X}C-=150;for(var J=0;J<this.strComposite.length;J++){var Q=J?I(this.compositeModeToggle):this.compositeModeToggle;Q.setPosition(k,C-20*J,0),Q.setScale(.5,.5,.5),Q.parent=this.compositeModeToggle.parent;var Z=Q.getComponentInChildren(P);Z.string=this.strComposite[J],this.textComponentList[this.textComponentList.length]=Z,this.textContentList[this.textContentList.length]=Z.string,Q.on(O.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[J]=Q}}else console.error("debug-view-runtime-control should be child of Canvas")}},{key:"isTextMatched",value:function(g,E){var _=new String(g),k=_.search(">");return -1===k?g===E:(_=(_=_.substr(k+1)).substr(0,_.search("<")))===E}},{key:"toggleSingleMode",value:function(g){for(var E=N.root.debugView,_=g.getComponentInChildren(P),k=0;k<this.strSingle.length;k++)this.isTextMatched(_.string,this.strSingle[k])&&(E.singleMode=k)}},{key:"toggleCompositeMode",value:function(g){for(var E=N.root.debugView,_=g.getComponentInChildren(P),k=0;k<this.strComposite.length;k++)this.isTextMatched(_.string,this.strComposite[k])&&E.enableCompositeMode(k,g.isChecked)}},{key:"toggleLightingWithAlbedo",value:function(g){N.root.debugView.lightingWithAlbedo=g.isChecked}},{key:"toggleCSMColoration",value:function(g){N.root.debugView.csmLayerColoration=g.isChecked}},{key:"enableAllCompositeMode",value:function(g){var E=N.root.debugView;E.enableAllCompositeMode(!0);for(var _=0;_<this.compositeModeToggleList.length;_++)this.compositeModeToggleList[_].getComponent(O).isChecked=!0;var k=this.miscModeToggleList[0].getComponent(O);k.isChecked=!1,E.csmLayerColoration=!1,(k=this.miscModeToggleList[1].getComponent(O)).isChecked=!0,E.lightingWithAlbedo=!0}},{key:"hideUI",value:function(g){var E=this.node.getChildByName("Titles"),_=!E.active;this.singleModeToggleList[0].parent.active=_,this.miscModeToggleList[0].parent.active=_,this.compositeModeToggleList[0].parent.active=_,this.EnableAllCompositeModeButton.parent.active=_,E.active=_,this.hideButtonLabel.string=_?"Hide UI":"Show UI"}},{key:"changeTextColor",value:function(g){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var E=0;E<this.textComponentList.length;E++)this.textComponentList[E].string=this.strColor[this._currentColorIndex]+this.textContentList[E]+"</color>";for(var _=0;_<this.labelComponentList.length;_++)this.labelComponentList[_].color=this.color[this._currentColorIndex]}},{key:"onLoad",value:function(){}},{key:"update",value:function(g){}}]),n}(M)).prototype,"compositeModeToggle",[e4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e9=st(e6.prototype,"singleModeToggle",[e3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e7=st(e6.prototype,"EnableAllCompositeModeButton",[e5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e6));_._RF.pop(),_._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var ti=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,g)).audioSource=_,k}return Ue(n,[{key:"play",value:function(g){if(g){var E=g.volume,_=void 0===E?1:E,k=g.loop,C=void 0!==k&&k;this.audioSource.volume=_,this.audioSource.loop=C}this.audioSource.play()}},{key:"pause",value:function(){this.audioSource.pause()}},{key:"resume",value:function(){this.audioSource.state===D.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function(){this.audioSource.stop()}},{key:"setVolume",value:function(g){this.audioSource.volume=g}},{key:"getVolume",value:function(){return this.audioSource.volume}},{key:"getAudioSource",value:function(){return this.audioSource}}]),n}(GameCore.Plugins.Audio.BaseAudioPlayer);_._RF.pop(),_._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var tr=GameCore,ta=tr.Plugins.Audio.BaseChannelManager,to=tr.Utils.Array,ts=function(g){ze(i,g);var E,_=Xe(i);function i(g,E){var k;return Fe(this,i),(k=_.call(this,E)).allowMultipleTracking={},k.handleLoadedAudio=function(g,E){var _=k.node.addComponent(D);return _.clip=E,_.playOnAwake=!1,new ti(g,_)},k.node=g,k}return Ue(i,[{key:"playing",value:function(g){var E,_=null===(E=this.getAudioClip(g))||void 0===E?void 0:E.audioPlayer;return!!_&&_.getAudioSource().state===D.AudioState.PLAYING}},{key:"onLoadAudio",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(E){_=this;return[2,new Promise(function(E,k){F.load(g,U,function(C,A){try{if(C)throw new Error(C.message);if(!_.node.isValid)return;var T=_.handleLoadedAudio(g,A);E(T)}catch(g){_instanceof(g,Error)?k(g):k(new Error("Audio load: Unknown error"))}})})]})}),function(g,_){return E.apply(this,arguments)})},{key:"playWithRealConfig",value:function(g,E){if(this.isCanPlay(E)){if(E){var _=E.volume,k=void 0===_?1:_,C=E.allowMultiple,A=void 0!==C&&C;if(E.volume=this.getVolume()*k,A){var T=g.getAudioSource().clip;if(!T)return;return void this.requestDuplicateAudioPlayer(g.getKey(),T,E).play(E)}}g.play(E)}}},{key:"isCanPlay",value:function(g){var E=this;if(g){var _=g.checkList;if((void 0===_?[]:_).some(function(g){var _=E.getAudioClip(g);return!!_&&_.audioPlayer.getAudioSource().state===D.AudioState.PLAYING}))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function(g,E,_){var k=this.getDuplicateAudioFromPool(g);if(k){if(_){var C=k.key,A=_.volume,T=void 0===A?1:A;this.setAudioClip(C,{volume:T})}return k.audioPlayer}var R="".concat(g,"_").concat(this.allowMultipleTracking[g].currentPostFix),I=this.handleLoadedAudio(R,E);return this.allowMultipleTracking[g].list.push({audioPlayer:I,key:R}),this.allowMultipleTracking[g].currentPostFix+=1,this.setAudioClip(R,{audioPlayer:I,volume:1}),I}},{key:"getDuplicateAudioFromPool",value:function(g){if(this.allowMultipleTracking[g]){var E=this.allowMultipleTracking[g].list,_=to.search(E,function(g){return g.audioPlayer.getAudioSource().state!==D.AudioState.PLAYING});if(_)return _}else this.allowMultipleTracking[g]={currentPostFix:1,list:[]};return null}}]),i}(ta);_._RF.pop();var tl,tu,tc,th,tp,tf=!1;_._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var ty,tv,tg,tm,tb,tw=k.ccclass,tS=k.property,tE=globalThis.game,t_=tE.audio,tk=tE.player,tC=(tl=tw("Music"),tu=tS(x),tl((tp=st((th=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"channelId",tp,Ke(g)),g.channel=null,g.isMute=!1,g.volume=1,g}return Ue(n,[{key:"__preload",value:function(){this.makePersistent(),this.channel=new ts(this.node,this.channelId),t_.addChannel(this.channel)}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"playing",value:function(g){var E,_;return null!==(E=null===(_=this.channel)||void 0===_?void 0:_.playing(g))&&void 0!==E&&E}},{key:"play",value:function(g,E){if(!this.isMusicEnable())return Promise.resolve();var _=null!=E?E:{};return _.loop||(_.loop=!0),t_.play(g,_,this.channelId)}},{key:"isMusicEnable",value:function(){return!!tk.getPlayerSetting("music")}},{key:"setVolume",value:function(g){this.volume=g,this.isMute||t_.setVolume(g,this.channelId)}},{key:"getVolume",value:function(){return t_.getVolume(this.channelId)}},{key:"pause",value:function(g){t_.pause(g,this.channelId)}},{key:"resume",value:function(g){this.isMusicEnable()&&t_.resume(g,this.channelId)}},{key:"stop",value:function(g){t_.stop(g,this.channelId)}},{key:"mute",value:function(g){this.isMute=g,g?t_.mute(this.channelId):(this.setVolume(this.volume),t_.unmute(this.channelId))}}]),n}(M)).prototype,"channelId",[tu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),tc=th))||tc);_._RF.pop(),_._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var tA=k.ccclass,tT=k.property,tR=globalThis.game,tI=tR.audio,tL=tR.player,tP=(ty=tA("Sound"),tv=tT(x),ty((tb=st((tm=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"channelId",tb,Ke(g)),g.channel=null,g}return Ue(n,[{key:"__preload",value:function(){this.channel=new ts(this.node,this.channelId),tI.addChannel(this.channel)}},{key:"onLoad",value:function(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"removePersistent",value:function(){N.removePersistRootNode(this.node)}},{key:"play",value:function(g,E){return this.isSoundEnable()?tI.play(g,E,this.channelId):Promise.resolve()}},{key:"isSoundEnable",value:function(){return!!tL.getPlayerSetting("sound")}},{key:"setVolume",value:function(g){tI.setVolume(g,this.channelId)}},{key:"pause",value:function(g){tI.pause(g,this.channelId)}},{key:"resume",value:function(g){this.isSoundEnable()&&tI.resume(g,this.channelId)}},{key:"stop",value:function(g){tI.stop(g,this.channelId)}},{key:"stopAll",value:function(){tI.stopAll(this.channelId)}},{key:"mute",value:function(g){g?tI.mute(this.channelId):tI.unmute(this.channelId)}}]),n}(M)).prototype,"channelId",[tv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),tg=tm))||tg);_._RF.pop(),_._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);var tO,tB,tN,tM,tD,tF,tU,tx,tz,tG,tV,tK,tH,tq,tW,tj,tX,tY,tJ,tQ,tZ=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"elasticOut",value:function(g,E,_){var k=E||.1,C=_||.1;if(0===g)return 0;if(1===g)return 1;var A=C/4;return k<1?k=1:A=C*Math.asin(1/k)/(2*Math.PI),k*Math.pow(2,-10*g)*Math.sin(2*Math.PI*(g-A)/C)+1}},{key:"easeOutExpo",value:function(g){return 1===g?1:1-Math.pow(2,-10*g)}},{key:"easeInExpo",value:function(g){return 0===g?0:Math.pow(2,10*g-10)}},{key:"runTweenAsync",value:function(g,E){return new Promise(function(_){var k=g.call(function(){_({tween:g})}).start();E&&(E.aborted?(k.stop(),_({tween:g})):E.addAbortListener(function(){k.stop(),_({tween:g})}))})}},{key:"runOnUpdateAsync",value:function(g,E,_,k){return new Promise(function(C,A){var T=z(g).to(E,{},{onUpdate:function(g,E){if(void 0!==E)try{_(E)}catch(g){A(_instanceof(g,Error)?g:new Error(JSON.stringify(g)))}}}).call(function(){C({tween:T})}).start();k&&(k.aborted?(T.stop(),C({tween:T})):k.addAbortListener(function(){T.stop(),C({tween:T})}))})}},{key:"waitTweenAsync",value:function(g,E){return new Promise(function(_){var k=z({});k.delay(g),k.call(function(){_()}),k.start(),E&&(E.aborted?(k.stop(),_()):E.addAbortListener(function(){k.stop(),_()}))})}},{key:"runAnimationAsync",value:function(g,E,_){return void 0===_?new Promise(function(_){g.play(E),g.once(G.EventType.FINISHED,_)}):_.aborted?Promise.resolve():new Promise(function(k){_.addAbortListener(function(){g.off(G.EventType.FINISHED,k),g.stop(),k()}),g.play(E),g.once(G.EventType.FINISHED,k)})}}]),e}();_._RF.pop(),_._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var t$=k.ccclass,t0=k.property,t1=(tO=t$("AutoLayoutWrappee"),tB=t0({type:R}),tN=t0({type:R}),tO((tF=st((tD=Ue(function e(){Fe(this,e),rt(this,"wrapeeContainer",tF,this),rt(this,"wrapee",tU,this)})).prototype,"wrapeeContainer",[tB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tU=st(tD.prototype,"wrapee",[tN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tM=tD))||tM),t2=(tx=t$("AutoLayout"),tz=t0({displayName:"Use Auto Layout"}),tG=t0({type:[t1],displayName:"Children",visible:function(){return this.useAutoLayout}}),tV=t0({visible:!1,serializable:!0}),tK=t0({type:V,displayName:"Selected Index",visible:function(){return this.useAutoLayout}}),tH=t0({type:K,displayName:"Deselected Icon Width",group:"Edge Icons",visible:function(){return this.useAutoLayout}}),tq=t0({visible:!1,serializable:!0}),tx((tX=st((tj=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"useAutoLayout",tX,Ke(g)),rt(g,"children",tY,Ke(g)),g.mappedChildren=[],rt(g,"selected",tJ,Ke(g)),rt(g,"deselectedIconW",tQ,Ke(g)),g.tweens=[],g}return Ue(i,[{key:"selectedIndex",get:function(){return this.selected},set:function(g){this.selected=g,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(g){this.deselectedIconW=g,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map(function(g){var E=g.wrapeeContainer.getComponent(H);if(!E)throw new Error("AutoLayout: Widget component not found");return Me(Me({},g),{},{wrapeeContainerWidget:E})})}},{key:"updateLayout",value:function(g){var E=arguments.length>0&&void 0!==g&&g;if(this._layoutDirty||E){this.updateChildrenAnchors();var _,k=at(this.mappedChildren);try{for(k.s();!(_=k.n()).done;){var C=_.value;C.wrapeeContainerWidget.updateAlignment()}}catch(g){k.e(g)}finally{k.f()}}Je(Ve(i.prototype),"updateLayout",this).call(this,E)}},{key:"getSelectedWorldX",value:function(){var g=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?g.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*g.width:g.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(g){if(g<this.selectedIndex)return 0;if(g>this.selectedIndex)return 1;if(0===g){var E=this.mappedChildren[g].wrapeeContainer.width,_=this.deselectedIconWidth/2,k=this.paddingLeft;return((k+E+(E-_+this.spacingX))/2-k)/E}if(g===this.children.length-1){var C=this.mappedChildren[g].wrapeeContainer.width,A=C-this.deselectedIconWidth/2+this.spacingX;return((A+C+this.paddingRight)/2-A)/C}return .5}},{key:"updateChildrenAnchors",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=this,_=at(this.tweens);try{for(_.s();!(g=_.n()).done;)g.value.stop()}catch(g){_.e(g)}finally{_.f()}this.tweens=[];return[4,Promise.all([this.children.flatMap(function(g,_){return E.getChildrenAnchorsTweens(g,E.getAnchorX(_))}).map(function(g){return tZ.runTweenAsync(g)})])];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var g=this;this.children.forEach(function(E,_){var k=g.getAnchorX(_);E.wrapee.setAnchorPoint(k,E.wrapee.anchorY),E.wrapeeContainer.setAnchorPoint(k,E.wrapeeContainer.anchorY)})}},{key:"getChildrenAnchorsTweens",value:function(g,E){return[z(g.wrapee).to(.3,{anchorX:E},{easing:"sineInOut"}).call(function(){g.wrapee.setAnchorPoint(E,g.wrapee.anchorY)}),z(g.wrapeeContainer).to(.3,{anchorX:E},{easing:"sineInOut"}).call(function(){g.wrapeeContainer.setAnchorPoint(E,g.wrapeeContainer.anchorY)})]}}]),i}(q)).prototype,"useAutoLayout",[tz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),tY=st(tj.prototype,"children",[tG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tJ=st(tj.prototype,"selected",[tV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),st(tj.prototype,"selectedIndex",[tK],Object.getOwnPropertyDescriptor(tj.prototype,"selectedIndex"),tj.prototype),st(tj.prototype,"deselectedIconWidth",[tH],Object.getOwnPropertyDescriptor(tj.prototype,"deselectedIconWidth"),tj.prototype),tQ=st(tj.prototype,"deselectedIconW",[tq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tW=tj))||tW);_._RF.pop(),_._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);var t4="view-resize",t3="view-resized",t5="request-view-resize",t6="layout-changed",t8="gameplay-update-config",t9="opened-skip-overlay",t7="closed-skip-overlay",ne="result-scene-replay",nn="result-scene-home",ni="upgrade-dynamic-atlas",nr="asset-quality-change",na="change-quality-assets",no="widget-resized";_._RF.pop(),_._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);var ns=function(){function e(){Fe(this,e)}return Ue(e,[{key:"getWindowSizeVsWorldGameRatio",value:function(){var g=W.getVisibleSize(),E=j.windowSize.width,_=window.devicePixelRatio;return E/(_=_>2?2:_)/g.width}},{key:"getBoundingBoxTo",value:function(g,E){var _=X.mat4();X.Mat4.fromSRT(_,E.getRotation(),E.getPosition(),E.getScale());var k=E.getComponent(R);if(!k)throw new Error("Node must have UITransform component");var C=k.anchorPoint,A=k.contentSize,T=A.width,I=A.height,L=new X.Rect(-C.x*T,-C.y*I,T,I),P=X.mat4();if(X.Mat4.multiply(P,g,_),L.transformMat4(P),!E.children||0===E.children.length)return L;var O,B=E.children,N=E.getWorldMatrix(),M=at(B);try{for(M.s();!(O=M.n()).done;){var D=O.value;if(null!=D&&D.active){if(D.getComponent(R)){var F=this.getBoundingBoxTo(N,D);F&&X.Rect.union(L,L,F)}}}}catch(g){M.e(g)}finally{M.f()}return L}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getBoundingBoxToWorld",value:function(g){if(g.parent){var E=g.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(E,g)}var _=g.getComponent(R);if(!_)throw new Error("Node must have UITransform component");return _.getBoundingBox()}},{key:"worldSizeToCssSize",value:function(g){return g*this.inst.getWindowSizeVsWorldGameRatio()}},{key:"cssSizeToWorldSize",value:function(g){return g/this.inst.getWindowSizeVsWorldGameRatio()}},{key:"getScreenWidthCss",value:function(){var g=document,E=g.body,_=g.documentElement,k=E.clientWidth,C=_.clientWidth;return Math.max(C,k)||0}},{key:"getScreenHeightCss",value:function(){var g=document,E=g.body,_=g.documentElement,k=E.clientHeight,C=_.clientHeight;return Math.max(C,k)||0}}]),e}();_._RF.pop(),_._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);var nl,nu,nc,nh,np=GameCore.Utils,nd=np.Array,nf=np.Object,ny=np.Valid,nv=np.String,ng=globalThis.game.monitorError,nm="compUtils",nb="".concat(nm,"_validateProperty"),jn=function(g){return"".concat(nb,"_").concat(nv.capitalize(g))},nw="".concat(nm,"_getComponent"),nS=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"".concat(g," is missing the required property: <").concat(_,">"))).className=g,k.propertyName=_,k}return Ue(n)}(je(Error)),nE=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"".concat(g," is missing these required properties: [").concat(_.map(function(g){return g.propertyName}).join(", "),"]"))).className=g,k.errors=_,k}return Ue(n)}(je(Error)),n_=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"],nk=function(){function e(){Fe(this,e),this.validComponentCalled={}}return Ue(e,[{key:"validateRequiredComponents",value:function(g){var E,_=g.name,k=g.constructor,C=at(this.getRequiredComponentNames(k));try{for(C.s();!(E=C.n()).done;){var A=E.value;if(!g.getComponent(A))throw new Error("".concat(_,": Missing required ").concat(A," component"))}}catch(g){C.e(g)}finally{C.f()}}},{key:"validateRequiredProperties",value:function(g){var E,_=g.name,k=g.constructor,C=at(this.getRequiredPropNames(k));try{for(C.s();!(E=C.n()).done;){var A=E.value;if(!nf.hasOwn(g,A))throw new Error("".concat(_,": Missing required ").concat(A," property"));var T=this.getProperty(A,g);if(!Y(T))throw new Error("".concat(_,": ").concat(A," property is not a cc object"))}}catch(g){C.e(g)}finally{C.f()}}},{key:"validateCustomProperties",value:function(g){var E,_=g.name,k=at(this.getCustomPropNames(g));try{for(k.s();!(E=k.n()).done;){var C=E.value;if(!nf.hasOwn(g,C))throw new Error("".concat(_,": Missing required ").concat(C," property"));var A=this.getProperty(C,g);if(!Y(A))throw new Error("".concat(_,": ").concat(C," property is not a cc object"))}}catch(g){k.e(g)}finally{k.f()}}},{key:"getProperty",value:function(g,E){var _;if(nf.hasOwn(E,g))return(null!==(_=Object.getOwnPropertyDescriptor(E,g))&&void 0!==_?_:{}).value}},{key:"getProps",value:function(g){if(!nf.hasOwn(g,"__props__"))return[];var E=g.__props__;return Array.isArray(E)?E:[]}},{key:"getRequiredPropNames",value:function(g){return this.getProps(g).filter(function(E){return"node"!==E&&!!nf.hasOwn(g,E)&&!!Y(g[E])&&!E.startsWith("_")})}},{key:"getBaseComponentName",value:function(g){for(var E=0,_=n_;E<_.length;E++){var k=_[E];if(k.indexOf(g)>=0)return k}return g}},{key:"getRequiredComponentNames",value:function(g){var E=this;if(!nf.hasOwn(g,"_requireComponent"))return[];var _=g._requireComponent;return Array.isArray(_)?_.map(function(g){return E.getBaseComponentName(g)}):[]}},{key:"getCustomPropNames",value:function(g){var E=this,_=Object.keys(g),k=this.getProps(g.constructor);return nd.difference(_,k).filter(function(g){return g.indexOf("_")<0}).filter(function(_){if(!nf.hasOwn(g,_))return!1;var k=E.getProperty(_,g);return!(!ny.isObject(k)||!Y(k))})}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"required",value:function(g){var E=arguments.length>0&&void 0!==g?g:"both",t=function(g){if("function"==typeof E)return E(g);switch(E){case"null-check":return null!==g;case"undefined-check":return void 0!==g;case"both":return null!=g;default:return!1}};return function(g,E){if("function"==typeof g)throw new Error("The required decorator can only be applied to non-static class properties.");var _=jn(E);if(void 0!==g[_])throw new Error("The required decorator found that property name ".concat(_," already exists. The reserved method name ").concat(_," is used already or the decorator was applied multiple times."));g[_]=function(g){if(!t(this[E]))throw new nS(g,E)}}}},{key:"validateDecoratedProperties",value:function(g){var E,_=g.constructor.name,k=[],C=g;for(var A in C)if("function"==typeof C[A]&&(E=A,nv.matchStart(E,nb)))try{C[A]()}catch(g){if(_instanceof(g,nS)){k.push(g);continue}throw g}if(0!==k.length){var T=new nE(_,k);if(ny.isDebugger())throw T;console.error(T),null==ng||ng.sendException(T,{componentName:T.className,missingProperties:T.errors.map(function(g){return g.propertyName})})}}},{key:"getComponent",value:function(g){return function(E,_){if("function"==typeof E)throw new Error("The getComponent decorator can only be applied to non-static class properties.");var k,C=(k=_,"".concat(nw,"_").concat(nv.capitalize(k)));if(void 0!==E[C])throw new Error("The getComponent decorator found that property name ".concat(C," already exists. The reserved method name ").concat(C," is used already or the decorator was applied multiple times."));E[C]=function(E){E[_]=E.getComponent(g)}}}},{key:"getDecoratedComponent",value:function(g){var E,_=g;for(var k in _)"function"==typeof _[k]&&(E=k,nv.matchStart(E,nw)&&_[k](g))}},{key:"onlyRunInLifeCycle",value:function(g,E,_){var k=_.value;_.value=function(){if(this.enabledInHierarchy){for(var g=arguments.length,_=new Array(g),C=0;C<g;C++)_[C]=arguments[C];return k.apply(this,_)}console.info("Skipping method call ".concat(String(E)," because component ").concat(this.constructor.name," is not enabled in hierarchy"))}}},{key:"onlyRunInLifeCycleAsync",value:function(g,E,_){var k=_.value,C=function(){var g=Be(function(){var g,_,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:if(!this.enabledInHierarchy)return[3,2];for(g=A.length,_=new Array(g),C=0;C<g;C++)_[C]=A[C];return[4,k.apply(this,_)];case 1:return[2,T.sent()];case 2:return[2,(console.info("Skipping method call ".concat(String(E)," because component ").concat(this.constructor.name," is not enabled in hierarchy")),Promise.resolve())]}})});return function(){return g.apply(this,arguments)}}();_.value=C}},{key:"decorateComponent",value:function(g){this.getDecoratedComponent(g),this.validateDecoratedProperties(g)}},{key:"lazyValidateProperties",value:function(g,E){var _=!(arguments.length>1&&void 0!==E)||E;if(_){var k=g.constructor,C=k.name;if(!this.inst.validComponentCalled[C])try{this.inst.validateRequiredComponents(g),this.inst.validateRequiredProperties(g),this.inst.validateCustomProperties(g)}catch(E){g.enabled=!1,console.error(E)}finally{this.inst.validComponentCalled[C]=!0}}}}]),e}();_._RF.pop(),_._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);var nC=k.ccclass,nA=k.property;nl=nC("Background"),nu=nA(J),nl((nh=st((nc=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"fitHeight",nh,Ke(g)),g.resize=function(){if(g.fitHeight){var E=ns.cssSizeToWorldSize(ns.getScreenHeightCss());g.uiTransform.width=E*g.ratio,g.uiTransform.height=E}},g}return Ue(n,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.ratio=this.uiTransform.width/this.uiTransform.height,this.validateRequiredComponents(),this.listenGameEvents(),this.resize()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t3,this.resize)}},{key:"unlistenGameEvents",value:function(){Q.off(t3,this.resize)}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}}]),n}(M)).prototype,"fitHeight",[nu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nc));_._RF.pop(),_._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var nT="STARS_UPDATED",nR="PLAY_BUTTON_PRESS",nI="REQUEST_NAVIGATION",nL="REQUEST_NAVIGATION_ANIMATION",nP="DASHBOARD_EVENTS_BUTTON_PRESS";_._RF.pop(),_._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var nO=function(g){return g[g.store=0]="store",g[g.collections=1]="collections",g[g.home=2]="home",g[g.leaderboard=3]="leaderboard",g[g.tournaments=4]="tournaments",g}(nO||{});Z(nO),_._RF.pop(),_._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);var nB=GameCore.Utils.Array,nN=function(){function e(){Fe(this,e),this.callbacks=[],this.isAborted=!1,this.abortReason="",this.callbacks=[]}var g;return Ue(e,[{key:"aborted",get:function(){return this.isAborted}},{key:"reason",get:function(){return this.abortReason}},{key:"addAbortListener",value:function(g){this.callbacks.push(g)}},{key:"removeAbortListener",value:function(g){var E=nB.searchIndex(this.callbacks,function(E){return E===g});-1!==E?this.callbacks.splice(E,1):console.warn("Abort listener not found")}},{key:"abort",value:function(g){if(!this.isAborted){this.isAborted=!0,this.abortReason=g;var E,_=at(this.callbacks);try{for(_.s();!(E=_.n()).done;){var k=E.value;"function"==typeof k&&k()}}catch(g){_.e(g)}finally{_.f()}this.callbacks=[]}}},{key:"untilAborted",value:(g=Be(function(){var g;return _ts_generator(this,function(E){g=this;if(!this.isAborted)return[2,new Promise(function(E){g.addAbortListener(function(){return E()})})];return[2]})}),function(){return g.apply(this,arguments)})},{key:"call",value:function(g){this.aborted||g(this)}},{key:"callAsync",value:function(g){return this.aborted?Promise.resolve():g(this)}},{key:"chain",value:function(g){var E=this;_instanceof(g,e)?g.addAbortListener(function(){return E.abort()}):g.addEventListener("abort",function(){return E.abort()})}}],[{key:"hasBeenAborted",value:function(g){return null==g||g.aborted}}]),e}();_._RF.pop(),_._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var nM=function(g){return g.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",g.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",g.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",g.CLOUD_IDLE_ANIM="animations/CloudIdle",g.TORNADO_IDLE_ANIM="animations/TornadoIdle",g.TILE_BREAK_ANIM="animations/TileBreak",g.TILE_CLEAR_ANIM="animations/TileClear",g.TILE_SHAKE_ANIM="animations/TileShake",g.TILE_SKIN_FOLDER="loadable/tiles",g.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",g.ITEM_POPUP_FOLDER="loadable/item-popup",g.SUMMER_BG="images/bg/summer",g.AUTUMN_BG="images/bg/autumn",g.WINTER_BG="images/bg/winter",g.FLOWER_FIELD_BG="images/bg/flower-field",g.TREE_PLANTING_FESTIVAL_BG="images/bg/tree-planting-festival",g.MUSIC_FESTIVAL_BG="images/bg/music-festival",g.HARVEST_FESTIVAL_BG="images/bg/harvest-festival",g.FOOD_FESTIVAL_BG="images/bg/food-festival",g.LIGHT_FESTIVAL_BG="images/bg/light-festival",g.PEACE_FESTIVAL_BG="images/bg/peace-festival",g.FLOWER_FESTIVAL_BG="images/bg/flower-festival",g.STREET_FESTIVAL_BG="images/bg/street-festival",g.COLOR_GARDEN_BG="images/bg/color-garden",g.COLOR_FESTIVAL_BG="images/bg/color-festival",g.NATURE_SUMMER_BG="images/bg/nature-summer",g.SNOW_MOUNTAIN_BG="images/bg/snow-mountain",g.ICE_FESTIVAL_BG="images/bg/ice-festival",g.NIGHT_FESTIVAL_BG="images/bg/night-festival",g.LOST_FESTIVAL_BG="images/bg/lost-festival",g.HALLOWEEN_BG="images/bg/halloween",g.CHRISTMAS_BG="images/bg/christmas",g.SPRING_FLOWER_FESTIVAL_BG="images/bg/spring-flower-festival",g.TET_HOLIDAY_BG="images/bg/tet-holiday",g.SEA_FESTIVAL_BG="images/bg/sea-festival",g.FIREWORK_FESTIVAL_BG="images/bg/firework-festival",g.SUMMER_BG_PREVIEW="images/preview/summer",g.AUTUMN_BG_PREVIEW="images/preview/autumn",g.WINTER_BG_PREVIEW="images/preview/winter",g.FLOWER_FIELD_BG_PREVIEW="images/preview/flower-field",g.TREE_PLANTING_FESTIVAL_BG_PREVIEW="images/preview/tree-planting-festival",g.MUSIC_FESTIVAL_BG_PREVIEW="images/preview/music-festival",g.HARVEST_FESTIVAL_BG_PREVIEW="images/preview/harvest-festival",g.FOOD_FESTIVAL_BG_PREVIEW="images/preview/food-festival",g.LIGHT_FESTIVAL_BG_PREVIEW="images/preview/light-festival",g.PEACE_FESTIVAL_BG_PREVIEW="images/preview/peace-festival",g.FLOWER_FESTIVAL_BG_PREVIEW="images/preview/flower-festival",g.STREET_FESTIVAL_BG_PREVIEW="images/preview/street-festival",g.COLOR_GARDEN_BG_PREVIEW="images/preview/color-garden",g.COLOR_FESTIVAL_BG_PREVIEW="images/preview/color-festival",g.NATURE_SUMMER_BG_PREVIEW="images/preview/nature-summer",g.SNOW_MOUNTAIN_BG_PREVIEW="images/preview/snow-mountain",g.ICE_FESTIVAL_BG_PREVIEW="images/preview/ice-festival",g.NIGHT_FESTIVAL_BG_PREVIEW="images/preview/night-festival",g.LOST_FESTIVAL_BG_PREVIEW="images/preview/lost-festival",g.HALLOWEEN_BG_PREVIEW="images/preview/halloween",g.CHRISTMAS_BG_PREVIEW="images/preview/christmas",g.SPRING_FLOWER_FESTIVAL_BG_PREVIEW="images/preview/spring-flower-festival",g.TET_HOLIDAY_BG_PREVIEW="images/preview/tet-holiday",g.SEA_FESTIVAL_BG_PREVIEW="images/preview/sea-festival",g.FIREWORK_FESTIVAL_BG_PREVIEW="images/preview/firework-festival",g.SUMMER_BG_TOURNAMENT="images/tournament/summer",g.AUTUMN_BG_TOURNAMENT="images/tournament/autumn",g.WINTER_BG_TOURNAMENT="images/tournament/winter",g.FLOWER_FIELD_BG_TOURNAMENT="images/tournament/flower-field",g.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT="images/tournament/tree-planting-festival",g.MUSIC_FESTIVAL_BG_TOURNAMENT="images/tournament/music-festival",g.HARVEST_FESTIVAL_BG_TOURNAMENT="images/tournament/harvest-festival",g.FOOD_FESTIVAL_BG_TOURNAMENT="images/tournament/food-festival",g.LIGHT_FESTIVAL_BG_TOURNAMENT="images/tournament/light-festival",g.PEACE_FESTIVAL_BG_TOURNAMENT="images/tournament/peace-festival",g.FLOWER_FESTIVAL_BG_TOURNAMENT="images/tournament/flower-festival",g.STREET_FESTIVAL_BG_TOURNAMENT="images/tournament/street-festival",g.COLOR_GARDEN_BG_TOURNAMENT="images/tournament/color-garden",g.COLOR_FESTIVAL_BG_TOURNAMENT="images/tournament/color-festival",g.NATURE_SUMMER_BG_TOURNAMENT="images/tournament/nature-summer",g.SNOW_MOUNTAIN_BG_TOURNAMENT="images/tournament/snow-mountain",g.ICE_FESTIVAL_BG_TOURNAMENT="images/tournament/ice-festival",g.NIGHT_FESTIVAL_BG_TOURNAMENT="images/tournament/night-festival",g.LOST_FESTIVAL_BG_TOURNAMENT="images/tournament/lost-festival",g.HALLOWEEN_BG_TOURNAMENT="images/tournament/halloween",g.CHRISTMAS_BG_TOURNAMENT="images/tournament/christmas",g.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT="images/tournament/spring-flower-festival",g.TET_HOLIDAY_BG_TOURNAMENT="images/tournament/tet-holiday",g.SEA_FESTIVAL_BG_TOURNAMENT="images/tournament/sea-festival",g.FIREWORK_FESTIVAL_BG_TOURNAMENT="images/tournament/firework-festival",g.SUMMER_BG_THUMBNAIL="images/thumbnail/summer",g.AUTUMN_BG_THUMBNAIL="images/thumbnail/autumn",g.WINTER_BG_THUMBNAIL="images/thumbnail/winter",g.FLOWER_FIELD_BG_THUMBNAIL="images/thumbnail/flower-field",g.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL="images/thumbnail/tree-planting-festival",g.MUSIC_FESTIVAL_BG_THUMBNAIL="images/thumbnail/music-festival",g.HARVEST_FESTIVAL_BG_THUMBNAIL="images/thumbnail/harvest-festival",g.FOOD_FESTIVAL_BG_THUMBNAIL="images/thumbnail/food-festival",g.LIGHT_FESTIVAL_BG_THUMBNAIL="images/thumbnail/light-festival",g.PEACE_FESTIVAL_BG_THUMBNAIL="images/thumbnail/peace-festival",g.FLOWER_FESTIVAL_BG_THUMBNAIL="images/thumbnail/flower-festival",g.STREET_FESTIVAL_BG_THUMBNAIL="images/thumbnail/street-festival",g.COLOR_GARDEN_BG_THUMBNAIL="images/thumbnail/color-garden",g.COLOR_FESTIVAL_BG_THUMBNAIL="images/thumbnail/color-festival",g.NATURE_SUMMER_BG_THUMBNAIL="images/thumbnail/nature-summer",g.SNOW_MOUNTAIN_BG_THUMBNAIL="images/thumbnail/snow-mountain",g.ICE_FESTIVAL_BG_THUMBNAIL="images/thumbnail/ice-festival",g.NIGHT_FESTIVAL_BG_THUMBNAIL="images/thumbnail/night-festival",g.LOST_FESTIVAL_BG_THUMBNAIL="images/thumbnail/lost-festival",g.HALLOWEEN_BG_THUMBNAIL="images/thumbnail/halloween",g.CHRISTMAS_BG_THUMBNAIL="images/thumbnail/christmas",g.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL="images/thumbnail/spring-flower-festival",g.TET_HOLIDAY_BG_THUMBNAIL="images/thumbnail/tet-holiday",g.SEA_FESTIVAL_BG_THUMBNAIL="images/thumbnail/sea-festival",g.FIREWORK_FESTIVAL_BG_THUMBNAIL="images/thumbnail/firework-festival",g.COLLECTIONS_PAGE="pages/CollectionsContent",g.LEADERBOARD_PAGE="pages/LeaderboardContent",g.TOURNAMENTS_PAGE="pages/TournamentsContent",g.LEVEL_DATA_FOLDER="levels-json",g}(nM||{});_._RF.pop(),_._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);var nD={summer:nM.SUMMER_BG,autumn:nM.AUTUMN_BG,winter:nM.WINTER_BG,"spring-festival":nM.FLOWER_FIELD_BG,"tree-planting-festival":nM.TREE_PLANTING_FESTIVAL_BG,"blue-sea-festival":nM.SEA_FESTIVAL_BG,"music-festival":nM.MUSIC_FESTIVAL_BG,"harvest-festival":nM.HARVEST_FESTIVAL_BG,"food-festival":nM.FOOD_FESTIVAL_BG,"snow-festival":nM.WINTER_BG,"light-festival":nM.LIGHT_FESTIVAL_BG,"peace-festival":nM.PEACE_FESTIVAL_BG,"flower-festival":nM.FLOWER_FESTIVAL_BG,"street-festival":nM.STREET_FESTIVAL_BG,"color-garden":nM.COLOR_GARDEN_BG,"color-festival":nM.COLOR_FESTIVAL_BG,"nature-summer":nM.NATURE_SUMMER_BG,"snow-mountain":nM.SNOW_MOUNTAIN_BG,"ice-festival":nM.ICE_FESTIVAL_BG,"green-grass-festival":nM.FLOWER_FIELD_BG,"community-festival":nM.NIGHT_FESTIVAL_BG,"water-festival":nM.SEA_FESTIVAL_BG,"animal-festival":nM.TREE_PLANTING_FESTIVAL_BG,"lost-festival":nM.LOST_FESTIVAL_BG,"halloween-festival":nM.HALLOWEEN_BG,"snow-music-festival":nM.MUSIC_FESTIVAL_BG,christmas:nM.CHRISTMAS_BG,"spring-flower-festival":nM.SPRING_FLOWER_FESTIVAL_BG,"tet-holiday":nM.TET_HOLIDAY_BG,"sea-festival":nM.SEA_FESTIVAL_BG,"firework-festival":nM.FIREWORK_FESTIVAL_BG,"halloween-horror":nM.HALLOWEEN_BG,"mid-autumn":nM.SPRING_FLOWER_FESTIVAL_BG,"christmas-sweet":nM.CHRISTMAS_BG,"new-year-countdown":nM.TET_HOLIDAY_BG},nF={summer:nM.SUMMER_BG_PREVIEW,autumn:nM.AUTUMN_BG_PREVIEW,winter:nM.WINTER_BG_PREVIEW,"spring-festival":nM.FLOWER_FIELD_BG_PREVIEW,"tree-planting-festival":nM.TREE_PLANTING_FESTIVAL_BG_PREVIEW,"blue-sea-festival":nM.SEA_FESTIVAL_BG_PREVIEW,"music-festival":nM.MUSIC_FESTIVAL_BG_PREVIEW,"harvest-festival":nM.HARVEST_FESTIVAL_BG_PREVIEW,"food-festival":nM.FOOD_FESTIVAL_BG_PREVIEW,"snow-festival":nM.WINTER_BG_PREVIEW,"light-festival":nM.LIGHT_FESTIVAL_BG_PREVIEW,"peace-festival":nM.PEACE_FESTIVAL_BG_PREVIEW,"flower-festival":nM.FLOWER_FESTIVAL_BG_PREVIEW,"street-festival":nM.STREET_FESTIVAL_BG_PREVIEW,"color-garden":nM.COLOR_GARDEN_BG_PREVIEW,"color-festival":nM.COLOR_FESTIVAL_BG_PREVIEW,"nature-summer":nM.NATURE_SUMMER_BG_PREVIEW,"snow-mountain":nM.SNOW_MOUNTAIN_BG_PREVIEW,"ice-festival":nM.ICE_FESTIVAL_BG_PREVIEW,"green-grass-festival":nM.FLOWER_FIELD_BG_PREVIEW,"community-festival":nM.NIGHT_FESTIVAL_BG_PREVIEW,"water-festival":nM.SEA_FESTIVAL_BG_PREVIEW,"animal-festival":nM.TREE_PLANTING_FESTIVAL_BG_PREVIEW,"lost-festival":nM.LOST_FESTIVAL_BG_PREVIEW,"halloween-festival":nM.HALLOWEEN_BG_PREVIEW,"snow-music-festival":nM.MUSIC_FESTIVAL_BG_PREVIEW,christmas:nM.CHRISTMAS_BG_PREVIEW,"spring-flower-festival":nM.SPRING_FLOWER_FESTIVAL_BG_PREVIEW,"tet-holiday":nM.TET_HOLIDAY_BG_PREVIEW,"sea-festival":nM.SEA_FESTIVAL_BG_PREVIEW,"firework-festival":nM.FIREWORK_FESTIVAL_BG_PREVIEW,"halloween-horror":nM.HALLOWEEN_BG_PREVIEW,"mid-autumn":nM.SPRING_FLOWER_FESTIVAL_BG_PREVIEW,"christmas-sweet":nM.CHRISTMAS_BG_PREVIEW,"new-year-countdown":nM.TET_HOLIDAY_BG_PREVIEW},nU={summer:nM.SUMMER_BG_TOURNAMENT,autumn:nM.AUTUMN_BG_TOURNAMENT,winter:nM.WINTER_BG_TOURNAMENT,"spring-festival":nM.FLOWER_FIELD_BG_TOURNAMENT,"tree-planting-festival":nM.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT,"blue-sea-festival":nM.SEA_FESTIVAL_BG_TOURNAMENT,"music-festival":nM.MUSIC_FESTIVAL_BG_TOURNAMENT,"harvest-festival":nM.HARVEST_FESTIVAL_BG_TOURNAMENT,"food-festival":nM.FOOD_FESTIVAL_BG_TOURNAMENT,"snow-festival":nM.WINTER_BG_TOURNAMENT,"light-festival":nM.LIGHT_FESTIVAL_BG_TOURNAMENT,"peace-festival":nM.PEACE_FESTIVAL_BG_TOURNAMENT,"flower-festival":nM.FLOWER_FESTIVAL_BG_TOURNAMENT,"street-festival":nM.STREET_FESTIVAL_BG_TOURNAMENT,"color-garden":nM.COLOR_GARDEN_BG_TOURNAMENT,"color-festival":nM.COLOR_FESTIVAL_BG_TOURNAMENT,"nature-summer":nM.NATURE_SUMMER_BG_TOURNAMENT,"snow-mountain":nM.SNOW_MOUNTAIN_BG_TOURNAMENT,"ice-festival":nM.ICE_FESTIVAL_BG_TOURNAMENT,"green-grass-festival":nM.FLOWER_FIELD_BG_TOURNAMENT,"community-festival":nM.NIGHT_FESTIVAL_BG_TOURNAMENT,"water-festival":nM.SEA_FESTIVAL_BG_TOURNAMENT,"animal-festival":nM.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT,"lost-festival":nM.LOST_FESTIVAL_BG_TOURNAMENT,"halloween-festival":nM.HALLOWEEN_BG_TOURNAMENT,"snow-music-festival":nM.MUSIC_FESTIVAL_BG_TOURNAMENT,christmas:nM.CHRISTMAS_BG_TOURNAMENT,"spring-flower-festival":nM.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT,"tet-holiday":nM.TET_HOLIDAY_BG_TOURNAMENT,"sea-festival":nM.SEA_FESTIVAL_BG_TOURNAMENT,"firework-festival":nM.FIREWORK_FESTIVAL_BG_TOURNAMENT,"halloween-horror":nM.HALLOWEEN_BG_TOURNAMENT,"mid-autumn":nM.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT,"christmas-sweet":nM.CHRISTMAS_BG_TOURNAMENT,"new-year-countdown":nM.TET_HOLIDAY_BG_TOURNAMENT},nx={summer:nM.SUMMER_BG_THUMBNAIL,autumn:nM.AUTUMN_BG_THUMBNAIL,winter:nM.WINTER_BG_THUMBNAIL,"spring-festival":nM.FLOWER_FIELD_BG_THUMBNAIL,"tree-planting-festival":nM.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL,"blue-sea-festival":nM.SEA_FESTIVAL_BG_THUMBNAIL,"music-festival":nM.MUSIC_FESTIVAL_BG_THUMBNAIL,"harvest-festival":nM.HARVEST_FESTIVAL_BG_THUMBNAIL,"food-festival":nM.FOOD_FESTIVAL_BG_THUMBNAIL,"snow-festival":nM.WINTER_BG_THUMBNAIL,"light-festival":nM.LIGHT_FESTIVAL_BG_THUMBNAIL,"peace-festival":nM.PEACE_FESTIVAL_BG_THUMBNAIL,"flower-festival":nM.FLOWER_FESTIVAL_BG_THUMBNAIL,"street-festival":nM.STREET_FESTIVAL_BG_THUMBNAIL,"color-garden":nM.COLOR_GARDEN_BG_THUMBNAIL,"color-festival":nM.COLOR_FESTIVAL_BG_THUMBNAIL,"nature-summer":nM.NATURE_SUMMER_BG_THUMBNAIL,"snow-mountain":nM.SNOW_MOUNTAIN_BG_THUMBNAIL,"ice-festival":nM.ICE_FESTIVAL_BG_THUMBNAIL,"green-grass-festival":nM.FLOWER_FIELD_BG_THUMBNAIL,"community-festival":nM.NIGHT_FESTIVAL_BG_THUMBNAIL,"water-festival":nM.SEA_FESTIVAL_BG_THUMBNAIL,"animal-festival":nM.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL,"lost-festival":nM.LOST_FESTIVAL_BG_THUMBNAIL,"halloween-festival":nM.HALLOWEEN_BG_THUMBNAIL,"snow-music-festival":nM.MUSIC_FESTIVAL_BG_THUMBNAIL,christmas:nM.CHRISTMAS_BG_THUMBNAIL,"spring-flower-festival":nM.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL,"tet-holiday":nM.TET_HOLIDAY_BG_THUMBNAIL,"sea-festival":nM.SEA_FESTIVAL_BG_THUMBNAIL,"firework-festival":nM.FIREWORK_FESTIVAL_BG_THUMBNAIL,"halloween-horror":nM.HALLOWEEN_BG_THUMBNAIL,"mid-autumn":nM.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL,"christmas-sweet":nM.CHRISTMAS_BG_THUMBNAIL,"new-year-countdown":nM.TET_HOLIDAY_BG_THUMBNAIL};_._RF.pop(),_._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);var nz,nG,nV,nK,nH,nq,nW,nj,nX,nY,nJ,nQ,nZ,n$,n0,n1,n2,n4,n3,n5,n6,n8,n9,n7=function(){function e(){Fe(this,e)}var g,E,_,k,C,A,T,R,I,L,P,O;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"setBlockInput",value:function(g){var E=$("Canvas/InputBlocker");E?E.active=g:console.warn("InputBlocker not found")}},{key:"getBlockInput",value:function(){var g=$("Canvas/InputBlocker");return g?g.active:(console.warn("InputBlocker not found"),!1)}},{key:"loadPrefabAsync",value:function(g){var E=this.getAsset(g,ee);return null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,ee,function(g,_){E(g?null:_)})})}},{key:"loadJsonAsync",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){E=this;return[2,new Promise(function(_){var k=E.getAsset(g,en);null===k?F.load(g,en,function(g,E){g?_(null):E&&E.json?_(E.json):_(null)}):_(k.json)})]})}),function(g){return O.apply(this,arguments)})},{key:"loadAudioClipAsync",value:(P=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,U);return[2,null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,U,function(g,_){E(g?null:_)})})]})}),function(g){return P.apply(this,arguments)})},{key:"loadAnimClipAsync",value:(L=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,ei);return[2,null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,ei,function(g,_){E(g?null:_)})})]})}),function(g){return L.apply(this,arguments)})},{key:"loadImageSpriteFrameAsync",value:(I=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,er);return[2,null!==E?Promise.resolve(ea.createWithImage(E)):new Promise(function(E){F.load(g,er,function(g,_){E(g?null:ea.createWithImage(_))})})]})}),function(g){return I.apply(this,arguments)})},{key:"loadSpriteFrameAsync",value:(R=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){E=!(k.length>1&&void 0!==k[1])||k[1],_=this.getAsset(g,ea);return[2,null!==_?(_.packable=E,Promise.resolve(_)):new Promise(function(_){F.load(g,ea,function(g,k){!g&&k?(k.packable=E,_(k)):_(null)})})]})}),function(g){return R.apply(this,arguments)})},{key:"loadSpriteFramesDirAsync",value:(T=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){E=F.getDirWithPath(g,ea);if(E.length>0){k=[],C=at(E);try{for(C.s();!(_=C.n()).done;){A=_.value,T=F.get(A.path,ea);if(!T)return[2,this.loadSpriteFramesFromDirAsync(g)];k.push(T)}}catch(g){C.e(g)}finally{C.f()}return[2,k]}return[2,this.loadSpriteFramesFromDirAsync(g)]})}),function(g){return T.apply(this,arguments)})},{key:"loadSpriteFramesFromDirAsync",value:(A=Be(function(g){return _ts_generator(this,function(E){return[2,new Promise(function(E){F.loadDir(g,ea,function(g,_){E(g?[]:_)})})]})}),function(g){return A.apply(this,arguments)})},{key:"loadThemeAsync",value:(C=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nD[g],"/spriteFrame"))]})}),function(g){return C.apply(this,arguments)})},{key:"loadThemePreviewAsync",value:(k=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nF[g],"/spriteFrame"))]})}),function(g){return k.apply(this,arguments)})},{key:"loadThemeTournamentAsync",value:(_=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nU[g],"/spriteFrame"))]})}),function(g){return _.apply(this,arguments)})},{key:"loadThemeThumbnailAsync",value:(E=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nx[g],"/spriteFrame"))]})}),function(g){return E.apply(this,arguments)})},{key:"loadSkinPreviewAsync",value:(g=Be(function(g){var E,_,k;return _ts_generator(this,function(C){for(E=[],_=1;_<=4;_++){k="".concat(nM.TILE_SKIN_PREVIEW_FOLDER,"/").concat(g.replace(/-/g,"_"),"_").concat(_,"/spriteFrame");E.push(this.loadSpriteFrameAsync(k))}return[2,Promise.all(E)]})}),function(E){return g.apply(this,arguments)})},{key:"getAsset",value:function(g,E){var _=F.getInfoWithPath(g,E);return _?F.get(_.path,E):null}}]),e}();_._RF.pop(),_._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var ie=k.ccclass,ii=k.property,ir=globalThis.game.monitorError,ia=GameCore.Utils.Number,io=(nz=ie("MultiBackground"),nG=ii({type:eo}),nV=ii({type:eo}),nK=ii({type:R}),nH=ii({type:R}),nq=ii({type:R}),nW=ii(V),nj=ii(H),nX=ii({type:es(nO)}),nY=ii({type:es(nO)}),nJ=nk.onlyRunInLifeCycleAsync,nQ=nk.onlyRunInLifeCycle,nz((n0=st((n$=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background1",n0,Ke(g)),rt(g,"background2",n1,Ke(g)),rt(g,"screenUiTransform",n2,Ke(g)),rt(g,"background1UiTransform",n4,Ke(g)),rt(g,"background2UiTransform",n3,Ke(g)),rt(g,"backgroundNudgeAmount",n5,Ke(g)),rt(g,"nudgeableWidget",n6,Ke(g)),rt(g,"pageOrder",n8,Ke(g)),rt(g,"homePage",n9,Ke(g)),g.currentThemeId="",g.tryNudgeBackground=function(E){var _=E.to,k=g.getDirection(g.homePage,_),C=ia.sign(k),A=Math.abs(k),T=g.backgroundNudgeAmount*A,R=Math.min(g.background1UiTransform.width,g.background2UiTransform.width),I=Math.max(0,(R-g.screenUiTransform.width)/2),L=Math.min(I,T)*C;z(g.nudgeableWidget).to(.5,{horizontalCenter:L},{easing:el.cubicInOut}).start()},g}return Ue(a,[{key:"onLoad",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,nk.lazyValidateProperties(this),this.listenToNavigationEvents()}},{key:"onDestroy",value:function(){var g;null===(g=this.tweenSignal)||void 0===g||g.abort(),this.unlistenToNavigationEvents()}},{key:"listenToNavigationEvents",value:function(){this.node.scene.on(nL,this.tryNudgeBackground)}},{key:"unlistenToNavigationEvents",value:function(){this.node.scene.off(nL,this.tryNudgeBackground)}},{key:"getDirection",value:function(g,E){var _=this.pageOrder.indexOf(g),k=this.pageOrder.indexOf(E);return -1===_||-1===k?(null==ir||ir.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):_-k}},{key:"setCurrentTheme",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,n7.loadThemeAsync(g)];case 1:E=_.sent();E?this.updateBackgroundSprites(E,g):null==ir||ir.sendException(new Error("MultiBackground.setCurrentTheme: Failed to load theme ".concat(g,"'s sprite.")));return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"updateBackgroundSprites",value:function(g,E){g.packable=!1,this.background1.spriteFrame=g,this.background2.spriteFrame=g,this.currentThemeId=E}},{key:"animateToNextTheme",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(this.currentThemeId===g)return[2,Promise.resolve()];return[4,n7.loadThemeAsync(g)];case 1:_=A.sent();if(!_)return[3,3];_.packable=!1,this.currentThemeId=g,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=_,this.nextBackground.node.setSiblingIndex(1);k=this.nextBackground.getComponent(eu);if(!k)throw new Error("".concat(this.nextBackground.node.name," UIOpacity is required"));k.opacity=0,null===(E=this.tweenSignal)||void 0===E||E.abort(),this.tweenSignal=new nN;return[4,tZ.runTweenAsync(z(k).to(1,{opacity:255}),this.tweenSignal)];case 2:if(A.sent(),!this.tweenSignal.aborted){this.currentBackground.node.active=!1;C=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=C}return[3,4];case 3:null==ir||ir.sendException(new Error("MultiBackground.animateToNextTheme: Failed to load theme ".concat(g,"'s sprite.")));A.label=4;case 4:return[2]}})}),function(g){return E.apply(this,arguments)})}]),a}(M)).prototype,"background1",[nG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n1=st(n$.prototype,"background2",[nV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n2=st(n$.prototype,"screenUiTransform",[nK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n4=st(n$.prototype,"background1UiTransform",[nH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n3=st(n$.prototype,"background2UiTransform",[nq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n5=st(n$.prototype,"backgroundNudgeAmount",[nW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),n6=st(n$.prototype,"nudgeableWidget",[nj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n8=st(n$.prototype,"pageOrder",[nX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),n9=st(n$.prototype,"homePage",[nY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nO.home}}),st(n$.prototype,"setCurrentTheme",[nJ],Object.getOwnPropertyDescriptor(n$.prototype,"setCurrentTheme"),n$.prototype),st(n$.prototype,"updateBackgroundSprites",[nQ],Object.getOwnPropertyDescriptor(n$.prototype,"updateBackgroundSprites"),n$.prototype),nZ=n$))||nZ);_._RF.pop(),_._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var is="musics/",il="sounds/",iu=GameCore.Utils.Object,ic={BUTTON_CLICK:"".concat(il,"use_item_click"),BOMB_DEFUSE:"".concat(il,"bomb_defuse"),BOMB_EXPLODE_1:"".concat(il,"bomb_explode_1"),BOMB_EXPLODE_2:"".concat(il,"bomb_explode_2"),CLICKS:"".concat(il,"clicks"),CLOSE_POPUP_CLICK:"".concat(il,"close_popup_click"),COLLECT_STARS:"".concat(il,"collect_stars"),COMBO_1:"".concat(il,"combo_1"),COMBO_2:"".concat(il,"combo_2"),COMBO_3:"".concat(il,"combo_3"),COMBO_4:"".concat(il,"combo_4"),COMBO_5:"".concat(il,"combo_5"),DAILY_REWARD:"".concat(il,"daily_reward"),EXTRA_TIME_SPAWN:"".concat(il,"extra_time_spawn"),GIFT_CHARGE:"".concat(il,"gift_charge"),GIFT_EXPLODE:"".concat(il,"gift_explode"),GIFT_REVEAL:"".concat(il,"gift_reveal"),HINT_ITEM:"".concat(il,"hint_item"),INVALID_MATCH:"".concat(il,"invalid_match"),LEVEL_COMPLETE:"".concat(il,"level_complete"),LEVEL_FAIL:"".concat(il,"level_fail"),LEVEL_START:"".concat(il,"level_start"),PROGRESS_STAR:"".concat(il,"progress_star"),RESCUE_TIMER:"".concat(il,"rescue_timer"),ROCKET_FLY:"".concat(il,"rocket_fly"),SHUFFLE_ITEM:"".concat(il,"shuffle_item"),THREE_STARS:"".concat(il,"three_stars"),TICKING_BOMB_BEFORE_EXPLODE:"".concat(il,"ticking_bomb_before_explode"),TILE_SELECT:"".concat(il,"tile_select"),USE_ITEM_CLICK:"".concat(il,"use_item_click"),BG_MUSIC:"".concat(is,"bg_music"),PATCH_SHIFT:"".concat(il,"patch_shift"),THUNDERBOLT:"".concat(il,"thunderbolt"),WIND:"".concat(il,"wind"),COLLECT_COINS:"".concat(il,"collect_coins"),COLLECT_STOCK_COINS:"".concat(il,"collect_stock_coins"),LEVEL_FAIL_TIMEOUT:"".concat(il,"level_fail_timeout"),STAR_CHEST_DRUM_ROLL:"".concat(il,"star_chest_drum_roll"),STAR_CHEST_OPEN:"".concat(il,"star_chest_open"),LEADERBOARD_TRIUMPH:"".concat(il,"leaderboard_triumph"),ITEM_REWARD:"".concat(il,"item_reward"),COMBO_6:"".concat(il,"combo_6"),COMBO_7:"".concat(il,"combo_7"),COMBO_8:"".concat(il,"combo_8"),COMBO_9:"".concat(il,"combo_9"),COMBO_10:"".concat(il,"combo_10"),COMBO_11:"".concat(il,"combo_11"),COMBO_12:"".concat(il,"combo_12"),COMBO_13:"".concat(il,"combo_13"),TILE_MATCH:"".concat(il,"tile_match"),TOURNAMENT_MUSIC:"".concat(is,"tournament_music")},ih=iu.vals(ic),ip=ih.reduce(function(g,E,_){return g[E]=_,g},{});Z(ip);var id,iy,iv=ih;_._RF.pop(),_._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var ig=function(g){return g[g.RESCUES_SCREEN=0]="RESCUES_SCREEN",g[g.LOADING_SCREEN=1]="LOADING_SCREEN",g[g.GET_ITEM_SCREEN=2]="GET_ITEM_SCREEN",g[g.GET_COIN_SCREEN=3]="GET_COIN_SCREEN",g[g.SETTINGS_SCREEN=4]="SETTINGS_SCREEN",g[g.START_LEVEL_SCREEN=5]="START_LEVEL_SCREEN",g[g.NOTIFICATION_SCREEN=6]="NOTIFICATION_SCREEN",g[g.LEVEL_COMPLETE_SCREEN=7]="LEVEL_COMPLETE_SCREEN",g[g.CONGRATULATION_SCREEN=8]="CONGRATULATION_SCREEN",g[g.QUIT_LEVEL_SCREEN=9]="QUIT_LEVEL_SCREEN",g[g.TOURNAMENT_DETAIL_SCREEN=10]="TOURNAMENT_DETAIL_SCREEN",g[g.DAILY_REWARDS_SCREEN=11]="DAILY_REWARDS_SCREEN",g[g.STAR_CHEST_SCREEN=12]="STAR_CHEST_SCREEN",g[g.START_OVER_SCREEN=13]="START_OVER_SCREEN",g[g.PAUSE_SCREEN=14]="PAUSE_SCREEN",g[g.HARD_LEVEL_SCREEN=15]="HARD_LEVEL_SCREEN",g[g.GET_REWARDS_SCREEN=16]="GET_REWARDS_SCREEN",g}(ig||{}),im=(Ge(id={},ig.RESCUES_SCREEN,"RescuesScreen"),Ge(id,ig.LOADING_SCREEN,"LoadingScreen"),Ge(id,ig.GET_ITEM_SCREEN,"GetItemScreen"),Ge(id,ig.GET_COIN_SCREEN,"GetCoinScreen"),Ge(id,ig.SETTINGS_SCREEN,"SettingsScreen"),Ge(id,ig.START_LEVEL_SCREEN,"StartLevelScreen"),Ge(id,ig.NOTIFICATION_SCREEN,"NotificationScreen"),Ge(id,ig.LEVEL_COMPLETE_SCREEN,"LevelCompleteScreen"),Ge(id,ig.CONGRATULATION_SCREEN,"CongratulationScreen"),Ge(id,ig.QUIT_LEVEL_SCREEN,"QuitLevelScreen"),Ge(id,ig.TOURNAMENT_DETAIL_SCREEN,"TournamentDetailScreen"),Ge(id,ig.DAILY_REWARDS_SCREEN,"DailyRewardsScreen"),Ge(id,ig.STAR_CHEST_SCREEN,"StarChestScreen"),Ge(id,ig.START_OVER_SCREEN,"StartOverScreen"),Ge(id,ig.PAUSE_SCREEN,"PauseScreen"),Ge(id,ig.HARD_LEVEL_SCREEN,"HardLevelScreen"),Ge(id,ig.GET_REWARDS_SCREEN,"GetRewardsScreen"),id),ib=(Ge(iy={},im[ig.RESCUES_SCREEN],ig.RESCUES_SCREEN),Ge(iy,im[ig.LOADING_SCREEN],ig.LOADING_SCREEN),Ge(iy,im[ig.GET_ITEM_SCREEN],ig.GET_ITEM_SCREEN),Ge(iy,im[ig.GET_COIN_SCREEN],ig.GET_COIN_SCREEN),Ge(iy,im[ig.SETTINGS_SCREEN],ig.SETTINGS_SCREEN),Ge(iy,im[ig.START_LEVEL_SCREEN],ig.START_LEVEL_SCREEN),Ge(iy,im[ig.NOTIFICATION_SCREEN],ig.NOTIFICATION_SCREEN),Ge(iy,im[ig.LEVEL_COMPLETE_SCREEN],ig.LEVEL_COMPLETE_SCREEN),Ge(iy,im[ig.CONGRATULATION_SCREEN],ig.CONGRATULATION_SCREEN),Ge(iy,im[ig.QUIT_LEVEL_SCREEN],ig.QUIT_LEVEL_SCREEN),Ge(iy,im[ig.TOURNAMENT_DETAIL_SCREEN],ig.TOURNAMENT_DETAIL_SCREEN),Ge(iy,im[ig.DAILY_REWARDS_SCREEN],ig.DAILY_REWARDS_SCREEN),Ge(iy,im[ig.STAR_CHEST_SCREEN],ig.STAR_CHEST_SCREEN),Ge(iy,im[ig.START_OVER_SCREEN],ig.START_OVER_SCREEN),Ge(iy,im[ig.PAUSE_SCREEN],ig.PAUSE_SCREEN),Ge(iy,im[ig.HARD_LEVEL_SCREEN],ig.HARD_LEVEL_SCREEN),Ge(iy,im[ig.GET_REWARDS_SCREEN],ig.GET_REWARDS_SCREEN),iy),iw=[im[ig.NOTIFICATION_SCREEN],im[ig.LOADING_SCREEN]];_._RF.pop(),_._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);var iS=globalThis.game.analytics,iE=GameCore.Utils.Array,i_=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"trackCurrentPage",value:function(g,E){if(!iE.has(iw,g)&&(E||iE.has(this.trackingPages,g))){this.trackingPages=this.trackingPages.filter(function(E){return E!==g}),E&&this.trackingPages.push(g);var _=this.getCurrentPage();iS.pageview(_)}}},{key:"switchSceneTracking",value:function(){this.trackingPages=[];var g=this.getCurrentPage();iS.pageview(g)}},{key:"getCurrentPage",value:function(){var g,E;return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:null!==(g=null===(E=N.getScene())||void 0===E?void 0:E.name)&&void 0!==g?g:"Unknown Scene"}}]),e}();i_.trackingPages=[],_._RF.pop(),_._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);var ik,iC,iA,iT,iR,iI,iL,iP,iO,iB,iN,iM,iD,iF,iU,ix,iz,iG,iV,iK,iH,iq,iW,ij,iX,iY,iJ,iQ,iZ,i$,i0,i1,i2,i4,i3,i5=function(){function e(){Fe(this,e),this.signal=new nN}var g,E,_,k,C;return Ue(e,[{key:"sound",get:function(){var g,E;return null!==(g=null===(E=$("Sound"))||void 0===E?void 0:E.getComponent(tP))&&void 0!==g?g:null}},{key:"music",get:function(){var g,E;return null!==(g=null===(E=$("Music"))||void 0===E?void 0:E.getComponent(tC))&&void 0!==g?g:null}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"muteAudio",value:function(g){this.muteMusic(g),this.muteSound(g)}},{key:"playSound",value:(C=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,null===(_=this.inst.sound)||void 0===_?void 0:_.play(g,E)];case 1:k.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"pauseSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.pause(g)}},{key:"resumeSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.resume(g)}},{key:"stopSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.stop(g)}},{key:"stopAllSounds",value:function(){var g;null===(g=this.inst.sound)||void 0===g||g.stopAll()}},{key:"muteSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.mute(g)}},{key:"playMusic",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E;this.inst.music&&(this.inst.currentMusic!==g&&this.pauseMusic(),this.inst.currentMusic=g,!_&&this.inst.music.playing(g)||(_&&this.inst.music.stop(g),this.inst.music.play(g)))}},{key:"pauseMusic",value:function(){var g;null===(g=this.inst.music)||void 0===g||g.pause(this.inst.currentMusic)}},{key:"muteMusic",value:function(g){var E;null===(E=this.inst.music)||void 0===E||E.mute(g)}},{key:"getCurrentMusic",value:function(){return this.inst.currentMusic}},{key:"turnUpMusic",value:(k=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=(null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0)>.6;if(_)return[3,2];return[4,this.setVolumeMusic(.6,!0)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"turnDownMusic",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=(null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0)<.2;if(_)return[3,2];return[4,this.setVolumeMusic(.2,!0)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"turnOffMusic",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.setVolumeMusic(0)];case 1:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getVolumeMusic",value:function(){var g,E;return null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0}},{key:"setVolumeMusic",value:(g=Be(function(g){var E,_,k,C,A,T;var R=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:E=this,_=R.length>1&&void 0!==R[1]&&R[1];if(!this.inst.music)return[3,3];this.inst.signal.abort();k=new nN;if(this.inst.signal=k,!_)return[3,2];C=this.inst.music.getVolume(),A=C;return[4,tZ.runOnUpdateAsync(this.inst.music.node,1,function(_){E.inst.music&&(A=C+(g-C)*_,E.inst.music.setVolume(A))},k)];case 1:I.sent();return[3,3];case 2:null===(T=this.inst.music)||void 0===T||T.setVolume(g);I.label=3;case 3:return[2]}})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var i6,i8,i9,i7,re=k.ccclass,rn=k.property,ri=k.disallowMultiple,rr=k.executionOrder,ra=globalThis.game.analytics,ro=GameCore.Plugins.Analytics.Events,rs=(ik=re("ExtendedButton"),iC=rr(111),iA=rn(ec),iT=rn(ec),iR=rn(eh.AnimationController),iI=rn({override:!0,visible:!1}),iL=rn({override:!0,visible:!1}),iP=rn({override:!0,visible:!1}),iO=rn({override:!0,visible:!1}),iB=rn({override:!0,visible:!1}),iN=rn({override:!0,visible:!1}),iM=rn({override:!0,visible:!1}),iD=rn({override:!0,visible:!1}),iF=rn({override:!0,visible:!1}),iU=rn({override:!0,visible:!1}),ix=rn({override:!0,visible:!1}),iz=rn(J),iG=rn(J),iV=rn(J),iK=rn({visible:function(){return this.makeSound},type:ip}),iH=rn({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),iq=rn({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),iW=rn({}),ik(ij=ri(ij=iC((iY=st((iX=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"clickStartEvents",iY,Ke(g)),rt(g,"clickEndEvents",iJ,Ke(g)),rt(g,"animationController",iQ,Ke(g)),rt(g,"useDesktopHover",iZ,Ke(g)),rt(g,"emitAnalyticsEvents",i$,Ke(g)),rt(g,"makeSound",i0,Ke(g)),rt(g,"soundKey",i1,Ke(g)),rt(g,"disableSpamClick",i2,Ke(g)),rt(g,"disableSpamDelay",i4,Ke(g)),rt(g,"isScrollViewCancelInnerEvents",i3,Ke(g)),g.currentClickBoundingBox=null,g.hasDown=!1,g.hasUp=!1,g.hasFinishClickCycle=!1,g.onTouchStart=function(E){g.interactable&&(g.hasDown||(g.currentClickBoundingBox=ns.getBoundingBoxToWorld(g.node),g.handleDown(E)))},g.onTouchEnd=function(E){g.scheduleOnce(function(){g.interactable&&g.hasDown&&(g.hasUp||g.handleUp(E))},0)},g.onTouchCancel=function(E){if(g.interactable&&g.hasDown&&!g.hasUp){if(!g.isScrollViewCancelInnerEvents){var _,k,C=E.getUILocation();if(null!==(_=null===(k=g.currentClickBoundingBox)||void 0===k?void 0:k.contains(C))&&void 0!==_&&_)return void g.handleUp(E)}g.hasUp=!0,g.hasFinishClickCycle=!0,g.handleResetButtonState(),g.emitClickEndEvents(E)}},g.onMouseEnter=function(E){g.useDesktopHover&&g.interactable&&(g.hasDown||(g.hasFinishClickCycle=!1,g.setAnimationState("HOVER")))},g.onMouseLeave=function(E){g.useDesktopHover&&g.interactable&&(g.hasDown||g.hasUp||g.hasFinishClickCycle||g.handleResetButtonState())},g.handleResetButtonState=function(){g.hasDown=!1,g.hasUp=!1,g.setAnimationState("RESET")},g}return Ue(n,[{key:"transition",get:function(){return B.Transition.NONE},set:function(g){$e(Ve(n.prototype),"transition",B.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return Je(Ve(n.prototype),"normalColor",this)},set:function(g){$e(Ve(n.prototype),"normalColor",g,this,!0)}},{key:"pressedColor",get:function(){return Je(Ve(n.prototype),"pressedColor",this)},set:function(g){$e(Ve(n.prototype),"pressedColor",g,this,!0)}},{key:"hoverColor",get:function(){return Je(Ve(n.prototype),"hoverColor",this)},set:function(g){$e(Ve(n.prototype),"hoverColor",g,this,!0)}},{key:"disabledColor",get:function(){return Je(Ve(n.prototype),"disabledColor",this)},set:function(g){$e(Ve(n.prototype),"disabledColor",g,this,!0)}},{key:"normalSprite",get:function(){return Je(Ve(n.prototype),"normalSprite",this)},set:function(g){$e(Ve(n.prototype),"normalSprite",g,this,!0)}},{key:"pressedSprite",get:function(){return Je(Ve(n.prototype),"pressedSprite",this)},set:function(g){$e(Ve(n.prototype),"pressedSprite",g,this,!0)}},{key:"hoverSprite",get:function(){return Je(Ve(n.prototype),"hoverSprite",this)},set:function(g){$e(Ve(n.prototype),"hoverSprite",g,this,!0)}},{key:"disabledSprite",get:function(){return Je(Ve(n.prototype),"disabledSprite",this)},set:function(g){$e(Ve(n.prototype),"disabledSprite",g,this,!0)}},{key:"duration",get:function(){return Je(Ve(n.prototype),"duration",this)},set:function(g){$e(Ve(n.prototype),"duration",g,this,!0)}},{key:"zoomScale",get:function(){return Je(Ve(n.prototype),"zoomScale",this)},set:function(g){$e(Ve(n.prototype),"zoomScale",g,this,!0)}},{key:"__preload",value:function(){Je(Ve(n.prototype),"__preload",this).call(this),nk.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var g;null===(g=Je(Ve(n.prototype),"onDestroy",this))||void 0===g||g.call(this)}},{key:"onEnable",value:function(){var g;null===(g=Je(Ve(n.prototype),"onEnable",this))||void 0===g||g.call(this),this.node.off(ep.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(C.EventType.TOUCH_START,this.onTouchStart),this.node.on(C.EventType.TOUCH_END,this.onTouchEnd),this.node.on(C.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var g;null===(g=Je(Ve(n.prototype),"onDisable",this))||void 0===g||g.call(this),this.node.off(C.EventType.TOUCH_START,this.onTouchStart),this.node.off(C.EventType.TOUCH_END,this.onTouchEnd),this.node.off(C.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(g){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&i5.playSound(iv[this.soundKey]),this.emitClickStartEvents(g)}},{key:"emitClickStartEvents",value:function(g){var E,_=at(this.clickStartEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}},{key:"emitClickEndEvents",value:function(g){var E,_=at(this.clickEndEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}},{key:"handleUp",value:function(g){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(g),this.emitClickEndEvents(g)}},{key:"emitButtonEvents",value:function(g){if(this.interactable){this.emitAnalyticsEvents&&ra.event(ro.BUTTON_CLICK,{button_name:this.node.name,screen_name:i_.getCurrentPage()});var E,_=at(this.clickEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}}},{key:"setAnimationState",value:function(g){this.animationController&&(this.animationController.setValue("DOWN","DOWN"===g),this.animationController.setValue("HOVER","HOVER"===g),this.animationController.setValue("RESET","RESET"===g))}},{key:"fakeClick",value:function(){var g=this;this.setAnimationState("DOWN"),this.scheduleOnce(function(){g.setAnimationState("RESET")},0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),n}(B)).prototype,"clickStartEvents",[iA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iJ=st(iX.prototype,"clickEndEvents",[iT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iQ=st(iX.prototype,"animationController",[iR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(iX.prototype,"transition",[iI],Object.getOwnPropertyDescriptor(iX.prototype,"transition"),iX.prototype),st(iX.prototype,"normalColor",[iL],Object.getOwnPropertyDescriptor(iX.prototype,"normalColor"),iX.prototype),st(iX.prototype,"pressedColor",[iP],Object.getOwnPropertyDescriptor(iX.prototype,"pressedColor"),iX.prototype),st(iX.prototype,"hoverColor",[iO],Object.getOwnPropertyDescriptor(iX.prototype,"hoverColor"),iX.prototype),st(iX.prototype,"disabledColor",[iB],Object.getOwnPropertyDescriptor(iX.prototype,"disabledColor"),iX.prototype),st(iX.prototype,"normalSprite",[iN],Object.getOwnPropertyDescriptor(iX.prototype,"normalSprite"),iX.prototype),st(iX.prototype,"pressedSprite",[iM],Object.getOwnPropertyDescriptor(iX.prototype,"pressedSprite"),iX.prototype),st(iX.prototype,"hoverSprite",[iD],Object.getOwnPropertyDescriptor(iX.prototype,"hoverSprite"),iX.prototype),st(iX.prototype,"disabledSprite",[iF],Object.getOwnPropertyDescriptor(iX.prototype,"disabledSprite"),iX.prototype),st(iX.prototype,"duration",[iU],Object.getOwnPropertyDescriptor(iX.prototype,"duration"),iX.prototype),st(iX.prototype,"zoomScale",[ix],Object.getOwnPropertyDescriptor(iX.prototype,"zoomScale"),iX.prototype),iZ=st(iX.prototype,"useDesktopHover",[iz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i$=st(iX.prototype,"emitAnalyticsEvents",[iG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i0=st(iX.prototype,"makeSound",[iV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i1=st(iX.prototype,"soundKey",[iK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ip[ic.BUTTON_CLICK]}}),i2=st(iX.prototype,"disableSpamClick",[iH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i4=st(iX.prototype,"disableSpamDelay",[iq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),i3=st(iX.prototype,"isScrollViewCancelInnerEvents",[iW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ij=iX))||ij)||ij)||ij);_._RF.pop(),_._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var rl=k.ccclass,ru=k.requireComponent,rc=k.property,rh=rl("OpacityToggler")(i6=ru([eu])((i9=st((i8=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"activeValue",i9,Ke(g)),rt(g,"inActiveValue",i7,Ke(g)),g.signal=new nN,g}return Ue(i,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"changeState",value:function(g){var E=arguments.length>0&&void 0!==g&&g;this.signal.abort(),this.opacityComponent.opacity=E?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(E=Be(function(){var g,E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:g=k.length>0&&void 0!==k[0]&&k[0],E=k.length>1&&void 0!==k[1]?k[1]:.2;this.signal.abort(),this.signal=new nN;_=g?this.activeValue:this.inActiveValue;return[4,tZ.runTweenAsync(z(this.opacityComponent).to(E,{opacity:_}),this.signal)];case 1:C.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"activeValue",[rc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),i7=st(i8.prototype,"inActiveValue",[rc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),i6=i8))||i6)||i6;_._RF.pop(),_._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);var rp,rf,ry,rv={Portrait:"portrait",Landscape:"landscape"},rg={Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}};_._RF.pop(),_._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var rm,rb,rw,rS,rE,r_,rk,rC,rA,rT,rR,rI,rL,rP,rO,rB,rN,rM,rD,rF,rU=k.ccclass,rx=k.property,rz=k.requireComponent,rG=k.disallowMultiple,rV=k.executeInEditMode,rK=rg,rH=rK.Portrait,rq=rK.Landscape;rU("DebugResolution")(rp=rG(rp=rz([ed])(rp=rV(!0)(((ry=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleLayoutChange=function(){var E;null===(E=g.graphics)||void 0===E||E.clear(),g.start()},g}return Ue(n,[{key:"drawPortrait",get:function(){return n._drawPortrait},set:function(g){g!==n._drawPortrait&&(g?this.drawPortraitResolution():this.graphics.clear(),n._drawPortrait=g,n._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return n._drawLandscape},set:function(g){g!==n._drawLandscape&&(g?this.drawLandscapeResolution():this.graphics.clear(),n._drawLandscape=g,n._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(ed),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t6,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var g=this.graphics,E=rH.WIDTH,_=rH.HEIGHT,k=-E/2,C=-_/2;g.strokeColor=A.GREEN,g.rect(k,C,E,_),g.stroke()}},{key:"drawLandscapeResolution",value:function(){var g=this.graphics,E=rq.WIDTH,_=rq.HEIGHT,k=-E/2,C=-_/2;g.strokeColor=A.CYAN,g.rect(k,C,E,_),g.stroke()}}]),n}(M))._drawPortrait=!0,ry._drawLandscape=!0,st((rf=ry).prototype,"drawPortrait",[rx],Object.getOwnPropertyDescriptor(rf.prototype,"drawPortrait"),rf.prototype),st(rf.prototype,"drawLandscape",[rx],Object.getOwnPropertyDescriptor(rf.prototype,"drawLandscape"),rf.prototype),rp=rf))||rp)||rp)||rp);_._RF.pop(),_._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var rW=k.ccclass,rj=k.executionOrder,rX=k.property,rY=GameCore.Utils.Valid,rJ=A.RED,rQ=A.BLACK,rZ=A.MAGENTA;rm=rW("GameStats"),rb=rj(-1e3),rw=rX(L),rS=rX(L),rE=rX(L),r_=rX(L),rk=rX(L),rC=rX(L),rA=rX(L),rT=rX(L),rm(rR=rb((rL=st((rI=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"fpsLabel",rL,Ke(g)),rt(g,"drawCountLabel",rP,Ke(g)),rt(g,"logicTimeLabel",rO,Ke(g)),rt(g,"physicTimeLabel",rB,Ke(g)),rt(g,"renderTimeLabel",rN,Ke(g)),rt(g,"objectMemoryUsageLabel",rM,Ke(g)),rt(g,"textureMemoryUsageLabel",rD,Ke(g)),rt(g,"devicePixelRatioLabel",rF,Ke(g)),g.refreshInterval=.5,g.handleMouseDown=function(){g.bg.enabled=!g.bg.enabled},g.waitForStats=function(){ey.stats&&(g.unschedule(g.waitForStats),g.node.active=!0,g.stats=ey.stats,g.startUpdateStats())},g.updateStats=function(){g.updateFps(),g.updateDrawCalls(),g.updateLogicTime(),g.updatePhysicTime(),g.updateRenderTime(),g.updateObjectMemoryUsage(),g.updateTextureMemoryUsage(),g.updateDevicePixelRatio()},g}return Ue(n,[{key:"__preload",value:function(){this.bg=this.getComponent(eo),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(ep.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,ey&&rY.isDebugger()&&(ey.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var g=this.getFps();this.updateFpsColor(g),this.fpsLabel.string="FPS: ".concat(g)}},{key:"updateFpsColor",value:function(g){this.fpsLabel.color=g<30?rJ:g<48?rZ:rQ}},{key:"updateDrawCalls",value:function(){var g=this.getDrawCalls();this.updateDrawCallsColor(g),this.drawCountLabel.string="Draw Calls: ".concat(g)}},{key:"updateDrawCallsColor",value:function(g){var E=ev.os===ev.OS.IOS,_=E?80:25,k=E?60:15;this.drawCountLabel.color=g>_?rJ:g>k?rZ:rQ}},{key:"updateLogicTime",value:function(){var g=this.getLogicTime();this.updateLogicTimeColor(g),this.logicTimeLabel.string="Logic Time: ".concat(g.toFixed(2),"ms")}},{key:"updateLogicTimeColor",value:function(g){this.logicTimeLabel.color=g>10?rJ:g>5?rZ:rQ}},{key:"updatePhysicTime",value:function(){var g=this.getPhysicTime();this.updatePhysicTimeColor(g),this.physicTimeLabel.string="Physic Time: ".concat(g.toFixed(2),"ms")}},{key:"updatePhysicTimeColor",value:function(g){this.physicTimeLabel.color=g>10?rJ:g>5?rZ:rQ}},{key:"updateRenderTime",value:function(){var g=this.getRenderTime();this.updateRenderTimeColor(g),this.renderTimeLabel.string="Render Time: ".concat(g.toFixed(2),"ms")}},{key:"updateRenderTimeColor",value:function(g){this.renderTimeLabel.color=g>10?rJ:g>5?rZ:rQ}},{key:"updateObjectMemoryUsage",value:function(){var g=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(g),this.objectMemoryUsageLabel.string="Object Mem: ".concat(g.toFixed(2),"MB")}},{key:"updateObjectMemoryUsageColor",value:function(g){this.objectMemoryUsageLabel.color=g>40?rJ:g>25?rZ:rQ}},{key:"updateTextureMemoryUsage",value:function(){var g=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(g),this.textureMemoryUsageLabel.string="Texture Mem: ".concat(g.toFixed(2),"MB")}},{key:"updateTextureMemoryUsageColor",value:function(g){this.textureMemoryUsageLabel.color=g>50?rJ:g>35?rZ:rQ}},{key:"updateDevicePixelRatio",value:function(){var g=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(g),this.devicePixelRatioLabel.string="Device Pixel Ratio: ".concat(g)}},{key:"updateDevicePixelRatioColor",value:function(g){this.devicePixelRatioLabel.color=g>2?rJ:g<=1?rZ:rQ}},{key:"getFps",value:function(){var g=this.stats.fps.counter;return Math.floor(g.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var g=this.stats.logic.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getPhysicTime",value:function(){var g=this.stats.physics.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getRenderTime",value:function(){var g=this.stats.render.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var g=this.stats.bufferMemory.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var g=this.stats.textureMemory.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),n}(M)).prototype,"fpsLabel",[rw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rP=st(rI.prototype,"drawCountLabel",[rS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rO=st(rI.prototype,"logicTimeLabel",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rB=st(rI.prototype,"physicTimeLabel",[r_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rN=st(rI.prototype,"renderTimeLabel",[rk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rM=st(rI.prototype,"objectMemoryUsageLabel",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rD=st(rI.prototype,"textureMemoryUsageLabel",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rF=st(rI.prototype,"devicePixelRatioLabel",[rT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rR=rI))||rR);_._RF.pop(),_._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var r$,r0=function(g){return g.INVITE_FRIENDS="invite-friends",g.REPLAY_FRIENDS="replay-friends",g.SHOW_CHALLENGE_RESULTS="show-challenge-results",g.NEXT_LEVEL="next-level",g.MAX_LEVEL="max-level",g.START_OVER="start-over",g.SELECT_LEVEL="select-level",g.GAME_START="game-start",g.GAME_PAUSE="game-pause",g.GAME_RESUME="game-resume",g.GAME_REPLAY="game-replay",g.GAME_FINISH="game-finish",g.GAME_EXIT="game-exit",g.USE_ITEM="use-item",g.SKIP_LEVEL="skip-level",g.ADD_ITEM="add-item",g.ADD_ITEMS="add-items",g.ADD_COINS="add-coins",g.REMOVE_COINS="remove-coins",g.REMOVE_COINS_SUCCESS="remove-coins-success",g.REMOVE_COINS_FAILED="remove-coins-failed",g.COIN_CHANGED="coin-changed",g.ABORT_COIN_ANIMATION="abort-coin-animation",g.ADD_STARS="add-stars",g.PAUSE_TIME="pause-time",g.RESUME_TIME="resume-time",g.TIME_OUT="time-out",g.HALF_TIME="half-time",g.RESCUE_START="rescue-time",g.RESCUE_FINISHED="clock-animation-finished",g.APPLY_GRAVITY="apply-gravity",g.IDLE_ENTER="idle-enter",g.IDLE_EXIT="idle-exit",g.GRID_MATCH="grid-match",g.GRID_MATCH_SUCCESS="grid-match-success",g.GRID_MATCH_FAIL="grid-match-fail",g.GRID_CLEAR="grid-clear",g.GRID_SPAWN="grid-spawn",g.GRID_CREATE="grid-create",g.GRID_RESIZE="grid-resize",g.TILE_CLICK="tile-click",g.BOMB_EXPLODE="bomb-explode",g.SHOW_HINT="show-hint",g.ADD_COMBO="add-combo",g.COMBO_UPDATED="combo-updated",g.COMBO_ENDED="combo-ended",g.ADD_SCORE="add-score",g.SCORE_UPDATED="score-updated",g.SHOW_UI="show-ui",g.HIDE_UI="hide-ui",g.AUTO_PLAY="auto-play",g.GUIDE_MASK_CLICKED="guide-mask-clicked",g}(r0||{});_._RF.pop(),_._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var r1,r2,r4,r3,r5,r6,r8,r9,r7,ae,an,ai,ar,aa,ao,as,al,au,ac=(0,k.ccclass)("PanelAnimationController")(r$=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).animators=new Set,g.eventTarget=new eg,g.handleRegistration=function(E){if(!E)throw new Error("Invalid event payload.");g.animators.has(E)&&console.warn("Animator already registered."),g.animators.add(E)},g.handleUnregistration=function(E){if(!E)throw new Error("Invalid event payload.");g.animators.has(E)||console.warn("Animator not registered."),g.animators.delete(E)},g.handleShowUIs=function(){var E=Be(function(E){var _,k,C,A,T,R,I,L,P,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:C=!1,A=[],T=at(g.animators);try{for(T.s();!(k=T.n()).done;){R=k.value;A.push(R)}}catch(g){T.e(g)}finally{T.f()}for(I=[],L=0,P=A;L<P.length;L++){B=P[L];if(!B.isReadyForAnimation()&&!C)C=!0,null==E||null===(O=E.fallback)||void 0===O||O.call(E);I.push(B.handleShowUI())}return[4,Promise.all(I)];case 1:N.sent(),null==E||null===(_=E.onComplete)||void 0===_||_.call(E),g.eventTarget.emit(r0.SHOW_UI);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g.handleHideUIs=function(){var E=Be(function(E){var _,k,C,A,T,R,I,L,P,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:C=!1,A=[],T=at(g.animators);try{for(T.s();!(k=T.n()).done;){R=k.value;A.push(R)}}catch(g){T.e(g)}finally{T.f()}for(I=[],L=0,P=A;L<P.length;L++){B=P[L];if(!B.isReadyForAnimation()&&!C)C=!0,null==E||null===(O=E.fallback)||void 0===O||O.call(E);I.push(B.handleHideUI())}return[4,Promise.all(I)];case 1:N.sent(),null==E||null===(_=E.onComplete)||void 0===_||_.call(E),g.eventTarget.emit(r0.HIDE_UI);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(n,[{key:"onEnable",value:function(){this.node.scene.on(r0.SHOW_UI,this.handleShowUIs,this),this.node.scene.on(r0.HIDE_UI,this.handleHideUIs,this)}},{key:"onDisable",value:function(){this.node.scene.off(r0.SHOW_UI,this.handleShowUIs,this),this.node.scene.off(r0.HIDE_UI,this.handleHideUIs,this)}},{key:"showUI",value:function(){return this.handleShowUIs()}},{key:"hideUI",value:function(){return this.handleHideUIs()}},{key:"on",value:function(g,E,_,k){this.eventTarget.on(g,E,_,k)}},{key:"off",value:function(g,E,_){this.eventTarget.off(g,E,_)}}],[{key:"getController",value:function(g){for(var E=null,_=g;null!==_;){if(E=_.getComponent(n))break;_=_.parent}return E}},{key:"registerAnimator",value:function(g){var E=this.getController(g.node);E?E.handleRegistration(g):console.warn("No PanelAnimationController found for animator ".concat(g.node.name))}},{key:"unregisterAnimator",value:function(g){var E=this.getController(g.node);E?E.handleUnregistration(g):console.warn("No PanelAnimationController found for animator ".concat(g.node.name))}}]),n}(M))||r$;_._RF.pop(),_._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var ah,ap,af,ay,av,ag,am,ab,aw,aS,aE,a_,ak=k.ccclass,aC=k.property,aA=GameCore.Utils.Object,aT=(r1=ak("AnimationConfig"),r2=aC({type:[H]}),r1((r5=st((r3=function(){function e(){Fe(this,e),rt(this,"startHidden",r5,this),rt(this,"nodes",r6,this),rt(this,"posOffset",r8,this),rt(this,"showEase",r9,this),rt(this,"hideEase",r7,this),rt(this,"showDuration",ae,this),rt(this,"hideDuration",an,this)}return Ue(e,[{key:"setConfig",value:function(g){g&&aA.assign(this,g)}}]),e}()).prototype,"startHidden",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),r6=st(r3.prototype,"nodes",[r2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),r8=st(r3.prototype,"posOffset",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),r9=st(r3.prototype,"showEase",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),r7=st(r3.prototype,"hideEase",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),ae=st(r3.prototype,"showDuration",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),an=st(r3.prototype,"hideDuration",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),r4=r3))||r4),aR=(ai=ak("PanelAnimator"),ar=aC({type:aT,displayName:"Top animation nodes"}),aa=aC({type:aT,displayName:"Bottom animation nodes"}),ai((al=st((as=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"topConfig",al,Ke(g)),rt(g,"botConfig",au,Ke(g)),g.isReady=!1,g}return Ue(a,[{key:"onEnable",value:function(){ac.registerAnimator(this)}},{key:"onDisable",value:function(){ac.unregisterAnimator(this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(_=Be(function(){return _ts_generator(this,function(g){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return _.apply(this,arguments)})},{key:"handleHideUI",value:(E=Be(function(){return _ts_generator(this,function(g){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return E.apply(this,arguments)})},{key:"createAnimator",value:function(g,E){var _=g.nodes,k=g.posOffset,C=g.showEase,A=g.hideEase,T=g.showDuration,R=g.hideDuration,I=_.map(function(g){return"top"===E&&g.isAlignTop?{mode:"top",value:g.top}:"bottom"===E&&g.isAlignBottom?{mode:"bottom",value:g.bottom}:{mode:"position",value:g.node.position.y}}),L=_.map(function(g){return"top"===E&&g.isAlignTop?{mode:"top",value:g.top+k}:"bottom"===E&&g.isAlignBottom?{mode:"bottom",value:g.bottom-k}:{mode:"position",value:g.node.position.y+k}}),P="shown",O=new nN;return{switchState:function(g,E){var k=arguments.length>1&&void 0!==E&&E;if(O.abort(),O=new nN,P===g)return Promise.resolve(null);P=g;var B="hidden"===g?I:L,N="hidden"===g?L:I,M="hidden"===g?R:T,D="hidden"===g?A:C;return k?(_.forEach(function(g,E){var _=B[E],k=N[E].value;"top"===_.mode&&(g.top=k),"bottom"===_.mode&&(g.bottom=k),"position"===_.mode&&(g.node.position=new em(g.node.position.x,k,g.node.position.z))}),Promise.resolve(null)):Promise.all(_.map(function(g,E){var _=B[E],k=N[E].value;return tZ.runTweenAsync(a.getTween({widget:g,config:_,target:k,easing:D,duration:M}),O)}))}}}},{key:"setAnimator",value:function(g){var E=g.topConfig,_=g.botConfig,k=new aT,C=new aT;k.setConfig(E),C.setConfig(_),this.topConfig=k,this.botConfig=C,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(g){var E=g.widget,_=g.config,k=g.target,C=g.easing,A=g.duration;return"top"===_.mode?z(E).call(function(){E.top=_.value}).to(A,{top:k},{easing:C}):"bottom"===_.mode?z(E).call(function(){E.bottom=_.value}).to(A,{bottom:k},{easing:C}):z(E.node.position).call(function(){E.node.position=new em(E.node.position.x,_.value,E.node.position.z)}).to(A,{y:k},{easing:C})}}]),a}(M)).prototype,"topConfig",[ar],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new aT}}),au=st(as.prototype,"botConfig",[aa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new aT}}),ao=as))||ao);_._RF.pop(),_._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var aI,aL,aP,aO,aB,aN,aM,aD,aF,aU,ax,az=k.ccclass,aG=k.requireComponent,aV=k.property,aK=globalThis.game,aH=aK.ads,aq=aK.event,aW=GameCore,aj=aW.Events,aX=aW.Configs.Ads.BannerDisplayAdOptions,aY=aW.Plugins.Ads.Types,aJ=aW.Utils,aQ=aJ.Array,aZ=aJ.Function,a$=["top","topleft","topright"],a0=["bottom","bottomleft","bottomright"],a1=["left","topleft","bottomleft"],a2=["right","topright","bottomright"];ah=az("ResizeWithBannerAd"),ap=aG(H),af=aV(J),ay=aV(J),av=aV(J),ag=aV(J),ah(am=ap((aw=st((ab=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"includeSAB",aw,Ke(g)),rt(g,"includeRightBanner",aS,Ke(g)),rt(g,"includeBottomBanner",aE,Ke(g)),rt(g,"includeLeftBanner",a_,Ke(g)),g.handleOnAdShowing=function(E){var _=E.placementId;g.checkValid()&&_&&aH.getAd(aY.BANNER,_)&&(g.resizeWhenBannerAdShow(_),g.emitResizeEvent())},g.handleOnAdClosed=function(E){var _=E.placementId;g.checkValid()&&_&&aH.getAd(aY.BANNER,_)&&(g.resizeWhenBannerAdClose(_),g.emitResizeEvent())},g.handleOnResize=function(){g.checkValid()&&aX.forEach(function(E){var _=E.PlacementId;g.resizeWhenBannerAdShow(_)})},g.resizeWhenBannerAdShow=function(E){var _=void 0,k=void 0,C=void 0,A=void 0,T=ns.cssSizeToWorldSize(1),R=aH.getBannerConfig(E),I=R.PlacementId,L=R.BannerWidth,P=R.Position;if("top"===P)_=aH.getBannerHeight(I,T);else if("bottom"===P)g.includeBottomBanner?k=aH.getBannerHeight(I,T,g.includeSAB):g.includeSAB&&(k=aH.getSafeAreaBottom(T));else if("left"===P||"right"===P){if(void 0===L)return;var O=L;"getBannerOffset"in GameSDK.extra&&(O+=GameSDK.extra.getBannerOffset()),"left"===P&&g.includeLeftBanner?C=O*T:"right"===P&&g.includeRightBanner&&(A=O*T)}g.updateWidgets({top:_,bottom:k,left:C,right:A})},g.resizeWhenBannerAdClose=function(E){var _=aH.getBannerConfig(E).Position,k=ns.cssSizeToWorldSize(1),C=g.includeSAB?aH.getSafeAreaBottom(k):0;g.updateWidgets({top:aQ.has(a$,_)?0:void 0,bottom:aQ.has(a0,_)?C:void 0,left:aQ.has(a1,_)?0:void 0,right:aQ.has(a2,_)?0:void 0})},g.emitResizeEvent=aZ.debounce(function(){Q.emit(no)},100),g}return Ue(n,[{key:"__preload",value:function(){this.widget=this.getComponent(H),nk.lazyValidateProperties(this),aq.on(aj.AD_SHOWING,this.handleOnAdShowing),aq.on(aj.AD_CLOSED,this.handleOnAdClosed),Q.on(t3,this.handleOnResize)}},{key:"onDestroy",value:function(){aq.off(aj.AD_SHOWING,this.handleOnAdShowing),aq.off(aj.AD_CLOSED,this.handleOnAdClosed),Q.off(t3,this.handleOnResize)}},{key:"start",value:function(){this.handleOnResize()}},{key:"updateWidgets",value:function(g){var E=g.top,_=g.bottom,k=g.left,C=g.right;this.widget.top=null!=E?E:this.widget.top,this.widget.bottom=null!=_?_:this.widget.bottom,this.widget.left=null!=k?k:this.widget.left,this.widget.right=null!=C?C:this.widget.right,eb.instance.emit("canvas-resize")}},{key:"checkValid",value:function(){return this.node.activeInHierarchy&&null!==this.node.parent&&void 0!==this.node.parent}}]),n}(M)).prototype,"includeSAB",[af],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),aS=st(ab.prototype,"includeRightBanner",[ay],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),aE=st(ab.prototype,"includeBottomBanner",[av],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),a_=st(ab.prototype,"includeLeftBanner",[ag],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),am=ab))||am);_._RF.pop(),_._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var a4,a3,a5,a6,a8,a9,a7,oe=k.ccclass,on=k.property,oi=k.executeInEditMode,or=k.requireComponent,oa=(aI=oe("TapperedProgressBar"),aL=or(eu),aP=on({type:eu,displayName:"Fill opacity"}),aO=on({type:eo,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),aB=on({type:eo,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),aN=on({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),aI(aM=oi(aM=aL((aF=st((aD=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"uiOpacity",aF,Ke(g)),rt(g,"leftCap",aU,Ke(g)),rt(g,"rightCap",ax,Ke(g)),g}return Ue(n,[{key:"progress",get:function(){return Je(Ve(n.prototype),"progress",this)},set:function(g){$e(Ve(n.prototype),"progress",g,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity){if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var g=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=g}}}},{key:"start",value:function(){this.updateAppearance()}}]),n}(ew)).prototype,"uiOpacity",[aP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aU=st(aD.prototype,"leftCap",[aO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ax=st(aD.prototype,"rightCap",[aB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st(aD.prototype,"progress",[aN],Object.getOwnPropertyDescriptor(aD.prototype,"progress"),aD.prototype),aM=aD))||aM)||aM)||aM);_._RF.pop(),_._RF.push({},"aa60frMJLtIlJZh2yJhMp1s","DynamicLabel",void 0);var oo,os,ol,ou,oc,oh,op,of,oy,ov,og=k.ccclass,om=k.property,ob=k.executeInEditMode,ow=k.requireComponent;a4=og("DynamicLabel"),a3=ow(L),a5=ob(!0),a6=om({type:K,min:1,max:200}),a8=om({type:K,min:.1,max:4}),a4(a9=a3(a9=a5((st((a7=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k)))._quality=1,g._size=1,g._outlineWidth=0,g._shadowOffset=new eS(0,0),g}return Ue(n,[{key:"size",get:function(){return this._size},set:function(g){this._size=g,this.label.fontSize=this.size*this.quality}},{key:"quality",get:function(){return this._quality},set:function(g){this._quality=g,this.node.scale=new em(1/this.quality,1/this.quality,1),this.label.fontSize=this.size*this.quality,this.label.outlineWidth=this._outlineWidth*this.quality,this.label.shadowOffset=this._shadowOffset.multiplyScalar(this.quality)}},{key:"__preload",value:function(){this.label=this.getComponent(L)}},{key:"start",value:function(){this._quality=1/this.node.scale.x,this._size=this.label.fontSize/this.quality,this._outlineWidth=this.label.outlineWidth,this._shadowOffset=this.label.shadowOffset,this.quality=window.devicePixelRatio,console.info("\uD83D\uDD20 ".concat(this.node.name,"<Label> quality:"),this.quality)}}]),n}(M)).prototype,"size",[a6],Object.getOwnPropertyDescriptor(a7.prototype,"size"),a7.prototype),st(a7.prototype,"quality",[a8],Object.getOwnPropertyDescriptor(a7.prototype,"quality"),a7.prototype),a9=a7))||a9)||a9);_._RF.pop(),_._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var oS,oE,o_,ok,oC,oA,oT,oR,oI,oL=k.ccclass,oP=k.property,oO=k.requireComponent,oB=k.executeInEditMode,oN=k.disallowMultiple,oM=globalThis.game.language;oo=oL("Localize"),os=oO(L),ol=oB(!0),ou=oP({visible:!0}),oc=oP({group:{name:"Fonts",id:"fonts",displayOrder:1},type:eE}),oh=oP({group:{name:"Fonts",id:"fonts",displayOrder:2},type:eE}),oo(op=oN(op=os(op=ol((st((of=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"enFont",oy,Ke(g)),rt(g,"ruFont",ov,Ke(g)),g.handleLanguageChanged=function(){g.updateTransToNode()},g}return Ue(n,[{key:"key",get:function(){return this._key},set:function(g){g&&(this._key=g,this.updateTransToNode())}},{key:"__preload",value:function(){this.label=this.getComponent(L),this.validateRequiredComponents(),this.updateTransToNode()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"start",value:function(){this.listenEvent()}},{key:"listenEvent",value:function(){Q.on("update-language",this.handleLanguageChanged)}},{key:"updateTransToNode",value:function(){if(this.node.active&&this._key)try{var g=oM.getText(this._key),E=this.getFontByLang();this.label.font=E,this.label.string=g,this.node.emit("update-trans",g)}catch(g){console.warn(g)}}},{key:"getFontByLang",value:function(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(oM.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}]),n}(M)).prototype,"key",[ou],Object.getOwnPropertyDescriptor(of.prototype,"key"),of.prototype),oy=st(of.prototype,"enFont",[oc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ov=st(of.prototype,"ruFont",[oh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),op=of))||op)||op)||op);_._RF.pop(),_._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var oD,oF,oU,ox,oz,oG,oV,oK,oH,oq=k.ccclass,oW=k.property,oj=function(){function e(g,E){Fe(this,e);var _=null!=E?E:{response:1,dampen:1,eager:1};this.k1=e.calcK1(_),this.k2=e.calcK2(_),this.k3=e.calcK3(_),this.xp=g.clone(),this.y=g.clone(),this.yd=new eS(0,0)}return Ue(e,[{key:"update",value:function(g,E,_){var k=arguments.length>2&&void 0!==_?_:null,C=k;null===C&&(C=new eS((E.x-this.xp.x)/g,(E.y-this.xp.y)/g),this.xp.x=E.x,this.xp.y=E.y);var A=Math.max(this.k2,g*g/2+g*this.k1/2,g*this.k1);return this.y.x=this.y.x+g*this.yd.x,this.y.y=this.y.y+g*this.yd.y,this.yd.x=this.yd.x+g*(E.x+this.k3*C.x-this.y.x-this.k1*this.yd.x)/A,this.yd.y=this.yd.y+g*(E.y+this.k3*C.y-this.y.y-this.k1*this.yd.y)/A,this.y}},{key:"setDynamics",value:function(g){this.k1=e.calcK1(g),this.k2=e.calcK2(g),this.k3=e.calcK3(g)}},{key:"reset",value:function(g){this.xp.set(g.x,g.y),this.y.set(g.x,g.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(g){return g.dampen/(Math.PI*g.response)}},{key:"calcK2",value:function(g){return 1/(2*Math.PI*g.response*(2*Math.PI*g.response))}},{key:"calcK3",value:function(g){return g.eager*g.dampen/(2*Math.PI*g.response)}}]),e}(),oX=(oS=oq("SODConfig"),oE=oW({type:K,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),o_=oW({type:K,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),ok=oW({type:K,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),oS((oT=st((oA=Ue(function e(){Fe(this,e),rt(this,"response",oT,this),rt(this,"dampen",oR,this),rt(this,"eager",oI,this)})).prototype,"response",[oE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),oR=st(oA.prototype,"dampen",[o_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),oI=st(oA.prototype,"eager",[ok],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oC=oA))||oC);_._RF.pop(),_._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var oY,oJ,oQ,oZ,o$,o0,o1,o2,o4,o3,o5,o6,o8,o9,o7,se,sn,si,sr,sa,so,ss,sl,su,sc,sh,sp=k.ccclass,sf=k.property,sy=(oD=sp("Trail"),oF=sf({type:C,displayName:"Target"}),oU=sf({type:ed,displayName:"Graphics"}),ox=sf({type:[oX],displayName:"Trail Nodes"}),oD((oV=st((oG=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"target",oV,Ke(g)),rt(g,"graphics",oK,Ke(g)),rt(g,"trailNodes",oH,Ke(g)),g.trailNodeInstances=[],g}return Ue(n,[{key:"reset",value:function(){var g,E=at(this.trailNodeInstances);try{for(E.s();!(g=E.n()).done;)g.value.reset(new eS(this.node.worldPosition.x,this.node.worldPosition.y))}catch(g){E.e(g)}finally{E.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(g){this.graphics.clear();var E=this.trailNodeInstances[0];this.drawTrail(g,E,this.target.worldPosition.x,this.target.worldPosition.y);for(var _=1;_<this.trailNodeInstances.length;_++){var k=this.trailNodeInstances[_-1],C=this.trailNodeInstances[_];this.drawTrail(g,C,k.currentState.x,k.currentState.y)}}},{key:"drawTrail",value:function(g,E,_,k){var C=this.graphics,A=new eS(_,k),T=E.update(g,A),R=new em(A.x,A.y,0),I=new em(T.x,T.y,0);C.node.inverseTransformPoint(R,R),C.node.inverseTransformPoint(I,I),C.moveTo(R.x,R.y),C.lineTo(I.x,I.y),C.stroke()}},{key:"spawnTrailNodes",value:function(){var g,E=at(this.trailNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value,k=new eS(this.node.worldPosition.x,this.node.worldPosition.y),C=new oj(k,_);this.trailNodeInstances.push(C)}}catch(g){E.e(g)}finally{E.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(M)).prototype,"target",[oF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oK=st(oG.prototype,"graphics",[oU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oH=st(oG.prototype,"trailNodes",[ox],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oz=oG))||oz);_._RF.pop(),_._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var sv,sg=k.ccclass,sm=k.executionOrder,sb=k.property,sw=GameCore.Utils.Function,sS="Batch By Name",sE="Batch Label",s_="Batch Sprite",sk=(oY=sg("BatchNodes"),oJ=sm(99999),oQ=sb({group:{name:sS}}),oZ=sb({type:[V],group:{name:sS}}),o$=sb({type:[x],group:{name:sS}}),o0=sb({group:{name:sE}}),o1=sb({group:{name:sE}}),o2=sb({group:{name:sE}}),o4=sb({group:{name:s_}}),o3=sb({group:{name:s_}}),o5=sb({readonly:!0}),o6=sb({readonly:!0}),o8=sb({readonly:!0}),oY(o9=oJ((se=st((o7=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"batchByName",se,Ke(g)),rt(g,"depthNames",sn,Ke(g)),rt(g,"listName",si,Ke(g)),rt(g,"batchLabel",sr,Ke(g)),rt(g,"depthLabel",sa,Ke(g)),rt(g,"typeLabel",so,Ke(g)),rt(g,"batchSprite",ss,Ke(g)),rt(g,"depthSprite",sl,Ke(g)),rt(g,"batchAllNodes",su,Ke(g)),rt(g,"batchDepth",sc,Ke(g)),rt(g,"checkOverlap",sh,Ke(g)),g.batchNode={},g.labelChildren=[],g.spriteChildren=[],g.allChildren=[],g.nameChildren=[],g.originalParents={},g.isInited=!1,g.handleNodeChange=sw.throttle(function(){g.isInited&&(console.warn("handleNodeChange",g.node.name),g.setupBatchNodes(g.node))},1e3),g.onAfterUpdate=function(){g.isInited&&g.hierarchyChildren()},g.onAfterRender=function(){g.isInited&&g.restoreOriginalChildren()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled&&(N.on(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.on(e_.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){N.off(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.off(e_.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){this.isInited||(N.on(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.on(e_.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"handleActiveChange",value:function(g){g.once(C.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.handleNodeChange)}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),N.off(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.off(e_.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(g){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(g),this.createGlobalNodes(g),this.createGlobalNameNodes(g),this.createGlobalLabelNode(g),this.createGlobalSpriteNode(g),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var g,E,_,k=this;null===(g=this.batchNode.node)||void 0===g||g.setSiblingIndex(0),null===(E=this.batchNode.label)||void 0===E||E.setSiblingIndex(this.depthLabel),null===(_=this.batchNode.sprite)||void 0===_||_.setSiblingIndex(this.depthSprite),this.listName.forEach(function(g,E){var _;console.log("name",g,k.depthNames[E]),null===(_=k.batchNode[g])||void 0===_||_.setSiblingIndex(k.depthNames[E])})}},{key:"createGlobalNodes",value:function(g){if(this.batchAllNodes){var E=new C("GlobalBatchNode");E.active=!0,this.batchNode.node=E,g.addChild(E)}}},{key:"createGlobalNameNodes",value:function(g){if(this.batchByName){var E,_=at(this.listName);try{for(_.s();!(E=_.n()).done;){var k=E.value;if(!this.batchNode[k]){var A=new C(k);A.active=!0,this.batchNode[k]=A,g.addChild(A)}}}catch(g){_.e(g)}finally{_.f()}}}},{key:"createGlobalLabelNode",value:function(g){if(this.batchLabel){var E=new C("GlobalLabelNode");E.active=!0,this.batchNode.label=E,g.addChild(E)}}},{key:"createGlobalSpriteNode",value:function(g){if(this.batchSprite){var E=new C("GlobalSpriteNode");E.active=!0,this.batchNode.sprite=E,g.addChild(E)}}},{key:"saveOriginalParents",value:function(){var g,E=[].concat(tt(this.labelChildren),tt(this.spriteChildren)),_=this.nameChildren,k=at(E);try{for(k.s();!(g=k.n()).done;){var C=g.value;C.node.parent&&(this.handleActiveChange(C.node),this.originalParents[C.uuid]=C.node.parent)}}catch(g){k.e(g)}finally{k.f()}var A,T=at(_);try{for(T.s();!(A=T.n()).done;){var R=A.value;R.parent&&(this.handleActiveChange(R),this.originalParents[R.uuid]=R.parent)}}catch(g){T.e(g)}finally{T.f()}}},{key:"saveOriginalChildren",value:function(g){var E,_=at(g.children);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.saveLabelChildren(k),this.saveSpriteChildren(k),this.saveNodeChildrenByName(k),this.saveNodeChildrenByType(k)}}catch(g){_.e(g)}finally{_.f()}this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(g){var E;if(this.batchLabel){var _=g.getComponentsInChildren(L);"char"===this.typeLabel&&(_=_.filter(function(g){return g.cacheMode===L.CacheMode.CHAR})),0!==_.length&&(E=this.labelChildren).push.apply(E,tt(_))}}},{key:"saveSpriteChildren",value:function(g){var E;if(this.batchSprite){var _=g.getComponentsInChildren(eo);0!==_.length&&(E=this.spriteChildren).push.apply(E,tt(_))}}},{key:"saveNodeChildrenByName",value:function(g){if(this.batchByName){var E,_=at(g.children);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.listName.includes(k.name)?this.nameChildren.push(k):this.saveNodeChildrenByName(k)}}catch(g){_.e(g)}finally{_.f()}}}},{key:"saveNodeChildrenByType",value:function(g,E){var _,k=arguments.length>1&&void 0!==E?E:0;if(this.batchAllNodes){var C=g.getComponentsInChildren(M);if((_=this.allChildren).push.apply(_,tt(C)),!(this.batchDepth<1||k>=this.batchDepth)){var A,T=at(this.allChildren);try{for(T.s();!(A=T.n()).done;){var R=A.value;this.saveNodeChildrenByType(R.node,this.batchDepth)}}catch(g){T.e(g)}finally{T.f()}}}}},{key:"hierarchyChildren",value:function(){var g,t=function(g,E){g.node.isValid&&g.node.activeInHierarchy&&!g.node.isChildOf(E)&&(g.node.setParent(E,!0),g.node.layer=ek.Enum.UI_2D)},E=["GlobalLabelNode","GlobalSpriteNode","GlobalBatchNode"],_=at(this.labelChildren);try{for(_.s();!(g=_.n()).done;)t(g.value,this.batchNode.label)}catch(g){_.e(g)}finally{_.f()}var k,C=at(this.spriteChildren);try{for(C.s();!(k=C.n()).done;)t(k.value,this.batchNode.sprite)}catch(g){C.e(g)}finally{C.f()}var A,T=at(this.allChildren);try{for(T.s();!(A=T.n()).done;)t(A.value,this.batchNode.node)}catch(g){T.e(g)}finally{T.f()}this.allChildren.sort(function(g,E){return g.constructor.name.localeCompare(E.constructor.name)}),this.labelChildren.sort(function(g,E){return g.cacheMode-E.cacheMode});var R,I=at(this.nameChildren);try{for(I.s();!(R=I.n()).done;){var L=R.value;if(L.isValid&&L.activeInHierarchy&&L.isTransformDirty()){var P=L.getComponent(eu);P&&P.opacity<1||E.includes(L.name)||L.isChildOf(this.batchNode[L.name])||(L.setParent(this.batchNode[L.name],!0),L.layer=ek.Enum.UI_2D)}}}catch(g){I.e(g)}finally{I.f()}}},{key:"restoreOriginalChildren",value:function(){var g=[].concat(tt(this.labelChildren),tt(this.spriteChildren));if(g.length>0){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value,C=this.originalParents[k.uuid];C&&(k.node.isChildOf(C)||k.node.setParent(C,!0))}}catch(g){_.e(g)}finally{_.f()}}var A,T=at(this.nameChildren);try{for(T.s();!(A=T.n()).done;){var R=A.value,I=this.originalParents[R.uuid];I&&(R.isChildOf(I)||R.setParent(I,!0))}}catch(g){T.e(g)}finally{T.f()}}}]),n}(M)).prototype,"batchByName",[oQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sn=st(o7.prototype,"depthNames",[oZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),si=st(o7.prototype,"listName",[o$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sr=st(o7.prototype,"batchLabel",[o0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sa=st(o7.prototype,"depthLabel",[o1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),so=st(o7.prototype,"typeLabel",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),ss=st(o7.prototype,"batchSprite",[o4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sl=st(o7.prototype,"depthSprite",[o3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),su=st(o7.prototype,"batchAllNodes",[o5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sc=st(o7.prototype,"batchDepth",[o6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sh=st(o7.prototype,"checkOverlap",[o8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),o9=o7))||o9)||o9);_._RF.pop(),_._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var sC=k.ccclass,sA=GameCore.Utils.Browser,sT=globalThis.game.player,sR=sC("Vibrate")(sv=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"vibrate",value:function(g){if(this.isVibrateEnable()&&!sA.vibrate(g)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!sT.getPlayerSetting("vibrate")}}]),n}(M))||sv;_._RF.pop(),_._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);var sI=1/6;_._RF.pop(),_._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);var sL,sP={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};_._RF.pop(),_._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var sO=10,sB=20,sN=100,sM=(Ge(sL={},sP.HINT,80),Ge(sL,sP.THUNDER,200),Ge(sL,sP.STORM,150),Ge(sL,sP.PLIERS,150),sL),sD=2e3,sF=300;_._RF.pop(),_._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var sU={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};_._RF.pop(),_._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);var sx=Me(Me({},GameCore.Dtos.Match.Data.getDefaultData()),{},{extraData:null});_._RF.pop(),_._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var sz=function(g){return g.UNLOCK_DEV_TOOLS="unlock-dev-tools",g.TRIGGER_UNLOCK_KEY="trigger-unlock-key",g.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",g}(sz||{}),sG={Events:sz,UNLOCK_SEQUENCE:"101013012031"};_._RF.pop(),_._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);var sV;_._RF.pop(),_._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);var sK={level:0,coins:0,stars:0,totalLevel:400,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:(sV={},Ge(sV,sP.HINT,0),Ge(sV,sP.THUNDER,0),Ge(sV,sP.STORM,0),Ge(sV,sP.PLIERS,0),sV)};_._RF.pop(),_._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);var sH="global-leaderboard-key",sq="friends-leaderboard-key",sW="global-leaderboard-id",sj="friends-leaderboard-id";_._RF.pop(),_._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);var sX=Me(Me({},GameCore.Dtos.Match.CustomData.getDefaultData()),{},{score:0});_._RF.pop(),_._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);var sY={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:sK,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};_._RF.pop(),_._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);var sJ="BootScene",sQ="GameScene",sZ="DashboardScene",s$="ChallengeResultScene";_._RF.pop(),_._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var s0=function(g){return g.RELOAD_TOURNAMENT="reload-tournament",g}(s0||{});_._RF.pop(),_._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);var s1=GameCore,s2=s1.Configs.FrameCapture,s4=s2.Enabled,s3=s2.WideframeConfigs,s5=s1.Utils.Object,s6=function(){var g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){if(!s4)return[2,(console.warn("FrameCapture is not enabled"),null)];E=wu(g);if(!E)return[2,null];Su(E,s3.CustomResultChallenge);_=window.game.frameCapture,k=s3.CustomResultChallenge,C=k.Width,A=k.Height;return[2,_.captureAsync({name:"CustomResultChallenge",width:C,height:A,renderOptions:E})]})});return function(E){return g.apply(this,arguments)}}(),Su=function(g,E){var _=E.Width,k=E.Height,C=E.Wideframe;g.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:C,size:[_,k],position:[0,0]}},wu=function(g){try{var E=g.playerId,_=void 0===E?"10":E,k=g.playerPhoto,C=void 0===k?"":k,A=g.playerScore,T=void 0===A?0:A,R=g.opponentId,I=void 0===R?"20":R,L=g.opponentPhoto,P=void 0===L?"":L,O=g.opponentScore,B=void 0===O?0:O,N=g.isPlayerFinished,M=g.isOpponentFinished,D=s3.CustomResultChallenge.RenderOptions;if(!D)return null;var F=s5.camelCaseKeys(s5.clone(D)||{}),U=F.playerPhoto,x=F.opponentPhoto,z=T===B,G=T>B,V=null!=N?N:M,K=N&&M;return"image"===U.type&&(U.name="".concat(_),U.image=C),"image"===x.type&&(x.name="".concat(I),x.image=P),V&&Eu(F,{playerScore:T,opponentScore:B,isPlayerFinished:N,isOpponentFinished:M}),!K||z?(delete F.leftCrown,delete F.rightCrown,F):(G?delete F.rightCrown:delete F.leftCrown,F)}catch(g){return console.warn("getRenderOptionsShareScore",g),null}},Eu=function(g,E){var _=g.leftScore,k=g.rightScore,C=E.playerScore,A=void 0===C?0:C,T=E.opponentScore,R=void 0===T?0:T,I=E.isPlayerFinished,L=E.isOpponentFinished;"text"===_.type&&(_.text=I?"".concat(A):"???"),"text"===k.type&&(k.text=L?"".concat(R):"???")};_._RF.pop(),_._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var s8=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,_)).code=g,k}return Ue(n)}(je(Error));_._RF.pop(),_._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var s9=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=g,k.tournamentId=_,k}return Ue(n)}(s8);_._RF.pop(),_._RF.push({},"e80e4nIcfdLN56j5b9SMhvH","LeaderboardUtils",void 0);var s7=globalThis.game.leaderboard,le=function(){function e(){Fe(this,e)}var g,E,_;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getAllLeaderboardAsync",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!s7)return[2,null];return[4,s7.getLeaderboardResponseAsync(g)];case 1:E=C.sent();if(!E)return[2,null];_=s7.getLeaderboardName(g);if(!_)return[3,3];return[4,this.requestLeaderboardAsync(_,E.amountPlayer)];case 2:k=(C.sent(),s7.getLeaderboard(_));return[3,4];case 3:k=null;C.label=4;case 4:return[2,k]}})}),function(g){return _.apply(this,arguments)})},{key:"requestLeaderboardAsync",value:(E=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:if(!this.isLeaderboardRequesting(g))return[3,2];return[4,this.waitForLeaderboardFinishAsync(g)];case 1:_.sent();return[3,4];case 2:return[4,s7.requestLeaderboardAsync(g,E)];case 3:_.sent();_.label=4;case 4:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"waitForLeaderboardFinishAsync",value:(g=Be(function(g){var E;return _ts_generator(this,function(_){E=this;return[2,new Promise(function(_){var k=setInterval(function(){E.isLeaderboardRequesting(g)||(clearInterval(k),_())},100)})]})}),function(E){return g.apply(this,arguments)})},{key:"isLeaderboardRequesting",value:function(g){var E;return(null===(E=s7.getLeaderboard(g))||void 0===E?void 0:E.isRequesting)||!1}}]),e}();try{new le}catch(g){console.error("LeaderboardUtils",g)}_._RF.pop(),_._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var lt={mapOrder:[{id:1,theme:"summer",skins:["fruit"],levelCount:10},{id:2,theme:"autumn",skins:["flower"],levelCount:10},{id:3,theme:"winter",skins:["tool"],levelCount:10},{id:4,theme:"summer",skins:["sport"],levelCount:10},{id:5,theme:"autumn",skins:["cosmetics"],levelCount:10},{id:6,theme:"winter",skins:["ice-cream"],levelCount:10},{id:7,theme:"summer",skins:["cakes"],levelCount:10},{id:8,theme:"autumn",skins:["car"],levelCount:10},{id:9,theme:"spring-festival",skins:["flower","ice-cream"],levelCount:10},{id:10,theme:"tree-planting-festival",skins:["fruit","car","tool"],levelCount:10},{id:11,theme:"blue-sea-festival",skins:["sport","fruit"],levelCount:10},{id:12,theme:"music-festival",skins:["cakes","car","cosmetics"],levelCount:10},{id:13,theme:"harvest-festival",skins:["fruit","car","tool"],levelCount:10},{id:14,theme:"food-festival",skins:["cakes","ice-cream","cosmetics"],levelCount:10},{id:15,theme:"snow-festival",skins:["cakes","sport"],levelCount:10},{id:16,theme:"light-festival",skins:["ice-cream","car"],levelCount:10},{id:17,theme:"peace-festival",skins:["flower","sport","tool"],levelCount:10},{id:18,theme:"flower-festival",skins:["flower","fruit"],levelCount:10},{id:19,theme:"street-festival",skins:["fruit","ice-cream","sport"],levelCount:10},{id:20,theme:"color-garden",skins:["cakes","cosmetics","tool"],levelCount:10},{id:21,theme:"color-festival",skins:["flower","cakes","fruit"],levelCount:10},{id:22,theme:"nature-summer",skins:["flower","sport"],levelCount:10},{id:23,theme:"snow-mountain",skins:["cakes","ice-cream"],levelCount:10},{id:24,theme:"ice-festival",skins:["ice-cream","cosmetics"],levelCount:10},{id:25,theme:"green-grass-festival",skins:["flower","sport","tool"],levelCount:10},{id:26,theme:"community-festival",skins:["cosmetics","cakes","ice-cream"],levelCount:10},{id:27,theme:"water-festival",skins:["sport","ice-cream","flower"],levelCount:10},{id:28,theme:"animal-festival",skins:["flower","fruit","cakes"],levelCount:10},{id:29,theme:"lost-festival",skins:["sport","tool","car"],levelCount:10},{id:30,theme:"halloween-festival",skins:["cakes","car","fruit"],levelCount:10},{id:31,theme:"snow-music-festival",skins:["ice-cream","sport","tool"],levelCount:10},{id:32,theme:"christmas",skins:["cakes","flower","sport"],levelCount:10},{id:33,theme:"spring-flower-festival",skins:["flower","fruit"],levelCount:10},{id:34,theme:"tet-holiday",skins:["flower","cosmetics","fruit"],levelCount:10},{id:35,theme:"sea-festival",skins:["ice-cream","sport"],levelCount:10},{id:36,theme:"firework-festival",skins:["cosmetics","car","tool"],levelCount:10},{id:37,theme:"halloween-horror",skins:["cakes","car","fruit"],levelCount:10},{id:38,theme:"mid-autumn",skins:["flower","fruit","ice-cream"],levelCount:10},{id:39,theme:"christmas-sweet",skins:["cakes","flower","sport"],levelCount:10},{id:40,theme:"new-year-countdown",skins:["cosmetics","car","tool"],levelCount:10}]};_._RF.pop(),_._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);var ln={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter",SPRING_FESTIVAL:"spring-festival",TREE_PLANTING_FESTIVAL:"tree-planting-festival",BLUE_SEA_FESTIVAL:"blue-sea-festival",MUSIC_FESTIVAL:"music-festival",HARVEST_FESTIVAL:"harvest-festival",FOOD_FESTIVAL:"food-festival",SNOW_FESTIVAL:"snow-festival",LIGHT_FESTIVAL:"light-festival",PEACE_FESTIVAL:"peace-festival",FLOWER_FESTIVAL:"flower-festival",STREET_FESTIVAL:"street-festival",COLOR_GARDEN:"color-garden",COLOR_FESTIVAL:"color-festival",NATURE_SUMMER:"nature-summer",SNOW_MOUNTAIN:"snow-mountain",ICE_FESTIVAL:"ice-festival",GREEN_GRASS_FESTIVAL:"green-grass-festival",COMMUNITY_FESTIVAL:"community-festival",WATER_FESTIVAL:"water-festival",ANIMAL_FESTIVAL:"animal-festival",LOST_FESTIVAL:"lost-festival",HALLOWEEN_FESTIVAL:"halloween-festival",SNOW_MUSIC_FESTIVAL:"snow-music-festival",CHRISTMAS:"christmas",SPRING_FLOWER_FESTIVAL:"spring-flower-festival",TET_HOLIDAY:"tet-holiday",SEA_FESTIVAL:"sea-festival",FIREWORK_FESTIVAL:"firework-festival",HALLOWEEN_HORROR:"halloween-horror","MID-AUTUMN":"mid-autumn",CHRISTMAS_SWEET:"christmas-sweet",NEW_YEAR_COUNTDOWN:"new-year-countdown",HAPPY_NEW_YEAR:"happy-new-year"};Z(ln),_._RF.pop(),_._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var li=globalThis.game,lr=li.player,la=li.storage,lo={id:0,currentTheme:ln.SUMMER,nextTheme:null,progress:0,max:10},ls={skins:["cakes"],theme:"summer",progress:0,max:10,isLocked:!0},ll=function(){function e(){Fe(this,e),this.mapData=lt,this.playerSkinProgress=null}return Ue(e,[{key:"initDashboardSceneStorage",value:function(){var g=la.getStorage("dashboard");if(null==g){var E=this.getCurrentMapProgressInstance();la.addStorage("dashboard",{lastMapPayload:E,numOfMapsPassed:0,animateToCurrentLevel:!1});var _=la.getStorage("collection");if(null==_){la.addStorage("collection",{lastMapPack:E.id,animateMapPackUnlock:!1});var k=la.getStorage("leaderboard_content");if(null==k){la.addStorage("leaderboard_content",{lastTabOpened:"global",previousScore:-1});var C=la.getStorage("tournament");null==C&&la.addStorage("tournament",{animateTournamentLeader:!1,previousScore:-1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),lo;for(var g=this.mapData.mapOrder,E=void 0,_=void 0,k=0,C=0,A=0,T=0;T<g.length;T++){var R=this.playerSkinProgress[T];if(R.currentProgress<R.maxProgress){var I,L;A=g[T].id,E=g[T].theme,_=null!==(I=null===(L=g[T+1])||void 0===L?void 0:L.theme)&&void 0!==I?I:E,k=R.currentProgress,C=R.maxProgress;break}}if(void 0===E||void 0===_){var P=g[g.length-1];return A=P.id,E=P.theme,_=P.theme,k=P.levelCount,C=P.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:A,currentTheme:E,nextTheme:_,progress:k,max:C}}return{id:A,currentTheme:E,nextTheme:_,progress:k,max:C}}},{key:"getUnlockedSkinsInstance",value:function(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];var g,E=[],_=at(this.playerSkinProgress);try{for(_.s();!(g=_.n()).done;){var k=g.value;k.isLocked||1!==k.skins.length||E.push(k.skins[0])}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"getLevelSkinsInstance",value:function(g){var E,_=null!=g?g:1,k=this.mapData.mapOrder,C=0,A=at(k);try{for(A.s();!(E=A.n()).done;){var T=E.value;if(C+T.levelCount>=_)return console.log("getMapSkin",T.skins),T.skins;C+=T.levelCount}}catch(g){A.e(g)}finally{A.f()}var R=k[k.length-1];return console.log("getMapSkin",R.skins),R.skins}},{key:"getLevelThemeInstance",value:function(g){var E,_=null!=g?g:1,k=this.mapData.mapOrder,C=0,A=at(k);try{for(A.s();!(E=A.n()).done;){var T=E.value;if(C+T.levelCount>=_)return console.log("getMapTheme",T.theme),T.theme;C+=T.levelCount}}catch(g){A.e(g)}finally{A.f()}var R=k[k.length-1];return console.log("getMapTheme",R.theme),R.theme}},{key:"getThemeSkinsInstance",value:function(g){var E,_=at(this.mapData.mapOrder);try{for(_.s();!(E=_.n()).done;){var k=E.value;if(k.theme===g)return console.log("getThemeSkins",k.skins),k.skins}}catch(g){_.e(g)}finally{_.f()}return console.warn("getThemeSkins: theme not found",g),[]}},{key:"getCollectionUnlockProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[ls];var g,E=[],_=at(this.playerSkinProgress);try{for(_.s();!(g=_.n()).done;){var k=g.value;E.push({skins:k.skins,theme:k.themeId,progress:k.currentProgress,max:k.maxProgress,isLocked:k.isLocked})}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"updatePlayerSkinProgress",value:function(){console.log("getPlayerSkinProgress: playerData not found, use data from level");var g=this.mapData.mapOrder;this.playerSkinProgress=[];var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.playerSkinProgress.push({skins:k.skins,themeId:k.theme,currentProgress:0,maxProgress:k.levelCount,isLocked:!0})}}catch(g){_.e(g)}finally{_.f()}this.updatePlayerSkinProgressByLevel()}},{key:"updatePlayerSkinProgressByLevel",value:function(){var g,E=lr.getGameData(),_=(null!==(g=null==E?void 0:E.level)&&void 0!==g?g:1)-1,k=this.mapData.mapOrder;this.playerSkinProgress[0].isLocked=!1;for(var C=0;C<k.length;C++){var A=k[C];if(!(_<=0)){var T=_-A.levelCount>=0?A.levelCount:_;_-=T,this.increaseProgress(C,T)}}}},{key:"increaseProgress",value:function(g,E){if(null!==this.playerSkinProgress){if(g>=this.playerSkinProgress.length)console.warn("increaseProgress: index out of range",g);else{var _,k=this.playerSkinProgress[g],C=k.currentProgress,A=k.maxProgress,T=C+E>A?A:C+E;if(T>0&&(this.playerSkinProgress[g].isLocked=!1),T===A)(null===(_=this.mapData.mapOrder[g+1])||void 0===_?void 0:_.skins)&&this.unlockSkin(g+1);this.playerSkinProgress[g].currentProgress=T,this.playerSkinProgress[g].maxProgress=A}}else console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?")}},{key:"unlockSkin",value:function(g){null!==this.playerSkinProgress?g>=this.playerSkinProgress.length?console.warn("unlockSkin: index out of range",g):this.playerSkinProgress[g].isLocked=!1:console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var g=this.getInstance();g.updatePlayerSkinProgress(),g.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkins",value:function(g){return this.getInstance().getLevelSkinsInstance(g)}},{key:"getLevelTheme",value:function(g){return this.getInstance().getLevelThemeInstance(g)}},{key:"getThemeSkins",value:function(g){return this.getInstance().getThemeSkinsInstance(g)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"getCurrentUnlockingThemeIndex",value:function(){var g=this.getCollectionUnlockProgress();if(0===g.length)return null;var E=0;return g.forEach(function(g,_){g.isLocked||(E=_)}),E}}]),e}();_._RF.pop(),_._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var lu=globalThis.game,lc=lu.match,lh=lu.player,lp=lu.leaderboard,ld=lu.frameCapture,lf=GameCore,ly=lf.Utils,lv=ly.Object,lg=ly.Valid,lm=ly.String,lb=ly.Array,lw=lf.Match.Modes,lS=lf.Dtos.Match.Data,lE=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],l_=function(){function e(){Fe(this,e)}var g,E,_,k,C,A,T,R,I,L,P,O,B,N,M,D,F,U,x;return Ue(e,[{key:"processStartSingleModeAsync",value:(x=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=lh.getPlayerId();return[4,lc.single.start.processAsync({playerId:g})];case 1:E.sent();return[2]}})}),function(){return x.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(U=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,lc.single.finish.processAsync()];case 1:g.sent();return[2]}})}),function(){return U.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(F=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=lh.getPlayerId(),E=GameSDK.context.getID();return[4,lc.tournament.continue.processAsync({playerId:g,contextId:E})];case 1:_.sent();return[2]}})}),function(){return F.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(D=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=lh.getPlayerId(),E=lh.getBestScore();return[4,lc.tournament.finish.processAsync({playerId:g,bestScore:E})];case 1:_.sent();return[2]}})}),function(){return D.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(M=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,7]);return[4,this.processContinueChallengeAsync()];case 1:k.sent();return[3,7];case 2:g=k.sent();if(!lv.hasOwn(g,"name")||lg.isString(g.name))throw g;E="PlayerHasFinishedMatch"===g.name;if(!E)return[3,4];return[4,this.processChallengeNewOpponentAsync()];case 3:E=k.sent();k.label=4;case 4:_="PlayerNotJoinInMatch"===g.name;if(!_)return[3,6];return[4,this.processJoinChallengeAsync()];case 5:_=k.sent();k.label=6;case 6:return[3,7];case 7:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(N=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:ld.addWideframeRender("renderResultChallenge",ld.wideframe.renderResultChallenge);return[4,lc.challenge.finish.processAsync(g)];case 1:E.sent();return[2]}})}),function(g){return N.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(B=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=this.getMatchState(),E=g.id,_=g.customData,k=_.playerId,C=_.opponentId;if(!lg.isString(E))throw new Error("Invalid match id");if(!lg.isString(k))throw new Error("Invalid player id");if(!lg.isString(C))throw new Error("Invalid opponent id");A=GameSDK.context.getID();if(!A)throw new Error("Cannot get contextId");return[4,lc.challenge.continue.processAsync({matchId:E,contextId:A,playerId:k,opponentId:C})];case 1:T.sent();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(O=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:g=lh.getConnectedPlayerIds(100,0),E=Math.floor(Math.random()*g.length),_=lh.getPlayerId(),k=g[E];return[4,lc.challenge.friend.processAsync({playerId:_,opponentId:k})];case 1:C.sent();return[2]}})}),function(){return O.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(P=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=this.getMatchState(),E=g.id,_=g.customData,k=_.playerId,C=_.opponentId;if(!lg.isString(E))throw new Error("Invalid match id");if(!lg.isString(k))throw new Error("Invalid player id");if(!lg.isString(C))throw new Error("Invalid opponent id");return[4,lc.challenge.join.processAsync({matchId:E,playerId:k,opponentId:C})];case 1:A.sent();return[2]}})}),function(){return P.apply(this,arguments)})},{key:"getMatchState",value:function(){var g=lc.getMatchState();if(!g)throw new Error("Match state not found");return g}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(L=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,10,,11]);E=null!=g?g:this.getMatchMode();switch(E){case lw.SINGLE:return[3,1];case lw.TOURNAMENT:return[3,3];case lw.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processStartSingleModeAsync()];case 2:k.sent();return[3,9];case 3:return[4,this.inst.processStartTournamentModeAsync()];case 4:k.sent();return[3,9];case 5:return[4,this.inst.processStartChallengeModeAsync()];case 6:k.sent();return[3,9];case 7:return[4,this.inst.processStartSingleModeAsync()];case 8:k.sent();k.label=9;case 9:return[3,11];case 10:_=k.sent();console.warn("startMatchAsync",_);return[3,11];case 11:return[2]}})}),function(g){return L.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(I=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lc.handler.setProfileData(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setProfileMatchDataAsync",E);return[3,3];case 3:return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(R=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lc.handler.setMatchCustomData(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setMatchCustomDataAsync",E);return[3,3];case 3:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lc.handler.setLeaderboardScore(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setLeaderboardScoreAsync",E);return[3,3];case 3:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"finishMatchAsync",value:(A=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,10,,11]);E=this.getMatchMode();switch(E){case lw.SINGLE:return[3,1];case lw.TOURNAMENT:return[3,3];case lw.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processFinishSingleModeAsync()];case 2:k.sent();return[3,9];case 3:return[4,this.inst.processFinishTournamentModeAsync()];case 4:k.sent();return[3,9];case 5:return[4,this.inst.processFinishChallengeModeAsync(g)];case 6:k.sent();return[3,9];case 7:return[4,this.inst.processFinishSingleModeAsync()];case 8:k.sent();k.label=9;case 9:return[3,11];case 10:_=k.sent();console.warn("finishMatchAsync",_);return[3,11];case 11:return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"joinTournamentAsync",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=lh.getPlayerId();return[4,lc.tournament.join.processAsync({tournamentId:g,playerId:E})];case 1:_.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"continueTournamentAsync",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=lh.getPlayerId();return[4,lc.tournament.continue.processAsync({playerId:E,contextId:g})];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"createTournamentName",value:function(){var g=lE[X.randomRangeInt(0,lE.length-1)],E="".concat(g," Tournament"),_=lm.removeDiacritics(E);return"".concat(_)}},{key:"getShortName",value:function(g,E){var _,k=arguments.length>1&&void 0!==E?E:50,C=g.split(" "),A=0,T="",R=at(C);try{for(R.s();!(_=R.n()).done;){var I=_.value;if(A+I.length+1>k)break;T+="".concat(I," "),A+=I.length+1}}catch(g){R.e(g)}finally{R.f()}return T.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var g,E,_,k=lm.generateObjectId(),C=lh.getPlayerId(),A=lh.getPlayer().name,T=lh.getGameData(),R=null!==(g=null==T?void 0:T.level)&&void 0!==g?g:1,I=ll.getLevelTheme(R),L=this.inst.getMatchState().profiles;return{score:null!==(E=null===(_=(void 0===L?{}:L)[C])||void 0===_?void 0:_.score)&&void 0!==E?E:0,playerId:C,mode:lw.TOURNAMENT,name:this.createTournamentName(),leaderboardId:k,payload:{playerId:C,playerName:A,leaderboardId:k,themeId:I}}}},{key:"getTournamentsAsync",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,GameSDK.tournament.getTournamentsAsync()];case 1:return[2,E.sent()];case 2:g=E.sent();return[2,(console.error(g),[])];case 3:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(E=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:return[4,this.getTournamentsAsync()];case 1:g=C.sent(),E=lb.search(g,function(g){var E,_=JSON.parse(null!==(E=g.getPayload())&&void 0!==E?E:"{}");return"DEFAULT"===g.getTournamentType()&&_.playerId===lh.getPlayerId()});if(E)throw new s9(lh.getPlayerId(),E.getID());_=this.createTournamentPayload();lh.setGameData({lastCreateTournamentShown:Date.now()});return[4,lc.tournament.create.processAsync(_)];case 2:C.sent();k=_.leaderboardId;lp.addLeaderboard({name:k,type:"tournament",autoSortRank:!0,leaderboardId:k});return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getMatchMode",value:function(){var g=this.inst.getMatchState();return lg.isString(g.mode)?g.mode:null}},{key:"getMatchCustomData",value:function(){var g=this.inst.getMatchState();return lg.isObject(g.customData)?g.customData:null}},{key:"getMatchExtraDataAsync",value:(g=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,lc.api.getMatchAPI().getMatchDetailByIdAsync(g)];case 1:E=_.sent();return[2,new lS(E).toObject().extraData]}})}),function(E){return g.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(g,E){this.setMatchCustomDataAsync({level:g,score:E});var _=lh.getPlayerId();this.setProfileMatchDataAsync({id:_,score:E})}}]),e}();_._RF.pop(),_._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);var lk,lC,lA,lT,lR,lI,lL,lP,lO,lB,lN,lM,lD=globalThis.game.event,lF=GameCore.Events,lU=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"switchScene",value:function(g,E){lD.emit(lF.SWITCH_SCENE,{sceneName:g,sceneData:E})}},{key:"preloadScene",value:function(g){lD.emit(lF.PRELOAD_SCENE,{sceneName:g})}},{key:"preloadDashboardScene",value:function(){this.preloadScene(sZ)}},{key:"switchToDashboardScene",value:function(g){this.switchScene(sZ,g)}},{key:"preloadGameScene",value:function(){this.preloadScene(sQ)}},{key:"switchToGameScene",value:function(g){this.switchScene(sQ,g)}},{key:"getSceneData",value:function(g){return"data"in g.scene&&g.scene.data||{}}}]),e}();_._RF.pop(),_._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);var lx,lz,lG,lV,lK,lH=k.ccclass,lq=k.property,lW=["Watch an ad to revive yourself\nKeep playing and don't give up!","Watching an ad doubles your rewards!","Test your skills\nin ranked tournaments","Challenge your friend\nSee who can score higher!","Send a challenge to your friend\nClaim bragging rights!","Clear all tiles to\nwin the level!","Beat the clock before\ntime runs out!","Clear bombs before\nthey explode","A season pack unlock\nnew tile sets!","The more stars you collect\nThe more coins you'll be rewarded!","Compete globally or with friends\nRise to the top in tournaments!","You can challenge a friend\nTest each other's reflexes!","The Thunder power-up\nblasts tiles away","A Hint power-up reveals\nthe next pair","Pliers can remove\nany bomb instantly","The Tornado power-up\nshuffles the board!","Earn coins by completing levels\nWin tournaments for even more!","A new tile set is unlocked\nevery season packs","Log in daily to claim\nbetter rewards!","Level up and earn coins\nwith each victory!","Each season pack offers\nnew tiles!"],lj=(lk=lH("LoadingFullScreen"),lC=nk.required(),lA=lq(ew),lT=nk.required(),lR=nk.getComponent(eu),lI=nk.required(),lL=lq(L),lk((lB=st((lO=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"progressBar",lB,Ke(g)),rt(g,"uiOpacity",lN,Ke(g)),rt(g,"loadingLabel",lM,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){nk.decorateComponent(this)}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0,this.progressBar.progress=0}},{key:"show",value:(_=Be(function(g){var E,_;return _ts_generator(this,function(g){switch(g.label){case 0:this.uiOpacity.opacity=0,this.progressBar.progress=0;E=z(this.uiOpacity).to(.5,{opacity:255},{easing:"cubicOut"}),_=z(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"});this.runLoadingTextAnimation(),tZ.runTweenAsync(E);return[4,tZ.runTweenAsync(_)];case 1:g.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(g){switch(g.label){case 0:if(!(this.uiOpacity&&this.progressBar))return[3,3];this.uiOpacity.opacity=255,this.progressBar.progress=.9;E=z(this.uiOpacity).to(.5,{opacity:0},{easing:"cubicIn"}),_=z(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"});this.runLoadingTextAnimation();return[4,tZ.runTweenAsync(_)];case 1:g.sent(),this.stopLoadingTextAnimation();return[4,tZ.runTweenAsync(E)];case 2:g.sent(),this.node.active=!1;g.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"runLoadingTextAnimation",value:function(){var g=this;this.updateHintText(),this.schedule(function(){return g.updateHintText()},5)}},{key:"updateHintText",value:function(){this.loadingLabel.string=this.getHintText()}},{key:"stopLoadingTextAnimation",value:function(){this.unscheduleAllCallbacks()}},{key:"getHintText",value:function(){return lW[Math.floor(Math.random()*lW.length)]}}]),a}(M)).prototype,"progressBar",[lC,lA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lN=st(lO.prototype,"uiOpacity",[lT,lR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lM=st(lO.prototype,"loadingLabel",[lI,lL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lP=lO))||lP);_._RF.pop(),_._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);var lX=k.ccclass,lY=k.property,lJ=(lx=lX("Loading"),lz=lY(ee),lx((lK=st((lV=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"loadingPrefab",lK,Ke(g)),g.loadingNode=null,g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"createLoadingFullScreen",value:function(){var g,E=$("Canvas");if(E&&!E.getChildByName("Loading")){this.loadingNode||(this.loadingNode=I(this.loadingPrefab));var _=I._clone(this.loadingNode);this.loadingFullScreen=_.getComponent(lj),this.node.active=!1,null===(g=$("Canvas"))||void 0===g||g.addChild(_)}}},{key:"show",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:this.createLoadingFullScreen();E=this.node.active;if(E)return[3,2];this.node.active=!0;return[4,this.loadingFullScreen.show(g)];case 1:E=_.sent();_.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=null!==(E=this.node)&&void 0!==E&&E.active&&this.loadingFullScreen;if(!_)return[3,2];return[4,this.loadingFullScreen.hide(g)];case 1:_=(k.sent(),this.node.active=!1);k.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),a}(M)).prototype,"loadingPrefab",[lz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lG=lV))||lG);_._RF.pop(),_._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);var lQ=globalThis.game.event,lZ=GameCore,l$=lZ.Events,l0=lZ.Utils.Array,l1=function(){function e(){Fe(this,e),this.showedScreens=[]}var g,E;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"openScreen",value:function(g,E){var _=im[g];lQ.emit(l$.OPEN_SCREEN,{screenName:_,screenData:E})}},{key:"closeScreen",value:function(g){var E=im[g];lQ.emit(l$.CLOSE_SCREEN,{screenName:E})}},{key:"openScreenAndWaitForClose",value:function(g,E){var _=this;return new Promise(function(k){_.openScreen(g,E);lQ.on(l$.CLOSE_SCREEN,function t(E){E.screenName===im[g]&&(lQ.off(l$.CLOSE_SCREEN,t),k(E))})})}},{key:"showLoadingScreen",value:function(g){this.openScreen(ig.LOADING_SCREEN,{duration:g})}},{key:"closeLoadingScreen",value:function(){this.closeScreen(ig.LOADING_SCREEN)}},{key:"showNotificationScreen",value:function(g,E){this.openScreen(ig.NOTIFICATION_SCREEN,{message:g,duration:E})}},{key:"closeNotificationScreen",value:function(){this.closeScreen(ig.NOTIFICATION_SCREEN)}},{key:"addShowedScene",value:function(g){l0.has(this.inst.showedScreens,g)||this.inst.showedScreens.push(g)}},{key:"showLoadingFullScreen",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!!l0.has(this.inst.showedScreens,g))return[3,3];this.addShowedScene(g);_=$("Loading");k=_;if(!k)return[3,2];_.active=!0;return[4,null===(E=_.getComponent(lJ))||void 0===E?void 0:E.show(g)];case 1:k=C.sent();C.label=2;case 2:C.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"hideLoadingFullScreen",value:(g=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=l0.has(this.inst.showedScreens,g);if(_)return[3,2];return[4,null===(E=$("Loading"))||void 0===E||null===(E=E.getComponent(lJ))||void 0===E?void 0:E.hide(g)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"showLoadingNotificationScreen",value:function(){this.openScreen(ig.NOTIFICATION_SCREEN,{message:"Loading",enableCloseOnTouch:!1})}},{key:"showTournamentDetailScreen",value:function(g,E,_){var k=!(arguments.length>2&&void 0!==_)||_;this.openScreen(ig.TOURNAMENT_DETAIL_SCREEN,{playAnimation:k,tournament:g,tournamentContextType:E})}},{key:"closeTournamentDetailScreen",value:function(){this.closeScreen(ig.TOURNAMENT_DETAIL_SCREEN)}}]),e}();_._RF.pop(),_._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);var l2=GameCore,l4=l2.Utils,l3=l4.String,l5=l4.Valid,l6=l4.Array,l8=l2.Configs.Mockup.Leaderboards,l9=globalThis.game,l7=l9.leaderboard,ue=l9.player,ut=function(){function e(){var g=this;Fe(this,e),this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,3,,4]);E=Date.now()-g.lastFetchGlobalTournament>g.maxTimeRefetch;if(!E)return[3,2];return[4,l7.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"})];case 1:E=(g.globalTournamentLBData=k.sent(),g.globalTournamentLBData.sort(function(g,E){return g.expireTime-E.expireTime}));k.label=2;case 2:return[3,4];case 3:_=k.sent();console.warn("fetchGlobalTournamentLeaderboardAsync",_);return[3,4];case 4:return[2,g.globalTournamentLBData]}})}),this.fetchTournamentsAsync=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,3,,4]);E=Date.now()-g.lastFetchTournamentsData>g.maxTimeRefetch;if(!E)return[3,2];return[4,GameSDK.tournament.getTournamentsAsync()];case 1:E=(g.playerTournaments=k.sent(),g.playerTournaments.sort(function(g,E){return g.getEndTime()-E.getEndTime()}));k.label=2;case 2:return[3,4];case 3:_=k.sent();console.warn("fetchTournamentsAsync",_);return[3,4];case 4:return[2,g.playerTournaments]}})})}var g;return Ue(e,[{key:"processPlayerTournamentData",value:function(){var g,E=[],_=at(this.playerTournaments);try{for(_.s();!(g=_.n()).done;){var k,C,A=g.value,T="".concat(A.getID()),R=A.getContextID(),I=A.getEndTime(),L=this.parseTournamentPayload(A.getPayload());if(this.validateGameSDKTournamentPayload(L)){if(!(I<Date.now()/1e3)&&"PAGE_HOSTED"!==A.getTournamentType()){var P=null!==(k=L.playerName)&&void 0!==k?k:"Player",O={id:T,title:null!==(C=A.getTitle())&&void 0!==C?C:this.createDefaultTournamentName(P),endTime:I,contextId:R,payload:L};E.push(O)}}}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"processGlobalTournamentLeaderboardData",value:function(){var g=[];if(l8.Enabled){for(var E=0;E<this.playerTournaments.length;E++){var _,k=this.playerTournaments[E],C=k.getTournamentType();if("PAGE_HOSTED"===C){var A="".concat(k.getID()),T=k.getContextID(),R=k.getEndTime(),I=this.parseTournamentPayload(k.getPayload()),L={id:A,title:null!==(_=k.getTitle())&&void 0!==_?_:"Global Tournament",endTime:R,contextId:T,payload:I,tournamentType:C};g.push(L)}}return g}for(var P=0;P<this.globalTournamentLBData.length;P++){var O,B={tournamentId:"",contextId:""},N=this.globalTournamentLBData[P];try{B=JSON.parse(N.description)}catch(g){continue}if(this.validateExpireTime(N)&&this.validateGlobalTournamentPayload(B)){var M={id:B.tournamentId,title:N.name,endTime:this.getTournamentEndTime(N),contextId:B.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:N._id,themeId:null!==(O=B.themeId)&&void 0!==O?O:ln.SUMMER}};g.push(M)}}return g}},{key:"validateGlobalTournamentPayload",value:function(g){var E=g.tournamentId,_=g.contextId;return!(!l5.isString(E)||""===E)&&!(!l5.isString(_)||""===_)}},{key:"getTournamentEndTime",value:function(g){var E=new Date(g.createdAt).getTime();return Math.round((1e3*g.expireTime+E)/1e3)}},{key:"validateExpireTime",value:function(g){return 1e3*this.getTournamentEndTime(g)-Date.now()>0}},{key:"validateGameSDKTournamentPayload",value:function(g){return!(!l5.isString(g.playerId)||""===g.playerId)&&!(!l5.isString(g.playerName)||""===g.playerName)&&!(!l5.isString(g.leaderboardId)||""===g.leaderboardId)}},{key:"createDefaultTournamentName",value:function(g){var E=g.substring(0,7),_="".concat(E.split(" ")[0]||E,"'s Tournament"),k=l3.removeDiacritics(_);return"".concat(k)}},{key:"parseTournamentPayload",value:function(g){if("string"!=typeof g)return{};try{return JSON.parse(g)}catch(g){return{}}}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"requestTournamentDataAsync",value:(g=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=e.getInstance();return[4,Promise.all([g.fetchTournamentsAsync(),g.fetchGlobalTournamentLeaderboardAsync()])];case 1:T.sent();E=g.processPlayerTournamentData(),_=g.processGlobalTournamentLeaderboardData();E.sort(function(g,E){return g.endTime-E.endTime}),_.sort(function(g,E){return g.endTime-E.endTime}),g.tournamentData=[].concat(tt(_),tt(E));C=at(g.tournamentData);try{for(C.s();!(k=C.n()).done;){A=k.value.payload.leaderboardId;A&&(l7.isExistLeaderboardId(A)||l7.addLeaderboard({type:"tournament",name:A,autoSortRank:!0,leaderboardId:A}))}}catch(g){C.e(g)}finally{C.f()}return[2,g.tournamentData]}})}),function(){return g.apply(this,arguments)})},{key:"getAllTournamentData",value:function(){return e.getInstance().tournamentData}},{key:"getTournamentDataById",value:function(g){var E=e.getInstance();return l6.search(E.tournamentData,function(E){return E.id===g})}},{key:"getPlayerTournamentData",value:function(){var g=e.getInstance(),E=ue.getPlayerId();return g.tournamentData.filter(function(g){return g.payload.playerId===E})}},{key:"getFriendsTournamentData",value:function(){var g=e.getInstance(),E=ue.getPlayerId();return g.tournamentData.filter(function(g){var _=g.payload;return _.playerId!==E&&"global"!==_.playerId})}},{key:"getGlobalTournamentData",value:function(){return e.getInstance().tournamentData.filter(function(g){return"global"===g.payload.playerId})}},{key:"validateTournamentExpired",value:function(g){var E=e.getTournamentDataById(g);return!!E&&E.endTime<Date.now()/1e3}}]),e}();_._RF.pop(),_._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var un,ui="time",ur="bomb";_._RF.pop(),_._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var ua=(0,k.ccclass)("InputController")(un=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleElementPointerDown=function(){},g.handleElementPointerUp=function(g){},g}return Ue(n,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){ev.os!==ev.OS.WINDOWS&&ev.os!==ev.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){ev.os!==ev.OS.WINDOWS&&ev.os!==ev.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(M))||un;_._RF.pop(),_._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var uo={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};_._RF.pop(),_._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var us="fall-down",ul="fly-up",uu="push-left",uc="push-right",uh="put-column-middle",up="put-row-middle";function Xc(g){for(var E=g.array,_=g.isLighter,k=g.out,C=void 0===k?new Set:k,A=0;A<E.length;A++)if(_(E.get(A))){for(var T=A+1;T<E.length;T++)if(!_(E.get(T))){E.swap(A,T),C.add(E.get(A));break}}return C}_._RF.pop(),_._RF.push({},"bfb989Gr/dArq4M9uSSrF5/","stagger",void 0),_._RF.pop(),_._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var ud=function(){function e(g){var E;Fe(this,e),this.array=[];var _=null!=g?g:{},k=_.width,C=void 0===k?1:k,A=_.height,T=void 0===A?1:A,R=_instanceof(g,e)?g.array:null!==(E=null==g?void 0:g.content)&&void 0!==E?E:[];if(R.length!==C*T)throw new Error("Invalid content length");this.width=C,this.height=T,this.array=tt(R)}return Ue(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(g,E){return this.array[E*this.width+g]}},{key:"set",value:function(g,E,_){this.array[E*this.width+g]=_}},{key:"isInBounds",value:function(g,E){return g>=0&&g<this.width&&E>=0&&E<this.height}},{key:"forEach",value:function(g){for(var E=0;E<this.height;E++)for(var _=0;_<this.width;_++)g(this.get(_,E),_,E)}},{key:"map",value:function(g){for(var E=[],_=0;_<this.height;_++)for(var k=0;k<this.width;k++)E.push(g(this.get(k,_),k,_));return E}},{key:"reduce",value:function(g,E){for(var _=E,k=0;k<this.height;k++)for(var C=0;C<this.width;C++)_=g(_,this.get(C,k),C,k);return _}},{key:"swap",value:function(g,E){var _=et(g,2),k=_[0],C=_[1],A=et(E,2),T=A[0],R=A[1],I=this.get(k,C);this.set(k,C,this.get(T,R)),this.set(T,R,I)}},{key:"shuffle",value:function(g){for(var E=null!=g?g:this.map(function(g,E,_){return[E,_]}),_=tt(E),k=new Set,C=_.length-1;C>0;C--){var A=eC(0,C+1),T=[_[A],_[C]];_[C]=T[0],_[A]=T[1],k.add(this.get(_[C][0],_[C][1])),k.add(this.get(_[A][0],_[A][1]))}for(var R=0;R<_.length;R++){var I=et(E[R],2),L=I[0],P=I[1],O=et(_[R],2),B=O[0],N=O[1];this.swap([L,P],[B,N])}return k}},{key:"toShuffled",value:function(g){var E=new e({width:this.width,height:this.height,content:this.array}),_=E.shuffle(g);return[E,_]}},{key:"gravitate",value:function(g){var E=this,_=et(g.rowRange,2),k=_[0],C=_[1],A=et(g.colRange,2),T=A[0],R=A[1],I=g.direction,L=g.isLighter,P=g.onSwap,O=g.out,B=void 0===O?new Set:O,N=R-T+1,M=C-k+1;switch(I){case uo.Up:for(var f=function(g){Xc({array:{length:M,get:function(_){return E.get(g,C-_)},swap:function(_,k){var A=E.get(g,C-_),T=E.get(g,C-k);E.swap([g,C-_],[g,C-k]),null==P||P(A,T)}},isLighter:L,out:B})},D=T;D<=R;D++)f(D);return B;case uo.Down:for(var m=function(g){Xc({array:{length:M,get:function(_){return E.get(g,k+_)},swap:function(_,C){var A=E.get(g,k+_),T=E.get(g,k+C);E.swap([g,k+_],[g,k+C]),null==P||P(A,T)}},isLighter:L,out:B})},F=T;F<=R;F++)m(F);return B;case uo.Left:for(var b=function(g){Xc({array:{length:N,get:function(_){return E.get(T+_,g)},swap:function(_,k){var C=E.get(T+_,g),A=E.get(T+k,g);E.swap([T+_,g],[T+k,g]),null==P||P(C,A)}},isLighter:L,out:B})},U=k;U<=C;U++)b(U);return B;case uo.Right:for(var w=function(g){Xc({array:{length:N,get:function(_){return E.get(R-_,g)},swap:function(_,k){var C=E.get(R-_,g),A=E.get(R-k,g);E.swap([R-_,g],[R-k,g]),null==P||P(C,A)}},isLighter:L,out:B})},x=k;x<=C;x++)w(x);return B;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var g=new e({width:this.width,height:this.height,content:this.array}),E=g.gravitate.apply(g,arguments);return[g,E]}},{key:"toRotated",value:function(){for(var g=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),E=0;E<this.height;E++)for(var _=0;_<this.width;_++)g.set(this.height-1-E,_,this.get(_,E));return g}}]),e}();_._RF.pop(),_._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),_._RF.pop(),_._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);var uf,uy,uv,ug,um,ub,uw,uS,uE,u_,uk,uC,uA,uT,uR,uI,uL,uP,uO,uB,uN,uM,uD,uF,uU,ux,uz,uG,uV,uK={bomb:"bomb",star:"star",none:"none"};_._RF.pop(),_._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var uH=k.ccclass,uq=k.property,uW=k.requireComponent,uj=(uf=uH("Tile"),uy=uW([R]),uv=uW([eu]),ug=uq(eo),um=uq(eo),ub=uq(eo),uw=uq(eo),uS=uq({type:R,displayName:"Background's UI Transform"}),uE=uq(ea),u_=uq({type:eu,displayName:"This UI Opacity"}),uk=uq(eu),uC=uq(eu),uA=uq(eu),uT=uq(rs),uR=uq(G),uf(uI=uy(uI=uv((uP=st((uL=function(g){ze(h,g);var E,_,k,C,A,T,R,I,L,P=Xe(h);function h(){var g;Fe(this,h);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=P.call.apply(P,[this].concat(_)),"icon",uP,Ke(g)),rt(g,"bombComponent",uO,Ke(g)),rt(g,"starComponent",uB,Ke(g)),rt(g,"background",uN,Ke(g)),rt(g,"bgUITransform",uM,Ke(g)),rt(g,"defaultBackground",uD,Ke(g)),rt(g,"uiOpacity",uF,Ke(g)),rt(g,"shineOpacity",uU,Ke(g)),rt(g,"glowOpacity",ux,Ke(g)),rt(g,"iconOpacity",uz,Ke(g)),rt(g,"button",uG,Ke(g)),rt(g,"animationComponent",uV,Ke(g)),g.id=null,g.isEmpty=!1,g.coord=new eS,g.signal=new nN,g}return Ue(h,[{key:"onLoad",value:function(){nk.lazyValidateProperties(this),this.special=this.createSpecialHandler(uK.none)}},{key:"update",value:function(g){var E;(null===(E=this.special)||void 0===E?void 0:E.type)===uK.bomb&&this.special.update(g)}},{key:"onDestroy",value:function(){var g,E;(null===(g=this.special)||void 0===g?void 0:g.type)===uK.bomb&&(null===(E=this.special)||void 0===E||E.onDestroy())}},{key:"setIgnoreInput",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.button.interactable=!E}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(g,E){this.coord.set(g,E)}},{key:"isSimilarTo",value:function(g){return this.id===g.id}},{key:"inSamePositionAs",value:function(g,E){return _instanceof(g,h)?this.coord.equals(g.getCoord()):this.coord.x===g&&this.coord.y===E}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(r0.TILE_CLICK,this)}},{key:"setIdentity",value:function(g){this.id=g,this.icon.spriteFrame=g;var E=et(this.getSize(),2),_=E[0],k=E[1],C=g.originalSize,A=C.width,T=C.height,R=Math.max(A/(.7*_),T/(.7*k));R>1&&this.icon.node.setScale(new em(1/R,1/R,1))}},{key:"setSpecialType",value:function(g,E){var _,k=arguments.length>0&&void 0!==g?g:uK.none,C=arguments.length>1?E:void 0;null===(_=this.special)||void 0===_||_.switch(k,C)}},{key:"setFocused",value:(L=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=z(this.shineOpacity).to(.15,{opacity:g?255:0},{easing:"cubicOut"});this.shineOpacity.node.scale=g?em.ZERO:em.ONE;_=z(this.shineOpacity.node).to(.15,{scale:g?em.ONE:em.ZERO},{easing:"cubicOut"});if(g){k=z(this.glowOpacity).to(2,{opacity:150});k.to(2,{opacity:20}),this.glowOpacityTween=z(this.glowOpacity).repeatForever(k).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;return[4,Promise.all([tZ.runTweenAsync(E),tZ.runTweenAsync(_)])];case 1:C.sent();return[2]}})}),function(g){return L.apply(this,arguments)})},{key:"setEmpty",value:function(g){var E,_,k,C=arguments.length>0&&void 0!==g&&g;if(!this.isEmpty){var A;if(this.signal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),C)return this.uiOpacity.opacity=0,void(null===(A=this.special)||void 0===A||A.switch(uK.none));(null===(E=this.special)||void 0===E?void 0:E.type)!==uK.star&&(null===(_=this.special)||void 0===_?void 0:_.type)!==uK.bomb||this.special.clear(),null===(k=this.special)||void 0===k||k.switch(uK.none),this.uiOpacity.opacity=0}}},{key:"setHint",value:(I=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!g)return[3,2];return[4,this.loadShakeClip()];case 1:k.sent(),this.shakeClip&&tZ.runAnimationAsync(this.animationComponent,this.shakeClip.name,this.signal);return[3,4];case 2:if(null===(E=this.animationComponent)||void 0===E||E.stop(),!this.background)return[2];_=z(this.background.node).to(.1,{scale:em.ONE,eulerAngles:em.ZERO});return[4,tZ.runTweenAsync(_,this.signal)];case 3:k.sent();k.label=4;case 4:return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"playClearFX",value:(R=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:this.signal.abort();E=new nN;this.signal=E;_=null;if("clear"!==g)return[3,2];return[4,this.loadClearClip()];case 1:C.sent(),_=this.clearClip;return[3,4];case 2:return[4,this.loadBreakClip()];case 3:C.sent(),_=this.breakClip;C.label=4;case 4:k=null===_||E.aborted;if(k)return[3,6];return[4,tZ.runAnimationAsync(this.animationComponent,_.name,E)];case 5:k=C.sent();C.label=6;case 6:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"restore",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:this.signal.abort();E=new nN;this.signal=E,this.animationComponent.stop(),this.isEmpty=!1,this.setIgnoreInput(!0),g&&this.setIdentity(g),this.uiOpacity.opacity=255,this.iconOpacity.opacity=255,this.node.setScale(em.ZERO),this.background.spriteFrame=this.defaultBackground,this.button.fakeClick();return[4,tZ.runTweenAsync(z(this.node).to(.3,{scale:em.ONE},{easing:"backOut"}),E)];case 1:_.sent(),this.node.setScale(em.ONE),this.setIgnoreInput(!1);return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"sync",value:(A=Be(function(g){var E,_,k,C,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:E=g.duration,_=void 0===E?.3:E,k=g.delay,C=void 0===k?0:k,A=g.easing,T=void 0===A?"cubicOut":A,R=(0,g.getTargetPosition)(this.coord),I=new em(R.x,R.y,this.node.position.z);return[4,tZ.runTweenAsync(z(this.node).delay(C).to(_,{position:I},{easing:T}))];case 1:L.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"fly",value:(C=Be(function(g){var E,_,k,C,A,T,R,I,L,P,O,B,N,M,D,F,U,x;return _ts_generator(this,function(G){E=this,_=300,k=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),C=Math.max(_-.7*k,0),A=k/1e3,T=this.node.position.clone(),R=g.getTilePosition(this.coord),I=new em(R.x,R.y,this.node.position.z),L=this.background.node,P=2,O=1,B=360,N=.0025*C,M=0,D=new em(0,0,0),F=.75-N,U={value:0,prevElapsed:0},x=z(U);return[2,(x.delay(A),x.to(.5,{value:0},{progress:function(g,_,k,C){var A=(P*=-1)*C,R=T.clone();return R.x+=A,E.node.setPosition(R),k}}),x.to(N,{value:1},{progress:function(g,k,A,T){var R=tZ.easeOutExpo(T),I=N*T-U.prevElapsed,P=N*T,M=C*R;E.setHeight(M,_);var D=E.node.position.clone();O+=.1,em.rotateZ(D,D,new em(0,0,0),O*Math.PI*I),E.node.setPosition(new em(D.x,D.y,D.z));var F=(B+=10)*I;return L.angle+=F,U.prevElapsed=P,A}}),x.call(function(){D.set((E.node.position.x+I.x)/2,(E.node.position.y+I.y)/2,0),U.prevElapsed=0,L.angle%=360,L.angle-=360,M=L.angle}),x.to(F,{value:0},{progress:function(g,k,A,T){var R=F*T-U.prevElapsed,I=F*T,P=C*(1-T);E.setHeight(P,_);var O=E.node.position.clone();return em.rotateZ(O,O,D,Math.PI/F*R),E.node.setPosition(new em(O.x,O.y,O.z)),L.angle+=-M/F*R,U.prevElapsed=I,A}}),x.call(function(){E.node.setPosition(I),E.setHeight(0,_),L.angle=0}),tZ.runTweenAsync(x))]})}),function(g){return C.apply(this,arguments)})},{key:"loadBreakClip",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.breakClip)return[3,2];return[4,n7.loadAnimClipAsync(nM.TILE_BREAK_ANIM)];case 1:g=E.sent();g&&this.animationComponent&&(this.breakClip=g,this.animationComponent.addClip(this.breakClip));E.label=2;case 2:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadClearClip",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.clearClip)return[3,2];return[4,n7.loadAnimClipAsync(nM.TILE_CLEAR_ANIM)];case 1:g=E.sent();g&&this.animationComponent&&(this.clearClip=g,this.animationComponent.addClip(this.clearClip));E.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"loadShakeClip",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.shakeClip)return[2,Promise.resolve()];return[4,n7.loadAnimClipAsync(nM.TILE_SHAKE_ANIM)];case 1:g=E.sent();if(!g||!this.animationComponent)return[2,Promise.resolve()];this.shakeClip=g,this.animationComponent.addClip(this.shakeClip);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setHeight",value:function(g,E){if(this.background){var _=this.background.node;_.setPosition(new em(_.position.x,g,0)),_.setScale(new em(1+g/E*.3,1+g/E*.3,1))}}},{key:"createSpecialHandler",value:function(g,E){var _=this;switch(g){case uK.bomb:return this.createBombHandler(null!=E?E:90);case uK.star:return this.createStarHandler();default:return{type:uK.none,switch:function(g,E){_.special=_.createSpecialHandler(g,E)}}}}},{key:"createBombHandler",value:function(g){var E=this,_=!1,k=g,a=function(){_=!0},o=function(){_=!1};this.node.scene.on(r0.TILE_CLICK,a),this.node.scene.on(r0.USE_ITEM,a),this.node.scene.on(r0.RESUME_TIME,a),this.node.scene.on(r0.PAUSE_TIME,o),this.node.scene.on(r0.TIME_OUT,o),this.bombComponent.node.active=!0;var r=function(){_=!1,E.bombComponent.node.active=!1,k=g,E.node.scene.off(r0.TILE_CLICK,a),E.node.scene.off(r0.USE_ITEM,a),E.node.scene.off(r0.GAME_RESUME,a),E.node.scene.off(r0.GAME_PAUSE,o),E.node.scene.off(r0.TIME_OUT,o)};return{type:uK.bomb,update:function(C){_&&(k-=C,E.bombComponent.fillRange=-k/g,k<=0&&(_=!1,E.bombComponent.node.active=!1,E.setEmpty(!0),E.node.scene.emit(r0.BOMB_EXPLODE,E)))},clear:function(){i5.playSound(ic.BOMB_DEFUSE)},cleanup:r,onDestroy:function(){E.node.scene.off(r0.TILE_CLICK,a),E.node.scene.off(r0.USE_ITEM,a),E.node.scene.off(r0.GAME_RESUME,a),E.node.scene.off(r0.GAME_PAUSE,o),E.node.scene.off(r0.TIME_OUT,o)},switch:function(g,_){r(),E.special=E.createSpecialHandler(g,_)},detonateImmediately:function(){k=0}}}},{key:"createStarHandler",value:function(){var g=this;this.starComponent.node.active=!0;var t=function(){g.starComponent.node.active=!1};return{type:uK.star,clear:function(){g.starComponent.node.active=!1,i5.playSound(ic.COLLECT_STARS);var E=g.node.worldPosition,_=E.x,k=E.y;g.node.scene.emit(r0.ADD_STARS,{startAnimationAt:[_,k]})},cleanup:t,switch:function(E){t(),g.special=g.createSpecialHandler(E)}}}}]),h}(M)).prototype,"icon",[ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uO=st(uL.prototype,"bombComponent",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uB=st(uL.prototype,"starComponent",[ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uN=st(uL.prototype,"background",[uw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uM=st(uL.prototype,"bgUITransform",[uS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uD=st(uL.prototype,"defaultBackground",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uF=st(uL.prototype,"uiOpacity",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uU=st(uL.prototype,"shineOpacity",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ux=st(uL.prototype,"glowOpacity",[uC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uz=st(uL.prototype,"iconOpacity",[uA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uG=st(uL.prototype,"button",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uV=st(uL.prototype,"animationComponent",[uR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uI=uL))||uI)||uI)||uI);function Lh(g,E,_,k){var C=arguments.length>3&&void 0!==k?k:0,A=_.x,T=_.y,R=et(E,2),I=R[0],L=R[1],P=I*(A-(g.width-1)/2)+C*(A-g.width/2),O=L*(T-(g.height-1)/2)+C*(T-g.height/2);return -1===A&&(P+=E[0]/4),A===g.width&&(P-=E[0]/4),-1===T&&(O+=E[1]/4),T===g.height&&(O-=E[1]/4),{x:P,y:O}}function Oh(g,E){var _=arguments.length>1&&void 0!==E?E:[0,0],k=et(g,2),C=k[0],A=k[1],T=et(_,2),R=T[0],I=T[1],L=1-R,P=1-I,O=C*L,B=A*P;return[O,B]}function Nh(g,E){for(var _=arguments.length>1&&void 0!==E&&E,k=g.split("-"),C=[],A=0;A<k.length;){var T=null,R=k[A];switch(R){case"normal":A+=1;break;case"fall":T=us,A+=2;break;case"fly":T=ul,A+=2;break;case"push":"left"===k[A+1]?(T=uu,A+=2):(T=uc,A+=2);break;case"put":"columns"===k[A+1]?(T=uh,A+=3):(T=up,A+=3)}T&&(_&&(T=Mh(T)),C.push(T))}return C}function Mh(g){switch(g){case us:return uc;case ul:return uu;case uu:return us;case uc:return ul;case uh:return up;case up:return uh}}function Dh(g){return(_instanceof(g,ud)?g.asArray():g).filter(function(g){return!g.isHidden()})}function Bh(g){return(_instanceof(g,ud)?g.asArray():g).filter(function(g){return g.isHidden()})}_._RF.pop(),_._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),_._RF.pop(),_._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),_._RF.pop(),_._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),_._RF.pop(),_._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),_._RF.pop(),_._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),_._RF.pop(),_._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),_._RF.pop(),_._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),_._RF.pop(),_._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),_._RF.pop(),_._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);var uX=GameCore.Utils.Object;function xh(g,E){var _=E.getCoord(),k=_.x,C=_.y;return uX.vals(uo).reduce(function(E,_){var A=_.x,T=_.y,R=k+A,I=C+T;return g.isInBounds(R,I)&&E.push(g.get(R,I)),E},[])}function Uh(g){return Array.isArray(g)}function Gh(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=Uh(g)?g:g.asArray();return k[eA(_,0,k.length)]}_._RF.pop(),_._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),_._RF.pop(),_._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);var uY=GameCore.Utils.Array;function Vh(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=_instanceof(g,ud)?g.asArray():g,C=Gh(k,_),A=uY.search(k,function(g){return g.isSimilarTo(C)&&!g.inSamePositionAs(C)});if(void 0===A)throw new Error("Could not find a matching tile");return[C,A]}_._RF.pop(),_._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var Hh=function(g){return g};function qh(g,E,_){var k=arguments.length>2&&void 0!==_?_:Hh;return function(){var _,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=g,C=E;_<=0&&(_=Number.POSITIVE_INFINITY);A=0;T.label=1;case 1:if(!(A<_))return[3,4];return[4,k(C)];case 2:T.sent(),C=1e9*eT(C);T.label=3;case 3:A++;return[3,1];case 4:return[2]}})}()}function Wh(g){return Array.isArray(g)}function jh(g,E,_){var k=arguments.length>2&&void 0!==_?_:Date.now(),C=Wh(g)?g:g.asArray();if(C.length<E)return new Set(C);for(var A=new Set,T=qh(-1,k),R=T.next();A.size<E;){if(R.done)throw new Error("RNG exhausted");A.add(Gh(C,R.value)),R=T.next()}return A}_._RF.pop(),_._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),_._RF.pop(),_._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),_._RF.pop(),_._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var uJ=[1,4];function Yh(g,E,_){var k,C=arguments.length>2&&void 0!==_?_:Date.now(),A=E.specials,T=A.bomb,R=eA.apply(void 0,[C].concat(uJ)),I=jh(g,T,C),L=g.asArray().filter(function(g){return!I.has(g)}),P=jh(L,R,C),O=at(I);try{for(O.s();!(k=O.n()).done;){var B=k.value,N=2*E.time/3;B.setSpecialType(uK.bomb,N)}}catch(g){O.e(g)}finally{O.f()}var M,D=at(P);try{for(D.s();!(M=D.n()).done;){var F=M.value;F.setSpecialType(uK.star)}}catch(g){D.e(g)}finally{D.f()}}_._RF.pop(),_._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),_._RF.pop(),_._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);var uQ=GameCore.Utils.Array;function Qh(g){var E=g.levelData,_=E.columns,k=E.rows,C=g.identities,A=g.createTile,T=g.seed,R=(function(g,E,_){var k,C=[],A=at(qh(E/2,g,function(g){return eA(g,0,_.length)}));try{for(A.s();!(k=A.n()).done;){var T=k.value;C.push(_[T]),C.push(_[T])}}catch(g){A.e(g)}finally{A.f()}return uQ.shuffle(C),C})(void 0===T?Date.now():T,_*k,C).map(function(g){var E=A(g);return E.setIdentity(g),E});return new ud({width:_,height:k,content:R})}_._RF.pop(),_._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);var uZ=GameCore.Utils.Array;function Zh(g){var E=g.customFen,_=g.identities,k=g.createTile,C=E.idSize,A=E.cols,T=E.rows,R=E.code;if(_.length<E.idSize)throw new Error("Invalid grid code. There are not enough identities/frames ".concat(_.length," to fill it according to fen code ").concat(C));var I=R.split(":");if(I.length!==T)throw new Error("Invalid grid code");var L=/[a-zA-Z]+\d+|./g,P=/[a-zA-Z]+/,O=/\d+/,B=I.reduceRight(function(g,C){var A,T=[],R=at(C.matchAll(L));try{for(R.s();!(A=R.n()).done;){var I,B,N=A.value[0],M=null===(I=O.exec(N))||void 0===I?void 0:I[0],D=void 0!==M?Number.parseInt(M,10):void 0,F=void 0!==D&&!Number.isNaN(D)&&D<_.length?_[D]:void 0,U=k(void 0!==F?F:_[0]),x=null===(B=P.exec(N))||void 0===B?void 0:B[0],z=void 0!==x?$h(x,E.encoding):void 0;z&&F?U.setSpecialType(z):U.setEmpty(),T.push(U)}}catch(g){R.e(g)}finally{R.f()}return g.concat(T)},[]);return new ud({width:A,height:T,content:B})}function $h(g,E){var _=uZ.search(Object.entries(E),function(E){var _=et(E,2);_[0];return _[1]===g});if(void 0===_)throw new Error("Invalid special type ".concat(g));return _[0]}_._RF.pop(),_._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),_._RF.pop(),_._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);var u$=GameCore.Utils.Array;function td(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=g.asArray(),C=Gh(g,_),A=xh(g,C);if(!A.some(function(g){return g.isSimilarTo(C)})){var T=Gh(A,_),R=u$.search(k,function(g){return!g.inSamePositionAs(C)&&!g.inSamePositionAs(T)&&g.isSimilarTo(T)});R.setIdentity(C.id),T.setIdentity(C.id)}}_._RF.pop(),_._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),_._RF.pop(),_._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var u0=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];_._RF.pop(),_._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var u1=GameCore.Utils.Array;function ad(g,E){return g[0]===E[0]&&g[1]===E[1]}function od(g){return new eS(g[0],g[1])}function rd(g,E){return g.x>=-1&&g.x<E.width+1&&g.y>=-1&&g.y<E.height+1}function sd(g,E){var _=arguments.length>1&&void 0!==E?E:u4;return _.map(function(E){return[g.tile[0]+E.x,g.tile[1]+E.y]})}var u2,u4=[uo.Up,uo.Down,uo.Left,uo.Right],u3=function(){function e(g,E){var _;if(Fe(this,e),this.f=0,this.g=0,this.h=0,E&&ad(g,E.tile))throw new Error("Tile cannot be its own parent");this.tile=g,this.parent=E;var k=e.calcDirection(this),C=E&&k&&E.cache.direction&&!k.equals(E.cache.direction)?1:0;this.cache={direction:k,turns:C+(null!==(_=null==E?void 0:E.cache.turns)&&void 0!==_?_:0)}}return Ue(e,[{key:"getKey",value:function(){var g;return"x:".concat(this.tile[0],",y:").concat(this.tile[1],",d:").concat(null===(g=this.cache.direction)||void 0===g?void 0:g.toString())}},{key:"equals",value:function(g){return this.getKey()===g.getKey()}}],[{key:"calcDirection",value:function(g){if(g.parent){var E=g.parent.tile,_=g.tile;return new eS(_[0]-E[0],_[1]-E[1])}return null}}]),e}();function hd(g,E,_){var k=yd(g,E),C=yd(g,_);if(0===k.length||0===C.length)return dd(E,_);var A=function(g,E,_){var k=[],C=[],A=new u3(E,null),T=new u3(_,null),R=[T.tile];k.push(A);for(;k.length>0;){var I=k.shift();if(C.push(I),ad(I.tile,T.tile)){for(var L=[],P=I,O=I,B=I.parent;B;)B.cache.turns!==O.cache.turns&&(L.unshift({a:od(B.tile),b:od(P.tile)}),P=B),O=B,B=B.parent;return L.unshift({a:od(O.tile),b:od(P.tile)}),L}var N,M=at(sd(I,yd(g,I.tile,R)));try{var f=function(){var g=N.value,E=new u3(g,I);if(E.cache.turns>8)return 0;var _=ad(E.tile,T.tile),A=C.some(function(g){return g.equals(E)});if(k.some(function(g){return g.equals(E)})||A&&!_)return 0;E.g=I.g+1+E.cache.turns,E.h=pd(E,T),E.f=E.g+E.h,k.push(E)};for(M.s();!(N=M.n()).done;)f()}catch(g){M.e(g)}finally{M.f()}k.sort(function(g,E){return g.f-E.f})}return null}(g,E,_);return A||dd(E,_)}function dd(g,E){var _=od(g),k=od(E);return _.x===k.x||_.y===k.y?[{a:_,b:k}]:[{a:_,b:{x:_.x,y:k.y}},{a:{x:_.x,y:k.y},b:k}]}function pd(g,E){var _=g.tile,k=E.tile;return Math.abs(_[0]-k[0])+Math.abs(_[1]-k[1])}function yd(g,E,_){var k,C=arguments.length>2&&void 0!==_?_:[],A=[],T=at(u4);try{var r=function(){var _=k.value,T={x:E[0]+_.x,y:E[1]+_.y};if(g.isInBounds(T.x,T.y))return(g.get(T.x,T.y).isHidden()||u1.search(C,function(g){return ad(g,[T.x,T.y])}))&&A.push(_),1;rd(T,g)&&A.push(_)};for(T.s();!(k=T.n()).done;)r()}catch(g){T.e(g)}finally{T.f()}return A}_._RF.pop(),_._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),_._RF.pop(),_._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var u5=(Ge(u2={},uK.bomb,"b"),Ge(u2,uK.star,"s"),Ge(u2,uK.none,"t"),u2);function vd(g,E){for(var _=arguments.length>1&&void 0!==E?E:u5,k=g.width,C=g.height,A=[],T=new Map,R=C-1;R>=0;R--){for(var I=[],L=0;L<k;L++){var P,O,B=g.get(L,R),N=B.isHidden()?null:B.id;if(null!==N){var M=null!==(P=null===(O=B.special)||void 0===O?void 0:O.type)&&void 0!==P?P:uK.none,D=_[M];if(!T.has(N)){var F=T.size.toString();T.set(N,F)}var U="".concat(D).concat(T.get(N));I.push(U)}else I.push(".")}A.push(I.join(""))}return{code:A.join(":"),idSize:T.size,encoding:_,rows:C,cols:k}}function md(g){return g.reduce(function(g,E,_,k){return E.inSamePositionAs(_,k)||g.push([E,[_,k]]),g},[])}function gd(g,E){var _,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:_=0,k=g-1,C=0,A=E-1;P.label=1;case 1:if(!(_<=k&&C<=A))return[3,19];T=_;P.label=2;case 2:if(!(T<=k))return[3,5];return[4,{x:T,y:C}];case 3:P.sent();P.label=4;case 4:T++;return[3,2];case 5:R=++C;P.label=6;case 6:if(!(R<=A))return[3,9];return[4,{x:k,y:R}];case 7:P.sent();P.label=8;case 8:R++;return[3,6];case 9:I=--k;P.label=10;case 10:if(!(I>=_))return[3,13];return[4,{x:I,y:A}];case 11:P.sent();P.label=12;case 12:I--;return[3,10];case 13:L=--A;P.label=14;case 14:if(!(L>=C))return[3,17];return[4,{x:_,y:L}];case 15:P.sent();P.label=16;case 16:L--;return[3,14];case 17:_++;P.label=18;case 18:return[3,1];case 19:return[2]}})}_._RF.pop(),_._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),_._RF.pop(),_._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),_._RF.pop(),_._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var u6,u8,u9,u7,ce,ct,cn,ci,cr,ca,co=GameCore.Utils.Array,cs=function(){function e(g,E){Fe(this,e),this.coord=new eS(g,E)}return Ue(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function Ld(g){return new eS(g[0],g[1])}function Od(g,E,_){if(void 0===E||void 0===_)return function(g,E){var _,k=arguments.length>1&&void 0!==E?E:gd,C=[],A=at(k(g.width,g.height));try{for(A.s();!(_=A.n()).done;){var T=_.value,R=g.get(T.x,T.y);R.isHidden()||C.push([R,[T.x,T.y]])}}catch(g){A.e(g)}finally{A.f()}var I,L=[],u=function(){var E=et(C.shift(),2),_=E[0],k=E[1];if(co.search(L,function(g){return Dd(g,k)}))return 0;L.push(k);for(var A,r=function(){var E=et(R[T],2),C=E[0],A=E[1];if(!C.isSimilarTo(_)||co.search(L,function(g){return Dd(g,A)}))return 0;var I=Od(g,k,A);return null!==I?{v:{v:I}}:void 0},T=0,R=C;T<R.length;T++)if(0!==(A=r())&&A)return A.v};for(;C.length>0;)if(0!==(I=u())&&I)return I.v;return null}(g);var k,C=[E[0]+1,E[1]+1],A=[_[0]+1,_[1]+1],T=function(g){var E=co.fillWith(g.width+2,function(g){return new cs(g-1,-1)}),_=co.fillWith(g.width+2,function(E){return new cs(E-1,g.height)}),k=co.fillWith(g.height,function(g){return new cs(-1,g)}),C=co.fillWith(g.height,function(E){return new cs(g.width,E)}),o=function(A,T){var R=A-1,I=T-1;return -1===R?k[I]:R===g.width?C[I]:-1===I?E[R]:I===g.height?_[R]:g.get(R,I)};return{get:function(g,E){return o(g,E)},width:g.width+2,height:g.height+2}}(g),R=[C,A];if(C[0]===A[0]&&Fd(T,R,C[1],A[1],C[0])||C[1]===A[1]&&xd(T,R,C[0],A[0],C[1]))return zd([{a:Ld(C),b:Ld(A)}],{x:-1,y:-1});var I=C[1]<=A[1]?C:A,L=C[1]<=A[1]?A:C,P=C[0]<=A[0]?C:A,O=C[0]<=A[0]?A:C,B=[],N=[],M=Ud(T,R,1,Ld(I),Ld(L)),D=Ud(T,R,-1,Ld(I),Ld(L));-1===M&&-1===D||(k=-1!==M?M:D,B=[{a:Ld(C),b:{x:C[0],y:k}},{a:{x:C[0],y:k},b:{x:A[0],y:k}},{a:{x:A[0],y:k},b:Ld(A)}]);var F=Gd(T,R,1,Ld(P),Ld(O)),U=Gd(T,R,-1,Ld(P),Ld(O));-1===F&&-1===U||(k=-1!==F?F:U,B=[{a:Ld(C),b:{x:k,y:C[1]}},{a:{x:k,y:C[1]},b:{x:k,y:A[1]}},{a:{x:k,y:A[1]},b:Ld(A)}]);var x=function(g,E,_,k){for(var C=_.y+1;C<k.y;C++)if(Fd(g,E,_.y,C,_.x)&&xd(g,E,_.x,k.x,C)&&Fd(g,E,C,k.y,k.x))return C;return -1}(T,R,Ld(I),Ld(L));-1!==x&&(k=x,N=[{a:Ld(C),b:{x:C[0],y:k}},{a:{x:C[0],y:k},b:{x:A[0],y:k}},{a:{x:A[0],y:k},b:Ld(A)}]);var z=function(g,E,_,k){for(var C=_.x+1;C<k.x;C++)if(xd(g,E,_.x,C,_.y)&&Fd(g,E,_.y,k.y,C)&&xd(g,E,C,k.x,k.y))return C;return -1}(T,R,Ld(P),Ld(O));return -1!==z&&(k=z,N=[{a:Ld(C),b:{x:k,y:C[1]}},{a:{x:k,y:C[1]},b:{x:k,y:A[1]}},{a:{x:k,y:A[1]},b:Ld(A)}]),B.length>0&&N.length>0?zd(Nd(B)<=Nd(N)?B:N,{x:-1,y:-1}):B.length>0?zd(B,{x:-1,y:-1}):N.length>0?zd(N,{x:-1,y:-1}):null}function Nd(g){var E,_=0,k=at(g);try{for(k.s();!(E=k.n()).done;)_+=Md(E.value)}catch(g){k.e(g)}finally{k.f()}return _}function Md(g){return g.a.x===g.b.x?Math.abs(g.a.y-g.b.y):g.a.y===g.b.y?Math.abs(g.a.x-g.b.x):0}function Dd(g,E){return g[0]===E[0]&&g[1]===E[1]}function Bd(g,E,_){var k=arguments.length>2&&void 0!==_?_:[],C=g.get.apply(g,tt(E));return C.isHidden()||k.some(function(g){return Dd(g,E)})}function Fd(g,E,_,k,C){for(var A=Math.min(_,k),T=Math.max(_,k),R=A;R<=T;R++)if(!Bd(g,[C,R],E))return!1;return!0}function xd(g,E,_,k,C){for(var A=Math.min(_,k),T=Math.max(_,k),R=A;R<=T;R++)if(!Bd(g,[R,C],E))return!1;return!0}function Ud(g,E,_,k,C){var A=1===_?C.y:k.y,T=1===_?k.x:C.x;if(Fd(g,E,k.y,C.y,T))for(;A>=0&&A<g.height&&Bd(g,[k.x,A],E)&&Bd(g,[C.x,A],E);){if(xd(g,E,k.x,C.x,A))return A;A+=_}return -1}function Gd(g,E,_,k,C){var A=1===_?C.x:k.x,T=1===_?k.y:C.y;if(xd(g,E,k.x,C.x,T))for(;A>=0&&A<g.width&&Bd(g,[A,k.y],E)&&Bd(g,[A,C.y],E);){if(Fd(g,E,k.y,C.y,A))return A;A+=_}return -1}function zd(g,E){return g.map(function(g){return{a:{x:g.a.x+E.x,y:g.a.y+E.y},b:{x:g.b.x+E.x,y:g.b.y+E.y}}})}_._RF.pop(),_._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var cl,cu=k.ccclass,cc=k.property,ch=k.requireComponent,cp=globalThis.game.monitorError,cd=GameCore.Utils,cf=cd.Array,cy=cd.Function,cv=(u6=cu("Board"),u8=ch(R),u9=cc(uj),u7=cc(C),ce=cc({displayName:"Tile Spacing",group:"Create config"}),u6(ct=u8((ci=st((cn=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"tilePrefab",ci,Ke(g)),rt(g,"tilesHolder",cr,Ke(g)),rt(g,"tileTrim",ca,Ke(g)),g.tileSize=[0,0],g.selectedTile=null,g.layoutType="portrait",g.parsedGravityRules=[],g.normalMatches=0,g.normalMatchesSinceLastSpawn=0,g.spawnAttempts=0,g.hintPath=null,g.hintTiles=null,g.animationQueue=[],g.isConsumingAnimation=!1,g.handleViewResized=cy.debounce(function(){g.updateTilesHolderScale()},100),g.onLayoutChanged=function(E){g.layoutType=E},g}return Ue(a,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),nk.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenEvents()}},{key:"onDestroy",value:function(){this.unlistenEvents()}},{key:"create",value:function(g,E,_){var k=this,C=arguments.length>2&&void 0!==_?_:Date.now(),A=tt(g);cf.shuffle(A);var T=A.slice(0,E.colors);null==cp||cp.addMetadata({frames:T.map(function(g){return g.name})}),this.levelData=E,this.parsedGravityRules=Nh(E.mode,this.layoutType===rv.Landscape);var r=function(g){var E=I(k.tilePrefab.node),_=E.getComponent(uj);return _.setIdentity(g),k.tilesHolder.addChild(E),E.active=!0,_},R=!1;if(void 0!==E.customFen)try{R=!0,this.grid=Zh({customFen:E.customFen,identities:T,createTile:r}),this.grid.forEach(function(g,E,_){g.setCoord(E,_),g.setIgnoreInput(!1),g.node.setSiblingIndex(0)})}catch(g){console.error("Error creating grid from custom fen",g,"falling back to random grid"),R=!1}R||(this.grid=Qh({levelData:E,seed:C,identities:T,createTile:r}),this.grid.forEach(function(g,E,_){g.setCoord(E,_),g.setIgnoreInput(!1),g.node.setSiblingIndex(0)}),td(this.grid,C),Yh(this.grid,E,C)),this.handleBoardLayout();var L=[this.tileTrim.x,this.tileTrim.y];this.tileSize=Oh(this.tilePrefab.getSize(),L),this.updateTilesHolderScale(),this.node.scene.emit(r0.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}},{key:"updateTilesHolderScale",value:function(){if(this.grid){var g=[this.grid.width,this.grid.height],E=[this.uiTransform.width,this.uiTransform.height],_=function(g,E,_){var k=et(g,2),C=k[0],A=k[1],T=et(E,2),R=T[0],I=T[1],L=et(_,2),P=L[0]/(C*R),O=L[1]/(A*I);return Math.min(P,O)}(g,this.tilePrefab.getSize(),E);this.tilesHolder.setScale(_,_),this.node.scene.emit(r0.GRID_RESIZE,_)}}},{key:"handleBoardLayout",value:function(){var g,E;this.layoutType===rv.Landscape&&0!==this.levelData.level&&(this.grid=(g=this.grid,(E=g.toRotated()).forEach(function(g,E,_){g.setCoord(E,_)}),E))}},{key:"destroyTiles",value:function(){var g;null===(g=this.grid)||void 0===g||g.forEach(function(g){return g.node.destroy()})}},{key:"animateTilesAppear",value:function(){var g=this;return new Promise(function(E){var _=function(){var _=Be(function(){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Promise.all(g.grid.map(function(E,_,k){var C=eR(0,.5),A=E.node.scale.clone(),T=function(E,_){var k,C=eS.ZERO.clone(),A=at(g.parsedGravityRules);try{for(A.s();!(k=A.n()).done;){var T=k.value,R=g.getPrimitiveDirection(E,_,T);C.subtract2f(R.x,R.y)}}catch(g){A.e(g)}finally{A.f()}return C.normalize()}(_,k),R=Lh(g.grid,g.tileSize,{x:_,y:k}),I=T.multiplyScalar(100).add2f(R.x,R.y);return E.node.setPosition(I.x,I.y),E.node.setScale(0,0),Promise.all([tZ.runTweenAsync(z(E.node).delay(C).to(.5,{scale:A},{easing:"elasticOut"})),E.sync({getTargetPosition:function(E){return Lh(g.grid,g.tileSize,E)},easing:"backOut",duration:.5,delay:C})])}))];case 1:_.sent(),E();return[2]}})});return function(){return _.apply(this,arguments)}}();g.animationQueue.push(_),g.consumeAnimationQueue()})}},{key:"animateTilesWave",value:function(){var g=this;return new Promise(function(E){var _=function(){var _=Be(function(){var _;return _ts_generator(this,function(k){switch(k.label){case 0:_=function(g,E){for(var _=E.x,k=E.y,C="center"===g?{x:(_-1)/2,y:(k-1)/2}:g,A=C.x,T=C.y,R=[],I=0;I<_;I++){for(var L=[],P=0;P<k;P++){var O=A-I,B=T-P,N=Math.sqrt(O*O+B*B);L.push(N)}R.push(L)}return R}("center",{x:g.grid.width,y:g.grid.height});return[4,Promise.all(g.grid.map(function(g,E,k){var C=.1*_[E][k],A=g.node.scale.clone();return Promise.all([tZ.runTweenAsync(z(g.node).delay(C).to(.25,{scale:A.clone().multiplyScalar(1.2)},{easing:"quadOut"}).to(.25,{scale:A},{easing:"quadIn"}))])}))];case 1:k.sent(),E();return[2]}})});return function(){return _.apply(this,arguments)}}();g.animationQueue.push(_),g.consumeAnimationQueue()})}},{key:"handleTileClick",value:function(g){if(!g.isHidden()){if(this.selectedTile===g)return i5.playSound(ic.TILE_SELECT),this.selectedTile=null,void g.setFocused(!1);if(!this.selectedTile)return i5.playSound(ic.TILE_SELECT),this.selectedTile=g,void g.setFocused(!0);if(!this.selectedTile.isSimilarTo(g))return i5.playSound(ic.TILE_SELECT),this.selectedTile.setFocused(!1),this.selectedTile=g,void g.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,g),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(g,E){var _=[g.getCoord().x,g.getCoord().y],k=[E.getCoord().x,E.getCoord().y],C=Od(this.grid,_,k);if(null===C){i5.playSound(ic.INVALID_MATCH),this.shakeGrid();var A=0===this.levelData.level,T=function(g,E,_,k){if(k){var C=u0[4].startTile,A=u0[4].endTile;if(E[0]===C.x&&E[1]===C.y&&_[0]===A.x&&_[1]===A.y)return[{a:C,b:A}];if(E[0]===A.x&&E[1]===A.y&&_[0]===C.x&&_[1]===C.y)return[{a:C,b:A}]}return hd(g,E,_)}(this.grid,_,k,A);return this.node.scene.emit(r0.GRID_MATCH,[g,E]),void this.node.scene.emit(r0.GRID_MATCH_FAIL,T)}i5.playSound(ic.TILE_MATCH),this.node.scene.emit(r0.GRID_MATCH,[g,E]),this.node.scene.emit(r0.GRID_MATCH_SUCCESS,C,[g,E]),this.clear([[g,E]],"clear")}},{key:"clear",value:function(g,E){var _=arguments.length>1&&void 0!==E?E:"clear";this.normalMatches+=g.length;var k,C=at(g);try{for(C.s();!(k=C.n()).done;){var A=et(k.value,2),T=A[0],R=A[1];T.setEmpty(),R.setEmpty(),T.playClearFX(_),R.playClearFX(_),this.node.scene.emit(r0.GRID_CLEAR,[T,R])}}catch(g){C.e(g)}finally{C.f()}this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var g=this.hintPath[0].a,E=this.hintPath[this.hintPath.length-1].b,_=this.getTileAt(g.x,g.y),k=this.getTileAt(E.x,E.y);_.setHint(!0),k.setHint(!0),this.hintTiles=[_,k]}}},{key:"hideHint",value:function(){if(this.hintTiles){var g=et(this.hintTiles,2),E=g[0],_=g[1];E.setHint(!1),_.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(g,E){return this.grid.isInBounds(g,E)?this.grid.get(g,E):null}},{key:"getAnyTileWorldPosition",value:function(g,E){var _=Lh(this.grid,this.tileSize,{x:g,y:E});this.tilePrefab.node.setPosition(_.x,_.y);var k=this.tilePrefab.node.getWorldPosition();return{x:k.x,y:k.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getGridSize",value:function(){return[this.grid.width,this.grid.height]}},{key:"getUncleared",value:function(){return Dh(this.grid)}},{key:"getCleared",value:function(){return Bh(this.grid)}},{key:"getBombTiles",value:function(){var g;return Dh(_instanceof(g=this.grid,ud)?g.asArray():g).filter(function(g){var E;return(null===(E=g.special)||void 0===E?void 0:E.type)===uK.bomb})}},{key:"getPairs",value:function(g,E){for(var _=arguments.length>0&&void 0!==g?g:1,k=!(arguments.length>1&&void 0!==E)||E,C=[],A=k?Dh(this.grid):Bh(this.grid),_$a=function(){var g=et(Vh(A),2),E=g[0],_=g[1];C.push([E,_]),A=A.filter(function(g){return g!==E&&g!==_})};C.length<_;)_$a();return C}},{key:"setIgnoreInput",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.grid.forEach(function(g){return g.setIgnoreInput(E)})}},{key:"processShuffleRequest",value:function(g){var E=this.processShuffleStep(this.grid,!0,g);this.grid=E[0],this.hintPath=E[1],this.consumeAnimationQueue()}},{key:"getCurrentFen",value:function(){return vd(this.grid)}},{key:"generateFenFromCurrentLevel",value:function(g){return a.generateFen(null!=g?g:this.levelData)}},{key:"listenEvents",value:function(){Q.on(t6,this.onLayoutChanged),Q.on(no,this.handleViewResized)}},{key:"unlistenEvents",value:function(){Q.off(t6,this.onLayoutChanged),Q.off(no,this.handleViewResized)}},{key:"shakeGrid",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.tilesHolder.position.clone(),E=z(this.tilesHolder).to(.05,{position:g.clone().add3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g.clone().subtract3f(eR(5,10),eR(5,10),0)}),_=z(this.tilesHolder).repeat(2,E).to(.05,{position:g});return[4,tZ.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"processGameplayCycle",value:function(){var g=Dh(this.grid);if(0!==g.length){var E=this.grid,_=g.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,k=this.normalMatchesSinceLastSpawn>=2;_&&(k?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),g.length>14&&(E=this.processGravitationStep(E));var C=this.processShuffleStep(E);this.consumeAnimationQueue(),this.grid=C[0],this.hintPath=C[1]}}},{key:"processSpawnStep",value:function(){var g=et(jh(Bh(this.grid),2),2),E=g[0],_=g[1];E.restore(),_.restore(E.id),this.node.scene.emit(r0.GRID_SPAWN,[E,_])}},{key:"processGravitationStep",value:function(g){var E,_=this,k=g,C=[],A=at(this.parsedGravityRules);try{var r=function(){var g=E.value,A=md(k=_.toGravitated(k,g));if(0===A.length)return 1;var T,R=at(A);try{for(R.s();!(T=R.n()).done;){var I=et(T.value,2),L=I[0],P=et(I[1],2),O=P[0],B=P[1];L.setCoord(O,B)}}catch(g){R.e(g)}finally{R.f()}k.forEach(function(g){g.node.setSiblingIndex(0)});var N=function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Promise.all(A.map(function(g){var E=et(g,2),C=E[0],A=et(E[1],2),T=A[0],R=A[1];return C.sync({delay:.25,duration:.25,getTargetPosition:function(){return Lh(k,_.tileSize,{x:T,y:R})}})}))];case 1:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}();C.push(N)};for(A.s();!(E=A.n()).done;)r()}catch(g){A.e(g)}finally{A.f()}var T=function(){var g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=0,E=C;k.label=1;case 1:if(!(g<E.length))return[3,4];_=E[g];return[4,_()];case 2:k.sent();k.label=3;case 3:g++;return[3,1];case 4:return[2]}})});return function(){return g.apply(this,arguments)}}();return this.animationQueue.push(T),k}},{key:"toGravitated",value:function(g,E){var _=new ud(g),k=g.height-1,C=g.width-1,A=[0,k],T=[0,C],R=Math.floor(g.height/2),I=Math.floor(g.width/2),u=function(g){return g.isHidden()};switch(E){case us:_.gravitate({rowRange:A,colRange:T,direction:uo.Down,isLighter:u});break;case ul:_.gravitate({rowRange:A,colRange:T,direction:uo.Up,isLighter:u});break;case uu:_.gravitate({rowRange:A,colRange:T,direction:uo.Left,isLighter:u});break;case uc:_.gravitate({rowRange:A,colRange:T,direction:uo.Right,isLighter:u});break;case uh:_.gravitate({rowRange:A,colRange:[I,C],direction:uo.Left,isLighter:u,out:_.gravitate({rowRange:A,colRange:[0,I-1],direction:uo.Right,isLighter:u})});break;case up:_.gravitate({rowRange:[R,k],colRange:T,direction:uo.Down,isLighter:u,out:_.gravitate({rowRange:[0,R-1],colRange:T,direction:uo.Up,isLighter:u})})}return _}},{key:"getPrimitiveDirection",value:function(g,E,_){var k=Math.floor(this.grid.height/2),C=Math.floor(this.grid.width/2);switch(_){case us:return uo.Down;case ul:return uo.Up;case uu:return uo.Left;case uc:return uo.Right;case uh:return g>=C?uo.Left:uo.Right;case up:return E>=k?uo.Down:uo.Up}}},{key:"processShuffleStep",value:function(g,E,_){var k,C=arguments.length>1&&void 0!==E&&E,A=arguments.length>2?_:void 0,T=Od(g),R=Dh(g).map(function(g){var E=g.getCoord();return[E.x,E.y]});if(null!==T&&!C)return[g,T];var I=100;do{var L=g.toShuffled(R),P=et(L,1);T=Od(k=P[0]),I--}while(null===T&&I>0);if(I<=0){var O=k.asArray().map(function(g){var E,_;return{name:null===(E=g.id)||void 0===E?void 0:E.name,type:null===(_=g.special)||void 0===_?void 0:_.type,active:!g.isHidden()}});return null==cp||cp.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",level:this.levelData.level,gridAsArray:O}),this.node.scene.emit(r0.GAME_EXIT),[g,T]}var B,N=md(k),M=at(N);try{for(M.s();!(B=M.n()).done;){var D=et(B.value,2),F=D[0],U=et(D[1],2),x=U[0],z=U[1];F.setCoord(x,z)}}catch(g){M.e(g)}finally{M.f()}var G=void 0!==A?function(){return A(g,k)}:this.createShuffleAnimationHandler(g,k);return this.animationQueue.push(G),[k,T]}},{key:"createShuffleAnimationHandler",value:function(g,E){var _=this,k=function(){var k=Be(function(){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,Promise.all(g.map(function(g,k,C){return g.sync({duration:.3,easing:"smooth",getTargetPosition:function(){return Lh(E,_.tileSize,{x:k,y:C},10)}})}))];case 1:k.sent();return[2]}})});return function(){return k.apply(this,arguments)}}(),C=function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:E.forEach(function(g){g.node.setSiblingIndex(0)});return[4,Promise.all(E.map(function(g){return g.sync({duration:.4,easing:"smooth",delay:eR(0,.2),getTargetPosition:function(g){return Lh(E,_.tileSize,g)}})}))];case 1:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}();return function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,k()];case 1:g.sent();return[4,C()];case 2:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.isConsumingAnimation)return[3,5];this.isConsumingAnimation=!0;E.label=1;case 1:if(!(this.animationQueue.length>0))return[3,4];if(0===this.getUncleared().length){this.animationQueue=[];return[3,4]}g=this.animationQueue.shift();return[4,g()];case 2:E.sent();E.label=3;case 3:return[3,1];case 4:this.isConsumingAnimation=!1;E.label=5;case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"clearAnimationQueue",value:function(){this.isConsumingAnimation=!1,this.animationQueue=[]}}],[{key:"generateFen",value:function(g){for(var E=g,_=[],k=0;k<E.colors;k++)_.push(k+1);var C=Date.now(),A=Qh({levelData:E,seed:C,identities:_,createTile:function(g){var E=g,_=void 0,k=new eS(0,0);return{get id(){return E},get special(){return _},get coord(){return k},setIdentity:function(g){E=g},isHidden:function(){return!1},setSpecialType:function(g){_={type:g}},setCoord:function(g,E){return k.set(g,E)},getCoord:function(){return k},isSimilarTo:function(g){return g.id===E},inSamePositionAs:function(g){return g.getCoord().equals(k)}}}});return A.forEach(function(g,E,_){g.setCoord(E,_)}),td(A,C),Yh(A,E,C),vd(A)}}]),a}(M)).prototype,"tilePrefab",[u9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cr=st(cn.prototype,"tilesHolder",[u7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ca=st(cn.prototype,"tileTrim",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(.025,.1)}}),ct=cn))||ct)||ct);_._RF.pop(),_._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var cg=(0,k.ccclass)("Line")(cl=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R)}},{key:"setPoints",value:function(g,E){this.node.setWorldPosition((g.x+E.x)/2,(g.y+E.y)/2,0),this.uiTransform.width=eS.distance(g,E)+10,this.uiTransform.width/=this.node.worldScale.x;var _=180*Math.atan2(E.y-g.y,E.x-g.x)/Math.PI;this.node.eulerAngles=new em(0,0,_)}}]),n}(M))||cl;_._RF.pop(),_._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var cm,cb,cw,cS,cE,c_,ck,cC,cA,cT,cR,cI=function(g){ze(n,g);var E=Xe(n);function n(g,_,k,C,A){var T;return Fe(this,n),(T=E.call(this,g,_,A)).ator=k,T.ftor=C,T}return Ue(n,[{key:"alloc",value:function(){var g=Je(Ve(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(g),g}},{key:"free",value:function(g){this.ftor&&this.ftor(g),Je(Ve(n.prototype),"free",this).call(this,g)}}]),n}(eI);_._RF.pop(),_._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var cL,cP,cO,cB,cN,cM,cD,cF,cU,cx=k.ccclass,cz=k.property,cG=(cm=cx("PathDrawer"),cb=cz({group:"Line",displayName:"Prefab",type:ee}),cw=cz({group:"Line",displayName:"Holder",type:C,tooltip:"Line Prefab"}),cS=cz({group:"Point",displayName:"Prefab",type:ee}),cE=cz({group:"Point",displayName:"Holder",type:C}),cm((cC=st((ck=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"linePrefab",cC,Ke(g)),rt(g,"lineHolder",cA,Ke(g)),g.lineNodes=[],rt(g,"pointPrefab",cT,Ke(g)),rt(g,"pointHolder",cR,Ke(g)),g.pointNodes=[],g}return Ue(n,[{key:"start",value:function(){var g=this;this.linePool=new cI(function(){var E=I(g.linePrefab);return g.lineHolder.addChild(E),E.parent=g.lineHolder,E.active=!1,E},0,function(E){g.lineNodes.push(E),E.active=!0},function(g){g.active=!1},function(g){g.isValid&&g.destroy()}),this.pointPool=new cI(function(){var E=I(g.pointPrefab);return g.pointHolder.addChild(E),E.active=!1,E},0,function(E){g.pointNodes.push(E),E.active=!0},function(g){g.active=!1},function(g){g.isValid&&g.destroy()})}},{key:"drawPath",value:function(g){this.clearPath();var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k,C=E.value;null===(k=this.linePool.alloc().getComponent(cg))||void 0===k||k.setPoints(C.a,C.b)}}catch(g){_.e(g)}finally{_.f()}}},{key:"clearPath",value:function(){var g,E=at(this.lineNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value;this.linePool.free(_)}}catch(g){E.e(g)}finally{E.f()}this.lineNodes=[];var k,C=at(this.pointNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value;this.pointPool.free(A)}}catch(g){C.e(g)}finally{C.f()}this.pointNodes=[]}}]),n}(M)).prototype,"linePrefab",[cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cA=st(ck.prototype,"lineHolder",[cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cT=st(ck.prototype,"pointPrefab",[cS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cR=st(ck.prototype,"pointHolder",[cE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c_=ck))||c_);_._RF.pop(),_._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var cV,cK=k.ccclass,cH=k.property,cq=(cL=cK("ErrorDrawer"),cP=cH(ea),cO=cH(ea),cB=cH(ea),cL((cD=st((cM=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"one",cD,Ke(g)),rt(g,"two",cF,Ke(g)),rt(g,"error",cU,Ke(g)),g}return Ue(n,[{key:"start",value:function(){Je(Ve(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(g){var E=this;if(this.clearPath(),g.forEach(function(_,k){var C;if(null===(C=E.linePool.alloc().getComponent(cg))||void 0===C||C.setPoints(_.a,_.b),0!==k){var A=E.pointPool.alloc();A.setWorldPosition(new em(_.a.x,_.a.y,0));var T=A.getComponent(eo);1===k&&g.length>3?T.spriteFrame=E.one:2===k&&g.length>3?T.spriteFrame=E.two:T.spriteFrame=E.error}}),1===g.length){var _=this.pointPool.alloc();_.setWorldPosition(new em(g[0].a.x+g[0].b.x,g[0].a.y+g[0].b.y,0).multiplyScalar(.5)),_.getComponent(eo).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(g){this.pathAppearDuration>0&&(this.pathAppearDuration-=g,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(cG)).prototype,"one",[cP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cF=st(cM.prototype,"two",[cO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cU=st(cM.prototype,"error",[cB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cN=cM))||cN);_._RF.pop(),_._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var cW,cj=(0,k.ccclass)("HintDrawer")(cV=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"drawPath",value:function(g){this.clearPath(),this.createPath(g),this.showPath()}},{key:"createPath",value:function(g){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k,C=E.value;null===(k=this.linePool.alloc().getComponent(cg))||void 0===k||k.setPoints(C.a,C.b),this.pointPool.alloc().setWorldPosition(C.a.x,C.a.y,0)}}catch(g){_.e(g)}finally{_.f()}this.pointPool.alloc().setWorldPosition(g[g.length-1].b.x,g[g.length-1].b.y,0)}},{key:"showPath",value:function(){var g,E=at(this.lineNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value.getComponent(eu);_.opacity=0,z(_).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(g){E.e(g)}finally{E.f()}var k,C=at(this.pointNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value.getComponent(eu);A.opacity=0,z(A).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(g){C.e(g)}finally{C.f()}}},{key:"clearPath",value:function(){var g,E=this,_=at(this.lineNodes);try{var i=function(){var _=g.value,k=_.getComponent(eu);z(k).to(.15,{opacity:0},{onComplete:function(){k.opacity=255,E.linePool.free(_)}}).start()};for(_.s();!(g=_.n()).done;)i()}catch(g){_.e(g)}finally{_.f()}var k,C=at(this.pointNodes);try{var r=function(){var g=k.value,_=g.getComponent(eu);z(_).to(.15,{opacity:0},{onComplete:function(){_.opacity=255,E.pointPool.free(g)}}).start()};for(C.s();!(k=C.n()).done;)r()}catch(g){C.e(g)}finally{C.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(cG))||cV;_._RF.pop(),_._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var cX,cY,cJ,cQ,cZ,c$,c0,c1,c2,c4=(0,k.ccclass)("MatchDrawer")(cW=function(g){ze(a,g);var E,_,k=Xe(a);function a(){return Fe(this,a),k.apply(this,arguments)}return Ue(a,[{key:"drawPath",value:function(g){var E=this;g.forEach(function(g,_){var k,C=E.linePool.alloc();null===(k=C.getComponent(cg))||void 0===k||k.setPoints(g.a,g.b),E.animateLine(C);var A=E.pointPool.alloc();A.setWorldPosition(g.a.x,g.a.y,0),E.animatePoint(A,_)});var _=this.pointPool.alloc();_.setWorldPosition(g[g.length-1].b.x,g[g.length-1].b.y,0),this.animatePoint(_,g.length)}},{key:"animateLine",value:(_=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=g.getComponent(eu);E.opacity=0;_=z(E).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});return[4,tZ.runTweenAsync(_)];case 1:k.sent(),E.opacity=255,this.linePool.free(g);return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"animatePoint",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.scale=em.ZERO;_=z(g).delay(.03*E).to(.2,{scale:em.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:em.ZERO},{easing:"backIn"});return[4,tZ.runTweenAsync(_)];case 1:k.sent(),this.pointPool.free(g);return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),a}(cG))||cW;_._RF.pop(),_._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var c5,c6=k.ccclass,c8=k.property,c9=(cX=c6("PathDraw"),cY=c8({group:{name:"Path Drawer"},type:c4}),cJ=c8({group:{name:"Path Drawer"},type:cj}),cQ=c8({group:{name:"Path Drawer"},type:cq}),cX((c0=st((c$=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"matchPath",c0,Ke(g)),rt(g,"hintPath",c1,Ke(g)),rt(g,"errorPath",c2,Ke(g)),g.isDrawingHint=!1,g}return Ue(n,[{key:"onLoad",value:function(){var g=this;this.node.scene.on(r0.GRID_RESIZE,function(E){g.node.setScale(E,E)})}},{key:"drawMatchPath",value:function(g,E){var _,k=g.map(function(g){return Me({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.matchPath.drawPath(k)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(g,E){if(!this.isDrawingHint){this.isDrawingHint=!0;var _,k=g.map(function(g){return Me({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.hintPath.drawPath(k)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(g,E){var _,k=g.map(function(g){return Me({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.errorPath.drawPath(k)}}]),n}(M)).prototype,"matchPath",[cY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c1=st(c$.prototype,"hintPath",[cJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c2=st(c$.prototype,"errorPath",[cQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cZ=c$))||cZ);_._RF.pop(),_._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var c7,he,ht,hn,hi,hr,ha,ho,hs,hl,hu,hc=k.ccclass,hh=[ic.COMBO_1,ic.COMBO_2,ic.COMBO_3,ic.COMBO_4,ic.COMBO_5,ic.COMBO_6,ic.COMBO_7,ic.COMBO_8,ic.COMBO_9,ic.COMBO_10,ic.COMBO_11,ic.COMBO_12,ic.COMBO_13],hp=hc("ComboManager")(c5=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(r0.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(r0.GAME_FINISH,this.resetCombo,this),this.node.scene.on(r0.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(r0.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(r0.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(g){if(this.currentCombo=g,g>0){var E=Math.min(g-1,hh.length-1);i5.playSound(hh[E]),this.vibrate(g)}this.emitEvent&&this.node.scene.emit(r0.COMBO_UPDATED,g)}},{key:"vibrate",value:function(g){var E;null===(E=$("Vibrate"))||void 0===E||null===(E=E.getComponent(sR))||void 0===E||E.vibrate(Math.min(20+20*g,220))}},{key:"setEmitEvent",value:function(g){this.emitEvent=g}}]),n}(M))||c5;_._RF.pop(),_._RF.push({},"78746Q4viBIlbRROK4J1bSl","Burst",void 0);var hf,hy=k.ccclass,hv=k.property,hg=(c7=hy("Burst"),he=hv(K),ht=hv(V),hn=hv(K),hi=hv(V),c7((ho=st((ha=function(){function e(){Fe(this,e),rt(this,"time",ho,this),rt(this,"repeatCount",hs,this),rt(this,"repeatInterval",hl,this),rt(this,"count",hu,this),this.remainingCount=0,this.curTime=0}return Ue(e,[{key:"update",value:function(g,E){if(0===this.remainingCount&&(this.remainingCount=this.repeatCount,this.curTime=this.time),this.remainingCount>0){var _=eL(g.time-g.startDelay.evaluate(0,1),g.duration)-E;_=_>0?_:0;var k=eL(g.time-g.startDelay.evaluate(0,1),g.duration);this.curTime>=_&&this.curTime<k&&(g.emit(this.count,E-(k-this.curTime)),this.curTime+=this.repeatInterval,--this.remainingCount)}}},{key:"reset",value:function(){this.remainingCount=0,this.curTime=0}}]),e}()).prototype,"time",[he],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hs=st(ha.prototype,"repeatCount",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hl=st(ha.prototype,"repeatInterval",[hn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hu=st(ha.prototype,"count",[hi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hr=ha))||hr);_._RF.pop(),_._RF.push({},"726cc2e08FBqpVIg/tPM7H2","Particle",void 0);var hm,hb,hw,hS,hE,h_,hk,hC,hA,hT,hR,hI,hL,hP,hO,hB,hN,hM=k.ccclass,hD=k.executeInEditMode,hF=hM("Particle")(hf=hD(!0)(hf=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).remainingLifetime=0,g.startLifetime=0,g}return Ue(n,[{key:"onLoad",value:function(){this.node.layer=ek.Enum.UI_2D}},{key:"init",value:function(g){this.sprite=this.getComponent(eo),this.particleSystem=g,this.velocity=em.ZERO,this.remainingLifetime=0,this.startLifetime=0,this.startSize=em.ZERO,this.startColor=A.WHITE.clone(),this.randomSeed=0}},{key:"reset",value:function(){this.node.rotation.set(0,0,0)}}]),n}(M))||hf)||hf;_._RF.pop(),_._RF.push({},"00eb3NBo0tM/qcD6ViMjx0A","CurveRange",void 0);var hU,hx,hz,hG,hV,hK,hH,hq,hW,hj,hX,hY,hJ,hQ,hZ,h$,h0,h1=k.ccclass,h2=k.property,h4=es({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),h3=(hm=h1("CurveRange"),hb=h2({type:es(h4)}),hw=h2({visible:function(){return this.mode===h4.Constant}}),hS=h2({visible:function(){return this.mode===h4.Curve}}),hE=h2({visible:function(){return this.mode===h4.TwoCurves}}),h_=h2({visible:function(){return this.mode===h4.TwoCurves}}),hk=h2({visible:function(){return this.mode===h4.TwoConstants}}),hC=h2({visible:function(){return this.mode===h4.TwoConstants}}),hm((hR=st((hT=function(){function e(){Fe(this,e),rt(this,"mode",hR,this),rt(this,"constant",hI,this),rt(this,"spline",hL,this),rt(this,"splineMin",hP,this),rt(this,"splineMax",hO,this),rt(this,"constantMin",hB,this),rt(this,"constantMax",hN,this),this.spline.assignSorted([0,1],[0,1]),this.splineMin.assignSorted([0,1],[0,1]),this.splineMax.assignSorted([0,1],[0,1])}return Ue(e,[{key:"evaluate",value:function(g,E){switch(this.mode){case h4.Curve:return this.spline.evaluate(g);case h4.TwoCurves:return eP(this.splineMin.evaluate(g),this.splineMax.evaluate(g),E);case h4.TwoConstants:return eP(this.constantMin,this.constantMax,E);default:return this.constant}}},{key:"getMax",value:function(){switch(this.mode){case h4.Curve:return 1;case h4.TwoConstants:return this.constantMax;case h4.TwoCurves:return 1;default:return this.constant}}},{key:"isZero",value:function(){switch(this.mode){case h4.Curve:return eO(1,0,eB);case h4.TwoConstants:return eO(Math.max(Math.abs(this.constantMax),Math.abs(this.constantMin)),0,eB);case h4.TwoCurves:return eO(1,0,eB);default:return eO(this.constant,0,eB)}}}]),e}()).prototype,"mode",[hb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h4.Constant}}),hI=st(hT.prototype,"constant",[hw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hL=st(hT.prototype,"spline",[hS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eN}}),hP=st(hT.prototype,"splineMin",[hE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eN}}),hO=st(hT.prototype,"splineMax",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eN}}),hB=st(hT.prototype,"constantMin",[hk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hN=st(hT.prototype,"constantMax",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hA=hT))||hA);_._RF.pop(),_._RF.push({},"3fe5eBRNTJFCZgeD7SqFSh5","GradientRange",void 0);var h5=k.ccclass,h6=k.property,h8=es({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),h9=new A,h7=new A,pe=(hU=h5("GradientRange"),hx=h6({type:es(h8)}),hz=h6({visible:function(){return this.mode===h8.Color}}),hG=h6({visible:function(){return this.mode===h8.TwoColors}}),hV=h6({visible:function(){return this.mode===h8.TwoColors}}),hK=h6({visible:function(){return this.mode===h8.Gradient||this.mode===h8.RandomColor}}),hH=h6({visible:function(){return this.mode===h8.TwoGradients}}),hq=h6({visible:function(){return this.mode===h8.TwoGradients}}),hU((hX=st((hj=function(){function e(){Fe(this,e),rt(this,"mode",hX,this),rt(this,"color",hY,this),rt(this,"colorMin",hJ,this),rt(this,"colorMax",hQ,this),rt(this,"gradient",hZ,this),rt(this,"gradientMin",h$,this),rt(this,"gradientMax",h0,this),this._color=A.WHITE.clone()}return Ue(e,[{key:"evaluate",value:function(g,E){switch(this.mode){case h8.Color:return this.color;case h8.TwoColors:return A.lerp(this._color,this.colorMin,this.colorMax,E),this._color;case h8.RandomColor:return this.gradient.getRandomColor(this._color);case h8.Gradient:return this.gradient.evaluateFast(this._color,g);case h8.TwoGradients:return A.lerp(this._color,this.gradientMin.evaluateFast(h9,g),this.gradientMax.evaluateFast(h7,g),E),this._color;default:return this.color}}}]),e}()).prototype,"mode",[hx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h8.Color}}),hY=st(hj.prototype,"color",[hz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),hJ=st(hj.prototype,"colorMin",[hG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),hQ=st(hj.prototype,"colorMax",[hV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),hZ=st(hj.prototype,"gradient",[hK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),h$=st(hj.prototype,"gradientMin",[hH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),h0=st(hj.prototype,"gradientMax",[hq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),hW=hj))||hW);function $y(g,E,_,k){!function(g,E){eS.set(g,Math.cos(E),Math.sin(E))}(g,k),g.z=0,em.multiplyScalar(g,g,E+(_-E)*eF())}function ef(g){var E=h4;switch(g.mode){case E.TwoCurves:case E.TwoConstants:return!0;default:return!1}}_._RF.pop(),_._RF.push({},"1a4c4Z/fWpFuL5b3emrVLug","ParticleFunction",void 0),_._RF.pop(),_._RF.push({},"c2fc2/T2apMGZCPX5a4abo/","ModuleRandSeed",void 0);var pt,pn,pi,pr,pa,po,ps,pl=23541,pu=39825,pc=90794,ph=91041,pp=125292,pf=197866,py=156497;_._RF.pop(),_._RF.push({},"39785+APfBJU5kvcdjZGiLr","ColorOvertimeModule",void 0);var pv,pg,pm,pb,pw,pS,pE,p_,pk,pC=k.ccclass,pA=k.property,pT=ph,pR=(pt=pC("ColorOvertimeModule"),pn=pA({type:J}),pi=pA({type:pe}),pt((po=st((pa=function(){function e(){Fe(this,e),rt(this,"enable",po,this),rt(this,"color",ps,this)}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=g.randomSeed+pT,_=function(g){var E=h8;switch(g.mode){case E.TwoGradients:case E.TwoColors:return!0;default:return!1}}(this.color)?eT(E):0,k=1-g.remainingLifetime/g.startLifetime;g.sprite.color=g.startColor.clone().multiply(this.color.evaluate(k,_))}}}]),e}()).prototype,"enable",[pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ps=st(pa.prototype,"color",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),pr=pa))||pr);_._RF.pop(),_._RF.push({},"c397apirpxFfJTJN1KLAcGi","LimitVelocityOvertimeModule",void 0);var pI,pL,pP,pO,pB,pN,pM,pD=k.ccclass,pF=k.property,pU=pl,px=(pv=pD("LimitVelocityOvertimeModule"),pg=pF({type:J}),pm=pF({type:h3}),pb=pF({type:h3}),pv((pE=st((pS=function(){function e(){Fe(this,e),rt(this,"enable",pE,this),rt(this,"limit",p_,this),rt(this,"dampen",pk,this),this.limit.constant=500,this.dampen.constant=.2}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=g.velocity.clone().normalize(),C=ef(this.limit)?eT(g.randomSeed+pU):0,A=ef(this.dampen)?eT(g.randomSeed+pU+1):0,T=g.velocity.length(),R=this.limit.evaluate(_,C),I=this.dampen.evaluate(_,A);g.velocity=k.multiplyScalar(this.dampenBeyondLimit(T,R,I,E))}}},{key:"dampenBeyondLimit",value:function(g,E,_,k){if(g<=E)return g;var C=1-Math.exp(-_*k);return X.lerp(g,E,C)}}]),e}()).prototype,"enable",[pg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p_=st(pS.prototype,"limit",[pm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),pk=st(pS.prototype,"dampen",[pb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),pw=pS))||pw);_._RF.pop(),_._RF.push({},"442c2KaGHdNip4TBoeKOOoY","RendererModule",void 0);var pz,pG,pV,pK,pH,pq,pW,pj,pX,pY,pJ,pQ,pZ,p$,p0=k.ccclass,p1=k.property,p2=(pI=p0("RendererModule"),pL=p1(eU),pP=p1(ea),pI((pN=st((pB=Ue(function e(){Fe(this,e),rt(this,"material",pN,this),rt(this,"spriteFrame",pM,this)})).prototype,"material",[pL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pM=st(pB.prototype,"spriteFrame",[pP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pO=pB))||pO);_._RF.pop(),_._RF.push({},"c6cfbhYVctHt53aUXC4oSWy","RotationOvertimeModule",void 0);var p4,p3,p5,p6,p8,p9,p7,de,dt,dn,di,dr,da,ds,dl,du,dc,dh,dp,df,dy,dv,dg,dm=k.ccclass,db=k.property,dw=pp,dS=(pz=dm("RotationOvertimeModule"),pG=db({type:J}),pV=db(J),pK=db({type:h3}),pH=db({type:h3,visible:function(){return this.separateAxes}}),pq=db({type:h3,visible:function(){return this.separateAxes}}),pW=db({type:h3}),pz((pY=st((pX=function(){function e(){Fe(this,e),rt(this,"enable",pY,this),rt(this,"separateAxes",pJ,this),rt(this,"x",pQ,this),rt(this,"y",pZ,this),rt(this,"z",p$,this)}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=g.randomSeed+dw,C=ef(this.z)?eT(k):0,A=this.z.evaluate(_,C)*E,T=0,R=0;if(this.separateAxes){var I=ef(this.x)?eT(k):0,L=ef(this.y)?eT(k):0;T=this.x.evaluate(_,I)*E,R=this.y.evaluate(_,L)*E}g.node.eulerAngles=new em(g.node.eulerAngles.x+T,g.node.eulerAngles.y+R,g.node.eulerAngles.z+A)}}}]),e}()).prototype,"enable",[pG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pJ=st(pX.prototype,"separateAxes",[pV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pQ=st(pX.prototype,"x",[pK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),pZ=st(pX.prototype,"y",[pH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),p$=st(pX.prototype,"z",[pq,pW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),pj=pX))||pj);_._RF.pop(),_._RF.push({},"f63cd4ScDJFPrnTLNT4+QKu","ShapeModule",void 0);var dE,d_,dk,dC,dA,dT,dR,dI=k.ccclass,dL=k.property,dP=es({Circle:0,Rectangle:1}),dO=es({Base:0,Edge:1}),zv=function(){return this.shape===dP.Circle},Vv=function(){return this.shape===dP.Rectangle},dB=[0,0],dN=(p4=dI("ShapeModule"),p3=dL({type:es(dP)}),p5=dL({type:es(dO),visible:Vv}),p6=dL({}),p8=dL({}),p9=dL({}),p7=dL({range:[0,360],visible:zv}),de=dL({range:[-360,360],visible:zv}),dt=dL({min:0,visible:zv}),dn=dL({range:[0,1],step:.01,visible:zv}),di=dL({visible:Vv}),p4((ds=st((da=function(){function e(){Fe(this,e),rt(this,"shape",ds,this),rt(this,"emitFrom",dl,this),rt(this,"position",du,this),rt(this,"rotation",dc,this),rt(this,"scale",dh,this),rt(this,"arc",dp,this),rt(this,"angle",df,this),rt(this,"radius",dy,this),rt(this,"radiusThickness",dv,this),rt(this,"rectangleThickness",dg,this)}return Ue(e,[{key:"emit",value:function(g){switch(this.shape){case dP.Circle:this.circleEmit(this.radius,this.radiusThickness,ex(this.generateArcAngle()),g);break;case dP.Rectangle:this.rectangleEmit(this.emitFrom,this.rectangleThickness,g)}}},{key:"circleEmit",value:function(g,E,_,k){var C=k.node.position;$y(C,g*(1-E),g,_+ex(this.angle)),k.velocity=C.clone().normalize()}},{key:"rectangleEmit",value:function(g,E,_){var k,C,A,T=_.node.position;switch(g){case dO.Base:C=T,A=E,eS.set(C,eR(-A.x,A.x),eR(-A.y,A.y));break;case dO.Edge:dB[0]=eR(-1,1),dB[1]=(0===(k=eR(-1,1))&&k++,eD.sign(k)),function(g){for(var E=0;E<g.length;E++){var _=E+eC(0,g.length-E),k=g[_];g[_]=g[E],g[E]=k}}(dB),this.applyRectThickness(dB,E),eS.set(T,dB[0],dB[1])}_.velocity=T.clone().normalize()}},{key:"generateArcAngle",value:function(){return eR(0,this.arc)}},{key:"applyRectThickness",value:function(g,E){E.x>0&&(g[0]*=E.x),E.y>0&&(g[1]*=E.y)}},{key:"gizmo",value:function(g){switch(g.strokeColor.fromHEX("#46C4FFB0"),g.fillColor.fromHEX("#46C4FF77"),g.lineWidth=8,this.shape){case dP.Circle:this.gizmoCircle(g);break;case dP.Rectangle:this.gizmoRectangle(g)}}},{key:"gizmoCircle",value:function(g){g.clear();var E=this.angle,_=this.angle+this.arc;if(this.createArcPath(g,this.radius,E,_),this.createArcPath(g,this.radius*(1-this.radiusThickness),E,_),this.arc<360&&this.radius>0){var k=this.radius*Math.cos(ex(this.angle)),C=this.radius*Math.sin(ex(this.angle)),A=this.radius*Math.cos(ex(this.arc+this.angle)),T=this.radius*Math.sin(ex(this.arc+this.angle));g.moveTo(k,C),g.lineTo(0,0),g.moveTo(A,T),g.lineTo(0,0)}g.stroke()}},{key:"gizmoRectangle",value:function(g){g.clear();var E=this.rectangleThickness.x,_=this.rectangleThickness.y;g.moveTo(E,_),g.lineTo(-E,_),g.lineTo(-E,-_),g.lineTo(E,-_),g.close(),g.stroke()}},{key:"createArcPath",value:function(g,E,_,k){if(!(E<=0))for(var C=(k-_)/48,A=0;A<=48;A++){var T=_+A*C,R=E*Math.cos(ex(T)),I=E*Math.sin(ex(T));0===A?g.moveTo(R,I):g.lineTo(R,I)}}}]),e}()).prototype,"shape",[p3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dP.Circle}}),dl=st(da.prototype,"emitFrom",[p5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dO.Base}}),du=st(da.prototype,"position",[p6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(0,0,0)}}),dc=st(da.prototype,"rotation",[p8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(0,0,0)}}),dh=st(da.prototype,"scale",[p9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(1,1,1)}}),dp=st(da.prototype,"arc",[p7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 360}}),df=st(da.prototype,"angle",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),dy=st(da.prototype,"radius",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),dv=st(da.prototype,"radiusThickness",[dn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),dg=st(da.prototype,"rectangleThickness",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(20,50)}}),dr=da))||dr);_._RF.pop(),_._RF.push({},"1b7c1WztGdLzKO8gh4ulm2c","SizeOvertimeModule",void 0);var dM,dD,dF,dU,dx,dz,dG,dV,dK,dH,dq,dW,dj,dX=k.ccclass,dY=k.property,dJ=pu,dQ=(dE=dX("SizeOvertimeModule"),d_=dY({type:J}),dk=dY({type:h3}),dE((dT=st((dA=function(){function e(){Fe(this,e),rt(this,"enable",dT,this),rt(this,"size",dR,this),this.size.constant=1}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=1-g.remainingLifetime/g.startLifetime,_=g.randomSeed+dJ,k=ef(this.size)?eT(_):0,C=this.size.evaluate(E,k);g.node.scale=new em(C*g.startSize.x,C*g.startSize.y,1)}}}]),e}()).prototype,"enable",[d_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dR=st(dA.prototype,"size",[dk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),dC=dA))||dC);_._RF.pop(),_._RF.push({},"530341yf3ZOmaqdU+AYM0/U","SpriteAnimationModule",void 0);var dZ,d$,d0,d1,d2,d4,d3,d5,d6,d8=k.ccclass,d9=k.property,d7=pc,fe=(dM=d8("SpriteAnimationModule"),dD=d9({type:J}),dF=d9({type:ea}),dU=d9({type:h3}),dx=d9({type:h3}),dz=d9({type:V}),dM((dK=st((dV=function(){function e(){Fe(this,e),rt(this,"enable",dK,this),rt(this,"frames",dH,this),rt(this,"frameOverTime",dq,this),rt(this,"startFrame",dW,this),rt(this,"cycleCount",dj,this),this.frameOverTime.constant=0,this.startFrame.constant=0}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=1-g.remainingLifetime/g.startLifetime,_=ef(this.startFrame)?eT(g.randomSeed+d7):0,k=ef(this.frameOverTime)?eT(g.randomSeed+d7):0,C=this.startFrame.evaluate(E,_),A=eL(this.cycleCount*(this.frameOverTime.evaluate(E,k)+C),this.frames.length);g.sprite.spriteFrame=this.frames[Math.floor(A)]}}}]),e}()).prototype,"enable",[dD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dH=st(dV.prototype,"frames",[dF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dq=st(dV.prototype,"frameOverTime",[dU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),dW=st(dV.prototype,"startFrame",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),dj=st(dV.prototype,"cycleCount",[dz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dG=dV))||dG);_._RF.pop(),_._RF.push({},"f6ad5Yz6wpE2ZzModn16CYQ","VelocityOvertimeModule",void 0);var ft,fn,fi,fr,fa,fo,fs,fl,fu,fc,fh,fp,fd,ff,fy,fv,fg,fm,fb,fw,fS,fE,f_,fk,fC,fA,fT,fR,fI,fL,fP,fO,fB,fN,fM,fD,fF,fU,fx,fz,fG,fV,fK,fH,fq,fW,fj,fX,fY,fJ,fQ,fZ,f$=k.ccclass,f0=k.property,f1=(dZ=f$("VelocityOvertimeModule"),d$=f0({type:J}),d0=f0({type:h3}),d1=f0({type:h3}),dZ((d3=st((d4=function(){function e(){Fe(this,e),rt(this,"enable",d3,this),rt(this,"x",d5,this),rt(this,"y",d6,this),this._temp_v3=new em,this.x.constant=0,this.y.constant=0}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=ef(this.x)?eT(g.randomSeed+pf):0,C=ef(this.y)?eT(g.randomSeed+py):0,A=em.set(this._temp_v3,this.x.evaluate(_,k),this.y.evaluate(_,C),0);em.add(g.velocity,g.velocity,A.multiplyScalar(E))}}}]),e}()).prototype,"enable",[d$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d5=st(d4.prototype,"x",[d0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),d6=st(d4.prototype,"y",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),d2=d4))||d2);_._RF.pop(),_._RF.push({},"10bc3IfFqBLtpSgVri/NVeX","ParticleSystem",void 0);var f2,f4,f3,f5,f6,f8,f9,f7,ye,yt=k.ccclass,yn=k.property,yi=k.executeInEditMode,yr=k.disallowMultiple,ya=(ft=yt("ParticleSystem"),fn=yi(!0),fi=yr(!0),fr=yn({}),fa=yn(J),fo=yn(K),fs=yn(J),fl=yn({type:h3}),fu=yn({type:h3}),fc=yn(pe),fh=yn(J),fp=yn({type:h3,formerlySerializedAs:"startSize"}),fd=yn({type:h3,visible:function(){return this.startSize2D}}),ff=yn({type:h3}),fy=yn(J),fv=yn({type:h3,formerlySerializedAs:"startRotation"}),fg=yn({type:h3}),fm=yn({type:h3}),fb=yn({type:dN}),fw=yn({type:f1}),fS=yn({type:dQ}),fE=yn({type:dS}),f_=yn({type:pR}),fk=yn({type:fe}),fC=yn({type:px}),fA=yn(hg),fT=yn({type:p2}),ft(fR=fn(fR=fi((st((fI=function(g){ze(n,g);var E=Xe(n);function n(){var g;return Fe(this,n),(g=E.call(this))._preview=!1,rt(g,"playOnAwake",fL,Ke(g)),rt(g,"duration",fP,Ke(g)),rt(g,"loop",fO,Ke(g)),rt(g,"startDelay",fB,Ke(g)),rt(g,"startLifetime",fN,Ke(g)),rt(g,"startColor",fM,Ke(g)),rt(g,"startSize2D",fD,Ke(g)),rt(g,"startSizeX",fF,Ke(g)),rt(g,"startSizeY",fU,Ke(g)),rt(g,"startSpeed",fx,Ke(g)),rt(g,"startRotation3D",fz,Ke(g)),rt(g,"startRotation",fG,Ke(g)),rt(g,"gravityModifier",fV,Ke(g)),rt(g,"rateOverTime",fK,Ke(g)),rt(g,"shapeModule",fH,Ke(g)),rt(g,"velocityOvertimeModule",fq,Ke(g)),rt(g,"sizeOvertimeModule",fW,Ke(g)),rt(g,"rotationOvertimeModule",fj,Ke(g)),rt(g,"colorOvertimeModule",fX,Ke(g)),rt(g,"spriteAnimationModule",fY,Ke(g)),rt(g,"limitVelocityOvertimeModule",fJ,Ke(g)),rt(g,"bursts",fQ,Ke(g)),rt(g,"rendererModule",fZ,Ke(g)),g.particles=[],g.time=0,g.emitRateTimeCounter=0,g.isPlaying=!1,g.isStopped=!0,g.isEmitting=!1,g.needToRestart=!1,g.startLifetime.constant=5,g.startSizeX.constant=1,g.startSpeed.constant=5,g.rateOverTime.constant=10,g}return Ue(n,[{key:"preview",get:function(){return this._preview},set:function(g){this._preview=g,this.graphics&&this.graphics.destroy()}},{key:"onEnable",value:function(){}},{key:"onLoad",value:function(){this.preview=null!==this.getComponent(ed),this.node.removeAllChildren()}},{key:"start",value:function(){this.node.position=new em(this.node.position.x,this.node.position.y,100),this.playOnAwake?this.play():this.preview}},{key:"update",value:function(g){this.isPlaying&&(this.time+=g,this.emitting(g))}},{key:"play",value:function(){this.needToRestart&&(this.needToRestart=!1),this.isStopped&&(this.isStopped=!1),this.time=0,this.isPlaying=!0,this.isEmitting=!0}},{key:"stop",value:function(){this.isPlaying||(this.isPlaying=!1),this.isEmitting||(this.isEmitting=!1),this.isStopped=!0}},{key:"emitting",value:function(g){var E=this,_=this.startDelay.evaluate(0,1);if(this.time>_&&this.time>this.duration+_&&(this.loop||(this.isEmitting=!1)),this.isEmitting){if(this.emitRateTimeCounter+=this.rateOverTime.evaluate(this.time/this.duration,1)*g,this.emitRateTimeCounter>1){var k=Math.floor(this.emitRateTimeCounter);this.emitRateTimeCounter-=k,this.emit(k,g)}var C,A=at(this.bursts);try{for(A.s();!(C=A.n()).done;)C.value.update(this,g)}catch(g){A.e(g)}finally{A.f()}}var T=this.gravityModifier.evaluate(this.time/this.duration,1);this.particles.forEach(function(_,k){_.node.active&&(E.spriteAnimationModule.update(_),E.sizeOvertimeModule.update(_),E.rotationOvertimeModule.update(_,g),E.colorOvertimeModule.update(_),E.velocityOvertimeModule.update(_,g),E.applyGravityModifier(_,T),E.limitVelocityOvertimeModule.update(_,g),_.node.position.add(_.velocity.clone().multiplyScalar(g)),_.remainingLifetime-=g,_.remainingLifetime<=0&&(_.node.active=!1))})}},{key:"emit",value:function(g,E){if(null!==this.rendererModule.spriteFrame)for(var _=this.time%this.duration/this.duration,k=0;k<g;k++){var C=this.getFreeParticle();C.init(this),C.reset(),this.shapeModule.emit(C);var A=this.startSpeed.evaluate(_,this.rand());C.velocity=C.velocity.clone().multiplyScalar(A);var T=this.startSizeX.evaluate(_,this.rand()),R=this.startSize2D?new em(T,this.startSizeY.evaluate(_,this.rand()),1):new em(T,T,1);C.startSize=R.clone(),C.node.scale=R.clone();var I=this.startRotation.evaluate(_,this.rand());C.node.eulerAngles=new em(0,0,I),C.startColor=this.startColor.evaluate(_,this.rand()).clone(),C.sprite.color=C.startColor.clone(),C.startLifetime=this.startLifetime.evaluate(_,this.rand())+E,C.remainingLifetime=C.startLifetime,C.randomSeed=eC(0,233280)}}},{key:"applyGravityModifier",value:function(g,E){g.velocity.add(new em(0,-9.8*E,0))}},{key:"rand",value:function(){return eT(eC(0,eD.INT_MAX))}},{key:"getFreeParticle",value:function(){var g=this.particles.find(function(g){return!g.node.active});return g||(g=this.createParticle()),g.node.active=!0,g}},{key:"createParticle",value:function(){var g=new C,E=I(g),_=E.addComponent(hF),k=E.addComponent(eo);return this.particles.push(_),k.spriteFrame=this.rendererModule.spriteFrame,k.customMaterial=this.rendererModule.material,this.node.addChild(E),_}}]),n}(M)).prototype,"preview",[fr],Object.getOwnPropertyDescriptor(fI.prototype,"preview"),fI.prototype),fL=st(fI.prototype,"playOnAwake",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),fP=st(fI.prototype,"duration",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),fO=st(fI.prototype,"loop",[fs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fB=st(fI.prototype,"startDelay",[fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),fN=st(fI.prototype,"startLifetime",[fu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),fM=st(fI.prototype,"startColor",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),fD=st(fI.prototype,"startSize2D",[fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fF=st(fI.prototype,"startSizeX",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),fU=st(fI.prototype,"startSizeY",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),fx=st(fI.prototype,"startSpeed",[ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),fz=st(fI.prototype,"startRotation3D",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fG=st(fI.prototype,"startRotation",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),fV=st(fI.prototype,"gravityModifier",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),fK=st(fI.prototype,"rateOverTime",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h3}}),fH=st(fI.prototype,"shapeModule",[fb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dN}}),fq=st(fI.prototype,"velocityOvertimeModule",[fw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f1}}),fW=st(fI.prototype,"sizeOvertimeModule",[fS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dQ}}),fj=st(fI.prototype,"rotationOvertimeModule",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dS}}),fX=st(fI.prototype,"colorOvertimeModule",[f_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pR}}),fY=st(fI.prototype,"spriteAnimationModule",[fk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fe}}),fJ=st(fI.prototype,"limitVelocityOvertimeModule",[fC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new px}}),fQ=st(fI.prototype,"bursts",[yn,fA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fZ=st(fI.prototype,"rendererModule",[fT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p2}}),fR=fI))||fR)||fR)||fR);_._RF.pop(),_._RF.push({},"a7ff8uVnP1G3ppM9F/A5DYq","Cloud",void 0);var yo,ys,yl,yu,yc,yh,yp,yf,yy,yv,yg,ym,yb,yw,yS,yE,y_,yk=k.ccclass,yC=k.property,yA=(f2=yk("Cloud"),f4=yC({type:C}),f3=yC({type:C}),f5=yC({type:G}),f2((f9=st((f8=function(g){ze(l,g);var E,_,k,C,A,T=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"cloudSprites",f9,Ke(g)),rt(g,"lightnings",f7,Ke(g)),rt(g,"animation",ye,Ke(g)),g}return Ue(l,[{key:"playInitAnimation",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.moveToScreenCenter()];case 1:g.sent();return[2]}})}),function(){return A.apply(this,arguments)})},{key:"playLightningAnimation",value:(C=Be(function(g,E){var _,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=this.lightnings[E],k=g.subtract(_.worldPosition),C=Math.atan2(k.y,k.x)*(180/Math.PI)+180,A=k.length();_.getComponent(R).width=A,_.angle=C,_.active=!0;return[4,tZ.waitTweenAsync(.2)];case 1:T.sent(),_.active=!1;return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"playScaleTween",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.cloudSprites.map(function(g){var E=z(g).to(.1,{scale:new em(1.2,1.2)},{easing:"quadOut"}).to(.1,{scale:new em(1,1)},{easing:"quadOut"});return tZ.runTweenAsync(E)});return[4,Promise.all(g)];case 1:E.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadAnimation",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(null!==this.animation.defaultClip)return[3,2];return[4,n7.loadAnimClipAsync(nM.CLOUD_IDLE_ANIM)];case 1:g=E.sent();g&&this.animation&&(this.animation.defaultClip=g);E.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"moveToScreenCenter",value:(E=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=$("Canvas").getComponent(R),E=g.width,_=g.height,k=0,C=0;switch(Math.floor(4*Math.random())){case 0:k=Math.random()*E-E/2,C=_/2+300;break;case 1:k=Math.random()*E-E/2,C=-_/2-300;break;case 2:k=-E/2-300,C=Math.random()*_-_/2;break;case 3:k=E/2+300,C=Math.random()*_-_/2}this.node.position=new em(k,C);A=z(this.node).to(.8,{position:new em(0,300)},{easing:"quadOut"});return[4,tZ.runTweenAsync(A)];case 1:T.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),l}(M)).prototype,"cloudSprites",[f4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f7=st(f8.prototype,"lightnings",[f3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ye=st(f8.prototype,"animation",[f5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f6=f8))||f6);_._RF.pop(),_._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var yT,yR,yI,yL,yP,yO=k.ccclass,yB=k.property,yN=k.disallowMultiple,yM=(yo=yO("ShiningStar"),ys=yB(eo),yl=yB({serializable:!0,visible:!1}),yu=yB({type:K,displayName:"Scale up duration",min:.001}),yc=yB({serializable:!0,visible:!1}),yh=yB({type:K,displayName:"Bounce and Fall duration",min:.001}),yp=yB({serializable:!0,visible:!1}),yf=yB({type:K,displayName:"Start scale"}),yy=yB({serializable:!0,visible:!1}),yv=yB({type:K,displayName:"End scale"}),yo(yg=yN((yb=st((ym=function(g){ze(u,g);var E,_,k,C,A,T,R,I=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=I.call.apply(I,[this].concat(_)),"shine",yb,Ke(g)),rt(g,"twScaleUpDuration",yw,Ke(g)),rt(g,"twBounceAndFallDuration",yS,Ke(g)),rt(g,"twStartScale",yE,Ke(g)),rt(g,"twEndScale",y_,Ke(g)),g.isBeingAnimated=!1,g}return Ue(u,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(g){this.twScaleUpDuration=g}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(g){this.twBounceAndFallDuration=g}},{key:"startScale",get:function(){return this.twStartScale},set:function(g){this.twStartScale=g}},{key:"endScale",get:function(){return this.twEndScale},set:function(g){this.twEndScale=g}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(eu),this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(R=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0;return[4,this.animateAppear()];case 1:g.sent();return[4,this.animateDisappear()];case 2:g.sent(),this.isBeingAnimated=!1;return[2]}})}),function(){return R.apply(this,arguments)})},{key:"animateAppear",value:(T=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.shineOpacity.opacity=255;return[4,Promise.all([this.animateFadeIn(),this.animateScaleUp()])];case 1:g.sent();return[2]}})}),function(){return T.apply(this,arguments)})},{key:"animateDisappear",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Promise.all([this.animateBounceAndFall(),this.animateScaleDown()])];case 1:g.sent(),this.node.setScale(0,0),this.uiOpacity.opacity=0;return[2]}})}),function(){return A.apply(this,arguments)})},{key:"animateBounceAndFall",value:(C=Be(function(){var g,E,_,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.node.position.x,E=this.node.position.y,_=[60,120],k=(Math.random()*(_[1]-_[0])+_[0])*(Math.PI/180),C=g+200*Math.cos(k),A=E+200*Math.sin(k),T=E-500,R=tZ.runTweenAsync(z(this.node).to(.2*this.twBounceAndFallDuration,{position:new em(C,A,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new em(C,T,this.node.position.z)},{easing:"cubicIn"})),I=[0,360],L=tZ.runTweenAsync(z(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new em(0,0,Math.random()*(I[1]-I[0])*(C>g?-1:1))},{easing:"sineOut"}));return[4,Promise.all([R,L])];case 1:P.sent(),this.node.eulerAngles=new em(0,0,0);return[2]}})}),function(){return C.apply(this,arguments)})},{key:"animateFadeIn",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=Math.max(this.scaleUpDuration/4,.01);return[4,tZ.runTweenAsync(z(this.uiOpacity).to(g,{opacity:255}))];case 1:E.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"animateScaleUp",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.node.setScale(this.startScale,this.startScale);g=new em(this.endScale,this.endScale,1);return[4,tZ.runTweenAsync(z(this.node).to(this.scaleUpDuration,{scale:g},{easing:"cubicOut"}))];case 1:E.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"animateScaleDown",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=new em(0,0,1);return[4,tZ.runTweenAsync(z(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:g},{easing:"cubicIn"}))];case 1:E.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}}]),u}(M)).prototype,"shine",[ys],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yw=st(ym.prototype,"twScaleUpDuration",[yl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(ym.prototype,"scaleUpDuration",[yu],Object.getOwnPropertyDescriptor(ym.prototype,"scaleUpDuration"),ym.prototype),yS=st(ym.prototype,"twBounceAndFallDuration",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(ym.prototype,"bounceAndFallDuration",[yh],Object.getOwnPropertyDescriptor(ym.prototype,"bounceAndFallDuration"),ym.prototype),yE=st(ym.prototype,"twStartScale",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(ym.prototype,"startScale",[yf],Object.getOwnPropertyDescriptor(ym.prototype,"startScale"),ym.prototype),y_=st(ym.prototype,"twEndScale",[yy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),st(ym.prototype,"endScale",[yv],Object.getOwnPropertyDescriptor(ym.prototype,"endScale"),ym.prototype),yg=ym))||yg)||yg);_._RF.pop(),_._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var yD,yF,yU,yx,yz,yG,yV,yK,yH,yq,yW,yj,yX,yY,yJ,yQ,yZ,y$,y0,y1,y2,y4=k.ccclass,y3=k.property,y5=k.disallowMultiple,y6=GameCore.Utils.Array,y8=(yT=y4("StarParticles"),yR=y3({type:[yM],displayName:"Prebuilt Shining stars"}),yT(yI=y5((yP=st((yL=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"shiningStars",yP,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=this.getFirstAvailableShiningStar();if(void 0===E)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");_=et(g,2),k=_[0],C=_[1],A=new em(k,C,this.node.worldPosition.z);E.node.worldPosition=A;return[4,E.playAnimation()];case 1:T.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return y6.search(this.shiningStars,function(g){return g.isAvailable})}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}}]),i}(M)).prototype,"shiningStars",[yR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yI=yL))||yI)||yI);_._RF.pop(),_._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var y9=k.ccclass,y7=k.property,ve=(yD=y9("EffectManager"),yF=y7({group:"Thunder Effect",type:yA}),yU=y7({group:"Mask Effect",type:rh}),yx=y7({group:"Mask Effect",type:C}),yz=y7({group:"Tornado Effect",type:C}),yG=y7({group:"Clear Particle Effect",type:C,displayName:"Particle holder node"}),yV=y7({group:"Clear Particle Effect",type:ya,displayName:"Emitter 1"}),yK=y7({group:"Clear Particle Effect",type:ya,displayName:"Emitter 2"}),yH=y7({group:"Star Particles Effect",type:y8}),yq=y7({group:"Confetti Effect",type:ya}),yD((yX=st((yj=function(g){ze(p,g);var E,_,k,C,A,T,R,I,L,P,O,B=Xe(p);function p(){var g;Fe(this,p);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=B.call.apply(B,[this].concat(_)),"cloud",yX,Ke(g)),rt(g,"backgroundMask",yY,Ke(g)),rt(g,"masks",yJ,Ke(g)),rt(g,"tornado",yQ,Ke(g)),g.bombExplosion=null,g.bombExplosionPool=null,g.defuseExplosion=null,g.defuseExplosionPool=null,rt(g,"clearParticleHolder",yZ,Ke(g)),rt(g,"clearParticle1",y$,Ke(g)),rt(g,"clearParticle2",y0,Ke(g)),rt(g,"starParticle",y1,Ke(g)),rt(g,"confetti",y2,Ke(g)),g.maskTargets=[],g}return Ue(p,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"update",value:function(){var g=this;this.maskTargets.length>0&&this.maskTargets.forEach(function(E,_){E.isHidden()||(g.masks[_].worldPosition=E.node.worldPosition.clone())})}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(r0.GRID_RESIZE,this.handleBoardResize,this)}},{key:"handleBoardResize",value:function(g){this.clearParticleHolder.setScale(g,g)}},{key:"playClearEffectAt",value:function(g){this.clearParticle1.node.setWorldPosition(new em(g[0].x,g[0].y,1)),this.clearParticle2.node.setWorldPosition(new em(g[1].x,g[1].y,1)),this.clearParticle1.play(),this.clearParticle2.play()}},{key:"playStarEffectAt",value:function(g){this.starParticle.fireShiningStarAt(g)}},{key:"playConfettiEffect",value:function(){var g,E=at(this.confetti);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}}},{key:"playTornadoAnimation",value:(O=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=null===(g=this.tornado.getChildByName("Sprite"))||void 0===g?void 0:g.getComponent(G);if(!(null!==(null==E?void 0:E.defaultClip)))return[3,2];this.tornado.active=!0;_=z(this.tornado);_.set({scale:new em(0,0,0)}),_.delay(.5),_.to(.5,{scale:new em(1,1,1)},{easing:"backOut"}),_.delay(.6),_.to(.3,{scale:new em(0,0,0)},{easing:"quadIn"}),_.set({active:!1}),n7.setBlockInput(!0);return[4,tZ.runTweenAsync(_)];case 1:k.sent(),n7.setBlockInput(!1);return[3,3];case 2:console.warn("EffectManager: Tornado animation is not loaded when animation play request was made.");k.label=3;case 3:return[2]}})}),function(){return O.apply(this,arguments)})},{key:"playThunderAnimation",value:(P=Be(function(g,E){var _,k,C,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:this.resetMasks();_=et(g,2),k=et(_[0],2),C=k[0],A=k[1],T=et(_[1],2),R=T[0],I=T[1];this.setMaskProperties(0,C.node.worldPosition,C.node.worldScale),this.setMaskProperties(1,A.node.worldPosition,A.node.worldScale),this.setMaskProperties(2,R.node.worldPosition,R.node.worldScale),this.setMaskProperties(3,I.node.worldPosition,I.node.worldScale),this.maskTargets=[C,A,R,I];return[4,this.setBackgroundMaskActive(!0)];case 1:L.sent(),this.cloud.node.active=!0;return[4,this.cloud.playInitAnimation()];case 2:L.sent();return[4,tZ.waitTweenAsync(.2)];case 3:L.sent();return[4,this.performCloudEffectToTiles(C,A,E)];case 4:L.sent();return[4,this.performCloudEffectToTiles(R,I,E)];case 5:L.sent(),this.cloud.node.active=!1;return[4,this.setBackgroundMaskActive(!1)];case 6:L.sent(),this.maskTargets=[];return[2]}})}),function(g,E){return P.apply(this,arguments)})},{key:"performCloudEffectToTiles",value:(L=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:this.shakeGame(),null===(k=$("Vibrate"))||void 0===k||null===(k=k.getComponent(sR))||void 0===k||k.vibrate(500),i5.playSound(ic.THUNDERBOLT),_.clear([[g,E]],"break");return[4,Promise.all([this.cloud.playLightningAnimation(g.node.worldPosition.clone(),0),this.cloud.playLightningAnimation(E.node.worldPosition.clone(),1),this.cloud.playScaleTween()])];case 1:C.sent(),this.node.scene.emit(r0.ADD_COMBO),this.node.scene.emit(r0.ADD_SCORE);return[2]}})}),function(g,E,_){return L.apply(this,arguments)})},{key:"createDefuseExplosionAt",value:(I=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.loadDefuseExplosionPrefab()];case 1:k.sent(),this.defuseExplosionPool||(this.defuseExplosionPool=new cI(this.createDefuseExplosion.bind(this),1,vt.getBombDefuseExplosion,vt.returnBombDefuseExplosion,vt.destroyBombDefuseExplosion));E=this.defuseExplosionPool.alloc();E.setWorldPosition(g);_=E.getComponent(G);return[4,tZ.runAnimationAsync(_)];case 2:if(k.sent(),!this.defuseExplosionPool)throw new Error("EffectManager: defuseExplosionPool is null");this.defuseExplosionPool.free(E);return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"createBombExplosionAt",value:(R=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.loadBombExplosionPrefab()];case 1:if(k.sent(),this.bombExplosionPool||(this.bombExplosionPool=new cI(this.createBombExplosion.bind(this),1,vn.getBombExplosion,vn.returnBombExplosion,vn.destroyBombExplosion)),!this.bombExplosionPool)return[3,3];E=this.bombExplosionPool.alloc();E.setWorldPosition(g);_=E.getComponent(G);return[4,tZ.runAnimationAsync(_)];case 2:k.sent(),this.bombExplosionPool&&this.bombExplosionPool.free(E);k.label=3;case 3:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(T=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:g&&(this.backgroundMask.node.active=!0);return[4,this.backgroundMask.changeStateFade(g,.25)];case 1:E.sent(),g||(this.backgroundMask.node.active=!1);return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"resetMasks",value:function(){var g,E=at(this.masks);try{for(E.s();!(g=E.n()).done;)g.value.worldPosition=new em(-9999,-9999,0)}catch(g){E.e(g)}finally{E.f()}}},{key:"setMaskProperties",value:function(g,E,_){_&&(this.masks[g].worldScale=_),this.masks[g].worldPosition=E}},{key:"createDefuseExplosion",value:function(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return vt.createDefuseExplosion(this.defuseExplosion,this.node)}},{key:"createBombExplosion",value:function(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return vn.createBombExplosion(this.bombExplosion,this.node)}},{key:"loadBombExplosionPrefab",value:(A=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.bombExplosion)return[2,Promise.resolve()];return[4,n7.loadPrefabAsync(nM.BOMB_EXPLODE_PREFAB)];case 1:g=E.sent();return[2,(g&&(this.bombExplosion=g),Promise.resolve())]}})}),function(){return A.apply(this,arguments)})},{key:"loadDefuseExplosionPrefab",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.defuseExplosion)return[2,Promise.resolve()];return[4,n7.loadPrefabAsync(nM.BOMB_DEFUSE_PREFAB)];case 1:g=E.sent();return[2,(g&&(this.defuseExplosion=g),Promise.resolve())]}})}),function(){return C.apply(this,arguments)})},{key:"loadThunderAnimation",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.cloud.loadAnimation()];case 1:g.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadTornadoAnimation",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=null===(g=this.tornado.getChildByName("Sprite"))||void 0===g?void 0:g.getComponent(G);if(null!==(null==E?void 0:E.defaultClip))return[2,Promise.resolve()];return[4,n7.loadAnimClipAsync(nM.TORNADO_IDLE_ANIM)];case 1:_=k.sent();return[2,(_&&(E.defaultClip=_),Promise.resolve())]}})}),function(){return _.apply(this,arguments)})},{key:"shakeGame",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.node.position.clone(),E=z(this.node).to(.05,{position:g.clone().add3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g.clone().subtract3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g});return[4,tZ.runTweenAsync(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),p}(M)).prototype,"cloud",[yF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yY=st(yj.prototype,"backgroundMask",[yU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yJ=st(yj.prototype,"masks",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yQ=st(yj.prototype,"tornado",[yz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yZ=st(yj.prototype,"clearParticleHolder",[yG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y$=st(yj.prototype,"clearParticle1",[yV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y0=st(yj.prototype,"clearParticle2",[yK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y1=st(yj.prototype,"starParticle",[yH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y2=st(yj.prototype,"confetti",[yq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yW=yj))||yW),vt=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"createDefuseExplosion",value:function(g,E){var _=I(g);return E.addChild(_),_.active=!1,_}},{key:"destroyBombDefuseExplosion",value:function(g){g.destroy()}},{key:"getBombDefuseExplosion",value:function(g){g.active=!0}},{key:"returnBombDefuseExplosion",value:function(g){g.active=!1}}]),e}(),vn=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"createBombExplosion",value:function(g,E){var _=I(g);return E.addChild(_),_.active=!1,_}},{key:"destroyBombExplosion",value:function(g){g.destroy()}},{key:"getBombExplosion",value:function(g){g.active=!0}},{key:"returnBombExplosion",value:function(g){g.active=!1}}]),e}();_._RF.pop(),_._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);var vi=GameCore,vr=vi.Configs,va=vi.Plugins.Ads,vo=va.Types,vs=va.Status,vl=vi.Utils.Array,vu=globalThis.game.ads,vc=function(){function e(){Fe(this,e),this.isAvoidBannerShowed=!1}var g,E,_,k;return Ue(e,[{key:"canbeShowInSDK",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:[],k=arguments.length>1&&void 0!==E?E:[],C=GameSDK.getSDKName();return(null==k||!k.length||!vl.has(k,C))&&!(null!=_&&_.length&&!vl.has(_,C))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"preloadAds",value:(k=Be(function(){var g,E,_,k,C,A,T,R;return _ts_generator(this,function(I){g=vr.Ads,E=g.Enabled,_=g.InterstitialAdOptions,k=g.RewardedVideoAdOptions,C=g.RewardedInterstitialAdOptions;if(E){A=vo.INTERSTITIAL,T=vo.REWARDED_VIDEO,R=vo.REWARDED_INTERSTITIAL;_.forEach(function(g){var E=g.PlacementId;vu.loadAdAsync(A,E).catch(function(){})}),k.forEach(function(g){var E=g.PlacementId;vu.loadAdAsync(T,E).catch(function(){})}),C.forEach(function(g){var E=g.PlacementId;vu.loadAdAsync(R,E).catch(function(){})})}return[2]})}),function(){return k.apply(this,arguments)})},{key:"setAvoidBannerShowed",value:function(g){this._instance.isAvoidBannerShowed=g}},{key:"showBannerAds",value:function(){var g=this,E=vr.Ads,_=E.Enabled,k=E.BannerDisplayAdOptions;if(_&&!this.inst.isAvoidBannerShowed){var C=eb.instance.getVisibleSize(),A=ns.worldSizeToCssSize(C.height*sI);k.forEach(function(E){var _=E.PlacementId,k=E.Position,C=E.BannerHeight;"bottom"===k&&C>A||g.showBannerAd(_)})}}},{key:"hideBannerAds",value:function(){var g=this,E=vr.Ads,_=E.Enabled,k=E.BannerDisplayAdOptions;_&&k.forEach(function(E){var _=E.PlacementId;g.hideBannerAd(_)})}},{key:"showBannerAd",value:function(g){this.inst.isAvoidBannerShowed||vu.showBannerAdAsync(g).catch(function(g){})}},{key:"hideBannerAd",value:function(g){vu.hideBannerAdAsync(g).catch(function(g){})}},{key:"canShowInterstitialAd",value:function(){var g=vu.getAdStatus(vo.INTERSTITIAL)===vs.FILLED;return vu.canbeShowInterstitialAd()&&g}},{key:"canShowRewardedVideoAd",value:function(){return vu.getAdStatus(vo.REWARDED_VIDEO)===vs.FILLED}},{key:"canShowRewardedInterstitialAd",value:function(){return vu.getAdStatus(vo.REWARDED_INTERSTITIAL)===vs.FILLED}},{key:"showInterstitialAdAsync",value:(_=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:E=g.forLevel,_=g.includeSDK,k=g.excludeSDK;if(!this.inst.canbeShowInSDK(_,k))return[2,!1];if(E&&vr.Gameplay.StartAdAtLevel>=E)return[2,!1];if(!vu.canbeShowInterstitialAd())return[2,!1];C=i5.getVolumeMusic();R.label=1;case 1:R.trys.push([1,4,5,6]);i5.muteSound(!0),i5.setVolumeMusic(0,!0);A=vu.getAdStatus(vo.INTERSTITIAL)===vs.FILLED;if(!A)return[3,3];return[4,vu.showAdAsync(vo.INTERSTITIAL)];case 2:A=R.sent();R.label=3;case 3:return[2,!0];case 4:T=R.sent();return[2,(console.warn("showInterstitialAdAsync failed",T),!1)];case 5:Q.resume(),i5.muteAudio(!1),i5.setVolumeMusic(C,!0),vu.loadAdAsync(vo.INTERSTITIAL).catch(function(){});return[7];case 6:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"showRewardVideoAdAsync",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=g.includeSDK,_=g.excludeSDK;if(!this.inst.canbeShowInSDK(E,_))return[2,!1];k=i5.getVolumeMusic();T.label=1;case 1:T.trys.push([1,5,6,7]);i5.muteSound(!0),i5.setVolumeMusic(0,!0),l1.showLoadingScreen();C=vu.getAdStatus(vo.REWARDED_VIDEO)!==vs.FILLED;if(!C)return[3,3];return[4,vu.loadAdAsync(vo.REWARDED_VIDEO)];case 2:C=T.sent();T.label=3;case 3:return[4,vu.showAdAsync(vo.REWARDED_VIDEO)];case 4:return[2,(T.sent(),!0)];case 5:A=T.sent();return[2,(console.warn("showRewardVideoAdAsync failed",A),_instanceof(A,Object)&&"code"in A&&"USER_INPUT"===A.code?l1.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2):l1.showNotificationScreen("No ads to display.",2),!1)];case 6:Q.resume(),l1.closeLoadingScreen(),i5.muteAudio(!1),i5.setVolumeMusic(k,!0),vu.loadAdAsync(vo.REWARDED_VIDEO).catch(function(){});return[7];case 7:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"showRewardedInterstitialAdAsync",value:(g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=g.includeSDK,_=g.excludeSDK;if(!this.inst.canbeShowInSDK(E,_))return[2,!1];k=i5.getVolumeMusic();T.label=1;case 1:T.trys.push([1,5,6,7]);i5.muteSound(!0),i5.setVolumeMusic(0,!0),l1.showLoadingScreen();C=vu.getAdStatus(vo.REWARDED_INTERSTITIAL)!==vs.FILLED;if(!C)return[3,3];return[4,vu.loadAdAsync(vo.REWARDED_INTERSTITIAL)];case 2:C=T.sent();T.label=3;case 3:return[4,vu.showAdAsync(vo.REWARDED_INTERSTITIAL)];case 4:return[2,(T.sent(),!0)];case 5:A=T.sent();return[2,(console.warn("showRewardedInterstitialAdAsync failed",A),!1)];case 6:Q.resume(),l1.closeLoadingScreen(),i5.muteAudio(!1),i5.setVolumeMusic(k,!0),vu.loadAdAsync(vo.REWARDED_INTERSTITIAL).catch(function(){});return[7];case 7:return[2]}})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var vh="newbie",vp="timer",vf="combo",vy="hint-item",vv="thunder-item",vg="storm-item",vm="pliers-item";_._RF.pop(),_._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var vb=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(r0.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(r0.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.on(r0.GRID_RESIZE,this.handleViewResized,this),this.manager.guideSkipButton.active=!0,this.showStep(this.currentStep),this.manager.node.scene.emit(r0.HIDE_UI)}},{key:"showNextStep",value:function(){this.currentStep+1<u0.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(E=Be(function(g){var E,_,k,C,A,T,R,I,L,P,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:E=this.gameplay,_=E.board,k=E.effectManager,C=u0[g].startTile,A=u0[g].endTile,T=_.getTileAt(C.x,C.y),R=_.getTileAt(A.x,A.y);if(!(T&&R))return[3,3];I=T.node.worldPosition,L=R.node.worldPosition;k.resetMasks(),k.setMaskProperties(0,I,T.node.worldScale),k.setMaskProperties(1,L,R.node.worldScale),k.setBackgroundMaskActive(!0);P=this.manager,O=P.guideHand,B=P.guideTextBox;O.node.active=!0,O.playHandAnimation(I,L),this.alignGuideTextBox(),this.alignSkipButton();return[4,B.hide()];case 1:N.sent(),B.setText(u0[g].description);return[4,B.show()];case 2:N.sent(),_.setIgnoreInput(!0),T.setIgnoreInput(!1),R.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1);N.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.gameplay,E=g.board,_=g.effectManager,k=u0[this.currentStep].startTile,C=u0[this.currentStep].endTile,A=E.getTileAt(k.x,k.y),T=E.getTileAt(C.x,C.y);if(A&&T){var R=A.node.worldPosition,I=T.node.worldPosition;_.setMaskProperties(0,R,A.node.worldScale),_.setMaskProperties(1,I,T.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}}},{key:"alignGuideTextBox",value:function(){var g=this.gameplay.board,E=this.manager.guideTextBox,_=g.getTileAt(0,0);if(_){var k=g.tilesHolder.getWorldScale(),C=g.getTileSize()[1]*k.y,A=_.node.worldPosition.y-C/2,T=E.widget.bottom+(A-E.widget.bottom)/2;E.node.setWorldPosition(E.node.worldPosition.x,T,0);var R=Math.max(Math.min(223,.85*(A-E.widget.bottom)),10),I=.7261538461538461*k.x;E.uiTransform.setContentSize(628*I,R)}}},{key:"alignSkipButton",value:function(){var g=this.gameplay.board,E=this.manager.guideSkipButton;if(E){var _=E.parent;if(_){var k=g.getTileAt(g.getGridSize()[0]-1,g.getGridSize()[1]-1);if(k){var C=g.tilesHolder.getWorldScale(),A=g.getTileSize()[1]*C.y,T=k.node.worldPosition.clone().add3f(A/2,A/2,0),I=ns.cssSizeToWorldSize(ns.getScreenHeightCss()),L=T.x-_.getComponent(R).width/2,P=Math.min(T.y+100,I-(I-T.y)/2);_.setWorldPosition(L,P,0)}}}}},{key:"close",value:(g=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=this.gameplay,E=g.board,_=g.effectManager;this.manager.node.scene.off(r0.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(r0.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.off(r0.GRID_RESIZE,this.handleViewResized,this),E.setIgnoreInput(!1);k=Promise.all;return[4,this.manager.guideTextBox.hide()];case 1:C=[A.sent()];return[4,_.setBackgroundMaskActive(!1)];case 2:return[4,k.apply(Promise,[C.concat([A.sent()])])];case 3:A.sent(),this.manager.guideHand.node.active=!1,this.manager.completeGuide(vh);return[2]}})}),function(){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var vw=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.clock,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5;return[4,this.gameplay.handleShowUI()];case 1:L.sent(),E.node.active=!0,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.active=!0,_.string="Remove all tiles before\nthe time end",_.node.setWorldPosition(I.x,I.y-T/2-50,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 2:L.sent(),this.manager.node.scene.once(r0.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r0.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.clock,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.setWorldPosition(I.x,I.y-T/2-50,0)}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideInfoText,_=g.guideMasks;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(r0.RESUME_TIME);return[4,_.hide()];case 1:k.sent(),E.node.active=!1,this.manager.completeGuide(vp),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var vS=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.comboContainer,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.node.active=!0,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.active=!0,_.string="Remove tiles continuously\nto increase combo!",_.node.setWorldPosition(I.x-A/2-10,I.y,0),_.horizontalAlign=ez.RIGHT,_.getComponent(R).setAnchorPoint(1,.5);return[4,E.show()];case 1:L.sent(),this.manager.node.scene.once(r0.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r0.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.comboContainer,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.setWorldPosition(I.x-A/2-10,I.y,0)}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideInfoText,_=g.guideMasks;this.manager.node.scene.emit(r0.RESUME_TIME),_.node.off(C.EventType.TOUCH_START,this.close,this);return[4,_.hide()];case 1:k.sent(),E.node.active=!1,this.manager.completeGuide(vf),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var vE=GameCore.Utils.Array,v_=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vE.search(this.gameplay.itemManager.items,function(g){return g.itemType===sP.HINT});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to reveal a connectable pair",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:L.sent(),this.manager.node.scene.once(r0.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r0.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);L.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vE.search(this.gameplay.itemManager.items,function(g){return g.itemType===sP.HINT});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(r0.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vy),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var vk=GameCore.Utils.Array,vC=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vk.search(this.gameplay.itemManager.items,function(g){return g.itemType===sP.THUNDER});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to remove 2 pairs",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:L.sent(),this.manager.node.scene.once(r0.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r0.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);L.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vk.search(this.gameplay.itemManager.items,function(g){return g.itemType===sP.THUNDER});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(r0.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vv),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var vA=GameCore.Utils.Array,vT=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vA.search(this.gameplay.itemManager.items,function(g){return g.itemType===sP.STORM});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to rearrange the tiles",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:L.sent(),this.manager.node.scene.once(r0.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r0.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);L.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vA.search(this.gameplay.itemManager.items,function(g){return g.itemType===sP.STORM});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(r0.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vg),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var vR,vI,vL,vP,vO,vB,vN,vM,vD,vF=GameCore.Utils.Array,vU=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vF.search(this.gameplay.itemManager.items,function(g){return g.itemType===sP.PLIERS});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to remove bomb",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=ez.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:L.sent(),this.manager.node.scene.once(r0.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(r0.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);L.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vF.search(this.gameplay.itemManager.items,function(g){return g.itemType===sP.PLIERS});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(r0.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vm),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var vx,vz,vG,vV,vK,vH,vq,vW=k.ccclass,vj=k.property,vX=(vR=vW("GuideHand"),vI=vj(C),vL=vj(C),vP=vj(eu),vR((vN=st((vB=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"hand",vN,Ke(g)),rt(g,"circleHighlight",vM,Ke(g)),rt(g,"circleHighlightOpacity",vD,Ke(g)),g}return Ue(n,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(g,E){var _=this;this.handTween&&this.handTween.stop();var k=z(this.hand).to(.8,{worldPosition:E},{easing:"quartOut"}).to(.2,{scale:new em(.9,.9,.9),angle:15}).call(function(){_.playHighlightAnimation()}).to(.2,{scale:em.ONE,angle:0}).to(.8,{worldPosition:g},{easing:"quartOut"}).to(.2,{scale:new em(.9,.9,.9),angle:15}).call(function(){_.playHighlightAnimation()}).to(.2,{scale:em.ONE,angle:0});this.handTween=z(this.hand).repeatForever(k).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),z(this.circleHighlight).to(.6,{scale:new em(1.5,1.5)},{easing:"quadOut"}).start(),z(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(M)).prototype,"hand",[vI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vM=st(vB.prototype,"circleHighlight",[vL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vD=st(vB.prototype,"circleHighlightOpacity",[vP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vO=vB))||vO);_._RF.pop(),_._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var vY,vJ,vQ,vZ,v$,v0,v1=k.ccclass,v2=k.property,v4=(vx=v1("GameMask"),vz=v2(R),vG=v2(eo),vx((vH=st((vK=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"uiTransform",vH,Ke(g)),rt(g,"sprite",vq,Ke(g)),g}return Ue(n,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),n}(M)).prototype,"uiTransform",[vz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vq=st(vK.prototype,"sprite",[vG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vV=vK))||vV);_._RF.pop(),_._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var v3,v5,v6,v8,v9,v7,ge,gt=k.ccclass,gn=k.property,gi=k.executeInEditMode,gr=(vY=gt("AlphaMasks"),vJ=gi(!0),vQ=gn(v4),vY(vZ=vJ((v0=st((v$=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"masks",v0,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent(R)}},{key:"start",value:function(){this.material=this.getComponent(eo).getMaterialInstance(0)}},{key:"update",value:function(){var g=this,E=this.UITransform,_=E.width,k=E.height;this.masks.forEach(function(E,C){var A=E.uiTransform,T=A.width,R=A.height,I=A.anchorX,L=A.anchorY,P=T*E.node.scale.x,O=R*E.node.scale.y,B=new eS(P/_,O/k),N=new eS(.5+(.5-I)*B.x,.5-(.5-L)*B.y),M=new eS(N.x+(E.node.worldPosition.x-g.node.worldPosition.x)/_,N.y-(E.node.worldPosition.y-g.node.worldPosition.y)/k);g.material.setProperty("mask".concat(C,"Texture"),E.texture),g.material.setProperty("ratio".concat(C),B),g.material.setProperty("center".concat(C),M)})}},{key:"setMaskActive",value:function(g,E){g>=this.masks.length||this.material.setProperty("useMask".concat(g),E?1:0)}}]),n}(M)).prototype,"masks",[vQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vZ=v$))||vZ)||vZ);_._RF.pop(),_._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var ga,go,gs,gl,gu,gc,gh,gp=k.ccclass,gf=k.property,gy=(v3=gp("GuideMasks"),v5=gf(rh),v6=gf(gr),v3((v7=st((v9=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background",v7,Ke(g)),rt(g,"alphaMasks",ge,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:g.sent(),this.background.node.active=!1;return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(r0.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(g,E,_,k){this.alphaMasks.masks[1].node.worldPosition=new em(-9999,-9999,0);var C=this.alphaMasks.masks[0];this.setMaskTransform(C,g,E,_,k)}},{key:"setItemMaskTransform",value:function(g,E,_,k){this.alphaMasks.masks[0].node.worldPosition=new em(-9999,-9999,0);var C=this.alphaMasks.masks[1];this.setMaskTransform(C,g,E,_,k)}},{key:"setMaskTransform",value:function(g,E,_,k,C){g.uiTransform.setContentSize(k,C),g.node.setWorldPosition(E,_,0)}}]),a}(M)).prototype,"background",[v5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ge=st(v9.prototype,"alphaMasks",[v6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v8=v9))||v8);_._RF.pop(),_._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var gv,gg,gm,gb,gw,gS,gE,g_,gk,gC,gA,gT,gR,gI=k.ccclass,gL=k.property,gP=(ga=gI("GuideTextBox"),go=gL(L),gs=gL(H),ga((gc=st((gu=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"guideText",gc,Ke(g)),rt(g,"widget",gh,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.opacityToggler=this.getComponent(rh),nk.lazyValidateProperties(this)}},{key:"setText",value:function(g){this.guideText.string=g}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.opacityToggler.changeStateFade(!0)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.opacityToggler.changeStateFade(!1)];case 1:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"guideText",[go],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gh=st(gu.prototype,"widget",[gs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gl=gu))||gl);_._RF.pop(),_._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var gO,gB,gN,gM,gD,gF,gU,gx,gz,gG,gV,gK,gH,gq,gW,gj,gX,gY,gJ,gQ=game,gZ=gQ.player,g$=gQ.analytics,g0=k.ccclass,g1=k.property,g2=GameCore,g4=g2.Match.Modes,g3=g2.Plugins.Analytics.Events,g5=g2.Utils.Array,g6=new eS(0,10),g8=new eS(0,10),g9="READY",g7="RUNNING",me=(gv=g0("GuidelinesManager"),gg=g1(vX),gm=g1(gP),gb=g1(L),gw=g1(gy),gS=g1(C),gv((gk=st((g_=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"guideHand",gk,Ke(g)),rt(g,"guideTextBox",gC,Ke(g)),rt(g,"guideInfoText",gA,Ke(g)),rt(g,"guideMasks",gT,Ke(g)),rt(g,"guideSkipButton",gR,Ke(g)),g.guideHintDelay=null,g.guideStormDelay=null,g}return Ue(i,[{key:"init",value:function(g){this.gameplay=g,this.status=g9,this.node.scene.on(r0.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(r0.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(r0.USE_ITEM,this.handleUseItem,this),this.node.scene.on(r0.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(r0.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(r0.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(vh)&&this.resetGuideItemShowed(),this.startGuide(vh)):this.startGuide(vp)}},{key:"startGuide",value:function(g){if(this.status===g7)return!1;if(this.hasGuideItemShowed(g))return!1;switch(this.addGuideItemShowed(g),this.status=g7,g){case vh:g$.event(g3.TUTORIAL_BEGIN),this.guide1=new vb(this),this.guide1.setup();break;case vp:this.guide2=new vw(this),this.guide2.setup();break;case vf:this.guide3=new vS(this),this.guide3.setup();break;case vy:this.guide4=new v_(this),this.guide4.setup();break;case vv:this.guide5=new vC(this),this.guide5.setup();break;case vg:this.guide6=new vT(this),this.guide6.setup();break;case vm:this.guide7=new vU(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(g){g$.event(g3.TUTORIAL_STEP,{step:g}),this.status=g9,this.addGuideItemShowed(g),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){var g=this.getCurrentLevel(),E=g6.x,_=g6.y;return g>=E&&g<=_}},{key:"isShowErrorPathLevel",value:function(){if(l_.getMatchMode()===g4.TOURNAMENT)return!1;var g=this.getCurrentLevel(),E=g8.x,_=g8.y;return g>=E&&g<=_}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(g){return g5.has(this.getGuideItemShowed(),g)}},{key:"addGuideItemShowed",value:function(g){if(!this.hasGuideItemShowed(g)){var E=this.getGuideItemShowed();E.push(g),gZ.setGameData({guideItemShowed:E})}}},{key:"resetGuideItemShowed",value:function(){gZ.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var g,E;return null!==(g=null===(E=gZ.getGameData())||void 0===E?void 0:E.guideItemShowed)&&void 0!==g?g:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(g){this.isNewbieGuideLevel()||g<2||(this.startGuide(vf),this.node.scene.off(r0.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var g=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=z(this.node).delay(5).call(function(){g.isNewbieGuideLevel()||(g.hasGuideItemShowed(vy)&&g.status===g9?g.node.scene.emit(r0.SHOW_HINT):g.startGuide(vy),g.startHintGuide())})),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var g=this;null===this.guideStormDelay&&(this.guideStormDelay=new eG(this.node).delay(10).call(function(){if(!g.isNewbieGuideLevel()&&!g.hasGuideItemShowed(vg)){var E=g5.search(g.gameplay.itemManager.items,function(g){return g.itemType===sP.STORM});E&&E.canActivate()&&(g.startGuide(vg)||g.startStormGuide())}})),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(vv)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(vm)}},{key:"handleUseItem",value:function(g){switch(this.startAutoGuides(),g){case sP.HINT:this.addGuideItemShowed(vy);break;case sP.THUNDER:this.addGuideItemShowed(vv);break;case sP.STORM:this.addGuideItemShowed(vg);break;case sP.PLIERS:this.addGuideItemShowed(vm)}}},{key:"skipNewbieGuide",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.guideSkipButton.active=!1;return[4,this.guide1.close()];case 1:E.sent();g=this.getCurrentLevel()+1;gZ.setGameData({level:g}),this.node.scene.emit(r0.NEXT_LEVEL),vc.showBannerAds();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onDestroy",value:function(){var g,E,_,k,C,A;null===(g=this.guide2)||void 0===g||g.unlistenEvents(),null===(E=this.guide3)||void 0===E||E.unlistenEvents(),null===(_=this.guide4)||void 0===_||_.unlistenEvents(),null===(k=this.guide5)||void 0===k||k.unlistenEvents(),null===(C=this.guide6)||void 0===C||C.unlistenEvents(),null===(A=this.guide7)||void 0===A||A.unlistenEvents()}}]),i}(M)).prototype,"guideHand",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gC=st(g_.prototype,"guideTextBox",[gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gA=st(g_.prototype,"guideInfoText",[gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gT=st(g_.prototype,"guideMasks",[gw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gR=st(g_.prototype,"guideSkipButton",[gS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gE=g_))||gE);_._RF.pop(),_._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var mt,mn=k.ccclass,mi=k.property,mr=(gO=mn("SpecialItem"),gB=mi({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),gN=mi({type:B,tooltip:"The button that activates the item"}),gM=mi({type:V,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),gD=mi({type:L,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),gF=mi({type:C,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),gU=mi({type:C,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),gx=mi({type:eu,group:"Animation"}),gz=mi({type:eu,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),gO((gK=st((gV=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"isDevButton",gK,Ke(g)),rt(g,"button",gH,Ke(g)),rt(g,"quantity",gq,Ke(g)),rt(g,"quantityLabel",gW,Ke(g)),rt(g,"quantityNode",gj,Ke(g)),rt(g,"plusNode",gX,Ke(g)),rt(g,"glowUIOpacity",gY,Ke(g)),rt(g,"uiOpacity",gJ,Ke(g)),g.requestItem=null,g.loadQuantity=null,g}return Ue(o,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"init",value:function(g){var E=this;this.node.scene.on(r0.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(r0.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(r0.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(r0.GRID_SPAWN,this.applyActivationStatus,this),this.node.scene.on(r0.BOMB_EXPLODE,this.applyActivationStatus,this),this.node.scene.on(r0.IDLE_EXIT,function(){E.button.interactable=!1,E.applyActivationStatus()}),this.node.scene.on(r0.IDLE_ENTER,function(){E.button.interactable=!0,E.applyActivationStatus()})}},{key:"start",value:function(){var g=this.loadQuantity();this.setQuantity(g)}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"applyActivationStatus",value:(k=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:null===(g=this.signal)||void 0===g||g.abort();E=new nN;this.signal=E;_=this.canActivate();this.button.interactable=_;return[4,tZ.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:_?255:128}),E)];case 1:k.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"activate",value:(_=Be(function(){return _ts_generator(this,function(g){this.quantity<=0?this.requestItem():(this.vibrate(),this.setQuantity(this.quantity-1));return[2]})}),function(){return _.apply(this,arguments)})},{key:"canActivate",value:function(){return!1}},{key:"setQuantity",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=g;if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();k=Math.max(0,k),this.quantity=k,this.quantityLabel.string="".concat(this.quantity),k<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),_&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}},{key:"getQuantity",value:function(){return this.quantity}},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;this.isDevButton||k&&this.setQuantity(_,k.animate)}},{key:"vibrate",value:function(){var g;null===(g=$("Vibrate"))||void 0===g||null===(g=g.getComponent(sR))||void 0===g||g.vibrate(50)}},{key:"animateAddItem",value:(E=Be(function(){return _ts_generator(this,function(g){return[2,(this.glowUIOpacity.opacity=0,Promise.all([tZ.runTweenAsync(z(this.node).to(.1,{scale:new em(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:em.ONE},{easing:"elasticOut"})),tZ.runTweenAsync(z(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))]))]})}),function(){return E.apply(this,arguments)})}]),o}(M)).prototype,"isDevButton",[gB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gH=st(gV.prototype,"button",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gq=st(gV.prototype,"quantity",[gM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gW=st(gV.prototype,"quantityLabel",[gD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gj=st(gV.prototype,"quantityNode",[gF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gX=st(gV.prototype,"plusNode",[gU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gY=st(gV.prototype,"glowUIOpacity",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gJ=st(gV.prototype,"uiOpacity",[gz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gG=gV))||gG);_._RF.pop(),_._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var ma,mo=(0,k.ccclass)("ItemManager")(mt=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).sceneItems=new Set,g}return Ue(n,[{key:"items",get:function(){return tt(this.sceneItems)}},{key:"onLoad",value:function(){this.syncItems()}},{key:"syncItems",value:function(){var g=$("Canvas/UI");if(g){var E,_=at(g.getComponentsInChildren(mr));try{for(_.s();!(E=_.n()).done;){var k=E.value;k.node.activeInHierarchy&&this.sceneItems.add(k)}}catch(g){_.e(g)}finally{_.f()}}}}]),n}(M))||mt;_._RF.pop(),_._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var ms,ml=k.ccclass,mu=GameCore.Utils,mc=mu.Device,mh=mu.Array,mp=globalThis.game.monitorError,mf={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},my=ml("LevelManager")(ma=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){return Fe(this,r),A.apply(this,arguments)}return Ue(r,[{key:"loadLevel",value:(C=Be(function(){var g,E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:g=T.length>0&&void 0!==T[0]?T[0]:1,E=T.length>1?T[1]:void 0;return[4,this.loadLevelData(g)];case 1:_=R.sent();this.levelData=_||this.levelData||mf;k=this.levelData,C=k.rows,A=k.columns;return[2,(mc.isMobile()&&A>=6&&C>=10&&(this.levelData.columns=5,this.levelData.rows=10),null==mp||mp.addMetadata({level:g}),this.getLevelSpriteFrames(g,E))]}})}),function(){return C.apply(this,arguments)})},{key:"loadLevelData",value:(k=Be(function(){var g,E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:g=A.length>0&&void 0!==A[0]?A[0]:1,E=10,_=this.paddingZero("".concat(Math.floor(g/E)+1),3),k=g%E;return[4,n7.loadJsonAsync("".concat(nM.LEVEL_DATA_FOLDER,"/").concat(_))];case 1:C=T.sent();return[2,C?C[k]:null]}})}),function(){return k.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"getLevelSpriteFrames",value:(_=Be(function(g,E){var _,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:if(!(E&&X.random()<=.5))return[3,2];_=ll.getThemeSkins(E),k=_[X.randomRangeInt(0,_.length)];return[4,this.loadSkinFrames(k)];case 1:return[2,I.sent()];case 2:C=ll.getLevelSkins(g);if(!(C.length>1))return[3,4];return[4,this.loadSkinFrames(C)];case 3:return[2,I.sent()];case 4:A=C[0],T=ll.getUnlockedSkins();if(T.length>1&&X.random()<=.5){R=T.filter(function(g){return g!==A});A=R[X.randomRangeInt(0,R.length)]}return[4,this.loadSkinFrames(A)];case 5:return[2,I.sent()]}})}),function(g,E){return _.apply(this,arguments)})},{key:"loadSkinFrames",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!Array.isArray(g))return[3,2];E=g.map(function(){var g=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E="".concat(nM.TILE_SKIN_FOLDER,"/").concat(g);return[4,n7.loadSpriteFramesDirAsync(E)];case 1:return[2,_.sent()]}})});return function(E){return g.apply(this,arguments)}}());_=mh.flatten;return[4,Promise.all(E)];case 1:return[2,_.apply(mh,[C.sent()])];case 2:k="".concat(nM.TILE_SKIN_FOLDER,"/").concat(g);return[4,n7.loadSpriteFramesDirAsync(k)];case 3:return[2,C.sent()]}})}),function(g){return E.apply(this,arguments)})},{key:"paddingZero",value:function(g,E){for(var _="",k=0;k<E-g.length;k++)_+="0";return _+g}}]),r}(M))||ma;_._RF.pop(),_._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var mv=k.ccclass,mg=GameCore.Match.Modes,mm=mv("ScoreManager")(ms=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).currentScore=0,g.tournamentStartScore=0,g}return Ue(i,[{key:"addScore",value:function(g,E,_){var k=this.getLevelMultiplier(g),C=this.getComboMultiplier(E),A=this.getTimeMultiplier(g,_),T=Math.floor(this.currentScore+10*k*C*A),R=10*Math.ceil(T/10);this.setScore(R)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var g=l_.getMatchMode();this.currentScore=g===mg.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(g){this.currentScore=g,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"resetTournamentStartScore",value:function(){this.tournamentStartScore=0}},{key:"updateScore",value:(E=Be(function(){return _ts_generator(this,function(g){this.node.scene.emit(r0.SCORE_UPDATED,this.currentScore);return[2]})}),function(){return E.apply(this,arguments)})},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(g){return 1+.1*(g-1)}},{key:"getComboMultiplier",value:function(g){return 1+.1*(g-1)}},{key:"getTimeMultiplier",value:function(g,E){return g<=2?4:1+.05*E}}]),i}(M))||ms;_._RF.pop(),_._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var mb=function(){function e(g){Fe(this,e),this.game=null,this.data={},this.game=g.getGameplay(),this.manager=g,this.updateStateData(),this.logDebug()}return Ue(e,[{key:"logDebug",value:function(){var g=this.constructor.name;console.info("[STATE] ".concat(g),this.data)}},{key:"updateStateData",value:function(){if(this.game){var g=this.game.getGameData();g&&(this.data=g)}}},{key:"updateGameData",value:function(g){var E;null===(E=this.game)||void 0===E||E.setGameData(g)}}]),e}();_._RF.pop(),_._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var mw=globalThis.game,mS=mw.analytics,mE=mw.match,m_=mw.storage,mk=GameCore,mC=mk.Match.Modes,mA=mk.Dtos.Match.Data,mT=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(g,E){var _;return Fe(this,r),_=A.call(this,g),i5.stopAllSounds(),_.vibrateDevice(),_.pauseCountdown(),_.updateMatchCustomData(),_.handleGameOver(E),_.logLevelFailAnalytics(),_}return Ue(r,[{key:"pauseCountdown",value:function(){var g;null===(g=this.game)||void 0===g||g.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var g;null===(g=$("Vibrate"))||void 0===g||null===(g=g.getComponent(sR))||void 0===g||g.vibrate(500)}},{key:"handleGameOver",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=l_.getMatchMode();if(n7.setBlockInput(!0),E===mC.SINGLE)return[3,5];if(E!==mC.TOURNAMENT)return[3,2];return[4,this.handleTournamentGameOver()];case 1:_.sent();return[3,4];case 2:if(E!==mC.CHALLENGE_FRIEND)return[2,void this.showFailScreen(g)];return[4,this.handleChallengeGameOver()];case 3:_.sent();_.label=4;case 4:n7.setBlockInput(!1);return[3,6];case 5:this.showFailScreen(g);_.label=6;case 6:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(k=Be(function(){var g,E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=this;if(!this.game)return[3,5];k=(null!==(g=l_.getMatchCustomData())&&void 0!==g?g:{}).tournamentId;if(!k)return[3,5];if(ut.validateTournamentExpired(k))return[2,(m_.setStorageData("tournament","animateTournamentLeader",!1),l1.showNotificationScreen("Tournament has ended",2),void(null===(C=this.game)||void 0===C||C.scheduleOnce(function(){var g;null===(g=_.game)||void 0===g||g.node.scene.emit(r0.GAME_EXIT)},2)))];I.label=1;case 1:I.trys.push([1,3,,4]);A=m_.getStorageData("tournament","previousScore"),T=this.game.scoreManager.getCurrentScore()>A;m_.setStorageData("tournament","animateTournamentLeader",T);return[4,l_.finishMatchAsync()];case 2:I.sent();return[3,4];case 3:R=I.sent();console.warn(R);return[3,4];case 4:null===(E=this.game)||void 0===E||E.node.scene.emit(r0.GAME_EXIT);I.label=5;case 5:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.game)return[3,6];C.label=1;case 1:C.trys.push([1,4,,5]);g=mE.getMatchState().id;return[4,mE.api.getMatchAPI().getMatchDetailByIdAsync(g)];case 2:E=C.sent(),_=new mA(E).toObject().extraData;return[4,l_.finishMatchAsync({extraData:null!=_?_:void 0})];case 3:C.sent();return[3,5];case 4:k=C.sent();console.warn(k);return[3,5];case 5:this.game.node.scene.emit(r0.SHOW_CHALLENGE_RESULTS);C.label=6;case 6:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"showFailScreen",value:(E=Be(function(g){var E;return _ts_generator(this,function(_){E=this.data.level;g===ui&&i5.playSound(ic.LEVEL_FAIL_TIMEOUT),i5.playSound(ic.LEVEL_FAIL),l1.openScreen(ig.RESCUES_SCREEN,{level:E,failKey:g});return[2]})}),function(g){return E.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var g;if(this.game){var E=this.data.level,_=void 0===E?1:E,k=null===(g=this.game)||void 0===g?void 0:g.scoreManager.getCurrentScore();l_.updateMatchStateAfterLevelFinish(_,k)}}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=this.game.scoreManager.getCurrentScore(),k=l_.getMatchMode()||void 0;mS.levelFail(E,_,k)}}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var g=this.manager.createPlayingState(this.manager);this.manager.change(g)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}},{key:"update",value:function(){}}]),r}(mb);_._RF.pop(),_._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var mR=globalThis.game,mI=mR.analytics,mL=mR.player,mP=mR.leaderboard,mO=mR.match,mB=GameCore,mN=mB.Match.Modes,mM=mB.Utils.Time,mD=function(g){ze(u,g);var E,_,k,C,A,T,R,I=Xe(u);function u(g){var E;return Fe(this,u),(E=I.call(this,g)).handleFinishStateFlow(),E}return Ue(u,[{key:"handleFinishStateFlow",value:(R=Be(function(){var g;return _ts_generator(this,function(E){if(this.game){this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),this.game.uiManager.pauseTime();g=l_.getMatchMode();g!==mN.CHALLENGE_FRIEND&&g!==mN.TOURNAMENT&&this.updatePlayerProgress(),this.updateMatchCustomData(),g===mN.CHALLENGE_FRIEND?this.handleFinishChallenge():g===mN.TOURNAMENT?this.handleFinishTournament():this.handleFinishSingle(),this.logLevelCompleteAnalytics()}return[2]})}),function(){return R.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"attemptCallCreateShortcut",value:function(){var g=this.data.level;(void 0===g?0:g)<2||vc.canShowInterstitialAd()||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(g){console.warn("createShortcutAsync",g)})}},{key:"updatePlayerProgress",value:function(){if(this.game){var g=this.data.level;if(g){var E=g+1,_=mL.getGameData();if(_){var k=_.totalLevel,C=_.level,A=Math.max(C,E),T=Me({},_);A<k&&(T.level=A),mL.setGameData(T)}}}}},{key:"updateMatchCustomData",value:function(){if(this.game){var g=this.data.level,E=void 0===g?1:g,_=this.game.scoreManager.getCurrentScore();l_.updateMatchStateAfterLevelFinish(E,_)}}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=this.game.scoreManager.getCurrentScore(),k=l_.getMatchMode()||void 0;mI.levelComplete(E,_,k)}}},{key:"handleFinishChallenge",value:(T=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!this.game)return[3,7];k.label=1;case 1:k.trys.push([1,4,,6]);g=mO.getMatchState().id;return[4,l_.getMatchExtraDataAsync(g)];case 2:E=k.sent();return[4,l_.finishMatchAsync({extraData:null!=E?E:void 0})];case 3:k.sent();return[3,6];case 4:_=k.sent();console.warn(_);return[4,l_.finishMatchAsync()];case 5:k.sent();return[3,6];case 6:this.game.node.scene.emit(r0.SHOW_CHALLENGE_RESULTS);k.label=7;case 7:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"handleFinishTournament",value:(A=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.handlePostTournamentScore(),!this.game)return[3,4];g=this.data.level,E=void 0===g?1:g;i5.playSound(ic.LEVEL_COMPLETE,{volume:.5}),this.game.effectManager.playConfettiEffect();return[4,mM.sleepAsync(500)];case 1:k.sent();_=vc.canShowInterstitialAd();if(!_)return[3,3];return[4,vc.showInterstitialAdAsync({forLevel:E})];case 2:_=k.sent();k.label=3;case 3:this.game.node.scene.emit(r0.NEXT_LEVEL);k.label=4;case 4:return[2]}})}),function(){return A.apply(this,arguments)})},{key:"handlePostTournamentScore",value:(C=Be(function(){var g,E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:if(!this.game)return[3,7];E=null===(g=this.game)||void 0===g?void 0:g.scoreManager.getCurrentScore();if(!E)return[3,7];R.label=1;case 1:R.trys.push([1,3,,4]);return[4,GameSDK.tournament.postScoreAsync(E)];case 2:R.sent();return[3,4];case 3:_=R.sent();console.warn("GameSDK post score async",_);return[3,4];case 4:k=l_.getMatchCustomData();if(!k)return[3,7];C=k.leaderboardId,A=k.playerId;T=C&&A;if(!T)return[3,6];return[4,mP.setLeaderboardScoreAsync(C,A,E)];case 5:T=R.sent();R.label=6;case 6:R.label=7;case 7:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleFinishSingle",value:(k=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:i5.turnUpMusic();g=this.data.level,E=void 0===g?0:g;if(!(E>0&&E%5==0))return[3,2];return[4,this.handleFinishHardLevel()];case 1:_.sent();return[3,4];case 2:return[4,this.handleFinishNormalLevel()];case 3:_.sent();_.label=4;case 4:this.handleNextLevelSingle();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"handleFinishNormalLevel",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:A=this.data.level,T=void 0===A?0:A,R=null!==(g=null===(E=mL.getGameData())||void 0===E?void 0:E.coins)&&void 0!==g?g:0,I=null!==(_=null===(k=l_.getMatchCustomData())||void 0===k?void 0:k.score)&&void 0!==_?_:0;L=vc.canShowInterstitialAd();if(!L)return[3,3];return[4,null===(C=this.game)||void 0===C?void 0:C.uiManager.interstitialAdIndicator.flash()];case 1:P.sent();return[4,vc.showInterstitialAdAsync({forLevel:T})];case 2:L=P.sent();P.label=3;case 3:i5.playSound(ic.LEVEL_COMPLETE,{volume:.5});return[4,l1.openScreenAndWaitForClose(ig.LEVEL_COMPLETE_SCREEN,{level:T,coins:R,score:I,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!1})];case 4:P.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleFinishHardLevel",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,L,P,O,B,N,M;return _ts_generator(this,function(D){switch(D.label){case 0:T=this.data.level,R=void 0===T?0:T,I=null!==(g=null===(E=mL.getGameData())||void 0===E?void 0:E.coins)&&void 0!==g?g:0,L=null!==(_=null===(k=l_.getMatchCustomData())||void 0===k?void 0:k.score)&&void 0!==_?_:0;P=vc.canShowInterstitialAd();if(!P)return[3,3];return[4,null===(A=this.game)||void 0===A?void 0:A.uiManager.interstitialAdIndicator.flash()];case 1:D.sent();return[4,vc.showInterstitialAdAsync({forLevel:R})];case 2:P=D.sent();D.label=3;case 3:i5.playSound(ic.LEVEL_COMPLETE,{volume:.5});return[4,l1.openScreenAndWaitForClose(ig.LEVEL_COMPLETE_SCREEN,{level:R,coins:I,score:L,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!0})];case 4:O=D.sent().screenData,B=(null!=O?O:{}).canShowRewardsAd;if(!(void 0!==B&&B))return[3,7];return[4,l1.openScreenAndWaitForClose(ig.GET_REWARDS_SCREEN)];case 5:N=D.sent().screenData,M=null!==(C=null==N?void 0:N.getRewardsSuccess)&&void 0!==C&&C;M&&this.getRewardItems();return[4,l1.openScreenAndWaitForClose(ig.LEVEL_COMPLETE_SCREEN,{level:R,coins:I,score:L,getRewardsSuccess:M,lookingForRewards:!1})];case 6:D.sent();D.label=7;case 7:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleNextLevelSingle",value:function(){var g=this.data.level,E=mL.getGameData();this.game&&g&&E&&(g>=E.totalLevel?this.game.node.scene.emit(r0.MAX_LEVEL):this.game.node.scene.emit(r0.NEXT_LEVEL))}},{key:"getRewardItems",value:function(){this.game&&(this.game.node.scene.emit(r0.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sP.STORM,quantity:1}),this.game.node.scene.emit(r0.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sP.THUNDER,quantity:1}))}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),u}(mb);_._RF.pop(),_._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var mF=globalThis.game,mU=mF.player,mx=mF.match,mz=GameCore.Match.Modes,mG=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(g){var E;return Fe(this,l),(E=R.call(this,g)).clearBoard(),E.loadLevel(),E.initCountdown(),E.initScore(),E}return Ue(l,[{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.board.clearAnimationQueue(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(T=Be(function(){var g,E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:if(!this.game)return[3,8];g=l_.getMatchMode();R.label=1;case 1:R.trys.push([1,6,,8]);if(g!==mz.CHALLENGE_FRIEND)return[3,3];return[4,this.loadChallengeFriendMode()];case 2:E=R.sent(),_=E.frames,k=E.extraData;i5.playSound(ic.LEVEL_START),this.handleChallengeFriendModeStart(_,k);return[3,5];case 3:return[4,this.loadSingleMode()];case 4:C=R.sent();i5.playSound(ic.LEVEL_START),g===mz.SINGLE?this.handleSingleModeStart(C):g===mz.TOURNAMENT&&this.handleTournamentModeStart(C);R.label=5;case 5:return[3,8];case 6:A=R.sent();console.error("Error loading level:",A);return[4,this.loadSingleMode()];case 7:T=R.sent();i5.playSound(ic.LEVEL_START),this.handleSingleModeStart(T);return[3,8];case 8:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"loadChallengeFriendMode",value:(A=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:g=mx.getMatchState().id;return[4,l_.getMatchExtraDataAsync(g)];case 1:E=C.sent();if(!E)throw new Error("Match mode ".concat(mz.CHALLENGE_FRIEND," but no extraData (for opponent initialization) was found in match data."));_=this.game.levelManager;return[4,_.loadLevel(E.level)];case 2:k=C.sent();return[2,(this.updateGameData({level:E.level,levelData:_.getLevelData()}),{frames:k,extraData:E})]}})}),function(){return A.apply(this,arguments)})},{key:"loadSingleMode",value:(C=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.game.levelManager;return[4,g.loadLevel(this.data.level,this.data.themeId)];case 1:E=_.sent();return[2,(this.updateGameData({levelData:g.getLevelData()}),E)]}})}),function(){return C.apply(this,arguments)})},{key:"handleChallengeFriendModeStart",value:(k=Be(function(g,E){var _,k,C,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:if(!this.game)return[3,3];_=this.game.levelManager.getLevelData(),k=E.level,C=E.fen,A=E.gravity,T=E.rules,R=E.time,I=mU.getPlayerId();return[4,Promise.all([l_.setMatchCustomDataAsync({level:k,score:0}),l_.setProfileMatchDataAsync({id:I,score:0})])];case 1:L.sent(),this.game.board.create(g,Me(Me({},_),{},{level:k,customFen:C,mode:A,rules:T,time:R})),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:L.sent(),this.game.board.setIgnoreInput(!1),this.ready();L.label=3;case 3:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleSingleModeStart",value:(_=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:if(!this.game)return[3,6];_=this.game.levelManager.getLevelData(),k=this.data.level,C=mU.getPlayerId();return[4,Promise.all([l_.setMatchCustomDataAsync({level:k,score:0}),l_.setProfileMatchDataAsync({id:C,score:0})])];case 1:T.sent(),this.game.board.create(g,_),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:T.sent(),null!==(E=this.game.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1);A=k&&k>0&&k%5==0;if(!A)return[3,5];l1.openScreen(ig.HARD_LEVEL_SCREEN);return[4,tZ.waitTweenAsync(1.3)];case 3:T.sent(),l1.closeScreen(ig.HARD_LEVEL_SCREEN);return[4,this.game.board.animateTilesWave()];case 4:A=T.sent();T.label=5;case 5:this.ready();T.label=6;case 6:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"handleTournamentModeStart",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!this.game)return[3,3];_=this.game.levelManager.getLevelData(),k=this.data.level,C=mU.getPlayerId();return[4,Promise.all([l_.setMatchCustomDataAsync({level:k}),l_.setProfileMatchDataAsync({id:C})])];case 1:A.sent(),this.game.board.create(g,_),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:A.sent(),null!==(E=this.game.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),this.ready();A.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.init()}},{key:"initCountdown",value:function(){this.game&&this.game.uiManager.initCountdown()}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var g=this.manager.createReadyState(this.manager);this.manager.change(g)}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),l}(mb);_._RF.pop(),_._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var mV=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),(_=E.call(this,g)).startCountdown(),_}return Ue(n,[{key:"startCountdown",value:function(){var g;null===(g=this.game)||void 0===g||g.uiManager.startCountdown()}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){var g=this.manager.createReadyState(this.manager);this.manager.change(g)}},{key:"playing",value:function(){}},{key:"fail",value:function(g){var E=this.manager.createFailState(this.manager,g);this.manager.change(E)}},{key:"finish",value:function(){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}},{key:"update",value:function(){this.updateStateData()}}]),n}(mb);_._RF.pop(),_._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var mK,mH=globalThis.game,mq=mH.analytics,mW=(mH.match,GameCore.Utils.Valid),mj=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),_=E.call(this,g),i5.stopAllSounds(),i5.turnDownMusic(),_.handleGuideFlow(),_.setLevelText(),_.setLevelTime(),_.setGridPlayable(),_.logLevelStartAnalytics(),_}return Ue(n,[{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var g=this.manager.createPlayingState(this.manager);this.manager.change(g)}},{key:"fail",value:function(g){if(mW.isDebugger()){var E=this.manager.createFailState(this.manager);this.manager.change(E)}}},{key:"finish",value:function(){if(mW.isDebugger()){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var g;null!==(g=this.manager.getGameplay().guidelinesManager)&&void 0!==g&&g.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var g,E;this.game&&(null!==(g=this.game.guidelinesManager)&&void 0!==g&&g.isNewbieGuideLevel()||this.game.handleShowUI(),null===(E=this.game.guidelinesManager)||void 0===E||E.show())}},{key:"setLevelTime",value:function(){if(this.game){var g=this.data.levelData;g&&this.game.uiManager.setCountdownTime(g.time)}}},{key:"setLevelText",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g;this.game.uiManager.setLevelText(E)}}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=(l_.getMatchCustomData()||{}).score,k=void 0===_?0:_,C=l_.getMatchMode()||void 0;mq.levelStart(E,k,C)}}}]),n}(mb);_._RF.pop(),_._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var mX,mY,mJ,mQ,mZ,m$,m0,m1,m2,m4=(0,k.ccclass)("StateManager")(mK=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(g){this.gameplay=g,this.state=new mG(this)}},{key:"change",value:function(g){this.state=g}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return _instanceof(this.state,mG)}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return _instanceof(this.state,mj)}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return _instanceof(this.state,mV)}},{key:"fail",value:function(g){this.state.fail(g)}},{key:"isFail",value:function(){return _instanceof(this.state,mT)}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return _instanceof(this.state,mD)}},{key:"update",value:function(g){this.state&&this.state.update(g)}},{key:"createInitializeState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mG,E)}},{key:"createReadyState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mj,E)}},{key:"createPlayingState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mV,E)}},{key:"createFailState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mT,E)}},{key:"createFinishState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mD,E)}}]),n}(M))||mK;_._RF.pop(),_._RF.push({},"2b89dXjcudIaZRJFuh5TAAI","InterstitialAdIndicator",void 0);var m3=k.ccclass,m5=k.property,m6=["Short ad break, hang tight!","Back to the game in just a sec!","Quick ad, then more fun!"];var m8,m9,m7,be,bt,bn=(mX=m3("InterstitialAdIndicator"),mY=nk.required(),mJ=m5(eu),mQ=nk.required(),mZ=m5(L),mX((m1=st((m0=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"uiOpacity",m1,Ke(g)),rt(g,"label",m2,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){nk.decorateComponent(this)}},{key:"flash",value:(E=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:null===(g=this.signal)||void 0===g||g.abort();_=new nN;this.signal=_,this.label.string=(E=Math.floor(Math.random()*m6.length),m6[E]);k=z(this.uiOpacity).to(.25,{opacity:255},{easing:"linear"}).delay(.25).to(.25,{opacity:100},{easing:"linear"}).delay(.125);return[4,tZ.runTweenAsync(z(this.uiOpacity).repeat(2,k).to(.25,{opacity:0},{easing:"linear"}),_)];case 1:C.sent(),this.uiOpacity.opacity=0;return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"uiOpacity",[mY,mJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m2=st(m0.prototype,"label",[mQ,mZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m$=m0))||m$);_._RF.pop(),_._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);var bi,br,ba,bo,bs,bl,bu,bc=k.ccclass,bh=k.property,bp=(m8=bc("Digit"),m9=bh(L),m8((bt=st((be=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"numberLabels",bt,Ke(g)),g.labelUITransforms=[],g.labelUIOpacitys=[],g.previousNumber=0,g}return Ue(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.labelUITransforms=this.numberLabels.map(function(g){return g.getComponent(R)}),this.labelUIOpacitys=this.numberLabels.map(function(g){return g.getComponent(eu)}),nk.lazyValidateProperties(this)}},{key:"setNumber",value:function(g){this.previousNumber!==g&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[g].node.active||(this.numberLabels[g].node.active=!0),this.labelUIOpacitys[g].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[g].contentSize),this.previousNumber=g)}}]),n}(M)).prototype,"numberLabels",[m9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),m7=be))||m7);_._RF.pop(),_._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var bd,bf=k.ccclass,by=k.disallowMultiple,bv=k.property,bg=(bi=bf("Clock"),br=bv(C),ba=bv(bp),bi(bo=by((bl=st((bs=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"clockIcon",bl,Ke(g)),rt(g,"digits",bu,Ke(g)),g.time=0,g.remaining=0,g.running=!1,g.halfTime=!1,g.handleUpdateConfig=function(E){g.enabled&&console.log("Clock: handleUpdateConfig",E)},g.refillTime=function(){var E=Date.now(),_=z(g.node).to(.5,{scale:new em(1.1,1.1,1)}),k=z(g.node).to(.5,{scale:new em(1,1,1)}),C=z(g.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),A=z(g.clockIcon).repeat(5,C),T=z(g.node).to(3,{position:new em(0,0,0)},{onUpdate:function(){var _=Date.now(),k=(_-E)/3e3>1?1:(_-E)/3e3,C=X.lerp(0,120,k);g.setTime(C)}}).call(function(){g.setTime(120),k.start(),g.node.scene.emit(r0.RESCUE_FINISHED)});z(g.node).parallel(_,T).start(),A.start()},g}return Ue(n,[{key:"__preload",value:function(){this.listenEvents()}},{key:"start",value:function(){this.init()}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"listenEvents",value:function(){this.node.scene.on(t8,this.handleUpdateConfig),this.node.scene.on(r0.RESCUE_START,this.refillTime)}},{key:"setTime",value:function(g){this.time=g,this.updateTimeLabel(g),this.remaining=g}},{key:"getRemainingTime",value:function(){return this.remaining}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(r0.TIME_OUT)}},{key:"update",value:function(g){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=g,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(r0.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}},{key:"updateTimeLabel",value:function(g){for(var E=this.convertSecondsToMmSs(g),_=0;_<E.length;_++)this.digits[_].setNumber(Number.parseInt(E[_]))}},{key:"convertSecondsToMmSs",value:function(g){var E=Math.floor(g/60),_=Math.floor(g%60),k=this.padZero(E),C=this.padZero(_);return"".concat(k).concat(C)}},{key:"padZero",value:function(g){return g<10?"0".concat(g):"".concat(g)}}]),n}(M)).prototype,"clockIcon",[br],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bu=st(bs.prototype,"digits",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bo=bs))||bo)||bo);_._RF.pop(),_._RF.push({},"dfab8xSeglD/abIKphEhi4g","ComboContainer",void 0);var bm,bb=k.ccclass,bw=GameCore.Match.Modes,bS=bb("ComboContainer")(bd=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"__preload",value:function(){this.widget=this.node.getComponent(H)}},{key:"onLoad",value:function(){nk.lazyValidateProperties(this)}},{key:"updateStatus",value:function(){l_.getMatchMode()===bw.TOURNAMENT?this.widget.top=180:this.widget.top=160}}]),n}(M))||bd;_._RF.pop(),_._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var bE=k.ccclass,b_=bE("ComboProgressBar")(bm=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"start",value:function(){this.progressBar=this.getComponent(oa),this.opacity=this.getComponent(eu),this.comboTimer=0,this.isActive=!1,this.node.scene.on(r0.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(g){this.isActive&&(this.comboTimer>0?(this.comboTimer-=g,this.progressBar.progress=this.comboTimer/2):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(r0.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(g){0===g?this.opacity.opacity=0:g>0&&(this.isActive=!0,this.comboTimer=2),g>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),n}(M))||bm;_._RF.pop(),_._RF.push({},"af947t5g91EkZVWXv5upZaV","CacheUtils",void 0);var bk,bC,bA,bT,bR,bI,bL,bP=GameCore.Utils.Image,bO=globalThis.game.frameCapture,bB=function(){function e(){Fe(this,e)}var g,E,_;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getPlayerAvatar",value:(_=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:C=this.playerAvatarCache.get("".concat(E,":").concat(_));A=C;if(A)return[3,2];return[4,this.loadPlayerAvatar(g,E,_,k)];case 1:A=C=T.sent();T.label=2;case 2:return[2,C]}})}),function(g,E,k,C){return _.apply(this,arguments)})},{key:"loadPlayerAvatar",value:(E=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:return[4,this.loadImage(g,_,_,"".concat(E,":").concat(_))];case 1:C=T.sent();if((null==k||!k.aborted)&&C){A=ea.createWithImage(C);return[2,(this.playerAvatarCache.set("".concat(E,":").concat(_),A),A)]}return[2]}})}),function(g,_,k,C){return E.apply(this,arguments)})},{key:"isAvatarCached",value:function(g,E){return this.playerAvatarCache.has("".concat(g,":").concat(E))}},{key:"loadImage",value:(g=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:T.trys.push([0,5,,6]);return[4,bO.captureAsync({width:E,height:_,name:"LeaderAvatar",renderOptions:Ge({},k,{name:k,type:"image",depth:0,position:[0,0],size:[E,_],image:g})})];case 1:C=T.sent();if(!C)return[3,3];return[4,bP.loadImage(C)];case 2:A=T.sent();return[3,4];case 3:A=null;T.label=4;case 4:return[2,A];case 5:T.sent();return[2,null];case 6:return[2]}})}),function(E,_,k,C){return g.apply(this,arguments)})}]),e}();bB.playerAvatarCache=new Map;try{new bB}catch(g){console.error("CacheUtils",g)}_._RF.pop(),_._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var bN,bM,bD,bF,bU,bx,bz,bG=k.ccclass,bV=k.property,bK=k.disallowMultiple,bH=(bk=bG("ScoreBlock"),bC=bV(L),bA=bV(K),bk(bT=bK((bI=st((bR=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"scoreText",bI,Ke(g)),rt(g,"maxScoreWidth",bL,Ke(g)),g.panelWidthDiff=0,g}return Ue(a,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(R),this.scoreUITransform=this.scoreText.node.getComponent(R),this.panelWidthDiff=this.uiTransform.width-this.maxScoreWidth,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"updateScore",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=g-this.score,k=z(this.node).to(.1,{},{onUpdate:function(g,k){if(k){var C=Math.floor(_*k)+E.score;E.scoreText.string=C.toString(),E.resizeWidth()}}});return[4,tZ.runTweenAsync(k)];case 1:C.sent(),this.setScore(g);return[4,this.resizeWidth()];case 2:C.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"setScore",value:function(g){var E=null!=g?g:0;this.score=E,this.scoreText.string=E.toString()}},{key:"resizeWidth",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this,E=this.uiTransform.width,_=(this.scoreUITransform.width>this.maxScoreWidth?this.scoreUITransform.width:this.maxScoreWidth)+this.panelWidthDiff;this.uiTween&&this.uiTween.stop(),this.uiTween=z(this.node).to(.05,{},{easing:"sineOut",onUpdate:function(k,C){C&&(g.uiTransform.width=X.lerp(E,_,C))}});return[4,tZ.runTweenAsync(this.uiTween)];case 1:k.sent(),this.uiTransform.width=_;return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"scoreText",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bL=st(bR.prototype,"maxScoreWidth",[bA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bT=bR))||bT)||bT);_._RF.pop(),_._RF.push({},"424745QWUlDPabdCe8UcRwy","ChallengeScoreBlock",void 0);var bq,bW,bj,bX,bY,bJ,bQ,bZ,b$,b0=k.ccclass,b1=k.property,b2=(bN=b0("ChallengeScoreBlock"),bM=b1(eo),bD=b1(ea),bN((bx=st((bU=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"avatar",bx,Ke(g)),rt(g,"defaultAvatar",bz,Ke(g)),g}return Ue(i,[{key:"updateInfo",value:(E=Be(function(g,E,_){var k,C;return _ts_generator(this,function(A){switch(A.label){case 0:k=this;this.setScore(_),this.scheduleOnce(function(){return k.resizeWidth()},0);A.label=1;case 1:A.trys.push([1,3,,4]);return[4,bB.getPlayerAvatar(g,E,50)];case 2:C=A.sent();if(!C)return[2];C.packable=!0,this.avatar.spriteFrame=C;return[3,4];case 3:A.sent();this.avatar.spriteFrame=this.defaultAvatar;return[3,4];case 4:return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),i}(bH)).prototype,"avatar",[bM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bz=st(bU.prototype,"defaultAvatar",[bD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bF=bU))||bF);_._RF.pop(),_._RF.push({},"f963aJjCvtD0Y2LplwjDer1","ScoreContainer",void 0);var b4,b3,b5,b6,b8,b9,b7,we,wt,wn,wi,wr=k.ccclass,wa=k.property,wo=GameCore.Match.Modes,ws=globalThis.game.match,wl=(bq=wr("ScoreContainer"),bW=wa(bH),bj=wa(b2),bX=wa(b2),bq((bQ=st((bJ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"scoreBlock",bQ,Ke(g)),rt(g,"playerScoreBlock",bZ,Ke(g)),rt(g,"opponentScoreBlock",b$,Ke(g)),g.scoreBlockShown=!1,g.challengeScoreBlockShown=!1,g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}},{key:"listenGameEvents",value:function(){this.node.scene.on(r0.SCORE_UPDATED,this.updateScore,this)}},{key:"unlistenGameEvents",value:function(){this.node.scene.off(r0.SCORE_UPDATED,this.updateScore,this)}},{key:"updateStatus",value:function(){var g=ws.getMatchState().mode;g===wo.CHALLENGE_FRIEND?(this.showChallengeScoreBlock(),this.hideScoreBlock()):g===wo.SINGLE&&(this.hideChallengeScoreBlock(),this.showScoreBlock())}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"showChallengeScoreBlock",value:function(){var g;if(!this.challengeScoreBlockShown){this.challengeScoreBlockShown=!0;var E=ws.getMatchState(),_=null!==(g=l_.getMatchCustomData())&&void 0!==g?g:{},k=_.playerId,C=_.opponentId;if(k&&C){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var A=E.profiles[k],T=E.profiles[C];this.playerScoreBlock.updateInfo(A.photo,k,A.score),this.opponentScoreBlock.updateInfo(T.photo,C,T.score)}}}},{key:"hideChallengeScoreBlock",value:function(){this.challengeScoreBlockShown&&(this.challengeScoreBlockShown=!1,this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1)}},{key:"showScoreBlock",value:function(){var g;if(!this.scoreBlockShown){this.scoreBlockShown=!0;var E=(null!==(g=l_.getMatchCustomData())&&void 0!==g?g:{}).score;this.scoreBlock.node.active=!0,this.scoreBlock.setScore(E)}}},{key:"hideScoreBlock",value:function(){this.scoreBlockShown&&(this.scoreBlockShown=!1,this.scoreBlock.node.active=!1)}},{key:"updateScore",value:function(g){this.challengeScoreBlockShown?this.playerScoreBlock.updateScore(g):this.scoreBlockShown&&this.scoreBlock.updateScore(g)}}]),n}(M)).prototype,"scoreBlock",[bW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bZ=st(bJ.prototype,"playerScoreBlock",[bj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b$=st(bJ.prototype,"opponentScoreBlock",[bX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bY=bJ))||bY);_._RF.pop(),_._RF.push({},"540108ucKBPYbN9gW5TFh/q","LeaderRail",void 0);var wc,wh,wp,wd,wf,wy=k.ccclass,wv=k.property,wg=(b4=wy("LeaderRail"),b3=wv(L),b5=wv(C),b6=wv(eo),b8=wv(ya),b4((we=st((b7=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"scoreLabel",we,Ke(g)),rt(g,"crown",wt,Ke(g)),rt(g,"avatar",wn,Ke(g)),rt(g,"spark",wi,Ke(g)),g.score=0,g}return Ue(a,[{key:"__preload",value:function(){this.defaultAvatar=this.avatar.spriteFrame,this.uiOpacity=this.getComponent(eu)}},{key:"updateScore",value:(_=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this,k=g-this.score,C=z(this.node).to(.5,{},{onUpdate:function(g,E){if(E){var C=Math.floor(k*E)+_.score;_.scoreLabel.string=C.toString()}}});return[4,tZ.runTweenAsync(C,E)];case 1:A.sent(),this.score=g,this.scoreLabel.string=g.toString();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"updatePhoto",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=GameSDK.player.getPhoto(),E=GameSDK.player.getID();if(!(g&&E))return[3,2];return[4,bB.getPlayerAvatar(g,E,50)];case 1:_=k.sent();_?(_.packable=!0,this.avatar.spriteFrame=_):this.avatar.spriteFrame=this.defaultAvatar;k.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setCrown",value:function(g){this.crown.active=g}},{key:"setOpacity",value:function(g){this.uiOpacity.opacity=g}},{key:"playSparkParticle",value:function(){this.spark.play()}},{key:"stopSparkParticle",value:function(){this.spark.stop()}}]),a}(M)).prototype,"scoreLabel",[b3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wt=st(b7.prototype,"crown",[b5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wn=st(b7.prototype,"avatar",[b6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wi=st(b7.prototype,"spark",[b8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b9=b7))||b9);_._RF.pop(),_._RF.push({},"00759vwS/dHS6GvHKvVE5Q1","TournamentProgressBar",void 0);var wm,wb,ww,wS,wE,w_,wk,wC,wA,wT,wR,wI,wL,wP,wO,wB=k.ccclass,wN=k.property,wM=474,wD=(wc=wB("TournamentProgressBar"),wh=wN(wg),wc((wf=st((wd=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"playerLeader",wf,Ke(g)),g.onUpdate=function(){g.playerLeader&&g.playerLeader.node&&(g.playerLeader.node.position=new em(g.progressBar.progress*wM-237,0,0))},g}return Ue(i,[{key:"__preload",value:function(){this.progressBar=this.getComponent(ew)}},{key:"updateProgress",value:(E=Be(function(g,E){var _,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:_=A.length>2&&void 0!==A[2]?A[2]:.5,k=A.length>3&&void 0!==A[3]?A[3]:"cubicOut",C=z(this.progressBar).to(_,{progress:g},{easing:k,onUpdate:this.onUpdate});return[4,tZ.runTweenAsync(C,E)];case 1:T.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"getProgress",value:function(){return this.progressBar.progress}}]),i}(M)).prototype,"playerLeader",[wh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wp=wd))||wp);_._RF.pop(),_._RF.push({},"16d68fBLT1Ha7lXADThDtfC","TournamentRail",void 0);var wF,wU,wx,wz,wG,wV,wK,wH,wq,wW,wj,wX,wY,wJ,wQ,wZ,w$,w0=k.ccclass,w1=k.property,w2=GameCore,w4=w2.Utils,w3=w4.Array,w5=w4.Object,w6=w2.Match.Modes,w8=globalThis.game.player,w9=(wm=w0("TournamentRail"),wb=w1(wD),ww=w1(wg),wS=w1(C),wE=w1(C),w_=w1(L),wk=w1(L),wm((wT=st((wA=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"progressBar",wT,Ke(g)),rt(g,"playerLeader",wR,Ke(g)),rt(g,"flag",wI,Ke(g)),rt(g,"sword",wL,Ke(g)),rt(g,"currentRank",wP,Ke(g)),rt(g,"nextRank",wO,Ke(g)),g.nextLeaderIndex=0,g.leaderData=[],g.score=0,g.minScore=0,g.maxScore=0,g.signal=new nN,g.isInited=!1,g}return Ue(s,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu)}},{key:"init",value:function(g){var E=this,_=w8.getPlayerId();this.leaderData=w5.vals(g.leaders).reduce(function(g,E){if(E.playerId!==_&&E.score>0){var k={score:E.score,rank:E.rank};g.push(k)}return g},[]),this.leaderData.sort(function(g,E){return g.score-E.score}),this.leaderData.forEach(function(g,_){g.rank=E.leaderData.length-_}),this.playerLeader.updatePhoto(),this.isInited=!0}},{key:"updateStatus",value:(A=Be(function(){var g;return _ts_generator(this,function(E){if(l_.getMatchMode()===w6.TOURNAMENT){this.signal.abort();g=new nN;this.signal=g,this.uiOpacity.opacity=255,this.node.scene.on(r0.SCORE_UPDATED,this.handleScoreUpdated,this),this.nextLeaderIndex=this.getScoreReachedLeaderIndex(this.score),this.syncRail(g,!0)}else this.uiOpacity.opacity=0;return[2]})}),function(){return A.apply(this,arguments)})},{key:"syncRail",value:(C=Be(function(g){var E,_,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(L){switch(L.label){case 0:E=I.length>1&&void 0!==I[1]&&I[1],_=this.leaderData[this.nextLeaderIndex-1],k=this.leaderData[this.nextLeaderIndex],C=_?_.rank:k?k.rank+1:1;this.setRankLabel(C,this.currentRank);A=!k;this.nextRank.node.active=!A,this.runActiveAnimation(this.sword,!A,g),this.playerLeader.setCrown(A),this.playerLeader.updateScore(this.score,g);T=E?0:void 0;if(!A)return[3,2];this.playerLeader.playSparkParticle();return[4,this.progressBar.updateProgress(1,g,T)];case 1:L.sent();return[3,4];case 2:this.playerLeader.stopSparkParticle(),this.setRankLabel(k.rank,this.nextRank),this.minScore=_?_.score:0,this.maxScore=k.score;R=(this.score-this.minScore)/(this.maxScore-this.minScore);R=.8*R+.1;return[4,this.progressBar.updateProgress(R,g,T)];case 3:L.sent();L.label=4;case 4:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"handleScoreUpdated",value:(k=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(this.score!==g))return[3,4];this.signal.abort();E=new nN;if(this.signal=E,this.score=g,!this.isInited)return[3,4];_=this.getScoreReachedLeaderIndex(g);if(!(_>this.nextLeaderIndex))return[3,3];this.nextLeaderIndex=_;k=(1-this.progressBar.getProgress())/1.5;k=Math.min(k,.5);return[4,this.progressBar.updateProgress(1,E,k,"cubicIn")];case 1:C.sent(),this.runBubbleAnimation(this.sword,E);return[4,this.progressBar.updateProgress(0,E,0)];case 2:C.sent(),this.runBubbleAnimation(this.flag,E);C.label=3;case 3:this.syncRail(E);C.label=4;case 4:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"runBubbleAnimation",value:(_=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.scale=em.ONE;_=z(g).to(.1,{scale:new em(1.2,1.2,1.2)}).to(.2,{scale:em.ONE},{easing:"backOut"});return[4,tZ.runTweenAsync(_,E)];case 1:k.sent(),g.scale=em.ONE;return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"runActiveAnimation",value:(E=Be(function(g,E,_){var k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:k=E?em.ZERO:em.ONE,C=E?em.ONE:em.ZERO;if(!!g.scale.equals(C))return[3,2];A=E?"backOut":"quadOut";g.scale=k;T=z(g).to(.1,{scale:new em(1.2,1.2,1.2)}).to(.2,{scale:C},{easing:A});return[4,tZ.runTweenAsync(T,_)];case 1:R.sent(),g.scale=C;R.label=2;case 2:return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"getScoreReachedLeaderIndex",value:function(g){var E=w3.searchIndex(this.leaderData,function(E){return E.score>=g});return -1===E?this.leaderData.length:E}},{key:"setRankLabel",value:function(g,E){var _="";_=1===g?"No.1":2===g?"2nd":3===g?"3rd":"".concat(g,"th"),E.string=_}}]),s}(M)).prototype,"progressBar",[wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wR=st(wA.prototype,"playerLeader",[ww],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wI=st(wA.prototype,"flag",[wS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wL=st(wA.prototype,"sword",[wE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wP=st(wA.prototype,"currentRank",[w_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wO=st(wA.prototype,"nextRank",[wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wC=wA))||wC);_._RF.pop(),_._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var w7,Se,St,Sn,Si,Sr=k.ccclass,Sa=k.property,So=(wF=Sr("Header"),wU=Sa(L),wx=Sa(C),wz=Sa(C),wG=Sa(C),wV=Sa(C),wK=Sa(wl),wH=Sa(w9),wF((wj=st((wW=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"levelText",wj,Ke(g)),rt(g,"settingNode",wX,Ke(g)),rt(g,"homeNode",wY,Ke(g)),rt(g,"leftNode",wJ,Ke(g)),rt(g,"coinNode",wQ,Ke(g)),rt(g,"scoreContainer",wZ,Ke(g)),rt(g,"tournamentRail",w$,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"updateStatus",value:function(){this.scoreContainer.updateStatus(),this.tournamentRail.updateStatus()}},{key:"handleClickedPauseGame",value:function(){this.showPauseScreen(),this.node.scene.emit(r0.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){l1.openScreen(ig.QUIT_LEVEL_SCREEN),this.node.scene.emit(r0.GAME_PAUSE)}},{key:"highlightCoinContainer",value:function(){var g=$("Canvas/Screens");if(g){var E=this.coinNode.worldPosition.clone();this.coinNode.parent=g,this.coinNode.worldPosition=E}}},{key:"removeCoinContainerHighlight",value:function(){var g=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=g}},{key:"showPauseScreen",value:function(){l1.openScreen(ig.PAUSE_SCREEN,{})}},{key:"setLevelText",value:function(g){this.levelText.string="Level ".concat(g)}},{key:"setButtonsSelectable",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.enableBtnNode(this.settingNode,E,!0),this.enableBtnNode(this.homeNode,E,!0)}},{key:"enableBtnNode",value:function(g,E,_){var k=g.getComponent(B);if(k&&(k.interactable=E),g.active=_,_)g.getComponent(rh)}},{key:"setActive",value:function(g){this.uiOpacity.opacity=g?255:0}}]),n}(M)).prototype,"levelText",[wU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wX=st(wW.prototype,"settingNode",[wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wY=st(wW.prototype,"homeNode",[wz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wJ=st(wW.prototype,"leftNode",[wG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wQ=st(wW.prototype,"coinNode",[wV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wZ=st(wW.prototype,"scoreContainer",[wK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w$=st(wW.prototype,"tournamentRail",[wH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wq=wW))||wq);_._RF.pop(),_._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var Ss=k.ccclass,Sl=k.property,Sc=(w7=Ss("UIMasks"),Se=Sl(rh),w7((Si=st((Sn=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background",Si,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:g.sent(),this.background.node.active=!1;return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"background",[Se],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),St=Sn))||St);_._RF.pop(),_._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var Sh,Sp,Sd,Sf,Sy,Sv="bomb";_._RF.pop(),_._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var Sg,Sm,Sb,Sw,SS,SE,S_,Sk,SC,SA,ST,SR,SI,SL,SP,SO,SB,SN,SM,SD,SF,SU=GameCore,Sx=SU.Dtos.Player,Sz=SU.Utils.Function,SG=k.ccclass,SV=k.property,SK=globalThis.game.player,SH=(Sh=SG("DevToolsContainer"),Sp=SV(C),Sh((Sy=st((Sf=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"devToolsToggle",Sy,Ke(g)),g.isActive=!0,g.game=null,g.bundleName="lowest",g.debouncedStarsNotification=Sz.debounce(function(){var g=SK.getGameData();g&&l1.showNotificationScreen("Stars added. Current stars: ".concat(g.stars))},700),g}return Ue(o,[{key:"injectGameplay",value:function(g){this.game=g}},{key:"hideAllButtons",value:function(){var g,E=at(this.getComponentsInChildren(B));try{for(E.s();!(g=E.n()).done;){var _=g.value.node.parent;_&&_.name!==this.devToolsToggle.name&&(_.active=!1)}}catch(g){E.e(g)}finally{E.f()}}},{key:"showAllButtons",value:function(){var g,E=at(this.getComponentsInChildren(B));try{for(E.s();!(g=E.n()).done;){var _=g.value.node.parent;_&&_.name!==this.devToolsToggle.name&&(_.active=!0)}}catch(g){E.e(g)}finally{E.f()}}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){SK.setPlayerData(Sx.Data.getDefaultData()),l1.openScreen(ig.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(r0.START_OVER,0)}},{key:"handleNextLevel",value:(k=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){k=(null!==(g=null===(E=this.game)||void 0===E||null===(E=E.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:1)+1;null===(_=this.game)||void 0===_||_.setGameData({level:k-1}),SK.setGameData({level:k}),this.node.scene.emit(r0.NEXT_LEVEL);return[2]})}),function(){return k.apply(this,arguments)})},{key:"handlePrevLevel",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){k=Math.max((null!==(g=null===(E=this.game)||void 0===E||null===(E=E.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:2)-1,1);null===(_=this.game)||void 0===_||_.setGameData({level:k-1}),SK.setGameData({level:k}),this.node.scene.emit(r0.NEXT_LEVEL);return[2]})}),function(){return _.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(k){_=Number(g.string);null===(E=this.game)||void 0===E||E.setGameData({level:_-1}),SK.setGameData({level:_}),this.node.scene.emit(r0.NEXT_LEVEL);return[2]})}),function(g){return E.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var g=globalThis.game.getBuildVersion();l1.showNotificationScreen("Build version: ".concat(g))}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(r0.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){this.node.scene.emit(r0.TIME_OUT)}},{key:"handleClickExplodeButton",value:function(){var g,E,_=this.game;if(_){var k=null===(g=_.getGameData())||void 0===g||null===(g=g.levelData)||void 0===g?void 0:g.specials.bomb;if(k&&!(k<=0)){var C=_.board.getBombTiles();if(0!==C.length){var A=C[0];if((null===(E=A.special)||void 0===E?void 0:E.type)!==Sv)throw new Error("Invalid bomb tile");A.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(r0.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sP.HINT,quantity:2}),this.node.scene.emit(r0.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sP.STORM,quantity:2}),this.node.scene.emit(r0.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sP.THUNDER,quantity:2}),this.node.scene.emit(r0.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sP.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(r0.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var g=SK.getGameData();g&&(SK.setGameData({stars:g.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchQualityAssets",value:function(){switch(this.bundleName){case"lowest":this.bundleName="highest";break;case"highest":this.bundleName="lowest"}Q.emit(na,{quality:this.bundleName})}}]),o}(M)).prototype,"devToolsToggle",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd=Sf))||Sd);_._RF.pop(),_._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var Sq,SW,Sj,SX,SY,SJ,SQ,SZ,S$=k.ccclass,S0=k.property,S1=GameCore.Utils.Valid,S2=(Sg=S$("UIManager"),Sm=S0(bn),Sb=S0(bg),Sw=S0(So),SS=S0(SH),SE=S0(b_),S_=S0(bS),Sk=S0(Sc),SC=S0([C]),SA=S0([C]),Sg((SI=st((SR=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"interstitialAdIndicator",SI,Ke(g)),rt(g,"clock",SL,Ke(g)),rt(g,"header",SP,Ke(g)),rt(g,"devTools",SO,Ke(g)),rt(g,"comboProgressBar",SB,Ke(g)),rt(g,"comboContainer",SN,Ke(g)),rt(g,"uiMasks",SM,Ke(g)),rt(g,"topAnimNodes",SD,Ke(g)),g.originTopNodesPos=[],rt(g,"botAnimNodes",SF,Ke(g)),g.originBotNodesPos=[],g.hideBotWorldY=-80,g.entranceSignal=new nN,g.exitSignal=new nN,g.showDevTools=function(){g.devTools&&(g.devTools.node.active=!0)},g}return Ue(r,[{key:"onLoad",value:function(){var g=this;this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),N.once(e_.EVENT_AFTER_UPDATE,function(){g.saveOriginPos(),g.initUIPos()})}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var g,E=at(this.topAnimNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value;this.originTopNodesPos.push(_.position.clone())}}catch(g){E.e(g)}finally{E.f()}var k,C=at(this.botAnimNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value;this.originBotNodesPos.push(A.position.clone())}}catch(g){C.e(g)}finally{C.f()}}},{key:"initUIPos",value:function(){var g=this;this.topAnimNodes.forEach(function(E,_){var k=g.originTopNodesPos[_].clone();k.y+=200,E.setPosition(k)});var E=new em(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(function(_,k){var C,A,T=g.originBotNodesPos[k].clone();E.y=g.hideBotWorldY;var R=null!==(C=null===(A=_.parent)||void 0===A?void 0:A.inverseTransformPoint(E,E).y)&&void 0!==C?C:200;T.y=R,_.setPosition(T)})}},{key:"listensDevToolsEvents",value:function(){this.node.scene.on(sG.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}},{key:"listenRescueEvents",value:function(){this.node.scene.on(r0.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(r0.RESCUE_FINISHED,this.hideRescueAnimation,this)}},{key:"initDevTools",value:function(g){var E=this;window.addEventListener("reset-game-data",function(){var g;null===(g=E.devTools)||void 0===g||g.handleResetData()}),this.devTools&&(this.devTools.node.active=S1.isDebugger(),this.devTools.injectGameplay(g))}},{key:"setLevelText",value:function(g){this.header.setLevelText(g)}},{key:"initCountdown",value:function(){this.clock.init()}},{key:"setCountdownTime",value:function(g){this.clock.setTime(g)}},{key:"startCountdown",value:function(){this.clock.startCountdown(),this.comboProgressBar.resume()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause(),this.clock.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume(),this.clock.resume()}},{key:"setComboUI",value:function(g){this.comboContainer.getComponent(rh).changeStateFade(g,.1)}},{key:"disableHeader",value:function(){this.header.setButtonsSelectable(!1)}},{key:"enableHeader",value:function(){this.header.setButtonsSelectable()}},{key:"updateStatus",value:function(){this.header.updateStatus(),this.comboContainer.updateStatus()}},{key:"showRescueAnimation",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.uiMasks.show()];case 1:g.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"hideRescueAnimation",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.uiMasks.hide()];case 1:g.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"playExitAnimUI",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I,L,P;return _ts_generator(this,function(O){switch(O.label){case 0:g=this;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new nN;E=[];this.topAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originTopNodesPos[k].y+200,0),A=z(_);A.to(.17,{position:C},{easing:"backIn"}),E.push(tZ.runTweenAsync(A,g.exitSignal))});k=new em(0,this.hideBotWorldY,0),C=at(this.botAnimNodes);try{for(C.s();!(_=C.n()).done;){R=_.value;k.y=this.hideBotWorldY;I=null!==(A=null===(T=R.parent)||void 0===T?void 0:T.inverseTransformPoint(k,k).y)&&void 0!==A?A:200,L=new em(R.position.x,I,0),P=z(R);P.to(.17,{position:L},{easing:"backIn"}),E.push(tZ.runTweenAsync(P,this.exitSignal))}}catch(g){C.e(g)}finally{C.f()}return[4,Promise.all(E)];case 1:O.sent(),this.exitSignal.aborted||this.header.setActive(!1);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new nN,this.header.setActive(!0);E=[];this.topAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originTopNodesPos[k].y,0),A=z(_);A.to(.2,{position:C},{easing:"backOut"}),E.push(tZ.runTweenAsync(A,g.entranceSignal))}),this.botAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originBotNodesPos[k].y,0),A=z(_);A.to(.2,{position:C},{easing:"backOut"}),E.push(tZ.runTweenAsync(A,g.entranceSignal))});return[4,Promise.all(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"setInteractableItemButtons",value:function(g){var E,_=!(arguments.length>0&&void 0!==g)||g,k=at(this.botAnimNodes);try{for(k.s();!(E=k.n()).done;){var C=E.value,A=C.getComponent(mr);if(A){if(!_){A.button.interactable=!1;continue}A.canActivate()&&(A.button.interactable=!0)}}}catch(g){k.e(g)}finally{k.f()}}}]),r}(M)).prototype,"interstitialAdIndicator",[Sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SL=st(SR.prototype,"clock",[Sb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SP=st(SR.prototype,"header",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SO=st(SR.prototype,"devTools",[SS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SB=st(SR.prototype,"comboProgressBar",[SE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SN=st(SR.prototype,"comboContainer",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SM=st(SR.prototype,"uiMasks",[Sk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SD=st(SR.prototype,"topAnimNodes",[SC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SF=st(SR.prototype,"botAnimNodes",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ST=SR))||ST);_._RF.pop(),_._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var S4=globalThis.game,S3=S4.player,S5=S4.ads,S6=S4.event,S8=S4.match,S9=S4.storage,S7=S4.analytics,Ee=S4.monitorError,Et=S4.frameCapture,En=S4.leaderboard,Ei=GameCore,Er=Ei.Events,Ea=Ei.Utils,Eo=Ea.Time,Es=Ea.Array,El=Ei.Configs.Gameplay,Ec=Ei.Match.Modes,Eh=k.ccclass,Ep=k.property,Ed=[];Sq=Eh("Gameplay"),SW=Ep(cv),Sj=Ep(rh),SX=Ep(c9),Sq((SJ=st((SY=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"board",SJ,Ke(g)),rt(g,"opacityToggler",SQ,Ke(g)),rt(g,"pathDraw",SZ,Ke(g)),g.gameData=null,g.defaultData={level:1,isFromLoader:!1},g.rescueTiles=[],g.isAutoPlayEnabled=!1,g.handleOpenScreen=function(E){E.screenName===im[ig.GET_ITEM_SCREEN]&&g.uiManager.highlightCoinContainer()},g.handleShowUI=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.uiManager.updateStatus(),g.uiManager.disableHeader(),g.uiManager.setInteractableItemButtons(!1);return[4,g.uiManager.playEntranceAnimUI()];case 1:E.sent(),g.uiManager.enableHeader(),g.uiManager.setInteractableItemButtons(!0);return[2]}})}),g.handleHideUI=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.uiManager.disableHeader(),g.uiManager.setInteractableItemButtons(!1);return[4,g.uiManager.playExitAnimUI()];case 1:E.sent();return[2]}})}),g.handleCloseScreen=function(E){E.screenName===im[ig.GET_ITEM_SCREEN]&&g.uiManager.unHighlightCoinContainer()},g.handlePauseGame=function(){g.node.scene.emit(r0.PAUSE_TIME),g.node.pauseSystemEvents(!0),g.opacityToggler.changeStateFade(!1,.1),g.uiManager.setComboUI(!1),g.processCrazyGamesGameplayStop()},g.handleResumeGame=function(){var E;g.node.resumeSystemEvents(!0),g.stateManager.isPlaying()&&g.node.scene.emit(r0.RESUME_TIME),g.processCrazyGamesGameplayStart(),g.opacityToggler.changeStateFade(!0,.1),g.uiManager.setComboUI(!0),null===(E=g.guidelinesManager)||void 0===E||E.startAutoGuides()},g.handleReplayGame=Be(function(){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g.handleHideHint();A.label=1;case 1:A.trys.push([1,6,,7]);E=l_.getMatchMode();_=E===Ec.SINGLE;if(!_)return[3,3];return[4,l_.finishMatchAsync()];case 2:_=A.sent();A.label=3;case 3:k=E!==Ec.CHALLENGE_FRIEND;if(!k)return[3,5];return[4,l_.startMatchAsync()];case 4:k=A.sent();A.label=5;case 5:E===Ec.TOURNAMENT&&(g.scoreManager.resetTournamentStartScore(),g.setGameData({level:1}));return[3,7];case 6:C=A.sent();console.warn("handleReplayGame",C);return[3,7];case 7:g.stateManager.initialize();return[2]}})}),g.handleFinishGame=function(){var E;g.attemptCallCreateShortcut(),null!==(E=g.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()?(g.guidelinesManager.guideSkipButton.active=!1,g.handleNextLevel()):g.stateManager.finish()},g.handleNextLevel=Be(function(){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!g.gameData)return[3,12];_=l_.getMatchMode();A.label=1;case 1:A.trys.push([1,5,,6]);if(_!==Ec.SINGLE)return[3,3];return[4,l_.finishMatchAsync()];case 2:A.sent();return[3,4];case 3:_===Ec.TOURNAMENT&&g.scoreManager.updateTournamentStartScore();A.label=4;case 4:return[3,6];case 5:k=A.sent();console.warn("handleNextLevel",k);return[3,6];case 6:C=(null!==(E=g.gameData.level)&&void 0!==E?E:1)+1;g.setGameData({level:C});if(_!==Ec.TOURNAMENT)return[3,8];return[4,l_.setMatchCustomDataAsync({level:C})];case 7:A.sent();return[3,11];case 8:return[4,l_.setMatchCustomDataAsync({level:C,score:0})];case 9:A.sent();return[4,l_.startMatchAsync()];case 10:A.sent();A.label=11;case 11:g.stateManager.initialize(),console.log("Next level",g.gameData.level);A.label=12;case 12:return[2]}})}),g.handleStartOver=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){S3.setGameData({level:null!=E?E:1}),g.gameData=S3.getGameData(),g.stateManager.initialize(),console.info("Start over",null===(_=g.gameData)||void 0===_?void 0:_.level);return[2]})});return function(g){return E.apply(this,arguments)}}(),g.handleMaxLevel=function(){g.gameData&&(g.initData(),l1.openScreen(ig.CONGRATULATION_SCREEN,{level:g.gameData.level}),console.info("Max level",g.gameData.level))},g.handleExitGame=Be(function(){return _ts_generator(this,function(g){try{S9.setStorageData("dashboard","animateToCurrentLevel",!0),S9.setStorageData("collection","animateMapPackUnlock",!0)}catch(g){console.warn("handleExitGame",g)}return[2]})}),g.handleTileClick=function(E){g.stateManager.playing(),g.board.handleTileClick(E),g.handleHideHint()},g.handleGridMatchSuccess=function(E,_){g.pathDraw.drawMatchPath(E,function(E){var _=E.x,k=E.y;return g.board.getAnyTileWorldPosition(_,k)}),g.comboManager.addCombo(),g.handleAddScore(),g.effectManager.playClearEffectAt([_[0].node.worldPosition,_[1].node.worldPosition])},g.handleGridMatchFail=function(E){var _;null!==(_=g.guidelinesManager)&&void 0!==_&&_.isShowErrorPathLevel()&&g.pathDraw.drawErrorPath(E,function(E){var _=E.x,k=E.y;return g.board.getAnyTileWorldPosition(_,k)})},g.checkIfGameIsFinish=function(){0===g.board.getUncleared().length&&g.node.scene.emit(r0.GAME_FINISH)},g.handlePauseTime=function(){g.uiManager.pauseTime()},g.handleResumeTime=function(){g.uiManager.resumeTime()},g.handleClockTimeout=function(){g.stateManager.fail(ui)},g.handleHalfTime=function(){void 0!==g.guidelinesManager&&(g.board.getUncleared().length>=g.board.getCleared().length&&g.guidelinesManager.startThunderGuide()||g.board.getBombTiles().length>0&&g.guidelinesManager.startPliersGuide())},g.handleStartRescue=function(){var E,_;for(i5.turnDownMusic(),n7.setBlockInput(!0),g.board.setIgnoreInput(!0);g.rescueTiles.length>0;){var k=g.rescueTiles.pop();null==k||k.restore()}var C=l_.getMatchMode()||void 0;S7.levelRescue(null!==(E=null===(_=g.gameData)||void 0===_?void 0:_.level)&&void 0!==E?E:1,void 0,C)},g.handleFinishRescue=function(){n7.setBlockInput(!1),g.board.setIgnoreInput(!1)},g.handleBombExplode=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.rescueTiles.push(E),g.board.setIgnoreInput(!0),n7.getBlockInput()||(i5.playSound(ic.BOMB_EXPLODE_1),n7.setBlockInput(!0));_=E.node.worldPosition;return[4,g.effectManager.createBombExplosionAt(new em(_.x,_.y,0))];case 1:k.sent(),n7.setBlockInput(!1),g.stateManager.isFail()||g.stateManager.fail(ur);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g.handleShowHint=function(){if(!g.pathDraw.isDrawingHint){var E=g.board.getHintPath();E&&(i5.playSound(ic.HINT_ITEM),g.pathDraw.drawHintPath(E,function(E){return g.board.getAnyTileWorldPosition(E.x,E.y)}),g.board.showHint())}},g.handleHideHint=function(){g.pathDraw.isDrawingHint&&(g.pathDraw.clearHintPath(),g.board.hideHint())},g.handleAddScore=function(){var E=g.levelManager.getLevelData().level,_=g.comboManager.getCombo(),k=g.uiManager.clock.getRemainingTime();g.scoreManager.addScore(E,_,k)},g.handleUseItem=function(E){g.stateManager.playing(),E!==sP.HINT&&g.handleHideHint()},g.handleAutoPlay=function(){g.isAutoPlayEnabled?g.disableAutoPlay():g.enableAutoPlay()},g.enableAutoPlay=function(){g.isAutoPlayEnabled=!0;g.node.scene.once(r0.GAME_FINISH,function(){g.disableAutoPlay()}),g.schedule(g.autoPlay,.5)},g.disableAutoPlay=function(){g.isAutoPlayEnabled=!1,g.unschedule(g.autoPlay)},g.autoPlay=function(){var E=g.board.getHintPath();if(!E)throw new Error("No path found");var _=E[0].a,k=E.slice(-1)[0].b,C=g.board.getTileAt(_.x,_.y),A=g.board.getTileAt(k.x,k.y);if(!C||!A)throw new Error("Tile is null");C.onClick(),A.onClick()},g.handleAddStars=function(E){var _=S3.getGameData();if(!_)return Promise.resolve([]);S3.setGameData({stars:_.stars+1});var k=E.startAnimationAt;k&&g.effectManager.playStarEffectAt(k)},g.handleInviteFriends=Be(function(){var E,_,k,C,A,T,R,I,L,P,O,B,N,M;return _ts_generator(this,function(D){switch(D.label){case 0:D.trys.push([0,2,,3]);l1.showLoadingScreen();C=g.board.generateFenFromCurrentLevel(),A=(null!==(E=S3.getGameData())&&void 0!==E?E:{}).level,T=void 0===A?1:A;T=Math.max(1,T);R=null!==(_=null===(k=g.gameData)||void 0===k?void 0:k.levelData)&&void 0!==_?_:{},I=R.mode,L=void 0===I?"":I,P=R.rules,O=void 0===P?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:P,B=R.time,N=void 0===B?0:B;Et.addWideframeRender("renderResultChallenge",s6);return[4,S8.context.choose.processAsync({playerId:S3.getPlayerId(),fallbackSingleMode:!1,extraData:{level:T,fen:C,gravity:L,rules:O,time:N}})];case 1:D.sent(),l1.closeLoadingScreen(),g.node.scene.emit(r0.GAME_RESUME),g.node.scene.emit(r0.GAME_REPLAY,{level:T});return[3,3];case 2:M=D.sent();if(console.warn("Unable to invite friends",M),l1.closeLoadingScreen(),l1.showNotificationScreen("Sorry, please try again later"),!_instanceof(M,Error))return[2];null==Ee||Ee.sendException(M),g.node.scene.emit(r0.GAME_RESUME),g.node.scene.emit(r0.SHOW_UI);return[3,3];case 3:return[2]}})}),g.handleAdShow=function(E){var _=E.placementId;_&&-1!==Ed.indexOf(_)&&(Ed.splice(Ed.indexOf(_),1),S5.hideBannerAdAsync(_).catch(function(){}),0===Ed.length&&S6.off(Er.AD_SHOWING,g.handleAdShow))},g.handleAddItem=function(){var E=Be(function(E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=E.animate,k=E.item,C=E.quantity,A=Es.search(g.itemManager.items,function(g){return g.itemType===k});if(!(void 0!==A))return[3,2];T=A.getQuantity()+C;A.saveQuantity(T),g.uiManager.setInteractableItemButtons(!1),g.handlePauseGame();return[4,_()];case 1:R.sent(),A.setQuantity(T,!0),g.uiManager.setInteractableItemButtons(!0),g.handleResumeGame();return[3,3];case 2:console.warn("Item ".concat(k," not found"));R.label=3;case 3:return[2]}})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(a,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function(){ll.init()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}},{key:"initUIManager",value:function(){var g;this.uiManager=null===(g=this.node.parent)||void 0===g?void 0:g.getComponentInChildren(S2),this.uiManager.initDevTools(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(my)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(m4)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(ua)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(ve)}},{key:"initItemManager",value:function(){this.itemManager=this.getComponent(mo),this.itemManager.syncItems();var g,E=at(this.itemManager.items);try{for(E.s();!(g=E.n()).done;)g.value.init(this)}catch(g){E.e(g)}finally{E.f()}}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(hp),this.comboManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(mm),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){El.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(me),this.guidelinesManager.init(this))}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){Ed=[],S6.off(Er.AD_SHOWING,this.handleAdShow),S6.clear(Er.OPENING_SCREEN),S6.clear(Er.CLOSING_SCREEN),S6.on(Er.OPENING_SCREEN,this.handleOpenScreen),S6.on(Er.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(r0.SHOW_UI,this.handleShowUI),this.node.scene.on(r0.HIDE_UI,this.handleHideUI),this.node.scene.on(r0.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(r0.GAME_RESUME,this.handleResumeGame),this.node.scene.on(r0.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(r0.GAME_FINISH,this.handleFinishGame),this.node.scene.on(r0.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(r0.START_OVER,this.handleStartOver),this.node.scene.on(r0.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(r0.GAME_EXIT,this.handleExitGame),this.node.scene.on(r0.TILE_CLICK,this.handleTileClick),this.node.scene.on(r0.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(r0.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(r0.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(r0.RESUME_TIME,this.handleResumeTime),this.node.scene.on(r0.TIME_OUT,this.handleClockTimeout),this.node.scene.on(r0.HALF_TIME,this.handleHalfTime),this.node.scene.on(r0.RESCUE_START,this.handleStartRescue),this.node.scene.on(r0.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(r0.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(r0.SHOW_HINT,this.handleShowHint),this.node.scene.on(r0.ADD_SCORE,this.handleAddScore),this.node.scene.on(r0.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(r0.USE_ITEM,this.handleUseItem),this.node.scene.on(r0.ADD_ITEM,this.handleAddItem),this.node.scene.on(r0.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(r0.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(r0.INVITE_FRIENDS,this.handleInviteFriends)}},{key:"start",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.initDataFirstTime();return[4,this.tryInitTournamentMode()];case 1:g.sent(),this.initGame();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"initDataFirstTime",value:function(){var g,E,_=this.getSceneData(),k=(null!=_?_:{}).isFromLoader,C=void 0!==k&&k,A=(null!=_?_:{}).level;void 0===A&&(A=l_.getMatchMode()===Ec.TOURNAMENT?1:null!==(g=null===(E=S3.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:0);this.initData(),this.setGameData({level:A,isFromLoader:C})}},{key:"initData",value:function(){var g,E=this.getSceneData(),_=(null!=E?E:{}).isFromLoader,k=void 0!==_&&_,C=null!==(g=S3.getGameData())&&void 0!==g?g:{},A=C.level,T=void 0===A?1:A,R=C.items;0===T&&k&&R?(R.hint=2,R.thunder=1,R.storm=1,R.pliers=0,S3.setGameData({items:R,coins:500,lastRewardedItems:Date.now()}),this.node.scene.emit(r0.ADD_COINS,{coins:500,playSound:!1})):R&&this.checkItemsRewardable()&&(R.hint<5&&(R.hint+=1),R.thunder<5&&(R.thunder+=1),R.storm<5&&(R.storm+=1),R.pliers<5&&(R.pliers+=1),S3.setGameData({items:R,lastRewardedItems:Date.now()})),this.setGameData(Me(Me({},this.defaultData),{},{level:T}))}},{key:"checkItemsRewardable",value:function(){var g,E=(null!==(g=S3.getGameData())&&void 0!==g?g:{}).lastRewardedItems,_=void 0===E?0:E;return!Eo.isToday(_)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"tryInitTournamentMode",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,L,P,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:if(l_.getMatchMode()!==Ec.TOURNAMENT)return[3,8];_=null!==(g=l_.getMatchCustomData())&&void 0!==g?g:{},k=_.leaderboardId,C=_.tournamentId;if(!(k&&C))return[3,8];return[4,ut.requestTournamentDataAsync()];case 1:N.sent();A=ut.getTournamentDataById(C);if(!A)return[3,8];T=A.payload.themeId;this.setGameData({themeId:T});R=En.getLeaderboardName(k);if(!R)return[3,8];I=null;if(!(null!==(E=this.gameData)&&void 0!==E&&E.isFromLoader))return[3,3];return[4,le.getAllLeaderboardAsync(k)];case 2:I=N.sent();return[3,5];case 3:return[4,le.waitForLeaderboardFinishAsync(R)];case 4:N.sent(),I=En.getLeaderboard(R);N.label=5;case 5:if(!I)return[3,8];this.uiManager.header.tournamentRail.init(I);L=S3.getPlayerId(),P=I.leaders[L];if(!!P)return[3,7];return[4,En.getLeadersByPlayerIdsAsync(R,[L])];case 6:O=N.sent();if(0===O.length)return[2];P=O[0];N.label=7;case 7:B=P.score;S9.setStorageData("tournament","previousScore",B);N.label=8;case 8:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setGameData",value:function(g){var E,_,k,C=null!==(E=null!==(_=g.level)&&void 0!==_?_:null===(k=this.gameData)||void 0===k?void 0:k.level)&&void 0!==E?E:1;this.gameData=Me(Me(Me({},this.gameData),g),{},{level:C})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return lU.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var g,E=null!==(g=this.getGameData())&&void 0!==g?g:{},_=E.level,k=void 0===_?0:_,C=E.nextLevelCount;k<2||(void 0===C?0:C)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(g){console.warn("checkAndCreateShortcutAsync",g)})}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),a}(M)).prototype,"board",[SW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SQ=st(SY.prototype,"opacityToggler",[Sj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SZ=st(SY.prototype,"pathDraw",[SX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SY));_._RF.pop(),_._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var Ef=function(g){return g[g.STAR_CHEST=0]="STAR_CHEST",g[g.BALLOON=1]="BALLOON",g}(Ef||{});Z(Ef),_._RF.pop(),_._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var Ey=function(g){return g.WORLD_TAB_SELECTED="world-tab-selected",g.FRIENDS_TAB_SELECTED="friends-tab-selected",g}(Ey||{}),Ev="#AE4212",Eg="#3D5172",Em="#92200C",Eb="#8F5542",Ew="#8A4733",ES="#3e7110",EE="#3e7110";_._RF.pop(),_._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),_._RF.pop(),_._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);_._RF.pop(),_._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),_._RF.pop(),_._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),_._RF.pop(),_._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var E_=k.ccclass,Ek=globalThis.game,EC=Ek.player,EA=Ek.analytics,ET=GameCore.Plugins.Analytics.Events;E_("HintItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l1.openScreen(ig.GET_ITEM_SCREEN,{item:sP.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},g.loadQuantity=function(){var g=EC.getGameData();return null!=g&&g.items&&g?g.items[sP.HINT]:0},g}return Ue(i,[{key:"itemType",get:function(){return sP.HINT}},{key:"init",value:function(g){this.boardInstance=g.board,this.pathDrawer=g.pathDraw,this.setQuantity(this.loadQuantity()),Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nk.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>0}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.pathDrawer.isDrawingHint;if(g)return[3,5];if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:E=_.sent();return[3,4];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:E=(_.sent(),EA.event(ET.USE_ITEM,{item_name:sP.HINT}),this.node.scene.emit(r0.USE_ITEM,sP.HINT),this.node.scene.emit(r0.SHOW_HINT));_.label=4;case 4:g=E;_.label=5;case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=EC.getGameData();C&&EC.setGameData({items:Me(Me({},C.items),{},Ge({},sP.HINT,_))})}}]),i}(mr));_._RF.pop(),_._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var ER=k.ccclass,EI=globalThis.game,EL=EI.player,EP=EI.analytics,EO=GameCore.Plugins.Analytics.Events;ER("PliersItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l1.openScreen(ig.GET_ITEM_SCREEN,{item:sP.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},g.loadQuantity=function(){var g=EL.getGameData();return null!=g&&g.items&&g?g.items[sP.PLIERS]:0},g}return Ue(i,[{key:"itemType",get:function(){return sP.PLIERS}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nk.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getBombTiles().length>0}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:_.sent();return[3,4];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:_.sent(),EP.event(EO.USE_ITEM,{item_name:sP.PLIERS}),this.node.scene.emit(r0.USE_ITEM,sP.PLIERS);g=Gh(this.boardInstance.getBombTiles()),E=g.node.worldPosition;this.effectManager.createDefuseExplosionAt(new em(E.x,E.y,0)),i5.playSound(ic.BOMB_DEFUSE),g.special.switch(uK.none),this.applyActivationStatus();_.label=4;case 4:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=EL.getGameData();C&&EL.setGameData({items:Me(Me({},C.items),{},Ge({},sP.PLIERS,_))})}}]),i}(mr));_._RF.pop(),_._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var EB=k.ccclass,EN=globalThis.game,EM=EN.player,ED=EN.analytics,EF=GameCore.Plugins.Analytics.Events;EB("StormItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l1.openScreen(ig.GET_ITEM_SCREEN,{item:sP.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},g.loadQuantity=function(){var g=EM.getGameData();return null!=g&&g.items&&g?g.items[sP.STORM]:0},g}return Ue(i,[{key:"itemType",get:function(){return sP.STORM}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nk.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>2}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this;if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:k.sent();return[3,6];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:if(k.sent(),ED.event(EF.USE_ITEM,{item_name:sP.STORM}),this.node.scene.emit(r0.USE_ITEM,sP.STORM),this.node.scene.emit(r0.HIDE_UI),!this.effectManager)return[3,6];return[4,tZ.waitTweenAsync(.5)];case 4:E=k.sent();return[4,Promise.race([this.effectManager.loadTornadoAnimation(),E])];case 5:if(k.sent(),this.effectManager){_=function(){var E=Be(function(E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:i5.setVolumeMusic(0,!0),i5.playSound(ic.SHUFFLE_ITEM),i5.playSound(ic.WIND);k=function(){var E=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:_.forEach(function(g,E,k){g.node.setSiblingIndex(_.asArray().length-1-(E+k*_.width))});return[4,Promise.all(_.map(function(E){return E.fly({getTilePosition:function(E){return Lh(_,g.boardInstance.getTileSize(),E)}})}))];case 1:E.sent();return[2]}})});return function(){return E.apply(this,arguments)}}();return[4,Promise.all(E.map(function(_,k,C){return _.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return Lh(E,g.boardInstance.getTileSize(),{x:k,y:C},10)}})}))];case 1:C.sent(),g.effectManager.playTornadoAnimation();return[4,k()];case 2:C.sent(),g.node.scene.emit(r0.SHOW_UI),i5.setVolumeMusic(.3,!0);return[2]}})});return function(g,_){return E.apply(this,arguments)}}();this.boardInstance.processShuffleRequest(_)}k.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=EM.getGameData();C&&EM.setGameData({items:Me(Me({},C.items),{},Ge({},sP.STORM,_))})}}]),i}(mr));_._RF.pop(),_._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var EU,Ex,Ez,EG,EV,EK,EH,Eq,EW,Ej,EX,EY,EJ,EQ,EZ,E$,E0,E1,E2=k.ccclass,E4=globalThis.game,E3=E4.player,E5=E4.analytics,E6=GameCore.Plugins.Analytics.Events;E2("ThunderItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l1.openScreen(ig.GET_ITEM_SCREEN,{item:sP.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},g.loadQuantity=function(){var g=E3.getGameData();return null!=g&&g.items&&g?g.items[sP.THUNDER]:0},g}return Ue(i,[{key:"itemType",get:function(){return sP.THUNDER}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nk.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>=4}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:_.sent();return[3,6];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:_.sent(),E5.event(E6.USE_ITEM,{item_name:sP.THUNDER}),this.node.scene.emit(r0.USE_ITEM,sP.THUNDER),this.node.scene.emit(r0.HIDE_UI);return[4,this.effectManager.loadThunderAnimation()];case 4:_.sent();g=this.boardInstance.getUncleared();if(g.length<4)return[3,6];i5.setVolumeMusic(0,!0);E=this.boardInstance.getPairs(2);n7.setBlockInput(!0),this.boardInstance.clearSelectedTile();return[4,this.effectManager.playThunderAnimation(E,this.boardInstance)];case 5:_.sent(),(g=this.boardInstance.getUncleared()).length>0&&this.node.scene.emit(r0.SHOW_UI),i5.setVolumeMusic(.3,!0),n7.setBlockInput(!1);_.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=E3.getGameData();C&&E3.setGameData({items:Me(Me({},C.items),{},Ge({},sP.THUNDER,_))})}}]),i}(mr));_._RF.pop(),_._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var E8,E9,E7,_e,_t,_n,_i,_r,_a,_o,_s,_l=k.ccclass,_u=k.property,_c=(EU=_l("Coin"),Ex=_u(eV),Ez=_u(G),EG=_u(ei),EV=_u(ei),EK=nk.onlyRunInLifeCycle,EH=nk.onlyRunInLifeCycle,Eq=nk.onlyRunInLifeCycle,EW=nk.onlyRunInLifeCycle,Ej=nk.onlyRunInLifeCycleAsync,EX=nk.onlyRunInLifeCycleAsync,EY=nk.onlyRunInLifeCycle,EU((EZ=st((EQ=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"emittingParticles",EZ,Ke(g)),rt(g,"animation",E$,Ke(g)),rt(g,"spin",E0,Ke(g)),rt(g,"rest",E1,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){nk.lazyValidateProperties(this)}},{key:"resetDisabled",value:function(){this.stopParticles(),this.stopAnimation(),this.hide(),this.node.active=!1,this.node.setPosition(0,0,this.node.position.z)}},{key:"hide",value:function(){this.node.setScale(em.ZERO)}},{key:"stopParticles",value:function(){this.emittingParticles.stopSystem()}},{key:"playTrailParticles",value:function(){this.emittingParticles.resetSystem()}},{key:"playSpinAnimationAfterDelay",value:(E=Be(function(){var g,E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:g=k.length>0&&void 0!==k[0]?k[0]:0,E=k.length>1?k[1]:void 0;_=g>0;if(!_)return[3,2];return[4,tZ.waitTweenAsync(g)];case 1:_=C.sent();C.label=2;case 2:return[4,this.playSpinAnimation(E)];case 3:C.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"playSpinAnimation",value:function(g){return tZ.runAnimationAsync(this.animation,this.spin.name,g)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),i}(M)).prototype,"emittingParticles",[Ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E$=st(EQ.prototype,"animation",[Ez],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E0=st(EQ.prototype,"spin",[EG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E1=st(EQ.prototype,"rest",[EV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(EQ.prototype,"resetDisabled",[EK],Object.getOwnPropertyDescriptor(EQ.prototype,"resetDisabled"),EQ.prototype),st(EQ.prototype,"hide",[EH],Object.getOwnPropertyDescriptor(EQ.prototype,"hide"),EQ.prototype),st(EQ.prototype,"stopParticles",[Eq],Object.getOwnPropertyDescriptor(EQ.prototype,"stopParticles"),EQ.prototype),st(EQ.prototype,"playTrailParticles",[EW],Object.getOwnPropertyDescriptor(EQ.prototype,"playTrailParticles"),EQ.prototype),st(EQ.prototype,"playSpinAnimationAfterDelay",[Ej],Object.getOwnPropertyDescriptor(EQ.prototype,"playSpinAnimationAfterDelay"),EQ.prototype),st(EQ.prototype,"playSpinAnimation",[EX],Object.getOwnPropertyDescriptor(EQ.prototype,"playSpinAnimation"),EQ.prototype),st(EQ.prototype,"stopAnimation",[EY],Object.getOwnPropertyDescriptor(EQ.prototype,"stopAnimation"),EQ.prototype),EJ=EQ))||EJ);_._RF.pop(),_._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var _h,_p,_d,_f,_y,_v,_g,_m,_b,_w,_S,_E,__,_k,_C,_A,_T,_R,_I=k.ccclass,_L=k.property,_P=em.ZERO.clone().add3f(0,-100,0),_O=em.ZERO.clone().add3f(0,100,0),_B=GameCore.Utils.Number,_N=(E8=_I("CoinTextPopup"),E9=_L(L),E7=_L(eu),_e=nk.onlyRunInLifeCycle,_t=nk.onlyRunInLifeCycle,_n=nk.onlyRunInLifeCycleAsync,_i=nk.onlyRunInLifeCycleAsync,E8((_o=st((_a=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"label",_o,Ke(g)),rt(g,"uiOpacity",_s,Ke(g)),g}return Ue(o,[{key:"__preload",value:function(){nk.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(k=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:this.enableNode(),this.initializePopup(g);return[4,this.showTextPopupAnimation(E)];case 1:_.sent();return[4,this.hidePopup()];case 2:_.sent(),this.disableNode();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"enableNode",value:function(){this.node.active=!0}},{key:"disableNode",value:function(){this.node.active=!1}},{key:"initializePopup",value:function(g){var E=_B.getShortNumber(g,3);this.label.string=E,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(_P)}},{key:"hidePopup",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.node.setScale(em.ONE),this.node.setPosition(_O);return[4,tZ.runTweenAsync(z(this.uiOpacity).to(.5,{opacity:0}))];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"showTextPopupAnimation",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all([tZ.runTweenAsync(z(this.node).to(1.5,{position:_O},{easing:"sineOut"}),g),tZ.runTweenAsync(z(this.node).to(.5,{scale:em.ONE},{easing:"backOut"}),g)])];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})}]),o}(M)).prototype,"label",[E9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_s=st(_a.prototype,"uiOpacity",[E7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(_a.prototype,"disableNode",[_e],Object.getOwnPropertyDescriptor(_a.prototype,"disableNode"),_a.prototype),st(_a.prototype,"initializePopup",[_t],Object.getOwnPropertyDescriptor(_a.prototype,"initializePopup"),_a.prototype),st(_a.prototype,"hidePopup",[_n],Object.getOwnPropertyDescriptor(_a.prototype,"hidePopup"),_a.prototype),st(_a.prototype,"showTextPopupAnimation",[_i],Object.getOwnPropertyDescriptor(_a.prototype,"showTextPopupAnimation"),_a.prototype),_r=_a))||_r);_._RF.pop(),_._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var _M,_D=k.ccclass,_F=k.disallowMultiple,_U=k.property,_x=globalThis.game,_z=_x.player,_G=_x.monitorError,_V=999999999,_K=10,_H=1,_q=1,_W=(_h=_D("CoinManager"),_p=nk.required(),_d=_U(ee),_f=nk.required(),_y=_U(ee),_v=nk.required(),_g=_U(C),_m=nk.onlyRunInLifeCycleAsync,_b=nk.onlyRunInLifeCycleAsync,_w=nk.onlyRunInLifeCycleAsync,_S=nk.onlyRunInLifeCycleAsync,_E=nk.onlyRunInLifeCycleAsync,__=nk.onlyRunInLifeCycleAsync,_h(_k=_F((_A=st((_C=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=A.call.apply(A,[this].concat(_))).coins=0,rt(g,"coinPrefab",_A,Ke(g)),rt(g,"coinTextPopup",_T,Ke(g)),rt(g,"coinAnimContainer",_R,Ke(g)),g.coinObjects=[],g}return Ue(r,[{key:"onLoad",value:function(){nk.decorateComponent(this),this.getCoinsFromPlayerData(),this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(){this.updateCoins({coins:this.coins})}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(r0.ADD_COINS,this.addCoins,this),this.node.scene.on(r0.REMOVE_COINS,this.removeCoins,this),this.node.scene.on(r0.ABORT_COIN_ANIMATION,this.abortCoinAnimation,this)}},{key:"prepareCoinCollection",value:function(){for(var g=0;g<_K;g++){var E=I(this.coinPrefab);E.setParent(this.coinAnimContainer),E.setPosition(0,0),E.active=!1,this.coinObjects.push(E.getComponent(_c))}}},{key:"prepareCoinTextPopup",value:function(){var g=I(this.coinTextPopup);g.setParent(this.node),g.active=!1,this.coinTextPopupNode=g.getComponent(_N)}},{key:"handleCollectionAnim",value:(C=Be(function(g,E,_,k,C){var A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this;if(!E)return[3,2];T=this.coinObjects.slice(0,this.getShortAmount(g));if(0===T.length)return[2,(console.warn("Requested coins amount is ".concat(g,". Shortened to ").concat(this.getShortAmount(g),". No coin objects was found to animate collection.")),void(null==_G||_G.sendException(new Error("Requested coins amount is ".concat(g,". Shortened to ").concat(this.getShortAmount(g),". No coin objects was found to animate collection.")),{coins:g,animatedCoins:T.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!E,coinCollectionCount:this.coinObjects.length})))];i5.playSound(ic.COLLECT_STOCK_COINS);return[4,Promise.all([this.playCoinFlyAndexplodeAnimation(E,T,_,k,C),tZ.waitTweenAsync(_+k/2,C).then(function(){return A.animateCoinTextPopup(g,C)})])];case 1:R.sent(),C.abort();return[3,3];case 2:console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played");R.label=3;case 3:return[2]}})}),function(g,E,_,k,A){return C.apply(this,arguments)})},{key:"playCoinFlyAndexplodeAnimation",value:(k=Be(function(g,E,_,k,C){var A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this,T=_+k;return[4,Promise.all([].concat(tt(E.flatMap(function(E){E.node.active=!0,E.stopParticles();var T=[0,.5*Math.min(_,k)],R=eR.apply(void 0,T),I=_-R,L=k+R;return[A.animateCoinExplode(E.node,I,C),tZ.waitTweenAsync(I,C).then(function(){return A.animateCoinFlyBack(g,E,L,C)})]})),[tZ.waitTweenAsync(T,C).then(function(){return g.emitExplodeEffect(C)})]))];case 1:R.sent();return[2]}})}),function(g,E,_,C,A){return k.apply(this,arguments)})},{key:"animateCoinTextPopup",value:function(g,E){return this.coinTextPopupNode.show(g,E)}},{key:"animateCoinFlyBack",value:(_=Be(function(g,E,_,k){var C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:C=E.node.worldPosition.clone(),A=em.ZERO.clone(),T=g.getCoinIconWorldScale();return[4,tZ.runTweenAsync(z(E.node).to(_,{scale:T},{onStart:function(){E.playSpinAnimationAfterDelay(0,k),E.playTrailParticles()},onUpdate:function(_,k){if(void 0!==k){var T=el.cubicIn(k),R=g.getCoinIconWorldPosition();E.node.worldPosition=em.lerp(A,C,R,T)}},onComplete:function(){E.emittingParticles.stopSystem(),E.stopAnimation(),E.hide()}}),k)];case 1:R.sent();return[4,tZ.waitTweenAsync(1,k)];case 2:R.sent(),E.resetDisabled();return[2]}})}),function(g,E,k,C){return _.apply(this,arguments)})},{key:"animateCoinExplode",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=[-200,200],C=[-200,200],A=eR(k[0],k[1]),T=eR(C[0],C[1]);g.setPosition(0,0,g.position.z),g.setScale(em.ZERO);R=new em(A,T,g.position.z);return[4,Promise.all([tZ.runTweenAsync(z(g).delay(.1*E).to(.8*E,{scale:em.ONE},{easing:"elasticOut"}),_),tZ.runTweenAsync(z(g).to(E,{position:R},{easing:"circOut"}),_)])];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var g=_z.getGameData();this.coins=g?g.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(g){var E,_;if(this.coins>_V&&(this.coins=_V),g.coins!==this.coins){var k=Math.max(0,g.coins-this.coins);this.coins=g.coins,_z.setGameData({coins:this.coins});var C=g.collectionAnimation;null===(E=this.collectionAnimSignal)||void 0===E||E.abort();var A=new nN;if(this.collectionAnimSignal=A,null==C||null===(_=C.signal)||void 0===_||_.chain(A),void 0===C||C.animateTextOnly)this.node.scene.emit(r0.COIN_CHANGED,Me(Me({},g),{},{collectionAnimation:{animateTextOnly:!0,signal:null==C?void 0:C.signal}}));else{var T=C.floatDuration,R=void 0===T?_H:T,I=C.flyDuration,L=void 0===I?_q:I,P=C.target,O=void 0===P?this.targetContainer:P;this.collectionAnimSignal=A,this.targetContainer=O;var B=Me(Me({},g),{},{collectionAnimation:{floatDuration:R,flyDuration:L,animateTextOnly:!1,signal:A,target:O}});this.node.scene.emit(r0.COIN_CHANGED,B),this.handleCollectionAnim(k,this.targetContainer,R,L,A)}}}},{key:"addCoins",value:function(g){this.updateCoins(Me(Me({},g),{},{coins:this.coins+g.coins}))}},{key:"removeCoins",value:function(g){this.coins<g.coins?this.node.scene.emit(r0.REMOVE_COINS_FAILED):(this.updateCoins(Me(Me({},g),{},{coins:this.coins-g.coins})),this.node.scene.emit(r0.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(r0.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(g){return Math.min(g,_K)}},{key:"abortCoinAnimation",value:function(){var g;null===(g=this.collectionAnimSignal)||void 0===g||g.abort()}},{key:"untilFinishesCollectAnim",value:function(){return void 0===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(g){this.targetContainer=g}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var g;null===(g=this.collectionAnimSignal)||void 0===g||g.abort()}}]),r}(M)).prototype,"coinPrefab",[_p,_d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_T=st(_C.prototype,"coinTextPopup",[_f,_y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_R=st(_C.prototype,"coinAnimContainer",[_v,_g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(_C.prototype,"handleCollectionAnim",[_m],Object.getOwnPropertyDescriptor(_C.prototype,"handleCollectionAnim"),_C.prototype),st(_C.prototype,"playCoinFlyAndexplodeAnimation",[_b],Object.getOwnPropertyDescriptor(_C.prototype,"playCoinFlyAndexplodeAnimation"),_C.prototype),st(_C.prototype,"animateCoinTextPopup",[_w],Object.getOwnPropertyDescriptor(_C.prototype,"animateCoinTextPopup"),_C.prototype),st(_C.prototype,"animateCoinFlyBack",[_S],Object.getOwnPropertyDescriptor(_C.prototype,"animateCoinFlyBack"),_C.prototype),st(_C.prototype,"animateCoinExplode",[_E],Object.getOwnPropertyDescriptor(_C.prototype,"animateCoinExplode"),_C.prototype),st(_C.prototype,"untilFinishesCollectAnim",[__],Object.getOwnPropertyDescriptor(_C.prototype,"untilFinishesCollectAnim"),_C.prototype),_k=_C))||_k)||_k);_._RF.pop(),_._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),_._RF.pop(),_._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),_._RF.pop(),_._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),_._RF.pop(),_._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),_._RF.pop(),_._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var _j,_X,_Y,_J,_Q,_Z,_$,_0,_1,_2,_4,_3=k.ccclass,_5=k.disallowMultiple,_6=GameCore,_8=_6.Events,_9=_6.Configs,_7=_6.Utils.Valid,ke=globalThis.game,kt=ke.ads,kn=ke.player,ki=ke.event;_3("BootScene")(_M=_5(_M=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).processWhenGameSdkStarted=function(){g.setupGameData(),g.processPreloadAssets()},g.processPreloadAssets=function(){g.loadCurrentPlayerTheme().catch(function(g){return console.error("loadCurrentPlayerTheme",g)})},g.handlePauseAudio=function(){ki.on(_8.VISIBILITY_HIDDEN,g.handleMuteAudio),ki.on(_8.VISIBILITY_VISIBLE,g.handleUnMuteAudio)},g.handleMuteAudio=function(){i5.muteAudio(!0)},g.handleUnMuteAudio=function(){kt.isAdFullSizeShowing()||i5.muteAudio(!1)},g}return Ue(n,[{key:"__preload",value:function(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.listenEvents()}},{key:"onLoad",value:function(){this.handlePauseAudio(),_9.Core.StartSDKAfterLoadGame||l1.showLoadingFullScreen(sJ)}},{key:"start",value:function(){this.processCrazyGamesLoadingStop()}},{key:"listenEvents",value:function(){ki.getEventEmitCount(_8.GAME_SDK_STARTED)>0?this.processWhenGameSdkStarted():ki.once(_8.GAME_SDK_STARTED,this.processWhenGameSdkStarted)}},{key:"setupGameData",value:function(){var g=kn.getGameData();if(g){var E=g.totalLevel,_=Math.max(E,400),k=Me(Me({},g),{},{totalLevel:_});kn.setGameData(k)}}},{key:"loadCurrentPlayerTheme",value:function(){var g=lt.mapOrder,E=g[0],_=kn.getGameData(),k=null==_?void 0:_.level;if(!_7.isNumber(k))return n7.loadThemeAsync(E.theme);var C,A=at(g);try{for(A.s();!(C=A.n()).done;){var T=C.value;if((k-=T.levelCount)<=0){E=T;break}}}catch(g){A.e(g)}finally{A.f()}return n7.loadThemeAsync(E.theme)}},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}}]),n}(M))||_M);_._RF.pop(),_._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var kr,ka,ko,ks,kl,ku,kc,kh,kp,kd,kf,ky,kv=k.ccclass,kg=k.property,km=(_j=kv("RigidBodyObject"),_X=kg(K),_Y=kg(eS),_J=kg(K),_Q=kg(J),_j((_0=st((_$=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"gravityScale",_0,Ke(g)),rt(g,"linearVelocity",_1,Ke(g)),rt(g,"bounce",_2,Ke(g)),rt(g,"simulate",_4,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(T).getComponent(R),this.uiTransform=this.node.getComponent(R)}},{key:"update",value:function(g){if(this.simulate){this.applyGravity();var E=this.node.worldPosition.clone();E.add(new em(this.linearVelocity.x*g,this.linearVelocity.y*g,0)),E=this.applyBounce(E),this.node.setWorldPosition(E)}}},{key:"applyForce",value:function(g){this.linearVelocity.add(g)}},{key:"applyGravity",value:function(){var g=new eS(0,-9.8*this.gravityScale);this.applyForce(g)}},{key:"applyBounce",value:function(g){var E=this.uiTransform.getBoundingBoxToWorld();E.yMin<0&&(g.y=E.height/2,this.linearVelocity.y*=-this.bounce),E.xMin<0&&(g.x=E.width/2,this.linearVelocity.x*=-1);var _=this.canvas.width;return E.xMax>_&&(g.x=_-E.width/2,this.linearVelocity.x*=-1),g}}]),n}(M)).prototype,"gravityScale",[_X],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_1=st(_$.prototype,"linearVelocity",[_Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(0,0)}}),_2=st(_$.prototype,"bounce",[_J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_4=st(_$.prototype,"simulate",[_Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_Z=_$))||_Z);_._RF.pop(),_._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var kb,kw,kS,kE,k_,kk,kC,kA,kT,kR,kI,kL,kP,kO,kB,kN,kM=k.ccclass,kD=k.property,kF=k.disallowMultiple,YI=function(){},kU=(kr=kM("AnimSkipOverlay"),ka=kD(eu),ko=kD(eu),ks=kD(B),kl=nk.onlyRunInLifeCycleAsync,ku=nk.onlyRunInLifeCycleAsync,kc=nk.onlyRunInLifeCycleAsync,kr(kh=kF((kd=st((kp=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"containerUIOpacity",kd,Ke(g)),rt(g,"maskUIOpacity",kf,Ke(g)),rt(g,"skipButton",ky,Ke(g)),g.isOpened=!1,g.currentCallback=YI,g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"open",value:(_=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.containerUIOpacity.node.active=!0;E=g.onSkip,_=g.opacity,k=void 0===_?255:_,C=g.transitionDuration,A=void 0===C?.2:C;this.maskUIOpacity.opacity=k;return[4,this.animateUIOpacity(0,255,A)];case 1:T.sent(),this.currentCallback=E,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(t9,g);return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"close",value:(E=Be(function(){var g;var E=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:g=E.length>0&&void 0!==E[0]?E[0]:.2;this.skipButton.interactable=!1,this.currentCallback=YI;return[4,this.animateUIOpacity(255,0,g)];case 1:_.sent(),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(t7);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"animateUIOpacity",value:function(g,E,_){return this.containerUIOpacity.opacity=g,tZ.runTweenAsync(z(this.containerUIOpacity).to(_,{opacity:E}))}},{key:"untilClosed",value:function(){var g=this;return!1===this.isOpened?Promise.resolve():new Promise(function(E){g.node.scene.once(t7,E)})}}]),a}(M)).prototype,"containerUIOpacity",[ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kf=st(kp.prototype,"maskUIOpacity",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ky=st(kp.prototype,"skipButton",[ks],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(kp.prototype,"open",[kl],Object.getOwnPropertyDescriptor(kp.prototype,"open"),kp.prototype),st(kp.prototype,"close",[ku],Object.getOwnPropertyDescriptor(kp.prototype,"close"),kp.prototype),st(kp.prototype,"untilClosed",[kc],Object.getOwnPropertyDescriptor(kp.prototype,"untilClosed"),kp.prototype),kh=kp))||kh)||kh);_._RF.pop(),_._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var kx,kz,kG,kV,kK,kH,kq,kW,kj,kX,kY,kJ,kQ,kZ,k$,k0,k1=k.ccclass,k2=k.property,k4=GameCore.Utils.Number,k3=(kb=k1("CoinContainer"),kw=k2(L),kS=k2(eo),kE=k2(eu),k_=k2(eV),kk=nk.onlyRunInLifeCycle,kC=nk.onlyRunInLifeCycleAsync,kA=nk.onlyRunInLifeCycleAsync,kT=nk.onlyRunInLifeCycle,kR=nk.onlyRunInLifeCycle,kb((kP=st((kL=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"coinLabel",kP,Ke(g)),rt(g,"coinIcon",kO,Ke(g)),rt(g,"explosionCircle",kB,Ke(g)),rt(g,"explosionParticles",kN,Ke(g)),g.currentCoin=0,g}return Ue(o,[{key:"setCoinText",value:function(g){this.coinLabel.string=g}},{key:"handleAddCoinButton",value:function(){l1.openScreen(ig.GET_COIN_SCREEN,{quantity:sF})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(r0.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(k=Be(function(g){var E,_,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:C=g.coins,A=g.collectionAnimation,T=g.playSound;if(!(void 0!==A&&!1!==this.node.activeInHierarchy))return[3,4];R=A.signal;if(null===(E=this.animAbortSignal)||void 0===E||E.abort(),this.animAbortSignal=null!=R?R:new nN,!A.animateTextOnly)return[3,2];return[4,this.animateCoinText(C,0,T,R)];case 1:return[2,(P.sent(),void this.setCoins(C))];case 2:I=null!==(_=A.flyDuration)&&void 0!==_?_:0,L=(null!==(k=A.floatDuration)&&void 0!==k?k:0)+I;return[4,this.animateCoinText(C,L,T,R)];case 3:P.sent(),this.setCoins(C);return[3,5];case 4:this.setCoins(C);P.label=5;case 5:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setCoins",value:function(g){this.setCoinText(k4.getShortNumber(g,3)),this.currentCoin=g}},{key:"animateCoinText",value:(_=Be(function(g,E){var _,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:_=this,k=!(T.length>2&&void 0!==T[2])||T[2],C=T.length>3?T[3]:void 0,A=this.currentCoin;return[4,tZ.waitTweenAsync(E,C)];case 1:R.sent(),k&&i5.playSound(ic.COLLECT_COINS);return[4,tZ.runOnUpdateAsync(this.node,1,function(E){var k=Math.round(A+(g-A)*E);_.setCoinText(k4.getShortNumber(k,3))},C)];case 2:R.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"emitExplodeEffect",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.initializeExplosionCircle(),this.explosionParticles.resetSystem();return[4,Promise.all([tZ.runTweenAsync(z(this.explosionCircle.node).to(.4,{scale:new em(3,3,3)},{easing:"quadOut"}),g),tZ.runTweenAsync(z(this.explosionCircle).delay(.2).to(.2,{opacity:0}),g)])];case 1:E.sent(),this.resetExplosionCircle();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"resetExplosionCircle",value:function(){this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0}},{key:"initializeExplosionCircle",value:function(){this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0)}},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var g;null===(g=this.animAbortSignal)||void 0===g||g.abort()}}]),o}(M)).prototype,"coinLabel",[kw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kO=st(kL.prototype,"coinIcon",[kS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kB=st(kL.prototype,"explosionCircle",[kE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kN=st(kL.prototype,"explosionParticles",[k_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(kL.prototype,"setCoins",[kk],Object.getOwnPropertyDescriptor(kL.prototype,"setCoins"),kL.prototype),st(kL.prototype,"animateCoinText",[kC],Object.getOwnPropertyDescriptor(kL.prototype,"animateCoinText"),kL.prototype),st(kL.prototype,"emitExplodeEffect",[kA],Object.getOwnPropertyDescriptor(kL.prototype,"emitExplodeEffect"),kL.prototype),st(kL.prototype,"resetExplosionCircle",[kT],Object.getOwnPropertyDescriptor(kL.prototype,"resetExplosionCircle"),kL.prototype),st(kL.prototype,"initializeExplosionCircle",[kR],Object.getOwnPropertyDescriptor(kL.prototype,"initializeExplosionCircle"),kL.prototype),kI=kL))||kI);_._RF.pop(),_._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);var k5,k6=k.ccclass,k8=k.property,k9=globalThis.game.player,k7=[1e3,1500];kx=k6("ItemContainer"),kz=k8({type:C,group:"Hint"}),kG=k8({type:L,group:"Hint"}),kV=k8({type:C,group:"Thunder"}),kK=k8({type:L,group:"Thunder"}),kH=k8({type:C,group:"Storm"}),kq=k8({type:L,group:"Storm"}),kW=k8(ee),kx((kX=st((kj=function(g){ze(u,g);var E,_,k,C,A,R=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"hintNode",kX,Ke(g)),rt(g,"hintLabel",kY,Ke(g)),g.hintCollection=[],rt(g,"thunderNode",kJ,Ke(g)),rt(g,"thunderLabel",kQ,Ke(g)),g.thunderCollection=[],rt(g,"stormNode",kZ,Ke(g)),rt(g,"stormLabel",k$,Ke(g)),g.stormCollection=[],rt(g,"itemPrefab",k0,Ke(g)),g}return Ue(u,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(T).node,this.widget=this.getComponent(H),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents(),this.listenToEvents()}},{key:"start",value:function(){this.prepareItemCollection()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(r0.ADD_ITEMS,this.handleAddItems,this)}},{key:"prepareItemCollection",value:function(){for(var g=0;g<9;g++){var E=I(this.itemPrefab),_=I(this.itemPrefab),k=I(this.itemPrefab);E.parent=this.canvas,_.parent=this.canvas,k.parent=this.canvas,E.active=!1,_.active=!1,k.active=!1,this.hintCollection.push(E.getComponent(km)),this.thunderCollection.push(_.getComponent(km)),this.stormCollection.push(k.getComponent(km))}}},{key:"updateStatus",value:function(g){var E=g.items;this.hintLabel.string="".concat(E.hint),this.thunderLabel.string="".concat(E.thunder),this.stormLabel.string="".concat(E.storm)}},{key:"show",value:(A=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.uiOpacity.opacity=255;g=z(this.widget).to(1.5,{right:0},{easing:"quadOut"});return[4,tZ.runTweenAsync(g,this.animAbortSignal)];case 1:E.sent(),this.widget.right=0;return[2]}})}),function(){return A.apply(this,arguments)})},{key:"hide",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=z(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"});return[4,tZ.runTweenAsync(g)];case 1:E.sent(),this.uiOpacity.opacity=0;return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleAddItems",value:(k=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=this;this.animAbortSignal=null!==(E=g.signal)&&void 0!==E?E:new nN;k=k9.getGameData();if(!k)return[3,3];this.updateStatus(k);C=this.show(),A=g.items.map(function(g){return _.animateItemCollection(g.item,g.quantity,1.5)});return[4,Promise.all([C].concat(tt(A)))];case 1:T.sent(),k.items=Me(Me({},k.items),{},{hint:k.items.hint+g.items[0].quantity,thunder:k.items.thunder+g.items[1].quantity,storm:k.items.storm+g.items[2].quantity}),k9.setGameData(k),this.updateStatus(k);return[4,this.hide()];case 2:T.sent();T.label=3;case 3:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"animateItemCollection",value:(_=Be(function(g,E,_){var k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:k=this,C=this.getItemCollection(g).slice(0,E);if(!(0!==C.length))return[3,2];A=C.map(function(E,C){E.node.active=!0,E.node.position=new em(0,0,E.node.position.z),E.linearVelocity=new eS(0,0),E.simulate=!0;var A=eR(Math.PI/3,2*Math.PI/3),T=eR(k7[0],k7[1])*Math.cos(A),R=eR(k7[0],k7[1])*Math.sin(A);E.applyForce(new eS(T,R));var I=k.getTargetNode(g);if(I)return E.getComponent(eo).spriteFrame=I.getComponent(eo).spriteFrame,k.getItemAnimation(E,I,_+.03*C)});return[4,Promise.all(A)];case 1:T.sent();T.label=2;case 2:return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"getItemCollection",value:function(g){switch(g){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}},{key:"getTargetNode",value:function(g){switch(g){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}},{key:"getItemAnimation",value:(E=Be(function(g,E){var _,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:_=A.length>2&&void 0!==A[2]?A[2]:0;g.node.scale=new em(2,2,2);return[4,tZ.waitTweenAsync(_,this.animAbortSignal)];case 1:T.sent();k=g.node.worldPosition.clone(),C=z(g.node).to(1,{scale:E.scale},{onUpdate:function(_,C){if(_&&C){var A=el.cubicIn(C);E&&(g.node.worldPosition=k.lerp(E.worldPosition,A))}},onComplete:function(){g.node.setPosition(0,0),g.node.active=!1}});return[4,tZ.runTweenAsync(C,this.animAbortSignal)];case 2:T.sent(),g.node.scale=E.scale.clone(),g.node.setPosition(0,0),g.node.active=!1;return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"onDestroy",value:function(){var g;null===(g=this.animAbortSignal)||void 0===g||g.abort()}}]),u}(M)).prototype,"hintNode",[kz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kY=st(kj.prototype,"hintLabel",[kG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kJ=st(kj.prototype,"thunderNode",[kV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kQ=st(kj.prototype,"thunderLabel",[kK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kZ=st(kj.prototype,"stormNode",[kH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k$=st(kj.prototype,"stormLabel",[kq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k0=st(kj.prototype,"itemPrefab",[kW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kj));_._RF.pop(),_._RF.push({},"904917NfYBJy781QxKjEPIO","ViewNode",void 0);var Ce,Ct,Cn,Ci,Cr,Ca,Co,Cs,Cl,Cu,Cc,Ch,Cp,Cd,Cf,Cy,Cv,Cg,Cm,Cb,Cw,CS,CE,C_,Ck=k.ccclass,CC=k.requireComponent,CA=Ck("ViewNode")(k5=CC(eu)(k5=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).order=0,g}return Ue(n,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"setVisible",value:function(g){this.uiOpacity.opacity=g?255:0}},{key:"isVisible",value:function(){return this.uiOpacity.opacity>0}}]),n}(M))||k5)||k5;_._RF.pop(),_._RF.push({},"0b250nSw/RHRq8vKigzgfhs","ScrollViewLayout",void 0);var CT,CR,CI,CL,CP,CO,CB,CN,CM,CD,CF,CU,Cx,Cz,CG,CV,CK,CH,Cq,CW,Cj,CX,CY,CJ,CQ,CZ,C$,C0,C1,C2,C4,C3,C5,C6,C8=k.ccclass,C9=k.property,C7=k.requireComponent,Ae=GameCore.Utils.Array,At=(Ce=C8("ScrollViewLayout"),Ct=C7(eK),Cn=C9(R),Ci=C9(K),Cr=C9(ee),Ca=C9(V),Co=C9(V),Cs=C9(),Cl=nk.onlyRunInLifeCycle,Cu=nk.onlyRunInLifeCycle,Cc=nk.onlyRunInLifeCycleAsync,Ch=nk.onlyRunInLifeCycleAsync,Cp=nk.onlyRunInLifeCycleAsync,Cd=nk.onlyRunInLifeCycle,Cf=nk.onlyRunInLifeCycle,Cy=nk.onlyRunInLifeCycle,Ce(Cv=Ct((Cm=st((Cg=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"viewport",Cm,Ke(g)),rt(g,"spacing",Cb,Ke(g)),rt(g,"nodePrefab",Cw,Ke(g)),rt(g,"maxNodeCount",CS,Ke(g)),rt(g,"extendCount",CE,Ke(g)),rt(g,"scrollView",C_,Ke(g)),g.nodePool=[],g.recycling=!1,g.direction=0,g.oldOffset=0,g.nodeHeight=0,g.scrollSignal=new nN,g.onNodeData=function(){},g.onNodeInvisible=function(){},g}return Ue(o,[{key:"__preload",value:function(){this.scrollView=this.getComponent(eK),this.uiTransform=this.getComponent(R)}},{key:"start",value:function(){var g=I(this.nodePrefab);this.nodeHeight=g.getComponent(R).height,g.destroy(),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"init",value:function(g,E){this.createNodePool(),this.currentNodeCount=this.nodePool.length,this.topMostNodeIndex=0,this.bottomMostNodeIndex=this.nodePool.length-1,this.onNodeData=null!=g?g:this.onNodeData,this.onNodeInvisible=null!=E?E:this.onNodeInvisible;for(var _=this.viewport.getBoundingBoxToWorld(),k=_.yMax,C=_.yMin,A=0;A<this.nodePool.length;A++)if(A<this.maxNodeCount){var T=this.nodePool[A];T.setVisible(!0),this.onNodeData(T);var R=this.getNodeBoundingBoxWorld(A),I=R.top,L=R.bot;(I<C||L>k)&&(T.setVisible(!1),this.onNodeInvisible(T))}else this.nodePool[A].setVisible(!1),this.onNodeInvisible(this.nodePool[A])}},{key:"updateNodeVisibility",value:function(){for(var g=0;g<this.nodePool.length;g++)this.nodePool[g].isVisible()&&this.onNodeData(this.nodePool[g])}},{key:"listenEvents",value:function(){this.scrollView.node.on(eK.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.on(eH.TOUCH_MOVE,this.abortScrollSignal,this)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(eK.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.off(eH.TOUCH_MOVE,this.abortScrollSignal,this)}},{key:"scrollToOrder",value:(k=Be(function(g,E){var _,k,C,A,T;var R=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:_=R.length>2&&void 0!==R[2]?R[2]:2,k=this.getNodeScrollOffset(g),C=this.scrollView.getScrollOffset().y,A=(k=Math.max(k,0))-(C=Math.max(C,0));T=Math.abs(A)<5;if(T)return[3,2];return[4,this.scrollToOffset(new eS(0,k),_,E)];case 1:T=I.sent();I.label=2;case 2:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"scrollToTop",value:(_=Be(function(g){var E;var _=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:E=_.length>1&&void 0!==_[1]?_[1]:2;return[4,this.scrollToOffset(new eS(0,0),E,g)];case 1:k.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"scrollToOffset",value:(E=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=new nN;this.scrollSignal=k,this.scrollView.scrollToOffset(g,E),k.addAbortListener(this.handleScrollSignalAborted.bind(this)),_.addAbortListener(this.handleExternalSignalAborted.bind(this,g,k));return[4,tZ.waitTweenAsync(E,_)];case 1:C.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"updateVisibility",value:function(){var g=this;if(this.direction=this.scrollView.getScrollOffset().y-this.oldOffset,this.oldOffset=this.scrollView.getScrollOffset().y,!this.recycling){var E=this.viewport.getBoundingBoxToWorld(),_=E.yMax,k=E.yMin;this.nodePool.forEach(function(E,C){var A=g.getNodeBoundingBoxWorld(C),T=A.top,R=A.bot;T<k||R>_?(E.setVisible(!1),g.onNodeInvisible(E)):E.setVisible(!0)}),this.direction>0&&this.validateNodeIndex(this.bottomMostNodeIndex)&&this.getNodeBoundingBoxWorld(this.bottomMostNodeIndex).top>k?this.recycleTopToBottom():this.direction<0&&this.validateNodeIndex(this.topMostNodeIndex)&&this.getNodeBoundingBoxWorld(this.topMostNodeIndex).bot<_&&this.recycleBottomToTop()}}},{key:"createNodePool",value:function(){if(0===this.nodePool.length){var g=Math.ceil(this.viewport.height/this.nodeHeight)+1+this.extendCount;this.setMaxNodeCount(this.maxNodeCount);for(var E=0;E<g;E++){var _,k=I(this.nodePrefab);null===(_=this.scrollView.content)||void 0===_||_.addChild(k),k.setPosition(this.getNodePosition(E));var C=k.addComponent(CA);C.order=E,this.nodePool.push(C)}}else for(var A=0;A<this.nodePool.length;A++)this.nodePool[A].order=A,this.nodePool[A].node.setPosition(this.getNodePosition(A))}},{key:"recycleTopToBottom",value:function(){for(this.recycling=!0;this.getNodeBoundingBoxWorld(this.topMostNodeIndex).bot>this.viewport.getBoundingBoxToWorld().yMax&&this.currentNodeCount<this.maxNodeCount;)this.nodePool[this.topMostNodeIndex].node.setPosition(this.getNodePosition(this.nodePool[this.bottomMostNodeIndex].order+1)),this.nodePool[this.topMostNodeIndex].order=this.nodePool[this.bottomMostNodeIndex].order+1,this.onNodeData(this.nodePool[this.topMostNodeIndex]),this.bottomMostNodeIndex=this.topMostNodeIndex,this.topMostNodeIndex=(this.topMostNodeIndex+1)%this.nodePool.length,this.currentNodeCount++;this.recycling=!1}},{key:"recycleBottomToTop",value:function(){for(this.recycling=!0;this.getNodeBoundingBoxWorld(this.bottomMostNodeIndex).top<this.viewport.getBoundingBoxToWorld().yMin&&this.currentNodeCount>this.nodePool.length;)this.nodePool[this.bottomMostNodeIndex].node.setPosition(this.getNodePosition(this.nodePool[this.topMostNodeIndex].order-1)),this.nodePool[this.bottomMostNodeIndex].order=this.nodePool[this.topMostNodeIndex].order-1,this.onNodeData(this.nodePool[this.bottomMostNodeIndex]),this.topMostNodeIndex=this.bottomMostNodeIndex,this.bottomMostNodeIndex=(this.bottomMostNodeIndex-1+this.nodePool.length)%this.nodePool.length,this.currentNodeCount--;this.recycling=!1}},{key:"updateLayout",value:function(){var g,E=at(this.getVisibleNodes());try{for(E.s();!(g=E.n()).done;){var _=g.value;_.node.setPosition(this.getNodePosition(_.order))}}catch(g){E.e(g)}finally{E.f()}}},{key:"setMaxNodeCount",value:function(g){this.maxNodeCount=g,this.scrollView.content.getComponent(R).height=(this.nodeHeight+this.spacing)*this.maxNodeCount}},{key:"getAllNodes",value:function(){return this.nodePool}},{key:"getVisibleNodes",value:function(){return this.nodePool.filter(function(g){return g.isVisible()})}},{key:"getNodePosition",value:function(g){return new em(0,-(this.nodeHeight+this.spacing)*g-this.nodeHeight/2,0)}},{key:"getNodeScrollOffset",value:function(g){return-this.getNodePosition(g).y-this.uiTransform.node.worldPosition.y-this.uiTransform.height/2+this.viewport.node.worldPosition.y}},{key:"getNodeByOrder",value:function(g){return Ae.search(this.nodePool,function(E){return E.order===g})}},{key:"getNodeBoundingBoxWorld",value:function(g){var E=this.nodePool[g].node.worldPosition.y;return{top:E+this.nodeHeight/2,bot:E-this.nodeHeight/2}}},{key:"validateNodeIndex",value:function(g){return g>=0&&g<this.nodePool.length}},{key:"abortScrollSignal",value:function(){this.scrollSignal.abort()}},{key:"handleScrollSignalAborted",value:function(){this.scrollView.stopAutoScroll(),this.updateVisibility()}},{key:"handleExternalSignalAborted",value:function(g,E){E.aborted||(this.scrollView.stopAutoScroll(),this.scrollView.scrollToOffset(g,0))}}]),o}(M)).prototype,"viewport",[Cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cb=st(Cg.prototype,"spacing",[Ci],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Cw=st(Cg.prototype,"nodePrefab",[Cr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CS=st(Cg.prototype,"maxNodeCount",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),CE=st(Cg.prototype,"extendCount",[Co],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C_=st(Cg.prototype,"scrollView",[Cs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Cg.prototype,"listenEvents",[Cl],Object.getOwnPropertyDescriptor(Cg.prototype,"listenEvents"),Cg.prototype),st(Cg.prototype,"unlistenEvents",[Cu],Object.getOwnPropertyDescriptor(Cg.prototype,"unlistenEvents"),Cg.prototype),st(Cg.prototype,"scrollToOrder",[Cc],Object.getOwnPropertyDescriptor(Cg.prototype,"scrollToOrder"),Cg.prototype),st(Cg.prototype,"scrollToTop",[Ch],Object.getOwnPropertyDescriptor(Cg.prototype,"scrollToTop"),Cg.prototype),st(Cg.prototype,"scrollToOffset",[Cp],Object.getOwnPropertyDescriptor(Cg.prototype,"scrollToOffset"),Cg.prototype),st(Cg.prototype,"updateVisibility",[Cd],Object.getOwnPropertyDescriptor(Cg.prototype,"updateVisibility"),Cg.prototype),st(Cg.prototype,"handleScrollSignalAborted",[Cf],Object.getOwnPropertyDescriptor(Cg.prototype,"handleScrollSignalAborted"),Cg.prototype),st(Cg.prototype,"handleExternalSignalAborted",[Cy],Object.getOwnPropertyDescriptor(Cg.prototype,"handleExternalSignalAborted"),Cg.prototype),Cv=Cg))||Cv)||Cv);_._RF.pop(),_._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var An,Ai,Ar,Aa,Ao,As,Al,Au,Ac,Ah,Ap,Ad=k.ccclass,Af=k.property,Ay=k.disallowMultiple,Av=k.requireComponent,Ag=(CT=Ad("DashboardPage"),CR=Av(H),CI=Av(eu),CL=nk.required(),CP=Af({type:C,displayName:"Page's container"}),CO=nk.required(),CB=nk.required(),CN=Af({type:C,displayName:"Placeholder"}),CM=nk.required(),CD=Af({displayName:"Don't create prefab",tooltip:"Tell the component to not create the prefab even if it hasn't create yet"}),CF=Af({displayName:"Darken background"}),CU=Af({type:V,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),Cx=Af({displayName:"Use navbar shadow"}),Cz=Af({type:V,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),CG=nk.required(),CV=nk.getComponent(eu),CK=nk.required(),CH=nk.getComponent(H),Cq=nk.onlyRunInLifeCycleAsync,CW=nk.onlyRunInLifeCycle,Cj=nk.onlyRunInLifeCycleAsync,CT(CX=Ay(CX=CR(CX=CI((CJ=st((CY=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",CJ,Ke(g)),rt(g,"containerUIOpacity",CQ,Ke(g)),rt(g,"placeholder",CZ,Ke(g)),rt(g,"placeholderUIOpacity",C$,Ke(g)),rt(g,"hasCreated",C0,Ke(g)),g.pagePrefab=null,rt(g,"darkenBackground",C1,Ke(g)),rt(g,"backgroundOpacity",C2,Ke(g)),rt(g,"useNavbarShadow",C4,Ke(g)),rt(g,"navbarShadowOpacity",C3,Ke(g)),rt(g,"uiOpacity",C5,Ke(g)),rt(g,"widgetComponent",C6,Ke(g)),g}return Ue(a,[{key:"onLoad",value:function(){this.containerUIOpacity=this.container.getComponent(eu),this.placeholderUIOpacity=this.placeholder.getComponent(eu),nk.decorateComponent(this);var g=this.container.getComponent(q);this.layoutComponents=g?[g]:[],this.widgetComponents=[this.widgetComponent].concat(tt(this.container.getComponentsInChildren(H)))}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"updateWidgets",value:function(){var g,E=at(this.widgetComponents);try{for(E.s();!(g=E.n()).done;)g.value.updateAlignment()}catch(g){E.e(g)}finally{E.f()}}},{key:"updateLayouts",value:function(){var g,E=at(this.layoutComponents);try{for(E.s();!(g=E.n()).done;)g.value.updateLayout()}catch(g){E.e(g)}finally{E.f()}}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.hasCreated;if(g)return[3,2];return[4,this.create()];case 1:g=E.sent();E.label=2;case 2:this.mountInLifeCycle();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"mountInLifeCycle",value:function(){this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,i_.trackCurrentPage(this.node.name,!0)}},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return!0}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(E=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!(this.pagePrefab&&!this.hasCreated))return[3,2];_=I(this.pagePrefab),k=_.getComponentsInChildren(H);(g=this.widgetComponents).push.apply(g,tt(k));C=_.getComponentsInChildren(q);(E=this.layoutComponents).push.apply(E,tt(C)),this.container.addChild(_);return[4,tZ.waitTweenAsync(0)];case 1:A.sent(),this.hasCreated=!0;A.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"container",[CL,CP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CQ=st(CY.prototype,"containerUIOpacity",[CO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CZ=st(CY.prototype,"placeholder",[CB,CN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C$=st(CY.prototype,"placeholderUIOpacity",[CM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C0=st(CY.prototype,"hasCreated",[CD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C1=st(CY.prototype,"darkenBackground",[CF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C2=st(CY.prototype,"backgroundOpacity",[CU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),C4=st(CY.prototype,"useNavbarShadow",[Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C3=st(CY.prototype,"navbarShadowOpacity",[Cz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),C5=st(CY.prototype,"uiOpacity",[CG,CV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C6=st(CY.prototype,"widgetComponent",[CK,CH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(CY.prototype,"mount",[Cq],Object.getOwnPropertyDescriptor(CY.prototype,"mount"),CY.prototype),st(CY.prototype,"mountInLifeCycle",[CW],Object.getOwnPropertyDescriptor(CY.prototype,"mountInLifeCycle"),CY.prototype),st(CY.prototype,"create",[Cj],Object.getOwnPropertyDescriptor(CY.prototype,"create"),CY.prototype),CX=CY))||CX)||CX)||CX)||CX);_._RF.pop(),_._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var Am,Ab,Aw,AS,AE,A_,Ak,AC,AA,AT,AR,AI,AL,AP,AO,AB,AN,AM=k.ccclass,AD=k.property,AF=(An=AM("ThemeProgressBar"),Ai=AD(C),Ar=AD(C),Aa=AD(C),Ao=AD(C),An((Au=st((Al=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"progressBar",Au,Ke(g)),rt(g,"progressText",Ac,Ke(g)),rt(g,"leftCap",Ah,Ke(g)),rt(g,"rightCap",Ap,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(g,E){g<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var _=this.progressBar.getComponent(ew);if(!_)throw new Error("ThemeProgressBar: progressBarComponent not found");_.progress=g/E;var k=this.progressText.getComponent(L);if(!k)throw new Error("ThemeProgressBar: progressTextComponent not found");k.string="".concat(g,"/").concat(E)}}]),n}(M)).prototype,"progressBar",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ac=st(Al.prototype,"progressText",[Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ah=st(Al.prototype,"leftCap",[Aa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ap=st(Al.prototype,"rightCap",[Ao],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),As=Al))||As);_._RF.pop(),_._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var AU,Ax,Az,AG,AV,AK,AH,Aq,AW,Aj,AX,AY,AJ,AQ,AZ,A$,A0,A1,A2,A4,A3,A5,A6,A8,A9,A7,Te,Tt=k.ccclass,Tn=k.disallowMultiple,Ti=k.property,Tr=[50,160],Ta=(Am=Tt("LockAnimator"),Ab=Ti(eV),Aw=Ti(G),AS=Ti(ei),AE=Ti(ei),A_=Ti(ei),Ak=Ti(sy),AC=Ti({type:V,min:0}),Am(AA=Tn((AR=st((AT=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"floatingParticles",AR,Ke(g)),rt(g,"iconAnimation",AI,Ke(g)),rt(g,"lockClip",AL,Ke(g)),rt(g,"unlockClip",AP,Ke(g)),rt(g,"tryToUnlockClip",AO,Ke(g)),rt(g,"trailTemplate",AB,Ke(g)),rt(g,"trailCount",AN,Ke(g)),g.trails=[],g}return Ue(o,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(k=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem();return[4,this.playAnimation(this.unlockClip.name,g)];case 1:E.sent(),this.floatingParticles.stopSystem();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var g=this;return Promise.all(this.trails.map(function(E){return tZ.runTweenAsync(g.getExplodeTrail(E))}))}},{key:"getExplodeTrail",value:function(g,E){var _=arguments.length>1&&void 0!==E?E:0,k=eR(0,2*Math.PI),C=eR(Tr[0],Tr[1])*Math.cos(k),A=eR(Tr[0],Tr[1])*Math.sin(k),T=new em(C,A,g.node.position.z),R=g.node.scale.clone();return z(g.node).delay(_).call(function(){g.node.setPosition(0,0),g.reset(),g.node.active=!0}).to(.5,{position:T.clone()},{easing:"expoOut"}).to(.5,{scale:new em(0,0,1)},{easing:"expoIn"}).call(function(){g.node.setPosition(0,0),g.node.scale=R,g.reset(),g.node.active=!1})}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var g=0;g<this.trailCount;g++){var E=I(this.trailTemplate.node);E.setParent(this.node),E.active=!1,this.trails.push(E.getComponent(sy))}}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"playAnimation",value:(_=Be(function(g,E){var _;return _ts_generator(this,function(k){_=this;return[2,null!=E&&E.aborted?Promise.resolve():new Promise(function(k){_.iconAnimation.once(G.EventType.FINISHED,function(){k()}),null==E||E.addAbortListener(function(){_.iconAnimation.off(G.EventType.FINISHED),_.iconAnimation.stop(),k()}),_.iconAnimation.play(g)})]})}),function(g,E){return _.apply(this,arguments)})},{key:"playTryToUnlockAnimation",value:(E=Be(function(){return _ts_generator(this,function(g){return[2,this.playAnimation(this.tryToUnlockClip.name)]})}),function(){return E.apply(this,arguments)})}]),o}(M)).prototype,"floatingParticles",[Ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AI=st(AT.prototype,"iconAnimation",[Aw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AL=st(AT.prototype,"lockClip",[AS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AP=st(AT.prototype,"unlockClip",[AE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AO=st(AT.prototype,"tryToUnlockClip",[A_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AB=st(AT.prototype,"trailTemplate",[Ak],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AN=st(AT.prototype,"trailCount",[AC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),AA=AT))||AA)||AA);_._RF.pop(),_._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var To,Ts,Tl,Tu,Tc,Th,Tp,Td,Tf,Ty,Tv,Tg,Tm,Tb=k.ccclass,Tw=k.property,TS={progress:0,max:10,isLocked:!0,theme:ln.SUMMER,skins:["fruit"]},TE=GameCore.Utils.Array,T_=(AU=Tb("ThemeBlock"),Ax=Tw(C),Az=Tw(eu),AG=Tw(C),AV=Tw(eu),AK=Tw(Ta),AH=Tw(C),Aq=Tw(eo),AW=Tw([eo]),Aj=Tw(L),AX=Tw(eu),AY=Tw(eu),AJ=Tw(J),AQ=nk.onlyRunInLifeCycleAsync,AU((A0=st((A$=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"mask",A0,Ke(g)),rt(g,"nodeUIOpacity",A1,Ke(g)),rt(g,"progressBar",A2,Ke(g)),rt(g,"backgroundUI",A4,Ke(g)),rt(g,"lockAnimator",A3,Ke(g)),rt(g,"themeLoadingRing",A5,Ke(g)),rt(g,"themeSprite",A6,Ke(g)),rt(g,"tileBlockIconSprite",A8,Ke(g)),rt(g,"titleLabel",A9,Ke(g)),rt(g,"titleOpacity",A7,Ke(g)),rt(g,"newTilesOpacity",Te,Ke(g)),g.signal=new nN,g.payload=TS,g}return Ue(r,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(g){this.payload.isLocked=g,this.updateInfo()}},{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){var E=arguments.length>0&&void 0!==g?g:TS;this.payload=E;var _=E.progress,k=E.max,C=E.isLocked,A=E.theme,T=E.skins;this.signal.abort();var R=new nN;this.signal=R,this.updateTitle(A),this.updateSkinAsync(T,R),this.updateThemeAsync(A,R);var I=this.progressBar.getComponent(AF);if(!I)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=C,this.progressBar.active=!C,this.lockAnimator.node.active=C,C||I.setProgress(_,k)}},{key:"playUnlockAnim",value:(C=Be(function(g){var E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:E=A.length>1&&void 0!==A[1]?A[1]:TS;this.payload=Me(Me({},E),{},{isLocked:!1});_=E.progress,k=E.max,C=this.progressBar.getComponent(AF);if(!C)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,C.setProgress(_,k);return[4,this.animateUnlockedState(g)];case 1:T.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"updateTitle",value:function(g){var E=g.replace(/-/g," ").replace(/\b\w/g,function(g){return g.toUpperCase()});this.titleLabel.string="".concat(E," levels")}},{key:"updateSkinAsync",value:(k=Be(function(g,E){var _,k,C,A,T,R,I,L,P,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:_=this.tileBlockIconSprite.length,k=g.length,C=g.map(function(){var g=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,n7.loadSkinPreviewAsync(g)];case 1:return[2,E.sent()]}})});return function(E){return g.apply(this,arguments)}}());return[4,Promise.all(C)];case 1:A=N.sent();if(!E.aborted&&this.tileBlockIconSprite){if(k<=_){for(T=Math.floor(_/k),R=_%k,I=tt(TE.fillWith(k,function(){return T})),L=0;L<R;L++)I[L]++;for(P=0,O=0;O<k;O++)for(B=0;B<I[O]&&P<_;B++,P++)this.tileBlockIconSprite[P].spriteFrame=A[O][B]}else this.tileBlockIconSprite.forEach(function(g,E){g.spriteFrame=A[E%k][0]})}return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"updateThemeAsync",value:(_=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.themeSprite.spriteFrame=null;_=n7.getAsset("".concat(nF[g],"/spriteFrame"),ea);k=_;if(k)return[3,2];this.themeLoadingRing.active=!0;return[4,n7.loadThemePreviewAsync(g)];case 1:k=_=A.sent();A.label=2;case 2:C=_;if(C)return[3,4];return[4,n7.loadThemePreviewAsync(ln.SUMMER)];case 3:C=_=A.sent();A.label=4;case 4:this.themeSprite&&_&&!E.aborted&&(this.themeSprite.spriteFrame=_,this.themeLoadingRing.active=!1);return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"animateUnlockedState",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this.mask.getComponent(eu),k=this.progressBar.getComponent(eu);if(!_)throw new Error("ThemeBlock: maskUIOpacity not found");if(!k)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,_.opacity=null!==(E=_.opacity)&&void 0!==E?E:255,this.progressBar.active=!0,k.opacity=0;return[4,this.lockAnimator.unlock(g)];case 1:C.sent(),this.lockAnimator.node.active=!1;return[4,Promise.all([tZ.runTweenAsync(z(_).to(.25,{opacity:0}),g),tZ.runTweenAsync(z(k).to(.25,{opacity:255}),g)])];case 2:C.sent(),this.mask.active=!1,_.opacity=0,k.opacity=255;return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"getUITransform",value:function(){return this.uiTransform}},{key:"setVisible",value:function(g){this.nodeUIOpacity.opacity=g?255:0,this.titleOpacity.opacity=g?255:0,this.newTilesOpacity.opacity=g?255:0}}]),r}(M)).prototype,"mask",[Ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A1=st(A$.prototype,"nodeUIOpacity",[Az],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A2=st(A$.prototype,"progressBar",[AG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A4=st(A$.prototype,"backgroundUI",[AV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A3=st(A$.prototype,"lockAnimator",[AK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A5=st(A$.prototype,"themeLoadingRing",[AH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A6=st(A$.prototype,"themeSprite",[Aq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A8=st(A$.prototype,"tileBlockIconSprite",[AW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),A9=st(A$.prototype,"titleLabel",[Aj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A7=st(A$.prototype,"titleOpacity",[AX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te=st(A$.prototype,"newTilesOpacity",[AY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(A$.prototype,"isLocked",[AJ],Object.getOwnPropertyDescriptor(A$.prototype,"isLocked"),A$.prototype),st(A$.prototype,"updateSkinAsync",[AQ],Object.getOwnPropertyDescriptor(A$.prototype,"updateSkinAsync"),A$.prototype),AZ=A$))||AZ);_._RF.pop(),_._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var Tk,TC,TA,TT,TR,TI,TL,TP,TO,TB,TN=k.ccclass,TM=k.property,TD=globalThis.game.storage,TF=(To=TN("CollectionsContent"),Ts=TM(aR),Tl=TM(At),Tu=TM(rh),Tc=TM({type:K,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),Th=nk.onlyRunInLifeCycleAsync,Tp=nk.onlyRunInLifeCycleAsync,To((Ty=st((Tf=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return(g=k.call.apply(k,[this].concat(_))).animateThemeBlockUnlockIndex=null,rt(g,"panelAnimator",Ty,Ke(g)),rt(g,"themeScrollView",Tv,Ke(g)),rt(g,"contentOpacity",Tg,Ke(g)),g.themeScrollViewInited=!1,g.payloads=[],g.preservedScrollPosition=new eS,rt(g,"offsetFromTopOfScrollView",Tm,Ke(g)),g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.node.scene.on(r0.HIDE_UI,this.hideContent),this.node.scene.on(r0.SHOW_UI,this.showContent),this.themeScrollView.listenEvents()}},{key:"unlistenEvents",value:function(){this.unlistenUIEvents(),this.themeScrollView.unlistenEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(r0.HIDE_UI,this.hideContent),this.node.scene.off(r0.SHOW_UI,this.showContent)}},{key:"init",value:function(g){var E=this;this.payloads=g,this.themeScrollViewInited||(this.themeScrollViewInited=!0,this.themeScrollView.init(function(g){var _=E.animateThemeBlockUnlockIndex===g.order,k=E.payloads[g.order],C=g.getComponent(T_);C.updateInfo(Me(Me({},k),{},{isLocked:!!_||k.isLocked})),C.setVisible(!0)}))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.scrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.scrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(g){var E=this,_=TD.getStorageData("collection","animateMapPackUnlock"),k=TD.getStorageData("collection","lastMapPack");g.forEach(function(g,C){var A=g.progress,T=g.max,R=g.isLocked;if(A<T&&!R&&_&&k!==C+1)return E.animateThemeBlockUnlockIndex=C,TD.setStorageData("collection","animateMapPackUnlock",!1),void TD.setStorageData("collection","lastMapPack",C+1)})}},{key:"shouldAnimateThemeBlockUnlock",value:function(){return null!==this.animateThemeBlockUnlockIndex}},{key:"playThemeTabUnlockAnim",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.animateThemeBlockUnlockIndex)return[3,2];E=this.themeScrollView.getNodeByOrder(this.animateThemeBlockUnlockIndex);if(!(E&&E.isVisible()))return[3,2];_=E.getComponent(T_);if(!_)return[3,2];k=ll.getCollectionUnlockProgress()[this.animateThemeBlockUnlockIndex];return[4,_.playUnlockAnim(g,Me(Me({},k),{},{isLocked:!0}))];case 1:C.sent(),this.animateThemeBlockUnlockIndex=null;C.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(E=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,this.themeScrollView.scrollToOrder(g,E)];case 1:_.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}}]),a}(M)).prototype,"panelAnimator",[Ts],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv=st(Tf.prototype,"themeScrollView",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tg=st(Tf.prototype,"contentOpacity",[Tu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tm=st(Tf.prototype,"offsetFromTopOfScrollView",[Tc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),st(Tf.prototype,"playThemeTabUnlockAnim",[Th],Object.getOwnPropertyDescriptor(Tf.prototype,"playThemeTabUnlockAnim"),Tf.prototype),st(Tf.prototype,"scrollToCurrentUnlockingTheme",[Tp],Object.getOwnPropertyDescriptor(Tf.prototype,"scrollToCurrentUnlockingTheme"),Tf.prototype),Td=Tf))||Td);_._RF.pop(),_._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var TU,Tx,Tz,TG,TV,TK,TH,Tq,TW,Tj,TX,TY,TJ,TQ,TZ,T$,T0,T1,T2,T4,T3,T5,T6,T8,T9,T7,Re,Rt,Rn,Ri,Rr,Ra,Ro,Rs,Rl,Ru,Rc,Rh,Rp,Rd,Rf=(Tk=(0,k.ccclass)("CollectionsPage"),TC=nk.required(),TA=nk.getComponent(ac),TT=nk.onlyRunInLifeCycleAsync,TR=nk.onlyRunInLifeCycle,TI=nk.onlyRunInLifeCycleAsync,TL=nk.onlyRunInLifeCycleAsync,Tk((TB=st((TO=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=A.call.apply(A,[this].concat(_))).payload=null,rt(g,"panelAnimationController",TB,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nk.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"setPayload",value:function(g){this.payload=g}},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(TF),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload);var g=ll.getCollectionUnlockProgress();this.themeContent.updateUnlockedProgress(g)}},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent(),this.themeContent.restoreScrollPosition(),this.themeContent.listenEvents();g=tZ.runTweenAsync(z(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent(),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents();return[4,this.panelAnimationController.hideUI()];case 2:g.sent(),this.themeContent.unlistenEvents();return[2]}})}),function(){return E.apply(this,arguments)})}]),r}(Ag)).prototype,"panelAnimationController",[TC,TA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(TO.prototype,"mount",[TT],Object.getOwnPropertyDescriptor(TO.prototype,"mount"),TO.prototype),st(TO.prototype,"onMount",[TR],Object.getOwnPropertyDescriptor(TO.prototype,"onMount"),TO.prototype),st(TO.prototype,"transitionIn",[TI],Object.getOwnPropertyDescriptor(TO.prototype,"transitionIn"),TO.prototype),st(TO.prototype,"transitionOut",[TL],Object.getOwnPropertyDescriptor(TO.prototype,"transitionOut"),TO.prototype),TP=TO))||TP);_._RF.pop(),_._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var Ry,Rv,Rg,Rm,Rb,Rw,RS,RE,R_,Rk,RC,RA,RT,RR=k.ccclass,RI=k.property,RL=k.disallowMultiple,RP=k.requireComponent,RO=GameCore.Utils.Array,RB=(TU=RR("PageManagerItem"),Tx=RI(Ag),Tz=RI({type:es(nO)}),TU((TK=st((TV=Ue(function e(){Fe(this,e),rt(this,"page",TK,this),rt(this,"pageType",TH,this)})).prototype,"page",[Tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TH=st(TV.prototype,"pageType",[Tz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TG=TV))||TG),RN=(Tq=RR("PageManager"),TW=RP(R),Tj=nk.required(),TX=RI({type:eu,displayName:"Background Mask",group:"Background Mask"}),TY=RI({type:K,displayName:"Transition duration",group:"Background Mask"}),TJ=RI({type:K,displayName:"Transition delay",group:"Background Mask"}),TQ=nk.required(),TZ=RI({type:eu,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),T$=RI({type:K,displayName:"Transition duration",group:"Nav Bar Shadow"}),T0=RI({type:K,displayName:"Transition delay",group:"Nav Bar Shadow"}),T1=RI({type:[RB]}),T2=RI({type:es(nO)}),T4=nk.required(),T3=nk.getComponent(R),T5=nk.onlyRunInLifeCycleAsync,T6=nk.onlyRunInLifeCycleAsync,T8=nk.onlyRunInLifeCycle,T9=nk.onlyRunInLifeCycle,T7=nk.onlyRunInLifeCycle,Re=nk.onlyRunInLifeCycleAsync,Rt=nk.onlyRunInLifeCycleAsync,Rn=nk.onlyRunInLifeCycleAsync,Tq(Ri=RL(Ri=TW((Ra=st((Rr=function(g){ze(h,g);var E,_,k,C,A,T,R,I,L,P=Xe(h);function h(){var g;Fe(this,h);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=P.call.apply(P,[this].concat(_)),"backgroundMask",Ra,Ke(g)),rt(g,"backgroundMaskTransitionDuration",Ro,Ke(g)),rt(g,"backgroundMaskTransitionDelay",Rs,Ke(g)),rt(g,"navBarShadow",Rl,Ke(g)),rt(g,"navBarShadowTransitionDuration",Ru,Ke(g)),rt(g,"navBarShadowTransitionDelay",Rc,Ke(g)),rt(g,"pageItems",Rh,Ke(g)),rt(g,"currentScreen",Rp,Ke(g)),rt(g,"uiTransform",Rd,Ke(g)),g}return Ue(h,[{key:"unmountAndHideAll",value:function(){var g=this;this.pageItems.forEach(function(E){var _=E.page;E.pageType!==g.currentScreen&&(_.unmount(),_.hide())})}},{key:"onLoad",value:function(){nk.decorateComponent(this)}},{key:"init",value:function(){var g=this;this.pageItems.forEach(function(E,_){var k=E.page.getWidget();k.right=-(_-1)*g.uiTransform.width,k.left=(_-1)*g.uiTransform.width})}},{key:"updateCollectionsContentPayload",value:function(g){var E=this.getPage(nO.collections);E&&_instanceof(E,Rf)&&E.setPayload(g)}},{key:"navigate",value:(L=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:C=g.from,A=g.to;if(!(null!==C))return[3,2];return[4,this.navigateFromPage(C,A,E,_,k)];case 1:T.sent();return[3,4];case 2:return[4,this.navigateFromNull(A,_,k)];case 3:T.sent();T.label=4;case 4:return[2]}})}),function(g,E,_,k){return L.apply(this,arguments)})},{key:"navigateFromPage",value:(I=Be(function(g,E,_,k,C){var A,T,R,I,L,P,O,B,N,M,D,F,U;return _ts_generator(this,function(x){switch(x.label){case 0:A=this,T=this.validateNavigationRequest(g,E),R=T.toPage,I=T.fromPage;this.currentScreen=E;L=this.uiTransform.width,P=this.getPageIndex(g),O=this.getPageIndex(E),B=Math.min(P,O),N=Math.max(P,O),M=(N-B)*L,D=P<O?1:-1,F=this.pageItems.slice(B,N+1);F.forEach(function(g,E){var _=g.page;_.show(),_.getWidget().enabled=!1,_.node.position=new em((E+B-P)*L,_.node.position.y,_.node.position.z)});U=!R.hasLoadedPage();U&&this.showLoadingScreen();return[4,this.mountPage(R,k)];case 1:x.sent();return[4,_.callAsync(function(){return A.performFullTransition({from:g,to:E,fromPage:I,toPage:R,distance:M,direction:D,items:F})})];case 2:x.sent(),_.call(function(){return A.cleanupPages(R,F.filter(function(g){return g.pageType!==E}))});return[4,_.callAsync(function(){return A.transitionInPage(R,C)})];case 3:x.sent(),U&&this.hideLoadingScreen();return[2]}})}),function(g,E,_,k,C){return I.apply(this,arguments)})},{key:"hideLoadingScreen",value:function(){l1.closeLoadingScreen()}},{key:"showLoadingScreen",value:function(){l1.showLoadingScreen()}},{key:"cleanupPages",value:function(g,E){var _=g.getWidget();_.enabled=!0,_.left=0,_.right=0,g.updateWidgets(),g.updateLayouts(),E.forEach(function(g){g.page.unmount(),g.page.hide()})}},{key:"performFullTransition",value:(R=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:E=g.from,_=g.to,k=g.fromPage,C=g.distance,A=g.direction,T=g.items,R=g.toPage;this.node.scene.emit(nL,{from:E,to:_});return[4,Promise.all([k.transitionOut(),this.transition(C,A,T),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,R.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,R.getNavbarShadow())])];case 1:I.sent();return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"mountPage",value:(T=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,g.mount()];case 1:_.sent();return[4,null==E?void 0:E(g)];case 2:_.sent();return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"validateNavigationRequest",value:function(g,E){if(g!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");var _=this.getPage(this.currentScreen),k=this.getPage(E);if(!k||!_)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");return{toPage:k,fromPage:_}}},{key:"navigateFromNull",value:(A=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=this.getPage(this.currentScreen);k.show(),this.currentScreen=g;return[4,this.mountPage(k,E)];case 1:C.sent(),this.node.scene.emit(nL,{from:null,to:g});return[4,this.transitionInPage(k,_)];case 2:C.sent();return[2]}})}),function(g,E,_){return A.apply(this,arguments)})},{key:"transitionInPage",value:(C=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,g.transitionIn()];case 1:_.sent();return[4,null==E?void 0:E(g)];case 2:_.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"getPage",value:function(g){var E=this.getPageIndex(g);return -1!==E?this.pageItems[E].page:null}},{key:"handleBackgroundMask",value:(k=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,tZ.runTweenAsync(z(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(g,{opacity:E}).start())];case 1:_.sent();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleNavBarShadow",value:(_=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,tZ.runTweenAsync(z(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(g,{opacity:E}).start())];case 1:_.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"getPageIndex",value:function(g){return RO.searchIndex(this.pageItems,function(E){return E.pageType===g})}},{key:"transition",value:(E=Be(function(g,E,_){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,Promise.all(_.map(function(_){var k=_.page;return tZ.runTweenAsync(z(k.node).to(.5,{position:new em(k.node.position.x-g*E,k.node.position.y,k.node.position.z)},{easing:el.quintInOut}))}))];case 1:k.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),h}(M)).prototype,"backgroundMask",[Tj,TX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ro=st(Rr.prototype,"backgroundMaskTransitionDuration",[TY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Rs=st(Rr.prototype,"backgroundMaskTransitionDelay",[TJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),Rl=st(Rr.prototype,"navBarShadow",[TQ,TZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ru=st(Rr.prototype,"navBarShadowTransitionDuration",[T$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Rc=st(Rr.prototype,"navBarShadowTransitionDelay",[T0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),Rh=st(Rr.prototype,"pageItems",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Rp=st(Rr.prototype,"currentScreen",[T2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nO.home}}),Rd=st(Rr.prototype,"uiTransform",[T4,T3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Rr.prototype,"navigate",[T5],Object.getOwnPropertyDescriptor(Rr.prototype,"navigate"),Rr.prototype),st(Rr.prototype,"navigateFromPage",[T6],Object.getOwnPropertyDescriptor(Rr.prototype,"navigateFromPage"),Rr.prototype),st(Rr.prototype,"hideLoadingScreen",[T8],Object.getOwnPropertyDescriptor(Rr.prototype,"hideLoadingScreen"),Rr.prototype),st(Rr.prototype,"showLoadingScreen",[T9],Object.getOwnPropertyDescriptor(Rr.prototype,"showLoadingScreen"),Rr.prototype),st(Rr.prototype,"cleanupPages",[T7],Object.getOwnPropertyDescriptor(Rr.prototype,"cleanupPages"),Rr.prototype),st(Rr.prototype,"performFullTransition",[Re],Object.getOwnPropertyDescriptor(Rr.prototype,"performFullTransition"),Rr.prototype),st(Rr.prototype,"mountPage",[Rt],Object.getOwnPropertyDescriptor(Rr.prototype,"mountPage"),Rr.prototype),st(Rr.prototype,"navigateFromNull",[Rn],Object.getOwnPropertyDescriptor(Rr.prototype,"navigateFromNull"),Rr.prototype),Ri=Rr))||Ri)||Ri)||Ri);_._RF.pop(),_._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var RM,RD,RF,RU,Rx,Rz,RG=k.ccclass,RV=k.property,RK=(Ry=RG("StarProgressBar"),Rv=RV(oa),Rg=RV(L),Rm=RV(V),Rb=RV(V),Rw=RV(x),Ry((R_=st((RE=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"progressBar",R_,Ke(g)),rt(g,"progressLabel",Rk,Ke(g)),rt(g,"current",RC,Ke(g)),rt(g,"total",RA,Ke(g)),rt(g,"separator",RT,Ke(g)),g}return Ue(i,[{key:"setRange",value:function(g,E){this.total=E,this.current=g,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string="".concat(this.current).concat(this.separator).concat(this.total)}},{key:"animateTo",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=this,C=Math.min(g,this.total)/this.total,A=this.current,T=1,R=z(this.progressBar).to(3,{progress:C},{easing:"quadOut",onUpdate:function(E,C){C&&(k.current=A+Math.floor((g-A)*C),null==_||_(k.current),k.current===A-T&&(T++,z(k.progressLabel.node).to(.05,{scale:new em(1.2,1.2,1.2)}).to(.05,{scale:em.ONE}).start()),k.updateProgressLabel())}});null==E||E.addAbortListener(function(){k.current=g,k.updateProgress()});return[4,tZ.runTweenAsync(R,E)];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(M)).prototype,"progressBar",[Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rk=st(RE.prototype,"progressLabel",[Rg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RC=st(RE.prototype,"current",[Rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RA=st(RE.prototype,"total",[Rb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RT=st(RE.prototype,"separator",[Rw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RS=RE))||RS);_._RF.pop(),_._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var RH,Rq,RW,Rj,RX,RY,RJ,RQ,RZ,R$,R0,R1=k.ccclass,R2=k.property,R4=(RM=R1("EventButton"),RD=R2({type:es(Ef)}),RF=R2(J),RM((Rz=st((Rx=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"eventType",Rz,Ke(g)),g._isAvailable=!1,g}return Ue(n,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(g){this._isAvailable=g,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(nP,{type:this.eventType})}},{key:"setAnimationState",value:function(g){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),Je(Ve(n.prototype),"setAnimationState",this).call(this,g)}}]),n}(rs)).prototype,"eventType",[RD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ef.STAR_CHEST}}),st(Rx.prototype,"isAvailable",[RF],Object.getOwnPropertyDescriptor(Rx.prototype,"isAvailable"),Rx.prototype),RU=Rx))||RU);_._RF.pop(),_._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var R3,R5,R6,R8,R9,R7,Ie,It,In,Ii,Ir,Ia,Io,Is,Il,Iu,Ic,Ih,Ip=k.ccclass,Id=k.property,If=globalThis.game.player,Iy=(RH=Ip("DashboardHeader"),Rq=Id({type:RK,displayName:"Progress bar",group:"Star Chest"}),RW=Id({type:R4,displayName:"Button Component",group:"Star Chest"}),Rj=Id({type:ei,displayName:"Default Rest animation",group:"Star Chest"}),RX=Id({type:ei,displayName:"Special Rest animation",group:"Star Chest"}),RH((RQ=st((RJ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"starProgressBar",RQ,Ke(g)),rt(g,"chestButton",RZ,Ke(g)),rt(g,"defaultRestAnimation",R$,Ke(g)),rt(g,"specialRestAnimation",R0,Ke(g)),g.handleStarsUpdateEvent=function(E){var _,k=null!=E?E:null===(_=If.getGameData())||void 0===_?void 0:_.stars;void 0!==k&&(g.starProgressBar.setRange(k,20),g.updateStarChestButtonAnimation(k))},g}return Ue(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),Q.on(nT,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function(){Q.off(nT,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function(g){this.handleStarsUpdateEvent(g)}},{key:"updateStarChestButtonAnimation",value:function(g){this.chestButton.isAvailable=g>=20}},{key:"validateRequiredComponents",value:function(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}},{key:"handleClickedSettingsButton",value:function(){l1.openScreen(ig.SETTINGS_SCREEN)}}]),n}(M)).prototype,"starProgressBar",[Rq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RZ=st(RJ.prototype,"chestButton",[RW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R$=st(RJ.prototype,"defaultRestAnimation",[Rj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R0=st(RJ.prototype,"specialRestAnimation",[RX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RY=RJ))||RY);_._RF.pop(),_._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var Iv,Ig,Im,Ib,Iw,IS,IE,I_,Ik,IC,IA,IT,IR=k.ccclass,II=k.property,IL=k.executeInEditMode,IP=(R3=IR("JourneyLevelAvatar"),R5=II({type:eo,displayName:"Avatar node"}),R6=II(C),R8=II(G),R9=II(eu),R7=II({type:ei,group:"Animation"}),Ie=II({type:ei,group:"Animation"}),It=II({type:ei,group:"Animation"}),In=II({type:ea,displayName:"Avatar sprite"}),R3(Ii=IL((Ia=st((Ir=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"sprite",Ia,Ke(g)),rt(g,"lockIcon",Io,Ke(g)),rt(g,"animation",Is,Ke(g)),rt(g,"opacity",Il,Ke(g)),rt(g,"flashAnimation",Iu,Ke(g)),rt(g,"unlockAnimation",Ic,Ke(g)),rt(g,"spawnAnimation",Ih,Ke(g)),g}return Ue(o,[{key:"avatarSprite",get:function(){var g,E;return null!==(g=null===(E=this.sprite)||void 0===E?void 0:E.spriteFrame)&&void 0!==g?g:null},set:function(g){this.sprite&&(this.sprite.spriteFrame=g)}},{key:"playUnlockAnimation",value:(k=Be(function(){var g,E,_,k,C,A,T,R,I,L,P;return _ts_generator(this,function(O){switch(O.label){case 0:g=this.playAnimation(this.unlockAnimation),E=this.lockIcon.position.x,_=this.lockIcon.position.y,k=[45,135],C=(Math.random()*(k[1]-k[0])+k[0])*(Math.PI/180),A=this.lockIcon.position.x+150*Math.cos(C),T=this.lockIcon.position.y+150*Math.sin(C),R=_-400,I=tZ.runTweenAsync(z(this.lockIcon).delay(.3).to(.2,{position:new em(A,T,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new em(A,R,this.lockIcon.position.z)},{easing:"cubicIn"})),L=[0,360],P=tZ.runTweenAsync(z(this.lockIcon).delay(.3).to(.6,{eulerAngles:new em(0,0,Math.random()*(L[1]-L[0])*(A>E?-1:1))},{easing:"sineOut"}));return[4,Promise.all([g,I,P])];case 1:O.sent(),this.lockIcon.position=new em(E,_,this.lockIcon.position.z),this.lockIcon.eulerAngles=new em(0,0,0);return[2]}})}),function(){return k.apply(this,arguments)})},{key:"playFlashAnimation",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=this.node.position.y,_=this.playAnimation(this.flashAnimation),k=tZ.runTweenAsync(z(this.node).to(.1,{position:new em(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new em(this.node.position.x,E,this.node.position.z)},{easing:"sineIn"}),g);return[4,Promise.all([_,k])];case 1:C.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(em.ZERO)}},{key:"playAnimation",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runAnimationAsync(this.animation,g.name)];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var g=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some(function(E){return null!==E&&(E.name===g.flashAnimation.name||E.name===g.unlockAnimation.name||E.name===g.spawnAnimation.name)}))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),o}(M)).prototype,"sprite",[R5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Io=st(Ir.prototype,"lockIcon",[R6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Is=st(Ir.prototype,"animation",[R8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Il=st(Ir.prototype,"opacity",[R9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iu=st(Ir.prototype,"flashAnimation",[R7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ic=st(Ir.prototype,"unlockAnimation",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ih=st(Ir.prototype,"spawnAnimation",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Ir.prototype,"avatarSprite",[In],Object.getOwnPropertyDescriptor(Ir.prototype,"avatarSprite"),Ir.prototype),Ii=Ir))||Ii)||Ii);_._RF.pop(),_._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var IO,IB,IN,IM,ID,IF,IU,Ix,Iz,IG,IV,IK,IH,Iq,IW,Ij,IX,IY,IJ,IQ,IZ,I$=k.ccclass,I0=k.property,I1=k.executeInEditMode,I2=(Iv=I$("JourneyProgressBar"),Ig=I0(oa),Im=I0(L),Ib=I0(eu),Iw=I0(V),IS=I0(V),IE=I0(x),Iv(I_=I1((IC=st((Ik=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"progressBar",IC,Ke(g)),rt(g,"progressLabel",IA,Ke(g)),rt(g,"labelUIOpacity",IT,Ke(g)),g.currentProgress=10,g.totalProgress=10,g.labelSeparator="/",g}return Ue(i,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(g){this.labelSeparator=g,this.updateProgress()}},{key:"setRange",value:function(g,E){this.totalProgress=E;var _=g;_>E&&(_=E),this.currentProgress=_,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(E=Be(function(g){var E,_,k,C,A,T,R,I,L,P,O,B,N,M,D,F;return _ts_generator(this,function(U){switch(U.label){case 0:E=this,_=g.nextCurr,k=g.nextTotal,C=g.numberOfProgressBar,A=void 0===C?0:C,T=g.onProgressBarPassed,R=g.signal,I=_/k,L=z(this.labelUIOpacity).to(.2,{opacity:0}),P=z(this.labelUIOpacity).to(.2,{opacity:255}),O=A<1?1:Math.sqrt(A)+1,B=0===A?I:A+I,N=1,M=this.progressBar.progress,D=B,F=tZ.runOnUpdateAsync(this.node,O,function(g){var _=el.sineInOut(g),k=eP(M,D,_);E.progressBar.progress=k%1,k>N&&(N=0===k?1:Math.ceil(k),null==T||T())},R);return[4,Promise.all([tZ.runTweenAsync(L,R),F])];case 1:U.sent(),this.currentProgress=_,this.totalProgress=k,this.updateProgress();return[4,tZ.runTweenAsync(P,R)];case 2:return[2,(U.sent(),this.labelUIOpacity.opacity=255,I)]}})}),function(g){return E.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string="".concat(this.currentProgress).concat(this.separator).concat(this.totalProgress)}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(M)).prototype,"progressBar",[Ig],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IA=st(Ik.prototype,"progressLabel",[Im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IT=st(Ik.prototype,"labelUIOpacity",[Ib],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Ik.prototype,"total",[Iw],Object.getOwnPropertyDescriptor(Ik.prototype,"total"),Ik.prototype),st(Ik.prototype,"current",[IS],Object.getOwnPropertyDescriptor(Ik.prototype,"current"),Ik.prototype),st(Ik.prototype,"separator",[IE],Object.getOwnPropertyDescriptor(Ik.prototype,"separator"),Ik.prototype),I_=Ik))||I_)||I_);_._RF.pop(),_._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var I4,I3,I5,I6,I8,I9,I7,Le,Lt,Ln,Li,Lr,La,Lo,Ls,Ll,Lu,Lc,Lp,Lf,Ly,Lv,Lg,Lm,Lb,Lw,LS,LE,L_,Lk,LC,LA,LT=k.ccclass,LR=k.property,LI=(IO=LT("ProgressConfiguration"),IB=LR(ea),IN=LR(x),IO((ID=st((IM=Ue(function e(){Fe(this,e),rt(this,"avatar",ID,this),rt(this,"themeId",IF,this)})).prototype,"avatar",[IB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IF=st(IM.prototype,"themeId",[IN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IM)),IU=LT("JourneyProgressAnimator"),Ix=LR(I2),Iz=LR(C),IG=LR(eo),IV=LR(IP),IK=LR({type:K,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),IH=nk.onlyRunInLifeCycleAsync,Iq=nk.onlyRunInLifeCycle,IU((IX=st((Ij=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"progressBar",IX,Ke(g)),rt(g,"currentLevelAvatarNode",IY,Ke(g)),rt(g,"currentLevelAvatar",IJ,Ke(g)),rt(g,"nextLevelAvatar",IQ,Ke(g)),rt(g,"nextLevelYOffset",IZ,Ke(g)),g.isAnimating=!1,g}return Ue(l,[{key:"setRange",value:function(g,E){this.progressBar.setRange(g,E)}},{key:"animateTo",value:(T=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.isAnimating)return[2,(console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve())];this.isAnimating=!0;_=g!==this.progressBar.current;if(!_)return[3,2];return[4,this.progressBar.animateTo({nextCurr:g,nextTotal:this.progressBar.total,signal:E})];case 1:_=k.sent();k.label=2;case 2:this.isAnimating=!1;return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"animateToNextLevel",value:(A=Be(function(g){var E,_,k,C,A,T,R,I,L,P;return _ts_generator(this,function(O){switch(O.label){case 0:E=this,_=g.nextCurr,k=g.nextTotal,C=g.mapsPassed,A=g.signal;if(!this.isAnimating)return[3,1];console.warn("JourneyProgressAnimator: animation already in progress");return[3,8];case 1:this.isAnimating=!0;T=C.length-2;if(0!==T)return[3,3];return[4,this.progressBar.animateTo({nextCurr:_,nextTotal:k,signal:A})];case 2:return[2,(O.sent(),void(this.isAnimating=!1))];case 3:return[4,this.animateTargetAvaToCenter(A)];case 4:O.sent();R=1;return[4,this.progressBar.animateTo({signal:A,nextCurr:_,nextTotal:k,numberOfProgressBar:T,onProgressBarPassed:function(){if(1===R)return E.nextLevelAvatar.playUnlockAnimation(),void(R+=1);if(R>=C.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");E.nextLevelAvatar.playFlashAnimation(A),E.setNextLevelAvatar(C[R].theme),R+=1}})];case 5:O.sent();return[4,this.animateTargetAvaToPrev(A)];case 6:O.sent();I=C[C.length-1].theme,L=C[C.length-2].theme;this.setCurrentLevelAvatar(L),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal();P=this.nextLevelAvatar;return[4,this.getSpriteFrameByThemeId(I)];case 7:P.avatarSprite=O.sent(),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1;O.label=8;case 8:return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=new em(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);return[4,tZ.runTweenAsync(z(this.nextLevelAvatar.node).to(1,{position:E},{easing:"cubicInOut"}),g)];case 1:_.sent(),this.nextLevelAvatar.node.position=E;return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this.currentLevelAvatarNode.position.clone();return[4,tZ.runTweenAsync(z(this.nextLevelAvatar.node).to(1,{position:E},{easing:"cubicInOut"}),g)];case 1:_.sent(),this.nextLevelAvatar.node.position=E;return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:(_=Be(function(g){return _ts_generator(this,function(E){return[2,n7.loadThemeThumbnailAsync(g)]})}),function(g){return _.apply(this,arguments)})},{key:"loadAndSetAvatar",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.getSpriteFrameByThemeId(g)];case 1:_=k.sent();_?this.setAvatar(_,E):console.warn("JourneyProgressAnimator: ".concat(g," is null"));return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"setAvatar",value:function(g,E){_instanceof(E,IP)?E.avatarSprite=g:E.spriteFrame=g}},{key:"setCurrentLevelAvatar",value:function(g){this.loadAndSetAvatar(g,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(g){this.loadAndSetAvatar(g,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}}]),l}(M)).prototype,"progressBar",[Ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IY=st(Ij.prototype,"currentLevelAvatarNode",[Iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IJ=st(Ij.prototype,"currentLevelAvatar",[IG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IQ=st(Ij.prototype,"nextLevelAvatar",[IV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IZ=st(Ij.prototype,"nextLevelYOffset",[IK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),st(Ij.prototype,"loadAndSetAvatar",[IH],Object.getOwnPropertyDescriptor(Ij.prototype,"loadAndSetAvatar"),Ij.prototype),st(Ij.prototype,"setAvatar",[Iq],Object.getOwnPropertyDescriptor(Ij.prototype,"setAvatar"),Ij.prototype),IW=Ij))||IW);_._RF.pop(),_._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var LL,LP,LO,LB,LN,LM,LD,LF,LU,Lx=k.ccclass,Lz=k.property,LG=globalThis.game,LV=LG.storage,LK=LG.monitorError,LH=GameCore.Utils,Lq=LH.Array,LW=LH.Json,Lj=(I4=Lx("HomeContent"),I3=nk.required(),I5=Lz({type:L,group:"Play Button"}),I6=nk.required(),I8=Lz({type:B,group:"Play Button"}),I9=nk.required(),I7=Lz({type:C,group:"Play Button"}),Le=nk.required(),Lt=Lz({type:C,group:"Play Button"}),Ln=nk.required(),Li=Lz(LI),Lr=nk.required(),La=Lz(Iy),Lo=nk.required(),Ls=Lz(eu),Ll=nk.required(),Lu=Lz(k3),Lc=nk.onlyRunInLifeCycleAsync,Lp=nk.onlyRunInLifeCycleAsync,Lf=nk.onlyRunInLifeCycleAsync,Ly=nk.onlyRunInLifeCycleAsync,Lv=nk.onlyRunInLifeCycleAsync,I4((Lb=st((Lm=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"playButtonLabel",Lb,Ke(g)),rt(g,"playButton",Lw,Ke(g)),rt(g,"playBackground",LS,Ke(g)),rt(g,"hardLevelBackground",LE,Ke(g)),rt(g,"journeyProgressAnimator",L_,Ke(g)),rt(g,"dashboardHeader",Lk,Ke(g)),rt(g,"overlayDuringAnim",LC,Ke(g)),rt(g,"coinContainer",LA,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){nk.decorateComponent(this)}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(nR)}},{key:"setPlayButton",value:function(g){var E="Level ".concat(g);this.playButtonLabel.string=E;var _=g%5==0;this.playBackground.active=!_,this.hardLevelBackground.active=_}},{key:"updateStarProgress",value:function(g){this.dashboardHeader.updateStarProgress(g)}},{key:"setUnlockProgress",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E;this.setProgress(g),this.updateCurrentMapInStorage(g,_)}},{key:"shouldPlayUnlockAnimation",value:function(){var g,E,_=LV.getStorage("dashboard");if(null==_)return null==LK||LK.sendException(new Error("DashboardScene: dashboardStorage not found")),!1;if(!(null!==(g=_.animateToCurrentLevel)&&void 0!==g&&g))return!1;var k=LV.getStorage("tournament");if(null==k)return null==LK||LK.sendException(new Error("DashboardScene: tournamentStorage not found")),!1;if(null!==(E=k.animateTournamentLeader)&&void 0!==E&&E)return!1;var C=_.lastMapPayload,A=ll.getCurrentMapProgress();return LW.encode(C)!==LW.encode(A)&&!(Lq.searchIndex(lt.mapOrder,function(g){return g.id===C.id})>Lq.searchIndex(lt.mapOrder,function(g){return g.id===A.id}))}},{key:"playUnlockProgressAnimation",value:function(g){var E=LV.getStorage("dashboard");if(null==E)throw new Error("DashboardScene: dashboardStorage not found");var _=E.lastMapPayload,k=ll.getCurrentMapProgress(),C=Lq.searchIndex(lt.mapOrder,function(g){return g.id===_.id}),A=Lq.searchIndex(lt.mapOrder,function(g){return g.id===k.id}),T=lt.mapOrder.slice(C,A+2);return _.id===k.id?this.playUnlockProgressAnimationOnly(k,_,g):this.playUnlockProgressAndPackAnimation(_,k,T,g)}},{key:"playUnlockProgressAndPackAnimation",value:(C=Be(function(g,E,_,k){return _ts_generator(this,function(C){switch(C.label){case 0:this.setProgress(Me({},g)),this.updateCurrentMapInStorage(Me({},E),!0),this.playButton.interactable=!1;return[4,this.showOwnOverlay(k)];case 1:C.sent();return[4,this.journeyProgressAnimator.animateToNextLevel({nextCurr:E.progress,nextTotal:E.max,mapsPassed:_,signal:k})];case 2:C.sent();return[4,this.hideOwnOverlay(k)];case 3:C.sent(),this.playButton.interactable=!0;return[2]}})}),function(g,E,_,k){return C.apply(this,arguments)})},{key:"playUnlockProgressAnimationOnly",value:(k=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:this.setProgress(Me(Me({},g),{},{progress:E.progress})),this.updateCurrentMapInStorage(Me({},g),!0);k=g.progress;return[4,this.showOwnOverlay(_)];case 1:C.sent();return[4,this.journeyProgressAnimator.animateTo(k,_)];case 2:C.sent();return[4,this.hideOwnOverlay(_)];case 3:C.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"hideOwnOverlay",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runTweenAsync(z(this.overlayDuringAnim).to(.3,{opacity:0}),g)];case 1:E.sent(),this.overlayDuringAnim.opacity=0;return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"showOwnOverlay",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runTweenAsync(z(this.overlayDuringAnim).to(.3,{opacity:150}),g)];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setProgress",value:function(g){var E=g.currentTheme,_=g.nextTheme,k=g.progress,C=g.max;this.journeyProgressAnimator.setCurrentLevelAvatar(E),this.journeyProgressAnimator.setNextLevelAvatar(null!=_?_:E),this.journeyProgressAnimator.setRange(k,C)}},{key:"updateCurrentMapInStorage",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=LV.getStorage("dashboard");if(null!=k){var C=k.animateToCurrentLevel;LV.setStorageData("dashboard","animateToCurrentLevel",!_&&C),LV.setStorageData("dashboard","lastMapPayload",g)}else null==LK||LK.sendException(new Error("DashboardScene: dashboardStorage not found"))}}]),r}(M)).prototype,"playButtonLabel",[I3,I5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lw=st(Lm.prototype,"playButton",[I6,I8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LS=st(Lm.prototype,"playBackground",[I9,I7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LE=st(Lm.prototype,"hardLevelBackground",[Le,Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L_=st(Lm.prototype,"journeyProgressAnimator",[Ln,Li],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lk=st(Lm.prototype,"dashboardHeader",[Lr,La],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LC=st(Lm.prototype,"overlayDuringAnim",[Lo,Ls],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LA=st(Lm.prototype,"coinContainer",[Ll,Lu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Lm.prototype,"playUnlockProgressAnimation",[Lc],Object.getOwnPropertyDescriptor(Lm.prototype,"playUnlockProgressAnimation"),Lm.prototype),st(Lm.prototype,"playUnlockProgressAndPackAnimation",[Lp],Object.getOwnPropertyDescriptor(Lm.prototype,"playUnlockProgressAndPackAnimation"),Lm.prototype),st(Lm.prototype,"playUnlockProgressAnimationOnly",[Lf],Object.getOwnPropertyDescriptor(Lm.prototype,"playUnlockProgressAnimationOnly"),Lm.prototype),st(Lm.prototype,"hideOwnOverlay",[Ly],Object.getOwnPropertyDescriptor(Lm.prototype,"hideOwnOverlay"),Lm.prototype),st(Lm.prototype,"showOwnOverlay",[Lv],Object.getOwnPropertyDescriptor(Lm.prototype,"showOwnOverlay"),Lm.prototype),Lg=Lm))||Lg);_._RF.pop(),_._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var LX,LY,LJ,LQ,LZ,L$,L0,L1,L2,L4,L3,L5,L6,L8,L9,L7,Pe,Pt,Pn,Pi,Pr,Pa,Po,Ps,Pl,Pu,Pc,Ph,Pp,Pd,Pf,Py,Pv,Pg=k.ccclass,Pm=k.property,Pb=GameCore.Utils.Array,Pw=(LL=Pg("NavManager"),LP=Pm(C),LO=Pm(C),LB=Pm(t2),LL((LD=st((LM=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"selectorNode",LD,Ke(g)),rt(g,"selectedButtonNode",LF,Ke(g)),rt(g,"autoLayout",LU,Ke(g)),g.navButtons=[],g.isNavigating=!1,g}return Ue(s,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var g;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(g=this.selectedButtonNode)||void 0===g?void 0:g.getComponentInChildren("NavButton"),nk.lazyValidateProperties(this)}},{key:"select",value:(A=Be(function(g){var E;return _ts_generator(this,function(_){E=this;if(!this.isNavigating){if(!Pb.has(this.navButtons,g))throw new Error("NavManager: Button not found");if(g!==this.selectedButton){if(!g.isWIP)return[2,(this.isNavigating=!0,this.node.scene.emit(nI,{from:this.selectedButton.buttonType,to:g.buttonType}),new Promise(function(_){E.node.scene.once(nL,function(){var k=E.selectedButton.deselect();E.autoLayout.selectedIndex=E.navButtons.indexOf(g),E.selectedButton=g;var C=E.autoLayout.getSelectedWorldX()-g.getSelectedWorldDistanceX(),A=E.playSelectorAnimation(C),T=g.select();Promise.all([k,T,A]).then(function(){E.isNavigating=!1,_()})})}))];this.handleWIPButton()}}return[2]})}),function(g){return A.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(C=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=this.isNavigating;if(E)return[3,4];if(!Pb.has([nO.store],g.buttonType))return[3,1];_=this.handleWIPButton();return[3,3];case 1:return[4,this.select(g)];case 2:_=k.sent();k.label=3;case 3:E=_;k.label=4;case 4:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"selectByType",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=Pb.search(this.navButtons,function(E){return E.buttonType===g});if(!E)throw new Error("NavManager: Button not found");return[4,this.selectUsingSceneTransition(E)];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"handleWIPButton",value:function(){l1.openScreen(ig.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){g=this;if(!this.currentButton||!Pb.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");E=this.currentButton.buttonType;return[2,(this.node.scene.emit(nI,{from:null,to:E}),new Promise(function(E){g.node.scene.once(nL,function(){g.autoLayout.selectedIndex=g.navButtons.indexOf(g.currentButton);var _=g.navButtons.map(function(E){return E===g.currentButton?E.select(!1):E.deselect(!1,!0)}),k=g.autoLayout.getSelectedWorldX()-g.currentButton.getSelectedWorldDistanceX();g.selectorNode.worldPosition=new em(k,g.selectorNode.worldPosition.y,0),Promise.all(_).then(function(){E()})})}))]})}),function(){return _.apply(this,arguments)})},{key:"playSelectorAnimation",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=new em(1,1,1),k=this.selectorNode.worldPosition.clone(),C=new em(1.2*_.x,.8*_.y,1);return[4,tZ.runTweenAsync(z(this.selectorNode).to(.3,{worldPosition:new em(g,k.y,0)},{easing:"quintInOut",onUpdate:function(g,k){if(void 0!==k){var A=E.calculateCurrentSquashScale(_,C,k);E.selectorNode.scale=A}}}))];case 1:A.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setIgnoreInput",value:function(g){var E,_=!(arguments.length>0&&void 0!==g)||g,k=at(this.navButtons);try{for(k.s();!(E=k.n()).done;){var C=E.value,A=C.getComponentInChildren(B);A&&(A.interactable=!_)}}catch(g){k.e(g)}finally{k.f()}}},{key:"calculateCurrentSquashScale",value:function(g,E,_){var k=this.splitIntoSquashRatio(_);return g.clone().lerp(E,k)}},{key:"splitIntoSquashRatio",value:function(g){return g<.5?2*g:1-2*(g-.5)}}]),s}(M)).prototype,"selectorNode",[LP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LF=st(LM.prototype,"selectedButtonNode",[LO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LU=st(LM.prototype,"autoLayout",[LB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LN=LM))||LN);_._RF.pop(),_._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var PS,PE,P_,Pk,PC,PA,PT,PR,PI,PL,PP,PO,PB=k.ccclass,PN=k.disallowMultiple,PM=k.property,PD=globalThis.game,PF=PD.event,PU=PD.storage,Px=PD.player,Pz=PD.leaderboard,PG=GameCore,PV=PG.Events,PK=PG.Match.Modes,PH=PG.Configs.DailyRewards,Pq=PG.Utils,PW=Pq.Time,Pj=Pq.Array;LX=PB("DashboardScene"),LY=nk.required(),LJ=PM(_W),LQ=nk.required(),LZ=PM(Pw),L$=nk.required(),L0=PM(io),L1=nk.required(),L2=PM(RN),L4=nk.required(),L3=PM(kU),L5=nk.onlyRunInLifeCycle,L6=nk.onlyRunInLifeCycle,L8=nk.onlyRunInLifeCycleAsync,L9=nk.onlyRunInLifeCycleAsync,L7=nk.onlyRunInLifeCycleAsync,Pe=nk.onlyRunInLifeCycleAsync,Pt=nk.onlyRunInLifeCycle,Pn=nk.onlyRunInLifeCycleAsync,Pi=nk.onlyRunInLifeCycleAsync,Pr=nk.onlyRunInLifeCycleAsync,Pa=nk.onlyRunInLifeCycleAsync,Po=nk.onlyRunInLifeCycleAsync,Ps=nk.onlyRunInLifeCycleAsync,Pl=nk.onlyRunInLifeCycleAsync,Pu=nk.onlyRunInLifeCycle,LX(Pc=PN((Pp=st((Ph=function(g){ze(v,g);var E,_,k,C,A,T,R,I,L,P,O,B,N,M,D=Xe(v);function v(){var g;Fe(this,v);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=D.call.apply(D,[this].concat(_)),"coinManager",Pp,Ke(g)),rt(g,"navManager",Pd,Ke(g)),rt(g,"bgComp",Pf,Ke(g)),rt(g,"pageManager",Py,Ke(g)),rt(g,"pageAnimSkipOverlay",Pv,Ke(g)),g.firstNavigation=!0,g.isFirstNavToCollections=!0,g.isFirstNavToTournament=!0,g.navigationSignal=null,g.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch(function(g){console.warn("subscribeBotAsync",g)})},g.playBgAnim=Be(function(){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=PU.getStorage("dashboard");if(null==_)throw new Error("DashboardScene: dashboardStorage not found");k=null!==(E=_.animateToCurrentLevel)&&void 0!==E&&E,C=Me({},_.lastMapPayload),A=ll.getCurrentMapProgress(),T=C.currentTheme===A.currentTheme&&C.nextTheme===A.nextTheme,R=A.currentTheme;if(!(k&&!T))return[3,5];return[4,tZ.waitTweenAsync(2)];case 1:I.sent();I.label=2;case 2:I.trys.push([2,4,,5]);return[4,g.bgComp.animateToNextTheme(R)];case 3:I.sent();return[3,5];case 4:I.sent();return[3,5];case 5:return[2]}})}),g}return Ue(v,[{key:"__preload",value:function(){}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(nI,this.onNavigate,this)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(nR,this.handlePlayButtonPress,this),this.node.scene.on(nP,this.handleEventButtonPress,this)}},{key:"onLoad",value:function(){nk.decorateComponent(this),this.listenNavigationEvents(),this.listenDashboardEvents(),this.coinManager.init(),ll.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(ll.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var g,E=(null!==(g=Px.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;_=0===_?1:_,Px.setGameData({level:_})}},{key:"start",value:function(){Px.getPlayerSetting("music")&&this.updateMusic(),this.playBgAnim(),this.pageManager.init(),this.navManager.selectDefaultNavBtn(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadScenes",value:function(){lU.preloadGameScene()}},{key:"initBgComp",value:function(){var g,E=PU.getStorage("dashboard");if(null==E)throw new Error("DashboardScene: dashboardStorage not found");var _=null!==(g=E.animateToCurrentLevel)&&void 0!==g&&g,k=Me({},E.lastMapPayload),C=ll.getCurrentMapProgress(),A=k.currentTheme===C.currentTheme&&k.nextTheme===C.nextTheme,T=C.currentTheme;_&&!A?this.bgComp.setCurrentTheme(k.currentTheme):this.bgComp.setCurrentTheme(T)}},{key:"handlePlayButtonPress",value:(M=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:T.trys.push([0,3,,4]);E=ll.getCurrentMapProgress(),_=(null!==(g=Px.getGameData())&&void 0!==g?g:{}).level,k=void 0===_?1:_;return[4,l_.setMatchCustomDataAsync({level:k})];case 1:T.sent();return[4,l_.startMatchAsync(PK.SINGLE)];case 2:T.sent(),this.updateCurrentMapInStorage(E),PU.setStorageData("collection","lastMapPack",E.id),PU.setStorageData("collection","animateMapPackUnlock",!1);C=PU.getStorage("leaderboard_content").lastTabOpened;this.getPlayerLeader(C).then(function(g){if(g){var E=g.score;PU.setStorageData("leaderboard_content","previousScore",E)}}),lU.switchScene(sQ,{level:k});return[3,4];case 3:A=T.sent();return[2,void console.error(A)];case 4:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"getPlayerLeader",value:(N=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E="global"===g?sH:sq;if(!E)return[2,null];_=Px.getPlayerId();return[4,Pz.getLeadersByPlayerIdsAsync(E,[_])];case 1:k=C.sent();return[2,0===k.length?null:k[0]]}})}),function(g){return N.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(g){PU.setStorageData("dashboard","animateToCurrentLevel",!1),PU.setStorageData("dashboard","lastMapPayload",g)}},{key:"updateMusic",value:(B=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=i5.getCurrentMusic()!==ic.BG_MUSIC;if(!g)return[3,3];return[4,i5.setVolumeMusic(0,!0)];case 1:E.sent();return[4,tZ.waitTweenAsync(1)];case 2:g=E.sent();E.label=3;case 3:i5.playMusic(ic.BG_MUSIC),i5.turnUpMusic();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"checkDailyRewardsOpenable",value:function(){var g=Px.getPlayerData().dailyRewarded,E=g.logDays,_=void 0===E?[]:E,k=g.lastRewarded,C=void 0===k?0:k;if(_.length>PH.MaxDays)return!0;if(PH.MockTime>0&&Date.now()-C>=1e3*PH.MockTime)return!0;return!PW.isToday(C)}},{key:"onNavigate",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=(this.firstNavigation&&(this.firstNavigation=!1,this.pageManager.unmountAndHideAll()),g.to);switch(E){case nO.store:return[3,1];case nO.collections:return[3,2];case nO.tournaments:return[3,5];case nO.leaderboard:return[3,5];case nO.home:return[3,7]}return[3,9];case 1:return[3,10];case 2:return[4,this.triggerPageNavigation(g)];case 3:_.sent();return[4,this.handleLogicAfterNavigateToCollections()];case 4:_.sent(),this.cleanupAfterPageNavigation();return[3,10];case 5:return[4,this.triggerPageNavigation(g)];case 6:_.sent(),this.cleanupAfterPageNavigation();return[3,10];case 7:return[4,this.handleNavigateToHome(g)];case 8:_.sent();return[3,10];case 9:throw new Error("DashboardScene: Unhandled page name");case 10:return[2]}})}),function(g){return O.apply(this,arguments)})},{key:"handleLogicAfterNavigateToCollections",value:(P=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=null===(g=this.pageManager.getPage(nO.collections))||void 0===g?void 0:g.getContainer().getComponentInChildren(TF);if(null==E)throw new Error("CollectionsContent not found");_=new nN,k=E.shouldAnimateThemeBlockUnlock();C=k;if(!C)return[3,2];return[4,this.openSkipOverlay(_)];case 1:C=T.sent();T.label=2;case 2:return[4,this.tryPlayScrollToCollectionAnim(E,_)];case 3:T.sent();return[4,E.playThemeTabUnlockAnim(_)];case 4:T.sent();A=k;if(!A)return[3,6];return[4,this.closeSkipOverlay()];case 5:A=T.sent();T.label=6;case 6:_.abort();return[2]}})}),function(){return P.apply(this,arguments)})},{key:"closeSkipOverlay",value:(L=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.pageAnimSkipOverlay.close()];case 1:g.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"openSkipOverlay",value:(I=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,this.pageAnimSkipOverlay.open({onSkip:function(){return g.abort()},opacity:200})];case 1:E.sent();return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"tryPlayScrollToCollectionAnim",value:(R=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=ll.getCurrentUnlockingThemeIndex();k=this.isFirstNavToCollections&&null!==_;if(!k)return[3,2];return[4,g.scrollToCurrentUnlockingTheme(_,E)];case 1:k=(C.sent(),this.isFirstNavToCollections=!1);C.label=2;case 2:return[2]}})}),function(g,E){return R.apply(this,arguments)})},{key:"cleanupAfterPageNavigation",value:function(){this.navManager.setIgnoreInput(!1)}},{key:"triggerPageNavigation",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:null===(E=this.navigationSignal)||void 0===E||E.abort(),this.navigationSignal=new nN;return[4,this.pageManager.navigate(g,this.navigationSignal)];case 1:_.sent();return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"handleNavigateToHome",value:(A=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=this;null===(E=this.navigationSignal)||void 0===E||E.abort(),this.navigationSignal=new nN;return[4,this.pageManager.navigate(g,this.navigationSignal,Be(function(){return _ts_generator(this,function(g){_.initializeHomepageCoinManager();return[2]})}))];case 1:k.sent();return[4,this.handleLogicAfterNavigateToHome()];case 2:k.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"handleLogicAfterNavigateToHome",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.tryOpenDailyRewardsScreen()];case 1:g.sent(),this.attemptCallSubscribeBot();return[4,this.waitUntilCoinManagerFinishesAnyAnimation()];case 2:g.sent();return[4,this.waitUntilPageAnimSkipOverlayCloses()];case 3:g.sent();return[4,this.tryNavigateToTournament()];case 4:g.sent();return[4,this.tryPlayLevelUpAnimation()];case 5:g.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"waitUntilCoinManagerFinishesAnyAnimation",value:function(){return this.coinManager.untilFinishesCollectAnim()}},{key:"waitUntilPageAnimSkipOverlayCloses",value:function(){return this.pageAnimSkipOverlay.untilClosed()}},{key:"tryNavigateToTournament",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if(!PU.getStorage("tournament").animateTournamentLeader)return[3,2];return[4,this.navManager.selectByType(nO.tournaments)];case 1:return[2,g.sent()];case 2:if(!this.isFirstNavToTournament)return[3,8];this.isFirstNavToTournament=!1;g.label=3;case 3:g.trys.push([3,7,,8]);if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");return[4,GameSDK.getTournamentAsync()];case 4:if(!(g.sent().getEndTime()<Date.now()/1e3))return[3,6];return[4,this.navManager.selectByType(nO.tournaments)];case 5:return[2,g.sent()];case 6:return[3,8];case 7:g.sent();return[3,8];case 8:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"tryPlayLevelUpAnimation",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:E=this,_=null===(g=this.pageManager.getPage(nO.home))||void 0===g?void 0:g.getContainer().getComponentInChildren(Lj);if(null==_)throw new Error("DashboardScene: Homepage not found");k=new nN;k.chain(this.navigationSignal);C=_.shouldPlayUnlockAnimation(),A=this.shouldPlayPackUnlockAnimation();T=C;if(!T)return[3,7];R=A;if(!R)return[3,2];return[4,this.pageAnimSkipOverlay.open({onSkip:function(){return k.abort()},opacity:150})];case 1:R=L.sent();L.label=2;case 2:return[4,_.playUnlockProgressAnimation(k)];case 3:L.sent();I=A;if(!I)return[3,6];return[4,this.pageAnimSkipOverlay.close()];case 4:L.sent();return[4,k.callAsync(function(){return E.navManager.selectByType(nO.collections)})];case 5:I=L.sent();L.label=6;case 6:T=I;L.label=7;case 7:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"shouldPlayPackUnlockAnimation",value:function(){var g=PU.getStorage("dashboard");if(null==g)throw new Error("DashboardScene: dashboardStorage not found");var E=g.lastMapPayload,_=ll.getCurrentMapProgress();return Pj.searchIndex(lt.mapOrder,function(g){return g.id===E.id})!==Pj.searchIndex(lt.mapOrder,function(g){return g.id===_.id})}},{key:"initializeHomepageCoinManager",value:function(){var g,E=null===(g=this.pageManager.getPage(nO.home))||void 0===g?void 0:g.getContainer().getComponentInChildren(Lj);if(null==E)throw new Error("DashboardScene: Homepage not found");this.coinManager.setTargetContainer(E.getCoinContainer()),this.coinManager.emitCoinAmount()}},{key:"tryOpenDailyRewardsScreen",value:(E=Be(function(){return _ts_generator(this,function(g){if(this.checkDailyRewardsOpenable())return[2,(l1.openScreen(ig.DAILY_REWARDS_SCREEN),new Promise(function(g){PF.on(PV.CLOSED_SCREEN,function t(E){E.screenName===im[ig.DAILY_REWARDS_SCREEN]&&(g(),PF.off(PV.CLOSED_SCREEN,t))})}))];return[2]})}),function(){return E.apply(this,arguments)})},{key:"handleEventButtonPress",value:function(g){switch(g.type){case Ef.STAR_CHEST:l1.openScreen(ig.STAR_CHEST_SCREEN);break;case Ef.BALLOON:l1.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}}}]),v}(M)).prototype,"coinManager",[LY,LJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pd=st(Ph.prototype,"navManager",[LQ,LZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pf=st(Ph.prototype,"bgComp",[L$,L0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Py=st(Ph.prototype,"pageManager",[L1,L2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv=st(Ph.prototype,"pageAnimSkipOverlay",[L4,L3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Ph.prototype,"preloadScenes",[L5],Object.getOwnPropertyDescriptor(Ph.prototype,"preloadScenes"),Ph.prototype),st(Ph.prototype,"initBgComp",[L6],Object.getOwnPropertyDescriptor(Ph.prototype,"initBgComp"),Ph.prototype),st(Ph.prototype,"handlePlayButtonPress",[L8],Object.getOwnPropertyDescriptor(Ph.prototype,"handlePlayButtonPress"),Ph.prototype),st(Ph.prototype,"onNavigate",[L9],Object.getOwnPropertyDescriptor(Ph.prototype,"onNavigate"),Ph.prototype),st(Ph.prototype,"handleLogicAfterNavigateToCollections",[L7],Object.getOwnPropertyDescriptor(Ph.prototype,"handleLogicAfterNavigateToCollections"),Ph.prototype),st(Ph.prototype,"tryPlayScrollToCollectionAnim",[Pe],Object.getOwnPropertyDescriptor(Ph.prototype,"tryPlayScrollToCollectionAnim"),Ph.prototype),st(Ph.prototype,"cleanupAfterPageNavigation",[Pt],Object.getOwnPropertyDescriptor(Ph.prototype,"cleanupAfterPageNavigation"),Ph.prototype),st(Ph.prototype,"triggerPageNavigation",[Pn],Object.getOwnPropertyDescriptor(Ph.prototype,"triggerPageNavigation"),Ph.prototype),st(Ph.prototype,"handleNavigateToHome",[Pi],Object.getOwnPropertyDescriptor(Ph.prototype,"handleNavigateToHome"),Ph.prototype),st(Ph.prototype,"waitUntilCoinManagerFinishesAnyAnimation",[Pr],Object.getOwnPropertyDescriptor(Ph.prototype,"waitUntilCoinManagerFinishesAnyAnimation"),Ph.prototype),st(Ph.prototype,"waitUntilPageAnimSkipOverlayCloses",[Pa],Object.getOwnPropertyDescriptor(Ph.prototype,"waitUntilPageAnimSkipOverlayCloses"),Ph.prototype),st(Ph.prototype,"tryNavigateToTournament",[Po],Object.getOwnPropertyDescriptor(Ph.prototype,"tryNavigateToTournament"),Ph.prototype),st(Ph.prototype,"tryPlayLevelUpAnimation",[Ps],Object.getOwnPropertyDescriptor(Ph.prototype,"tryPlayLevelUpAnimation"),Ph.prototype),st(Ph.prototype,"tryOpenDailyRewardsScreen",[Pl],Object.getOwnPropertyDescriptor(Ph.prototype,"tryOpenDailyRewardsScreen"),Ph.prototype),st(Ph.prototype,"handleEventButtonPress",[Pu],Object.getOwnPropertyDescriptor(Ph.prototype,"handleEventButtonPress"),Ph.prototype),Pc=Ph))||Pc);_._RF.pop(),_._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var PX,PY=k.ccclass,PJ=k.property,PQ=globalThis.game,PZ=PQ.player,P$=PQ.storage,P0=PQ.monitorError,P1=GameCore.Utils.Number;PS=PY("HomePage"),PE=nk.required(),P_=PJ({type:L,group:"Placeholders"}),Pk=nk.required(),PC=nk.getComponent(ac),PA=nk.onlyRunInLifeCycleAsync,PT=nk.onlyRunInLifeCycle,PR=nk.onlyRunInLifeCycleAsync,PI=nk.onlyRunInLifeCycleAsync,PS((PP=st((PL=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"coinLabel",PP,Ke(g)),rt(g,"panelAnimationController",PO,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nk.decorateComponent(this)}},{key:"onEnable",value:function(){this.node.scene.on(r0.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"onDisable",value:function(){this.node.scene.off(r0.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"updatePlaceholderCoins",value:(C=Be(function(g){return _ts_generator(this,function(E){this.coinLabel.string=P1.getShortNumber(g.coins,3);return[2]})}),function(g){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){var g,E,_;if(!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(Lj),!this.homeContent))throw new Error("HomePage: homeContent not found");var k=PZ.getGameData(),C=null!==(g=null==k?void 0:k.coins)&&void 0!==g?g:0;this.updatePlaceholderCoins({coins:C});var A=null!==(E=null==k?void 0:k.level)&&void 0!==E?E:1;this.homeContent.setPlayButton(A);var T=null!==(_=null==k?void 0:k.stars)&&void 0!==_?_:0;this.homeContent.updateStarProgress(T),this.initUnlockProgressData()}},{key:"initUnlockProgressData",value:function(){var g=this.homeContent.shouldPlayUnlockAnimation(),E=Me({},ll.getCurrentMapProgress()),_=P$.getStorage("dashboard");if(null==_)return null==P0||P0.sendException(new Error("DashboardScene: dashboardStorage not found")),void(g||this.homeContent.setUnlockProgress(E));var k=Me({},_.lastMapPayload);g?this.homeContent.setUnlockProgress(k):this.homeContent.setUnlockProgress(E)}},{key:"transitionIn",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:g.sent();return[4,this.panelAnimationController.showUI()];case 2:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent();return[4,this.panelAnimationController.hideUI()];case 2:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hasLoadedPage",value:function(){return!0}}]),r}(Ag)).prototype,"coinLabel",[PE,P_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PO=st(PL.prototype,"panelAnimationController",[Pk,PC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(PL.prototype,"mount",[PA],Object.getOwnPropertyDescriptor(PL.prototype,"mount"),PL.prototype),st(PL.prototype,"onMount",[PT],Object.getOwnPropertyDescriptor(PL.prototype,"onMount"),PL.prototype),st(PL.prototype,"transitionIn",[PR],Object.getOwnPropertyDescriptor(PL.prototype,"transitionIn"),PL.prototype),st(PL.prototype,"transitionOut",[PI],Object.getOwnPropertyDescriptor(PL.prototype,"transitionOut"),PL.prototype),PL));_._RF.pop(),_._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var P2,P4,P3,P5,P6,P8,P9,P7,Oe,Ot,On,Oi,Or,Oa,Oo,Os,Ol,Ou,Oc,Op,Of=(0,k.ccclass)("LeaderboardIsEmpty")(PX=function(g){ze(i,g);var E,_=Xe(i);function i(){return Fe(this,i),_.apply(this,arguments)}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.uiOpacity.opacity=255;g=this.node.position.clone(),E=z(this.node);E.to(.05,{position:g.clone().add3f(5,0,0)}),E.to(.05,{position:g.clone().add3f(-5,0,0)});_=z(this.node).repeat(2,E);_.to(.05,{position:g});return[4,tZ.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),i}(M))||PX;_._RF.pop(),_._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var Oy,Ov,Og,Om,Ob,Ow,OS,OE=k.ccclass,O_=k.property,Ok=k.requireComponent,OC=globalThis.game.analytics,OA=GameCore,OT=OA.Utils.Array,OR=OA.Plugins.Analytics.Events,OI=(P2=OE("SwitchButton"),P4=Ok([B,G]),P3=O_(J),P5=O_(C),P6=O_(C),P8=O_(J),P9=O_({visible:function(){return this.useSound},type:ip}),P7=O_(J),Oe=O_({visible:function(){return this.useDesktopHover},type:ei}),Ot=O_({visible:function(){return this.useDesktopHover},type:ei}),P2(On=P4((Or=st((Oi=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"enable",Or,Ke(g)),rt(g,"nodeOn",Oa,Ke(g)),rt(g,"nodeOff",Oo,Ke(g)),rt(g,"useSound",Os,Ke(g)),rt(g,"soundKey",Ol,Ke(g)),rt(g,"useDesktopHover",Ou,Ke(g)),rt(g,"mouseEnterClip",Oc,Ke(g)),rt(g,"mouseLeaveClip",Op,Ke(g)),g.isMouseLeaved=!1,g.onMouseEnter=function(E){g.useDesktopHover&&g.buttonComponent.interactable&&(g.isMouseLeaved=!1,g.animationComponent.play(g.mouseEnterClip.name))},g.onMouseLeave=function(E){g.useDesktopHover&&g.buttonComponent.interactable&&(g.isMouseLeaved||(g.isMouseLeaved=!0,g.animationComponent.play(g.mouseLeaveClip.name)))},g}return Ue(n,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(B),this.animationComponent=this.getComponent(G),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var g=this.animationComponent.clips.map(function(g){return null==g?void 0:g.name}).filter(function(g){return null!=g&&"string"==typeof g});this.useDesktopHover&&(OT.has(g,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),OT.has(g,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(OC.event(OR.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&i5.playSound(iv[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(g){this.node.active&&this.updateStatus(g)}},{key:"updateStatus",value:function(g){return this.enable===g||(this.onMouseLeave(null),this.enable=g,this.nodeOn.active=g,this.nodeOff.active=!g),this.enable}}]),n}(M)).prototype,"enable",[P3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Oa=st(Oi.prototype,"nodeOn",[P5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oo=st(Oi.prototype,"nodeOff",[P6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Os=st(Oi.prototype,"useSound",[P8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ol=st(Oi.prototype,"soundKey",[P9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ip[ic.BUTTON_CLICK]}}),Ou=st(Oi.prototype,"useDesktopHover",[P7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Oc=st(Oi.prototype,"mouseEnterClip",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Op=st(Oi.prototype,"mouseLeaveClip",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),On=Oi))||On)||On);_._RF.pop(),_._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var OL,OP,OO,OB,ON,OM,OD,OF,OU,Ox=k.ccclass,Oz=k.property,OG=globalThis.game.analytics,OV=GameCore.Plugins.Analytics.Events,OK=(Oy=Ox("Tabs"),Ov=Oz(OI),Og=Oz(OI),Oy((Ow=st((Ob=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"tabWorld",Ow,Ke(g)),rt(g,"tabFriends",OS,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents(),"MsGames"===GameSDK.getSDKName()&&(this.tabWorld.node.active=!1,this.tabFriends.node.active=!1)}},{key:"validateRequiredComponents",value:function(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}},{key:"setInteractableButtons",value:function(g){this.tabWorld.getComponent(B).interactable=g,this.tabFriends.getComponent(B).interactable=g}},{key:"updateStatus",value:function(g){this.tabWorld.setEnabled("global"===g),this.tabFriends.setEnabled("friends"===g)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),i5.playSound(ic.BUTTON_CLICK),OG.event(OV.BUTTON_CLICK,{button_name:this.node.name,screen_name:i_.getCurrentPage()}),this.node.scene.emit(Ey.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),i5.playSound(ic.BUTTON_CLICK),OG.event(OV.BUTTON_CLICK,{button_name:this.node.name,screen_name:i_.getCurrentPage()}),this.node.scene.emit(Ey.FRIENDS_TAB_SELECTED)}}]),n}(M)).prototype,"tabWorld",[Ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OS=st(Ob.prototype,"tabFriends",[Og],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Om=Ob))||Om);_._RF.pop(),_._RF.push({},"91613SO4bxPDq9dH9zxyIef","LeaderboardTimer",void 0);var OH,Oq,OW,Oj,OX,OY=k.ccclass,OJ=k.property,OQ=GameCore.Utils.Time,OZ=(OL=OY("LeaderboardTimer"),OP=OJ(R),OO=OJ(C),OB=OJ(L),OL((OD=st((OM=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"background",OD,Ke(g)),rt(g,"calendar",OF,Ke(g)),rt(g,"timerLabel",OU,Ke(g)),g.alreadyShown=!1,g}return Ue(i,[{key:"onLoad",value:function(){this.timerOpacity=this.timerLabel.node.getComponent(eu),this.validateRequiredComponents(),this.backgroundDefaultWidth=this.background.width,this.calendarDefaultPosition=this.calendar.position.clone()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(!this.alreadyShown&&!g.aborted))return[3,3];this.alreadyShown=!0;E=z(this.calendar).to(.3,{scale:em.ONE},{easing:"backOut"}).to(.3,{position:this.calendarDefaultPosition.clone()},{easing:"quadOut"}),_=z(this.background).delay(.3).to(.3,{width:this.backgroundDefaultWidth},{easing:"quadOut"}),k=z(this.timerOpacity).to(.3,{opacity:255});return[4,Promise.all([tZ.runTweenAsync(E,g),tZ.runTweenAsync(_,g)])];case 1:C.sent(),this.calendar.scale=em.ONE,this.calendar.position=this.calendarDefaultPosition.clone(),this.background.width=this.backgroundDefaultWidth;return[4,tZ.runTweenAsync(k,g)];case 2:C.sent(),this.timerOpacity.opacity=255;C.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"reset",value:function(){this.alreadyShown||(this.calendar.position=this.background.node.position.clone(),this.calendar.scale=em.ZERO,this.background.width=0,this.timerOpacity.opacity=0)}},{key:"setTimeLabel",value:function(g){if(g){var E=new Date,_=0;if("manually"===g)_=0;else if("daily"===g)_=Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+1);else if("weekly"===g){var k=E.getUTCDay(),C=0===k?1:8-k;_=Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+C)}else _="monthly"===g?Date.UTC(E.getUTCFullYear(),E.getUTCMonth()+1):Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+1);this.timerLabel.string="Ends ".concat(OQ.getRelativeTime(_/1e3))}else this.timerLabel.string="Ends soon"}}]),i}(M)).prototype,"background",[OP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OF=st(OM.prototype,"calendar",[OO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OU=st(OM.prototype,"timerLabel",[OB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ON=OM))||ON);_._RF.pop(),_._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var O$,O0,O1,O2,O4,O3,O5,O6,O8,O9,O7,Bt,Bn,Bi,Br,Ba,Bo,Bs,Bl,Bu,Bc,Bp,Bf,By,Bv,Bg,Bm,Bb,Bw,BS,BE,B_,Bk,BC,BA,BT,BR,BI,BL,BP,BO,BB,BN,BM,BD=k.ccclass,BF=k.disallowMultiple,BU=k.property,Bx=(OH=BD("LeaderSkeleton"),Oq=BU(C),OH(OW=BF((OX=st((Oj=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",OX,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,tZ.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=this;this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;k=this.container.position.clone();this.container.position=new em(k.x,k.y-100,k.z);C=z(this.node).delay(g);C.to(.2,{scale:em.ONE},{easing:"cubicOut"});A=z(this.container).delay(g);A.to(.2,{position:k},{easing:"cubicOut"});T=z(this.uiOpacity).delay(g);T.to(.2,{opacity:255},{easing:"cubicOut"}),E.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=k,_.uiOpacity.opacity=255});return[4,Promise.all([tZ.runTweenAsync(C,E),tZ.runTweenAsync(A,E),tZ.runTweenAsync(T,E)])];case 1:R.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(M)).prototype,"container",[Oq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OW=Oj))||OW)||OW);_._RF.pop(),_._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var Bz,BG,BV,BK,BH,Bq,BW,Bj,BX,BY,BJ,BQ,BZ,B$=k.ccclass,B0=k.property,B1=GameCore.Utils.Number,B2=(O$=B$("Leader"),O0=B0(L),O1=B0(eu),O2=B0({type:C,group:"Container"}),O4=B0({type:eo,group:"Background"}),O3=B0({type:ea,group:"Background"}),O5=B0({type:eo,group:"Rank"}),O6=B0({type:L,group:"Rank"}),O8=B0({type:ea,group:"Rank"}),O9=B0({type:ea,group:"Rank"}),O7=B0({type:ea,group:"Rank"}),Bt=B0({type:ea,group:"Rank"}),Bn=B0({type:eo,group:"Avatar"}),Bi=B0({type:eu,group:"Avatar"}),Br=B0({type:eo,group:"Score"}),Ba=B0({type:L,group:"Score"}),Bo=B0({type:ea,group:"Score"}),Bs=B0({type:eu,group:"Score"}),Bl=B0({type:eu}),Bu=B0({type:R}),Bc=nk.onlyRunInLifeCycle,Bp=nk.onlyRunInLifeCycleAsync,Bf=nk.onlyRunInLifeCycle,O$((Bg=st((Bv=function(g){ze(l,g);var E,_,k,C,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"nameLabel",Bg,Ke(g)),rt(g,"nameOpacity",Bm,Ke(g)),rt(g,"container",Bb,Ke(g)),rt(g,"background",Bw,Ke(g)),rt(g,"highlightBackground",BS,Ke(g)),rt(g,"rankSprite",BE,Ke(g)),rt(g,"rankLabel",B_,Ke(g)),rt(g,"goldRank",Bk,Ke(g)),rt(g,"silverRank",BC,Ke(g)),rt(g,"bronzeRank",BA,Ke(g)),rt(g,"highlightRank",BT,Ke(g)),rt(g,"avatar",BR,Ke(g)),rt(g,"avatarOpacity",BI,Ke(g)),rt(g,"scoreBackground",BL,Ke(g)),rt(g,"scoreLabel",BP,Ke(g)),rt(g,"highlightScoreBackground",BO,Ke(g)),rt(g,"scoreOpacity",BB,Ke(g)),rt(g,"uiOpacity",BN,Ke(g)),rt(g,"uiTransform",BM,Ke(g)),g.signal=new nN,g}return Ue(l,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.defaultAvatar=this.avatar.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g,E){this.updateBackground(g),this.updateRank(g,E),this.updatePhoto(g),this.updateUsername(g),this.updateScore(g)}},{key:"updateBackground",value:function(g){this.background.spriteFrame=g.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(g,E){var _=g.rank;this.rankLabel.string=E&&_>E?"".concat(E,"+"):_.toString(),this.rankSprite.spriteFrame=this.defaultRank;var k=new A(Ew);switch(g.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,k=new A(EE)),_){case 1:this.rankSprite.spriteFrame=this.goldRank,k=new A(Ev);break;case 2:this.rankSprite.spriteFrame=this.silverRank,k=new A(Eg);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,k=new A(Em)}this.rankLabel.shadowColor=k,this.rankLabel.outlineColor=k}},{key:"updatePhoto",value:(T=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.signal.abort();E=new nN;if(this.signal=E,!this.avatar)return[3,5];_=g.playerId,k=g.photo;if(!bB.isAvatarCached(g.playerId,70))return[3,2];return[4,bB.getPlayerAvatar(k,_,70,E)];case 1:C=T.sent();if(!C||E.aborted)return[2];this.setPhoto(C);return[3,5];case 2:this.avatar.spriteFrame=this.defaultAvatar;return[4,tZ.waitTweenAsync(.1,E)];case 3:if(T.sent(),!!E.aborted)return[3,5];return[4,bB.getPlayerAvatar(k,_,70,E)];case 4:A=T.sent();A&&!E.aborted&&this.setPhoto(A);T.label=5;case 5:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"setPhoto",value:function(g){this.node.active&&(g.packable=!0,this.avatar.spriteFrame=g)}},{key:"updateUsername",value:function(g){this.nameLabel.string=g.name,this.nameLabel.color=new A(g.isHighlight?ES:Eb)}},{key:"updateScore",value:function(g){var E=Math.floor(g.score);this.scoreLabel.string=B1.getShortNumber(E,7);var _=this.scoreLabel.getComponent(L);_.outlineColor=new A(g.isHighlight?EE:Ew),_.shadowColor=new A(g.isHighlight?EE:Ew),this.scoreBackground.spriteFrame=g.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(C=Be(function(g,E){var _,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(L){switch(L.label){case 0:_=this,k=I.length>2&&void 0!==I[2]?I[2]:.3;this.node.scale=new em(.8,.8,.8),this.setVisible(!1);C=this.container.position.clone();this.container.position=new em(C.x,C.y-100,C.z);A=z(this.node).delay(E);A.to(k,{scale:em.ONE},{easing:"elasticOut"});T=z(this.container).delay(E);T.to(k,{position:C},{easing:"backOut"});R=z(this.uiOpacity).delay(E);R.to(k,{opacity:255},{easing:"cubicOut",onUpdate:function(){_.nameOpacity.opacity=_.uiOpacity.opacity,_.scoreOpacity.opacity=_.uiOpacity.opacity,_.avatarOpacity.opacity=_.uiOpacity.opacity}}),g.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=C,_.uiOpacity.opacity=255,_.avatar.node.active=!0});return[4,Promise.all([tZ.runTweenAsync(A,g),tZ.runTweenAsync(T,g),tZ.runTweenAsync(R,g)])];case 1:L.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(k=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=z(this.node).to(E,{worldPosition:g},{easing:"quadOut"});return[4,tZ.runTweenAsync(k,_)];case 1:C.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"runScaleAnimation",value:(_=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=z(this.node).to(E,{scale:new em(g,g,g)},{easing:"backOut"});return[4,tZ.runTweenAsync(k,_)];case 1:C.sent();return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(E=Be(function(g,E,_,k,C,A){var T;return _ts_generator(this,function(R){switch(R.label){case 0:T=this;return[4,tZ.runOnUpdateAsync(this.node,C,function(C){var A=Math.floor(g+(E-g)*C),R=Math.floor(_+(k-_)*C);T.updateRank({rank:A,isHighlight:!0}),T.updateScore({score:R,isHighlight:!0})},A)];case 1:R.sent();return[2]}})}),function(g,_,k,C,A,T){return E.apply(this,arguments)})},{key:"setVisible",value:function(g){var E=g?255:0;this.uiOpacity.opacity=E,this.nameOpacity.opacity=E,this.scoreOpacity.opacity=E,this.avatarOpacity.opacity=E}}]),l}(M)).prototype,"nameLabel",[O0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bm=st(Bv.prototype,"nameOpacity",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bb=st(Bv.prototype,"container",[O2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bw=st(Bv.prototype,"background",[O4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BS=st(Bv.prototype,"highlightBackground",[O3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BE=st(Bv.prototype,"rankSprite",[O5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=st(Bv.prototype,"rankLabel",[O6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bk=st(Bv.prototype,"goldRank",[O8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BC=st(Bv.prototype,"silverRank",[O9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BA=st(Bv.prototype,"bronzeRank",[O7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BT=st(Bv.prototype,"highlightRank",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BR=st(Bv.prototype,"avatar",[Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=st(Bv.prototype,"avatarOpacity",[Bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BL=st(Bv.prototype,"scoreBackground",[Br],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BP=st(Bv.prototype,"scoreLabel",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BO=st(Bv.prototype,"highlightScoreBackground",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BB=st(Bv.prototype,"scoreOpacity",[Bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BN=st(Bv.prototype,"uiOpacity",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=st(Bv.prototype,"uiTransform",[Bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Bv.prototype,"updateInfo",[Bc],Object.getOwnPropertyDescriptor(Bv.prototype,"updateInfo"),Bv.prototype),st(Bv.prototype,"updatePhoto",[Bp],Object.getOwnPropertyDescriptor(Bv.prototype,"updatePhoto"),Bv.prototype),st(Bv.prototype,"setPhoto",[Bf],Object.getOwnPropertyDescriptor(Bv.prototype,"setPhoto"),Bv.prototype),By=Bv))||By);_._RF.pop(),_._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var B4,B3,B5,B6,B8,B9,B7,Ne,Nt,Nn,Ni,Nr,Na,No,Ns,Nl,Nu,Nc,Np,Nf,Ny,Nv,Ng,Nm,Nb,Nw,NS=k.ccclass,NE=k.property,N_=globalThis.game.player,Nk=GameCore.Utils.Array,NC=(Bz=NS("Leaders"),BG=NE(At),BV=NE(B2),BK=NE(V),BH=nk.onlyRunInLifeCycleAsync,Bq=nk.onlyRunInLifeCycleAsync,BW=nk.onlyRunInLifeCycleAsync,Bj=nk.onlyRunInLifeCycleAsync,Bz((BJ=st((BY=function(g){ze(u,g);var E,_,k,C,A,T,I=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=I.call.apply(I,[this].concat(_)),"scrollView",BJ,Ke(g)),rt(g,"tempLeader",BQ,Ke(g)),rt(g,"maxLeader",BZ,Ke(g)),g.leaderData=[],g.displayLeaderData=[],g.displayPlayerLeader=null,g.isHidden=!0,g}return Ue(u,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.batchNodes=this.getComponents(sk),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=N_.getPlayerId()}},{key:"updateData",value:(T=Be(function(g){return _ts_generator(this,function(E){this.isHidden=!1,this.leaderData=g,this.leaderData.forEach(function(g,E){g.rank=E+1}),this.setupDisplayLeadersData();return[2]})}),function(g){return T.apply(this,arguments)})},{key:"initScrollViews",value:function(){var g=this;this.scrollView.setMaxNodeCount(this.leaderData.length),this.scrollView.init(function(E){var _=E.getComponent(B2),k=g.displayLeaderData[E.order],C=k.playerId,A=k.photo,T=k.name,R=k.score;_.setVisible(!0),_.updateInfo({playerId:C,isHighlight:g.currentPlayerId===C,name:T,photo:A,rank:E.order+1,score:R},g.maxLeader)}),this.setBatchNodes(!0)}},{key:"playRankChangeAnimation",value:(A=Be(function(g,E,_,k){var C,A,T,R,I,L,P,O,B,N,M,D;return _ts_generator(this,function(F){switch(F.label){case 0:if(E>=_)return[3,4];C=this.displayLeaderData,A=Nk.search(C,function(g){return g.playerId===N_.getPlayerId()});if(!A)return[3,4];T=A.rank;if(!C[k-1])return[3,4];R=this.scrollView.getNodeByOrder(A.rank-1);if(!R)return[3,4];I=null==R?void 0:R.getComponent(B2);if(!I)return[3,4];I.setVisible(!1),this.tempLeader.setVisible(!0),this.tempLeader.updatePhoto({playerId:N_.getPlayerId(),photo:A.photo}),this.tempLeader.node.worldPosition=R.node.worldPosition.clone();return[4,this.tempLeader.runScaleAnimation(1.1,.5,g)];case 1:F.sent();L=Math.min(.5*(T-k),2),P=[this.tempLeader.runUpdateDataAnimation(T,k,E,_,L,g),this.scrollToLeaderRank(k,L,g)],O=this.scrollView.scrollView.getMaxScrollOffset().y,B=this.scrollView.getNodeScrollOffset(k-1),N=em.ZERO;if(B<0)N=new em(this.tempLeader.node.worldPosition.x,this.node.worldPosition.y+this.scrollView.getNodePosition(k-1).y+this.uiTransform.height/2,this.tempLeader.node.worldPosition.z);else if(this.scrollView.scrollView.getScrollOffset().y>=O-5){if(B<O)N=new em(this.tempLeader.node.worldPosition.x,this.scrollView.viewport.node.worldPosition.y,this.tempLeader.node.worldPosition.z);else{D=this.scrollView.getNodeByOrder(k-1);N=null!==(M=null==D?void 0:D.node.worldPosition.clone())&&void 0!==M?M:em.ZERO}}N.equals(em.ZERO)||P.push(this.tempLeader.runWorldPositionAnimation(N,L,g));return[4,Promise.all(P)];case 2:F.sent();return[4,Promise.all([this.tempLeader.runScaleAnimation(1,.25,g),this.playPostRankChangeAnimation(k,T,g)])];case 3:F.sent(),this.tempLeader.setVisible(!1),R.node.worldPosition=this.tempLeader.node.worldPosition.clone(),this.setupDisplayLeadersData(),this.scrollView.updateNodeVisibility(),this.scrollView.updateLayout();F.label=4;case 4:return[2]}})}),function(g,E,_,k){return A.apply(this,arguments)})},{key:"playShowLeadersAnimation",value:(C=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:E=this,_=T.length>1&&void 0!==T[1]?T[1]:.1;if(!!this.isHidden)return[3,2];k=[],C=this.scrollView.getAllNodes();if(C.sort(function(g,E){return g.order-E.order}).forEach(function(g,_){var C=g.getComponent(B2);C.setVisible(_<E.leaderData.length),g.isVisible()&&k.push(C)}),k.length<1)return[3,2];k=k.slice(0,C.length-1);A=.3;return[4,Promise.all(k.map(function(){var k=Be(function(k,C){var T;return _ts_generator(this,function(R){switch(R.label){case 0:T=E.isHidden;if(T)return[3,2];return[4,k.runShowUpAnimation(g,C*_,A)];case 1:T=R.sent();R.label=2;case 2:return[2]}})});return function(g,E){return k.apply(this,arguments)}}()))];case 1:R.sent();R.label=2;case 2:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"scrollToPlayerLeader",value:(k=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:_=this.displayPlayerLeader;if(!_)return[3,2];return[4,this.scrollToLeaderRank(this.displayPlayerLeader.rank,g,E)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"updateDisplayPlayerLeaderForRankChanging",value:function(g,E,_){if(!this.displayPlayerLeader)return!1;this.displayPlayerLeader.score=g,this.displayLeaderData.sort(function(g,E){return E.score-g.score});var k=this.displayLeaderData.indexOf(this.displayPlayerLeader)+1;return _===k?(this.displayPlayerLeader.score=E,this.displayPlayerLeader.rank=_,!1):(this.displayPlayerLeader.rank=k,this.tempLeader.updateInfo({playerId:N_.getPlayerId(),isHighlight:!0,name:this.displayPlayerLeader.name,photo:this.displayPlayerLeader.photo,rank:this.displayPlayerLeader.rank,score:g}),!0)}},{key:"hideLeaders",value:function(){this.isHidden=!0;var g,E=at(this.scrollView.getAllNodes().map(function(g){return g.getComponent(B2)}));try{for(E.s();!(g=E.n()).done;){var _=g.value;null==_||_.setVisible(!1)}}catch(g){E.e(g)}finally{E.f()}this.setBatchNodes(!1)}},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"setBatchNodes",value:function(g){this.batchNodes.every(function(E){E.enabled=g})}},{key:"setupDisplayLeadersData",value:function(){var g=this,E=Nk.search(this.leaderData,function(E){return E.playerId===g.currentPlayerId});E?(this.displayLeaderData=this.leaderData.filter(function(E){return E.playerId!==g.currentPlayerId}),this.displayPlayerLeader=Me({},E),this.displayLeaderData.splice(E.rank-1,0,this.displayPlayerLeader)):(this.displayPlayerLeader=null,this.displayLeaderData=this.leaderData)}},{key:"playPostRankChangeAnimation",value:(_=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=null!=g?g:0,C=this.scrollView.getVisibleNodes().filter(function(g){return g.order>=k-1&&g.order<E}),A=C.map(function(g){return g.getComponent(B2)}),T=this.scrollView.nodeHeight+this.scrollView.spacing,R=[];A.forEach(function(g,E){g.updateRank({rank:C[E].order+2,isHighlight:!1});var k=g.node.worldPosition.clone();R.push(g.runWorldPositionAnimation(k.add3f(0,-T,0),.25,_))});return[4,Promise.all(R)];case 1:I.sent();return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"scrollToLeaderRank",value:(E=Be(function(g,E,_){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.scrollView.scrollToOrder(g-1,_,E)];case 1:k.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),u}(M)).prototype,"scrollView",[BG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BQ=st(BY.prototype,"tempLeader",[BV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BZ=st(BY.prototype,"maxLeader",[BK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(BY.prototype,"updateData",[BH],Object.getOwnPropertyDescriptor(BY.prototype,"updateData"),BY.prototype),st(BY.prototype,"playRankChangeAnimation",[Bq],Object.getOwnPropertyDescriptor(BY.prototype,"playRankChangeAnimation"),BY.prototype),st(BY.prototype,"scrollToPlayerLeader",[BW],Object.getOwnPropertyDescriptor(BY.prototype,"scrollToPlayerLeader"),BY.prototype),st(BY.prototype,"scrollToLeaderRank",[Bj],Object.getOwnPropertyDescriptor(BY.prototype,"scrollToLeaderRank"),BY.prototype),BX=BY))||BX);_._RF.pop(),_._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var NA,NT,NR,NI,NL,NP,NO,NB,NN=k.ccclass,NM=k.property,ND=globalThis.game,NF=ND.storage,NU=ND.leaderboard,Nx=ND.player,Nz=ND.monitorError,NG=GameCore,NV=NG.Utils.Object,NK=NG.Configs.Leaderboards,NH=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),(_=E.call(this,g)).name="EmptyLeaderboardError",_}return Ue(n)}(je(Error)),Nq=(B4=NN("LeaderboardContent"),B3=nk.required(),B5=NM(OK),B6=nk.required(),B8=NM(OZ),B9=nk.required(),B7=NM(NC),Ne=NM({type:[Bx]}),Nt=nk.required(),Nn=NM(Of),Ni=nk.required(),Nr=NM(rh),Na=nk.onlyRunInLifeCycleAsync,No=nk.onlyRunInLifeCycleAsync,Ns=nk.onlyRunInLifeCycleAsync,Nl=nk.onlyRunInLifeCycleAsync,Nu=nk.onlyRunInLifeCycleAsync,Nc=nk.onlyRunInLifeCycleAsync,B4((Ny=st((Nf=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"tabs",Ny,Ke(g)),rt(g,"timer",Nv,Ke(g)),rt(g,"leaders",Ng,Ke(g)),rt(g,"leaderSkeletons",Nm,Ke(g)),rt(g,"leaderboardIsEmpty",Nb,Ke(g)),rt(g,"contentOpacity",Nw,Ke(g)),g.isHidden=!0,g.currentLb=null,g.animAbortSignal=new nN,g.hasPlayedAppearAnim={friends:!1,global:!1,tournament:!1},g.handleFriendsTabSelected=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:NF.setStorageData("leaderboard_content","lastTabOpened","friends"),g.cleanupSideEffects();E=g.animAbortSignal;k.label=1;case 1:k.trys.push([1,3,,4]);return[4,g.updateStatus(E,"friends")];case 2:k.sent();return[3,4];case 3:_=k.sent();E.call(function(){var g=_instanceof(_,Error)?_:new Error("Unknown error during loading friends leaderboard.");console.error("LeaderboardContent",g),null==Nz||Nz.sendException(g),l1.showNotificationScreen("Unable to load friends leaderboard. Please try again later.",2)});return[3,4];case 4:return[2]}})}),g.handleWorldTabSelected=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:NF.setStorageData("leaderboard_content","lastTabOpened","global"),g.cleanupSideEffects();E=g.animAbortSignal;k.label=1;case 1:k.trys.push([1,3,,4]);return[4,g.updateStatus(E,"global")];case 2:k.sent();return[3,4];case 3:_=k.sent();E.call(function(){var g=_instanceof(_,Error)?_:new Error("Unknown error during loading global leaderboard.");console.error("LeaderboardContent",g),null==Nz||Nz.sendException(g),l1.showNotificationScreen("Unable to load global leaderboard. Please try again later.",2)});return[3,4];case 4:return[2]}})}),g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(l,[{key:"__preload",value:function(){this.leaders.maxLeader=NK.Limit}},{key:"onLoad",value:function(){nk.decorateComponent(this)}},{key:"listenEvents",value:function(){this.node.scene.on(Ey.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(Ey.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(r0.HIDE_UI,this.hideContent),this.node.scene.on(r0.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.node.scene.off(Ey.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(Ey.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(r0.HIDE_UI,this.hideContent),this.node.scene.off(r0.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(T=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this,k=this.getLeaderboardName(g);C=null!==k;if(!C)return[3,3];return[4,E.callAsync(function(){return NU.requestLeaderboardAsync(k,NK.Limit)})];case 1:A.sent(),E.call(function(){var g=NU.getLeaderboard(k);_.currentLb=null!=g?g:_.currentLb});return[4,E.callAsync(Be(function(){return _ts_generator(this,function(E){return[2,_.loadPlayerLeaderData(g)]})}))];case 2:C=A.sent();A.label=3;case 3:return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"getLeaderboardName",value:function(g){return"friends"===g?sq:sH}},{key:"showLoading",value:(A=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=k.length>1&&void 0!==k[1]?k[1]:0;return[4,Promise.all([this.leaders.scrollView.unlistenEvents(),this.leaders.scrollView.scrollToTop(g).then(function(){E.leaders&&(E.leaders.scrollView.scrollView.enabled=!1,E.leaders.scrollView.listenEvents())}),this.leaderSkeletons.map(function(E,k){return E.show(k*_,g)})])];case 1:C.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"hideLoading",value:(C=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(E){return E.hide(g)}))];case 1:E.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"entering",value:function(){this.timer.reset(),this.isHidden=!1;var g=NF.getStorageData("leaderboard_content","lastTabOpened");"friends"===g?this.handleFriendsTabSelected():"global"===g&&this.handleWorldTabSelected()}},{key:"enter",value:function(){this.listenEvents()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){this.animAbortSignal.abort(),this.animAbortSignal=new nN,this.leaders.hideLeaders(),this.leaderboardIsEmpty.hide()}},{key:"updateStatus",value:(k=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this;if(!(void 0!==g&&!this.isHidden))return[3,7];this.tabs.updateStatus(E);return[4,this.showLoading(g)];case 1:R.sent();R.label=2;case 2:R.trys.push([2,4,,5]);return[4,this.loadLeaderboard(E,g)];case 3:R.sent();return[3,5];case 4:T=R.sent();if(!_instanceof(T,NH))throw T;return[2,void g.call(function(){A.leaderboardIsEmpty.show(),A.hideLoading(g)})];case 5:null===(_=this.timer)||void 0===_||_.setTimeLabel(null===(k=this.currentLb)||void 0===k?void 0:k.resettable),null===(C=this.timer)||void 0===C||C.show(g),this.hideLoading(g);return[4,g.callAsync(function(g){return A.playLeadersShowupAnimation(E,g)})];case 6:R.sent();R.label=7;case 7:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"playLeadersShowupAnimation",value:(_=Be(function(g,E){var _,k,C,A,T,R,I,L,P,O,B,N,M;return _ts_generator(this,function(D){switch(D.label){case 0:_=this;if(!this.currentLb)return[3,6];k=Nx.getPlayerId(),C=this.currentLb.leaders[k],A=NF.getStorage("leaderboard_content").previousScore,T=null!=C?C:{},R=T.score,I=T.rank,L=NV.vals(this.currentLb.leaders);L.sort(function(g,E){return E.score-g.score});P=-1!==A&&A<R&&I<=NK.Limit;this.leaders.updateData(L);O=!1;C&&P&&(O=this.leaders.updateDisplayPlayerLeaderForRankChanging(A,R,I)),this.leaders.initScrollViews(),this.leaders.scrollView.scrollView.enabled=!0;B=this.hasPlayedAppearAnim[g]?0:.1;return[4,E.callAsync(function(){return _.leaders.playShowLeadersAnimation(E,B)})];case 1:D.sent(),this.hasPlayedAppearAnim[g]=!0;N=C;if(!N)return[3,5];return[4,E.callAsync(function(){return _.leaders.scrollToPlayerLeader(1,E)})];case 2:D.sent();M=O&&-1!==A;if(!M)return[3,4];return[4,E.callAsync(function(g){return _.leaders.playRankChangeAnimation(g,A,R,I)})];case 3:M=(D.sent(),NF.setStorageData("leaderboard_content","previousScore",R));D.label=4;case 4:N=M;D.label=5;case 5:D.label=6;case 6:return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"loadPlayerLeaderData",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=Nx.getPlayerId();if(null===this.currentLb)throw new Error("LeaderboardContent: Leaderboard is not found.");_=this.currentLb.leaders;if(0===Object.keys(_).length)throw new NH("LeaderboardContent: Leaderboard is empty.");if(!!_[E])return[3,2];k=this.getLeaderboardName(g);if(null===k)throw new Error("LeaderboardContent: Leaderboard name is not found.");return[4,NU.getLeadersByPlayerIdsAsync(k,[E])];case 1:C=T.sent();if(0!==C.length){A=C[0];_[E]=A}T.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),l}(M)).prototype,"tabs",[B3,B5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv=st(Nf.prototype,"timer",[B6,B8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ng=st(Nf.prototype,"leaders",[B9,B7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nm=st(Nf.prototype,"leaderSkeletons",[Ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nb=st(Nf.prototype,"leaderboardIsEmpty",[Nt,Nn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nw=st(Nf.prototype,"contentOpacity",[Ni,Nr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Nf.prototype,"loadLeaderboard",[Na],Object.getOwnPropertyDescriptor(Nf.prototype,"loadLeaderboard"),Nf.prototype),st(Nf.prototype,"showLoading",[No],Object.getOwnPropertyDescriptor(Nf.prototype,"showLoading"),Nf.prototype),st(Nf.prototype,"hideLoading",[Ns],Object.getOwnPropertyDescriptor(Nf.prototype,"hideLoading"),Nf.prototype),st(Nf.prototype,"updateStatus",[Nl],Object.getOwnPropertyDescriptor(Nf.prototype,"updateStatus"),Nf.prototype),st(Nf.prototype,"playLeadersShowupAnimation",[Nu],Object.getOwnPropertyDescriptor(Nf.prototype,"playLeadersShowupAnimation"),Nf.prototype),st(Nf.prototype,"loadPlayerLeaderData",[Nc],Object.getOwnPropertyDescriptor(Nf.prototype,"loadPlayerLeaderData"),Nf.prototype),Np=Nf))||Np);_._RF.pop(),_._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var NW,Nj,NX,NY,NJ,NQ,NZ,N$,N0,N1,N2,N4,N3,N5,N6,N8,N9,N7;NA=(0,k.ccclass)("LeaderboardPage"),NT=nk.required(),NR=nk.getComponent(ac),NI=nk.onlyRunInLifeCycleAsync,NL=nk.onlyRunInLifeCycleAsync,NP=nk.onlyRunInLifeCycleAsync,NA((NB=st((NO=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimationController",NB,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nk.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:if(g.sent(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(Nq),!this.content)throw new Error("LeaderboardPage: Leaders not found");return[2]}})}),function(){return k.apply(this,arguments)})},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:this.content.entering();return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent();g=tZ.runTweenAsync(z(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent(),this.content.enter();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent(),this.content.unlistenUIEvents(),this.content.leaders.setBatchNodes(!1);return[4,this.panelAnimationController.hideUI()];case 2:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"unmount",value:function(){var g,E;null===(g=this.content)||void 0===g||g.hide(),null===(E=this.content)||void 0===E||E.cleanup(),Je(Ve(r.prototype),"unmount",this).call(this)}}]),r}(Ag)).prototype,"panelAnimationController",[NT,NR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(NO.prototype,"mount",[NI],Object.getOwnPropertyDescriptor(NO.prototype,"mount"),NO.prototype),st(NO.prototype,"transitionIn",[NL],Object.getOwnPropertyDescriptor(NO.prototype,"transitionIn"),NO.prototype),st(NO.prototype,"transitionOut",[NP],Object.getOwnPropertyDescriptor(NO.prototype,"transitionOut"),NO.prototype),NO));_._RF.pop(),_._RF.push({},"0d1c02Npp9IXrjlFdl8co2L","TopLeader",void 0);var Mt,Mn,Mi,Mr,Ma,Mo,Ms,Ml,Mu,Mc,Mp,Mf,My,Mv,Mg,Mm,Mb,Mw,MS,ME,M_,Mk,MC,MA,MT,MR=k.ccclass,MI=k.property,ML=GameCore.Utils.Number,MP=(NW=MR("TopLeader"),Nj=MI(L),NX=MI(C),NY=MI({type:eo}),NJ=MI({type:eu}),NQ=MI({type:L}),NZ=MI({type:eu}),N$=nk.onlyRunInLifeCycle,N0=nk.onlyRunInLifeCycleAsync,N1=nk.onlyRunInLifeCycleAsync,NW((N3=st((N4=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"nameLabel",N3,Ke(g)),rt(g,"defaultAvatar",N5,Ke(g)),rt(g,"avatar",N6,Ke(g)),rt(g,"avatarOpacity",N8,Ke(g)),rt(g,"scoreLabel",N9,Ke(g)),rt(g,"uiOpacity",N7,Ke(g)),g.signal=new nN,g}return Ue(o,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){this.updateUsername(g),this.updatePhoto(g),this.updateScore(g)}},{key:"updateUsername",value:function(g){this.nameLabel&&(this.nameLabel.string=g.name)}},{key:"updatePhoto",value:(k=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.signal.abort();E=new nN;this.signal=E,this.defaultAvatar.active=!bB.isAvatarCached(g.playerId,128),this.avatar.spriteFrame=null;_=g.playerId,k=g.photo;return[4,bB.getPlayerAvatar(k,_,128,E)];case 1:C=A.sent();C&&!E.aborted&&this.setPhoto(C);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setPhoto",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!this.node.active)return[3,2];g.packable=!0,this.avatar.spriteFrame=g;E=z(this.avatarOpacity).to(.2,{opacity:255});return[4,tZ.runTweenAsync(E,this.signal)];case 1:_.sent(),this.defaultAvatar.active=!1;_.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"updateScore",value:function(g){if(this.scoreLabel){var E=Math.floor(g.score);this.scoreLabel.string=ML.getShortNumber(E,7)}}},{key:"runShowUpAnimation",value:(E=Be(function(g){var E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:E=A.length>1&&void 0!==A[1]?A[1]:.3,_=A.length>2?A[2]:void 0;this.node.scale=em.ZERO;k=z(this.node).delay(g).to(E,{scale:new em(1,1,1)},{easing:"backOut"}),C=z(this.uiOpacity).delay(g).to(E,{opacity:255});return[4,Promise.all([tZ.runTweenAsync(k,_),tZ.runTweenAsync(C,_)])];case 1:T.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setVisible",value:function(g){var E=g?255:0;this.uiOpacity.opacity=E,this.avatarOpacity.opacity=E}}]),o}(M)).prototype,"nameLabel",[Nj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N5=st(N4.prototype,"defaultAvatar",[NX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N6=st(N4.prototype,"avatar",[NY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N8=st(N4.prototype,"avatarOpacity",[NJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N9=st(N4.prototype,"scoreLabel",[NQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N7=st(N4.prototype,"uiOpacity",[NZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(N4.prototype,"updateInfo",[N$],Object.getOwnPropertyDescriptor(N4.prototype,"updateInfo"),N4.prototype),st(N4.prototype,"updatePhoto",[N0],Object.getOwnPropertyDescriptor(N4.prototype,"updatePhoto"),N4.prototype),st(N4.prototype,"setPhoto",[N1],Object.getOwnPropertyDescriptor(N4.prototype,"setPhoto"),N4.prototype),N2=N4))||N2);_._RF.pop(),_._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var MO,MB,MN,MM,MD,MF=k.ccclass,MU=k.property,Mx=globalThis.game,Mz=Mx.leaderboard,MG=Mx.player,MV=GameCore.Utils,MK=MV.Time,MH=MV.Object,Mq=MV.Array,MW=(Mt=MF("TournamentBlock"),Mn=MU(C),Mi=MU(L),Mr=MU(L),Ma=MU(L),Mo=MU(L),Ms=MU(R),Ml=MU({type:eo}),Mu=MU(C),Mc=MU(C),Mp=MU(MP),Mf=nk.onlyRunInLifeCycleAsync,My=nk.onlyRunInLifeCycle,Mt((Mm=st((Mg=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"container",Mm,Ke(g)),rt(g,"titleLabel",Mb,Ke(g)),rt(g,"timeLabel",Mw,Ke(g)),rt(g,"playerCountLabel",MS,Ke(g)),rt(g,"playButtonLabel",ME,Ke(g)),rt(g,"uiTransform",M_,Ke(g)),rt(g,"banner",Mk,Ke(g)),rt(g,"bannerMask",MC,Ke(g)),rt(g,"bannerLoadingRing",MA,Ke(g)),rt(g,"topLeader",MT,Ke(g)),g.hasPlayedAnimation=!1,g}return Ue(l,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"updateInfo",value:(T=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:this.payload=g;E=g.endTime,_=g.title,k=g.payload,C=k.leaderboardId,A=k.themeId;T=C;if(!T)return[3,2];this.topLeader.setVisible(!1),this.topLeader.node.active=!1,this.setPlayerCountWaiting(),this.updateTitle(_),this.updateEndTime(E),this.updateTournamentBanner(A);return[4,this.fetchAndUpdateLeadersPayload(C,{leaders:[],amountPlayer:0},_)];case 1:T=R.sent();R.label=2;case 2:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"fetchAndUpdateLeadersPayload",value:(A=Be(function(g,E,_){var k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:k=E;T.label=1;case 1:T.trys.push([1,3,,4]);return[4,this.getLeadersPayload(g)];case 2:C=T.sent();C&&(k=C);return[3,4];case 3:A=T.sent();console.error("Fetch lb for tournament ".concat(_),A);return[3,4];case 4:this.updateLeadersPayload(k);return[2]}})}),function(g,E,_){return A.apply(this,arguments)})},{key:"updateLeadersPayload",value:function(g){this.leadersPayload=g;var E=this.leadersPayload,_=E.player,k=E.amountPlayer,C=E.leaders;this.updatePlayerCount(k),this.updatePlayButtonLabel(void 0!==_),this.updateTopLeader(null!=C?C:[])}},{key:"updateTitle",value:function(g){g&&(this.titleLabel.string=g)}},{key:"updateEndTime",value:function(g){var E=MK.getRelativeTime(g);this.timeLabel.string="Ends ".concat(E)}},{key:"updatePlayerCount",value:function(g){this.playerCountLabel.string="".concat(g," ").concat(g>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"updateTopLeader",value:(C=Be(function(g){var E,_;return _ts_generator(this,function(k){if(0!==g.length){_=g[0];GameCore.Configs.Mockup.Leaderboards.Enabled&&(_=null!==(E=Mq.search(g,function(g){return 1===g.rank}))&&void 0!==E?E:_),this.topLeader.node.active=!0,this.topLeader.updateInfo(_),this.topLeader.runShowUpAnimation(0,.2)}return[2]})}),function(g){return C.apply(this,arguments)})},{key:"updateTournamentBanner",value:(k=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=n7.getAsset("".concat(nF[g],"/spriteFrame"),ea);_=E;if(_)return[3,2];this.bannerMask.active=!0,this.bannerLoadingRing.active=!0;return[4,n7.loadThemePreviewAsync(g)];case 1:_=E=C.sent();C.label=2;case 2:k=E;if(k)return[3,4];return[4,n7.loadThemePreviewAsync(ln.SUMMER)];case 3:k=E=C.sent();C.label=4;case 4:this.banner&&E&&(this.banner.spriteFrame=E,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"updatePlayButtonLabel",value:function(g){this.playButtonLabel.string=g?"Continue":"Join"}},{key:"getLeadersPayload",value:(_=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=Mz.getLeaderboardName(g);if(!_)return[2,null];return[4,le.getAllLeaderboardAsync(g)];case 1:k=I.sent();if(!k)return[2,null];C=MH.vals(k.leaders);C.sort(function(g,E){return g.rank-E.rank});A=MG.getPlayerId();return[4,Mz.getLeadersByPlayerIdsAsync(_,[A])];case 2:T=I.sent(),R={leaders:C,amountPlayer:null!==(E=k.amountPlayer)&&void 0!==E?E:0};return[2,(T.length>0&&(R.player=T[0]),R)]}})}),function(g){return _.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=this;this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;C=this.container.position.clone();this.container.position=new em(C.x,C.y-100,C.z);A=z(this.node).delay(g);A.to(E,{scale:em.ONE},{easing:"elasticOut"});T=z(this.container).delay(g);T.to(E,{position:C},{easing:"backOut"});R=z(this.uiOpacity).delay(g);R.to(E,{opacity:255},{easing:"cubicOut"}),_.addAbortListener(function(){k.node.scale=em.ONE,k.container.position=C,k.uiOpacity.opacity=255});return[4,Promise.all([tZ.runTweenAsync(A,_),tZ.runTweenAsync(T,_),tZ.runTweenAsync(R,_)])];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var g=this.payload.id||"";if(ut.validateTournamentExpired(g))return this.node.scene.emit(s0.RELOAD_TOURNAMENT),void l1.showNotificationScreen("Tournament has ended",2);try{var E=JSON.stringify(this.payload);l1.showTournamentDetailScreen(E,"tournament_start",this.hasPlayedAnimation),this.hasPlayedAnimation=!0}catch(g){console.warn("handleOnTournamentClicked",g)}}}]),l}(M)).prototype,"container",[Mn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mb=st(Mg.prototype,"titleLabel",[Mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mw=st(Mg.prototype,"timeLabel",[Mr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MS=st(Mg.prototype,"playerCountLabel",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=st(Mg.prototype,"playButtonLabel",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=st(Mg.prototype,"uiTransform",[Ms],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mk=st(Mg.prototype,"banner",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MC=st(Mg.prototype,"bannerMask",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MA=st(Mg.prototype,"bannerLoadingRing",[Mc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MT=st(Mg.prototype,"topLeader",[Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Mg.prototype,"fetchAndUpdateLeadersPayload",[Mf],Object.getOwnPropertyDescriptor(Mg.prototype,"fetchAndUpdateLeadersPayload"),Mg.prototype),st(Mg.prototype,"updateLeadersPayload",[My],Object.getOwnPropertyDescriptor(Mg.prototype,"updateLeadersPayload"),Mg.prototype),Mv=Mg))||Mv);_._RF.pop(),_._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var Mj,MX,MY,MJ,MQ,MZ,M$,M0,M1,M2,M4,M3,M5,M6=k.ccclass,M8=k.property,M9=(MO=M6("TournamentBlockSkeleton"),MB=M8(C),MO((MD=st((MM=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",MD,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,tZ.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=this;this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;k=this.container.position.clone();this.container.position=new em(k.x,k.y-100,k.z);C=z(this.node).delay(g);C.to(.2,{scale:em.ONE},{easing:"elasticOut"});A=z(this.container).delay(g);A.to(.2,{position:k},{easing:"backOut"});T=z(this.uiOpacity).delay(g);T.to(.2,{opacity:255},{easing:"cubicOut"}),E.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=k,_.uiOpacity.opacity=255});return[4,Promise.all([tZ.runTweenAsync(C,E),tZ.runTweenAsync(A,E),tZ.runTweenAsync(T,E)])];case 1:R.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})}]),a}(M)).prototype,"container",[MB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MN=MM))||MN);_._RF.pop(),_._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var M7,Dt,Dn,Di,Dr,Da=k.ccclass,Do=k.property,Ds=globalThis.game.player,Dl=(Mj=Da("TournamentsBoard"),MX=Do(ee),MY=Do(C),MJ=Do(q),MQ=Do(C),MZ=Do(R),Mj((M1=st((M0=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"tournamentBlockPrefab",M1,Ke(g)),g.tournamentBlockArray=[],rt(g,"inactiveNodeContainer",M2,Ke(g)),rt(g,"layout",M4,Ke(g)),rt(g,"createTournamentButton",M3,Ke(g)),rt(g,"viewport",M5,Ke(g)),g}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"start",value:function(){for(var g=0;g<20;g++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"updateData",value:function(g){var E=this,_=!1;g.forEach(function(g,k){var C=E.tournamentBlockArray[k];g.payload.playerId===Ds.getPlayerId()&&(_=!0),C||(C=E.addTournamentBlock()),E.layout.node.addChild(C.node),C.updateInfo(g)}),_||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var g=I(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(g);var E=g.getComponent(MW);return this.tournamentBlockArray.push(E),E}},{key:"removeTournamentBlocks",value:function(){var g,E=at(this.getActiveTournamentBlocks());try{for(E.s();!(g=E.n()).done;){var _=g.value;this.inactiveNodeContainer.addChild(_.node)}}catch(g){E.e(g)}finally{E.f()}this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var g=this;return this.tournamentBlockArray.filter(function(E){return E.node.parent===g.layout.node})}},{key:"setCreateTournamentButtonActive",value:function(g){g?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=g}},{key:"showTournamentBlocks",value:(E=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this.getActiveTournamentBlocks();if(_.length<1)return[3,2];k=Math.ceil(g/this.tournamentBlockContentHeight),C=Math.min(_.length,k);return[4,Promise.all(_.map(function(){var g=Be(function(g,_){return _ts_generator(this,function(k){switch(k.label){case 0:if(!(_<C))return[3,2];return[4,g.runShowPopUpAnimation(.1*_,.3,E)];case 1:k.sent();return[3,3];case 2:g.uiOpacity.opacity=255;k.label=3;case 3:return[2]}})});return function(E,_){return g.apply(this,arguments)}}()))];case 1:A.sent();A.label=2;case 2:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"updateVisibility",value:function(){var g,E=this.viewport.getBoundingBoxToWorld(),_=E.yMax,k=E.yMin,C=at(this.getActiveTournamentBlocks());try{for(C.s();!(g=C.n()).done;){var A=g.value,T=A.uiTransform;if(void 0!==T){var R=T.getBoundingBoxToWorld(),I=R.yMax,L=R.yMin,P=I<k||L>_;A.uiOpacity.opacity=P?0:255}}}catch(g){C.e(g)}finally{C.f()}}}]),i}(M)).prototype,"tournamentBlockPrefab",[MX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M2=st(M0.prototype,"inactiveNodeContainer",[MY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M4=st(M0.prototype,"layout",[MJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M3=st(M0.prototype,"createTournamentButton",[MQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M5=st(M0.prototype,"viewport",[MZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M$=M0))||M$);_._RF.pop(),_._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var Du,Dc,Dp,Df,Dy,Dv,Dg,Dm,Db,Dw,DS,DE,D_,Dk,DC,DA=k.ccclass,DT=k.property,DR=(M7=DA("TournamentsNotAvailable"),Dt=DT(C),M7((Dr=st((Di=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"createButton",Dr,Ke(g)),g}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.createButton.active=!0,this.uiOpacity.opacity=255;g=this.node.position.clone(),E=z(this.node);E.to(.05,{position:g.clone().add3f(5,0,0)}),E.to(.05,{position:g.clone().add3f(-5,0,0)});_=z(this.node).repeat(2,E);_.to(.05,{position:g});return[4,tZ.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hide",value:function(){this.createButton.active=!1,this.uiOpacity.opacity=0}}]),i}(M)).prototype,"createButton",[Dt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn=Di))||Dn);_._RF.pop(),_._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var DI,DL,DP,DO,DB,DN,DM,DD,DF,DU=k.ccclass,Dx=k.property,Dz=globalThis.game,DG=Dz.storage,DV=Dz.match,DK=GameCore.Utils,DH=DK.Object,Dq=DK.Array,DW=(Du=DU("TournamentContent"),Dc=Dx({type:aR}),Dp=Dx(Dl),Df=Dx(DR),Dy=Dx(eK),Dv=Dx({type:[M9]}),Dg=Dx(rh),Du((Dw=st((Db=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimator",Dw,Ke(g)),rt(g,"tournamentsBoard",DS,Ke(g)),rt(g,"tournamentsNotAvailable",DE,Ke(g)),rt(g,"scrollView",D_,Ke(g)),rt(g,"skeletons",Dk,Ke(g)),rt(g,"contentOpacity",DC,Ke(g)),g.animAbortSignal=null,g.softAbortSignal=null,g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(r,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(eK.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(s0.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(r0.HIDE_UI,this.hideContent),this.node.scene.on(r0.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(eK.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(s0.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(r0.HIDE_UI,this.hideContent),this.node.scene.off(r0.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(C=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.listenEvents();E=null===this.animAbortSignal&&null===this.softAbortSignal;if(!E)return[3,2];this.animAbortSignal=new nN,this.softAbortSignal=new nN;return[4,this.showLoading(this.animAbortSignal)];case 1:E=(T.sent(),!this.isAborted());T.label=2;case 2:if(!E)return[3,10];return[4,ut.requestTournamentDataAsync()];case 3:_=T.sent();k=this.isAborted();if(k)return[3,9];return[4,this.hideLoading(this.animAbortSignal)];case 4:T.sent();C=this.isAborted();if(C)return[3,8];if(!(0!==_.length||null!==(g=this.softAbortSignal)&&void 0!==g&&g.aborted))return[3,6];this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(_);return[4,this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal)];case 5:A=(T.sent(),this.tournamentsBoard.updateVisibility());return[3,7];case 6:A=this.tournamentsNotAvailable.show();T.label=7;case 7:C=A;T.label=8;case 8:k=C;T.label=9;case 9:T.label=10;case 10:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"showLoading",value:(k=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.scrollView.scrollToTop(0),this.scrollView.enabled=!1;return[4,Promise.all([this.skeletons.map(function(E){return E.show(0,g)})])];case 1:E.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"hideLoading",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all([this.skeletons.map(function(E){return E.hide(g)})])];case 1:E.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!DG.getStorage("tournament").animateTournamentLeader)return;var g=ut.getAllTournamentData(),E=DV.getMatchState().customData.tournamentId;if(!E)throw new Error("Tournament ID not found");var _=Dq.search(g,function(g){return g.id===E});if(!_)throw new Error("Tournament not found");var k=JSON.stringify(_);l1.showTournamentDetailScreen(k,"tournament_end")}catch(g){DG.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",g)}}},{key:"processCreateTournament",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,l_.processCreateTournamentAsync()];case 1:_.sent();return[3,3];case 2:g=_.sent();if(!DH.hasOwn(g,"code"))return[2,void l1.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament",2)];if("USER_INPUT"===g.code)return[2];if("PLAYER_HAS_TOURNAMENT"===g.code)return[2,void l1.showNotificationScreen("You already have a tournament",2)];if("INVALID_OPERATION"===g.code&&DH.hasOwn(g,"message")){E="string"==typeof g.message?g.message:"Failed to Create Tournament";return[2,void l1.showNotificationScreen(E,2)]}l1.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament",2);return[3,3];case 3:this.reload();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"isAborted",value:function(){var g,E;return null===(g=null===(E=this.animAbortSignal)||void 0===E?void 0:E.aborted)||void 0===g||g}},{key:"cleanup",value:function(){var g;this.unlistenEvents(),null===(g=this.animAbortSignal)||void 0===g||g.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var g;null===(g=this.softAbortSignal)||void 0===g||g.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.enter()}}]),r}(M)).prototype,"panelAnimator",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DS=st(Db.prototype,"tournamentsBoard",[Dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DE=st(Db.prototype,"tournamentsNotAvailable",[Df],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_=st(Db.prototype,"scrollView",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dk=st(Db.prototype,"skeletons",[Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DC=st(Db.prototype,"contentOpacity",[Dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dm=Db))||Dm);_._RF.pop(),_._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var Dj,DX,DY,DJ,DQ;DI=(0,k.ccclass)("TournamentPage"),DL=nk.required(),DP=nk.getComponent(ac),DO=nk.onlyRunInLifeCycleAsync,DB=nk.onlyRunInLifeCycle,DN=nk.onlyRunInLifeCycleAsync,DM=nk.onlyRunInLifeCycleAsync,DI((DF=st((DD=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimationController",DF,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nk.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(DW),!this.content)throw new Error("LeaderboardPage: Leaders not found")}},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent();g=tZ.runTweenAsync(z(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent(),this.content.enter();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:null===(g=this.content)||void 0===g||g.softAbort(),this.content.unlistenUIEvents();return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:E.sent();return[4,this.panelAnimationController.hideUI()];case 2:E.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"unmount",value:function(){var g;null===(g=this.content)||void 0===g||g.cleanup(),Je(Ve(r.prototype),"unmount",this).call(this)}}]),r}(Ag)).prototype,"panelAnimationController",[DL,DP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(DD.prototype,"mount",[DO],Object.getOwnPropertyDescriptor(DD.prototype,"mount"),DD.prototype),st(DD.prototype,"onMount",[DB],Object.getOwnPropertyDescriptor(DD.prototype,"onMount"),DD.prototype),st(DD.prototype,"transitionIn",[DN],Object.getOwnPropertyDescriptor(DD.prototype,"transitionIn"),DD.prototype),st(DD.prototype,"transitionOut",[DM],Object.getOwnPropertyDescriptor(DD.prototype,"transitionOut"),DD.prototype),DD));_._RF.pop(),_._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var DZ,D$,D0,D1,D2,D4,D3,D5,D6=k.ccclass,D8=k.property;Dj=D6("EventBadge"),DX=D8(L),DY=D8(x),Dj((DQ=st((DJ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"label",DQ,Ke(g)),g}return Ue(n,[{key:"text",get:function(){return this.label.string},set:function(g){this.label.string=g}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(M)).prototype,"label",[DX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(DJ.prototype,"text",[DY],Object.getOwnPropertyDescriptor(DJ.prototype,"text"),DJ.prototype),DJ));_._RF.pop(),_._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var D9,D7,Ft,Fn,Fi,Fr,Fa,Fo,Fs,Fl,Fu,Fc,Fh,Fp,Ff,Fy,Fv,Fg,Fm,Fb,Fw,FS,FE,F_,Fk,FC,FA,FT,FR,FI,FL,FP,FO,FB,FN,FM,FD,FF,FU,Fx,Fz,FG,FV,FK,FH,Fq,FW,Fj=k.ccclass,FX=k.property;DZ=Fj("EventProgressBar"),D$=FX(oa),D0=FX(L),D1=FX(x),D2=FX({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),DZ((D3=st((D4=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"progressBar",D3,Ke(g)),rt(g,"progressLabel",D5,Ke(g)),g}return Ue(n,[{key:"text",get:function(){return this.progressLabel.string},set:function(g){this.progressLabel.string=g}},{key:"progress",get:function(){return this.progressBar.progress},set:function(g){this.progressBar.progress=g}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(M)).prototype,"progressBar",[D$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D5=st(D4.prototype,"progressLabel",[D0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(D4.prototype,"text",[D1],Object.getOwnPropertyDescriptor(D4.prototype,"text"),D4.prototype),st(D4.prototype,"progress",[D2],Object.getOwnPropertyDescriptor(D4.prototype,"progress"),D4.prototype),D4));_._RF.pop(),_._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var FY,FJ,FQ,FZ,F$,F0=k.ccclass,F1=k.property,F2=k.executeInEditMode,F4=globalThis.game.analytics,F3=GameCore.Plugins.Analytics.Events;D9=F0("NavButton"),D7=F1(J),Ft=F1({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),Fn=F1({type:K,group:{name:"Animation"}}),Fi=F1({type:K,group:{name:"Animation"}}),Fr=F1({type:K,group:{name:"Animation"}}),Fa=F1({type:K,group:{name:"Animation"}}),Fo=F1({type:K,group:{name:"Animation"}}),Fs=F1({group:{name:"Animation"}}),Fl=F1({type:K,group:{name:"Animation"}}),Fu=F1({type:K,group:{name:"Animation"}}),Fc=F1({group:{name:"Animation"}}),Fh=F1({type:K,group:{name:"Animation"}}),Fp=F1({type:K,group:{name:"Animation"}}),Ff=F1({type:K,group:{name:"Animation"}}),Fy=F1({type:K,group:{name:"Animation"}}),Fv=F1({type:K,group:{name:"Animation"}}),Fg=F1({type:R}),Fm=F1(C),Fb=F1(eu),Fw=F1({type:R}),FS=F1({type:es(nO)}),FE=F1(Pw),D9(F_=F2((FC=st((Fk=function(g){ze(o,g);var E,_,k=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"wip",FC,Ke(g)),rt(g,"isSelectedInEditor",FA,Ke(g)),rt(g,"animationDuration",FT,Ke(g)),rt(g,"selectedSpacing",FR,Ke(g)),rt(g,"deselectedSpacing",FI,Ke(g)),rt(g,"selectedIconY",FL,Ke(g)),rt(g,"selectedIconX",FP,Ke(g)),rt(g,"selectedIconScale",FO,Ke(g)),rt(g,"deselectedIconY",FB,Ke(g)),rt(g,"deselectedIconX",FN,Ke(g)),rt(g,"deselectedIconScale",FM,Ke(g)),rt(g,"initTextY",FD,Ke(g)),rt(g,"selectedTextY",FF,Ke(g)),rt(g,"selectedTextX",FU,Ke(g)),rt(g,"deselectedTextY",Fx,Ke(g)),rt(g,"deselectedTextX",Fz,Ke(g)),rt(g,"spacer",FG,Ke(g)),rt(g,"icon",FV,Ke(g)),rt(g,"text",FK,Ke(g)),rt(g,"uiTransform",FH,Ke(g)),rt(g,"screenType",Fq,Ke(g)),rt(g,"navManager",FW,Ke(g)),g.isSelected=!1,g.onMouseEnter=function(E){g.isSelected||g.playHoverOnAnimation()},g.onMouseLeave=function(E){g.isSelected||g.playHoverOffAnimation()},g}return Ue(o,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.initTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var g,E;this.isSelected||(i5.playSound(ic.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),F4.event(F3.BUTTON_CLICK,{button_name:null!==(g=null===(E=this.node.parent)||void 0===E?void 0:E.name)&&void 0!==g?g:this.node.name,screen_name:i_.getCurrentPage()}))}},{key:"select",value:(_=Be(function(){var g;var E=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:g=!(E.length>0&&void 0!==E[0])||E[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0;if(!g)return[3,2];return[4,tZ.runTweenAsync(this.playSelectAnimation())];case 1:_.sent();return[3,3];case 2:this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255;_.label=3;case 3:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"deselect",value:(E=Be(function(){var g,E;var _=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:g=!(_.length>0&&void 0!==_[0])||_[0],E=_.length>1&&void 0!==_[1]&&_[1];if(!this.isSelected&&!E)throw new Error("NavButton: Already deselected");this.isSelected=!1;if(!g)return[3,2];return[4,tZ.runTweenAsync(this.deselectAnimation())];case 1:k.sent();return[3,3];case 2:this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0;k.label=3;case 3:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var g=new em(this.selectedIconX,this.selectedIconY,0),E=new em(this.deselectedIconX,this.deselectedIconY,0),_=this.node.scale.clone();this.node.scale=this.selectedIconScale;var k=this.uiTransform.convertToWorldSpaceAR(g),C=this.uiTransform.convertToWorldSpaceAR(E);return this.node.scale=_,C.x-k.x}},{key:"playHoverOnAnimation",value:function(){var g=z(this.icon);return g.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),tZ.runTweenAsync(g)}},{key:"playHoverOffAnimation",value:function(){var g=z(this.icon);return g.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),tZ.runTweenAsync(g)}},{key:"playSelectAnimation",value:function(){var g=this;return z(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(E,_){if(void 0!==_){var k=el.quintInOut(_),C=el.backOut(_),A=el.linear(_),T=_<.5?2*_:1,R=g.deselectedIconY+(g.selectedIconY-g.deselectedIconY)*C,I=g.deselectedIconX+(g.selectedIconX-g.deselectedIconX)*A;g.icon.setPosition(I,R,0);var L=g.deselectedIconScale.clone().lerp(g.selectedIconScale,k);g.icon.setScale(L.x,L.y,g.icon.scale.z);var P=255*T,O=g.deselectedTextY+(g.selectedTextY-g.deselectedTextY)*A,B=g.deselectedTextX+(g.selectedTextX-g.deselectedTextX)*A;g.text.opacity=P,g.text.node.setPosition(B,O,0)}}})}},{key:"deselectAnimation",value:function(){var g=this;return z(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(E,_){if(void 0!==_){var k=eP(g.selectedIconY,g.deselectedIconY,_),C=eP(g.selectedIconX,g.deselectedIconX,_);g.icon.setPosition(C,k,0);var A=eP(255,0,_<.5?2*_:1);g.text.opacity=A;var T=eP(g.selectedTextY,g.deselectedTextY,_),R=eP(g.selectedTextX,g.deselectedTextX,_);g.text.node.setPosition(R,T,0);var I=g.selectedIconScale.clone().lerp(g.deselectedIconScale,el.quintInOut(_));g.icon.setScale(I.x,I.y,g.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}}]),o}(M)).prototype,"wip",[D7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),FA=st(Fk.prototype,"isSelectedInEditor",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),FT=st(Fk.prototype,"animationDuration",[Fn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),FR=st(Fk.prototype,"selectedSpacing",[Fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),FI=st(Fk.prototype,"deselectedSpacing",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),FL=st(Fk.prototype,"selectedIconY",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),FP=st(Fk.prototype,"selectedIconX",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FO=st(Fk.prototype,"selectedIconScale",[Fs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(1,1,1)}}),FB=st(Fk.prototype,"deselectedIconY",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FN=st(Fk.prototype,"deselectedIconX",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FM=st(Fk.prototype,"deselectedIconScale",[Fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(.8,.8,1)}}),FD=st(Fk.prototype,"initTextY",[Fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -100}}),FF=st(Fk.prototype,"selectedTextY",[Fp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -10}}),FU=st(Fk.prototype,"selectedTextX",[Ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fx=st(Fk.prototype,"deselectedTextY",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fz=st(Fk.prototype,"deselectedTextX",[Fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FG=st(Fk.prototype,"spacer",[Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FV=st(Fk.prototype,"icon",[Fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FK=st(Fk.prototype,"text",[Fb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FH=st(Fk.prototype,"uiTransform",[Fw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fq=st(Fk.prototype,"screenType",[FS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FW=st(Fk.prototype,"navManager",[FE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F_=Fk))||F_);_._RF.pop(),_._RF.push({},"091aai5+ANDeZfFN8JFkbyi","TournamentButton",void 0);var F5,F6,F8,F9,F7,Ut=k.ccclass,Un=k.property,Ui=globalThis.game.leaderboard;FY=Ut("TournamentButton"),FJ=Un(C),FQ=nk.onlyRunInLifeCycle,FY((F$=st((FZ=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"hotIcon",F$,Ke(g)),g}return Ue(i,[{key:"onLoad",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:L.trys.push([0,11,,12]);return[4,ut.requestTournamentDataAsync()];case 1:E=at.apply(void 0,[L.sent()]);L.label=2;case 2:L.trys.push([2,8,9,10]);E.s();L.label=3;case 3:if(!!(g=E.n()).done)return[3,7];_=g.value.payload,k=_.leaderboardId,C=_.playerId;if(!(k&&"global"===C))return[3,6];A=Ui.getLeaderboardName(k);T=A;if(!T)return[3,5];return[4,Ui.requestLeaderboardAsync(A,0)];case 4:T=(L.sent(),this.checkAndShowHotIcon(A));L.label=5;case 5:L.label=6;case 6:return[3,3];case 7:return[3,10];case 8:R=L.sent();E.e(R);return[3,10];case 9:E.f();return[7];case 10:return[3,12];case 11:I=L.sent();console.info("Error in TournamentButton",I);return[3,12];case 12:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"checkAndShowHotIcon",value:function(g){var E=Ui.getLeaderboard(g);E&&E.amountPlayer>=30&&(this.hotIcon.active=!0)}}]),i}(M)).prototype,"hotIcon",[FJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(FZ.prototype,"checkAndShowHotIcon",[FQ],Object.getOwnPropertyDescriptor(FZ.prototype,"checkAndShowHotIcon"),FZ.prototype),FZ));_._RF.pop(),_._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var Ur,Ua,Uo,Us,Ul,Uu,Uc,Up,Uf,Uy,Uv,Ug,Um,Ub,Uw=k.ccclass,US=k.property,UE=k.disallowMultiple,U_=globalThis.game.player,Uk=rv,UC=GameCore.Match.Modes,UA=[ic.COMBO_1,ic.COMBO_2,ic.COMBO_3,ic.COMBO_4,ic.COMBO_5,ic.COMBO_6,ic.COMBO_7,ic.COMBO_8,ic.COMBO_9,ic.COMBO_10,ic.COMBO_11,ic.COMBO_12,ic.COMBO_13,ic.TILE_MATCH,ic.BOMB_DEFUSE,ic.BOMB_EXPLODE_1,ic.BOMB_EXPLODE_2,ic.TILE_SELECT,ic.THUNDERBOLT,ic.SHUFFLE_ITEM,ic.LEVEL_START,ic.LEVEL_COMPLETE,ic.LEVEL_FAIL];F5=Uw("GameScene"),F6=US(_W),F5(F8=UE((F7=st((F9=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"coinManager",F7,Ke(g)),g.handleGameExit=function(){lU.switchScene(sZ)},g.handleShowResults=function(){lU.switchScene(s$)},g.handleGameMaskWhenLayoutChanged=function(g){var E=$("Canvas/Game/GameObjects");if(E){var _=E.getComponent(eq);_&&(_.enabled=g===Uk.Landscape)}},g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onLoad",value:function(){this.coinManager.init()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t6,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(r0.GAME_EXIT,this.handleGameExit),this.node.scene.on(r0.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}},{key:"start",value:function(){U_.getPlayerSetting("music")&&this.updateMusic(),this.preloadSounds(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadSounds",value:function(){for(var g=0,E=UA;g<E.length;g++){var _=E[g];n7.loadAudioClipAsync(_)}}},{key:"preloadScenes",value:function(){lU.preloadDashboardScene()}},{key:"updateMusic",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=l_.getMatchMode()===UC.TOURNAMENT,E=g?ic.TOURNAMENT_MUSIC:ic.BG_MUSIC;_=i5.getCurrentMusic()!==E;if(!_)return[3,3];return[4,i5.setVolumeMusic(0,!0)];case 1:k.sent();return[4,tZ.waitTweenAsync(1)];case 2:_=k.sent();k.label=3;case 3:i5.playMusic(E,g),i5.setVolumeMusic(g?.4:.3,!0);return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"coinManager",[F6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F8=F9))||F8);_._RF.pop(),_._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);var UT,UR,UI,UL,UP,UO,UB=k.ccclass,UN=k.property;Ur=UB("ItemButton"),Ua=UN(J),Uo=UN(B),Us=UN({type:V}),Ul=UN(L),Uu=UN(C),Uc=UN(C),Ur((Uf=st((Up=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"isDebug",Uf,Ke(g)),rt(g,"button",Uy,Ke(g)),rt(g,"quantity",Uv,Ke(g)),rt(g,"quantityLabel",Ug,Ke(g)),rt(g,"plusNode",Um,Ke(g)),rt(g,"quantityNode",Ub,Ke(g)),g}return Ue(n,[{key:"__preload",value:function(){this.item=this.getComponent(mr),this.validateRequiredComponents()}},{key:"start",value:function(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string="".concat(this.quantity),this.validateButton(),this.node.scene.on(r0.GRID_CREATE,this.validateButton,this),this.node.scene.on(r0.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(r0.GRID_CLEAR,this.validateButton,this)}},{key:"validateRequiredComponents",value:function(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}},{key:"validateButton",value:function(){var g=this;console.log("VALIDATE BUTTON"),this.canActivate().then(function(E){g.button.interactable=!0,g.plusNode.active=0===g.quantity,g.quantityNode.active=g.quantity>0})}},{key:"activate",value:function(){var g=this;return new Promise(function(E){if(g.quantity<=0)return g.handleShowAddItemScreen(),void E();g.item.activate().then(function(){g.isDebug||(g.quantity--,g.quantityLabel.string="".concat(g.quantity),g.item.saveQuantity()),g.validateButton(),E()})})}},{key:"canActivate",value:function(){return Promise.resolve(!0)}},{key:"addQuantity",value:function(g){this.quantity+=g,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"clearQuantity",value:function(){this.quantity=0,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"handleShowAddItemScreen",value:function(){l1.openScreen(ig.GET_ITEM_SCREEN,{item:sP.HINT,quantity:1})}}]),n}(M)).prototype,"isDebug",[Ua],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Uy=st(Up.prototype,"button",[Uo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uv=st(Up.prototype,"quantity",[Us],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ug=st(Up.prototype,"quantityLabel",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Um=st(Up.prototype,"plusNode",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ub=st(Up.prototype,"quantityNode",[Uc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Up));_._RF.pop(),_._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var UM,UD,UF,UU,Ux,Uz,UG=k.ccclass,UV=k.property;UT=UG("ComboEffect"),UR=UV(eu),UI=UV(eV),UT((UP=st((UL=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"circleOpacity",UP,Ke(g)),rt(g,"particle",UO,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(r0.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(g){g>1&&(this.circleOpacity.node.scale=em.ZERO,this.circleOpacity.opacity=60,this.particle.resetSystem(),z(this.circleOpacity.node).to(.2,{scale:new em(1.3,1.3,1.3)},{easing:"quadOut"}).start(),z(this.circleOpacity).delay(.3).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),n}(M)).prototype,"circleOpacity",[UR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UO=st(UL.prototype,"particle",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UL));_._RF.pop(),_._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var UK,UH,Uq,UW,Uj,UX,UY,UJ,UQ=k.ccclass,UZ=k.property;UM=UQ("ComboLabel"),UD=UZ(L),UF=UZ(C),UM((Ux=st((UU=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"comboNumber",Ux,Ke(g)),rt(g,"comboContainer",Uz,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.opacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(r0.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(g){0===g?this.opacity.opacity=0:g>1?(this.opacity.opacity=255,this.comboNumber.string="".concat(g),z(this.comboContainer).to(.1,{scale:new em(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:em.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),n}(M)).prototype,"comboNumber",[UD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uz=st(UU.prototype,"comboContainer",[UF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UU));_._RF.pop(),_._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var U$,U0,U1,U2,U4,U3,U5,U6,U8,U9=k.ccclass,U7=k.property;UK=U9("ComboPopup"),UH=U7(eo),Uq=U7(ea),UW=U7(G),UK((UX=st((Uj=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"textSprite",UX,Ke(g)),rt(g,"comboSprites",UY,Ke(g)),rt(g,"animation",UJ,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"start",value:function(){this.node.scene.on(r0.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"validateRequiredComponents",value:function(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}},{key:"handleOnComboUpdated",value:function(g){if(!(g<2)){for(var E=this.comboSprites.length-1;E>=0;E--)if(g>=E+2){this.textSprite.spriteFrame=this.comboSprites[E],this.animation.play();break}}}}]),n}(M)).prototype,"textSprite",[UH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UY=st(Uj.prototype,"comboSprites",[Uq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),UJ=st(Uj.prototype,"animation",[UW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uj));_._RF.pop(),_._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var xt,xn,xi,xr,xa,xo,xs,xl,xu,xc,xp,xf,xy,xv,xg,xm=k.ccclass,xb=k.property,xw=(U$=xm("PlayerScore"),U0=xb(C),U1=xb(L),U2=xb(eo),U$((U5=st((U3=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"crown",U5,Ke(g)),rt(g,"playerScore",U6,Ke(g)),rt(g,"avatar",U8,Ke(g)),g}return Ue(i,[{key:"showCrown",value:function(g){this.crown.active=g}},{key:"setPlayerScore",value:function(g){this.playerScore.string=g.toString()}},{key:"playWaitingAnimation",value:function(){var g=this,E=0;this.playerScore.schedule(function(){E=(E+1)%4;var _=Array(E+1).join(".");g.playerScore.string="Waiting"+_},.5);var _=this.playerScore.getComponent(eu),k=z(_).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=z(_).repeatForever(k).start()}},{key:"stopWaitingAnimation",value:function(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(eu).opacity=255}},{key:"loadPhoto",value:(E=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,2,,3]);return[4,bB.getPlayerAvatar(g,E,128)];case 1:_=C.sent();if(!_)throw new Error("Failed to create sprite frame");_.packable=!0,this.avatar.spriteFrame=_;return[3,3];case 2:k=C.sent();return[2,void console.error(k)];case 3:return[2]}})}),function(g,_){return E.apply(this,arguments)})}]),i}(M)).prototype,"crown",[U0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U6=st(U3.prototype,"playerScore",[U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U8=st(U3.prototype,"avatar",[U2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U4=U3))||U4);_._RF.pop(),_._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var xS,xE,x_,xk,xC,xA,xT,xR,xI,xL=k.ccclass,xP=k.disallowMultiple,xO=k.property,xB=globalThis.game,xN=xB.match,xM=xB.player,xD=xB.monitorError,xF="Waiting",xU=GameCore,xx=xU.Dtos.Match.Data,xz=xU.Utils.Object;xt=xL("ChallengeResultScene"),xn=xO(V),xi=xO({type:xw,group:"Score"}),xr=xO({type:xw,group:"Score"}),xa=xO(ya),xo=xO(L),xs=xO(my),xt(xl=xP((xc=st((xu=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"pollingInterval",xc,Ke(g)),rt(g,"playerScore",xp,Ke(g)),rt(g,"opponentScore",xf,Ke(g)),rt(g,"paperConfetti",xy,Ke(g)),rt(g,"titleText",xv,Ke(g)),rt(g,"levelManager",xg,Ke(g)),g.goToDashboardScene=function(){lU.switchScene(sZ)},g.pollMatchState=Be(function(){var E,_,k,C,A,T,R,I,L,P,O,B,N,M,D,F,U,x;return _ts_generator(this,function(z){switch(z.label){case 0:z.trys.push([0,2,,3]);E=xN.getMatchState().id;if(null===E)throw new Error("Match id is not found");_=xM.getPlayerId(),k=Date.now();return[4,xN.api.getMatchAPI().getMatchDetailByIdAsync(E)];case 1:C=z.sent(),A=Date.now(),T=Math.max(0,A-k,g.pollingInterval),R=new xx(C).toObject(),I=R.blackPlayerId,L=R.blackPlayerScore,P=R.whitePlayerScore,O=R.blackPlayerFinish,B=R.whitePlayerFinish,N=_===I?L:P,M=_===I?P:L,D=_===I?O:B,F=_===I?B:O,U=O&&B;if(g.playerScore.setPlayerScore(N),g.opponentScore.setPlayerScore(M),g.playerScore.showCrown(U&&N>M),g.opponentScore.showCrown(U&&M>N),g.stopWaitingAnimation(),g.playerScore.stopWaitingAnimation(),g.opponentScore.stopWaitingAnimation(),U){if(N===M)g.titleText.string="Draw";else if(N>M)g.titleText.string="You Win";else{if(!(N<M))return[2];g.titleText.string="You Lose"}}else g.titleText.string=xF,g.playWaitingAnimation(),D||g.playerScore.playWaitingAnimation(),F||g.opponentScore.playWaitingAnimation();g.scheduleOnce(g.pollMatchState,T);return[3,3];case 2:x=z.sent();console.warn("ResultScene: Error on pollMatchState",x),g.scheduleOnce(g.pollMatchState,g.pollingInterval);return[3,3];case 3:return[2]}})}),g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"onLoad",value:function(){try{var g=xN.getMatchState(),E=g.customData,_=E.playerId,k=E.opponentId;if(null===_||null===k)throw new Error("ResultScene: playerId is ".concat(_," and opponentId is ").concat(k,". Expected to not be null."));var C=xM.getPlayer().photo,A=g.profiles[_],T=A.score,R=void 0===T?0:T,I=A.finished,L=void 0!==I&&I,P=g.profiles[k],O=P.photo,B=P.score,N=void 0===B?0:B,M=P.finished,D=void 0!==M&&M,F=L&&D,U=F&&R>N,x=F&&N>R;this.playerScore.loadPhoto(C,_),this.opponentScore.loadPhoto(O,k),this.playerScore.setPlayerScore(R),this.opponentScore.setPlayerScore(N),this.playerScore.showCrown(U),this.opponentScore.showCrown(x),L&&D?R===N?this.titleText.string="Draw":U?this.titleText.string="You Win":x&&(this.titleText.string="You Lose"):(this.titleText.string=xF,this.playWaitingAnimation(),L||this.playerScore.playWaitingAnimation(),D||this.opponentScore.playWaitingAnimation())}catch(g){console.warn("ResultScene: Error on load",g),this.goToDashboardScene()}}},{key:"listenEvents",value:function(){this.node.scene.on(nn,this.goToDashboardScene),this.node.scene.on(ne,this.onReplayButtonPressed,this)}},{key:"start",value:function(){var g=this;this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce(function(){var E,_=at(g.paperConfetti);try{for(_.s();!(E=_.n()).done;)E.value.play()}catch(g){_.e(g)}finally{_.f()}},.2),i5.playSound(ic.LEVEL_COMPLETE),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadScenes",value:function(){lU.preloadDashboardScene()}},{key:"onDestroy",value:function(){this.unschedule(this.pollMatchState)}},{key:"onReplayButtonPressed",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,L,P,O,B,N;return _ts_generator(this,function(M){switch(M.label){case 0:E=(null!==(g=xM.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;_=Math.max(1,_);return[4,this.levelManager.loadLevelData(_)];case 1:k=M.sent();M.label=2;case 2:M.trys.push([2,4,,5]);if(!k)throw new Error("Level data is not found");C=xN.getMatchState().customData.opponentId;if(!C)throw new Error("Opponent id is not found");l1.showLoadingScreen();A=cv.generateFen(k),T=k.mode,R=void 0===T?"":T,I=k.rules,L=void 0===I?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:I,P=k.time,O=void 0===P?0:P,B=k.level;return[4,xN.challenge.friend.processAsync({playerId:xM.getPlayerId(),opponentId:C,extraData:{level:B,fen:A,gravity:R,rules:L,time:O}})];case 3:M.sent(),l1.closeLoadingScreen(),this.goToGameScene();return[3,5];case 4:N=M.sent();if(xz.hasOwn(N,"code")&&"USER_INPUT"===N.code)return[2];console.warn("ReplayChallengeFriend",N),l1.closeLoadingScreen(),l1.showNotificationScreen("Sorry, you cannot replay\nat this time.",2),null==xD||xD.sendException(_instanceof(N,Error)?N:new Error("ReplayChallengeFriend"+JSON.stringify(N))),this.scheduleOnce(this.goToDashboardScene,2);return[3,5];case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onHomeButtonPressed",value:function(){this.goToDashboardScene()}},{key:"goToGameScene",value:function(){lU.switchScene(sQ)}},{key:"playWaitingAnimation",value:function(){var g=this,E=0;this.titleText.schedule(function(){E=(E+1)%4;var _=Array(E+1).join(".");g.titleText.string=xF+_},.5);var _=this.titleText.getComponent(eu),k=z(_).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=z(_).repeatForever(k).start()}},{key:"stopWaitingAnimation",value:function(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(eu).opacity=255}}]),i}(M)).prototype,"pollingInterval",[xn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),xp=st(xu.prototype,"playerScore",[xi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xf=st(xu.prototype,"opponentScore",[xr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xy=st(xu.prototype,"paperConfetti",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xv=st(xu.prototype,"titleText",[xo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xg=st(xu.prototype,"levelManager",[xs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xl=xu))||xl);_._RF.pop(),_._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var xG,xV=k.ccclass,xK=k.property,xH=k.disallowMultiple,xq=GameCore.Events,xW=globalThis.game.event,xj=(xS=xV("BaseScreen"),xE=xK(C),x_=xK(C),xk=xK(eu),xS(xC=xH((xT=st((xA=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"container",xT,Ke(g)),rt(g,"backgroundMask",xR,Ke(g)),rt(g,"screenOpacity",xI,Ke(g)),g.data={},g}return Ue(n,[{key:"__preload",value:function(){this.animation=this.getComponent(G),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function(){var g=this.getMaskOpacity(),E=this.getContainerOpacity();g&&E&&(g.opacity=0,E.opacity=0)}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function(g){this.screenOpacity.opacity=g}},{key:"open",value:function(g){var E,_;g&&(this.data=g),this.show(),this.runAnimation(null!==(E=null===(_=this.data.overrideAnimation)||void 0===_?void 0:_.openScreen)&&void 0!==E?E:"OpenScreen")}},{key:"close",value:function(){var g,E,_=this;this.node.active&&(this.animation.once(G.EventType.FINISHED,function(){xW.emit(xq.CLOSED_SCREEN,{screenName:_.node.name}),_.hide()}),this.runAnimation(null!==(g=null===(E=this.data.overrideAnimation)||void 0===E?void 0:E.closeScreen)&&void 0!==g?g:"CloseScreen"))}},{key:"runAnimation",value:function(g){if(!this.isAnimationExist(g))throw new Error("".concat(this.node.name,": Animation component must have ").concat(g," clip"));this.animation.play(g)}},{key:"isAnimationExist",value:function(g){return this.animation.clips.some(function(E){return!(!E||E.name!==g)})}},{key:"getMaskOpacity",value:function(){var g=this.backgroundMask.getComponent(eu);return g||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function(){var g=this.container.getComponent(eu);return g||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function(){this.setScreenOpacity(255);var g=this.node.getComponent(H);if(g){g.enabled=!0,g.updateAlignment();var E,_=at(this.node.getComponentsInChildren(H));try{for(_.s();!(E=_.n()).done;)E.value.updateAlignment()}catch(g){_.e(g)}finally{_.f()}}}},{key:"hide",value:function(){this.setScreenOpacity(0),this.node.setWorldPosition(new em(-1e3,-1e3,0));var g=this.node.getComponent(H);g&&(g.enabled=!1)}}]),n}(M)).prototype,"container",[xE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xR=st(xA.prototype,"backgroundMask",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xI=st(xA.prototype,"screenOpacity",[xk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xC=xA))||xC)||xC);_._RF.pop(),_._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var xX,xY,xJ,xQ,xZ,x$=k.ccclass,x0=k.requireComponent;x$("BackgroundMask")(xG=x0([eu])(xG=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"onLoad",value:function(){var g=this.getComponent(eu);g?(this.opacity=g,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var g,E,_=this.opacity.opacity/255;g=_,(E=document.getElementById("app-mask"))&&(E.style.background="rgb(0 0 0 / ".concat(g,")"))}}]),n}(M))||xG);_._RF.pop(),_._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);var x1,x2,x4,x3,x5,x6,x8,x9,x7,zt,zn,zi,zr,za,zo=k.ccclass,zs=k.property,zl=(xX=zo("Screens"),xY=zs({type:es(ig)}),xX((xZ=st((xQ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"screenKeys",xZ,Ke(g)),g}return Ue(n)}(M)).prototype,"screenKeys",[xY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xJ=xQ))||xJ);_._RF.pop(),_._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var zu,zc,zh,zp,zf,zy,zg,zm,zb,zw,zS,zE,z_,zk,zC,zA,zT,zR,zI,zL,zP,zO=k.ccclass,zB=k.property,zN=k.disallowMultiple,zM=k.requireComponent,zD=GameCore.Events,zF=globalThis.game.event;x1=zO("CongratulationScreen"),x2=zM(xj),x4=zB(C),x3=zB(C),x5=zB(B),x6=zB(B),x8=zB(B),x1(x9=zN(x9=x2((zt=st((x7=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"congratulation",zt,Ke(g)),rt(g,"confirmation",zn,Ke(g)),rt(g,"closeButtonComponent",zi,Ke(g)),rt(g,"yesButtonComponent",zr,Ke(g)),rt(g,"noButtonComponent",za,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("CongratulationScreen: screen not found");g.validateEventPayload(E)&&(g.closeButtonComponent.interactable=!0,g.yesButtonComponent.interactable=!0,g.noButtonComponent.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.confirmationUIOpacity=this.confirmation.getComponent(eu),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){zF.on(zD.OPENING_SCREEN,this.handleOpeningScreen),zF.on(zD.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){zF.off(zD.OPENING_SCREEN,this.handleOpeningScreen),zF.off(zD.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,l1.closeScreen(ib[this.node.name])}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,z(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),z(this.confirmation).set({scale:new em(.8,.8,.8)}).to(.2,{scale:new em(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(r0.START_OVER,1)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(r0.GAME_REPLAY,{level:this.screen.data.level})}}]),n}(M)).prototype,"congratulation",[x4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zn=st(x7.prototype,"confirmation",[x3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zi=st(x7.prototype,"closeButtonComponent",[x5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zr=st(x7.prototype,"yesButtonComponent",[x6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),za=st(x7.prototype,"noButtonComponent",[x8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x9=x7))||x9)||x9);_._RF.pop(),_._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var zU,zx,zz,zG,zV,zK,zH,zq,zW,zj,zX,zY,zJ,zQ,zZ,z$,z0,z1,z2,z4,z3,z5,z6=k.ccclass,z8=k.property,z9=(zu=z6("DayBlock"),zc=z8({type:eo,group:"Background"}),zh=z8({type:eo,group:"Background"}),zp=z8({type:ea,group:"Background"}),zf=z8({type:ea,group:"Background"}),zy=z8(L),zg=z8(L),zm=z8(C),zb=z8(C),zw=z8(C),zu((z_=st((zE=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"background",z_,Ke(g)),rt(g,"topBackground",zk,Ke(g)),rt(g,"blueBackground",zC,Ke(g)),rt(g,"blueTopBackground",zA,Ke(g)),rt(g,"dayLabel",zT,Ke(g)),rt(g,"coinLabel",zR,Ke(g)),rt(g,"rewardItemsNode",zI,Ke(g)),rt(g,"checkNode",zL,Ke(g)),rt(g,"glowNodes",zP,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new A(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new A("#3469bf")}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){this.updateBackground(g),this.updateDayLabel(g),this.coinLabel.string=g.value.toString(),this.updateRewardItems(g)}},{key:"updateBackground",value:function(g){if(this.blueTopBackground&&this.blueBackground)switch(g.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(g){this.dayLabel.string="Day ".concat(g.day.toString());var E=this.defaultDayLabelOutlineColor;"rewarded"!==g.status&&(E=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=E,this.dayLabel.shadowColor=E}},{key:"updateRewardItems",value:function(g){switch(g.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(g){this.glowNodes&&this.glowNodes.forEach(function(E){E.active=g})}}]),n}(M)).prototype,"background",[zc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zk=st(zE.prototype,"topBackground",[zh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zC=st(zE.prototype,"blueBackground",[zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zA=st(zE.prototype,"blueTopBackground",[zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zT=st(zE.prototype,"dayLabel",[zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zR=st(zE.prototype,"coinLabel",[zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zI=st(zE.prototype,"rewardItemsNode",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zL=st(zE.prototype,"checkNode",[zb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zP=st(zE.prototype,"glowNodes",[zw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zS=zE))||zS);_._RF.pop(),_._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var z7=k.ccclass,Gt=k.property,Gn=k.requireComponent,Gi=GameCore,Gr=Gi.Events,Ga=Gi.Utils,Go=Ga.Object,Gs=Ga.Array,Gl=Gi.Configs.DailyRewards,Gu=globalThis.game,Gc=Gu.event,Gp=Gu.dailyRewards,Gf=Gu.player,Gy=Gu.monitorError;zU=z7("DailyRewardsScreen"),zx=Gn(xj),zz=nk.required(),zG=nk.getComponent(xj),zV=nk.required(),zK=Gt(C),zH=nk.required(),zq=Gt(B),zW=nk.required(),zj=Gt(B),zX=Gt([z9]),zY=nk.onlyRunInLifeCycleAsync,zJ=nk.onlyRunInLifeCycle,zQ=nk.onlyRunInLifeCycleAsync,zZ=nk.onlyRunInLifeCycle,zU(z$=zx((z1=st((z0=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"screen",z1,Ke(g)),g.rewardsData=[],g.debugScreenOpened=!1,g.debugUpdatedRewardsData=!1,rt(g,"loadingRing",z2,Ke(g)),rt(g,"claimButton",z4,Ke(g)),rt(g,"claimX2Button",z3,Ke(g)),rt(g,"dailyBlocks",z5,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(){var E=Be(function(E){return _ts_generator(this,function(_){g.validateEventPayload(E)&&g.open();return[2]})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,nk.decorateComponent(this),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"listenScreenEvents",value:function(){Gc.on(Gr.OPENING_SCREEN,this.handleOpeningScreen),Gc.on(Gr.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Gc.off(Gr.OPENING_SCREEN,this.handleOpeningScreen),Gc.off(Gr.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.prepareScreen(),this.openAsync()}},{key:"openAsync",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.updateRewardsData()];case 1:g.sent();return[4,this.updateScreenToMatchData()];case 2:g.sent();return[2]}})}),function(){return A.apply(this,arguments)})},{key:"updateScreenToMatchData",value:function(){return this.loginDailyRewards(),this.updateDayBlocks(),this.loadingRing.active=!1,this.setInteractableButtons(!0),this.runPopUpAnimation()}},{key:"prepareScreen",value:function(){this.debugScreenOpened=!0,this.loadingRing.active=!0,this.setInteractableButtons(!1),this.node.scene.emit(r0.HIDE_UI),this.resetState()}},{key:"close",value:function(){Gc.emit(Gr.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(r0.SHOW_UI)}},{key:"resetState",value:function(){var g,E=at(this.dailyBlocks);try{for(E.s();!(g=E.n()).done;){var _=g.value;_.uiOpacity.opacity=0,_.node.scale=new em(1.2,1.2,1.2)}}catch(g){E.e(g)}finally{E.f()}}},{key:"runPopUpAnimation",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;this.screen.container||console.warn("DailyRewardScreen: screen not found");return[4,Promise.all(this.dailyBlocks.map(function(E,_){return g.runAppearTween(E,.15*_)}))];case 1:E.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"runAppearTween",value:(k=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=z(g.uiOpacity).delay(E).to(.3,{opacity:255},{easing:"quadOut"}),k=z(g.node).delay(E).to(.3,{scale:em.ONE},{easing:"backOut"});return[4,Promise.all([tZ.runTweenAsync(_),tZ.runTweenAsync(k)])];case 1:C.sent();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleOnClaim",value:function(){this.setInteractableButtons(!1);var g=this.getCurrentRewardData();if(!g)return null==Gy||Gy.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),l1.showNotificationScreen("Unable to validate rewards. Please try again later...",2),void this.setInteractableButtons(!0);this.claimReward(g)}},{key:"handleOnClaimX2",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.setInteractableButtons(!1);g=this.getCurrentRewardData();if(!g)return[2,(null==Gy||Gy.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),l1.showNotificationScreen("Unable to validate rewards. Please try again later...",2),void this.setInteractableButtons(!0))];return[4,vc.showRewardVideoAdAsync({})];case 1:E.sent()?this.claimReward(g,!0):this.setInteractableButtons(!0);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return Gs.search(this.rewardsData,function(g){return"ready"===g.status})}},{key:"claimReward",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=g.value*(_?2:1),C=new nN;if(this.node.scene.emit(r0.ADD_COINS,{coins:k,collectionAnimation:{animateTextOnly:!1,signal:C}}),g.items){var A=g.items.hint*(_?2:1),T=g.items.thunder*(_?2:1),R=g.items.storm*(_?2:1),I=Gf.getGameData();I?(Gf.setGameData({items:{hint:I.items.hint+A,thunder:I.items.thunder+T,storm:I.items.storm+R,pliers:I.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Gp.requestDailyRewardsAsync()];case 1:_.sent();for(g=Me({},Gp.getDailyRewards()),E=0;E<Gl.MaxDays;E++)g[E]=Me(Me({},g[E]),{},{value:sU[E].value,items:sU[E].items});g&&(this.rewardsData=Go.vals(g),this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData));return[2]}})}),function(){return E.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){Gp.logLoginReward()}},{key:"updateDayBlocks",value:function(){var g=this;this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),null==Gy||Gy.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach(function(E,_){if(!(_>=g.rewardsData.length)){var k=g.rewardsData[_],C=k.id,A=k.type,T=k.value,R=k.status;E.updateInfo({day:C,type:A,value:T,status:R})}})}},{key:"setInteractableButtons",value:function(g){this.claimButton.interactable=g,this.claimX2Button.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),s}(M)).prototype,"screen",[zz,zG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z2=st(z0.prototype,"loadingRing",[zV,zK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z4=st(z0.prototype,"claimButton",[zH,zq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z3=st(z0.prototype,"claimX2Button",[zW,zj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z5=st(z0.prototype,"dailyBlocks",[zX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),st(z0.prototype,"updateScreenToMatchData",[zY],Object.getOwnPropertyDescriptor(z0.prototype,"updateScreenToMatchData"),z0.prototype),st(z0.prototype,"claimReward",[zJ],Object.getOwnPropertyDescriptor(z0.prototype,"claimReward"),z0.prototype),st(z0.prototype,"updateRewardsData",[zQ],Object.getOwnPropertyDescriptor(z0.prototype,"updateRewardsData"),z0.prototype),st(z0.prototype,"setInteractableButtons",[zZ],Object.getOwnPropertyDescriptor(z0.prototype,"setInteractableButtons"),z0.prototype),z$=z0))||z$);_._RF.pop(),_._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var Gv,Gg,Gm,Gb,Gw,GS,GE,G_,Gk,GC;(0,k.ccclass)("DayBlockRed")(function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"updateBackground",value:function(g){if(this.blueTopBackground&&this.blueBackground)switch(g.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(g){this.dayLabel.string="Day ".concat(g.day.toString());var E=this.defaultDayLabelOutlineColor;"ready"===g.status&&(E=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=E,this.dayLabel.outlineColor=E}}]),n}(z9));_._RF.pop(),_._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var GA,GT,GR,GI,GL,GP,GO,GB=k.ccclass,GN=k.property,GM=k.requireComponent,GD=globalThis.game.event,GF=GameCore.Events;Gv=GB("GetCoinScreen"),Gg=GM(xj),Gm=GN(L),Gb=GN(B),Gw=GN(B),Gv(GS=Gg((G_=st((GE=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"quantityLabel",G_,Ke(g)),rt(g,"closeButtonComponent",Gk,Ke(g)),rt(g,"getNowButtonComponent",GC,Ke(g)),g.handleOpeningScreen=function(E){console.log("GetCoinScreen.OPENING_SCREEN",E),g.validateEventPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){GD.on(GF.OPENING_SCREEN,this.handleOpeningScreen),GD.on(GF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){GD.off(GF.OPENING_SCREEN,this.handleOpeningScreen),GD.off(GF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return"screenName"in g&&g.screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(r0.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),GD.emit(GF.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(r0.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var g=this.getQuantity();g&&this.updateQuantityLabel(g)}},{key:"updateQuantityLabel",value:function(g){this.quantityLabel.string="x".concat(g.toString())}},{key:"getQuantity",value:function(){var g=this.payload.screenData;return g&&"quantity"in g&&g.quantity&&"number"==typeof g.quantity?g.quantity:0}},{key:"handleAddCoin",value:function(){var g=this.getQuantity();this.node.scene.emit(r0.ADD_COINS,{coins:g,collectionAnimation:{animateTextOnly:!1},skipAnimation:!0}),this.close()}},{key:"handleGetNowButtonClicked",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:i5.stopAllSounds();return[4,vc.showRewardVideoAdAsync({})];case 1:g.sent()&&this.handleAddCoin();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.getNowButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),i}(M)).prototype,"quantityLabel",[Gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gk=st(GE.prototype,"closeButtonComponent",[Gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GC=st(GE.prototype,"getNowButtonComponent",[Gw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GS=GE))||GS);_._RF.pop(),_._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var GU,Gx,Gz,GG,GV,GK,GH,Gq,GW,Gj,GX,GY,GJ,GQ,GZ,G$,G0,G1,G2,G4,G3,G5,G6,G8,G9=k.ccclass,G7=k.property,Vt=(GA=G9("ItemCollectionFX"),GT=G7(eo),GR=G7(ya),GA((GP=st((GL=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"sprite",GP,Ke(g)),rt(g,"particles",GO,Ke(g)),g}return Ue(n,[{key:"__preload",value:function(){nk.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}}}]),n}(M)).prototype,"sprite",[GT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GO=st(GL.prototype,"particles",[GR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GI=GL))||GI);_._RF.pop(),_._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var Vn,Vi,Vr,Va,Vo,Vs,Vl,Vu,Vc=k.ccclass,Vp=k.property,Vd=globalThis.game,Vf=Vd.event,Vy=Vd.player,Vg=Vd.analytics,Vm=GameCore,Vb=Vm.Events,Vw=Vm.Utils,VS=Vw.Object,VE=Vw.Array,V_=Vm.Plugins.Analytics.Events;GU=Vc("GetItemScreen"),Gx=Vp(ee),Gz=Vp(eo),GG=Vp(eo),GV=Vp(eo),GK=Vp(eo),GH=Vp(L),Gq=Vp(L),GW=Vp(L),Gj=Vp(B),GX=Vp(B),GY=Vp(B),GU((GQ=st((GJ=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"itemFxPrefab",GQ,Ke(g)),rt(g,"hintSprite",GZ,Ke(g)),rt(g,"stormSprite",G$,Ke(g)),rt(g,"pliersSprite",G0,Ke(g)),rt(g,"thunderSprite",G1,Ke(g)),rt(g,"titleLabel",G2,Ke(g)),rt(g,"descriptionLabel",G4,Ke(g)),rt(g,"coinLabel",G3,Ke(g)),rt(g,"closeButtonComponent",G5,Ke(g)),rt(g,"buyItemButtonComponent",G6,Ke(g)),rt(g,"getNowButtonComponent",G8,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("GetItemScreen: screen not found");if(g.validateEventPayload(E)){g.setInteractableButtons(!0);var _=g.getItemType();_&&g.updateStatus(_)}},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Vf.on(Vb.OPENING_SCREEN,this.handleOpeningScreen),Vf.on(Vb.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Vf.off(Vb.OPENING_SCREEN,this.handleOpeningScreen),Vf.off(Vb.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.node.scene.emit(r0.GAME_PAUSE)}},{key:"close",value:function(){this.setInteractableButtons(!1),Vf.emit(Vb.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(r0.GAME_RESUME)}},{key:"updateStatus",value:function(g){this.updateItemIcon(g),this.updateTitle(g),this.updateDescription(),this.updateButtons(g)}},{key:"updateItemIcon",value:function(g){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach(function(g){g.node.active=!1}),g){case sP.HINT:this.activeIcon=this.hintSprite;break;case sP.STORM:this.activeIcon=this.stormSprite;break;case sP.THUNDER:this.activeIcon=this.thunderSprite;break;case sP.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}},{key:"updateTitle",value:function(g){var E=g.charAt(0).toUpperCase()+g.slice(1);this.titleLabel.string=E}},{key:"updateDescription",value:function(){var g,E=null===(g=this.payload.screenData)||void 0===g?void 0:g.message;E&&(this.descriptionLabel.string=E)}},{key:"updateButtons",value:function(g){var E=this.canBuyItem(g);this.buyItemButtonComponent.node.active=E,this.getNowButtonComponent.node.active=!E,E&&(this.coinLabel.string="".concat(3*sM[g]))}},{key:"canBuyItem",value:function(g){var E=Vy.getGameData();return!!E&&E.coins>=3*sM[g]}},{key:"getItemType",value:function(){var g=this.payload.screenData;return g&&g.item&&VE.has(VS.vals(sP),g.item)?g.item:null}},{key:"handleAddItem",value:(A=Be(function(){var g,E;return _ts_generator(this,function(_){g=this,E=this.getItemType();E&&(Vg.event(V_.EARN_ITEM,{item_name:E,value:3}),this.node.scene.emit(r0.ADD_ITEM,{animate:function(){return g.animateAddItem(E)},item:E,quantity:3}));return[2]})}),function(){return A.apply(this,arguments)})},{key:"animateAddItem",value:(C=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:E=this.activeIcon.spriteFrame,_=et(this.createItemCollectionNode(E),2),k=_[0],C=_[1],A=this.getItemButtonWorldPosition(g),T=new em(.5,.5,.5);return[4,this.playScaleUpItemAnim(k,C)];case 1:R.sent();return[4,tZ.waitTweenAsync(.8)];case 2:R.sent();return[4,this.playMoveCloseToItemButtonAnim(k,A,T)];case 3:R.sent();return[4,this.playJumpAnim(k,T,A)];case 4:R.sent(),i5.playSound("sounds/clicks"),k.destroy();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"playJumpAnim",value:(k=Be(function(g,E,_){var k,C;return _ts_generator(this,function(A){switch(A.label){case 0:k=_.clone().add3f(0,70,0),C=E.clone().multiplyScalar(1.3);return[4,Promise.all([tZ.runTweenAsync(z(g).to(.3,{worldPosition:k},{easing:"cubicOut"})),tZ.runTweenAsync(z(g).to(.3,{scale:C},{easing:"cubicOut"}))])];case 1:A.sent();return[4,tZ.runTweenAsync(z(g).to(.5,{worldPosition:_},{easing:"cubicIn"}))];case 2:A.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"playMoveCloseToItemButtonAnim",value:function(g,E,_){var k=E.clone().add3f(0,30,0);return tZ.runTweenAsync(z(g).to(1,{worldPosition:k,scale:_},{easing:"cubicInOut"}))}},{key:"createItemCollectionNode",value:function(g){var E=I(this.itemFxPrefab),_=E.getComponent(Vt);return E.setParent(this.node.parent),_.sprite.spriteFrame=g,E.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[E,_]}},{key:"playScaleUpItemAnim",value:function(g,E){return g.setScale(em.ZERO),tZ.runTweenAsync(z(g).delay(.2).call(function(){E.playExplosionParticles(),i5.playSound("sounds/item_reward")}).to(.1,{scale:new em(.8,1.2,1)}).to(.1,{scale:new em(1.2,.8,1)}).to(.1,{scale:new em(1,1,1)}))}},{key:"getItemButtonWorldPosition",value:function(g){return this.getItemButton(g).worldPosition.clone()}},{key:"handleGetNowButtonClicked",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.stopAllSounds();return[4,vc.showRewardVideoAdAsync({})];case 1:g.sent()&&(this.handleAddItem(),this.close());return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(E=Be(function(){return _ts_generator(this,function(g){this.node.scene.emit(r0.REMOVE_COINS,{coins:3*sM[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close();return[2]})}),function(){return E.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var g;null===(g=$("Sound"))||void 0===g||null===(g=g.getComponent(tP))||void 0===g||g.stopAll()}},{key:"getItemButton",value:function(g){switch(g){case sP.HINT:return $("Canvas/UI/Footer/HintItemButton");case sP.STORM:return $("Canvas/UI/Footer/StormItemButton");case sP.THUNDER:return $("Canvas/UI/Footer/ThunderItemButton");case sP.PLIERS:return $("Canvas/UI/Footer/PliersItemButton")}}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.buyItemButtonComponent.interactable=g,this.getNowButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),s}(M)).prototype,"itemFxPrefab",[Gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GZ=st(GJ.prototype,"hintSprite",[Gz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G$=st(GJ.prototype,"stormSprite",[GG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G0=st(GJ.prototype,"pliersSprite",[GV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G1=st(GJ.prototype,"thunderSprite",[GK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G2=st(GJ.prototype,"titleLabel",[GH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G4=st(GJ.prototype,"descriptionLabel",[Gq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G3=st(GJ.prototype,"coinLabel",[GW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G5=st(GJ.prototype,"closeButtonComponent",[Gj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G6=st(GJ.prototype,"buyItemButtonComponent",[GX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G8=st(GJ.prototype,"getNowButtonComponent",[GY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GJ));_._RF.pop(),_._RF.push({},"4d6710xA7hAk65cGA4Dgdrc","GetRewardsScreen",void 0);var Vk,VC=k.ccclass,VA=k.requireComponent,VT=k.property,VR=GameCore.Events,VI=globalThis.game.event;Vn=VC("GetRewardsScreen"),Vi=VA(xj),Vr=VT(L),Va=VT(B),Vn(Vo=Vi((Vl=st((Vs=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"adStartingLabel",Vl,Ke(g)),rt(g,"skipButton",Vu,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){VI.on(VR.OPENING_SCREEN,this.handleOpeningScreen),VI.on(VR.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){VI.off(VR.OPENING_SCREEN,this.handleOpeningScreen),VI.off(VR.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.runAdStartingAnimation()}},{key:"close",value:function(g){this.setInteractableButtons(!1),VI.emit(VR.CLOSE_SCREEN,{screenName:this.node.name,screenData:{getRewardsSuccess:g}})}},{key:"runAdStartingAnimation",value:function(){var g=this,E=5;this.adStartingLabel.string="AD starting in ".concat(E,"...");this.schedule(function(){E<=0?g.stopAdStartingAnimation():(E--,g.adStartingLabel.string="AD starting in ".concat(E,"..."))},1,6)}},{key:"stopAdStartingAnimation",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.unscheduleAllCallbacks();return[4,vc.showRewardedInterstitialAdAsync({})];case 1:g=E.sent();this.close(g);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleClickedSkip",value:function(){this.unscheduleAllCallbacks(),this.close(!1)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.skipButton.interactable=g}}]),i}(M)).prototype,"adStartingLabel",[Vr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vu=st(Vs.prototype,"skipButton",[Va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vo=Vs))||Vo);_._RF.pop(),_._RF.push({},"bfe1eXch0ZMKIz1ofLKc2Iv","HardLevelScreen",void 0);var VL,VP,VO,VB,VN,VM,VD,VF,VU,Vx,Vz,VG,VV,VK=k.ccclass,VH=k.requireComponent,Vq=GameCore.Events,VW=globalThis.game.event;VK("HardLevelScreen")(Vk=VH(xj)(Vk=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleOpeningScreen=function(E){g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){VW.on(Vq.OPENING_SCREEN,this.handleOpeningScreen),VW.on(Vq.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){VW.off(Vq.OPENING_SCREEN,this.handleOpeningScreen),VW.off(Vq.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation()}},{key:"close",value:function(){l1.closeScreen(ib[this.node.name])}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}}]),n}(M))||Vk);_._RF.pop(),_._RF.push({},"2db0dg4dI9GCKCdFOMrBFsQ","GetRewardsEffect",void 0);var Vj,VX,VY,VJ,VQ,VZ,V$,V0,V1,V2,V4,V3,V5,V6,V8,V9,V7,Kt,Kn,Ki,Kr,Ka,Ko,Ks,Kl,Ku,Kc,Kh,Kp,Kd,Kf,Ky,Kv,Kg,Km,Kb,Kw=k.ccclass,KS=k.property,KE=(VL=Kw("GetRewardsEffect"),VP=KS(ea),VO=KS(ea),VB=KS(ea),VN=KS(ea),VM=KS(ya),VL((VU=st((VF=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"hint",VU,Ke(g)),rt(g,"thunder",Vx,Ke(g)),rt(g,"storm",Vz,Ke(g)),rt(g,"pliers",VG,Ke(g)),rt(g,"particles",VV,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"playAnimation",value:(E=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this,k=-30*(g.length-1)/2+90;return[4,Promise.all(g.map(function(g,C){var A=_.createSprite(g),T=k+30*C,R=.15*C;A.node.position=new em(300*Math.cos(Math.PI/180*T),300*Math.sin(Math.PI/180*T),0);var I=z(A.node);return I.delay(R),I.to(.6,{position:em.ZERO,scale:new em(.7,.7,.7)},{easing:"backIn"}),tZ.runTweenAsync(I).then(function(){E(),i5.playSound(ic.COLLECT_STARS),_.playExplodeEffect(),A.node.destroy()})}))];case 1:C.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"playExplodeEffect",value:function(){var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;){var _=g.value;_.stop(),_.play()}}catch(g){E.e(g)}finally{E.f()}}},{key:"createSprite",value:function(g){var E=this.getSpriteFrame(g),_=(new C).addComponent(eo);return _.spriteFrame=E,_.node.parent=this.node,_.node.scale=new em(1.5,1.5,1.5),_}},{key:"getSpriteFrame",value:function(g){switch(g){case"hint":return this.hint;case"thunder":return this.thunder;case"storm":return this.storm;case"pliers":return this.pliers;default:return null}}}]),i}(M)).prototype,"hint",[VP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vx=st(VF.prototype,"thunder",[VO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vz=st(VF.prototype,"storm",[VB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VG=st(VF.prototype,"pliers",[VN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VV=st(VF.prototype,"particles",[VM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),VD=VF))||VD);_._RF.pop(),_._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var K_,Kk=k.ccclass,KC=k.property,KA=k.requireComponent,KT=GameCore,KR=KT.Events,KI=KT.Utils.Valid,KL=globalThis.game,KP=KL.event,KO=KL.player,KB="Coin Container";Vj=Kk("LevelCompleteScreen"),VX=KA(xj),VY=KC(L),VJ=KC(L),VQ=KC(eu),VZ=KC(KE),V$=KC({type:L,group:"Play Button"}),V0=KC({type:B,group:"Play Button"}),V1=KC({type:C,group:"Play Button"}),V2=KC({type:eu,group:"Play Button"}),V4=KC({type:C,group:"Play Button"}),V3=KC({type:C,group:"Play Button"}),V5=KC({type:G,group:KB}),V6=KC({type:k3,group:KB}),V8=KC({type:G,group:KB}),V9=KC({type:ei,group:KB}),V7=KC({type:ei,group:KB}),Kt=KC(ya),Vj(Kn=VX((Kr=st((Ki=function(g){ze(c,g);var E,_,k,C,A,T,R,I,L=Xe(c);function c(){var g;Fe(this,c);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=L.call.apply(L,[this].concat(_))).level=1,g.coins=40,g.currentCoins=0,g.score=0,g.playAnimation=!1,g.getRewardsSuccess=!1,g.lookingForRewards=!1,g.playButtonSignal=new nN,rt(g,"coinText",Kr,Ke(g)),rt(g,"scoreText",Ka,Ke(g)),rt(g,"lookingForRewardsText",Ko,Ke(g)),rt(g,"getRewardsEffect",Ks,Ke(g)),rt(g,"playButtonLabel",Kl,Ke(g)),rt(g,"playButton",Ku,Ke(g)),rt(g,"playBackground",Kc,Ke(g)),rt(g,"shineBackground",Kh,Ke(g)),rt(g,"hardLevelBackground",Kp,Ke(g)),rt(g,"playButtonContainer",Kd,Ke(g)),rt(g,"coinAnimation",Kf,Ke(g)),rt(g,"coinContainer",Ky,Ke(g)),rt(g,"coinContainerAnimation",Kv,Ke(g)),rt(g,"coinContainerEnterClip",Kg,Ke(g)),rt(g,"coinContainerExitClip",Km,Ke(g)),rt(g,"particles",Kb,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StarChestScreen: screen not found");g.validateEventPayload(E)&&(g.playButton.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g.handleParticleEnd=Be(function(){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=g.level;if(!E)return[3,2];return[4,tZ.waitTweenAsync(.15)];case 1:E=_.sent();_.label=2;case 2:return[4,Promise.all([g.animateCoin(),g.animateScore()])];case 3:_.sent();if(!g.lookingForRewards)return[3,5];return[4,g.handleLookingForRewards()];case 4:_.sent();return[3,7];case 5:return[4,g.animateVisiblePlayButton(!0)];case 6:_.sent();_.label=7;case 7:return[2]}})}),g}return Ue(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){KP.on(KR.OPENING_SCREEN,this.handleOpeningScreen),KP.on(KR.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){KP.off(KR.OPENING_SCREEN,this.handleOpeningScreen),KP.off(KR.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){var E=null!=g?g:{},_=E.screenName,k=E.screenData;return _===this.node.name&&!!KI.isObject(k)&&(KI.isNumber(k.level)&&(this.level=k.level,this.coins=this.level<5?sO:sB),KI.isNumber(k.coins)&&(this.currentCoins=k.coins),KI.isNumber(k.score)&&(this.score=k.score),this.playAnimation=!1,KI.isObject(k.overrideAnimation)&&(this.playAnimation="LevelCompleteOpenScreen"===k.overrideAnimation.openScreen),this.lookingForRewards=!1,KI.isBoolean(k.lookingForRewards)&&(this.lookingForRewards=k.lookingForRewards),this.getRewardsSuccess=!1,KI.isBoolean(k.getRewardsSuccess)&&(this.getRewardsSuccess=k.getRewardsSuccess),!0)}},{key:"open",value:function(){this.updateStatus(),this.node.scene.emit(r0.HIDE_UI),this.tryPlayAnimation()}},{key:"close",value:(I=Be(function(){var g,E,_,k;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:E=C.length>0&&void 0!==C[0]&&C[0],_=at(this.particles);try{for(_.s();!(g=_.n()).done;){k=g.value;k.stop()}}catch(g){_.e(g)}finally{_.f()}return[4,tZ.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name)];case 1:A.sent(),KP.emit(KR.CLOSE_SCREEN,{screenName:this.node.name,screenData:{canShowRewardsAd:E}}),this.node.scene.emit(r0.ABORT_COIN_ANIMATION);return[2]}})}),function(){return I.apply(this,arguments)})},{key:"updateStatus",value:function(){this.updateCoinContainer(),this.updatePlayButton(),this.lookingForRewardsText.opacity=0}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoins})}},{key:"updatePlayButton",value:function(){var g=KO.getGameData();if(g){var E=(this.level+1>g.totalLevel?this.level:this.level+1)%5==0;this.playBackground.active=!E,this.hardLevelBackground.active=E}}},{key:"tryPlayAnimation",value:function(){if(this.playAnimation){this.screen.setScreenOpacity(255),this.coinText.string="x0",this.scoreText.string="0",this.animateVisiblePlayButton(!1,!1);var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}var _=this.screen.getComponent(G);_?_.once(G.EventType.FINISHED,this.handleParticleEnd):this.handleParticleEnd()}else{if(this.animateVisiblePlayButton(!0,!1),!this.getRewardsSuccess)return;this.getRewardsEffect.playAnimation(["storm","thunder"],this.animateCollectItemPlayButton.bind(this))}}},{key:"handleLookingForRewards",value:(R=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.animateLookingForRewards()];case 1:g.sent(),vc.canShowRewardedInterstitialAd()?this.close(!0):this.animateVisiblePlayButton(!0);return[2]}})}),function(){return R.apply(this,arguments)})},{key:"animateCoin",value:(T=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;if(!this.screen.container)return[3,3];this.coinAnimation.play();return[4,tZ.runOnUpdateAsync(this.node,.8,function(E){var _=eP(0,g.coins,E),k=Math.floor(_);g.coinText.string="x".concat(k)})];case 1:E.sent();return[4,this.animateCoinCollection()];case 2:E.sent(),this.coinText.string="x".concat(this.coins);return[3,4];case 3:console.warn("LevelCompleteScreen: screen not found");E.label=4;case 4:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"animateScore",value:(A=Be(function(){var g;return _ts_generator(this,function(E){g=this;tZ.runOnUpdateAsync(this.scoreText.node,.8,function(E){var _=eP(0,g.score,E);g.scoreText.string="".concat(Math.floor(_))}),this.scoreText.node.setScale(1,1,1),this.scoreText.string="".concat(this.score);return[2]})}),function(){return A.apply(this,arguments)})},{key:"animateCoinCollection",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,tZ.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name)];case 1:g.sent(),this.node.scene.emit(r0.ADD_COINS,{coins:this.coins,collectionAnimation:{floatDuration:.5,flyDuration:.5,animateTextOnly:!1,target:this.coinContainer}});return[2]}})}),function(){return C.apply(this,arguments)})},{key:"animateLookingForRewards",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=z(this.lookingForRewardsText);g.to(.25,{opacity:255},{easing:"linear"}).delay(.25),g.to(.25,{opacity:100},{easing:"linear"}).delay(.125);return[4,tZ.runTweenAsync(z(this.lookingForRewardsText).repeat(2,g).to(.25,{opacity:0},{easing:"linear"}))];case 1:E.sent(),this.lookingForRewardsText.opacity=0;return[2]}})}),function(){return k.apply(this,arguments)})},{key:"animateVisiblePlayButton",value:(_=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:E=!(T.length>1&&void 0!==T[1])||T[1],_=g?1:0;if(!E)return[3,2];this.playButtonSignal.abort();k=new nN;this.playButtonSignal=k;C=g?0:1;this.playButtonContainer.setScale(C,C,this.playButtonContainer.scale.z);A=z(this.playButtonContainer).to(.5,{scale:new em(_,_,1)},{easing:"backOut"});g||(this.playButton.interactable=!1);return[4,tZ.runTweenAsync(A,k)];case 1:R.sent(),g&&(this.playButton.interactable=!0);return[3,3];case 2:this.playButton.interactable=g,this.playButtonContainer.setScale(_,_,this.playButtonContainer.scale.z);R.label=3;case 3:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"animateCollectItemPlayButton",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.playButtonSignal.abort();g=new nN;this.playButtonSignal=g;E=z(this.playButtonContainer).to(.08,{scale:new em(.95,1.05,1)}).to(.08,{scale:new em(1.05,.95,1)}).to(.08,{scale:new em(1,1,1)}),_=z(this.shineBackground).to(.08,{opacity:50},{easing:"quadOut"}).to(.08,{opacity:0},{easing:"quadIn"});return[4,Promise.all([tZ.runTweenAsync(E,g),tZ.runTweenAsync(_,g)])];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleClickedPlay",value:function(){this.playButton.interactable=!1,this.close()}}]),c}(M)).prototype,"coinText",[VY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ka=st(Ki.prototype,"scoreText",[VJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ko=st(Ki.prototype,"lookingForRewardsText",[VQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ks=st(Ki.prototype,"getRewardsEffect",[VZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kl=st(Ki.prototype,"playButtonLabel",[V$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=st(Ki.prototype,"playButton",[V0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kc=st(Ki.prototype,"playBackground",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kh=st(Ki.prototype,"shineBackground",[V2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kp=st(Ki.prototype,"hardLevelBackground",[V4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kd=st(Ki.prototype,"playButtonContainer",[V3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kf=st(Ki.prototype,"coinAnimation",[V5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ky=st(Ki.prototype,"coinContainer",[V6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kv=st(Ki.prototype,"coinContainerAnimation",[V8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kg=st(Ki.prototype,"coinContainerEnterClip",[V9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Km=st(Ki.prototype,"coinContainerExitClip",[V7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kb=st(Ki.prototype,"particles",[Kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kn=Ki))||Kn);_._RF.pop(),_._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var KN,KM,KD,KF,KU,Kx,Kz,KG,KV=k.ccclass,KK=k.disallowMultiple,KH=k.requireComponent,Kq=GameCore.Events,KW=globalThis.game.event;KV("LoadingScreen")(K_=KK(K_=KH(xj)(K_=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleOpeningScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g.handleClosingScreen=function(E){g.validateEventPayload(E)&&g.unscheduleAllCallbacks()},g.handleClosedScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!1)},g.handleOnCloseScreen=function(){l1.closeScreen(ib[g.node.name])},g}return Ue(n,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){KW.on(Kq.OPENING_SCREEN,this.handleOpeningScreen),KW.on(Kq.OPENED_SCREEN,this.handleOpenedScreen),KW.on(Kq.CLOSING_SCREEN,this.handleClosingScreen),KW.on(Kq.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){KW.off(Kq.OPENING_SCREEN,this.handleOpeningScreen),KW.off(Kq.OPENED_SCREEN,this.handleOpenedScreen),KW.off(Kq.CLOSING_SCREEN,this.handleClosingScreen),KW.off(Kq.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var g=this.screen.data.duration;g&&g>0&&this.scheduleOnce(this.handleOnCloseScreen,g)}}}]),n}(M))||K_)||K_);_._RF.pop(),_._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var Kj,KX,KY,KJ,KQ,KZ,K$,K0,K1,K2,K4,K3,K5,K6,K8,K9,K7=k.ccclass,Ht=k.disallowMultiple,Hn=k.requireComponent,Hi=k.property,Hr=GameCore,Ha=Hr.Events,Ho=Hr.Utils.Valid,Hs=globalThis.game.event;KN=K7("NotificationScreen"),KM=Hn(xj),KD=Hi(L),KF=Hi(B),KN(KU=Ht(KU=KM((Kz=st((Kx=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"message",Kz,Ke(g)),rt(g,"touchZone",KG,Ke(g)),g.enableCloseOnTouch=!0,g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.updateScreenData(E)},g.handleClosingScreen=function(E){g.validateEventPayload(E)&&g.unscheduleAllCallbacks()},g}return Ue(n,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Hs.on(Ha.OPENING_SCREEN,this.handleOpeningScreen),Hs.on(Ha.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){Hs.off(Ha.OPENING_SCREEN,this.handleOpeningScreen),Hs.off(Ha.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"updateScreenData",value:function(g){var E=this,_=g.screenData;Ho.isObject(_)?(_.message&&(this.message.string=_.message),_.duration&&_.duration>0&&this.scheduleOnce(function(){l1.closeScreen(ib[E.node.name])},_.duration),!1===_.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),l1.closeScreen(ib[this.node.name])}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),n}(M)).prototype,"message",[KD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KG=st(Kx.prototype,"touchZone",[KF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KU=Kx))||KU)||KU);_._RF.pop(),_._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var Hl,Hu,Hc,Hp,Hd,Hf,Hy,Hv,Hg,Hm,Hb,Hw,HS,HE,H_,Hk,HC,HA,HT,HR,HI,HL,HP=k.ccclass,HO=k.property,HB=k.requireComponent,HN=GameCore,HM=HN.Events,HD=HN.Match.Modes,HF=globalThis.game,HU=HF.event,Hx=HF.storage;Kj=HP("QuitLevelScreen"),KX=HB(xj),KY=HO(L),KJ=HO(L),KQ=HO(B),KZ=HO(L),K$=HO(L),K0=HO(B),Kj(K1=KX((K4=st((K2=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"singleDescription",K4,Ke(g)),rt(g,"tournamentDescription",K3,Ke(g)),rt(g,"quitButton",K5,Ke(g)),rt(g,"quitLabel",K6,Ke(g)),rt(g,"endLabel",K8,Ke(g)),rt(g,"continueButton",K9,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){HU.on(HM.OPENING_SCREEN,this.handleOpeningScreen),HU.on(HM.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){HU.off(HM.OPENING_SCREEN,this.handleOpeningScreen),HU.off(HM.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(r0.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),l1.closeScreen(ib[this.node.name]),this.node.scene.emit(r0.SHOW_UI),this.node.scene.emit(r0.GAME_RESUME)}},{key:"updateStatus",value:function(){var g=l_.getMatchMode()===HD.TOURNAMENT;this.singleDescription.node.active=!g,this.tournamentDescription.node.active=g,this.quitLabel.node.active=!g,this.endLabel.node.active=g}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.quitButton.interactable=g,this.continueButton.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"handleClickedContinue",value:function(){this.close()}},{key:"handleClickedQuit",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.setInteractableButtons(!1),l_.getMatchMode()!==HD.TOURNAMENT)return[3,2];E=(null!==(g=l_.getMatchCustomData())&&void 0!==g?g:{}).score,_=(void 0===E?0:E)>Hx.getStorageData("tournament","previousScore");Hx.setStorageData("tournament","animateTournamentLeader",_);return[4,l_.finishMatchAsync()];case 1:k.sent();k.label=2;case 2:this.node.scene.emit(r0.GAME_EXIT);return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"singleDescription",[KY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K3=st(K2.prototype,"tournamentDescription",[KJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K5=st(K2.prototype,"quitButton",[KQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K6=st(K2.prototype,"quitLabel",[KZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K8=st(K2.prototype,"endLabel",[K$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K9=st(K2.prototype,"continueButton",[K0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K1=K2))||K1);_._RF.pop(),_._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var Hz,HG,HV,HK,HH,Hq,HW,Hj,HX,HY,HJ,HQ,HZ,H$,H0,H1,H2,H4,H3,H5,H6,H8,H9,H7,qt,qn,qi=k.ccclass,qr=k.property,qa=k.disallowMultiple,qo=k.requireComponent,qs=GameCore.Events,ql=globalThis.game,qu=ql.event,qc=ql.player;Hl=qi("RescuesScreen"),Hu=qo(xj),Hc=qr(eu),Hp=qr([C]),Hd=qr(L),Hf=qr(L),Hy=qr(C),Hv=qr(C),Hg=qr(G),Hm=qr(C),Hb=qr(C),Hl(Hw=qa(Hw=Hu((HE=st((HS=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"adOpacity",HE,Ke(g)),rt(g,"animNodes",H_,Ke(g)),rt(g,"titleLabel",Hk,Ke(g)),rt(g,"descriptionLabel",HC,Ke(g)),rt(g,"timer",HA,Ke(g)),rt(g,"bomb",HT,Ke(g)),rt(g,"bombAnim",HR,Ke(g)),rt(g,"replayButton",HI,Ke(g)),rt(g,"buyTimeButton",HL,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("RescuesScreen: screen not found");g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){qu.on(qs.OPENING_SCREEN,this.handleOpeningScreen),qu.on(qs.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){qu.off(qs.OPENING_SCREEN,this.handleOpeningScreen),qu.off(qs.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:i5.turnOffMusic();return[4,this.resetState()];case 1:g.sent(),this.runOpenAnimation(),this.node.scene.emit(r0.HIDE_UI);return[2]}})}),function(){return A.apply(this,arguments)})},{key:"close",value:function(){i5.turnUpMusic(),qu.emit(qs.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(C=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){E=(null===(g=this.payload.screenData)||void 0===g?void 0:g.failKey)===ur;this.titleLabel.string=E?"Boom!":"Time's Up!",this.descriptionLabel.string=E?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!E,this.bomb.active=E,E&&this.bombAnim.play();_=qc.getGameData();if(_){k=_.coins>=sD;this.replayButton.active=!k,this.buyTimeButton.active=k,this.adOpacity.opacity=0}return[2]})}),function(){return C.apply(this,arguments)})},{key:"runOpenAnimation",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;if(!this.screen.container)return[3,3];return[4,Promise.all(this.animNodes.map(function(E,_){g.runAppearTween(E,.1*_)}))];case 1:E.sent();return[4,this.runShowAdContainer()];case 2:E.sent();return[3,4];case 3:console.warn("TimeUpScreen: screen not found");E.label=4;case 4:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"runAppearTween",value:(_=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,tZ.runTweenAsync(z(g).set({scale:new em(0,0,0)}).delay(E).to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*tZ.elasticOut(k,.1,.45)}}))];case 1:_.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var g=z(this.adOpacity);return g.delay(1),g.to(.5,{opacity:255}),tZ.runTweenAsync(g)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit(r0.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit(r0.REMOVE_COINS,{coins:sD,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,vc.showRewardVideoAdAsync({})];case 1:g.sent()&&this.startRescue();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit(r0.SHOW_UI),this.node.scene.emit(r0.RESCUE_START),this.close()}}]),s}(M)).prototype,"adOpacity",[Hc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H_=st(HS.prototype,"animNodes",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Hk=st(HS.prototype,"titleLabel",[Hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HC=st(HS.prototype,"descriptionLabel",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HA=st(HS.prototype,"timer",[Hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HT=st(HS.prototype,"bomb",[Hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HR=st(HS.prototype,"bombAnim",[Hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HI=st(HS.prototype,"replayButton",[Hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HL=st(HS.prototype,"buyTimeButton",[Hb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hw=HS))||Hw)||Hw);_._RF.pop(),_._RF.push({},"726c9oCUUBDpboDnHRz7SGZ","PauseScreen",void 0);var qp,qd,qf,qy,qv,qg,qm,qb,qw,qS,qE,q_,qk,qC,qA,qT,qR,qI,qL,qP,qO,qB,qN,qM,qD,qF,qU=k.ccclass,qx=k.property,qz=k.requireComponent,qG=GameCore,qV=qG.Events,qK=qG.Utils.Device,qH=qG.Match.Modes,qq=globalThis.game,qW=qq.player,qj=qq.event;Hz=qU("PauseScreen"),HG=qz(xj),HV=qx(C),HK=qx(C),HH=qx(C),Hq=qx(OI),HW=qx(OI),Hj=qx(OI),HX=qx(B),HY=qx(B),HJ=qx(B),HQ=qx(B),HZ=qx(C),Hz(H$=HG((H1=st((H0=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"musicSetting",H1,Ke(g)),rt(g,"soundSetting",H2,Ke(g)),rt(g,"vibrateSetting",H4,Ke(g)),rt(g,"musicSwitch",H3,Ke(g)),rt(g,"soundSwitch",H5,Ke(g)),rt(g,"vibrateSwitch",H6,Ke(g)),rt(g,"closeButtonComponent",H8,Ke(g)),rt(g,"continueButtonComponent",H9,Ke(g)),rt(g,"restartButtonComponent",H7,Ke(g)),rt(g,"challengeFriendsButtonComponent",qt,Ke(g)),rt(g,"animNodes",qn,Ke(g)),g.triggerSequence="",g.handleOpeningScreen=function(E){g.validateSwitchScreenPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateSwitchScreenPayload(E)&&g.open()},g.handleResetSequence=function(){g.triggerSequence=""},g.handleTriggerUnlockKey=function(E){if("code"in E){var _=E.code,k=sG.UNLOCK_SEQUENCE;"number"==typeof _&&-1!==k.indexOf(_.toString())&&(g.triggerSequence+=_.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",_,g.triggerSequence,g.triggerSequence===k),g.triggerSequence===k&&(g.node.scene.emit(sG.Events.UNLOCK_DEV_TOOLS),g.node.off(sG.Events.TRIGGER_UNLOCK_KEY)))}},g.updateVibrateButton=function(){var E=g.vibrateSetting.getComponentInChildren(B),_=g.vibrateSetting.getComponentInChildren(OI),k=g.vibrateSetting.getComponentInChildren(rh);if(E&&_&&k){if(qK.isMobile()){var C,A=null!==(C=qW.getPlayerSetting("vibrate"))&&void 0!==C&&C;_.setEnabled(A)}else E.interactable=!1,_.setEnabled(!1),k.changeState(!1)}else console.warn("SettingsScreen: vibrate button missing components")},g}return Ue(a,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){qj.on(qV.OPENING_SCREEN,this.handleOpeningScreen),qj.on(qV.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){qj.off(qV.OPENING_SCREEN,this.handleOpeningScreen),qj.off(qV.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(g){return g.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(sG.Events.TRIGGER_UNLOCK_KEY),this.node.on(sG.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(sG.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(sG.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(sG.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(sG.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(r0.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(sG.Events.TRIGGER_RESET_SEQUENCE),l1.closeScreen(ib[this.node.name])}},{key:"updateStatus",value:function(){var g,E,_,k={music:null!==(g=qW.getPlayerSetting("music"))&&void 0!==g&&g,sound:null!==(E=qW.getPlayerSetting("sound"))&&void 0!==E&&E,vibrate:null!==(_=qW.getPlayerSetting("vibrate"))&&void 0!==_&&_};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(k.music),this.soundSwitch.setEnabled(k.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var g=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(E,_){g.runAppearTween(E,.1*_)})}},{key:"runAppearTween",value:function(g,E){var _=z(g);_.set({scale:new em(0,0,0)}),_.delay(E),_.to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*tZ.elasticOut(k,.1,.45)}}),_.start()}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.continueButtonComponent.interactable=g,this.restartButtonComponent.interactable=g,this.challengeFriendsButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var g=this.musicSwitch.switch();if(qW.setSetting("music",g),this.node.emit(sG.Events.TRIGGER_UNLOCK_KEY,{code:g?1:0}),g){var E=l_.getMatchMode();i5.playMusic(E===qH.TOURNAMENT?ic.TOURNAMENT_MUSIC:ic.BG_MUSIC)}else i5.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var g=this.soundSwitch.switch();qW.setSetting("sound",g),this.node.emit(sG.Events.TRIGGER_UNLOCK_KEY,{code:g?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var g=this.vibrateSwitch.switch();qW.setSetting("vibrate",g)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:this.close();E=(null!==(g=qW.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;k=vc.canShowInterstitialAd();if(!k)return[3,2];return[4,vc.showInterstitialAdAsync({forLevel:_})];case 1:k=C.sent();C.label=2;case 2:l_.getMatchMode()!==qH.TOURNAMENT?(this.node.scene.emit(r0.GAME_RESUME),this.node.scene.emit(r0.GAME_REPLAY,{level:_})):l1.openScreen(ig.START_OVER_SCREEN);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleClickedChallengeFriends",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if("MsGames"!==GameSDK.getSDKName())return[3,2];l1.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 1:return[2,(g.sent(),void l1.closeLoadingScreen())];case 2:this.close(),this.node.scene.emit(r0.INVITE_FRIENDS);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(r0.GAME_RESUME),this.node.scene.emit(r0.SHOW_UI)}}]),a}(M)).prototype,"musicSetting",[HV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H2=st(H0.prototype,"soundSetting",[HK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H4=st(H0.prototype,"vibrateSetting",[HH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H3=st(H0.prototype,"musicSwitch",[Hq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H5=st(H0.prototype,"soundSwitch",[HW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H6=st(H0.prototype,"vibrateSwitch",[Hj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H8=st(H0.prototype,"closeButtonComponent",[HX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H9=st(H0.prototype,"continueButtonComponent",[HY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H7=st(H0.prototype,"restartButtonComponent",[HJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qt=st(H0.prototype,"challengeFriendsButtonComponent",[HQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qn=st(H0.prototype,"animNodes",[HZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),H$=H0))||H$);_._RF.pop(),_._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var qX,qY,qJ,qQ,qZ,q$,q0,q1,q2,q4,q3,q5,q6,q8,q9,q7,Wt,Wn,Wi,Wr,Wa,Wo,Ws,Wl=k.ccclass,Wu=k.property,Wc=k.requireComponent,Wp=GameCore,Wd=Wp.Events,Wf=Wp.Utils.Device,Wy=Wp.Match.Modes,Wv=Wp.Configs.Debugger.MonitorError,Wg=globalThis.game,Wm=Wg.player,Wb=Wg.event,Ww=Wg.monitorError;qp=Wl("SettingsScreen"),qd=Wc(xj),qf=Wu(C),qy=Wu(C),qv=Wu(C),qg=Wu(OI),qm=Wu(OI),qb=Wu(OI),qw=Wu(B),qS=Wu(B),qE=Wu(B),q_=Wu(B),qk=Wu(C),qp(qC=qd((qT=st((qA=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"musicSetting",qT,Ke(g)),rt(g,"soundSetting",qR,Ke(g)),rt(g,"vibrateSetting",qI,Ke(g)),rt(g,"musicSwitch",qL,Ke(g)),rt(g,"soundSwitch",qP,Ke(g)),rt(g,"vibrateSwitch",qO,Ke(g)),rt(g,"closeButtonComponent",qB,Ke(g)),rt(g,"reportButtonComponent",qN,Ke(g)),rt(g,"shareButtonComponent",qM,Ke(g)),rt(g,"inviteFriendsButtonComponent",qD,Ke(g)),rt(g,"animNodes",qF,Ke(g)),g.triggerSequence="",g.handleOpeningScreen=function(E){g.validateSwitchScreenPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateSwitchScreenPayload(E)&&g.open()},g.handleResetSequence=function(){g.triggerSequence=""},g.handleTriggerUnlockKey=function(E){if("code"in E){var _=E.code,k=sG.UNLOCK_SEQUENCE;"number"==typeof _&&-1!==k.indexOf(_.toString())&&(g.triggerSequence+=_.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",_,g.triggerSequence,g.triggerSequence===k),g.triggerSequence===k&&(g.node.scene.emit(sG.Events.UNLOCK_DEV_TOOLS),g.node.off(sG.Events.TRIGGER_UNLOCK_KEY)))}},g.updateVibrateButton=function(){var E=g.vibrateSetting.getComponentInChildren(B),_=g.vibrateSetting.getComponentInChildren(OI),k=g.vibrateSetting.getComponentInChildren(rh);if(E&&_&&k){if(Wf.isMobile()){var C,A=null!==(C=Wm.getPlayerSetting("vibrate"))&&void 0!==C&&C;_.setEnabled(A)}else E.interactable=!1,_.setEnabled(!1),k.changeState(!1)}else console.warn("SettingsScreen: vibrate button missing components")},g}return Ue(a,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools(),this.reportButtonComponent.node.parent.active=Wv.Feedback}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Wb.on(Wd.OPENING_SCREEN,this.handleOpeningScreen),Wb.on(Wd.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Wb.off(Wd.OPENING_SCREEN,this.handleOpeningScreen),Wb.off(Wd.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(g){return g.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(sG.Events.TRIGGER_UNLOCK_KEY),this.node.on(sG.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(sG.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(sG.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(sG.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(sG.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(r0.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(sG.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(r0.SHOW_UI),l1.closeScreen(ib[this.node.name])}},{key:"updateStatus",value:function(){var g,E,_,k={music:null!==(g=Wm.getPlayerSetting("music"))&&void 0!==g&&g,sound:null!==(E=Wm.getPlayerSetting("sound"))&&void 0!==E&&E,vibrate:null!==(_=Wm.getPlayerSetting("vibrate"))&&void 0!==_&&_};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(k.music),this.soundSwitch.setEnabled(k.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var g=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(E,_){("ReportButton"!==E.name||Wv.Feedback)&&g.runAppearTween(E,.1*_)})}},{key:"runAppearTween",value:function(g,E){var _=z(g);_.set({scale:new em(0,0,0)}),_.delay(E),_.to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*tZ.elasticOut(k,.1,.45)}}),_.start()}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.reportButtonComponent.interactable=g,this.shareButtonComponent.interactable=g,this.inviteFriendsButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var g=this.musicSwitch.switch();if(Wm.setSetting("music",g),this.node.emit(sG.Events.TRIGGER_UNLOCK_KEY,{code:g?1:0}),g){var E=l_.getMatchMode();i5.playMusic(E===Wy.TOURNAMENT?ic.TOURNAMENT_MUSIC:ic.BG_MUSIC)}else i5.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var g=this.soundSwitch.switch();Wm.setSetting("sound",g),this.node.emit(sG.Events.TRIGGER_UNLOCK_KEY,{code:g?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var g=this.vibrateSwitch.switch();Wm.setSetting("vibrate",g)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedClose",value:function(){this.close()}},{key:"handleClickedReport",value:function(){null==Ww||Ww.feedbackAsync()}},{key:"handleClickedShare",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if("FacebookInstant"!==GameSDK.getSDKName())return[3,2];l1.showLoadingScreen();return[4,GameSDK.extra.shareBestScoreAsync()];case 1:return[2,(g.sent(),void l1.closeLoadingScreen())];case 2:this.close();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleClickedInviteFriends",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=GameSDK.getSDKName();switch(g){case"MsGames":return[3,1];case"FacebookInstant":return[3,3]}return[3,5];case 1:l1.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 2:E.sent(),l1.closeLoadingScreen();return[3,6];case 3:l1.showLoadingScreen();return[4,GameSDK.extra.inviteWithBestScoreAsync()];case 4:E.sent(),l1.closeLoadingScreen();return[3,6];case 5:this.close();E.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(M)).prototype,"musicSetting",[qf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qR=st(qA.prototype,"soundSetting",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qI=st(qA.prototype,"vibrateSetting",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qL=st(qA.prototype,"musicSwitch",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qP=st(qA.prototype,"soundSwitch",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qO=st(qA.prototype,"vibrateSwitch",[qb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qB=st(qA.prototype,"closeButtonComponent",[qw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qN=st(qA.prototype,"reportButtonComponent",[qS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qM=st(qA.prototype,"shareButtonComponent",[qE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qD=st(qA.prototype,"inviteFriendsButtonComponent",[q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qF=st(qA.prototype,"animNodes",[qk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qC=qA))||qC);_._RF.pop(),_._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var WS,WE,W_,Wk,WC,WA,WT,WR,WI,WL,WP,WO,WB,WN,WM,WD,WF,WU,Wx,Wz,WG=k.ccclass,WV=k.property,WK=(qX=WG("StarChest"),qY=WV(eo),qJ=WV(eu),qQ=WV(eV),qZ=WV(eu),q$=WV(eu),q0=WV({type:K,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),q1=WV({type:K,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),q2=WV({type:K,displayName:"Centered Offset X",group:"Reward Animations"}),q4=WV({type:K,displayName:"Centered Offset Y",group:"Reward Animations"}),q3=WV({type:K,min:0,displayName:"Starting Scale",group:"Reward Animations"}),q5=WV({type:K,min:0,displayName:"Ending Scale",group:"Reward Animations"}),qX((q9=st((q8=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"sprite",q9,Ke(g)),rt(g,"glowOpacity",q7,Ke(g)),rt(g,"explosionParticles",Wt,Ke(g)),rt(g,"circle",Wn,Ke(g)),rt(g,"uiOpacity",Wi,Ke(g)),g.ogCenterX=0,g.ogCenterY=0,rt(g,"endingOffsetX",Wr,Ke(g)),rt(g,"endingOffsetY",Wa,Ke(g)),rt(g,"startingScale",Wo,Ke(g)),rt(g,"endingScale",Ws,Ke(g)),g}return Ue(s,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"moveToCenter",value:(A=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=new em(this.endingOffsetX,this.endingOffsetY,this.node.position.z);return[4,tZ.runTweenAsync(z(this.node).to(.7,{position:E},{easing:"quintInOut"}),g)];case 1:_.sent(),this.node.position=E;return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new em(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(C=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this.startingScale+(this.endingScale-this.startingScale)*g,k=new em(_,_,_);return[4,Promise.all([tZ.runTweenAsync(z(this.sprite.node).to(.2,{scale:k},{easing:"backOut"}),E),tZ.runTweenAsync(z(this.glowOpacity.node).to(.2,{scale:k},{easing:"backOut"}),E)])];case 1:C.sent(),this.sprite.node.setScale(k),this.glowOpacity.node.setScale(k);return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"startShaking",value:function(){var g=this,E=this.node.position.clone();this.shakingTween={ogPos:E,tw:z(this.node).to(.1,{},{onUpdate:function(_,k){if(k){var C=E.x+10*(k-.5);g.node.position=new em(C,E.y,E.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this.sprite.node.scale.clone().multiplyScalar(1.1);return[4,Promise.all([tZ.runTweenAsync(z(this.sprite.node).to(.2,{scale:E},{easing:"cubicInOut"}),g),tZ.runTweenAsync(z(this.glowOpacity.node).to(.2,{scale:E}),g),tZ.runTweenAsync(z(this.glowOpacity).to(.5,{opacity:255}),g)])];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"explode",value:(_=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=new em(8,8,8),k=function(){var k=Be(function(){return _ts_generator(this,function(k){switch(k.label){case 0:E.circle.opacity=255,E.circle.node.setScale(em.ZERO);return[4,Promise.all([tZ.runTweenAsync(z(E.circle).to(.3,{opacity:0}),g),tZ.runTweenAsync(z(E.circle.node).to(.3,{scale:_},{easing:"cubicOut"}),g)])];case 1:k.sent(),E.circle.opacity=0,E.circle.node.scale=_;return[2]}})});return function(){return k.apply(this,arguments)}}(),C=function(){var _=Be(function(){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Promise.all([tZ.runTweenAsync(z(E.glowOpacity.node).to(.3,{scale:em.ZERO},{easing:"cubicOut"}),g),tZ.runTweenAsync(z(E.sprite.node).to(.3,{scale:em.ZERO},{easing:"cubicOut"}),g)])];case 1:_.sent(),E.sprite.node.setScale(em.ZERO),E.glowOpacity.node.setScale(em.ZERO);return[2]}})});return function(){return _.apply(this,arguments)}}();return[4,Promise.all([this.explodeParticles(g),k(),C()])];case 1:A.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"explodeParticles",value:(E=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=g.aborted;if(E)return[3,2];this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem();return[4,tZ.waitTweenAsync(1)];case 1:E=(_.sent(),this.explosionParticles.node.active=!1);_.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),s}(M)).prototype,"sprite",[qY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q7=st(q8.prototype,"glowOpacity",[qJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wt=st(q8.prototype,"explosionParticles",[qQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wn=st(q8.prototype,"circle",[qZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wi=st(q8.prototype,"uiOpacity",[q$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(q8.prototype,"startingOffsetX",[q0],Object.getOwnPropertyDescriptor(q8.prototype,"startingOffsetX"),q8.prototype),st(q8.prototype,"startingOffsetY",[q1],Object.getOwnPropertyDescriptor(q8.prototype,"startingOffsetY"),q8.prototype),Wr=st(q8.prototype,"endingOffsetX",[q2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wa=st(q8.prototype,"endingOffsetY",[q4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wo=st(q8.prototype,"startingScale",[q3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Ws=st(q8.prototype,"endingScale",[q5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),q6=q8))||q6);_._RF.pop(),_._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var WH,Wq,WW,Wj,WX,WY,WJ,WQ,WZ,W$,W0,W1,W2,W4,W3=k.ccclass,W5=k.property,W6=k.requireComponent,W8=GameCore.Events,W9=globalThis.game,W7=W9.event,jt=W9.player;WS=W3("StarChestScreen"),WE=W6(xj),W_=W5(RK),Wk=W5(B),WC=W5(B),WA=W5(G),WT=W5(WK),WR=W5(eu),WI=W5(kU),WL=W5(L),WS(WP=WE((WB=st((WO=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"starProgressBar",WB,Ke(g)),rt(g,"openButton",WN,Ke(g)),rt(g,"continueButton",WM,Ke(g)),rt(g,"chestAnimation",WD,Ke(g)),rt(g,"starChest",WF,Ke(g)),rt(g,"chestUnlockFXMask",WU,Ke(g)),rt(g,"skipOverlay",Wx,Ke(g)),rt(g,"messageLabel",Wz,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StarChestScreen: screen not found");g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){W7.on(W8.OPENING_SCREEN,this.handleOpeningScreen),W7.on(W8.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){W7.off(W8.OPENING_SCREEN,this.handleOpeningScreen),W7.off(W8.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(r0.HIDE_UI);var g=jt.getGameData();if(g){var E=g.stars;this.numChestAvailable=Math.floor(E/20),this.starProgressBar.setRange(E,20);var _=this.numChestAvailable>0;this.setInteractableButtons(!0),this.openButton.node.active=_,this.openButton.interactable=_,this.continueButton.node.active=!_,this.continueButton.interactable=!_,this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){W7.emit(W8.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(r0.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(C=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!(0!==this.numChestAvailable))return[3,5];i5.turnDownMusic();g=jt.getGameData();if(!g)return[3,4];this.setInteractableButtons(!1);E=g.stars;jt.setGameData({stars:g.stars-20*this.numChestAvailable});_=new nN;return[4,this.skipOverlay.open({opacity:200,onSkip:function(){return _.abort()}})];case 1:k.sent();return[4,this.handleUnlockAnimation(E,g.stars,_)];case 2:k.sent();return[4,this.skipOverlay.close()];case 3:k.sent(),i5.turnUpMusic(),Q.emit(nT),this.close();k.label=4;case 4:return[3,6];case 5:this.close();k.label=6;case 6:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(k=Be(function(g,E,_){var k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:k=this;return[4,Promise.all([this.starChest.moveToCenter(_),this.fadeInChestUnlockFX(_)])];case 1:R.sent(),this.chestAnimation.stop(),this.starChest.startShaking();return[4,i5.playSound(ic.STAR_CHEST_DRUM_ROLL,{loop:!0})];case 2:R.sent();return[4,tZ.waitTweenAsync(0)];case 3:R.sent();C=g,A=this.numChestAvailable;return[4,Promise.all([this.starProgressBar.animateTo(E,_,function(g){var E;C-g>=20&&(C=g,A--,k.starChest.scale((E=A,k.numChestAvailable>2?1-E/k.numChestAvailable:.35*(1-E/k.numChestAvailable)),_),i5.playSound(ic.STAR_CHEST_OPEN))})])];case 4:R.sent();return[4,tZ.waitTweenAsync(1,_)];case 5:R.sent(),this.starChest.stopShaking();return[4,this.starChest.glow(_)];case 6:R.sent(),i5.stopSound(ic.STAR_CHEST_DRUM_ROLL);T=sN*this.numChestAvailable;this.node.scene.emit(r0.ADD_COINS,{coins:T,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:_},skipAnimation:!0});return[4,this.starChest.explode(_)];case 7:R.sent();return[4,tZ.waitTweenAsync(1,_)];case 8:R.sent();return[4,Promise.all([this.fadeOutChestUnlockFX(_)])];case 9:R.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.chestUnlockFXMask.node.active=!0;return[4,tZ.runTweenAsync(z(this.chestUnlockFXMask).to(.5,{opacity:150}),g)];case 1:E.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runTweenAsync(z(this.chestUnlockFXMask).to(.3,{opacity:0}),g)];case 1:E.sent(),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1;return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setInteractableButtons",value:function(g){this.openButton.interactable=g,this.continueButton.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),r}(M)).prototype,"starProgressBar",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WN=st(WO.prototype,"openButton",[Wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WM=st(WO.prototype,"continueButton",[WC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WD=st(WO.prototype,"chestAnimation",[WA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WF=st(WO.prototype,"starChest",[WT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WU=st(WO.prototype,"chestUnlockFXMask",[WR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wx=st(WO.prototype,"skipOverlay",[WI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wz=st(WO.prototype,"messageLabel",[WL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WP=WO))||WP);_._RF.pop(),_._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);var ji,jr,ja,jo,js,jl,ju,jc,jp=k.ccclass,jd=k.property,jf=k.requireComponent,jy=GameCore.Events,jv=globalThis.game.event;WH=jp("StartLevelScreen"),Wq=jf(xj),WW=jd(C),Wj=jd(C),WX=jd(C),WY=jd(C),WJ=jd(B),WH(WQ=Wq((W$=st((WZ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"playButton",W$,Ke(g)),rt(g,"goalText",W0,Ke(g)),rt(g,"levelText",W1,Ke(g)),rt(g,"missionText",W2,Ke(g)),rt(g,"playButtonComponent",W4,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StartLevelScreen: screen not found");g.validateEventPayload(E)&&(g.playButtonComponent.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){jv.on(jy.OPENING_SCREEN,this.handleOpeningScreen),jv.on(jy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){jv.off(jy.OPENING_SCREEN,this.handleOpeningScreen),jv.off(jy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){var E=null!=g?g:{},_=E.screenName,k=E.screenData;return _===this.node.name&&(null!=k&&k.level&&(this.levelId=k.level),null!=k&&k.mission&&(this.mission=k.mission),!0)}},{key:"open",value:function(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(r0.HIDE_UI)}},{key:"close",value:function(){this.playButtonComponent.interactable=!1,jv.emit(jy.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(r0.SHOW_UI)}},{key:"updateComponents",value:function(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}},{key:"updateGoalText",value:function(){var g=this.mission.mission;this.goalText.getComponent(L).string=g>1?"Goals":"Goal"}},{key:"updateLevelText",value:function(){this.levelText.getComponent(L).string="Level ".concat(this.levelId)}},{key:"updateDescriptionText",value:function(){this.missionText.getComponent(L).string=this.mission.description}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedPlay",value:function(){this.node.scene.emit(r0.GAME_START),this.close()}}]),n}(M)).prototype,"playButton",[WW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W0=st(WZ.prototype,"goalText",[Wj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W1=st(WZ.prototype,"levelText",[WX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W2=st(WZ.prototype,"missionText",[WY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W4=st(WZ.prototype,"playButtonComponent",[WJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WQ=WZ))||WQ);_._RF.pop(),_._RF.push({},"2f7694kcVZNWq3iTCp1piqI","StartOverScreen",void 0);var jg,jm,jb,jw,jS,jE=k.ccclass,j_=k.property,jk=k.requireComponent,jC=GameCore.Events,jA=globalThis.game,jT=jA.event,jR=jA.player;ji=jE("StartOverScreen"),jr=jk(xj),ja=j_(B),jo=j_(B),ji(js=jr((ju=st((jl=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"restartButton",ju,Ke(g)),rt(g,"cancelButton",jc,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){jT.on(jC.OPENING_SCREEN,this.handleOpeningScreen),jT.on(jC.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){jT.off(jC.OPENING_SCREEN,this.handleOpeningScreen),jT.off(jC.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(r0.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),l1.closeScreen(ib[this.node.name])}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.restartButton.interactable=g,this.cancelButton.interactable=g}},{key:"handleClickedCancel",value:function(){this.close(),this.node.scene.emit(r0.GAME_RESUME),this.node.scene.emit(r0.SHOW_UI)}},{key:"handleClickedRestart",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){this.close();E=(null!==(g=jR.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;this.node.scene.emit(r0.GAME_RESUME),this.node.scene.emit(r0.GAME_REPLAY,{level:_});return[2]})}),function(){return E.apply(this,arguments)})}]),i}(M)).prototype,"restartButton",[ja],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jc=st(jl.prototype,"cancelButton",[jo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),js=jl))||js);_._RF.pop(),_._RF.push({},"d6d78U+W5xDwqln9pXXQOaF","TopLeaders",void 0);var jI,jL,jP,jO,jB,jN=k.ccclass,jM=k.property,jD=(jg=jN("TopLeaders"),jm=jM(MP),jg((jS=st((jw=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"topLeaders",jS,Ke(g)),g.leaderData=[],g}return Ue(i,[{key:"updateData",value:function(g){var E=this;this.leaderData=g.slice(0,3),this.leaderData.slice(0,3).forEach(function(g,_){E.topLeaders[_].updateInfo({playerId:g.playerId,name:g.name,photo:g.photo,score:g.score})})}},{key:"playShowLeadersAnimation",value:(E=Be(function(g){var E,_,k;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=C.length>1&&void 0!==C[1]?C[1]:.1,k=.3;return[4,Promise.all(this.leaderData.map(function(){var C=Be(function(C,A){var T;return _ts_generator(this,function(C){switch(C.label){case 0:T=E.topLeaders[A];return[4,T.runShowUpAnimation(A*_,k,g)];case 1:C.sent();return[2]}})});return function(g,E){return C.apply(this,arguments)}}()))];case 1:A.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"hideLeaders",value:function(){var g,E=at(this.topLeaders);try{for(E.s();!(g=E.n()).done;)g.value.setVisible(!1)}catch(g){E.e(g)}finally{E.f()}}}]),i}(M)).prototype,"topLeaders",[jm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jb=jw))||jb);_._RF.pop(),_._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var jF,jU,jx,jz,jG,jV,jK,jH,jq,jW,jj,jX,jY,jJ,jQ,jZ,j$,j0,j1,j2,j4,j3,j5,j6,j8,j9,j7,Xt,Xn,Xi,Xr,Xa,Xo,Xs,Xl,Xu,Xh,Xp,Xd,Xf,Xy,Xv=k.ccclass,Xg=k.property,Xm=(jI=Xv("TournamentLeaderSkeleton"),jL=Xg(C),jI((jB=st((jO=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",jB,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,tZ.runTweenAsync(z(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;_=this.container.position.clone();this.container.position=new em(_.x,_.y-100,_.z);k=z(this.node).delay(g);k.to(.2,{scale:em.ONE},{easing:"elasticOut"});C=z(this.container).delay(g);C.to(.2,{position:_},{easing:"backOut"});A=z(this.uiOpacity).delay(g);A.to(.2,{opacity:255},{easing:"cubicOut"});return[4,Promise.all([tZ.runTweenAsync(k,E),tZ.runTweenAsync(C,E),tZ.runTweenAsync(A,E)])];case 1:T.sent(),this.node.scale=em.ONE,this.container.position=_,this.uiOpacity.opacity=255;return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(M)).prototype,"container",[jL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jP=jO))||jP);_._RF.pop(),_._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var Xb=k.ccclass,Xw=k.property,XS=k.requireComponent,XE=GameCore,X_=XE.Events,Xk=XE.Utils,XC=Xk.Object,XA=Xk.Time,XT=Xk.Number,XR=globalThis.game,XI=XR.event,XL=XR.storage,XP=XR.player,XO=XR.leaderboard,XB=1166;jF=Xb("TournamentDetailScreen"),jU=XS(xj),jx=Xw(L),jz=Xw(L),jG=Xw(L),jV=Xw(NC),jK=Xw(jD),jH=Xw({type:C,group:"Buttons"}),jq=Xw({type:C,group:"Buttons"}),jW=Xw({type:C,group:"Buttons"}),jj=Xw({type:eo}),jX=Xw({type:C}),jY=Xw({type:C}),jJ=Xw({type:[Xm]}),jQ=Xw(ya),jZ=Xw({type:R,group:"Container"}),j$=Xw({type:R,group:"Container"}),j0=nk.onlyRunInLifeCycleAsync,j1=nk.onlyRunInLifeCycleAsync,j2=nk.onlyRunInLifeCycleAsync,j4=nk.onlyRunInLifeCycleAsync,j3=nk.onlyRunInLifeCycleAsync,j5=nk.onlyRunInLifeCycle,j6=nk.onlyRunInLifeCycle,jF(j8=jU((j7=st((j9=function(g){ze(v,g);var E,_,k,C,A,T,R,I,L,P,O,N,M,D=Xe(v);function v(){var g;Fe(this,v);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=D.call.apply(D,[this].concat(_)),"titleLabel",j7,Ke(g)),rt(g,"timeLabel",Xt,Ke(g)),rt(g,"playerCountLabel",Xn,Ke(g)),rt(g,"tournamentLeaders",Xi,Ke(g)),rt(g,"topLeaders",Xr,Ke(g)),rt(g,"playButton",Xa,Ke(g)),rt(g,"continueButton",Xo,Ke(g)),rt(g,"replayButton",Xs,Ke(g)),rt(g,"banner",Xl,Ke(g)),rt(g,"bannerLoadingRing",Xu,Ke(g)),rt(g,"bannerMask",Xh,Ke(g)),rt(g,"leaderSkeletons",Xp,Ke(g)),rt(g,"paperConfetti",Xd,Ke(g)),rt(g,"container",Xf,Ke(g)),rt(g,"tempContainer",Xy,Ke(g)),g.signal=new nN,g.leadersPayload=null,g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("TournamentDetailScreen: screen not found");g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(v,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(xj),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nk.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){XI.on(X_.OPENING_SCREEN,this.handleOpeningScreen),XI.on(X_.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){XI.off(X_.OPENING_SCREEN,this.handleOpeningScreen),XI.off(X_.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.updateContainer(),this.setInteractableButtons(!0),this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders(),this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(r0.HIDE_UI),this.updateInfo()}},{key:"close",value:function(){l1.closeTournamentDetailScreen(),this.setInteractableButtons(!1),this.node.scene.emit(r0.SHOW_UI),this.cleanup()}},{key:"cleanup",value:function(){var g;null===(g=this.signal)||void 0===g||g.abort(),this.signal=new nN,this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(M=Be(function(){var g,E,_,k,C,A,T,R,I,L,P,O,B,N,M,D,F,U,x,z,G,V,K,H,q,W,j,X,Y,J;return _ts_generator(this,function(Q){switch(Q.label){case 0:T=this,R=this.signal,I=null===(g=this.payload)||void 0===g||null===(g=g.screenData)||void 0===g?void 0:g.tournament;if(!I)return[3,9];L=null===(E=null===(_=this.payload.screenData)||void 0===_?void 0:_.playAnimation)||void 0===E||E,P=JSON.parse(I);P.id=P.id.toString(),this.tournamentPayload=P;O=this.tournamentPayload,B=O.endTime,N=O.payload,M=O.title,D=N.leaderboardId,F=void 0===D?"":D,U=N.themeId;this.updateTitle(M),this.updateEndTime(B),this.updateTournamentBanner(U,R);x=XL.getStorage("tournament"),z=x.previousScore,G=x.animateTournamentLeader;XL.setStorageData("tournament","animateTournamentLeader",!1),this.updateButtonsVisibility(G);return[4,this.showLoading(R)];case 1:Q.sent();return[4,this.loadLeaders(F)];case 2:if(Q.sent(),!!this.leadersPayload&&0!==this.leadersPayload.leaders.length&&!R.aborted)return[3,4];this.updatePlayerCount(0);return[4,this.hideLoading(R)];case 3:return[2,void Q.sent()];case 4:V=this.leadersPayload,K=V.player,H=V.amountPlayer,q=null!==(k=this.leadersPayload.leaders)&&void 0!==k?k:[];q.sort(function(g,E){return g.rank-E.rank});return[4,this.hideLoading(R)];case 5:if(Q.sent(),!this.topLeaders||!this.tournamentLeaders||!!R.aborted)return[3,9];this.updatePlayerCount(H),this.topLeaders.updateData(q),this.topLeaders.playShowLeadersAnimation(R);W=null!==(C=null==K?void 0:K.score)&&void 0!==C?C:0,j=null!==(A=null==K?void 0:K.rank)&&void 0!==A?A:0,X=G&&-1!==z&&z<W;this.tournamentLeaders.updateData(q);Y=!1;K&&X&&(Y=this.tournamentLeaders.updateDisplayPlayerLeaderForRankChanging(z,W,j)),this.tournamentLeaders.initScrollViews(),this.tournamentLeaders.scrollView.scrollView.enabled=!0;return[4,R.callAsync(function(g){return T.runShowUpAnimation(g,L)})];case 6:Q.sent();J=G&&Y&&-1!==z&&this.tournamentLeaders;if(!J)return[3,8];return[4,R.callAsync(function(g){return T.tournamentLeaders.playRankChangeAnimation(g,z,W,j)})];case 7:J=(Q.sent(),this.tryPlayConfettiEffect(j));Q.label=8;case 8:Q.label=9;case 9:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"updateContainer",value:(N=Be(function(){var g;return _ts_generator(this,function(E){g=this.tempContainer.height;this.container.node.position=this.tempContainer.node.position.clone(),g<XB&&this.container.height!==g?(this.container.height=g,eb.instance.emit("canvas-resize")):g>XB&&this.container.height<XB&&(this.container.height=XB,eb.instance.emit("canvas-resize"));return[2]})}),function(){return N.apply(this,arguments)})},{key:"loadLeaders",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,this.getLeadersPayload(g)];case 1:E.leadersPayload=_.sent();return[2]}})}),function(g){return O.apply(this,arguments)})},{key:"showLoading",value:(P=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=k.length>1&&void 0!==k[1]?k[1]:0;return[4,Promise.all([this.tournamentLeaders.scrollView.unlistenEvents(),this.tournamentLeaders.scrollView.scrollToTop(g,.1).then(function(){E.tournamentLeaders.scrollView.scrollView.enabled=!1,E.tournamentLeaders.scrollView.listenEvents()}),this.leaderSkeletons.map(function(E,k){return E.show(k*_,g)})])];case 1:C.sent();return[2]}})}),function(g){return P.apply(this,arguments)})},{key:"hideLoading",value:(L=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(E){return E.hide(g)}))];case 1:E.sent();return[2]}})}),function(g){return L.apply(this,arguments)})},{key:"runShowUpAnimation",value:(I=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=!(k.length>1&&void 0!==k[1])||k[1],_=E?0:.1;return[4,this.tournamentLeaders.playShowLeadersAnimation(g,_)];case 1:C.sent();return[4,this.tournamentLeaders.scrollToPlayerLeader(1.5,g)];case 2:C.sent();return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"tryPlayConfettiEffect",value:function(g){if(!(g>10)){var E,_=at(this.paperConfetti);try{for(_.s();!(E=_.n()).done;)E.value.play()}catch(g){_.e(g)}finally{_.f()}i5.playSound(ic.LEADERBOARD_TRIUMPH)}}},{key:"updateTitle",value:function(g){g&&(this.titleLabel.string=g)}},{key:"updateEndTime",value:function(g){var E=XA.getRelativeTime(g);E=(E=E.replace("seconds","secs").replace("second","sec")).replace("minutes","mins").replace("minute","min"),this.timeLabel.string="Ends ".concat(E)}},{key:"updateTournamentBanner",value:(R=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.banner.spriteFrame=null;_=n7.getAsset("".concat(nU[g],"/spriteFrame"),ea);k=_;if(k)return[3,2];this.bannerMask.active=!0,this.bannerLoadingRing.active=!0;return[4,n7.loadThemeTournamentAsync(g)];case 1:k=_=A.sent();A.label=2;case 2:C=_;if(C)return[3,4];return[4,n7.loadThemeTournamentAsync(ln.SUMMER)];case 3:C=_=A.sent();A.label=4;case 4:this.banner&&_&&!E.aborted&&(this.banner.spriteFrame=_,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1);return[2]}})}),function(g,E){return R.apply(this,arguments)})},{key:"updatePlayerCount",value:function(g){var E=XT.getShortNumber(g,3);this.playerCountLabel.string="".concat(E," ").concat(g>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"getLeadersPayload",value:(T=Be(function(g){var E,_,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:E=XO.getLeaderboardName(g);if(!E)return[2,null];return[4,le.getAllLeaderboardAsync(g)];case 1:_=P.sent();if(!_)return[2,null];C=XC.vals(_.leaders),A=XP.getPlayerId(),T={leaders:[],amountPlayer:_.amountPlayer},R=at(C);try{for(R.s();!(k=R.n()).done;){I=k.value;I.playerId===A?(T.player=I,T.leaders.push(I)):T.leaders.push(I)}}catch(g){R.e(g)}finally{R.f()}if(!!T.player)return[3,3];return[4,XO.getLeadersByPlayerIdsAsync(E,[A])];case 2:L=P.sent();L&&L.length>0&&(T.player=L[0],T.leaders.push(L[0]));P.label=3;case 3:return[2,T]}})}),function(g){return T.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(g){this.playButton.active=!g,this.continueButton.active=g,this.replayButton.active=g}},{key:"handleOnPlay",value:(A=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.tournamentPayload.id||"";if(ut.validateTournamentExpired(g))return[2,(this.close(),this.node.scene.emit(s0.RELOAD_TOURNAMENT),void l1.showNotificationScreen("Tournament has ended",2))];k.label=1;case 1:k.trys.push([1,4,9,10]);l1.showLoadingScreen();return[4,l_.setMatchCustomDataAsync({level:1,score:0})];case 2:k.sent();return[4,this.processJoinTournament()];case 3:k.sent();return[3,10];case 4:E=k.sent();if(XC.hasOwn(E,"code")&&"USER_INPUT"===E.code)return[2];k.label=5;case 5:k.trys.push([5,7,,8]);return[4,this.processContinueTournament()];case 6:k.sent();return[3,8];case 7:_=k.sent();if(XC.hasOwn(_,"code")&&"USER_INPUT"===_.code)return[2];console.error("processPlayButtonPressed",_),l1.showNotificationScreen("Sorry, you cannot join\nat this time.",2);return[3,8];case 8:return[3,10];case 9:l1.closeLoadingScreen();return[7];case 10:return[2]}})}),function(){return A.apply(this,arguments)})},{key:"processJoinTournament",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,this.joinTournamentAsync()];case 1:E.sent(),lU.switchScene(sQ,{level:1});return[3,3];case 2:g=E.sent();throw console.warn("processJoinTournament",g),g;case 3:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"processContinueTournament",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,this.continueTournamentAsync()];case 1:E.sent(),lU.switchScene(sQ,{level:1});return[3,3];case 2:g=E.sent();throw console.warn("processContinueTournament",g),g;case 3:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"joinTournamentAsync",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.tournamentPayload.id||"";return[4,l_.joinTournamentAsync(g)];case 1:E.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"continueTournamentAsync",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:E=null!==(g=GameSDK.context.getID())&&void 0!==g?g:"";return[4,l_.continueTournamentAsync(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var g,E,_=(null!==(g=null===(E=this.payload)||void 0===E?void 0:E.screenData)&&void 0!==g?g:{}).tournamentContextType;switch(void 0===_?"tournament_start":_){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}},{key:"setInteractableButtons",value:function(g){this.screen.backgroundMask.getComponent(B).interactable=g}}]),v}(M)).prototype,"titleLabel",[jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xt=st(j9.prototype,"timeLabel",[jz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xn=st(j9.prototype,"playerCountLabel",[jG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xi=st(j9.prototype,"tournamentLeaders",[jV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xr=st(j9.prototype,"topLeaders",[jK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xa=st(j9.prototype,"playButton",[jH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xo=st(j9.prototype,"continueButton",[jq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xs=st(j9.prototype,"replayButton",[jW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xl=st(j9.prototype,"banner",[jj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xu=st(j9.prototype,"bannerLoadingRing",[jX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xh=st(j9.prototype,"bannerMask",[jY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=st(j9.prototype,"leaderSkeletons",[jJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xd=st(j9.prototype,"paperConfetti",[jQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xf=st(j9.prototype,"container",[jZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xy=st(j9.prototype,"tempContainer",[j$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(j9.prototype,"updateInfo",[j0],Object.getOwnPropertyDescriptor(j9.prototype,"updateInfo"),j9.prototype),st(j9.prototype,"loadLeaders",[j1],Object.getOwnPropertyDescriptor(j9.prototype,"loadLeaders"),j9.prototype),st(j9.prototype,"showLoading",[j2],Object.getOwnPropertyDescriptor(j9.prototype,"showLoading"),j9.prototype),st(j9.prototype,"hideLoading",[j4],Object.getOwnPropertyDescriptor(j9.prototype,"hideLoading"),j9.prototype),st(j9.prototype,"runShowUpAnimation",[j3],Object.getOwnPropertyDescriptor(j9.prototype,"runShowUpAnimation"),j9.prototype),st(j9.prototype,"tryPlayConfettiEffect",[j5],Object.getOwnPropertyDescriptor(j9.prototype,"tryPlayConfettiEffect"),j9.prototype),st(j9.prototype,"updatePlayerCount",[j6],Object.getOwnPropertyDescriptor(j9.prototype,"updatePlayerCount"),j9.prototype),j8=j9))||j8);_._RF.pop(),_._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,k.ccclass)("TournamentLeader")(function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n)}(B2));_._RF.pop(),_._RF.push({},"0b4bc6YT6ZGg4lnXfh/zL6J","AdsManager",void 0);var XN=GameCore,XM=XN.Events,XD=XN.Configs,XF=XN.Utils.Time,XU=globalThis.game,Xx=XU.ads,Xz=XU.player,XG=XU.event,XV=function(){function e(){var g=this;Fe(this,e),this.currentLayout="",this.handleShowBannerAds=function(E){E.sceneName!==sJ&&(Xz.isFirstLogin()||(vc.showBannerAds(),XG.off(XM.SCENE_LAUNCHED,g.handleShowBannerAds)))},this.handleWhenGameReady=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,g.handleShowInterstitialAdWhenGameReady()];case 1:E.sent();return[4,XF.sleepAsync(2e3)];case 2:E.sent(),vc.preloadAds();return[2]}})}),this.handleShowInterstitialAdWhenGameReady=Be(function(){var E,_,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:E=XD.Ads,_=E.Enabled,k=E.ShowAdOnLoad;if(!_)return[3,6];C=k.Enabled,A=k.DelaySeconds,T=k.PlacementId;if(!C)return[3,6];P.label=1;case 1:P.trys.push([1,5,,6]);R=A>0;if(!R)return[3,3];return[4,XF.sleepAsync(1e3*A)];case 2:R=P.sent();P.label=3;case 3:I=Xx.getAdByPlacementId(T);if(!I)return[2];return[4,g.showAdByConfig(I)];case 4:P.sent();return[3,6];case 5:L=P.sent();console.warn("handleShowAdWhenLoadGame failed",L);return[3,6];case 6:return[2]}})}),this.handleLayoutChanged=function(E){if(g.currentLayout!==E){g.currentLayout=E;var _=XD.Ads.BannerDisplayAdOptions;E!==rv.Landscape?_.forEach(function(g){var E=g.PlacementId,_=g.Position;"bottom"===_||"top"===_?vc.showBannerAd(E):vc.hideBannerAd(E)}):vc.showBannerAds()}}}var g;return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Ads Manager: Initialized")}},{key:"listenEvents",value:function(){Q.on(t6,this.handleLayoutChanged),XG.on(XM.SCENE_LAUNCHED,this.handleShowBannerAds),XG.once(XM.GAME_READY,this.handleWhenGameReady)}},{key:"showAdByConfig",value:(g=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,3,4,5]);E=g.type,_=g.placementId;return[4,Xx.loadAdAsync(E,_)];case 1:C.sent(),i5.muteAudio(!0);return[4,Xx.showAdAsync(E,_)];case 2:C.sent();return[3,5];case 3:k=C.sent();console.warn("showAdByConfig failed",k);return[3,5];case 4:Q.resume(),i5.muteAudio(!1);return[7];case 5:return[2]}})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var XK=GameCore.Events,XH=globalThis.game,Xq=XH.event,XW=XH.monitorError,Xj=function(){function e(){var g=this;Fe(this,e),this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=function(){if(!g.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void(null==XW||XW.sendException(new Error("Core: Booting callback is not set")));console.info("\uD83D\uDE80 Core: Boot"),g.callbackCoreBooting(),g.callbackCoreBooting=null},this.handleWhenCoreStarting=function(){if(!g.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void(null==XW||XW.sendException(new Error("Core: Starting callback is not set")));console.info("\uD83D\uDE80 Core: Starting"),g.callbackCoreStarting(),g.callbackCoreStarting=null},this.handleWhenCoreReady=function(){if(!g.callbackCoreReady)return console.error("Core: Ready callback is not set"),void(null==XW||XW.sendException(new Error("Core: Ready callback is not set")));console.info("\uD83D\uDE80 Core: Ready"),g.callbackCoreReady(),g.callbackCoreReady=null}}return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Core Manager: Initialized")}},{key:"listenEvents",value:function(){Xq.once(XK.CORE_BOOTING,this.handleWhenCoreBooting),Xq.once(XK.CORE_STARTING,this.handleWhenCoreStarting),Xq.once(XK.CORE_READY,this.handleWhenCoreReady)}},{key:"requestStart",value:function(){Xq.emit(XK.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(g){this.callbackCoreBooting=g,Xq.getEventEmitCount(XK.CORE_BOOTING)>0&&(Xq.off(XK.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}},{key:"onCoreStart",value:function(g){this.callbackCoreStarting=g,Xq.getEventEmitCount(XK.CORE_STARTING)>0&&(Xq.off(XK.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}},{key:"onCoreReady",value:function(g){this.callbackCoreReady=g,Xq.getEventEmitCount(XK.CORE_READY)>0&&(Xq.off(XK.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}]),e}();_._RF.pop(),_._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var XX=GameCore,XY=XX.Events,XJ=XX.Configs.GameEngine.DynamicAtlas,XQ=XX.Utils,XZ=XQ.Valid,X$=XQ.Device,X0=globalThis.game.event,X1=function(){function e(){var g=this;Fe(this,e),this.handlePauseEngine=Be(function(){return _ts_generator(this,function(g){console.info("Engine: Paused",Q.isPaused()),Q.isPaused();return[2]})}),this.handleResumeEngine=Be(function(){return _ts_generator(this,function(g){console.info("Engine: Resumed",Q.isPaused()),Q.isPaused();return[2]})}),this.handleResizeView=function(E){eb.instance.resizeWithBrowserSize(!1);var _=E.width,k=E.height;g.resizeView(_,k)},this.handleViewResized=function(g){var E=g.width,_=g.height;eb.instance.resizeWithBrowserSize(!0),console.info("✨ New View Size",{width:E,height:_})}}var g;return Ue(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.setupAssetDownloader(),this.setupOptimalPipelines(),this.setupEngineRunningState(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){Q.on(t4,this.handleResizeView),Q.on(t3,this.handleViewResized)}},{key:"overrideSettings",value:function(){eW.overrideSettings(ej.Category.ENGINE,"debug",XZ.isDebugger()),Q.frameRate=X$.isDesktop()?60:48}},{key:"setupAutoAtlas",value:function(){eX.instance.cacheAsset=!0}},{key:"setupAssetDownloader",value:function(){var g=eX.instance.downloader;g.maxConcurrency=10,g.maxRequestsPerFrame=6}},{key:"getPipelineFlows",value:function(){var g,E;return null!==(g=null===(E=N.root)||void 0===E||null===(E=E.pipeline)||void 0===E?void 0:E.flows)&&void 0!==g?g:[]}},{key:"getRenderQueues",value:function(g){var E=this.getPipelineFlows()[0];return null!=E&&E.stages?E.stages[g].renderQueues:[]}},{key:"setupOptimalPipelines",value:(g=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:eX.instance.transformPipeline.remove(1);return[4,XZ.isValueChangeAsync(function(){return!!N.root},!0,{timeout:1e4})];case 1:_.sent();g=this.getPipelineFlows();g.shift(),g.shift();E=this.getRenderQueues(0);E.shift(),E.shift();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"setupEngineRunningState",value:function(){var g=this;eY.on(ep.EventType.TOUCH_START,this.handleResumeEngine),X0.once(XY.GAME_READY,function(){X0.on(XY.VISIBILITY_HIDDEN,g.handlePauseEngine),X0.on(XY.VISIBILITY_VISIBLE,g.handleResumeEngine)})}},{key:"setupDynamicAtlas",value:function(){switch(ev.os){case ev.OS.IOS:this.setupDynamicAtlasForIOS();break;case ev.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(g){var E=g.Enabled,_=g.AutoAtlasSize,k=g.MaxAtlasCount,C=g.MaxAtlasSize,A=g.MaxFrameSize;if(eJ.CLEANUP_IMAGE_CACHE=!1,eQ.instance.enabled=E,eQ.instance.textureSize=C,eQ.instance.maxFrameSize=A,eQ.instance.maxAtlasCount=k,eQ.instance.textureBleeding=!0,_){var T=this.getMaxTextureSize();if(!T)return;eQ.instance.maxAtlasCount=1,eQ.instance.textureSize=T}}},{key:"getMaxTextureSize",value:function(){if(!N.root)return -1;var g=N.root.device.capabilities.maxTextureSize,E=1024;return g-E<=eQ.instance.maxFrameSize?-1:g>8192?7168:g-E}},{key:"setupDynamicAtlasForIOS",value:function(){var g=XJ.IOS;this.setDynamicAtlas(g)}},{key:"setupDynamicAtlasForAndroid",value:function(){var g=XJ.Android;this.setDynamicAtlas(g)}},{key:"setupDynamicAtlasForDesktop",value:function(){var g=XJ.Desktop;this.setDynamicAtlas(g)}},{key:"setupBatcherLimit",value:function(){eJ.BATCHER2D_MEM_INCREMENT=288,eJ.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(g,E){var _,k=window.devicePixelRatio,C=k>=2?2/k:1,A=g*k*C,T=E*k*C;null===(_=N.root)||void 0===_||_.resize(A,T),j.windowSize=new X.Size(A,T),N.once(e_.EVENT_AFTER_UPDATE,function(){Q.emit(t3,{width:A,height:T})})}}]),e}();_._RF.pop();var X2,X4=new(function(){function e(){Fe(this,e),this._registry={},this._moduleCache={}}return Ue(e,[{key:"define",value:function(g,E,_){this._registry[g]={factory:E,resolveMap:_}}},{key:"require",value:function(g){return this._require(g)}},{key:"throwInvalidWrapper",value:function(g,E){throw new Error("Module '".concat(g,"' imported from '").concat(E,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(g,E){var _=this._moduleCache[g];if(_)return _.exports;var k={id:g,exports:{}};return this._moduleCache[g]=k,this._tryModuleLoad(k,g),k.exports}},{key:"_resolve",value:function(g,E){return this._resolveFromInfos(g,E)||this._throwUnresolved(g,E)}},{key:"_resolveFromInfos",value:function(g,E){var _,k;return g in cjsInfos?g:E&&null!==(_=null===(k=cjsInfos[E])||void 0===k?void 0:k.resolveCache[g])&&void 0!==_?_:void 0}},{key:"_tryModuleLoad",value:function(g,E){var _=!0;try{this._load(g,E),_=!1}finally{_&&delete this._moduleCache[E]}}},{key:"_load",value:function(g,E){var _=this._loadWrapper(E),k=_.factory,C=_.resolveMap,A=this._createRequire(g),T=C?this._createRequireWithResolveMap("function"==typeof C?C():C,A):A;k(g.exports,T,g)}},{key:"_loadWrapper",value:function(g){return g in this._registry?this._registry[g]:this._loadHostProvidedModules(g)}},{key:"_loadHostProvidedModules",value:function(g){return{factory:function(E,_,k){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(g,"'."));try{k.exports=require(g)}catch(E){throw new Error("Exception thrown when calling host defined require('".concat(g,"')."),{cause:E})}}}}},{key:"_createRequire",value:function(g){var E=this;return function(_){return E._require(_,g)}}},{key:"_createRequireWithResolveMap",value:function(g,E){return function(_){var k=g[_];if(k)return E(k);throw new Error("Unresolved specifier "+_)}}},{key:"_throwUnresolved",value:function(g,E){throw new Error("Unable to resolve ".concat(g," from ").concat(parent,"."))}}]),e}());function c3(g){return(c3="function"==typeof Symbol&&"symbol"==_type_of(Symbol.iterator)?function(g){return void 0===g?"undefined":_type_of(g)}:function(g){return g&&"function"==typeof Symbol&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":void 0===g?"undefined":_type_of(g)})(g)}var X3="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";X4.define(X3,function(g,E,_,k,C){(function(E,k){"object"===c3(g)&&void 0!==_?_.exports=k():"function"==typeof define&&define.amd?define(k):E.ResizeObserver=k()})(this,function(){var g=function(){if("undefined"!=typeof Map)return Map;function e(g,E){var _=-1;return g.some(function(g,k){return g[0]===E&&(_=k,!0)}),_}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(g){var E=e(this.__entries__,g),_=this.__entries__[E];return _&&_[1]},t.prototype.set=function(g,E){var _=e(this.__entries__,g);~_?this.__entries__[_][1]=E:this.__entries__.push([g,E])},t.prototype.delete=function(g){var E=this.__entries__,_=e(E,g);~_&&E.splice(_,1)},t.prototype.has=function(g){return!!~e(this.__entries__,g)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(g,E){void 0===E&&(E=null);for(var _=0,k=this.__entries__;_<k.length;_++){var C=k[_];g.call(E,C[1],C[0])}},t}()}(),E="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,_="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),k="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(_):function(g){return setTimeout(function(){return g(Date.now())},1e3/60)};var C=["top","right","bottom","left","width","height","size","weight"],A="undefined"!=typeof MutationObserver,T=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(g,E){var _=!1,C=!1,A=0;function r(){_&&(_=!1,g()),C&&l()}function s(){k(r)}function l(){var g=Date.now();if(_){if(g-A<2)return;C=!0}else _=!0,C=!1,setTimeout(s,E);A=g}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(g){~this.observers_.indexOf(g)||this.observers_.push(g),this.connected_||this.connect_()},e.prototype.removeObserver=function(g){var E=this.observers_,_=E.indexOf(g);~_&&E.splice(_,1),!E.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var g=this.observers_.filter(function(g){return g.gatherActive(),g.hasActive()});return g.forEach(function(g){return g.broadcastActive()}),g.length>0},e.prototype.connect_=function(){E&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),A?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){E&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(g){var E=g.propertyName,_=void 0===E?"":E;C.some(function(g){return!!~_.indexOf(g)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(g,E){for(var _=0,k=Object.keys(E);_<k.length;_++){var C=k[_];Object.defineProperty(g,C,{value:E[C],enumerable:!1,writable:!1,configurable:!0})}return g},l=function(g){return g&&g.ownerDocument&&g.ownerDocument.defaultView||_},R=f(0,0,0,0);function c(g){return parseFloat(g)||0}function h(g){for(var E=[],_=1;_<arguments.length;_++)E[_-1]=arguments[_];return E.reduce(function(E,_){return E+c(g["border-"+_+"-width"])},0)}function d(g){var E=g.clientWidth,_=g.clientHeight;if(!E&&!_)return R;var k=l(g).getComputedStyle(g),C=function(g){for(var E={},_=0,k=["top","right","bottom","left"];_<k.length;_++){var C=k[_],A=g["padding-"+C];E[C]=c(A)}return E}(k),A=C.left+C.right,T=C.top+C.bottom,I=c(k.width),L=c(k.height);if("border-box"===k.boxSizing&&(Math.round(I+A)!==E&&(I-=h(k,"left","right")+A),Math.round(L+T)!==_&&(L-=h(k,"top","bottom")+T)),!function(g){return g===l(g).document.documentElement}(g)){var P=Math.round(I+A)-E,O=Math.round(L+T)-_;1!==Math.abs(P)&&(I-=P),1!==Math.abs(O)&&(L-=O)}return f(C.left,C.top,I,L)}var I="undefined"!=typeof SVGGraphicsElement?function(g){return _instanceof(g,l(g).SVGGraphicsElement)}:function(g){return _instanceof(g,l(g).SVGElement)&&"function"==typeof g.getBBox};function y(g){return E?I(g)?function(g){var E=g.getBBox();return f(0,0,E.width,E.height)}(g):d(g):R}function f(g,E,_,k){return{x:g,y:E,width:_,height:k}}var L=function(){function e(g){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=f(0,0,0,0),this.target=g}return e.prototype.isActive=function(){var g=y(this.target);return this.contentRect_=g,g.width!==this.broadcastWidth||g.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var g=this.contentRect_;return this.broadcastWidth=g.width,this.broadcastHeight=g.height,g},e}(),m=function(g,E){var _,k,C,A,T,R,I,L=(k=(_=E).x,C=_.y,A=_.width,T=_.height,R="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,I=Object.create(R.prototype),s(I,{x:k,y:C,width:A,height:T,top:C,right:k+A,bottom:T+C,left:k}),I);s(this,{target:g,contentRect:L})},P=function(){function t(E,_,k){if(this.activeObservations_=[],this.observations_=new g,"function"!=typeof E)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=E,this.controller_=_,this.callbackCtx_=k}return t.prototype.observe=function(g){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(g,l(g).Element))throw new TypeError('parameter 1 is not of type "Element".');var E=this.observations_;E.has(g)||(E.set(g,new L(g)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(g){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(g,l(g).Element))throw new TypeError('parameter 1 is not of type "Element".');var E=this.observations_;E.has(g)&&(E.delete(g),E.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var g=this;this.clearActive(),this.observations_.forEach(function(E){E.isActive()&&g.activeObservations_.push(E)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var g=this.callbackCtx_,E=this.activeObservations_.map(function(g){return new m(g.target,g.broadcastRect())});this.callback_.call(g,E,g),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),O="undefined"!=typeof WeakMap?new WeakMap:new g,S=function e(g){if(!_instanceof(this,e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var E=T.getInstance(),_=new P(g,E,this);O.set(this,_)};return["observe","unobserve","disconnect"].forEach(function(g){S.prototype[g]=function(){var E;return(E=O.get(this))[g].apply(E,arguments)}}),void 0!==_.ResizeObserver?_.ResizeObserver:S}),X2=_.exports},{}),X4.require(X3),_._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var X5=rv,X6=rg,X8=X6.Portrait,X9=X6.Landscape,X7=GameCore,Yt=X7.Utils.Function,Yn=X7.Configs.GameEngine,Yi=Yn.AutoResizeCanvas,Yr=Yn.AutoChangeOrientation,Ya=function(){function e(){var g=this;Fe(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(E){console.info("\uD83D\uDCF1 View resize by system"),window.devicePixelRatio=E||window.devicePixelRatio,g.setupOrientationByScreenSize(),g.resizeGameView()},this.handleViewResize=Yt.debounce(function(){console.info("\uD83D\uDCF1 View resize by window"),g.setupOrientationByScreenSize(),g.resizeGameView()},200),this.handleBodyResize=Yt.debounce(function(){g.resizeGameDiv()&&(console.info("\uD83D\uDCF1 View resize by body"),g.setupOrientationByScreenSize(),g.resizeGameView())},200)}return Ue(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){Yi&&(j.on("window-resize",this.handleViewResize,this),j.on("orientation-change",this.handleViewResize,this)),Q.on(t5,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){Yi&&new X2(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){Yr&&(eb.instance.resizeWithBrowserSize(!0),eb.instance.setOrientation(eJ.ORIENTATION_AUTO),eb.instance.setResolutionPolicy(eZ.ContentStrategy.FIXED_WIDTH),eb.instance.setResolutionPolicy(eZ.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=eb.instance.getResolutionPolicy())}},{key:"setupOrientationByScreenSize",value:function(){if(Yr){var g=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(eZ.ContentStrategy.FIXED_WIDTH),g<1?this.setPortraitView():this.setLandscapeView()}}},{key:"resizeGameDiv",value:function(){var g=document.getElementById("GameDiv");if(!g)return!1;var E=ns.getScreenWidthCss(),_=ns.getScreenHeightCss(),k=g.getBoundingClientRect(),C=k.width,A=k.height;return(E!==C||_!==A)&&(g.style.width="".concat(E,"px"),g.style.height="".concat(_,"px"),!0)}},{key:"resizeGameView",value:function(){var g=ns.getScreenWidthCss(),E=ns.getScreenHeightCss();Q.emit(t4,{width:g,height:E})}},{key:"setPortraitView",value:function(){var g=X8.WIDTH,E=X8.HEIGHT;this.currentLayout=X5.Portrait,this.changeDesignResolutionSize(g,E)}},{key:"setLandscapeView",value:function(){var g=X9.WIDTH,E=X9.HEIGHT;this.currentLayout=X5.Landscape,this.changeDesignResolutionSize(g,E)}},{key:"changeDesignResolutionSize",value:function(g,E){eb.instance.setDesignResolutionSize(g,E,this.resolutionPolicy),Q.emit(t6,this.currentLayout),console.info("\uD83D\uDCF1 Change layout to",this.currentLayout)}},{key:"getScreenRatio",value:function(){return ns.getScreenWidthCss()/ns.getScreenHeightCss()}}]),e}();_._RF.pop(),_._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var Yo=GameCore,Ys=Yo.Utils,Yl=Ys.Valid,Yu=Ys.Object,Yc=Ys.Array,Yp=Yo.Dtos.Match,Yd=Yp.CustomData,Yf=Yp.Data,Yy=["code","cols","encoding","idSize","rows"],Yv=["addRandomTilesPerMove","maxSpaceOfPair"],Yg=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function(){Yd.addDefaultData(sX),Yd.addValidateFunction("score",function(g){if(!Yl.isNumber(g)||g<0)throw new Error("score ".concat(g," is invalid"))})}},{key:"setupMatchData",value:function(){var g=this;Yf.addDefaultData(sx),Yf.addValidateFunction("extraData",function(E){if(null!=E){if(!Yl.isObject(E))throw new Error("extraData ".concat(E," must be a record of string keys"));var _=E,k=Object.keys(_);if(!Yc.has(k,"level"))throw new Error("extraData.level is missing");if(!Yl.isNumber(_.level))throw new Error("extraData.level ".concat(_.level," must be a number"));if(!Yc.has(k,"fen"))throw new Error("extraData.fen is missing");if(g.validateFen(_.fen),!Yc.has(k,"gravity"))throw new Error("extraData.gravity is missing");if(!Yl.isString(_.gravity))throw new Error("extraData.gravity ".concat(_.gravity," must be a string"));if(!Yc.has(k,"rules"))throw new Error("extraData.rules is missing");if(g.validateLevelRules(_.rules),!Yc.has(k,"time"))throw new Error("extraData.time is missing");if(!Yl.isNumber(_.time))throw new Error("extraData.time ".concat(_.time," must be a number"))}})}},{key:"validateFen",value:function(g){if(!Yl.isObject(g))throw new Error("extraData.fen ".concat(g," must be a record of string keys"));var E=this.validateKeys(g,Yy);if(!Yl.isNumber(E.idSize))throw new Error("fen.idSize must be a number");if(!Yl.isString(E.code))throw new Error("fen.code must be a string");if(!Yl.isNumber(E.rows))throw new Error("fen.rows must be a number");if(!Yl.isNumber(E.cols))throw new Error("fen.cols must be a number");if(!Yl.isObject(E.encoding))throw new Error("fen.encoding must be a record of string keys");var _=this.validateKeys(E.encoding,Yu.vals(uK));Object.entries(_).forEach(function(g){var E=et(g,2),_=E[0],k=E[1];if(!Yl.isString(k))throw new Error("fen.encoding.".concat(_," ").concat(k," must be a string"))})}},{key:"validateLevelRules",value:function(g){if(!Yl.isObject(g))throw new Error("extraData.rules ".concat(g," must be a record of string keys"));var E=this.validateKeys(g,Yv);if(!Yl.isNumber(E.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!Yl.isNumber(E.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function(g,E){return Object.keys(g).forEach(function(g){if(!Yc.has(E,g))throw new Error("Key ".concat(g," is missing"))}),g}}]),e}();_._RF.pop(),_._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var Ym=GameCore,Yb=Ym.Utils,Yw=Yb.Valid,YS=Yb.Array,YE=Yb.Object,Y_=Ym.Dtos,Yk=globalThis.game.player,YC=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var g=Y_.Player;g.Data.addDefaultData(sY),g.GameData.addDefaultData(sK),g.GameData.addValidateFunction("stars",function(g){if(!Yw.isNumber(g)||g<0)throw new Error("stars ".concat(g," is invalid"))}),g.GameData.addValidateFunction("totalLevel",function(g){if(!Yw.isNumber(g)||g<1)throw new Error("totalLevel ".concat(g," is invalid"))}),g.GameData.addValidateFunction("levelVersion",function(g){if(!Yw.isNumber(g)||g<0)throw new Error("levelVersion ".concat(g," is invalid"))}),g.GameData.addValidateFunction("lastRewardedItems",function(g){if(!Yw.isNumber(g)||g<0)throw new Error("lastRewardedItems ".concat(g," is invalid"))}),g.GameData.addValidateFunction("lastCreateTournamentShown",function(g){if(!Yw.isNumber(g)||g<0)throw new Error("lastCreateTournamentShown ".concat(g," is invalid"))}),g.GameData.addValidateFunction("guideItemShowed",function(g){if(!Array.isArray(g))throw new Error("guideItemShowed ".concat(g," is invalid"))}),g.GameData.addValidateFunction("items",function(g){if(!Yw.isObject(g))throw new Error("items ".concat(g," is invalid"));var E=Object.keys(g),_=YE.vals(g);if(!YS.has(E,sP.HINT))throw new Error("item ".concat(sP.HINT," not found"));if(!YS.has(E,sP.THUNDER))throw new Error("item ".concat(sP.THUNDER," not found"));if(!YS.has(E,sP.STORM))throw new Error("item ".concat(sP.STORM," not found"));if(!YS.has(E,sP.PLIERS))throw new Error("item ".concat(sP.PLIERS," not found"));_.forEach(function(g){if(!Yw.isNumber(g)||g<0)throw new Error("item ".concat(g," is invalid"))})}),g.GameData.addValidateFunction("skins",function(g){if(!Yw.isObject(g))throw new Error("skins ".concat(g," is invalid"))})}},{key:"requestConnectedPlayers",value:function(){Yk.requestConnectedPlayers().catch(function(g){console.warn("player.requestConnectedPlayers",g)})}}]),e}();_._RF.pop(),_._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var YA=GameCore,YT=YA.Events,YR=YA.Utils.Valid,YL=globalThis.game,YP=YL.event,YO=YL.adaptivePerformance,YB=function(){function e(){var g=this;Fe(this,e),this.handleBeginFrame=function(){N.on(e_.EVENT_AFTER_UPDATE,g.lateUpdate),N.on(e_.EVENT_BEFORE_UPDATE,g.updateActualFPS)},this.handleAfterSceneLaunch=function(g){YO&&YO.trackingScene(g.name)},this.handleRequestResizeGame=function(g){var E=g.forcePixelRatio;YR.isNumber(E)&&Q.emit(t5,E)},this.lateUpdate=function(){var g=1e3*Q.deltaTime;null==YO||YO.updatePostStepDeltaTime(g)},this.updateActualFPS=function(){var g,E=null===(g=N.root)||void 0===g?void 0:g.fps;YR.isNumber(E)&&(null==YO||YO.updateActualFPS(E))}}return Ue(e,[{key:"init",value:function(){YO&&this.listenEvents()}},{key:"listenEvents",value:function(){YP.on(YT.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),N.once(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.on(e_.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();_._RF.pop(),_._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var YN=globalThis.game.canvasRecorder,YM=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){if(Q.canvas&&YN){YN.setCanvas(Q.canvas);var g=YN.getOptions(),E=YN.waitNextFrame;YN.waitNextFrame=Be(function(){var _;return _ts_generator(this,function(k){switch(k.label){case 0:if(!g.syncFps)return[3,1];_=new Promise(function(g){N.once(e_.EVENT_AFTER_RENDER,g),Q.pause(),Q.step()});return[3,3];case 1:Q.resume();return[4,E.call(YN)];case 2:_=(k.sent(),Promise.resolve());k.label=3;case 3:return[2,_]}})})}}}]),e}();_._RF.pop(),_._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var YD=function(){function e(){var g=this;Fe(this,e),this.hideCocosStats=function(){clearInterval(g.waiter),g.waiter=setInterval(g.checkProfilerReady,100)},this.checkProfilerReady=function(){if(ey){ey._showFPS=!1;var E=ey._rootNode;E&&(E.active=!1,E.isValid&&(E.destroyAllChildren(),E.removeAllChildren(),E.destroy(),clearInterval(g.waiter)))}}}return Ue(e,[{key:"init",value:function(){ey&&N.on(e_.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();_._RF.pop(),_._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var YF=GameCore,YU=YF.Configs.GameEngine.DynamicAssets,Yx=YF.Events,Yz=YF.Utils.Array,YG=globalThis.game,YV=YG.event,YK=YG.storage,YH=[".png",".jpg",".jpeg",".webp"],Yq=function(){function e(){var g=this;Fe(this,e),this.isProcessing=!1,this.useHighQuality=!1,this.upgradableAssets=new Map,this.handleSceneLaunched=function(g){var E=g.sceneName,_=[sJ];Yz.has(_,E)||Q.emit(na,{quality:"highest"})},this.requestUpdateDynamicAssets=function(){Q.emit(ni,{force:!0})},this.collectUpgradableAssets=function(E){var _,k=E.output=E.input,C=YU.Resolution,A=C.Adjust,T=C.Original,R=at(k);try{for(R.s();!(_=R.n()).done;){var I=_.value;if(Yz.has(YH,I.ext)&&!g.upgradableAssets.has(I.uuid)){g.useHighQuality?(I.url=g.replaceAssetUrl(I.url),I.resolution=T,I.upgradeOnNextRequest=!0):A<T&&(I.resolution=A);var L={ext:I.ext,url:I.url,uuid:I.uuid,options:I.options,upgraded:I.upgraded,resolution:I.resolution,upgradeOnNextRequest:I.upgradeOnNextRequest};g.upgradableAssets.set(I.uuid,L)}}}catch(g){R.e(g)}finally{R.f()}},this.replaceAssetUrl=function(E){return g.useHighQuality?E.replace("native/","native32/"):E},this.handleChangeQuality=Be(function(){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:g.isProcessing=!0;_=[],k=at(g.upgradableAssets.values());try{for(k.s();!(E=k.n()).done;){C=E.value,A=g.processUpgradeQualityAsync(C);_.push(A)}}catch(g){k.e(g)}finally{k.f()}return[4,Promise.all(_)];case 1:T=I.sent();g.isProcessing=!1;R=T.filter(function(g){return g}).length;g.requestUpdateDynamicAssets(),console.warn("DynamicAssets: Upgradable Assets Info",{total:R,results:T});return[2]}})})}var g;return Ue(e,[{key:"init",value:function(){var g=YU.Enabled,E=YU.Resolution;console.info("DynamicAssets: init",{EDITOR:tf,Enabled:g}),g&&(eX.instance.transformPipeline.insert(this.collectUpgradableAssets,2),this.initState(),this.listenEvents(),window.requestIdleCallback=window.requestIdleCallback||function(g){g()},E.Adjust,E.Original)}},{key:"initState",value:function(){var g=globalThis.game.getBuildVersion().toString();YK.addStorage("DynamicAssets",{useHighQuality:!1,buildVersion:"0"},!0);var E=YK.getStorage("DynamicAssets"),_=null!=E?E:{},k=_.buildVersion,C=_.useHighQuality;"boolean"==typeof C&&(this.useHighQuality=C&&k===g),YK.setStorageData("DynamicAssets","buildVersion",g)}},{key:"listenEvents",value:function(){var g=this;Q.on(na,this.handleChangeQuality),setTimeout(function(){g.useHighQuality=!0,g.autoUpgradeQuality(),YV.on(Yx.SCENE_LAUNCHED,g.handleSceneLaunched)},4e3)}},{key:"autoUpgradeQuality",value:function(){var g=this;requestIdleCallback(Be(function(){var E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(!g.isProcessing&&!Q.isPaused()))return[3,2];E=tt(g.upgradableAssets.values()).find(function(g){return!g.upgraded&&!g.upgradeOnNextRequest});if(!E)return[2,(YK.setStorageData("DynamicAssets","useHighQuality",!0),void g.requestUpdateDynamicAssets())];console.info("DynamicAssets: Auto upgrade quality",E),g.isProcessing=!0;return[4,g.processUpgradeQualityAsync(E)];case 1:_.sent(),g.isProcessing=!1,g.autoUpgradeQuality();_.label=2;case 2:return[2]}})}),{timeout:1e3})}},{key:"processUpgradeQualityAsync",value:(g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){E=this;if(g.upgraded||g.upgradeOnNextRequest)return[2,!0];_=eX.instance,k=_.assets,C=_.loadAny,A=k.get(g.uuid);return[2,_instanceof(A,er)?(g.url=this.replaceAssetUrl(g.url),new Promise(function(_){C(g,g.options,function(k,C){if(k)return console.warn("DynamicAssets: Upgrade error",k),void _(!1);A.reset(C),g.upgraded=!0,E.upgradableAssets.set(g.uuid,g),Q.emit(nr,{asset:A,item:g}),_(!0)})})):(console.warn("DynamicAssets: Asset not found",g.uuid),!1)]})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var YW=GameCore,Yj=YW.Events,YX=YW.Configs.GameEngine.DynamicAtlas,YY=YX.UsePowerOfTwo,YJ=YX.TextureAtlasOptimize,YQ=YW.Utils,YZ=YQ.Array,Y$=YQ.Json,Y0=YQ.Object,Y1=YQ.Function,Y2=globalThis.game.event,Y4=function(){function e(){var g=this;Fe(this,e),this.atlasTexId=null,this.drawInfo=[],this.atlasInfo=null,this.lastAtlasInfo=null,this.renderTimes=[],this.lastRenderTime=0,this.renderTimeInterval=5e3,this.isEffective=!0,this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1,this.collectInfo={},this.pendingSprites={},this.checkRenderTimeHighers=function(){var E=g.getMeanRenderTime();E>8&&g.handleLaggyFrame(E),N.once(e_.EVENT_AFTER_RENDER,function(){setTimeout(g.checkRenderTimeHighers,g.renderTimeInterval)})},this.resetPendingSprites=function(){g.pendingSprites={}},this.updateBeforeRenderTime=function(){g.lastRenderTime=performance.now()},this.updateAfterRenderTime=function(){g.renderTimes.push(performance.now()-g.lastRenderTime)},this.requestUpdateDynamicAtlas=Y1.throttle(function(E){g.isProcessing||(g.isProcessing=!0,g.forceUpdateDynamicAtlas=(null==E?void 0:E.force)||!1,N.once(e_.EVENT_AFTER_RENDER,g.updateDynamicAtlas))},5e3),this.updateDynamicAtlas=function(){try{var E=N.getScene();if(!E)return;var _=g.collectPackageInfo();if(Object.keys(_).length<1)return;if(g.drawInfo=[],g.atlasInfo=null,g.generateDrawInfo(Y0.vals(_)),!g.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found");if(!g.updateAtlasData()&&!g.forceUpdateDynamicAtlas)return;var k=E.getComponentsInChildren(e0);g.refreshComponents(k)}catch(g){console.error("DynamicAtlas: Error updating dynamic atlas",g)}finally{g.isProcessing=!1,g.forceUpdateDynamicAtlas=!1}},this.generateDrawInfo=function(E){if(!(E.length<1)){console.info("DynamicAtlas: generate draw info",E);var _=E.sort(function(g,E){return E.usageCount-g.usageCount}),k=eQ.instance.textureSize;if(g.calculateOptimizedAtlas(_,k),g.atlasInfo){var C,A=g.atlasInfo.textures,T=at(A);try{for(T.s();!(C=T.n()).done;){var R=C.value;g.drawInfo.push(R)}}catch(g){T.e(g)}finally{T.f()}var I=_.filter(function(g){return!A.some(function(E){return E.id===g.id})});I.length>0&&(console.warn("DynamicAtlas: Missing textures",I),g.generateDrawInfo(I))}else console.warn("DynamicAtlas: Atlas info not found",{textures:_})}},this.calculateOptimizedAtlas=function(E,_){var k=function(g){var E,_=0,k=0,C=at(g);try{for(C.s();!(E=C.n()).done;){var A=E.value;_+=A.w*A.h,k=Math.max(k,A.w)}}catch(g){C.e(g)}finally{C.f()}g.sort(function(g,E){return E.h-g.h});var T,R=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(_/.95)),k),h:1/0}],I=0,L=0,P=at(g);try{for(P.s();!(T=P.n()).done;)for(var O=T.value,B=R.length-1;B>=0;B--){var N=R[B];if(!(O.w>N.w||O.h>N.h)){if(O.x=N.x,O.y=N.y,L=Math.max(L,O.y+O.h),I=Math.max(I,O.x+O.w),O.w===N.w&&O.h===N.h){var M=R.pop();B<R.length&&(R[B]=M)}else O.h===N.h?(N.x+=O.w,N.w-=O.w):O.w===N.w?(N.y+=O.h,N.h-=O.h):(R.push({x:N.x+O.w,y:N.y,w:N.w-O.w,h:O.h}),N.y+=O.h,N.h-=O.h);break}}}catch(g){P.e(g)}finally{P.f()}return{w:I,h:L,fill:_/(I*L)||0}}(E),C=k.w,A=k.h,T=k.fill;if(T<.6)console.warn("DynamicAtlas: Fill rate is too low",T,tt(E));else{if(C>_||A>_)return console.warn("DynamicAtlas: Packed size is bigger than atlas size",C,A,_),void(E.pop()?g.calculateOptimizedAtlas(E,_):console.warn("DynamicAtlas: Texture size is too big",C,A,_));g.atlasInfo={textures:E,atlasSize:_,packedInfo:{width:Math.round(C),height:Math.round(A),fillRate:T}}}},this.drawTexture=function(E,_,k){var C=_.texture,A=C.image;if(!A||A.width<1||A.height<1)console.warn("DynamicAtlas: Texture image not found",C);else if(!A.data||A.data.width<1||A.data.height<1)console.warn("DynamicAtlas: Texture image data not found",A);else{var T=C.getId(),R=YZ.search(tt(g.drawInfo),function(g){return g.id===T})||{x:-1,y:-1},I=R.x,L=R.y;if(!(I<0||L<0)){var P=E._innerTextureInfos[T];P||(k&&(E._texture.drawTextureAt(A,I-1,L),E._texture.drawTextureAt(A,I+1,L),E._texture.drawTextureAt(A,I,L-1),E._texture.drawTextureAt(A,I,L+1)),E._texture.drawTextureAt(A,I,L),E._count++,E._innerTextureInfos[T]={texture:C,x:I,y:L});var O=_.rect,B=O.x,N=O.y;B+=(null==P?void 0:P.x)||I,N+=(null==P?void 0:P.y)||L;var M={texture:E._texture,x:B,y:N};return E._innerSpriteFrames.push(_),M}g.pendingSprites[_.uuid]=_}},this.refreshComponents=function(g){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.node.active&&(k.node.active=!1,k.node.active=!0)}}catch(g){_.e(g)}finally{_.f()}},this.isSameAtlas=function(g,E){if(!g||!E)return!1;var _=g.packedInfo,k=g.textures,C=E.packedInfo,A=E.textures;return _.width===C.width&&_.height===C.height&&k.length===A.length&&k.every(function(g,E){var _=g.id,k=g.w,C=g.h,T=A[E],R=T.id,I=T.w,L=T.h;return _===R&&k===I&&C===L})}}return Ue(e,[{key:"init",value:function(){YJ&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:YJ}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){var g=this;Q.on(ni,this.requestUpdateDynamicAtlas),N.on(e_.EVENT_BEFORE_SCENE_LAUNCH,this.resetPendingSprites),Y2.once(Yj.GAME_READY,function(){g.setupRenderListeners()})}},{key:"setupRenderListeners",value:function(){var g=this;N.on(e_.EVENT_BEFORE_RENDER,this.updateBeforeRenderTime),N.on(e_.EVENT_AFTER_RENDER,this.updateAfterRenderTime),Y2.once(Yj.SCENE_LAUNCHED,function(){N.once(e_.EVENT_AFTER_RENDER,g.checkRenderTimeHighers)})}},{key:"handleLaggyFrame",value:function(g){console.warn("DynamicAtlas: Laggy frame detected, render time: ".concat(g.toFixed(2),"ms")),this.isEffective||(this.renderTimeInterval=Math.min(this.renderTimeInterval+1e3,1e4),console.warn("DynamicAtlas: Atlas update not effective. Increased interval: ".concat(this.renderTimeInterval,"ms"))),this.requestUpdateDynamicAtlas()}},{key:"getMeanRenderTime",value:function(){var g,E=0,_=at(this.renderTimes);try{for(_.s();!(g=_.n()).done;)E+=g.value}catch(g){_.e(g)}finally{_.f()}return E/=this.renderTimes.length,this.renderTimes=[],E}},{key:"overrideDynamicAtlas",value:function(){var g=this,E=eQ.instance;eQ.instance.insertSpriteFrame=function(_){if(E._atlasIndex>=E._maxAtlasCount)return null;if(!_||_.original)return console.warn("DynamicAtlas: Skip original texture",_),null;if(!_.packable)return console.warn("DynamicAtlas: Skip non-packable texture",_),null;var k=g.getAtlas(),C=k?k.insertSpriteFrame(_):null;return!C&&E._atlasIndex<E._maxAtlasCount&&(C=(k=g.getAtlas())?k.insertSpriteFrame(_):null),C}}},{key:"createAtlas",value:function(){return eQ.instance.newAtlas()}},{key:"getAtlas",value:function(){var g=this,E=eQ.instance,_=E._atlases,k=void 0===_?[]:_,C=E._atlasIndex,A=E.textureBleeding,T=k[C];return T||(T=this.createAtlas()),T?(T.originalInsertSpriteFrame||(T.originalInsertSpriteFrame=T.insertSpriteFrame,T.insertSpriteFrame=function(E){return g.drawTexture(T,E,A)}),this.atlasTexId=T._texture.getId(),T):null}},{key:"collectPackageInfo",value:function(){var g,E={},_=at(Y0.vals(this.pendingSprites));try{for(_.s();!(g=_.n()).done;){var k=g.value;if(this.isValidSpriteFrame(k)){var C=k.texture,A=k.original,T=C.getId(),R=null==A?void 0:A._texture.getId();T!==R?(R&&(T=R),this.collectInfo[T]||this.initializeCollectInfo(T,k),this.collectInfo[T].usageCount++,E[T]=this.collectInfo[T]):console.warn("DynamicAtlas: Skip original texture",{texId:T,oriTexId:R})}}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"isValidSpriteFrame",value:function(g){var E=g.packable,_=g.texture,k=g.original,C=g.name,A=g.uuid;if(!E)return console.warn("DynamicAtlas: Skip non-packable texture",C,A),!1;if(!_instanceof(_,e$))return console.warn("DynamicAtlas: Skip non-texture2d texture",C,A),!1;var T=null==k?void 0:k._texture.getId();return this.atlasTexId!==T||(console.warn("DynamicAtlas: Skip texture in atlas",C,A),!1)}},{key:"initializeCollectInfo",value:function(g,E){var _=E.texture,k=E.original,C=E.uuid,A=_.width,T=_.height,R=(null==k?void 0:k._texture)||{width:0,height:0},I=R.width,L=R.height,P=Math.max(A,I)+2,O=Math.max(T,L)+2;P<=1||O<=1?console.warn("DynamicAtlas: Skip invalid texture size",C,{w:P,h:O}):this.collectInfo[g]={id:g,w:P,h:O,x:-1,y:-1,usageCount:0,name:C}}},{key:"updateAtlasData",value:function(){if(!this.atlasInfo)return!1;if(this.lastAtlasInfo&&!this.forceUpdateDynamicAtlas){var g=this.isSameAtlas(this.lastAtlasInfo,this.atlasInfo);if(this.isEffective=!g,g)return console.warn("DynamicAtlas: Last update dynamic atlas is not effective"),!1}console.info("DynamicAtlas: atlas info",this.atlasInfo);var E=this.getAtlas();if(!E||!E._texture)return!1;var _=this.atlasInfo.packedInfo,k=E._texture,C=k.width,A=k.height,T=_.width+20,R=_.height+20,I=Math.max(T,R),L=YY?I:T;return(C!==L||A!==L)&&(eQ.instance.reset(),!(!(E=this.getAtlas())||!E._texture)&&(YY?(E._texture.initWithSize(L,L),console.info("DynamicAtlas: Resize atlas (PO2)",L,E)):(E._texture.initWithSize(T,R),console.info("DynamicAtlas: Resize atlas",T,R,E)),this.lastAtlasInfo=Y$.clone(this.atlasInfo),!0))}}]),e}();_._RF.pop();var Y3={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};_._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var Y5=GameCore.Events,Y6=globalThis.game,Y8=Y6.event,Y9=Y6.language,Y7=function(){function e(){var g=this;Fe(this,e),this.handleLanguageChanged=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){_=E.locale;Q.emit("update-language",_),g.updateComponentInEditor();return[2]})});return function(g){return E.apply(this,arguments)}}()}var g,_,k;return Ue(e,[{key:"init",value:function(){var g=this;this.addLanguage("en").then(function(){g.setLanguage("en"),g.listenEvent()})}},{key:"listenEvent",value:function(){Y8.on(Y5.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,this.getLangData(g)];case 1:E=_.sent();Y9.add(g,E);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setLanguage",value:function(g){Y9.choose(g)}},{key:"getLangData",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(g){case"en":return[2,Y3];case"ru":return[2,this.loadLanguageAsync(g)];default:throw new Error("Language ".concat(g," not supported"))}return[2]})}),function(g){return _.apply(this,arguments)})},{key:"loadLanguageAsync",value:(g=Be(function(g){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,E.import("db://assets/resources/locales/".concat(g,".json"))];case 1:_=k.sent().default;Y9.add(g,_);return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"updateComponentInEditor",value:function(){}}]),e}();_._RF.pop(),_._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var Jt=GameCore,Jn=Jt.Configs,Ji=Jn.Mockup,Jr=Ji.Leaderboards,Ja=Ji.GameSDK.Player,Jo=Jn.Leaderboards,Js=Jt.Utils.Number,Jl=globalThis.game.leaderboard,Ju=function(){function e(){var g=this;Fe(this,e),this.handleWhenGameSDKStarted=function(){Jr.Enabled?g.setupLeaderboardsMockup():g.setupLeaderboards()}}var g,E,_,k,C;return Ue(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(C=Be(function(){return _ts_generator(this,function(g){this.setupLeaderboardByConfigs();return[2]})}),function(){return C.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var g=Jo.LeaderboardId;g?(Jl.addLeaderboard({name:sH,type:"global",autoSortRank:!0,leaderboardId:g}),Jl.addLeaderboard({name:sq,type:"friends",autoSortRank:!0,leaderboardId:g})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(k=Be(function(){return _ts_generator(this,function(g){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard();return[2]})}),function(){return k.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(_=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=sH,E=sW,_=Jr.NumOfLeaders;return[4,Jl.createLeaderboardAsync({_id:E,name:g,numberOfLeaders:Js.random(_.Max-_.Min)+_.Min})];case 1:k=A.sent();Jl.addLeaderboard({name:g,type:"global",autoSortRank:!0,leaderboardId:k});return[4,Jl.requestLeaderboardAsync(g,10)];case 2:A.sent();C=Jl.getLeaderboard(g);console.info("setupGlobalLeaderboard fetch new",C,C&&Object.keys(C.leaders).length),C=Jl.getLeaderboard(g),console.info("setupGlobalLeaderboard load more",C,C&&Object.keys(C.leaders).length);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(E=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=sq,E=sj,_=0,k=Ja.ConnectedPlayers;k.Enabled&&(_=Js.random(k.NumOfPlayers-1)+1);return[4,Jl.createLeaderboardAsync({_id:E,name:g,numberOfLeaders:_})];case 1:C=T.sent();Jl.addLeaderboard({name:g,type:"friends",autoSortRank:!0,leaderboardId:C});return[4,Jl.requestLeaderboardAsync(g,10)];case 2:T.sent();A=Jl.getLeaderboard(g);console.info("setupFriendsLeaderboard done",A);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(g=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:return[4,ut.requestTournamentDataAsync()];case 1:g=E.sent();g.forEach(function(g){var E=g.payload.leaderboardId;E&&(Jl.isExistLeaderboardId(E)||Jl.addLeaderboard({type:"tournament",name:E,autoSortRank:!0,leaderboardId:E}))}),console.info("setupGlobalTournamentLeaderboard done",g);return[2]}})}),function(){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var Jc=GameCore,Jh=Jc.Utils,Jp=Jc.Events,Jd=Jc.Configs.PerformanceMonitor.FpsTracking,Jf=globalThis.game.event,Jy=function(){function e(){var g=this;Fe(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){g.startTraceFps(),N.on(e_.EVENT_AFTER_UPDATE,g.handleLateUpdate)},this.handleLateUpdate=function(){if(g.mark){if(g.fpsTraceDuration-=Q.deltaTime,g.fpsTraceDuration<=0&&!g.traceStopped)return g.traceStopped=!0,g.unListenEvents(),g.updateFPS(),void g.mark.stop(g.markName);g.fpsTraceIntervalTimer-=Q.deltaTime,g.fpsTraceIntervalTimer>0||(g.fpsTraceIntervalTimer=g.fpsTraceInterval,g.updateFPS(),g.mark.stop(g.markName),g.startTraceFps())}}}return Ue(e,[{key:"mark",get:function(){return Jd.Enabled?Jh.Mark:null}},{key:"init",value:function(){var g=Jd.TrackingDuration,E=Jd.TrackingInterval;this.fpsTraceDuration=null!=g?g:60,this.fpsTraceInterval=null!=E?E:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){Jf.once(Jp.GAME_READY,this.handleStartTraceFps)}},{key:"unListenEvents",value:function(){N.off(e_.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var g,E;if(this.mark){var _=this.getFPS(),k=this.getDrawCalls(),C=this.getDeviceRender(),A=this.getTextureMemory();this.minFps=Math.min(null!==(g=this.minFps)&&void 0!==g?g:_,_),this.maxFps=Math.max(null!==(E=this.maxFps)&&void 0!==E?E:0,_),this.mark.putMetric(this.markName,"FPS Metric",_),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",C),this.mark.putAttr(this.markName,"Draw Calls",k.toString()),this.mark.putAttr(this.markName,"Texture Memory",A.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info("FPS: ".concat(_," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(k,", texture memory: ").concat(A.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!N.root)return 0;var g=N.root.fps;return Math.floor(g)||0}},{key:"getDrawCalls",value:function(){return N.root&&N.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return N.root&&N.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return N.root&&N.root.device.memoryStatus.textureSize/1048576||0}}]),e}();_._RF.pop(),_._RF.push({},"d5789HUcoJBYr7E3NOGuQyN","Profiler",void 0);var Jv=GameCore,Jg=Jv.Utils.Valid,Jm=Jv.Configs.Debugger.Profiler,Jb=globalThis.game.event,Jw=function(){function e(){var g=this;Fe(this,e),this.isUpdated=!1,this.isPost=!1,this.isDrawn=!1,this.isCommitted=!1,this.isRendered=!1,this.isFramed=!1,this.waitOptions={timeout:0,checkInterval:1},this.initState=function(){g.isFramed=!1,g.isUpdated=!1,g.isDrawn=!1,g.isCommitted=!1,g.isRendered=!1,g.isPost=!1},this.startTraceLoop=function(){g.clearLoopEvents(),g.initState(),g.useTickAsync(),g.listenLoopEvents()},this.handleBeginFrame=function(){g.measure("Frame",g.processBeginFrame)},this.processBeginFrame=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isFramed=!1,console.time("Frame");return[4,Jg.isValueChangeAsync(function(){return g.isFramed},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Frame");return[2]}})}),this.handleBeforeUpdate=function(){g.measure("Update",g.processBeforeUpdate)},this.processBeforeUpdate=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isUpdated=!1,console.time("Update");return[4,Jg.isValueChangeAsync(function(){return g.isUpdated},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Update");return[2]}})}),this.handleAfterUpdate=function(){g.isUpdated=!0},this.handleBeforeDraw=function(){g.measure("Draw",g.processBeforeDraw)},this.processBeforeDraw=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isDrawn=!1,console.time("Draw");return[4,Jg.isValueChangeAsync(function(){return g.isDrawn},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Draw");return[2]}})}),this.handleBeforeCommit=function(){g.measure("Commit",g.processBeforeCommit)},this.processBeforeCommit=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isCommitted=!1,console.time("Commit");return[4,Jg.isValueChangeAsync(function(){return g.isCommitted},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Commit");return[2]}})}),this.handleBeforeRender=function(){g.isCommitted=!0,g.measure("Render",g.processBeforeRender)},this.processBeforeRender=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isRendered=!1,console.time("Render");return[4,Jg.isValueChangeAsync(function(){return g.isRendered},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Render");return[2]}})}),this.handleAfterRender=function(){g.isRendered=!0},this.handleAfterDraw=function(){g.isDrawn=!0,g.measure("Post",g.processPost)},this.processPost=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isPost=!1,console.time("Post");return[4,Jg.isValueChangeAsync(function(){return g.isPost},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Post");return[2]}})}),this.handleEndFrame=function(){g.isPost=!0,g.isFramed=!0,g.restoreTick()}}var g,E;return Ue(e,[{key:"profiler",get:function(){return globalThis.game.profiler}},{key:"init",value:function(){Jm.Enabled&&(this.initState(),this.addTickAsync(),this.listenEvents())}},{key:"addTickAsync",value:function(){var g=this;N.originalTick=N.tick,N.tickAsync=function(){var E=Be(function(E){var _,k,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:if(!!this._invalid)return[3,8];return[4,g.emitAsync(e_.EVENT_BEGIN_FRAME)];case 1:if(L.sent(),!!this._paused)return[3,4];return[4,g.emitAsync(e_.EVENT_BEFORE_UPDATE)];case 2:L.sent(),this._compScheduler.startPhase(),this._compScheduler.updatePhase(E);for(k=0;k<this._systems.length;++k)this._systems[k].update(E);this._compScheduler.lateUpdatePhase(E);return[4,g.emitAsync(e_.EVENT_AFTER_UPDATE)];case 3:L.sent(),e1._deferredDestroy();for(A=0;A<this._systems.length;++A)this._systems[A].postUpdate(E);L.label=4;case 4:return[4,g.emitAsync(e_.EVENT_BEFORE_DRAW)];case 5:L.sent();T=null===(_=N.getScene())||void 0===_?void 0:_.getComponentsInChildren("UIRenderer");if(!T)return[3,8];I=at(T);try{for(I.s();!(R=I.n()).done;)R.value.updateRenderer()}catch(g){I.e(g)}finally{I.f()}this._root.frameMove(E);return[4,g.emitAsync(e_.EVENT_AFTER_DRAW)];case 6:L.sent(),C.resetHasChangedFlags(),C.clearNodeArray();return[4,g.emitAsync(e_.EVENT_END_FRAME)];case 7:L.sent(),this._totalFrames++;L.label=8;case 8:return[2]}})});return function(g){return E.apply(this,arguments)}}()}},{key:"emitAsync",value:(E=Be(function(g){var E,_,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(L){switch(L.label){case 0:for(E=I.length,_=new Array(E>1?E-1:0),k=1;k<E;k++)_[k-1]=I[k];return[4,this.waitEvent.apply(this,[g].concat(_))];case 1:L.sent(),N.emit.apply(N,[g].concat(_));A=this.getListeners(g),T=at(A);try{for(T.s();!(C=T.n()).done;){R=C.value;R.check=R.originalCheck}}catch(g){T.e(g)}finally{T.f()}return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"useTickAsync",value:function(){N.tick=N.tickAsync}},{key:"restoreTick",value:function(){N.tick=N.originalTick}},{key:"getListeners",value:function(g){return N._callbackTable[g].callbackInfos||[]}},{key:"waitEvent",value:(g=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){for(E=T.length,_=new Array(E>1?E-1:0),k=1;k<E;k++)_[k-1]=T[k];C=this.getListeners(g);if(0!==C.length){A=C.map(function(E){var k=E.target,C=E.callback;return E.originalCheck||(E.originalCheck=E.check),E.check=function(){return!1},new Promise(function(E){var A="Wait ".concat(g," (").concat(k,":").concat(C.name,")");console.time(A),k?C.call.apply(C,[k].concat(_)):C.apply(void 0,_),E(!0),console.timeEnd(A)})});return[2,Promise.all(A)]}return[2]})}),function(E){return g.apply(this,arguments)})},{key:"listenEvents",value:function(){Jb.on("render",this.startTraceLoop)}},{key:"listenLoopEvents",value:function(){N.once(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.once(e_.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),N.once(e_.EVENT_AFTER_UPDATE,this.handleAfterUpdate),N.once(e_.EVENT_BEFORE_DRAW,this.handleBeforeDraw),N.once(e_.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),N.once(e_.EVENT_BEFORE_RENDER,this.handleBeforeRender),N.once(e_.EVENT_AFTER_RENDER,this.handleAfterRender),N.once(e_.EVENT_AFTER_DRAW,this.handleAfterDraw),N.once(e_.EVENT_END_FRAME,this.handleEndFrame)}},{key:"clearLoopEvents",value:function(){N.off(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.off(e_.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),N.off(e_.EVENT_AFTER_UPDATE,this.handleAfterUpdate),N.off(e_.EVENT_BEFORE_DRAW,this.handleBeforeDraw),N.off(e_.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),N.off(e_.EVENT_BEFORE_RENDER,this.handleBeforeRender),N.off(e_.EVENT_AFTER_RENDER,this.handleAfterRender),N.off(e_.EVENT_AFTER_DRAW,this.handleAfterDraw),N.off(e_.EVENT_END_FRAME,this.handleEndFrame)}},{key:"measure",value:function(g,E,_){var k,C=!(arguments.length>2&&void 0!==_)||_;null===(k=this.profiler)||void 0===k||k.measureCode({name:g,isAsync:C,profile:g,callback:E})}}]),e}();_._RF.pop(),_._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var JS=GameCore.Events,JE=globalThis.game.event,J_=function(){function e(){Fe(this,e),this.handleHotReload=function(){Q.restart()},this.handleUpdateConfig=function(g){if("Gameplay"===g.type){Q.emit(t8,g.config);var E=g.id,_=g.type;JE.emit(JS.REMOTE_CONFIG_UPDATED,{id:E,type:_})}}}return Ue(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){JE.on(JS.REQUEST_HOT_RELOAD,this.handleHotReload),JE.on(JS.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();_._RF.pop(),_._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var Jk=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}},{key:"initProfiler",value:function(){(new Jw).init()}},{key:"initLanguages",value:function(){(new Y7).init()}},{key:"initCocosStats",value:function(){(new YD).init()}},{key:"initLeaderboards",value:function(){(new Ju).init()}},{key:"initRemoteConfig",value:function(){(new J_).init()}},{key:"initDynamicAtlas",value:function(){(new Y4).init()}},{key:"initDynamicAssets",value:function(){(new Yq).init()}},{key:"initCanvasRecorder",value:function(){(new YM).init()}},{key:"initPerformanceMonitor",value:function(){(new Jy).init()}},{key:"initAdaptivePerformance",value:function(){(new YB).init()}}]),e}();_._RF.pop(),_._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var JC=globalThis.game,JA=JC.event,JT=JC.monitorError,JR=GameCore,JI=JR.Events,JL=JR.Configs.PerformanceMonitor,JP=JR.Utils.Mark,JO=function(){function e(){var g=this;Fe(this,e),this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var E=Be(function(E){var _,k,C;return _ts_generator(this,function(A){_=E.sceneName,k=E.sceneData,C=g.correctSceneName(_);console.info("Switching",C,null!=k?k:{}),C&&(l1.showLoadingFullScreen(C),g.startScene({sceneName:C,sceneData:k}));return[2]})});return function(g){return E.apply(this,arguments)}}(),this.preloadScene=function(E,_){var k=E.sceneName;g.startMeasure(k),N.preloadScene(k,g.onSceneProgress,g.onScenePreloaded(k,_))},this.startMeasure=function(E){g.mark&&(g.queueLoadScene[E]&&(g.mark.putAttr(g.markName,"Canceled","true"),g.stopMeasure(E)),console.groupCollapsed("\uD83D\uDCE6 ".concat(E,": loading progress")),g.mark.measure(g.markName),g.mark.putAttr(g.markName,"Cancel","false"),g.mark.putAttr(g.markName,"Success","false"),g.mark.putMetric(g.markName,E),g.mark.start(g.markName),g.queueLoadScene[E]=!0)},this.stopMeasure=function(E){g.mark&&g.queueLoadScene[E]&&(g.mark.rmAttr(g.markName,"File"),g.mark.putAttr(g.markName,"Success","true"),g.mark.stop(g.markName),g.queueLoadScene[E]=!1,console.groupEnd())},this.onSceneProgress=function(E,_,k){var C=E/_;g.mark&&g.mark.putAttr(g.markName,"Last File","".concat(k.id," (").concat(k.ext,")"));var A=Math.floor(70*C+30);GameSDK.setLoadingProgress(A)},this.onScenePreloaded=function(g,E){return function(_){_?console.warn("SceneManager.onScenePreloaded",{sceneName:g,error:_}):(E&&E(g,_),JA.emit(JI.SCENE_LOADED,{sceneName:g,isPreload:!0}))}},this.onDirectorLoadScene=function(E){return function(_,k){if(_)console.warn("SceneManager.onSceneLoaded",_);else if(null!=k&&k.scene){var C=k.name;g.handleBeforeSceneLaunch(k,E)(),N.once(e_.EVENT_AFTER_SCENE_LAUNCH,g.handleSceneLaunched(C,E))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(E,_){return function(){g.setSceneData(E,null!=_?_:{}),Q.emit(t5),JA.emit(JI.SCENE_LOADED,{sceneName:E.name})}},this.handleSceneLaunched=function(E,_){return function(){var k;l1.hideLoadingFullScreen(E),i_.switchSceneTracking(),null==JT||JT.addMetadata({currentScene:E}),null===(k=g.callbackSwitchScene)||void 0===k||k.call(g,{sceneName:E,sceneData:_}),JA.emit(JI.SCENE_LAUNCHED,{sceneName:E})}},this.handleSceneLoaded=function(E){var _=E.sceneName;g.stopMeasure(_)}}return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){JA.on(JI.SWITCH_SCENE,this.switchScene),JA.on(JI.PRELOAD_SCENE,this.preloadScene),JA.on(JI.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(g){var E=this.getCurrentScene();return E&&g===E.name?null:g}},{key:"startScene",value:function(g){var E=this,_=g.sceneName,k=g.sceneData;this.preloadScene({sceneName:_},function(g,C){g===_&&(C?console.warn("SceneManager.startScene",{sceneName:_,error:C}):N.loadScene(_,E.onDirectorLoadScene(k)))})}},{key:"mark",get:function(){return JL.LoadResources?JP:null}},{key:"getCurrentScene",value:function(){return N.getScene()}},{key:"getLoadedScenes",value:function(){var g=this,E=[];return Object.keys(this.queueLoadScene).map(function(_){g.queueLoadScene[_]||E.push(_)}),E}},{key:"onSwitchScene",value:function(g){this.callbackSwitchScene=g}},{key:"setSceneData",value:function(g,E){if(E&&("data"in g||g.scene.attr({data:{}}),"data"in g)){var _=g.data||{};g.scene.attr({data:Me(Me({},_),E)}),console.info("SceneManager.setSceneData",{sceneName:g.name,sceneData:E,currentData:_})}}}]),e}();_._RF.pop(),_._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var JB=globalThis.game,JN=JB.event,JM=JB.monitorError,JD=GameCore,JF=JD.Events,JU=JD.Utils.Object,Jx=function(){function e(){var g=this;Fe(this,e),this.screens={},this.handleOpenScreen=function(E){var _=E.screenName,k=E.screenData;g.openScreen(_,k)},this.handleCloseScreen=function(E){var _=E.screenName;g.closeScreen(_)}}var g,E,_,k;return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){JN.on(JF.OPEN_SCREEN,this.handleOpenScreen),JN.on(JF.CLOSE_SCREEN,this.handleCloseScreen)}},{key:"reorderScreens",value:function(){var g=JU.vals(this.screens).filter(function(g){return"ready"===g.state});g.sort(function(g,E){return g.order-E.order});for(var E=0;E<g.length;E++){var _=g[E];_.order=E,_.comp.node.setSiblingIndex(_.order)}}},{key:"addScreenKeys",value:function(g,E){var _=this;g.forEach(function(g,k){_.screens[im[g]]&&(_.screens[im[g]].order=k),_.screens[im[g]]={state:"key",parent:E,key:g,order:k}})}},{key:"addScreens",value:function(g){var E=this;g.forEach(function(g,_){E.screens[g.node.name]={state:"ready",comp:g,order:_}})}},{key:"preloadScreens",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=JU.vals(this.screens).reduce(function(g,E){if("key"===E.state){var _=n7.loadPrefabAsync("screens/".concat(im[E.key]));g.push(_)}return g},[]);return[4,Promise.all(g)];case 1:return[2,E.sent()]}})}),function(){return k.apply(this,arguments)})},{key:"getScreen",value:(_=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(L){switch(L.label){case 0:E=this.screens[g];if(null==E)return[2,(null==JM||JM.sendException(new Error("ScreenManager.openScreen Screen ".concat(g," not found")),{screenName:g,screens:this.getScreensAsMetadata()}),null)];if("ready"===E.state)return[2,E.comp];console.info("ScreenManager.getScreen","Screen ".concat(g," not found in cache, instantiating it..."));_=E.parent,k=E.key,C=E.order;return[4,n7.loadPrefabAsync("screens/".concat(im[k]))];case 1:A=L.sent();if(!A)return[2,(null==JM||JM.sendException(new Error("ScreenManager.getScreen: Failed to load Screen ".concat(g," prefab...")),{screenName:g,screens:this.getScreensAsMetadata()}),null)];T=I(A);T.name=g,_.addChild(T),T.active=!1;R=T.getComponent(xj);return[2,R?(this.screens[g]={state:"ready",comp:R,order:C},this.reorderScreens(),R):(null==JM||JM.sendException(new Error("ScreenManager.getScreen: Screen ".concat(g," prefab doesn't have BaseScreen component...")),{screenName:g,screens:this.getScreensAsMetadata()}),null)]}})}),function(g){return _.apply(this,arguments)})},{key:"getScreensAsMetadata",value:function(){var g=this;return Object.keys(this.screens).map(function(E){var _=g.screens[E];return"ready"===_.state?"".concat(_.comp.node.name,"(loaded)"):"".concat(im[_.key],"(not-loaded)")}).join(", ")}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:(E=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,3,,4]);n7.setBlockInput(!0);return[4,this.getScreen(g)];case 1:_=A.sent();if(n7.setBlockInput(!1),null==_||!_.node)return[2,void console.warn("ScreenManager.openScreen","Screen ".concat(g," not found"))];_.node.active=!0,_.node.setPosition(new em(0,0,0));k={screenName:g,screenData:E};JN.emit(JF.OPENING_SCREEN,k),i_.trackCurrentPage(g,!0),null==JM||JM.addMetadata({currentScreen:g});return[4,tZ.waitTweenAsync(0)];case 2:A.sent(),_.open(E),JN.emit(JF.OPENED_SCREEN,k);return[3,4];case 3:C=A.sent();console.error("ScreenManager.openScreen",C);return[3,4];case 4:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"closeScreen",value:(g=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,2,,3]);return[4,this.getScreen(g)];case 1:_=A.sent();if(!_)return[2,void console.warn("ScreenManager.closeScreen","Screen ".concat(g," not found"))];if(null===(E=_.node)||void 0===E||!E.active)return[2];k={screenName:g};JN.emit(JF.CLOSING_SCREEN,k),_.close(),i_.trackCurrentPage(g,!1),null==JM||JM.removeMetadata("currentScreen");return[3,3];case 2:C=A.sent();console.error("ScreenManager.closeScreen",C);return[3,3];case 3:return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"closeAllScreens",value:function(){for(var g in this.screens)"ready"===this.screens[g].state&&this.closeScreen(g)}}]),e}();_._RF.pop(),_._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var Jz=GameCore,JG=Jz.Configs.Core,JV=Jz.Events,JK=Jz.Plugins.Analytics.Events,JH=globalThis.game,Jq=JH.context,JW=JH.storage,Jj=JH.event,JX=JH.analytics,JY=JH.monitorError;new(function(){function e(){var g=this;Fe(this,e),this.coreManager=new Xj,this.adsManager=new XV,this.matchManager=new Yg,this.sceneManager=new JO,this.screenManager=new Jx,this.engineManager=new X1,this.layoutManager=new Ya,this.playerManager=new YC,this.pluginsManager=new Jk,this.handleWhenCoreBoot=function(){Q.inited?g.handleCocosInit():Q.once(e2.EVENT_POST_PROJECT_INIT,g.handleCocosInit)},this.handleCocosInit=function(){g.coreManager.requestStart()},this.handleWhenCoreStart=function(){g.playerManager.setupDefaultGameData(),g.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){g.initPlugins(),console.groupEnd(),JX.event(JK.LOAD_START),JG.StartSDKAfterLoadGame?Jj.once(JV.SCENE_LOADED,g.handleStartGameWhenMainSceneReady):g.processStartGame(),g.preloadScenes()},this.handleStartGameWhenMainSceneReady=function(){g.processStartGame()},this.handleSwitchScene=function(E){var _=E.sceneName,k=g.sceneManager.getCurrentScene();if((null==k?void 0:k.name)===_){g.screenManager.closeAllScreens(),g.screenManager.clearScreens();var C=null==k?void 0:k.getComponentsInChildren(xj);if(C.length>0){var A=C.map(function(g){return g.node.name}).join(", ");console.info("\uD83D\uDCFA Loaded Screens in ".concat(_,": ").concat(A)),g.screenManager.addScreens(C)}var T=null==k?void 0:k.getComponentInChildren(zl);if(T){var R=T.screenKeys.filter(function(g){return!C.some(function(E){return E.node.name===im[g]})});if(0!==R.length){var I=R.map(function(g){return im[g]}).join(", ");console.info("\uD83D\uDCFA Lazy-loading Screens in ".concat(_,": ").concat(I)),g.screenManager.addScreenKeys(R,T.node),g.screenManager.preloadScreens()}}}},console.groupCollapsed("\uD83D\uDCE6 Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}var g,E,_;return Ue(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.adsManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"preloadScenes",value:function(){"solo"===JW.getStorageData("context","sessionContextType")?lU.preloadDashboardScene():lU.preloadGameScene()}},{key:"processStartGame",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:console.groupEnd(),JX.event(JK.LOAD_COMPLETE);return[4,this.startGameAsync()];case 1:g.sent(),this.startProcessContextData();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"startGameAsync",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,GameSDK.startGameAsync()];case 1:E.sent();return[3,3];case 2:g=E.sent();console.warn("GameSDK.startGameAsync",g),_instanceof(g,Error)&&(null==JY||JY.sendException(g));return[3,3];case 3:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"startProcessContextData",value:(g=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!Jj.getEventEmitCount(JV.PLAYER_INFO_LOADED))return[3,6];JX.event(JK.APP_READY);E.label=1;case 1:E.trys.push([1,3,4,5]);this.playerManager.requestConnectedPlayers();return[4,Jq.processContextData()];case 2:E.sent();return[3,5];case 3:g=E.sent();console.error("startProcessContextData",g),_instanceof(g,Error)&&(null==JY||JY.sendException(g));return[3,5];case 4:Jj.emit(JV.GAME_READY);return[7];case 5:return[3,7];case 6:Jj.once(JV.PLAYER_INFO_LOADED,this.startProcessContextData);E.label=7;case 7:return[2]}})}),function(){return g.apply(this,arguments)})},{key:"initPlugins",value:function(){this.pluginsManager.initProfiler(),this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),_._RF.pop()}}});(function(g){g("virtual:///prerequisite-imports/main","chunks:///main.js")})(function(g,E){System.register(g,[E],function(g,E){return{setters:[function(E){var _={};for(var k in E)if("default"!==k&&"__esModule"!==k)_[k]=E[k];g(_)}],execute:function(){}}})});