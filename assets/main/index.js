System.register("chunks:///main.js",["./renderCustomShareScore-f8229879.js","./rollupPluginModLoBabelHelpers-487c63b6.js","cc"],(function(){var e,t,n,i,a,o,r,l,s,u,c,h,p,d,y,v,f,g,m,b,w,k,S,C,E,A,T,R,P,O,I,L,_,D,M,N,z,B,F,x,U,G,H,V,q,W,K,j,Y,X,Z,J,Q,$,ee,te,ne,ie,ae,oe,re,le,se,ue,ce,he,pe,de,ye,ve,fe,ge,me,be,we,ke,Se,Ce,Ee,Ae,Te,Re,Pe,Oe,Ie,Le,_e,De,Me,Ne,ze,Be,Fe,xe,Ue,Ge,He,Ve,qe,We,Ke,je,Ye,Xe,Ze,Je,Qe,$e,et,tt,nt,it,at,ot,rt;return{setters:[function(D){e=D.A,t=D.G,n=D.a,i=D.C,a=D.b,o=D.c,r=D.d,l=D.e,s=D.f,u=D.R,c=D.g,h=D.L,p=D.h,d=D.I,y=D.T,v=D.i,f=D.E,g=D.j,m=D.k,b=D.S,w=D.l,k=D.m,S=D.n,C=D.o,E=D.p,A=D.q,T=D.r,R=D.s,P=D.t,O=D.u,I=D.v,L=D.w,_=D.x},function(e){D=e._,M=e.f,N=e.c,z=e.d,B=e.a,F=e.b,x=e.e,U=e.g,G=e.h,H=e.i,V=e.j,q=e.k,W=e.l,K=e.m,j=e.n,Y=e.o,X=e.p,Z=e.q},function(e){J=e.cclegacy,Q=e._decorator,$=e.UITransform,ee=e.CCInteger,te=e.CCFloat,ne=e.Widget,ie=e.tween,ae=e.Layout,oe=e.game,re=e.Component,le=e.ccenum,se=e.Sprite,ue=e.Enum,ce=e.easing,he=e.UIOpacity,pe=e.EventHandler,de=e.animation,ye=e.CCBoolean,ve=e.Button,fe=e.Input,ge=e.Node,me=e.Graphics,be=e.Color,we=e.Label,ke=e.profiler,Se=e.sys,Ce=e.EventTarget,Ee=e.ParticleSystem2D,Ae=e.math,Te=e.View,Re=e.ProgressBar,Pe=e.Vec2,Oe=e.Vec3,Ie=e.CCString,Le=e.director,_e=e.Director,De=e.Layers,Me=e.find,Ne=e.randomRangeInt,ze=e.SpriteFrame,Be=e.Animation,Fe=e.pseudoRandomRangeInt,xe=e.pseudoRandom,Ue=e.randomRange,Ge=e.instantiate,He=e.Pool,Ve=e.Prefab,qe=e.repeat,We=e.lerp,Ke=e.approx,je=e.EPSILON,Ye=e.RealCurve,Xe=e.Gradient,Ze=e.bits,Je=e.random,Qe=e.Material,$e=e.toRadian,et=e.HorizontalTextAlignment,tt=e.Tween,nt=e.AnimationClip,it=e.Canvas,at=e.ScrollView,ot=e.NodeEventType,rt=e.Mask}],execute:function(){var lt,st,ut,ct,ht,pt,dt,yt,vt,ft,gt,mt,bt,wt,kt,St,Ct,Et,At,Tt;J._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var Rt,Pt=Q.ccclass,Ot=Q.property,It=(lt=Pt("AutoLayoutWrappee"),st=Ot({type:$}),ut=Ot({type:$}),lt((pt=D((ht=M((function e(){N(this,e),z(this,"wrapeeContainer",pt,this),z(this,"wrapee",dt,this)}))).prototype,"wrapeeContainer",[st],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dt=D(ht.prototype,"wrapee",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ct=ht))||ct),Lt=(yt=Pt("AutoLayout"),vt=Ot({displayName:"Use Auto Layout"}),ft=Ot({type:[It],displayName:"Children",visible:function(){return this.useAutoLayout}}),gt=Ot({visible:!1,serializable:!0}),mt=Ot({type:ee,displayName:"Selected Index",visible:function(){return this.useAutoLayout}}),bt=Ot({type:te,displayName:"Deselected Icon Width",group:"Edge Icons",visible:function(){return this.useAutoLayout}}),wt=Ot({visible:!1,serializable:!0}),yt((Ct=D((St=function(t){B(a,t);var n,i=F(a);function a(){var e;N(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),z(e,"useAutoLayout",Ct,x(e)),z(e,"children",Et,x(e)),e.mappedChildren=[],z(e,"selected",At,x(e)),z(e,"deselectedIconW",Tt,x(e)),e.tweens=[],e}return M(a,[{key:"selectedIndex",get:function(){return this.selected},set:function(e){this.selected=e,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(e){this.deselectedIconW=e,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map((function(e){var t=e.wrapeeContainer.getComponent(ne);if(!t)throw new Error("AutoLayout: Widget component not found");return U(U({},e),{},{wrapeeContainerWidget:t})}))}},{key:"updateLayout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._layoutDirty||e){this.updateChildrenAnchors();var t,n=G(this.mappedChildren);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.wrapeeContainerWidget.updateAlignment()}}catch(e){n.e(e)}finally{n.f()}}H(V(a.prototype),"updateLayout",this).call(this,e)}},{key:"getSelectedWorldX",value:function(){var e=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?e.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*e.width:e.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(e){if(e<this.selectedIndex)return 0;if(e>this.selectedIndex)return 1;if(0===e){var t=this.mappedChildren[e].wrapeeContainer.width,n=this.deselectedIconWidth/2,i=this.paddingLeft;return((i+t+(t-n+this.spacingX))/2-i)/t}if(e===this.children.length-1){var a=this.mappedChildren[e].wrapeeContainer.width,o=a-this.deselectedIconWidth/2+this.spacingX;return((o+a+this.paddingRight)/2-o)/a}return.5}},{key:"updateChildrenAnchors",value:(n=q((function*(){var t,n=this,i=G(this.tweens);try{for(i.s();!(t=i.n()).done;)t.value.stop()}catch(e){i.e(e)}finally{i.f()}this.tweens=[],yield Promise.all([this.children.flatMap((function(e,t){return n.getChildrenAnchorsTweens(e,n.getAnchorX(t))})).map((function(t){return e.runTweenAsync(t)}))])})),function(){return n.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var e=this;this.children.forEach((function(t,n){var i=e.getAnchorX(n);t.wrapee.setAnchorPoint(i,t.wrapee.anchorY),t.wrapeeContainer.setAnchorPoint(i,t.wrapeeContainer.anchorY)}))}},{key:"getChildrenAnchorsTweens",value:function(e,t){return[ie(e.wrapee).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapee.setAnchorPoint(t,e.wrapee.anchorY)})),ie(e.wrapeeContainer).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapeeContainer.setAnchorPoint(t,e.wrapeeContainer.anchorY)}))]}}]),a}(ae)).prototype,"useAutoLayout",[vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Et=D(St.prototype,"children",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),At=D(St.prototype,"selected",[gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),D(St.prototype,"selectedIndex",[mt],Object.getOwnPropertyDescriptor(St.prototype,"selectedIndex"),St.prototype),D(St.prototype,"deselectedIconWidth",[bt],Object.getOwnPropertyDescriptor(St.prototype,"deselectedIconWidth"),St.prototype),Tt=D(St.prototype,"deselectedIconW",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kt=St))||kt);J._RF.pop(),J._RF.push({},"ed5c6D+6KVEj5lrgtq+D9bJ","LayoutUtils",void 0);var _t,Dt=n.Layout,Mt=function(){function e(){N(this,e),this.currentLayout="",oe.off(t.LAYOUT_CHANGED,e.onLayoutChanged),oe.on(t.LAYOUT_CHANGED,e.onLayoutChanged)}return M(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getCurrentLayout",value:function(){return this.inst.currentLayout}},{key:"isPortrait",value:function(){return this.inst.currentLayout===Dt.Portrait}},{key:"isLandscape",value:function(){return this.inst.currentLayout===Dt.Landscape}}]),e}();Rt=Mt,Mt.onLayoutChanged=function(e){Rt.inst.currentLayout!==e&&(Rt.inst.currentLayout=e,oe.emit(t.ORIENTATION_CHANGED,e))};try{new Mt}catch(e){console.error("LayoutUtils",e)}J._RF.pop(),J._RF.push({},"32a77jcKOREvpuCe9wamBRu","Background",void 0);(0,Q.ccclass)("Background")(_t=function(e){B(a,e);var n=F(a);function a(){return N(this,a),n.apply(this,arguments)}return M(a,[{key:"__preload",value:function(){this.uiTransform=this.getComponent($),this.ratio=this.uiTransform.width/this.uiTransform.height,this.listenGameEvents(),this.handleViewResized()}},{key:"listenGameEvents",value:function(){oe.on(t.ORIENTATION_CHANGED,this.handleViewResized,this),oe.on(t.VIEW_RESIZED,this.handleViewResized,this)}},{key:"unlistenGameEvents",value:function(){oe.off(t.VIEW_RESIZED,this.handleViewResized,this),oe.off(t.ORIENTATION_CHANGED,this.handleViewResized,this)}},{key:"handleViewResized",value:function(){if(Mt.isPortrait()){var e=i.cssSizeToWorldSize(i.getScreenHeightCss());this.uiTransform.width=e*this.ratio,this.uiTransform.height=e}else if(Mt.isLandscape()){var t=i.cssSizeToWorldSize(i.getScreenWidthCss());this.uiTransform.width=t,this.uiTransform.height=t/this.ratio}}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}}]),a}(re));J._RF.pop(),J._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var Nt="STARS_UPDATED",zt="PLAY_BUTTON_PRESS",Bt="REQUEST_NAVIGATION",Ft="REQUEST_NAVIGATION_ANIMATION",xt="DASHBOARD_EVENTS_BUTTON_PRESS";J._RF.pop(),J._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var Ut,Gt,Ht,Vt,qt,Wt,Kt,jt,Yt,Xt,Zt,Jt,Qt,$t,en,tn,nn,an,on,rn,ln,sn,un,cn=function(e){return e[e.store=0]="store",e[e.collections=1]="collections",e[e.home=2]="home",e[e.leaderboard=3]="leaderboard",e[e.tournaments=4]="tournaments",e}(cn||{});le(cn),J._RF.pop(),J._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var hn=Q.ccclass,pn=Q.property,dn=globalThis.game.monitorError,yn=GameCore.Utils.Number,vn=n.Layout,fn=(Ut=hn("MultiBackground"),Gt=pn({type:se}),Ht=pn({type:se}),Vt=pn({type:$}),qt=pn({type:$}),Wt=pn({type:$}),Kt=pn(ee),jt=pn(ne),Yt=pn({type:ue(cn)}),Xt=pn({type:ue(cn)}),Zt=a.onlyRunInLifeCycleAsync,Jt=a.onlyRunInLifeCycle,Ut((en=D(($t=function(n){B(u,n);var i,l,s=F(u);function u(){var e;N(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),z(e,"background1",en,x(e)),z(e,"background2",tn,x(e)),z(e,"screenUiTransform",nn,x(e)),z(e,"background1UiTransform",an,x(e)),z(e,"background2UiTransform",on,x(e)),z(e,"backgroundNudgeAmount",rn,x(e)),z(e,"nudgeableWidget",ln,x(e)),z(e,"pageOrder",sn,x(e)),z(e,"homePage",un,x(e)),e.currentPage=cn.home,e.currentThemeId="",e.tryNudgeBackground=function(t){var n=t.to;e.currentPage=n;var i=e.getDirection(e.homePage,n),a=yn.sign(i),o=Math.abs(i),r=e.backgroundNudgeAmount*o,l=Math.min(e.background1UiTransform.width,e.background2UiTransform.width),s=Math.max(0,(l-e.screenUiTransform.width)/2),u=Math.min(s,r)*a;ie(e.nudgeableWidget).to(.5,{horizontalCenter:u},{easing:ce.cubicInOut}).start()},e}return M(u,[{key:"onLoad",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,a.lazyValidateProperties(this),this.listenToNavigationEvents()}},{key:"onDestroy",value:function(){var e;null===(e=this.tweenSignal)||void 0===e||e.abort(),this.unlistenToNavigationEvents()}},{key:"listenToNavigationEvents",value:function(){this.node.scene.on(Ft,this.tryNudgeBackground),oe.on(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"unlistenToNavigationEvents",value:function(){this.node.scene.off(Ft,this.tryNudgeBackground),oe.off(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"getDirection",value:function(e,t){var n=this.pageOrder.indexOf(e),i=this.pageOrder.indexOf(t);return-1===n||-1===i?(null==dn||dn.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):n-i}},{key:"setCurrentTheme",value:(l=q((function*(e){var t=yield o.loadThemeAsync(e);t?this.updateBackgroundSprites(t,e):null==dn||dn.sendException(new Error("MultiBackground.setCurrentTheme: Failed to load theme ".concat(e,"'s sprite.")))})),function(e){return l.apply(this,arguments)})},{key:"updateBackgroundSprites",value:function(e,t){e.packable=!1,this.background1.spriteFrame=e,this.background2.spriteFrame=e,this.currentThemeId=t}},{key:"animateToNextTheme",value:(i=q((function*(t){var n;if(this.currentThemeId===t)return Promise.resolve();var i=yield o.loadThemeAsync(t);if(i){i.packable=!1,this.currentThemeId=t,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=i,this.nextBackground.node.setSiblingIndex(1);var a=this.nextBackground.getComponent(he);if(!a)throw new Error("".concat(this.nextBackground.node.name," UIOpacity is required"));if(a.opacity=0,null===(n=this.tweenSignal)||void 0===n||n.abort(),this.tweenSignal=new r,yield e.runTweenAsync(ie(a).to(1,{opacity:255}),this.tweenSignal),!this.tweenSignal.aborted){this.currentBackground.node.active=!1;var l=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=l}}else null==dn||dn.sendException(new Error("MultiBackground.animateToNextTheme: Failed to load theme ".concat(t,"'s sprite.")))})),function(e){return i.apply(this,arguments)})},{key:"handleOrientationChanged",value:function(e){if(e===vn.Portrait){var t=this.getDirection(this.homePage,this.currentPage),n=yn.sign(t),i=Math.abs(t),a=this.backgroundNudgeAmount*i,o=Math.min(this.background1UiTransform.width,this.background2UiTransform.width),r=Math.max(0,(o-this.screenUiTransform.width)/2),l=Math.min(r,a)*n;this.nudgeableWidget.horizontalCenter=l}else e===vn.Landscape&&(this.nudgeableWidget.horizontalCenter=0)}}]),u}(re)).prototype,"background1",[Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tn=D($t.prototype,"background2",[Ht],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nn=D($t.prototype,"screenUiTransform",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),an=D($t.prototype,"background1UiTransform",[qt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),on=D($t.prototype,"background2UiTransform",[Wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rn=D($t.prototype,"backgroundNudgeAmount",[Kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),ln=D($t.prototype,"nudgeableWidget",[jt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sn=D($t.prototype,"pageOrder",[Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),un=D($t.prototype,"homePage",[Xt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cn.home}}),D($t.prototype,"setCurrentTheme",[Zt],Object.getOwnPropertyDescriptor($t.prototype,"setCurrentTheme"),$t.prototype),D($t.prototype,"updateBackgroundSprites",[Jt],Object.getOwnPropertyDescriptor($t.prototype,"updateBackgroundSprites"),$t.prototype),Qt=$t))||Qt);J._RF.pop(),J._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var gn="musics/",mn="sounds/",bn=GameCore.Utils.Object,wn={BUTTON_CLICK:"".concat(mn,"use_item_click"),BOMB_DEFUSE:"".concat(mn,"bomb_defuse"),BOMB_EXPLODE_1:"".concat(mn,"bomb_explode_1"),BOMB_EXPLODE_2:"".concat(mn,"bomb_explode_2"),CLICKS:"".concat(mn,"clicks"),CLOSE_POPUP_CLICK:"".concat(mn,"close_popup_click"),COLLECT_STARS:"".concat(mn,"collect_stars"),COMBO_1:"".concat(mn,"combo_1"),COMBO_2:"".concat(mn,"combo_2"),COMBO_3:"".concat(mn,"combo_3"),COMBO_4:"".concat(mn,"combo_4"),COMBO_5:"".concat(mn,"combo_5"),DAILY_REWARD:"".concat(mn,"daily_reward"),EXTRA_TIME_SPAWN:"".concat(mn,"extra_time_spawn"),GIFT_CHARGE:"".concat(mn,"gift_charge"),GIFT_EXPLODE:"".concat(mn,"gift_explode"),GIFT_REVEAL:"".concat(mn,"gift_reveal"),HINT_ITEM:"".concat(mn,"hint_item"),INVALID_MATCH:"".concat(mn,"invalid_match"),LEVEL_COMPLETE:"".concat(mn,"level_complete"),LEVEL_FAIL:"".concat(mn,"level_fail"),LEVEL_START:"".concat(mn,"level_start"),PROGRESS_STAR:"".concat(mn,"progress_star"),RESCUE_TIMER:"".concat(mn,"rescue_timer"),ROCKET_FLY:"".concat(mn,"rocket_fly"),SHUFFLE_ITEM:"".concat(mn,"shuffle_item"),THREE_STARS:"".concat(mn,"three_stars"),TICKING_BOMB_BEFORE_EXPLODE:"".concat(mn,"ticking_bomb_before_explode"),TILE_SELECT:"".concat(mn,"tile_select"),USE_ITEM_CLICK:"".concat(mn,"use_item_click"),BG_MUSIC:"".concat(gn,"bg_music"),PATCH_SHIFT:"".concat(mn,"patch_shift"),THUNDERBOLT:"".concat(mn,"thunderbolt"),WIND:"".concat(mn,"wind"),COLLECT_COINS:"".concat(mn,"collect_coins"),COLLECT_STOCK_COINS:"".concat(mn,"collect_stock_coins"),LEVEL_FAIL_TIMEOUT:"".concat(mn,"level_fail_timeout"),STAR_CHEST_DRUM_ROLL:"".concat(mn,"star_chest_drum_roll"),STAR_CHEST_OPEN:"".concat(mn,"star_chest_open"),LEADERBOARD_TRIUMPH:"".concat(mn,"leaderboard_triumph"),ITEM_REWARD:"".concat(mn,"item_reward"),COMBO_6:"".concat(mn,"combo_6"),COMBO_7:"".concat(mn,"combo_7"),COMBO_8:"".concat(mn,"combo_8"),COMBO_9:"".concat(mn,"combo_9"),COMBO_10:"".concat(mn,"combo_10"),COMBO_11:"".concat(mn,"combo_11"),COMBO_12:"".concat(mn,"combo_12"),COMBO_13:"".concat(mn,"combo_13"),TILE_MATCH:"".concat(mn,"tile_match"),TOURNAMENT_MUSIC:"".concat(gn,"tournament_music")},kn=bn.vals(wn),Sn=kn.reduce((function(e,t,n){return e[t]=n,e}),{});le(Sn);var Cn,En,An,Tn,Rn,Pn,On,In,Ln,_n,Dn,Mn,Nn,zn,Bn,Fn,xn,Un,Gn,Hn,Vn,qn,Wn,Kn,jn,Yn,Xn,Zn,Jn,Qn,$n,ei,ti,ni,ii,ai=kn;J._RF.pop(),J._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var oi,ri,li,si,ui=Q.ccclass,ci=Q.property,hi=Q.disallowMultiple,pi=Q.executionOrder,di=globalThis.game.analytics,yi=GameCore.Plugins.Analytics.Events,vi=(Cn=ui("ExtendedButton"),En=pi(111),An=ci(pe),Tn=ci(pe),Rn=ci(de.AnimationController),Pn=ci({override:!0,visible:!1}),On=ci({override:!0,visible:!1}),In=ci({override:!0,visible:!1}),Ln=ci({override:!0,visible:!1}),_n=ci({override:!0,visible:!1}),Dn=ci({override:!0,visible:!1}),Mn=ci({override:!0,visible:!1}),Nn=ci({override:!0,visible:!1}),zn=ci({override:!0,visible:!1}),Bn=ci({override:!0,visible:!1}),Fn=ci({override:!0,visible:!1}),xn=ci(ye),Un=ci(ye),Gn=ci(ye),Hn=ci({visible:function(){return this.makeSound},type:Sn}),Vn=ci({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),qn=ci({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),Wn=ci({}),Cn(Kn=hi(Kn=En((Yn=D((jn=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return e=t.call.apply(t,[this].concat(o)),z(e,"clickStartEvents",Yn,x(e)),z(e,"clickEndEvents",Xn,x(e)),z(e,"animationController",Zn,x(e)),z(e,"useDesktopHover",Jn,x(e)),z(e,"emitAnalyticsEvents",Qn,x(e)),z(e,"makeSound",$n,x(e)),z(e,"soundKey",ei,x(e)),z(e,"disableSpamClick",ti,x(e)),z(e,"disableSpamDelay",ni,x(e)),z(e,"isScrollViewCancelInnerEvents",ii,x(e)),e.currentClickBoundingBox=null,e.hasDown=!1,e.hasUp=!1,e.hasFinishClickCycle=!1,e.onTouchStart=function(t){e.interactable&&(e.hasDown||(e.currentClickBoundingBox=i.getBoundingBoxToWorld(e.node),e.handleDown(t)))},e.onTouchEnd=function(t){e.scheduleOnce((function(){e.interactable&&e.hasDown&&(e.hasUp||e.handleUp(t))}),0)},e.onTouchCancel=function(t){if(e.interactable&&e.hasDown&&!e.hasUp){if(!e.isScrollViewCancelInnerEvents){var n,i,a=t.getUILocation();if(null!==(n=null===(i=e.currentClickBoundingBox)||void 0===i?void 0:i.contains(a))&&void 0!==n&&n)return void e.handleUp(t)}e.hasUp=!0,e.hasFinishClickCycle=!0,e.handleResetButtonState(),e.emitClickEndEvents(t)}},e.onMouseEnter=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||(e.hasFinishClickCycle=!1,e.setAnimationState("HOVER")))},e.onMouseLeave=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||e.hasUp||e.hasFinishClickCycle||e.handleResetButtonState())},e.handleResetButtonState=function(){e.hasDown=!1,e.hasUp=!1,e.setAnimationState("RESET")},e}return M(n,[{key:"transition",get:function(){return ve.Transition.NONE},set:function(e){W(V(n.prototype),"transition",ve.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return H(V(n.prototype),"normalColor",this)},set:function(e){W(V(n.prototype),"normalColor",e,this,!0)}},{key:"pressedColor",get:function(){return H(V(n.prototype),"pressedColor",this)},set:function(e){W(V(n.prototype),"pressedColor",e,this,!0)}},{key:"hoverColor",get:function(){return H(V(n.prototype),"hoverColor",this)},set:function(e){W(V(n.prototype),"hoverColor",e,this,!0)}},{key:"disabledColor",get:function(){return H(V(n.prototype),"disabledColor",this)},set:function(e){W(V(n.prototype),"disabledColor",e,this,!0)}},{key:"normalSprite",get:function(){return H(V(n.prototype),"normalSprite",this)},set:function(e){W(V(n.prototype),"normalSprite",e,this,!0)}},{key:"pressedSprite",get:function(){return H(V(n.prototype),"pressedSprite",this)},set:function(e){W(V(n.prototype),"pressedSprite",e,this,!0)}},{key:"hoverSprite",get:function(){return H(V(n.prototype),"hoverSprite",this)},set:function(e){W(V(n.prototype),"hoverSprite",e,this,!0)}},{key:"disabledSprite",get:function(){return H(V(n.prototype),"disabledSprite",this)},set:function(e){W(V(n.prototype),"disabledSprite",e,this,!0)}},{key:"duration",get:function(){return H(V(n.prototype),"duration",this)},set:function(e){W(V(n.prototype),"duration",e,this,!0)}},{key:"zoomScale",get:function(){return H(V(n.prototype),"zoomScale",this)},set:function(e){W(V(n.prototype),"zoomScale",e,this,!0)}},{key:"__preload",value:function(){H(V(n.prototype),"__preload",this).call(this),a.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var e;null===(e=H(V(n.prototype),"onDestroy",this))||void 0===e||e.call(this)}},{key:"onEnable",value:function(){var e;null===(e=H(V(n.prototype),"onEnable",this))||void 0===e||e.call(this),this.node.off(fe.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(ge.EventType.TOUCH_START,this.onTouchStart),this.node.on(ge.EventType.TOUCH_END,this.onTouchEnd),this.node.on(ge.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(ge.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var e;null===(e=H(V(n.prototype),"onDisable",this))||void 0===e||e.call(this),this.node.off(ge.EventType.TOUCH_START,this.onTouchStart),this.node.off(ge.EventType.TOUCH_END,this.onTouchEnd),this.node.off(ge.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(ge.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(e){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&l.playSound(ai[this.soundKey]),this.emitClickStartEvents(e)}},{key:"emitClickStartEvents",value:function(e){var t,n=G(this.clickStartEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}}},{key:"emitClickEndEvents",value:function(e){var t,n=G(this.clickEndEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}}},{key:"handleUp",value:function(e){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}},{key:"emitButtonEvents",value:function(e){if(this.interactable){this.emitAnalyticsEvents&&di.event(yi.BUTTON_CLICK,{button_name:this.node.name,screen_name:s.getCurrentPage()});var t,n=G(this.clickEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}}}},{key:"setAnimationState",value:function(e){this.animationController&&(this.animationController.setValue("DOWN","DOWN"===e),this.animationController.setValue("HOVER","HOVER"===e),this.animationController.setValue("RESET","RESET"===e))}},{key:"fakeClick",value:function(){var e=this;this.setAnimationState("DOWN"),this.scheduleOnce((function(){e.setAnimationState("RESET")}),0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),n}(ve)).prototype,"clickStartEvents",[An],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xn=D(jn.prototype,"clickEndEvents",[Tn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Zn=D(jn.prototype,"animationController",[Rn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(jn.prototype,"transition",[Pn],Object.getOwnPropertyDescriptor(jn.prototype,"transition"),jn.prototype),D(jn.prototype,"normalColor",[On],Object.getOwnPropertyDescriptor(jn.prototype,"normalColor"),jn.prototype),D(jn.prototype,"pressedColor",[In],Object.getOwnPropertyDescriptor(jn.prototype,"pressedColor"),jn.prototype),D(jn.prototype,"hoverColor",[Ln],Object.getOwnPropertyDescriptor(jn.prototype,"hoverColor"),jn.prototype),D(jn.prototype,"disabledColor",[_n],Object.getOwnPropertyDescriptor(jn.prototype,"disabledColor"),jn.prototype),D(jn.prototype,"normalSprite",[Dn],Object.getOwnPropertyDescriptor(jn.prototype,"normalSprite"),jn.prototype),D(jn.prototype,"pressedSprite",[Mn],Object.getOwnPropertyDescriptor(jn.prototype,"pressedSprite"),jn.prototype),D(jn.prototype,"hoverSprite",[Nn],Object.getOwnPropertyDescriptor(jn.prototype,"hoverSprite"),jn.prototype),D(jn.prototype,"disabledSprite",[zn],Object.getOwnPropertyDescriptor(jn.prototype,"disabledSprite"),jn.prototype),D(jn.prototype,"duration",[Bn],Object.getOwnPropertyDescriptor(jn.prototype,"duration"),jn.prototype),D(jn.prototype,"zoomScale",[Fn],Object.getOwnPropertyDescriptor(jn.prototype,"zoomScale"),jn.prototype),Jn=D(jn.prototype,"useDesktopHover",[xn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Qn=D(jn.prototype,"emitAnalyticsEvents",[Un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$n=D(jn.prototype,"makeSound",[Gn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ei=D(jn.prototype,"soundKey",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sn[wn.BUTTON_CLICK]}}),ti=D(jn.prototype,"disableSpamClick",[Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ni=D(jn.prototype,"disableSpamDelay",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ii=D(jn.prototype,"isScrollViewCancelInnerEvents",[Wn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Kn=jn))||Kn)||Kn)||Kn);J._RF.pop(),J._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var fi,gi,mi,bi=Q.ccclass,wi=Q.requireComponent,ki=Q.property,Si=bi("OpacityToggler")(oi=wi([he])((li=D((ri=function(t){B(o,t);var n,i=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n)),z(e,"activeValue",li,x(e)),z(e,"inActiveValue",si,x(e)),e.signal=new r,e}return M(o,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"changeState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.signal.abort(),this.opacityComponent.opacity=e?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(n=q((function*(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;this.signal.abort(),this.signal=new r;var i=t?this.activeValue:this.inActiveValue;yield e.runTweenAsync(ie(this.opacityComponent).to(n,{opacity:i}),this.signal)})),function(){return n.apply(this,arguments)})}]),o}(re)).prototype,"activeValue",[ki],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),si=D(ri.prototype,"inActiveValue",[ki],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),oi=ri))||oi)||oi;J._RF.pop(),J._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var Ci,Ei,Ai,Ti,Ri,Pi,Oi,Ii,Li,_i,Di,Mi,Ni,zi,Bi,Fi,xi,Ui,Gi,Hi,Vi=Q.ccclass,qi=Q.property,Wi=Q.requireComponent,Ki=Q.disallowMultiple,ji=Q.executeInEditMode,Yi=n.DesignSize,Xi=Yi.Portrait,Zi=Yi.Landscape;Vi("DebugResolution")(fi=Ki(fi=Wi([me])(fi=ji(!0)(((mi=function(e){B(i,e);var n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).handleLayoutChange=function(){var t;null===(t=e.graphics)||void 0===t||t.clear(),e.start()},e}return M(i,[{key:"drawPortrait",get:function(){return i._drawPortrait},set:function(e){e!==i._drawPortrait&&(e?this.drawPortraitResolution():this.graphics.clear(),i._drawPortrait=e,i._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return i._drawLandscape},set:function(e){e!==i._drawLandscape&&(e?this.drawLandscapeResolution():this.graphics.clear(),i._drawLandscape=e,i._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(me),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){oe.on(t.LAYOUT_CHANGED,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var e=this.graphics;if(e){var t=Xi.WIDTH,n=Xi.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=be.GREEN,e.rect(i,a,t,n),e.stroke()}}},{key:"drawLandscapeResolution",value:function(){var e=this.graphics;if(e){var t=Zi.WIDTH,n=Zi.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=be.CYAN,e.rect(i,a,t,n),e.stroke()}}}]),i}(re))._drawPortrait=!0,mi._drawLandscape=!0,D((gi=mi).prototype,"drawPortrait",[qi],Object.getOwnPropertyDescriptor(gi.prototype,"drawPortrait"),gi.prototype),D(gi.prototype,"drawLandscape",[qi],Object.getOwnPropertyDescriptor(gi.prototype,"drawLandscape"),gi.prototype),fi=gi))||fi)||fi)||fi);J._RF.pop(),J._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var Ji=Q.ccclass,Qi=Q.executionOrder,$i=Q.property,ea=GameCore.Utils.Valid,ta=be.RED,na=be.BLACK,ia=be.MAGENTA;Ci=Ji("GameStats"),Ei=Qi(-1e3),Ai=$i(we),Ti=$i(we),Ri=$i(we),Pi=$i(we),Oi=$i(we),Ii=$i(we),Li=$i(we),_i=$i(we),Ci(Di=Ei((Ni=D((Mi=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"fpsLabel",Ni,x(e)),z(e,"drawCountLabel",zi,x(e)),z(e,"logicTimeLabel",Bi,x(e)),z(e,"physicTimeLabel",Fi,x(e)),z(e,"renderTimeLabel",xi,x(e)),z(e,"objectMemoryUsageLabel",Ui,x(e)),z(e,"textureMemoryUsageLabel",Gi,x(e)),z(e,"devicePixelRatioLabel",Hi,x(e)),e.refreshInterval=.5,e.handleMouseDown=function(){e.bg.enabled=!e.bg.enabled},e.waitForStats=function(){ke.stats&&(e.unschedule(e.waitForStats),e.node.active=!0,e.stats=ke.stats,e.startUpdateStats())},e.updateStats=function(){e.updateFps(),e.updateDrawCalls(),e.updateLogicTime(),e.updatePhysicTime(),e.updateRenderTime(),e.updateObjectMemoryUsage(),e.updateTextureMemoryUsage(),e.updateDevicePixelRatio()},e}return M(n,[{key:"__preload",value:function(){this.bg=this.getComponent(se),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(fe.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,ke&&ea.isDebugger()&&(ke.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var e=this.getFps();this.updateFpsColor(e),this.fpsLabel.string="FPS: ".concat(e)}},{key:"updateFpsColor",value:function(e){this.fpsLabel.color=e<30?ta:e<48?ia:na}},{key:"updateDrawCalls",value:function(){var e=this.getDrawCalls();this.updateDrawCallsColor(e),this.drawCountLabel.string="Draw Calls: ".concat(e)}},{key:"updateDrawCallsColor",value:function(e){var t=Se.os===Se.OS.IOS,n=t?80:25,i=t?60:15;this.drawCountLabel.color=e>n?ta:e>i?ia:na}},{key:"updateLogicTime",value:function(){var e=this.getLogicTime();this.updateLogicTimeColor(e),this.logicTimeLabel.string="Logic Time: ".concat(e.toFixed(2),"ms")}},{key:"updateLogicTimeColor",value:function(e){this.logicTimeLabel.color=e>10?ta:e>5?ia:na}},{key:"updatePhysicTime",value:function(){var e=this.getPhysicTime();this.updatePhysicTimeColor(e),this.physicTimeLabel.string="Physic Time: ".concat(e.toFixed(2),"ms")}},{key:"updatePhysicTimeColor",value:function(e){this.physicTimeLabel.color=e>10?ta:e>5?ia:na}},{key:"updateRenderTime",value:function(){var e=this.getRenderTime();this.updateRenderTimeColor(e),this.renderTimeLabel.string="Render Time: ".concat(e.toFixed(2),"ms")}},{key:"updateRenderTimeColor",value:function(e){this.renderTimeLabel.color=e>10?ta:e>5?ia:na}},{key:"updateObjectMemoryUsage",value:function(){var e=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(e),this.objectMemoryUsageLabel.string="Object Mem: ".concat(e.toFixed(2),"MB")}},{key:"updateObjectMemoryUsageColor",value:function(e){this.objectMemoryUsageLabel.color=e>40?ta:e>25?ia:na}},{key:"updateTextureMemoryUsage",value:function(){var e=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(e),this.textureMemoryUsageLabel.string="Texture Mem: ".concat(e.toFixed(2),"MB")}},{key:"updateTextureMemoryUsageColor",value:function(e){this.textureMemoryUsageLabel.color=e>50?ta:e>35?ia:na}},{key:"updateDevicePixelRatio",value:function(){var e=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(e),this.devicePixelRatioLabel.string="Device Pixel Ratio: ".concat(e)}},{key:"updateDevicePixelRatioColor",value:function(e){this.devicePixelRatioLabel.color=e>2?ta:e<=1?ia:na}},{key:"getFps",value:function(){var e=this.stats.fps.counter;return Math.floor(e.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var e=this.stats.logic.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getPhysicTime",value:function(){var e=this.stats.physics.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getRenderTime",value:function(){var e=this.stats.render.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var e=this.stats.bufferMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var e=this.stats.textureMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),n}(re)).prototype,"fpsLabel",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zi=D(Mi.prototype,"drawCountLabel",[Ti],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bi=D(Mi.prototype,"logicTimeLabel",[Ri],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fi=D(Mi.prototype,"physicTimeLabel",[Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xi=D(Mi.prototype,"renderTimeLabel",[Oi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ui=D(Mi.prototype,"objectMemoryUsageLabel",[Ii],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gi=D(Mi.prototype,"textureMemoryUsageLabel",[Li],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hi=D(Mi.prototype,"devicePixelRatioLabel",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Di=Mi))||Di);J._RF.pop(),J._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var aa,oa=function(e){return e.CHALLENGE_FRIENDS="challenge-friends",e.REPLAY_FRIENDS="replay-friends",e.SHOW_CHALLENGE_RESULTS="show-challenge-results",e.UPDATE_MUSIC="update-music",e.NEXT_LEVEL="next-level",e.MAX_LEVEL="max-level",e.START_OVER="start-over",e.SELECT_LEVEL="select-level",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_REPLAY="game-replay",e.GAME_FINISH="game-finish",e.GAME_EXIT="game-exit",e.USE_ITEM="use-item",e.SKIP_LEVEL="skip-level",e.ADD_ITEM="add-item",e.ADD_ITEMS="add-items",e.REFRESH_ITEMS="refresh-items",e.ADD_COINS="add-coins",e.REMOVE_COINS="remove-coins",e.REMOVE_COINS_SUCCESS="remove-coins-success",e.REMOVE_COINS_FAILED="remove-coins-failed",e.COIN_CHANGED="coin-changed",e.ABORT_COIN_ANIMATION="abort-coin-animation",e.ADD_STARS="add-stars",e.PAUSE_TIME="pause-time",e.RESUME_TIME="resume-time",e.TIME_OUT="time-out",e.HALF_TIME="half-time",e.RESCUE_START="rescue-time",e.RESCUE_FINISHED="clock-animation-finished",e.TIME_UPDATED="time-updated",e.APPLY_GRAVITY="apply-gravity",e.IDLE_ENTER="idle-enter",e.IDLE_EXIT="idle-exit",e.GRID_MATCH="grid-match",e.GRID_MATCH_SUCCESS="grid-match-success",e.GRID_MATCH_FAIL="grid-match-fail",e.GRID_CLEAR="grid-clear",e.GRID_SPAWN="grid-spawn",e.GRID_CREATE="grid-create",e.GRID_RESIZE="grid-resize",e.TILE_CLICK="tile-click",e.BOMB_EXPLODE="bomb-explode",e.SHOW_HINT="show-hint",e.ADD_COMBO="add-combo",e.COMBO_UPDATED="combo-updated",e.COMBO_ENDED="combo-ended",e.COMBO_PROGRESS="combo-progress",e.ADD_SCORE="add-score",e.SCORE_UPDATED="score-updated",e.SHOW_UI="show-ui",e.HIDE_UI="hide-ui",e.AUTO_PLAY="auto-play",e.GUIDE_MASK_CLICKED="guide-mask-clicked",e}(oa||{});J._RF.pop(),J._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var ra,la,sa,ua,ca,ha,pa,da,ya,va,fa,ga,ma,ba,wa,ka,Sa,Ca,Ea=(0,Q.ccclass)("PanelAnimationController")(aa=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).animators=new Set,e.eventTarget=new Ce,e.handleRegistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)&&console.warn("Animator already registered."),e.animators.add(t)},e.handleUnregistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)||console.warn("Animator not registered."),e.animators.delete(t)},e.handleShowUIs=function(){var t=q((function*(t){var n,i,a=!1,o=[],r=G(e.animators);try{for(r.s();!(i=r.n()).done;){var l=i.value;o.push(l)}}catch(e){r.e(e)}finally{r.f()}for(var s=[],u=0,c=o;u<c.length;u++){var h,p=c[u];if(!p.isReadyForAnimation()&&!a)a=!0,null==t||null===(h=t.fallback)||void 0===h||h.call(t);s.push(p.handleShowUI())}yield Promise.all(s),null==t||null===(n=t.onComplete)||void 0===n||n.call(t),e.eventTarget.emit(oa.SHOW_UI)}));return function(e){return t.apply(this,arguments)}}(),e.handleHideUIs=function(){var t=q((function*(t){var n,i,a=!1,o=[],r=G(e.animators);try{for(r.s();!(i=r.n()).done;){var l=i.value;o.push(l)}}catch(e){r.e(e)}finally{r.f()}for(var s=[],u=0,c=o;u<c.length;u++){var h,p=c[u];if(!p.isReadyForAnimation()&&!a)a=!0,null==t||null===(h=t.fallback)||void 0===h||h.call(t);s.push(p.handleHideUI())}yield Promise.all(s),null==t||null===(n=t.onComplete)||void 0===n||n.call(t),e.eventTarget.emit(oa.HIDE_UI)}));return function(e){return t.apply(this,arguments)}}(),e}return M(n,[{key:"onEnable",value:function(){this.node.scene.on(oa.SHOW_UI,this.handleShowUIs,this),this.node.scene.on(oa.HIDE_UI,this.handleHideUIs,this)}},{key:"onDisable",value:function(){this.node.scene.off(oa.SHOW_UI,this.handleShowUIs,this),this.node.scene.off(oa.HIDE_UI,this.handleHideUIs,this)}},{key:"showUI",value:function(){return this.handleShowUIs()}},{key:"hideUI",value:function(){return this.handleHideUIs()}},{key:"on",value:function(e,t,n,i){this.eventTarget.on(e,t,n,i)}},{key:"off",value:function(e,t,n){this.eventTarget.off(e,t,n)}}],[{key:"getController",value:function(e){for(var t=null,i=e;null!==i;){if(t=i.getComponent(n))return t;i=i.parent}return t}},{key:"registerAnimator",value:function(e){var t=this.getController(e.node);t?t.handleRegistration(e):console.warn("No PanelAnimationController found for animator ".concat(e.node.name))}},{key:"unregisterAnimator",value:function(e){var t=this.getController(e.node);t?t.handleUnregistration(e):console.warn("No PanelAnimationController found for animator ".concat(e.node.name))}}]),n}(re))||aa;J._RF.pop(),J._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var Aa,Ta=Q.ccclass,Ra=Q.property,Pa=GameCore.Utils.Object,Oa=(ra=Ta("AnimationConfig"),la=Ra({type:[ne]}),ra((ca=D((ua=function(){function e(){N(this,e),z(this,"startHidden",ca,this),z(this,"nodes",ha,this),z(this,"posOffset",pa,this),z(this,"showEase",da,this),z(this,"hideEase",ya,this),z(this,"showDuration",va,this),z(this,"hideDuration",fa,this)}return M(e,[{key:"setConfig",value:function(e){e&&Pa.assign(this,e)}}]),e}()).prototype,"startHidden",[Ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ha=D(ua.prototype,"nodes",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pa=D(ua.prototype,"posOffset",[Ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),da=D(ua.prototype,"showEase",[Ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),ya=D(ua.prototype,"hideEase",[Ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),va=D(ua.prototype,"showDuration",[Ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fa=D(ua.prototype,"hideDuration",[Ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sa=ua))||sa),Ia=(ga=Ta("PanelAnimator"),ma=Ra({type:Oa,displayName:"Top animation nodes"}),ba=Ra({type:Oa,displayName:"Bottom animation nodes"}),ga((Sa=D((ka=function(t){B(o,t);var n,i,a=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),z(e,"topConfig",Sa,x(e)),z(e,"botConfig",Ca,x(e)),e.isReady=!1,e}return M(o,[{key:"onEnable",value:function(){Ea.registerAnimator(this)}},{key:"onDisable",value:function(){Ea.unregisterAnimator(this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(i=q((function*(){if(this.isReady)return Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")]);console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"))})),function(){return i.apply(this,arguments)})},{key:"handleHideUI",value:(n=q((function*(){if(this.isReady)return Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")]);console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"))})),function(){return n.apply(this,arguments)})},{key:"createAnimator",value:function(t,n){var i=t.nodes,a=t.posOffset,l=t.showEase,s=t.hideEase,u=t.showDuration,c=t.hideDuration,h=i.map((function(e){return"top"===n&&e.isAlignTop?{mode:"top",value:e.top}:"bottom"===n&&e.isAlignBottom?{mode:"bottom",value:e.bottom}:{mode:"position",value:e.node.position.y}})),p=i.map((function(e){return"top"===n&&e.isAlignTop?{mode:"top",value:e.top+a}:"bottom"===n&&e.isAlignBottom?{mode:"bottom",value:e.bottom-a}:{mode:"position",value:e.node.position.y+a}})),d="shown",y=new r;return{switchState:function(){var t=q((function*(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y.abort();var a=new r;if(y=a,d!==t){d=t;var v="hidden"===t?h:p,f="hidden"===t?p:h,g="hidden"===t?c:u,m="hidden"===t?s:l,b=function(){for(var e=0,t=i.length;e<t;e++){var n=i[e],a=v[e],r=f[e].value;o.setToTargetImmediately(n,a,r)}};n?b():(a.addAbortListener(b),yield Promise.all(i.map((function(t,n){var i=v[n],r=f[n].value;return e.runTweenAsync(o.getTween({widget:t,config:i,target:r,easing:m,duration:g}),a)}))),a.aborted||a.removeAbortListener(b))}}));return function(e){return t.apply(this,arguments)}}()}}},{key:"setAnimator",value:function(e){var t=e.topConfig,n=e.botConfig,i=new Oa,a=new Oa;i.setConfig(t),a.setConfig(n),this.topConfig=i,this.botConfig=a,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(e){var t=e.widget,n=e.config,i=e.target,a=e.easing,o=e.duration;return"top"===n.mode?ie(t).call((function(){t.top=n.value})).to(o,{top:i},{easing:a}):"bottom"===n.mode?ie(t).call((function(){t.bottom=n.value})).to(o,{bottom:i},{easing:a}):ie(t.node.position).call((function(){t.node.setPosition(t.node.position.x,n.value,t.node.position.z)})).to(o,{y:i},{easing:a})}},{key:"setToTargetImmediately",value:function(e,t,n){"top"===t.mode&&(e.top=n),"bottom"===t.mode&&(e.bottom=n);var i=e.node.position.x,a=n,o=e.node.position.z;e.node.setPosition(i,a,o)}}]),o}(re)).prototype,"topConfig",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oa}}),Ca=D(ka.prototype,"botConfig",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oa}}),wa=ka))||wa);J._RF.pop(),J._RF.push({},"21a9aAlkBtGxKLqip8g0o6l","ParticleSystem2DExtra",void 0);var La,_a=Q.ccclass,Da=Q.disallowMultiple,Ma=Q.executeInEditMode,Na=Q.requireComponent,za=_a("ParticleSystem2DExtra")(Aa=Ma(!0)(Aa=Da(!0)(Aa=Na(Ee)(Aa=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).emitParticle=function(t){return function(n){t(n);var i=e.particleSystem._simulator.particles.length,a=e.particleSystem._simulator.particles[i-1];e.initParticle(a)}},e.step=function(t){return function(n){for(var i=e.particleSystem._simulator.particles,a=0;a<i.length;a++){var o=i[a];e.updateParticle(o,n)}t(n)}},e}return M(n,[{key:"__preload",value:function(){this.particleSystem=this.getComponent(Ee),this.validateRequiredComponents(),this.overrideFunctions()}},{key:"overrideFunctions",value:function(){var e=this.particleSystem._simulator.emitParticle.bind(this.particleSystem._simulator);this.particleSystem._simulator.emitParticle=this.emitParticle(e);var t=this.particleSystem._simulator.step.bind(this.particleSystem._simulator);this.particleSystem._simulator.step=this.step(t)}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}}]),n}(re))||Aa)||Aa)||Aa)||Aa;J._RF.pop(),J._RF.push({},"9a5a3MgLaRAKbHluGCPsA8j","ExampleParticleSystem2DExtra",void 0);var Ba,Fa,xa,Ua,Ga,Ha,Va,qa,Wa,Ka,ja,Ya;(0,Q.ccclass)("ExampleParticleSystem2DExtra")(La=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"initParticle",value:function(e){e.maxSize=Ae.randomRange(.25,1)*e.size,e.size=0,e.deltaSize=0,e.cycleDuration=Ae.randomRange(.4,.6),e.life=e.timeToLive,this.setInitPosition(e.pos)}},{key:"updateParticle",value:function(e,t){this.updateScale(e)}},{key:"setInitPosition",value:function(e){var t=e.x,n=e.y;return e.x=t+Ae.randomRange(-350,350),e.y=n+Ae.randomRange(-350,350),e}},{key:"updateScale",value:function(e){var t=1-(e.life-e.timeToLive)%e.cycleDuration/e.cycleDuration;e.size=e.maxSize*Math.sin(t*Math.PI)}}]),n}(za));J._RF.pop(),J._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var Xa,Za,Ja,Qa,$a,eo,to,no,io,ao,oo=Q.ccclass,ro=Q.requireComponent,lo=Q.property,so=globalThis.game,uo=so.ads,co=so.event,ho=GameCore,po=ho.Events,yo=ho.Configs.Ads.BannerDisplayAdOptions,vo=ho.Plugins.Ads,fo=vo.Types,go=vo.Status,mo=ho.Utils,bo=mo.Array,wo=mo.Function,ko=["top","topleft","topright"],So=["bottom","bottomleft","bottomright"],Co=["left","topleft","bottomleft"],Eo=["right","topright","bottomright"];Ba=oo("ResizeWithBannerAd"),Fa=ro(ne),xa=lo(ye),Ua=lo(ye),Ga=lo(ye),Ha=lo(ye),Ba(Va=Fa((Wa=D((qa=function(e){B(o,e);var n=F(o);function o(){var e;N(this,o);for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return e=n.call.apply(n,[this].concat(r)),z(e,"includeSAB",Wa,x(e)),z(e,"includeRightBanner",Ka,x(e)),z(e,"includeBottomBanner",ja,x(e)),z(e,"includeLeftBanner",Ya,x(e)),e.handleOnAdShowing=function(t){var n=t.placementId;e.checkValid()&&n&&(uo.getAd(fo.BANNER,n)&&(e.resizeWhenBannerAdShow(n),e.emitResizeEvent()))},e.handleOnAdClosed=function(t){var n=t.placementId;e.checkValid()&&n&&(uo.getAd(fo.BANNER,n)&&(e.resizeWhenBannerAdClose(n),e.emitResizeEvent()))},e.handleOnResize=function(){e.checkValid()&&yo.forEach((function(t){var n=t.PlacementId,i=uo.getAdStatus(fo.BANNER,n);i&&(i===go.SHOWING?e.resizeWhenBannerAdShow(n):i===go.IDLE&&e.resizeWhenBannerAdClose(n))}))},e.resizeWhenBannerAdShow=function(t){var n=void 0,a=void 0,o=void 0,r=void 0,l=i.cssSizeToWorldSize(1),s=uo.getBannerConfig(t),u=s.PlacementId,c=s.BannerWidth,h=s.Position;if("top"===h)n=uo.getBannerHeight(u,l);else if("bottom"===h)e.includeBottomBanner?a=uo.getBannerHeight(u,l,e.includeSAB):e.includeSAB&&(a=uo.getSafeAreaBottom(l));else if("left"===h||"right"===h){if(void 0===c)return;var p=c;"getBannerOffset"in GameSDK.extra&&(p+=GameSDK.extra.getBannerOffset()),"left"===h&&e.includeLeftBanner?o=p*l:"right"===h&&e.includeRightBanner&&(r=p*l)}e.updateWidgets({top:n,bottom:a,left:o,right:r})},e.resizeWhenBannerAdClose=function(t){var n=uo.getBannerConfig(t).Position,a=i.cssSizeToWorldSize(1),o=e.includeSAB?uo.getSafeAreaBottom(a):0;e.updateWidgets({top:bo.has(ko,n)?0:void 0,bottom:bo.has(So,n)?o:void 0,left:bo.has(Co,n)?0:void 0,right:bo.has(Eo,n)?0:void 0})},e.emitResizeEvent=wo.debounce((function(){oe.emit(t.WIDGET_RESIZED)}),100),e}return M(o,[{key:"__preload",value:function(){this.widget=this.getComponent(ne),a.lazyValidateProperties(this),co.on(po.AD_SHOWING,this.handleOnAdShowing),co.on(po.AD_CLOSED,this.handleOnAdClosed),oe.on(t.VIEW_RESIZED,this.handleOnResize)}},{key:"onDestroy",value:function(){co.off(po.AD_SHOWING,this.handleOnAdShowing),co.off(po.AD_CLOSED,this.handleOnAdClosed),oe.off(t.VIEW_RESIZED,this.handleOnResize)}},{key:"start",value:function(){this.handleOnResize()}},{key:"updateWidgets",value:function(e){var t=e.top,n=e.bottom,i=e.left,a=e.right;this.widget.top=null!=t?t:this.widget.top,this.widget.bottom=null!=n?n:this.widget.bottom,this.widget.left=null!=i?i:this.widget.left,this.widget.right=null!=a?a:this.widget.right,Te.instance.emit("canvas-resize")}},{key:"checkValid",value:function(){return this.node.activeInHierarchy&&null!==this.node.parent&&void 0!==this.node.parent}}]),o}(re)).prototype,"includeSAB",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ka=D(qa.prototype,"includeRightBanner",[Ua],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ja=D(qa.prototype,"includeBottomBanner",[Ga],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ya=D(qa.prototype,"includeLeftBanner",[Ha],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Va=qa))||Va);J._RF.pop(),J._RF.push({},"3825fBvhGRPUK6d/ohif+v0","PreloadSprite",void 0);var Ao=Q.ccclass,To=Q.property,Ro=Q.requireComponent,Po=n.Layout,Oo=function(e){return e[e.Portrait=0]="Portrait",e[e.Landscape=1]="Landscape",e}(Oo||{}),Io=[Po.Portrait,Po.Landscape];le(Oo);var Lo,_o,Do,Mo,No,zo,Bo,Fo,xo,Uo,Go;Xa=Ao("PreloadSprite"),Za=Ro(se),Ja=To({type:Oo}),Qa=To({type:u}),$a=To({type:ye}),Xa(eo=Za((no=D((to=function(e){B(a,e);var n,i=F(a);function a(){var e;N(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),z(e,"layout",no,x(e)),z(e,"path",io,x(e)),z(e,"packable",ao,x(e)),e}return M(a,[{key:"__preload",value:function(){this.sprite=this.getComponent(se),oe.on(t.ORIENTATION_CHANGED,this.loadSpriteFrame,this),this.loadSpriteFrame()}},{key:"onDestroy",value:function(){oe.off(t.ORIENTATION_CHANGED,this.loadSpriteFrame,this)}},{key:"loadSpriteFrame",value:(n=q((function*(){if(this.sprite.spriteFrame)this.unlistenEvent();else if(Mt.getCurrentLayout()===Io[this.layout]&&this.path){var e="".concat(c[this.path],"/spriteFrame");if(e){var t=yield o.loadSpriteFrameAsync(e,this.packable);this.sprite.spriteFrame||(this.sprite.spriteFrame=t),this.unlistenEvent()}}})),function(){return n.apply(this,arguments)})},{key:"unlistenEvent",value:function(){oe.off(t.ORIENTATION_CHANGED,this.loadSpriteFrame,this)}}]),a}(re)).prototype,"layout",[Ja],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),io=D(to.prototype,"path",[Qa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ao=D(to.prototype,"packable",[$a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eo=to))||eo);J._RF.pop(),J._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var Ho,Vo,qo,Wo,Ko,jo,Yo,Xo=Q.ccclass,Zo=Q.property,Jo=Q.executeInEditMode,Qo=Q.requireComponent,$o=(Lo=Xo("TapperedProgressBar"),_o=Qo(he),Do=Zo({type:he,displayName:"Fill opacity"}),Mo=Zo({type:se,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),No=Zo({type:se,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),zo=Zo({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),Lo(Bo=Jo(Bo=_o((xo=D((Fo=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"uiOpacity",xo,x(e)),z(e,"leftCap",Uo,x(e)),z(e,"rightCap",Go,x(e)),e}return M(n,[{key:"progress",get:function(){return H(V(n.prototype),"progress",this)},set:function(e){W(V(n.prototype),"progress",e,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity)if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var e=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=e}}},{key:"start",value:function(){this.updateAppearance()}}]),n}(Re)).prototype,"uiOpacity",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uo=D(Fo.prototype,"leftCap",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Go=D(Fo.prototype,"rightCap",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),D(Fo.prototype,"progress",[zo],Object.getOwnPropertyDescriptor(Fo.prototype,"progress"),Fo.prototype),Bo=Fo))||Bo)||Bo)||Bo);J._RF.pop(),J._RF.push({},"aa60frMJLtIlJZh2yJhMp1s","DynamicLabel",void 0);var er,tr,nr,ir,ar,or,rr,lr,sr,ur,cr,hr,pr,dr,yr,vr,fr,gr,mr,br=Q.ccclass,wr=Q.property,kr=Q.executeInEditMode,Sr=Q.requireComponent;Ho=br("DynamicLabel"),Vo=Sr(we),qo=kr(!0),Wo=wr({type:te,min:1,max:200}),Ko=wr({type:te,min:.1,max:4}),Ho(jo=Vo(jo=qo((D((Yo=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a)))._quality=1,e._size=1,e._outlineWidth=0,e._shadowOffset=new Pe(0,0),e}return M(n,[{key:"size",get:function(){return this._size},set:function(e){this._size=e,this.label.fontSize=this.size*this.quality}},{key:"quality",get:function(){return this._quality},set:function(e){this._quality=e,this.node.scale=new Oe(1/this.quality,1/this.quality,1),this.label.fontSize=this.size*this.quality,this.label.outlineWidth=this._outlineWidth*this.quality,this.label.shadowOffset=this._shadowOffset.multiplyScalar(this.quality)}},{key:"__preload",value:function(){this.label=this.getComponent(we)}},{key:"start",value:function(){this._quality=1/this.node.scale.x,this._size=this.label.fontSize/this.quality,this._outlineWidth=this.label.outlineWidth,this._shadowOffset=this.label.shadowOffset,this.quality=window.devicePixelRatio,console.info("🔠 ".concat(this.node.name,"<Label> quality:"),this.quality)}}]),n}(re)).prototype,"size",[Wo],Object.getOwnPropertyDescriptor(Yo.prototype,"size"),Yo.prototype),D(Yo.prototype,"quality",[Ko],Object.getOwnPropertyDescriptor(Yo.prototype,"quality"),Yo.prototype),jo=Yo))||jo)||jo);J._RF.pop(),J._RF.push({},"060a722v8VBE68QPm8fKcyQ","LocalizePreloader",void 0);var Cr,Er,Ar,Tr,Rr,Pr,Or,Ir,Lr,_r,Dr,Mr,Nr,zr,Br,Fr,xr,Ur,Gr,Hr,Vr,qr,Wr=Q.ccclass,Kr=Q.property,jr=GameCore.Utils,Yr=jr.Array,Xr=jr.Valid,Zr=globalThis.game.language,Jr=Object.keys(h),Qr=(er=Wr("LocalizeTextureKey"),tr=Kr({visible:!1}),nr=Kr(Ie),er((or=D((ar=function(){function e(){N(this,e),z(this,"_key",or,this)}return M(e,[{key:"key",get:function(){return this._key},set:function(e){Zr.hasTextureKey(e)?this._key=e:console.warn("Key ".concat(e," not found in locales"))}}]),e}()).prototype,"_key",[tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),D(ar.prototype,"key",[nr],Object.getOwnPropertyDescriptor(ar.prototype,"key"),ar.prototype),ir=ar))||ir),$r=(rr=Wr("SupportedLocaleKey"),lr=Kr({visible:!1}),sr=Kr(Ie),rr((hr=D((cr=function(){function e(){N(this,e),z(this,"_key",hr,this)}return M(e,[{key:"key",get:function(){return this._key},set:function(e){Jr.includes(e)?this._key=e:console.warn("Key ".concat(e," not found. Supported locales are ").concat(Jr.join(", ")))}}]),e}()).prototype,"_key",[lr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),D(cr.prototype,"key",[sr],Object.getOwnPropertyDescriptor(cr.prototype,"key"),cr.prototype),ur=cr))||ur);pr=Wr("LocalizePreloader"),dr=Kr([Qr]),yr=Kr({type:$r,tooltip:"Preload only for these locales"}),pr((gr=D((fr=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"keys",gr,x(e)),z(e,"locales",mr,x(e)),e}return M(n,[{key:"__preload",value:function(){var e=Zr.getCurrentLocale(),t=this.locales.map((function(e){return e.key}));if(Yr.has(t,e)){var n=this.keys.reduce((function(e,t){if(!1===Zr.hasTextureKey(t.key))return e;var n="".concat(Zr.getTexture(t.key),"/spriteFrame");return e.push(n),e}),[]);o.loadSpriteFramesAsync(n)}else Xr.isDebugger()&&console.info("Skipping preloading of textures because current locale is not in the list of preloading locales")}}]),n}(re)).prototype,"keys",[dr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mr=D(fr.prototype,"locales",[yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vr=fr));J._RF.pop(),J._RF.push({},"3f364xnTJtDR5yeow2MWHhm","LocalizedLayout",void 0);var el,tl,nl,il,al,ol,rl,ll,sl,ul=Q.ccclass,cl=Q.property,hl=Q.executeInEditMode,pl=Q.disallowMultiple,dl=Q.requireComponent;Cr=ul("LocalizedLayout"),Er=hl(!0),Ar=dl($),Tr=cl(p),Rr=a.required(),Pr=cl($),Or=cl({visible:!1}),Ir=cl({visible:!1}),Lr=cl({visible:!1}),_r=cl({visible:!1}),Dr=cl({type:te,group:"Padding"}),Mr=cl({type:te,group:"Padding"}),Nr=cl({type:te,group:"Padding"}),zr=cl({type:te,group:"Padding"}),Cr(Br=pl(Br=Er(Br=Ar((xr=D((Fr=function(e){B(i,e);var n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"label",xr,x(e)),z(e,"layout",Ur,x(e)),z(e,"_top",Gr,x(e)),z(e,"_down",Hr,x(e)),z(e,"_left",Vr,x(e)),z(e,"_right",qr,x(e)),e.updateContentSize=function(t){var n,i=(null!=t?t:{}).localize;if(void 0!==e.label&&(void 0===i||e.label===i)){var a=null===(n=e.label.getComponent($))||void 0===n?void 0:n.contentSize;void 0!==a&&e.layout.setContentSize(a.width+e.left+e.right,a.height+e.top+e.down)}},e}return M(i,[{key:"top",get:function(){return this._top},set:function(e){this._top=e,this.updateContentSize()}},{key:"down",get:function(){return this._down},set:function(e){this._down=e,this.updateContentSize()}},{key:"left",get:function(){return this._left},set:function(e){this._left=e,this.updateContentSize()}},{key:"right",get:function(){return this._right},set:function(e){this._right=e,this.updateContentSize()}},{key:"__preload",value:function(){this.layout=this.getComponent($),a.validateRequiredProperties(this)}},{key:"start",value:function(){this.updateContentSize()}},{key:"onEnable",value:function(){this.listenEvent()}},{key:"onDisable",value:function(){this.unlistenEvent()}},{key:"listenEvent",value:function(){oe.on(t.LOCALIZE_APPLIED,this.updateContentSize)}},{key:"unlistenEvent",value:function(){oe.off(t.LOCALIZE_APPLIED,this.updateContentSize)}}]),i}(re)).prototype,"label",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ur=D(Fr.prototype,"layout",[Rr,Pr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gr=D(Fr.prototype,"_top",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hr=D(Fr.prototype,"_down",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vr=D(Fr.prototype,"_left",[Lr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qr=D(Fr.prototype,"_right",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),D(Fr.prototype,"top",[Dr],Object.getOwnPropertyDescriptor(Fr.prototype,"top"),Fr.prototype),D(Fr.prototype,"down",[Mr],Object.getOwnPropertyDescriptor(Fr.prototype,"down"),Fr.prototype),D(Fr.prototype,"left",[Nr],Object.getOwnPropertyDescriptor(Fr.prototype,"left"),Fr.prototype),D(Fr.prototype,"right",[zr],Object.getOwnPropertyDescriptor(Fr.prototype,"right"),Fr.prototype),Br=Fr))||Br)||Br)||Br);J._RF.pop(),J._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var yl,vl,fl,gl,ml,bl,wl,kl,Sl,Cl=Q.ccclass,El=Q.property,Al=function(){function e(t,n){N(this,e);var i=null!=n?n:{response:1,dampen:1,eager:1};this.k1=e.calcK1(i),this.k2=e.calcK2(i),this.k3=e.calcK3(i),this.xp=t.clone(),this.y=t.clone(),this.yd=new Pe(0,0)}return M(e,[{key:"update",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=n;null===i&&(i=new Pe((t.x-this.xp.x)/e,(t.y-this.xp.y)/e),this.xp.x=t.x,this.xp.y=t.y);var a=Math.max(this.k2,e*e/2+e*this.k1/2,e*this.k1);return this.y.x=this.y.x+e*this.yd.x,this.y.y=this.y.y+e*this.yd.y,this.yd.x=this.yd.x+e*(t.x+this.k3*i.x-this.y.x-this.k1*this.yd.x)/a,this.yd.y=this.yd.y+e*(t.y+this.k3*i.y-this.y.y-this.k1*this.yd.y)/a,this.y}},{key:"setDynamics",value:function(t){this.k1=e.calcK1(t),this.k2=e.calcK2(t),this.k3=e.calcK3(t)}},{key:"reset",value:function(e){this.xp.set(e.x,e.y),this.y.set(e.x,e.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(e){return e.dampen/(Math.PI*e.response)}},{key:"calcK2",value:function(e){return 1/(2*Math.PI*e.response*(2*Math.PI*e.response))}},{key:"calcK3",value:function(e){return e.eager*e.dampen/(2*Math.PI*e.response)}}]),e}(),Tl=(el=Cl("SODConfig"),tl=El({type:te,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),nl=El({type:te,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),il=El({type:te,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),el((rl=D((ol=M((function e(){N(this,e),z(this,"response",rl,this),z(this,"dampen",ll,this),z(this,"eager",sl,this)}))).prototype,"response",[tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),ll=D(ol.prototype,"dampen",[nl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),sl=D(ol.prototype,"eager",[il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),al=ol))||al);J._RF.pop(),J._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var Rl,Pl,Ol,Il,Ll,_l,Dl,Ml,Nl,zl,Bl,Fl,xl,Ul,Gl,Hl,Vl,ql,Wl,Kl,jl,Yl,Xl,Zl,Jl,Ql,$l=Q.ccclass,es=Q.property,ts=(yl=$l("Trail"),vl=es({type:ge,displayName:"Target"}),fl=es({type:me,displayName:"Graphics"}),gl=es({type:[Tl],displayName:"Trail Nodes"}),yl((wl=D((bl=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"target",wl,x(e)),z(e,"graphics",kl,x(e)),z(e,"trailNodes",Sl,x(e)),e.trailNodeInstances=[],e}return M(n,[{key:"reset",value:function(){var e,t=G(this.trailNodeInstances);try{for(t.s();!(e=t.n()).done;){e.value.reset(new Pe(this.node.worldPosition.x,this.node.worldPosition.y))}}catch(e){t.e(e)}finally{t.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(e){this.graphics.clear();var t=this.trailNodeInstances[0];this.drawTrail(e,t,this.target.worldPosition.x,this.target.worldPosition.y);for(var n=1;n<this.trailNodeInstances.length;n++){var i=this.trailNodeInstances[n-1],a=this.trailNodeInstances[n];this.drawTrail(e,a,i.currentState.x,i.currentState.y)}}},{key:"drawTrail",value:function(e,t,n,i){var a=this.graphics,o=new Pe(n,i),r=t.update(e,o),l=new Oe(o.x,o.y,0),s=new Oe(r.x,r.y,0);a.node.inverseTransformPoint(l,l),a.node.inverseTransformPoint(s,s),a.moveTo(l.x,l.y),a.lineTo(s.x,s.y),a.stroke()}},{key:"spawnTrailNodes",value:function(){var e,t=G(this.trailNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=new Pe(this.node.worldPosition.x,this.node.worldPosition.y),a=new Al(i,n);this.trailNodeInstances.push(a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(re)).prototype,"target",[vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kl=D(bl.prototype,"graphics",[fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sl=D(bl.prototype,"trailNodes",[gl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ml=bl))||ml);J._RF.pop(),J._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var ns,is=Q.ccclass,as=Q.executionOrder,os=Q.property,rs=GameCore.Utils.Function,ls="Batch By Name",ss="Batch Label",us="Batch Sprite",cs=(Rl=is("BatchNodes"),Pl=as(99999),Ol=os({group:{name:ls}}),Il=os({type:[ee],group:{name:ls}}),Ll=os({type:[Ie],group:{name:ls}}),_l=os({group:{name:ss}}),Dl=os({group:{name:ss}}),Ml=os({group:{name:ss}}),Nl=os({group:{name:us}}),zl=os({group:{name:us}}),Bl=os({readonly:!0}),Fl=os({readonly:!0}),xl=os({readonly:!0}),Rl(Ul=Pl((Hl=D((Gl=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"batchByName",Hl,x(e)),z(e,"depthNames",Vl,x(e)),z(e,"listName",ql,x(e)),z(e,"batchLabel",Wl,x(e)),z(e,"depthLabel",Kl,x(e)),z(e,"typeLabel",jl,x(e)),z(e,"batchSprite",Yl,x(e)),z(e,"depthSprite",Xl,x(e)),z(e,"batchAllNodes",Zl,x(e)),z(e,"batchDepth",Jl,x(e)),z(e,"checkOverlap",Ql,x(e)),e.batchNode={},e.labelChildren=[],e.spriteChildren=[],e.allChildren=[],e.nameChildren=[],e.originalParents={},e.isInited=!1,e.handleNodeChange=rs.throttle((function(){e.isInited&&(console.warn("handleNodeChange",e.node.name),e.setupBatchNodes(e.node))}),1e3),e.onAfterUpdate=function(){e.isInited&&e.hierarchyChildren()},e.onAfterRender=function(){e.isInited&&e.restoreOriginalChildren()},e}return M(n,[{key:"__preload",value:function(){this.enabled&&(Le.on(_e.EVENT_AFTER_UPDATE,this.onAfterUpdate),Le.on(_e.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){Le.off(_e.EVENT_AFTER_UPDATE,this.onAfterUpdate),Le.off(_e.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){this.isInited||(Le.on(_e.EVENT_AFTER_UPDATE,this.onAfterUpdate),Le.on(_e.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"handleActiveChange",value:function(e){e.once(ge.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.handleNodeChange)}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),Le.off(_e.EVENT_AFTER_UPDATE,this.onAfterUpdate),Le.off(_e.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(e){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(e),this.createGlobalNodes(e),this.createGlobalNameNodes(e),this.createGlobalLabelNode(e),this.createGlobalSpriteNode(e),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var e,t,n,i=this;null===(e=this.batchNode.node)||void 0===e||e.setSiblingIndex(0),null===(t=this.batchNode.label)||void 0===t||t.setSiblingIndex(this.depthLabel),null===(n=this.batchNode.sprite)||void 0===n||n.setSiblingIndex(this.depthSprite),this.listName.forEach((function(e,t){var n,a=i.depthNames[t];void 0!==a?null===(n=i.batchNode[e])||void 0===n||n.setSiblingIndex(a):console.warn("BatchNodes: depth is undefined",e,t,a)}))}},{key:"createGlobalNodes",value:function(e){if(this.batchAllNodes){var t=new ge("GlobalBatchNode");t.active=!0,this.batchNode.node=t,e.addChild(t)}}},{key:"createGlobalNameNodes",value:function(e){if(this.batchByName){var t,n=G(this.listName);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!this.batchNode[i]){var a=new ge(i);a.active=!0,this.batchNode[i]=a,e.addChild(a)}}}catch(e){n.e(e)}finally{n.f()}}}},{key:"createGlobalLabelNode",value:function(e){if(this.batchLabel){var t=new ge("GlobalLabelNode");t.active=!0,this.batchNode.label=t,e.addChild(t)}}},{key:"createGlobalSpriteNode",value:function(e){if(this.batchSprite){var t=new ge("GlobalSpriteNode");t.active=!0,this.batchNode.sprite=t,e.addChild(t)}}},{key:"saveOriginalParents",value:function(){var e,t=[].concat(K(this.labelChildren),K(this.spriteChildren)),n=this.nameChildren,i=G(t);try{for(i.s();!(e=i.n()).done;){var a=e.value;a.node.parent&&(this.handleActiveChange(a.node),this.originalParents[a.uuid]=a.node.parent)}}catch(e){i.e(e)}finally{i.f()}var o,r=G(n);try{for(r.s();!(o=r.n()).done;){var l=o.value;l.parent&&(this.handleActiveChange(l),this.originalParents[l.uuid]=l.parent)}}catch(e){r.e(e)}finally{r.f()}}},{key:"saveOriginalChildren",value:function(e){var t,n=e.children,i=G(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;this.saveLabelChildren(a),this.saveSpriteChildren(a),this.saveNodeChildrenByName(a),this.saveNodeChildrenByType(a)}}catch(e){i.e(e)}finally{i.f()}this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(e){var t;if(this.batchLabel){var n=e.getComponentsInChildren(we),i={none:we.CacheMode.NONE,char:we.CacheMode.CHAR,bitmap:we.CacheMode.BITMAP}[this.typeLabel];i&&(n=n.filter((function(e){return e.cacheMode===i}))),0!==n.length&&(t=this.labelChildren).push.apply(t,K(n))}}},{key:"saveSpriteChildren",value:function(e){var t;if(this.batchSprite){var n=e.getComponentsInChildren(se);0!==n.length&&(t=this.spriteChildren).push.apply(t,K(n))}}},{key:"saveNodeChildrenByName",value:function(e){if(this.batchByName){var t,n=G(e.children);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.listName.includes(i.name)?this.nameChildren.push(i):this.saveNodeChildrenByName(i)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"saveNodeChildrenByType",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.batchAllNodes){var i=e.getComponentsInChildren(re);if((t=this.allChildren).push.apply(t,K(i)),!(this.batchDepth<1||n>=this.batchDepth)){var a,o=G(this.allChildren);try{for(o.s();!(a=o.n()).done;){var r=a.value;this.saveNodeChildrenByType(r.node,this.batchDepth)}}catch(e){o.e(e)}finally{o.f()}}}}},{key:"hierarchyChildren",value:function(){var e,t=function(e,t){e.node.isValid&&e.node.activeInHierarchy&&t&&!e.node.isChildOf(t)&&(e.node.setParent(t,!0),e.node.layer=De.Enum.UI_2D)},n=["GlobalLabelNode","GlobalSpriteNode","GlobalBatchNode"],i=G(this.labelChildren);try{for(i.s();!(e=i.n()).done;){t(e.value,this.batchNode.label)}}catch(e){i.e(e)}finally{i.f()}var a,o=G(this.spriteChildren);try{for(o.s();!(a=o.n()).done;){t(a.value,this.batchNode.sprite)}}catch(e){o.e(e)}finally{o.f()}var r,l=G(this.allChildren);try{for(l.s();!(r=l.n()).done;){t(r.value,this.batchNode.node)}}catch(e){l.e(e)}finally{l.f()}this.allChildren.sort((function(e,t){return e.constructor.name.localeCompare(t.constructor.name)})),this.labelChildren.sort((function(e,t){return e.cacheMode-t.cacheMode}));var s,u=G(this.nameChildren);try{for(u.s();!(s=u.n()).done;){var c=s.value;if(c.isValid&&c.activeInHierarchy&&c.isTransformDirty()){var h=c.getComponent(he);if(!(h&&h.opacity<1||n.includes(c.name))){var p=this.batchNode[c.name];p&&(c.isChildOf(p)||(c.setParent(p,!0),c.layer=De.Enum.UI_2D))}}}}catch(e){u.e(e)}finally{u.f()}}},{key:"restoreOriginalChildren",value:function(){var e=[].concat(K(this.labelChildren),K(this.spriteChildren));if(e.length>0){var t,n=G(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=this.originalParents[i.uuid];a&&(i.node.isChildOf(a)||i.node.setParent(a,!0))}}catch(e){n.e(e)}finally{n.f()}}var o,r=G(this.nameChildren);try{for(r.s();!(o=r.n()).done;){var l=o.value,s=this.originalParents[l.uuid];s&&(l.isChildOf(s)||l.setParent(s,!0))}}catch(e){r.e(e)}finally{r.f()}}}]),n}(re)).prototype,"batchByName",[Ol],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Vl=D(Gl.prototype,"depthNames",[Il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ql=D(Gl.prototype,"listName",[Ll],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wl=D(Gl.prototype,"batchLabel",[_l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Kl=D(Gl.prototype,"depthLabel",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),jl=D(Gl.prototype,"typeLabel",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),Yl=D(Gl.prototype,"batchSprite",[Nl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Xl=D(Gl.prototype,"depthSprite",[zl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Zl=D(Gl.prototype,"batchAllNodes",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Jl=D(Gl.prototype,"batchDepth",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ql=D(Gl.prototype,"checkOverlap",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ul=Gl))||Ul)||Ul);J._RF.pop(),J._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var hs,ps=Q.ccclass,ds=GameCore.Utils.Browser,ys=globalThis.game.player,vs=ps("Vibrate")(ns=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"vibrate",value:function(e){if(this.isVibrateEnable()&&!ds.vibrate(e)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!ys.getPlayerSetting("vibrate")}}]),n}(re))||ns;J._RF.pop(),J._RF.push({},"21fbd1aIo9DNoKfAoZaF1DC","WidgetCanvasTarget",void 0);var fs;(0,Q.ccclass)("WidgetCanvasTarget")(hs=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"__preload",value:function(){var e=this.getComponent(ne);if(e){var t=Me("Canvas");t&&(e.target=t)}}}]),n}(re));J._RF.pop(),J._RF.push({},"4231ekw8TxKt6dwgto3CKYu","CloudAnimation",void 0),J._RF.pop(),J._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var gs=10,ms=20,bs=100,ws=(j(fs={},d.HINT,80),j(fs,d.THUNDER,200),j(fs,d.STORM,150),j(fs,d.PLIERS,150),fs),ks=2e3,Ss=300;J._RF.pop(),J._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var Cs={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};J._RF.pop(),J._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var Es=function(e){return e.UNLOCK_DEV_TOOLS="unlock-dev-tools",e.TRIGGER_UNLOCK_KEY="trigger-unlock-key",e.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",e}(Es||{}),As={Events:Es,UNLOCK_SEQUENCE:"101013012031"};J._RF.pop(),J._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var Ts=function(e){return e.RELOAD_TOURNAMENT="reload-tournament",e}(Ts||{});J._RF.pop(),J._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var Rs=function(e){B(n,e);var t=F(n);function n(e,i){var a;return N(this,n),(a=t.call(this,i)).code=e,a}return M(n)}(Y(Error));J._RF.pop(),J._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var Ps=function(e){B(n,e);var t=F(n);function n(e,i){var a;return N(this,n),(a=t.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=e,a.tournamentId=i,a}return M(n)}(Rs);J._RF.pop(),J._RF.push({},"e80e4nIcfdLN56j5b9SMhvH","LeaderboardUtils",void 0);var Os=globalThis.game.leaderboard,Is=function(){function e(){N(this,e)}var t,n,i;return M(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getAllLeaderboardAsync",value:(i=q((function*(e){if(!Os)return null;var t=yield Os.getLeaderboardResponseAsync(e);if(!t)return null;var n=Os.getLeaderboardName(e);return n?(yield this.requestLeaderboardAsync(n,t.amountPlayer),Os.getLeaderboard(n)):null})),function(e){return i.apply(this,arguments)})},{key:"requestLeaderboardAsync",value:(n=q((function*(e,t){this.isLeaderboardRequesting(e)?yield this.waitForLeaderboardFinishAsync(e):yield Os.requestLeaderboardAsync(e,t)})),function(e,t){return n.apply(this,arguments)})},{key:"waitForLeaderboardFinishAsync",value:(t=q((function*(e){var t=this;if(this.isLeaderboardRequesting(e))return new Promise((function(n){var i=setInterval((function(){t.isLeaderboardRequesting(e)||(clearInterval(i),n())}),100)}))})),function(e){return t.apply(this,arguments)})},{key:"isLeaderboardRequesting",value:function(e){var t;return(null===(t=Os.getLeaderboard(e))||void 0===t?void 0:t.isRequesting)||!1}}]),e}();try{new Is}catch(e){console.error("LeaderboardUtils",e)}J._RF.pop(),J._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var Ls={mapOrder:[{id:1,theme:"summer",skins:["fruit"],levelCount:10},{id:2,theme:"autumn",skins:["flower"],levelCount:10},{id:3,theme:"winter",skins:["tool"],levelCount:10},{id:4,theme:"summer",skins:["sport"],levelCount:10},{id:5,theme:"autumn",skins:["cosmetics"],levelCount:10},{id:6,theme:"winter",skins:["ice-cream"],levelCount:10},{id:7,theme:"summer",skins:["cakes"],levelCount:10},{id:8,theme:"autumn",skins:["car"],levelCount:10},{id:9,theme:"spring-festival",skins:["flower","ice-cream"],levelCount:10},{id:10,theme:"tree-planting-festival",skins:["fruit","car","tool"],levelCount:10},{id:11,theme:"blue-sea-festival",skins:["sport","fruit"],levelCount:10},{id:12,theme:"music-festival",skins:["cakes","car","cosmetics"],levelCount:10},{id:13,theme:"harvest-festival",skins:["fruit","car","tool"],levelCount:10},{id:14,theme:"food-festival",skins:["cakes","ice-cream","cosmetics"],levelCount:10},{id:15,theme:"snow-festival",skins:["cakes","sport"],levelCount:10},{id:16,theme:"light-festival",skins:["ice-cream","car"],levelCount:10},{id:17,theme:"peace-festival",skins:["flower","sport","tool"],levelCount:10},{id:18,theme:"flower-festival",skins:["flower","fruit"],levelCount:10},{id:19,theme:"street-festival",skins:["fruit","ice-cream","sport"],levelCount:10},{id:20,theme:"color-garden",skins:["cakes","cosmetics","tool"],levelCount:10},{id:21,theme:"color-festival",skins:["flower","cakes","fruit"],levelCount:10},{id:22,theme:"nature-summer",skins:["flower","sport"],levelCount:10},{id:23,theme:"snow-mountain",skins:["cakes","ice-cream"],levelCount:10},{id:24,theme:"ice-festival",skins:["ice-cream","cosmetics"],levelCount:10},{id:25,theme:"green-grass-festival",skins:["flower","sport","tool"],levelCount:10},{id:26,theme:"community-festival",skins:["cosmetics","cakes","ice-cream"],levelCount:10},{id:27,theme:"water-festival",skins:["sport","ice-cream","flower"],levelCount:10},{id:28,theme:"animal-festival",skins:["flower","fruit","cakes"],levelCount:10},{id:29,theme:"lost-festival",skins:["sport","tool","car"],levelCount:10},{id:30,theme:"halloween-festival",skins:["cakes","car","fruit"],levelCount:10},{id:31,theme:"snow-music-festival",skins:["ice-cream","sport","tool"],levelCount:10},{id:32,theme:"christmas",skins:["cakes","flower","sport"],levelCount:10},{id:33,theme:"spring-flower-festival",skins:["flower","fruit"],levelCount:10},{id:34,theme:"tet-holiday",skins:["flower","cosmetics","fruit"],levelCount:10},{id:35,theme:"sea-festival",skins:["ice-cream","sport"],levelCount:10},{id:36,theme:"firework-festival",skins:["cosmetics","car","tool"],levelCount:10},{id:37,theme:"halloween-horror",skins:["cakes","car","fruit"],levelCount:10},{id:38,theme:"mid-autumn",skins:["flower","fruit","ice-cream"],levelCount:10},{id:39,theme:"christmas-sweet",skins:["cakes","flower","sport"],levelCount:10},{id:40,theme:"new-year-countdown",skins:["cosmetics","car","tool"],levelCount:10}]};J._RF.pop(),J._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var _s=globalThis.game,Ds=_s.player,Ms=_s.storage,Ns=Ls.mapOrder.map((function(e){return{skins:e.skins,themeId:e.theme,currentProgress:0,maxProgress:e.levelCount,isLocked:!0}})),zs=function(){function e(){N(this,e),this.playerSkinProgress=Ns.map((function(e){return U({},e)}))}return M(e,[{key:"initDefaultPlayerSkinProgress",value:function(){this.playerSkinProgress=Ns.map((function(e){return U({},e)}))}},{key:"initDashboardSceneStorage",value:function(){var e=Ms.getStorage("dashboard");if(null==e){var t=this.getCurrentMapProgressInstance();Ms.addStorage("dashboard",{lastMapPayload:t,numOfMapsPassed:0,animateToCurrentLevel:!1});var n=Ms.getStorage("collection");if(null==n){Ms.addStorage("collection",{lastMapPack:t.id,animateMapPackUnlock:!1});var i=Ms.getStorage("leaderboard_content");if(null==i){Ms.addStorage("leaderboard_content",{lastTabOpened:"global",previousScore:-1});var a=Ms.getStorage("tournament");null==a&&Ms.addStorage("tournament",{animateTournamentLeader:!1,previousScore:-1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){for(var e=void 0,t=void 0,n=0,i=0,a=0,o=0,r=Ls.mapOrder.length;o<r;o++){var l=this.playerSkinProgress[o],s=Ls.mapOrder[o],u=Ls.mapOrder[o+1];if(l.currentProgress<l.maxProgress){var c;a=s.id,e=s.theme,t=null!==(c=null==u?void 0:u.theme)&&void 0!==c?c:e,n=l.currentProgress,i=l.maxProgress;break}}if(void 0===e||void 0===t){var h=Ls.mapOrder[Ls.mapOrder.length-1];return{id:a=h.id,currentTheme:e=h.theme,nextTheme:t=h.theme,progress:n=h.levelCount,max:i=h.levelCount}}return{id:a,currentTheme:e,nextTheme:t,progress:n,max:i}}},{key:"getUnlockedSkinsInstance",value:function(){var e,t=[],n=G(this.playerSkinProgress);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(!i.isLocked&&1===i.skins.length){var a=i.skins[0];a&&t.push(a)}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getLevelSkinsInstance",value:function(e){var t,n=null!=e?e:1,i=0,a=G(Ls.mapOrder);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(i+o.levelCount>=n)return o.skins;i+=o.levelCount}}catch(e){a.e(e)}finally{a.f()}return Ls.mapOrder[Ls.mapOrder.length-1].skins}},{key:"getLevelThemeInstance",value:function(e){var t,n=null!=e?e:1,i=0,a=G(Ls.mapOrder);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(i+o.levelCount>=n)return o.theme;i+=o.levelCount}}catch(e){a.e(e)}finally{a.f()}return Ls.mapOrder[Ls.mapOrder.length-1].theme}},{key:"getThemeSkinsInstance",value:function(e){var t,n=G(Ls.mapOrder);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.theme===e)return i.skins}}catch(e){n.e(e)}finally{n.f()}return[]}},{key:"getCollectionUnlockProgressInstance",value:function(){var e,t=[],n=G(this.playerSkinProgress);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.push({skins:i.skins,theme:i.themeId,progress:i.currentProgress,max:i.maxProgress,isLocked:i.isLocked})}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"updatePlayerSkinProgress",value:function(){var e,t=Ds.getGameData(),n=(null!==(e=null==t?void 0:t.level)&&void 0!==e?e:1)-1;this.playerSkinProgress[0].isLocked=!1;for(var i=0,a=Ls.mapOrder.length;i<a;i++){var o=Ls.mapOrder[i];if(!(n<=0)){var r=n-o.levelCount>=0?o.levelCount:n;n-=r,this.increaseProgress(i,r)}}}},{key:"increaseProgress",value:function(e,t){if(e<0||e>=this.playerSkinProgress.length)throw new Error("increaseProgress: index out of range");var n,i=this.playerSkinProgress[e],a=i.currentProgress,o=i.maxProgress,r=a+t>o?o:a+t;(r>0&&(i.isLocked=!1),r===o)&&((null===(n=Ls.mapOrder[e+1])||void 0===n?void 0:n.skins)&&(this.playerSkinProgress[e+1].isLocked=!1));i.currentProgress=r,i.maxProgress=o}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var e=this.getInstance();e.initDefaultPlayerSkinProgress(),e.updatePlayerSkinProgress(),e.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkins",value:function(e){return this.getInstance().getLevelSkinsInstance(e)}},{key:"getLevelTheme",value:function(e){return this.getInstance().getLevelThemeInstance(e)}},{key:"getThemeSkins",value:function(e){return this.getInstance().getThemeSkinsInstance(e)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"getCurrentUnlockingThemeIndex",value:function(){var e=this.getCollectionUnlockProgress();if(0===e.length)return null;var t=0;return e.forEach((function(e,n){e.isLocked||(t=n)})),t}}]),e}();J._RF.pop(),J._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var Bs=globalThis.game,Fs=Bs.match,xs=Bs.player,Us=Bs.leaderboard,Gs=Bs.frameCapture,Hs=GameCore,Vs=Hs.Utils,qs=Vs.Object,Ws=Vs.Valid,Ks=Vs.String,js=Vs.Array,Ys=Hs.Match.Modes,Xs=Hs.Dtos.Match.Data,Zs=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],Js=function(){function e(){N(this,e)}var t,n,i,a,o,r,l,s,u,c,h,p,d,y,v,f,g,m,b;return M(e,[{key:"processStartSingleModeAsync",value:(b=q((function*(){var e=xs.getPlayerId();yield Fs.single.start.processAsync({playerId:e})})),function(){return b.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(m=q((function*(){yield Fs.single.finish.processAsync()})),function(){return m.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(g=q((function*(){var e=xs.getPlayerId(),t=GameSDK.context.getID();yield Fs.tournament.continue.processAsync({playerId:e,contextId:t})})),function(){return g.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(f=q((function*(){var e=xs.getPlayerId(),t=xs.getBestScore();yield Fs.tournament.finish.processAsync({playerId:e,bestScore:t})})),function(){return f.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(v=q((function*(){try{yield this.processContinueChallengeAsync()}catch(e){if(!qs.hasOwn(e,"name")||Ws.isString(e.name))throw e;"PlayerHasFinishedMatch"===e.name&&(yield this.processChallengeNewOpponentAsync()),"PlayerNotJoinInMatch"===e.name&&(yield this.processJoinChallengeAsync())}})),function(){return v.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(y=q((function*(e){Gs.addWideframeRender("renderResultChallenge",Gs.wideframe.renderResultChallenge),yield Fs.challenge.finish.processAsync(e)})),function(e){return y.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(d=q((function*(){var e=this.getMatchState(),t=e.id,n=e.customData,i=n.playerId,a=n.opponentId;if(!Ws.isString(t))throw new Error("Invalid match id");if(!Ws.isString(i))throw new Error("Invalid player id");if(!Ws.isString(a))throw new Error("Invalid opponent id");var o=GameSDK.context.getID();if(!o)throw new Error("Cannot get contextId");yield Fs.challenge.continue.processAsync({matchId:t,contextId:o,playerId:i,opponentId:a})})),function(){return d.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(p=q((function*(){var e=xs.getConnectedPlayerIds(100,0),t=Math.floor(Math.random()*e.length),n=xs.getPlayerId(),i=e[t];yield Fs.challenge.friend.processAsync({playerId:n,opponentId:i})})),function(){return p.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(h=q((function*(){var e=this.getMatchState(),t=e.id,n=e.customData,i=n.playerId,a=n.opponentId;if(!Ws.isString(t))throw new Error("Invalid match id");if(!Ws.isString(i))throw new Error("Invalid player id");if(!Ws.isString(a))throw new Error("Invalid opponent id");yield Fs.challenge.join.processAsync({matchId:t,playerId:i,opponentId:a})})),function(){return h.apply(this,arguments)})},{key:"getMatchState",value:function(){var e=Fs.getMatchState();if(!e)throw new Error("Match state not found");return e}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(c=q((function*(e){try{switch(null!=e?e:this.getMatchMode()){case Ys.SINGLE:yield this.inst.processStartSingleModeAsync();break;case Ys.TOURNAMENT:yield this.inst.processStartTournamentModeAsync();break;case Ys.CHALLENGE_FRIEND:yield this.inst.processStartChallengeModeAsync();break;default:yield this.inst.processStartSingleModeAsync()}}catch(e){console.warn("startMatchAsync",e)}})),function(e){return c.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(u=q((function*(e){try{yield Fs.handler.setProfileData(e)}catch(e){console.warn("setProfileMatchDataAsync",e)}})),function(e){return u.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(s=q((function*(e){try{yield Fs.handler.setMatchCustomData(e)}catch(e){console.warn("setMatchCustomDataAsync",e)}})),function(e){return s.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(l=q((function*(e){try{yield Fs.handler.setLeaderboardScore(e)}catch(e){console.warn("setLeaderboardScoreAsync",e)}})),function(e){return l.apply(this,arguments)})},{key:"finishMatchAsync",value:(r=q((function*(e){try{switch(this.getMatchMode()){case Ys.SINGLE:yield this.inst.processFinishSingleModeAsync();break;case Ys.TOURNAMENT:yield this.inst.processFinishTournamentModeAsync();break;case Ys.CHALLENGE_FRIEND:yield this.inst.processFinishChallengeModeAsync(e);break;default:yield this.inst.processFinishSingleModeAsync()}}catch(e){console.warn("finishMatchAsync",e)}})),function(e){return r.apply(this,arguments)})},{key:"joinTournamentAsync",value:(o=q((function*(e){var t=xs.getPlayerId();yield Fs.tournament.join.processAsync({tournamentId:e,playerId:t})})),function(e){return o.apply(this,arguments)})},{key:"continueTournamentAsync",value:(a=q((function*(e){var t=xs.getPlayerId();yield Fs.tournament.continue.processAsync({playerId:t,contextId:e})})),function(e){return a.apply(this,arguments)})},{key:"createTournamentName",value:function(){var e=Zs[Ae.randomRangeInt(0,Zs.length-1)],t="".concat(e," Tournament"),n=Ks.removeDiacritics(t);return"".concat(n)}},{key:"getShortName",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,i=e.split(" "),a=0,o="",r=G(i);try{for(r.s();!(t=r.n()).done;){var l=t.value;if(a+l.length+1>n)break;o+="".concat(l," "),a+=l.length+1}}catch(e){r.e(e)}finally{r.f()}return o.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var e,t,n,i=Ks.generateObjectId(),a=xs.getPlayerId(),o=xs.getPlayer().name,r=xs.getGameData(),l=null!==(e=null==r?void 0:r.level)&&void 0!==e?e:1,s=zs.getLevelTheme(l),u=this.inst.getMatchState().profiles;return{score:null!==(t=null===(n=(void 0===u?{}:u)[a])||void 0===n?void 0:n.score)&&void 0!==t?t:0,playerId:a,mode:Ys.TOURNAMENT,name:this.createTournamentName(),leaderboardId:i,payload:{playerId:a,playerName:o,leaderboardId:i,themeId:s}}}},{key:"getTournamentsAsync",value:(i=q((function*(){try{return yield GameSDK.tournament.getTournamentsAsync()}catch(e){return console.error(e),[]}})),function(){return i.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(n=q((function*(){var e=yield this.getTournamentsAsync(),t=js.search(e,(function(e){var t,n=JSON.parse(null!==(t=e.getPayload())&&void 0!==t?t:"{}");return"DEFAULT"===e.getTournamentType()&&n.playerId===xs.getPlayerId()}));if(t)throw new Ps(xs.getPlayerId(),t.getID());var n=this.createTournamentPayload();xs.setGameData({lastCreateTournamentShown:Date.now()}),yield Fs.tournament.create.processAsync(n);var i=n.leaderboardId;Us.addLeaderboard({name:i,type:"tournament",autoSortRank:!0,leaderboardId:i})})),function(){return n.apply(this,arguments)})},{key:"getMatchMode",value:function(){var e=this.inst.getMatchState();return Ws.isString(e.mode)?e.mode:null}},{key:"getMatchCustomData",value:function(){var e=this.inst.getMatchState();return Ws.isObject(e.customData)?e.customData:null}},{key:"getMatchExtraDataAsync",value:(t=q((function*(e){var t=yield Fs.api.getMatchAPI().getMatchDetailByIdAsync(e);return new Xs(t).toObject().extraData})),function(e){return t.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(e,t){this.setMatchCustomDataAsync({level:e,score:t});var n=xs.getPlayerId();this.setProfileMatchDataAsync({id:n,score:t})}}]),e}();J._RF.pop(),J._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var Qs,$s="time",eu="bomb";J._RF.pop(),J._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var tu=(0,Q.ccclass)("InputController")(Qs=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).handleElementPointerDown=function(){},e.handleElementPointerUp=function(e){},e}return M(n,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){Se.os!==Se.OS.WINDOWS&&Se.os!==Se.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){Se.os!==Se.OS.WINDOWS&&Se.os!==Se.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(re))||Qs;J._RF.pop(),J._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var nu={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};J._RF.pop(),J._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var iu="fall-down",au="fly-up",ou="push-left",ru="push-right",lu="put-columns-middle",su="put-rows-middle",uu=[iu,au,ou,ru,lu,su],cu=[iu,au,su],hu=[ou,ru,lu];function pu(e){for(var t=e.array,n=e.isLighter,i=e.out,a=void 0===i?new Set:i,o=0;o<t.length;o++)if(n(t.get(o)))for(var r=o+1;r<t.length;r++)if(!n(t.get(r))){t.swap(o,r),a.add(t.get(o));break}return a}J._RF.pop(),J._RF.push({},"bfb989Gr/dArq4M9uSSrF5/","stagger",void 0),J._RF.pop(),J._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var du,yu,vu,fu,gu,mu,bu,wu,ku,Su,Cu,Eu,Au,Tu,Ru,Pu,Ou,Iu,Lu,_u,Du,Mu,Nu,zu,Bu,Fu,xu,Uu,Gu,Hu,Vu,qu,Wu,Ku,ju,Yu,Xu,Zu,Ju,Qu,$u,ec,tc,nc,ic,ac,oc,rc,lc=function(){function e(t){var n;N(this,e),this.array=[];var i=null!=t?t:{},a=i.width,o=void 0===a?1:a,r=i.height,l=void 0===r?1:r,s=t instanceof e?t.array:null!==(n=null==t?void 0:t.content)&&void 0!==n?n:[];if(s.length!==o*l)throw new Error("Invalid content length");this.width=o,this.height=l,this.array=K(s)}return M(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(e,t){if(!this.isInBounds(e,t))throw new Error("Out of bounds");return this.array[t*this.width+e]}},{key:"set",value:function(e,t,n){this.array[t*this.width+e]=n}},{key:"isInBounds",value:function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}},{key:"forEach",value:function(e){for(var t=0;t<this.height;t++)for(var n=0;n<this.width;n++)e(this.get(n,t),n,t)}},{key:"map",value:function(e){for(var t=[],n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.push(e(this.get(i,n),i,n));return t}},{key:"reduce",value:function(e,t){for(var n=t,i=0;i<this.height;i++)for(var a=0;a<this.width;a++)n=e(n,this.get(a,i),a,i);return n}},{key:"swap",value:function(e,t){var n=X(e,2),i=n[0],a=n[1],o=X(t,2),r=o[0],l=o[1],s=this.get(i,a);this.set(i,a,this.get(r,l)),this.set(r,l,s)}},{key:"shuffle",value:function(e){for(var t=null!=e?e:this.map((function(e,t,n){return[t,n]})),n=K(t),i=new Set,a=n.length-1;a>0;a--){var o=Ne(0,a+1),r=n[a],l=n[o];n[a]=l,n[o]=r,i.add(this.get(r[0],r[1])),i.add(this.get(l[0],l[1]))}for(var s=0;s<n.length;s++){var u=t[s],c=X(u,2),h=c[0],p=c[1],d=n[s],y=X(d,2),v=y[0],f=y[1];this.swap([h,p],[v,f])}return i}},{key:"toShuffled",value:function(t){var n=new e({width:this.width,height:this.height,content:this.array}),i=n.shuffle(t);return[n,i]}},{key:"gravitate",value:function(e){var t=this,n=X(e.rowRange,2),i=n[0],a=n[1],o=X(e.colRange,2),r=o[0],l=o[1],s=e.direction,u=e.isLighter,c=e.onSwap,h=e.out,p=void 0===h?new Set:h,d=l-r+1,y=a-i+1;switch(s){case nu.Up:for(var v=function(e){pu({array:{length:y,get:function(n){return t.get(e,a-n)},swap:function(n,i){var o=t.get(e,a-n),r=t.get(e,a-i);t.swap([e,a-n],[e,a-i]),null==c||c(o,r)}},isLighter:u,out:p})},f=r;f<=l;f++)v(f);return p;case nu.Down:for(var g=function(e){pu({array:{length:y,get:function(n){return t.get(e,i+n)},swap:function(n,a){var o=t.get(e,i+n),r=t.get(e,i+a);t.swap([e,i+n],[e,i+a]),null==c||c(o,r)}},isLighter:u,out:p})},m=r;m<=l;m++)g(m);return p;case nu.Left:for(var b=function(e){pu({array:{length:d,get:function(n){return t.get(r+n,e)},swap:function(n,i){var a=t.get(r+n,e),o=t.get(r+i,e);t.swap([r+n,e],[r+i,e]),null==c||c(a,o)}},isLighter:u,out:p})},w=i;w<=a;w++)b(w);return p;case nu.Right:for(var k=function(e){pu({array:{length:d,get:function(n){return t.get(l-n,e)},swap:function(n,i){var a=t.get(l-n,e),o=t.get(l-i,e);t.swap([l-n,e],[l-i,e]),null==c||c(a,o)}},isLighter:u,out:p})},S=i;S<=a;S++)k(S);return p;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var t=new e({width:this.width,height:this.height,content:this.array}),n=t.gravitate.apply(t,arguments);return[t,n]}},{key:"toRotated",value:function(){for(var t=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.set(this.height-1-n,i,this.get(i,n));return t}}]),e}();J._RF.pop(),J._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),J._RF.pop(),J._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var sc=Q.ccclass,uc=Q.property,cc=Q.requireComponent,hc=(du=sc("Tile"),yu=cc([$]),vu=cc([he]),fu=a.required,gu=uc({type:se,group:"Sprite"}),mu=a.required,bu=uc({type:se,group:"Sprite"}),wu=a.required,ku=uc({type:se,group:"Sprite"}),Su=a.required,Cu=uc({type:se,group:"Sprite"}),Eu=a.required,Au=uc({type:$,displayName:"Background UI Transform"}),Tu=a.required,Ru=uc(ze),Pu=a.required,Ou=uc({type:he,group:"Opacity"}),Iu=a.required,Lu=uc({type:he,group:"Opacity"}),_u=a.required,Du=uc({type:he,group:"Opacity"}),Mu=a.required,Nu=uc({type:he,group:"Opacity"}),zu=a.required,Bu=uc(vi),Fu=a.required,xu=uc(Be),Uu=a.required,Gu=uc(ge),Hu=a.onlyRunInLifeCycle,Vu=a.onlyRunInLifeCycleAsync,qu=a.onlyRunInLifeCycleAsync,Wu=a.onlyRunInLifeCycle,du(Ku=yu(Ku=vu((Yu=D((ju=function(t){B(S,t);var n,i,s,u,c,h,p,d,f,g,m,b,w,k=F(S);function S(){var e;N(this,S);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=k.call.apply(k,[this].concat(n)),z(e,"icon",Yu,x(e)),z(e,"bombComponent",Xu,x(e)),z(e,"starComponent",Zu,x(e)),z(e,"background",Ju,x(e)),z(e,"bgUITransform",Qu,x(e)),z(e,"defaultBackground",$u,x(e)),z(e,"uiOpacity",ec,x(e)),z(e,"shineOpacity",tc,x(e)),z(e,"glowOpacity",nc,x(e)),z(e,"iconOpacity",ic,x(e)),z(e,"button",ac,x(e)),z(e,"animationComponent",oc,x(e)),z(e,"container",rc,x(e)),e.clearClip=null,e.shakeClip=null,e.breakClip=null,e.id=null,e.isEmpty=!1,e.coord=new Pe,e.signal=new r,e}return M(S,[{key:"onLoad",value:function(){a.validateRequiredProperties(this,S),this.special=this.createSpecialHandler(y.none)}},{key:"update",value:function(e){var t;(null===(t=this.special)||void 0===t?void 0:t.type)===y.bomb&&this.special.update(e)}},{key:"onDestroy",value:function(){var e,t;(null===(e=this.special)||void 0===e?void 0:e.type)===y.bomb&&(null===(t=this.special)||void 0===t||t.onDestroy())}},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.button.interactable=!e}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(e,t){this.coord.set(e,t)}},{key:"isSimilarTo",value:function(e){return this.id===e.id}},{key:"inSamePositionAs",value:function(e,t){return e instanceof S?this.coord.equals(e.getCoord()):this.coord.x===e&&this.coord.y===t}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(oa.TILE_CLICK,this)}},{key:"setIdentity",value:function(e){this.id=e,this.icon.spriteFrame=e;var t=this.getSize(),n=X(t,2),i=n[0],a=n[1],o=e.originalSize,r=o.width,l=o.height,s=Math.max(r/(.7*i),l/(.7*a));s>1&&this.icon.node.setScale(new Oe(1/s,1/s,1))}},{key:"setSpecialType",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y.none,n=arguments.length>1?arguments[1]:void 0;null===(e=this.special)||void 0===e||e.switch(t,n)}},{key:"setFocused",value:(w=q((function*(t){var n=ie(this.shineOpacity).to(.15,{opacity:t?255:0},{easing:"cubicOut"});this.shineOpacity.node.scale=t?Oe.ZERO:Oe.ONE;var i=ie(this.shineOpacity.node).to(.15,{scale:t?Oe.ONE:Oe.ZERO},{easing:"cubicOut"});if(t){var a=ie(this.glowOpacity).to(2,{opacity:150});a.to(2,{opacity:20}),this.glowOpacityTween=ie(this.glowOpacity).repeatForever(a).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;yield Promise.all([e.runTweenAsync(n),e.runTweenAsync(i)])})),function(e){return w.apply(this,arguments)})},{key:"setEmpty",value:function(){var e,t,n,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty){var a;if(this.signal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),i)return this.setOpacity(0),void(null===(a=this.special)||void 0===a||a.switch(y.none));(null===(e=this.special)||void 0===e?void 0:e.type)!==y.star&&(null===(t=this.special)||void 0===t?void 0:t.type)!==y.bomb||this.special.clear(),null===(n=this.special)||void 0===n||n.switch(y.none),this.setOpacity(0)}}},{key:"setOpacity",value:function(e){this.uiOpacity.opacity=e}},{key:"setHint",value:(b=q((function*(t){var n;if(t){var i=yield this.getShakeClip();if(null===i)return;yield this.runAnimation(i.name,this.signal)}else if(null===(n=this.animationComponent)||void 0===n||n.stop(),this.container){var a=ie(this.container).to(.1,{scale:Oe.ONE,eulerAngles:Oe.ZERO});yield e.runTweenAsync(a,this.signal)}})),function(e){return b.apply(this,arguments)})},{key:"playClearFX",value:(m=q((function*(e){var t=this;this.signal.abort();var n=new r;this.signal=n,this.setOpacity(255),n.addAbortListener((function(){return t.setOpacity(0)}));var i=yield this.getClearClip();null!==i&&(yield this.runAnimationAfterDelay(i.name,e,n),n.aborted||this.setOpacity(0))})),function(e){return m.apply(this,arguments)})},{key:"playOldLightningClearFX",value:(g=q((function*(){var e=this;this.signal.abort();var t=new r;this.signal=t,this.setOpacity(255),t.addAbortListener((function(){return e.setOpacity(0)}));var n=yield this.getOldBreakClip();null!==n&&(yield this.runAnimation(n.name,t),t.aborted||this.setOpacity(0))})),function(){return g.apply(this,arguments)})},{key:"runAnimationAfterDelay",value:(f=q((function*(t,n,i){n&&(yield e.waitTweenAsync(n,i)),yield this.runAnimation(t,i)})),function(e,t,n){return f.apply(this,arguments)})},{key:"runAnimation",value:function(t,n){return e.runAnimationAsync(this.animationComponent,t,n)}},{key:"restore",value:(d=q((function*(t){this.signal.abort();var n=new r;this.signal=n,this.animationComponent.stop(),this.isEmpty=!1,this.setIgnoreInput(!0),t&&this.setIdentity(t),this.setOpacity(255),this.iconOpacity.opacity=255,this.node.setScale(Oe.ZERO),this.background.spriteFrame=this.defaultBackground,this.button.fakeClick(),yield e.runTweenAsync(ie(this.node).to(.3,{scale:Oe.ONE},{easing:"backOut"}),n),this.node.setScale(Oe.ONE),this.setIgnoreInput(!1)})),function(e){return d.apply(this,arguments)})},{key:"sync",value:(p=q((function*(t){var n=t.duration,i=void 0===n?.3:n,a=t.delay,o=void 0===a?0:a,r=t.easing,l=void 0===r?"cubicOut":r,s=(0,t.getTargetPosition)(this.coord),u=new Oe(s.x,s.y,this.node.position.z);yield e.runTweenAsync(ie(this.node).delay(o).to(i,{position:u},{easing:l}))})),function(e){return p.apply(this,arguments)})},{key:"fly",value:(h=q((function*(t){var n=this,i=300,a=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),o=Math.max(i-.7*a,0),r=a/1e3,l=this.node.position.clone(),s=t.getTilePosition(this.coord),u=new Oe(s.x,s.y,this.node.position.z),c=this.background.node,h=2,p=1,d=360,y=.0025*o,v=0,f=new Oe(0,0,0),g=.75-y,m={value:0,prevElapsed:0},b=ie(m);return b.delay(r),b.to(.5,{value:0},{progress:function(e,t,i,a){var o=(h*=-1)*a,r=l.clone();return r.x+=o,n.node.setPosition(r),i}}),b.to(y,{value:1},{progress:function(t,a,r,l){var s=e.expoOut(l),u=y*l-m.prevElapsed,h=y*l,v=o*s;n.setHeight(v,i);var f=n.node.position.clone();p+=.1,Oe.rotateZ(f,f,new Oe(0,0,0),p*Math.PI*u),n.node.setPosition(new Oe(f.x,f.y,f.z));var g=(d+=10)*u;return c.angle+=g,m.prevElapsed=h,r}}),b.call((function(){f.set((n.node.position.x+u.x)/2,(n.node.position.y+u.y)/2,0),m.prevElapsed=0,c.angle%=360,c.angle-=360,v=c.angle})),b.to(g,{value:0},{progress:function(e,t,a,r){var l=g*r-m.prevElapsed,s=g*r,u=o*(1-r);n.setHeight(u,i);var h=n.node.position.clone();return Oe.rotateZ(h,h,f,Math.PI/g*l),n.node.setPosition(new Oe(h.x,h.y,h.z)),c.angle+=-v/g*l,m.prevElapsed=s,a}}),b.call((function(){n.node.setPosition(u),n.setHeight(0,i),c.angle=0})),e.runTweenAsync(b)})),function(e){return h.apply(this,arguments)})},{key:"moveAround",value:(c=q((function*(){for(var t=[{x:1,y:1},{x:-1,y:1},{x:-1,y:-1},{x:1,y:-1}],n=this.container.position.clone(),i=-1,a=0;a<5;a++){for(var o=Ae.randomRangeInt(0,4);i===o;)o=Ae.randomRangeInt(0,4);i=o;var r=t[o];if(r){var l=n.clone().add(new Oe(5*r.x,5*r.y)),s=ie(this.container).to(.1,{position:l},{easing:"smooth"});yield e.runTweenAsync(s)}}var u=ie(this.container).to(.1,{position:n},{easing:"smooth"});yield e.runTweenAsync(u)})),function(){return c.apply(this,arguments)})},{key:"addAnimationClip",value:function(e){this.animationComponent.addClip(e)}},{key:"getClearClip",value:(u=q((function*(){if(this.clearClip)return this.clearClip;var e=yield o.loadAnimClipAsync(v.TILE_CLEAR_ANIM);return e?(this.clearClip=e,this.addAnimationClip(e),e):null})),function(){return u.apply(this,arguments)})},{key:"getShakeClip",value:(s=q((function*(){if(this.shakeClip)return this.shakeClip;var e=yield o.loadAnimClipAsync(v.TILE_SHAKE_ANIM);return e?(this.shakeClip=e,this.addAnimationClip(e),e):null})),function(){return s.apply(this,arguments)})},{key:"getOldBreakClip",value:(i=q((function*(){if(this.breakClip)return this.breakClip;var e=yield o.loadAnimClipAsync(v.TILE_BREAK_ANIM);return e?(this.breakClip=e,this.addAnimationClip(e),e):null})),function(){return i.apply(this,arguments)})},{key:"setHeight",value:function(e,t){if(this.background){var n=this.background.node;n.setPosition(new Oe(n.position.x,e,0)),n.setScale(new Oe(1+e/t*.3,1+e/t*.3,1))}}},{key:"createSpecialHandler",value:function(e,t){var n=this;switch(e){case y.bomb:return this.createBombHandler(null!=t?t:90);case y.star:return this.createStarHandler();default:return{type:y.none,switch:function(e,t){n.special=n.createSpecialHandler(e,t)}}}}},{key:"createBombHandler",value:function(e){var t=this,n=!1,i=e,a=function(){n=!0},o=function(){n=!1};this.node.scene.on(oa.TILE_CLICK,a),this.node.scene.on(oa.USE_ITEM,a),this.node.scene.on(oa.RESUME_TIME,a),this.node.scene.on(oa.PAUSE_TIME,o),this.node.scene.on(oa.TIME_OUT,o),this.bombComponent.node.active=!0;var r=function(){n=!1,t.bombComponent.node.active=!1,i=e,t.node.scene.off(oa.TILE_CLICK,a),t.node.scene.off(oa.USE_ITEM,a),t.node.scene.off(oa.GAME_RESUME,a),t.node.scene.off(oa.GAME_PAUSE,o),t.node.scene.off(oa.TIME_OUT,o)};return{type:y.bomb,update:function(a){n&&(i-=a,t.bombComponent.fillRange=-i/e,i<=0&&(n=!1,t.bombComponent.node.active=!1,t.setEmpty(!0),t.node.scene.emit(oa.BOMB_EXPLODE,t)))},clear:function(){l.playSound(wn.BOMB_DEFUSE)},cleanup:r,onDestroy:function(){t.node.scene.off(oa.TILE_CLICK,a),t.node.scene.off(oa.USE_ITEM,a),t.node.scene.off(oa.GAME_RESUME,a),t.node.scene.off(oa.GAME_PAUSE,o),t.node.scene.off(oa.TIME_OUT,o)},switch:function(e,n){r(),t.special=t.createSpecialHandler(e,n)},detonateImmediately:function(){i=0}}}},{key:"createStarHandler",value:function(){var e=this;this.starComponent.node.active=!0;var t=function(){e.starComponent.node.active=!1};return{type:y.star,clear:function(){e.starComponent.node.active=!1,l.playSound(wn.COLLECT_STARS);var t=e.node.worldPosition,n=t.x,i=t.y;e.node.scene.emit(oa.ADD_STARS,{startAnimationAt:[n,i]})},cleanup:t,switch:function(n){t(),e.special=e.createSpecialHandler(n)}}}}],[{key:"preloadTileAnimations",value:(n=q((function*(){yield Promise.all([o.loadAnimClipAsync(v.TILE_CLEAR_ANIM),o.loadAnimClipAsync(v.TILE_SHAKE_ANIM),o.loadAnimClipAsync(v.TILE_BREAK_ANIM)])})),function(){return n.apply(this,arguments)})}]),S}(re)).prototype,"icon",[fu,gu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xu=D(ju.prototype,"bombComponent",[mu,bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zu=D(ju.prototype,"starComponent",[wu,ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ju=D(ju.prototype,"background",[Su,Cu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qu=D(ju.prototype,"bgUITransform",[Eu,Au],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$u=D(ju.prototype,"defaultBackground",[Tu,Ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ec=D(ju.prototype,"uiOpacity",[Pu,Ou],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tc=D(ju.prototype,"shineOpacity",[Iu,Lu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nc=D(ju.prototype,"glowOpacity",[_u,Du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ic=D(ju.prototype,"iconOpacity",[Mu,Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ac=D(ju.prototype,"button",[zu,Bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oc=D(ju.prototype,"animationComponent",[Fu,xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rc=D(ju.prototype,"container",[Uu,Gu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(ju.prototype,"setOpacity",[Hu],Object.getOwnPropertyDescriptor(ju.prototype,"setOpacity"),ju.prototype),D(ju.prototype,"runAnimationAfterDelay",[Vu],Object.getOwnPropertyDescriptor(ju.prototype,"runAnimationAfterDelay"),ju.prototype),D(ju.prototype,"runAnimation",[qu],Object.getOwnPropertyDescriptor(ju.prototype,"runAnimation"),ju.prototype),D(ju.prototype,"addAnimationClip",[Wu],Object.getOwnPropertyDescriptor(ju.prototype,"addAnimationClip"),ju.prototype),Ku=ju))||Ku)||Ku)||Ku);function pc(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=n.x,o=n.y,r=X(t,2),l=r[0],s=r[1],u=l*(a-(e.width-1)/2)+i*(a-e.width/2),c=s*(o-(e.height-1)/2)+i*(o-e.height/2);return-1===a&&(u+=t[0]/4),a===e.width&&(u-=t[0]/4),-1===o&&(c+=t[1]/4),o===e.height&&(c-=t[1]/4),{x:u,y:c}}function dc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],n=X(e,2),i=n[0],a=n[1],o=X(t,2),r=o[0],l=o[1],s=1-r,u=1-l,c=i*s,h=a*u;return[c,h]}function yc(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.split("-"),i=[],a=0;a<n.length;){var o=null,r=n[a];switch(r){case"normal":a+=1;break;case"fall":o=iu,a+=2;break;case"fly":o=au,a+=2;break;case"push":"left"===n[a+1]?(o=ou,a+=2):(o=ru,a+=2);break;case"put":"columns"===n[a+1]?(o=lu,a+=3):(o=su,a+=3)}o&&(t&&(o=vc(o)),i.push(o))}return i}function vc(e){switch(e){case iu:return ru;case au:return ou;case ou:return iu;case ru:return au;case lu:return su;case su:return lu}}function fc(e){return(e instanceof lc?e.asArray():e).filter((function(e){return!e.isHidden()}))}function gc(e){return(e instanceof lc?e.asArray():e).filter((function(e){return e.isHidden()}))}J._RF.pop(),J._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),J._RF.pop(),J._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),J._RF.pop(),J._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),J._RF.pop(),J._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),J._RF.pop(),J._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),J._RF.pop(),J._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),J._RF.pop(),J._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),J._RF.pop(),J._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),J._RF.pop(),J._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);var mc=GameCore.Utils.Object;function bc(e,t){var n=t.getCoord(),i=n.x,a=n.y;return mc.vals(nu).reduce((function(t,n){var o=n.x,r=n.y,l=i+o,s=a+r;return e.isInBounds(l,s)&&t.push(e.get(l,s)),t}),[])}function wc(e){return Array.isArray(e)}function kc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=wc(e)?e:e.asArray();return n[Fe(t,0,n.length)]}J._RF.pop(),J._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),J._RF.pop(),J._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);var Sc=GameCore.Utils.Array;function Cc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e instanceof lc?e.asArray():e,i=kc(n,t),a=Sc.search(n,(function(e){return e.isSimilarTo(i)&&!e.inSamePositionAs(i)}));if(void 0===a)throw new Error("Could not find a matching tile");return[i,a]}J._RF.pop(),J._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var Ec=function(e){return e};function Ac(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ec;return function*(){var i=e,a=t;i<=0&&(i=Number.POSITIVE_INFINITY);for(var o=0;o<i;o++)yield n(a),a=1e9*xe(a)}()}function Tc(e){return Array.isArray(e)}function Rc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=Tc(e)?e:e.asArray();if(i.length<t)return new Set(i);for(var a=new Set,o=Ac(-1,n),r=o.next();a.size<t;){if(r.done)throw new Error("RNG exhausted");a.add(kc(i,r.value)),r=o.next()}return a}J._RF.pop(),J._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),J._RF.pop(),J._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),J._RF.pop(),J._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var Pc=[1,4];function Oc(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),a=t.specials,o=a.bomb,r=Fe.apply(void 0,[i].concat(Pc)),l=Rc(e,o,i),s=e.asArray().filter((function(e){return!l.has(e)})),u=Rc(s,r,i),c=G(l);try{for(c.s();!(n=c.n()).done;){var h=n.value,p=2*t.time/3;h.setSpecialType(y.bomb,p)}}catch(e){c.e(e)}finally{c.f()}var d,v=G(u);try{for(v.s();!(d=v.n()).done;){var f=d.value;f.setSpecialType(y.star)}}catch(e){v.e(e)}finally{v.f()}}J._RF.pop(),J._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),J._RF.pop(),J._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);var Ic=GameCore.Utils.Array;function Lc(e){var t=e.levelData,n=t.columns,i=t.rows,a=e.identities,o=e.createTile,r=e.seed,l=function(e,t,n){var i,a=[],o=G(Ac(t/2,e,(function(e){return Fe(e,0,n.length)})));try{for(o.s();!(i=o.n()).done;){var r=i.value;a.push(n[r]),a.push(n[r])}}catch(e){o.e(e)}finally{o.f()}return Ic.shuffle(a),a}(void 0===r?Date.now():r,n*i,a),s=_c(e.levelData,a,l),u=_c(e.levelData,a,s.reverse()).reverse().map((function(e){var t=o(e);return t.setIdentity(e),t}));return new lc({width:n,height:i,content:u})}function _c(e,t,n){var i=e.rows,a=e.columns,o=e.rules;if(!o.maxSpaceOfPair)return n;for(var r=function(e,t,n){for(var i=[],a=0;a<t;a++){i[a]=[];for(var o=0;o<n;o++)i[a][o]=e[a*n+o]}return i}(n,i,a),l=0;l<t.length;l++)for(var s=null,u=null,c=0;c<i;c++)for(var h=0;h<a;h++){if(r[c][h]===t[l]){if(!s||!u){s=c,u=h;continue}var p=o.maxSpaceOfPair+1;if(Math.abs(c-s)+Math.abs(h-u)<=p){u=h,s=c;continue}var d=Dc(s,u,c,h),y=r[d.row][d.column];r[d.row][d.column]=r[c][h],r[c][h]=y}}return function(e){for(var t=[],n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)t.push(e[n][i]);return t}(r)}function Dc(e,t,n,i){var a=e,o=t;return n>e&&(a=e+1),n<e&&(a=e-1),i>t&&(o=t+1),i<t&&(o=t-1),{row:a,column:o}}J._RF.pop(),J._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);var Mc=GameCore.Utils.Array;function Nc(e){var t=e.customFen,n=e.identities,i=e.createTile,a=t.idSize,o=t.cols,r=t.rows,l=t.code;if(n.length<t.idSize)throw new Error("Invalid grid code. There are not enough identities/frames ".concat(n.length," to fill it according to fen code ").concat(a));var s=l.split(":");if(s.length!==r)throw new Error("Invalid grid code");var u=/[a-zA-Z]+\d+|./g,c=/[a-zA-Z]+/,h=/\d+/,p=s.reduceRight((function(e,a){var o,r=[],l=a.matchAll(u),s=G(l);try{for(s.s();!(o=s.n()).done;){var p,d,y=o.value[0],v=null===(p=h.exec(y))||void 0===p?void 0:p[0],f=void 0!==v?Number.parseInt(v,10):void 0,g=void 0!==f&&!Number.isNaN(f)&&f<n.length?n[f]:void 0,m=i(void 0!==g?g:n[0]),b=null===(d=c.exec(y))||void 0===d?void 0:d[0],w=void 0!==b?zc(b,t.encoding):void 0;w&&g?m.setSpecialType(w):m.setEmpty(),r.push(m)}}catch(e){s.e(e)}finally{s.f()}return e.concat(r)}),[]);return new lc({width:o,height:r,content:p})}function zc(e,t){var n=Mc.search(Object.entries(t),(function(t){var n=X(t,2);n[0];return n[1]===e}));if(void 0===n)throw new Error("Invalid special type ".concat(e));return n[0]}J._RF.pop(),J._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),J._RF.pop(),J._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);var Bc=GameCore.Utils.Array;function Fc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e.asArray(),i=kc(e,t),a=bc(e,i);if(!a.some((function(e){return e.isSimilarTo(i)}))){var o=kc(a,t),r=Bc.search(n,(function(e){return!e.inSamePositionAs(i)&&!e.inSamePositionAs(o)&&e.isSimilarTo(o)}));r.setIdentity(i.id),o.setIdentity(i.id)}}J._RF.pop(),J._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),J._RF.pop(),J._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var xc=[{startTile:{x:0,y:1},endTile:{x:3,y:1},localeTextKey:"guide.step1"},{startTile:{x:2,y:2},endTile:{x:3,y:0},localeTextKey:"guide.step2"},{startTile:{x:0,y:0},endTile:{x:3,y:3},localeTextKey:"guide.step3"},{startTile:{x:0,y:4},endTile:{x:2,y:3},localeTextKey:"guide.step4"},{startTile:{x:1,y:4},endTile:{x:1,y:2},localeTextKey:"guide.step5"}];J._RF.pop(),J._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var Uc=GameCore.Utils.Array;function Gc(e,t){return e[0]===t[0]&&e[1]===t[1]}function Hc(e){return new Pe(e[0],e[1])}function Vc(e,t){return e.x>=-1&&e.x<t.width+1&&e.y>=-1&&e.y<t.height+1}function qc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Kc;return t.map((function(t){return[e.tile[0]+t.x,e.tile[1]+t.y]}))}var Wc,Kc=[nu.Up,nu.Down,nu.Left,nu.Right],jc=function(){function e(t,n){var i;if(N(this,e),this.f=0,this.g=0,this.h=0,n&&Gc(t,n.tile))throw new Error("Tile cannot be its own parent");this.tile=t,this.parent=n;var a=e.calcDirection(this),o=n&&a&&n.cache.direction&&!a.equals(n.cache.direction)?1:0;this.cache={direction:a,turns:o+(null!==(i=null==n?void 0:n.cache.turns)&&void 0!==i?i:0)}}return M(e,[{key:"getKey",value:function(){var e;return"x:".concat(this.tile[0],",y:").concat(this.tile[1],",d:").concat(null===(e=this.cache.direction)||void 0===e?void 0:e.toString())}},{key:"equals",value:function(e){return this.getKey()===e.getKey()}}],[{key:"calcDirection",value:function(e){if(e.parent){var t=e.parent.tile,n=e.tile;return new Pe(n[0]-t[0],n[1]-t[1])}return null}}]),e}();function Yc(e,t,n){var i=Jc(e,t),a=Jc(e,n);if(0===i.length||0===a.length)return Xc(t,n);var o=function(e,t,n){var i=[],a=[],o=new jc(t,null),r=new jc(n,null),l=[r.tile];i.push(o);for(;i.length>0;){var s=i.shift();if(a.push(s),Gc(s.tile,r.tile)){for(var u=[],c=s,h=s,p=s.parent;p;)p.cache.turns!==h.cache.turns&&(u.unshift({a:Hc(p.tile),b:Hc(c.tile)}),c=p),h=p,p=p.parent;return u.unshift({a:Hc(h.tile),b:Hc(c.tile)}),u}var d,y=qc(s,Jc(e,s.tile,l)),v=G(y);try{var f=function(){var e=d.value,t=new jc(e,s);if(t.cache.turns>8)return 0;var n=Gc(t.tile,r.tile),o=a.some((function(e){return e.equals(t)}));if(i.some((function(e){return e.equals(t)}))||o&&!n)return 0;t.g=s.g+1+t.cache.turns,t.h=Zc(t,r),t.f=t.g+t.h,i.push(t)};for(v.s();!(d=v.n()).done;)f()}catch(e){v.e(e)}finally{v.f()}i.sort((function(e,t){return e.f-t.f}))}return null}(e,t,n);return o||Xc(t,n)}function Xc(e,t){var n=Hc(e),i=Hc(t);return n.x===i.x||n.y===i.y?[{a:n,b:i}]:[{a:n,b:{x:n.x,y:i.y}},{a:{x:n.x,y:i.y},b:i}]}function Zc(e,t){var n=e.tile,i=t.tile;return Math.abs(n[0]-i[0])+Math.abs(n[1]-i[1])}function Jc(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=[],o=G(Kc);try{var r=function(){var o=n.value,r={x:t[0]+o.x,y:t[1]+o.y};if(e.isInBounds(r.x,r.y))return(e.get(r.x,r.y).isHidden()||Uc.search(i,(function(e){return Gc(e,[r.x,r.y])})))&&a.push(o),1;Vc(r,e)&&a.push(o)};for(o.s();!(n=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}return a}J._RF.pop(),J._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),J._RF.pop(),J._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var Qc=(j(Wc={},y.bomb,"b"),j(Wc,y.star,"s"),j(Wc,y.none,"t"),Wc);function $c(e){return e.reduce((function(e,t,n,i){return t.inSamePositionAs(n,i)||e.push([t,[n,i]]),e}),[])}function*eh(e,t){for(var n=0,i=e-1,a=0,o=t-1;n<=i&&a<=o;){for(var r=n;r<=i;r++)yield{x:r,y:a};for(var l=++a;l<=o;l++)yield{x:i,y:l};for(var s=--i;s>=n;s--)yield{x:s,y:o};for(var u=--o;u>=a;u--)yield{x:n,y:u};n++}}J._RF.pop(),J._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),J._RF.pop(),J._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),J._RF.pop(),J._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var th,nh,ih,ah,oh,rh,lh,sh,uh,ch,hh,ph,dh=GameCore.Utils.Array,yh=function(){function e(t,n){N(this,e),this.coord=new Pe(t,n)}return M(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function vh(e){return new Pe(e[0],e[1])}function fh(e,t,n){if(void 0===t||void 0===n)return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:eh,i=[],a=G(n(e.width,e.height));try{for(a.s();!(t=a.n()).done;){var o=t.value,r=e.get(o.x,o.y);r.isHidden()||i.push([r,[o.x,o.y]])}}catch(e){a.e(e)}finally{a.f()}var l,s=[],u=function(){var t=i.shift(),n=X(t,2),a=n[0],o=n[1];if(dh.search(s,(function(e){return bh(e,o)})))return 0;s.push(o);for(var r,l=function(){var t=X(c[u],2),n=t[0],i=t[1];if(!n.isSimilarTo(a)||dh.search(s,(function(e){return bh(e,i)})))return 0;var r=fh(e,o,i);return null!==r?{v:{v:r}}:void 0},u=0,c=i;u<c.length;u++)if(0!==(r=l())&&r)return r.v};for(;i.length>0;)if(0!==(l=u())&&l)return l.v;return null}(e);var i,a=[t[0]+1,t[1]+1],o=[n[0]+1,n[1]+1],r=function(e){var t=dh.fillWith(e.width+2,(function(e){return new yh(e-1,-1)})),n=dh.fillWith(e.width+2,(function(t){return new yh(t-1,e.height)})),i=dh.fillWith(e.height,(function(e){return new yh(-1,e)})),a=dh.fillWith(e.height,(function(t){return new yh(e.width,t)})),o=function(o,r){var l=o-1,s=r-1;return-1===l?i[s]:l===e.width?a[s]:-1===s?t[l]:s===e.height?n[l]:e.get(l,s)};return{get:function(e,t){return o(e,t)},width:e.width+2,height:e.height+2}}(e),l=[a,o];if(a[0]===o[0]&&kh(r,l,a[1],o[1],a[0])||a[1]===o[1]&&Sh(r,l,a[0],o[0],a[1]))return Ah([{a:vh(a),b:vh(o)}],{x:-1,y:-1});var s=a[1]<=o[1]?a:o,u=a[1]<=o[1]?o:a,c=a[0]<=o[0]?a:o,h=a[0]<=o[0]?o:a,p=[],d=[],y=Ch(r,l,1,vh(s),vh(u)),v=Ch(r,l,-1,vh(s),vh(u));-1===y&&-1===v||(i=-1!==y?y:v,p=[{a:vh(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:o[0],y:i}},{a:{x:o[0],y:i},b:vh(o)}]);var f=Eh(r,l,1,vh(c),vh(h)),g=Eh(r,l,-1,vh(c),vh(h));-1===f&&-1===g||(i=-1!==f?f:g,p=[{a:vh(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:o[1]}},{a:{x:i,y:o[1]},b:vh(o)}]);var m=function(e,t,n,i){for(var a=n.y+1;a<i.y;a++)if(kh(e,t,n.y,a,n.x)&&Sh(e,t,n.x,i.x,a)&&kh(e,t,a,i.y,i.x))return a;return-1}(r,l,vh(s),vh(u));-1!==m&&(i=m,d=[{a:vh(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:o[0],y:i}},{a:{x:o[0],y:i},b:vh(o)}]);var b=function(e,t,n,i){for(var a=n.x+1;a<i.x;a++)if(Sh(e,t,n.x,a,n.y)&&kh(e,t,n.y,i.y,a)&&Sh(e,t,a,i.x,i.y))return a;return-1}(r,l,vh(c),vh(h));return-1!==b&&(i=b,d=[{a:vh(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:o[1]}},{a:{x:i,y:o[1]},b:vh(o)}]),p.length>0&&d.length>0?Ah(gh(p)<=gh(d)?p:d,{x:-1,y:-1}):p.length>0?Ah(p,{x:-1,y:-1}):d.length>0?Ah(d,{x:-1,y:-1}):null}function gh(e){var t,n=0,i=G(e);try{for(i.s();!(t=i.n()).done;){n+=mh(t.value)}}catch(e){i.e(e)}finally{i.f()}return n}function mh(e){return e.a.x===e.b.x?Math.abs(e.a.y-e.b.y):e.a.y===e.b.y?Math.abs(e.a.x-e.b.x):0}function bh(e,t){return e[0]===t[0]&&e[1]===t[1]}function wh(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=e.get.apply(e,K(t));return i.isHidden()||n.some((function(e){return bh(e,t)}))}function kh(e,t,n,i,a){for(var o=Math.min(n,i),r=Math.max(n,i),l=o;l<=r;l++)if(!wh(e,[a,l],t))return!1;return!0}function Sh(e,t,n,i,a){for(var o=Math.min(n,i),r=Math.max(n,i),l=o;l<=r;l++)if(!wh(e,[l,a],t))return!1;return!0}function Ch(e,t,n,i,a){var o=1===n?a.y:i.y,r=1===n?i.x:a.x;if(kh(e,t,i.y,a.y,r))for(;o>=0&&o<e.height&&wh(e,[i.x,o],t)&&wh(e,[a.x,o],t);){if(Sh(e,t,i.x,a.x,o))return o;o+=n}return-1}function Eh(e,t,n,i,a){var o=1===n?a.x:i.x,r=1===n?i.y:a.y;if(Sh(e,t,i.x,a.x,r))for(;o>=0&&o<e.width&&wh(e,[o,i.y],t)&&wh(e,[o,a.y],t);){if(kh(e,t,i.y,a.y,o))return o;o+=n}return-1}function Ah(e,t){return e.map((function(e){return{a:{x:e.a.x+t.x,y:e.a.y+t.y},b:{x:e.b.x+t.x,y:e.b.y+t.y}}}))}J._RF.pop(),J._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var Th=Q.ccclass,Rh=Q.property,Ph=Q.requireComponent,Oh=globalThis.game.monitorError,Ih=GameCore.Utils,Lh=Ih.Array,_h=Ih.Function,Dh=Ih.Valid,Mh=n.Layout,Nh=(th=Th("Board"),nh=Ph($),ih=a.required,ah=Rh(hc),oh=a.required,rh=Rh(ge),lh=Rh({displayName:"Tile Spacing",group:"Create config"}),th(sh=nh((ch=D((uh=function(n){B(u,n);var i,o,r,s=F(u);function u(){var e;N(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),z(e,"tilePrefab",ch,x(e)),z(e,"tilesHolder",hh,x(e)),z(e,"tileTrim",ph,x(e)),e.tileSize=[0,0],e.selectedTile=null,e.parsedGravityRules=[],e.normalMatches=0,e.normalMatchesSinceLastSpawn=0,e.spawnAttempts=0,e.hintPath=null,e.hintTiles=null,e.isAnimating=!1,e.animationQueue=[],e.isConsumingAnimation=!1,e.handleViewResized=_h.debounce((function(){e.updateTilesHolderScale()}),100),e}return M(u,[{key:"onLoad",value:function(){this.widget=this.getComponent(ne),this.uiTransform=this.getComponent($),a.validateRequiredProperties(this,u),this.tilePrefab.node.active=!1,this.listenEvents()}},{key:"onDestroy",value:function(){this.unlistenEvents()}},{key:"hasActiveGrid",value:function(){return void 0!==this.grid}},{key:"create",value:(r=q((function*(t,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();this.levelData=n,this.handleOrientationChanged(Mt.getCurrentLayout()),yield e.waitTweenAsync(0);var o=K(t);Lh.shuffle(o);var r=o.slice(0,n.colors);null==Oh||Oh.addMetadata({frames:r.map((function(e){return e.name}))}),this.parsedGravityRules=yc(n.mode,Mt.isLandscape());var l=function(e){var t=Ge(i.tilePrefab.node),n=t.getComponent(hc);return n.setIdentity(e),i.tilesHolder.addChild(t),t.active=!0,n},s=!1;if(void 0!==n.customFen)try{s=!0,this.grid=Nc({customFen:n.customFen,identities:r,createTile:l}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)}))}catch(e){console.error("Error creating grid from custom fen",e,"falling back to random grid"),s=!1}s||(this.grid=Lc({levelData:n,seed:a,identities:r,createTile:l}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)})),Fc(this.grid,a),Oc(this.grid,n,a)),this.handleBoardLayout();var u=[this.tileTrim.x,this.tileTrim.y];this.tileSize=dc(this.tilePrefab.getSize(),u),this.updateTilesHolderScale(),this.node.scene.emit(oa.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()})),function(e,t){return r.apply(this,arguments)})},{key:"updateTilesHolderScale",value:function(){if(this.grid){var e=[this.grid.width,this.grid.height],t=[this.uiTransform.width,this.uiTransform.height],n=function(e,t,n){var i=X(e,2),a=i[0],o=i[1],r=X(t,2),l=r[0],s=r[1],u=X(n,2),c=u[0]/(a*l),h=u[1]/(o*s);return Math.min(c,h)}(e,this.tilePrefab.getSize(),t);this.tilesHolder.setScale(n,n),this.node.scene.emit(oa.GRID_RESIZE,n)}}},{key:"handleBoardLayout",value:function(){var e,t;this.grid&&Mt.isLandscape()&&0!==this.levelData.level&&(this.grid=(e=this.grid,(t=e.toRotated()).forEach((function(e,t,n){e.setCoord(t,n)})),t))}},{key:"destroyTiles",value:function(){var e;null===(e=this.grid)||void 0===e||e.forEach((function(e){return e.node.destroy()}))}},{key:"animateTilesAppear",value:function(){var t=this;if(void 0===this.grid){var n=new Error("animateTilesAppear: Grid is not initialized");if(Dh.isDebugger())throw n;return null==Oh||Oh.sendException(n),Promise.resolve()}var i=this.grid;return new Promise((function(n){var a=function(){var a=q((function*(){var a=function(e){return pc(i,t.tileSize,e)};yield Promise.all(i.map((function(n,o,r){var l=Ue(0,.5),s=n.node.scale.clone(),u=function(e,n){var i,a=Pe.ZERO.clone(),o=G(t.parsedGravityRules);try{for(o.s();!(i=o.n()).done;){var r=i.value,l=t.getPrimitiveDirection(e,n,r);a.subtract2f(l.x,l.y)}}catch(e){o.e(e)}finally{o.f()}return a.normalize()}(o,r),c=pc(i,t.tileSize,{x:o,y:r}),h=u.multiplyScalar(100).add2f(c.x,c.y);return n.node.setPosition(h.x,h.y),n.node.setScale(0,0),Promise.all([e.runTweenAsync(ie(n.node).delay(l).to(.5,{scale:s},{easing:"elasticOut"})),n.sync({getTargetPosition:a,easing:"backOut",duration:.5,delay:l})])}))),n()}));return function(){return a.apply(this,arguments)}}();t.animationQueue.push(a),t.consumeAnimationQueue()}))}},{key:"animateTilesWave",value:function(){var t=this;if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","animateTilesWave"),Promise.resolve();var n=this.grid;return new Promise((function(i){var a=function(){var t=q((function*(){var t=function(e,t){for(var n=t.x,i=t.y,a="center"===e?{x:(n-1)/2,y:(i-1)/2}:e,o=a.x,r=a.y,l=[],s=0;s<n;s++){for(var u=[],c=0;c<i;c++){var h=o-s,p=r-c,d=Math.sqrt(h*h+p*p);u.push(d)}l.push(u)}return l}("center",{x:n.width,y:n.height});yield Promise.all(n.map((function(n,i,a){var o,r,l=.1*(null!==(o=null===(r=t[i])||void 0===r?void 0:r[a])&&void 0!==o?o:0),s=n.node.scale.clone();return Promise.all([e.runTweenAsync(ie(n.node).delay(l).to(.25,{scale:s.clone().multiplyScalar(1.2)},{easing:"quadOut"}).to(.25,{scale:s},{easing:"quadIn"}))])}))),i()}));return function(){return t.apply(this,arguments)}}();t.animationQueue.push(a),t.consumeAnimationQueue()}))}},{key:"animateTilesError",value:(o=q((function*(){if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","animateTilesError"),Promise.resolve();this.isAnimating||(this.isAnimating=!0,yield Promise.all(this.grid.map((function(e){return e.moveAround()}))),this.isAnimating=!1)})),function(){return o.apply(this,arguments)})},{key:"handleTileClick",value:function(e){if(!e.isHidden()){if(this.selectedTile===e)return l.playSound(wn.TILE_SELECT),this.selectedTile=null,void e.setFocused(!1);if(!this.selectedTile)return l.playSound(wn.TILE_SELECT),this.selectedTile=e,void e.setFocused(!0);if(!this.selectedTile.isSimilarTo(e))return l.playSound(wn.TILE_SELECT),this.selectedTile.setFocused(!1),this.selectedTile=e,void e.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,e),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(e,t){if(void 0!==this.grid){var n=[e.getCoord().x,e.getCoord().y],i=[t.getCoord().x,t.getCoord().y],a=fh(this.grid,n,i);if(null===a){l.playSound(wn.INVALID_MATCH),this.animateTilesError();var o=0===this.levelData.level,r=function(e,t,n,i){if(i){var a=xc[4].startTile,o=xc[4].endTile;if(t[0]===a.x&&t[1]===a.y&&n[0]===o.x&&n[1]===o.y)return[{a:a,b:o}];if(t[0]===o.x&&t[1]===o.y&&n[0]===a.x&&n[1]===a.y)return[{a:a,b:o}]}return Yc(e,t,n)}(this.grid,n,i,o);return this.node.scene.emit(oa.GRID_MATCH,[e,t]),void this.node.scene.emit(oa.GRID_MATCH_FAIL,r)}l.playSound(wn.TILE_MATCH),this.node.scene.emit(oa.GRID_MATCH,[e,t]),this.node.scene.emit(oa.GRID_MATCH_SUCCESS,a,[e,t]),this.clear([[e,t]])}else this.reportOrThrowInDebugger("Grid is not initialized","match")}},{key:"clear",value:function(e,t){this.normalMatches+=e.length;for(var n=0;n<e.length;n++){var i=e[n],a=X(i,2),o=a[0],r=a[1],l=t?2*n*t:0,s=t?(2*n+1)*t:0;o.setEmpty(),r.setEmpty(),o.playClearFX(l),r.playClearFX(s),this.node.scene.emit(oa.GRID_CLEAR,[o,r])}this.processGameplayCycle()}},{key:"clearUsingOldLightningFX",value:function(e){this.normalMatches+=e.length;var t,n=G(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=X(i,2),o=a[0],r=a[1];o.setEmpty(),r.setEmpty(),o.playOldLightningClearFX(),r.playOldLightningClearFX(),this.node.scene.emit(oa.GRID_CLEAR,[o,r])}}catch(e){n.e(e)}finally{n.f()}this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var e=this.hintPath[0],t=this.hintPath[this.hintPath.length-1];if(e&&t){var n=e.a,i=t.b,a=this.getTileAt(n.x,n.y),o=this.getTileAt(i.x,i.y);a&&o?(a.setHint(!0),o.setHint(!0),this.hintTiles=[a,o]):this.reportOrThrowInDebugger("Hint tiles are not valid","showHint")}else this.reportOrThrowInDebugger("Hint path is not valid","showHint")}}},{key:"hideHint",value:function(){if(this.hintTiles){var e=X(this.hintTiles,2),t=e[0],n=e[1];t.setHint(!1),n.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(e,t){return void 0===this.grid?null:this.grid.isInBounds(e,t)?this.grid.get(e,t):null}},{key:"getAnyTileWorldPosition",value:function(e,t){if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getAnyTileWorldPosition"),{x:0,y:0};var n=pc(this.grid,this.tileSize,{x:e,y:t});this.tilePrefab.node.setPosition(n.x,n.y);var i=this.tilePrefab.node.getWorldPosition();return{x:i.x,y:i.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getGridSize",value:function(){return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getGridSize"),[0,0]):[this.grid.width,this.grid.height]}},{key:"getUncleared",value:function(){return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getUncleared"),[]):fc(this.grid)}},{key:"getCleared",value:function(){return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getCleared"),[]):gc(this.grid)}},{key:"getBombTiles",value:function(){return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getBombTiles"),[]):fc((e=this.grid)instanceof lc?e.asArray():e).filter((function(e){var t;return(null===(t=e.special)||void 0===t?void 0:t.type)===y.bomb}));var e}},{key:"getPairs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getPairs"),[];for(var n=[],i=t?fc(this.grid):gc(this.grid),a=function(){var e=Cc(i),t=X(e,2),a=t[0],o=t[1];n.push([a,o]),i=i.filter((function(e){return e!==a&&e!==o}))};n.length<e;)a();return n}},{key:"getBoundingBoxWorld",value:function(){var e=this.tilesHolder.getWorldScale().x,t=this.getGridSize(),n=this.tileSize[0]*e*t[0],i=this.tileSize[1]*e*t[1],a=this.node.getWorldPosition().subtract3f(n/2,i/2,0);return new Ae.Rect(a.x,a.y,n,i)}},{key:"setIgnoreInput",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];null===(e=this.grid)||void 0===e||e.forEach((function(e){return e.setIgnoreInput(t)}))}},{key:"processShuffleRequest",value:function(e){if(void 0!==this.grid){var t=this.processShuffleStep(this.grid,!0,e);this.grid=t[0],this.hintPath=t[1],this.consumeAnimationQueue()}else this.reportOrThrowInDebugger("Grid is not initialized","processShuffleRequest")}},{key:"generateFenFromCurrentLevel",value:function(e){return u.generateFen(null!=e?e:this.levelData)}},{key:"listenEvents",value:function(){oe.on(t.VIEW_RESIZED,this.handleViewResized),oe.on(t.WIDGET_RESIZED,this.handleViewResized),oe.on(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"unlistenEvents",value:function(){oe.off(t.VIEW_RESIZED,this.handleViewResized),oe.off(t.WIDGET_RESIZED,this.handleViewResized),oe.off(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"handleOrientationChanged",value:function(e){var t;e===Mh.Portrait||0===(null===(t=this.levelData)||void 0===t?void 0:t.level)?(this.widget.left=20,this.widget.right=20):e===Mh.Landscape&&(this.widget.left=700,this.widget.right=120)}},{key:"processGameplayCycle",value:function(){if(void 0!==this.grid){var e=fc(this.grid);if(0!==e.length){var t=this.grid,n=e.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,i=this.normalMatchesSinceLastSpawn>=2;n&&(i?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),e.length>14&&(t=this.processGravitationStep(t));var a=this.processShuffleStep(t);this.consumeAnimationQueue(),this.grid=a[0],this.hintPath=a[1]}}else this.reportOrThrowInDebugger("Grid is not initialized","processGameplayCycle")}},{key:"processSpawnStep",value:function(){var e;if(void 0!==this.grid){var t=Rc(gc(this.grid),2),n=X(t,2),i=n[0],a=n[1],o=null!==(e=null==i?void 0:i.id)&&void 0!==e?e:void 0;void 0!==i&&void 0!==o&&void 0!==a?(i.restore(),a.restore(o),this.node.scene.emit(oa.GRID_SPAWN,[i,a])):this.reportOrThrowInDebugger("Failed to get random tiles","processSpawnStep")}else this.reportOrThrowInDebugger("Grid is not initialized","processSpawnStep")}},{key:"processGravitationStep",value:function(e){var t,n=this,i=e,a=[],o=G(this.parsedGravityRules);try{var r=function(){var e=t.value,o=$c(i=n.toGravitated(i,e));if(0===o.length)return 1;var r,l=G(o);try{for(l.s();!(r=l.n()).done;){var s=X(r.value,2),u=s[0],c=X(s[1],2),h=c[0],p=c[1];u.setCoord(h,p)}}catch(e){l.e(e)}finally{l.f()}i.forEach((function(e){e.node.setSiblingIndex(0)}));var d=function(){var e=q((function*(){yield Promise.all(o.map((function(e){var t=X(e,2),a=t[0],o=X(t[1],2),r=o[0],l=o[1];return a.sync({delay:.25,duration:.25,getTargetPosition:function(){return pc(i,n.tileSize,{x:r,y:l})}})})))}));return function(){return e.apply(this,arguments)}}();a.push(d)};for(o.s();!(t=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}var l=function(){var e=q((function*(){for(var e=0,t=a;e<t.length;e++){var n=t[e];yield n()}}));return function(){return e.apply(this,arguments)}}();return this.animationQueue.push(l),i}},{key:"toGravitated",value:function(e,t){var n=new lc(e),i=e.height-1,a=e.width-1,o=[0,i],r=[0,a],l=Math.floor(e.height/2),s=Math.floor(e.width/2),u=function(e){return e.isHidden()};switch(t){case iu:n.gravitate({rowRange:o,colRange:r,direction:nu.Down,isLighter:u});break;case au:n.gravitate({rowRange:o,colRange:r,direction:nu.Up,isLighter:u});break;case ou:n.gravitate({rowRange:o,colRange:r,direction:nu.Left,isLighter:u});break;case ru:n.gravitate({rowRange:o,colRange:r,direction:nu.Right,isLighter:u});break;case lu:n.gravitate({rowRange:o,colRange:[s,a],direction:nu.Left,isLighter:u,out:n.gravitate({rowRange:o,colRange:[0,s-1],direction:nu.Right,isLighter:u})});break;case su:n.gravitate({rowRange:[l,i],colRange:r,direction:nu.Down,isLighter:u,out:n.gravitate({rowRange:[0,l-1],colRange:r,direction:nu.Up,isLighter:u})})}return n}},{key:"getPrimitiveDirection",value:function(e,t,n){if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getPrimitiveDirection"),nu.Down;var i=Math.floor(this.grid.height/2),a=Math.floor(this.grid.width/2);switch(n){case iu:return nu.Down;case au:return nu.Up;case ou:return nu.Left;case ru:return nu.Right;case lu:return e>=a?nu.Left:nu.Right;case su:return t>=i?nu.Down:nu.Up}}},{key:"processShuffleStep",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0,o=fh(e),r=fc(e).map((function(e){var t=e.getCoord();return[t.x,t.y]}));if(null!==o&&!i)return[e,o];var l=100;do{var s=e.toShuffled(r),u=X(s,1);o=fh(n=u[0]),l--}while(null===o&&l>0);if(l<=0){var c,h=n.asArray().map((function(e){var t,n;return{name:null===(t=e.id)||void 0===t?void 0:t.name,type:null===(n=e.special)||void 0===n?void 0:n.type,active:!e.isHidden()}}));return null==Oh||Oh.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",level:this.levelData.level,gridAsArray:h}),this.node.scene.emit(oa.GAME_EXIT),[e,null!==(c=o)&&void 0!==c?c:[]]}var p,d=$c(n),y=G(d);try{for(y.s();!(p=y.n()).done;){var v=X(p.value,2),f=v[0],g=X(v[1],2),m=g[0],b=g[1];f.setCoord(m,b)}}catch(e){y.e(e)}finally{y.f()}var w=void 0!==a?function(){return a(e,n)}:this.createShuffleAnimationHandler(e,n);return this.animationQueue.push(w),[n,null!==(t=o)&&void 0!==t?t:[]]}},{key:"createShuffleAnimationHandler",value:function(e,t){var n=this,i=function(){var i=q((function*(){yield Promise.all(e.map((function(e,i,a){return e.sync({duration:.3,easing:"smooth",getTargetPosition:function(){return pc(t,n.tileSize,{x:i,y:a},10)}})})))}));return function(){return i.apply(this,arguments)}}(),a=function(){var e=q((function*(){t.forEach((function(e){e.node.setSiblingIndex(0)})),yield Promise.all(t.map((function(e){return e.sync({duration:.4,easing:"smooth",delay:Ue(0,.2),getTargetPosition:function(e){return pc(t,n.tileSize,e)}})})))}));return function(){return e.apply(this,arguments)}}();return function(){var e=q((function*(){yield i(),yield a()}));return function(){return e.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(i=q((function*(){if(!this.isConsumingAnimation){for(this.isConsumingAnimation=!0;this.animationQueue.length>0;){if(0===this.getUncleared().length){this.animationQueue=[];break}var e=this.animationQueue.shift();yield null==e?void 0:e()}this.isConsumingAnimation=!1}})),function(){return i.apply(this,arguments)})},{key:"clearAnimationQueue",value:function(){this.isConsumingAnimation=!1,this.animationQueue=[]}},{key:"reportOrThrowInDebugger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown error thrown",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Board",n=new Error("".concat(t,": ").concat(e));if(Dh.isDebugger())throw n;null==Oh||Oh.sendException(n)}}],[{key:"generateFen",value:function(e){for(var t=e,n=[],i=0;i<t.colors;i++)n.push(i+1);var a=Date.now(),o=Lc({levelData:t,seed:a,identities:n,createTile:function(e){var t=e,n=void 0,i=new Pe(0,0);return{get id(){return t},get special(){return n},get coord(){return i},setIdentity:function(e){t=e},isHidden:function(){return!1},setSpecialType:function(e){n={type:e}},setCoord:function(e,t){return i.set(e,t)},getCoord:function(){return i},isSimilarTo:function(e){return e.id===t},inSamePositionAs:function(e){return e.getCoord().equals(i)}}}});return o.forEach((function(e,t,n){e.setCoord(t,n)})),Fc(o,a),Oc(o,t,a),function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qc,n=e.width,i=e.height,a=[],o=new Map,r=i-1;r>=0;r--){for(var l=[],s=0;s<n;s++){var u,c,h=e.get(s,r),p=h.isHidden()?null:h.id;if(null!==p){var d=t[null!==(u=null===(c=h.special)||void 0===c?void 0:c.type)&&void 0!==u?u:y.none];if(!o.has(p)){var v=o.size.toString();o.set(p,v)}var f="".concat(d).concat(o.get(p));l.push(f)}else l.push(".")}a.push(l.join(""))}return{code:a.join(":"),idSize:o.size,encoding:t,rows:i,cols:n}}(o)}}]),u}(re)).prototype,"tilePrefab",[ih,ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hh=D(uh.prototype,"tilesHolder",[oh,rh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ph=D(uh.prototype,"tileTrim",[lh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pe(.025,.1)}}),sh=uh))||sh)||sh);J._RF.pop(),J._RF.push({},"f7e1byg/txJGqnuJJ7xQV1M","withItemAnalytics",void 0);var zh=GameCore.Plugins.Analytics.Events,Bh=globalThis.game.analytics,Fh=function(e,t){return function(){return Bh.event(zh.USE_ITEM,{item_name:e}),t.apply(void 0,arguments)}};J._RF.pop(),J._RF.push({},"bc704Yz8bdJzYja7TsWcGMN","useHintItem",void 0);var xh=Fh(d.PLIERS,(function(e,t){if(!t.isDrawingHint){var n=e.getHintPath();null!==n&&(l.playSound(wn.HINT_ITEM),t.drawHintPath(n,(function(t){return e.getAnyTileWorldPosition(t.x,t.y)})),e.showHint())}}));J._RF.pop(),J._RF.push({},"0a2423JE25HLIm5td77YE7e","usePliersItem",void 0);var Uh=Fh(d.PLIERS,(function(e,t){var n,i=kc(e.getBombTiles()),a=i.node.worldPosition;t.createDefuseExplosionAt(a.x,a.y),l.playSound(wn.BOMB_DEFUSE),null===(n=i.special)||void 0===n||n.switch(y.none)}));J._RF.pop(),J._RF.push({},"d2cd0VZLwhNMJwc3ppHvOtA","withLoweredVolume",void 0);var Gh=function(e){return q((function*(){l.setVolumeMusic(0,!0);var t=yield e.apply(void 0,arguments);return l.setVolumeMusic(.3,!0),t}))};J._RF.pop(),J._RF.push({},"a62ebriH15FfI8l0x1GBX1p","useThunderItem",void 0);var Hh,Vh=function(){var e=q((function*(e,t){if(!(e.getUncleared().length<4)){var n=e.getPairs(2);e.clearSelectedTile();var i=e.node.position.x;yield qh(e,0),yield t.playThunderAnimation(n,e),yield qh(e,i)}}));return function(t,n){return e.apply(this,arguments)}}(),qh=function(){var t=q((function*(t,n){if(t.node.position.x!==n){var i=new Oe(n,t.node.position.y,t.node.position.z),a=ie(t.node).to(.2,{position:i},{easing:"sineOut"});yield e.runTweenAsync(a)}}));return function(e,n){return t.apply(this,arguments)}}(),Wh=Fh(d.THUNDER,Gh((Hh=Vh,q((function*(){o.setBlockInput(!0);var e=yield Hh.apply(void 0,arguments);return o.setBlockInput(!1),e})))));J._RF.pop(),J._RF.push({},"0e50bRTLUtMgYDDkS0nbFm5","useTornadoItem",void 0);var Kh,jh=GameCore.Utils.Function,Yh=function(){var e=q((function*(e,t){var n=yield jh.allSettled(e.map((function(n,i,a){return n.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return pc(e,t,{x:i,y:a},10)}})})));n.some((function(e){return"rejected"===e.status}))&&console.error("Error playing padding animation",n.filter((function(e){return"rejected"===e.status})))}));return function(t,n){return e.apply(this,arguments)}}(),Xh=function(){var e=q((function*(e,t){var n=e.asArray().length;e.forEach((function(t,i,a){t.node.setSiblingIndex(n-1-(i+a*e.width))}));var i=yield jh.allSettled(e.map((function(n){return n.fly({getTilePosition:function(n){return pc(e,t,n)}})})));i.some((function(e){return"rejected"===e.status}))&&console.error("Error playing shuffle animation",i.filter((function(e){return"rejected"===e.status})))}));return function(t,n){return e.apply(this,arguments)}}(),Zh=function(){var e=q((function*(e,t,n,i){l.playSound(wn.SHUFFLE_ITEM),l.playSound(wn.WIND),yield Yh(e,n()),i(),yield Xh(t,n())}));return function(t,n,i,a){return e.apply(this,arguments)}}(),Jh=function(){var e=q((function*(e,t){var n=function(){return e.getTileSize()},i=function(){return t.playTornadoAnimation()},a=Gh((function(e,t){return Zh(e,t,n,i)}));return new Promise((function(t){e.processShuffleRequest(function(){var n=q((function*(n,i){var o=e.node.position.x;yield Qh(e,0),yield a(n,i),yield Qh(e,o),t()}));return function(e,t){return n.apply(this,arguments)}}())}))}));return function(t,n){return e.apply(this,arguments)}}(),Qh=function(){var t=q((function*(t,n){if(t.node.position.x!==n){var i=new Oe(n,t.node.position.y,t.node.position.z),a=ie(t.node).to(.2,{position:i},{easing:"sineOut"});yield e.runTweenAsync(a)}}));return function(e,n){return t.apply(this,arguments)}}(),$h=Fh(d.THUNDER,Gh(Jh));J._RF.pop(),J._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var ep=(0,Q.ccclass)("Line")(Kh=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent($)}},{key:"setPoints",value:function(e,t){this.node.setWorldPosition((e.x+t.x)/2,(e.y+t.y)/2,0),this.uiTransform.width=Pe.distance(e,t)+10,this.uiTransform.width/=this.node.worldScale.x;var n=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI;this.node.eulerAngles=new Oe(0,0,n)}}]),n}(re))||Kh;J._RF.pop(),J._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var tp,np,ip,ap,op,rp,lp,sp,up,cp,hp,pp=function(e){B(n,e);var t=F(n);function n(e,i,a,o,r){var l;return N(this,n),(l=t.call(this,e,i,r)).ator=a,l.ftor=o,l}return M(n,[{key:"alloc",value:function(){var e=H(V(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(e),e}},{key:"free",value:function(e){this.ftor&&this.ftor(e),H(V(n.prototype),"free",this).call(this,e)}}]),n}(He);J._RF.pop(),J._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var dp,yp,vp,fp,gp,mp,bp,wp,kp,Sp=Q.ccclass,Cp=Q.property,Ep=(tp=Sp("PathDrawer"),np=Cp({group:"Line",displayName:"Prefab",type:Ve}),ip=Cp({group:"Line",displayName:"Holder",type:ge,tooltip:"Line Prefab"}),ap=Cp({group:"Point",displayName:"Prefab",type:Ve}),op=Cp({group:"Point",displayName:"Holder",type:ge}),tp((sp=D((lp=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"linePrefab",sp,x(e)),z(e,"lineHolder",up,x(e)),e.lineNodes=[],z(e,"pointPrefab",cp,x(e)),z(e,"pointHolder",hp,x(e)),e.pointNodes=[],e}return M(n,[{key:"start",value:function(){var e=this;this.linePool=new pp((function(){var t=Ge(e.linePrefab);return e.lineHolder.addChild(t),t.parent=e.lineHolder,t.active=!1,t}),0,(function(t){e.lineNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()})),this.pointPool=new pp((function(){var t=Ge(e.pointPrefab);return e.pointHolder.addChild(t),t.active=!1,t}),0,(function(t){e.pointNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()}))}},{key:"drawPath",value:function(e){this.clearPath();var t,n=G(e);try{for(n.s();!(t=n.n()).done;){var i,a=t.value;null===(i=this.linePool.alloc().getComponent(ep))||void 0===i||i.setPoints(a.a,a.b)}}catch(e){n.e(e)}finally{n.f()}}},{key:"clearPath",value:function(){var e,t=G(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.linePool.free(n)}}catch(e){t.e(e)}finally{t.f()}this.lineNodes=[];var i,a=G(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.pointPool.free(o)}}catch(e){a.e(e)}finally{a.f()}this.pointNodes=[]}}]),n}(re)).prototype,"linePrefab",[np],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),up=D(lp.prototype,"lineHolder",[ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cp=D(lp.prototype,"pointPrefab",[ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hp=D(lp.prototype,"pointHolder",[op],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rp=lp))||rp);J._RF.pop(),J._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var Ap,Tp=Q.ccclass,Rp=Q.property,Pp=(dp=Tp("ErrorDrawer"),yp=Rp(ze),vp=Rp(ze),fp=Rp(ze),dp((bp=D((mp=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"one",bp,x(e)),z(e,"two",wp,x(e)),z(e,"error",kp,x(e)),e}return M(n,[{key:"start",value:function(){H(V(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(e){var t=this;if(this.clearPath(),e.forEach((function(n,i){var a;if(null===(a=t.linePool.alloc().getComponent(ep))||void 0===a||a.setPoints(n.a,n.b),0!==i){var o=t.pointPool.alloc();o.setWorldPosition(new Oe(n.a.x,n.a.y,0));var r=o.getComponent(se);1===i&&e.length>3?r.spriteFrame=t.one:2===i&&e.length>3?r.spriteFrame=t.two:r.spriteFrame=t.error}})),1===e.length){var n=this.pointPool.alloc();n.setWorldPosition(new Oe(e[0].a.x+e[0].b.x,e[0].a.y+e[0].b.y,0).multiplyScalar(.5)),n.getComponent(se).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(e){this.pathAppearDuration>0&&(this.pathAppearDuration-=e,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(Ep)).prototype,"one",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wp=D(mp.prototype,"two",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kp=D(mp.prototype,"error",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gp=mp))||gp);J._RF.pop(),J._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var Op,Ip=(0,Q.ccclass)("HintDrawer")(Ap=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"drawPath",value:function(e){this.clearPath(),this.createPath(e),this.showPath()}},{key:"createPath",value:function(e){var t,n=G(e);try{for(n.s();!(t=n.n()).done;){var i,a=t.value;null===(i=this.linePool.alloc().getComponent(ep))||void 0===i||i.setPoints(a.a,a.b),this.pointPool.alloc().setWorldPosition(a.a.x,a.a.y,0)}}catch(e){n.e(e)}finally{n.f()}this.pointPool.alloc().setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0)}},{key:"showPath",value:function(){var e,t=G(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value.getComponent(he);n.opacity=0,ie(n).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){t.e(e)}finally{t.f()}var i,a=G(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value.getComponent(he);o.opacity=0,ie(o).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){a.e(e)}finally{a.f()}}},{key:"clearPath",value:function(){var e,t=this,n=G(this.lineNodes);try{var i=function(){var n=e.value,i=n.getComponent(he);ie(i).to(.15,{opacity:0},{onComplete:function(){i.opacity=255,t.linePool.free(n)}}).start()};for(n.s();!(e=n.n()).done;)i()}catch(e){n.e(e)}finally{n.f()}var a,o=G(this.pointNodes);try{var r=function(){var e=a.value,n=e.getComponent(he);ie(n).to(.15,{opacity:0},{onComplete:function(){n.opacity=255,t.pointPool.free(e)}}).start()};for(o.s();!(a=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(Ep))||Ap;J._RF.pop(),J._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var Lp,_p,Dp,Mp,Np,zp,Bp,Fp,xp,Up=(0,Q.ccclass)("MatchDrawer")(Op=function(t){B(o,t);var n,i,a=F(o);function o(){return N(this,o),a.apply(this,arguments)}return M(o,[{key:"drawPath",value:function(e){var t=this;e.forEach((function(e,n){var i,a=t.linePool.alloc();null===(i=a.getComponent(ep))||void 0===i||i.setPoints(e.a,e.b),t.animateLine(a);var o=t.pointPool.alloc();o.setWorldPosition(e.a.x,e.a.y,0),t.animatePoint(o,n)}));var n=this.pointPool.alloc();n.setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0),this.animatePoint(n,e.length)}},{key:"animateLine",value:(i=q((function*(t){var n=t.getComponent(he);n.opacity=0;var i=ie(n).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});yield e.runTweenAsync(i),n.opacity=255,this.linePool.free(t)})),function(e){return i.apply(this,arguments)})},{key:"animatePoint",value:(n=q((function*(t,n){t.scale=Oe.ZERO;var i=ie(t).delay(.03*n).to(.2,{scale:Oe.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:Oe.ZERO},{easing:"backIn"});yield e.runTweenAsync(i),this.pointPool.free(t)})),function(e,t){return n.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),o}(Ep))||Op;J._RF.pop(),J._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var Gp,Hp=Q.ccclass,Vp=Q.property,qp=(Lp=Hp("PathDraw"),_p=Vp({group:{name:"Path Drawer"},type:Up}),Dp=Vp({group:{name:"Path Drawer"},type:Ip}),Mp=Vp({group:{name:"Path Drawer"},type:Pp}),Lp((Bp=D((zp=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"matchPath",Bp,x(e)),z(e,"hintPath",Fp,x(e)),z(e,"errorPath",xp,x(e)),e.isDrawingHint=!1,e}return M(n,[{key:"onLoad",value:function(){var e=this;this.node.scene.on(oa.GRID_RESIZE,(function(t){e.node.setScale(t,t),e.node.position=e.board.node.position.clone()}))}},{key:"init",value:function(e){this.board=e}},{key:"drawMatchPath",value:function(e,t){var n,i=e.map((function(e){return U({},e)})),a=G(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.a=t(o.a),o.b=t(o.b)}}catch(e){a.e(e)}finally{a.f()}this.matchPath.drawPath(i)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(e,t){if(!this.isDrawingHint){this.isDrawingHint=!0;var n,i=e.map((function(e){return U({},e)})),a=G(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.a=t(o.a),o.b=t(o.b)}}catch(e){a.e(e)}finally{a.f()}this.hintPath.drawPath(i)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(e,t){var n,i=e.map((function(e){return U({},e)})),a=G(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.a=t(o.a),o.b=t(o.b)}}catch(e){a.e(e)}finally{a.f()}this.errorPath.drawPath(i)}}]),n}(re)).prototype,"matchPath",[_p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fp=D(zp.prototype,"hintPath",[Dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xp=D(zp.prototype,"errorPath",[Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Np=zp))||Np);J._RF.pop(),J._RF.push({},"1a5c0RyWQJOipSvNtPLsTHS","ClockManager",void 0);var Wp,Kp=Q.ccclass,jp=Q.disallowMultiple,Yp=Kp("ClockManager")(Gp=jp(Gp=function(t){B(a,t);var n,i=F(a);function a(){var e;N(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=i.call.apply(i,[this].concat(n))).time=0,e.remaining=0,e.running=!1,e.halfTime=!1,e}return M(a,[{key:"onLoad",value:function(){this.node.scene.on(oa.RESCUE_START,this.refillTime,this)}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"setTime",value:function(e){this.time=e,this.remaining=e,this.node.scene.emit(oa.TIME_UPDATED,this.remaining)}},{key:"getRemainingTime",value:function(){return this.remaining}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(oa.TIME_OUT)}},{key:"update",value:function(e){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=e,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(oa.HALF_TIME)),this.remaining>=0&&this.node.scene.emit(oa.TIME_UPDATED,this.remaining)))}},{key:"refillTime",value:(n=q((function*(){var t=this,n=ie(this.node).to(3,{},{onUpdate:function(e,n){if(n){var i=Ae.lerp(0,120,n);t.setTime(i)}}});yield e.runTweenAsync(n),this.setTime(120),this.node.scene.emit(oa.RESCUE_FINISHED)})),function(){return n.apply(this,arguments)})}]),a}(re))||Gp)||Gp;J._RF.pop(),J._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var Xp,Zp,Jp,Qp,$p,ed,td,nd,id,ad,od,rd=Q.ccclass,ld=[wn.COMBO_1,wn.COMBO_2,wn.COMBO_3,wn.COMBO_4,wn.COMBO_5,wn.COMBO_6,wn.COMBO_7,wn.COMBO_8,wn.COMBO_9,wn.COMBO_10,wn.COMBO_11,wn.COMBO_12,wn.COMBO_13],sd=rd("ComboManager")(Wp=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(oa.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(oa.GAME_FINISH,this.resetCombo,this),this.node.scene.on(oa.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(oa.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(oa.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(e){if(this.currentCombo=e,e>0){var t=Math.min(e-1,ld.length-1);l.playSound(ld[t]),this.vibrate(e)}this.emitEvent&&this.node.scene.emit(oa.COMBO_UPDATED,e)}},{key:"vibrate",value:function(e){var t;null===(t=Me("Vibrate"))||void 0===t||null===(t=t.getComponent(vs))||void 0===t||t.vibrate(Math.min(20+20*e,220))}},{key:"setEmitEvent",value:function(e){this.emitEvent=e}}]),n}(re))||Wp;J._RF.pop(),J._RF.push({},"78746Q4viBIlbRROK4J1bSl","Burst",void 0);var ud,cd=Q.ccclass,hd=Q.property,pd=(Xp=cd("Burst"),Zp=hd(te),Jp=hd(ee),Qp=hd(te),$p=hd(ee),Xp((nd=D((td=function(){function e(){N(this,e),z(this,"time",nd,this),z(this,"repeatCount",id,this),z(this,"repeatInterval",ad,this),z(this,"count",od,this),this.remainingCount=0,this.curTime=0}return M(e,[{key:"update",value:function(e,t){if(0===this.remainingCount&&(this.remainingCount=this.repeatCount,this.curTime=this.time),this.remainingCount>0){var n=qe(e.time-e.startDelay.evaluate(0,1),e.duration)-t;n=n>0?n:0;var i=qe(e.time-e.startDelay.evaluate(0,1),e.duration);this.curTime>=n&&this.curTime<i&&(e.emit(this.count,t-(i-this.curTime)),this.curTime+=this.repeatInterval,--this.remainingCount)}}},{key:"reset",value:function(){this.remainingCount=0,this.curTime=0}}]),e}()).prototype,"time",[Zp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),id=D(td.prototype,"repeatCount",[Jp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ad=D(td.prototype,"repeatInterval",[Qp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),od=D(td.prototype,"count",[$p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ed=td))||ed);J._RF.pop(),J._RF.push({},"726cc2e08FBqpVIg/tPM7H2","Particle",void 0);var dd,yd,vd,fd,gd,md,bd,wd,kd,Sd,Cd,Ed,Ad,Td,Rd,Pd,Od,Id=Q.ccclass,Ld=Q.executeInEditMode,_d=Id("Particle")(ud=Ld(!0)(ud=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).remainingLifetime=0,e.startLifetime=0,e}return M(n,[{key:"onLoad",value:function(){this.node.layer=De.Enum.UI_2D}},{key:"init",value:function(e){this.sprite=this.getComponent(se),this.particleSystem=e,this.velocity=Oe.ZERO,this.remainingLifetime=0,this.startLifetime=0,this.startSize=Oe.ZERO,this.startColor=be.WHITE.clone(),this.randomSeed=0}},{key:"reset",value:function(){this.node.rotation.set(0,0,0)}}]),n}(re))||ud)||ud;J._RF.pop(),J._RF.push({},"00eb3NBo0tM/qcD6ViMjx0A","CurveRange",void 0);var Dd,Md,Nd,zd,Bd,Fd,xd,Ud,Gd,Hd,Vd,qd,Wd,Kd,jd,Yd,Xd,Zd=Q.ccclass,Jd=Q.property,Qd=ue({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),$d=(dd=Zd("CurveRange"),yd=Jd({type:ue(Qd)}),vd=Jd({visible:function(){return this.mode===Qd.Constant}}),fd=Jd({visible:function(){return this.mode===Qd.Curve}}),gd=Jd({visible:function(){return this.mode===Qd.TwoCurves}}),md=Jd({visible:function(){return this.mode===Qd.TwoCurves}}),bd=Jd({visible:function(){return this.mode===Qd.TwoConstants}}),wd=Jd({visible:function(){return this.mode===Qd.TwoConstants}}),dd((Cd=D((Sd=function(){function e(){N(this,e),z(this,"mode",Cd,this),z(this,"constant",Ed,this),z(this,"spline",Ad,this),z(this,"splineMin",Td,this),z(this,"splineMax",Rd,this),z(this,"constantMin",Pd,this),z(this,"constantMax",Od,this),this.spline.assignSorted([0,1],[0,1]),this.splineMin.assignSorted([0,1],[0,1]),this.splineMax.assignSorted([0,1],[0,1])}return M(e,[{key:"evaluate",value:function(e,t){switch(this.mode){case Qd.Curve:return this.spline.evaluate(e);case Qd.TwoCurves:return We(this.splineMin.evaluate(e),this.splineMax.evaluate(e),t);case Qd.TwoConstants:return We(this.constantMin,this.constantMax,t);default:return this.constant}}},{key:"getMax",value:function(){switch(this.mode){case Qd.Curve:return 1;case Qd.TwoConstants:return this.constantMax;case Qd.TwoCurves:return 1;default:return this.constant}}},{key:"isZero",value:function(){switch(this.mode){case Qd.Curve:return Ke(1,0,je);case Qd.TwoConstants:return Ke(Math.max(Math.abs(this.constantMax),Math.abs(this.constantMin)),0,je);case Qd.TwoCurves:return Ke(1,0,je);default:return Ke(this.constant,0,je)}}}]),e}()).prototype,"mode",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qd.Constant}}),Ed=D(Sd.prototype,"constant",[vd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ad=D(Sd.prototype,"spline",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ye}}),Td=D(Sd.prototype,"splineMin",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ye}}),Rd=D(Sd.prototype,"splineMax",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ye}}),Pd=D(Sd.prototype,"constantMin",[bd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Od=D(Sd.prototype,"constantMax",[wd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kd=Sd))||kd);J._RF.pop(),J._RF.push({},"3fe5eBRNTJFCZgeD7SqFSh5","GradientRange",void 0);var ey=Q.ccclass,ty=Q.property,ny=ue({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),iy=new be,ay=new be,oy=(Dd=ey("GradientRange"),Md=ty({type:ue(ny)}),Nd=ty({visible:function(){return this.mode===ny.Color}}),zd=ty({visible:function(){return this.mode===ny.TwoColors}}),Bd=ty({visible:function(){return this.mode===ny.TwoColors}}),Fd=ty({visible:function(){return this.mode===ny.Gradient||this.mode===ny.RandomColor}}),xd=ty({visible:function(){return this.mode===ny.TwoGradients}}),Ud=ty({visible:function(){return this.mode===ny.TwoGradients}}),Dd((Vd=D((Hd=function(){function e(){N(this,e),z(this,"mode",Vd,this),z(this,"color",qd,this),z(this,"colorMin",Wd,this),z(this,"colorMax",Kd,this),z(this,"gradient",jd,this),z(this,"gradientMin",Yd,this),z(this,"gradientMax",Xd,this),this._color=be.WHITE.clone()}return M(e,[{key:"evaluate",value:function(e,t){switch(this.mode){case ny.Color:return this.color;case ny.TwoColors:return be.lerp(this._color,this.colorMin,this.colorMax,t),this._color;case ny.RandomColor:return this.gradient.getRandomColor(this._color);case ny.Gradient:return this.gradient.evaluateFast(this._color,e);case ny.TwoGradients:return be.lerp(this._color,this.gradientMin.evaluateFast(iy,e),this.gradientMax.evaluateFast(ay,e),t),this._color;default:return this.color}}}]),e}()).prototype,"mode",[Md],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ny.Color}}),qd=D(Hd.prototype,"color",[Nd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return be.WHITE.clone()}}),Wd=D(Hd.prototype,"colorMin",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return be.WHITE.clone()}}),Kd=D(Hd.prototype,"colorMax",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return be.WHITE.clone()}}),jd=D(Hd.prototype,"gradient",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xe}}),Yd=D(Hd.prototype,"gradientMin",[xd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xe}}),Xd=D(Hd.prototype,"gradientMax",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xe}}),Gd=Hd))||Gd);function ry(e,t,n,i){!function(e,t){Pe.set(e,Math.cos(t),Math.sin(t))}(e,i),e.z=0,Oe.multiplyScalar(e,e,t+(n-t)*Je())}function ly(e){var t=Qd;switch(e.mode){case t.TwoCurves:case t.TwoConstants:return!0;default:return!1}}J._RF.pop(),J._RF.push({},"1a4c4Z/fWpFuL5b3emrVLug","ParticleFunction",void 0),J._RF.pop(),J._RF.push({},"c2fc2/T2apMGZCPX5a4abo/","ModuleRandSeed",void 0);var sy,uy,cy,hy,py,dy,yy,vy=23541,fy=39825,gy=90794,my=91041,by=125292,wy=197866,ky=156497;J._RF.pop(),J._RF.push({},"39785+APfBJU5kvcdjZGiLr","ColorOvertimeModule",void 0);var Sy,Cy,Ey,Ay,Ty,Ry,Py,Oy,Iy,Ly=Q.ccclass,_y=Q.property,Dy=my,My=(sy=Ly("ColorOvertimeModule"),uy=_y({type:ye}),cy=_y({type:oy}),sy((dy=D((py=function(){function e(){N(this,e),z(this,"enable",dy,this),z(this,"color",yy,this)}return M(e,[{key:"update",value:function(e){if(this.enable){var t=e.randomSeed+Dy,n=function(e){var t=ny;switch(e.mode){case t.TwoGradients:case t.TwoColors:return!0;default:return!1}}(this.color)?xe(t):0,i=1-e.remainingLifetime/e.startLifetime;e.sprite.color=e.startColor.clone().multiply(this.color.evaluate(i,n))}}}]),e}()).prototype,"enable",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yy=D(py.prototype,"color",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new oy}}),hy=py))||hy);J._RF.pop(),J._RF.push({},"c397apirpxFfJTJN1KLAcGi","LimitVelocityOvertimeModule",void 0);var Ny,zy,By,Fy,xy,Uy,Gy,Hy=Q.ccclass,Vy=Q.property,qy=vy,Wy=(Sy=Hy("LimitVelocityOvertimeModule"),Cy=Vy({type:ye}),Ey=Vy({type:$d}),Ay=Vy({type:$d}),Sy((Py=D((Ry=function(){function e(){N(this,e),z(this,"enable",Py,this),z(this,"limit",Oy,this),z(this,"dampen",Iy,this),this.limit.constant=500,this.dampen.constant=.2}return M(e,[{key:"update",value:function(e,t){if(this.enable){var n=1-e.remainingLifetime/e.startLifetime,i=e.velocity.clone().normalize(),a=ly(this.limit)?xe(e.randomSeed+qy):0,o=ly(this.dampen)?xe(e.randomSeed+qy+1):0,r=e.velocity.length(),l=this.limit.evaluate(n,a),s=this.dampen.evaluate(n,o);e.velocity=i.multiplyScalar(this.dampenBeyondLimit(r,l,s,t))}}},{key:"dampenBeyondLimit",value:function(e,t,n,i){if(e<=t)return e;var a=1-Math.exp(-n*i);return Ae.lerp(e,t,a)}}]),e}()).prototype,"enable",[Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oy=D(Ry.prototype,"limit",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),Iy=D(Ry.prototype,"dampen",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),Ty=Ry))||Ty);J._RF.pop(),J._RF.push({},"442c2KaGHdNip4TBoeKOOoY","RendererModule",void 0);var Ky,jy,Yy,Xy,Zy,Jy,Qy,$y,ev,tv,nv,iv,av,ov,rv=Q.ccclass,lv=Q.property,sv=(Ny=rv("RendererModule"),zy=lv(Qe),By=lv(ze),Ny((Uy=D((xy=M((function e(){N(this,e),z(this,"material",Uy,this),z(this,"spriteFrame",Gy,this)}))).prototype,"material",[zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gy=D(xy.prototype,"spriteFrame",[By],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fy=xy))||Fy);J._RF.pop(),J._RF.push({},"c6cfbhYVctHt53aUXC4oSWy","RotationOvertimeModule",void 0);var uv,cv,hv,pv,dv,yv,vv,fv,gv,mv,bv,wv,kv,Sv,Cv,Ev,Av,Tv,Rv,Pv,Ov,Iv,Lv,_v=Q.ccclass,Dv=Q.property,Mv=by,Nv=(Ky=_v("RotationOvertimeModule"),jy=Dv({type:ye}),Yy=Dv(ye),Xy=Dv({type:$d}),Zy=Dv({type:$d,visible:function(){return this.separateAxes}}),Jy=Dv({type:$d,visible:function(){return this.separateAxes}}),Qy=Dv({type:$d}),Ky((tv=D((ev=function(){function e(){N(this,e),z(this,"enable",tv,this),z(this,"separateAxes",nv,this),z(this,"x",iv,this),z(this,"y",av,this),z(this,"z",ov,this)}return M(e,[{key:"update",value:function(e,t){if(this.enable){var n=1-e.remainingLifetime/e.startLifetime,i=e.randomSeed+Mv,a=ly(this.z)?xe(i):0,o=this.z.evaluate(n,a)*t,r=0,l=0;if(this.separateAxes){var s=ly(this.x)?xe(i):0,u=ly(this.y)?xe(i):0;r=this.x.evaluate(n,s)*t,l=this.y.evaluate(n,u)*t}e.node.eulerAngles=new Oe(e.node.eulerAngles.x+r,e.node.eulerAngles.y+l,e.node.eulerAngles.z+o)}}}]),e}()).prototype,"enable",[jy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nv=D(ev.prototype,"separateAxes",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),iv=D(ev.prototype,"x",[Xy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),av=D(ev.prototype,"y",[Zy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),ov=D(ev.prototype,"z",[Jy,Qy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),$y=ev))||$y);J._RF.pop(),J._RF.push({},"f63cd4ScDJFPrnTLNT4+QKu","ShapeModule",void 0);var zv,Bv,Fv,xv,Uv,Gv,Hv,Vv=Q.ccclass,qv=Q.property,Wv=ue({Circle:0,Rectangle:1}),Kv=ue({Base:0,Edge:1}),jv=function(){return this.shape===Wv.Circle},Yv=function(){return this.shape===Wv.Rectangle},Xv=[0,0],Zv=(uv=Vv("ShapeModule"),cv=qv({type:ue(Wv)}),hv=qv({type:ue(Kv),visible:Yv}),pv=qv({}),dv=qv({}),yv=qv({}),vv=qv({range:[0,360],visible:jv}),fv=qv({range:[-360,360],visible:jv}),gv=qv({min:0,visible:jv}),mv=qv({range:[0,1],step:.01,visible:jv}),bv=qv({visible:Yv}),uv((Sv=D((kv=function(){function e(){N(this,e),z(this,"shape",Sv,this),z(this,"emitFrom",Cv,this),z(this,"position",Ev,this),z(this,"rotation",Av,this),z(this,"scale",Tv,this),z(this,"arc",Rv,this),z(this,"angle",Pv,this),z(this,"radius",Ov,this),z(this,"radiusThickness",Iv,this),z(this,"rectangleThickness",Lv,this)}return M(e,[{key:"emit",value:function(e){switch(this.shape){case Wv.Circle:this.circleEmit(this.radius,this.radiusThickness,$e(this.generateArcAngle()),e);break;case Wv.Rectangle:this.rectangleEmit(this.emitFrom,this.rectangleThickness,e)}}},{key:"circleEmit",value:function(e,t,n,i){var a=i.node.position;ry(a,e*(1-t),e,n+$e(this.angle)),i.velocity=a.clone().normalize()}},{key:"rectangleEmit",value:function(e,t,n){var i,a,o,r=n.node.position;switch(e){case Kv.Base:a=r,o=t,Pe.set(a,Ue(-o.x,o.x),Ue(-o.y,o.y));break;case Kv.Edge:Xv[0]=Ue(-1,1),Xv[1]=(0===(i=Ue(-1,1))&&i++,Ze.sign(i)),function(e){for(var t=0;t<e.length;t++){var n=t+Ne(0,e.length-t),i=e[n];e[n]=e[t],e[t]=i}}(Xv),this.applyRectThickness(Xv,t),Pe.set(r,Xv[0],Xv[1])}n.velocity=r.clone().normalize()}},{key:"generateArcAngle",value:function(){return Ue(0,this.arc)}},{key:"applyRectThickness",value:function(e,t){t.x>0&&(e[0]*=t.x),t.y>0&&(e[1]*=t.y)}},{key:"gizmo",value:function(e){switch(e.strokeColor.fromHEX("#46C4FFB0"),e.fillColor.fromHEX("#46C4FF77"),e.lineWidth=8,this.shape){case Wv.Circle:this.gizmoCircle(e);break;case Wv.Rectangle:this.gizmoRectangle(e)}}},{key:"gizmoCircle",value:function(e){e.clear();var t=this.angle,n=this.angle+this.arc;if(this.createArcPath(e,this.radius,t,n),this.createArcPath(e,this.radius*(1-this.radiusThickness),t,n),this.arc<360&&this.radius>0){var i=this.radius*Math.cos($e(this.angle)),a=this.radius*Math.sin($e(this.angle)),o=this.radius*Math.cos($e(this.arc+this.angle)),r=this.radius*Math.sin($e(this.arc+this.angle));e.moveTo(i,a),e.lineTo(0,0),e.moveTo(o,r),e.lineTo(0,0)}e.stroke()}},{key:"gizmoRectangle",value:function(e){e.clear();var t=this.rectangleThickness.x,n=this.rectangleThickness.y;e.moveTo(t,n),e.lineTo(-t,n),e.lineTo(-t,-n),e.lineTo(t,-n),e.close(),e.stroke()}},{key:"createArcPath",value:function(e,t,n,i){if(!(t<=0))for(var a=(i-n)/48,o=0;o<=48;o++){var r=n+o*a,l=t*Math.cos($e(r)),s=t*Math.sin($e(r));0===o?e.moveTo(l,s):e.lineTo(l,s)}}}]),e}()).prototype,"shape",[cv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Wv.Circle}}),Cv=D(kv.prototype,"emitFrom",[hv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kv.Base}}),Ev=D(kv.prototype,"position",[pv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(0,0,0)}}),Av=D(kv.prototype,"rotation",[dv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(0,0,0)}}),Tv=D(kv.prototype,"scale",[yv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(1,1,1)}}),Rv=D(kv.prototype,"arc",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 360}}),Pv=D(kv.prototype,"angle",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),Ov=D(kv.prototype,"radius",[gv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Iv=D(kv.prototype,"radiusThickness",[mv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Lv=D(kv.prototype,"rectangleThickness",[bv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pe(20,50)}}),wv=kv))||wv);J._RF.pop(),J._RF.push({},"1b7c1WztGdLzKO8gh4ulm2c","SizeOvertimeModule",void 0);var Jv,Qv,$v,ef,tf,nf,af,of,rf,lf,sf,uf,cf,hf=Q.ccclass,pf=Q.property,df=fy,yf=(zv=hf("SizeOvertimeModule"),Bv=pf({type:ye}),Fv=pf({type:$d}),zv((Gv=D((Uv=function(){function e(){N(this,e),z(this,"enable",Gv,this),z(this,"size",Hv,this),this.size.constant=1}return M(e,[{key:"update",value:function(e){if(this.enable){var t=1-e.remainingLifetime/e.startLifetime,n=e.randomSeed+df,i=ly(this.size)?xe(n):0,a=this.size.evaluate(t,i);e.node.scale=new Oe(a*e.startSize.x,a*e.startSize.y,1)}}}]),e}()).prototype,"enable",[Bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hv=D(Uv.prototype,"size",[Fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),xv=Uv))||xv);J._RF.pop(),J._RF.push({},"530341yf3ZOmaqdU+AYM0/U","SpriteAnimationModule",void 0);var vf,ff,gf,mf,bf,wf,kf,Sf,Cf,Ef=Q.ccclass,Af=Q.property,Tf=gy,Rf=(Jv=Ef("SpriteAnimationModule"),Qv=Af({type:ye}),$v=Af({type:ze}),ef=Af({type:$d}),tf=Af({type:$d}),nf=Af({type:ee}),Jv((rf=D((of=function(){function e(){N(this,e),z(this,"enable",rf,this),z(this,"frames",lf,this),z(this,"frameOverTime",sf,this),z(this,"startFrame",uf,this),z(this,"cycleCount",cf,this),this.frameOverTime.constant=0,this.startFrame.constant=0}return M(e,[{key:"update",value:function(e){if(this.enable){var t=1-e.remainingLifetime/e.startLifetime,n=ly(this.startFrame)?xe(e.randomSeed+Tf):0,i=ly(this.frameOverTime)?xe(e.randomSeed+Tf):0,a=this.startFrame.evaluate(t,n),o=qe(this.cycleCount*(this.frameOverTime.evaluate(t,i)+a),this.frames.length);e.sprite.spriteFrame=this.frames[Math.floor(o)]}}}]),e}()).prototype,"enable",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lf=D(of.prototype,"frames",[$v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sf=D(of.prototype,"frameOverTime",[ef],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),uf=D(of.prototype,"startFrame",[tf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),cf=D(of.prototype,"cycleCount",[nf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),af=of))||af);J._RF.pop(),J._RF.push({},"f6ad5Yz6wpE2ZzModn16CYQ","VelocityOvertimeModule",void 0);var Pf,Of,If,Lf,_f,Df,Mf,Nf,zf,Bf,Ff,xf,Uf,Gf,Hf,Vf,qf,Wf,Kf,jf,Yf,Xf,Zf,Jf,Qf,$f,eg,tg,ng,ig,ag,og,rg,lg,sg,ug,cg,hg,pg,dg,yg,vg,fg,gg,mg,bg,wg,kg,Sg,Cg,Eg,Ag,Tg=Q.ccclass,Rg=Q.property,Pg=(vf=Tg("VelocityOvertimeModule"),ff=Rg({type:ye}),gf=Rg({type:$d}),mf=Rg({type:$d}),vf((kf=D((wf=function(){function e(){N(this,e),z(this,"enable",kf,this),z(this,"x",Sf,this),z(this,"y",Cf,this),this._temp_v3=new Oe,this.x.constant=0,this.y.constant=0}return M(e,[{key:"update",value:function(e,t){if(this.enable){var n=1-e.remainingLifetime/e.startLifetime,i=ly(this.x)?xe(e.randomSeed+wy):0,a=ly(this.y)?xe(e.randomSeed+ky):0,o=Oe.set(this._temp_v3,this.x.evaluate(n,i),this.y.evaluate(n,a),0);Oe.add(e.velocity,e.velocity,o.multiplyScalar(t))}}}]),e}()).prototype,"enable",[ff],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sf=D(wf.prototype,"x",[gf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),Cf=D(wf.prototype,"y",[mf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),bf=wf))||bf);J._RF.pop(),J._RF.push({},"10bc3IfFqBLtpSgVri/NVeX","ParticleSystem",void 0);var Og,Ig,Lg,_g,Dg,Mg,Ng,zg=Q.ccclass,Bg=Q.property,Fg=Q.executeInEditMode,xg=Q.disallowMultiple,Ug=(Pf=zg("ParticleSystem"),Of=Fg(!0),If=xg(!0),Lf=Bg({}),_f=Bg(ye),Df=Bg(te),Mf=Bg(ye),Nf=Bg({type:$d}),zf=Bg({type:$d}),Bf=Bg(oy),Ff=Bg(ye),xf=Bg({type:$d,formerlySerializedAs:"startSize"}),Uf=Bg({type:$d,visible:function(){return this.startSize2D}}),Gf=Bg({type:$d}),Hf=Bg(ye),Vf=Bg({type:$d,formerlySerializedAs:"startRotation"}),qf=Bg({type:$d}),Wf=Bg({type:$d}),Kf=Bg({type:Zv}),jf=Bg({type:Pg}),Yf=Bg({type:yf}),Xf=Bg({type:Nv}),Zf=Bg({type:My}),Jf=Bg({type:Rf}),Qf=Bg({type:Wy}),$f=Bg(pd),eg=Bg({type:sv}),Pf(tg=Of(tg=If((D((ng=function(e){B(n,e);var t=F(n);function n(){var e;return N(this,n),(e=t.call(this))._preview=!1,z(e,"playOnAwake",ig,x(e)),z(e,"duration",ag,x(e)),z(e,"loop",og,x(e)),z(e,"startDelay",rg,x(e)),z(e,"startLifetime",lg,x(e)),z(e,"startColor",sg,x(e)),z(e,"startSize2D",ug,x(e)),z(e,"startSizeX",cg,x(e)),z(e,"startSizeY",hg,x(e)),z(e,"startSpeed",pg,x(e)),z(e,"startRotation3D",dg,x(e)),z(e,"startRotation",yg,x(e)),z(e,"gravityModifier",vg,x(e)),z(e,"rateOverTime",fg,x(e)),z(e,"shapeModule",gg,x(e)),z(e,"velocityOvertimeModule",mg,x(e)),z(e,"sizeOvertimeModule",bg,x(e)),z(e,"rotationOvertimeModule",wg,x(e)),z(e,"colorOvertimeModule",kg,x(e)),z(e,"spriteAnimationModule",Sg,x(e)),z(e,"limitVelocityOvertimeModule",Cg,x(e)),z(e,"bursts",Eg,x(e)),z(e,"rendererModule",Ag,x(e)),e.particles=[],e.time=0,e.emitRateTimeCounter=0,e.isPlaying=!1,e.isStopped=!0,e.isEmitting=!1,e.needToRestart=!1,e.startLifetime.constant=5,e.startSizeX.constant=1,e.startSpeed.constant=5,e.rateOverTime.constant=10,e}return M(n,[{key:"preview",get:function(){return this._preview},set:function(e){this._preview=e,this.graphics&&this.graphics.destroy()}},{key:"onEnable",value:function(){}},{key:"onLoad",value:function(){this.preview=null!==this.getComponent(me),this.node.removeAllChildren()}},{key:"start",value:function(){this.node.position=new Oe(this.node.position.x,this.node.position.y,100),(this.playOnAwake&&!f||this.preview&&f)&&this.play()}},{key:"update",value:function(e){this.isPlaying&&(this.time+=e,this.emitting(e))}},{key:"play",value:function(){this.needToRestart&&(this.needToRestart=!1),this.isStopped&&(this.isStopped=!1),this.time=0,this.isPlaying=!0,this.isEmitting=!0}},{key:"stop",value:function(){this.isPlaying||(this.isPlaying=!1),this.isEmitting||(this.isEmitting=!1),this.isStopped=!0}},{key:"emitting",value:function(e){var t=this,n=this.startDelay.evaluate(0,1);if(this.time>n&&this.time>this.duration+n&&(this.loop||(this.isEmitting=!1)),this.isEmitting){if(this.emitRateTimeCounter+=this.rateOverTime.evaluate(this.time/this.duration,1)*e,this.emitRateTimeCounter>1){var i=Math.floor(this.emitRateTimeCounter);this.emitRateTimeCounter-=i,this.emit(i,e)}var a,o=G(this.bursts);try{for(o.s();!(a=o.n()).done;){a.value.update(this,e)}}catch(e){o.e(e)}finally{o.f()}}var r=this.gravityModifier.evaluate(this.time/this.duration,1);this.particles.forEach((function(n,i){n.node.active&&(t.spriteAnimationModule.update(n),t.sizeOvertimeModule.update(n),t.rotationOvertimeModule.update(n,e),t.colorOvertimeModule.update(n),t.velocityOvertimeModule.update(n,e),t.applyGravityModifier(n,r),t.limitVelocityOvertimeModule.update(n,e),n.node.position.add(n.velocity.clone().multiplyScalar(e)),n.remainingLifetime-=e,n.remainingLifetime<=0&&(n.node.active=!1))}))}},{key:"emit",value:function(e,t){if(null!==this.rendererModule.spriteFrame)for(var n=this.time%this.duration/this.duration,i=0;i<e;i++){var a=this.getFreeParticle();a.init(this),a.reset(),this.shapeModule.emit(a);var o=this.startSpeed.evaluate(n,this.rand());a.velocity=a.velocity.clone().multiplyScalar(o);var r=this.startSizeX.evaluate(n,this.rand()),l=this.startSize2D?new Oe(r,this.startSizeY.evaluate(n,this.rand()),1):new Oe(r,r,1);a.startSize=l.clone(),a.node.scale=l.clone();var s=this.startRotation.evaluate(n,this.rand());a.node.eulerAngles=new Oe(0,0,s),a.startColor=this.startColor.evaluate(n,this.rand()).clone(),a.sprite.color=a.startColor.clone(),a.startLifetime=this.startLifetime.evaluate(n,this.rand())+t,a.remainingLifetime=a.startLifetime,a.randomSeed=Ne(0,233280)}}},{key:"applyGravityModifier",value:function(e,t){e.velocity.add(new Oe(0,-9.8*t,0))}},{key:"rand",value:function(){return xe(Ne(0,Ze.INT_MAX))}},{key:"getFreeParticle",value:function(){var e=this.particles.find((function(e){return!e.node.active}));return e||(e=this.createParticle()),e.node.active=!0,e}},{key:"createParticle",value:function(){var e=new ge,t=Ge(e),n=t.addComponent(_d),i=t.addComponent(se);return this.particles.push(n),i.spriteFrame=this.rendererModule.spriteFrame,i.customMaterial=this.rendererModule.material,this.node.addChild(t),n}}]),n}(re)).prototype,"preview",[Lf],Object.getOwnPropertyDescriptor(ng.prototype,"preview"),ng.prototype),ig=D(ng.prototype,"playOnAwake",[_f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ag=D(ng.prototype,"duration",[Df],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),og=D(ng.prototype,"loop",[Mf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rg=D(ng.prototype,"startDelay",[Nf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),lg=D(ng.prototype,"startLifetime",[zf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),sg=D(ng.prototype,"startColor",[Bf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new oy}}),ug=D(ng.prototype,"startSize2D",[Ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),cg=D(ng.prototype,"startSizeX",[xf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),hg=D(ng.prototype,"startSizeY",[Uf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),pg=D(ng.prototype,"startSpeed",[Gf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),dg=D(ng.prototype,"startRotation3D",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yg=D(ng.prototype,"startRotation",[Vf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),vg=D(ng.prototype,"gravityModifier",[qf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),fg=D(ng.prototype,"rateOverTime",[Wf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $d}}),gg=D(ng.prototype,"shapeModule",[Kf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Zv}}),mg=D(ng.prototype,"velocityOvertimeModule",[jf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pg}}),bg=D(ng.prototype,"sizeOvertimeModule",[Yf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new yf}}),wg=D(ng.prototype,"rotationOvertimeModule",[Xf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Nv}}),kg=D(ng.prototype,"colorOvertimeModule",[Zf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new My}}),Sg=D(ng.prototype,"spriteAnimationModule",[Jf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Rf}}),Cg=D(ng.prototype,"limitVelocityOvertimeModule",[Qf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Wy}}),Eg=D(ng.prototype,"bursts",[Bg,$f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ag=D(ng.prototype,"rendererModule",[eg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new sv}}),tg=ng))||tg)||tg)||tg);J._RF.pop(),J._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var Gg,Hg,Vg,qg,Wg,Kg,jg,Yg,Xg,Zg,Jg,Qg,$g,em,tm,nm,im,am,om,rm,lm,sm=Q.ccclass,um=Q.property,cm=(Og=sm("ItemCollectionFX"),Ig=um(se),Lg=um(Ug),Og((Mg=D((Dg=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"sprite",Mg,x(e)),z(e,"particles",Ng,x(e)),e}return M(n,[{key:"__preload",value:function(){a.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){var e,t=G(this.particles);try{for(t.s();!(e=t.n()).done;){e.value.play()}}catch(e){t.e(e)}finally{t.f()}}}]),n}(re)).prototype,"sprite",[Ig],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ng=D(Dg.prototype,"particles",[Lg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_g=Dg))||_g);J._RF.pop(),J._RF.push({},"a7ff8uVnP1G3ppM9F/A5DYq","Cloud",void 0);var hm=Q.ccclass,pm=Q.property,dm=new Oe(1.2,1.2),ym=new Oe(0,300),vm=(Gg=hm("Cloud"),Hg=pm({type:ge}),Vg=a.required,qg=pm(ge),Wg=a.required,Kg=pm(Ve),jg=a.required,Yg=a.required,Xg=pm(Ve),Zg=a.required,Jg=a.onlyRunInLifeCycleAsync,Qg=a.onlyRunInLifeCycleAsync,$g=a.onlyRunInLifeCycleAsync,Gg((nm=D((tm=function(t){B(c,t);var n,i,o,l,s,u=F(c);function c(){var e;N(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=u.call.apply(u,[this].concat(n)),z(e,"cloudSprites",nm,x(e)),z(e,"raysContainer",im,x(e)),z(e,"rayPrefab",am,x(e)),z(e,"rayPool",om,x(e)),z(e,"oldRayPrefab",rm,x(e)),z(e,"oldRayPool",lm,x(e)),e.cacheDirectionVector=new Oe,e.scaleTweenSignal=new r,e.canvas=null,e}return M(c,[{key:"onLoad",value:function(){this.rayPool=new pp(this.createRay.bind(this),2,this.allocRay.bind(this),this.freeRay.bind(this),this.destroyRay.bind(this)),this.oldRayPool=new pp(this.createOldRay.bind(this),2,this.allocOldRay.bind(this),this.freeOldRay.bind(this),this.destroyOldRay.bind(this)),a.validateRequiredProperties(this,c)}},{key:"createRay",value:function(){var e=Ge(this.rayPrefab);e.active=!1,this.raysContainer.addChild(e);var t=e.getComponent($),n=e.getComponent(Be);if(!t||!n)throw new Error("Cloud.createRay: Invalid prefab");return{node:e,uiTransform:t,animation:n}}},{key:"allocRay",value:function(e){e.node.active=!0}},{key:"freeRay",value:function(e){e.node.active=!1}},{key:"destroyRay",value:function(e){e.node.isValid&&e.node.destroy()}},{key:"createOldRay",value:function(){var e=Ge(this.oldRayPrefab);e.active=!1,this.raysContainer.addChild(e);var t=e.getComponent($);if(!t)throw new Error("Cloud.createOldRay: Invalid prefab");return{node:e,uiTransform:t}}},{key:"allocOldRay",value:function(e){e.node.active=!0}},{key:"freeOldRay",value:function(e){e.node.active=!1}},{key:"destroyOldRay",value:function(e){e.node.isValid&&e.node.destroy()}},{key:"playInitAnimation",value:(s=q((function*(){yield this.moveToScreenCenter()})),function(){return s.apply(this,arguments)})},{key:"playLightningAnimation",value:(l=q((function*(e){yield this.playOldLightningAnimation(e)})),function(e){return l.apply(this,arguments)})},{key:"playOldLightningAnimation",value:(o=q((function*(t){var n=this.oldRayPool.alloc(),i=n.node,a=n.uiTransform;i.setWorldPosition(this.node.worldPosition),this.cacheDirectionVector.set(t),this.cacheDirectionVector.subtract(i.worldPosition);var o=Math.atan2(this.cacheDirectionVector.y,this.cacheDirectionVector.x)*(180/Math.PI)+180,r=this.cacheDirectionVector.length();a.width=r,i.angle=o,yield e.waitTweenAsync(.2),this.oldRayPool.free(n)})),function(e){return o.apply(this,arguments)})},{key:"playScaleTween",value:(i=q((function*(){this.scaleTweenSignal.abort();var t=new r;this.scaleTweenSignal=t,yield Promise.all(this.cloudSprites.map((function(n){return e.runTweenAsync(ie(n).to(.1,{scale:dm},{easing:"quadOut"}).to(.1,{scale:Oe.ONE},{easing:"quadOut"}),t)})))})),function(){return i.apply(this,arguments)})},{key:"moveToScreenCenter",value:(n=q((function*(){var t,n,i;if(this.canvas=null!==(t=null!==(n=this.canvas)&&void 0!==n?n:null===(i=Me("Canvas"))||void 0===i?void 0:i.getComponent($))&&void 0!==t?t:null,this.canvas){var a=this.canvas,o=a.width,r=a.height,l=0,s=0;switch(Math.floor(4*Math.random())){case 0:l=Math.random()*o-o/2,s=r/2+300;break;case 1:l=Math.random()*o-o/2,s=-r/2-300;break;case 2:l=-o/2-300,s=Math.random()*r-r/2;break;case 3:l=o/2+300,s=Math.random()*r-r/2}this.node.setPosition(l,s);var u=ie(this.node).to(.8,{position:ym},{easing:"quadOut"});yield e.runTweenAsync(u)}})),function(){return n.apply(this,arguments)})}]),c}(re)).prototype,"cloudSprites",[Hg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),im=D(tm.prototype,"raysContainer",[Vg,qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am=D(tm.prototype,"rayPrefab",[Wg,Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om=D(tm.prototype,"rayPool",[jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rm=D(tm.prototype,"oldRayPrefab",[Yg,Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm=D(tm.prototype,"oldRayPool",[Zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(tm.prototype,"playLightningAnimation",[Jg],Object.getOwnPropertyDescriptor(tm.prototype,"playLightningAnimation"),tm.prototype),D(tm.prototype,"playOldLightningAnimation",[Qg],Object.getOwnPropertyDescriptor(tm.prototype,"playOldLightningAnimation"),tm.prototype),D(tm.prototype,"playScaleTween",[$g],Object.getOwnPropertyDescriptor(tm.prototype,"playScaleTween"),tm.prototype),em=tm))||em);J._RF.pop(),J._RF.push({},"7df59GGBIxFo7OyHCGrEKe5","addItemEffect",void 0);var fm,gm,mm,bm,wm,km,Sm,Cm,Em,Am,Tm,Rm,Pm,Om,Im,Lm,_m,Dm=function(){var t=q((function*(t,n){t.playExplosionParticles(),l.playSound("sounds/item_reward"),yield Mm(t),yield e.waitTweenAsync(.8),yield Nm(t,n),yield zm(t,n)}));return function(e,n){return t.apply(this,arguments)}}(),Mm=function(){var t=q((function*(t){var n=ie(t.node).to(.1,{scale:new Oe(.8,1.2,1)}).to(.1,{scale:new Oe(1.2,.8,1)}).to(.1,{scale:new Oe(1,1,1)});yield e.runTweenAsync(n)}));return function(e){return t.apply(this,arguments)}}(),Nm=function(){var t=q((function*(t,n){var i=n.node.worldPosition.clone().add3f(0,30,0),a=new Oe(.5,.5,.5),o=ie(t.node).to(1,{worldPosition:i,scale:a},{easing:"cubicInOut"});yield e.runTweenAsync(o)}));return function(e,n){return t.apply(this,arguments)}}(),zm=function(){var t=q((function*(t,n){var i=n.node.worldPosition.clone(),a=i.clone().add3f(0,70,0),o=new Oe(.65,.65,.65),r=ie(t.node).to(.3,{worldPosition:a,scale:o},{easing:"cubicOut"}).to(.5,{worldPosition:i},{easing:"cubicIn"});yield e.runTweenAsync(r)}));return function(e,n){return t.apply(this,arguments)}}();J._RF.pop(),J._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var Bm,Fm,xm,Um,Gm,Hm=Q.ccclass,Vm=Q.property,qm=Q.disallowMultiple,Wm=(fm=Hm("ShiningStar"),gm=Vm(se),mm=Vm({serializable:!0,visible:!1}),bm=Vm({type:te,displayName:"Scale up duration",min:.001}),wm=Vm({serializable:!0,visible:!1}),km=Vm({type:te,displayName:"Bounce and Fall duration",min:.001}),Sm=Vm({serializable:!0,visible:!1}),Cm=Vm({type:te,displayName:"Start scale"}),Em=Vm({serializable:!0,visible:!1}),Am=Vm({type:te,displayName:"End scale"}),fm(Tm=qm((Pm=D((Rm=function(t){B(h,t);var n,i,o,r,l,s,u,c=F(h);function h(){var e;N(this,h);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=c.call.apply(c,[this].concat(n)),z(e,"shine",Pm,x(e)),z(e,"twScaleUpDuration",Om,x(e)),z(e,"twBounceAndFallDuration",Im,x(e)),z(e,"twStartScale",Lm,x(e)),z(e,"twEndScale",_m,x(e)),e.isBeingAnimated=!1,e}return M(h,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(e){this.twScaleUpDuration=e}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(e){this.twBounceAndFallDuration=e}},{key:"startScale",get:function(){return this.twStartScale},set:function(e){this.twStartScale=e}},{key:"endScale",get:function(){return this.twEndScale},set:function(e){this.twEndScale=e}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(he),this.uiOpacity=this.node.getComponent(he),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(u=q((function*(){if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0,yield this.animateAppear(),yield this.animateDisappear(),this.isBeingAnimated=!1})),function(){return u.apply(this,arguments)})},{key:"animateAppear",value:(s=q((function*(){this.shineOpacity.opacity=255,yield Promise.all([this.animateFadeIn(),this.animateScaleUp()])})),function(){return s.apply(this,arguments)})},{key:"animateDisappear",value:(l=q((function*(){yield Promise.all([this.animateBounceAndFall(),this.animateScaleDown()]),this.node.setScale(0,0),this.uiOpacity.opacity=0})),function(){return l.apply(this,arguments)})},{key:"animateBounceAndFall",value:(r=q((function*(){var t=this.node.position.x,n=this.node.position.y,i=[60,120],a=(Math.random()*(i[1]-i[0])+i[0])*(Math.PI/180),o=t+200*Math.cos(a),r=n+200*Math.sin(a),l=n-500,s=e.runTweenAsync(ie(this.node).to(.2*this.twBounceAndFallDuration,{position:new Oe(o,r,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new Oe(o,l,this.node.position.z)},{easing:"cubicIn"})),u=[0,360],c=e.runTweenAsync(ie(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new Oe(0,0,Math.random()*(u[1]-u[0])*(o>t?-1:1))},{easing:"sineOut"}));yield Promise.all([s,c]),this.node.eulerAngles=new Oe(0,0,0)})),function(){return r.apply(this,arguments)})},{key:"animateFadeIn",value:(o=q((function*(){var t=Math.max(this.scaleUpDuration/4,.01);yield e.runTweenAsync(ie(this.uiOpacity).to(t,{opacity:255}))})),function(){return o.apply(this,arguments)})},{key:"animateScaleUp",value:(i=q((function*(){this.node.setScale(this.startScale,this.startScale);var t=new Oe(this.endScale,this.endScale,1);yield e.runTweenAsync(ie(this.node).to(this.scaleUpDuration,{scale:t},{easing:"cubicOut"}))})),function(){return i.apply(this,arguments)})},{key:"animateScaleDown",value:(n=q((function*(){var t=new Oe(0,0,1);yield e.runTweenAsync(ie(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:t},{easing:"cubicIn"}))})),function(){return n.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}}]),h}(re)).prototype,"shine",[gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Om=D(Rm.prototype,"twScaleUpDuration",[mm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),D(Rm.prototype,"scaleUpDuration",[bm],Object.getOwnPropertyDescriptor(Rm.prototype,"scaleUpDuration"),Rm.prototype),Im=D(Rm.prototype,"twBounceAndFallDuration",[wm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),D(Rm.prototype,"bounceAndFallDuration",[km],Object.getOwnPropertyDescriptor(Rm.prototype,"bounceAndFallDuration"),Rm.prototype),Lm=D(Rm.prototype,"twStartScale",[Sm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),D(Rm.prototype,"startScale",[Cm],Object.getOwnPropertyDescriptor(Rm.prototype,"startScale"),Rm.prototype),_m=D(Rm.prototype,"twEndScale",[Em],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),D(Rm.prototype,"endScale",[Am],Object.getOwnPropertyDescriptor(Rm.prototype,"endScale"),Rm.prototype),Tm=Rm))||Tm)||Tm);J._RF.pop(),J._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var Km,jm,Ym,Xm,Zm,Jm,Qm,$m,eb,tb,nb,ib,ab,ob,rb,lb,sb,ub,cb,hb,pb,db,yb,vb,fb,gb,mb,bb,wb,kb,Sb,Cb,Eb,Ab,Tb,Rb,Pb,Ob,Ib,Lb,_b,Db,Mb,Nb,zb,Bb=Q.ccclass,Fb=Q.property,xb=Q.disallowMultiple,Ub=GameCore.Utils.Array,Gb=(Bm=Bb("StarParticles"),Fm=Fb({type:[Wm],displayName:"Prebuilt Shining stars"}),Bm(xm=xb((Gm=D((Um=function(e){B(i,e);var t,n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"shiningStars",Gm,x(e)),e}return M(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(t=q((function*(e){var t=this.getFirstAvailableShiningStar();if(void 0===t)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");var n=X(e,2),i=n[0],a=n[1],o=new Oe(i,a,this.node.worldPosition.z);t.node.worldPosition=o,yield t.playAnimation()})),function(e){return t.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return Ub.search(this.shiningStars,(function(e){return e.isAvailable}))}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}}]),i}(re)).prototype,"shiningStars",[Fm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xm=Um))||xm)||xm);J._RF.pop(),J._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var Hb=GameCore.Utils.Valid,Vb=Q.ccclass,qb=Q.property,Wb=globalThis.game.monitorError,Kb=Oe.ONE.clone().multiplyScalar(.5),jb=(Km=Vb("EffectManager"),jm=a.required,Ym=qb({group:"Thunder Effect",type:vm}),Xm=a.required,Zm=qb({group:"Mask Effect",type:Si}),Jm=a.required,Qm=qb({group:"Mask Effect",type:ge}),$m=a.required,eb=qb({group:"Tornado Effect",type:ge}),tb=a.required,nb=qb({group:"Clear Particle Effect",type:ge,displayName:"Particle holder node"}),ib=a.required,ab=qb({group:"Clear Particle Effect",type:Ug,displayName:"Emitter 1"}),ob=a.required,rb=qb({group:"Clear Particle Effect",type:Ug,displayName:"Emitter 2"}),lb=a.required,sb=qb({group:"Star Particles Effect",type:Gb}),ub=a.required,cb=qb({group:"Confetti Effect",type:Ug}),hb=qb({group:"Add Item Effect",type:cm}),pb=qb({group:"Add Item Effect",type:ze}),db=qb({group:"Add Item Effect",type:ze}),yb=qb({group:"Add Item Effect",type:ze}),vb=qb({group:"Add Item Effect",type:ze}),fb=a.required,gb=qb({type:ge,displayName:"Clear Explosion Container",group:"Clear Explosion Effect"}),mb=a.onlyRunInLifeCycle,bb=a.onlyRunInLifeCycleAsync,Km((Sb=D((kb=function(t){B(S,t);var n,i,s,u,c,h,p,y,f,g,m,b,w,k=F(S);function S(){var e;N(this,S);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=k.call.apply(k,[this].concat(n)),z(e,"cloud",Sb,x(e)),z(e,"backgroundMask",Cb,x(e)),z(e,"masks",Eb,x(e)),z(e,"tornado",Ab,x(e)),z(e,"clearParticleHolder",Tb,x(e)),z(e,"clearParticle1",Rb,x(e)),z(e,"clearParticle2",Pb,x(e)),z(e,"starParticle",Ob,x(e)),z(e,"confetti",Ib,x(e)),z(e,"itemEffect",Lb,x(e)),z(e,"hintSpriteFrame",_b,x(e)),z(e,"thunderSpriteFrame",Db,x(e)),z(e,"tornadoSpriteFrame",Mb,x(e)),z(e,"pliersSpriteFrame",Nb,x(e)),e.maskTargets=[],e.vibrate=null,e.gameShakeSignal=new r,z(e,"clearExplosionContainer",zb,x(e)),e}return M(S,[{key:"__preload",value:function(){a.validateRequiredProperties(this,S)}},{key:"onLoad",value:function(){this.loadDefuseExplosionPool(),this.loadBombExplosionPool(),this.loadClearExplosionPool()}},{key:"update",value:function(){if(this.maskTargets.length>0)for(var e=0;e<this.maskTargets.length;e++){var t=this.maskTargets[e];if(!t.isHidden()){var n=this.masks[e];n&&n.setWorldPosition(t.node.worldPosition)}}}},{key:"onEnable",value:function(){this.node.scene.on(oa.GRID_RESIZE,this.handleBoardResize,this)}},{key:"onDisable",value:function(){this.node.scene.off(oa.GRID_RESIZE,this.handleBoardResize,this)}},{key:"handleBoardResize",value:function(e){this.clearParticleHolder.setScale(e,e),this.clearExplosionContainer.setScale(e,e)}},{key:"playClearEffectAt",value:function(e){var t=e[0],n=t.x,i=t.y,a=e[1],o=a.x,r=a.y,l=this.clearParticle1.node.worldPosition.z,s=this.clearParticle2.node.worldPosition.z;this.clearParticle1.node.setWorldPosition(n,i,l),this.clearParticle2.node.setWorldPosition(o,r,s),this.clearParticle1.play(),this.clearParticle2.play()}},{key:"playStarEffectAt",value:function(e){this.starParticle.fireShiningStarAt(e)}},{key:"playConfettiEffect",value:function(){var e,t=G(this.confetti);try{for(t.s();!(e=t.n()).done;){e.value.play()}}catch(e){t.e(e)}finally{t.f()}}},{key:"playTornadoAnimation",value:(w=q((function*(){o.setBlockInput(!0),this.tornado.active=!0,this.tornado.setScale(Oe.ZERO),yield e.runTweenAsync(ie(this.tornado).to(.5,{scale:Oe.ONE},{easing:"quadOut"}).to(.5,{scale:Kb},{easing:"quadInOut"}).to(.5,{scale:Oe.ONE},{easing:"quadInOut"}).to(.5,{scale:Oe.ZERO},{easing:"quadInOut"})),this.tornado.active=!1,o.setBlockInput(!1)})),function(){return w.apply(this,arguments)})},{key:"playThunderAnimation",value:(b=q((function*(t,n){this.resetMasks();var i=X(t,2),a=X(i[0],2),o=a[0],r=a[1],l=X(i[1],2),s=l[0],u=l[1];this.setMaskProperties(0,o.node.worldPosition,o.node.worldScale),this.setMaskProperties(1,r.node.worldPosition,r.node.worldScale),this.setMaskProperties(2,s.node.worldPosition,s.node.worldScale),this.setMaskProperties(3,u.node.worldPosition,u.node.worldScale),this.maskTargets=[o,r,s,u],yield this.setBackgroundMaskActive(!0),this.cloud.node.active=!0,yield this.cloud.playInitAnimation(),yield e.waitTweenAsync(.2);var c=[];c.push(this.performCloudEffectToTiles(o,r,n)),yield e.waitTweenAsync(.5),c.push(this.performCloudEffectToTiles(s,u,n)),yield Promise.all(c),this.cloud.node.active=!1,yield this.setBackgroundMaskActive(!1),this.maskTargets=[]})),function(e,t){return b.apply(this,arguments)})},{key:"playItemAddAnimation",value:(m=q((function*(t,n){var i=n.itemType;if(i){switch(yield e.waitTweenAsync(.2),this.itemEffect.node.active=!0,this.itemEffect.node.parent=Me("Canvas"),this.itemEffect.node.worldPosition=t,this.itemEffect.node.scale=Oe.ONE,i){case d.HINT:this.itemEffect.sprite.spriteFrame=this.hintSpriteFrame;break;case d.THUNDER:this.itemEffect.sprite.spriteFrame=this.thunderSpriteFrame;break;case d.STORM:this.itemEffect.sprite.spriteFrame=this.tornadoSpriteFrame;break;case d.PLIERS:this.itemEffect.sprite.spriteFrame=this.pliersSpriteFrame}yield Dm(this.itemEffect,n),this.itemEffect.node.active=!1}})),function(e,t){return m.apply(this,arguments)})},{key:"playMultiThunderAnimation",value:(g=q((function*(t,n,i){this.resetMasks(),this.cloud.node.active=!0,yield this.cloud.playInitAnimation(),yield e.waitTweenAsync(.2),n.clear(t,i);for(var a=[],o=0,r=2*t.length;o<r;o++){var s=t[Math.floor(o/2)];if(void 0!==s){var u=s[o%2];void 0!==u&&(0!==o&&o%2==0&&(this.node.scene.emit(oa.ADD_COMBO),this.node.scene.emit(oa.ADD_SCORE)),this.shakeGame(),this.shakeScreen(500),l.playSound(wn.THUNDERBOLT),a.push(this.cloud.playLightningAnimation(u.node.worldPosition)),a.push(this.cloud.playScaleTween()),i&&(yield e.waitTweenAsync(i)))}}yield Promise.all(a),this.cloud.node.active=!1,yield this.setBackgroundMaskActive(!1)})),function(e,t,n){return g.apply(this,arguments)})},{key:"performCloudEffectToTiles",value:(f=q((function*(t,n,i,a){this.shakeGame(),this.shakeScreen(500),l.playSound(wn.THUNDERBOLT),i.clearUsingOldLightningFX([[t,n]]),this.node.scene.emit(oa.ADD_COMBO),this.node.scene.emit(oa.ADD_SCORE);var o=[];o.push(this.createClearExplosionAt(t.node.worldPosition)),o.push(this.cloud.playLightningAnimation(t.node.worldPosition)),o.push(this.cloud.playScaleTween()),a&&(yield e.waitTweenAsync(a)),o.push(this.cloud.playLightningAnimation(n.node.worldPosition)),yield Promise.all(o)})),function(e,t,n,i){return f.apply(this,arguments)})},{key:"shakeScreen",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.vibrate=null!==(e=this.vibrate)&&void 0!==e?e:this.node.getComponent(vs),null===(t=this.vibrate)||void 0===t||t.vibrate(n)}},{key:"loadDefuseExplosionPool",value:(y=q((function*(){if(this.defuseExplosionPool)return this.defuseExplosionPool;var e=yield o.loadPrefabAsync(v.BOMB_DEFUSE_PREFAB);if(null!==e)return this.defuseExplosionPool=function(e,t){return new pp((function(){var n=Ge(e),i=n.getComponent(Be);if(!i)throw new Error("DefuseExplosion: No animation component found in bombDefuseExplosionPrefab");return t.addChild(n),n.active=!1,{node:n,animation:i}}),1,(function(e){e.node.active=!0}),(function(e){e.node.active=!1}),(function(e){e.node.destroy()}))}(e,this.node),this.defuseExplosionPool;this.reportOrThrowInDebugger("Failed to load prefab","createDefuseExplosionAt")})),function(){return y.apply(this,arguments)})},{key:"loadBombExplosionPool",value:(p=q((function*(){if(this.bombExplosionPool)return this.bombExplosionPool;var e=yield o.loadPrefabAsync(v.BOMB_EXPLODE_PREFAB);if(null!==e)return this.bombExplosionPool=function(e,t){return new pp((function(){var n=Ge(e),i=n.getComponent(Be);if(!i)throw new Error("BombExplosion: No animation component found in bombExplosionPrefab");return t.addChild(n),n.active=!1,{node:n,animation:i}}),1,(function(e){e.node.active=!0}),(function(e){e.node.active=!1}),(function(e){e.node.destroy()}))}(e,this.node),this.bombExplosionPool;this.reportOrThrowInDebugger("Failed to load prefab","createBombExplosionAt")})),function(){return p.apply(this,arguments)})},{key:"loadClearExplosionPool",value:(h=q((function*(){if(this.clearExplosionPool)return this.clearExplosionPool;var e=yield o.loadPrefabAsync(v.CLEAR_EXPLOSION_PREFAB);if(null!==e)return this.clearExplosionPool=function(e,t){return new pp((function(){var n=Ge(e),i=n.getComponent($),a=n.getComponent(Be);if(!i||!a)throw new Error("ClearExplosion: Invalid prefab");return t.addChild(n),n.active=!1,{node:n,uiTransform:i,animation:a}}),2,(function(e){e.node.active=!0}),(function(e){e.node.active=!1}),(function(e){e.node.destroy()}))}(e,this.clearExplosionContainer),this.clearExplosionPool;this.reportOrThrowInDebugger("Failed to load prefab","createClearExplosionAt")})),function(){return h.apply(this,arguments)})},{key:"createDefuseExplosionAt",value:(c=q((function*(t,n){var i=yield this.loadDefuseExplosionPool();if(i){var a=i.alloc(),o=a.node,r=a.animation;o.setWorldPosition(t,n,0),yield e.runAnimationAsync(r),i.free(a)}})),function(e,t){return c.apply(this,arguments)})},{key:"createBombExplosionAt",value:(u=q((function*(t){var n=yield this.loadBombExplosionPool();if(n){var i=n.alloc(),a=i.node,o=i.animation;a.setWorldPosition(t),yield e.runAnimationAsync(o),n.free(i)}})),function(e){return u.apply(this,arguments)})},{key:"createClearExplosionAt",value:(s=q((function*(t){var n=yield this.loadClearExplosionPool();if(n){var i=n.alloc(),a=i.node,o=i.animation;a.setWorldPosition(t),yield e.runAnimationAsync(o),n.free(i)}})),function(e){return s.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(i=q((function*(e){e&&(this.backgroundMask.node.active=!0),yield this.backgroundMask.changeStateFade(e,.25),e||(this.backgroundMask.node.active=!1)})),function(e){return i.apply(this,arguments)})},{key:"resetMasks",value:function(){var e,t=G(this.masks);try{for(t.s();!(e=t.n()).done;){e.value.worldPosition=new Oe(-9999,-9999,0)}}catch(e){t.e(e)}finally{t.f()}}},{key:"setMaskProperties",value:function(e,t,n){var i=this.masks[e];i&&(n&&(i.worldScale=n),i.worldPosition=t)}},{key:"shakeGame",value:(n=q((function*(){var t=this;this.gameShakeSignal.abort();var n=new r;this.gameShakeSignal=n;var i=this.node.position.clone(),a=Ue(-10,10),o=Ue(-10,10),l=i.clone().add3f(a,o,0),s=i.clone().add3f(-a,-o,0),u=ie(this.node).to(.05,{position:l}).to(.05,{position:s}).to(.05,{position:i});n.addAbortListener((function(){t.node.setPosition(i)})),yield e.runTweenAsync(u,n)})),function(){return n.apply(this,arguments)})},{key:"reportOrThrowInDebugger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown error thrown",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Board",n=new Error("".concat(t,": ").concat(e));if(Hb.isDebugger())throw n;null==Wb||Wb.sendException(n)}}]),S}(re)).prototype,"cloud",[jm,Ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cb=D(kb.prototype,"backgroundMask",[Xm,Zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eb=D(kb.prototype,"masks",[Jm,Qm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ab=D(kb.prototype,"tornado",[$m,eb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tb=D(kb.prototype,"clearParticleHolder",[tb,nb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rb=D(kb.prototype,"clearParticle1",[ib,ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pb=D(kb.prototype,"clearParticle2",[ob,rb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ob=D(kb.prototype,"starParticle",[lb,sb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ib=D(kb.prototype,"confetti",[ub,cb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Lb=D(kb.prototype,"itemEffect",[hb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_b=D(kb.prototype,"hintSpriteFrame",[pb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Db=D(kb.prototype,"thunderSpriteFrame",[db],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mb=D(kb.prototype,"tornadoSpriteFrame",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nb=D(kb.prototype,"pliersSpriteFrame",[vb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zb=D(kb.prototype,"clearExplosionContainer",[fb,gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(kb.prototype,"shakeScreen",[mb],Object.getOwnPropertyDescriptor(kb.prototype,"shakeScreen"),kb.prototype),D(kb.prototype,"shakeGame",[bb],Object.getOwnPropertyDescriptor(kb.prototype,"shakeGame"),kb.prototype),wb=kb))||wb);J._RF.pop(),J._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var Yb="newbie",Xb="timer",Zb="combo",Jb="hint-item",Qb="thunder-item",$b="storm-item",ew="pliers-item";J._RF.pop(),J._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var tw=function(){function e(t){var n=this;N(this,e),this.alignSkipButton=function(){var e=n.gameplay.board,t=n.manager.guideUi.guideSkipButton;if(t){var a=t.parent;if(a){var o=e.getBoundingBoxWorld(),r=o.yMax,l=o.xMax,s=i.cssSizeToWorldSize(i.getScreenHeightCss()),u=l-a.getComponent($).width/2,c=Math.min(r+100,r+(s-r)/2);a.setWorldPosition(u,c,0)}}},this.manager=t,this.gameplay=t.gameplay}var t,n;return M(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(oa.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(oa.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.on(oa.GRID_RESIZE,this.handleViewResized,this),this.manager.guideUi.guideSkipButton.on($.EventType.SIZE_CHANGED,this.alignSkipButton,this),this.showStep(this.currentStep),this.manager.node.scene.emit(oa.HIDE_UI)}},{key:"showNextStep",value:function(){this.currentStep+1<xc.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(n=q((function*(e){var t=xc[e];if(t){var n=this.gameplay,i=n.board,a=n.effectManager,o=t.startTile,r=t.endTile,l=i.getTileAt(o.x,o.y),s=i.getTileAt(r.x,r.y);if(l&&s){var u=l.node.worldPosition,c=s.node.worldPosition;a.resetMasks(),a.setMaskProperties(0,u,l.node.worldScale),a.setMaskProperties(1,c,s.node.worldScale),a.setBackgroundMaskActive(!0);var h=this.manager.guideUi,p=h.guideHand,d=h.guideTextBox,y=h.guideSkipButton;p.node.active=!0,y.active=!0,p.playHandAnimation(u,c),this.alignGuideTextBox(),this.alignSkipButton(),yield d.hide(),d.setLocalizedText(t.localeTextKey),yield d.show(),i.setIgnoreInput(!0),l.setIgnoreInput(!1),s.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1)}}})),function(e){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=xc[this.currentStep];if(e){var t=this.gameplay,n=t.board,i=t.effectManager,a=e.startTile,o=e.endTile,r=n.getTileAt(a.x,a.y),l=n.getTileAt(o.x,o.y);if(r&&l){var s=r.node.worldPosition,u=l.node.worldPosition;i.setMaskProperties(0,s,r.node.worldScale),i.setMaskProperties(1,u,l.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}}}},{key:"alignGuideTextBox",value:function(){var e=this.gameplay.board,t=this.manager.guideUi.guideTextBox,n=e.getBoundingBoxWorld(),i=n.width,a=n.yMin,o=t.widget.bottom+(a-t.widget.bottom)/2;t.node.setWorldPosition(t.node.worldPosition.x,o,0);var r=Math.max(Math.min(223,.85*(a-t.widget.bottom)),10);t.uiTransform.setContentSize(i,r)}},{key:"close",value:(t=q((function*(){var e=this.gameplay,t=e.board,n=e.effectManager;this.manager.node.scene.off(oa.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(oa.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.off(oa.GRID_RESIZE,this.handleViewResized,this),this.manager.guideUi.guideSkipButton.off($.EventType.SIZE_CHANGED,this.alignSkipButton,this),t.setIgnoreInput(!1),yield Promise.all([this.manager.guideUi.guideTextBox.hide(),n.setBackgroundMaskActive(!1)]),this.manager.guideUi.guideHand.node.active=!1,this.manager.completeGuide(Yb)})),function(){return t.apply(this,arguments)})}]),e}();J._RF.pop(),J._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var nw=function(){function e(t){N(this,e),this.manager=t,this.gameplay=t.gameplay}var n,i;return M(e,[{key:"setup",value:(i=q((function*(){var e=this.manager.guideUi,n=e.guideMasks,i=e.guideInfoText,a=e.guideInfoTextLocalizer;yield this.gameplay.handleShowUI(),n.node.active=!0,i.node.active=!0,a.key="guide.timer",i.horizontalAlign=et.CENTER,i.getComponent($).setAnchorPoint(.5,.5),this.handleViewResized(),yield n.show(),this.manager.node.scene.once(oa.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(oa.PAUSE_TIME),oe.on(t.VIEW_RESIZED,this.handleViewResized,this),oe.on(t.ORIENTATION_CHANGED,this.handleViewResized,this)})),function(){return i.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.uiManager.currentLayout.clock,a=i.getComponent($).contentSize,o=a.width,r=a.height,l=i.node.worldPosition,s=Mt.isPortrait()?l.y-r/2-50:l.y+r/2+70;o*=1.5,r*=1.5,t.setOtherMaskTransform(l.x,l.y,o,r),n.node.setWorldPosition(l.x,s,0)}},{key:"close",value:(n=q((function*(){var e=this.manager.guideUi,t=e.guideInfoText,n=e.guideMasks;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(oa.RESUME_TIME),yield n.hide(),t.node.active=!1,this.manager.completeGuide(Xb),this.unlistenEvents()})),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){oe.off(t.VIEW_RESIZED,this.handleViewResized,this),oe.off(t.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();J._RF.pop(),J._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var iw=function(){function e(t){N(this,e),this.manager=t,this.gameplay=t.gameplay}var n,i;return M(e,[{key:"setup",value:(i=q((function*(){var e=this.manager.guideUi,n=e.guideMasks,i=e.guideInfoText,a=e.guideInfoTextLocalizer;n.node.active=!0,i.node.active=!0,a.key="guide.combo",i.horizontalAlign=et.RIGHT,i.getComponent($).setAnchorPoint(1,.5),this.handleViewResized(),yield n.show(),this.manager.node.scene.once(oa.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(oa.PAUSE_TIME),oe.on(t.VIEW_RESIZED,this.handleViewResized,this),oe.on(t.ORIENTATION_CHANGED,this.handleViewResized,this)})),function(){return i.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.uiManager.comboContainer,a=i.getComponent($).contentSize,o=a.width,r=a.height,l=1.5*i.node.scale.x,s=i.node.worldPosition;o*=l,r*=l,t.setOtherMaskTransform(s.x,s.y,o,r),n.node.setWorldPosition(s.x-o/2-10,s.y,0)}},{key:"close",value:(n=q((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText;this.manager.node.scene.emit(oa.RESUME_TIME),t.node.off(ge.EventType.TOUCH_START,this.close,this),yield t.hide(),n.node.active=!1,this.manager.completeGuide(Zb),this.unlistenEvents()})),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){oe.off(t.VIEW_RESIZED,this.handleViewResized,this),oe.off(t.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();J._RF.pop(),J._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var aw=GameCore.Utils.Array,ow=function(){function e(t){N(this,e),this.manager=t,this.gameplay=t.gameplay}var n,i;return M(e,[{key:"setup",value:(i=q((function*(){var e=this.manager.guideUi,n=e.guideMasks,i=e.guideInfoText,a=e.guideInfoTextLocalizer;aw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.HINT}))&&(n.node.active=!0,i.node.active=!0,a.key="guide.hint",i.horizontalAlign=et.CENTER,i.getComponent($).setAnchorPoint(.5,.5),this.handleViewResized(),yield n.show(),this.manager.node.scene.once(oa.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(oa.PAUSE_TIME),oe.on(t.VIEW_RESIZED,this.handleViewResized,this),oe.on(t.ORIENTATION_CHANGED,this.handleViewResized,this))})),function(){return i.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=aw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.HINT}));if(i){var a=i.node.worldPosition,o=i.getComponent($).contentSize,r=o.width,l=o.height;if(r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),Mt.isPortrait())n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0);else if(Mt.isLandscape()){var s=this.gameplay.uiManager.currentLayout.clock,u=new Oe(s.node.worldPosition.x,s.node.worldPosition.y-750,0);n.node.worldPosition=u}}}},{key:"close",value:(n=q((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText;this.manager.node.scene.emit(oa.RESUME_TIME),yield t.hide(),n.node.active=!1,this.manager.completeGuide(Jb),this.unlistenEvents()})),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){oe.off(t.VIEW_RESIZED,this.handleViewResized,this),oe.off(t.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();J._RF.pop(),J._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var rw=GameCore.Utils.Array,lw=function(){function e(t){N(this,e),this.manager=t,this.gameplay=t.gameplay}var n,i;return M(e,[{key:"setup",value:(i=q((function*(){var e=this.manager.guideUi,n=e.guideMasks,i=e.guideInfoText,a=e.guideInfoTextLocalizer;rw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.THUNDER}))&&(n.node.active=!0,i.node.active=!0,a.key="guide.thunder",i.horizontalAlign=et.CENTER,i.getComponent($).setAnchorPoint(.5,.5),this.handleViewResized(),yield n.show(),this.manager.node.scene.once(oa.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(oa.PAUSE_TIME),oe.on(t.VIEW_RESIZED,this.handleViewResized,this),oe.on(t.ORIENTATION_CHANGED,this.handleViewResized,this))})),function(){return i.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=rw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.THUNDER}));if(i){var a=i.node.worldPosition,o=i.getComponent($).contentSize,r=o.width,l=o.height;if(r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),Mt.isPortrait())n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0);else if(Mt.isLandscape()){var s=this.gameplay.uiManager.currentLayout.clock,u=new Oe(s.node.worldPosition.x,s.node.worldPosition.y-750,0);n.node.worldPosition=u}}}},{key:"close",value:(n=q((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText;this.manager.node.scene.emit(oa.RESUME_TIME),yield t.hide(),n.node.active=!1,this.manager.completeGuide(Qb),this.unlistenEvents()})),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){oe.off(t.VIEW_RESIZED,this.handleViewResized,this),oe.off(t.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();J._RF.pop(),J._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var sw=GameCore.Utils.Array,uw=function(){function e(t){N(this,e),this.manager=t,this.gameplay=t.gameplay}var n,i;return M(e,[{key:"setup",value:(i=q((function*(){var e=this.manager.guideUi,n=e.guideMasks,i=e.guideInfoText,a=e.guideInfoTextLocalizer;sw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.STORM}))&&(n.node.active=!0,i.node.active=!0,a.key="guide.storm",i.horizontalAlign=et.CENTER,i.getComponent($).setAnchorPoint(.5,.5),this.handleViewResized(),yield n.show(),this.manager.node.scene.once(oa.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(oa.PAUSE_TIME),oe.on(t.VIEW_RESIZED,this.handleViewResized,this),oe.on(t.ORIENTATION_CHANGED,this.handleViewResized,this))})),function(){return i.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=sw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.STORM}));if(i){var a=i.node.worldPosition,o=i.getComponent($).contentSize,r=o.width,l=o.height;if(r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),Mt.isPortrait())n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0);else if(Mt.isLandscape()){var s=this.gameplay.uiManager.currentLayout.clock,u=new Oe(s.node.worldPosition.x,s.node.worldPosition.y-750,0);n.node.worldPosition=u}}}},{key:"close",value:(n=q((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText;this.manager.node.scene.emit(oa.RESUME_TIME),yield t.hide(),n.node.active=!1,this.manager.completeGuide($b),this.unlistenEvents()})),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){oe.off(t.VIEW_RESIZED,this.handleViewResized,this),oe.off(t.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();J._RF.pop(),J._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var cw,hw,pw,dw,yw,vw,fw,gw,mw,bw=GameCore.Utils.Array,ww=function(){function e(t){N(this,e),this.manager=t,this.gameplay=t.gameplay}var n,i;return M(e,[{key:"setup",value:(i=q((function*(){var e=this.manager.guideUi,n=e.guideMasks,i=e.guideInfoText,a=e.guideInfoTextLocalizer;bw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.PLIERS}))&&(n.node.active=!0,i.node.active=!0,a.key="guide.pliers",i.horizontalAlign=et.CENTER,i.getComponent($).setAnchorPoint(.5,.5),this.handleViewResized(),yield n.show(),this.manager.node.scene.once(oa.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(oa.PAUSE_TIME),oe.on(t.VIEW_RESIZED,this.handleViewResized,this),oe.on(t.ORIENTATION_CHANGED,this.handleViewResized,this))})),function(){return i.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=bw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.PLIERS}));if(i){var a=i.node.worldPosition,o=i.getComponent($).contentSize,r=o.width,l=o.height;if(r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),Mt.isPortrait())n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0);else if(Mt.isLandscape()){var s=this.gameplay.uiManager.currentLayout.clock,u=new Oe(s.node.worldPosition.x,s.node.worldPosition.y-750,0);n.node.worldPosition=u}}}},{key:"close",value:(n=q((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText;this.manager.node.scene.emit(oa.RESUME_TIME),yield t.hide(),n.node.active=!1,this.manager.completeGuide(ew),this.unlistenEvents()})),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){oe.off(t.VIEW_RESIZED,this.handleViewResized,this),oe.off(t.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();J._RF.pop(),J._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var kw,Sw,Cw,Ew,Aw,Tw,Rw,Pw=Q.ccclass,Ow=Q.property,Iw=(cw=Pw("GuideHand"),hw=Ow(ge),pw=Ow(ge),dw=Ow(he),cw((fw=D((vw=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"hand",fw,x(e)),z(e,"circleHighlight",gw,x(e)),z(e,"circleHighlightOpacity",mw,x(e)),e}return M(n,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(e,t){var n=this;this.handTween&&this.handTween.stop();var i=ie(this.hand).to(.8,{worldPosition:t},{easing:"quartOut"}).to(.2,{scale:new Oe(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:Oe.ONE,angle:0}).to(.8,{worldPosition:e},{easing:"quartOut"}).to(.2,{scale:new Oe(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:Oe.ONE,angle:0});this.handTween=ie(this.hand).repeatForever(i).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),ie(this.circleHighlight).to(.6,{scale:new Oe(1.5,1.5)},{easing:"quadOut"}).start(),ie(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(re)).prototype,"hand",[hw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gw=D(vw.prototype,"circleHighlight",[pw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mw=D(vw.prototype,"circleHighlightOpacity",[dw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yw=vw))||yw);J._RF.pop(),J._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var Lw,_w,Dw,Mw,Nw,zw,Bw=Q.ccclass,Fw=Q.property,xw=(kw=Bw("GameMask"),Sw=Fw($),Cw=Fw(se),kw((Tw=D((Aw=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"uiTransform",Tw,x(e)),z(e,"sprite",Rw,x(e)),e}return M(n,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),n}(re)).prototype,"uiTransform",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rw=D(Aw.prototype,"sprite",[Cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ew=Aw))||Ew);J._RF.pop(),J._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var Uw,Gw,Hw,Vw,qw,Ww,Kw,jw=Q.ccclass,Yw=Q.property,Xw=Q.executeInEditMode,Zw=(Lw=jw("AlphaMasks"),_w=Xw(!0),Dw=Yw(xw),Lw(Mw=_w((zw=D((Nw=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"masks",zw,x(e)),e}return M(n,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent($)}},{key:"start",value:function(){this.material=this.getComponent(se).getMaterialInstance(0)}},{key:"update",value:function(){var e=this,t=this.UITransform,n=t.width,i=t.height;this.masks.forEach((function(t,a){var o=t.uiTransform,r=o.width,l=o.height,s=o.anchorX,u=o.anchorY,c=r*t.node.scale.x,h=l*t.node.scale.y,p=new Pe(c/n,h/i),d=new Pe(.5+(.5-s)*p.x,.5-(.5-u)*p.y),y=new Pe(d.x+(t.node.worldPosition.x-e.node.worldPosition.x)/n,d.y-(t.node.worldPosition.y-e.node.worldPosition.y)/i);e.material.setProperty("mask".concat(a,"Texture"),t.texture),e.material.setProperty("ratio".concat(a),p),e.material.setProperty("center".concat(a),y)}))}},{key:"setMaskActive",value:function(e,t){e>=this.masks.length||this.material.setProperty("useMask".concat(e),t?1:0)}}]),n}(re)).prototype,"masks",[Dw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mw=Nw))||Mw)||Mw);J._RF.pop(),J._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var Jw,Qw,$w,ek,tk,nk,ik,ak,ok,rk,lk,sk,uk,ck,hk,pk,dk,yk,vk=Q.ccclass,fk=Q.property,gk=(Uw=vk("GuideMasks"),Gw=fk(Si),Hw=fk(Zw),Uw((Ww=D((qw=function(e){B(o,e);var t,n,i=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n)),z(e,"background",Ww,x(e)),z(e,"alphaMasks",Kw,x(e)),e}return M(o,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"show",value:(n=q((function*(){this.background.node.active=!0,yield this.background.changeStateFade(!0,.25)})),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=q((function*(){yield this.background.changeStateFade(!1,.25),this.background.node.active=!1})),function(){return t.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(oa.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[1].node.worldPosition=new Oe(-9999,-9999,0);var a=this.alphaMasks.masks[0];this.setMaskTransform(a,e,t,n,i)}},{key:"setItemMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[0].node.worldPosition=new Oe(-9999,-9999,0);var a=this.alphaMasks.masks[1];this.setMaskTransform(a,e,t,n,i)}},{key:"setMaskTransform",value:function(e,t,n,i,a){e.uiTransform.setContentSize(i,a),e.node.setWorldPosition(t,n,0)}}]),o}(re)).prototype,"background",[Gw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kw=D(qw.prototype,"alphaMasks",[Hw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vw=qw))||Vw);J._RF.pop(),J._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var mk,bk,wk,kk,Sk,Ck,Ek,Ak,Tk,Rk,Pk,Ok,Ik,Lk,_k,Dk,Mk,Nk,zk,Bk,Fk,xk=Q.ccclass,Uk=Q.property,Gk=(Jw=xk("GuideTextBox"),Qw=a.required(),$w=Uk(we),ek=a.required(),tk=Uk(ne),nk=a.required(),ik=Uk($),ak=a.required(),ok=Uk(Si),rk=a.required(),lk=Uk(p),Jw((ck=D((uk=function(e){B(o,e);var t,n,i=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n)),z(e,"guideText",ck,x(e)),z(e,"widget",hk,x(e)),z(e,"uiTransform",pk,x(e)),z(e,"opacityToggler",dk,x(e)),z(e,"localizer",yk,x(e)),e}return M(o,[{key:"__preload",value:function(){a.validateRequiredProperties(this)}},{key:"setLocalizedText",value:function(e){this.localizer.key=e}},{key:"show",value:(n=q((function*(){yield this.opacityToggler.changeStateFade(!0)})),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=q((function*(){yield this.opacityToggler.changeStateFade(!1)})),function(){return t.apply(this,arguments)})}]),o}(re)).prototype,"guideText",[Qw,$w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hk=D(uk.prototype,"widget",[ek,tk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pk=D(uk.prototype,"uiTransform",[nk,ik],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dk=D(uk.prototype,"opacityToggler",[ak,ok],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yk=D(uk.prototype,"localizer",[rk,lk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sk=uk))||sk);J._RF.pop(),J._RF.push({},"a2522Y5Q6JGSr90yCp/4qCm","GuideUI",void 0);var Hk,Vk,qk,Wk,Kk,jk=Q.ccclass,Yk=Q.property,Xk=(mk=jk("GuideUI"),bk=a.required(),wk=Yk(Iw),kk=a.required(),Sk=Yk(Gk),Ck=a.required(),Ek=Yk(we),Ak=a.required(),Tk=Yk(p),Rk=a.required(),Pk=Yk(gk),Ok=a.required(),Ik=Yk(ge),mk((Dk=D((_k=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"guideHand",Dk,x(e)),z(e,"guideTextBox",Mk,x(e)),z(e,"guideInfoText",Nk,x(e)),z(e,"guideInfoTextLocalizer",zk,x(e)),z(e,"guideMasks",Bk,x(e)),z(e,"guideSkipButton",Fk,x(e)),e}return M(n,[{key:"__preload",value:function(){a.validateRequiredProperties(this)}}]),n}(re)).prototype,"guideHand",[bk,wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mk=D(_k.prototype,"guideTextBox",[kk,Sk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nk=D(_k.prototype,"guideInfoText",[Ck,Ek],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zk=D(_k.prototype,"guideInfoTextLocalizer",[Ak,Tk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bk=D(_k.prototype,"guideMasks",[Rk,Pk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fk=D(_k.prototype,"guideSkipButton",[Ok,Ik],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lk=_k))||Lk);J._RF.pop(),J._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var Zk=game,Jk=Zk.player,Qk=Zk.analytics,$k=Q.ccclass,eS=Q.property,tS=GameCore,nS=tS.Match.Modes,iS=tS.Plugins.Analytics.Events,aS=tS.Utils.Array,oS=new Pe(0,10),rS=new Pe(0,10),lS="READY",sS="RUNNING",uS=(Hk=$k("GuidelinesManager"),Vk=eS(Xk),Hk((Kk=D((Wk=function(e){B(i,e);var t,n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"guideUi",Kk,x(e)),e.guideHintDelay=null,e.guideStormDelay=null,e}return M(i,[{key:"init",value:function(e){this.gameplay=e,this.status=lS,this.node.scene.on(oa.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(oa.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(oa.USE_ITEM,this.handleUseItem,this),this.node.scene.on(oa.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(oa.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(oa.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(Yb)&&this.resetGuideItemShowed(),this.startGuide(Yb)):this.startGuide(Xb)}},{key:"startGuide",value:function(e){if(this.status===sS)return!1;if(this.hasGuideItemShowed(e))return!1;switch(this.addGuideItemShowed(e),this.status=sS,e){case Yb:Qk.event(iS.TUTORIAL_BEGIN),this.guide1=new tw(this),this.guide1.setup();break;case Xb:this.guide2=new nw(this),this.guide2.setup();break;case Zb:this.guide3=new iw(this),this.guide3.setup();break;case Jb:this.guide4=new ow(this),this.guide4.setup();break;case Qb:this.guide5=new lw(this),this.guide5.setup();break;case $b:this.guide6=new uw(this),this.guide6.setup();break;case ew:this.guide7=new ww(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(e){Qk.event(iS.TUTORIAL_STEP,{step:e}),this.status=lS,this.addGuideItemShowed(e),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){var e=this.getCurrentLevel(),t=oS.x,n=oS.y;return e>=t&&e<=n}},{key:"isShowErrorPathLevel",value:function(){if(Js.getMatchMode()===nS.TOURNAMENT)return!1;var e=this.getCurrentLevel(),t=rS.x,n=rS.y;return e>=t&&e<=n}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(e){return aS.has(this.getGuideItemShowed(),e)}},{key:"addGuideItemShowed",value:function(e){if(!this.hasGuideItemShowed(e)){var t=this.getGuideItemShowed();t.push(e),Jk.setGameData({guideItemShowed:t})}}},{key:"resetGuideItemShowed",value:function(){Jk.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var e,t;return null!==(e=null===(t=Jk.getGameData())||void 0===t?void 0:t.guideItemShowed)&&void 0!==e?e:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(e){this.isNewbieGuideLevel()||e<2||(this.startGuide(Zb),this.node.scene.off(oa.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var e=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=ie(this.node).delay(5).call((function(){e.isNewbieGuideLevel()||(e.hasGuideItemShowed(Jb)&&e.status===lS?e.node.scene.emit(oa.SHOW_HINT):e.startGuide(Jb),e.startHintGuide())}))),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var e=this;null===this.guideStormDelay&&(this.guideStormDelay=new tt(this.node).delay(10).call((function(){e.isNewbieGuideLevel()||e.hasGuideItemShowed($b)||e.gameplay.itemManager.canUseItem(d.STORM)&&(e.startGuide($b)||e.startStormGuide())}))),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(Qb)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(ew)}},{key:"handleUseItem",value:function(e){switch(this.startAutoGuides(),e){case d.HINT:this.addGuideItemShowed(Jb);break;case d.THUNDER:this.addGuideItemShowed(Qb);break;case d.STORM:this.addGuideItemShowed($b);break;case d.PLIERS:this.addGuideItemShowed(ew)}}},{key:"skipNewbieGuide",value:(t=q((function*(){this.guideUi.guideSkipButton.active=!1,yield this.guide1.close();var e=this.getCurrentLevel()+1;Jk.setGameData({level:e}),this.node.scene.emit(oa.NEXT_LEVEL)})),function(){return t.apply(this,arguments)})},{key:"onDestroy",value:function(){var e,t,n,i,a,o;null===(e=this.guide2)||void 0===e||e.unlistenEvents(),null===(t=this.guide3)||void 0===t||t.unlistenEvents(),null===(n=this.guide4)||void 0===n||n.unlistenEvents(),null===(i=this.guide5)||void 0===i||i.unlistenEvents(),null===(a=this.guide6)||void 0===a||a.unlistenEvents(),null===(o=this.guide7)||void 0===o||o.unlistenEvents()}}]),i}(re)).prototype,"guideUi",[Vk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qk=Wk))||qk);J._RF.pop(),J._RF.push({},"aa973zMvtZFD6GO7rUb6TBF","canUseHintItem",void 0);J._RF.pop(),J._RF.push({},"f3464SQfFhIs5PVRx8JpCO1","canUsePliersItem",void 0);J._RF.pop(),J._RF.push({},"ad5b3eazZ1B3YR8JJm+qvM6","canUseThunderItem",void 0);J._RF.pop(),J._RF.push({},"3b5b1bQTVlDaaFOGKDB5VZk","canUseTornadoItem",void 0);var cS,hS;J._RF.pop(),J._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var pS=Q.ccclass,dS=globalThis.game.player,yS=(j(cS={},d.HINT,{canActivate:!1,quantity:0}),j(cS,d.THUNDER,{canActivate:!1,quantity:0}),j(cS,d.STORM,{canActivate:!1,quantity:0}),j(cS,d.PLIERS,{canActivate:!1,quantity:0}),cS),vS=pS("ItemManager")(hS=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).itemConfigs=yS,e}return M(n,[{key:"onLoad",value:function(){this.node.scene.on(oa.GRID_CREATE,this.updateItemsConfig,this),this.node.scene.on(oa.GRID_MATCH,this.updateItemsConfig,this),this.node.scene.on(oa.GRID_CLEAR,this.updateItemsConfig,this),this.node.scene.on(oa.GRID_SPAWN,this.updateItemsConfig,this),this.node.scene.on(oa.BOMB_EXPLODE,this.updateItemsConfig,this),this.node.scene.on(oa.REFRESH_ITEMS,this.updateItemsConfig,this)}},{key:"init",value:function(e){this.game=e}},{key:"getQuantity",value:function(e){return this.itemConfigs[e].quantity}},{key:"setQuantity",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Math.max(0,t);this.itemConfigs[e].quantity=i,this.saveQuantity(e,t),this.updateItemConfig(e,n)}},{key:"saveQuantity",value:function(e,t){var n=dS.getGameData();n&&dS.setGameData({items:U(U({},n.items),{},j({},e,t))})}},{key:"canUseItem",value:function(e){var t=this.game,n=t.board,i=t.pathDraw;switch(e){case d.HINT:return function(e,t){return e.getUncleared().length>0&&!1===t.isDrawingHint}(n,i);case d.PLIERS:return function(e){return e.getBombTiles().length>0}(n);case d.STORM:return function(e){return e.getUncleared().length>4}(n);case d.THUNDER:return function(e){return e.getUncleared().length>=4}(n);default:return!1}}},{key:"updateItemsConfig",value:function(){var e=dS.getGameData();if(e){for(var t=0,n=Object.keys(this.itemConfigs);t<n.length;t++){var i=n[t],a=this.itemConfigs[i];a.canActivate=this.canUseItem(i),a.quantity=e.items[i]||0}this.game.uiManager.currentLayout.updateStatus({items:this.itemConfigs})}}},{key:"updateItemConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=dS.getGameData();n&&(this.itemConfigs[e].canActivate=this.canUseItem(e),this.itemConfigs[e].quantity=n.items[e]||0,this.game.uiManager.currentLayout.updateStatus(U({items:U(U({},this.itemConfigs),{},j({},e,U({animate:t},this.itemConfigs[e])))},this.game.uiManager.config)))}}]),n}(re))||hS;J._RF.pop(),J._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);var fS={CAKES:"cakes",CAR:"car",COSMETIC:"cosmetics",FLOWER:"flower",FRUIT:"fruit",ICE_CREAM:"ice-cream",SPORT:"sport",TOOL:"tool"};J._RF.pop(),J._RF.push({},"5c321EpuONCAq5BAh+AQCcd","RandomizedLevelDataConfig",void 0);var gS=5,mS=[90,200],bS=[6,30],wS={bombRange:[1,8],rocketRange:[0,2]},kS={maxSpaceOfPairRange:[2,10],addRandomTilesPerMoveRange:[0,8]},SS=[5,7],CS=[6,12];J._RF.pop(),J._RF.push({},"4e7344vPB1EoI9uMkZu5Zd0","createRandomizedLevelData",void 0);var ES,AS,TS=function(e,t){return function(n){return n<=0?[e,t]:n>=1?[t,t]:[Math.floor(e+n*(t-e)),t]}},RS=function(e,t){var n=Math.ceil(e),i=Math.floor(t);return Math.floor(Math.random()*(i-n+1))+n},PS=function(e){return function(t){return RS.apply(void 0,K(e(t)))}},OS={generateDifficulty:(ES=gS,function(e){return ES<=1?0:(e-1)%ES/(ES-1)}),generateTime:PS(function(e,t){var n=TS(t,e);return function(e){return n(e)}}.apply(void 0,K(mS))),generateColors:PS(TS.apply(void 0,K(bS))),specials:{generateBomb:PS(TS.apply(void 0,K(wS.bombRange))),generateRocket:PS(TS.apply(void 0,K(wS.rocketRange)))},rules:{generateMaxSpaceOfPair:PS(TS.apply(void 0,K(kS.maxSpaceOfPairRange))),generateAddRandomTilesPerMove:PS(TS.apply(void 0,K(kS.addRandomTilesPerMoveRange)))},generateColumns:PS(TS.apply(void 0,K(SS))),generateRows:PS(TS.apply(void 0,K(CS)))};J._RF.pop(),J._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var IS,LS=Q.ccclass,_S=GameCore.Utils,DS=_S.Device,MS=_S.Array,NS=globalThis.game.monitorError,zS=Object.values(fS),BS={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},FS=function(){var e={};return function(t){if(e[t])return e[t];var n=function(e){var t=OS.generateDifficulty(e),n=OS.generateColumns(t),i=OS.generateRows(t);return{rows:n%2==1&&i%2==1?i+1:i,columns:n,colors:OS.generateColors(t),gravity:Math.random()>.75?"normal":Math.random()>.5?uu[Math.floor(Math.random()*uu.length)]:[cu[Math.floor(Math.random()*cu.length)],hu[Math.floor(Math.random()*hu.length)]].join("-"),rules:{addRandomTilesPerMove:OS.rules.generateAddRandomTilesPerMove(t),maxSpaceOfPair:OS.rules.generateMaxSpaceOfPair(t)},specials:{bomb:OS.specials.generateBomb(t),rocket:OS.specials.generateRocket(t)},time:OS.generateTime(t)}}(t);return e[t]={level:t,theme:zS,rows:n.rows,columns:n.columns,colors:n.colors,mode:n.gravity,rules:{maxSpaceOfPair:n.rules.maxSpaceOfPair,addRandomTilesPerMove:n.rules.addRandomTilesPerMove},specials:{bomb:n.specials.bomb,rocket:n.specials.rocket},time:n.time},e[t]}},xS=LS("LevelManager")(AS=function(e){B(l,e);var t,n,i,a,r=F(l);function l(){var e;N(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=r.call.apply(r,[this].concat(n))).getRandomizedLevelData=FS(),e}return M(l,[{key:"loadLevel",value:(a=q((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,n=yield this.loadLevelData(e);this.levelData=n||this.levelData||BS;var i=this.levelData,a=i.rows,o=i.columns;return DS.isMobile()&&o>=6&&a>=10&&(this.levelData.columns=5,this.levelData.rows=10),null==NS||NS.addMetadata({level:e}),this.getLevelSpriteFrames(e,t)})),function(){return a.apply(this,arguments)})},{key:"loadLevelData",value:(i=q((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(e>=g)return this.getRandomizedLevelData(e);var t=10,n=this.paddingZero("".concat(Math.floor(e/t)+1),3),i=e%t,a=yield o.loadJsonAsync("".concat(v.LEVEL_DATA_FOLDER,"/").concat(n));return a?a[i]:null})),function(){return i.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"getLevelSpriteFrames",value:(n=q((function*(e,t){if(t&&Ae.random()<=.5){var n=zs.getThemeSkins(t),i=n[Ae.randomRangeInt(0,n.length)];return yield this.loadSkinFrames(i)}var a=zs.getLevelSkins(e);if(0===a.length)throw new Error("No skins found for level ".concat(e));if(a.length>1)return yield this.loadSkinFrames(a);var o=a[0],r=zs.getUnlockedSkins();if(r.length>1&&Ae.random()<=.5){var l=r.filter((function(e){return e!==o}));o=l[Ae.randomRangeInt(0,l.length)]}return yield this.loadSkinFrames(o)})),function(e,t){return n.apply(this,arguments)})},{key:"loadSkinFrames",value:(t=q((function*(e){if(Array.isArray(e)){var t=e.map(function(){var e=q((function*(e){var t="".concat(v.TILE_SKIN_FOLDER,"/").concat(e);return yield o.loadSpriteFramesDirAsync(t)}));return function(t){return e.apply(this,arguments)}}());return MS.flatten(yield Promise.all(t))}var n="".concat(v.TILE_SKIN_FOLDER,"/").concat(e);return yield o.loadSpriteFramesDirAsync(n)})),function(e){return t.apply(this,arguments)})},{key:"paddingZero",value:function(e,t){for(var n="",i=0;i<t-e.length;i++)n+="0";return n+e}}]),l}(re))||AS;J._RF.pop(),J._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var US=Q.ccclass,GS=GameCore.Match.Modes,HS=US("ScoreManager")(IS=function(e){B(i,e);var t,n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).currentScore=0,e.tournamentStartScore=0,e}return M(i,[{key:"addScore",value:function(e,t,n){var i=this.getLevelMultiplier(e),a=this.getComboMultiplier(t),o=this.getTimeMultiplier(e,n),r=Math.floor(this.currentScore+10*i*a*o),l=10*Math.ceil(r/10);this.setScore(l)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var e=Js.getMatchMode();this.currentScore=e===GS.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(e){this.currentScore=e,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"resetTournamentStartScore",value:function(){this.tournamentStartScore=0}},{key:"updateScore",value:(t=q((function*(){this.node.scene.emit(oa.SCORE_UPDATED,this.currentScore)})),function(){return t.apply(this,arguments)})},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(e){return 1+.1*(e-1)}},{key:"getComboMultiplier",value:function(e){return 1+.1*(e-1)}},{key:"getTimeMultiplier",value:function(e,t){return e<=2?4:1+.05*t}}]),i}(re))||IS;J._RF.pop(),J._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var VS=function(){function e(t){N(this,e),this.game=null,this.data={},this.game=t.getGameplay(),this.manager=t,this.updateStateData(),this.logDebug()}return M(e,[{key:"logDebug",value:function(){var e=this.constructor.name;console.info("[STATE] ".concat(e),this.data)}},{key:"updateStateData",value:function(){if(this.game){var e=this.game.getGameData();e&&(this.data=e)}}},{key:"updateGameData",value:function(e){var t;null===(t=this.game)||void 0===t||t.setGameData(e)}}]),e}();J._RF.pop(),J._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var qS=globalThis.game,WS=qS.analytics,KS=qS.match,jS=qS.storage,YS=GameCore,XS=YS.Match.Modes,ZS=YS.Dtos.Match.Data,JS=function(e){B(s,e);var t,n,i,a,r=F(s);function s(e,t){var n;return N(this,s),n=r.call(this,e),l.stopAllSounds(),n.vibrateDevice(),n.pauseCountdown(),n.updateMatchCustomData(),n.handleGameOver(t),n.logLevelFailAnalytics(),n}return M(s,[{key:"pauseCountdown",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var e;null===(e=Me("Vibrate"))||void 0===e||null===(e=e.getComponent(vs))||void 0===e||e.vibrate(500)}},{key:"handleGameOver",value:(a=q((function*(e){var t=Js.getMatchMode();if(o.setBlockInput(!0),t!==XS.SINGLE){if(t===XS.TOURNAMENT)yield this.handleTournamentGameOver();else{if(t!==XS.CHALLENGE_FRIEND)return void this.showFailScreen(e);yield this.handleChallengeGameOver()}o.setBlockInput(!1)}else this.showFailScreen(e)})),function(e){return a.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(i=q((function*(){var e,t,n=this;if(this.game){var i=(null!==(e=Js.getMatchCustomData())&&void 0!==e?e:{}).tournamentId;if(i){var a;if(m.validateTournamentExpired(i))return jS.setStorageData("tournament","animateTournamentLeader",!1),b.showNotificationScreenWithLocalizedKey("error.tourEnded",2),void(null===(a=this.game)||void 0===a||a.scheduleOnce((function(){var e;null===(e=n.game)||void 0===e||e.node.scene.emit(oa.GAME_EXIT)}),2));try{var o=jS.getStorageData("tournament","previousScore"),r=this.game.scoreManager.getCurrentScore()>o;jS.setStorageData("tournament","animateTournamentLeader",r),yield Js.finishMatchAsync()}catch(e){console.warn(e)}null===(t=this.game)||void 0===t||t.node.scene.emit(oa.GAME_EXIT)}}})),function(){return i.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(n=q((function*(){if(this.game){try{var e=KS.getMatchState().id,t=yield KS.api.getMatchAPI().getMatchDetailByIdAsync(e),n=new ZS(t).toObject().extraData;yield Js.finishMatchAsync({extraData:null!=n?n:void 0})}catch(e){console.warn(e)}this.game.node.scene.emit(oa.SHOW_CHALLENGE_RESULTS)}})),function(){return n.apply(this,arguments)})},{key:"showFailScreen",value:(t=q((function*(e){var t=this.data.level;e===$s&&l.playSound(wn.LEVEL_FAIL_TIMEOUT),l.playSound(wn.LEVEL_FAIL),b.openScreen(w.RESCUES_SCREEN,{level:t,failKey:e})})),function(e){return t.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var e;if(this.game){var t=this.data.level,n=void 0===t?1:t,i=null===(e=this.game)||void 0===e?void 0:e.scoreManager.getCurrentScore();Js.updateMatchStateAfterLevelFinish(n,i)}}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore(),i=Js.getMatchMode()||void 0;WS.levelFail(t,n,i)}}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){}}]),s}(VS);J._RF.pop(),J._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var QS=globalThis.game,$S=QS.analytics,eC=QS.player,tC=QS.leaderboard,nC=QS.match,iC=GameCore,aC=iC.Match.Modes,oC=iC.Utils.Time,rC=GameCore.Configs.Ads.NotifyPlayerBeforeShow,lC=function(t){B(h,t);var n,i,a,o,r,s,u,c=F(h);function h(e){var t;return N(this,h),(t=c.call(this,e)).handleFinishStateFlow(),t}return M(h,[{key:"handleFinishStateFlow",value:(u=q((function*(){if(this.game){this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),this.game.uiManager.pauseTime();var e=Js.getMatchMode();e!==aC.CHALLENGE_FRIEND&&e!==aC.TOURNAMENT&&this.updatePlayerProgress(),this.updateMatchCustomData(),e===aC.CHALLENGE_FRIEND?this.handleFinishChallenge():e===aC.TOURNAMENT?this.handleFinishTournament():this.handleFinishSingle(),this.logLevelCompleteAnalytics()}})),function(){return u.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"attemptCallCreateShortcut",value:function(){var e=this.data.level;(void 0===e?0:e)<2||k.canShowInterstitialAd()||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("createShortcutAsync",e)}))}},{key:"updatePlayerProgress",value:function(){if(this.game){var e=this.data.level;if(e){var t=e+1,n=eC.getGameData();if(n){var i=n.level,a=Math.max(i,t);eC.setGameData(U(U({},n),{},{level:a}))}}}}},{key:"updateMatchCustomData",value:function(){if(this.game){var e=this.data.level,t=void 0===e?1:e,n=this.game.scoreManager.getCurrentScore();Js.updateMatchStateAfterLevelFinish(t,n)}}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore(),i=Js.getMatchMode()||void 0;$S.levelComplete(t,n,i)}}},{key:"handleFinishChallenge",value:(s=q((function*(){if(this.game){try{var e=nC.getMatchState().id,t=yield Js.getMatchExtraDataAsync(e);yield Js.finishMatchAsync({extraData:null!=t?t:void 0})}catch(e){console.warn(e),yield Js.finishMatchAsync()}this.game.node.scene.emit(oa.SHOW_CHALLENGE_RESULTS)}})),function(){return s.apply(this,arguments)})},{key:"handleFinishTournament",value:(r=q((function*(){if(this.handlePostTournamentScore(),this.game){var e=this.data.level,t=void 0===e?1:e;l.playSound(wn.LEVEL_COMPLETE,{volume:.5}),this.game.effectManager.playConfettiEffect(),yield oC.sleepAsync(500),k.canShowInterstitialAd()&&(yield k.showInterstitialAdAsync({forLevel:t})),this.game.node.scene.emit(oa.NEXT_LEVEL)}})),function(){return r.apply(this,arguments)})},{key:"handlePostTournamentScore",value:(o=q((function*(){var e;if(this.game){var t=null===(e=this.game)||void 0===e?void 0:e.scoreManager.getCurrentScore();if(t){try{yield GameSDK.tournament.postScoreAsync(t)}catch(e){console.warn("GameSDK post score async",e)}var n=Js.getMatchCustomData();if(n){var i=n.leaderboardId,a=n.playerId;i&&a&&(yield tC.setLeaderboardScoreAsync(i,a,t))}}}})),function(){return o.apply(this,arguments)})},{key:"handleFinishSingle",value:(a=q((function*(){l.turnUpMusic();var e=this.data.level,t=void 0===e?0:e;t>0&&t%5==0?yield this.handleFinishHardLevel():yield this.handleFinishNormalLevel(),this.handleNextLevelSingle()})),function(){return a.apply(this,arguments)})},{key:"handleFinishNormalLevel",value:(i=q((function*(){var t,n,i,a,o,r,s=this.data.level,u=void 0===s?0:s,c=null!==(t=null===(n=eC.getGameData())||void 0===n?void 0:n.coins)&&void 0!==t?t:0,h=null!==(i=null===(a=Js.getMatchCustomData())||void 0===a?void 0:a.score)&&void 0!==i?i:0;rC&&(yield null===(o=this.game)||void 0===o?void 0:o.uiManager.interstitialAdIndicator.flash()),k.canShowInterstitialAd()&&(null===(r=this.game)||void 0===r||r.node.scene.emit(oa.HIDE_UI),yield e.waitTweenAsync(.8),yield k.showInterstitialAdAsync({forLevel:u})),l.playSound(wn.LEVEL_COMPLETE,{volume:.5}),yield b.openScreenAndWaitForClose(w.LEVEL_COMPLETE_SCREEN,{level:u,coins:c,score:h,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!1})})),function(){return i.apply(this,arguments)})},{key:"handleFinishHardLevel",value:(n=q((function*(){var e,t,n,i,a,o=this.data.level,r=void 0===o?0:o,s=null!==(e=null===(t=eC.getGameData())||void 0===t?void 0:t.coins)&&void 0!==e?e:0,u=null!==(n=null===(i=Js.getMatchCustomData())||void 0===i?void 0:i.score)&&void 0!==n?n:0;l.playSound(wn.LEVEL_COMPLETE,{volume:.5});var c=(yield b.openScreenAndWaitForClose(w.LEVEL_COMPLETE_SCREEN,{level:r,coins:s,score:u,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!0})).screenData,h=(null!=c?c:{}).canShowRewardsAd;if(void 0!==h&&h){var p=(yield b.openScreenAndWaitForClose(w.GET_REWARDS_SCREEN)).screenData,d=null!==(a=null==p?void 0:p.getRewardsSuccess)&&void 0!==a&&a;d&&this.getRewardItems(),yield b.openScreenAndWaitForClose(w.LEVEL_COMPLETE_SCREEN,{level:r,coins:s,score:u,getRewardsSuccess:d,lookingForRewards:!1}),d||(yield k.showInterstitialAdAsync({forLevel:r}))}else yield k.showInterstitialAdAsync({forLevel:r})})),function(){return n.apply(this,arguments)})},{key:"handleNextLevelSingle",value:function(){var e=this.data.level,t=eC.getGameData();this.game&&e&&t&&this.game.node.scene.emit(oa.NEXT_LEVEL)}},{key:"getRewardItems",value:function(){this.game&&(this.game.node.scene.emit(oa.ADD_ITEM,{item:d.STORM,quantity:1}),this.game.node.scene.emit(oa.ADD_ITEM,{item:d.THUNDER,quantity:1}))}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),h}(VS);J._RF.pop(),J._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var sC=globalThis.game,uC=sC.player,cC=sC.match,hC=GameCore.Match.Modes,pC=function(t){B(c,t);var n,i,a,o,r,s,u=F(c);function c(e){var t;return N(this,c),(t=u.call(this,e)).clearBoard(),t.initCountdown(),t.initScore(),t.loadLevel().then((function(){t.updateUI()})),t}return M(c,[{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.board.clearAnimationQueue(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(s=q((function*(){if(this.game){var e=Js.getMatchMode();try{if(e===hC.CHALLENGE_FRIEND){var t=yield this.loadChallengeFriendMode(),n=t.frames,i=t.extraData;l.playSound(wn.LEVEL_START),this.handleChallengeFriendModeStart(n,i)}else{var a=yield this.loadSingleMode();l.playSound(wn.LEVEL_START),e===hC.SINGLE?this.handleSingleModeStart(a):e===hC.TOURNAMENT&&this.handleTournamentModeStart(a)}}catch(e){console.error("Error loading level:",e);var o=yield this.loadSingleMode();l.playSound(wn.LEVEL_START),this.handleSingleModeStart(o)}}})),function(){return s.apply(this,arguments)})},{key:"loadChallengeFriendMode",value:(r=q((function*(){var e=cC.getMatchState().id,t=yield Js.getMatchExtraDataAsync(e);if(!t)throw new Error("Match mode ".concat(hC.CHALLENGE_FRIEND," but no extraData (for opponent initialization) was found in match data."));var n=this.game.levelManager,i=yield n.loadLevel(t.level);return this.updateGameData({level:t.level,levelData:n.getLevelData()}),{frames:i,extraData:t}})),function(){return r.apply(this,arguments)})},{key:"loadSingleMode",value:(o=q((function*(){var e=this.game.levelManager,t=yield e.loadLevel(this.data.level,this.data.themeId);return this.updateGameData({levelData:e.getLevelData()}),t})),function(){return o.apply(this,arguments)})},{key:"handleChallengeFriendModeStart",value:(a=q((function*(e,t){if(this.game){var n=this.game.levelManager.getLevelData(),i=t.level,a=t.fen,o=t.gravity,r=t.rules,l=t.time,s=uC.getPlayerId();yield Promise.all([Js.setMatchCustomDataAsync({level:i,score:0}),Js.setProfileMatchDataAsync({id:s,score:0})]),yield this.game.board.create(e,U(U({},n),{},{level:i,customFen:a,mode:o,rules:r,time:l})),this.game.board.setIgnoreInput(!0),yield this.game.board.animateTilesAppear(),this.game.board.setIgnoreInput(!1),this.ready()}})),function(e,t){return a.apply(this,arguments)})},{key:"handleSingleModeStart",value:(i=q((function*(t){var n;if(this.game){var i=this.game.levelManager.getLevelData(),a=this.data.level,o=uC.getPlayerId();yield Promise.all([Js.setMatchCustomDataAsync({level:a,score:0}),Js.setProfileMatchDataAsync({id:o,score:0})]),yield this.game.board.create(t,i),this.game.board.setIgnoreInput(!0),yield this.game.board.animateTilesAppear(),null!==(n=this.game.guidelinesManager)&&void 0!==n&&n.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),a&&a>0&&a%5==0&&(Mt.isLandscape()&&this.game.handleShowUI(),b.openScreen(w.HARD_LEVEL_SCREEN),yield e.waitTweenAsync(1.3),b.closeScreen(w.HARD_LEVEL_SCREEN),yield this.game.board.animateTilesWave()),this.ready()}})),function(e){return i.apply(this,arguments)})},{key:"handleTournamentModeStart",value:(n=q((function*(e){var t;if(this.game){var n=this.game.levelManager.getLevelData(),i=this.data.level,a=uC.getPlayerId();yield Promise.all([Js.setMatchCustomDataAsync({level:i}),Js.setProfileMatchDataAsync({id:a})]),yield this.game.board.create(e,n),this.game.board.setIgnoreInput(!0),yield this.game.board.animateTilesAppear(),null!==(t=this.game.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),this.ready()}})),function(e){return n.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.init()}},{key:"initCountdown",value:function(){this.game&&this.game.clockManager.init()}},{key:"updateUI",value:function(){if(this.game){var e=this.game.getGameData();if(e){var t=e.level,n=void 0===t?0:t,i=e.levelData;this.game.uiManager.setLevelText(n),i&&this.game.clockManager.setTime(i.time)}}}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),c}(VS);J._RF.pop(),J._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var dC=function(e){B(n,e);var t=F(n);function n(e){var i;return N(this,n),(i=t.call(this,e)).startCountdown(),i}return M(n,[{key:"startCountdown",value:function(){this.game&&(this.game.clockManager.startCountdown(),this.game.uiManager.startCountdown())}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"playing",value:function(){}},{key:"fail",value:function(e){var t=this.manager.createFailState(this.manager,e);this.manager.change(t)}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){this.updateStateData()}}]),n}(VS);J._RF.pop(),J._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var yC,vC=globalThis.game.analytics,fC=GameCore.Utils.Valid,gC=function(e){B(n,e);var t=F(n);function n(e){var i;return N(this,n),i=t.call(this,e),l.stopAllSounds(),l.turnDownMusic(),i.handleGuideFlow(),i.setGridPlayable(),i.logLevelStartAnalytics(),i}return M(n,[{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(e){if(fC.isDebugger()){var t=this.manager.createFailState(this.manager);this.manager.change(t)}}},{key:"finish",value:function(){if(fC.isDebugger()){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var e;null!==(e=this.manager.getGameplay().guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var e,t;this.game&&(null!==(e=this.game.guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.game.handleShowUI(),null===(t=this.game.guidelinesManager)||void 0===t||t.show())}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=(Js.getMatchCustomData()||{}).score,i=void 0===n?0:n,a=Js.getMatchMode()||void 0;vC.levelStart(t,i,a)}}}]),n}(VS);J._RF.pop(),J._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var mC,bC=(0,Q.ccclass)("StateManager")(yC=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(e){this.gameplay=e,this.state=new pC(this)}},{key:"change",value:function(e){this.state=e}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return this.state instanceof pC}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return this.state instanceof gC}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return this.state instanceof dC}},{key:"fail",value:function(e){this.state.fail(e)}},{key:"isFail",value:function(){return this.state instanceof JS}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return this.state instanceof lC}},{key:"update",value:function(e){this.state&&this.state.update(e)}},{key:"createInitializeState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Z(pC,t)}},{key:"createReadyState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Z(gC,t)}},{key:"createPlayingState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Z(dC,t)}},{key:"createFailState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Z(JS,t)}},{key:"createFinishState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Z(lC,t)}}]),n}(re))||yC;J._RF.pop(),J._RF.push({},"a95ba1U+uJB66zZU7UYL4e5","TournamentManager",void 0);var wC,kC,SC,CC,EC,AC,TC,RC,PC,OC=Q.ccclass,IC=GameCore.Utils.Object,LC=globalThis.game.player,_C=OC("TournamentManager")(mC=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).leaderData=[],e.isInited=!1,e}return M(n,[{key:"init",value:function(e){var t=this,n=LC.getPlayerId();this.leaderData=IC.vals(e.leaders).reduce((function(e,t){if(t.playerId!==n&&t.score>0){var i={score:t.score,rank:t.rank};e.push(i)}return e}),[]),this.leaderData.sort((function(e,t){return e.score-t.score})),this.leaderData.forEach((function(e,n){e.rank=t.leaderData.length-n})),this.isInited=!0}}]),n}(re))||mC;J._RF.pop(),J._RF.push({},"2b89dXjcudIaZRJFuh5TAAI","InterstitialAdIndicator",void 0);var DC=Q.ccclass,MC=Q.property,NC=["ads.interNotice.backInSec","ads.interNotice.hangTight","ads.interNotice.quickAd"];var zC,BC=GameCore.Configs.Ads.NotifyPlayerBeforeShow,FC=(wC=DC("InterstitialAdIndicator"),kC=a.required(),SC=MC(he),CC=a.required(),EC=MC(p),wC((RC=D((TC=function(t){B(o,t);var n,i=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n)),z(e,"uiOpacity",RC,x(e)),z(e,"labelLocalizer",PC,x(e)),e}return M(o,[{key:"__preload",value:function(){a.validateRequiredProperties(this)}},{key:"flash",value:(n=q((function*(){var t;if(!1===BC)return Promise.resolve();null===(t=this.signal)||void 0===t||t.abort();var n,i=new r;this.signal=i,this.labelLocalizer.key=(n=Math.floor(Math.random()*NC.length),NC[n]);var a=ie(this.uiOpacity).to(.25,{opacity:255},{easing:"linear"}).delay(.25).to(.25,{opacity:100},{easing:"linear"}).delay(.125);yield e.runTweenAsync(ie(this.uiOpacity).repeat(2,a).to(.25,{opacity:0},{easing:"linear"}),i),this.uiOpacity.opacity=0})),function(){return n.apply(this,arguments)})}]),o}(re)).prototype,"uiOpacity",[kC,SC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PC=D(TC.prototype,"labelLocalizer",[CC,EC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AC=TC))||AC);J._RF.pop(),J._RF.push({},"dfab8xSeglD/abIKphEhi4g","ComboContainer",void 0);var xC,UC=Q.ccclass,GC=GameCore.Match.Modes,HC=UC("ComboContainer")(zC=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"__preload",value:function(){this.widget=this.node.getComponent(ne),this.node.scene.on(oa.GRID_RESIZE,this.handleViewResized,this)}},{key:"init",value:function(e){this.board=e}},{key:"updateWidget",value:function(){if(Mt.isPortrait())return this.node.scale=new Oe(1,1,1),this.widget.right=22.5,void(this.widget.top=Js.getMatchMode()===GC.TOURNAMENT?180:160);if(this.board){this.node.scale=new Oe(1.5,1.5,1.5);var e=this.board.getBoundingBoxWorld().yMax,t=i.cssSizeToWorldSize(i.getScreenHeightCss());this.widget.right=142.5,this.widget.top=(t-e)/2}}},{key:"updateStatus",value:function(){this.updateWidget()}},{key:"handleViewResized",value:function(){this.updateWidget()}}]),n}(re))||zC;J._RF.pop(),J._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var VC,qC,WC,KC,jC,YC,XC,ZC,JC,QC,$C,eE,tE,nE,iE,aE,oE,rE,lE,sE,uE,cE,hE,pE,dE,yE,vE=Q.ccclass,fE=vE("ComboProgressBar")(xC=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"start",value:function(){this.progressBar=this.getComponent($o),this.opacity=this.getComponent(he),this.comboTimer=0,this.isActive=!1,this.node.scene.on(oa.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(e){this.isActive&&(this.comboTimer>0?(this.comboTimer-=e,this.progressBar.progress=this.comboTimer/2):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(oa.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>0&&(this.isActive=!0,this.comboTimer=2),e>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),n}(re))||xC;J._RF.pop(),J._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var gE,mE,bE,wE,kE,SE,CE,EE=Q.ccclass,AE=Q.property,TE=(j(VC={},d.HINT,"item.hintDesc"),j(VC,d.PLIERS,"item.pliersDesc"),j(VC,d.STORM,"item.stormDesc"),j(VC,d.THUNDER,"item.thunderDesc"),VC),RE=(qC=EE("SpecialItem"),WC=AE({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),KC=a.required,jC=AE({type:ve,tooltip:"The button that activates the item"}),YC=AE({type:ee,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),XC=a.required,ZC=AE({type:we,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),JC=a.required,QC=AE({type:ge,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),$C=a.required,eE=AE({type:ge,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),tE=a.required,nE=AE({type:he,group:"Animation"}),iE=a.required,aE=AE({type:he,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),qC((lE=D((rE=function(t){B(l,t);var n,i,o=F(l);function l(){var e;N(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),z(e,"isDevButton",lE,x(e)),z(e,"button",sE,x(e)),z(e,"quantity",uE,x(e)),z(e,"quantityLabel",cE,x(e)),z(e,"quantityNode",hE,x(e)),z(e,"plusNode",pE,x(e)),z(e,"glowUIOpacity",dE,x(e)),z(e,"uiOpacity",yE,x(e)),e.vibrateComp=null,e}return M(l,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){a.validateRequiredProperties(this,l)}},{key:"updateStatus",value:function(e){var t;if(void 0!==this.itemType){var n=null===(t=e.items)||void 0===t?void 0:t[this.itemType];n&&(this.setActiveStatus(n.canActivate),this.setQuantity(n.quantity,n.animate))}}},{key:"setActiveStatus",value:function(t){var n;null===(n=this.signal)||void 0===n||n.abort();var i=new r;this.signal=i,this.button.interactable=t,e.runTweenAsync(ie(this.uiOpacity).to(.2,{opacity:t?255:128}),i)}},{key:"activate",value:(i=q((function*(){this.quantity<=0?this.requestItem():(this.vibrate(),this.node.scene.emit(oa.USE_ITEM,this.itemType))})),function(){return i.apply(this,arguments)})},{key:"setQuantity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e;if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,void(this.plusNode.active=!1);n=Math.max(0,n),this.quantity=n,this.quantityLabel.string="".concat(this.quantity),n<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),t&&this.animateAddItem()}},{key:"requestItem",value:function(){void 0!==this.itemType?b.openScreen(w.GET_ITEM_SCREEN,{item:this.itemType,localizedMessageKey:TE[this.itemType],quantity:1}):console.warn("Item type is not defined")}},{key:"vibrate",value:function(){var e,t;this.vibrateComp=null!==(e=this.vibrateComp)&&void 0!==e?e:this.node.getComponent(vs),null===(t=this.vibrateComp)||void 0===t||t.vibrate(50)}},{key:"animateAddItem",value:(n=q((function*(){return this.glowUIOpacity.opacity=0,Promise.all([e.runTweenAsync(ie(this.node).to(.1,{scale:new Oe(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:Oe.ONE},{easing:"elasticOut"})),e.runTweenAsync(ie(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))])})),function(){return n.apply(this,arguments)})}]),l}(re)).prototype,"isDevButton",[WC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sE=D(rE.prototype,"button",[KC,jC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uE=D(rE.prototype,"quantity",[YC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cE=D(rE.prototype,"quantityLabel",[XC,ZC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hE=D(rE.prototype,"quantityNode",[JC,QC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pE=D(rE.prototype,"plusNode",[$C,eE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dE=D(rE.prototype,"glowUIOpacity",[tE,nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yE=D(rE.prototype,"uiOpacity",[iE,aE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oE=rE))||oE);J._RF.pop(),J._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var PE=Q.ccclass,OE=Q.disallowMultiple,IE=Q.property,LE=(gE=PE("Clock"),mE=IE(ge),bE=IE(we),gE(wE=OE((SE=D((kE=function(t){B(o,t);var n,i,a=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),z(e,"clockIcon",SE,x(e)),z(e,"timeLabel",CE,x(e)),e}return M(o,[{key:"__preload",value:function(){this.node.scene.on(oa.TIME_UPDATED,this.updateTimeLabel,this),this.node.scene.on(oa.RESCUE_START,this.handleRescueStart,this),this.node.scene.on(oa.RESCUE_FINISHED,this.handleRescueFinished,this)}},{key:"updateStatus",value:function(e){e.time&&this.updateTimeLabel(e.time)}},{key:"updateTimeLabel",value:function(e){var t=this.convertSecondsToMmSs(e);this.timeLabel.string=t}},{key:"convertSecondsToMmSs",value:function(e){var t=Math.floor(e/60),n=Math.floor(e%60),i=this.padZero(t),a=this.padZero(n);return"".concat(i,":").concat(a)}},{key:"padZero",value:function(e){return e<10?"0".concat(e):"".concat(e)}},{key:"handleRescueStart",value:(i=q((function*(){var t=ie(this.node).to(.5,{scale:new Oe(1.1,1.1,1)}),n=ie(this.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),i=ie(this.clockIcon).repeat(5,n);e.runTweenAsync(i),e.runTweenAsync(t)})),function(){return i.apply(this,arguments)})},{key:"handleRescueFinished",value:(n=q((function*(){var t=ie(this.node).to(.5,{scale:new Oe(1,1,1)});e.runTweenAsync(t)})),function(){return n.apply(this,arguments)})}]),o}(re)).prototype,"clockIcon",[mE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CE=D(kE.prototype,"timeLabel",[bE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wE=kE))||wE)||wE);J._RF.pop(),J._RF.push({},"af947t5g91EkZVWXv5upZaV","CacheUtils",void 0);var _E,DE,ME,NE,zE,BE,FE,xE,UE,GE,HE,VE=GameCore.Utils.Image,qE=globalThis.game.frameCapture,WE=function(){function e(){N(this,e)}var t,n,i;return M(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getPlayerAvatar",value:(i=q((function*(e,t,n,i){var a=this.playerAvatarCache.get("".concat(t,":").concat(n));return a||(a=yield this.loadPlayerAvatar(e,t,n,i)),a})),function(e,t,n,a){return i.apply(this,arguments)})},{key:"loadPlayerAvatar",value:(n=q((function*(e,t,n,i){var a=yield this.loadImage(e,n,n,"".concat(t,":").concat(n));if((null==i||!i.aborted)&&a){var o=ze.createWithImage(a);return this.playerAvatarCache.set("".concat(t,":").concat(n),o),o}})),function(e,t,i,a){return n.apply(this,arguments)})},{key:"isAvatarCached",value:function(e,t){return this.playerAvatarCache.has("".concat(e,":").concat(t))}},{key:"loadImage",value:(t=q((function*(e,t,n,i){try{var a=yield qE.captureAsync({width:t,height:n,name:"LeaderAvatar",renderOptions:j({},i,{name:i,type:"image",depth:0,position:[0,0],size:[t,n],image:e})});return a?yield VE.loadImage(a):null}catch(e){return null}})),function(e,n,i,a){return t.apply(this,arguments)})}]),e}();WE.playerAvatarCache=new Map;try{new WE}catch(e){console.error("CacheUtils",e)}J._RF.pop(),J._RF.push({},"540108ucKBPYbN9gW5TFh/q","LeaderRail",void 0);var KE,jE,YE,XE,ZE,JE=Q.ccclass,QE=Q.property,$E=(_E=JE("LeaderRail"),DE=QE(we),ME=QE(ge),NE=QE(se),zE=QE(Ug),_E((xE=D((FE=function(t){B(o,t);var n,i,a=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),z(e,"scoreLabel",xE,x(e)),z(e,"crown",UE,x(e)),z(e,"avatar",GE,x(e)),z(e,"spark",HE,x(e)),e.score=0,e}return M(o,[{key:"__preload",value:function(){this.defaultAvatar=this.avatar.spriteFrame,this.uiOpacity=this.getComponent(he)}},{key:"updateScore",value:(i=q((function*(t,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=t-this.score,r=a?0:.5,l=ie(this.node).to(r,{},{onUpdate:function(e,t){if(t){var n=Math.floor(o*t)+i.score;i.scoreLabel.string=n.toString()}}});yield e.runTweenAsync(l,n),this.score=t,this.scoreLabel.string=t.toString()})),function(e,t){return i.apply(this,arguments)})},{key:"updatePhoto",value:(n=q((function*(){var e=GameSDK.player.getPhoto(),t=GameSDK.player.getID();if(e&&t){var n=yield WE.getPlayerAvatar(e,t,50);n?(n.packable=!0,this.avatar.spriteFrame=n):this.avatar.spriteFrame=this.defaultAvatar}})),function(){return n.apply(this,arguments)})},{key:"setCrown",value:function(e){this.crown.active=e}},{key:"setOpacity",value:function(e){this.uiOpacity.opacity=e}},{key:"playSparkParticle",value:function(){this.spark.play()}},{key:"stopSparkParticle",value:function(){this.spark.stop()}}]),o}(re)).prototype,"scoreLabel",[DE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UE=D(FE.prototype,"crown",[ME],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GE=D(FE.prototype,"avatar",[NE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HE=D(FE.prototype,"spark",[zE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BE=FE))||BE);J._RF.pop(),J._RF.push({},"00759vwS/dHS6GvHKvVE5Q1","TournamentProgressBar",void 0);var eA,tA,nA,iA,aA,oA,rA,lA,sA,uA,cA,hA,pA,dA,yA,vA,fA=Q.ccclass,gA=Q.property,mA=474,bA=(KE=fA("TournamentProgressBar"),jE=gA($E),KE((ZE=D((XE=function(t){B(a,t);var n,i=F(a);function a(){var e;N(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),z(e,"playerLeader",ZE,x(e)),e.onUpdate=function(){e.playerLeader&&e.playerLeader.node&&(e.playerLeader.node.position=new Oe(e.progressBar.progress*mA-237,0,0))},e}return M(a,[{key:"__preload",value:function(){this.progressBar=this.getComponent(Re)}},{key:"updateProgress",value:(n=q((function*(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"cubicOut",o=ie(this.progressBar).to(i,{progress:t},{easing:a,onUpdate:this.onUpdate});yield e.runTweenAsync(o,n)})),function(e,t){return n.apply(this,arguments)})},{key:"getProgress",value:function(){return this.progressBar.progress}}]),a}(re)).prototype,"playerLeader",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YE=XE))||YE);J._RF.pop(),J._RF.push({},"16d68fBLT1Ha7lXADThDtfC","TournamentRail",void 0);var wA,kA,SA,CA,EA,AA,TA,RA,PA,OA=Q.ccclass,IA=Q.property,LA=GameCore,_A=LA.Utils.Array,DA=LA.Match.Modes,MA=(eA=OA("TournamentRail"),tA=IA(bA),nA=IA($E),iA=IA(ge),aA=IA(ge),oA=IA(p),rA=IA(p),lA=a.onlyRunInLifeCycleAsync,eA((cA=D((uA=function(t){B(u,t);var n,i,a,o,l,s=F(u);function u(){var e;N(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),z(e,"progressBar",cA,x(e)),z(e,"playerLeader",hA,x(e)),z(e,"flag",pA,x(e)),z(e,"sword",dA,x(e)),z(e,"currentRankLocalizer",yA,x(e)),z(e,"nextRankLocalizer",vA,x(e)),e.nextLeaderIndex=0,e.score=0,e.minScore=0,e.maxScore=0,e.signal=new r,e}return M(u,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(he),this.playerLeader.updatePhoto()}},{key:"updateStatus",value:(l=q((function*(e){if(Js.getMatchMode()===DA.TOURNAMENT){this.uiOpacity.opacity=255;var t=e.leaderData,n=e.score;if(t&&void 0!==n){this.signal.abort();var i=new r;this.signal=i,this.score=n,this.nextLeaderIndex=this.getScoreReachedLeaderIndex(this.score,t),this.syncRail(t,i,!0)}}else this.uiOpacity.opacity=0})),function(e){return l.apply(this,arguments)})},{key:"syncRail",value:(o=q((function*(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e[this.nextLeaderIndex-1],a=e[this.nextLeaderIndex],o=i?i.rank:a?a.rank+1:1;this.setRankLabel(o,this.currentRankLocalizer);var r=!a;this.nextRankLocalizer.node.active=!r,this.runActiveAnimation(this.sword,!r,t,n),this.playerLeader.setCrown(r),this.playerLeader.updateScore(this.score,t,n);var l=n?0:void 0;if(r)this.playerLeader.playSparkParticle(),yield this.progressBar.updateProgress(1,t,l);else{this.playerLeader.stopSparkParticle(),this.setRankLabel(a.rank,this.nextRankLocalizer),this.minScore=i?i.score:0,this.maxScore=a.score;var s=(this.score-this.minScore)/(this.maxScore-this.minScore);s=.8*s+.1,yield this.progressBar.updateProgress(s,t,l)}})),function(e,t){return o.apply(this,arguments)})},{key:"handleScoreUpdated",value:(a=q((function*(e){var t=e.score,n=e.leaderData;if(void 0!==t&&n&&this.score!==t){this.signal.abort();var i=new r;this.signal=i,this.score=t;var a=this.getScoreReachedLeaderIndex(t,n);if(a>this.nextLeaderIndex){this.nextLeaderIndex=a;var o=(1-this.progressBar.getProgress())/1.5;o=Math.min(o,.5),yield this.progressBar.updateProgress(1,i,o,"cubicIn"),this.runBubbleAnimation(this.sword,i),yield this.progressBar.updateProgress(0,i,0),this.runBubbleAnimation(this.flag,i)}this.syncRail(n,i)}})),function(e){return a.apply(this,arguments)})},{key:"runBubbleAnimation",value:(i=q((function*(t,n){t.scale=Oe.ONE;var i=ie(t).to(.1,{scale:new Oe(1.2,1.2,1.2)}).to(.2,{scale:Oe.ONE},{easing:"backOut"});yield e.runTweenAsync(i,n),t.scale=Oe.ONE})),function(e,t){return i.apply(this,arguments)})},{key:"runActiveAnimation",value:(n=q((function*(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=n?Oe.ZERO:Oe.ONE,r=n?Oe.ONE:Oe.ZERO;if(a)t.scale=r;else if(!t.scale.equals(r)){var l=n?"backOut":"quadOut";t.scale=o;var s=ie(t).to(.1,{scale:new Oe(1.2,1.2,1.2)}).to(.2,{scale:r},{easing:l});yield e.runTweenAsync(s,i),t.scale=r}})),function(e,t,i){return n.apply(this,arguments)})},{key:"getScoreReachedLeaderIndex",value:function(e,t){var n=_A.searchIndex(t,(function(t){return t.score>=e}));return-1===n?t.length:n}},{key:"setRankLabel",value:function(e,t){1!==e?2!==e?3!==e?(t.key="status.nth",t.setParams([e.toString()])):t.key="status.third":t.key="status.second":t.key="status.first"}}]),u}(re)).prototype,"progressBar",[tA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hA=D(uA.prototype,"playerLeader",[nA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pA=D(uA.prototype,"flag",[iA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dA=D(uA.prototype,"sword",[aA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yA=D(uA.prototype,"currentRankLocalizer",[oA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vA=D(uA.prototype,"nextRankLocalizer",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(uA.prototype,"updateStatus",[lA],Object.getOwnPropertyDescriptor(uA.prototype,"updateStatus"),uA.prototype),sA=uA))||sA);J._RF.pop(),J._RF.push({},"ac5371+oVZBLoBKwAM7rH3r","GameSceneLayout",void 0);var NA,zA,BA,FA,xA,UA,GA,HA,VA,qA=Q.ccclass,WA=Q.property,KA=(wA=qA("GameSceneLayout"),kA=WA(MA),SA=WA(LE),CA=WA(RE),wA((TA=D((AA=function(e){B(o,e);var t,n,i,a=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),z(e,"tournamentRail",TA,x(e)),z(e,"clock",RA,x(e)),z(e,"items",PA,x(e)),e.isInited=!1,e.entranceSignal=new r,e.exitSignal=new r,e}return M(o,[{key:"waitForInitAsync",value:(i=q((function*(){var e=this;if(!this.isInited)return new Promise((function(t){var n=setInterval((function(){e.isInited&&(clearInterval(n),t())}),100)}))})),function(){return i.apply(this,arguments)})},{key:"setLevelText",value:function(e){}},{key:"disableLayout",value:function(){}},{key:"enableLayout",value:function(){}},{key:"updateStatus",value:function(e){this.clock.updateStatus(e),this.tournamentRail.updateStatus(e);var t,n=G(this.items);try{for(n.s();!(t=n.n()).done;){t.value.updateStatus(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"playExitAnimUI",value:(n=q((function*(){})),function(){return n.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(t=q((function*(){})),function(){return t.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){}},{key:"unHighlightCoinContainer",value:function(){}},{key:"handleScoreUpdated",value:function(e){}}]),o}(re)).prototype,"tournamentRail",[kA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RA=D(AA.prototype,"clock",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PA=D(AA.prototype,"items",[CA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),EA=AA))||EA);J._RF.pop(),J._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var jA,YA,XA,ZA,JA,QA,$A,eT=Q.ccclass,tT=Q.property,nT=Q.disallowMultiple,iT=(NA=eT("ScoreBlock"),zA=tT(we),BA=tT(ye),FA=tT({visible:function(){return this.isResizeWidth}}),NA(xA=nT((GA=D((UA=function(t){B(r,t);var n,i,o=F(r);function r(){var e;N(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),z(e,"scoreText",GA,x(e)),z(e,"isResizeWidth",HA,x(e)),z(e,"maxScoreWidth",VA,x(e)),e.panelWidthDiff=0,e}return M(r,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent($),this.scoreUITransform=this.scoreText.node.getComponent($),this.panelWidthDiff=this.uiTransform.width-this.maxScoreWidth,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"updateScore",value:(i=q((function*(t){var n=this,i=t-this.score,a=ie(this.node).to(.1,{},{onUpdate:function(e,t){if(t){var a=Math.floor(i*t)+n.score;n.scoreText.string=a.toString(),n.resizeWidth()}}});yield e.runTweenAsync(a),this.setScore(t),yield this.resizeWidth()})),function(e){return i.apply(this,arguments)})},{key:"setScore",value:function(e){var t=null!=e?e:0;this.score=t,this.scoreText.string=t.toString()}},{key:"resizeWidth",value:(n=q((function*(){var t=this;if(this.isResizeWidth){var n=this.uiTransform.width,i=(this.scoreUITransform.width>this.maxScoreWidth?this.scoreUITransform.width:this.maxScoreWidth)+this.panelWidthDiff;this.uiTween&&this.uiTween.stop(),this.uiTween=ie(this.node).to(.05,{},{easing:"sineOut",onUpdate:function(e,a){a&&(t.uiTransform.width=Ae.lerp(n,i,a))}}),yield e.runTweenAsync(this.uiTween),this.uiTransform.width=i}})),function(){return n.apply(this,arguments)})}]),r}(re)).prototype,"scoreText",[zA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HA=D(UA.prototype,"isResizeWidth",[BA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),VA=D(UA.prototype,"maxScoreWidth",[FA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xA=UA))||xA)||xA);J._RF.pop(),J._RF.push({},"424745QWUlDPabdCe8UcRwy","ChallengeScoreBlock",void 0);var aT,oT,rT,lT,sT,uT,cT,hT,pT,dT,yT,vT,fT,gT=Q.ccclass,mT=Q.property,bT=(jA=gT("ChallengeScoreBlock"),YA=mT(se),XA=mT(ze),jA((QA=D((JA=function(e){B(i,e);var t,n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"avatar",QA,x(e)),z(e,"defaultAvatar",$A,x(e)),e}return M(i,[{key:"updateInfo",value:(t=q((function*(e,t,n){var i=this;this.setScore(n),this.scheduleOnce((function(){return i.resizeWidth()}),0);try{var a=yield WE.getPlayerAvatar(e,t,50);if(!a)return;a.packable=!0,this.avatar.spriteFrame=a}catch(e){this.avatar.spriteFrame=this.defaultAvatar}})),function(e,n,i){return t.apply(this,arguments)})}]),i}(iT)).prototype,"avatar",[YA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$A=D(JA.prototype,"defaultAvatar",[XA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZA=JA))||ZA);J._RF.pop(),J._RF.push({},"b1ef276tNtH+oc5BqYfDMXl","Sidebar",void 0);var wT,kT,ST,CT,ET,AT,TT,RT,PT,OT,IT,LT,_T,DT=Q.ccclass,MT=Q.property,NT=Q.disallowMultiple,zT=(aT=DT("Sidebar"),oT=MT(iT),rT=MT(we),lT=MT(ge),sT=MT(ge),uT=MT(Ye),aT(cT=NT((pT=D((hT=function(t){B(i,t);var n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"scoreBlock",pT,x(e)),z(e,"levelNumber",dT,x(e)),z(e,"sidebarContainer",yT,x(e)),z(e,"leavesContainer",vT,x(e)),z(e,"entranceCurve",fT,x(e)),e.originSidebarPosition=0,e.originLeavesPosition=0,e}return M(i,[{key:"saveOriginPos",value:function(){this.originSidebarPosition=this.sidebarContainer.position.y,this.originLeavesPosition=this.leavesContainer.position.y}},{key:"initUIPos",value:function(){this.sidebarContainer.setPosition(this.sidebarContainer.position.x,this.originSidebarPosition+1200),this.leavesContainer.setPosition(this.leavesContainer.position.x,this.originLeavesPosition+150)}},{key:"playExitAnimUI",value:function(t){var n=ie(this.sidebarContainer).to(.2,{position:new Oe(this.sidebarContainer.position.x,this.originSidebarPosition+1200,0)},{easing:"quadIn"}),i=ie(this.leavesContainer);return i.delay(.1).to(.2,{position:new Oe(this.leavesContainer.position.x,this.originLeavesPosition+150,0)},{easing:"quadIn"}),[e.runTweenAsync(n,t),e.runTweenAsync(i,t)]}},{key:"playEntranceAnimUI",value:function(t){var n=this,i=ie(this.sidebarContainer).to(.3,{position:new Oe(this.sidebarContainer.position.x,this.originSidebarPosition,0)},{easing:function(e){return n.entranceCurve.evaluate(e)}}),a=ie(this.leavesContainer);return a.to(.2,{position:new Oe(this.leavesContainer.position.x,this.originLeavesPosition,0)},{easing:"quadIn"}),[e.runTweenAsync(i,t),e.runTweenAsync(a,t)]}},{key:"setLevelText",value:function(e){this.levelNumber.string=e.toString()}},{key:"updateStatus",value:function(e){e.score&&this.scoreBlock.setScore(e.score),e.level&&this.setLevelText(e.level)}},{key:"updateScore",value:function(e){this.scoreBlock.updateScore(e)}}]),i}(re)).prototype,"scoreBlock",[oT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dT=D(hT.prototype,"levelNumber",[rT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yT=D(hT.prototype,"sidebarContainer",[lT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vT=D(hT.prototype,"leavesContainer",[sT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fT=D(hT.prototype,"entranceCurve",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ye}}),cT=hT))||cT)||cT);J._RF.pop(),J._RF.push({},"0ff4fFbKylIvaONtaTZkRQV","LandscapeLayout",void 0);var BT,FT,xT,UT,GT,HT,VT,qT=Q.ccclass,WT=Q.property,KT=globalThis.game.match,jT=GameCore.Match.Modes,YT=(wT=qT("LandscapeLayout"),kT=WT({type:zT,group:"Sidebar"}),ST=WT({type:bT,group:"ChallengeScore"}),CT=WT({type:bT,group:"ChallengeScore"}),ET=WT(ge),AT=WT(ge),wT((PT=D((RT=function(t){B(o,t);var n,i,a=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),z(e,"sidebar",PT,x(e)),z(e,"playerScoreBlock",OT,x(e)),z(e,"opponentScoreBlock",IT,x(e)),z(e,"leftAnimNodes",LT,x(e)),e.originLeftNodesPos=[],z(e,"rightAnimNodes",_T,x(e)),e.originRightNodesPos=[],e}return M(o,[{key:"onLoad",value:function(){var e=this;Le.once(_e.EVENT_AFTER_UPDATE,(function(){e.saveOriginPos(),e.initUIPos(),e.isInited=!0}))}},{key:"saveOriginPos",value:function(){this.sidebar.saveOriginPos();var e,t=G(this.leftAnimNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.originLeftNodesPos.push(n.position.clone())}}catch(e){t.e(e)}finally{t.f()}var i,a=G(this.rightAnimNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.originRightNodesPos.push(o.position.clone())}}catch(e){a.e(e)}finally{a.f()}}},{key:"initUIPos",value:function(){var e=this;this.sidebar.initUIPos(),this.leftAnimNodes.forEach((function(t,n){var i=e.originLeftNodesPos[n].clone();i.y+=1200,t.setPosition(i)})),this.rightAnimNodes.forEach((function(t,n){var i=e.originRightNodesPos[n].clone();i.x+=900,t.setPosition(i)}))}},{key:"playExitAnimUI",value:(i=q((function*(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new r;var i=[];this.leftAnimNodes.forEach((function(a,o){var r=new Oe(t.node.position.x,t.originLeftNodesPos[o].y+1200,0),l=ie(a);l.to(n,{position:r},{easing:"quadIn"}),i.push(e.runTweenAsync(l,t.exitSignal))})),this.rightAnimNodes.forEach((function(a,o){var r=new Oe(t.originRightNodesPos[o].x+900,a.position.y,0),l=ie(a);l.to(n,{position:r},{easing:"backIn"}),i.push(e.runTweenAsync(l,t.exitSignal))})),i.push.apply(i,K(this.sidebar.playExitAnimUI(this.exitSignal))),yield Promise.all(i)})),function(){return i.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(n=q((function*(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new r;var i=[];this.leftAnimNodes.forEach((function(a,o){var r=new Oe(t.node.position.x,t.originLeftNodesPos[o].y,0),l=ie(a);l.to(n,{position:r},{easing:"quadOut"}),i.push(e.runTweenAsync(l,t.entranceSignal))})),this.rightAnimNodes.forEach((function(a,o){var r=new Oe(t.originRightNodesPos[o].x,a.position.y,0),l=ie(a);l.to(n,{position:r},{easing:"backOut"}),i.push(e.runTweenAsync(l,t.entranceSignal))})),i.push.apply(i,K(this.sidebar.playEntranceAnimUI(this.entranceSignal))),yield Promise.all(i)})),function(){return n.apply(this,arguments)})},{key:"setLevelText",value:function(e){this.sidebar.setLevelText(e)}},{key:"updateStatus",value:function(e){H(V(o.prototype),"updateStatus",this).call(this,e),this.sidebar.updateStatus(e),this.updateScoreBlockStatus(e)}},{key:"updateScoreBlockStatus",value:function(e){var t;if(Js.getMatchMode()!==jT.CHALLENGE_FRIEND)return this.playerScoreBlock.node.active=!1,void(this.opponentScoreBlock.node.active=!1);if(!this.playerScoreBlock.node.active){var n=KT.getMatchState(),i=null!==(t=Js.getMatchCustomData())&&void 0!==t?t:{},a=i.playerId,o=i.opponentId;if(a&&o){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var r=n.profiles[a],l=n.profiles[o];this.playerScoreBlock.updateInfo(r.photo,a,r.score),this.opponentScoreBlock.updateInfo(l.photo,o,l.score),e.score&&this.playerScoreBlock.setScore(e.score)}}}},{key:"handleScoreUpdated",value:function(e){this.sidebar.updateScore(e),this.playerScoreBlock.node.active&&this.playerScoreBlock.updateScore(e)}}]),o}(KA)).prototype,"sidebar",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OT=D(RT.prototype,"playerScoreBlock",[ST],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IT=D(RT.prototype,"opponentScoreBlock",[CT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LT=D(RT.prototype,"leftAnimNodes",[ET],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_T=D(RT.prototype,"rightAnimNodes",[AT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),TT=RT))||TT);J._RF.pop(),J._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var XT,ZT,JT,QT,$T,eR,tR,nR,iR,aR=Q.ccclass,oR=Q.property,rR=(BT=aR("UIMasks"),FT=oR(Si),xT=oR(Zw),BT((HT=D((GT=function(e){B(o,e);var t,n,i=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n)),z(e,"background",HT,x(e)),z(e,"alphaMasks",VT,x(e)),e}return M(o,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"show",value:(n=q((function*(){this.alphaMasks.setMaskActive(0,Mt.isPortrait()),this.alphaMasks.setMaskActive(1,Mt.isLandscape()),this.background.node.active=!0,yield this.background.changeStateFade(!0,.25)})),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=q((function*(){yield this.background.changeStateFade(!1,.25),this.background.node.active=!1})),function(){return t.apply(this,arguments)})}]),o}(re)).prototype,"background",[FT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VT=D(GT.prototype,"alphaMasks",[xT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UT=GT))||UT);J._RF.pop(),J._RF.push({},"f963aJjCvtD0Y2LplwjDer1","ScoreContainer",void 0);var lR,sR,uR,cR,hR,pR,dR,yR,vR,fR,gR,mR,bR,wR,kR,SR,CR=Q.ccclass,ER=Q.property,AR=GameCore.Match.Modes,TR=globalThis.game.match,RR=(XT=CR("ScoreContainer"),ZT=ER(iT),JT=ER(bT),QT=ER(bT),XT((tR=D((eR=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"scoreBlock",tR,x(e)),z(e,"playerScoreBlock",nR,x(e)),z(e,"opponentScoreBlock",iR,x(e)),e.scoreBlockShown=!1,e.challengeScoreBlockShown=!1,e}return M(n,[{key:"updateStatus",value:function(e){switch(TR.getMatchState().mode){case AR.CHALLENGE_FRIEND:this.showChallengeScoreBlock(),this.hideScoreBlock(),e.score&&this.playerScoreBlock.setScore(e.score);break;case AR.SINGLE:this.hideChallengeScoreBlock(),this.showScoreBlock(),e.score&&this.scoreBlock.setScore(e.score);break;default:this.hideScoreBlock(),this.hideChallengeScoreBlock()}}},{key:"showChallengeScoreBlock",value:function(){var e;if(!this.challengeScoreBlockShown){this.challengeScoreBlockShown=!0;var t=TR.getMatchState(),n=null!==(e=Js.getMatchCustomData())&&void 0!==e?e:{},i=n.playerId,a=n.opponentId;if(i&&a){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var o=t.profiles[i],r=t.profiles[a];this.playerScoreBlock.updateInfo(o.photo,i,o.score),this.opponentScoreBlock.updateInfo(r.photo,a,r.score)}}}},{key:"hideChallengeScoreBlock",value:function(){this.challengeScoreBlockShown&&(this.challengeScoreBlockShown=!1,this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1)}},{key:"showScoreBlock",value:function(){var e;if(!this.scoreBlockShown){this.scoreBlockShown=!0;var t=(null!==(e=Js.getMatchCustomData())&&void 0!==e?e:{}).score;this.scoreBlock.node.active=!0,this.scoreBlock.setScore(t)}}},{key:"hideScoreBlock",value:function(){this.scoreBlockShown&&(this.scoreBlockShown=!1,this.scoreBlock.node.active=!1)}},{key:"updateScore",value:function(e){this.challengeScoreBlockShown?this.playerScoreBlock.updateScore(e):this.scoreBlockShown&&this.scoreBlock.updateScore(e)}}]),n}(re)).prototype,"scoreBlock",[ZT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nR=D(eR.prototype,"playerScoreBlock",[JT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iR=D(eR.prototype,"opponentScoreBlock",[QT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$T=eR))||$T);J._RF.pop(),J._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var PR,OR,IR,LR,_R,DR,MR,NR,zR,BR=Q.ccclass,FR=Q.property,xR=(lR=BR("Header"),sR=FR(p),uR=FR(ge),cR=FR(ge),hR=FR(ge),pR=FR(ge),dR=FR(RR),yR=a.onlyRunInLifeCycle,lR((gR=D((fR=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"levelTextLocalizer",gR,x(e)),z(e,"settingNode",mR,x(e)),z(e,"homeNode",bR,x(e)),z(e,"leftNode",wR,x(e)),z(e,"coinNode",kR,x(e)),z(e,"scoreContainer",SR,x(e)),e}return M(n,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"updateStatus",value:function(e){this.scoreContainer.updateStatus(e),e.level&&this.setLevelText(e.level)}},{key:"highlightCoinContainer",value:function(){var e=Me("Canvas/Screens");if(e){var t=this.coinNode.worldPosition.clone();this.coinNode.parent=e,this.coinNode.worldPosition=t}}},{key:"removeCoinContainerHighlight",value:function(){var e=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=e}},{key:"setLevelText",value:function(e){this.levelTextLocalizer.setParams([e.toString()])}},{key:"setButtonsInteractable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.settingNode.getComponent(ve).interactable=e,this.homeNode.getComponent(ve).interactable=e}},{key:"setActive",value:function(e){this.uiOpacity.opacity=e?255:0}}]),n}(re)).prototype,"levelTextLocalizer",[sR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mR=D(fR.prototype,"settingNode",[uR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bR=D(fR.prototype,"homeNode",[cR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wR=D(fR.prototype,"leftNode",[hR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kR=D(fR.prototype,"coinNode",[pR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SR=D(fR.prototype,"scoreContainer",[dR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(fR.prototype,"setActive",[yR],Object.getOwnPropertyDescriptor(fR.prototype,"setActive"),fR.prototype),vR=fR))||vR);J._RF.pop(),J._RF.push({},"456584ngz9FupmxndAXqCbY","PortraitLayout",void 0);var UR=Q.ccclass,GR=Q.property,HR=(PR=UR("PortraitLayout"),OR=GR(xR),IR=GR([ge]),LR=GR([ge]),PR((MR=D((DR=function(t){B(l,t);var n,i,o=F(l);function l(){var e;N(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),z(e,"header",MR,x(e)),z(e,"topAnimNodes",NR,x(e)),e.originTopNodesPos=[],z(e,"botAnimNodes",zR,x(e)),e.originBotNodesPos=[],e.hideBotWorldY=-80,e}return M(l,[{key:"onLoad",value:function(){var e=this;this.validateRequiredComponents(),Le.once(_e.EVENT_AFTER_UPDATE,(function(){e.saveOriginPos(),e.initUIPos(),e.isInited=!0}))}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var e,t=G(this.topAnimNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.originTopNodesPos.push(n.position.clone())}}catch(e){t.e(e)}finally{t.f()}var i,a=G(this.botAnimNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.originBotNodesPos.push(o.position.clone())}}catch(e){a.e(e)}finally{a.f()}}},{key:"initUIPos",value:function(){var e=this;this.topAnimNodes.forEach((function(t,n){var i=e.originTopNodesPos[n].clone();i.y+=200,t.setPosition(i)}));var t=new Oe(0,this.hideBotWorldY,0);this.botAnimNodes.forEach((function(n,i){var a,o,r=e.originBotNodesPos[i].clone();t.y=e.hideBotWorldY;var l=null!==(a=null===(o=n.parent)||void 0===o?void 0:o.inverseTransformPoint(t,t).y)&&void 0!==a?a:200;r.y=l,n.setPosition(r)}))}},{key:"setLevelText",value:function(e){this.header.setLevelText(e)}},{key:"disableLayout",value:function(){this.header.setButtonsInteractable(!1)}},{key:"enableLayout",value:function(){this.header.setButtonsInteractable()}},{key:"updateStatus",value:function(e){H(V(l.prototype),"updateStatus",this).call(this,e),this.header.updateStatus(e)}},{key:"playExitAnimUI",value:(i=q((function*(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new r;var i=[];this.topAnimNodes.forEach((function(a,o){var r=new Oe(a.position.x,t.originTopNodesPos[o].y+200,0),l=ie(a);l.to(n,{position:r},{easing:"backIn"}),i.push(e.runTweenAsync(l,t.exitSignal))}));var a,o=new Oe(0,this.hideBotWorldY,0),l=G(this.botAnimNodes);try{for(l.s();!(a=l.n()).done;){var s,u,c=a.value;o.y=this.hideBotWorldY;var h=null!==(s=null===(u=c.parent)||void 0===u?void 0:u.inverseTransformPoint(o,o).y)&&void 0!==s?s:200,p=new Oe(c.position.x,h,0),d=ie(c);d.to(n,{position:p},{easing:"backIn"}),i.push(e.runTweenAsync(d,this.exitSignal))}}catch(e){l.e(e)}finally{l.f()}yield Promise.all(i),this.exitSignal.aborted||this.header.setActive(!1)})),function(){return i.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(n=q((function*(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new r,this.header.setActive(!0);var i=[];this.topAnimNodes.forEach((function(a,o){var r=new Oe(a.position.x,t.originTopNodesPos[o].y,0),l=ie(a);l.to(n,{position:r},{easing:"backOut"}),i.push(e.runTweenAsync(l,t.entranceSignal))})),this.botAnimNodes.forEach((function(a,o){var r=new Oe(a.position.x,t.originBotNodesPos[o].y,0),l=ie(a);l.to(n,{position:r},{easing:"backOut"}),i.push(e.runTweenAsync(l,t.entranceSignal))})),yield Promise.all(i)})),function(){return n.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"handleScoreUpdated",value:function(e){this.header.scoreContainer.updateScore(e)}}]),l}(KA)).prototype,"header",[OR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NR=D(DR.prototype,"topAnimNodes",[IR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zR=D(DR.prototype,"botAnimNodes",[LR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_R=DR))||_R);J._RF.pop(),J._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var VR,qR,WR,KR,jR,YR="bomb";J._RF.pop(),J._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var XR,ZR,JR,QR,$R,eP,tP,nP,iP,aP,oP,rP,lP,sP,uP,cP,hP,pP=GameCore,dP=pP.Dtos.Player,yP=pP.Utils.Function,vP=Q.ccclass,fP=Q.property,gP=globalThis.game,mP=gP.player,bP=gP.language,wP=Object.keys(h),kP=(VR=vP("DevToolsContainer"),qR=fP(ge),VR((jR=D((KR=function(e){B(l,e);var n,i,a,o,r=F(l);function l(){var e;N(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),z(e,"devToolsToggle",jR,x(e)),e.isActive=!0,e.game=null,e.bundleName="lowest",e.currentLocaleIndex=0,e.debouncedStarsNotification=yP.debounce((function(){var e=mP.getGameData();e&&b.showNotificationScreen("Stars added. Current stars: ".concat(e.stars))}),700),e}return M(l,[{key:"injectGameplay",value:function(e){this.game=e}},{key:"start",value:function(){this.initCurrentLocale()}},{key:"initCurrentLocale",value:function(){var e=bP.getCurrentLocale();this.currentLocaleIndex=wP.indexOf(e)}},{key:"hideAllButtons",value:function(){var e,t=this.getComponentsInChildren(ve),n=G(t);try{for(n.s();!(e=n.n()).done;){var i=e.value.node.parent;i&&(i.name!==this.devToolsToggle.name&&(i.active=!1))}}catch(e){n.e(e)}finally{n.f()}}},{key:"showAllButtons",value:function(){var e,t=this.getComponentsInChildren(ve),n=G(t);try{for(n.s();!(e=n.n()).done;){var i=e.value.node.parent;i&&(i.name!==this.devToolsToggle.name&&(i.active=!0))}}catch(e){n.e(e)}finally{n.f()}}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){mP.setPlayerData(dP.Data.getDefaultData()),b.openScreen(w.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(oa.START_OVER,0)}},{key:"handleNextLevel",value:(o=q((function*(){var e,t,n,i=(null!==(e=null===(t=this.game)||void 0===t||null===(t=t.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:1)+1;null===(n=this.game)||void 0===n||n.setGameData({level:i-1}),mP.setGameData({level:i}),this.node.scene.emit(oa.NEXT_LEVEL)})),function(){return o.apply(this,arguments)})},{key:"handlePrevLevel",value:(a=q((function*(){var e,t,n,i=Math.max((null!==(e=null===(t=this.game)||void 0===t||null===(t=t.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:2)-1,1);null===(n=this.game)||void 0===n||n.setGameData({level:i-1}),mP.setGameData({level:i}),this.node.scene.emit(oa.NEXT_LEVEL)})),function(){return a.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(i=q((function*(e){var t,n=Number(e.string);null===(t=this.game)||void 0===t||t.setGameData({level:n-1}),mP.setGameData({level:n}),this.node.scene.emit(oa.NEXT_LEVEL)})),function(e){return i.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var e=globalThis.game.getBuildVersion();b.showNotificationScreen("Build version: ".concat(e))}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(oa.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){var e;null===(e=this.game)||void 0===e||e.clockManager.setTime(.1)}},{key:"handleClickExplodeButton",value:function(){var e,t,n=this.game;if(n){var i=null===(e=n.getGameData())||void 0===e||null===(e=e.levelData)||void 0===e?void 0:e.specials.bomb;if(i&&!(i<=0)){var a=n.board.getBombTiles();if(0!==a.length){var o=a[0];if(!o||(null===(t=o.special)||void 0===t?void 0:t.type)!==YR)throw new Error("Invalid bomb tile");o.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(oa.ADD_ITEM,{item:d.HINT,quantity:2}),this.node.scene.emit(oa.ADD_ITEM,{item:d.STORM,quantity:2}),this.node.scene.emit(oa.ADD_ITEM,{item:d.THUNDER,quantity:2}),this.node.scene.emit(oa.ADD_ITEM,{item:d.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(oa.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var e=mP.getGameData();e&&(mP.setGameData({stars:e.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchQualityAssets",value:function(){switch(this.bundleName){case"lowest":this.bundleName="highest";break;case"highest":this.bundleName="lowest"}oe.emit(t.CHANGE_QUALITY_ASSETS,{quality:this.bundleName})}},{key:"handleSwitchLocale",value:(n=q((function*(){this.currentLocaleIndex=(this.currentLocaleIndex+1)%wP.length;var e=wP[this.currentLocaleIndex];b.showLoadingNotificationScreen();try{if(!e)throw new Error("Locale is undefined");yield this.preloadLanguageAsync(e),oe.emit(t.CHOOSE_LANGUAGE,{locale:e,saveToPlayerData:!0}),b.showNotificationScreen("Language changed to ".concat(e))}catch(e){console.error(e),b.showNotificationScreen("Failed to change language")}})),function(){return n.apply(this,arguments)})},{key:"preloadLanguageAsync",value:function(e){return new Promise((function(n,i){oe.emit(t.PRELOAD_LANGUAGE,{locale:e,onLoad:n,onError:i})}))}}]),l}(re)).prototype,"devToolsToggle",[qR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WR=KR))||WR);J._RF.pop(),J._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var SP,CP,EP,AP,TP,RP,PP,OP,IP,LP=Q.ccclass,_P=Q.property,DP=GameCore,MP=DP.Utils.Valid,NP=DP.Match.Modes,zP=n.Layout,BP=(XR=LP("UIManager"),ZR=_P(FC),JR=_P(HR),QR=_P(YT),$R=_P(kP),eP=_P(fE),tP=_P(HC),nP=_P(rR),XR((oP=D((aP=function(e){B(s,e);var n,i,a,o,r,l=F(s);function s(){var e;N(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=l.call.apply(l,[this].concat(n)),z(e,"interstitialAdIndicator",oP,x(e)),z(e,"portraitLayout",rP,x(e)),z(e,"landscapeLayout",lP,x(e)),z(e,"devTools",sP,x(e)),z(e,"comboProgressBar",uP,x(e)),z(e,"comboContainer",cP,x(e)),z(e,"uiMasks",hP,x(e)),e.uiShown=!1,e.config={},e.showDevTools=function(){e.devTools&&(e.devTools.node.active=!0)},e}return M(s,[{key:"onLoad",value:function(){this.node.scene.on(As.Events.UNLOCK_DEV_TOOLS,this.showDevTools),this.node.scene.on(oa.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(oa.RESCUE_FINISHED,this.hideRescueAnimation,this),this.node.scene.on(oa.SCORE_UPDATED,this.handleScoreUpdated,this),oe.on(t.ORIENTATION_CHANGED,this.onOrientationChanged,this),this.onOrientationChanged(Mt.getCurrentLayout())}},{key:"onDestroy",value:function(){this.node.scene.off(As.Events.UNLOCK_DEV_TOOLS,this.showDevTools),this.node.scene.off(oa.RESCUE_START,this.showRescueAnimation,this),this.node.scene.off(oa.RESCUE_FINISHED,this.hideRescueAnimation,this),this.node.scene.off(oa.SCORE_UPDATED,this.handleScoreUpdated,this),oe.off(t.ORIENTATION_CHANGED,this.onOrientationChanged,this)}},{key:"init",value:function(e){this.game=e,this.initDevTools(e),this.comboContainer.init(e.board)}},{key:"initDevTools",value:function(e){var t=this;window.addEventListener("reset-game-data",(function(){var e;null===(e=t.devTools)||void 0===e||e.handleResetData()})),this.devTools&&(this.devTools.node.active=MP.isDebugger(),this.devTools.injectGameplay(e))}},{key:"setLevelText",value:function(e){this.config.level=e,this.currentLayout.setLevelText(e)}},{key:"startCountdown",value:function(){this.comboProgressBar.resume()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume()}},{key:"setComboUI",value:function(e){this.comboContainer.getComponent(Si).changeStateFade(e,.1)}},{key:"disableLayout",value:function(){this.currentLayout.disableLayout()}},{key:"enableLayout",value:function(){this.currentLayout.enableLayout()}},{key:"updateStatus",value:function(){var e;this.currentLayout.updateStatus({score:this.game.scoreManager.getCurrentScore(),leaderData:null===(e=this.game.tournamentManager)||void 0===e?void 0:e.leaderData,items:this.game.itemManager.itemConfigs}),this.comboContainer.updateStatus()}},{key:"showRescueAnimation",value:(r=q((function*(){yield this.uiMasks.show()})),function(){return r.apply(this,arguments)})},{key:"hideRescueAnimation",value:(o=q((function*(){yield this.uiMasks.hide()})),function(){return o.apply(this,arguments)})},{key:"playExitAnimUI",value:(a=q((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.uiShown=!1,yield this.currentLayout.playExitAnimUI(e)})),function(){return a.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(i=q((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;this.uiShown=!0,yield this.currentLayout.playEntranceAnimUI(e)})),function(){return i.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.currentLayout.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.currentLayout.unHighlightCoinContainer()}},{key:"handleClickedPauseGame",value:function(){b.openScreen(w.PAUSE_SCREEN),this.node.scene.emit(oa.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){b.openScreen(w.QUIT_LEVEL_SCREEN),this.node.scene.emit(oa.GAME_PAUSE)}},{key:"items",get:function(){return this.currentLayout.items}},{key:"setInteractableItems",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=G(this.items);try{for(n.s();!(e=n.n()).done;){var i=e.value;t?void 0!==i.itemType?i.button.interactable=this.game.itemManager.canUseItem(i.itemType):console.warn("Item type is not defined"):i.button.interactable=!1}}catch(e){n.e(e)}finally{n.f()}}},{key:"onOrientationChanged",value:(n=q((function*(e){var t;e===zP.Portrait?(this.landscapeLayout.node.active=!1,this.portraitLayout.node.active=!0,this.currentLayout=this.portraitLayout):e===zP.Landscape&&(this.portraitLayout.node.active=!1,this.landscapeLayout.node.active=!0,this.currentLayout=this.landscapeLayout),this.currentLayout&&(this.currentLayout.updateStatus({level:this.config.level,score:this.game.scoreManager.getCurrentScore(),time:this.game.clockManager.getRemainingTime(),leaderData:null===(t=this.game.tournamentManager)||void 0===t?void 0:t.leaderData,items:this.game.itemManager.itemConfigs}),yield this.currentLayout.waitForInitAsync(),this.uiShown?this.playEntranceAnimUI(0):this.playExitAnimUI(0))})),function(e){return n.apply(this,arguments)})},{key:"handleScoreUpdated",value:function(e){var t;this.config.score=e,this.currentLayout.handleScoreUpdated(e),Js.getMatchMode()===NP.TOURNAMENT&&this.currentLayout.tournamentRail.handleScoreUpdated({score:e,leaderData:null===(t=this.game.tournamentManager)||void 0===t?void 0:t.leaderData})}}]),s}(re)).prototype,"interstitialAdIndicator",[ZR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rP=D(aP.prototype,"portraitLayout",[JR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lP=D(aP.prototype,"landscapeLayout",[QR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sP=D(aP.prototype,"devTools",[$R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uP=D(aP.prototype,"comboProgressBar",[eP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cP=D(aP.prototype,"comboContainer",[tP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hP=D(aP.prototype,"uiMasks",[nP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iP=aP))||iP);J._RF.pop(),J._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var FP=globalThis.game,xP=FP.player,UP=FP.ads,GP=FP.event,HP=FP.match,VP=FP.storage,qP=FP.analytics,WP=FP.monitorError,KP=FP.leaderboard,jP=GameCore,YP=jP.Events,XP=jP.Utils,ZP=XP.Time,JP=XP.Array,QP=XP.Valid,$P=jP.Configs.Gameplay,eO=jP.Match.Modes,tO=Q.ccclass,nO=Q.property,iO=[],aO={level:1,isFromLoader:!1};SP=tO("Gameplay"),CP=nO(Nh),EP=nO(Si),AP=nO(qp),SP((PP=D((RP=function(e){B(r,e);var t,n,i=F(r);function r(){var e;N(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n)),z(e,"board",PP,x(e)),z(e,"opacityToggler",OP,x(e)),z(e,"pathDraw",IP,x(e)),e.gameData=null,e.rescueTiles=[],e.isAutoPlayEnabled=!1,e.handleOpenScreen=function(t){t.screenName===S[w.GET_ITEM_SCREEN]&&e.uiManager.highlightCoinContainer()},e.handleShowUI=q((function*(){e.uiManager.updateStatus(),e.uiManager.disableLayout(),e.uiManager.setInteractableItems(!1),yield e.uiManager.playEntranceAnimUI(),e.uiManager.enableLayout(),e.uiManager.setInteractableItems(!0)})),e.handleHideUI=q((function*(){e.uiManager.disableLayout(),e.uiManager.setInteractableItems(!1),yield e.uiManager.playExitAnimUI()})),e.handleCloseScreen=function(t){t.screenName===S[w.GET_ITEM_SCREEN]&&e.uiManager.unHighlightCoinContainer()},e.handlePauseGame=function(){e.node.scene.emit(oa.PAUSE_TIME),e.node.pauseSystemEvents(!0),e.opacityToggler.changeStateFade(!1,.1),e.uiManager.setComboUI(!1),e.processCrazyGamesGameplayStop()},e.handleResumeGame=function(){var t;e.node.resumeSystemEvents(!0),e.stateManager.isPlaying()&&e.node.scene.emit(oa.RESUME_TIME),e.processCrazyGamesGameplayStart(),e.opacityToggler.changeStateFade(!0,.1),e.uiManager.setComboUI(!0),null===(t=e.guidelinesManager)||void 0===t||t.startAutoGuides()},e.handleReplayGame=q((function*(){e.handleHideHint();try{var t=Js.getMatchMode();t===eO.SINGLE&&(yield Js.finishMatchAsync()),t!==eO.CHALLENGE_FRIEND&&(yield Js.startMatchAsync()),t===eO.TOURNAMENT&&(e.scoreManager.resetTournamentStartScore(),e.setGameData({level:1}))}catch(e){console.warn("handleReplayGame",e)}e.stateManager.initialize()})),e.handleFinishGame=function(){var t;e.attemptCallCreateShortcut(),null!==(t=e.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()?(e.guidelinesManager.guideUi.guideSkipButton.active=!1,e.handleNextLevel()):e.stateManager.finish()},e.handleNextLevel=q((function*(){var t;if(e.gameData){var n=Js.getMatchMode();try{n===eO.SINGLE?yield Js.finishMatchAsync():n===eO.TOURNAMENT&&e.scoreManager.updateTournamentStartScore()}catch(e){console.warn("handleNextLevel",e)}var i=(null!==(t=e.gameData.level)&&void 0!==t?t:1)+1;e.setGameData({level:i}),n===eO.TOURNAMENT?yield Js.setMatchCustomDataAsync({level:i}):(yield Js.setMatchCustomDataAsync({level:i,score:0}),yield Js.startMatchAsync()),e.stateManager.initialize(),console.log("Next level",e.gameData.level)}})),e.handleStartOver=function(){var t=q((function*(t){var n;xP.setGameData({level:null!=t?t:1}),e.gameData=xP.getGameData(),e.stateManager.initialize(),console.info("Start over",null===(n=e.gameData)||void 0===n?void 0:n.level)}));return function(e){return t.apply(this,arguments)}}(),e.handleMaxLevel=function(){e.gameData&&(e.initData(),b.openScreen(w.CONGRATULATION_SCREEN,{level:e.gameData.level}),console.info("Max level",e.gameData.level))},e.handleExitGame=q((function*(){try{VP.setStorageData("dashboard","animateToCurrentLevel",!0),VP.setStorageData("collection","animateMapPackUnlock",!0)}catch(e){console.warn("handleExitGame",e)}})),e.handleTileClick=function(t){e.stateManager.playing(),e.board.handleTileClick(t),e.handleHideHint()},e.handleGridMatchSuccess=function(t,n){e.pathDraw.drawMatchPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)})),e.comboManager.addCombo(),e.handleAddScore(),e.effectManager.playClearEffectAt([n[0].node.worldPosition,n[1].node.worldPosition])},e.handleGridMatchFail=function(t){var n;null!==(n=e.guidelinesManager)&&void 0!==n&&n.isShowErrorPathLevel()&&e.pathDraw.drawErrorPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)}))},e.checkIfGameIsFinish=function(){0===e.board.getUncleared().length&&e.node.scene.emit(oa.GAME_FINISH)},e.handlePauseTime=function(){e.clockManager.pause(),e.uiManager.pauseTime()},e.handleResumeTime=function(){e.clockManager.resume(),e.uiManager.resumeTime()},e.handleClockTimeout=function(){e.stateManager.fail($s)},e.handleHalfTime=function(){void 0!==e.guidelinesManager&&(e.board.getUncleared().length>=e.board.getCleared().length&&e.guidelinesManager.startThunderGuide()||e.board.getBombTiles().length>0&&e.guidelinesManager.startPliersGuide())},e.handleStartRescue=function(){var t,n,i;for(l.turnDownMusic(),o.setBlockInput(!0),e.board.setIgnoreInput(!0);e.rescueTiles.length>0;){var a=e.rescueTiles.pop();null==a||a.restore()}var r=null!==(t=Js.getMatchMode())&&void 0!==t?t:void 0;qP.levelRescue(null!==(n=null===(i=e.gameData)||void 0===i?void 0:i.level)&&void 0!==n?n:1,void 0,r)},e.handleFinishRescue=function(){o.setBlockInput(!1),e.board.setIgnoreInput(!1)},e.handleBombExplode=function(){var t=q((function*(t){e.rescueTiles.push(t),e.board.setIgnoreInput(!0),o.getBlockInput()||(l.playSound(wn.BOMB_EXPLODE_1),o.setBlockInput(!0));var n=t.node.worldPosition;yield e.effectManager.createBombExplosionAt(new Oe(n.x,n.y,0)),o.setBlockInput(!1),e.stateManager.isFail()||e.stateManager.fail(eu)}));return function(e){return t.apply(this,arguments)}}(),e.handleShowHint=function(){if(!e.pathDraw.isDrawingHint){var t=e.board.getHintPath();t&&(l.playSound(wn.HINT_ITEM),e.pathDraw.drawHintPath(t,(function(t){return e.board.getAnyTileWorldPosition(t.x,t.y)})),e.board.showHint(),e.node.scene.emit(oa.REFRESH_ITEMS))}},e.handleHideHint=function(){e.pathDraw.isDrawingHint&&(e.pathDraw.clearHintPath(),e.board.hideHint(),e.node.scene.emit(oa.REFRESH_ITEMS))},e.handleAddScore=function(){var t=e.levelManager.getLevelData().level,n=e.comboManager.getCombo(),i=e.clockManager.getRemainingTime();e.scoreManager.addScore(t,n,i)},e.handleUseItem=function(){var t=q((function*(t){switch(e.stateManager.playing(),t!==d.HINT&&e.handleHideHint(),e.itemManager.setQuantity(t,e.itemManager.getQuantity(t)-1),t){case d.HINT:xh(e.board,e.pathDraw),e.node.scene.emit(oa.REFRESH_ITEMS);break;case d.PLIERS:Uh(e.board,e.effectManager),e.node.scene.emit(oa.REFRESH_ITEMS);break;case d.STORM:e.node.scene.emit(oa.HIDE_UI),e.node.scene.emit(oa.PAUSE_TIME),yield $h(e.board,e.effectManager),e.node.scene.emit(oa.RESUME_TIME),e.node.scene.emit(oa.SHOW_UI);break;case d.THUNDER:e.node.scene.emit(oa.HIDE_UI),e.node.scene.emit(oa.PAUSE_TIME),yield Wh(e.board,e.effectManager),e.board.getUncleared().length>0&&(e.node.scene.emit(oa.RESUME_TIME),e.node.scene.emit(oa.SHOW_UI))}}));return function(e){return t.apply(this,arguments)}}(),e.handleAutoPlay=function(){e.isAutoPlayEnabled?e.disableAutoPlay():e.enableAutoPlay()},e.enableAutoPlay=function(){e.isAutoPlayEnabled=!0,e.schedule(e.autoPlay,.5)},e.disableAutoPlay=function(){e.isAutoPlayEnabled=!1,e.unschedule(e.autoPlay)},e.autoPlay=function(){if(e.stateManager.isReady()||e.stateManager.isPlaying()){var t=e.board.getHintPath();if(!t)throw new Error("No path found");var n=t[0],i=t.slice(-1)[0];if(void 0!==n&&void 0!==i){var a=n.a,o=i.b,r=e.board.getTileAt(a.x,a.y),l=e.board.getTileAt(o.x,o.y);if(!r||!l)throw new Error("Tile is null");r.onClick(),l.onClick()}else{var s=new Error("No path found");if(QP.isDebugger())throw s;null==WP||WP.sendException(s)}}},e.handleAddStars=function(t){var n=xP.getGameData();if(!n)return Promise.resolve([]);xP.setGameData({stars:n.stars+1});var i=t.startAnimationAt;i&&e.effectManager.playStarEffectAt(i)},e.handleChallengeFriends=q((function*(){try{var t,n,i;b.showLoadingScreen();var a=e.board.generateFenFromCurrentLevel(),o=(null!==(t=xP.getGameData())&&void 0!==t?t:{}).level,r=void 0===o?1:o;r=Math.max(1,r);var l=null!==(n=null===(i=e.gameData)||void 0===i?void 0:i.levelData)&&void 0!==n?n:{},s=l.mode,u=void 0===s?"":s,c=l.rules,h=void 0===c?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:c,p=l.time,d=void 0===p?0:p;yield HP.context.choose.processAsync({playerId:xP.getPlayerId(),fallbackSingleMode:!1,extraData:{level:r,fen:a,gravity:u,rules:h,time:d}}),Js.getMatchMode()===eO.TOURNAMENT&&(yield e.tryInitTournamentMode(!0)),b.closeLoadingScreen(),e.node.scene.emit(oa.UPDATE_MUSIC),e.node.scene.emit(oa.GAME_RESUME),e.node.scene.emit(oa.GAME_REPLAY,{level:r})}catch(t){if(console.warn("Unable to invite friends",t),b.closeLoadingScreen(),b.showNotificationScreenWithLocalizedKey("error.tryLater"),!(t instanceof Error))return;null==WP||WP.sendException(t),e.node.scene.emit(oa.GAME_RESUME),e.node.scene.emit(oa.SHOW_UI)}})),e.handleAdShow=function(t){var n=t.placementId;n&&-1!==iO.indexOf(n)&&(iO.splice(iO.indexOf(n),1),UP.hideBannerAdAsync(n).catch((function(){})),0===iO.length&&GP.off(YP.AD_SHOWING,e.handleAdShow))},e.handleAddItem=function(){var t=q((function*(t){var n=t.animate,i=t.item,a=t.quantity,o=JP.search(e.uiManager.items,(function(e){return e.itemType===i}));if(void 0!==o){var r=e.itemManager.getQuantity(i)+a;if(e.itemManager.saveQuantity(i,r),e.uiManager.setInteractableItems(!1),n){var l=n.startWorldPosition;yield e.effectManager.playItemAddAnimation(new Oe(l.x,l.y),o)}e.itemManager.setQuantity(i,r,!0),e.uiManager.setInteractableItems(!0)}else console.warn("Item ".concat(i," not found"))}));return function(e){return t.apply(this,arguments)}}(),e}return M(r,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function(){zs.init()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initClockManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager(),this.initPathDraw()}},{key:"initUIManager",value:function(){var e;this.uiManager=null===(e=this.node.parent)||void 0===e?void 0:e.getComponentInChildren(BP),this.uiManager.init(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(xS)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(bC)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(tu)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(jb)}},{key:"initItemManager",value:function(){this.itemManager=this.getComponent(vS),this.itemManager.init(this)}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(sd),this.comboManager.init()}},{key:"initClockManager",value:function(){this.clockManager=this.getComponent(Yp),this.clockManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(HS),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){$P.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(uS),this.guidelinesManager.init(this))}},{key:"initPathDraw",value:function(){this.pathDraw.init(this.board)}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){iO=[],GP.off(YP.AD_SHOWING,this.handleAdShow),GP.clear(YP.OPENING_SCREEN),GP.clear(YP.CLOSING_SCREEN),GP.on(YP.OPENING_SCREEN,this.handleOpenScreen),GP.on(YP.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(oa.SHOW_UI,this.handleShowUI),this.node.scene.on(oa.HIDE_UI,this.handleHideUI),this.node.scene.on(oa.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(oa.GAME_RESUME,this.handleResumeGame),this.node.scene.on(oa.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(oa.GAME_FINISH,this.handleFinishGame),this.node.scene.on(oa.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(oa.START_OVER,this.handleStartOver),this.node.scene.on(oa.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(oa.GAME_EXIT,this.handleExitGame),this.node.scene.on(oa.TILE_CLICK,this.handleTileClick),this.node.scene.on(oa.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(oa.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(oa.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(oa.RESUME_TIME,this.handleResumeTime),this.node.scene.on(oa.TIME_OUT,this.handleClockTimeout),this.node.scene.on(oa.HALF_TIME,this.handleHalfTime),this.node.scene.on(oa.RESCUE_START,this.handleStartRescue),this.node.scene.on(oa.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(oa.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(oa.SHOW_HINT,this.handleShowHint),this.node.scene.on(oa.ADD_SCORE,this.handleAddScore),this.node.scene.on(oa.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(oa.USE_ITEM,this.handleUseItem),this.node.scene.on(oa.ADD_ITEM,this.handleAddItem),this.node.scene.on(oa.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(oa.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(oa.CHALLENGE_FRIENDS,this.handleChallengeFriends)}},{key:"start",value:(n=q((function*(){this.initDataFirstTime(),yield this.tryInitTournamentMode(),this.initGame()})),function(){return n.apply(this,arguments)})},{key:"initDataFirstTime",value:function(){var e,t,n=this.getSceneData(),i=(null!=n?n:{}).isFromLoader,a=void 0!==i&&i,o=(null!=n?n:{}).level;void 0===o&&(o=Js.getMatchMode()===eO.TOURNAMENT?1:null!==(e=null===(t=xP.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:0);this.initData(),this.setGameData({level:o,isFromLoader:a})}},{key:"initData",value:function(){var e,t=this.getSceneData(),n=(null!=t?t:{}).isFromLoader,i=void 0!==n&&n,a=null!==(e=xP.getGameData())&&void 0!==e?e:{},o=a.level,r=void 0===o?1:o,l=a.items;0===r&&i&&l?(l.hint=2,l.thunder=1,l.storm=1,l.pliers=0,xP.setGameData({items:l,coins:500,lastRewardedItems:Date.now()}),this.node.scene.emit(oa.ADD_COINS,{coins:500,playSound:!1})):l&&this.checkItemsRewardable()&&(l.hint<5&&(l.hint+=1),l.thunder<5&&(l.thunder+=1),l.storm<5&&(l.storm+=1),l.pliers<5&&(l.pliers+=1),xP.setGameData({items:l,lastRewardedItems:Date.now()})),this.setGameData(U(U({},aO),{},{level:r}))}},{key:"checkItemsRewardable",value:function(){var e,t=(null!==(e=xP.getGameData())&&void 0!==e?e:{}).lastRewardedItems,n=void 0===t?0:t;return!ZP.isToday(n)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"tryInitTournamentMode",value:(t=q((function*(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=Js.getMatchMode();if(i===eO.TOURNAMENT){var a=null!==(e=Js.getMatchCustomData())&&void 0!==e?e:{},o=a.leaderboardId,r=a.tournamentId;if(o&&r){yield m.requestTournamentDataAsync();var l=m.getTournamentDataById(r);if(l){var s=l.payload.themeId;this.setGameData({themeId:s});var u=KP.getLeaderboardName(o);if(u){var c=null;if(null!==(t=this.gameData)&&void 0!==t&&t.isFromLoader||n?c=yield Is.getAllLeaderboardAsync(o):(yield Is.waitForLeaderboardFinishAsync(u),c=KP.getLeaderboard(u)),c){this.tournamentManager=this.getComponent(_C),this.tournamentManager.init(c);var h=xP.getPlayerId(),p=c.leaders[h];if(!p){var d=yield KP.getLeadersByPlayerIdsAsync(u,[h]);if(0===d.length)return;p=d[0]}if(p){var y=p,v=y.score;VP.setStorageData("tournament","previousScore",v)}}}}}}})),function(){return t.apply(this,arguments)})},{key:"setGameData",value:function(e){var t,n,i,a=null!==(t=null!==(n=e.level)&&void 0!==n?n:null===(i=this.gameData)||void 0===i?void 0:i.level)&&void 0!==t?t:1;this.gameData=U(U(U({},this.gameData),e),{},{level:a})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return C.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var e,t=null!==(e=this.getGameData())&&void 0!==e?e:{},n=t.level,i=void 0===n?0:n,a=t.nextLevelCount;i<2||(void 0===a?0:a)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("checkAndCreateShortcutAsync",e)}))}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),r}(re)).prototype,"board",[CP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OP=D(RP.prototype,"opacityToggler",[EP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IP=D(RP.prototype,"pathDraw",[AP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TP=RP));J._RF.pop(),J._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var oO=function(e){return e[e.STAR_CHEST=0]="STAR_CHEST",e[e.BALLOON=1]="BALLOON",e}(oO||{});le(oO),J._RF.pop(),J._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var rO,lO=function(e){return e.WORLD_TAB_SELECTED="world-tab-selected",e.FRIENDS_TAB_SELECTED="friends-tab-selected",e}(lO||{}),sO="#AE4212",uO="#3D5172",cO="#92200C",hO="#8F5542",pO="#8A4733",dO="#3e7110",yO="#3e7110";J._RF.pop(),J._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),J._RF.pop(),J._RF.push({},"2737dY5lxxEY6mKDXeUQJUc","ThemeLocaleKeys",void 0);var vO,fO=(j(rO={},E.SUMMER,"theme.summer"),j(rO,E.AUTUMN,"theme.autumn"),j(rO,E.WINTER,"theme.winter"),j(rO,E.SPRING_FESTIVAL,"theme.springFestival"),j(rO,E.TREE_PLANTING_FESTIVAL,"theme.treePlantingFestival"),j(rO,E.BLUE_SEA_FESTIVAL,"theme.blueSeaFestival"),j(rO,E.MUSIC_FESTIVAL,"theme.musicFestival"),j(rO,E.HARVEST_FESTIVAL,"theme.harvestFestival"),j(rO,E.FOOD_FESTIVAL,"theme.foodFestival"),j(rO,E.SNOW_FESTIVAL,"theme.snowFestival"),j(rO,E.LIGHT_FESTIVAL,"theme.lightFestival"),j(rO,E.PEACE_FESTIVAL,"theme.peaceFestival"),j(rO,E.FLOWER_FESTIVAL,"theme.flowerFestival"),j(rO,E.STREET_FESTIVAL,"theme.streetFestival"),j(rO,E.COLOR_GARDEN,"theme.colorGarden"),j(rO,E.COLOR_FESTIVAL,"theme.colorFestival"),j(rO,E.NATURE_SUMMER,"theme.natureSummer"),j(rO,E.SNOW_MOUNTAIN,"theme.snowMountain"),j(rO,E.ICE_FESTIVAL,"theme.iceFestival"),j(rO,E.GREEN_GRASS_FESTIVAL,"theme.greenGrassFestival"),j(rO,E.COMMUNITY_FESTIVAL,"theme.communityFestival"),j(rO,E.WATER_FESTIVAL,"theme.waterFestival"),j(rO,E.ANIMAL_FESTIVAL,"theme.animalFestival"),j(rO,E.LOST_FESTIVAL,"theme.lostFestival"),j(rO,E.HALLOWEEN_FESTIVAL,"theme.halloweenFestival"),j(rO,E.SNOW_MUSIC_FESTIVAL,"theme.snowMusicFestival"),j(rO,E.CHRISTMAS,"theme.christmas"),j(rO,E.SPRING_FLOWER_FESTIVAL,"theme.springFlowerFestival"),j(rO,E.TET_HOLIDAY,"theme.tetHoliday"),j(rO,E.SEA_FESTIVAL,"theme.seaFestival"),j(rO,E.FIREWORK_FESTIVAL,"theme.fireworkFestival"),j(rO,E.HALLOWEEN_HORROR,"theme.halloweenHorror"),j(rO,E.MID_AUTUMN,"theme.midAutumn"),j(rO,E.CHRISTMAS_SWEET,"theme.christmasSweet"),j(rO,E.NEW_YEAR_COUNTDOWN,"theme.newYearCountdown"),j(rO,E.HAPPY_NEW_YEAR,"theme.happyNewYear"),rO);J._RF.pop(),J._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),J._RF.pop(),J._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),J._RF.pop(),J._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var gO;(0,Q.ccclass)("HintItem")(vO=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"itemType",get:function(){return d.HINT}}]),n}(RE));J._RF.pop(),J._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var mO;(0,Q.ccclass)("PliersItem")(gO=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"itemType",get:function(){return d.PLIERS}}]),n}(RE));J._RF.pop(),J._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var bO;(0,Q.ccclass)("StormItem")(mO=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"itemType",get:function(){return d.STORM}}]),n}(RE));J._RF.pop(),J._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var wO,kO,SO,CO,EO,AO,TO,RO,PO,OO,IO,LO,_O,DO,MO,NO,zO,BO;(0,Q.ccclass)("ThunderItem")(bO=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"itemType",get:function(){return d.THUNDER}}]),n}(RE));J._RF.pop(),J._RF.push({},"28c5eNXZLBE+50Dno043fmy","useTornadoThunderCombined",void 0),J._RF.pop(),J._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var FO,xO,UO,GO,HO,VO,qO,WO,KO,jO,YO,XO=Q.ccclass,ZO=Q.property,JO=(wO=XO("Coin"),kO=ZO(Ee),SO=ZO(Be),CO=ZO(nt),EO=ZO(nt),AO=a.onlyRunInLifeCycle,TO=a.onlyRunInLifeCycle,RO=a.onlyRunInLifeCycle,PO=a.onlyRunInLifeCycle,OO=a.onlyRunInLifeCycleAsync,IO=a.onlyRunInLifeCycleAsync,LO=a.onlyRunInLifeCycle,wO((MO=D((DO=function(t){B(o,t);var n,i=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n)),z(e,"emittingParticles",MO,x(e)),z(e,"animation",NO,x(e)),z(e,"spin",zO,x(e)),z(e,"rest",BO,x(e)),e}return M(o,[{key:"__preload",value:function(){a.lazyValidateProperties(this)}},{key:"resetDisabled",value:function(){this.stopParticles(),this.stopAnimation(),this.hide(),this.node.active=!1,this.node.setPosition(0,0,this.node.position.z)}},{key:"hide",value:function(){this.node.setScale(Oe.ZERO)}},{key:"stopParticles",value:function(){this.emittingParticles.stopSystem()}},{key:"playTrailParticles",value:function(){this.emittingParticles.resetSystem()}},{key:"playSpinAnimationAfterDelay",value:(n=q((function*(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;t>0&&(yield e.waitTweenAsync(t)),yield this.playSpinAnimation(n)})),function(){return n.apply(this,arguments)})},{key:"playSpinAnimation",value:function(t){return e.runAnimationAsync(this.animation,this.spin.name,t)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),o}(re)).prototype,"emittingParticles",[kO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NO=D(DO.prototype,"animation",[SO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zO=D(DO.prototype,"spin",[CO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BO=D(DO.prototype,"rest",[EO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(DO.prototype,"resetDisabled",[AO],Object.getOwnPropertyDescriptor(DO.prototype,"resetDisabled"),DO.prototype),D(DO.prototype,"hide",[TO],Object.getOwnPropertyDescriptor(DO.prototype,"hide"),DO.prototype),D(DO.prototype,"stopParticles",[RO],Object.getOwnPropertyDescriptor(DO.prototype,"stopParticles"),DO.prototype),D(DO.prototype,"playTrailParticles",[PO],Object.getOwnPropertyDescriptor(DO.prototype,"playTrailParticles"),DO.prototype),D(DO.prototype,"playSpinAnimationAfterDelay",[OO],Object.getOwnPropertyDescriptor(DO.prototype,"playSpinAnimationAfterDelay"),DO.prototype),D(DO.prototype,"playSpinAnimation",[IO],Object.getOwnPropertyDescriptor(DO.prototype,"playSpinAnimation"),DO.prototype),D(DO.prototype,"stopAnimation",[LO],Object.getOwnPropertyDescriptor(DO.prototype,"stopAnimation"),DO.prototype),_O=DO))||_O);J._RF.pop(),J._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var QO,$O,eI,tI,nI,iI,aI,oI,rI,lI,sI,uI,cI,hI,pI,dI,yI,vI,fI=Q.ccclass,gI=Q.property,mI=Oe.ZERO.clone().add3f(0,-100,0),bI=Oe.ZERO.clone().add3f(0,100,0),wI=GameCore.Utils.Number,kI=(FO=fI("CoinTextPopup"),xO=gI(we),UO=gI(he),GO=a.onlyRunInLifeCycle,HO=a.onlyRunInLifeCycle,VO=a.onlyRunInLifeCycleAsync,qO=a.onlyRunInLifeCycleAsync,FO((jO=D((KO=function(t){B(l,t);var n,i,o,r=F(l);function l(){var e;N(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),z(e,"label",jO,x(e)),z(e,"uiOpacity",YO,x(e)),e}return M(l,[{key:"__preload",value:function(){a.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(o=q((function*(e,t){this.enableNode(),this.initializePopup(e),yield this.showTextPopupAnimation(t),yield this.hidePopup(),this.disableNode()})),function(e,t){return o.apply(this,arguments)})},{key:"enableNode",value:function(){this.node.active=!0}},{key:"disableNode",value:function(){this.node.active=!1}},{key:"initializePopup",value:function(e){var t=wI.getShortNumber(e,3);this.label.string=t,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(mI)}},{key:"hidePopup",value:(i=q((function*(){this.node.setScale(Oe.ONE),this.node.setPosition(bI),yield e.runTweenAsync(ie(this.uiOpacity).to(.5,{opacity:0}))})),function(){return i.apply(this,arguments)})},{key:"showTextPopupAnimation",value:(n=q((function*(t){yield Promise.all([e.runTweenAsync(ie(this.node).to(1.5,{position:bI},{easing:"sineOut"}),t),e.runTweenAsync(ie(this.node).to(.5,{scale:Oe.ONE},{easing:"backOut"}),t)])})),function(e){return n.apply(this,arguments)})}]),l}(re)).prototype,"label",[xO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YO=D(KO.prototype,"uiOpacity",[UO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(KO.prototype,"disableNode",[GO],Object.getOwnPropertyDescriptor(KO.prototype,"disableNode"),KO.prototype),D(KO.prototype,"initializePopup",[HO],Object.getOwnPropertyDescriptor(KO.prototype,"initializePopup"),KO.prototype),D(KO.prototype,"hidePopup",[VO],Object.getOwnPropertyDescriptor(KO.prototype,"hidePopup"),KO.prototype),D(KO.prototype,"showTextPopupAnimation",[qO],Object.getOwnPropertyDescriptor(KO.prototype,"showTextPopupAnimation"),KO.prototype),WO=KO))||WO);J._RF.pop(),J._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var SI,CI=Q.ccclass,EI=Q.disallowMultiple,AI=Q.property,TI=globalThis.game,RI=TI.player,PI=TI.monitorError,OI=999999999,II=10,LI=1,_I=1,DI=(QO=CI("CoinManager"),$O=a.required(),eI=AI(Ve),tI=a.required(),nI=AI(Ve),iI=a.required(),aI=AI(ge),oI=a.onlyRunInLifeCycleAsync,rI=a.onlyRunInLifeCycleAsync,lI=a.onlyRunInLifeCycleAsync,sI=a.onlyRunInLifeCycleAsync,uI=a.onlyRunInLifeCycleAsync,cI=a.onlyRunInLifeCycleAsync,QO(hI=EI((dI=D((pI=function(t){B(c,t);var n,i,o,s,u=F(c);function c(){var e;N(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=u.call.apply(u,[this].concat(n))).coins=0,z(e,"coinPrefab",dI,x(e)),z(e,"coinTextPopup",yI,x(e)),z(e,"coinAnimContainer",vI,x(e)),e.coinObjects=[],e}return M(c,[{key:"onLoad",value:function(){a.validateRequiredProperties(this),this.getCoinsFromPlayerData(),this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(){this.updateCoins({coins:this.coins})}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(oa.ADD_COINS,this.addCoins,this),this.node.scene.on(oa.REMOVE_COINS,this.removeCoins,this),this.node.scene.on(oa.ABORT_COIN_ANIMATION,this.abortCoinAnimation,this)}},{key:"prepareCoinCollection",value:function(){for(var e=0;e<II;e++){var t=Ge(this.coinPrefab);t.setParent(this.coinAnimContainer),t.setPosition(0,0),t.active=!1,this.coinObjects.push(t.getComponent(JO))}}},{key:"prepareCoinTextPopup",value:function(){var e=Ge(this.coinTextPopup);e.setParent(this.node),e.active=!1,this.coinTextPopupNode=e.getComponent(kI)}},{key:"handleCollectionAnim",value:(s=q((function*(t,n,i,a,o){var r=this;if(n){var s=this.coinObjects.slice(0,this.getShortAmount(t));if(0===s.length)return console.warn("Requested coins amount is ".concat(t,". Shortened to ").concat(this.getShortAmount(t),". No coin objects was found to animate collection.")),void(null==PI||PI.sendException(new Error("Requested coins amount is ".concat(t,". Shortened to ").concat(this.getShortAmount(t),". No coin objects was found to animate collection.")),{coins:t,animatedCoins:s.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!n,coinCollectionCount:this.coinObjects.length}));l.playSound(wn.COLLECT_STOCK_COINS),yield Promise.all([this.playCoinFlyAndexplodeAnimation(n,s,i,a,o),e.waitTweenAsync(i+a/2,o).then((function(){return r.animateCoinTextPopup(t,o)}))]),o.abort()}else console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played")})),function(e,t,n,i,a){return s.apply(this,arguments)})},{key:"playCoinFlyAndexplodeAnimation",value:(o=q((function*(t,n,i,a,o){var r=this,l=i+a;yield Promise.all([].concat(K(n.flatMap((function(n){n.node.active=!0,n.stopParticles();var l=[0,.5*Math.min(i,a)],s=Ue.apply(void 0,l),u=i-s,c=a+s;return[r.animateCoinExplode(n.node,u,o),e.waitTweenAsync(u,o).then((function(){return r.animateCoinFlyBack(t,n,c,o)}))]}))),[e.waitTweenAsync(l,o).then((function(){return t.emitExplodeEffect(o)}))]))})),function(e,t,n,i,a){return o.apply(this,arguments)})},{key:"animateCoinTextPopup",value:function(e,t){return this.coinTextPopupNode.show(e,t)}},{key:"animateCoinFlyBack",value:(i=q((function*(t,n,i,a){var o=n.node.worldPosition.clone(),r=Oe.ZERO.clone(),l=t.getCoinIconWorldScale();yield e.runTweenAsync(ie(n.node).to(i,{scale:l},{onStart:function(){n.playSpinAnimationAfterDelay(0,a),n.playTrailParticles()},onUpdate:function(e,i){if(void 0!==i){var a=ce.cubicIn(i),l=t.getCoinIconWorldPosition();n.node.worldPosition=Oe.lerp(r,o,l,a)}},onComplete:function(){n.emittingParticles.stopSystem(),n.stopAnimation(),n.hide()}}),a),yield e.waitTweenAsync(1,a),n.resetDisabled()})),function(e,t,n,a){return i.apply(this,arguments)})},{key:"animateCoinExplode",value:(n=q((function*(t,n,i){var a=[-200,200],o=[-200,200],r=Ue(a[0],a[1]),l=Ue(o[0],o[1]);t.setPosition(0,0,t.position.z),t.setScale(Oe.ZERO);var s=new Oe(r,l,t.position.z);yield Promise.all([e.runTweenAsync(ie(t).delay(.1*n).to(.8*n,{scale:Oe.ONE},{easing:"elasticOut"}),i),e.runTweenAsync(ie(t).to(n,{position:s},{easing:"circOut"}),i)])})),function(e,t,i){return n.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var e=RI.getGameData();this.coins=e?e.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(e){var t,n;if(this.coins>OI&&(this.coins=OI),e.coins!==this.coins){var i=Math.max(0,e.coins-this.coins);this.coins=e.coins,RI.setGameData({coins:this.coins});var a=e.collectionAnimation;null===(t=this.collectionAnimSignal)||void 0===t||t.abort();var o=new r;if(this.collectionAnimSignal=o,null==a||null===(n=a.signal)||void 0===n||n.chain(o),void 0===a||a.animateTextOnly)this.node.scene.emit(oa.COIN_CHANGED,U(U({},e),{},{collectionAnimation:{animateTextOnly:!0,signal:null==a?void 0:a.signal}}));else{var l=a.floatDuration,s=void 0===l?LI:l,u=a.flyDuration,c=void 0===u?_I:u,h=a.target,p=void 0===h?this.targetContainer:h;this.collectionAnimSignal=o,this.targetContainer=p;var d=U(U({},e),{},{collectionAnimation:{floatDuration:s,flyDuration:c,animateTextOnly:!1,signal:o,target:p}});this.node.scene.emit(oa.COIN_CHANGED,d),this.handleCollectionAnim(i,this.targetContainer,s,c,o)}}}},{key:"addCoins",value:function(e){this.updateCoins(U(U({},e),{},{coins:this.coins+e.coins}))}},{key:"removeCoins",value:function(e){this.coins<e.coins?this.node.scene.emit(oa.REMOVE_COINS_FAILED):(this.updateCoins(U(U({},e),{},{coins:this.coins-e.coins})),this.node.scene.emit(oa.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(oa.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(e){return Math.min(e,II)}},{key:"abortCoinAnimation",value:function(){var e;null===(e=this.collectionAnimSignal)||void 0===e||e.abort()}},{key:"untilFinishesCollectAnim",value:function(){return void 0===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(e){this.targetContainer=e}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var e;null===(e=this.collectionAnimSignal)||void 0===e||e.abort()}}]),c}(re)).prototype,"coinPrefab",[$O,eI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yI=D(pI.prototype,"coinTextPopup",[tI,nI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vI=D(pI.prototype,"coinAnimContainer",[iI,aI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(pI.prototype,"handleCollectionAnim",[oI],Object.getOwnPropertyDescriptor(pI.prototype,"handleCollectionAnim"),pI.prototype),D(pI.prototype,"playCoinFlyAndexplodeAnimation",[rI],Object.getOwnPropertyDescriptor(pI.prototype,"playCoinFlyAndexplodeAnimation"),pI.prototype),D(pI.prototype,"animateCoinTextPopup",[lI],Object.getOwnPropertyDescriptor(pI.prototype,"animateCoinTextPopup"),pI.prototype),D(pI.prototype,"animateCoinFlyBack",[sI],Object.getOwnPropertyDescriptor(pI.prototype,"animateCoinFlyBack"),pI.prototype),D(pI.prototype,"animateCoinExplode",[uI],Object.getOwnPropertyDescriptor(pI.prototype,"animateCoinExplode"),pI.prototype),D(pI.prototype,"untilFinishesCollectAnim",[cI],Object.getOwnPropertyDescriptor(pI.prototype,"untilFinishesCollectAnim"),pI.prototype),hI=pI))||hI)||hI);J._RF.pop(),J._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),J._RF.pop(),J._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),J._RF.pop(),J._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),J._RF.pop(),J._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),J._RF.pop(),J._RF.push({},"c20acgKcuRFP6+Am/XjOFeP","ParticleSystem2DExtra",void 0);var MI,NI=Q.ccclass,zI=Q.disallowMultiple,BI=Q.executeInEditMode,FI=Q.requireComponent,xI=NI("ParticleSystem2DExtra")(SI=BI(!0)(SI=zI(!0)(SI=FI(Ee)(SI=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).emitParticle=function(t){return function(n){t(n);var i=e.particleSystem._simulator.particles.length,a=e.particleSystem._simulator.particles[i-1];e.initParticle(a)}},e.step=function(t){return function(n){for(var i=e.particleSystem._simulator.particles,a=0;a<i.length;a++){var o=i[a];e.updateParticle(o,n)}t(n)}},e}return M(n,[{key:"__preload",value:function(){this.particleSystem=this.getComponent(Ee),this.validateRequiredComponents(),this.overrideFunctions()}},{key:"overrideFunctions",value:function(){var e=this.particleSystem._simulator.emitParticle.bind(this.particleSystem._simulator);this.particleSystem._simulator.emitParticle=this.emitParticle(e);var t=this.particleSystem._simulator.step.bind(this.particleSystem._simulator);this.particleSystem._simulator.step=this.step(t)}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}}]),n}(re))||SI)||SI)||SI)||SI;J._RF.pop(),J._RF.push({},"664feJL84ZOTaM99dgWY4x0","ExampleParticleSystem2DExtra",void 0);var UI;(0,Q.ccclass)("ExampleParticleSystem2DExtra")(MI=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"initParticle",value:function(e){e.maxSize=Ae.randomRange(.25,1)*e.size,e.size=0,e.deltaSize=0,e.cycleDuration=Ae.randomRange(.4,.6),e.life=e.timeToLive,this.setInitPosition(e.pos)}},{key:"updateParticle",value:function(e,t){this.updateScale(e)}},{key:"setInitPosition",value:function(e){var t=e.x,n=e.y;return e.x=t+Ae.randomRange(-350,350),e.y=n+Ae.randomRange(-350,350),e}},{key:"updateScale",value:function(e){var t=1-(e.life-e.timeToLive)%e.cycleDuration/e.cycleDuration;e.size=e.maxSize*Math.sin(t*Math.PI)}}]),n}(xI));J._RF.pop(),J._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var GI,HI,VI,qI,WI,KI,jI,YI,XI,ZI,JI,QI=Q.ccclass,$I=Q.disallowMultiple,eL=GameCore,tL=eL.Events,nL=eL.Configs,iL=eL.Utils.Valid,aL=globalThis.game,oL=aL.ads,rL=aL.player,lL=aL.event;QI("BootScene")(UI=$I(UI=function(e){B(i,e);var t,n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).processWhenGameSdkStarted=function(){e.setupGameData(),e.processPreloadAssets(),e.sendMsGamesDailyNotification()},e.handlePauseAudio=function(){lL.on(tL.VISIBILITY_HIDDEN,e.handleMuteAudio),lL.on(tL.VISIBILITY_VISIBLE,e.handleUnMuteAudio)},e.handleMuteAudio=function(){l.muteAudio(!0)},e.handleUnMuteAudio=function(){oL.isAdFullSizeShowing()||l.muteAudio(!1)},e}return M(i,[{key:"__preload",value:function(){this.listenEvents(),this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart()}},{key:"onLoad",value:function(){this.handlePauseAudio(),nL.Core.StartSDKAfterLoadGame||b.showLoadingFullScreen(A.BOOT_SCENE)}},{key:"start",value:function(){this.processCrazyGamesLoadingStop()}},{key:"listenEvents",value:function(){lL.catchUp(tL.GAME_SDK_STARTED,this.processWhenGameSdkStarted)}},{key:"setupGameData",value:function(){var e=rL.getGameData();if(e){var t=e.totalLevel,n=Math.max(t,g),i=U(U({},e),{},{totalLevel:n});rL.setGameData(i)}}},{key:"processPreloadAssets",value:(t=q((function*(){try{yield this.loadCurrentPlayerTheme()}catch(e){console.error("loadCurrentPlayerTheme",e)}})),function(){return t.apply(this,arguments)})},{key:"loadCurrentPlayerTheme",value:function(){var e=Ls.mapOrder,t=e[0];if(iL.isObject(t)){var n=rL.getGameData(),i=null==n?void 0:n.level;if(!iL.isNumber(i))return o.loadThemeAsync(t.theme);var a,r=G(e);try{for(r.s();!(a=r.n()).done;){var l=a.value;if((i-=l.levelCount)<=0){t=l;break}}}catch(e){r.e(e)}finally{r.f()}return o.loadThemeAsync(t.theme)}}},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}},{key:"sendMsGamesDailyNotification",value:function(){var e=GameSDK.extra;"sendDailyNotificationAsync"in e&&e.sendDailyNotificationAsync()}}]),i}(re))||UI);J._RF.pop(),J._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var sL,uL,cL,hL,pL,dL,yL,vL,fL,gL,mL,bL,wL=Q.ccclass,kL=Q.property;GI=wL("RigidBodyObject"),HI=kL(te),VI=kL(Pe),qI=kL(te),WI=kL(ye),GI((YI=D((jI=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"gravityScale",YI,x(e)),z(e,"linearVelocity",XI,x(e)),z(e,"bounce",ZI,x(e)),z(e,"simulate",JI,x(e)),e}return M(n,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(it).getComponent($),this.uiTransform=this.node.getComponent($)}},{key:"update",value:function(e){if(this.simulate){this.applyGravity();var t=this.node.worldPosition.clone();t.add(new Oe(this.linearVelocity.x*e,this.linearVelocity.y*e,0)),t=this.applyBounce(t),this.node.setWorldPosition(t)}}},{key:"applyForce",value:function(e){this.linearVelocity.add(e)}},{key:"applyGravity",value:function(){var e=new Pe(0,-9.8*this.gravityScale);this.applyForce(e)}},{key:"applyBounce",value:function(e){var t=this.uiTransform.getBoundingBoxToWorld();t.yMin<0&&(e.y=t.height/2,this.linearVelocity.y*=-this.bounce),t.xMin<0&&(e.x=t.width/2,this.linearVelocity.x*=-1);var n=this.canvas.width;return t.xMax>n&&(e.x=n-t.width/2,this.linearVelocity.x*=-1),e}}]),n}(re)).prototype,"gravityScale",[HI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),XI=D(jI.prototype,"linearVelocity",[VI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Pe(0,0)}}),ZI=D(jI.prototype,"bounce",[qI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JI=D(jI.prototype,"simulate",[WI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KI=jI));J._RF.pop(),J._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var SL,CL,EL,AL,TL,RL,PL,OL,IL,LL,_L,DL,ML,NL,zL,BL,FL=Q.ccclass,xL=Q.property,UL=Q.disallowMultiple,GL=function(){},HL=(sL=FL("AnimSkipOverlay"),uL=xL(he),cL=xL(he),hL=xL(ve),pL=a.onlyRunInLifeCycleAsync,dL=a.onlyRunInLifeCycleAsync,yL=a.onlyRunInLifeCycleAsync,sL(vL=UL((gL=D((fL=function(n){B(l,n);var i,o,r=F(l);function l(){var e;N(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),z(e,"containerUIOpacity",gL,x(e)),z(e,"maskUIOpacity",mL,x(e)),z(e,"skipButton",bL,x(e)),e.isOpened=!1,e.currentCallback=GL,e}return M(l,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"open",value:(o=q((function*(e){this.containerUIOpacity.node.active=!0;var n=e.onSkip,i=e.opacity,a=void 0===i?255:i,o=e.transitionDuration,r=void 0===o?.2:o;this.maskUIOpacity.opacity=a,yield this.animateUIOpacity(0,255,r),this.currentCallback=n,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(t.OPENED_SKIP_OVERLAY,e)})),function(e){return o.apply(this,arguments)})},{key:"close",value:(i=q((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.skipButton.interactable=!1,this.currentCallback=GL,yield this.animateUIOpacity(255,0,e),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(t.CLOSED_SKIP_OVERLAY)})),function(){return i.apply(this,arguments)})},{key:"animateUIOpacity",value:function(t,n,i){return this.containerUIOpacity.opacity=t,e.runTweenAsync(ie(this.containerUIOpacity).to(i,{opacity:n}))}},{key:"untilClosed",value:function(){var e=this;return!1===this.isOpened?Promise.resolve():new Promise((function(n){e.node.scene.once(t.CLOSED_SKIP_OVERLAY,n)}))}}]),l}(re)).prototype,"containerUIOpacity",[uL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mL=D(fL.prototype,"maskUIOpacity",[cL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bL=D(fL.prototype,"skipButton",[hL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(fL.prototype,"open",[pL],Object.getOwnPropertyDescriptor(fL.prototype,"open"),fL.prototype),D(fL.prototype,"close",[dL],Object.getOwnPropertyDescriptor(fL.prototype,"close"),fL.prototype),D(fL.prototype,"untilClosed",[yL],Object.getOwnPropertyDescriptor(fL.prototype,"untilClosed"),fL.prototype),vL=fL))||vL)||vL);J._RF.pop(),J._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var VL,qL,WL,KL,jL,YL,XL,ZL,JL,QL=Q.ccclass,$L=Q.property,e_=GameCore.Utils.Number,t_=(SL=QL("CoinContainer"),CL=$L(we),EL=$L(se),AL=$L(he),TL=$L(Ee),RL=a.onlyRunInLifeCycle,PL=a.onlyRunInLifeCycleAsync,OL=a.onlyRunInLifeCycleAsync,IL=a.onlyRunInLifeCycle,LL=a.onlyRunInLifeCycle,SL((ML=D((DL=function(t){B(u,t);var n,i,o,s=F(u);function u(){var e;N(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),z(e,"coinLabel",ML,x(e)),z(e,"coinIcon",NL,x(e)),z(e,"explosionCircle",zL,x(e)),z(e,"explosionParticles",BL,x(e)),e.currentCoin=0,e}return M(u,[{key:"setCoinTextFromNumber",value:function(e){var t=e_.getShortNumber(e,3);this.coinLabel.string=t}},{key:"handleAddCoinButton",value:function(){b.openScreen(w.GET_COIN_SCREEN,{quantity:Ss})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(oa.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(o=q((function*(e){var t,n,i,a=e.coins,o=e.collectionAnimation,l=e.playSound;if(void 0!==o&&!1!==this.node.activeInHierarchy){var s=o.signal;if(null===(t=this.animAbortSignal)||void 0===t||t.abort(),this.animAbortSignal=null!=s?s:new r,o.animateTextOnly)return yield this.animateCoinText(a,0,l,s),void this.setCoins(a);var u=null!==(n=o.flyDuration)&&void 0!==n?n:0,c=(null!==(i=o.floatDuration)&&void 0!==i?i:0)+u;yield this.animateCoinText(a,c,l,s),this.setCoins(a)}else this.setCoins(a)})),function(e){return o.apply(this,arguments)})},{key:"setCoins",value:function(e){this.setCoinTextFromNumber(e),this.currentCoin=e}},{key:"animateCoinText",value:(i=q((function*(t,n){var i=this,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3?arguments[3]:void 0,r=this.currentCoin;yield e.waitTweenAsync(n,o),a&&l.playSound(wn.COLLECT_COINS),yield e.runOnUpdateAsync(this.node,1,(function(e){var n=Math.round(r+(t-r)*e);i.setCoinTextFromNumber(n)}),o)})),function(e,t){return i.apply(this,arguments)})},{key:"emitExplodeEffect",value:(n=q((function*(t){this.initializeExplosionCircle(),this.explosionParticles.resetSystem(),yield Promise.all([e.runTweenAsync(ie(this.explosionCircle.node).to(.4,{scale:new Oe(3,3,3)},{easing:"quadOut"}),t),e.runTweenAsync(ie(this.explosionCircle).delay(.2).to(.2,{opacity:0}),t)]),this.resetExplosionCircle()})),function(e){return n.apply(this,arguments)})},{key:"resetExplosionCircle",value:function(){this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0}},{key:"initializeExplosionCircle",value:function(){this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0)}},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var e;null===(e=this.animAbortSignal)||void 0===e||e.abort()}}]),u}(re)).prototype,"coinLabel",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NL=D(DL.prototype,"coinIcon",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zL=D(DL.prototype,"explosionCircle",[AL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BL=D(DL.prototype,"explosionParticles",[TL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(DL.prototype,"setCoins",[RL],Object.getOwnPropertyDescriptor(DL.prototype,"setCoins"),DL.prototype),D(DL.prototype,"animateCoinText",[PL],Object.getOwnPropertyDescriptor(DL.prototype,"animateCoinText"),DL.prototype),D(DL.prototype,"emitExplodeEffect",[OL],Object.getOwnPropertyDescriptor(DL.prototype,"emitExplodeEffect"),DL.prototype),D(DL.prototype,"resetExplosionCircle",[IL],Object.getOwnPropertyDescriptor(DL.prototype,"resetExplosionCircle"),DL.prototype),D(DL.prototype,"initializeExplosionCircle",[LL],Object.getOwnPropertyDescriptor(DL.prototype,"initializeExplosionCircle"),DL.prototype),_L=DL))||_L);J._RF.pop(),J._RF.push({},"95ba56f1qVFfLLdPv++OfLw","SmoothScrollView",void 0);var n_,i_=Q.ccclass,a_=Q.property,o_=(VL=i_("SmoothScrollView"),qL=a_({type:ye,group:"Mouse Scroll"}),WL=a_({type:te,group:"Mouse Scroll",visible:function(){return this.mouseScroll}}),KL=a_({type:te,group:"Mouse Scroll",visible:function(){return this.mouseScroll}}),VL((XL=D((YL=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"mouseScroll",XL,x(e)),z(e,"mouseScrollSpeed",ZL,x(e)),z(e,"mouseScrollDuration",JL,x(e)),e}return M(n,[{key:"_onMouseWheel",value:function(e,t){if(this.mouseScroll){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(e,t)){var i=new Oe,a=e.getScrollY()<0?1:-1;this.vertical?i.set(0,a*this.mouseScrollSpeed,0):this.horizontal&&i.set(a*this.mouseScrollSpeed,0,0),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._startAutoScroll(i,this.mouseScrollDuration,!0),this._stopPropagationIfTargetIsMe(e)}}else H(V(n.prototype),"_onMouseWheel",this).call(this,e,t)}}]),n}(at)).prototype,"mouseScroll",[qL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZL=D(YL.prototype,"mouseScrollSpeed",[WL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),JL=D(YL.prototype,"mouseScrollDuration",[KL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),jL=YL))||jL);J._RF.pop(),J._RF.push({},"904917NfYBJy781QxKjEPIO","ViewNode",void 0);var r_,l_,s_,u_,c_,h_,p_,d_,y_,v_,f_,g_,m_,b_,w_,k_,S_,C_,E_,A_,T_=Q.ccclass,R_=Q.requireComponent,P_=T_("ViewNode")(n_=R_(he)(n_=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).order=0,e}return M(n,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"setVisible",value:function(e){this.uiOpacity.opacity=e?255:0}},{key:"isVisible",value:function(){return this.uiOpacity.opacity>0}}]),n}(re))||n_)||n_;J._RF.pop(),J._RF.push({},"0b250nSw/RHRq8vKigzgfhs","ScrollViewLayout",void 0);var O_,I_,L_,__,D_,M_,N_,z_,B_,F_,x_,U_,G_,H_,V_,q_,W_,K_,j_,Y_,X_,Z_,J_,Q_,$_,eD,tD,nD,iD,aD,oD,rD,lD=Q.ccclass,sD=Q.property,uD=Q.requireComponent,cD=GameCore.Utils.Array,hD=(r_=lD("ScrollViewLayout"),l_=uD(o_),s_=sD($),u_=sD(te),c_=sD(Ve),h_=sD(ee),p_=sD(ee),d_=a.onlyRunInLifeCycleAsync,y_=a.onlyRunInLifeCycleAsync,v_=a.onlyRunInLifeCycleAsync,f_=a.onlyRunInLifeCycle,g_=a.onlyRunInLifeCycle,m_=a.onlyRunInLifeCycle,r_(b_=l_((k_=D((w_=function(t){B(s,t);var n,i,o,l=F(s);function s(){var e;N(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=l.call.apply(l,[this].concat(n)),z(e,"viewport",k_,x(e)),z(e,"spacing",S_,x(e)),z(e,"nodePrefab",C_,x(e)),z(e,"maxNodeCount",E_,x(e)),z(e,"extendCount",A_,x(e)),e.nodePool=[],e.nodeHeight=0,e.scrollSignal=new r,e.onNodeVisible=function(){},e.onNodeInvisible=function(){},e}return M(s,[{key:"__preload",value:function(){this.scrollView=this.getComponent(o_),this.uiTransform=this.getComponent($)}},{key:"start",value:function(){var e=Ge(this.nodePrefab);this.nodeHeight=e.getComponent($).height,e.destroy(),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"init",value:function(e,t){this.createNodePool(),this.onNodeVisible=null!=e?e:this.onNodeVisible,this.onNodeInvisible=null!=t?t:this.onNodeInvisible;for(var n=0;n<this.nodePool.length;n++)this.nodePool[n].setVisible(!1);this.updateVisibility()}},{key:"updateNodeVisibility",value:function(){for(var e=0;e<this.nodePool.length;e++)this.nodePool[e].isVisible()?this.onNodeVisible(this.nodePool[e]):this.onNodeInvisible(this.nodePool[e])}},{key:"listenEvents",value:function(){this.scrollView.node.on(at.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.on(ot.TOUCH_MOVE,this.abortScrollSignal,this),this.scrollView.node.on(ot.MOUSE_WHEEL,this.abortScrollSignal,this)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(at.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.off(ot.TOUCH_MOVE,this.abortScrollSignal,this),this.scrollView.node.off(ot.MOUSE_WHEEL,this.abortScrollSignal,this)}},{key:"scrollToOrder",value:(o=q((function*(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=this.getNodeScrollOffset(e),a=this.scrollView.getScrollOffset().y,o=(i=Math.max(i,0))-(a=Math.max(a,0));Math.abs(o)<5||(yield this.scrollToOffset(new Pe(0,i),n,t))})),function(e,t){return o.apply(this,arguments)})},{key:"scrollToTop",value:(i=q((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;yield this.scrollToOffset(new Pe(0,0),t,e)})),function(e){return i.apply(this,arguments)})},{key:"scrollToOffset",value:(n=q((function*(t,n,i){var a=new r;this.scrollSignal=a,this.scrollView.scrollToOffset(t,n),a.addAbortListener(this.handleScrollSignalAborted.bind(this)),i.addAbortListener(this.handleExternalSignalAborted.bind(this,t,a)),yield e.waitTweenAsync(n,i)})),function(e,t,i){return n.apply(this,arguments)})},{key:"updateVisibility",value:function(){for(var e=this.viewport.getBoundingBoxToWorld(),t=e.yMax,n=e.yMin,i=0;i<this.maxNodeCount;i++){var a=this.getNodeBoundingBoxWorld(i),o=a.top,r=a.bot;if(o<n||r>t){var l=this.getNodeByOrder(i);l&&(this.onNodeInvisible(l),l.setVisible(!1))}else{var s=this.getNodeByOrder(i);if(s)s.isVisible()||(s.order=i,this.onNodeVisible(s),s.setVisible(!0));else{var u=this.getInvisibleNode();u&&(u.node.setPosition(this.getNodePosition(i)),u.order=i,this.onNodeVisible(u),u.setVisible(!0))}}}}},{key:"updateLayout",value:function(){var e,t=this.getVisibleNodes(),n=G(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.node.setPosition(this.getNodePosition(i.order))}}catch(e){n.e(e)}finally{n.f()}}},{key:"setMaxNodeCount",value:function(e){this.maxNodeCount=e,this.scrollView.content.getComponent($).height=(this.nodeHeight+this.spacing)*this.maxNodeCount}},{key:"getAllNodes",value:function(){return this.nodePool}},{key:"getVisibleNodes",value:function(){return this.nodePool.filter((function(e){return e.isVisible()}))}},{key:"getNodePosition",value:function(e){return new Oe(0,-(this.nodeHeight+this.spacing)*e-this.nodeHeight/2,0)}},{key:"getNodeScrollOffset",value:function(e){return-this.getNodePosition(e).y-this.uiTransform.node.worldPosition.y-this.uiTransform.height/2+this.viewport.node.worldPosition.y}},{key:"getNodeByOrder",value:function(e){return cD.search(this.nodePool,(function(t){return t.order===e}))}},{key:"getInvisibleNode",value:function(){return cD.search(this.nodePool,(function(e){return!e.isVisible()}))}},{key:"createNodePool",value:function(){if(!(this.nodePool.length>0)){var e=Math.ceil(this.viewport.height/this.nodeHeight)+1+this.extendCount;this.setMaxNodeCount(this.maxNodeCount);for(var t=0;t<e;t++){var n,i=Ge(this.nodePrefab);null===(n=this.scrollView.content)||void 0===n||n.addChild(i),i.setPosition(this.getNodePosition(this.nodePool.length));var a=i.addComponent(P_);a.order=t,a.setVisible(!1),this.nodePool.push(a)}}}},{key:"getNodeBoundingBoxWorld",value:function(e){var t,n,i=this.getNodePosition(e).y+(null!==(t=null===(n=this.scrollView.content)||void 0===n?void 0:n.worldPosition.y)&&void 0!==t?t:0);return{top:i+this.nodeHeight/2,bot:i-this.nodeHeight/2}}},{key:"abortScrollSignal",value:function(){this.scrollSignal.abort()}},{key:"handleScrollSignalAborted",value:function(){this.scrollView.stopAutoScroll(),this.updateVisibility()}},{key:"handleExternalSignalAborted",value:function(e,t){t.aborted||(this.scrollView.stopAutoScroll(),this.scrollView.scrollToOffset(e,0),this.updateVisibility())}}]),s}(re)).prototype,"viewport",[s_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S_=D(w_.prototype,"spacing",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C_=D(w_.prototype,"nodePrefab",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E_=D(w_.prototype,"maxNodeCount",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),A_=D(w_.prototype,"extendCount",[p_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),D(w_.prototype,"scrollToOrder",[d_],Object.getOwnPropertyDescriptor(w_.prototype,"scrollToOrder"),w_.prototype),D(w_.prototype,"scrollToTop",[y_],Object.getOwnPropertyDescriptor(w_.prototype,"scrollToTop"),w_.prototype),D(w_.prototype,"scrollToOffset",[v_],Object.getOwnPropertyDescriptor(w_.prototype,"scrollToOffset"),w_.prototype),D(w_.prototype,"updateVisibility",[f_],Object.getOwnPropertyDescriptor(w_.prototype,"updateVisibility"),w_.prototype),D(w_.prototype,"handleScrollSignalAborted",[g_],Object.getOwnPropertyDescriptor(w_.prototype,"handleScrollSignalAborted"),w_.prototype),D(w_.prototype,"handleExternalSignalAborted",[m_],Object.getOwnPropertyDescriptor(w_.prototype,"handleExternalSignalAborted"),w_.prototype),b_=w_))||b_)||b_);J._RF.pop(),J._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var pD,dD,yD,vD,fD,gD,mD,bD,wD,kD,SD,CD=Q.ccclass,ED=Q.property,AD=Q.disallowMultiple,TD=Q.requireComponent,RD=(O_=CD("DashboardPage"),I_=TD(ne),L_=TD(he),__=a.required(),D_=ED({type:ge,displayName:"Page's container"}),M_=a.required(),N_=a.required(),z_=ED({type:ge,displayName:"Placeholder"}),B_=a.required(),F_=ED({displayName:"Don't create prefab",tooltip:"Tell the component to not create the prefab even if it hasn't create yet"}),x_=ED({displayName:"Darken background"}),U_=ED({type:ee,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),G_=ED({displayName:"Use navbar shadow"}),H_=ED({type:ee,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),V_=a.required(),q_=a.required(),W_=a.onlyRunInLifeCycleAsync,K_=a.onlyRunInLifeCycle,j_=a.onlyRunInLifeCycleAsync,O_(Y_=AD(Y_=I_(Y_=L_((Z_=D((X_=function(t){B(r,t);var n,i,o=F(r);function r(){var e;N(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),z(e,"container",Z_,x(e)),z(e,"containerUIOpacity",J_,x(e)),z(e,"placeholder",Q_,x(e)),z(e,"placeholderUIOpacity",$_,x(e)),z(e,"hasCreated",eD,x(e)),e.pagePrefab=null,z(e,"darkenBackground",tD,x(e)),z(e,"backgroundOpacity",nD,x(e)),z(e,"useNavbarShadow",iD,x(e)),z(e,"navbarShadowOpacity",aD,x(e)),z(e,"uiOpacity",oD,x(e)),z(e,"widgetComponent",rD,x(e)),e}return M(r,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(he),this.widgetComponent=this.getComponent(ne),this.containerUIOpacity=this.container.getComponent(he),this.placeholderUIOpacity=this.placeholder.getComponent(he),a.validateRequiredProperties(this)}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(i=q((function*(){this.hasCreated||(yield this.create()),this.mountInLifeCycle()})),function(){return i.apply(this,arguments)})},{key:"mountInLifeCycle",value:function(){this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,s.trackCurrentPage(this.node.name,!0)}},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return!0}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(n=q((function*(){if(this.pagePrefab&&!this.hasCreated){var t=Ge(this.pagePrefab);this.container.addChild(t),yield e.waitTweenAsync(0),this.hasCreated=!0}})),function(){return n.apply(this,arguments)})}]),r}(re)).prototype,"container",[__,D_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J_=D(X_.prototype,"containerUIOpacity",[M_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q_=D(X_.prototype,"placeholder",[N_,z_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$_=D(X_.prototype,"placeholderUIOpacity",[B_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eD=D(X_.prototype,"hasCreated",[F_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tD=D(X_.prototype,"darkenBackground",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nD=D(X_.prototype,"backgroundOpacity",[U_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),iD=D(X_.prototype,"useNavbarShadow",[G_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),aD=D(X_.prototype,"navbarShadowOpacity",[H_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),oD=D(X_.prototype,"uiOpacity",[V_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rD=D(X_.prototype,"widgetComponent",[q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(X_.prototype,"mount",[W_],Object.getOwnPropertyDescriptor(X_.prototype,"mount"),X_.prototype),D(X_.prototype,"mountInLifeCycle",[K_],Object.getOwnPropertyDescriptor(X_.prototype,"mountInLifeCycle"),X_.prototype),D(X_.prototype,"create",[j_],Object.getOwnPropertyDescriptor(X_.prototype,"create"),X_.prototype),Y_=X_))||Y_)||Y_)||Y_)||Y_);J._RF.pop(),J._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var PD,OD,ID,LD,_D,DD,MD,ND,zD,BD,FD,xD,UD,GD,HD,VD,qD,WD=Q.ccclass,KD=Q.property,jD=(pD=WD("ThemeProgressBar"),dD=KD(ge),yD=KD(ge),vD=KD(ge),fD=KD(ge),pD((bD=D((mD=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"progressBar",bD,x(e)),z(e,"progressText",wD,x(e)),z(e,"leftCap",kD,x(e)),z(e,"rightCap",SD,x(e)),e}return M(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(e,t){e<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var n=this.progressBar.getComponent(Re);if(!n)throw new Error("ThemeProgressBar: progressBarComponent not found");n.progress=e/t;var i=this.progressText.getComponent(we);if(!i)throw new Error("ThemeProgressBar: progressTextComponent not found");i.string="".concat(e,"/").concat(t)}}]),n}(re)).prototype,"progressBar",[dD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wD=D(mD.prototype,"progressText",[yD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kD=D(mD.prototype,"leftCap",[vD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SD=D(mD.prototype,"rightCap",[fD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gD=mD))||gD);J._RF.pop(),J._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var YD,XD,ZD,JD,QD,$D,eM,tM,nM,iM,aM,oM,rM,lM,sM,uM,cM,hM,pM,dM,yM,vM,fM,gM,mM,bM,wM,kM=Q.ccclass,SM=Q.disallowMultiple,CM=Q.property,EM=[50,160],AM=(PD=kM("LockAnimator"),OD=CM(Ee),ID=CM(Be),LD=CM(nt),_D=CM(nt),DD=CM(nt),MD=CM(ts),ND=CM({type:ee,min:0}),PD(zD=SM((FD=D((BD=function(t){B(l,t);var n,i,o,r=F(l);function l(){var e;N(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),z(e,"floatingParticles",FD,x(e)),z(e,"iconAnimation",xD,x(e)),z(e,"lockClip",UD,x(e)),z(e,"unlockClip",GD,x(e)),z(e,"tryToUnlockClip",HD,x(e)),z(e,"trailTemplate",VD,x(e)),z(e,"trailCount",qD,x(e)),e.trails=[],e}return M(l,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(o=q((function*(e){this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem(),yield this.playAnimation(this.unlockClip.name,e),this.floatingParticles.stopSystem()})),function(e){return o.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var t=this;return Promise.all(this.trails.map((function(n){return e.runTweenAsync(t.getExplodeTrail(n))})))}},{key:"getExplodeTrail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ue(0,2*Math.PI),i=Ue(EM[0],EM[1])*Math.cos(n),a=Ue(EM[0],EM[1])*Math.sin(n),o=new Oe(i,a,e.node.position.z),r=e.node.scale.clone();return ie(e.node).delay(t).call((function(){e.node.setPosition(0,0),e.reset(),e.node.active=!0})).to(.5,{position:o.clone()},{easing:"expoOut"}).to(.5,{scale:new Oe(0,0,1)},{easing:"expoIn"}).call((function(){e.node.setPosition(0,0),e.node.scale=r,e.reset(),e.node.active=!1}))}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var e=0;e<this.trailCount;e++){var t=Ge(this.trailTemplate.node);t.setParent(this.node),t.active=!1,this.trails.push(t.getComponent(ts))}}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"playAnimation",value:(i=q((function*(e,t){var n=this;return null!=t&&t.aborted?Promise.resolve():new Promise((function(i){n.iconAnimation.once(Be.EventType.FINISHED,(function(){i()})),null==t||t.addAbortListener((function(){n.iconAnimation.off(Be.EventType.FINISHED),n.iconAnimation.stop(),i()})),n.iconAnimation.play(e)}))})),function(e,t){return i.apply(this,arguments)})},{key:"playTryToUnlockAnimation",value:(n=q((function*(){return this.playAnimation(this.tryToUnlockClip.name)})),function(){return n.apply(this,arguments)})}]),l}(re)).prototype,"floatingParticles",[OD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xD=D(BD.prototype,"iconAnimation",[ID],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UD=D(BD.prototype,"lockClip",[LD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GD=D(BD.prototype,"unlockClip",[_D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HD=D(BD.prototype,"tryToUnlockClip",[DD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VD=D(BD.prototype,"trailTemplate",[MD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qD=D(BD.prototype,"trailCount",[ND],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zD=BD))||zD)||zD);J._RF.pop(),J._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var TM,RM,PM,OM,IM,LM,_M,DM,MM,NM,zM,BM,FM,xM=Q.ccclass,UM=Q.property,GM={progress:0,max:10,isLocked:!0,theme:E.SUMMER,skins:[fS.FRUIT]},HM=GameCore.Utils.Array,VM=(YD=xM("ThemeBlock"),XD=UM(ge),ZD=UM(ge),JD=UM(AM),QD=UM({type:ge,group:"Container"}),$D=UM({type:he,group:"Container"}),eM=UM({type:ge,group:"Theme"}),tM=UM({type:se,group:"Theme"}),nM=UM({type:p,group:"Title"}),iM=UM({type:he,group:"Title"}),aM=UM({type:se,group:"Tile"}),oM=UM({type:he,group:"Tile"}),rM=UM(ye),lM=a.onlyRunInLifeCycleAsync,YD((cM=D((uM=function(t){B(c,t);var n,i,l,s,u=F(c);function c(){var e;N(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=u.call.apply(u,[this].concat(n)),z(e,"mask",cM,x(e)),z(e,"progressBar",hM,x(e)),z(e,"lockAnimator",pM,x(e)),z(e,"container",dM,x(e)),z(e,"containerOpacity",yM,x(e)),z(e,"themeLoadingRing",vM,x(e)),z(e,"themeSprite",fM,x(e)),z(e,"titleLocalizer",gM,x(e)),z(e,"titleOpacity",mM,x(e)),z(e,"tileBlockIconSprite",bM,x(e)),z(e,"newTilesOpacity",wM,x(e)),e.signal=new r,e.payload=GM,e}return M(c,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(e){this.payload.isLocked=e,this.updateInfo()}},{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"updateInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:GM;this.payload=e;var t=e.progress,n=e.max,i=e.isLocked,a=e.theme,o=e.skins;this.signal.abort();var l=new r;this.signal=l,this.updateTitle(a),this.updateSkinAsync(o,l),this.updateThemeAsync(a,l);var s=this.progressBar.getComponent(jD);if(!s)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=i,this.progressBar.active=!i,this.lockAnimator.node.active=i,i||s.setProgress(t,n)}},{key:"playUnlockAnim",value:(s=q((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:GM;this.payload=U(U({},t),{},{isLocked:!1});var n=t.progress,i=t.max,a=this.progressBar.getComponent(jD);if(!a)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,a.setProgress(n,i),yield this.animateUnlockedState(e)})),function(e){return s.apply(this,arguments)})},{key:"updateTitle",value:function(e){var t=fO[e];this.titleLocalizer.key=t}},{key:"updateSkinAsync",value:(l=q((function*(e,t){var n=this.tileBlockIconSprite.length,i=e.length,a=e.map(function(){var e=q((function*(e){return yield o.loadSkinPreviewAsync(e)}));return function(t){return e.apply(this,arguments)}}()),r=yield Promise.all(a);if(!t.aborted&&this.tileBlockIconSprite)if(i<=n){for(var l=Math.floor(n/i),s=n%i,u=K(HM.fillWith(i,(function(){return l}))),c=0;c<s;c++)u[c]++;for(var h=0,p=0;p<i;p++)for(var d=0;d<u[p]&&h<n;d++,h++)this.tileBlockIconSprite[h].spriteFrame=r[p][d]}else this.tileBlockIconSprite.forEach((function(e,t){e.spriteFrame=r[t%i][0]}))})),function(e,t){return l.apply(this,arguments)})},{key:"updateThemeAsync",value:(i=q((function*(e,t){this.themeSprite.spriteFrame=null;var n=o.getAsset("".concat(T[e],"/spriteFrame"),ze);n||(this.themeLoadingRing.active=!0,n=yield o.loadThemePreviewAsync(e)),n||(n=yield o.loadThemePreviewAsync(E.SUMMER)),this.themeSprite&&n&&!t.aborted&&(this.themeSprite.spriteFrame=n,this.themeLoadingRing.active=!1)})),function(e,t){return i.apply(this,arguments)})},{key:"animateUnlockedState",value:(n=q((function*(t){var n,i=this.mask.getComponent(he),a=this.progressBar.getComponent(he);if(!i)throw new Error("ThemeBlock: maskUIOpacity not found");if(!a)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,i.opacity=null!==(n=i.opacity)&&void 0!==n?n:255,this.progressBar.active=!0,a.opacity=0,yield this.lockAnimator.unlock(t),this.lockAnimator.node.active=!1,yield Promise.all([e.runTweenAsync(ie(i).to(.25,{opacity:0}),t),e.runTweenAsync(ie(a).to(.25,{opacity:255}),t)]),this.mask.active=!1,i.opacity=0,a.opacity=255})),function(e){return n.apply(this,arguments)})},{key:"setVisible",value:function(e){this.containerOpacity.opacity=e?255:0,this.titleOpacity.opacity=e?255:0,this.newTilesOpacity.opacity=e?255:0}}]),c}(re)).prototype,"mask",[XD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hM=D(uM.prototype,"progressBar",[ZD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pM=D(uM.prototype,"lockAnimator",[JD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dM=D(uM.prototype,"container",[QD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yM=D(uM.prototype,"containerOpacity",[$D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vM=D(uM.prototype,"themeLoadingRing",[eM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fM=D(uM.prototype,"themeSprite",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gM=D(uM.prototype,"titleLocalizer",[nM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mM=D(uM.prototype,"titleOpacity",[iM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bM=D(uM.prototype,"tileBlockIconSprite",[aM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wM=D(uM.prototype,"newTilesOpacity",[oM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(uM.prototype,"isLocked",[rM],Object.getOwnPropertyDescriptor(uM.prototype,"isLocked"),uM.prototype),D(uM.prototype,"updateSkinAsync",[lM],Object.getOwnPropertyDescriptor(uM.prototype,"updateSkinAsync"),uM.prototype),sM=uM))||sM);J._RF.pop(),J._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var qM,WM,KM,jM,YM,XM,ZM,JM,QM,$M=Q.ccclass,eN=Q.property,tN=globalThis.game.storage,nN=(TM=$M("CollectionsContent"),RM=eN(Ia),PM=eN(hD),OM=eN(Si),IM=eN({type:te,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),LM=a.onlyRunInLifeCycleAsync,_M=a.onlyRunInLifeCycleAsync,TM((NM=D((MM=function(e){B(o,e);var t,n,i=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=i.call.apply(i,[this].concat(n))).animateThemeBlockUnlockIndex=null,z(e,"panelAnimator",NM,x(e)),z(e,"themeScrollView",zM,x(e)),z(e,"contentOpacity",BM,x(e)),e.themeScrollViewInited=!1,e.payloads=[],e.preservedScrollPosition=new Pe,z(e,"offsetFromTopOfScrollView",FM,x(e)),e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return M(o,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.node.scene.on(oa.HIDE_UI,this.hideContent),this.node.scene.on(oa.SHOW_UI,this.showContent),this.themeScrollView.listenEvents()}},{key:"unlistenEvents",value:function(){this.unlistenUIEvents(),this.themeScrollView.unlistenEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(oa.HIDE_UI,this.hideContent),this.node.scene.off(oa.SHOW_UI,this.showContent)}},{key:"init",value:function(e){var t=this;this.payloads=e,this.themeScrollViewInited||(this.themeScrollViewInited=!0,this.themeScrollView.init((function(e){var n=t.animateThemeBlockUnlockIndex===e.order,i=t.payloads[e.order],a=e.getComponent(VM);a.updateInfo(U(U({},i),{},{isLocked:!!n||i.isLocked})),a.setVisible(!0),a.container.scale=new Oe(.4,.4,.4),ie(a.container).to(.3,{scale:Oe.ONE},{easing:"quadOut"}).start()})))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.scrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.scrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(e){var t=this,n=tN.getStorageData("collection","animateMapPackUnlock"),i=tN.getStorageData("collection","lastMapPack");e.forEach((function(e,a){var o=e.progress,r=e.max,l=e.isLocked;if(o<r&&!l&&n&&i!==a+1)return t.animateThemeBlockUnlockIndex=a,tN.setStorageData("collection","animateMapPackUnlock",!1),void tN.setStorageData("collection","lastMapPack",a+1)}))}},{key:"shouldAnimateThemeBlockUnlock",value:function(){return null!==this.animateThemeBlockUnlockIndex}},{key:"playThemeTabUnlockAnim",value:(n=q((function*(e){if(this.animateThemeBlockUnlockIndex){var t=this.themeScrollView.getNodeByOrder(this.animateThemeBlockUnlockIndex);if(t&&t.isVisible()){var n=t.getComponent(VM);if(n){var i=zs.getCollectionUnlockProgress()[this.animateThemeBlockUnlockIndex];yield n.playUnlockAnim(e,U(U({},i),{},{isLocked:!0})),this.animateThemeBlockUnlockIndex=null}}}})),function(e){return n.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(t=q((function*(e,t){yield this.themeScrollView.scrollToOrder(e,t)})),function(e,n){return t.apply(this,arguments)})},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}}]),o}(re)).prototype,"panelAnimator",[RM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zM=D(MM.prototype,"themeScrollView",[PM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=D(MM.prototype,"contentOpacity",[OM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FM=D(MM.prototype,"offsetFromTopOfScrollView",[IM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),D(MM.prototype,"playThemeTabUnlockAnim",[LM],Object.getOwnPropertyDescriptor(MM.prototype,"playThemeTabUnlockAnim"),MM.prototype),D(MM.prototype,"scrollToCurrentUnlockingTheme",[_M],Object.getOwnPropertyDescriptor(MM.prototype,"scrollToCurrentUnlockingTheme"),MM.prototype),DM=MM))||DM);J._RF.pop(),J._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var iN,aN,oN,rN,lN,sN,uN,cN,hN,pN,dN,yN,vN,fN,gN,mN,bN,wN,kN,SN,CN,EN,AN,TN,RN,PN,ON,IN,LN,_N,DN,MN,NN,zN,BN,FN,xN,UN,GN,HN=(qM=(0,Q.ccclass)("CollectionsPage"),WM=a.required(),KM=a.onlyRunInLifeCycleAsync,jM=a.onlyRunInLifeCycle,YM=a.onlyRunInLifeCycleAsync,XM=a.onlyRunInLifeCycleAsync,qM((QM=D((JM=function(t){B(l,t);var n,i,a,o,r=F(l);function l(){var e;N(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=r.call.apply(r,[this].concat(n))).payload=null,z(e,"panelAnimationController",QM,x(e)),e}return M(l,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(Ea),H(V(l.prototype),"onLoad",this).call(this)}},{key:"start",value:(o=q((function*(){H(V(l.prototype),"start",this).call(this)})),function(){return o.apply(this,arguments)})},{key:"setPayload",value:function(e){this.payload=e}},{key:"mount",value:(a=q((function*(){yield H(V(l.prototype),"mount",this).call(this),this.onMount()})),function(){return a.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(nN),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload);var e=zs.getCollectionUnlockProgress();this.themeContent.updateUnlockedProgress(e)}},{key:"transitionIn",value:(i=q((function*(){yield H(V(l.prototype),"transitionIn",this).call(this),this.themeContent.restoreScrollPosition(),this.themeContent.listenEvents();var t=e.runTweenAsync(ie(this.containerUIOpacity).to(.2,{opacity:255})),n=this.panelAnimationController.showUI();yield Promise.all([t,n])})),function(){return i.apply(this,arguments)})},{key:"transitionOut",value:(n=q((function*(){yield H(V(l.prototype),"transitionOut",this).call(this),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents(),yield this.panelAnimationController.hideUI(),this.themeContent.unlistenEvents()})),function(){return n.apply(this,arguments)})}]),l}(RD)).prototype,"panelAnimationController",[WM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(JM.prototype,"mount",[KM],Object.getOwnPropertyDescriptor(JM.prototype,"mount"),JM.prototype),D(JM.prototype,"onMount",[jM],Object.getOwnPropertyDescriptor(JM.prototype,"onMount"),JM.prototype),D(JM.prototype,"transitionIn",[YM],Object.getOwnPropertyDescriptor(JM.prototype,"transitionIn"),JM.prototype),D(JM.prototype,"transitionOut",[XM],Object.getOwnPropertyDescriptor(JM.prototype,"transitionOut"),JM.prototype),ZM=JM))||ZM);J._RF.pop(),J._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var VN,qN,WN,KN,jN,YN,XN,ZN,JN,QN,$N,ez,tz,nz=Q.ccclass,iz=Q.property,az=Q.disallowMultiple,oz=Q.requireComponent,rz=GameCore.Utils.Array,lz=(iN=nz("PageManagerItem"),aN=iz(RD),oN=iz({type:ue(cn)}),iN((sN=D((lN=M((function e(){N(this,e),z(this,"page",sN,this),z(this,"pageType",uN,this)}))).prototype,"page",[aN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uN=D(lN.prototype,"pageType",[oN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rN=lN))||rN),sz=(cN=nz("PageManager"),hN=oz($),pN=a.required(),dN=iz({type:he,displayName:"Background Mask",group:"Background Mask"}),yN=iz({type:te,displayName:"Transition duration",group:"Background Mask"}),vN=iz({type:te,displayName:"Transition delay",group:"Background Mask"}),fN=a.required(),gN=iz({type:he,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),mN=iz({type:te,displayName:"Transition duration",group:"Nav Bar Shadow"}),bN=iz({type:te,displayName:"Transition delay",group:"Nav Bar Shadow"}),wN=iz({type:[lz]}),kN=iz({type:ue(cn)}),SN=a.required(),CN=a.onlyRunInLifeCycleAsync,EN=a.onlyRunInLifeCycleAsync,AN=a.onlyRunInLifeCycle,TN=a.onlyRunInLifeCycle,RN=a.onlyRunInLifeCycle,PN=a.onlyRunInLifeCycleAsync,ON=a.onlyRunInLifeCycleAsync,IN=a.onlyRunInLifeCycleAsync,cN(LN=az(LN=hN((DN=D((_N=function(n){B(y,n);var i,o,r,l,s,u,c,h,p,d=F(y);function y(){var e;N(this,y);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=d.call.apply(d,[this].concat(n)),z(e,"backgroundMask",DN,x(e)),z(e,"backgroundMaskTransitionDuration",MN,x(e)),z(e,"backgroundMaskTransitionDelay",NN,x(e)),z(e,"navBarShadow",zN,x(e)),z(e,"navBarShadowTransitionDuration",BN,x(e)),z(e,"navBarShadowTransitionDelay",FN,x(e)),z(e,"pageItems",xN,x(e)),z(e,"currentScreen",UN,x(e)),z(e,"uiTransform",GN,x(e)),e}return M(y,[{key:"unmountAndHideAll",value:function(){var e=this;this.pageItems.forEach((function(t){var n=t.page;t.pageType!==e.currentScreen&&(n.unmount(),n.hide())}))}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent($),a.validateRequiredProperties(this),oe.on(t.VIEW_RESIZED,this.init,this)}},{key:"onDestroy",value:function(){oe.off(t.VIEW_RESIZED,this.init,this)}},{key:"init",value:function(){var e=this;this.pageItems.forEach((function(t,n){var i=t.page.getWidget(),a=e.getPageIndex(e.currentScreen);i.right=-(n-a)*e.uiTransform.width,i.left=(n-a)*e.uiTransform.width,i.updateAlignment()}))}},{key:"updateCollectionsContentPayload",value:function(e){var t=this.getPage(cn.collections);t&&t instanceof HN&&t.setPayload(e)}},{key:"navigate",value:(p=q((function*(e,t,n,i){var a=e.from,o=e.to;null!==a?yield this.navigateFromPage(a,o,t,n,i):yield this.navigateFromNull(o,n,i)})),function(e,t,n,i){return p.apply(this,arguments)})},{key:"navigateFromPage",value:(h=q((function*(e,t,n,i,a){var o=this,r=this.validateNavigationRequest(e,t),l=r.toPage,s=r.fromPage;this.currentScreen=t;var u=this.uiTransform.width,c=this.getPageIndex(e),h=this.getPageIndex(t),p=Math.min(c,h),d=Math.max(c,h),y=(d-p)*u,v=c<h?1:-1,f=this.pageItems.slice(p,d+1);f.forEach((function(e,t){var n=e.page;n.show(),n.getWidget().enabled=!1,n.node.position=new Oe((t+p-c)*u,n.node.position.y,n.node.position.z)}));var g=!l.hasLoadedPage();g&&this.showLoadingScreen(),yield this.mountPage(l,i),yield n.callAsync((function(){return o.performFullTransition({from:e,to:t,fromPage:s,toPage:l,distance:y,direction:v,items:f})})),n.call((function(){return o.cleanupPages(l,f.filter((function(e){return e.pageType!==t})))})),yield n.callAsync((function(){return o.transitionInPage(l,a)})),g&&this.hideLoadingScreen()})),function(e,t,n,i,a){return h.apply(this,arguments)})},{key:"hideLoadingScreen",value:function(){b.closeLoadingScreen()}},{key:"showLoadingScreen",value:function(){b.showLoadingScreen()}},{key:"cleanupPages",value:function(e,t){var n=e.getWidget();n.enabled=!0,n.left=0,n.right=0,Te.instance.emit("canvas-resize"),t.forEach((function(e){e.page.unmount(),e.page.hide()}))}},{key:"performFullTransition",value:(c=q((function*(e){var t=e.from,n=e.to,i=e.fromPage,a=e.distance,o=e.direction,r=e.items,l=e.toPage;this.node.scene.emit(Ft,{from:t,to:n}),yield Promise.all([i.transitionOut(),this.transition(a,o,r),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,l.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,l.getNavbarShadow())])})),function(e){return c.apply(this,arguments)})},{key:"mountPage",value:(u=q((function*(e,t){yield e.mount(),yield null==t?void 0:t(e)})),function(e,t){return u.apply(this,arguments)})},{key:"validateNavigationRequest",value:function(e,t){if(e!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");var n=this.getPage(this.currentScreen),i=this.getPage(t);if(!i||!n)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");return{toPage:i,fromPage:n}}},{key:"navigateFromNull",value:(s=q((function*(e,t,n){var i=this.getPage(this.currentScreen);i.show(),this.currentScreen=e,yield this.mountPage(i,t),this.node.scene.emit(Ft,{from:null,to:e}),yield this.transitionInPage(i,n)})),function(e,t,n){return s.apply(this,arguments)})},{key:"transitionInPage",value:(l=q((function*(e,t){yield e.transitionIn(),yield null==t?void 0:t(e)})),function(e,t){return l.apply(this,arguments)})},{key:"getPage",value:function(e){var t=this.getPageIndex(e);return-1!==t?this.pageItems[t].page:null}},{key:"handleBackgroundMask",value:(r=q((function*(t,n){yield e.runTweenAsync(ie(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(t,{opacity:n}).start())})),function(e,t){return r.apply(this,arguments)})},{key:"handleNavBarShadow",value:(o=q((function*(t,n){yield e.runTweenAsync(ie(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(t,{opacity:n}).start())})),function(e,t){return o.apply(this,arguments)})},{key:"getPageIndex",value:function(e){return rz.searchIndex(this.pageItems,(function(t){return t.pageType===e}))}},{key:"transition",value:(i=q((function*(t,n,i){yield Promise.all(i.map((function(i){var a=i.page;return e.runTweenAsync(ie(a.node).to(.5,{position:new Oe(a.node.position.x-t*n,a.node.position.y,a.node.position.z)},{easing:ce.quintInOut}))})))})),function(e,t,n){return i.apply(this,arguments)})}]),y}(re)).prototype,"backgroundMask",[pN,dN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MN=D(_N.prototype,"backgroundMaskTransitionDuration",[yN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),NN=D(_N.prototype,"backgroundMaskTransitionDelay",[vN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),zN=D(_N.prototype,"navBarShadow",[fN,gN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BN=D(_N.prototype,"navBarShadowTransitionDuration",[mN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),FN=D(_N.prototype,"navBarShadowTransitionDelay",[bN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),xN=D(_N.prototype,"pageItems",[wN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),UN=D(_N.prototype,"currentScreen",[kN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return cn.home}}),GN=D(_N.prototype,"uiTransform",[SN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(_N.prototype,"navigate",[CN],Object.getOwnPropertyDescriptor(_N.prototype,"navigate"),_N.prototype),D(_N.prototype,"navigateFromPage",[EN],Object.getOwnPropertyDescriptor(_N.prototype,"navigateFromPage"),_N.prototype),D(_N.prototype,"hideLoadingScreen",[AN],Object.getOwnPropertyDescriptor(_N.prototype,"hideLoadingScreen"),_N.prototype),D(_N.prototype,"showLoadingScreen",[TN],Object.getOwnPropertyDescriptor(_N.prototype,"showLoadingScreen"),_N.prototype),D(_N.prototype,"cleanupPages",[RN],Object.getOwnPropertyDescriptor(_N.prototype,"cleanupPages"),_N.prototype),D(_N.prototype,"performFullTransition",[PN],Object.getOwnPropertyDescriptor(_N.prototype,"performFullTransition"),_N.prototype),D(_N.prototype,"mountPage",[ON],Object.getOwnPropertyDescriptor(_N.prototype,"mountPage"),_N.prototype),D(_N.prototype,"navigateFromNull",[IN],Object.getOwnPropertyDescriptor(_N.prototype,"navigateFromNull"),_N.prototype),LN=_N))||LN)||LN)||LN);J._RF.pop(),J._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var uz,cz,hz,pz,dz,yz,vz=Q.ccclass,fz=Q.property,gz=(VN=vz("StarProgressBar"),qN=fz($o),WN=fz(we),KN=fz(ee),jN=fz(ee),YN=fz(Ie),VN((JN=D((ZN=function(t){B(a,t);var n,i=F(a);function a(){var e;N(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),z(e,"progressBar",JN,x(e)),z(e,"progressLabel",QN,x(e)),z(e,"current",$N,x(e)),z(e,"total",ez,x(e)),z(e,"separator",tz,x(e)),e}return M(a,[{key:"setRange",value:function(e,t){this.total=t,this.current=e,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string="".concat(this.current).concat(this.separator).concat(this.total)}},{key:"animateTo",value:(n=q((function*(t,n,i){var a=this,o=Math.min(t,this.total)/this.total,r=this.current,l=1,s=ie(this.progressBar).to(3,{progress:o},{easing:"quadOut",onUpdate:function(e,n){n&&(a.current=r+Math.floor((t-r)*n),null==i||i(a.current),a.current===r-l&&(l++,ie(a.progressLabel.node).to(.05,{scale:new Oe(1.2,1.2,1.2)}).to(.05,{scale:Oe.ONE}).start()),a.updateProgressLabel())}});null==n||n.addAbortListener((function(){a.current=t,a.updateProgress()})),yield e.runTweenAsync(s,n)})),function(e,t,i){return n.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),a}(re)).prototype,"progressBar",[qN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QN=D(ZN.prototype,"progressLabel",[WN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$N=D(ZN.prototype,"current",[KN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ez=D(ZN.prototype,"total",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tz=D(ZN.prototype,"separator",[YN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XN=ZN))||XN);J._RF.pop(),J._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var mz,bz,wz,kz,Sz,Cz,Ez,Az,Tz,Rz=Q.ccclass,Pz=Q.property,Oz=(uz=Rz("EventButton"),cz=Pz({type:ue(oO)}),hz=Pz(ye),uz((yz=D((dz=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"eventType",yz,x(e)),e._isAvailable=!1,e}return M(n,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(e){this._isAvailable=e,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(xt,{type:this.eventType})}},{key:"setAnimationState",value:function(e){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),H(V(n.prototype),"setAnimationState",this).call(this,e)}}]),n}(vi)).prototype,"eventType",[cz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return oO.STAR_CHEST}}),D(dz.prototype,"isAvailable",[hz],Object.getOwnPropertyDescriptor(dz.prototype,"isAvailable"),dz.prototype),pz=dz))||pz);J._RF.pop(),J._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var Iz,Lz,_z,Dz,Mz,Nz,zz,Bz,Fz,xz,Uz,Gz,Hz,Vz,qz,Wz,Kz,jz,Yz=Q.ccclass,Xz=Q.property,Zz=globalThis.game.player,Jz=(mz=Yz("DashboardHeader"),bz=Xz({type:gz,displayName:"Progress bar",group:"Star Chest"}),wz=Xz({type:Oz,displayName:"Button Component",group:"Star Chest"}),kz=Xz(ne),mz((Ez=D((Cz=function(e){B(i,e);var n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"starProgressBar",Ez,x(e)),z(e,"chestButton",Az,x(e)),z(e,"containerWidget",Tz,x(e)),e}return M(i,[{key:"__preload",value:function(){oe.on(Nt,this.handleStarsUpdateEvent,this),oe.on(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged()}},{key:"onDestroy",value:function(){oe.off(Nt,this.handleStarsUpdateEvent,this),oe.off(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"updateStarProgress",value:function(e){this.handleStarsUpdateEvent(e)}},{key:"updateStarChestButtonAnimation",value:function(e){this.chestButton.isAvailable=e>=20}},{key:"handleStarsUpdateEvent",value:function(e){var t,n=null!=e?e:null===(t=Zz.getGameData())||void 0===t?void 0:t.stars;void 0!==n&&(this.starProgressBar.setRange(n,20),this.updateStarChestButtonAnimation(n))}},{key:"handleOrientationChanged",value:function(){Mt.isPortrait()?(this.containerWidget.left=0,this.containerWidget.right=0):Mt.isLandscape()&&(this.containerWidget.left=450,this.containerWidget.right=450)}},{key:"handleClickedSettingsButton",value:function(){b.openScreen(w.SETTINGS_SCREEN)}}]),i}(re)).prototype,"starProgressBar",[bz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Az=D(Cz.prototype,"chestButton",[wz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tz=D(Cz.prototype,"containerWidget",[kz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sz=Cz))||Sz);J._RF.pop(),J._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var Qz,$z,eB,tB,nB,iB,aB,oB,rB,lB,sB,uB,cB=Q.ccclass,hB=Q.property,pB=Q.executeInEditMode,dB=(Iz=cB("JourneyLevelAvatar"),Lz=hB({type:se,displayName:"Avatar node"}),_z=hB(ge),Dz=hB(Be),Mz=hB(he),Nz=hB({type:nt,group:"Animation"}),zz=hB({type:nt,group:"Animation"}),Bz=hB({type:nt,group:"Animation"}),Fz=hB({type:ze,displayName:"Avatar sprite"}),Iz(xz=pB((Gz=D((Uz=function(t){B(r,t);var n,i,a,o=F(r);function r(){var e;N(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),z(e,"sprite",Gz,x(e)),z(e,"lockIcon",Hz,x(e)),z(e,"animation",Vz,x(e)),z(e,"opacity",qz,x(e)),z(e,"flashAnimation",Wz,x(e)),z(e,"unlockAnimation",Kz,x(e)),z(e,"spawnAnimation",jz,x(e)),e}return M(r,[{key:"avatarSprite",get:function(){var e,t;return null!==(e=null===(t=this.sprite)||void 0===t?void 0:t.spriteFrame)&&void 0!==e?e:null},set:function(e){this.sprite&&(this.sprite.spriteFrame=e)}},{key:"playUnlockAnimation",value:(a=q((function*(){var t=this.playAnimation(this.unlockAnimation),n=this.lockIcon.position.x,i=this.lockIcon.position.y,a=[45,135],o=(Math.random()*(a[1]-a[0])+a[0])*(Math.PI/180),r=this.lockIcon.position.x+150*Math.cos(o),l=this.lockIcon.position.y+150*Math.sin(o),s=i-400,u=e.runTweenAsync(ie(this.lockIcon).delay(.3).to(.2,{position:new Oe(r,l,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new Oe(r,s,this.lockIcon.position.z)},{easing:"cubicIn"})),c=[0,360],h=e.runTweenAsync(ie(this.lockIcon).delay(.3).to(.6,{eulerAngles:new Oe(0,0,Math.random()*(c[1]-c[0])*(r>n?-1:1))},{easing:"sineOut"}));yield Promise.all([t,u,h]),this.lockIcon.position=new Oe(n,i,this.lockIcon.position.z),this.lockIcon.eulerAngles=new Oe(0,0,0)})),function(){return a.apply(this,arguments)})},{key:"playFlashAnimation",value:(i=q((function*(t){var n=this.node.position.y,i=this.playAnimation(this.flashAnimation),a=e.runTweenAsync(ie(this.node).to(.1,{position:new Oe(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new Oe(this.node.position.x,n,this.node.position.z)},{easing:"sineIn"}),t);yield Promise.all([i,a])})),function(e){return i.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(Oe.ZERO)}},{key:"playAnimation",value:(n=q((function*(t){yield e.runAnimationAsync(this.animation,t.name)})),function(e){return n.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var e=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some((function(t){return null!==t&&(t.name===e.flashAnimation.name||t.name===e.unlockAnimation.name||t.name===e.spawnAnimation.name)})))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),r}(re)).prototype,"sprite",[Lz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hz=D(Uz.prototype,"lockIcon",[_z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vz=D(Uz.prototype,"animation",[Dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qz=D(Uz.prototype,"opacity",[Mz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wz=D(Uz.prototype,"flashAnimation",[Nz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kz=D(Uz.prototype,"unlockAnimation",[zz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jz=D(Uz.prototype,"spawnAnimation",[Bz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(Uz.prototype,"avatarSprite",[Fz],Object.getOwnPropertyDescriptor(Uz.prototype,"avatarSprite"),Uz.prototype),xz=Uz))||xz)||xz);J._RF.pop(),J._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var yB,vB,fB,gB,mB,bB,wB,kB,SB,CB,EB,AB,TB,RB,PB,OB,IB,LB,_B,DB,MB,NB,zB=Q.ccclass,BB=Q.property,FB=Q.executeInEditMode,xB=(Qz=zB("JourneyProgressBar"),$z=BB($o),eB=BB(we),tB=BB(he),nB=BB(ee),iB=BB(ee),aB=BB(Ie),Qz(oB=FB((lB=D((rB=function(t){B(a,t);var n,i=F(a);function a(){var e;N(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),z(e,"progressBar",lB,x(e)),z(e,"progressLabel",sB,x(e)),z(e,"labelUIOpacity",uB,x(e)),e.currentProgress=10,e.totalProgress=10,e.labelSeparator="/",e}return M(a,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(e){this.labelSeparator=e,this.updateProgress()}},{key:"setRange",value:function(e,t){this.totalProgress=t;var n=e;n>t&&(n=t),this.currentProgress=n,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(n=q((function*(t){var n=this,i=t.nextCurr,a=t.nextTotal,o=t.numberOfProgressBar,r=void 0===o?0:o,l=t.onProgressBarPassed,s=t.signal,u=i/a,c=ie(this.labelUIOpacity).to(.2,{opacity:0}),h=ie(this.labelUIOpacity).to(.2,{opacity:255}),p=r<1?1:Math.sqrt(r)+1,d=0===r?u:r+u,y=1,v=this.progressBar.progress,f=d,g=e.runOnUpdateAsync(this.node,p,(function(e){var t=ce.sineInOut(e),i=We(v,f,t);n.progressBar.progress=i%1,i>y&&(y=0===i?1:Math.ceil(i),null==l||l())}),s);return yield Promise.all([e.runTweenAsync(c,s),g]),this.currentProgress=i,this.totalProgress=a,this.updateProgress(),yield e.runTweenAsync(h,s),this.labelUIOpacity.opacity=255,u})),function(e){return n.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string="".concat(this.currentProgress).concat(this.separator).concat(this.totalProgress)}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),a}(re)).prototype,"progressBar",[$z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sB=D(rB.prototype,"progressLabel",[eB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uB=D(rB.prototype,"labelUIOpacity",[tB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(rB.prototype,"total",[nB],Object.getOwnPropertyDescriptor(rB.prototype,"total"),rB.prototype),D(rB.prototype,"current",[iB],Object.getOwnPropertyDescriptor(rB.prototype,"current"),rB.prototype),D(rB.prototype,"separator",[aB],Object.getOwnPropertyDescriptor(rB.prototype,"separator"),rB.prototype),oB=rB))||oB)||oB);J._RF.pop(),J._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var UB,GB,HB,VB,qB,WB,KB,jB,YB,XB,ZB,JB=Q.ccclass,QB=Q.property,$B=(yB=JB("ProgressConfiguration"),vB=QB(ze),fB=QB(Ie),yB((bB=D((mB=M((function e(){N(this,e),z(this,"avatar",bB,this),z(this,"themeId",wB,this)}))).prototype,"avatar",[vB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wB=D(mB.prototype,"themeId",[fB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gB=mB)),kB=JB("JourneyProgressAnimator"),SB=QB(xB),CB=QB(ge),EB=QB(se),AB=QB(dB),TB=QB({type:te,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),RB=a.onlyRunInLifeCycleAsync,PB=a.onlyRunInLifeCycle,kB((LB=D((IB=function(t){B(h,t);var n,i,r,l,s,u,c=F(h);function h(){var e;N(this,h);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=c.call.apply(c,[this].concat(n)),z(e,"progressBar",LB,x(e)),z(e,"currentLevelAvatarNode",_B,x(e)),z(e,"currentLevelAvatar",DB,x(e)),z(e,"nextLevelAvatar",MB,x(e)),z(e,"nextLevelYOffset",NB,x(e)),e.isAnimating=!1,e}return M(h,[{key:"setRange",value:function(e,t){this.progressBar.setRange(e,t)}},{key:"animateTo",value:(u=q((function*(e,t){if(this.isAnimating)return console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve();this.isAnimating=!0,e!==this.progressBar.current&&(yield this.progressBar.animateTo({nextCurr:e,nextTotal:this.progressBar.total,signal:t})),this.isAnimating=!1})),function(e,t){return u.apply(this,arguments)})},{key:"animateToNextLevel",value:(s=q((function*(e){var t=this,n=e.nextCurr,i=e.nextTotal,a=e.mapsPassed,o=e.signal;if(this.isAnimating)console.warn("JourneyProgressAnimator: animation already in progress");else{this.isAnimating=!0;var r=a.length-2;if(0===r)return yield this.progressBar.animateTo({nextCurr:n,nextTotal:i,signal:o}),void(this.isAnimating=!1);yield this.animateTargetAvaToCenter(o);var l=1;yield this.progressBar.animateTo({signal:o,nextCurr:n,nextTotal:i,numberOfProgressBar:r,onProgressBarPassed:function(){if(1===l)return t.nextLevelAvatar.playUnlockAnimation(),void(l+=1);if(l>=a.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");t.nextLevelAvatar.playFlashAnimation(o),t.setNextLevelAvatar(a[l].theme),l+=1}}),yield this.animateTargetAvaToPrev(o);var s=a[a.length-1].theme,u=a[a.length-2].theme;this.setCurrentLevelAvatar(u),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=yield this.getSpriteFrameByThemeId(s),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1}})),function(e){return s.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(l=q((function*(t){var n=new Oe(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);yield e.runTweenAsync(ie(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t),this.nextLevelAvatar.node.position=n})),function(e){return l.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(r=q((function*(t){var n=this.currentLevelAvatarNode.position.clone();yield e.runTweenAsync(ie(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t),this.nextLevelAvatar.node.position=n})),function(e){return r.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:(i=q((function*(e){return o.loadThemeThumbnailAsync(e)})),function(e){return i.apply(this,arguments)})},{key:"loadAndSetAvatar",value:(n=q((function*(e,t){var n=yield this.getSpriteFrameByThemeId(e);n?this.setAvatar(n,t):console.warn("JourneyProgressAnimator: ".concat(e," is null"))})),function(e,t){return n.apply(this,arguments)})},{key:"setAvatar",value:function(e,t){t instanceof dB?t.avatarSprite=e:t.spriteFrame=e}},{key:"setCurrentLevelAvatar",value:function(e){this.loadAndSetAvatar(e,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(e){this.loadAndSetAvatar(e,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}}]),h}(re)).prototype,"progressBar",[SB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_B=D(IB.prototype,"currentLevelAvatarNode",[CB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DB=D(IB.prototype,"currentLevelAvatar",[EB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MB=D(IB.prototype,"nextLevelAvatar",[AB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NB=D(IB.prototype,"nextLevelYOffset",[TB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),D(IB.prototype,"loadAndSetAvatar",[RB],Object.getOwnPropertyDescriptor(IB.prototype,"loadAndSetAvatar"),IB.prototype),D(IB.prototype,"setAvatar",[PB],Object.getOwnPropertyDescriptor(IB.prototype,"setAvatar"),IB.prototype),OB=IB))||OB);J._RF.pop(),J._RF.push({},"4b935BmCjhBf73yEp1PitwH","LandscapeMask",void 0);var eF,tF,nF,iF,aF,oF,rF,lF,sF,uF,cF,hF,pF,dF,yF,vF,fF,gF,mF,bF,wF,kF,SF,CF,EF,AF,TF,RF,PF,OF,IF,LF,_F,DF,MF,NF,zF,BF,FF=Q.ccclass,xF=Q.property,UF=(UB=FF("LandscapeMask"),GB=xF(Si),HB=xF($),VB=xF($),qB=xF($),UB((jB=D((KB=function(e){B(i,e);var n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"opacityToggler",jB,x(e)),z(e,"uiTransform",YB,x(e)),z(e,"leftMask",XB,x(e)),z(e,"rightMask",ZB,x(e)),e}return M(i,[{key:"__preload",value:function(){oe.on(t.VIEW_RESIZED,this.onViewResized,this),this.onViewResized()}},{key:"onDestroy",value:function(){oe.off(t.VIEW_RESIZED,this.onViewResized,this)}},{key:"onViewResized",value:function(){var e=this.uiTransform.contentSize,t=e.width,n=e.height;this.leftMask.width=2*n,this.rightMask.width=2*n,this.leftMask.node.worldPosition.set(0),this.rightMask.node.worldPosition.set(t)}},{key:"show",value:function(){this.opacityToggler.changeStateFade(!0,.2)}},{key:"hide",value:function(){this.opacityToggler.changeStateFade(!1,.1)}}]),i}(re)).prototype,"opacityToggler",[GB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YB=D(KB.prototype,"uiTransform",[HB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XB=D(KB.prototype,"leftMask",[VB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZB=D(KB.prototype,"rightMask",[qB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WB=KB))||WB);J._RF.pop(),J._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var GF,HF,VF,qF,WF,KF,jF,YF,XF,ZF,JF,QF,$F,ex,tx,nx,ix,ax=Q.ccclass,ox=Q.property,rx=globalThis.game,lx=rx.storage,sx=rx.monitorError,ux=GameCore.Utils,cx=ux.Array,hx=ux.Json,px=(eF=ax("HomeContent"),tF=a.required(),nF=ox({type:p,group:"Play Button"}),iF=a.required(),aF=ox({type:ve,group:"Play Button"}),oF=a.required(),rF=ox({type:ge,group:"Play Button"}),lF=a.required(),sF=ox({type:ge,group:"Play Button"}),uF=a.required(),cF=ox($B),hF=a.required(),pF=ox(Jz),dF=a.required(),yF=ox(he),vF=a.required(),fF=ox(t_),gF=a.required(),mF=ox(ge),bF=a.required(),wF=ox(UF),kF=a.onlyRunInLifeCycleAsync,SF=a.onlyRunInLifeCycleAsync,CF=a.onlyRunInLifeCycleAsync,EF=a.onlyRunInLifeCycleAsync,AF=a.onlyRunInLifeCycleAsync,eF((PF=D((RF=function(n){B(u,n);var i,o,r,l,s=F(u);function u(){var e;N(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),z(e,"playButtonLocalizer",PF,x(e)),z(e,"playButton",OF,x(e)),z(e,"playBackground",IF,x(e)),z(e,"hardLevelBackground",LF,x(e)),z(e,"journeyProgressAnimator",_F,x(e)),z(e,"dashboardHeader",DF,x(e)),z(e,"overlayDuringAnim",MF,x(e)),z(e,"coinContainer",NF,x(e)),z(e,"leavesContainer",zF,x(e)),z(e,"landscapeMask",BF,x(e)),e}return M(u,[{key:"onLoad",value:function(){oe.on(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(),a.validateRequiredProperties(this)}},{key:"onDestroy",value:function(){oe.off(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(zt)}},{key:"setPlayButton",value:function(e){this.playButtonLocalizer.setParams([e.toString()]);var t=e%5==0;this.playBackground.active=!t,this.hardLevelBackground.active=t}},{key:"updateStarProgress",value:function(e){this.dashboardHeader.updateStarProgress(e)}},{key:"setUnlockProgress",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setProgress(e),this.updateCurrentMapInStorage(e,t)}},{key:"shouldPlayUnlockAnimation",value:function(){var e,t,n=lx.getStorage("dashboard");if(null==n)return null==sx||sx.sendException(new Error("DashboardScene: dashboardStorage not found")),!1;if(!(null!==(e=n.animateToCurrentLevel)&&void 0!==e&&e))return!1;var i=lx.getStorage("tournament");if(null==i)return null==sx||sx.sendException(new Error("DashboardScene: tournamentStorage not found")),!1;if(null!==(t=i.animateTournamentLeader)&&void 0!==t&&t)return!1;var a=n.lastMapPayload,o=zs.getCurrentMapProgress();return hx.encode(a)!==hx.encode(o)&&!(cx.searchIndex(Ls.mapOrder,(function(e){return e.id===a.id}))>cx.searchIndex(Ls.mapOrder,(function(e){return e.id===o.id})))}},{key:"playUnlockProgressAnimation",value:function(e){var t=lx.getStorage("dashboard");if(null==t)throw new Error("DashboardScene: dashboardStorage not found");var n=t.lastMapPayload,i=zs.getCurrentMapProgress(),a=cx.searchIndex(Ls.mapOrder,(function(e){return e.id===n.id})),o=cx.searchIndex(Ls.mapOrder,(function(e){return e.id===i.id})),r=Ls.mapOrder.slice(a,o+2);return n.id===i.id?this.playUnlockProgressAnimationOnly(i,n,e):this.playUnlockProgressAndPackAnimation(n,i,r,e)}},{key:"playUnlockProgressAndPackAnimation",value:(l=q((function*(e,t,n,i){this.setProgress(U({},e)),this.updateCurrentMapInStorage(U({},t),!0),this.playButton.interactable=!1,yield this.showOwnOverlay(i),yield this.journeyProgressAnimator.animateToNextLevel({nextCurr:t.progress,nextTotal:t.max,mapsPassed:n,signal:i}),yield this.hideOwnOverlay(i),this.playButton.interactable=!0})),function(e,t,n,i){return l.apply(this,arguments)})},{key:"playUnlockProgressAnimationOnly",value:(r=q((function*(e,t,n){this.setProgress(U(U({},e),{},{progress:t.progress})),this.updateCurrentMapInStorage(U({},e),!0);var i=e.progress;yield this.showOwnOverlay(n),yield this.journeyProgressAnimator.animateTo(i,n),yield this.hideOwnOverlay(n)})),function(e,t,n){return r.apply(this,arguments)})},{key:"hideOwnOverlay",value:(o=q((function*(t){yield e.runTweenAsync(ie(this.overlayDuringAnim).to(.3,{opacity:0}),t),this.overlayDuringAnim.opacity=0})),function(e){return o.apply(this,arguments)})},{key:"showOwnOverlay",value:(i=q((function*(t){yield e.runTweenAsync(ie(this.overlayDuringAnim).to(.3,{opacity:150}),t)})),function(e){return i.apply(this,arguments)})},{key:"setProgress",value:function(e){var t=e.currentTheme,n=e.nextTheme,i=e.progress,a=e.max;this.journeyProgressAnimator.setCurrentLevelAvatar(t),this.journeyProgressAnimator.setNextLevelAvatar(null!=n?n:t),this.journeyProgressAnimator.setRange(i,a)}},{key:"updateCurrentMapInStorage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=lx.getStorage("dashboard");if(null!=n){var i=n.animateToCurrentLevel;lx.setStorageData("dashboard","animateToCurrentLevel",!t&&i),lx.setStorageData("dashboard","lastMapPayload",e)}else null==sx||sx.sendException(new Error("DashboardScene: dashboardStorage not found"))}},{key:"handleOrientationChanged",value:function(){this.leavesContainer.active=Mt.isLandscape(),this.landscapeMask.node.active=Mt.isLandscape()}},{key:"transitionIn",value:function(){this.landscapeMask.node.active&&this.landscapeMask.show()}},{key:"transitionOut",value:function(){this.landscapeMask.node.active&&this.landscapeMask.hide()}}]),u}(re)).prototype,"playButtonLocalizer",[tF,nF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OF=D(RF.prototype,"playButton",[iF,aF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IF=D(RF.prototype,"playBackground",[oF,rF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LF=D(RF.prototype,"hardLevelBackground",[lF,sF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_F=D(RF.prototype,"journeyProgressAnimator",[uF,cF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DF=D(RF.prototype,"dashboardHeader",[hF,pF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MF=D(RF.prototype,"overlayDuringAnim",[dF,yF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NF=D(RF.prototype,"coinContainer",[vF,fF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zF=D(RF.prototype,"leavesContainer",[gF,mF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BF=D(RF.prototype,"landscapeMask",[bF,wF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(RF.prototype,"playUnlockProgressAnimation",[kF],Object.getOwnPropertyDescriptor(RF.prototype,"playUnlockProgressAnimation"),RF.prototype),D(RF.prototype,"playUnlockProgressAndPackAnimation",[SF],Object.getOwnPropertyDescriptor(RF.prototype,"playUnlockProgressAndPackAnimation"),RF.prototype),D(RF.prototype,"playUnlockProgressAnimationOnly",[CF],Object.getOwnPropertyDescriptor(RF.prototype,"playUnlockProgressAnimationOnly"),RF.prototype),D(RF.prototype,"hideOwnOverlay",[EF],Object.getOwnPropertyDescriptor(RF.prototype,"hideOwnOverlay"),RF.prototype),D(RF.prototype,"showOwnOverlay",[AF],Object.getOwnPropertyDescriptor(RF.prototype,"showOwnOverlay"),RF.prototype),TF=RF))||TF);J._RF.pop(),J._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var dx,yx,vx,fx,gx,mx,bx,wx,kx,Sx,Cx,Ex,Ax,Tx,Rx,Px,Ox,Ix,Lx,_x,Dx,Mx,Nx,zx,Bx,Fx,xx,Ux,Gx,Hx,Vx,qx,Wx,Kx=Q.ccclass,jx=Q.property,Yx=GameCore.Utils.Array,Xx=n.Layout,Zx=(GF=Kx("NavManager"),HF=jx(ge),VF=jx(ge),qF=jx(Lt),WF=jx({type:ne,group:"Widgets"}),KF=jx({type:ne,group:"Widgets"}),jF=jx({type:ne,group:"Widgets"}),YF=jx($),GF((JF=D((ZF=function(n){B(u,n);var i,a,o,r,l,s=F(u);function u(){var e;N(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),z(e,"selectorNode",JF,x(e)),z(e,"selectedButtonNode",QF,x(e)),z(e,"autoLayout",$F,x(e)),z(e,"navWidget",ex,x(e)),z(e,"backgroundWidget",tx,x(e)),z(e,"layoutWidget",nx,x(e)),z(e,"uiTransform",ix,x(e)),e.navButtons=[],e.isNavigating=!1,e}return M(u,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var e;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(e=this.selectedButtonNode)||void 0===e?void 0:e.getComponentInChildren("NavButton"),oe.on(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this),oe.on(t.VIEW_RESIZED,this.handleViewResized,this),this.handleOrientationChanged(Mt.getCurrentLayout())}},{key:"onDestroy",value:function(){oe.off(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this),oe.off(t.VIEW_RESIZED,this.handleViewResized,this)}},{key:"select",value:(l=q((function*(e){var t=this;if(!this.isNavigating){if(!Yx.has(this.navButtons,e))throw new Error("NavManager: Button not found");if(e!==this.selectedButton){if(!e.isWIP)return this.isNavigating=!0,this.node.scene.emit(Bt,{from:this.selectedButton.buttonType,to:e.buttonType}),new Promise((function(n){t.node.scene.once(Ft,(function(){var i=t.selectedButton.deselect();t.autoLayout.selectedIndex=t.navButtons.indexOf(e),t.selectedButton=e;var a=t.autoLayout.getSelectedWorldX()-e.getSelectedWorldDistanceX(),o=t.playSelectorAnimation(a),r=e.select();Promise.all([i,r,o]).then((function(){t.isNavigating=!1,n()}))}))}));this.handleWIPButton()}}})),function(e){return l.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(r=q((function*(e){this.isNavigating||(Yx.has([cn.store],e.buttonType)?this.handleWIPButton():yield this.select(e))})),function(e){return r.apply(this,arguments)})},{key:"selectByType",value:(o=q((function*(e){var t=Yx.search(this.navButtons,(function(t){return t.buttonType===e}));if(!t)throw new Error("NavManager: Button not found");yield this.selectUsingSceneTransition(t)})),function(e){return o.apply(this,arguments)})},{key:"handleWIPButton",value:function(){b.openScreen(w.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(a=q((function*(){var e=this;if(!this.currentButton||!Yx.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");var t=this.currentButton.buttonType;return this.node.scene.emit(Bt,{from:null,to:t}),new Promise((function(t){e.node.scene.once(Ft,(function(){e.autoLayout.selectedIndex=e.navButtons.indexOf(e.currentButton);var n=e.navButtons.map((function(t){return t===e.currentButton?t.select(!1):t.deselect(!1,!0)})),i=e.autoLayout.getSelectedWorldX()-e.currentButton.getSelectedWorldDistanceX();e.selectorNode.worldPosition=new Oe(i,e.selectorNode.worldPosition.y,0),Promise.all(n).then((function(){t()}))}))}))})),function(){return a.apply(this,arguments)})},{key:"playSelectorAnimation",value:(i=q((function*(t){var n=this,i=new Oe(1,1,1),a=this.selectorNode.worldPosition.clone(),o=new Oe(1.2*i.x,.8*i.y,1);yield e.runTweenAsync(ie(this.selectorNode).to(.3,{worldPosition:new Oe(t,a.y,0)},{easing:"quintInOut",onUpdate:function(e,t){if(void 0!==t){var a=n.calculateCurrentSquashScale(i,o,t);n.selectorNode.scale=a}}}))})),function(e){return i.apply(this,arguments)})},{key:"setIgnoreInput",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=G(this.navButtons);try{for(n.s();!(e=n.n()).done;){var i=e.value,a=i.getComponentInChildren(ve);a&&(a.interactable=!t)}}catch(e){n.e(e)}finally{n.f()}}},{key:"calculateCurrentSquashScale",value:function(e,t,n){var i=this.splitIntoSquashRatio(n);return e.clone().lerp(t,i)}},{key:"splitIntoSquashRatio",value:function(e){return e<.5?2*e:1-2*(e-.5)}},{key:"handleOrientationChanged",value:function(e){e===Xx.Portrait?(this.navWidget.isAlignLeft=!0,this.navWidget.isAlignRight=!0,this.backgroundWidget.left=-50,this.backgroundWidget.right=-50,this.layoutWidget.left=0,this.layoutWidget.right=0):e===Xx.Landscape&&(this.navWidget.isAlignLeft=!1,this.navWidget.isAlignRight=!1,this.backgroundWidget.left=0,this.backgroundWidget.right=0,this.layoutWidget.left=25,this.layoutWidget.right=25,this.uiTransform.width=1e3)}},{key:"handleViewResized",value:function(){this.selectedButton&&this.selectorNode.setWorldPosition(this.selectedButton.node.worldPosition.x,this.selectorNode.worldPosition.y,0)}}]),u}(re)).prototype,"selectorNode",[HF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QF=D(ZF.prototype,"selectedButtonNode",[VF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$F=D(ZF.prototype,"autoLayout",[qF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ex=D(ZF.prototype,"navWidget",[WF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tx=D(ZF.prototype,"backgroundWidget",[KF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nx=D(ZF.prototype,"layoutWidget",[jF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ix=D(ZF.prototype,"uiTransform",[YF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XF=ZF))||XF);J._RF.pop(),J._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var Jx,Qx=Q.ccclass,$x=Q.disallowMultiple,eU=Q.property,tU=globalThis.game,nU=tU.event,iU=tU.storage,aU=tU.player,oU=tU.leaderboard,rU=GameCore,lU=rU.Events,sU=rU.Match.Modes,uU=rU.Configs.DailyRewards,cU=rU.Utils,hU=cU.Time,pU=cU.Array;dx=Qx("DashboardScene"),yx=a.required(),vx=eU(DI),fx=a.required(),gx=eU(Zx),mx=a.required(),bx=eU(fn),wx=a.required(),kx=eU(sz),Sx=a.required(),Cx=eU(HL),Ex=a.onlyRunInLifeCycle,Ax=a.onlyRunInLifeCycle,Tx=a.onlyRunInLifeCycleAsync,Rx=a.onlyRunInLifeCycleAsync,Px=a.onlyRunInLifeCycleAsync,Ox=a.onlyRunInLifeCycleAsync,Ix=a.onlyRunInLifeCycle,Lx=a.onlyRunInLifeCycleAsync,_x=a.onlyRunInLifeCycleAsync,Dx=a.onlyRunInLifeCycleAsync,Mx=a.onlyRunInLifeCycleAsync,Nx=a.onlyRunInLifeCycleAsync,zx=a.onlyRunInLifeCycleAsync,Bx=a.onlyRunInLifeCycleAsync,Fx=a.onlyRunInLifeCycle,dx(xx=$x((Gx=D((Ux=function(t){B(E,t);var n,i,o,s,u,c,h,p,d,y,v,f,g,m,k=F(E);function E(){var t;N(this,E);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=k.call.apply(k,[this].concat(i)),z(t,"coinManager",Gx,x(t)),z(t,"navManager",Hx,x(t)),z(t,"bgComp",Vx,x(t)),z(t,"pageManager",qx,x(t)),z(t,"pageAnimSkipOverlay",Wx,x(t)),t.firstNavigation=!0,t.isFirstNavToCollections=!0,t.isFirstNavToTournament=!0,t.navigationSignal=null,t.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch((function(e){console.warn("subscribeBotAsync",e)}))},t.playBgAnim=q((function*(){var n,i=iU.getStorage("dashboard");if(null==i)throw new Error("DashboardScene: dashboardStorage not found");var a=null!==(n=i.animateToCurrentLevel)&&void 0!==n&&n,o=U({},i.lastMapPayload),r=zs.getCurrentMapProgress(),l=o.currentTheme===r.currentTheme&&o.nextTheme===r.nextTheme,s=r.currentTheme;if(a&&!l){yield e.waitTweenAsync(2);try{yield t.bgComp.animateToNextTheme(s)}catch(e){}}})),t}return M(E,[{key:"__preload",value:function(){}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(Bt,this.onNavigate,this)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(zt,this.handlePlayButtonPress,this),this.node.scene.on(xt,this.handleEventButtonPress,this)}},{key:"onLoad",value:function(){a.validateRequiredProperties(this),this.listenNavigationEvents(),this.listenDashboardEvents(),this.coinManager.init(),zs.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(zs.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var e,t=(null!==(e=aU.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;n=0===n?1:n,aU.setGameData({level:n})}},{key:"start",value:function(){aU.getPlayerSetting("music")&&this.updateMusic(),this.playBgAnim(),this.pageManager.init(),this.navManager.selectDefaultNavBtn(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadScenes",value:function(){C.preloadGameScene()}},{key:"initBgComp",value:function(){var e,t=iU.getStorage("dashboard");if(null==t)throw new Error("DashboardScene: dashboardStorage not found");var n=null!==(e=t.animateToCurrentLevel)&&void 0!==e&&e,i=U({},t.lastMapPayload),a=zs.getCurrentMapProgress(),o=i.currentTheme===a.currentTheme&&i.nextTheme===a.nextTheme,r=a.currentTheme;n&&!o?this.bgComp.setCurrentTheme(i.currentTheme):this.bgComp.setCurrentTheme(r)}},{key:"handlePlayButtonPress",value:(m=q((function*(){try{var e,t=zs.getCurrentMapProgress(),n=(null!==(e=aU.getGameData())&&void 0!==e?e:{}).level,i=void 0===n?1:n;yield Js.setMatchCustomDataAsync({level:i}),yield Js.startMatchAsync(sU.SINGLE),this.updateCurrentMapInStorage(t),iU.setStorageData("collection","lastMapPack",t.id),iU.setStorageData("collection","animateMapPackUnlock",!1);var a=iU.getStorage("leaderboard_content").lastTabOpened;this.getPlayerLeader(a).then((function(e){if(e){var t=e.score;iU.setStorageData("leaderboard_content","previousScore",t)}})),C.switchScene(A.GAME_SCENE,{level:i})}catch(e){return void console.error(e)}})),function(){return m.apply(this,arguments)})},{key:"getPlayerLeader",value:(g=q((function*(e){var t="global"===e?R.GLOBAL:R.FRIENDS;if(!t)return null;var n=aU.getPlayerId(),i=yield oU.getLeadersByPlayerIdsAsync(t,[n]);return 0===i.length?null:i[0]})),function(e){return g.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(e){iU.setStorageData("dashboard","animateToCurrentLevel",!1),iU.setStorageData("dashboard","lastMapPayload",e)}},{key:"updateMusic",value:(f=q((function*(){l.getCurrentMusic()!==wn.BG_MUSIC&&(yield l.setVolumeMusic(0,!0),yield e.waitTweenAsync(1)),l.playMusic(wn.BG_MUSIC),l.turnUpMusic()})),function(){return f.apply(this,arguments)})},{key:"checkDailyRewardsOpenable",value:function(){var e=aU.getPlayerData().dailyRewarded,t=e.logDays,n=void 0===t?[]:t,i=e.lastRewarded,a=void 0===i?0:i;if(n.length>uU.MaxDays)return!0;if(uU.MockTime>0&&Date.now()-a>=1e3*uU.MockTime)return!0;return!hU.isToday(a)}},{key:"onNavigate",value:(v=q((function*(e){switch(this.firstNavigation&&(this.firstNavigation=!1,this.pageManager.unmountAndHideAll()),e.to){case cn.store:break;case cn.collections:yield this.triggerPageNavigation(e),yield this.handleLogicAfterNavigateToCollections(),this.cleanupAfterPageNavigation();break;case cn.tournaments:case cn.leaderboard:yield this.triggerPageNavigation(e),this.cleanupAfterPageNavigation();break;case cn.home:yield this.handleNavigateToHome(e);break;default:throw new Error("DashboardScene: Unhandled page name")}})),function(e){return v.apply(this,arguments)})},{key:"handleLogicAfterNavigateToCollections",value:(y=q((function*(){var e,t=null===(e=this.pageManager.getPage(cn.collections))||void 0===e?void 0:e.getContainer().getComponentInChildren(nN);if(null==t)throw new Error("CollectionsContent not found");var n=new r,i=t.shouldAnimateThemeBlockUnlock();i&&(yield this.openSkipOverlay(n)),yield this.tryPlayScrollToCollectionAnim(t,n),yield t.playThemeTabUnlockAnim(n),i&&(yield this.closeSkipOverlay()),n.abort()})),function(){return y.apply(this,arguments)})},{key:"closeSkipOverlay",value:(d=q((function*(){yield this.pageAnimSkipOverlay.close()})),function(){return d.apply(this,arguments)})},{key:"openSkipOverlay",value:(p=q((function*(e){yield this.pageAnimSkipOverlay.open({onSkip:function(){return e.abort()},opacity:200})})),function(e){return p.apply(this,arguments)})},{key:"tryPlayScrollToCollectionAnim",value:(h=q((function*(e,t){var n=zs.getCurrentUnlockingThemeIndex();this.isFirstNavToCollections&&null!==n&&(yield e.scrollToCurrentUnlockingTheme(n,t),this.isFirstNavToCollections=!1)})),function(e,t){return h.apply(this,arguments)})},{key:"cleanupAfterPageNavigation",value:function(){this.navManager.setIgnoreInput(!1)}},{key:"triggerPageNavigation",value:(c=q((function*(e){var t;null===(t=this.navigationSignal)||void 0===t||t.abort(),this.navigationSignal=new r,yield this.pageManager.navigate(e,this.navigationSignal)})),function(e){return c.apply(this,arguments)})},{key:"handleNavigateToHome",value:(u=q((function*(e){var t,n=this;null===(t=this.navigationSignal)||void 0===t||t.abort(),this.navigationSignal=new r,yield this.pageManager.navigate(e,this.navigationSignal,q((function*(){n.initializeHomepageCoinManager()}))),yield this.handleLogicAfterNavigateToHome()})),function(e){return u.apply(this,arguments)})},{key:"handleLogicAfterNavigateToHome",value:(s=q((function*(){yield this.tryOpenDailyRewardsScreen(),this.attemptCallSubscribeBot(),yield this.waitUntilCoinManagerFinishesAnyAnimation(),yield this.waitUntilPageAnimSkipOverlayCloses(),yield this.tryNavigateToTournament(),yield this.tryPlayLevelUpAnimation()})),function(){return s.apply(this,arguments)})},{key:"waitUntilCoinManagerFinishesAnyAnimation",value:function(){return this.coinManager.untilFinishesCollectAnim()}},{key:"waitUntilPageAnimSkipOverlayCloses",value:function(){return this.pageAnimSkipOverlay.untilClosed()}},{key:"tryNavigateToTournament",value:(o=q((function*(){if(iU.getStorage("tournament").animateTournamentLeader)return yield this.navManager.selectByType(cn.tournaments);if(this.isFirstNavToTournament){this.isFirstNavToTournament=!1;try{if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");if((yield GameSDK.getTournamentAsync()).getEndTime()<Date.now()/1e3)return yield this.navManager.selectByType(cn.tournaments)}catch(e){}}})),function(){return o.apply(this,arguments)})},{key:"tryPlayLevelUpAnimation",value:(i=q((function*(){var e,t=this,n=null===(e=this.pageManager.getPage(cn.home))||void 0===e?void 0:e.getContainer().getComponentInChildren(px);if(null==n)throw new Error("DashboardScene: Homepage not found");var i=new r;i.chain(this.navigationSignal);var a=n.shouldPlayUnlockAnimation(),o=this.shouldPlayPackUnlockAnimation();a&&(o&&(yield this.pageAnimSkipOverlay.open({onSkip:function(){return i.abort()},opacity:150})),yield n.playUnlockProgressAnimation(i),o&&(yield this.pageAnimSkipOverlay.close(),yield i.callAsync((function(){return t.navManager.selectByType(cn.collections)}))))})),function(){return i.apply(this,arguments)})},{key:"shouldPlayPackUnlockAnimation",value:function(){var e=iU.getStorage("dashboard");if(null==e)throw new Error("DashboardScene: dashboardStorage not found");var t=e.lastMapPayload,n=zs.getCurrentMapProgress();return!(pU.searchIndex(Ls.mapOrder,(function(e){return e.id===t.id}))===pU.searchIndex(Ls.mapOrder,(function(e){return e.id===n.id})))}},{key:"initializeHomepageCoinManager",value:function(){var e,t=null===(e=this.pageManager.getPage(cn.home))||void 0===e?void 0:e.getContainer().getComponentInChildren(px);if(null==t)throw new Error("DashboardScene: Homepage not found");this.coinManager.setTargetContainer(t.getCoinContainer()),this.coinManager.emitCoinAmount()}},{key:"tryOpenDailyRewardsScreen",value:(n=q((function*(){if(this.checkDailyRewardsOpenable())return b.openScreen(w.DAILY_REWARDS_SCREEN),new Promise((function(e){nU.on(lU.CLOSED_SCREEN,(function t(n){n.screenName===S[w.DAILY_REWARDS_SCREEN]&&(e(),nU.off(lU.CLOSED_SCREEN,t))}))}))})),function(){return n.apply(this,arguments)})},{key:"handleEventButtonPress",value:function(e){switch(e.type){case oO.STAR_CHEST:b.openScreen(w.STAR_CHEST_SCREEN);break;case oO.BALLOON:b.showNotificationScreenWithLocalizedKey("error.soon");break;default:throw new Error("DashboardScene: Unhandled event button type")}}},{key:"handleTestLayoutButtonClicked",value:function(){}}]),E}(re)).prototype,"coinManager",[yx,vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hx=D(Ux.prototype,"navManager",[fx,gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vx=D(Ux.prototype,"bgComp",[mx,bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qx=D(Ux.prototype,"pageManager",[wx,kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wx=D(Ux.prototype,"pageAnimSkipOverlay",[Sx,Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(Ux.prototype,"preloadScenes",[Ex],Object.getOwnPropertyDescriptor(Ux.prototype,"preloadScenes"),Ux.prototype),D(Ux.prototype,"initBgComp",[Ax],Object.getOwnPropertyDescriptor(Ux.prototype,"initBgComp"),Ux.prototype),D(Ux.prototype,"handlePlayButtonPress",[Tx],Object.getOwnPropertyDescriptor(Ux.prototype,"handlePlayButtonPress"),Ux.prototype),D(Ux.prototype,"onNavigate",[Rx],Object.getOwnPropertyDescriptor(Ux.prototype,"onNavigate"),Ux.prototype),D(Ux.prototype,"handleLogicAfterNavigateToCollections",[Px],Object.getOwnPropertyDescriptor(Ux.prototype,"handleLogicAfterNavigateToCollections"),Ux.prototype),D(Ux.prototype,"tryPlayScrollToCollectionAnim",[Ox],Object.getOwnPropertyDescriptor(Ux.prototype,"tryPlayScrollToCollectionAnim"),Ux.prototype),D(Ux.prototype,"cleanupAfterPageNavigation",[Ix],Object.getOwnPropertyDescriptor(Ux.prototype,"cleanupAfterPageNavigation"),Ux.prototype),D(Ux.prototype,"triggerPageNavigation",[Lx],Object.getOwnPropertyDescriptor(Ux.prototype,"triggerPageNavigation"),Ux.prototype),D(Ux.prototype,"handleNavigateToHome",[_x],Object.getOwnPropertyDescriptor(Ux.prototype,"handleNavigateToHome"),Ux.prototype),D(Ux.prototype,"waitUntilCoinManagerFinishesAnyAnimation",[Dx],Object.getOwnPropertyDescriptor(Ux.prototype,"waitUntilCoinManagerFinishesAnyAnimation"),Ux.prototype),D(Ux.prototype,"waitUntilPageAnimSkipOverlayCloses",[Mx],Object.getOwnPropertyDescriptor(Ux.prototype,"waitUntilPageAnimSkipOverlayCloses"),Ux.prototype),D(Ux.prototype,"tryNavigateToTournament",[Nx],Object.getOwnPropertyDescriptor(Ux.prototype,"tryNavigateToTournament"),Ux.prototype),D(Ux.prototype,"tryPlayLevelUpAnimation",[zx],Object.getOwnPropertyDescriptor(Ux.prototype,"tryPlayLevelUpAnimation"),Ux.prototype),D(Ux.prototype,"tryOpenDailyRewardsScreen",[Bx],Object.getOwnPropertyDescriptor(Ux.prototype,"tryOpenDailyRewardsScreen"),Ux.prototype),D(Ux.prototype,"handleEventButtonPress",[Fx],Object.getOwnPropertyDescriptor(Ux.prototype,"handleEventButtonPress"),Ux.prototype),xx=Ux))||xx);J._RF.pop(),J._RF.push({},"1be4fAboTNK3IFk6IiygYLZ","PageContent",void 0);var dU,yU,vU,fU,gU,mU=Q.ccclass,bU=n.Layout;mU("PageContent")(Jx=function(e){B(i,e);var n=F(i);function i(){return N(this,i),n.apply(this,arguments)}return M(i,[{key:"__preload",value:function(){this.widget=this.getComponent(ne),this.uiTransform=this.getComponent($)}},{key:"onLoad",value:function(){oe.on(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(Mt.getCurrentLayout())}},{key:"onDestroy",value:function(){oe.off(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"handleOrientationChanged",value:function(e){e===bU.Portrait?(this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0):e===bU.Landscape&&(this.widget.isAlignLeft=!1,this.widget.isAlignRight=!1,this.uiTransform.width=1e3)}}]),i}(re));J._RF.pop(),J._RF.push({},"c68178FyxlCOqbCt/+wktvw","PageHeader",void 0);var wU,kU,SU,CU,EU,AU,TU,RU,PU,OU,IU,LU,_U=Q.ccclass,DU=Q.property,MU=n.Layout;dU=_U("PageHeader"),yU=DU(ne),dU((gU=D((fU=function(e){B(r,e);var n,i,a=F(r);function r(){var e;N(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),z(e,"widget",gU,x(e)),e}return M(r,[{key:"__preload",value:function(){Mt.isLandscape()&&this.loadLeaves()}},{key:"onLoad",value:function(){oe.on(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(Mt.getCurrentLayout())}},{key:"onDestroy",value:function(){oe.off(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"handleOrientationChanged",value:(i=q((function*(e){e===MU.Portrait?(this.leaves&&(this.leaves.active=!1),this.widget.left=-80,this.widget.right=-80):e===MU.Landscape&&(this.widget.left=0,this.widget.right=0,yield this.loadLeaves(),this.leaves&&(this.leaves.active=!0))})),function(e){return i.apply(this,arguments)})},{key:"loadLeaves",value:(n=q((function*(){if(!this.leaves){var e=yield o.loadPrefabAsync(v.PAGE_LEAVES_PREFAB);!this.leaves&&e&&(this.leaves=Ge(e),this.node.addChild(this.leaves))}})),function(){return n.apply(this,arguments)})}]),r}(re)).prototype,"widget",[yU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vU=fU));J._RF.pop(),J._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var NU,zU=Q.ccclass,BU=Q.property,FU=globalThis.game,xU=FU.player,UU=FU.storage,GU=FU.monitorError,HU=GameCore.Utils.Number;wU=zU("HomePage"),kU=a.required(),SU=BU({type:we,group:"Placeholders"}),CU=a.required(),EU=a.onlyRunInLifeCycleAsync,AU=a.onlyRunInLifeCycle,TU=a.onlyRunInLifeCycleAsync,RU=a.onlyRunInLifeCycleAsync,wU((IU=D((OU=function(e){B(r,e);var t,n,i,a,o=F(r);function r(){var e;N(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),z(e,"coinLabel",IU,x(e)),z(e,"panelAnimationController",LU,x(e)),e}return M(r,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(Ea),H(V(r.prototype),"onLoad",this).call(this)}},{key:"onEnable",value:function(){this.node.scene.on(oa.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"onDisable",value:function(){this.node.scene.off(oa.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"updatePlaceholderCoins",value:(a=q((function*(e){this.coinLabel.string=HU.getShortNumber(e.coins,3)})),function(e){return a.apply(this,arguments)})},{key:"mount",value:(i=q((function*(){yield H(V(r.prototype),"mount",this).call(this),this.onMount()})),function(){return i.apply(this,arguments)})},{key:"onMount",value:function(){var e,t,n;if(!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(px),!this.homeContent))throw new Error("HomePage: homeContent not found");var i=xU.getGameData(),a=null!==(e=null==i?void 0:i.coins)&&void 0!==e?e:0;this.updatePlaceholderCoins({coins:a});var o=null!==(t=null==i?void 0:i.level)&&void 0!==t?t:1;this.homeContent.setPlayButton(o);var r=null!==(n=null==i?void 0:i.stars)&&void 0!==n?n:0;this.homeContent.updateStarProgress(r),this.initUnlockProgressData()}},{key:"initUnlockProgressData",value:function(){var e=this.homeContent.shouldPlayUnlockAnimation(),t=U({},zs.getCurrentMapProgress()),n=UU.getStorage("dashboard");if(null==n)return null==GU||GU.sendException(new Error("DashboardScene: dashboardStorage not found")),void(e||this.homeContent.setUnlockProgress(t));var i=U({},n.lastMapPayload);e?this.homeContent.setUnlockProgress(i):this.homeContent.setUnlockProgress(t)}},{key:"transitionIn",value:(n=q((function*(){this.homeContent.transitionIn(),yield H(V(r.prototype),"transitionIn",this).call(this),yield this.panelAnimationController.showUI()})),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=q((function*(){this.homeContent.transitionOut(),yield H(V(r.prototype),"transitionOut",this).call(this),yield this.panelAnimationController.hideUI()})),function(){return t.apply(this,arguments)})},{key:"hasLoadedPage",value:function(){return!0}}]),r}(RD)).prototype,"coinLabel",[kU,SU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LU=D(OU.prototype,"panelAnimationController",[CU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(OU.prototype,"mount",[EU],Object.getOwnPropertyDescriptor(OU.prototype,"mount"),OU.prototype),D(OU.prototype,"onMount",[AU],Object.getOwnPropertyDescriptor(OU.prototype,"onMount"),OU.prototype),D(OU.prototype,"transitionIn",[TU],Object.getOwnPropertyDescriptor(OU.prototype,"transitionIn"),OU.prototype),D(OU.prototype,"transitionOut",[RU],Object.getOwnPropertyDescriptor(OU.prototype,"transitionOut"),OU.prototype),PU=OU));J._RF.pop(),J._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var VU,qU,WU,KU,jU,YU,XU,ZU,JU,QU,$U,eG,tG,nG,iG,aG,oG,rG,lG,sG,uG=(0,Q.ccclass)("LeaderboardIsEmpty")(NU=function(t){B(o,t);var n,i=F(o);function o(){return N(this,o),i.apply(this,arguments)}return M(o,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"show",value:(n=q((function*(){this.uiOpacity.opacity=255;var t=this.node.position.clone(),n=ie(this.node);n.to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)});var i=ie(this.node).repeat(2,n);i.to(.05,{position:t}),yield e.runTweenAsync(i)})),function(){return n.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),o}(re))||NU;J._RF.pop(),J._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var cG,hG,pG,dG,yG,vG,fG,gG=Q.ccclass,mG=Q.property,bG=Q.requireComponent,wG=globalThis.game.analytics,kG=GameCore,SG=kG.Utils.Array,CG=kG.Plugins.Analytics.Events,EG=(VU=gG("SwitchButton"),qU=bG([ve,Be]),WU=mG(ye),KU=mG(ge),jU=mG(ge),YU=mG(ye),XU=mG({visible:function(){return this.useSound},type:Sn}),ZU=mG(ye),JU=mG({visible:function(){return this.useDesktopHover},type:nt}),QU=mG({visible:function(){return this.useDesktopHover},type:nt}),VU($U=qU((tG=D((eG=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"enable",tG,x(e)),z(e,"nodeOn",nG,x(e)),z(e,"nodeOff",iG,x(e)),z(e,"useSound",aG,x(e)),z(e,"soundKey",oG,x(e)),z(e,"useDesktopHover",rG,x(e)),z(e,"mouseEnterClip",lG,x(e)),z(e,"mouseLeaveClip",sG,x(e)),e.isMouseLeaved=!1,e.onMouseEnter=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved=!1,e.animationComponent.play(e.mouseEnterClip.name))},e.onMouseLeave=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved||(e.isMouseLeaved=!0,e.animationComponent.play(e.mouseLeaveClip.name)))},e}return M(n,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(ve),this.animationComponent=this.getComponent(Be),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var e=this.animationComponent.clips.map((function(e){return null==e?void 0:e.name})).filter((function(e){return null!=e&&"string"==typeof e}));this.useDesktopHover&&(SG.has(e,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),SG.has(e,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(ge.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(ge.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(wG.event(CG.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&l.playSound(ai[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(e){this.node.active&&this.updateStatus(e)}},{key:"updateStatus",value:function(e){return this.enable===e||(this.onMouseLeave(null),this.enable=e,this.nodeOn.active=e,this.nodeOff.active=!e),this.enable}}]),n}(re)).prototype,"enable",[WU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),nG=D(eG.prototype,"nodeOn",[KU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iG=D(eG.prototype,"nodeOff",[jU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aG=D(eG.prototype,"useSound",[YU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),oG=D(eG.prototype,"soundKey",[XU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sn[wn.BUTTON_CLICK]}}),rG=D(eG.prototype,"useDesktopHover",[ZU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lG=D(eG.prototype,"mouseEnterClip",[JU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sG=D(eG.prototype,"mouseLeaveClip",[QU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$U=eG))||$U)||$U);J._RF.pop(),J._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var AG,TG,RG,PG,OG,IG,LG,_G,DG,MG=Q.ccclass,NG=Q.property,zG=globalThis.game.analytics,BG=GameCore.Plugins.Analytics.Events,FG=(cG=MG("Tabs"),hG=NG(EG),pG=NG(EG),cG((vG=D((yG=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"tabWorld",vG,x(e)),z(e,"tabFriends",fG,x(e)),e}return M(n,[{key:"onLoad",value:function(){"MsGames"===GameSDK.getSDKName()&&(this.tabWorld.node.active=!1,this.tabFriends.node.active=!1)}},{key:"setInteractableButtons",value:function(e){this.tabWorld.getComponent(ve).interactable=e,this.tabFriends.getComponent(ve).interactable=e}},{key:"updateStatus",value:function(e){this.tabWorld.setEnabled("global"===e),this.tabFriends.setEnabled("friends"===e)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),l.playSound(wn.BUTTON_CLICK),zG.event(BG.BUTTON_CLICK,{button_name:this.node.name,screen_name:s.getCurrentPage()}),this.node.scene.emit(lO.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),l.playSound(wn.BUTTON_CLICK),zG.event(BG.BUTTON_CLICK,{button_name:this.node.name,screen_name:s.getCurrentPage()}),this.node.scene.emit(lO.FRIENDS_TAB_SELECTED)}}]),n}(re)).prototype,"tabWorld",[hG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fG=D(yG.prototype,"tabFriends",[pG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dG=yG))||dG);J._RF.pop(),J._RF.push({},"91613SO4bxPDq9dH9zxyIef","LeaderboardTimer",void 0);var xG,UG,GG,HG,VG,qG=Q.ccclass,WG=Q.property,KG=GameCore.Utils.Time,jG=globalThis.game.language,YG=(AG=qG("LeaderboardTimer"),TG=WG($),RG=WG(ge),PG=WG(p),AG((LG=D((IG=function(t){B(o,t);var n,i=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n)),z(e,"background",LG,x(e)),z(e,"calendar",_G,x(e)),z(e,"timerLocalizer",DG,x(e)),e.alreadyShown=!1,e}return M(o,[{key:"onLoad",value:function(){this.timerOpacity=this.timerLocalizer.node.getComponent(he),this.validateRequiredComponents(),this.backgroundDefaultWidth=this.background.width,this.calendarDefaultPosition=this.calendar.position.clone()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"show",value:(n=q((function*(t){if(!this.alreadyShown&&!t.aborted){this.alreadyShown=!0;var n=ie(this.calendar).to(.3,{scale:Oe.ONE},{easing:"backOut"}).to(.3,{position:this.calendarDefaultPosition.clone()},{easing:"quadOut"}),i=ie(this.background).delay(.3).to(.3,{width:this.backgroundDefaultWidth},{easing:"quadOut"}),a=ie(this.timerOpacity).to(.3,{opacity:255});yield Promise.all([e.runTweenAsync(n,t),e.runTweenAsync(i,t)]),this.calendar.scale=Oe.ONE,this.calendar.position=this.calendarDefaultPosition.clone(),this.background.width=this.backgroundDefaultWidth,yield e.runTweenAsync(a,t),this.timerOpacity.opacity=255}})),function(e){return n.apply(this,arguments)})},{key:"reset",value:function(){this.alreadyShown||(this.calendar.position=this.background.node.position.clone(),this.calendar.scale=Oe.ZERO,this.background.width=0,this.timerOpacity.opacity=0)}},{key:"setTimeLabel",value:function(e){if(e){var t=new Date,n=0;if("manually"===e)n=0;else if("daily"===e)n=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()+1);else if("weekly"===e){var i=t.getUTCDay(),a=0===i?1:8-i;n=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()+a)}else n="monthly"===e?Date.UTC(t.getUTCFullYear(),t.getUTCMonth()+1):Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()+1);try{var o=KG.getRelativeTime(n/1e3,jG.getCurrentLocale());this.timerLocalizer.key="game.endsIn",this.timerLocalizer.setParams([o])}catch(e){this.timerLocalizer.key="game.endsSoon"}}else this.timerLocalizer.key="game.endsSoon"}}]),o}(re)).prototype,"background",[TG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_G=D(IG.prototype,"calendar",[RG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DG=D(IG.prototype,"timerLocalizer",[PG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OG=IG))||OG);J._RF.pop(),J._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var XG,ZG,JG,QG,$G,eH,tH,nH,iH,aH,oH,rH,lH,sH,uH,cH,hH,pH,dH,yH,vH,fH,gH,mH,bH,wH,kH,SH,CH,EH,AH,TH,RH,PH,OH,IH,LH,_H,DH,MH,NH,zH,BH,FH,xH=Q.ccclass,UH=Q.disallowMultiple,GH=Q.property,HH=(xG=xH("LeaderSkeleton"),UG=GH(ge),xG(GG=UH((VG=D((HG=function(t){B(o,t);var n,i,a=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),z(e,"container",VG,x(e)),e}return M(o,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"hide",value:(i=q((function*(t){var n=this;yield e.runTweenAsync(ie(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t)})),function(e){return i.apply(this,arguments)})},{key:"show",value:(n=q((function*(t,n){var i=this;this.node.active=!0,this.uiOpacity.opacity=0;var a=this.container.position.clone();this.container.position=new Oe(a.x,a.y-100,a.z);var o=ie(this.container).delay(t);o.to(.2,{position:a},{easing:"cubicOut"});var r=ie(this.uiOpacity).delay(t);r.to(.2,{opacity:255},{easing:"cubicOut"}),n.addAbortListener((function(){i.container.position=a,i.uiOpacity.opacity=255})),yield Promise.all([e.runTweenAsync(o,n),e.runTweenAsync(r,n)])})),function(e,t){return n.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),o}(re)).prototype,"container",[UG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GG=HG))||GG)||GG);J._RF.pop(),J._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var VH,qH,WH,KH,jH,YH,XH,ZH,JH,QH,$H,eV,tV,nV=Q.ccclass,iV=Q.property,aV=GameCore.Utils.Number,oV=(XG=nV("Leader"),ZG=iV(we),JG=iV(he),QG=iV({type:ge,group:"Container"}),$G=iV({type:se,group:"Background"}),eH=iV({type:ze,group:"Background"}),tH=iV({type:se,group:"Rank"}),nH=iV({type:we,group:"Rank"}),iH=iV({type:ze,group:"Rank"}),aH=iV({type:ze,group:"Rank"}),oH=iV({type:ze,group:"Rank"}),rH=iV({type:ze,group:"Rank"}),lH=iV({type:se,group:"Avatar"}),sH=iV({type:he,group:"Avatar"}),uH=iV({type:se,group:"Score"}),cH=iV({type:we,group:"Score"}),hH=iV({type:ze,group:"Score"}),pH=iV({type:he,group:"Score"}),dH=iV({type:he}),yH=iV({type:$}),vH=a.onlyRunInLifeCycle,fH=a.onlyRunInLifeCycleAsync,gH=a.onlyRunInLifeCycle,XG((wH=D((bH=function(t){B(c,t);var n,i,o,l,s,u=F(c);function c(){var e;N(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=u.call.apply(u,[this].concat(n)),z(e,"nameLabel",wH,x(e)),z(e,"nameOpacity",kH,x(e)),z(e,"container",SH,x(e)),z(e,"background",CH,x(e)),z(e,"highlightBackground",EH,x(e)),z(e,"rankSprite",AH,x(e)),z(e,"rankLabel",TH,x(e)),z(e,"goldRank",RH,x(e)),z(e,"silverRank",PH,x(e)),z(e,"bronzeRank",OH,x(e)),z(e,"highlightRank",IH,x(e)),z(e,"avatar",LH,x(e)),z(e,"avatarOpacity",_H,x(e)),z(e,"scoreBackground",DH,x(e)),z(e,"scoreLabel",MH,x(e)),z(e,"highlightScoreBackground",NH,x(e)),z(e,"scoreOpacity",zH,x(e)),z(e,"uiOpacity",BH,x(e)),z(e,"uiTransform",FH,x(e)),e.signal=new r,e}return M(c,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.defaultAvatar=this.avatar.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e,t){this.updateBackground(e),this.updateRank(e,t),this.updatePhoto(e),this.updateUsername(e),this.updateScore(e)}},{key:"updateBackground",value:function(e){this.background.spriteFrame=e.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(e,t){var n=e.rank;this.rankLabel.string=t&&n>t?"".concat(t,"+"):n.toString(),this.rankSprite.spriteFrame=this.defaultRank;var i=new be(pO);switch(e.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,i=new be(yO)),n){case 1:this.rankSprite.spriteFrame=this.goldRank,i=new be(sO);break;case 2:this.rankSprite.spriteFrame=this.silverRank,i=new be(uO);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,i=new be(cO)}this.rankLabel.shadowColor=i,this.rankLabel.outlineColor=i}},{key:"updatePhoto",value:(s=q((function*(t){this.signal.abort();var n=new r;if(this.signal=n,this.avatar){var i=t.playerId,a=t.photo;if(WE.isAvatarCached(t.playerId,70)){var o=yield WE.getPlayerAvatar(a,i,70,n);if(!o||n.aborted)return;this.setPhoto(o)}else if(this.avatar.spriteFrame=this.defaultAvatar,yield e.waitTweenAsync(.1,n),!n.aborted){var l=yield WE.getPlayerAvatar(a,i,70,n);l&&!n.aborted&&this.setPhoto(l)}}})),function(e){return s.apply(this,arguments)})},{key:"setPhoto",value:function(e){this.node.active&&(e.packable=!0,this.avatar.spriteFrame=e)}},{key:"updateUsername",value:function(e){this.nameLabel.string=e.name,this.nameLabel.color=new be(e.isHighlight?dO:hO)}},{key:"updateScore",value:function(e){var t=Math.floor(e.score);this.scoreLabel.string=aV.getShortNumber(t,7);var n=this.scoreLabel.getComponent(we);n.outlineColor=new be(e.isHighlight?yO:pO),n.shadowColor=new be(e.isHighlight?yO:pO),this.scoreBackground.spriteFrame=e.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(l=q((function*(t,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;this.setVisible(!1);var o=this.container.position.clone();this.container.position=new Oe(o.x,o.y-100,o.z);var r=ie(this.container).delay(n);r.to(a,{position:o},{easing:"backOut"});var l=ie(this.uiOpacity).delay(n);l.to(a,{opacity:255},{easing:"cubicOut",onUpdate:function(){i.nameOpacity.opacity=i.uiOpacity.opacity,i.scoreOpacity.opacity=i.uiOpacity.opacity,i.avatarOpacity.opacity=i.uiOpacity.opacity}}),t.addAbortListener((function(){i.container.position=o,i.uiOpacity.opacity=255,i.avatar.node.active=!0})),yield Promise.all([e.runTweenAsync(r,t),e.runTweenAsync(l,t)])})),function(e,t){return l.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(o=q((function*(t,n,i){var a=ie(this.node).to(n,{worldPosition:t},{easing:"quadOut"});yield e.runTweenAsync(a,i)})),function(e,t,n){return o.apply(this,arguments)})},{key:"runScaleAnimation",value:(i=q((function*(t,n,i){var a=ie(this.node).to(n,{scale:new Oe(t,t,t)},{easing:"backOut"});yield e.runTweenAsync(a,i)})),function(e,t,n){return i.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(n=q((function*(t,n,i,a,o,r){var l=this;yield e.runOnUpdateAsync(this.node,o,(function(e){var o=Math.floor(t+(n-t)*e),r=Math.floor(i+(a-i)*e);l.updateRank({rank:o,isHighlight:!0}),l.updateScore({score:r,isHighlight:!0})}),r)})),function(e,t,i,a,o,r){return n.apply(this,arguments)})},{key:"setVisible",value:function(e){var t=e?255:0;this.uiOpacity.opacity=t,this.nameOpacity.opacity=t,this.scoreOpacity.opacity=t,this.avatarOpacity.opacity=t}}]),c}(re)).prototype,"nameLabel",[ZG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kH=D(bH.prototype,"nameOpacity",[JG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SH=D(bH.prototype,"container",[QG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CH=D(bH.prototype,"background",[$G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EH=D(bH.prototype,"highlightBackground",[eH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AH=D(bH.prototype,"rankSprite",[tH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TH=D(bH.prototype,"rankLabel",[nH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RH=D(bH.prototype,"goldRank",[iH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PH=D(bH.prototype,"silverRank",[aH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OH=D(bH.prototype,"bronzeRank",[oH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IH=D(bH.prototype,"highlightRank",[rH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LH=D(bH.prototype,"avatar",[lH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_H=D(bH.prototype,"avatarOpacity",[sH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DH=D(bH.prototype,"scoreBackground",[uH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MH=D(bH.prototype,"scoreLabel",[cH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NH=D(bH.prototype,"highlightScoreBackground",[hH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zH=D(bH.prototype,"scoreOpacity",[pH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BH=D(bH.prototype,"uiOpacity",[dH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FH=D(bH.prototype,"uiTransform",[yH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(bH.prototype,"updateInfo",[vH],Object.getOwnPropertyDescriptor(bH.prototype,"updateInfo"),bH.prototype),D(bH.prototype,"updatePhoto",[fH],Object.getOwnPropertyDescriptor(bH.prototype,"updatePhoto"),bH.prototype),D(bH.prototype,"setPhoto",[gH],Object.getOwnPropertyDescriptor(bH.prototype,"setPhoto"),bH.prototype),mH=bH))||mH);J._RF.pop(),J._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var rV,lV,sV,uV,cV,hV,pV,dV,yV,vV,fV,gV,mV,bV,wV,kV,SV,CV,EV,AV,TV,RV,PV,OV,IV,LV,_V=Q.ccclass,DV=Q.property,MV=globalThis.game.player,NV=GameCore.Utils.Array,zV=(VH=_V("Leaders"),qH=DV(hD),WH=DV(oV),KH=DV(ee),jH=a.onlyRunInLifeCycleAsync,YH=a.onlyRunInLifeCycleAsync,XH=a.onlyRunInLifeCycleAsync,ZH=a.onlyRunInLifeCycleAsync,VH(($H=D((QH=function(e){B(u,e);var t,n,i,o,r,l,s=F(u);function u(){var e;N(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),z(e,"scrollView",$H,x(e)),z(e,"tempLeader",eV,x(e)),z(e,"maxLeader",tV,x(e)),e.leaderData=[],e.displayLeaderData=[],e.displayPlayerLeader=null,e.isHidden=!0,e}return M(u,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent($),this.batchNodes=this.getComponents(cs),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=MV.getPlayerId()}},{key:"updateData",value:(l=q((function*(e){this.isHidden=!1,this.leaderData=e,this.leaderData.forEach((function(e,t){e.rank=t+1})),this.setupDisplayLeadersData()})),function(e){return l.apply(this,arguments)})},{key:"initScrollViews",value:function(){var e=this;this.scrollView.setMaxNodeCount(this.leaderData.length),this.scrollView.init((function(t){var n=t.getComponent(oV),i=e.displayLeaderData[t.order];if(i){var a=i.playerId,o=i.photo,r=i.name,l=i.score;n.setVisible(!0),n.updateInfo({playerId:a,isHighlight:e.currentPlayerId===a,name:r,photo:o,rank:t.order+1,score:l},e.maxLeader)}})),this.setBatchNodes(!0)}},{key:"playRankChangeAnimation",value:(r=q((function*(e,t,n,i){if(!(t>=n)){var a=this.displayLeaderData,o=NV.search(a,(function(e){return e.playerId===MV.getPlayerId()}));if(o){var r=o.rank;if(a[i-1]){var l=this.scrollView.getNodeByOrder(o.rank-1);if(l){var s=null==l?void 0:l.getComponent(oV);if(s){s.setVisible(!1),this.tempLeader.setVisible(!0),this.tempLeader.updatePhoto({playerId:MV.getPlayerId(),photo:o.photo}),this.tempLeader.node.worldPosition=l.node.worldPosition.clone(),yield this.tempLeader.runScaleAnimation(1.1,.5,e);var u=Math.min(.5*(r-i),2),c=[this.tempLeader.runUpdateDataAnimation(r,i,t,n,u,e),this.scrollToLeaderRank(i,u,e)],h=this.scrollView.scrollView.getMaxScrollOffset().y,p=this.scrollView.getNodeScrollOffset(i-1),d=Oe.ZERO;if(p<0)d=new Oe(this.tempLeader.node.worldPosition.x,this.node.worldPosition.y+this.scrollView.getNodePosition(i-1).y+this.uiTransform.height/2,this.tempLeader.node.worldPosition.z);else if(this.scrollView.scrollView.getScrollOffset().y>=h-5)if(p<h)d=new Oe(this.tempLeader.node.worldPosition.x,this.scrollView.viewport.node.worldPosition.y,this.tempLeader.node.worldPosition.z);else{var y,v=this.scrollView.getNodeByOrder(i-1);d=null!==(y=null==v?void 0:v.node.worldPosition.clone())&&void 0!==y?y:Oe.ZERO}d.equals(Oe.ZERO)||c.push(this.tempLeader.runWorldPositionAnimation(d,u,e)),yield Promise.all(c),yield Promise.all([this.tempLeader.runScaleAnimation(1,.25,e),this.playPostRankChangeAnimation(i,r,e)]),this.tempLeader.setVisible(!1),l.node.worldPosition=this.tempLeader.node.worldPosition.clone(),this.setupDisplayLeadersData(),this.scrollView.updateNodeVisibility(),this.scrollView.updateLayout()}}}}}})),function(e,t,n,i){return r.apply(this,arguments)})},{key:"playShowLeadersAnimation",value:(o=q((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;if(!this.isHidden){var i=[],a=this.scrollView.getAllNodes();if(a.sort((function(e,t){return e.order-t.order})).forEach((function(e,n){var a=e.getComponent(oV);a.setVisible(n<t.leaderData.length),e.isVisible()&&i.push(a)})),!(i.length<1)){i=i.slice(0,a.length-1);var o=.3;yield Promise.all(i.map(function(){var i=q((function*(i,a){t.isHidden||(yield i.runShowUpAnimation(e,a*n,o))}));return function(e,t){return i.apply(this,arguments)}}()))}}})),function(e){return o.apply(this,arguments)})},{key:"scrollToPlayerLeader",value:(i=q((function*(e,t){this.displayPlayerLeader&&(yield this.scrollToLeaderRank(this.displayPlayerLeader.rank,e,t))})),function(e,t){return i.apply(this,arguments)})},{key:"updateDisplayPlayerLeaderForRankChanging",value:function(e,t,n){if(!this.displayPlayerLeader)return!1;this.displayPlayerLeader.score=e,this.displayLeaderData.sort((function(e,t){return t.score-e.score}));var i=this.displayLeaderData.indexOf(this.displayPlayerLeader)+1;return n===i?(this.displayPlayerLeader.score=t,this.displayPlayerLeader.rank=n,!1):(this.displayPlayerLeader.rank=i,this.tempLeader.updateInfo({playerId:MV.getPlayerId(),isHighlight:!0,name:this.displayPlayerLeader.name,photo:this.displayPlayerLeader.photo,rank:this.displayPlayerLeader.rank,score:e}),!0)}},{key:"hideLeaders",value:function(){this.isHidden=!0;var e,t=this.scrollView.getAllNodes().map((function(e){return e.getComponent(oV)})),n=G(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;null==i||i.setVisible(!1)}}catch(e){n.e(e)}finally{n.f()}this.setBatchNodes(!1)}},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"setBatchNodes",value:function(e){this.batchNodes.every((function(t){t.enabled=e}))}},{key:"setupDisplayLeadersData",value:function(){var e=this,t=NV.search(this.leaderData,(function(t){return t.playerId===e.currentPlayerId}));t?(this.displayLeaderData=this.leaderData.filter((function(t){return t.playerId!==e.currentPlayerId})),this.displayPlayerLeader=U({},t),this.displayLeaderData.splice(t.rank-1,0,this.displayPlayerLeader)):(this.displayPlayerLeader=null,this.displayLeaderData=this.leaderData)}},{key:"playPostRankChangeAnimation",value:(n=q((function*(e,t,n){var i=null!=e?e:0,a=this.scrollView.getVisibleNodes().filter((function(e){return e.order>=i-1&&e.order<t})),o=a.map((function(e){return e.getComponent(oV)})),r=this.scrollView.nodeHeight+this.scrollView.spacing,l=[];o.forEach((function(e,t){var i=a[t];if(i){e.updateRank({rank:i.order+2,isHighlight:!1});var o=e.node.worldPosition.clone();l.push(e.runWorldPositionAnimation(o.add3f(0,-r,0),.25,n))}})),yield Promise.all(l)})),function(e,t,i){return n.apply(this,arguments)})},{key:"scrollToLeaderRank",value:(t=q((function*(e,t,n){yield this.scrollView.scrollToOrder(e-1,n,t)})),function(e,n,i){return t.apply(this,arguments)})}]),u}(re)).prototype,"scrollView",[qH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eV=D(QH.prototype,"tempLeader",[WH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tV=D(QH.prototype,"maxLeader",[KH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(QH.prototype,"updateData",[jH],Object.getOwnPropertyDescriptor(QH.prototype,"updateData"),QH.prototype),D(QH.prototype,"playRankChangeAnimation",[YH],Object.getOwnPropertyDescriptor(QH.prototype,"playRankChangeAnimation"),QH.prototype),D(QH.prototype,"scrollToPlayerLeader",[XH],Object.getOwnPropertyDescriptor(QH.prototype,"scrollToPlayerLeader"),QH.prototype),D(QH.prototype,"scrollToLeaderRank",[ZH],Object.getOwnPropertyDescriptor(QH.prototype,"scrollToLeaderRank"),QH.prototype),JH=QH))||JH);J._RF.pop(),J._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var BV,FV,xV,UV,GV,HV,VV,qV,WV=Q.ccclass,KV=Q.property,jV=globalThis.game,YV=jV.storage,XV=jV.leaderboard,ZV=jV.player,JV=jV.monitorError,QV=GameCore,$V=QV.Utils.Object,eq=QV.Configs.Leaderboards,tq=function(e){B(n,e);var t=F(n);function n(e){var i;return N(this,n),(i=t.call(this,e)).name="EmptyLeaderboardError",i}return M(n)}(Y(Error)),nq=(rV=WV("LeaderboardContent"),lV=a.required(),sV=KV(FG),uV=a.required(),cV=KV(YG),hV=a.required(),pV=KV(zV),dV=KV({type:[HH]}),yV=a.required(),vV=KV(uG),fV=a.required(),gV=KV(Si),mV=a.onlyRunInLifeCycleAsync,bV=a.onlyRunInLifeCycleAsync,wV=a.onlyRunInLifeCycleAsync,kV=a.onlyRunInLifeCycleAsync,SV=a.onlyRunInLifeCycleAsync,CV=a.onlyRunInLifeCycleAsync,rV((TV=D((AV=function(e){B(c,e);var t,n,i,o,l,s,u=F(c);function c(){var e;N(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=u.call.apply(u,[this].concat(n)),z(e,"tabs",TV,x(e)),z(e,"timer",RV,x(e)),z(e,"leaders",PV,x(e)),z(e,"leaderSkeletons",OV,x(e)),z(e,"leaderboardIsEmpty",IV,x(e)),z(e,"contentOpacity",LV,x(e)),e.isHidden=!0,e.currentLb=null,e.animAbortSignal=new r,e.hasPlayedAppearAnim={friends:!1,global:!1,tournament:!1},e.handleFriendsTabSelected=q((function*(){YV.setStorageData("leaderboard_content","lastTabOpened","friends"),e.cleanupSideEffects();var t=e.animAbortSignal;try{yield e.updateStatus(t,"friends")}catch(e){t.call((function(){var t=e instanceof Error?e:new Error("Unknown error during loading friends leaderboard.");console.error("LeaderboardContent",t),null==JV||JV.sendException(t),b.showNotificationScreenWithLocalizedKey("error.noFriendsLb",2)}))}})),e.handleWorldTabSelected=q((function*(){YV.setStorageData("leaderboard_content","lastTabOpened","global"),e.cleanupSideEffects();var t=e.animAbortSignal;try{yield e.updateStatus(t,"global")}catch(e){t.call((function(){var t=e instanceof Error?e:new Error("Unknown error during loading global leaderboard.");console.error("LeaderboardContent",t),null==JV||JV.sendException(t),b.showNotificationScreenWithLocalizedKey("error.noWorldLb",2)}))}})),e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return M(c,[{key:"__preload",value:function(){this.leaders.maxLeader=eq.Limit}},{key:"onLoad",value:function(){a.validateRequiredProperties(this)}},{key:"listenEvents",value:function(){this.node.scene.on(lO.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(lO.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(oa.HIDE_UI,this.hideContent),this.node.scene.on(oa.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.node.scene.off(lO.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(lO.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(oa.HIDE_UI,this.hideContent),this.node.scene.off(oa.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(s=q((function*(e,t){var n=this,i=this.getLeaderboardName(e);null!==i&&(yield t.callAsync((function(){return XV.requestLeaderboardAsync(i,eq.Limit)})),t.call((function(){var e=XV.getLeaderboard(i);n.currentLb=null!=e?e:n.currentLb})),yield t.callAsync(q((function*(){return n.loadPlayerLeaderData(e)}))))})),function(e,t){return s.apply(this,arguments)})},{key:"getLeaderboardName",value:function(e){return"friends"===e?R.FRIENDS:R.GLOBAL}},{key:"showLoading",value:(l=q((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;yield Promise.all([this.leaders.scrollView.unlistenEvents(),this.leaders.scrollView.scrollToTop(e).then((function(){t.leaders&&(t.leaders.scrollView.scrollView.enabled=!1,t.leaders.scrollView.listenEvents())})),this.leaderSkeletons.map((function(t,i){return t.show(i*n,e)}))])})),function(e){return l.apply(this,arguments)})},{key:"hideLoading",value:(o=q((function*(e){yield Promise.all(this.leaderSkeletons.map((function(t){return t.hide(e)})))})),function(e){return o.apply(this,arguments)})},{key:"entering",value:function(){this.timer.reset(),this.isHidden=!1;var e=YV.getStorageData("leaderboard_content","lastTabOpened");"friends"===e?this.handleFriendsTabSelected():"global"===e&&this.handleWorldTabSelected()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){this.animAbortSignal.abort(),this.animAbortSignal=new r,this.leaders.hideLeaders(),this.leaderboardIsEmpty.hide()}},{key:"updateStatus",value:(i=q((function*(e,t){var n,i,a,o=this;if(void 0!==e&&!this.isHidden){this.tabs.updateStatus(t),yield this.showLoading(e);try{yield this.loadLeaderboard(t,e)}catch(t){if(!(t instanceof tq))throw t;return void e.call((function(){o.leaderboardIsEmpty.show(),o.hideLoading(e)}))}null===(n=this.timer)||void 0===n||n.setTimeLabel(null===(i=this.currentLb)||void 0===i?void 0:i.resettable),null===(a=this.timer)||void 0===a||a.show(e),this.hideLoading(e),yield e.callAsync((function(e){return o.playLeadersShowupAnimation(t,e)}))}})),function(e,t){return i.apply(this,arguments)})},{key:"playLeadersShowupAnimation",value:(n=q((function*(e,t){var n=this;if(this.currentLb){var i=ZV.getPlayerId(),a=this.currentLb.leaders[i],o=YV.getStorage("leaderboard_content").previousScore,r=null!=a?a:{},l=r.score,s=r.rank,u=$V.vals(this.currentLb.leaders);u.sort((function(e,t){return t.score-e.score}));var c=-1!==o&&o<l&&s<=eq.Limit;this.leaders.updateData(u);var h=!1;a&&c&&(h=this.leaders.updateDisplayPlayerLeaderForRankChanging(o,l,s)),this.leaders.initScrollViews(),this.leaders.scrollView.scrollView.enabled=!0;var p=this.hasPlayedAppearAnim[e]?0:.1;yield t.callAsync((function(){return n.leaders.playShowLeadersAnimation(t,p)})),this.hasPlayedAppearAnim[e]=!0,a&&(yield t.callAsync((function(){return n.leaders.scrollToPlayerLeader(1,t)})),h&&-1!==o&&(yield t.callAsync((function(e){return n.leaders.playRankChangeAnimation(e,o,l,s)})),YV.setStorageData("leaderboard_content","previousScore",l)))}})),function(e,t){return n.apply(this,arguments)})},{key:"loadPlayerLeaderData",value:(t=q((function*(e){var t=ZV.getPlayerId();if(null===this.currentLb)throw new Error("LeaderboardContent: Leaderboard is not found.");var n=this.currentLb.leaders;if(0===Object.keys(n).length)throw new tq("LeaderboardContent: Leaderboard is empty.");if(!n[t]){var i=this.getLeaderboardName(e);if(null===i)throw new Error("LeaderboardContent: Leaderboard name is not found.");var a=yield XV.getLeadersByPlayerIdsAsync(i,[t]);if(0!==a.length){var o=a[0];n[t]=o}}})),function(e){return t.apply(this,arguments)})}]),c}(re)).prototype,"tabs",[lV,sV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RV=D(AV.prototype,"timer",[uV,cV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PV=D(AV.prototype,"leaders",[hV,pV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OV=D(AV.prototype,"leaderSkeletons",[dV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IV=D(AV.prototype,"leaderboardIsEmpty",[yV,vV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LV=D(AV.prototype,"contentOpacity",[fV,gV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(AV.prototype,"loadLeaderboard",[mV],Object.getOwnPropertyDescriptor(AV.prototype,"loadLeaderboard"),AV.prototype),D(AV.prototype,"showLoading",[bV],Object.getOwnPropertyDescriptor(AV.prototype,"showLoading"),AV.prototype),D(AV.prototype,"hideLoading",[wV],Object.getOwnPropertyDescriptor(AV.prototype,"hideLoading"),AV.prototype),D(AV.prototype,"updateStatus",[kV],Object.getOwnPropertyDescriptor(AV.prototype,"updateStatus"),AV.prototype),D(AV.prototype,"playLeadersShowupAnimation",[SV],Object.getOwnPropertyDescriptor(AV.prototype,"playLeadersShowupAnimation"),AV.prototype),D(AV.prototype,"loadPlayerLeaderData",[CV],Object.getOwnPropertyDescriptor(AV.prototype,"loadPlayerLeaderData"),AV.prototype),EV=AV))||EV);J._RF.pop(),J._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var iq,aq,oq,rq,lq,sq,uq,cq,hq,pq,dq,yq,vq,fq,gq,mq,bq,wq;BV=(0,Q.ccclass)("LeaderboardPage"),FV=a.required(),xV=a.onlyRunInLifeCycleAsync,UV=a.onlyRunInLifeCycleAsync,GV=a.onlyRunInLifeCycleAsync,BV((qV=D((VV=function(t){B(l,t);var n,i,a,o,r=F(l);function l(){var e;N(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),z(e,"panelAnimationController",qV,x(e)),e}return M(l,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(Ea),H(V(l.prototype),"onLoad",this).call(this)}},{key:"start",value:(o=q((function*(){H(V(l.prototype),"start",this).call(this)})),function(){return o.apply(this,arguments)})},{key:"mount",value:(a=q((function*(){if(yield H(V(l.prototype),"mount",this).call(this),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(nq),!this.content)throw new Error("LeaderboardPage: Leaders not found")})),function(){return a.apply(this,arguments)})},{key:"transitionIn",value:(i=q((function*(){this.content.entering(),yield H(V(l.prototype),"transitionIn",this).call(this);var t=e.runTweenAsync(ie(this.containerUIOpacity).to(.2,{opacity:255})),n=this.panelAnimationController.showUI();this.content.listenEvents(),yield Promise.all([t,n])})),function(){return i.apply(this,arguments)})},{key:"transitionOut",value:(n=q((function*(){yield H(V(l.prototype),"transitionOut",this).call(this),this.content.unlistenUIEvents(),this.content.leaders.setBatchNodes(!1),yield this.panelAnimationController.hideUI()})),function(){return n.apply(this,arguments)})},{key:"unmount",value:function(){var e,t;null===(e=this.content)||void 0===e||e.hide(),null===(t=this.content)||void 0===t||t.cleanup(),H(V(l.prototype),"unmount",this).call(this)}}]),l}(RD)).prototype,"panelAnimationController",[FV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(VV.prototype,"mount",[xV],Object.getOwnPropertyDescriptor(VV.prototype,"mount"),VV.prototype),D(VV.prototype,"transitionIn",[UV],Object.getOwnPropertyDescriptor(VV.prototype,"transitionIn"),VV.prototype),D(VV.prototype,"transitionOut",[GV],Object.getOwnPropertyDescriptor(VV.prototype,"transitionOut"),VV.prototype),HV=VV));J._RF.pop(),J._RF.push({},"0d1c02Npp9IXrjlFdl8co2L","TopLeader",void 0);var kq,Sq,Cq,Eq,Aq,Tq,Rq,Pq,Oq,Iq,Lq,_q,Dq,Mq,Nq,zq,Bq,Fq,xq,Uq,Gq,Hq,Vq,qq,Wq,Kq,jq,Yq=Q.ccclass,Xq=Q.property,Zq=GameCore.Utils.Number,Jq=(iq=Yq("TopLeader"),aq=Xq(we),oq=Xq(ge),rq=Xq({type:se}),lq=Xq({type:he}),sq=Xq({type:we}),uq=Xq({type:he}),cq=a.onlyRunInLifeCycle,hq=a.onlyRunInLifeCycleAsync,pq=a.onlyRunInLifeCycleAsync,iq((vq=D((yq=function(t){B(s,t);var n,i,o,l=F(s);function s(){var e;N(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=l.call.apply(l,[this].concat(n)),z(e,"nameLabel",vq,x(e)),z(e,"defaultAvatar",fq,x(e)),z(e,"avatar",gq,x(e)),z(e,"avatarOpacity",mq,x(e)),z(e,"scoreLabel",bq,x(e)),z(e,"uiOpacity",wq,x(e)),e.signal=new r,e}return M(s,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e){this.updateUsername(e),this.updatePhoto(e),this.updateScore(e)}},{key:"updateUsername",value:function(e){this.nameLabel&&(this.nameLabel.string=e.name)}},{key:"updatePhoto",value:(o=q((function*(e){this.signal.abort();var t=new r;this.signal=t,this.defaultAvatar.active=!WE.isAvatarCached(e.playerId,128),this.avatar.spriteFrame=null;var n=e.playerId,i=e.photo,a=yield WE.getPlayerAvatar(i,n,128,t);a&&!t.aborted&&this.setPhoto(a)})),function(e){return o.apply(this,arguments)})},{key:"setPhoto",value:(i=q((function*(t){if(this.node.active){t.packable=!0,this.avatar.spriteFrame=t;var n=ie(this.avatarOpacity).to(.2,{opacity:255});yield e.runTweenAsync(n,this.signal),this.defaultAvatar.active=!1}})),function(e){return i.apply(this,arguments)})},{key:"updateScore",value:function(e){if(this.scoreLabel){var t=Math.floor(e.score);this.scoreLabel.string=Zq.getShortNumber(t,7)}}},{key:"runShowUpAnimation",value:(n=q((function*(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,i=arguments.length>2?arguments[2]:void 0;this.node.scale=Oe.ZERO;var a=ie(this.node).delay(t).to(n,{scale:new Oe(1,1,1)},{easing:"backOut"}),o=ie(this.uiOpacity).delay(t).to(n,{opacity:255});yield Promise.all([e.runTweenAsync(a,i),e.runTweenAsync(o,i)])})),function(e){return n.apply(this,arguments)})},{key:"setVisible",value:function(e){var t=e?255:0;this.uiOpacity.opacity=t,this.avatarOpacity.opacity=t}}]),s}(re)).prototype,"nameLabel",[aq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fq=D(yq.prototype,"defaultAvatar",[oq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gq=D(yq.prototype,"avatar",[rq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mq=D(yq.prototype,"avatarOpacity",[lq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bq=D(yq.prototype,"scoreLabel",[sq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wq=D(yq.prototype,"uiOpacity",[uq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(yq.prototype,"updateInfo",[cq],Object.getOwnPropertyDescriptor(yq.prototype,"updateInfo"),yq.prototype),D(yq.prototype,"updatePhoto",[hq],Object.getOwnPropertyDescriptor(yq.prototype,"updatePhoto"),yq.prototype),D(yq.prototype,"setPhoto",[pq],Object.getOwnPropertyDescriptor(yq.prototype,"setPhoto"),yq.prototype),dq=yq))||dq);J._RF.pop(),J._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var Qq,$q,eW,tW,nW,iW=Q.ccclass,aW=Q.property,oW=globalThis.game,rW=oW.leaderboard,lW=oW.player,sW=oW.language,uW=GameCore.Utils,cW=uW.Time,hW=uW.Object,pW=uW.Array,dW=uW.Number,yW=(kq=iW("TournamentBlock"),Sq=aW(ge),Cq=aW(we),Eq=aW(p),Aq=aW(p),Tq=aW(p),Rq=aW(p),Pq=aW($),Oq=aW({type:se}),Iq=aW(ge),Lq=aW(ge),_q=aW(Jq),Dq=a.onlyRunInLifeCycleAsync,Mq=a.onlyRunInLifeCycle,kq((Bq=D((zq=function(t){B(h,t);var n,i,r,l,s,u,c=F(h);function h(){var e;N(this,h);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=c.call.apply(c,[this].concat(n)),z(e,"container",Bq,x(e)),z(e,"title",Fq,x(e)),z(e,"titleLocalizer",xq,x(e)),z(e,"timeLocalizer",Uq,x(e)),z(e,"playerCountLocalizer",Gq,x(e)),z(e,"playButtonLocalize",Hq,x(e)),z(e,"uiTransform",Vq,x(e)),z(e,"banner",qq,x(e)),z(e,"bannerMask",Wq,x(e)),z(e,"bannerLoadingRing",Kq,x(e)),z(e,"topLeader",jq,x(e)),e.hasPlayedAnimation=!1,e}return M(h,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"updateInfo",value:(u=q((function*(e){this.payload=e;var t=e.endTime,n=e.title,i=e.payload.playerName,a=e.tournamentType,o=e.payload,r=o.leaderboardId,l=o.themeId;r&&(this.topLeader.setVisible(!1),this.topLeader.node.active=!1,this.setPlayerCountWaiting(),"PAGE_HOSTED"===a?this.updateTitleTournamentTitle(n):this.updateTitleWithPlayerName(null!=i?i:n),this.updateEndTime(t),this.updateTournamentBanner(l),yield this.fetchAndUpdateLeadersPayload(r,{leaders:[],amountPlayer:0},n))})),function(e){return u.apply(this,arguments)})},{key:"fetchAndUpdateLeadersPayload",value:(s=q((function*(e,t,n){var i=t;try{var a=yield this.getLeadersPayload(e);a&&(i=a)}catch(e){console.error("Fetch lb for tournament ".concat(n),e)}this.updateLeadersPayload(i)})),function(e,t,n){return s.apply(this,arguments)})},{key:"updateLeadersPayload",value:function(e){this.leadersPayload=e;var t=this.leadersPayload,n=t.player,i=t.amountPlayer,a=t.leaders;this.updatePlayerCount(i),this.updatePlayButtonLabel(void 0!==n),this.updateTopLeader(null!=a?a:[])}},{key:"updateTitleWithPlayerName",value:function(e){void 0!==e&&(this.titleLocalizer.enabled=!0,this.titleLocalizer.setParams([e]))}},{key:"updateTitleTournamentTitle",value:function(e){this.titleLocalizer.enabled=!1,this.title.string=e}},{key:"updateEndTime",value:function(e){try{var t=cW.getRelativeTime(e,sW.getCurrentLocale());this.timeLocalizer.key="game.endsIn",this.timeLocalizer.setParams([t])}catch(e){this.timeLocalizer.key="game.endsSoon"}}},{key:"updatePlayerCount",value:function(e){var t=dW.getShortNumber(e,3);1===e?this.playerCountLocalizer.key="game.player":(this.playerCountLocalizer.key="game.nPlayers",this.playerCountLocalizer.setParams([t]))}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLocalizer.key="status.loading"}},{key:"updateTopLeader",value:(l=q((function*(e){if(0!==e.length){var t,n=e[0];GameCore.Configs.Mockup.Leaderboards.Enabled&&(n=null!==(t=pW.search(e,(function(e){return 1===e.rank})))&&void 0!==t?t:n),this.topLeader.node.active=!0,this.topLeader.updateInfo(n),this.topLeader.runShowUpAnimation(0,.2)}})),function(e){return l.apply(this,arguments)})},{key:"updateTournamentBanner",value:(r=q((function*(e){var t=o.getAsset("".concat(T[e],"/spriteFrame"),ze);t||(this.bannerMask.active=!0,this.bannerLoadingRing.active=!0,t=yield o.loadThemePreviewAsync(e)),t||(t=yield o.loadThemePreviewAsync(E.SUMMER)),this.banner&&t&&(this.banner.spriteFrame=t,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1)})),function(e){return r.apply(this,arguments)})},{key:"updatePlayButtonLabel",value:function(e){this.playButtonLocalize.key=e?"game.continue":"game.join"}},{key:"getLeadersPayload",value:(i=q((function*(e){var t,n=rW.getLeaderboardName(e);if(!n)return null;var i=yield Is.getAllLeaderboardAsync(e);if(!i)return null;var a=hW.vals(i.leaders);a.sort((function(e,t){return e.rank-t.rank}));var o=lW.getPlayerId(),r=yield rW.getLeadersByPlayerIdsAsync(n,[o]),l={leaders:a,amountPlayer:null!==(t=i.amountPlayer)&&void 0!==t?t:0};return r.length>0&&(l.player=r[0]),l})),function(e){return i.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(n=q((function*(t,n,i){var a=this;this.node.scale=new Oe(.8,.8,.8),this.uiOpacity.opacity=0;var o=this.container.position.clone();this.container.position=new Oe(o.x,o.y-100,o.z);var r=ie(this.node).delay(t);r.to(n,{scale:Oe.ONE},{easing:"elasticOut"});var l=ie(this.container).delay(t);l.to(n,{position:o},{easing:"backOut"});var s=ie(this.uiOpacity).delay(t);s.to(n,{opacity:255},{easing:"cubicOut"}),i.addAbortListener((function(){a.node.scale=Oe.ONE,a.container.position=o,a.uiOpacity.opacity=255})),yield Promise.all([e.runTweenAsync(r,i),e.runTweenAsync(l,i),e.runTweenAsync(s,i)])})),function(e,t,i){return n.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var e=this.payload.id||"";if(m.validateTournamentExpired(e))return this.node.scene.emit(Ts.RELOAD_TOURNAMENT),void b.showNotificationScreenWithLocalizedKey("error.tourEnded",2);try{var t=JSON.stringify(this.payload);b.showTournamentDetailScreen(t,"tournament_start",this.hasPlayedAnimation),this.hasPlayedAnimation=!0}catch(e){console.warn("handleOnTournamentClicked",e)}}}]),h}(re)).prototype,"container",[Sq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fq=D(zq.prototype,"title",[Cq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xq=D(zq.prototype,"titleLocalizer",[Eq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uq=D(zq.prototype,"timeLocalizer",[Aq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gq=D(zq.prototype,"playerCountLocalizer",[Tq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hq=D(zq.prototype,"playButtonLocalize",[Rq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vq=D(zq.prototype,"uiTransform",[Pq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qq=D(zq.prototype,"banner",[Oq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wq=D(zq.prototype,"bannerMask",[Iq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kq=D(zq.prototype,"bannerLoadingRing",[Lq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jq=D(zq.prototype,"topLeader",[_q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(zq.prototype,"fetchAndUpdateLeadersPayload",[Dq],Object.getOwnPropertyDescriptor(zq.prototype,"fetchAndUpdateLeadersPayload"),zq.prototype),D(zq.prototype,"updateLeadersPayload",[Mq],Object.getOwnPropertyDescriptor(zq.prototype,"updateLeadersPayload"),zq.prototype),Nq=zq))||Nq);J._RF.pop(),J._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var vW,fW,gW,mW,bW,wW,kW,SW,CW,EW,AW,TW,RW,PW=Q.ccclass,OW=Q.property,IW=(Qq=PW("TournamentBlockSkeleton"),$q=OW(ge),Qq((nW=D((tW=function(t){B(r,t);var n,i,o=F(r);function r(){var e;N(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),z(e,"container",nW,x(e)),e}return M(r,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"hide",value:(i=q((function*(t){var n=this;yield e.runTweenAsync(ie(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t)})),function(e){return i.apply(this,arguments)})},{key:"show",value:(n=q((function*(t,n){var i=this;this.node.active=!0,this.node.scale=new Oe(.8,.8,.8),this.uiOpacity.opacity=0;var a=this.container.position.clone();this.container.position=new Oe(a.x,a.y-100,a.z);var o=ie(this.node).delay(t);o.to(.2,{scale:Oe.ONE},{easing:"elasticOut"});var r=ie(this.container).delay(t);r.to(.2,{position:a},{easing:"backOut"});var l=ie(this.uiOpacity).delay(t);l.to(.2,{opacity:255},{easing:"cubicOut"}),n.addAbortListener((function(){i.node.scale=Oe.ONE,i.container.position=a,i.uiOpacity.opacity=255})),yield Promise.all([e.runTweenAsync(o,n),e.runTweenAsync(r,n),e.runTweenAsync(l,n)])})),function(e,t){return n.apply(this,arguments)})}]),r}(re)).prototype,"container",[$q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eW=tW))||eW);J._RF.pop(),J._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var LW,_W=Q.ccclass,DW=Q.property,MW=globalThis.game.player,NW=(vW=_W("TournamentsBoard"),fW=DW(Ve),gW=DW(ge),mW=DW(ae),bW=DW(ge),wW=DW($),vW((CW=D((SW=function(e){B(i,e);var t,n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"tournamentBlockPrefab",CW,x(e)),e.tournamentBlockArray=[],z(e,"inactiveNodeContainer",EW,x(e)),z(e,"layout",AW,x(e)),z(e,"createTournamentButton",TW,x(e)),z(e,"viewport",RW,x(e)),e}return M(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"start",value:function(){for(var e=0;e<20;e++)this.addTournamentBlock();var t=this.tournamentBlockArray[0];t&&(this.tournamentBlockContentHeight=t.uiTransform.contentSize.height+this.layout.spacingY)}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"updateData",value:function(e){var t=this,n=!1;e.forEach((function(e,i){var a=t.tournamentBlockArray[i];e.payload.playerId===MW.getPlayerId()&&(n=!0),a||(a=t.addTournamentBlock()),t.layout.node.addChild(a.node),a.updateInfo(e)})),n||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var e=Ge(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(e);var t=e.getComponent(yW);return this.tournamentBlockArray.push(t),t}},{key:"removeTournamentBlocks",value:function(){var e,t=this.getActiveTournamentBlocks(),n=G(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.inactiveNodeContainer.addChild(i.node)}}catch(e){n.e(e)}finally{n.f()}this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var e=this;return this.tournamentBlockArray.filter((function(t){return t.node.parent===e.layout.node}))}},{key:"setCreateTournamentButtonActive",value:function(e){e?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=e}},{key:"showTournamentBlocks",value:(t=q((function*(e,t){var n=this.getActiveTournamentBlocks();if(!(n.length<1)){var i=Math.ceil(e/this.tournamentBlockContentHeight),a=Math.min(n.length,i);yield Promise.all(n.map(function(){var e=q((function*(e,n){n<a?yield e.runShowPopUpAnimation(.1*n,.3,t):e.uiOpacity.opacity=255}));return function(t,n){return e.apply(this,arguments)}}()))}})),function(e,n){return t.apply(this,arguments)})},{key:"updateVisibility",value:function(){var e,t=this.viewport.getBoundingBoxToWorld(),n=t.yMax,i=t.yMin,a=this.getActiveTournamentBlocks(),o=G(a);try{for(o.s();!(e=o.n()).done;){var r=e.value,l=r.uiTransform;if(void 0!==l){var s=l.getBoundingBoxToWorld(),u=s.yMax,c=s.yMin,h=u<i||c>n;r.uiOpacity.opacity=h?0:255}}}catch(e){o.e(e)}finally{o.f()}}}]),i}(re)).prototype,"tournamentBlockPrefab",[fW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EW=D(SW.prototype,"inactiveNodeContainer",[gW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AW=D(SW.prototype,"layout",[mW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TW=D(SW.prototype,"createTournamentButton",[bW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RW=D(SW.prototype,"viewport",[wW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kW=SW))||kW);J._RF.pop(),J._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var zW,BW,FW,xW,UW,GW,HW,VW,qW,WW,KW,jW,YW,XW,ZW,JW=(0,Q.ccclass)("TournamentsNotAvailable")(LW=function(t){B(a,t);var n,i=F(a);function a(){return N(this,a),i.apply(this,arguments)}return M(a,[{key:"onLoad",value:function(){this.hide()}},{key:"show",value:(n=q((function*(){this.node.active=!0;var t=this.node.position.clone(),n=ie(this.node);n.to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)});var i=ie(this.node).repeat(2,n);i.to(.05,{position:t}),yield e.runTweenAsync(i)})),function(){return n.apply(this,arguments)})},{key:"hide",value:function(){this.node.active=!1}}]),a}(re))||LW;J._RF.pop(),J._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var QW,$W,eK,tK,nK,iK,aK,oK,rK,lK=Q.ccclass,sK=Q.property,uK=globalThis.game,cK=uK.storage,hK=uK.match,pK=GameCore.Utils,dK=pK.Object,yK=pK.Array,vK=(zW=lK("TournamentContent"),BW=sK({type:Ia}),FW=sK(NW),xW=sK(JW),UW=sK(at),GW=sK({type:[IW]}),HW=sK(Si),zW((WW=D((qW=function(e){B(s,e);var t,n,i,o,l=F(s);function s(){var e;N(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=l.call.apply(l,[this].concat(n)),z(e,"panelAnimator",WW,x(e)),z(e,"tournamentsBoard",KW,x(e)),z(e,"tournamentsNotAvailable",jW,x(e)),z(e,"scrollView",YW,x(e)),z(e,"skeletons",XW,x(e)),z(e,"contentOpacity",ZW,x(e)),e.animAbortSignal=null,e.softAbortSignal=null,e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return M(s,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent($),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(at.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(Ts.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(oa.HIDE_UI,this.hideContent),this.node.scene.on(oa.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(at.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(Ts.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(oa.HIDE_UI,this.hideContent),this.node.scene.off(oa.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(o=q((function*(){var e;if(null===this.animAbortSignal&&null===this.softAbortSignal&&(this.animAbortSignal=new r,this.softAbortSignal=new r,yield this.showLoading(this.animAbortSignal),!this.isAborted())){var t=yield m.requestTournamentDataAsync();this.isAborted()||(yield this.hideLoading(this.animAbortSignal),this.isAborted()||(0!==t.length||null!==(e=this.softAbortSignal)&&void 0!==e&&e.aborted?(this.tournamentsNotAvailable.hide(),this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(t),yield this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal),this.tournamentsBoard.updateVisibility()):this.tournamentsNotAvailable.show()))}})),function(){return o.apply(this,arguments)})},{key:"showLoading",value:(i=q((function*(e){this.scrollView.scrollToTop(0),this.scrollView.enabled=!1,yield Promise.all([this.skeletons.map((function(t){return t.show(0,e)}))])})),function(e){return i.apply(this,arguments)})},{key:"hideLoading",value:(n=q((function*(e){yield Promise.all([this.skeletons.map((function(t){return t.hide(e)}))])})),function(e){return n.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!cK.getStorage("tournament").animateTournamentLeader)return;var e=m.getAllTournamentData(),t=hK.getMatchState().customData.tournamentId;if(!t)throw new Error("Tournament ID not found");var n=yK.search(e,(function(e){return e.id===t}));if(!n)throw new Error("Tournament not found");var i=JSON.stringify(n);b.showTournamentDetailScreen(i,"tournament_end")}catch(e){cK.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",e)}}},{key:"processCreateTournament",value:(t=q((function*(){try{yield Js.processCreateTournamentAsync()}catch(e){if(!dK.hasOwn(e,"code"))return void b.showNotificationScreenWithLocalizedKey("error.createTourFail",2);if("USER_INPUT"===e.code)return;if("PLAYER_HAS_TOURNAMENT"===e.code)return void b.showNotificationScreenWithLocalizedKey("error.tourExists",2);"INVALID_OPERATION"===e.code&&dK.hasOwn(e,"message")&&"string"==typeof e.message&&b.showNotificationScreen(e.message,2),b.showNotificationScreenWithLocalizedKey("error.createTourFail",2)}this.reload()})),function(){return t.apply(this,arguments)})},{key:"isAborted",value:function(){var e,t;return null===(e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===e||e}},{key:"cleanup",value:function(){var e;this.unlistenEvents(),null===(e=this.animAbortSignal)||void 0===e||e.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var e;null===(e=this.softAbortSignal)||void 0===e||e.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.listenEvents(),this.enter()}}]),s}(re)).prototype,"panelAnimator",[BW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KW=D(qW.prototype,"tournamentsBoard",[FW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jW=D(qW.prototype,"tournamentsNotAvailable",[xW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YW=D(qW.prototype,"scrollView",[UW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XW=D(qW.prototype,"skeletons",[GW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ZW=D(qW.prototype,"contentOpacity",[HW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VW=qW))||VW);J._RF.pop(),J._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var fK,gK,mK,bK,wK,kK;QW=(0,Q.ccclass)("TournamentPage"),$W=a.required(),eK=a.onlyRunInLifeCycleAsync,tK=a.onlyRunInLifeCycle,nK=a.onlyRunInLifeCycleAsync,iK=a.onlyRunInLifeCycleAsync,QW((rK=D((oK=function(t){B(l,t);var n,i,a,o,r=F(l);function l(){var e;N(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),z(e,"panelAnimationController",rK,x(e)),e}return M(l,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(Ea),H(V(l.prototype),"onLoad",this).call(this)}},{key:"start",value:(o=q((function*(){H(V(l.prototype),"start",this).call(this)})),function(){return o.apply(this,arguments)})},{key:"mount",value:(a=q((function*(){yield H(V(l.prototype),"mount",this).call(this),this.onMount()})),function(){return a.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(vK),!this.content)throw new Error("LeaderboardPage: Leaders not found")}},{key:"transitionIn",value:(i=q((function*(){yield H(V(l.prototype),"transitionIn",this).call(this);var t=e.runTweenAsync(ie(this.containerUIOpacity).to(.2,{opacity:255})),n=this.panelAnimationController.showUI();this.content.listenEvents(),yield Promise.all([t,n]),this.content.enter()})),function(){return i.apply(this,arguments)})},{key:"transitionOut",value:(n=q((function*(){var e;null===(e=this.content)||void 0===e||e.softAbort(),this.content.unlistenUIEvents(),yield H(V(l.prototype),"transitionOut",this).call(this),yield this.panelAnimationController.hideUI()})),function(){return n.apply(this,arguments)})},{key:"unmount",value:function(){var e;null===(e=this.content)||void 0===e||e.cleanup(),H(V(l.prototype),"unmount",this).call(this)}}]),l}(RD)).prototype,"panelAnimationController",[$W],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(oK.prototype,"mount",[eK],Object.getOwnPropertyDescriptor(oK.prototype,"mount"),oK.prototype),D(oK.prototype,"onMount",[tK],Object.getOwnPropertyDescriptor(oK.prototype,"onMount"),oK.prototype),D(oK.prototype,"transitionIn",[nK],Object.getOwnPropertyDescriptor(oK.prototype,"transitionIn"),oK.prototype),D(oK.prototype,"transitionOut",[iK],Object.getOwnPropertyDescriptor(oK.prototype,"transitionOut"),oK.prototype),aK=oK));J._RF.pop(),J._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var SK,CK,EK,AK,TK,RK,PK,OK,IK,LK=Q.ccclass,_K=Q.property;fK=LK("EventBadge"),gK=_K(we),mK=_K(Ie),fK((kK=D((wK=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"label",kK,x(e)),e}return M(n,[{key:"text",get:function(){return this.label.string},set:function(e){this.label.string=e}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(re)).prototype,"label",[gK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(wK.prototype,"text",[mK],Object.getOwnPropertyDescriptor(wK.prototype,"text"),wK.prototype),bK=wK));J._RF.pop(),J._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var DK,MK,NK,zK,BK,FK,xK,UK,GK,HK,VK,qK,WK,KK,jK,YK,XK,ZK,JK,QK,$K,ej,tj,nj,ij,aj,oj,rj,lj,sj,uj,cj,hj,pj,dj,yj,vj,fj,gj,mj,bj,wj,kj,Sj,Cj,Ej,Aj,Tj=Q.ccclass,Rj=Q.property;SK=Tj("EventProgressBar"),CK=Rj($o),EK=Rj(we),AK=Rj(Ie),TK=Rj({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),SK((OK=D((PK=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"progressBar",OK,x(e)),z(e,"progressLabel",IK,x(e)),e}return M(n,[{key:"text",get:function(){return this.progressLabel.string},set:function(e){this.progressLabel.string=e}},{key:"progress",get:function(){return this.progressBar.progress},set:function(e){this.progressBar.progress=e}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(re)).prototype,"progressBar",[CK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IK=D(PK.prototype,"progressLabel",[EK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(PK.prototype,"text",[AK],Object.getOwnPropertyDescriptor(PK.prototype,"text"),PK.prototype),D(PK.prototype,"progress",[TK],Object.getOwnPropertyDescriptor(PK.prototype,"progress"),PK.prototype),RK=PK));J._RF.pop(),J._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var Pj,Oj,Ij,Lj,_j,Dj,Mj=Q.ccclass,Nj=Q.property,zj=Q.executeInEditMode,Bj=globalThis.game.analytics,Fj=GameCore.Plugins.Analytics.Events;DK=Mj("NavButton"),MK=Nj(ye),NK=Nj({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),zK=Nj({type:te,group:{name:"Animation"}}),BK=Nj({type:te,group:{name:"Animation"}}),FK=Nj({type:te,group:{name:"Animation"}}),xK=Nj({type:te,group:{name:"Animation"}}),UK=Nj({type:te,group:{name:"Animation"}}),GK=Nj({group:{name:"Animation"}}),HK=Nj({type:te,group:{name:"Animation"}}),VK=Nj({type:te,group:{name:"Animation"}}),qK=Nj({group:{name:"Animation"}}),WK=Nj({type:te,group:{name:"Animation"}}),KK=Nj({type:te,group:{name:"Animation"}}),jK=Nj({type:te,group:{name:"Animation"}}),YK=Nj({type:te,group:{name:"Animation"}}),XK=Nj({type:te,group:{name:"Animation"}}),ZK=Nj({type:$}),JK=Nj(ge),QK=Nj(he),$K=Nj({type:$}),ej=Nj({type:ue(cn)}),tj=Nj(Zx),DK(nj=zj((aj=D((ij=function(t){B(r,t);var n,i,o=F(r);function r(){var e;N(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),z(e,"wip",aj,x(e)),z(e,"isSelectedInEditor",oj,x(e)),z(e,"animationDuration",rj,x(e)),z(e,"selectedSpacing",lj,x(e)),z(e,"deselectedSpacing",sj,x(e)),z(e,"selectedIconY",uj,x(e)),z(e,"selectedIconX",cj,x(e)),z(e,"selectedIconScale",hj,x(e)),z(e,"deselectedIconY",pj,x(e)),z(e,"deselectedIconX",dj,x(e)),z(e,"deselectedIconScale",yj,x(e)),z(e,"initTextY",vj,x(e)),z(e,"selectedTextY",fj,x(e)),z(e,"selectedTextX",gj,x(e)),z(e,"deselectedTextY",mj,x(e)),z(e,"deselectedTextX",bj,x(e)),z(e,"spacer",wj,x(e)),z(e,"icon",kj,x(e)),z(e,"text",Sj,x(e)),z(e,"uiTransform",Cj,x(e)),z(e,"screenType",Ej,x(e)),z(e,"navManager",Aj,x(e)),e.isSelected=!1,e.onMouseEnter=function(t){e.isSelected||e.playHoverOnAnimation()},e.onMouseLeave=function(t){e.isSelected||e.playHoverOffAnimation()},e}return M(r,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(ge.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(ge.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.initTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var e,t;this.isSelected||(l.playSound(wn.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),Bj.event(Fj.BUTTON_CLICK,{button_name:null!==(e=null===(t=this.node.parent)||void 0===t?void 0:t.name)&&void 0!==e?e:this.node.name,screen_name:s.getCurrentPage()}))}},{key:"select",value:(i=q((function*(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0,t?yield e.runTweenAsync(this.playSelectAnimation()):(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255)})),function(){return i.apply(this,arguments)})},{key:"deselect",value:(n=q((function*(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isSelected&&!n)throw new Error("NavButton: Already deselected");this.isSelected=!1,t?yield e.runTweenAsync(this.deselectAnimation()):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0)})),function(){return n.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var e=new Oe(this.selectedIconX,this.selectedIconY,0),t=new Oe(this.deselectedIconX,this.deselectedIconY,0),n=this.node.scale.clone();this.node.scale=this.selectedIconScale;var i=this.uiTransform.convertToWorldSpaceAR(e),a=this.uiTransform.convertToWorldSpaceAR(t);return this.node.scale=n,a.x-i.x}},{key:"playHoverOnAnimation",value:function(){var t=ie(this.icon);return t.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),e.runTweenAsync(t)}},{key:"playHoverOffAnimation",value:function(){var t=ie(this.icon);return t.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),e.runTweenAsync(t)}},{key:"playSelectAnimation",value:function(){var e=this;return ie(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=ce.quintInOut(n),a=ce.backOut(n),o=ce.linear(n),r=n<.5?2*n:1,l=e.deselectedIconY+(e.selectedIconY-e.deselectedIconY)*a,s=e.deselectedIconX+(e.selectedIconX-e.deselectedIconX)*o;e.icon.setPosition(s,l,0);var u=e.deselectedIconScale.clone().lerp(e.selectedIconScale,i);e.icon.setScale(u.x,u.y,e.icon.scale.z);var c=255*r,h=e.deselectedTextY+(e.selectedTextY-e.deselectedTextY)*o,p=e.deselectedTextX+(e.selectedTextX-e.deselectedTextX)*o;e.text.opacity=c,e.text.node.setPosition(p,h,0)}}})}},{key:"deselectAnimation",value:function(){var e=this;return ie(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=We(e.selectedIconY,e.deselectedIconY,n),a=We(e.selectedIconX,e.deselectedIconX,n);e.icon.setPosition(a,i,0);var o=We(255,0,n<.5?2*n:1);e.text.opacity=o;var r=We(e.selectedTextY,e.deselectedTextY,n),l=We(e.selectedTextX,e.deselectedTextX,n);e.text.node.setPosition(l,r,0);var s=e.selectedIconScale.clone().lerp(e.deselectedIconScale,ce.quintInOut(n));e.icon.setScale(s.x,s.y,e.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent($),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}}]),r}(re)).prototype,"wip",[MK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oj=D(ij.prototype,"isSelectedInEditor",[NK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rj=D(ij.prototype,"animationDuration",[zK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),lj=D(ij.prototype,"selectedSpacing",[BK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),sj=D(ij.prototype,"deselectedSpacing",[FK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),uj=D(ij.prototype,"selectedIconY",[xK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),cj=D(ij.prototype,"selectedIconX",[UK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hj=D(ij.prototype,"selectedIconScale",[GK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(1,1,1)}}),pj=D(ij.prototype,"deselectedIconY",[HK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dj=D(ij.prototype,"deselectedIconX",[VK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yj=D(ij.prototype,"deselectedIconScale",[qK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(.8,.8,1)}}),vj=D(ij.prototype,"initTextY",[WK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-100}}),fj=D(ij.prototype,"selectedTextY",[KK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-10}}),gj=D(ij.prototype,"selectedTextX",[jK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mj=D(ij.prototype,"deselectedTextY",[YK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bj=D(ij.prototype,"deselectedTextX",[XK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wj=D(ij.prototype,"spacer",[ZK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kj=D(ij.prototype,"icon",[JK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sj=D(ij.prototype,"text",[QK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cj=D(ij.prototype,"uiTransform",[$K],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ej=D(ij.prototype,"screenType",[ej],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aj=D(ij.prototype,"navManager",[tj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nj=ij))||nj);J._RF.pop(),J._RF.push({},"091aai5+ANDeZfFN8JFkbyi","TournamentButton",void 0);var xj,Uj,Gj,Hj,Vj,qj,Wj=Q.ccclass,Kj=Q.property,jj=globalThis.game.leaderboard;Pj=Wj("TournamentButton"),Oj=Kj(ge),Ij=a.onlyRunInLifeCycleAsync,Pj((Dj=D((_j=function(t){B(o,t);var n,i,a=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),z(e,"hotIcon",Dj,x(e)),e}return M(o,[{key:"onLoad",value:(i=q((function*(){try{var e,t=yield m.requestTournamentDataAsync(),n=G(t);try{for(n.s();!(e=n.n()).done;){var i=e.value.payload,a=i.leaderboardId,o=i.playerId;if(a&&"global"===o){var r=jj.getLeaderboardName(a);if(r&&(yield jj.requestLeaderboardAsync(r,0),this.checkAndShowHotIcon(r)))break}}}catch(e){n.e(e)}finally{n.f()}}catch(e){console.info("Error in TournamentButton",e)}})),function(){return i.apply(this,arguments)})},{key:"checkAndShowHotIcon",value:function(e){if(!this.node||!this.node.activeInHierarchy)return!1;var t=jj.getLeaderboard(e);return!!t&&(!(t.amountPlayer<30)&&(this.showHotIcon(),!0))}},{key:"showHotIcon",value:(n=q((function*(){this.hotIcon.active=!0,this.hotIcon.scale=Oe.ZERO;var t=ie(this.hotIcon).to(.5,{scale:Oe.ONE},{easing:"backOut"});yield e.runTweenAsync(t);var n=ie(this.hotIcon).delay(1).to(.3,{scale:new Oe(1.1,1.1)},{easing:"backIn"}).to(.3,{scale:Oe.ONE},{easing:"backOut"});ie(this.hotIcon).repeatForever(n).start()})),function(){return n.apply(this,arguments)})}]),o}(re)).prototype,"hotIcon",[Oj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(_j.prototype,"showHotIcon",[Ij],Object.getOwnPropertyDescriptor(_j.prototype,"showHotIcon"),_j.prototype),Lj=_j));J._RF.pop(),J._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var Yj,Xj,Zj,Jj,Qj,$j,eY,tY=Q.ccclass,nY=Q.property,iY=Q.disallowMultiple,aY=globalThis.game.player,oY=n.Layout,rY=GameCore.Match.Modes,lY=[wn.COMBO_1,wn.COMBO_2,wn.COMBO_3,wn.COMBO_4,wn.COMBO_5,wn.COMBO_6,wn.COMBO_7,wn.COMBO_8,wn.COMBO_9,wn.COMBO_10,wn.COMBO_11,wn.COMBO_12,wn.COMBO_13,wn.TILE_MATCH,wn.BOMB_DEFUSE,wn.BOMB_EXPLODE_1,wn.BOMB_EXPLODE_2,wn.TILE_SELECT,wn.THUNDERBOLT,wn.SHUFFLE_ITEM,wn.LEVEL_START,wn.LEVEL_COMPLETE,wn.LEVEL_FAIL];xj=tY("GameScene"),Uj=a.required,Gj=nY(DI),xj(Hj=iY((qj=D((Vj=function(n){B(r,n);var i=F(r);function r(){var t;N(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return t=i.call.apply(i,[this].concat(a)),z(t,"coinManager",qj,x(t)),t.handleGameExit=function(){C.switchScene(A.DASHBOARD_SCENE)},t.handleShowResults=function(){C.switchScene(A.CHALLENGE_RESULT_SCENE)},t.handleGameMaskWhenLayoutChanged=function(e){var t=Me("Canvas/Game/GameObjects");if(t){var n=t.getComponent(rt);n&&(n.enabled=e===oY.Landscape)}},t.updateMusic=q((function*(){var t=Js.getMatchMode()===rY.TOURNAMENT,n=t?wn.TOURNAMENT_MUSIC:wn.BG_MUSIC;l.getCurrentMusic()!==n&&(yield l.setVolumeMusic(0,!0),yield e.waitTweenAsync(1)),l.playMusic(n,t),l.setVolumeMusic(t?.4:.3,!0)})),t}return M(r,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onLoad",value:function(){this.coinManager.init()}},{key:"validateRequiredComponents",value:function(){a.validateRequiredProperties(this,r)}},{key:"listenGameEvents",value:function(){oe.on(t.ORIENTATION_CHANGED,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(oa.GAME_EXIT,this.handleGameExit),this.node.scene.on(oa.SHOW_CHALLENGE_RESULTS,this.handleShowResults),this.node.scene.on(oa.UPDATE_MUSIC,this.updateMusic)}},{key:"start",value:function(){aY.getPlayerSetting("music")&&this.updateMusic(),this.preloadSounds(),this.preloadTileAnimations(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadTileAnimations",value:function(){return hc.preloadTileAnimations()}},{key:"preloadSounds",value:function(){for(var e=0,t=lY;e<t.length;e++){var n=t[e];o.loadAudioClipAsync(n)}}},{key:"preloadScenes",value:function(){C.preloadDashboardScene()}}]),r}(re)).prototype,"coinManager",[Uj,Gj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hj=Vj))||Hj);J._RF.pop(),J._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var sY,uY,cY,hY,pY,dY,yY,vY=Q.ccclass,fY=Q.property;Yj=vY("ComboEffect"),Xj=fY(he),Zj=fY(Ee),Yj(($j=D((Qj=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"circleOpacity",$j,x(e)),z(e,"particle",eY,x(e)),e}return M(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(oa.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){e>1&&(this.circleOpacity.node.scale=Oe.ZERO,this.circleOpacity.opacity=60,this.particle.resetSystem(),ie(this.circleOpacity.node).to(.2,{scale:new Oe(1.3,1.3,1.3)},{easing:"quadOut"}).start(),ie(this.circleOpacity).delay(.3).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),n}(re)).prototype,"circleOpacity",[Xj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eY=D(Qj.prototype,"particle",[Zj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jj=Qj));J._RF.pop(),J._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var gY,mY,bY,wY,kY,SY,CY,EY,AY,TY=Q.ccclass,RY=Q.property;sY=TY("ComboLabel"),uY=RY(we),cY=RY(ge),sY((dY=D((pY=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"comboNumber",dY,x(e)),z(e,"comboContainer",yY,x(e)),e}return M(n,[{key:"onLoad",value:function(){this.opacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(oa.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>1?(this.opacity.opacity=255,this.comboNumber.string="".concat(e),ie(this.comboContainer).to(.1,{scale:new Oe(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:Oe.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),n}(re)).prototype,"comboNumber",[uY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yY=D(pY.prototype,"comboContainer",[cY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hY=pY));J._RF.pop(),J._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var PY,OY,IY,LY,_Y,DY,MY,NY,zY,BY,FY,xY,UY,GY=Q.ccclass,HY=Q.property,VY=n.Layout,qY=["good","great","excellent"];gY=GY("ComboPopup"),mY=a.required(),bY=HY(p),wY=a.required(),kY=HY(Be),gY((EY=D((CY=function(e){B(i,e);var n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"spriteLocalizer",EY,x(e)),z(e,"animation",AY,x(e)),e}return M(i,[{key:"__preload",value:function(){this.widget=this.getComponent(ne),a.validateRequiredProperties(this)}},{key:"onLoad",value:function(){oe.on(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(Mt.getCurrentLayout())}},{key:"onDestroy",value:function(){oe.off(t.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"start",value:function(){this.node.scene.on(oa.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){if(!(e<2))for(var t=qY.length-1;t>=0;t--){var n=qY[t];if(e>=t+2){this.spriteLocalizer.key=n,this.animation.play();break}}}},{key:"handleOrientationChanged",value:function(e){e===VY.Portrait?(this.widget.left=20,this.widget.right=20):e===VY.Landscape&&(this.widget.left=700,this.widget.right=120)}}]),i}(re)).prototype,"spriteLocalizer",[mY,bY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AY=D(CY.prototype,"animation",[wY,kY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SY=CY));J._RF.pop(),J._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var WY,KY,jY,YY,XY,ZY,JY,QY,$Y,eX,tX,nX,iX,aX,oX,rX,lX,sX,uX,cX,hX,pX,dX,yX,vX,fX,gX=Q.ccclass,mX=Q.property,bX=(PY=gX("PlayerScore"),OY=mX(ge),IY=mX(we),LY=mX(he),_Y=mX(he),DY=mX(se),PY((zY=D((NY=function(e){B(i,e);var t,n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"crown",zY,x(e)),z(e,"playerScore",BY,x(e)),z(e,"playerScoreUiOpacity",FY,x(e)),z(e,"waitingUiOpacity",xY,x(e)),z(e,"avatar",UY,x(e)),e}return M(i,[{key:"showCrown",value:function(e){this.crown.active=e}},{key:"setPlayerScore",value:function(e){this.playerScore.string=e.toString()}},{key:"playWaitingAnimation",value:function(){this.waitingUiOpacity.node.active=!0,this.playerScoreUiOpacity.node.active=!1,this.waitingUiOpacity.opacity=130,this.playerScoreUiOpacity.opacity=0;var e=ie(this.waitingUiOpacity).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=ie(this.waitingUiOpacity).repeatForever(e).start()}},{key:"stopWaitingAnimation",value:function(){this.waitingAnimation&&this.waitingAnimation.stop(),this.waitingUiOpacity.opacity=0,this.playerScoreUiOpacity.opacity=255,this.waitingUiOpacity.node.active=!1,this.playerScoreUiOpacity.node.active=!0}},{key:"loadPhoto",value:(t=q((function*(e,t){try{var n=yield WE.getPlayerAvatar(e,t,128);if(!n)throw new Error("Failed to create sprite frame");n.packable=!0,this.avatar.spriteFrame=n}catch(e){return void console.error(e)}})),function(e,n){return t.apply(this,arguments)})}]),i}(re)).prototype,"crown",[OY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BY=D(NY.prototype,"playerScore",[IY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FY=D(NY.prototype,"playerScoreUiOpacity",[LY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xY=D(NY.prototype,"waitingUiOpacity",[_Y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UY=D(NY.prototype,"avatar",[DY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MY=NY))||MY);J._RF.pop(),J._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var wX,kX,SX,CX,EX,AX,TX=Q.ccclass,RX=Q.disallowMultiple,PX=Q.property,OX=globalThis.game,IX=OX.match,LX=OX.player,_X=OX.monitorError,DX=GameCore.Utils.Object;WY=TX("ChallengeResultScene"),KY=PX(p),jY=PX(p),YY=PX(p),XY=PX(p),ZY=PX({type:bX,group:"Score"}),JY=PX({type:bX,group:"Score"}),QY=PX(Ug),$Y=PX(xS),eX=PX(Be),tX=a.onlyRunInLifeCycle,nX=a.onlyRunInLifeCycle,iX=a.onlyRunInLifeCycle,aX=a.onlyRunInLifeCycle,oX=a.onlyRunInLifeCycle,WY(rX=RX((sX=D((lX=function(e){B(o,e);var n,i=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n)),z(e,"drawLocalizer",sX,x(e)),z(e,"winLocalizer",uX,x(e)),z(e,"loseLocalizer",cX,x(e)),z(e,"waitingLocalizer",hX,x(e)),z(e,"playerScore",pX,x(e)),z(e,"opponentScore",dX,x(e)),z(e,"paperConfetti",yX,x(e)),z(e,"levelManager",vX,x(e)),z(e,"headerAnimation",fX,x(e)),e.goToDashboardScene=function(){C.switchScene(A.DASHBOARD_SCENE)},e}return M(o,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.node.scene.on(t.RESULT_SCENE_HOME,this.goToDashboardScene),this.node.scene.on(t.RESULT_SCENE_REPLAY,this.handleTryAgainClicked,this)}},{key:"start",value:function(){this.scheduleOnce(this.preloadScenes,3);try{var e,t,n=IX.getMatchState(),i=n.customData,a=i.playerId,o=i.opponentId;if(null===a||null===o)throw new Error("ResultScene: playerId is ".concat(a," and opponentId is ").concat(o,". Expected to not be null."));var r=LX.getPlayer().photo,l=null!==(e=n.profiles[a])&&void 0!==e?e:{},s=l.score,u=void 0===s?0:s,c=l.finished,h=void 0!==c&&c,p=null!==(t=n.profiles[o])&&void 0!==t?t:{},d=p.photo,y=void 0===d?"":d,v=p.score,f=void 0===v?0:v,g=p.finished,m=void 0!==g&&g,b=h&&m,w=b&&u>f,k=b&&f>u;this.playerScore.loadPhoto(r,a),this.opponentScore.loadPhoto(y,o),this.playerScore.setPlayerScore(u),this.opponentScore.setPlayerScore(f),this.playerScore.showCrown(w),this.opponentScore.showCrown(k),h&&m?u===f?this.playStatusAnimation("Draw"):w?this.playStatusAnimation("Win"):k&&this.playStatusAnimation("Lose"):(h||this.playerScore.playWaitingAnimation(),m||this.opponentScore.playWaitingAnimation(),this.playStatusAnimation("Waiting"))}catch(e){console.warn("ResultScene: Error on load",e),this.goToDashboardScene()}}},{key:"preloadScenes",value:function(){C.preloadDashboardScene()}},{key:"handleTryAgainClicked",value:(n=q((function*(){var e,t=(null!==(e=LX.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;n=Math.max(1,n);var i=yield this.levelManager.loadLevelData(n);try{if(!i)throw new Error("Level data is not found");var a=IX.getMatchState().customData.opponentId;if(!a)throw new Error("Opponent id is not found");b.showLoadingScreen();var o=Nh.generateFen(i),r=i.mode,l=void 0===r?"":r,s=i.rules,u=void 0===s?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:s,c=i.time,h=void 0===c?0:c,p=i.level;yield IX.challenge.friend.processAsync({playerId:LX.getPlayerId(),opponentId:a,extraData:{level:p,fen:o,gravity:l,rules:u,time:h}}),b.closeLoadingScreen(),this.goToGameScene()}catch(e){if(DX.hasOwn(e,"code")&&"USER_INPUT"===e.code)return void b.closeLoadingScreen();console.warn("ReplayChallengeFriend",e),b.closeLoadingScreen(),b.showNotificationScreenWithLocalizedKey("error.challengeFail",2),null==_X||_X.sendException(e instanceof Error?e:new Error("ReplayChallengeFriend"+JSON.stringify(e))),this.scheduleOnce(this.goToDashboardScene,2)}})),function(){return n.apply(this,arguments)})},{key:"handleHomeClicked",value:function(){this.goToDashboardScene()}},{key:"goToGameScene",value:function(){C.switchScene(A.GAME_SCENE)}},{key:"playStatusAnimation",value:function(e){var t=this;"Win"!==e&&"Waiting"!==e||this.triggerConfettiAnimation();var n=this.getSpriteLocalizer(e);n.node.active=!0,n.waitLocalized().then((function(){switch(e){case"Draw":t.playDrawAnimation();break;case"Win":t.playWinAnimation();break;case"Lose":t.playLoseAnimation();break;case"Waiting":t.playWaitingAnimation()}}))}},{key:"getSpriteLocalizer",value:function(e){switch(e){case"Draw":return this.drawLocalizer;case"Win":return this.winLocalizer;case"Lose":return this.loseLocalizer;case"Waiting":return this.waitingLocalizer}}},{key:"playDrawAnimation",value:function(){this.headerAnimation.play("RibbonDraw"),l.playSound(wn.LEVEL_FAIL)}},{key:"playWinAnimation",value:function(){this.headerAnimation.play("RibbonWin"),l.playSound(wn.LEVEL_COMPLETE)}},{key:"playLoseAnimation",value:function(){this.headerAnimation.play("RibbonLose"),l.playSound(wn.LEVEL_FAIL)}},{key:"playWaitingAnimation",value:function(){this.headerAnimation.play("RibbonWaiting"),l.playSound(wn.LEVEL_COMPLETE)}},{key:"triggerConfettiAnimation",value:function(){var e=this;this.scheduleOnce((function(){var t,n=G(e.paperConfetti);try{for(n.s();!(t=n.n()).done;){t.value.play()}}catch(e){n.e(e)}finally{n.f()}}),.2)}}]),o}(re)).prototype,"drawLocalizer",[KY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uX=D(lX.prototype,"winLocalizer",[jY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cX=D(lX.prototype,"loseLocalizer",[YY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hX=D(lX.prototype,"waitingLocalizer",[XY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pX=D(lX.prototype,"playerScore",[ZY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dX=D(lX.prototype,"opponentScore",[JY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yX=D(lX.prototype,"paperConfetti",[QY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vX=D(lX.prototype,"levelManager",[$Y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fX=D(lX.prototype,"headerAnimation",[eX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(lX.prototype,"playDrawAnimation",[tX],Object.getOwnPropertyDescriptor(lX.prototype,"playDrawAnimation"),lX.prototype),D(lX.prototype,"playWinAnimation",[nX],Object.getOwnPropertyDescriptor(lX.prototype,"playWinAnimation"),lX.prototype),D(lX.prototype,"playLoseAnimation",[iX],Object.getOwnPropertyDescriptor(lX.prototype,"playLoseAnimation"),lX.prototype),D(lX.prototype,"playWaitingAnimation",[aX],Object.getOwnPropertyDescriptor(lX.prototype,"playWaitingAnimation"),lX.prototype),D(lX.prototype,"triggerConfettiAnimation",[oX],Object.getOwnPropertyDescriptor(lX.prototype,"triggerConfettiAnimation"),lX.prototype),rX=lX))||rX);J._RF.pop(),J._RF.push({},"c0a5fPghzxBxpXiudxt+Qd4","TestParticleSystemScene",void 0);var MX,NX,zX,BX,FX,xX,UX,GX,HX,VX=Q.ccclass,qX=Q.property;wX=VX("TestParticleSystemScene"),kX=qX(ge),SX=a.required(),wX((AX=D((EX=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"stars",AX,x(e)),e}return M(n,[{key:"__preload",value:function(){C.markIsTestScene(A.TEST_PARTICLE_SYSTEM_SCENE)}},{key:"onLoad",value:function(){GameSDK.startGameAsync().catch((function(e){console.warn("GameSDK.startGameAsync",e)}))}},{key:"start",value:function(){var e=this.stars.getComponent(Ug);null==e||e.play()}}]),n}(re)).prototype,"stars",[kX,SX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CX=EX));J._RF.pop(),J._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var WX,KX=Q.ccclass,jX=Q.property,YX=Q.disallowMultiple,XX=GameCore.Events,ZX=globalThis.game.event,JX=(MX=KX("BaseScreen"),NX=jX(ge),zX=jX(ge),BX=jX(he),MX(FX=YX((UX=D((xX=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"container",UX,x(e)),z(e,"backgroundMask",GX,x(e)),z(e,"screenOpacity",HX,x(e)),e.data={},e}return M(n,[{key:"__preload",value:function(){this.animation=this.getComponent(Be),this.backgroundMaskButton=this.backgroundMask.getComponent(ve),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function(){var e=this.getMaskOpacity(),t=this.getContainerOpacity();e&&t&&(e.opacity=0,t.opacity=0)}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function(e){this.screenOpacity.opacity=e}},{key:"open",value:function(e){var t,n;e&&(this.data=e),this.show(),this.runAnimation(null!==(t=null===(n=this.data.overrideAnimation)||void 0===n?void 0:n.openScreen)&&void 0!==t?t:"OpenScreen")}},{key:"close",value:function(){var e,t,n=this;this.node.active&&(this.animation.once(Be.EventType.FINISHED,(function(){ZX.emit(XX.CLOSED_SCREEN,{screenName:n.node.name}),n.hide()})),this.runAnimation(null!==(e=null===(t=this.data.overrideAnimation)||void 0===t?void 0:t.closeScreen)&&void 0!==e?e:"CloseScreen"))}},{key:"runAnimation",value:function(e){if(!this.isAnimationExist(e))throw new Error("".concat(this.node.name,": Animation component must have ").concat(e," clip"));this.animation.play(e)}},{key:"isAnimationExist",value:function(e){return this.animation.clips.some((function(t){return!(!t||t.name!==e)}))}},{key:"getMaskOpacity",value:function(){var e=this.backgroundMask.getComponent(he);return e||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function(){var e=this.container.getComponent(he);return e||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function(){this.setScreenOpacity(255);var e=this.node.getComponent(ne);if(e){e.enabled=!0,e.updateAlignment();var t,n=this.node.getComponentsInChildren(ne),i=G(n);try{for(i.s();!(t=i.n()).done;){t.value.updateAlignment()}}catch(e){i.e(e)}finally{i.f()}}}},{key:"hide",value:function(){this.setScreenOpacity(0),this.node.setWorldPosition(new Oe(-1e3,-1e3,0));var e=this.node.getComponent(ne);e&&(e.enabled=!1)}}]),n}(re)).prototype,"container",[NX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GX=D(xX.prototype,"backgroundMask",[zX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HX=D(xX.prototype,"screenOpacity",[BX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FX=xX))||FX)||FX);J._RF.pop(),J._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var QX,$X,eZ,tZ,nZ,iZ,aZ,oZ,rZ,lZ,sZ,uZ,cZ,hZ,pZ=Q.ccclass,dZ=Q.requireComponent;pZ("BackgroundMask")(WX=dZ([he])(WX=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"onLoad",value:function(){var e=this.getComponent(he);e?(this.opacity=e,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var e,t,n=this.opacity.opacity/255;e=n,(t=document.getElementById("app-mask"))&&(t.style.background="rgb(0 0 0 / ".concat(e,")"))}}]),n}(re))||WX);J._RF.pop(),J._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var yZ,vZ,fZ,gZ,mZ,bZ,wZ,kZ,SZ,CZ,EZ,AZ,TZ,RZ,PZ,OZ,IZ,LZ,_Z,DZ,MZ,NZ,zZ,BZ=Q.ccclass,FZ=Q.property,xZ=Q.disallowMultiple,UZ=Q.requireComponent,GZ=GameCore.Events,HZ=globalThis.game.event;QX=BZ("CongratulationScreen"),$X=UZ(JX),eZ=FZ(ge),tZ=FZ(ge),nZ=FZ(ve),iZ=FZ(ve),aZ=FZ(ve),QX(oZ=xZ(oZ=$X((lZ=D((rZ=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"congratulation",lZ,x(e)),z(e,"confirmation",sZ,x(e)),z(e,"closeButtonComponent",uZ,x(e)),z(e,"yesButtonComponent",cZ,x(e)),z(e,"noButtonComponent",hZ,x(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("CongratulationScreen: screen not found");e.validateEventPayload(t)&&(e.closeButtonComponent.interactable=!0,e.yesButtonComponent.interactable=!0,e.noButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return M(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.confirmationUIOpacity=this.confirmation.getComponent(he),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){HZ.on(GZ.OPENING_SCREEN,this.handleOpeningScreen),HZ.on(GZ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){HZ.off(GZ.OPENING_SCREEN,this.handleOpeningScreen),HZ.off(GZ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,b.closeScreen(w.CONGRATULATION_SCREEN)}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,ie(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),ie(this.confirmation).set({scale:new Oe(.8,.8,.8)}).to(.2,{scale:new Oe(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(oa.START_OVER,1)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(oa.GAME_REPLAY,{level:this.screen.data.level})}}]),n}(re)).prototype,"congratulation",[eZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sZ=D(rZ.prototype,"confirmation",[tZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uZ=D(rZ.prototype,"closeButtonComponent",[nZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cZ=D(rZ.prototype,"yesButtonComponent",[iZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hZ=D(rZ.prototype,"noButtonComponent",[aZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oZ=rZ))||oZ)||oZ);J._RF.pop(),J._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var VZ,qZ,WZ,KZ,jZ,YZ,XZ,ZZ,JZ,QZ,$Z,eJ,tJ,nJ,iJ,aJ,oJ,rJ,lJ,sJ,uJ,cJ=Q.ccclass,hJ=Q.property,pJ=(yZ=cJ("DayBlock"),vZ=hJ({type:se,group:"Background"}),fZ=hJ({type:se,group:"Background"}),gZ=hJ({type:ze,group:"Background"}),mZ=hJ({type:ze,group:"Background"}),bZ=hJ(we),wZ=hJ(p),kZ=hJ(we),SZ=hJ(ge),CZ=hJ(ge),EZ=hJ(ge),yZ((RZ=D((TZ=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"background",RZ,x(e)),z(e,"topBackground",PZ,x(e)),z(e,"blueBackground",OZ,x(e)),z(e,"blueTopBackground",IZ,x(e)),z(e,"dayLabel",LZ,x(e)),z(e,"dayLocalizer",_Z,x(e)),z(e,"coinLabel",DZ,x(e)),z(e,"rewardItemsNode",MZ,x(e)),z(e,"checkNode",NZ,x(e)),z(e,"glowNodes",zZ,x(e)),e}return M(n,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(he),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new be(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new be("#3469bf")}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e){this.updateBackground(e),this.updateDayLabel(e),this.coinLabel.string=e.value.toString(),this.updateRewardItems(e)}},{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLocalizer.setParams([e.day.toString()]);var t=this.defaultDayLabelOutlineColor;"rewarded"!==e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=t,this.dayLabel.shadowColor=t}},{key:"updateRewardItems",value:function(e){switch(e.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(e){this.glowNodes&&this.glowNodes.forEach((function(t){t.active=e}))}}]),n}(re)).prototype,"background",[vZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PZ=D(TZ.prototype,"topBackground",[fZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OZ=D(TZ.prototype,"blueBackground",[gZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IZ=D(TZ.prototype,"blueTopBackground",[mZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LZ=D(TZ.prototype,"dayLabel",[bZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_Z=D(TZ.prototype,"dayLocalizer",[wZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DZ=D(TZ.prototype,"coinLabel",[kZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MZ=D(TZ.prototype,"rewardItemsNode",[SZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NZ=D(TZ.prototype,"checkNode",[CZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zZ=D(TZ.prototype,"glowNodes",[EZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AZ=TZ))||AZ);J._RF.pop(),J._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var dJ,yJ=Q.ccclass,vJ=Q.property,fJ=Q.requireComponent,gJ=GameCore,mJ=gJ.Events,bJ=gJ.Utils,wJ=bJ.Object,kJ=bJ.Array,SJ=gJ.Configs.DailyRewards,CJ=globalThis.game,EJ=CJ.event,AJ=CJ.dailyRewards,TJ=CJ.player,RJ=CJ.monitorError;VZ=yJ("DailyRewardsScreen"),qZ=fJ(JX),WZ=a.required(),KZ=a.required(),jZ=vJ(ge),YZ=a.required(),XZ=vJ(ve),ZZ=a.required(),JZ=vJ(ve),QZ=vJ([pJ]),$Z=a.onlyRunInLifeCycleAsync,eJ=a.onlyRunInLifeCycle,tJ=a.onlyRunInLifeCycleAsync,nJ=a.onlyRunInLifeCycle,VZ(iJ=qZ((oJ=D((aJ=function(t){B(c,t);var n,i,o,l,s,u=F(c);function c(){var e;N(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=u.call.apply(u,[this].concat(n)),z(e,"screen",oJ,x(e)),e.rewardsData=[],e.debugScreenOpened=!1,e.debugUpdatedRewardsData=!1,z(e,"loadingRing",rJ,x(e)),z(e,"claimButton",lJ,x(e)),z(e,"claimX2Button",sJ,x(e)),z(e,"dailyBlocks",uJ,x(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!0)},e.handleOpenedScreen=function(){var t=q((function*(t){e.validateEventPayload(t)&&e.open()}));return function(e){return t.apply(this,arguments)}}(),e}return M(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),a.validateRequiredProperties(this),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"listenScreenEvents",value:function(){EJ.on(mJ.OPENING_SCREEN,this.handleOpeningScreen),EJ.on(mJ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){EJ.off(mJ.OPENING_SCREEN,this.handleOpeningScreen),EJ.off(mJ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.prepareScreen(),this.openAsync()}},{key:"openAsync",value:(s=q((function*(){yield this.updateRewardsData(),yield this.updateScreenToMatchData()})),function(){return s.apply(this,arguments)})},{key:"updateScreenToMatchData",value:function(){return this.loginDailyRewards(),this.updateDayBlocks(),this.loadingRing.active=!1,this.setInteractableButtons(!0),this.runPopUpAnimation()}},{key:"prepareScreen",value:function(){
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.debugScreenOpened=!0,this.loadingRing.active=!0,this.setInteractableButtons(!1),this.node.scene.emit(oa.HIDE_UI),this.resetState()}},{key:"close",value:function(){EJ.emit(mJ.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(oa.SHOW_UI)}},{key:"resetState",value:function(){var e,t=G(this.dailyBlocks);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.uiOpacity.opacity=0,n.node.scale=new Oe(1.2,1.2,1.2)}}catch(e){t.e(e)}finally{t.f()}}},{key:"runPopUpAnimation",value:(l=q((function*(){var e=this;this.screen.container||console.warn("DailyRewardScreen: screen not found"),yield Promise.all(this.dailyBlocks.map((function(t,n){return e.runAppearTween(t,.15*n)})))})),function(){return l.apply(this,arguments)})},{key:"runAppearTween",value:(o=q((function*(t,n){var i=ie(t.uiOpacity).delay(n).to(.3,{opacity:255},{easing:"quadOut"}),a=ie(t.node).delay(n).to(.3,{scale:Oe.ONE},{easing:"backOut"});yield Promise.all([e.runTweenAsync(i),e.runTweenAsync(a)])})),function(e,t){return o.apply(this,arguments)})},{key:"handleOnClaim",value:function(){this.setInteractableButtons(!1);var e=this.getCurrentRewardData();if(!e)
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return null==RJ||RJ.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),b.showNotificationScreenWithLocalizedKey("error.rewardFail",2),void this.setInteractableButtons(!0);this.claimReward(e)}},{key:"handleOnClaimX2",value:(i=q((function*(){this.setInteractableButtons(!1);var e=this.getCurrentRewardData();if(!e)
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return null==RJ||RJ.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),b.showNotificationScreenWithLocalizedKey("error.rewardFail",2),void this.setInteractableButtons(!0);(yield k.showRewardVideoAdAsync({}))?this.claimReward(e,!0):this.setInteractableButtons(!0)})),function(){return i.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return kJ.search(this.rewardsData,(function(e){return"ready"===e.status}))}},{key:"claimReward",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.value*(t?2:1),i=new r;if(this.node.scene.emit(oa.ADD_COINS,{coins:n,collectionAnimation:{animateTextOnly:!1,signal:i}}),e.items){var a=e.items.hint*(t?2:1),o=e.items.thunder*(t?2:1),l=e.items.storm*(t?2:1),s=TJ.getGameData();s?(TJ.setGameData({items:{hint:s.items.hint+a,thunder:s.items.thunder+o,storm:s.items.storm+l,pliers:s.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(n=q((function*(){yield AJ.requestDailyRewardsAsync();for(var e=U({},AJ.getDailyRewards()),t=0;t<SJ.MaxDays;t++){var n=Cs[t];if(n){var i=e[t];i&&(e[t]=U(U({},i),{},{value:n.value,items:n.items}))}}e&&(this.rewardsData=wJ.vals(e),
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData))})),function(){return n.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){AJ.logLoginReward()}},{key:"updateDayBlocks",value:function(){var e=this;
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),null==RJ||RJ.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach((function(t,n){
//! DEBUG bug Cannot read properties of undefined (reading 'find')
if(!(n>=e.rewardsData.length)){var i=e.rewardsData[n];if(i){var a=i.id,o=i.type,r=i.value,l=i.status;t.updateInfo({day:a,type:o,value:r,status:l})}}}))}},{key:"setInteractableButtons",value:function(e){this.claimButton.interactable=e,this.claimX2Button.interactable=e,this.screen.backgroundMaskButton.interactable=e}}]),c}(re)).prototype,"screen",[WZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rJ=D(aJ.prototype,"loadingRing",[KZ,jZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lJ=D(aJ.prototype,"claimButton",[YZ,XZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sJ=D(aJ.prototype,"claimX2Button",[ZZ,JZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uJ=D(aJ.prototype,"dailyBlocks",[QZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),D(aJ.prototype,"updateScreenToMatchData",[$Z],Object.getOwnPropertyDescriptor(aJ.prototype,"updateScreenToMatchData"),aJ.prototype),D(aJ.prototype,"claimReward",[eJ],Object.getOwnPropertyDescriptor(aJ.prototype,"claimReward"),aJ.prototype),D(aJ.prototype,"updateRewardsData",[tJ],Object.getOwnPropertyDescriptor(aJ.prototype,"updateRewardsData"),aJ.prototype),D(aJ.prototype,"setInteractableButtons",[nJ],Object.getOwnPropertyDescriptor(aJ.prototype,"setInteractableButtons"),aJ.prototype),iJ=aJ))||iJ);J._RF.pop(),J._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var PJ,OJ,IJ,LJ,_J,DJ,MJ,NJ,zJ,BJ;(0,Q.ccclass)("DayBlockRed")(dJ=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n,[{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLocalizer.setParams([e.day.toString()]);var t=this.defaultDayLabelOutlineColor;"ready"===e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=t,this.dayLabel.outlineColor=t}}]),n}(pJ));J._RF.pop(),J._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var FJ,xJ,UJ,GJ,HJ,VJ,qJ,WJ,KJ,jJ,YJ,XJ,ZJ,JJ,QJ,$J,eQ,tQ,nQ,iQ,aQ,oQ,rQ,lQ,sQ,uQ,cQ,hQ,pQ,dQ,yQ,vQ=Q.ccclass,fQ=Q.property,gQ=Q.requireComponent,mQ=globalThis.game.event,bQ=GameCore.Events;PJ=vQ("GetCoinScreen"),OJ=gQ(JX),IJ=fQ(we),LJ=fQ(ve),_J=fQ(ve),PJ(DJ=OJ((NJ=D((MJ=function(e){B(i,e);var t,n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"quantityLabel",NJ,x(e)),z(e,"closeButtonComponent",zJ,x(e)),z(e,"getNowButtonComponent",BJ,x(e)),e.handleOpeningScreen=function(t){console.log("GetCoinScreen.OPENING_SCREEN",t),e.validateEventPayload(t)&&(e.setInteractableButtons(!0),e.updateStatus())},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return M(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){mQ.on(bQ.OPENING_SCREEN,this.handleOpeningScreen),mQ.on(bQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){mQ.off(bQ.OPENING_SCREEN,this.handleOpeningScreen),mQ.off(bQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return"screenName"in e&&(e.screenName===this.node.name&&(this.payload=e,!0))}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(oa.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),mQ.emit(bQ.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(oa.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var e=this.getQuantity();e&&this.updateQuantityLabel(e)}},{key:"updateQuantityLabel",value:function(e){this.quantityLabel.string="x".concat(e.toString())}},{key:"getQuantity",value:function(){var e=this.payload.screenData;return e&&"quantity"in e&&e.quantity&&"number"==typeof e.quantity?e.quantity:0}},{key:"handleAddCoin",value:function(){var e=this.getQuantity();this.node.scene.emit(oa.ADD_COINS,{coins:e,collectionAnimation:{animateTextOnly:!1},skipAnimation:!0}),this.close()}},{key:"handleGetNowButtonClicked",value:(t=q((function*(){l.stopAllSounds(),(yield k.showRewardVideoAdAsync({}))&&this.handleAddCoin()})),function(){return t.apply(this,arguments)})},{key:"setInteractableButtons",value:function(e){this.closeButtonComponent.interactable=e,this.getNowButtonComponent.interactable=e,this.screen.backgroundMaskButton.interactable=e}}]),i}(re)).prototype,"quantityLabel",[IJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zJ=D(MJ.prototype,"closeButtonComponent",[LJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BJ=D(MJ.prototype,"getNowButtonComponent",[_J],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DJ=MJ))||DJ);J._RF.pop(),J._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var wQ,kQ,SQ,CQ,EQ,AQ,TQ,RQ,PQ,OQ,IQ=Q.ccclass,LQ=Q.property,_Q=globalThis.game,DQ=_Q.event,MQ=_Q.player,NQ=_Q.analytics,zQ=_Q.language,BQ=GameCore,FQ=BQ.Events,xQ=BQ.Utils.Array,UQ=BQ.Plugins.Analytics.Events,GQ=Object.values(d);FJ=IQ("GetItemScreen"),xJ=LQ({type:Ve,group:"Item"}),UJ=LQ({type:se,group:"Item"}),GJ=LQ({type:ze,group:"Item"}),HJ=LQ({type:ze,group:"Item"}),VJ=LQ({type:ze,group:"Item"}),qJ=LQ({type:ze,group:"Item"}),WJ=LQ({type:we,group:"Title"}),KJ=LQ({type:p,group:"Title"}),jJ=LQ({type:we,group:"Description"}),YJ=LQ({type:p,group:"Description"}),XJ=LQ(we),ZJ=LQ({type:ve,group:"Buttons"}),JJ=LQ({type:ve,group:"Buttons"}),QJ=LQ({type:ve,group:"Buttons"}),FJ((tQ=D((eQ=function(e){B(r,e);var t,n,i,o=F(r);function r(){var e;N(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),z(e,"itemFxPrefab",tQ,x(e)),z(e,"itemSprite",nQ,x(e)),z(e,"hintSpriteFrame",iQ,x(e)),z(e,"stormSpriteFrame",aQ,x(e)),z(e,"thunderSpriteFrame",oQ,x(e)),z(e,"pliersSpriteFrame",rQ,x(e)),z(e,"titleLabel",lQ,x(e)),z(e,"titleLocalizer",sQ,x(e)),z(e,"descriptionLabel",uQ,x(e)),z(e,"descriptionLocalizer",cQ,x(e)),z(e,"coinLabel",hQ,x(e)),z(e,"closeButtonComponent",pQ,x(e)),z(e,"buyItemButtonComponent",dQ,x(e)),z(e,"getNowButtonComponent",yQ,x(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("GetItemScreen: screen not found");e.validateEventPayload(t)&&e.validateEventPayloadData(t.screenData)&&(e.setInteractableButtons(!0),e.data=t.screenData,e.updateStatus(t.screenData))},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return M(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){DQ.on(FQ.OPENING_SCREEN,this.handleOpeningScreen),DQ.on(FQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){DQ.off(FQ.OPENING_SCREEN,this.handleOpeningScreen),DQ.off(FQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"validateEventPayloadData",value:function(e){return!!e&&(!(!("item"in e)||!xQ.has(GQ,e.item))&&("quantity"in e&&"number"==typeof e.quantity&&!("localizedMessageKey"in e&&void 0!==e.localizedMessageKey&&!zQ.hasTextKey(e.localizedMessageKey))))}},{key:"open",value:function(){this.node.scene.emit(oa.GAME_PAUSE)}},{key:"close",value:function(){this.setInteractableButtons(!1),DQ.emit(FQ.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(oa.GAME_RESUME)}},{key:"updateStatus",value:function(e){this.updateItemIcon(e.item),this.updateTitle(e.item),e.localizedMessageKey&&this.updateDescription(e.localizedMessageKey),this.updateButtons(e.item)}},{key:"updateItemIcon",value:function(e){switch(e){case d.HINT:this.itemSprite.spriteFrame=this.hintSpriteFrame;break;case d.STORM:this.itemSprite.spriteFrame=this.stormSpriteFrame;break;case d.THUNDER:this.itemSprite.spriteFrame=this.thunderSpriteFrame;break;case d.PLIERS:this.itemSprite.spriteFrame=this.pliersSpriteFrame}}},{key:"getItemLocalizedTitleKey",value:function(e){switch(e){case d.HINT:return"item.hint";case d.STORM:return"item.storm";case d.THUNDER:return"item.thunder";case d.PLIERS:return"item.pliers"}}},{key:"updateTitle",value:function(e){this.titleLocalizer.key=this.getItemLocalizedTitleKey(e)}},{key:"updateDescription",value:function(e){this.descriptionLocalizer.key=e}},{key:"updateButtons",value:function(e){var t=this.canBuyItem(e);this.buyItemButtonComponent.node.active=t,this.getNowButtonComponent.node.active=!t,t&&(this.coinLabel.string="".concat(3*ws[e]))}},{key:"canBuyItem",value:function(e){var t=MQ.getGameData();return!!t&&t.coins>=3*ws[e]}},{key:"handleAddItem",value:(i=q((function*(){this.data.item&&(NQ.event(UQ.EARN_ITEM,{item_name:this.data.item,value:3}),this.node.scene.emit(oa.ADD_ITEM,{animate:{startWorldPosition:this.itemSprite.node.worldPosition.clone()},item:this.data.item,quantity:3}))})),function(){return i.apply(this,arguments)})},{key:"handleGetNowButtonClicked",value:(n=q((function*(){this.stopAllSounds(),(yield k.showRewardVideoAdAsync({}))&&(this.handleAddItem(),this.close())})),function(){return n.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(t=q((function*(){this.node.scene.emit(oa.REMOVE_COINS,{coins:3*ws[this.data.item],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close()})),function(){return t.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var e;null===(e=Me("Sound"))||void 0===e||null===(e=e.getComponent(P))||void 0===e||e.stopAll()}},{key:"setInteractableButtons",value:function(e){this.closeButtonComponent.interactable=e,this.buyItemButtonComponent.interactable=e,this.getNowButtonComponent.interactable=e,this.screen.backgroundMaskButton.interactable=e}}]),r}(re)).prototype,"itemFxPrefab",[xJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nQ=D(eQ.prototype,"itemSprite",[UJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iQ=D(eQ.prototype,"hintSpriteFrame",[GJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aQ=D(eQ.prototype,"stormSpriteFrame",[HJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oQ=D(eQ.prototype,"thunderSpriteFrame",[VJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rQ=D(eQ.prototype,"pliersSpriteFrame",[qJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lQ=D(eQ.prototype,"titleLabel",[WJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sQ=D(eQ.prototype,"titleLocalizer",[KJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uQ=D(eQ.prototype,"descriptionLabel",[jJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cQ=D(eQ.prototype,"descriptionLocalizer",[YJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hQ=D(eQ.prototype,"coinLabel",[XJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pQ=D(eQ.prototype,"closeButtonComponent",[ZJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dQ=D(eQ.prototype,"buyItemButtonComponent",[JJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yQ=D(eQ.prototype,"getNowButtonComponent",[QJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$J=eQ));J._RF.pop(),J._RF.push({},"4d6710xA7hAk65cGA4Dgdrc","GetRewardsScreen",void 0);var HQ,VQ=Q.ccclass,qQ=Q.requireComponent,WQ=Q.property,KQ=GameCore.Events,jQ=globalThis.game.event;wQ=VQ("GetRewardsScreen"),kQ=qQ(JX),SQ=WQ(p),CQ=WQ(ve),EQ=WQ(he),wQ(AQ=kQ((RQ=D((TQ=function(t){B(o,t);var n,i=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n)),z(e,"adStartingLocalizer",RQ,x(e)),z(e,"skipButton",PQ,x(e)),z(e,"skipButtonUiOpacity",OQ,x(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.skipButtonUiOpacity.opacity=0,e.setInteractableButtons(!1))},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return M(o,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){jQ.on(KQ.OPENING_SCREEN,this.handleOpeningScreen),jQ.on(KQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){jQ.off(KQ.OPENING_SCREEN,this.handleOpeningScreen),jQ.off(KQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.runAdStartingAnimation()}},{key:"close",value:function(e){this.setInteractableButtons(!1),jQ.emit(KQ.CLOSE_SCREEN,{screenName:this.node.name,screenData:{getRewardsSuccess:e}})}},{key:"runAdStartingAnimation",value:function(){var t=this,n=5;this.adStartingLocalizer.setParams([n.toString()]);this.schedule((function(){n<=0?t.stopAdStartingAnimation():(3===--n&&e.runTweenAsync(ie(t.skipButtonUiOpacity).to(.3,{opacity:255},{onComplete:function(){t.setInteractableButtons(!0)}})),t.adStartingLocalizer.setParams([n.toString()]))}),1,6)}},{key:"stopAdStartingAnimation",value:(n=q((function*(){this.unscheduleAllCallbacks();var e=yield k.showRewardedInterstitialAdAsync({});this.close(e)})),function(){return n.apply(this,arguments)})},{key:"handleClickedSkip",value:function(){this.unscheduleAllCallbacks(),this.close(!1)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(e){this.skipButton.interactable=e}}]),o}(re)).prototype,"adStartingLocalizer",[SQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PQ=D(TQ.prototype,"skipButton",[CQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OQ=D(TQ.prototype,"skipButtonUiOpacity",[EQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AQ=TQ))||AQ);J._RF.pop(),J._RF.push({},"bfe1eXch0ZMKIz1ofLKc2Iv","HardLevelScreen",void 0);var YQ,XQ,ZQ,JQ,QQ,$Q,e$,t$,n$,i$,a$,o$,r$,l$=Q.ccclass,s$=Q.requireComponent,u$=GameCore.Events,c$=globalThis.game.event;l$("HardLevelScreen")(HQ=s$(JX)(HQ=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).handleOpeningScreen=function(t){e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return M(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){c$.on(u$.OPENING_SCREEN,this.handleOpeningScreen),c$.on(u$.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){c$.off(u$.OPENING_SCREEN,this.handleOpeningScreen),c$.off(u$.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation()}},{key:"close",value:function(){b.closeScreen(O[this.node.name])}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}}]),n}(re))||HQ);J._RF.pop(),J._RF.push({},"2db0dg4dI9GCKCdFOMrBFsQ","GetRewardsEffect",void 0);var h$,p$,d$,y$,v$,f$,g$,m$,b$,w$,k$,S$,C$,E$,A$,T$,R$,P$,O$,I$,L$,_$,D$,M$,N$,z$,B$,F$,x$,U$,G$,H$,V$,q$,W$=Q.ccclass,K$=Q.property,j$=(YQ=W$("GetRewardsEffect"),XQ=K$(ze),ZQ=K$(ze),JQ=K$(ze),QQ=K$(ze),$Q=K$(Ug),YQ((n$=D((t$=function(t){B(o,t);var n,i=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=i.call.apply(i,[this].concat(n)),z(e,"hint",n$,x(e)),z(e,"thunder",i$,x(e)),z(e,"storm",a$,x(e)),z(e,"pliers",o$,x(e)),z(e,"particles",r$,x(e)),e}return M(o,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"playAnimation",value:(n=q((function*(t,n){var i=this,a=-30*(t.length-1)/2+90;yield Promise.all(t.map((function(t,o){var r=i.createSprite(t),s=a+30*o,u=.15*o;r.node.position=new Oe(300*Math.cos(s*(Math.PI/180)),300*Math.sin(s*(Math.PI/180)),0);var c=ie(r.node);return c.delay(u),c.to(.6,{position:Oe.ZERO,scale:new Oe(.7,.7,.7)},{easing:"backIn"}),e.runTweenAsync(c).then((function(){n(),l.playSound(wn.COLLECT_STARS),i.playExplodeEffect(),r.node.destroy()}))})))})),function(e,t){return n.apply(this,arguments)})},{key:"playExplodeEffect",value:function(){var e,t=G(this.particles);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.play()}}catch(e){t.e(e)}finally{t.f()}}},{key:"createSprite",value:function(e){var t=this.getSpriteFrame(e),n=(new ge).addComponent(se);return n.spriteFrame=t,n.node.parent=this.node,n.node.scale=new Oe(1.5,1.5,1.5),n}},{key:"getSpriteFrame",value:function(e){switch(e){case"hint":return this.hint;case"thunder":return this.thunder;case"storm":return this.storm;case"pliers":return this.pliers;default:return null}}}]),o}(re)).prototype,"hint",[XQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i$=D(t$.prototype,"thunder",[ZQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a$=D(t$.prototype,"storm",[JQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o$=D(t$.prototype,"pliers",[QQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r$=D(t$.prototype,"particles",[$Q],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),e$=t$))||e$);J._RF.pop(),J._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var Y$,X$=Q.ccclass,Z$=Q.property,J$=Q.requireComponent,Q$=GameCore,$$=Q$.Events,e0=Q$.Utils.Valid,t0=globalThis.game,n0=t0.event,i0=t0.player,a0="Coin Container";h$=X$("LevelCompleteScreen"),p$=J$(JX),d$=Z$(we),y$=Z$(we),v$=Z$(he),f$=Z$(j$),g$=Z$({type:ve,group:"Play Button"}),m$=Z$({type:ge,group:"Play Button"}),b$=Z$({type:he,group:"Play Button"}),w$=Z$({type:ge,group:"Play Button"}),k$=Z$({type:ge,group:"Play Button"}),S$=Z$({type:Be,group:a0}),C$=Z$({type:t_,group:a0}),E$=Z$({type:Be,group:a0}),A$=Z$({type:nt,group:a0}),T$=Z$({type:nt,group:a0}),R$=Z$(Ug),h$(P$=p$((I$=D((O$=function(t){B(d,t);var n,i,o,l,s,u,c,h,p=F(d);function d(){var t;N(this,d);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return(t=p.call.apply(p,[this].concat(i))).level=1,t.coins=40,t.currentCoins=0,t.score=0,t.playAnimation=!1,t.getRewardsSuccess=!1,t.lookingForRewards=!1,t.playButtonSignal=new r,z(t,"coinText",I$,x(t)),z(t,"scoreText",L$,x(t)),z(t,"lookingForRewardsText",_$,x(t)),z(t,"getRewardsEffect",D$,x(t)),z(t,"playButton",M$,x(t)),z(t,"playBackground",N$,x(t)),z(t,"shineBackground",z$,x(t)),z(t,"hardLevelBackground",B$,x(t)),z(t,"playButtonContainer",F$,x(t)),z(t,"coinAnimation",x$,x(t)),z(t,"coinContainer",U$,x(t)),z(t,"coinContainerAnimation",G$,x(t)),z(t,"coinContainerEnterClip",H$,x(t)),z(t,"coinContainerExitClip",V$,x(t)),z(t,"particles",q$,x(t)),t.coinContainerShown=!1,t.handleOpeningScreen=function(e){if(!t.screen)throw new Error("StarChestScreen: screen not found");t.validateEventPayload(e)&&(t.playButton.interactable=!0)},t.handleOpenedScreen=function(e){t.validateEventPayload(e)&&t.open()},t.handleParticleEnd=q((function*(){t.level&&(yield e.waitTweenAsync(.15)),yield Promise.all([t.animateCoin(),t.animateScore()]),t.lookingForRewards?yield t.handleLookingForRewards():yield t.animateVisiblePlayButton(!0)})),t}return M(d,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){n0.on($$.OPENING_SCREEN,this.handleOpeningScreen),n0.on($$.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){n0.off($$.OPENING_SCREEN,this.handleOpeningScreen),n0.off($$.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){var t=null!=e?e:{},n=t.screenName,i=t.screenData;return n===this.node.name&&(!!e0.isObject(i)&&(e0.isNumber(i.level)&&(this.level=i.level,this.coins=this.level<5?gs:ms),e0.isNumber(i.coins)&&(this.currentCoins=i.coins),e0.isNumber(i.score)&&(this.score=i.score),this.playAnimation=!1,e0.isObject(i.overrideAnimation)&&(this.playAnimation="LevelCompleteOpenScreen"===i.overrideAnimation.openScreen),this.lookingForRewards=!1,e0.isBoolean(i.lookingForRewards)&&(this.lookingForRewards=i.lookingForRewards),this.getRewardsSuccess=!1,e0.isBoolean(i.getRewardsSuccess)&&(this.getRewardsSuccess=i.getRewardsSuccess),!0))}},{key:"open",value:function(){this.updateStatus(),this.node.scene.emit(oa.HIDE_UI),this.tryPlayAnimation()}},{key:"close",value:(h=q((function*(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=G(this.particles);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.stop()}}catch(e){i.e(e)}finally{i.f()}this.coinContainerShown&&(this.coinContainerShown=!1,yield e.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name)),n0.emit($$.CLOSE_SCREEN,{screenName:this.node.name,screenData:{canShowRewardsAd:n}}),this.node.scene.emit(oa.ABORT_COIN_ANIMATION)})),function(){return h.apply(this,arguments)})},{key:"updateStatus",value:function(){this.updateCoinContainer(),this.updatePlayButton(),this.lookingForRewardsText.opacity=0}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoins})}},{key:"updatePlayButton",value:function(){var e=i0.getGameData();if(e){var t=(this.level+1>e.totalLevel?this.level:this.level+1)%5==0;this.playBackground.active=!t,this.hardLevelBackground.active=t}}},{key:"tryPlayAnimation",value:function(){if(this.playAnimation){this.screen.setScreenOpacity(255),this.coinText.string="x0",this.scoreText.string="0",this.animateVisiblePlayButton(!1,!1);var e,t=G(this.particles);try{for(t.s();!(e=t.n()).done;){e.value.play()}}catch(e){t.e(e)}finally{t.f()}var n=this.screen.getComponent(Be);n?n.once(Be.EventType.FINISHED,this.handleParticleEnd):this.handleParticleEnd()}else{if(this.animateVisiblePlayButton(!0,!1),!this.getRewardsSuccess)return;this.getRewardsEffect.playAnimation(["storm","thunder"],this.animateCollectItemPlayButton.bind(this))}}},{key:"handleLookingForRewards",value:(c=q((function*(){yield this.animateLookingForRewards(),k.canShowRewardedInterstitialAd()?this.close(!0):this.animateVisiblePlayButton(!0)})),function(){return c.apply(this,arguments)})},{key:"animateCoin",value:(u=q((function*(){var t=this;this.screen.container?(this.coinAnimation.play(),yield e.runOnUpdateAsync(this.node,.8,(function(e){var n=We(0,t.coins,e),i=Math.floor(n);t.coinText.string="x".concat(i)})),yield this.animateCoinCollection(),this.coinText.string="x".concat(this.coins)):console.warn("LevelCompleteScreen: screen not found")})),function(){return u.apply(this,arguments)})},{key:"animateScore",value:(s=q((function*(){var t=this;e.runOnUpdateAsync(this.scoreText.node,.8,(function(e){var n=We(0,t.score,e);t.scoreText.string="".concat(Math.floor(n))})),this.scoreText.node.setScale(1,1,1),this.scoreText.string="".concat(this.score)})),function(){return s.apply(this,arguments)})},{key:"animateCoinCollection",value:(l=q((function*(){this.coinContainerShown=!0,yield e.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name),this.node.scene.emit(oa.ADD_COINS,{coins:this.coins,collectionAnimation:{floatDuration:.5,flyDuration:.5,animateTextOnly:!1,target:this.coinContainer}})})),function(){return l.apply(this,arguments)})},{key:"animateLookingForRewards",value:(o=q((function*(){var t=ie(this.lookingForRewardsText);t.to(.25,{opacity:255},{easing:"linear"}).delay(.25),t.to(.25,{opacity:100},{easing:"linear"}).delay(.125),yield e.runTweenAsync(ie(this.lookingForRewardsText).repeat(2,t).to(.25,{opacity:0},{easing:"linear"})),this.lookingForRewardsText.opacity=0})),function(){return o.apply(this,arguments)})},{key:"animateVisiblePlayButton",value:(i=q((function*(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=t?1:0;if(n){this.playButtonSignal.abort();var a=new r;this.playButtonSignal=a;var o=t?0:1;this.playButtonContainer.setScale(o,o,this.playButtonContainer.scale.z);var l=ie(this.playButtonContainer).to(.5,{scale:new Oe(i,i,1)},{easing:"backOut"});t||(this.playButton.interactable=!1),yield e.runTweenAsync(l,a),t&&(this.playButton.interactable=!0)}else this.playButton.interactable=t,this.playButtonContainer.setScale(i,i,this.playButtonContainer.scale.z)})),function(e){return i.apply(this,arguments)})},{key:"animateCollectItemPlayButton",value:(n=q((function*(){this.playButtonSignal.abort();var t=new r;this.playButtonSignal=t;var n=ie(this.playButtonContainer).to(.08,{scale:new Oe(.95,1.05,1)}).to(.08,{scale:new Oe(1.05,.95,1)}).to(.08,{scale:new Oe(1,1,1)}),i=ie(this.shineBackground).to(.08,{opacity:50},{easing:"quadOut"}).to(.08,{opacity:0},{easing:"quadIn"});yield Promise.all([e.runTweenAsync(n,t),e.runTweenAsync(i,t)])})),function(){return n.apply(this,arguments)})},{key:"handleClickedPlay",value:function(){this.playButton.interactable=!1,this.close()}}]),d}(re)).prototype,"coinText",[d$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L$=D(O$.prototype,"scoreText",[y$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_$=D(O$.prototype,"lookingForRewardsText",[v$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D$=D(O$.prototype,"getRewardsEffect",[f$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M$=D(O$.prototype,"playButton",[g$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N$=D(O$.prototype,"playBackground",[m$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z$=D(O$.prototype,"shineBackground",[b$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B$=D(O$.prototype,"hardLevelBackground",[w$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F$=D(O$.prototype,"playButtonContainer",[k$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x$=D(O$.prototype,"coinAnimation",[S$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U$=D(O$.prototype,"coinContainer",[C$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G$=D(O$.prototype,"coinContainerAnimation",[E$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H$=D(O$.prototype,"coinContainerEnterClip",[A$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V$=D(O$.prototype,"coinContainerExitClip",[T$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q$=D(O$.prototype,"particles",[R$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),P$=O$))||P$);J._RF.pop(),J._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var o0,r0,l0,s0,u0,c0,h0,p0,d0,y0,v0=Q.ccclass,f0=Q.disallowMultiple,g0=Q.requireComponent,m0=GameCore.Events,b0=globalThis.game.event;v0("LoadingScreen")(Y$=f0(Y$=g0(JX)(Y$=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e.handleClosedScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!1)},e.handleOnCloseScreen=function(){b.closeScreen(w.LOADING_SCREEN)},e}return M(n,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){b0.on(m0.OPENING_SCREEN,this.handleOpeningScreen),b0.on(m0.OPENED_SCREEN,this.handleOpenedScreen),b0.on(m0.CLOSING_SCREEN,this.handleClosingScreen),b0.on(m0.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){b0.off(m0.OPENING_SCREEN,this.handleOpeningScreen),b0.off(m0.OPENED_SCREEN,this.handleOpenedScreen),b0.off(m0.CLOSING_SCREEN,this.handleClosingScreen),b0.off(m0.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var e=this.screen.data.duration;e&&e>0&&this.scheduleOnce(this.handleOnCloseScreen,e)}}}]),n}(re))||Y$)||Y$);J._RF.pop(),J._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var w0,k0,S0,C0,E0,A0,T0,R0,P0,O0,I0,L0,_0,D0,M0,N0,z0=Q.ccclass,B0=Q.disallowMultiple,F0=Q.requireComponent,x0=Q.property,U0=GameCore,G0=U0.Events,H0=U0.Utils.Valid,V0=globalThis.game.event;o0=z0("NotificationScreen"),r0=F0(JX),l0=x0(we),s0=x0(p),u0=x0(ve),o0(c0=B0(c0=r0((p0=D((h0=function(e){B(n,e);var t=F(n);function n(){var e;N(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),z(e,"message",p0,x(e)),z(e,"messageLocalizer",d0,x(e)),z(e,"touchZone",y0,x(e)),e.enableCloseOnTouch=!0,e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.updateScreenData(t)},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e}return M(n,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){V0.on(G0.OPENING_SCREEN,this.handleOpeningScreen),V0.on(G0.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){V0.off(G0.OPENING_SCREEN,this.handleOpeningScreen),V0.off(G0.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"updateScreenData",value:function(e){var t=e.screenData;H0.isObject(t)?(void 0!==t.message?this.setMessageManually(t.message):void 0!==t.localizedMessageKey&&this.setMessageUsingLocalizeKey(t.localizedMessageKey),t.duration&&t.duration>0&&this.scheduleOnce((function(){b.closeScreen(w.NOTIFICATION_SCREEN)}),t.duration),!1===t.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"setMessageManually",value:function(e){this.messageLocalizer.enabled=!1,this.message.string=e}},{key:"setMessageUsingLocalizeKey",value:function(e){this.messageLocalizer.enabled=!0,this.messageLocalizer.key=e}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),b.closeScreen(w.NOTIFICATION_SCREEN)}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),n}(re)).prototype,"message",[l0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d0=D(h0.prototype,"messageLocalizer",[s0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y0=D(h0.prototype,"touchZone",[u0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c0=h0))||c0)||c0);J._RF.pop(),J._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var q0,W0,K0,j0,Y0,X0,Z0,J0,Q0,$0,e1,t1,n1,i1,a1,o1,r1,l1,s1,u1,c1,h1,p1=Q.ccclass,d1=Q.property,y1=Q.requireComponent,v1=GameCore,f1=v1.Events,g1=v1.Match.Modes,m1=globalThis.game,b1=m1.event,w1=m1.storage;w0=p1("QuitLevelScreen"),k0=y1(JX),S0=d1(we),C0=d1(we),E0=d1(ve),A0=d1(we),T0=d1(we),R0=d1(ve),w0(P0=k0((I0=D((O0=function(e){B(i,e);var t,n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"singleDescription",I0,x(e)),z(e,"tournamentDescription",L0,x(e)),z(e,"quitButton",_0,x(e)),z(e,"quitLabel",D0,x(e)),z(e,"endLabel",M0,x(e)),z(e,"continueButton",N0,x(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.setInteractableButtons(!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return M(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){b1.on(f1.OPENING_SCREEN,this.handleOpeningScreen),b1.on(f1.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){b1.off(f1.OPENING_SCREEN,this.handleOpeningScreen),b1.off(f1.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(oa.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),b.closeScreen(O[this.node.name]),this.node.scene.emit(oa.SHOW_UI),this.node.scene.emit(oa.GAME_RESUME)}},{key:"updateStatus",value:function(){var e=Js.getMatchMode()===g1.TOURNAMENT;this.singleDescription.node.active=!e,this.tournamentDescription.node.active=e,this.quitLabel.node.active=!e,this.endLabel.node.active=e}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(e){this.quitButton.interactable=e,this.continueButton.interactable=e,this.screen.backgroundMaskButton.interactable=e}},{key:"handleClickedContinue",value:function(){this.close()}},{key:"handleClickedQuit",value:(t=q((function*(){if(this.setInteractableButtons(!1),Js.getMatchMode()===g1.TOURNAMENT){var e,t=(null!==(e=Js.getMatchCustomData())&&void 0!==e?e:{}).score,n=(void 0===t?0:t)>w1.getStorageData("tournament","previousScore");w1.setStorageData("tournament","animateTournamentLeader",n),yield Js.finishMatchAsync()}this.node.scene.emit(oa.GAME_EXIT)})),function(){return t.apply(this,arguments)})}]),i}(re)).prototype,"singleDescription",[S0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L0=D(O0.prototype,"tournamentDescription",[C0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_0=D(O0.prototype,"quitButton",[E0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D0=D(O0.prototype,"quitLabel",[A0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M0=D(O0.prototype,"endLabel",[T0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N0=D(O0.prototype,"continueButton",[R0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P0=O0))||P0);J._RF.pop(),J._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var k1,S1,C1,E1,A1,T1,R1,P1,O1,I1,L1,_1,D1,M1,N1,z1,B1,F1,x1,U1,G1,H1,V1,q1,W1,K1,j1=Q.ccclass,Y1=Q.property,X1=Q.disallowMultiple,Z1=Q.requireComponent,J1=GameCore.Events,Q1=globalThis.game,$1=Q1.event,e2=Q1.player;q0=j1("RescuesScreen"),W0=Z1(JX),K0=Y1(he),j0=Y1([ge]),Y0=Y1(p),X0=Y1(p),Z0=Y1(ge),J0=Y1(ge),Q0=Y1(Be),$0=Y1(ge),e1=Y1(ge),q0(t1=X1(t1=W0((i1=D((n1=function(t){B(c,t);var n,i,o,r,s,u=F(c);function c(){var e;N(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=u.call.apply(u,[this].concat(n)),z(e,"adOpacity",i1,x(e)),z(e,"animNodes",a1,x(e)),z(e,"titleLocalizer",o1,x(e)),z(e,"descriptionLocalizer",r1,x(e)),z(e,"timer",l1,x(e)),z(e,"bomb",s1,x(e)),z(e,"bombAnim",u1,x(e)),z(e,"replayButton",c1,x(e)),z(e,"buyTimeButton",h1,x(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("RescuesScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return M(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){$1.on(J1.OPENING_SCREEN,this.handleOpeningScreen),$1.on(J1.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){$1.off(J1.OPENING_SCREEN,this.handleOpeningScreen),$1.off(J1.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:(s=q((function*(){l.turnOffMusic(),yield this.resetState(),this.runOpenAnimation(),this.node.scene.emit(oa.HIDE_UI)})),function(){return s.apply(this,arguments)})},{key:"close",value:function(){l.turnUpMusic(),$1.emit(J1.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(r=q((function*(){var e,t=(null===(e=this.payload.screenData)||void 0===e?void 0:e.failKey)===eu;this.titleLocalizer.key=t?"game.boom":"game.timesUp",this.descriptionLocalizer.key=t?"game.bombDesc":"game.timesUpDesc",this.timer.active=!t,this.bomb.active=t,t&&this.bombAnim.play();var n=e2.getGameData();if(n){var i=n.coins>=ks;this.replayButton.active=!i,this.buyTimeButton.active=i,this.adOpacity.opacity=0}})),function(){return r.apply(this,arguments)})},{key:"runOpenAnimation",value:(o=q((function*(){var e=this;this.screen.container?(yield Promise.all(this.animNodes.map((function(t,n){e.runAppearTween(t,.1*n)}))),yield this.runShowAdContainer()):console.warn("TimeUpScreen: screen not found")})),function(){return o.apply(this,arguments)})},{key:"runAppearTween",value:(i=q((function*(t,n){yield e.runTweenAsync(ie(t).set({scale:new Oe(0,0,0)}).delay(n).to(1,{scale:new Oe(1,1,1)},{easing:function(t){return e.elasticOut(t,.1,.45)}}))})),function(e,t){return i.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var t=ie(this.adOpacity);return t.delay(1),t.to(.5,{opacity:255}),e.runTweenAsync(t)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit(oa.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit(oa.REMOVE_COINS,{coins:ks,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(n=q((function*(){(yield k.showRewardVideoAdAsync({}))&&this.startRescue()})),function(){return n.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit(oa.SHOW_UI),this.node.scene.emit(oa.RESCUE_START),this.close()}}]),c}(re)).prototype,"adOpacity",[K0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a1=D(n1.prototype,"animNodes",[j0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),o1=D(n1.prototype,"titleLocalizer",[Y0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r1=D(n1.prototype,"descriptionLocalizer",[X0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l1=D(n1.prototype,"timer",[Z0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s1=D(n1.prototype,"bomb",[J0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u1=D(n1.prototype,"bombAnim",[Q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c1=D(n1.prototype,"replayButton",[$0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h1=D(n1.prototype,"buyTimeButton",[e1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t1=n1))||t1)||t1);J._RF.pop(),J._RF.push({},"726c9oCUUBDpboDnHRz7SGZ","PauseScreen",void 0);var t2,n2,i2,a2,o2,r2,l2,s2,u2,c2,h2,p2,d2,y2,v2,f2,g2,m2,b2,w2,k2,S2,C2,E2,A2,T2,R2=Q.ccclass,P2=Q.property,O2=Q.requireComponent,I2=GameCore,L2=I2.Events,_2=I2.Utils.Device,D2=I2.Match.Modes,M2=globalThis.game,N2=M2.player,z2=M2.event;k1=R2("PauseScreen"),S1=O2(JX),C1=P2(ge),E1=P2(ge),A1=P2(ge),T1=P2(EG),R1=P2(EG),P1=P2(EG),O1=P2(ve),I1=P2(ve),L1=P2(ve),_1=P2(ve),D1=P2(ge),k1(M1=S1((z1=D((N1=function(t){B(r,t);var n,i,o=F(r);function r(){var e;N(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),z(e,"musicSetting",z1,x(e)),z(e,"soundSetting",B1,x(e)),z(e,"vibrateSetting",F1,x(e)),z(e,"musicSwitch",x1,x(e)),z(e,"soundSwitch",U1,x(e)),z(e,"vibrateSwitch",G1,x(e)),z(e,"closeButtonComponent",H1,x(e)),z(e,"continueButtonComponent",V1,x(e)),z(e,"restartButtonComponent",q1,x(e)),z(e,"challengeFriendsButtonComponent",W1,x(e)),z(e,"animNodes",K1,x(e)),e.triggerSequence="",e.handleOpeningScreen=function(t){e.validateSwitchScreenPayload(t)&&(e.setInteractableButtons(!0),e.updateStatus())},e.handleOpenedScreen=function(t){e.validateSwitchScreenPayload(t)&&e.open()},e.handleResetSequence=function(){e.triggerSequence=""},e.handleTriggerUnlockKey=function(t){if("code"in t){var n=t.code,i=As.UNLOCK_SEQUENCE;"number"==typeof n&&-1!==i.indexOf(n.toString())&&(e.triggerSequence+=n.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",n,e.triggerSequence,e.triggerSequence===i),e.triggerSequence===i&&(e.node.scene.emit(As.Events.UNLOCK_DEV_TOOLS),e.node.off(As.Events.TRIGGER_UNLOCK_KEY)))}},e.updateVibrateButton=function(){var t=e.vibrateSetting.getComponentInChildren(ve),n=e.vibrateSetting.getComponentInChildren(EG),i=e.vibrateSetting.getComponentInChildren(Si);if(t&&n&&i)if(_2.isMobile()){var a,o=null!==(a=N2.getPlayerSetting("vibrate"))&&void 0!==a&&a;n.setEnabled(o)}else t.interactable=!1,n.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")},e}return M(r,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){z2.on(L2.OPENING_SCREEN,this.handleOpeningScreen),z2.on(L2.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){z2.off(L2.OPENING_SCREEN,this.handleOpeningScreen),z2.off(L2.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(e){return e.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(As.Events.TRIGGER_UNLOCK_KEY),this.node.on(As.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(As.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(As.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(As.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(As.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(oa.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(As.Events.TRIGGER_RESET_SEQUENCE),b.closeScreen(O[this.node.name])}},{key:"updateStatus",value:function(){var e,t,n,i={music:null!==(e=N2.getPlayerSetting("music"))&&void 0!==e&&e,sound:null!==(t=N2.getPlayerSetting("sound"))&&void 0!==t&&t,vibrate:null!==(n=N2.getPlayerSetting("vibrate"))&&void 0!==n&&n};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(i.music),this.soundSwitch.setEnabled(i.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach((function(t,n){e.runAppearTween(t,.1*n)}))}},{key:"runAppearTween",value:function(t,n){var i=ie(t);i.set({scale:new Oe(0,0,0)}),i.delay(n),i.to(1,{scale:new Oe(1,1,1)},{easing:function(t){return e.elasticOut(t,.1,.45)}}),i.start()}},{key:"setInteractableButtons",value:function(e){this.closeButtonComponent.interactable=e,this.continueButtonComponent.interactable=e,this.restartButtonComponent.interactable=e,this.challengeFriendsButtonComponent.interactable=e,this.screen.backgroundMaskButton.interactable=e}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var e=this.musicSwitch.switch();if(N2.setSetting("music",e),this.node.emit(As.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e){var t=Js.getMatchMode();l.playMusic(t===D2.TOURNAMENT?wn.TOURNAMENT_MUSIC:wn.BG_MUSIC)}else l.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var e=this.soundSwitch.switch();N2.setSetting("sound",e),this.node.emit(As.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var e=this.vibrateSwitch.switch();N2.setSetting("vibrate",e)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:(i=q((function*(){var e;this.close();var t=(null!==(e=N2.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;k.canShowInterstitialAd()&&(yield k.showInterstitialAdAsync({forLevel:n})),Js.getMatchMode()!==D2.TOURNAMENT?(this.node.scene.emit(oa.GAME_RESUME),this.node.scene.emit(oa.GAME_REPLAY,{level:n})):b.openScreen(w.START_OVER_SCREEN)})),function(){return i.apply(this,arguments)})},{key:"handleClickedChallengeFriends",value:(n=q((function*(){if("MsGames"===GameSDK.getSDKName())return b.showLoadingScreen(),yield GameSDK.extra.shareAsync(),void b.closeLoadingScreen();this.close(),this.node.scene.emit(oa.CHALLENGE_FRIENDS)})),function(){return n.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(oa.GAME_RESUME),this.node.scene.emit(oa.SHOW_UI)}}]),r}(re)).prototype,"musicSetting",[C1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B1=D(N1.prototype,"soundSetting",[E1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F1=D(N1.prototype,"vibrateSetting",[A1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x1=D(N1.prototype,"musicSwitch",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U1=D(N1.prototype,"soundSwitch",[R1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G1=D(N1.prototype,"vibrateSwitch",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H1=D(N1.prototype,"closeButtonComponent",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V1=D(N1.prototype,"continueButtonComponent",[I1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q1=D(N1.prototype,"restartButtonComponent",[L1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W1=D(N1.prototype,"challengeFriendsButtonComponent",[_1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K1=D(N1.prototype,"animNodes",[D1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),M1=N1))||M1);J._RF.pop(),J._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var B2,F2,x2,U2,G2,H2,V2,q2,W2,K2,j2,Y2,X2,Z2,J2,Q2,$2,e5,t5,n5,i5,a5,o5,r5=Q.ccclass,l5=Q.property,s5=Q.requireComponent,u5=GameCore,c5=u5.Events,h5=u5.Utils.Device,p5=u5.Match.Modes,d5=u5.Configs.Debugger.MonitorError,y5=globalThis.game,v5=y5.player,f5=y5.event,g5=y5.monitorError,m5=y5.frameCapture;t2=r5("SettingsScreen"),n2=s5(JX),i2=l5(ge),a2=l5(ge),o2=l5(ge),r2=l5(EG),l2=l5(EG),s2=l5(EG),u2=l5(ve),c2=l5(ve),h2=l5(ve),p2=l5(ve),d2=l5(ge),t2(y2=n2((f2=D((v2=function(t){B(r,t);var n,i,o=F(r);function r(){var e;N(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),z(e,"musicSetting",f2,x(e)),z(e,"soundSetting",g2,x(e)),z(e,"vibrateSetting",m2,x(e)),z(e,"musicSwitch",b2,x(e)),z(e,"soundSwitch",w2,x(e)),z(e,"vibrateSwitch",k2,x(e)),z(e,"closeButtonComponent",S2,x(e)),z(e,"reportButtonComponent",C2,x(e)),z(e,"shareButtonComponent",E2,x(e)),z(e,"inviteFriendsButtonComponent",A2,x(e)),z(e,"animNodes",T2,x(e)),e.triggerSequence="",e.handleOpeningScreen=function(t){e.validateSwitchScreenPayload(t)&&(e.setInteractableButtons(!0),e.updateStatus())},e.handleOpenedScreen=function(t){e.validateSwitchScreenPayload(t)&&e.open()},e.handleResetSequence=function(){e.triggerSequence=""},e.handleTriggerUnlockKey=function(t){if("code"in t){var n=t.code,i=As.UNLOCK_SEQUENCE;"number"==typeof n&&-1!==i.indexOf(n.toString())&&(e.triggerSequence+=n.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",n,e.triggerSequence,e.triggerSequence===i),e.triggerSequence===i&&(e.node.scene.emit(As.Events.UNLOCK_DEV_TOOLS),e.node.off(As.Events.TRIGGER_UNLOCK_KEY)))}},e.updateVibrateButton=function(){var t=e.vibrateSetting.getComponentInChildren(ve),n=e.vibrateSetting.getComponentInChildren(EG),i=e.vibrateSetting.getComponentInChildren(Si);if(t&&n&&i)if(h5.isMobile()){var a,o=null!==(a=v5.getPlayerSetting("vibrate"))&&void 0!==a&&a;n.setEnabled(o)}else t.interactable=!1,n.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")},e}return M(r,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools(),this.reportButtonComponent.node.parent.active=d5.Feedback}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){f5.on(c5.OPENING_SCREEN,this.handleOpeningScreen),f5.on(c5.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){f5.off(c5.OPENING_SCREEN,this.handleOpeningScreen),f5.off(c5.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(e){return e.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(As.Events.TRIGGER_UNLOCK_KEY),this.node.on(As.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(As.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(As.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(As.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(As.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(oa.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(As.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(oa.SHOW_UI),b.closeScreen(w.SETTINGS_SCREEN)}},{key:"updateStatus",value:function(){var e,t,n,i={music:null!==(e=v5.getPlayerSetting("music"))&&void 0!==e&&e,sound:null!==(t=v5.getPlayerSetting("sound"))&&void 0!==t&&t,vibrate:null!==(n=v5.getPlayerSetting("vibrate"))&&void 0!==n&&n};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(i.music),this.soundSwitch.setEnabled(i.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach((function(t,n){("ReportButton"!==t.name||d5.Feedback)&&e.runAppearTween(t,.1*n)}))}},{key:"runAppearTween",value:function(t,n){var i=ie(t);i.set({scale:new Oe(0,0,0)}),i.delay(n),i.to(1,{scale:new Oe(1,1,1)},{easing:function(t){return e.elasticOut(t,.1,.45)}}),i.start()}},{key:"setInteractableButtons",value:function(e){this.closeButtonComponent.interactable=e,this.reportButtonComponent.interactable=e,this.shareButtonComponent.interactable=e,this.inviteFriendsButtonComponent.interactable=e,this.screen.backgroundMaskButton.interactable=e}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var e=this.musicSwitch.switch();if(v5.setSetting("music",e),this.node.emit(As.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e){var t=Js.getMatchMode();l.playMusic(t===p5.TOURNAMENT?wn.TOURNAMENT_MUSIC:wn.BG_MUSIC)}else l.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var e=this.soundSwitch.switch();v5.setSetting("sound",e),this.node.emit(As.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var e=this.vibrateSwitch.switch();v5.setSetting("vibrate",e)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedClose",value:function(){this.close()}},{key:"handleClickedReport",value:function(){null==g5||g5.feedbackAsync()}},{key:"handleClickedShare",value:(i=q((function*(){if("FacebookInstant"===GameSDK.getSDKName())return m5.addWideframeRender("renderShareScore",I),b.showLoadingScreen(),yield GameSDK.extra.shareBestScoreAsync(),void b.closeLoadingScreen();this.close()})),function(){return i.apply(this,arguments)})},{key:"handleClickedInviteFriends",value:(n=q((function*(){switch(GameSDK.getSDKName()){case"MsGames":b.showLoadingScreen(),yield GameSDK.extra.shareAsync(),b.closeLoadingScreen();break;case"FacebookInstant":m5.addWideframeRender("renderShareScore",L),b.showLoadingScreen(),yield GameSDK.extra.inviteWithBestScoreAsync(),b.closeLoadingScreen()}})),function(){return n.apply(this,arguments)})}]),r}(re)).prototype,"musicSetting",[i2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g2=D(v2.prototype,"soundSetting",[a2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m2=D(v2.prototype,"vibrateSetting",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b2=D(v2.prototype,"musicSwitch",[r2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w2=D(v2.prototype,"soundSwitch",[l2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k2=D(v2.prototype,"vibrateSwitch",[s2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S2=D(v2.prototype,"closeButtonComponent",[u2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C2=D(v2.prototype,"reportButtonComponent",[c2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E2=D(v2.prototype,"shareButtonComponent",[h2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A2=D(v2.prototype,"inviteFriendsButtonComponent",[p2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T2=D(v2.prototype,"animNodes",[d2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),y2=v2))||y2);J._RF.pop(),J._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var b5,w5,k5,S5,C5,E5,A5,T5,R5,P5,O5,I5,L5,_5,D5,M5,N5,z5,B5,F5,x5=Q.ccclass,U5=Q.property,G5=(B2=x5("StarChest"),F2=U5(se),x2=U5(he),U2=U5(Ee),G2=U5(he),H2=U5(he),V2=U5({type:te,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),q2=U5({type:te,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),W2=U5({type:te,displayName:"Centered Offset X",group:"Reward Animations"}),K2=U5({type:te,displayName:"Centered Offset Y",group:"Reward Animations"}),j2=U5({type:te,min:0,displayName:"Starting Scale",group:"Reward Animations"}),Y2=U5({type:te,min:0,displayName:"Ending Scale",group:"Reward Animations"}),B2((J2=D((Z2=function(t){B(u,t);var n,i,o,r,l,s=F(u);function u(){var e;N(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),z(e,"sprite",J2,x(e)),z(e,"glowOpacity",Q2,x(e)),z(e,"explosionParticles",$2,x(e)),z(e,"circle",e5,x(e)),z(e,"uiOpacity",t5,x(e)),e.ogCenterX=0,e.ogCenterY=0,z(e,"endingOffsetX",n5,x(e)),z(e,"endingOffsetY",i5,x(e)),z(e,"startingScale",a5,x(e)),z(e,"endingScale",o5,x(e)),e}return M(u,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"moveToCenter",value:(l=q((function*(t){var n=new Oe(this.endingOffsetX,this.endingOffsetY,this.node.position.z);yield e.runTweenAsync(ie(this.node).to(.7,{position:n},{easing:"quintInOut"}),t),this.node.position=n})),function(e){return l.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new Oe(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(r=q((function*(t,n){var i=this.startingScale+(this.endingScale-this.startingScale)*t,a=new Oe(i,i,i);yield Promise.all([e.runTweenAsync(ie(this.sprite.node).to(.2,{scale:a},{easing:"backOut"}),n),e.runTweenAsync(ie(this.glowOpacity.node).to(.2,{scale:a},{easing:"backOut"}),n)]),this.sprite.node.setScale(a),this.glowOpacity.node.setScale(a)})),function(e,t){return r.apply(this,arguments)})},{key:"startShaking",value:function(){var e=this,t=this.node.position.clone();this.shakingTween={ogPos:t,tw:ie(this.node).to(.1,{},{onUpdate:function(n,i){if(i){var a=t.x+10*(i-.5);e.node.position=new Oe(a,t.y,t.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(o=q((function*(t){var n=this.sprite.node.scale.clone().multiplyScalar(1.1);yield Promise.all([e.runTweenAsync(ie(this.sprite.node).to(.2,{scale:n},{easing:"cubicInOut"}),t),e.runTweenAsync(ie(this.glowOpacity.node).to(.2,{scale:n}),t),e.runTweenAsync(ie(this.glowOpacity).to(.5,{opacity:255}),t)])})),function(e){return o.apply(this,arguments)})},{key:"explode",value:(i=q((function*(t){var n=this,i=new Oe(8,8,8),a=function(){var a=q((function*(){n.circle.opacity=255,n.circle.node.setScale(Oe.ZERO),yield Promise.all([e.runTweenAsync(ie(n.circle).to(.3,{opacity:0}),t),e.runTweenAsync(ie(n.circle.node).to(.3,{scale:i},{easing:"cubicOut"}),t)]),n.circle.opacity=0,n.circle.node.scale=i}));return function(){return a.apply(this,arguments)}}(),o=function(){var i=q((function*(){yield Promise.all([e.runTweenAsync(ie(n.glowOpacity.node).to(.3,{scale:Oe.ZERO},{easing:"cubicOut"}),t),e.runTweenAsync(ie(n.sprite.node).to(.3,{scale:Oe.ZERO},{easing:"cubicOut"}),t)]),n.sprite.node.setScale(Oe.ZERO),n.glowOpacity.node.setScale(Oe.ZERO)}));return function(){return i.apply(this,arguments)}}();yield Promise.all([this.explodeParticles(t),a(),o()])})),function(e){return i.apply(this,arguments)})},{key:"explodeParticles",value:(n=q((function*(t){t.aborted||(this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem(),yield e.waitTweenAsync(1),this.explosionParticles.node.active=!1)})),function(e){return n.apply(this,arguments)})}]),u}(re)).prototype,"sprite",[F2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q2=D(Z2.prototype,"glowOpacity",[x2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$2=D(Z2.prototype,"explosionParticles",[U2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e5=D(Z2.prototype,"circle",[G2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t5=D(Z2.prototype,"uiOpacity",[H2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(Z2.prototype,"startingOffsetX",[V2],Object.getOwnPropertyDescriptor(Z2.prototype,"startingOffsetX"),Z2.prototype),D(Z2.prototype,"startingOffsetY",[q2],Object.getOwnPropertyDescriptor(Z2.prototype,"startingOffsetY"),Z2.prototype),n5=D(Z2.prototype,"endingOffsetX",[W2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),i5=D(Z2.prototype,"endingOffsetY",[K2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a5=D(Z2.prototype,"startingScale",[j2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),o5=D(Z2.prototype,"endingScale",[Y2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),X2=Z2))||X2);J._RF.pop(),J._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var H5,V5,q5,W5,K5,j5,Y5,X5,Z5=Q.ccclass,J5=Q.property,Q5=Q.requireComponent,$5=GameCore.Events,e3=globalThis.game,t3=e3.event,n3=e3.player;b5=Z5("StarChestScreen"),w5=Q5(JX),k5=J5(gz),S5=J5(ve),C5=J5(ve),E5=J5(Be),A5=J5(G5),T5=J5(he),R5=J5(HL),P5=J5(p),b5(O5=w5((L5=D((I5=function(t){B(c,t);var n,i,o,s,u=F(c);function c(){var e;N(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=u.call.apply(u,[this].concat(n)),z(e,"starProgressBar",L5,x(e)),z(e,"openButton",_5,x(e)),z(e,"continueButton",D5,x(e)),z(e,"chestAnimation",M5,x(e)),z(e,"starChest",N5,x(e)),z(e,"chestUnlockFXMask",z5,x(e)),z(e,"skipOverlay",B5,x(e)),z(e,"messageLabelLocalizer",F5,x(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return M(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){t3.on($5.OPENING_SCREEN,this.handleOpeningScreen),t3.on($5.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){t3.off($5.OPENING_SCREEN,this.handleOpeningScreen),t3.off($5.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(oa.HIDE_UI);var e=n3.getGameData();if(e){var t=e.stars;this.numChestAvailable=Math.floor(t/20),this.starProgressBar.setRange(t,20);var n=this.numChestAvailable>0;this.setInteractableButtons(!0),this.openButton.node.active=n,this.openButton.interactable=n,this.continueButton.node.active=!n,this.continueButton.interactable=!n,this.messageLabelLocalizer.key=this.numChestAvailable?"reward.starChestAvailable":"reward.starChestUnavailable",this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){this.setInteractableButtons(!1),t3.emit($5.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(oa.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(s=q((function*(){if(0!==this.numChestAvailable){l.turnDownMusic();var e=n3.getGameData();if(e){this.setInteractableButtons(!1);var t=e.stars;n3.setGameData({stars:e.stars-20*this.numChestAvailable});var n=new r;yield this.skipOverlay.open({opacity:200,onSkip:function(){return n.abort()}}),yield this.handleUnlockAnimation(t,e.stars,n),yield this.skipOverlay.close(),l.turnUpMusic(),oe.emit(Nt),this.close()}}else this.close()})),function(){return s.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(o=q((function*(t,n,i){var a=this;yield Promise.all([this.starChest.moveToCenter(i),this.fadeInChestUnlockFX(i)]),this.chestAnimation.stop(),this.starChest.startShaking(),yield l.playSound(wn.STAR_CHEST_DRUM_ROLL,{loop:!0}),yield e.waitTweenAsync(0);var o=t,r=this.numChestAvailable;yield Promise.all([this.starProgressBar.animateTo(n,i,(function(e){var t;o-e>=20&&(o=e,r--,a.starChest.scale((t=r,a.numChestAvailable>2?1-t/a.numChestAvailable:.35*(1-t/a.numChestAvailable)),i),l.playSound(wn.STAR_CHEST_OPEN))}))]),yield e.waitTweenAsync(1,i),this.starChest.stopShaking(),yield this.starChest.glow(i),l.stopSound(wn.STAR_CHEST_DRUM_ROLL);var s=bs*this.numChestAvailable;this.node.scene.emit(oa.ADD_COINS,{coins:s,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:i},skipAnimation:!0}),yield this.starChest.explode(i),yield e.waitTweenAsync(1,i),yield Promise.all([this.fadeOutChestUnlockFX(i)])})),function(e,t,n){return o.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(i=q((function*(t){this.chestUnlockFXMask.node.active=!0,yield e.runTweenAsync(ie(this.chestUnlockFXMask).to(.5,{opacity:150}),t)})),function(e){return i.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(n=q((function*(t){yield e.runTweenAsync(ie(this.chestUnlockFXMask).to(.3,{opacity:0}),t),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1})),function(e){return n.apply(this,arguments)})},{key:"setInteractableButtons",value:function(e){this.openButton.interactable=e,this.continueButton.interactable=e,this.screen.backgroundMaskButton.interactable=e}}]),c}(re)).prototype,"starProgressBar",[k5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_5=D(I5.prototype,"openButton",[S5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D5=D(I5.prototype,"continueButton",[C5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M5=D(I5.prototype,"chestAnimation",[E5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N5=D(I5.prototype,"starChest",[A5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z5=D(I5.prototype,"chestUnlockFXMask",[T5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B5=D(I5.prototype,"skipOverlay",[R5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F5=D(I5.prototype,"messageLabelLocalizer",[P5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O5=I5))||O5);J._RF.pop(),J._RF.push({},"2f7694kcVZNWq3iTCp1piqI","StartOverScreen",void 0);var i3,a3,o3,r3,l3,s3=Q.ccclass,u3=Q.property,c3=Q.requireComponent,h3=GameCore.Events,p3=globalThis.game,d3=p3.event,y3=p3.player;H5=s3("StartOverScreen"),V5=c3(JX),q5=u3(ve),W5=u3(ve),H5(K5=V5((Y5=D((j5=function(e){B(i,e);var t,n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"restartButton",Y5,x(e)),z(e,"cancelButton",X5,x(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.setInteractableButtons(!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return M(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){d3.on(h3.OPENING_SCREEN,this.handleOpeningScreen),d3.on(h3.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){d3.off(h3.OPENING_SCREEN,this.handleOpeningScreen),d3.off(h3.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(oa.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),b.closeScreen(w.START_OVER_SCREEN)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(e){this.restartButton.interactable=e,this.cancelButton.interactable=e}},{key:"handleClickedCancel",value:function(){this.close(),this.node.scene.emit(oa.GAME_RESUME),this.node.scene.emit(oa.SHOW_UI)}},{key:"handleClickedRestart",value:(t=q((function*(){var e;this.close();var t=(null!==(e=y3.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;this.node.scene.emit(oa.GAME_RESUME),this.node.scene.emit(oa.GAME_REPLAY,{level:n})})),function(){return t.apply(this,arguments)})}]),i}(re)).prototype,"restartButton",[q5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X5=D(j5.prototype,"cancelButton",[W5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K5=j5))||K5);J._RF.pop(),J._RF.push({},"d6d78U+W5xDwqln9pXXQOaF","TopLeaders",void 0);var v3,f3,g3,m3,b3,w3=Q.ccclass,k3=Q.property,S3=(i3=w3("TopLeaders"),a3=k3(Jq),i3((l3=D((r3=function(e){B(i,e);var t,n=F(i);function i(){var e;N(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),z(e,"topLeaders",l3,x(e)),e.leaderData=[],e}return M(i,[{key:"updateData",value:function(e){var t=this;this.leaderData=e.slice(0,3),this.leaderData.slice(0,3).forEach((function(e,n){t.topLeaders[n].updateInfo({playerId:e.playerId,name:e.name,photo:e.photo,score:e.score})}))}},{key:"playShowLeadersAnimation",value:(t=q((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,i=.3;yield Promise.all(this.leaderData.map(function(){var a=q((function*(a,o){var r=t.topLeaders[o];yield r.runShowUpAnimation(o*n,i,e)}));return function(e,t){return a.apply(this,arguments)}}()))})),function(e){return t.apply(this,arguments)})},{key:"hideLeaders",value:function(){var e,t=G(this.topLeaders);try{for(t.s();!(e=t.n()).done;){e.value.setVisible(!1)}}catch(e){t.e(e)}finally{t.f()}}}]),i}(re)).prototype,"topLeaders",[a3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),o3=r3))||o3);J._RF.pop(),J._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var C3,E3,A3,T3,R3,P3,O3,I3,L3,_3,D3,M3,N3,z3,B3,F3,x3,U3,G3,H3,V3,q3,W3,K3,j3,Y3,X3,Z3,J3,Q3,$3,e9,t9,n9,i9,a9,o9,r9,l9,s9,u9,c9,h9,p9=Q.ccclass,d9=Q.property,y9=(v3=p9("TournamentLeaderSkeleton"),f3=d9(ge),v3((b3=D((m3=function(t){B(o,t);var n,i,a=F(o);function o(){var e;N(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),z(e,"container",b3,x(e)),e}return M(o,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"hide",value:(i=q((function*(t){var n=this;yield e.runTweenAsync(ie(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t)})),function(e){return i.apply(this,arguments)})},{key:"show",value:(n=q((function*(t,n){this.node.active=!0,this.node.scale=new Oe(.8,.8,.8),this.uiOpacity.opacity=0;var i=this.container.position.clone();this.container.position=new Oe(i.x,i.y-100,i.z);var a=ie(this.node).delay(t);a.to(.2,{scale:Oe.ONE},{easing:"elasticOut"});var o=ie(this.container).delay(t);o.to(.2,{position:i},{easing:"backOut"});var r=ie(this.uiOpacity).delay(t);r.to(.2,{opacity:255},{easing:"cubicOut"}),yield Promise.all([e.runTweenAsync(a,n),e.runTweenAsync(o,n),e.runTweenAsync(r,n)]),this.node.scale=Oe.ONE,this.container.position=i,this.uiOpacity.opacity=255})),function(e,t){return n.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),o}(re)).prototype,"container",[f3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g3=m3))||g3);J._RF.pop(),J._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var v9,f9=Q.ccclass,g9=Q.property,m9=Q.requireComponent,b9=GameCore,w9=b9.Events,k9=b9.Utils,S9=k9.Object,C9=k9.Time,E9=k9.Number,A9=globalThis.game,T9=A9.event,R9=A9.storage,P9=A9.player,O9=A9.leaderboard,I9=A9.language,L9=1166;C3=f9("TournamentDetailScreen"),E3=m9(JX),A3=g9(we),T3=g9(p),R3=g9(p),P3=g9(p),O3=g9(zV),I3=g9(S3),L3=g9({type:ge,group:"Buttons"}),_3=g9({type:ge,group:"Buttons"}),D3=g9({type:ge,group:"Buttons"}),M3=g9({type:se}),N3=g9({type:ge}),z3=g9({type:ge}),B3=g9({type:[y9]}),F3=g9(Ug),x3=g9({type:$,group:"Container"}),U3=g9({type:$,group:"Container"}),G3=a.onlyRunInLifeCycleAsync,H3=a.onlyRunInLifeCycleAsync,V3=a.onlyRunInLifeCycleAsync,q3=a.onlyRunInLifeCycleAsync,W3=a.onlyRunInLifeCycleAsync,K3=a.onlyRunInLifeCycle,j3=a.onlyRunInLifeCycle,C3(Y3=E3((Z3=D((X3=function(e){B(k,e);var t,n,i,s,u,c,h,p,d,y,v,f,g,w=F(k);function k(){var e;N(this,k);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=w.call.apply(w,[this].concat(n)),z(e,"title",Z3,x(e)),z(e,"titleLocalizer",J3,x(e)),z(e,"timeLocalizer",Q3,x(e)),z(e,"playerCountLocalizer",$3,x(e)),z(e,"tournamentLeaders",e9,x(e)),z(e,"topLeaders",t9,x(e)),z(e,"playButton",n9,x(e)),z(e,"continueButton",i9,x(e)),z(e,"replayButton",a9,x(e)),z(e,"banner",o9,x(e)),z(e,"bannerLoadingRing",r9,x(e)),z(e,"bannerMask",l9,x(e)),z(e,"leaderSkeletons",s9,x(e)),z(e,"paperConfetti",u9,x(e)),z(e,"container",c9,x(e)),z(e,"tempContainer",h9,x(e)),e.signal=new r,e.leadersPayload=null,e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("TournamentDetailScreen: screen not found");e.validateEventPayload(t)&&(e.enabled=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return M(k,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(JX),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){a.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){T9.on(w9.OPENING_SCREEN,this.handleOpeningScreen),T9.on(w9.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){T9.off(w9.OPENING_SCREEN,this.handleOpeningScreen),T9.off(w9.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function(){this.updateContainer(),this.setInteractableButtons(!0),this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders(),this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(oa.HIDE_UI),this.updateInfo()}},{key:"close",value:function(){b.closeTournamentDetailScreen(),this.setInteractableButtons(!1),this.node.scene.emit(oa.SHOW_UI),this.cleanup()}},{key:"cleanup",value:function(){var e;null===(e=this.signal)||void 0===e||e.abort(),this.signal=new r,this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(g=q((function*(){var e,t,n,i,a,o,r=this,l=this.signal,s=null===(e=this.payload)||void 0===e||null===(e=e.screenData)||void 0===e?void 0:e.tournament;if(s){var u=null===(t=null===(n=this.payload.screenData)||void 0===n?void 0:n.playAnimation)||void 0===t||t,c=JSON.parse(s);c.id=c.id.toString(),this.tournamentPayload=c;var h=this.tournamentPayload,p=h.endTime,d=h.payload,y=h.title,v=h.tournamentType,f=d.leaderboardId,g=void 0===f?"":f,m=d.themeId,b=d.playerName;"PAGE_HOSTED"===v?this.updateTitleTournamentTitle(y):this.updateTitleWithPlayerName(null!=b?b:y),this.updateEndTime(p),this.updateTournamentBanner(m,l);var w=R9.getStorage("tournament"),k=w.previousScore,S=w.animateTournamentLeader;if(R9.setStorageData("tournament","animateTournamentLeader",!1),this.updateButtonsVisibility(S),yield this.showLoading(l),yield this.loadLeaders(g),!this.leadersPayload||0===this.leadersPayload.leaders.length||l.aborted)return this.updatePlayerCount(0),void(yield this.hideLoading(l));var C=this.leadersPayload,E=C.player,A=C.amountPlayer,T=null!==(i=this.leadersPayload.leaders)&&void 0!==i?i:[];if(T.sort((function(e,t){return e.rank-t.rank})),yield this.hideLoading(l),this.topLeaders&&this.tournamentLeaders&&!l.aborted){this.updatePlayerCount(A),this.topLeaders.updateData(T),this.topLeaders.playShowLeadersAnimation(l);var R=null!==(a=null==E?void 0:E.score)&&void 0!==a?a:0,P=null!==(o=null==E?void 0:E.rank)&&void 0!==o?o:0,O=S&&-1!==k&&k<R;this.tournamentLeaders.updateData(T);var I=!1;E&&O&&(I=this.tournamentLeaders.updateDisplayPlayerLeaderForRankChanging(k,R,P)),this.tournamentLeaders.initScrollViews(),this.tournamentLeaders.scrollView.scrollView.enabled=!0,yield l.callAsync((function(e){return r.runShowUpAnimation(e,u)})),S&&I&&-1!==k&&this.tournamentLeaders&&(yield l.callAsync((function(e){return r.tournamentLeaders.playRankChangeAnimation(e,k,R,P)})),this.tryPlayConfettiEffect(P))}}})),function(){return g.apply(this,arguments)})},{key:"updateContainer",value:(f=q((function*(){var e=this.tempContainer.height;this.container.node.position=this.tempContainer.node.position.clone(),e<L9&&this.container.height!==e?(this.container.height=e,Te.instance.emit("canvas-resize")):e>L9&&this.container.height<L9&&(this.container.height=L9,Te.instance.emit("canvas-resize"))})),function(){return f.apply(this,arguments)})},{key:"loadLeaders",value:(v=q((function*(e){this.leadersPayload=yield this.getLeadersPayload(e)})),function(e){return v.apply(this,arguments)})},{key:"showLoading",value:(y=q((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;yield Promise.all([this.tournamentLeaders.scrollView.unlistenEvents(),this.tournamentLeaders.scrollView.scrollToTop(e,.1).then((function(){t.tournamentLeaders.scrollView.scrollView.enabled=!1,t.tournamentLeaders.scrollView.listenEvents()})),this.leaderSkeletons.map((function(t,i){return t.show(i*n,e)}))])})),function(e){return y.apply(this,arguments)})},{key:"hideLoading",value:(d=q((function*(e){yield Promise.all(this.leaderSkeletons.map((function(t){return t.hide(e)})))})),function(e){return d.apply(this,arguments)})},{key:"runShowUpAnimation",value:(p=q((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t?0:.1;yield this.tournamentLeaders.playShowLeadersAnimation(e,n),yield this.tournamentLeaders.scrollToPlayerLeader(1.5,e)})),function(e){return p.apply(this,arguments)})},{key:"tryPlayConfettiEffect",value:function(e){if(!(e>10)){var t,n=G(this.paperConfetti);try{for(n.s();!(t=n.n()).done;){t.value.play()}}catch(e){n.e(e)}finally{n.f()}l.playSound(wn.LEADERBOARD_TRIUMPH)}}},{key:"updateTitleWithPlayerName",value:function(e){void 0!==e&&(this.titleLocalizer.enabled=!0,this.titleLocalizer.setParams([e]))}},{key:"updateTitleTournamentTitle",value:function(e){this.titleLocalizer.enabled=!1,this.title.string=e}},{key:"updateEndTime",value:function(e){try{var t=C9.getRelativeTime(e,I9.getCurrentLocale(),{style:"short"});this.timeLocalizer.key="game.endsIn",this.timeLocalizer.setParams([t])}catch(e){this.timeLocalizer.key="game.endsSoon"}}},{key:"updateTournamentBanner",value:(h=q((function*(e,t){this.banner.spriteFrame=null;var n=o.getAsset("".concat(_[e],"/spriteFrame"),ze);n||(this.bannerMask.active=!0,this.bannerLoadingRing.active=!0,n=yield o.loadThemeTournamentAsync(e)),n||(n=yield o.loadThemeTournamentAsync(E.SUMMER)),this.banner&&n&&!t.aborted&&(this.banner.spriteFrame=n,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1)})),function(e,t){return h.apply(this,arguments)})},{key:"updatePlayerCount",value:function(e){var t=E9.getShortNumber(e,3);1===e?this.playerCountLocalizer.key="game.player":(this.playerCountLocalizer.key="game.nPlayers",this.playerCountLocalizer.setParams([t]))}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLocalizer.key="status.loading"}},{key:"getLeadersPayload",value:(c=q((function*(e){var t=O9.getLeaderboardName(e);if(!t)return null;var n=yield Is.getAllLeaderboardAsync(e);if(!n)return null;var i,a=S9.vals(n.leaders),o=P9.getPlayerId(),r={leaders:[],amountPlayer:n.amountPlayer},l=G(a);try{for(l.s();!(i=l.n()).done;){var s=i.value;s.playerId===o?(r.player=s,r.leaders.push(s)):r.leaders.push(s)}}catch(e){l.e(e)}finally{l.f()}if(!r.player){var u=(yield O9.getLeadersByPlayerIdsAsync(t,[o]))[0];u&&(r.player=u,r.leaders.push(u))}return r})),function(e){return c.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(e){this.playButton.active=!e,this.continueButton.active=e,this.replayButton.active=e}},{key:"handleOnPlay",value:(u=q((function*(){var e=this.tournamentPayload.id||"";if(m.validateTournamentExpired(e))return this.close(),this.node.scene.emit(Ts.RELOAD_TOURNAMENT),void b.showNotificationScreenWithLocalizedKey("error.tourEnded",2);try{b.showLoadingScreen(),yield Js.setMatchCustomDataAsync({level:1,score:0}),yield this.processJoinTournament()}catch(e){if(S9.hasOwn(e,"code")&&"USER_INPUT"===e.code)return;try{yield this.processContinueTournament()}catch(e){if(S9.hasOwn(e,"code")&&"USER_INPUT"===e.code)return;console.error("processPlayButtonPressed",e),b.showNotificationScreenWithLocalizedKey("error.tourJoinFail",2)}}finally{b.closeLoadingScreen()}})),function(){return u.apply(this,arguments)})},{key:"processJoinTournament",value:(s=q((function*(){try{yield this.joinTournamentAsync(),C.switchScene(A.GAME_SCENE,{level:1})}catch(e){throw console.warn("processJoinTournament",e),e}})),function(){return s.apply(this,arguments)})},{key:"processContinueTournament",value:(i=q((function*(){try{yield this.continueTournamentAsync(),C.switchScene(A.GAME_SCENE,{level:1})}catch(e){throw console.warn("processContinueTournament",e),e}})),function(){return i.apply(this,arguments)})},{key:"joinTournamentAsync",value:(n=q((function*(){var e=this.tournamentPayload.id||"";yield Js.joinTournamentAsync(e)})),function(){return n.apply(this,arguments)})},{key:"continueTournamentAsync",value:(t=q((function*(){var e,t=null!==(e=GameSDK.context.getID())&&void 0!==e?e:"";yield Js.continueTournamentAsync(t)})),function(){return t.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var e,t,n=(null!==(e=null===(t=this.payload)||void 0===t?void 0:t.screenData)&&void 0!==e?e:{}).tournamentContextType;switch(void 0===n?"tournament_start":n){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}},{key:"setInteractableButtons",value:function(e){this.screen.backgroundMaskButton.interactable=e}}]),k}(re)).prototype,"title",[A3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J3=D(X3.prototype,"titleLocalizer",[T3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q3=D(X3.prototype,"timeLocalizer",[R3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$3=D(X3.prototype,"playerCountLocalizer",[P3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e9=D(X3.prototype,"tournamentLeaders",[O3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t9=D(X3.prototype,"topLeaders",[I3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n9=D(X3.prototype,"playButton",[L3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i9=D(X3.prototype,"continueButton",[_3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a9=D(X3.prototype,"replayButton",[D3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o9=D(X3.prototype,"banner",[M3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r9=D(X3.prototype,"bannerLoadingRing",[N3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l9=D(X3.prototype,"bannerMask",[z3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s9=D(X3.prototype,"leaderSkeletons",[B3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),u9=D(X3.prototype,"paperConfetti",[F3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),c9=D(X3.prototype,"container",[x3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h9=D(X3.prototype,"tempContainer",[U3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D(X3.prototype,"updateInfo",[G3],Object.getOwnPropertyDescriptor(X3.prototype,"updateInfo"),X3.prototype),D(X3.prototype,"loadLeaders",[H3],Object.getOwnPropertyDescriptor(X3.prototype,"loadLeaders"),X3.prototype),D(X3.prototype,"showLoading",[V3],Object.getOwnPropertyDescriptor(X3.prototype,"showLoading"),X3.prototype),D(X3.prototype,"hideLoading",[q3],Object.getOwnPropertyDescriptor(X3.prototype,"hideLoading"),X3.prototype),D(X3.prototype,"runShowUpAnimation",[W3],Object.getOwnPropertyDescriptor(X3.prototype,"runShowUpAnimation"),X3.prototype),D(X3.prototype,"tryPlayConfettiEffect",[K3],Object.getOwnPropertyDescriptor(X3.prototype,"tryPlayConfettiEffect"),X3.prototype),D(X3.prototype,"updatePlayerCount",[j3],Object.getOwnPropertyDescriptor(X3.prototype,"updatePlayerCount"),X3.prototype),Y3=X3))||Y3);J._RF.pop(),J._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,Q.ccclass)("TournamentLeader")(v9=function(e){B(n,e);var t=F(n);function n(){return N(this,n),t.apply(this,arguments)}return M(n)}(oV));J._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});