function _instanceof(n,w){if(null!=w&&"undefined"!=typeof Symbol&&w[Symbol.hasInstance])return!!w[Symbol.hasInstance](n);return n instanceof w}function _ts_generator(n,w){var k,C,E,_,T={label:0,sent:function(){if(1&E[0])throw E[1];return E[1]},trys:[],ops:[]};return _={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(_[Symbol.iterator]=function(){return this}),_;function verb(n){return function(w){return step([n,w])}}function step(_){if(k)throw new TypeError("Generator is already executing.");while(T)try{if(k=1,C&&(E=2&_[0]?C.return:_[0]?C.throw||((E=C.return)&&E.call(C),0):C.next)&&!(E=E.call(C,_[1])).done)return E;if(C=0,E)_=[2&_[0],E.value];switch(_[0]){case 0:case 1:E=_;break;case 4:T.label++;return{value:_[1],done:false};case 5:T.label++;C=_[1];_=[0];continue;case 7:_=T.ops.pop();T.trys.pop();continue;default:if(E=T.trys,!(E=E.length>0&&E[E.length-1])&&(6===_[0]||2===_[0])){T=0;continue}if(3===_[0]&&(!E||_[1]>E[0]&&_[1]<E[3])){T.label=_[1];break}if(6===_[0]&&T.label<E[1]){T.label=E[1];E=_;break}if(E&&T.label<E[2]){T.label=E[2];T.ops.push(_);break}if(E[2])T.ops.pop();T.trys.pop();continue}_=w.call(n,T)}catch(n){_=[6,n];C=0}finally{k=E=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:true}}}System.register("chunks:///main.js",["./renderCustomShareScore-02a4eb22.js","cc"],function(){var n,w,k,C,E,_,T,I,L,D,M,N,z,B,F,x,U,G,H,V,q,W,K,j,Y,X,Z,J,Q,$,ee,et,en,ei,er,ea,eo,es,el,eu,ec,eh,ep,ed,ey,ef,ev,eg,em,eb,ew,eS,ek,eC,eE,e_,eA,eT,eP,eR,eI,eO,eL,eD,eM,eN,ez,eB,eF,ex,eU,eG,eH,eV,eq,eW,eK,ej,eY,eX,eZ,eJ,eQ,e$,e0,e1,e2,e4,e3,e5,e6,e8,e9,e7,te,tt,tn,ti,tr,ta,to,ts,tl,tu,tc,th,tp,td,ty,tf,tv,tg,tm,tb,tw,tS;return{setters:[function(ew){n=ew._,w=ew.a,k=ew.b,C=ew.c,E=ew.d,_=ew.e,T=ew.f,I=ew.g,L=ew.h,D=ew.i,M=ew.j,N=ew.k,z=ew.A,B=ew.C,F=ew.G,x=ew.l,U=ew.m,G=ew.n,H=ew.o,V=ew.p,q=ew.q,W=ew.r,K=ew.L,j=ew.s,Y=ew.t,X=ew.u,Z=ew.I,J=ew.v,Q=ew.w,$=ew.T,ee=ew.R,et=ew.E,en=ew.x,ei=ew.S,er=ew.y,ea=ew.z,eo=ew.B,es=ew.D,el=ew.F,eu=ew.H,ec=ew.J,eh=ew.K,ep=ew.M,ed=ew.N,ey=ew.O,ef=ew.P,ev=ew.Q,eg=ew.U,em=ew.V,eb=ew.W},function(n){ew=n.cclegacy,eS=n._decorator,ek=n.Node,eC=n.Color,eE=n.Canvas,e_=n.UITransform,eA=n.instantiate,eT=n.Label,eP=n.RichText,eR=n.Toggle,eI=n.Button,eO=n.director,eL=n.Component,eD=n.CCInteger,eM=n.CCFloat,eN=n.Widget,ez=n.tween,eB=n.Layout,eF=n.ccenum,ex=n.Sprite,eU=n.Enum,eG=n.easing,eH=n.UIOpacity,eV=n.EventHandler,eq=n.animation,eW=n.CCBoolean,eK=n.Input,ej=n.Graphics,eY=n.game,eX=n.profiler,eZ=n.sys,eJ=n.EventTarget,eQ=n.Vec3,e$=n.ParticleSystem2D,e0=n.math,e1=n.View,e2=n.ProgressBar,e4=n.Vec2,e3=n.CCString,e5=n.Director,e6=n.Layers,e8=n.find,e9=n.randomRangeInt,e7=n.SpriteFrame,te=n.Animation,tt=n.pseudoRandomRangeInt,tn=n.pseudoRandom,ti=n.randomRange,tr=n.Pool,ta=n.Prefab,to=n.repeat,ts=n.lerp,tl=n.approx,tu=n.EPSILON,tc=n.RealCurve,th=n.Gradient,tp=n.bits,td=n.random,ty=n.Material,tf=n.toRadian,tv=n.HorizontalTextAlignment,tg=n.Tween,tm=n.AnimationClip,tb=n.ScrollView,tw=n.NodeEventType,tS=n.Mask}],execute:function(){var tk,tC,tE,t_,tA,tT,tP,tR;ew._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var tI,tO,tL,tD,tM,tN,tz,tB,tF,tx,tU,tG,tH,tV,tq,tW,tK,tj,tY,tX,tZ=eS.ccclass,tJ=eS.property;tk=tZ("internal.DebugViewRuntimeControl"),tC=tJ(ek),tE=tJ(ek),t_=tJ(ek),tk((tT=n((tA=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"compositeModeToggle",tT,_(n)),E(n,"singleModeToggle",tP,_(n)),E(n,"EnableAllCompositeModeButton",tR,_(n)),n._single=0,n.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],n.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],n.strMisc=["CSM Layer Coloration","Lighting With Albedo"],n.compositeModeToggleList=[],n.singleModeToggleList=[],n.miscModeToggleList=[],n.textComponentList=[],n.labelComponentList=[],n.textContentList=[],n._currentColorIndex=0,n.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],n.color=[eC.WHITE,eC.BLACK,eC.RED,eC.GREEN,eC.BLUE],n}return T(s,[{key:"start",value:function(){if(this.node.parent.getComponent(eE)){var n=this.node.parent.getComponent(e_),w=.5*n.width,k=.5*n.height,C=.1*w-w,E=k-.1*k,_=this.node.getChildByName("MiscMode"),T=eA(_);T.parent=this.node,T.name="Buttons";var I=eA(_);I.parent=this.node,I.name="Titles";for(var L=0;L<2;L++){var D=eA(this.EnableAllCompositeModeButton.getChildByName("Label"));D.setPosition(C+(L>0?450:150),E,0),D.setScale(.75,.75,.75),D.parent=I;var M=D.getComponent(eT);M.string=L?"----------Composite Mode----------":"----------Single Mode----------",M.color=eC.WHITE,M.overflow=0,this.labelComponentList[this.labelComponentList.length]=M}E-=20;for(var N=0,z=0;z<this.strSingle.length;z++,N++){z===this.strSingle.length>>1&&(C+=200,N=0);var B=z?eA(this.singleModeToggle):this.singleModeToggle;B.setPosition(C,E-20*N,0),B.setScale(.5,.5,.5),B.parent=this.singleModeToggle.parent;var F=B.getComponentInChildren(eP);F.string=this.strSingle[z],this.textComponentList[this.textComponentList.length]=F,this.textContentList[this.textContentList.length]=F.string,B.on(eR.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[z]=B}C+=200,this.EnableAllCompositeModeButton.setPosition(C+15,E,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(eI.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=T;var x=this.EnableAllCompositeModeButton.getComponentInChildren(eT);this.labelComponentList[this.labelComponentList.length]=x;var U=eA(this.EnableAllCompositeModeButton);U.setPosition(C+90,E,0),U.setScale(.5,.5,.5),U.on(eI.EventType.CLICK,this.changeTextColor,this),U.parent=T,(x=U.getComponentInChildren(eT)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=x;var G=eA(this.EnableAllCompositeModeButton);G.setPosition(C+200,E,0),G.setScale(.5,.5,.5),G.on(eI.EventType.CLICK,this.hideUI,this),G.parent=this.node.parent,(x=G.getComponentInChildren(eT)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=x,this.hideButtonLabel=x,E-=40;for(var H=0;H<this.strMisc.length;H++){var V=eA(this.compositeModeToggle);V.setPosition(C,E-20*H,0),V.setScale(.5,.5,.5),V.parent=_;var q=V.getComponentInChildren(eP);q.string=this.strMisc[H],this.textComponentList[this.textComponentList.length]=q,this.textContentList[this.textContentList.length]=q.string,V.getComponent(eR).isChecked=!!H,V.on(eR.EventType.TOGGLE,H?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[H]=V}E-=150;for(var W=0;W<this.strComposite.length;W++){var K=W?eA(this.compositeModeToggle):this.compositeModeToggle;K.setPosition(C,E-20*W,0),K.setScale(.5,.5,.5),K.parent=this.compositeModeToggle.parent;var j=K.getComponentInChildren(eP);j.string=this.strComposite[W],this.textComponentList[this.textComponentList.length]=j,this.textContentList[this.textContentList.length]=j.string,K.on(eR.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[W]=K}}else console.error("debug-view-runtime-control should be child of Canvas")}},{key:"isTextMatched",value:function(n,w){var k=new String(n),C=k.search(">");return -1===C?n===w:(k=(k=k.substr(C+1)).substr(0,k.search("<")))===w}},{key:"toggleSingleMode",value:function(n){for(var w=eO.root.debugView,k=n.getComponentInChildren(eP),C=0;C<this.strSingle.length;C++)this.isTextMatched(k.string,this.strSingle[C])&&(w.singleMode=C)}},{key:"toggleCompositeMode",value:function(n){for(var w=eO.root.debugView,k=n.getComponentInChildren(eP),C=0;C<this.strComposite.length;C++)this.isTextMatched(k.string,this.strComposite[C])&&w.enableCompositeMode(C,n.isChecked)}},{key:"toggleLightingWithAlbedo",value:function(n){eO.root.debugView.lightingWithAlbedo=n.isChecked}},{key:"toggleCSMColoration",value:function(n){eO.root.debugView.csmLayerColoration=n.isChecked}},{key:"enableAllCompositeMode",value:function(n){var w=eO.root.debugView;w.enableAllCompositeMode(!0);for(var k=0;k<this.compositeModeToggleList.length;k++)this.compositeModeToggleList[k].getComponent(eR).isChecked=!0;var C=this.miscModeToggleList[0].getComponent(eR);C.isChecked=!1,w.csmLayerColoration=!1,(C=this.miscModeToggleList[1].getComponent(eR)).isChecked=!0,w.lightingWithAlbedo=!0}},{key:"hideUI",value:function(n){var w=this.node.getChildByName("Titles"),k=!w.active;this.singleModeToggleList[0].parent.active=k,this.miscModeToggleList[0].parent.active=k,this.compositeModeToggleList[0].parent.active=k,this.EnableAllCompositeModeButton.parent.active=k,w.active=k,this.hideButtonLabel.string=k?"Hide UI":"Show UI"}},{key:"changeTextColor",value:function(n){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var w=0;w<this.textComponentList.length;w++)this.textComponentList[w].string=this.strColor[this._currentColorIndex]+this.textContentList[w]+"</color>";for(var k=0;k<this.labelComponentList.length;k++)this.labelComponentList[k].color=this.color[this._currentColorIndex]}},{key:"onLoad",value:function(){}},{key:"update",value:function(n){}}]),s}(eL)).prototype,"compositeModeToggle",[tC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tP=n(tA.prototype,"singleModeToggle",[tE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tR=n(tA.prototype,"EnableAllCompositeModeButton",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tA));ew._RF.pop(),ew._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var tQ=eS.ccclass,t$=eS.property,t0=(tI=tQ("AutoLayoutWrappee"),tO=t$({type:e_}),tL=t$({type:e_}),tI((tN=n((tM=T(function e(){C(this,e),E(this,"wrapeeContainer",tN,this),E(this,"wrapee",tz,this)})).prototype,"wrapeeContainer",[tO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tz=n(tM.prototype,"wrapee",[tL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tD=tM))||tD),t1=(tB=tQ("AutoLayout"),tF=t$({displayName:"Use Auto Layout"}),tx=t$({type:[t0],displayName:"Children",visible:function(){return this.useAutoLayout}}),tU=t$({visible:!1,serializable:!0}),tG=t$({type:eD,displayName:"Selected Index",visible:function(){return this.useAutoLayout}}),tH=t$({type:eM,displayName:"Deselected Icon Width",group:"Edge Icons",visible:function(){return this.useAutoLayout}}),tV=t$({visible:!1,serializable:!0}),tB((tK=n((tW=function(n){w(v,n);var B,F=k(v);function v(){var n;C(this,v);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=F.call.apply(F,[this].concat(k)),E(n,"useAutoLayout",tK,_(n)),E(n,"children",tj,_(n)),n.mappedChildren=[],E(n,"selected",tY,_(n)),E(n,"deselectedIconW",tX,_(n)),n.tweens=[],n}return T(v,[{key:"selectedIndex",get:function(){return this.selected},set:function(n){this.selected=n,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(n){this.deselectedIconW=n,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map(function(n){var w=n.wrapeeContainer.getComponent(eN);if(!w)throw new Error("AutoLayout: Widget component not found");return I(I({},n),{},{wrapeeContainerWidget:w})})}},{key:"updateLayout",value:function(n){var w=arguments.length>0&&void 0!==n&&n;if(this._layoutDirty||w){this.updateChildrenAnchors();var k,C=L(this.mappedChildren);try{for(C.s();!(k=C.n()).done;){var E=k.value;E.wrapeeContainerWidget.updateAlignment()}}catch(n){C.e(n)}finally{C.f()}}D(M(v.prototype),"updateLayout",this).call(this,w)}},{key:"getSelectedWorldX",value:function(){var n=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?n.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*n.width:n.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(n){if(n<this.selectedIndex)return 0;if(n>this.selectedIndex)return 1;if(0===n){var w=this.mappedChildren[n].wrapeeContainer.width,k=this.deselectedIconWidth/2,C=this.paddingLeft;return((C+w+(w-k+this.spacingX))/2-C)/w}if(n===this.children.length-1){var E=this.mappedChildren[n].wrapeeContainer.width,_=E-this.deselectedIconWidth/2+this.spacingX;return((_+E+this.paddingRight)/2-_)/E}return .5}},{key:"updateChildrenAnchors",value:(B=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:w=this,k=L(this.tweens);try{for(k.s();!(n=k.n()).done;)n.value.stop()}catch(n){k.e(n)}finally{k.f()}this.tweens=[];return[4,Promise.all([this.children.flatMap(function(n,k){return w.getChildrenAnchorsTweens(n,w.getAnchorX(k))}).map(function(n){return z.runTweenAsync(n)})])];case 1:C.sent();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var n=this;this.children.forEach(function(w,k){var C=n.getAnchorX(k);w.wrapee.setAnchorPoint(C,w.wrapee.anchorY),w.wrapeeContainer.setAnchorPoint(C,w.wrapeeContainer.anchorY)})}},{key:"getChildrenAnchorsTweens",value:function(n,w){return[ez(n.wrapee).to(.3,{anchorX:w},{easing:"sineInOut"}).call(function(){n.wrapee.setAnchorPoint(w,n.wrapee.anchorY)}),ez(n.wrapeeContainer).to(.3,{anchorX:w},{easing:"sineInOut"}).call(function(){n.wrapeeContainer.setAnchorPoint(w,n.wrapeeContainer.anchorY)})]}}]),v}(eB)).prototype,"useAutoLayout",[tF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),tj=n(tW.prototype,"children",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tY=n(tW.prototype,"selected",[tU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),n(tW.prototype,"selectedIndex",[tG],Object.getOwnPropertyDescriptor(tW.prototype,"selectedIndex"),tW.prototype),n(tW.prototype,"deselectedIconWidth",[tH],Object.getOwnPropertyDescriptor(tW.prototype,"deselectedIconWidth"),tW.prototype),tX=n(tW.prototype,"deselectedIconW",[tV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tq=tW))||tq);ew._RF.pop(),ew._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var t2="STARS_UPDATED",t4="PLAY_BUTTON_PRESS",t3="REQUEST_NAVIGATION",t5="REQUEST_NAVIGATION_ANIMATION",t6="DASHBOARD_EVENTS_BUTTON_PRESS";ew._RF.pop(),ew._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var t8,t9,t7,ne,nt,nn,ni,nr,na,no,ns,nl,nu,nh,np,nd,ny,nf,nv,ng,nm,nb,nw,nS=function(n){return n[n.store=0]="store",n[n.collections=1]="collections",n[n.home=2]="home",n[n.leaderboard=3]="leaderboard",n[n.tournaments=4]="tournaments",n}(nS||{});eF(nS),ew._RF.pop(),ew._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var nk=eS.ccclass,nC=eS.property,nE=globalThis.game.monitorError,n_=GameCore.Utils.Number,nA=(t8=nk("MultiBackground"),t9=nC({type:ex}),t7=nC({type:ex}),ne=nC({type:e_}),nt=nC({type:e_}),nn=nC({type:e_}),ni=nC(eD),nr=nC(eN),na=nC({type:eU(nS)}),no=nC({type:eU(nS)}),ns=B.onlyRunInLifeCycleAsync,nl=B.onlyRunInLifeCycle,t8((np=n((nh=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"background1",np,_(n)),E(n,"background2",nd,_(n)),E(n,"screenUiTransform",ny,_(n)),E(n,"background1UiTransform",nf,_(n)),E(n,"background2UiTransform",nv,_(n)),E(n,"backgroundNudgeAmount",ng,_(n)),E(n,"nudgeableWidget",nm,_(n)),E(n,"pageOrder",nb,_(n)),E(n,"homePage",nw,_(n)),n.currentThemeId="",n.tryNudgeBackground=function(w){var k=w.to,C=n.getDirection(n.homePage,k),E=n_.sign(C),_=Math.abs(C),T=n.backgroundNudgeAmount*_,I=Math.min(n.background1UiTransform.width,n.background2UiTransform.width),L=Math.max(0,(I-n.screenUiTransform.width)/2),D=Math.min(L,T)*E;ez(n.nudgeableWidget).to(.5,{horizontalCenter:D},{easing:eG.cubicInOut}).start()},n}return T(c,[{key:"onLoad",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,B.lazyValidateProperties(this),this.listenToNavigationEvents()}},{key:"onDestroy",value:function(){var n;null===(n=this.tweenSignal)||void 0===n||n.abort(),this.unlistenToNavigationEvents()}},{key:"listenToNavigationEvents",value:function(){this.node.scene.on(t5,this.tryNudgeBackground)}},{key:"unlistenToNavigationEvents",value:function(){this.node.scene.off(t5,this.tryNudgeBackground)}},{key:"getDirection",value:function(n,w){var k=this.pageOrder.indexOf(n),C=this.pageOrder.indexOf(w);return -1===k||-1===C?(null==nE||nE.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):k-C}},{key:"setCurrentTheme",value:(L=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,F.loadThemeAsync(n)];case 1:w=k.sent();w?this.updateBackgroundSprites(w,n):null==nE||nE.sendException(new Error("MultiBackground.setCurrentTheme: Failed to load theme ".concat(n,"'s sprite.")));return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"updateBackgroundSprites",value:function(n,w){n.packable=!1,this.background1.spriteFrame=n,this.background2.spriteFrame=n,this.currentThemeId=w}},{key:"animateToNextTheme",value:(I=N(function(n){var w,k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:if(this.currentThemeId===n)return[2,Promise.resolve()];return[4,F.loadThemeAsync(n)];case 1:k=_.sent();if(!k)return[3,3];k.packable=!1,this.currentThemeId=n,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=k,this.nextBackground.node.setSiblingIndex(1);C=this.nextBackground.getComponent(eH);if(!C)throw new Error("".concat(this.nextBackground.node.name," UIOpacity is required"));C.opacity=0,null===(w=this.tweenSignal)||void 0===w||w.abort(),this.tweenSignal=new x;return[4,z.runTweenAsync(ez(C).to(1,{opacity:255}),this.tweenSignal)];case 2:if(_.sent(),!this.tweenSignal.aborted){this.currentBackground.node.active=!1;E=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=E}return[3,4];case 3:null==nE||nE.sendException(new Error("MultiBackground.animateToNextTheme: Failed to load theme ".concat(n,"'s sprite.")));_.label=4;case 4:return[2]}})}),function(n){return I.apply(this,arguments)})}]),c}(eL)).prototype,"background1",[t9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nd=n(nh.prototype,"background2",[t7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ny=n(nh.prototype,"screenUiTransform",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nf=n(nh.prototype,"background1UiTransform",[nt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nv=n(nh.prototype,"background2UiTransform",[nn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ng=n(nh.prototype,"backgroundNudgeAmount",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),nm=n(nh.prototype,"nudgeableWidget",[nr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nb=n(nh.prototype,"pageOrder",[na],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nw=n(nh.prototype,"homePage",[no],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nS.home}}),n(nh.prototype,"setCurrentTheme",[ns],Object.getOwnPropertyDescriptor(nh.prototype,"setCurrentTheme"),nh.prototype),n(nh.prototype,"updateBackgroundSprites",[nl],Object.getOwnPropertyDescriptor(nh.prototype,"updateBackgroundSprites"),nh.prototype),nu=nh))||nu);ew._RF.pop(),ew._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var nT="musics/",nP="sounds/",nR=GameCore.Utils.Object,nI={BUTTON_CLICK:"".concat(nP,"use_item_click"),BOMB_DEFUSE:"".concat(nP,"bomb_defuse"),BOMB_EXPLODE_1:"".concat(nP,"bomb_explode_1"),BOMB_EXPLODE_2:"".concat(nP,"bomb_explode_2"),CLICKS:"".concat(nP,"clicks"),CLOSE_POPUP_CLICK:"".concat(nP,"close_popup_click"),COLLECT_STARS:"".concat(nP,"collect_stars"),COMBO_1:"".concat(nP,"combo_1"),COMBO_2:"".concat(nP,"combo_2"),COMBO_3:"".concat(nP,"combo_3"),COMBO_4:"".concat(nP,"combo_4"),COMBO_5:"".concat(nP,"combo_5"),DAILY_REWARD:"".concat(nP,"daily_reward"),EXTRA_TIME_SPAWN:"".concat(nP,"extra_time_spawn"),GIFT_CHARGE:"".concat(nP,"gift_charge"),GIFT_EXPLODE:"".concat(nP,"gift_explode"),GIFT_REVEAL:"".concat(nP,"gift_reveal"),HINT_ITEM:"".concat(nP,"hint_item"),INVALID_MATCH:"".concat(nP,"invalid_match"),LEVEL_COMPLETE:"".concat(nP,"level_complete"),LEVEL_FAIL:"".concat(nP,"level_fail"),LEVEL_START:"".concat(nP,"level_start"),PROGRESS_STAR:"".concat(nP,"progress_star"),RESCUE_TIMER:"".concat(nP,"rescue_timer"),ROCKET_FLY:"".concat(nP,"rocket_fly"),SHUFFLE_ITEM:"".concat(nP,"shuffle_item"),THREE_STARS:"".concat(nP,"three_stars"),TICKING_BOMB_BEFORE_EXPLODE:"".concat(nP,"ticking_bomb_before_explode"),TILE_SELECT:"".concat(nP,"tile_select"),USE_ITEM_CLICK:"".concat(nP,"use_item_click"),BG_MUSIC:"".concat(nT,"bg_music"),PATCH_SHIFT:"".concat(nP,"patch_shift"),THUNDERBOLT:"".concat(nP,"thunderbolt"),WIND:"".concat(nP,"wind"),COLLECT_COINS:"".concat(nP,"collect_coins"),COLLECT_STOCK_COINS:"".concat(nP,"collect_stock_coins"),LEVEL_FAIL_TIMEOUT:"".concat(nP,"level_fail_timeout"),STAR_CHEST_DRUM_ROLL:"".concat(nP,"star_chest_drum_roll"),STAR_CHEST_OPEN:"".concat(nP,"star_chest_open"),LEADERBOARD_TRIUMPH:"".concat(nP,"leaderboard_triumph"),ITEM_REWARD:"".concat(nP,"item_reward"),COMBO_6:"".concat(nP,"combo_6"),COMBO_7:"".concat(nP,"combo_7"),COMBO_8:"".concat(nP,"combo_8"),COMBO_9:"".concat(nP,"combo_9"),COMBO_10:"".concat(nP,"combo_10"),COMBO_11:"".concat(nP,"combo_11"),COMBO_12:"".concat(nP,"combo_12"),COMBO_13:"".concat(nP,"combo_13"),TILE_MATCH:"".concat(nP,"tile_match"),TOURNAMENT_MUSIC:"".concat(nT,"tournament_music")},nO=nR.vals(nI),nL=nO.reduce(function(n,w,k){return n[w]=k,n},{});eF(nL);var nD,nM,nN,nz,nB,nF,nx,nU,nG,nH,nV,nq,nW,nK,nj,nY,nX,nZ,nJ,nQ,n$,n0,n1,n2,n4,n3,n5,n6,n8,n9,n7,ie,it,ii,ir,ia=nO;ew._RF.pop(),ew._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var io,is,il,ih,ip=eS.ccclass,id=eS.property,iy=eS.disallowMultiple,iv=eS.executionOrder,ig=globalThis.game.analytics,im=GameCore.Plugins.Analytics.Events,ib=(nD=ip("ExtendedButton"),nM=iv(111),nN=id(eV),nz=id(eV),nB=id(eq.AnimationController),nF=id({override:!0,visible:!1}),nx=id({override:!0,visible:!1}),nU=id({override:!0,visible:!1}),nG=id({override:!0,visible:!1}),nH=id({override:!0,visible:!1}),nV=id({override:!0,visible:!1}),nq=id({override:!0,visible:!1}),nW=id({override:!0,visible:!1}),nK=id({override:!0,visible:!1}),nj=id({override:!0,visible:!1}),nY=id({override:!0,visible:!1}),nX=id(eW),nZ=id(eW),nJ=id(eW),nQ=id({visible:function(){return this.makeSound},type:nL}),n$=id({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),n0=id({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),n1=id({}),nD(n2=iy(n2=nM((n3=n((n4=function(n){w(h,n);var I=k(h);function h(){var n;C(this,h);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"clickStartEvents",n3,_(n)),E(n,"clickEndEvents",n5,_(n)),E(n,"animationController",n6,_(n)),E(n,"useDesktopHover",n8,_(n)),E(n,"emitAnalyticsEvents",n9,_(n)),E(n,"makeSound",n7,_(n)),E(n,"soundKey",ie,_(n)),E(n,"disableSpamClick",it,_(n)),E(n,"disableSpamDelay",ii,_(n)),E(n,"isScrollViewCancelInnerEvents",ir,_(n)),n.currentClickBoundingBox=null,n.hasDown=!1,n.hasUp=!1,n.hasFinishClickCycle=!1,n.onTouchStart=function(w){n.interactable&&(n.hasDown||(n.currentClickBoundingBox=U.getBoundingBoxToWorld(n.node),n.handleDown(w)))},n.onTouchEnd=function(w){n.scheduleOnce(function(){n.interactable&&n.hasDown&&(n.hasUp||n.handleUp(w))},0)},n.onTouchCancel=function(w){if(n.interactable&&n.hasDown&&!n.hasUp){if(!n.isScrollViewCancelInnerEvents){var k,C,E=w.getUILocation();if(null!==(k=null===(C=n.currentClickBoundingBox)||void 0===C?void 0:C.contains(E))&&void 0!==k&&k)return void n.handleUp(w)}n.hasUp=!0,n.hasFinishClickCycle=!0,n.handleResetButtonState(),n.emitClickEndEvents(w)}},n.onMouseEnter=function(w){n.useDesktopHover&&n.interactable&&(n.hasDown||(n.hasFinishClickCycle=!1,n.setAnimationState("HOVER")))},n.onMouseLeave=function(w){n.useDesktopHover&&n.interactable&&(n.hasDown||n.hasUp||n.hasFinishClickCycle||n.handleResetButtonState())},n.handleResetButtonState=function(){n.hasDown=!1,n.hasUp=!1,n.setAnimationState("RESET")},n}return T(h,[{key:"transition",get:function(){return eI.Transition.NONE},set:function(n){G(M(h.prototype),"transition",eI.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return D(M(h.prototype),"normalColor",this)},set:function(n){G(M(h.prototype),"normalColor",n,this,!0)}},{key:"pressedColor",get:function(){return D(M(h.prototype),"pressedColor",this)},set:function(n){G(M(h.prototype),"pressedColor",n,this,!0)}},{key:"hoverColor",get:function(){return D(M(h.prototype),"hoverColor",this)},set:function(n){G(M(h.prototype),"hoverColor",n,this,!0)}},{key:"disabledColor",get:function(){return D(M(h.prototype),"disabledColor",this)},set:function(n){G(M(h.prototype),"disabledColor",n,this,!0)}},{key:"normalSprite",get:function(){return D(M(h.prototype),"normalSprite",this)},set:function(n){G(M(h.prototype),"normalSprite",n,this,!0)}},{key:"pressedSprite",get:function(){return D(M(h.prototype),"pressedSprite",this)},set:function(n){G(M(h.prototype),"pressedSprite",n,this,!0)}},{key:"hoverSprite",get:function(){return D(M(h.prototype),"hoverSprite",this)},set:function(n){G(M(h.prototype),"hoverSprite",n,this,!0)}},{key:"disabledSprite",get:function(){return D(M(h.prototype),"disabledSprite",this)},set:function(n){G(M(h.prototype),"disabledSprite",n,this,!0)}},{key:"duration",get:function(){return D(M(h.prototype),"duration",this)},set:function(n){G(M(h.prototype),"duration",n,this,!0)}},{key:"zoomScale",get:function(){return D(M(h.prototype),"zoomScale",this)},set:function(n){G(M(h.prototype),"zoomScale",n,this,!0)}},{key:"__preload",value:function(){D(M(h.prototype),"__preload",this).call(this),B.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var n;null===(n=D(M(h.prototype),"onDestroy",this))||void 0===n||n.call(this)}},{key:"onEnable",value:function(){var n;null===(n=D(M(h.prototype),"onEnable",this))||void 0===n||n.call(this),this.node.off(eK.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(ek.EventType.TOUCH_START,this.onTouchStart),this.node.on(ek.EventType.TOUCH_END,this.onTouchEnd),this.node.on(ek.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(ek.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(ek.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var n;null===(n=D(M(h.prototype),"onDisable",this))||void 0===n||n.call(this),this.node.off(ek.EventType.TOUCH_START,this.onTouchStart),this.node.off(ek.EventType.TOUCH_END,this.onTouchEnd),this.node.off(ek.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(ek.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(ek.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(n){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&H.playSound(ia[this.soundKey]),this.emitClickStartEvents(n)}},{key:"emitClickStartEvents",value:function(n){var w,k=L(this.clickStartEvents);try{for(k.s();!(w=k.n()).done;){var C=w.value;C.emit([n,C.customEventData])}}catch(n){k.e(n)}finally{k.f()}}},{key:"emitClickEndEvents",value:function(n){var w,k=L(this.clickEndEvents);try{for(k.s();!(w=k.n()).done;){var C=w.value;C.emit([n,C.customEventData])}}catch(n){k.e(n)}finally{k.f()}}},{key:"handleUp",value:function(n){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(n),this.emitClickEndEvents(n)}},{key:"emitButtonEvents",value:function(n){if(this.interactable){this.emitAnalyticsEvents&&ig.event(im.BUTTON_CLICK,{button_name:this.node.name,screen_name:V.getCurrentPage()});var w,k=L(this.clickEvents);try{for(k.s();!(w=k.n()).done;){var C=w.value;C.emit([n,C.customEventData])}}catch(n){k.e(n)}finally{k.f()}}}},{key:"setAnimationState",value:function(n){this.animationController&&(this.animationController.setValue("DOWN","DOWN"===n),this.animationController.setValue("HOVER","HOVER"===n),this.animationController.setValue("RESET","RESET"===n))}},{key:"fakeClick",value:function(){var n=this;this.setAnimationState("DOWN"),this.scheduleOnce(function(){n.setAnimationState("RESET")},0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),h}(eI)).prototype,"clickStartEvents",[nN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),n5=n(n4.prototype,"clickEndEvents",[nz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),n6=n(n4.prototype,"animationController",[nB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(n4.prototype,"transition",[nF],Object.getOwnPropertyDescriptor(n4.prototype,"transition"),n4.prototype),n(n4.prototype,"normalColor",[nx],Object.getOwnPropertyDescriptor(n4.prototype,"normalColor"),n4.prototype),n(n4.prototype,"pressedColor",[nU],Object.getOwnPropertyDescriptor(n4.prototype,"pressedColor"),n4.prototype),n(n4.prototype,"hoverColor",[nG],Object.getOwnPropertyDescriptor(n4.prototype,"hoverColor"),n4.prototype),n(n4.prototype,"disabledColor",[nH],Object.getOwnPropertyDescriptor(n4.prototype,"disabledColor"),n4.prototype),n(n4.prototype,"normalSprite",[nV],Object.getOwnPropertyDescriptor(n4.prototype,"normalSprite"),n4.prototype),n(n4.prototype,"pressedSprite",[nq],Object.getOwnPropertyDescriptor(n4.prototype,"pressedSprite"),n4.prototype),n(n4.prototype,"hoverSprite",[nW],Object.getOwnPropertyDescriptor(n4.prototype,"hoverSprite"),n4.prototype),n(n4.prototype,"disabledSprite",[nK],Object.getOwnPropertyDescriptor(n4.prototype,"disabledSprite"),n4.prototype),n(n4.prototype,"duration",[nj],Object.getOwnPropertyDescriptor(n4.prototype,"duration"),n4.prototype),n(n4.prototype,"zoomScale",[nY],Object.getOwnPropertyDescriptor(n4.prototype,"zoomScale"),n4.prototype),n8=n(n4.prototype,"useDesktopHover",[nX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),n9=n(n4.prototype,"emitAnalyticsEvents",[nZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),n7=n(n4.prototype,"makeSound",[nJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ie=n(n4.prototype,"soundKey",[nQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nL[nI.BUTTON_CLICK]}}),it=n(n4.prototype,"disableSpamClick",[n$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ii=n(n4.prototype,"disableSpamDelay",[n0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),ir=n(n4.prototype,"isScrollViewCancelInnerEvents",[n1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),n2=n4))||n2)||n2)||n2);ew._RF.pop(),ew._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var iw,iS,ik,iC=eS.ccclass,iE=eS.requireComponent,i_=eS.property,iA=iC("OpacityToggler")(io=iE([eH])((il=n((is=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"activeValue",il,_(n)),E(n,"inActiveValue",ih,_(n)),n.signal=new x,n}return T(u,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(eH),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"changeState",value:function(n){var w=arguments.length>0&&void 0!==n&&n;this.signal.abort(),this.opacityComponent.opacity=w?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(I=N(function(){var n,w,k;var C=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:n=C.length>0&&void 0!==C[0]&&C[0],w=C.length>1&&void 0!==C[1]?C[1]:.2;this.signal.abort(),this.signal=new x;k=n?this.activeValue:this.inActiveValue;return[4,z.runTweenAsync(ez(this.opacityComponent).to(w,{opacity:k}),this.signal)];case 1:E.sent();return[2]}})}),function(){return I.apply(this,arguments)})}]),u}(eL)).prototype,"activeValue",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),ih=n(is.prototype,"inActiveValue",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),io=is))||io)||io;ew._RF.pop(),ew._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var iT,iP,iR,iI,iO,iL,iD,iM,iN,iz,iB,iF,ix,iU,iG,iH,iV,iq,iW,iK,ij=eS.ccclass,iY=eS.property,iX=eS.requireComponent,iZ=eS.disallowMultiple,iJ=eS.executeInEditMode,iQ=W.DesignSize,i$=iQ.Portrait,i0=iQ.Landscape;ij("DebugResolution")(iw=iZ(iw=iX([ej])(iw=iJ(!0)(((ik=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).handleLayoutChange=function(){var w;null===(w=n.graphics)||void 0===w||w.clear(),n.start()},n}return T(o,[{key:"drawPortrait",get:function(){return o._drawPortrait},set:function(n){n!==o._drawPortrait&&(n?this.drawPortraitResolution():this.graphics.clear(),o._drawPortrait=n,o._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return o._drawLandscape},set:function(n){n!==o._drawLandscape&&(n?this.drawLandscapeResolution():this.graphics.clear(),o._drawLandscape=n,o._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(ej),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){eY.on(q.LAYOUT_CHANGED,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var n=this.graphics;if(n){var w=i$.WIDTH,k=i$.HEIGHT,C=-w/2,E=-k/2;n.strokeColor=eC.GREEN,n.rect(C,E,w,k),n.stroke()}}},{key:"drawLandscapeResolution",value:function(){var n=this.graphics;if(n){var w=i0.WIDTH,k=i0.HEIGHT,C=-w/2,E=-k/2;n.strokeColor=eC.CYAN,n.rect(C,E,w,k),n.stroke()}}}]),o}(eL))._drawPortrait=!0,ik._drawLandscape=!0,n((iS=ik).prototype,"drawPortrait",[iY],Object.getOwnPropertyDescriptor(iS.prototype,"drawPortrait"),iS.prototype),n(iS.prototype,"drawLandscape",[iY],Object.getOwnPropertyDescriptor(iS.prototype,"drawLandscape"),iS.prototype),iw=iS))||iw)||iw)||iw);ew._RF.pop(),ew._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var i1=eS.ccclass,i2=eS.executionOrder,i4=eS.property,i3=GameCore.Utils.Valid,i5=eC.RED,i6=eC.BLACK,i8=eC.MAGENTA;iT=i1("GameStats"),iP=i2(-1e3),iR=i4(eT),iI=i4(eT),iO=i4(eT),iL=i4(eT),iD=i4(eT),iM=i4(eT),iN=i4(eT),iz=i4(eT),iT(iB=iP((ix=n((iF=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"fpsLabel",ix,_(n)),E(n,"drawCountLabel",iU,_(n)),E(n,"logicTimeLabel",iG,_(n)),E(n,"physicTimeLabel",iH,_(n)),E(n,"renderTimeLabel",iV,_(n)),E(n,"objectMemoryUsageLabel",iq,_(n)),E(n,"textureMemoryUsageLabel",iW,_(n)),E(n,"devicePixelRatioLabel",iK,_(n)),n.refreshInterval=.5,n.handleMouseDown=function(){n.bg.enabled=!n.bg.enabled},n.waitForStats=function(){eX.stats&&(n.unschedule(n.waitForStats),n.node.active=!0,n.stats=eX.stats,n.startUpdateStats())},n.updateStats=function(){n.updateFps(),n.updateDrawCalls(),n.updateLogicTime(),n.updatePhysicTime(),n.updateRenderTime(),n.updateObjectMemoryUsage(),n.updateTextureMemoryUsage(),n.updateDevicePixelRatio()},n}return T(s,[{key:"__preload",value:function(){this.bg=this.getComponent(ex),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(eK.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,eX&&i3.isDebugger()&&(eX.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var n=this.getFps();this.updateFpsColor(n),this.fpsLabel.string="FPS: ".concat(n)}},{key:"updateFpsColor",value:function(n){this.fpsLabel.color=n<30?i5:n<48?i8:i6}},{key:"updateDrawCalls",value:function(){var n=this.getDrawCalls();this.updateDrawCallsColor(n),this.drawCountLabel.string="Draw Calls: ".concat(n)}},{key:"updateDrawCallsColor",value:function(n){var w=eZ.os===eZ.OS.IOS,k=w?80:25,C=w?60:15;this.drawCountLabel.color=n>k?i5:n>C?i8:i6}},{key:"updateLogicTime",value:function(){var n=this.getLogicTime();this.updateLogicTimeColor(n),this.logicTimeLabel.string="Logic Time: ".concat(n.toFixed(2),"ms")}},{key:"updateLogicTimeColor",value:function(n){this.logicTimeLabel.color=n>10?i5:n>5?i8:i6}},{key:"updatePhysicTime",value:function(){var n=this.getPhysicTime();this.updatePhysicTimeColor(n),this.physicTimeLabel.string="Physic Time: ".concat(n.toFixed(2),"ms")}},{key:"updatePhysicTimeColor",value:function(n){this.physicTimeLabel.color=n>10?i5:n>5?i8:i6}},{key:"updateRenderTime",value:function(){var n=this.getRenderTime();this.updateRenderTimeColor(n),this.renderTimeLabel.string="Render Time: ".concat(n.toFixed(2),"ms")}},{key:"updateRenderTimeColor",value:function(n){this.renderTimeLabel.color=n>10?i5:n>5?i8:i6}},{key:"updateObjectMemoryUsage",value:function(){var n=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(n),this.objectMemoryUsageLabel.string="Object Mem: ".concat(n.toFixed(2),"MB")}},{key:"updateObjectMemoryUsageColor",value:function(n){this.objectMemoryUsageLabel.color=n>40?i5:n>25?i8:i6}},{key:"updateTextureMemoryUsage",value:function(){var n=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(n),this.textureMemoryUsageLabel.string="Texture Mem: ".concat(n.toFixed(2),"MB")}},{key:"updateTextureMemoryUsageColor",value:function(n){this.textureMemoryUsageLabel.color=n>50?i5:n>35?i8:i6}},{key:"updateDevicePixelRatio",value:function(){var n=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(n),this.devicePixelRatioLabel.string="Device Pixel Ratio: ".concat(n)}},{key:"updateDevicePixelRatioColor",value:function(n){this.devicePixelRatioLabel.color=n>2?i5:n<=1?i8:i6}},{key:"getFps",value:function(){var n=this.stats.fps.counter;return Math.floor(n.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var n=this.stats.logic.counter;return Math.floor(1e3*n.value)/1e3||0}},{key:"getPhysicTime",value:function(){var n=this.stats.physics.counter;return Math.floor(1e3*n.value)/1e3||0}},{key:"getRenderTime",value:function(){var n=this.stats.render.counter;return Math.floor(1e3*n.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var n=this.stats.bufferMemory.counter;return Math.floor(1e3*n.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var n=this.stats.textureMemory.counter;return Math.floor(1e3*n.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),s}(eL)).prototype,"fpsLabel",[iR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iU=n(iF.prototype,"drawCountLabel",[iI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iG=n(iF.prototype,"logicTimeLabel",[iO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iH=n(iF.prototype,"physicTimeLabel",[iL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iV=n(iF.prototype,"renderTimeLabel",[iD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iq=n(iF.prototype,"objectMemoryUsageLabel",[iM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iW=n(iF.prototype,"textureMemoryUsageLabel",[iN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iK=n(iF.prototype,"devicePixelRatioLabel",[iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iB=iF))||iB);ew._RF.pop(),ew._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var i9,i7=function(n){return n.CHALLENGE_FRIENDS="challenge-friends",n.REPLAY_FRIENDS="replay-friends",n.SHOW_CHALLENGE_RESULTS="show-challenge-results",n.NEXT_LEVEL="next-level",n.MAX_LEVEL="max-level",n.START_OVER="start-over",n.SELECT_LEVEL="select-level",n.GAME_START="game-start",n.GAME_PAUSE="game-pause",n.GAME_RESUME="game-resume",n.GAME_REPLAY="game-replay",n.GAME_FINISH="game-finish",n.GAME_EXIT="game-exit",n.USE_ITEM="use-item",n.SKIP_LEVEL="skip-level",n.ADD_ITEM="add-item",n.ADD_ITEMS="add-items",n.REFRESH_ITEMS="refresh-items",n.ADD_COINS="add-coins",n.REMOVE_COINS="remove-coins",n.REMOVE_COINS_SUCCESS="remove-coins-success",n.REMOVE_COINS_FAILED="remove-coins-failed",n.COIN_CHANGED="coin-changed",n.ABORT_COIN_ANIMATION="abort-coin-animation",n.ADD_STARS="add-stars",n.PAUSE_TIME="pause-time",n.RESUME_TIME="resume-time",n.TIME_OUT="time-out",n.HALF_TIME="half-time",n.RESCUE_START="rescue-time",n.RESCUE_FINISHED="clock-animation-finished",n.TIME_UPDATED="time-updated",n.APPLY_GRAVITY="apply-gravity",n.IDLE_ENTER="idle-enter",n.IDLE_EXIT="idle-exit",n.GRID_MATCH="grid-match",n.GRID_MATCH_SUCCESS="grid-match-success",n.GRID_MATCH_FAIL="grid-match-fail",n.GRID_CLEAR="grid-clear",n.GRID_SPAWN="grid-spawn",n.GRID_CREATE="grid-create",n.GRID_RESIZE="grid-resize",n.TILE_CLICK="tile-click",n.BOMB_EXPLODE="bomb-explode",n.SHOW_HINT="show-hint",n.ADD_COMBO="add-combo",n.COMBO_UPDATED="combo-updated",n.COMBO_ENDED="combo-ended",n.COMBO_PROGRESS="combo-progress",n.ADD_SCORE="add-score",n.SCORE_UPDATED="score-updated",n.SHOW_UI="show-ui",n.HIDE_UI="hide-ui",n.AUTO_PLAY="auto-play",n.GUIDE_MASK_CLICKED="guide-mask-clicked",n}(i7||{});ew._RF.pop(),ew._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var re,rt,rn,ri,rr,ra,ro,rs,rl,ru,rp,rd,ry,rf,rv,rg,rm,rb,rw=(0,eS.ccclass)("PanelAnimationController")(i9=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).animators=new Set,n.eventTarget=new eJ,n.handleRegistration=function(w){if(!w)throw new Error("Invalid event payload.");n.animators.has(w)&&console.warn("Animator already registered."),n.animators.add(w)},n.handleUnregistration=function(w){if(!w)throw new Error("Invalid event payload.");n.animators.has(w)||console.warn("Animator not registered."),n.animators.delete(w)},n.handleShowUIs=function(){var w=N(function(w){var k,C,E,_,T,I,D,M,N,z,B;return _ts_generator(this,function(F){switch(F.label){case 0:E=!1,_=[],T=L(n.animators);try{for(T.s();!(C=T.n()).done;){I=C.value;_.push(I)}}catch(n){T.e(n)}finally{T.f()}for(D=[],M=0,N=_;M<N.length;M++){B=N[M];if(!B.isReadyForAnimation()&&!E)E=!0,null==w||null===(z=w.fallback)||void 0===z||z.call(w);D.push(B.handleShowUI())}return[4,Promise.all(D)];case 1:F.sent(),null==w||null===(k=w.onComplete)||void 0===k||k.call(w),n.eventTarget.emit(i7.SHOW_UI);return[2]}})});return function(n){return w.apply(this,arguments)}}(),n.handleHideUIs=function(){var w=N(function(w){var k,C,E,_,T,I,D,M,N,z,B;return _ts_generator(this,function(F){switch(F.label){case 0:E=!1,_=[],T=L(n.animators);try{for(T.s();!(C=T.n()).done;){I=C.value;_.push(I)}}catch(n){T.e(n)}finally{T.f()}for(D=[],M=0,N=_;M<N.length;M++){B=N[M];if(!B.isReadyForAnimation()&&!E)E=!0,null==w||null===(z=w.fallback)||void 0===z||z.call(w);D.push(B.handleHideUI())}return[4,Promise.all(D)];case 1:F.sent(),null==w||null===(k=w.onComplete)||void 0===k||k.call(w),n.eventTarget.emit(i7.HIDE_UI);return[2]}})});return function(n){return w.apply(this,arguments)}}(),n}return T(o,[{key:"onEnable",value:function(){this.node.scene.on(i7.SHOW_UI,this.handleShowUIs,this),this.node.scene.on(i7.HIDE_UI,this.handleHideUIs,this)}},{key:"onDisable",value:function(){this.node.scene.off(i7.SHOW_UI,this.handleShowUIs,this),this.node.scene.off(i7.HIDE_UI,this.handleHideUIs,this)}},{key:"showUI",value:function(){return this.handleShowUIs()}},{key:"hideUI",value:function(){return this.handleHideUIs()}},{key:"on",value:function(n,w,k,C){this.eventTarget.on(n,w,k,C)}},{key:"off",value:function(n,w,k){this.eventTarget.off(n,w,k)}}],[{key:"getController",value:function(n){for(var w=null,k=n;null!==k;){if(w=k.getComponent(o))break;k=k.parent}return w}},{key:"registerAnimator",value:function(n){var w=this.getController(n.node);w?w.handleRegistration(n):console.warn("No PanelAnimationController found for animator ".concat(n.node.name))}},{key:"unregisterAnimator",value:function(n){var w=this.getController(n.node);w?w.handleUnregistration(n):console.warn("No PanelAnimationController found for animator ".concat(n.node.name))}}]),o}(eL))||i9;ew._RF.pop(),ew._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var rS,rk=eS.ccclass,rC=eS.property,rE=GameCore.Utils.Object,r_=(re=rk("AnimationConfig"),rt=rC({type:[eN]}),re((rr=n((ri=function(){function e(){C(this,e),E(this,"startHidden",rr,this),E(this,"nodes",ra,this),E(this,"posOffset",ro,this),E(this,"showEase",rs,this),E(this,"hideEase",rl,this),E(this,"showDuration",ru,this),E(this,"hideDuration",rp,this)}return T(e,[{key:"setConfig",value:function(n){n&&rE.assign(this,n)}}]),e}()).prototype,"startHidden",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ra=n(ri.prototype,"nodes",[rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ro=n(ri.prototype,"posOffset",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rs=n(ri.prototype,"showEase",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),rl=n(ri.prototype,"hideEase",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),ru=n(ri.prototype,"showDuration",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rp=n(ri.prototype,"hideDuration",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rn=ri))||rn),rA=(rd=rk("PanelAnimator"),ry=rC({type:r_,displayName:"Top animation nodes"}),rf=rC({type:r_,displayName:"Bottom animation nodes"}),rd((rm=n((rg=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"topConfig",rm,_(n)),E(n,"botConfig",rb,_(n)),n.isReady=!1,n}return T(c,[{key:"onEnable",value:function(){rw.registerAnimator(this)}},{key:"onDisable",value:function(){rw.unregisterAnimator(this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(L=N(function(){return _ts_generator(this,function(n){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return L.apply(this,arguments)})},{key:"handleHideUI",value:(I=N(function(){return _ts_generator(this,function(n){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return I.apply(this,arguments)})},{key:"createAnimator",value:function(n,w){var k=n.nodes,C=n.posOffset,E=n.showEase,_=n.hideEase,T=n.showDuration,I=n.hideDuration,L=k.map(function(n){return"top"===w&&n.isAlignTop?{mode:"top",value:n.top}:"bottom"===w&&n.isAlignBottom?{mode:"bottom",value:n.bottom}:{mode:"position",value:n.node.position.y}}),D=k.map(function(n){return"top"===w&&n.isAlignTop?{mode:"top",value:n.top+C}:"bottom"===w&&n.isAlignBottom?{mode:"bottom",value:n.bottom-C}:{mode:"position",value:n.node.position.y+C}}),M="shown",N=new x;return{switchState:function(n,w){var C=arguments.length>1&&void 0!==w&&w;if(N.abort(),N=new x,M===n)return Promise.resolve(null);M=n;var B="hidden"===n?L:D,F="hidden"===n?D:L,U="hidden"===n?I:T,G="hidden"===n?_:E;return C?(k.forEach(function(n,w){var k=B[w],C=F[w].value;"top"===k.mode&&(n.top=C),"bottom"===k.mode&&(n.bottom=C),"position"===k.mode&&(n.node.position=new eQ(n.node.position.x,C,n.node.position.z))}),Promise.resolve(null)):Promise.all(k.map(function(n,w){var k=B[w],C=F[w].value;return z.runTweenAsync(c.getTween({widget:n,config:k,target:C,easing:G,duration:U}),N)}))}}}},{key:"setAnimator",value:function(n){var w=n.topConfig,k=n.botConfig,C=new r_,E=new r_;C.setConfig(w),E.setConfig(k),this.topConfig=C,this.botConfig=E,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(n){var w=n.widget,k=n.config,C=n.target,E=n.easing,_=n.duration;return"top"===k.mode?ez(w).call(function(){w.top=k.value}).to(_,{top:C},{easing:E}):"bottom"===k.mode?ez(w).call(function(){w.bottom=k.value}).to(_,{bottom:C},{easing:E}):ez(w.node.position).call(function(){w.node.position=new eQ(w.node.position.x,k.value,w.node.position.z)}).to(_,{y:C},{easing:E})}}]),c}(eL)).prototype,"topConfig",[ry],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new r_}}),rb=n(rg.prototype,"botConfig",[rf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new r_}}),rv=rg))||rv);ew._RF.pop(),ew._RF.push({},"21a9aAlkBtGxKLqip8g0o6l","ParticleSystem2DExtra",void 0);var rT=eS.ccclass,rP=eS.disallowMultiple,rR=eS.executeInEditMode,rI=eS.requireComponent,rO=rT("ParticleSystem2DExtra")(rS=rR(!0)(rS=rP(!0)(rS=rI(e$)(rS=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).emitParticle=function(w){return function(k){w(k);var C=n.particleSystem._simulator.particles.length,E=n.particleSystem._simulator.particles[C-1];n.initParticle(E)}},n.step=function(w){return function(k){for(var C=n.particleSystem._simulator.particles,E=0;E<C.length;E++){var _=C[E];n.updateParticle(_,k)}w(k)}},n}return T(o,[{key:"__preload",value:function(){this.particleSystem=this.getComponent(e$),this.validateRequiredComponents(),this.overrideFunctions()}},{key:"overrideFunctions",value:function(){var n=this.particleSystem._simulator.emitParticle.bind(this.particleSystem._simulator);this.particleSystem._simulator.emitParticle=this.emitParticle(n);var w=this.particleSystem._simulator.step.bind(this.particleSystem._simulator);this.particleSystem._simulator.step=this.step(w)}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}}]),o}(eL))||rS)||rS)||rS)||rS;ew._RF.pop(),ew._RF.push({},"9a5a3MgLaRAKbHluGCPsA8j","ExampleParticleSystem2DExtra",void 0);var rL,rD,rM,rN,rz,rB,rF,rx,rU,rG,rH,rV;(0,eS.ccclass)("ExampleParticleSystem2DExtra")(function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"initParticle",value:function(n){n.maxSize=e0.randomRange(.25,1)*n.size,n.size=0,n.deltaSize=0,n.cycleDuration=e0.randomRange(.4,.6),n.life=n.timeToLive,this.setInitPosition(n.pos)}},{key:"updateParticle",value:function(n,w){this.updateScale(n)}},{key:"setInitPosition",value:function(n){var w=n.x,k=n.y;return n.x=w+e0.randomRange(-350,350),n.y=k+e0.randomRange(-350,350),n}},{key:"updateScale",value:function(n){var w=1-(n.life-n.timeToLive)%n.cycleDuration/n.cycleDuration;n.size=n.maxSize*Math.sin(w*Math.PI)}}]),o}(rO));ew._RF.pop(),ew._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var rq,rW,rK,rj,rY,rX,rZ,rJ,rQ,r$,r0,r1=eS.ccclass,r2=eS.requireComponent,r4=eS.property,r3=globalThis.game,r5=r3.ads,r6=r3.event,r8=GameCore,r9=r8.Events,r7=r8.Configs.Ads.BannerDisplayAdOptions,ae=r8.Plugins.Ads,at=ae.Types,an=ae.Status,ai=r8.Utils,ar=ai.Array,aa=ai.Function,ao=["top","topleft","topright"],as=["bottom","bottomleft","bottomright"],al=["left","topleft","bottomleft"],au=["right","topright","bottomright"];rL=r1("ResizeWithBannerAd"),rD=r2(eN),rM=r4(eW),rN=r4(eW),rz=r4(eW),rB=r4(eW),rL(rF=rD((rU=n((rx=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"includeSAB",rU,_(n)),E(n,"includeRightBanner",rG,_(n)),E(n,"includeBottomBanner",rH,_(n)),E(n,"includeLeftBanner",rV,_(n)),n.handleOnAdShowing=function(w){var k=w.placementId;n.checkValid()&&k&&r5.getAd(at.BANNER,k)&&(n.resizeWhenBannerAdShow(k),n.emitResizeEvent())},n.handleOnAdClosed=function(w){var k=w.placementId;n.checkValid()&&k&&r5.getAd(at.BANNER,k)&&(n.resizeWhenBannerAdClose(k),n.emitResizeEvent())},n.handleOnResize=function(){n.checkValid()&&r7.forEach(function(w){var k=w.PlacementId,C=r5.getAdStatus(at.BANNER,k);C&&(C===an.SHOWING?n.resizeWhenBannerAdShow(k):C===an.IDLE&&n.resizeWhenBannerAdClose(k))})},n.resizeWhenBannerAdShow=function(w){var k=void 0,C=void 0,E=void 0,_=void 0,T=U.cssSizeToWorldSize(1),I=r5.getBannerConfig(w),L=I.PlacementId,D=I.BannerWidth,M=I.Position;if("top"===M)k=r5.getBannerHeight(L,T);else if("bottom"===M)n.includeBottomBanner?C=r5.getBannerHeight(L,T,n.includeSAB):n.includeSAB&&(C=r5.getSafeAreaBottom(T));else if("left"===M||"right"===M){if(void 0===D)return;var N=D;"getBannerOffset"in GameSDK.extra&&(N+=GameSDK.extra.getBannerOffset()),"left"===M&&n.includeLeftBanner?E=N*T:"right"===M&&n.includeRightBanner&&(_=N*T)}n.updateWidgets({top:k,bottom:C,left:E,right:_})},n.resizeWhenBannerAdClose=function(w){var k=r5.getBannerConfig(w).Position,C=U.cssSizeToWorldSize(1),E=n.includeSAB?r5.getSafeAreaBottom(C):0;n.updateWidgets({top:ar.has(ao,k)?0:void 0,bottom:ar.has(as,k)?E:void 0,left:ar.has(al,k)?0:void 0,right:ar.has(au,k)?0:void 0})},n.emitResizeEvent=aa.debounce(function(){eY.emit(q.WIDGET_RESIZED)},100),n}return T(s,[{key:"__preload",value:function(){this.widget=this.getComponent(eN),B.lazyValidateProperties(this),r6.on(r9.AD_SHOWING,this.handleOnAdShowing),r6.on(r9.AD_CLOSED,this.handleOnAdClosed),eY.on(q.VIEW_RESIZED,this.handleOnResize)}},{key:"onDestroy",value:function(){r6.off(r9.AD_SHOWING,this.handleOnAdShowing),r6.off(r9.AD_CLOSED,this.handleOnAdClosed),eY.off(q.VIEW_RESIZED,this.handleOnResize)}},{key:"start",value:function(){this.handleOnResize()}},{key:"updateWidgets",value:function(n){var w=n.top,k=n.bottom,C=n.left,E=n.right;this.widget.top=null!=w?w:this.widget.top,this.widget.bottom=null!=k?k:this.widget.bottom,this.widget.left=null!=C?C:this.widget.left,this.widget.right=null!=E?E:this.widget.right,e1.instance.emit("canvas-resize")}},{key:"checkValid",value:function(){return this.node.activeInHierarchy&&null!==this.node.parent&&void 0!==this.node.parent}}]),s}(eL)).prototype,"includeSAB",[rM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rG=n(rx.prototype,"includeRightBanner",[rN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rH=n(rx.prototype,"includeBottomBanner",[rz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rV=n(rx.prototype,"includeLeftBanner",[rB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rF=rx))||rF);ew._RF.pop(),ew._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var ah,ap,ad,ay,af,av,ag,am=eS.ccclass,ab=eS.property,aw=eS.executeInEditMode,aS=eS.requireComponent,ak=(rq=am("TapperedProgressBar"),rW=aS(eH),rK=ab({type:eH,displayName:"Fill opacity"}),rj=ab({type:ex,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),rY=ab({type:ex,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),rX=ab({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),rq(rZ=aw(rZ=rW((rQ=n((rJ=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"uiOpacity",rQ,_(n)),E(n,"leftCap",r$,_(n)),E(n,"rightCap",r0,_(n)),n}return T(s,[{key:"progress",get:function(){return D(M(s.prototype),"progress",this)},set:function(n){G(M(s.prototype),"progress",n,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity){if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var n=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=n}}}},{key:"start",value:function(){this.updateAppearance()}}]),s}(e2)).prototype,"uiOpacity",[rK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),r$=n(rJ.prototype,"leftCap",[rj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),r0=n(rJ.prototype,"rightCap",[rY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),n(rJ.prototype,"progress",[rX],Object.getOwnPropertyDescriptor(rJ.prototype,"progress"),rJ.prototype),rZ=rJ))||rZ)||rZ)||rZ);ew._RF.pop(),ew._RF.push({},"aa60frMJLtIlJZh2yJhMp1s","DynamicLabel",void 0);var aC,aE,a_,aA,aT,aP,aR,aI,aL,aD,aM,aN,az,aB,aF,ax,aU,aG,aH=eS.ccclass,aV=eS.property,aq=eS.executeInEditMode,aW=eS.requireComponent;ah=aH("DynamicLabel"),ap=aW(eT),ad=aq(!0),ay=aV({type:eM,min:1,max:200}),af=aV({type:eM,min:.1,max:4}),ah(av=ap(av=ad((n((ag=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k)))._quality=1,n._size=1,n._outlineWidth=0,n._shadowOffset=new e4(0,0),n}return T(o,[{key:"size",get:function(){return this._size},set:function(n){this._size=n,this.label.fontSize=this.size*this.quality}},{key:"quality",get:function(){return this._quality},set:function(n){this._quality=n,this.node.scale=new eQ(1/this.quality,1/this.quality,1),this.label.fontSize=this.size*this.quality,this.label.outlineWidth=this._outlineWidth*this.quality,this.label.shadowOffset=this._shadowOffset.multiplyScalar(this.quality)}},{key:"__preload",value:function(){this.label=this.getComponent(eT)}},{key:"start",value:function(){this._quality=1/this.node.scale.x,this._size=this.label.fontSize/this.quality,this._outlineWidth=this.label.outlineWidth,this._shadowOffset=this.label.shadowOffset,this.quality=window.devicePixelRatio,console.info("\uD83D\uDD20 ".concat(this.node.name,"<Label> quality:"),this.quality)}}]),o}(eL)).prototype,"size",[ay],Object.getOwnPropertyDescriptor(ag.prototype,"size"),ag.prototype),n(ag.prototype,"quality",[af],Object.getOwnPropertyDescriptor(ag.prototype,"quality"),ag.prototype),av=ag))||av)||av);ew._RF.pop(),ew._RF.push({},"24e92x58aBHlrfObdu6qJYD","LocalizePreloader",void 0);var aK,aj,aY,aX,aZ,aJ,aQ,a$,a0,a1,a2,a4,a3,a5,a6,a8,a9,a7,oe,ot,on,oi,or=eS.ccclass,oa=eS.property,oo=GameCore.Utils,os=oo.Array,ol=oo.Valid,ou=globalThis.game.language,op=Object.keys(K),od=(aC=or("LocalizeTextureKey"),aE=oa({visible:!1}),a_=oa(e3),aC((aP=n((aT=function(){function e(){C(this,e),E(this,"_key",aP,this)}return T(e,[{key:"key",get:function(){return this._key},set:function(n){ou.hasTextureKey(n)?this._key=n:console.warn("Key ".concat(n," not found in locales"))}}]),e}()).prototype,"_key",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),n(aT.prototype,"key",[a_],Object.getOwnPropertyDescriptor(aT.prototype,"key"),aT.prototype),aA=aT))||aA),oy=(aR=or("SupportedLocaleKey"),aI=oa({visible:!1}),aL=oa(e3),aR((aN=n((aM=function(){function e(){C(this,e),E(this,"_key",aN,this)}return T(e,[{key:"key",get:function(){return this._key},set:function(n){op.includes(n)?this._key=n:console.warn("Key ".concat(n," not found. Supported locales are ").concat(op.join(", ")))}}]),e}()).prototype,"_key",[aI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),n(aM.prototype,"key",[aL],Object.getOwnPropertyDescriptor(aM.prototype,"key"),aM.prototype),aD=aM))||aD);az=or("LocalizePreloader"),aB=oa([od]),aF=oa({type:oy,tooltip:"Preload only for these locales"}),az((aU=n((ax=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"keys",aU,_(n)),E(n,"locales",aG,_(n)),n}return T(s,[{key:"__preload",value:function(){var n=ou.getCurrentLocale(),w=this.locales.map(function(n){return n.key});if(os.has(w,n)){var k=this.keys.reduce(function(n,w){if(!1===ou.hasTextureKey(w.key))return n;var k="".concat(ou.getTexture(w.key),"/spriteFrame");return n.push(k),n},[]);F.loadSpriteFramesAsync(k)}else ol.isDebugger()&&console.info("Skipping preloading of textures because current locale is not in the list of preloading locales")}}]),s}(eL)).prototype,"keys",[aB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aG=n(ax.prototype,"locales",[aF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ax));ew._RF.pop(),ew._RF.push({},"3f364xnTJtDR5yeow2MWHhm","LocalizedLayout",void 0);var of,ov,og,om,ob,ow,oS,ok,oC,oE=eS.ccclass,o_=eS.property,oA=eS.executeInEditMode,oT=eS.disallowMultiple,oP=eS.requireComponent;aK=oE("LocalizedLayout"),aj=oA(!0),aY=oP(e_),aX=o_(j),aZ=B.required(),aJ=o_(e_),aQ=o_({visible:!1}),a$=o_({visible:!1}),a0=o_({visible:!1}),a1=o_({visible:!1}),a2=o_({type:eM,group:"Padding"}),a4=o_({type:eM,group:"Padding"}),a3=o_({type:eM,group:"Padding"}),a5=o_({type:eM,group:"Padding"}),aK(a6=oT(a6=aj(a6=aY((a9=n((a8=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"label",a9,_(n)),E(n,"layout",a7,_(n)),E(n,"_top",oe,_(n)),E(n,"_down",ot,_(n)),E(n,"_left",on,_(n)),E(n,"_right",oi,_(n)),n.updateContentSize=function(w){var k,C=(null!=w?w:{}).localize;if(void 0!==n.label&&(void 0===C||n.label===C)){var E=null===(k=n.label.getComponent(e_))||void 0===k?void 0:k.contentSize;void 0!==E&&n.layout.setContentSize(E.width+n.left+n.right,E.height+n.top+n.down)}},n}return T(s,[{key:"top",get:function(){return this._top},set:function(n){this._top=n,this.updateContentSize()}},{key:"down",get:function(){return this._down},set:function(n){this._down=n,this.updateContentSize()}},{key:"left",get:function(){return this._left},set:function(n){this._left=n,this.updateContentSize()}},{key:"right",get:function(){return this._right},set:function(n){this._right=n,this.updateContentSize()}},{key:"__preload",value:function(){this.layout=this.getComponent(e_),B.validateRequiredProperties(this)}},{key:"start",value:function(){this.updateContentSize()}},{key:"onEnable",value:function(){this.listenEvent()}},{key:"onDisable",value:function(){this.unlistenEvent()}},{key:"listenEvent",value:function(){eY.on(q.LOCALIZE_APPLIED,this.updateContentSize)}},{key:"unlistenEvent",value:function(){eY.off(q.LOCALIZE_APPLIED,this.updateContentSize)}}]),s}(eL)).prototype,"label",[aX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a7=n(a8.prototype,"layout",[aZ,aJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oe=n(a8.prototype,"_top",[aQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ot=n(a8.prototype,"_down",[a$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),on=n(a8.prototype,"_left",[a0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oi=n(a8.prototype,"_right",[a1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),n(a8.prototype,"top",[a2],Object.getOwnPropertyDescriptor(a8.prototype,"top"),a8.prototype),n(a8.prototype,"down",[a4],Object.getOwnPropertyDescriptor(a8.prototype,"down"),a8.prototype),n(a8.prototype,"left",[a3],Object.getOwnPropertyDescriptor(a8.prototype,"left"),a8.prototype),n(a8.prototype,"right",[a5],Object.getOwnPropertyDescriptor(a8.prototype,"right"),a8.prototype),a6=a8))||a6)||a6)||a6);ew._RF.pop(),ew._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var oR,oI,oO,oL,oD,oM,oN,oz,oB,oF=eS.ccclass,ox=eS.property,oU=function(){function e(n,w){C(this,e);var k=null!=w?w:{response:1,dampen:1,eager:1};this.k1=e.calcK1(k),this.k2=e.calcK2(k),this.k3=e.calcK3(k),this.xp=n.clone(),this.y=n.clone(),this.yd=new e4(0,0)}return T(e,[{key:"update",value:function(n,w,k){var C=arguments.length>2&&void 0!==k?k:null,E=C;null===E&&(E=new e4((w.x-this.xp.x)/n,(w.y-this.xp.y)/n),this.xp.x=w.x,this.xp.y=w.y);var _=Math.max(this.k2,n*n/2+n*this.k1/2,n*this.k1);return this.y.x=this.y.x+n*this.yd.x,this.y.y=this.y.y+n*this.yd.y,this.yd.x=this.yd.x+n*(w.x+this.k3*E.x-this.y.x-this.k1*this.yd.x)/_,this.yd.y=this.yd.y+n*(w.y+this.k3*E.y-this.y.y-this.k1*this.yd.y)/_,this.y}},{key:"setDynamics",value:function(n){this.k1=e.calcK1(n),this.k2=e.calcK2(n),this.k3=e.calcK3(n)}},{key:"reset",value:function(n){this.xp.set(n.x,n.y),this.y.set(n.x,n.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(n){return n.dampen/(Math.PI*n.response)}},{key:"calcK2",value:function(n){return 1/(2*Math.PI*n.response*(2*Math.PI*n.response))}},{key:"calcK3",value:function(n){return n.eager*n.dampen/(2*Math.PI*n.response)}}]),e}(),oG=(of=oF("SODConfig"),ov=ox({type:eM,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),og=ox({type:eM,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),om=ox({type:eM,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),of((oS=n((ow=T(function e(){C(this,e),E(this,"response",oS,this),E(this,"dampen",ok,this),E(this,"eager",oC,this)})).prototype,"response",[ov],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),ok=n(ow.prototype,"dampen",[og],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),oC=n(ow.prototype,"eager",[om],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ob=ow))||ob);ew._RF.pop(),ew._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var oH,oV,oq,oW,oK,oj,oY,oX,oZ,oJ,oQ,o$,o0,o1,o2,o4,o3,o5,o6,o8,o9,o7,se,st,sn,si,sr=eS.ccclass,sa=eS.property,so=(oR=sr("Trail"),oI=sa({type:ek,displayName:"Target"}),oO=sa({type:ej,displayName:"Graphics"}),oL=sa({type:[oG],displayName:"Trail Nodes"}),oR((oN=n((oM=function(n){w(u,n);var I=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"target",oN,_(n)),E(n,"graphics",oz,_(n)),E(n,"trailNodes",oB,_(n)),n.trailNodeInstances=[],n}return T(u,[{key:"reset",value:function(){var n,w=L(this.trailNodeInstances);try{for(w.s();!(n=w.n()).done;)n.value.reset(new e4(this.node.worldPosition.x,this.node.worldPosition.y))}catch(n){w.e(n)}finally{w.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(n){this.graphics.clear();var w=this.trailNodeInstances[0];this.drawTrail(n,w,this.target.worldPosition.x,this.target.worldPosition.y);for(var k=1;k<this.trailNodeInstances.length;k++){var C=this.trailNodeInstances[k-1],E=this.trailNodeInstances[k];this.drawTrail(n,E,C.currentState.x,C.currentState.y)}}},{key:"drawTrail",value:function(n,w,k,C){var E=this.graphics,_=new e4(k,C),T=w.update(n,_),I=new eQ(_.x,_.y,0),L=new eQ(T.x,T.y,0);E.node.inverseTransformPoint(I,I),E.node.inverseTransformPoint(L,L),E.moveTo(I.x,I.y),E.lineTo(L.x,L.y),E.stroke()}},{key:"spawnTrailNodes",value:function(){var n,w=L(this.trailNodes);try{for(w.s();!(n=w.n()).done;){var k=n.value,C=new e4(this.node.worldPosition.x,this.node.worldPosition.y),E=new oU(C,k);this.trailNodeInstances.push(E)}}catch(n){w.e(n)}finally{w.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),u}(eL)).prototype,"target",[oI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oz=n(oM.prototype,"graphics",[oO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oB=n(oM.prototype,"trailNodes",[oL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oD=oM))||oD);ew._RF.pop(),ew._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var ss,sl=eS.ccclass,su=eS.executionOrder,sc=eS.property,sp=GameCore.Utils.Function,sd="Batch By Name",sy="Batch Label",sf="Batch Sprite",sv=(oH=sl("BatchNodes"),oV=su(99999),oq=sc({group:{name:sd}}),oW=sc({type:[eD],group:{name:sd}}),oK=sc({type:[e3],group:{name:sd}}),oj=sc({group:{name:sy}}),oY=sc({group:{name:sy}}),oX=sc({group:{name:sy}}),oZ=sc({group:{name:sf}}),oJ=sc({group:{name:sf}}),oQ=sc({readonly:!0}),o$=sc({readonly:!0}),o0=sc({readonly:!0}),oH(o1=oV((o4=n((o2=function(n){w(u,n);var I=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"batchByName",o4,_(n)),E(n,"depthNames",o3,_(n)),E(n,"listName",o5,_(n)),E(n,"batchLabel",o6,_(n)),E(n,"depthLabel",o8,_(n)),E(n,"typeLabel",o9,_(n)),E(n,"batchSprite",o7,_(n)),E(n,"depthSprite",se,_(n)),E(n,"batchAllNodes",st,_(n)),E(n,"batchDepth",sn,_(n)),E(n,"checkOverlap",si,_(n)),n.batchNode={},n.labelChildren=[],n.spriteChildren=[],n.allChildren=[],n.nameChildren=[],n.originalParents={},n.isInited=!1,n.handleNodeChange=sp.throttle(function(){n.isInited&&(console.warn("handleNodeChange",n.node.name),n.setupBatchNodes(n.node))},1e3),n.onAfterUpdate=function(){n.isInited&&n.hierarchyChildren()},n.onAfterRender=function(){n.isInited&&n.restoreOriginalChildren()},n}return T(u,[{key:"__preload",value:function(){this.enabled&&(eO.on(e5.EVENT_AFTER_UPDATE,this.onAfterUpdate),eO.on(e5.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){eO.off(e5.EVENT_AFTER_UPDATE,this.onAfterUpdate),eO.off(e5.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){this.isInited||(eO.on(e5.EVENT_AFTER_UPDATE,this.onAfterUpdate),eO.on(e5.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"handleActiveChange",value:function(n){n.once(ek.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.handleNodeChange)}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),eO.off(e5.EVENT_AFTER_UPDATE,this.onAfterUpdate),eO.off(e5.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(n){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(n),this.createGlobalNodes(n),this.createGlobalNameNodes(n),this.createGlobalLabelNode(n),this.createGlobalSpriteNode(n),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var n,w,k,C=this;null===(n=this.batchNode.node)||void 0===n||n.setSiblingIndex(0),null===(w=this.batchNode.label)||void 0===w||w.setSiblingIndex(this.depthLabel),null===(k=this.batchNode.sprite)||void 0===k||k.setSiblingIndex(this.depthSprite),this.listName.forEach(function(n,w){var k,E=C.depthNames[w];void 0!==E?null===(k=C.batchNode[n])||void 0===k||k.setSiblingIndex(E):console.warn("BatchNodes: depth is undefined",n,w,E)})}},{key:"createGlobalNodes",value:function(n){if(this.batchAllNodes){var w=new ek("GlobalBatchNode");w.active=!0,this.batchNode.node=w,n.addChild(w)}}},{key:"createGlobalNameNodes",value:function(n){if(this.batchByName){var w,k=L(this.listName);try{for(k.s();!(w=k.n()).done;){var C=w.value;if(!this.batchNode[C]){var E=new ek(C);E.active=!0,this.batchNode[C]=E,n.addChild(E)}}}catch(n){k.e(n)}finally{k.f()}}}},{key:"createGlobalLabelNode",value:function(n){if(this.batchLabel){var w=new ek("GlobalLabelNode");w.active=!0,this.batchNode.label=w,n.addChild(w)}}},{key:"createGlobalSpriteNode",value:function(n){if(this.batchSprite){var w=new ek("GlobalSpriteNode");w.active=!0,this.batchNode.sprite=w,n.addChild(w)}}},{key:"saveOriginalParents",value:function(){var n,w=[].concat(Y(this.labelChildren),Y(this.spriteChildren)),k=this.nameChildren,C=L(w);try{for(C.s();!(n=C.n()).done;){var E=n.value;E.node.parent&&(this.handleActiveChange(E.node),this.originalParents[E.uuid]=E.node.parent)}}catch(n){C.e(n)}finally{C.f()}var _,T=L(k);try{for(T.s();!(_=T.n()).done;){var I=_.value;I.parent&&(this.handleActiveChange(I),this.originalParents[I.uuid]=I.parent)}}catch(n){T.e(n)}finally{T.f()}}},{key:"saveOriginalChildren",value:function(n){var w,k=n.children,C=L(k);try{for(C.s();!(w=C.n()).done;){var E=w.value;this.saveLabelChildren(E),this.saveSpriteChildren(E),this.saveNodeChildrenByName(E),this.saveNodeChildrenByType(E)}}catch(n){C.e(n)}finally{C.f()}this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(n){var w;if(this.batchLabel){var k=n.getComponentsInChildren(eT);"char"===this.typeLabel&&(k=k.filter(function(n){return n.cacheMode===eT.CacheMode.CHAR})),0!==k.length&&(w=this.labelChildren).push.apply(w,Y(k))}}},{key:"saveSpriteChildren",value:function(n){var w;if(this.batchSprite){var k=n.getComponentsInChildren(ex);0!==k.length&&(w=this.spriteChildren).push.apply(w,Y(k))}}},{key:"saveNodeChildrenByName",value:function(n){if(this.batchByName){var w,k=L(n.children);try{for(k.s();!(w=k.n()).done;){var C=w.value;this.listName.includes(C.name)?this.nameChildren.push(C):this.saveNodeChildrenByName(C)}}catch(n){k.e(n)}finally{k.f()}}}},{key:"saveNodeChildrenByType",value:function(n,w){var k,C=arguments.length>1&&void 0!==w?w:0;if(this.batchAllNodes){var E=n.getComponentsInChildren(eL);if((k=this.allChildren).push.apply(k,Y(E)),!(this.batchDepth<1||C>=this.batchDepth)){var _,T=L(this.allChildren);try{for(T.s();!(_=T.n()).done;){var I=_.value;this.saveNodeChildrenByType(I.node,this.batchDepth)}}catch(n){T.e(n)}finally{T.f()}}}}},{key:"hierarchyChildren",value:function(){var n,t=function(n,w){n.node.isValid&&n.node.activeInHierarchy&&w&&!n.node.isChildOf(w)&&(n.node.setParent(w,!0),n.node.layer=e6.Enum.UI_2D)},w=["GlobalLabelNode","GlobalSpriteNode","GlobalBatchNode"],k=L(this.labelChildren);try{for(k.s();!(n=k.n()).done;)t(n.value,this.batchNode.label)}catch(n){k.e(n)}finally{k.f()}var C,E=L(this.spriteChildren);try{for(E.s();!(C=E.n()).done;)t(C.value,this.batchNode.sprite)}catch(n){E.e(n)}finally{E.f()}var _,T=L(this.allChildren);try{for(T.s();!(_=T.n()).done;)t(_.value,this.batchNode.node)}catch(n){T.e(n)}finally{T.f()}this.allChildren.sort(function(n,w){return n.constructor.name.localeCompare(w.constructor.name)}),this.labelChildren.sort(function(n,w){return n.cacheMode-w.cacheMode});var I,D=L(this.nameChildren);try{for(D.s();!(I=D.n()).done;){var M=I.value;if(M.isValid&&M.activeInHierarchy&&M.isTransformDirty()){var N=M.getComponent(eH);if(!(N&&N.opacity<1||w.includes(M.name))){var z=this.batchNode[M.name];z&&(M.isChildOf(z)||(M.setParent(z,!0),M.layer=e6.Enum.UI_2D))}}}}catch(n){D.e(n)}finally{D.f()}}},{key:"restoreOriginalChildren",value:function(){var n=[].concat(Y(this.labelChildren),Y(this.spriteChildren));if(n.length>0){var w,k=L(n);try{for(k.s();!(w=k.n()).done;){var C=w.value,E=this.originalParents[C.uuid];E&&(C.node.isChildOf(E)||C.node.setParent(E,!0))}}catch(n){k.e(n)}finally{k.f()}}var _,T=L(this.nameChildren);try{for(T.s();!(_=T.n()).done;){var I=_.value,D=this.originalParents[I.uuid];D&&(I.isChildOf(D)||I.setParent(D,!0))}}catch(n){T.e(n)}finally{T.f()}}}]),u}(eL)).prototype,"batchByName",[oq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),o3=n(o2.prototype,"depthNames",[oW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),o5=n(o2.prototype,"listName",[oK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),o6=n(o2.prototype,"batchLabel",[oj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),o8=n(o2.prototype,"depthLabel",[oY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),o9=n(o2.prototype,"typeLabel",[oX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),o7=n(o2.prototype,"batchSprite",[oZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),se=n(o2.prototype,"depthSprite",[oJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),st=n(o2.prototype,"batchAllNodes",[oQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sn=n(o2.prototype,"batchDepth",[o$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),si=n(o2.prototype,"checkOverlap",[o0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),o1=o2))||o1)||o1);ew._RF.pop(),ew._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var sg=eS.ccclass,sm=GameCore.Utils.Browser,sb=globalThis.game.player,sw=sg("Vibrate")(ss=function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"vibrate",value:function(n){if(this.isVibrateEnable()&&!sm.vibrate(n)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!sb.getPlayerSetting("vibrate")}}]),o}(eL))||ss;ew._RF.pop(),ew._RF.push({},"21fbd1aIo9DNoKfAoZaF1DC","WidgetCanvasTarget",void 0);var sS;(0,eS.ccclass)("WidgetCanvasTarget")(function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"__preload",value:function(){var n=this.getComponent(eN);if(n){var w=e8("Canvas");w&&(n.target=w)}}}]),o}(eL));ew._RF.pop(),ew._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var sk=10,sC=20,sE=100,s_=(X(sS={},Z.HINT,80),X(sS,Z.THUNDER,200),X(sS,Z.STORM,150),X(sS,Z.PLIERS,150),sS),sA=2e3,sT=300;ew._RF.pop(),ew._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var sP={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};ew._RF.pop(),ew._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var sR=function(n){return n.UNLOCK_DEV_TOOLS="unlock-dev-tools",n.TRIGGER_UNLOCK_KEY="trigger-unlock-key",n.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",n}(sR||{}),sI={Events:sR,UNLOCK_SEQUENCE:"101013012031"};ew._RF.pop(),ew._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var sO=function(n){return n.RELOAD_TOURNAMENT="reload-tournament",n}(sO||{});ew._RF.pop(),ew._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var sL=function(n){w(o,n);var E=k(o);function o(n,w){var k;return C(this,o),(k=E.call(this,w)).code=n,k}return T(o)}(J(Error));ew._RF.pop(),ew._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var sD=function(n){w(o,n);var E=k(o);function o(n,w){var k;return C(this,o),(k=E.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=n,k.tournamentId=w,k}return T(o)}(sL);ew._RF.pop(),ew._RF.push({},"e80e4nIcfdLN56j5b9SMhvH","LeaderboardUtils",void 0);var sM=globalThis.game.leaderboard,sN=function(){function e(){C(this,e)}var n,w,k;return T(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getAllLeaderboardAsync",value:(k=N(function(n){var w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:if(!sM)return[2,null];return[4,sM.getLeaderboardResponseAsync(n)];case 1:w=E.sent();if(!w)return[2,null];k=sM.getLeaderboardName(n);if(!k)return[3,3];return[4,this.requestLeaderboardAsync(k,w.amountPlayer)];case 2:C=(E.sent(),sM.getLeaderboard(k));return[3,4];case 3:C=null;E.label=4;case 4:return[2,C]}})}),function(n){return k.apply(this,arguments)})},{key:"requestLeaderboardAsync",value:(w=N(function(n,w){return _ts_generator(this,function(k){switch(k.label){case 0:if(!this.isLeaderboardRequesting(n))return[3,2];return[4,this.waitForLeaderboardFinishAsync(n)];case 1:k.sent();return[3,4];case 2:return[4,sM.requestLeaderboardAsync(n,w)];case 3:k.sent();k.label=4;case 4:return[2]}})}),function(n,k){return w.apply(this,arguments)})},{key:"waitForLeaderboardFinishAsync",value:(n=N(function(n){var w;return _ts_generator(this,function(k){w=this;if(this.isLeaderboardRequesting(n))return[2,new Promise(function(k){var C=setInterval(function(){w.isLeaderboardRequesting(n)||(clearInterval(C),k())},100)})];return[2]})}),function(w){return n.apply(this,arguments)})},{key:"isLeaderboardRequesting",value:function(n){var w;return(null===(w=sM.getLeaderboard(n))||void 0===w?void 0:w.isRequesting)||!1}}]),e}();try{new sN}catch(n){console.error("LeaderboardUtils",n)}ew._RF.pop(),ew._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var sz={mapOrder:[{id:1,theme:"summer",skins:["fruit"],levelCount:10},{id:2,theme:"autumn",skins:["flower"],levelCount:10},{id:3,theme:"winter",skins:["tool"],levelCount:10},{id:4,theme:"summer",skins:["sport"],levelCount:10},{id:5,theme:"autumn",skins:["cosmetics"],levelCount:10},{id:6,theme:"winter",skins:["ice-cream"],levelCount:10},{id:7,theme:"summer",skins:["cakes"],levelCount:10},{id:8,theme:"autumn",skins:["car"],levelCount:10},{id:9,theme:"spring-festival",skins:["flower","ice-cream"],levelCount:10},{id:10,theme:"tree-planting-festival",skins:["fruit","car","tool"],levelCount:10},{id:11,theme:"blue-sea-festival",skins:["sport","fruit"],levelCount:10},{id:12,theme:"music-festival",skins:["cakes","car","cosmetics"],levelCount:10},{id:13,theme:"harvest-festival",skins:["fruit","car","tool"],levelCount:10},{id:14,theme:"food-festival",skins:["cakes","ice-cream","cosmetics"],levelCount:10},{id:15,theme:"snow-festival",skins:["cakes","sport"],levelCount:10},{id:16,theme:"light-festival",skins:["ice-cream","car"],levelCount:10},{id:17,theme:"peace-festival",skins:["flower","sport","tool"],levelCount:10},{id:18,theme:"flower-festival",skins:["flower","fruit"],levelCount:10},{id:19,theme:"street-festival",skins:["fruit","ice-cream","sport"],levelCount:10},{id:20,theme:"color-garden",skins:["cakes","cosmetics","tool"],levelCount:10},{id:21,theme:"color-festival",skins:["flower","cakes","fruit"],levelCount:10},{id:22,theme:"nature-summer",skins:["flower","sport"],levelCount:10},{id:23,theme:"snow-mountain",skins:["cakes","ice-cream"],levelCount:10},{id:24,theme:"ice-festival",skins:["ice-cream","cosmetics"],levelCount:10},{id:25,theme:"green-grass-festival",skins:["flower","sport","tool"],levelCount:10},{id:26,theme:"community-festival",skins:["cosmetics","cakes","ice-cream"],levelCount:10},{id:27,theme:"water-festival",skins:["sport","ice-cream","flower"],levelCount:10},{id:28,theme:"animal-festival",skins:["flower","fruit","cakes"],levelCount:10},{id:29,theme:"lost-festival",skins:["sport","tool","car"],levelCount:10},{id:30,theme:"halloween-festival",skins:["cakes","car","fruit"],levelCount:10},{id:31,theme:"snow-music-festival",skins:["ice-cream","sport","tool"],levelCount:10},{id:32,theme:"christmas",skins:["cakes","flower","sport"],levelCount:10},{id:33,theme:"spring-flower-festival",skins:["flower","fruit"],levelCount:10},{id:34,theme:"tet-holiday",skins:["flower","cosmetics","fruit"],levelCount:10},{id:35,theme:"sea-festival",skins:["ice-cream","sport"],levelCount:10},{id:36,theme:"firework-festival",skins:["cosmetics","car","tool"],levelCount:10},{id:37,theme:"halloween-horror",skins:["cakes","car","fruit"],levelCount:10},{id:38,theme:"mid-autumn",skins:["flower","fruit","ice-cream"],levelCount:10},{id:39,theme:"christmas-sweet",skins:["cakes","flower","sport"],levelCount:10},{id:40,theme:"new-year-countdown",skins:["cosmetics","car","tool"],levelCount:10}]};ew._RF.pop(),ew._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var sB=globalThis.game,sF=sB.player,sx=sB.storage,sU=sz.mapOrder.map(function(n){return{skins:n.skins,themeId:n.theme,currentProgress:0,maxProgress:n.levelCount,isLocked:!0}}),sG=function(){function e(){C(this,e),this.playerSkinProgress=sU.map(function(n){return I({},n)})}return T(e,[{key:"initDashboardSceneStorage",value:function(){var n=sx.getStorage("dashboard");if(null==n){var w=this.getCurrentMapProgressInstance();sx.addStorage("dashboard",{lastMapPayload:w,numOfMapsPassed:0,animateToCurrentLevel:!1});var k=sx.getStorage("collection");if(null==k){sx.addStorage("collection",{lastMapPack:w.id,animateMapPackUnlock:!1});var C=sx.getStorage("leaderboard_content");if(null==C){sx.addStorage("leaderboard_content",{lastTabOpened:"global",previousScore:-1});var E=sx.getStorage("tournament");null==E&&sx.addStorage("tournament",{animateTournamentLeader:!1,previousScore:-1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){for(var n=void 0,w=void 0,k=0,C=0,E=0,_=0,T=sz.mapOrder.length;_<T;_++){var I=this.playerSkinProgress[_],L=sz.mapOrder[_],D=sz.mapOrder[_+1];if(I.currentProgress<I.maxProgress){var M;E=L.id,n=L.theme,w=null!==(M=null==D?void 0:D.theme)&&void 0!==M?M:n,k=I.currentProgress,C=I.maxProgress;break}}if(void 0===n||void 0===w){var N=sz.mapOrder[sz.mapOrder.length-1];return{id:E=N.id,currentTheme:n=N.theme,nextTheme:w=N.theme,progress:k=N.levelCount,max:C=N.levelCount}}return{id:E,currentTheme:n,nextTheme:w,progress:k,max:C}}},{key:"getUnlockedSkinsInstance",value:function(){var n,w=[],k=L(this.playerSkinProgress);try{for(k.s();!(n=k.n()).done;){var C=n.value;if(!C.isLocked&&1===C.skins.length){var E=C.skins[0];E&&w.push(E)}}}catch(n){k.e(n)}finally{k.f()}return w}},{key:"getLevelSkinsInstance",value:function(n){var w,k=null!=n?n:1,C=0,E=L(sz.mapOrder);try{for(E.s();!(w=E.n()).done;){var _=w.value;if(C+_.levelCount>=k)return _.skins;C+=_.levelCount}}catch(n){E.e(n)}finally{E.f()}return sz.mapOrder[sz.mapOrder.length-1].skins}},{key:"getLevelThemeInstance",value:function(n){var w,k=null!=n?n:1,C=0,E=L(sz.mapOrder);try{for(E.s();!(w=E.n()).done;){var _=w.value;if(C+_.levelCount>=k)return _.theme;C+=_.levelCount}}catch(n){E.e(n)}finally{E.f()}return sz.mapOrder[sz.mapOrder.length-1].theme}},{key:"getThemeSkinsInstance",value:function(n){var w,k=L(sz.mapOrder);try{for(k.s();!(w=k.n()).done;){var C=w.value;if(C.theme===n)return C.skins}}catch(n){k.e(n)}finally{k.f()}return[]}},{key:"getCollectionUnlockProgressInstance",value:function(){var n,w=[],k=L(this.playerSkinProgress);try{for(k.s();!(n=k.n()).done;){var C=n.value;w.push({skins:C.skins,theme:C.themeId,progress:C.currentProgress,max:C.maxProgress,isLocked:C.isLocked})}}catch(n){k.e(n)}finally{k.f()}return w}},{key:"updatePlayerSkinProgress",value:function(){var n,w=sF.getGameData(),k=(null!==(n=null==w?void 0:w.level)&&void 0!==n?n:1)-1;this.playerSkinProgress[0].isLocked=!1;for(var C=0,E=sz.mapOrder.length;C<E;C++){var _=sz.mapOrder[C];if(!(k<=0)){var T=k-_.levelCount>=0?_.levelCount:k;k-=T,this.increaseProgress(C,T)}}}},{key:"increaseProgress",value:function(n,w){if(n<0||n>=this.playerSkinProgress.length)throw new Error("increaseProgress: index out of range");var k,C=this.playerSkinProgress[n],E=C.currentProgress,_=C.maxProgress,T=E+w>_?_:E+w;T>0&&(C.isLocked=!1),T===_&&(null===(k=sz.mapOrder[n+1])||void 0===k?void 0:k.skins)&&(this.playerSkinProgress[n+1].isLocked=!1);C.currentProgress=T,C.maxProgress=_}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var n=this.getInstance();n.updatePlayerSkinProgress(),n.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkins",value:function(n){return this.getInstance().getLevelSkinsInstance(n)}},{key:"getLevelTheme",value:function(n){return this.getInstance().getLevelThemeInstance(n)}},{key:"getThemeSkins",value:function(n){return this.getInstance().getThemeSkinsInstance(n)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"getCurrentUnlockingThemeIndex",value:function(){var n=this.getCollectionUnlockProgress();if(0===n.length)return null;var w=0;return n.forEach(function(n,k){n.isLocked||(w=k)}),w}}]),e}();ew._RF.pop(),ew._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var sH=globalThis.game,sV=sH.match,sq=sH.player,sW=sH.leaderboard,sK=sH.frameCapture,sj=GameCore,sY=sj.Utils,sX=sY.Object,sZ=sY.Valid,sJ=sY.String,sQ=sY.Array,s$=sj.Match.Modes,s0=sj.Dtos.Match.Data,s1=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],s2=function(){function e(){C(this,e)}var n,w,k,E,_,I,D,M,z,B,F,x,U,G,H,V,q,W,K;return T(e,[{key:"processStartSingleModeAsync",value:(K=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:n=sq.getPlayerId();return[4,sV.single.start.processAsync({playerId:n})];case 1:w.sent();return[2]}})}),function(){return K.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(W=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,sV.single.finish.processAsync()];case 1:n.sent();return[2]}})}),function(){return W.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(q=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:n=sq.getPlayerId(),w=GameSDK.context.getID();return[4,sV.tournament.continue.processAsync({playerId:n,contextId:w})];case 1:k.sent();return[2]}})}),function(){return q.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(V=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:n=sq.getPlayerId(),w=sq.getBestScore();return[4,sV.tournament.finish.processAsync({playerId:n,bestScore:w})];case 1:k.sent();return[2]}})}),function(){return V.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(H=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,2,,7]);return[4,this.processContinueChallengeAsync()];case 1:C.sent();return[3,7];case 2:n=C.sent();if(!sX.hasOwn(n,"name")||sZ.isString(n.name))throw n;w="PlayerHasFinishedMatch"===n.name;if(!w)return[3,4];return[4,this.processChallengeNewOpponentAsync()];case 3:w=C.sent();C.label=4;case 4:k="PlayerNotJoinInMatch"===n.name;if(!k)return[3,6];return[4,this.processJoinChallengeAsync()];case 5:k=C.sent();C.label=6;case 6:return[3,7];case 7:return[2]}})}),function(){return H.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(G=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:sK.addWideframeRender("renderResultChallenge",sK.wideframe.renderResultChallenge);return[4,sV.challenge.finish.processAsync(n)];case 1:w.sent();return[2]}})}),function(n){return G.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(U=N(function(){var n,w,k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:n=this.getMatchState(),w=n.id,k=n.customData,C=k.playerId,E=k.opponentId;if(!sZ.isString(w))throw new Error("Invalid match id");if(!sZ.isString(C))throw new Error("Invalid player id");if(!sZ.isString(E))throw new Error("Invalid opponent id");_=GameSDK.context.getID();if(!_)throw new Error("Cannot get contextId");return[4,sV.challenge.continue.processAsync({matchId:w,contextId:_,playerId:C,opponentId:E})];case 1:T.sent();return[2]}})}),function(){return U.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(x=N(function(){var n,w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:n=sq.getConnectedPlayerIds(100,0),w=Math.floor(Math.random()*n.length),k=sq.getPlayerId(),C=n[w];return[4,sV.challenge.friend.processAsync({playerId:k,opponentId:C})];case 1:E.sent();return[2]}})}),function(){return x.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(F=N(function(){var n,w,k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:n=this.getMatchState(),w=n.id,k=n.customData,C=k.playerId,E=k.opponentId;if(!sZ.isString(w))throw new Error("Invalid match id");if(!sZ.isString(C))throw new Error("Invalid player id");if(!sZ.isString(E))throw new Error("Invalid opponent id");return[4,sV.challenge.join.processAsync({matchId:w,playerId:C,opponentId:E})];case 1:_.sent();return[2]}})}),function(){return F.apply(this,arguments)})},{key:"getMatchState",value:function(){var n=sV.getMatchState();if(!n)throw new Error("Match state not found");return n}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(B=N(function(n){var w,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,10,,11]);w=null!=n?n:this.getMatchMode();switch(w){case s$.SINGLE:return[3,1];case s$.TOURNAMENT:return[3,3];case s$.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processStartSingleModeAsync()];case 2:C.sent();return[3,9];case 3:return[4,this.inst.processStartTournamentModeAsync()];case 4:C.sent();return[3,9];case 5:return[4,this.inst.processStartChallengeModeAsync()];case 6:C.sent();return[3,9];case 7:return[4,this.inst.processStartSingleModeAsync()];case 8:C.sent();C.label=9;case 9:return[3,11];case 10:k=C.sent();console.warn("startMatchAsync",k);return[3,11];case 11:return[2]}})}),function(n){return B.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(z=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,3]);return[4,sV.handler.setProfileData(n)];case 1:k.sent();return[3,3];case 2:w=k.sent();console.warn("setProfileMatchDataAsync",w);return[3,3];case 3:return[2]}})}),function(n){return z.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(M=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,3]);return[4,sV.handler.setMatchCustomData(n)];case 1:k.sent();return[3,3];case 2:w=k.sent();console.warn("setMatchCustomDataAsync",w);return[3,3];case 3:return[2]}})}),function(n){return M.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(D=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,3]);return[4,sV.handler.setLeaderboardScore(n)];case 1:k.sent();return[3,3];case 2:w=k.sent();console.warn("setLeaderboardScoreAsync",w);return[3,3];case 3:return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"finishMatchAsync",value:(I=N(function(n){var w,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,10,,11]);w=this.getMatchMode();switch(w){case s$.SINGLE:return[3,1];case s$.TOURNAMENT:return[3,3];case s$.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processFinishSingleModeAsync()];case 2:C.sent();return[3,9];case 3:return[4,this.inst.processFinishTournamentModeAsync()];case 4:C.sent();return[3,9];case 5:return[4,this.inst.processFinishChallengeModeAsync(n)];case 6:C.sent();return[3,9];case 7:return[4,this.inst.processFinishSingleModeAsync()];case 8:C.sent();C.label=9;case 9:return[3,11];case 10:k=C.sent();console.warn("finishMatchAsync",k);return[3,11];case 11:return[2]}})}),function(n){return I.apply(this,arguments)})},{key:"joinTournamentAsync",value:(_=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=sq.getPlayerId();return[4,sV.tournament.join.processAsync({tournamentId:n,playerId:w})];case 1:k.sent();return[2]}})}),function(n){return _.apply(this,arguments)})},{key:"continueTournamentAsync",value:(E=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=sq.getPlayerId();return[4,sV.tournament.continue.processAsync({playerId:w,contextId:n})];case 1:k.sent();return[2]}})}),function(n){return E.apply(this,arguments)})},{key:"createTournamentName",value:function(){var n=s1[e0.randomRangeInt(0,s1.length-1)],w="".concat(n," Tournament"),k=sJ.removeDiacritics(w);return"".concat(k)}},{key:"getShortName",value:function(n,w){var k,C=arguments.length>1&&void 0!==w?w:50,E=n.split(" "),_=0,T="",I=L(E);try{for(I.s();!(k=I.n()).done;){var D=k.value;if(_+D.length+1>C)break;T+="".concat(D," "),_+=D.length+1}}catch(n){I.e(n)}finally{I.f()}return T.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var n,w,k,C=sJ.generateObjectId(),E=sq.getPlayerId(),_=sq.getPlayer().name,T=sq.getGameData(),I=null!==(n=null==T?void 0:T.level)&&void 0!==n?n:1,L=sG.getLevelTheme(I),D=this.inst.getMatchState().profiles;return{score:null!==(w=null===(k=(void 0===D?{}:D)[E])||void 0===k?void 0:k.score)&&void 0!==w?w:0,playerId:E,mode:s$.TOURNAMENT,name:this.createTournamentName(),leaderboardId:C,payload:{playerId:E,playerName:_,leaderboardId:C,themeId:L}}}},{key:"getTournamentsAsync",value:(k=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,2,,3]);return[4,GameSDK.tournament.getTournamentsAsync()];case 1:return[2,w.sent()];case 2:n=w.sent();return[2,(console.error(n),[])];case 3:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(w=N(function(){var n,w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:return[4,this.getTournamentsAsync()];case 1:n=E.sent(),w=sQ.search(n,function(n){var w,k=JSON.parse(null!==(w=n.getPayload())&&void 0!==w?w:"{}");return"DEFAULT"===n.getTournamentType()&&k.playerId===sq.getPlayerId()});if(w)throw new sD(sq.getPlayerId(),w.getID());k=this.createTournamentPayload();sq.setGameData({lastCreateTournamentShown:Date.now()});return[4,sV.tournament.create.processAsync(k)];case 2:E.sent();C=k.leaderboardId;sW.addLeaderboard({name:C,type:"tournament",autoSortRank:!0,leaderboardId:C});return[2]}})}),function(){return w.apply(this,arguments)})},{key:"getMatchMode",value:function(){var n=this.inst.getMatchState();return sZ.isString(n.mode)?n.mode:null}},{key:"getMatchCustomData",value:function(){var n=this.inst.getMatchState();return sZ.isObject(n.customData)?n.customData:null}},{key:"getMatchExtraDataAsync",value:(n=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,sV.api.getMatchAPI().getMatchDetailByIdAsync(n)];case 1:w=k.sent();return[2,new s0(w).toObject().extraData]}})}),function(w){return n.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(n,w){this.setMatchCustomDataAsync({level:n,score:w});var k=sq.getPlayerId();this.setProfileMatchDataAsync({id:k,score:w})}}]),e}();ew._RF.pop(),ew._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var s4,s3="time",s5="bomb";ew._RF.pop(),ew._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var s6,s8=(0,eS.ccclass)("InputController")(s4=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).handleElementPointerDown=function(){},n.handleElementPointerUp=function(n){},n}return T(o,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){eZ.os!==eZ.OS.WINDOWS&&eZ.os!==eZ.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){eZ.os!==eZ.OS.WINDOWS&&eZ.os!==eZ.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),o}(eL))||s4;ew._RF.pop(),ew._RF.push({},"ed5c6D+6KVEj5lrgtq+D9bJ","LayoutUtils",void 0);var s9=W.Layout,s7=function(){function e(){C(this,e),this.currentLayout="",eY.off(q.LAYOUT_CHANGED,e.onLayoutChanged),eY.on(q.LAYOUT_CHANGED,e.onLayoutChanged)}return T(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getCurrentLayout",value:function(){return this.inst.currentLayout}},{key:"isPortrait",value:function(){return this.inst.currentLayout===s9.Portrait}},{key:"isLandscape",value:function(){return this.inst.currentLayout===s9.Landscape}}]),e}();s6=s7,s7.onLayoutChanged=function(n){s6.inst.currentLayout!==n&&(s6.inst.currentLayout=n,eY.emit(q.ORIENTATION_CHANGED,n))};try{new s7}catch(n){console.error("LayoutUtils",n)}ew._RF.pop(),ew._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var le={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};ew._RF.pop(),ew._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var lt="fall-down",ln="fly-up",li="push-left",lr="push-right",la="put-column-middle",lo="put-row-middle";function iu(n){for(var w=n.array,k=n.isLighter,C=n.out,E=void 0===C?new Set:C,_=0;_<w.length;_++)if(k(w.get(_))){for(var T=_+1;T<w.length;T++)if(!k(w.get(T))){w.swap(_,T),E.add(w.get(_));break}}return E}ew._RF.pop(),ew._RF.push({},"bfb989Gr/dArq4M9uSSrF5/","stagger",void 0),ew._RF.pop(),ew._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var ls,ll,lu,lp,ld,ly,lf,lv,lg,lm,lb,lw,lS,lk,lC,lE,l_,lA,lT,lP,lR,lI,lO,lL,lD,lM,lN,lz,lB,lF,lx,lU,lG,lH,lV,lq,lW,lK,lj,lY,lX,lZ,lJ,lQ,l$,l0,l1,l2=function(){function e(n){var w;C(this,e),this.array=[];var k=null!=n?n:{},E=k.width,_=void 0===E?1:E,T=k.height,I=void 0===T?1:T,L=_instanceof(n,e)?n.array:null!==(w=null==n?void 0:n.content)&&void 0!==w?w:[];if(L.length!==_*I)throw new Error("Invalid content length");this.width=_,this.height=I,this.array=Y(L)}return T(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(n,w){if(!this.isInBounds(n,w))throw new Error("Out of bounds");return this.array[w*this.width+n]}},{key:"set",value:function(n,w,k){this.array[w*this.width+n]=k}},{key:"isInBounds",value:function(n,w){return n>=0&&n<this.width&&w>=0&&w<this.height}},{key:"forEach",value:function(n){for(var w=0;w<this.height;w++)for(var k=0;k<this.width;k++)n(this.get(k,w),k,w)}},{key:"map",value:function(n){for(var w=[],k=0;k<this.height;k++)for(var C=0;C<this.width;C++)w.push(n(this.get(C,k),C,k));return w}},{key:"reduce",value:function(n,w){for(var k=w,C=0;C<this.height;C++)for(var E=0;E<this.width;E++)k=n(k,this.get(E,C),E,C);return k}},{key:"swap",value:function(n,w){var k=Q(n,2),C=k[0],E=k[1],_=Q(w,2),T=_[0],I=_[1],L=this.get(C,E);this.set(C,E,this.get(T,I)),this.set(T,I,L)}},{key:"shuffle",value:function(n){for(var w=null!=n?n:this.map(function(n,w,k){return[w,k]}),k=Y(w),C=new Set,E=k.length-1;E>0;E--){var _=e9(0,E+1),T=k[E],I=k[_];k[E]=I,k[_]=T,C.add(this.get(T[0],T[1])),C.add(this.get(I[0],I[1]))}for(var L=0;L<k.length;L++){var D=w[L],M=Q(D,2),N=M[0],z=M[1],B=k[L],F=Q(B,2),x=F[0],U=F[1];this.swap([N,z],[x,U])}return C}},{key:"toShuffled",value:function(n){var w=new e({width:this.width,height:this.height,content:this.array}),k=w.shuffle(n);return[w,k]}},{key:"gravitate",value:function(n){var w=this,k=Q(n.rowRange,2),C=k[0],E=k[1],_=Q(n.colRange,2),T=_[0],I=_[1],L=n.direction,D=n.isLighter,M=n.onSwap,N=n.out,z=void 0===N?new Set:N,B=I-T+1,F=E-C+1;switch(L){case le.Up:for(var v=function(n){iu({array:{length:F,get:function(k){return w.get(n,E-k)},swap:function(k,C){var _=w.get(n,E-k),T=w.get(n,E-C);w.swap([n,E-k],[n,E-C]),null==M||M(_,T)}},isLighter:D,out:z})},x=T;x<=I;x++)v(x);return z;case le.Down:for(var g=function(n){iu({array:{length:F,get:function(k){return w.get(n,C+k)},swap:function(k,E){var _=w.get(n,C+k),T=w.get(n,C+E);w.swap([n,C+k],[n,C+E]),null==M||M(_,T)}},isLighter:D,out:z})},U=T;U<=I;U++)g(U);return z;case le.Left:for(var b=function(n){iu({array:{length:B,get:function(k){return w.get(T+k,n)},swap:function(k,C){var E=w.get(T+k,n),_=w.get(T+C,n);w.swap([T+k,n],[T+C,n]),null==M||M(E,_)}},isLighter:D,out:z})},G=C;G<=E;G++)b(G);return z;case le.Right:for(var S=function(n){iu({array:{length:B,get:function(k){return w.get(I-k,n)},swap:function(k,C){var E=w.get(I-k,n),_=w.get(I-C,n);w.swap([I-k,n],[I-C,n]),null==M||M(E,_)}},isLighter:D,out:z})},H=C;H<=E;H++)S(H);return z;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var n=new e({width:this.width,height:this.height,content:this.array}),w=n.gravitate.apply(n,arguments);return[n,w]}},{key:"toRotated",value:function(){for(var n=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),w=0;w<this.height;w++)for(var k=0;k<this.width;k++)n.set(this.height-1-w,k,this.get(k,w));return n}}]),e}();ew._RF.pop(),ew._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),ew._RF.pop(),ew._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var l4=eS.ccclass,l3=eS.property,l5=eS.requireComponent,l6=(ls=l4("Tile"),ll=l5([e_]),lu=l5([eH]),lp=B.required,ld=l3({type:ex,group:"Sprite"}),ly=B.required,lf=l3({type:ex,group:"Sprite"}),lv=B.required,lg=l3({type:ex,group:"Sprite"}),lm=B.required,lb=l3({type:ex,group:"Sprite"}),lw=B.required,lS=l3({type:e_,displayName:"Background UI Transform"}),lk=B.required,lC=l3(e7),lE=B.required,l_=l3({type:eH,group:"Opacity"}),lA=B.required,lT=l3({type:eH,group:"Opacity"}),lP=B.required,lR=l3({type:eH,group:"Opacity"}),lI=B.required,lO=l3({type:eH,group:"Opacity"}),lL=B.required,lD=l3(ib),lM=B.required,lN=l3(te),lz=B.required,lB=l3(ek),lF=B.onlyRunInLifeCycle,lx=B.onlyRunInLifeCycleAsync,lU=B.onlyRunInLifeCycleAsync,ls(lG=ll(lG=lu((lV=n((lH=function(n){w(A,n);var I,L,D,M,U,G,V,q,W,K,j,Y=k(A);function A(){var n;C(this,A);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=Y.call.apply(Y,[this].concat(k)),E(n,"icon",lV,_(n)),E(n,"bombComponent",lq,_(n)),E(n,"starComponent",lW,_(n)),E(n,"background",lK,_(n)),E(n,"bgUITransform",lj,_(n)),E(n,"defaultBackground",lY,_(n)),E(n,"uiOpacity",lX,_(n)),E(n,"shineOpacity",lZ,_(n)),E(n,"glowOpacity",lJ,_(n)),E(n,"iconOpacity",lQ,_(n)),E(n,"button",l$,_(n)),E(n,"animationComponent",l0,_(n)),E(n,"container",l1,_(n)),n.clearClip=null,n.shakeClip=null,n.id=null,n.isEmpty=!1,n.coord=new e4,n.signal=new x,n}return T(A,[{key:"onLoad",value:function(){B.validateRequiredProperties(this,A),this.special=this.createSpecialHandler($.none)}},{key:"update",value:function(n){var w;(null===(w=this.special)||void 0===w?void 0:w.type)===$.bomb&&this.special.update(n)}},{key:"onDestroy",value:function(){var n,w;(null===(n=this.special)||void 0===n?void 0:n.type)===$.bomb&&(null===(w=this.special)||void 0===w||w.onDestroy())}},{key:"setIgnoreInput",value:function(n){var w=!(arguments.length>0&&void 0!==n)||n;this.button.interactable=!w}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(n,w){this.coord.set(n,w)}},{key:"isSimilarTo",value:function(n){return this.id===n.id}},{key:"inSamePositionAs",value:function(n,w){return _instanceof(n,A)?this.coord.equals(n.getCoord()):this.coord.x===n&&this.coord.y===w}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(i7.TILE_CLICK,this)}},{key:"setIdentity",value:function(n){this.id=n,this.icon.spriteFrame=n;var w=this.getSize(),k=Q(w,2),C=k[0],E=k[1],_=n.originalSize,T=_.width,I=_.height,L=Math.max(T/(.7*C),I/(.7*E));L>1&&this.icon.node.setScale(new eQ(1/L,1/L,1))}},{key:"setSpecialType",value:function(n,w){var k,C=arguments.length>0&&void 0!==n?n:$.none,E=arguments.length>1?w:void 0;null===(k=this.special)||void 0===k||k.switch(C,E)}},{key:"setFocused",value:(j=N(function(n){var w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:w=ez(this.shineOpacity).to(.15,{opacity:n?255:0},{easing:"cubicOut"});this.shineOpacity.node.scale=n?eQ.ZERO:eQ.ONE;k=ez(this.shineOpacity.node).to(.15,{scale:n?eQ.ONE:eQ.ZERO},{easing:"cubicOut"});if(n){C=ez(this.glowOpacity).to(2,{opacity:150});C.to(2,{opacity:20}),this.glowOpacityTween=ez(this.glowOpacity).repeatForever(C).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;return[4,Promise.all([z.runTweenAsync(w),z.runTweenAsync(k)])];case 1:E.sent();return[2]}})}),function(n){return j.apply(this,arguments)})},{key:"setEmpty",value:function(n){var w,k,C,E=arguments.length>0&&void 0!==n&&n;if(!this.isEmpty){var _;if(this.signal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),E)return this.setOpacity(0),void(null===(_=this.special)||void 0===_||_.switch($.none));(null===(w=this.special)||void 0===w?void 0:w.type)!==$.star&&(null===(k=this.special)||void 0===k?void 0:k.type)!==$.bomb||this.special.clear(),null===(C=this.special)||void 0===C||C.switch($.none),this.setOpacity(0)}}},{key:"setOpacity",value:function(n){this.uiOpacity.opacity=n}},{key:"setHint",value:(K=N(function(n){var w,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!n)return[3,2];return[4,this.getShakeClip()];case 1:if(!C.sent())return[2];this.shakeClip&&z.runAnimationAsync(this.animationComponent,this.shakeClip.name,this.signal);return[3,4];case 2:if(null===(w=this.animationComponent)||void 0===w||w.stop(),!this.container)return[3,4];k=ez(this.container).to(.1,{scale:eQ.ONE,eulerAngles:eQ.ZERO});return[4,z.runTweenAsync(k,this.signal)];case 3:C.sent();C.label=4;case 4:return[2]}})}),function(n){return K.apply(this,arguments)})},{key:"playClearFX",value:(W=N(function(n){var w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:this.signal.abort();w=new x;this.signal=w,this.setOpacity(255);return[4,this.getClearClip()];case 1:k=E.sent();C=w.aborted||null===k;if(C)return[3,3];return[4,this.runAnimationAfterDelay(k.name,n,w)];case 2:C=E.sent();E.label=3;case 3:this.setOpacity(0);return[2]}})}),function(n){return W.apply(this,arguments)})},{key:"runAnimationAfterDelay",value:(q=N(function(n,w,k){var C;return _ts_generator(this,function(E){switch(E.label){case 0:C=w;if(!C)return[3,2];return[4,z.waitTweenAsync(w,k)];case 1:C=E.sent();E.label=2;case 2:return[4,this.runAnimation(n,k)];case 3:E.sent();return[2]}})}),function(n,w,k){return q.apply(this,arguments)})},{key:"runAnimation",value:function(n,w){return z.runAnimationAsync(this.animationComponent,n,w)}},{key:"restore",value:(V=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:this.signal.abort();w=new x;this.signal=w,this.animationComponent.stop(),this.isEmpty=!1,this.setIgnoreInput(!0),n&&this.setIdentity(n),this.setOpacity(255),this.iconOpacity.opacity=255,this.node.setScale(eQ.ZERO),this.background.spriteFrame=this.defaultBackground,this.button.fakeClick();return[4,z.runTweenAsync(ez(this.node).to(.3,{scale:eQ.ONE},{easing:"backOut"}),w)];case 1:k.sent(),this.node.setScale(eQ.ONE),this.setIgnoreInput(!1);return[2]}})}),function(n){return V.apply(this,arguments)})},{key:"sync",value:(G=N(function(n){var w,k,C,E,_,T,I,L;return _ts_generator(this,function(D){switch(D.label){case 0:w=n.duration,k=void 0===w?.3:w,C=n.delay,E=void 0===C?0:C,_=n.easing,T=void 0===_?"cubicOut":_,I=(0,n.getTargetPosition)(this.coord),L=new eQ(I.x,I.y,this.node.position.z);return[4,z.runTweenAsync(ez(this.node).delay(E).to(k,{position:L},{easing:T}))];case 1:D.sent();return[2]}})}),function(n){return G.apply(this,arguments)})},{key:"fly",value:(U=N(function(n){var w,k,C,E,_,T,I,L,D,M,N,B,F,x,U,G,H,V;return _ts_generator(this,function(q){w=this,k=300,C=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),E=Math.max(k-.7*C,0),_=C/1e3,T=this.node.position.clone(),I=n.getTilePosition(this.coord),L=new eQ(I.x,I.y,this.node.position.z),D=this.background.node,M=2,N=1,B=360,F=.0025*E,x=0,U=new eQ(0,0,0),G=.75-F,H={value:0,prevElapsed:0},V=ez(H);return[2,(V.delay(_),V.to(.5,{value:0},{progress:function(n,k,C,E){var _=(M*=-1)*E,I=T.clone();return I.x+=_,w.node.setPosition(I),C}}),V.to(F,{value:1},{progress:function(n,C,_,T){var I=z.expoOut(T),L=F*T-H.prevElapsed,M=F*T,x=E*I;w.setHeight(x,k);var U=w.node.position.clone();N+=.1,eQ.rotateZ(U,U,new eQ(0,0,0),N*Math.PI*L),w.node.setPosition(new eQ(U.x,U.y,U.z));var G=(B+=10)*L;return D.angle+=G,H.prevElapsed=M,_}}),V.call(function(){U.set((w.node.position.x+L.x)/2,(w.node.position.y+L.y)/2,0),H.prevElapsed=0,D.angle%=360,D.angle-=360,x=D.angle}),V.to(G,{value:0},{progress:function(n,C,_,T){var I=G*T-H.prevElapsed,L=G*T,M=E*(1-T);w.setHeight(M,k);var N=w.node.position.clone();return eQ.rotateZ(N,N,U,Math.PI/G*I),w.node.setPosition(new eQ(N.x,N.y,N.z)),D.angle+=-x/G*I,H.prevElapsed=L,_}}),V.call(function(){w.node.setPosition(L),w.setHeight(0,k),D.angle=0}),z.runTweenAsync(V))]})}),function(n){return U.apply(this,arguments)})},{key:"moveAround",value:(M=N(function(){var n,w,k,C,E,_,T,I,L;return _ts_generator(this,function(D){switch(D.label){case 0:n=[{x:1,y:1},{x:-1,y:1},{x:-1,y:-1},{x:1,y:-1}],w=this.container.position.clone(),k=-1,C=0;D.label=1;case 1:if(!(C<5))return[3,4];for(E=e0.randomRangeInt(0,4);k===E;)E=e0.randomRangeInt(0,4);k=E;_=n[E];if(!_)return[3,3];T=w.clone().add(new eQ(5*_.x,5*_.y)),I=ez(this.container).to(.1,{position:T},{easing:"smooth"});return[4,z.runTweenAsync(I)];case 2:D.sent();D.label=3;case 3:C++;return[3,1];case 4:L=ez(this.container).to(.1,{position:w},{easing:"smooth"});return[4,z.runTweenAsync(L)];case 5:D.sent();return[2]}})}),function(){return M.apply(this,arguments)})},{key:"getClearClip",value:(D=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:if(this.clearClip)return[2,this.clearClip];return[4,F.loadAnimClipAsync(ee.TILE_CLEAR_ANIM)];case 1:n=w.sent();return[2,n?(this.clearClip=n,this.animationComponent.addClip(n),n):null]}})}),function(){return D.apply(this,arguments)})},{key:"getShakeClip",value:(L=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:if(this.shakeClip)return[2,this.shakeClip];return[4,F.loadAnimClipAsync(ee.TILE_SHAKE_ANIM)];case 1:n=w.sent();return[2,n?(this.shakeClip=n,this.animationComponent.addClip(n),n):null]}})}),function(){return L.apply(this,arguments)})},{key:"setHeight",value:function(n,w){if(this.background){var k=this.background.node;k.setPosition(new eQ(k.position.x,n,0)),k.setScale(new eQ(1+n/w*.3,1+n/w*.3,1))}}},{key:"createSpecialHandler",value:function(n,w){var k=this;switch(n){case $.bomb:return this.createBombHandler(null!=w?w:90);case $.star:return this.createStarHandler();default:return{type:$.none,switch:function(n,w){k.special=k.createSpecialHandler(n,w)}}}}},{key:"createBombHandler",value:function(n){var w=this,k=!1,C=n,a=function(){k=!0},o=function(){k=!1};this.node.scene.on(i7.TILE_CLICK,a),this.node.scene.on(i7.USE_ITEM,a),this.node.scene.on(i7.RESUME_TIME,a),this.node.scene.on(i7.PAUSE_TIME,o),this.node.scene.on(i7.TIME_OUT,o),this.bombComponent.node.active=!0;var r=function(){k=!1,w.bombComponent.node.active=!1,C=n,w.node.scene.off(i7.TILE_CLICK,a),w.node.scene.off(i7.USE_ITEM,a),w.node.scene.off(i7.GAME_RESUME,a),w.node.scene.off(i7.GAME_PAUSE,o),w.node.scene.off(i7.TIME_OUT,o)};return{type:$.bomb,update:function(E){k&&(C-=E,w.bombComponent.fillRange=-C/n,C<=0&&(k=!1,w.bombComponent.node.active=!1,w.setEmpty(!0),w.node.scene.emit(i7.BOMB_EXPLODE,w)))},clear:function(){H.playSound(nI.BOMB_DEFUSE)},cleanup:r,onDestroy:function(){w.node.scene.off(i7.TILE_CLICK,a),w.node.scene.off(i7.USE_ITEM,a),w.node.scene.off(i7.GAME_RESUME,a),w.node.scene.off(i7.GAME_PAUSE,o),w.node.scene.off(i7.TIME_OUT,o)},switch:function(n,k){r(),w.special=w.createSpecialHandler(n,k)},detonateImmediately:function(){C=0}}}},{key:"createStarHandler",value:function(){var n=this;this.starComponent.node.active=!0;var t=function(){n.starComponent.node.active=!1};return{type:$.star,clear:function(){n.starComponent.node.active=!1,H.playSound(nI.COLLECT_STARS);var w=n.node.worldPosition,k=w.x,C=w.y;n.node.scene.emit(i7.ADD_STARS,{startAnimationAt:[k,C]})},cleanup:t,switch:function(w){t(),n.special=n.createSpecialHandler(w)}}}}],[{key:"preloadTileAnimations",value:(I=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,Promise.all([F.loadAnimClipAsync(ee.TILE_CLEAR_ANIM),F.loadAnimClipAsync(ee.TILE_SHAKE_ANIM)])];case 1:n.sent();return[2]}})}),function(){return I.apply(this,arguments)})}]),A}(eL)).prototype,"icon",[lp,ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lq=n(lH.prototype,"bombComponent",[ly,lf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lW=n(lH.prototype,"starComponent",[lv,lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lK=n(lH.prototype,"background",[lm,lb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lj=n(lH.prototype,"bgUITransform",[lw,lS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lY=n(lH.prototype,"defaultBackground",[lk,lC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lX=n(lH.prototype,"uiOpacity",[lE,l_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lZ=n(lH.prototype,"shineOpacity",[lA,lT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lJ=n(lH.prototype,"glowOpacity",[lP,lR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lQ=n(lH.prototype,"iconOpacity",[lI,lO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l$=n(lH.prototype,"button",[lL,lD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l0=n(lH.prototype,"animationComponent",[lM,lN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l1=n(lH.prototype,"container",[lz,lB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(lH.prototype,"setOpacity",[lF],Object.getOwnPropertyDescriptor(lH.prototype,"setOpacity"),lH.prototype),n(lH.prototype,"runAnimationAfterDelay",[lx],Object.getOwnPropertyDescriptor(lH.prototype,"runAnimationAfterDelay"),lH.prototype),n(lH.prototype,"runAnimation",[lU],Object.getOwnPropertyDescriptor(lH.prototype,"runAnimation"),lH.prototype),lG=lH))||lG)||lG)||lG);function nc(n,w,k,C){var E=arguments.length>3&&void 0!==C?C:0,_=k.x,T=k.y,I=Q(w,2),L=I[0],D=I[1],M=L*(_-(n.width-1)/2)+E*(_-n.width/2),N=D*(T-(n.height-1)/2)+E*(T-n.height/2);return -1===_&&(M+=w[0]/4),_===n.width&&(M-=w[0]/4),-1===T&&(N+=w[1]/4),T===n.height&&(N-=w[1]/4),{x:M,y:N}}function ic(n,w){var k=arguments.length>1&&void 0!==w?w:[0,0],C=Q(n,2),E=C[0],_=C[1],T=Q(k,2),I=T[0],L=T[1],D=1-I,M=1-L,N=E*D,z=_*M;return[N,z]}function ac(n,w){for(var k=arguments.length>1&&void 0!==w&&w,C=n.split("-"),E=[],_=0;_<C.length;){var T=null,I=C[_];switch(I){case"normal":_+=1;break;case"fall":T=lt,_+=2;break;case"fly":T=ln,_+=2;break;case"push":"left"===C[_+1]?(T=li,_+=2):(T=lr,_+=2);break;case"put":"columns"===C[_+1]?(T=la,_+=3):(T=lo,_+=3)}T&&(k&&(T=oc(T)),E.push(T))}return E}function oc(n){switch(n){case lt:return lr;case ln:return li;case li:return lt;case lr:return ln;case la:return lo;case lo:return la}}function rc(n){return(_instanceof(n,l2)?n.asArray():n).filter(function(n){return!n.isHidden()})}function lc(n){return(_instanceof(n,l2)?n.asArray():n).filter(function(n){return n.isHidden()})}ew._RF.pop(),ew._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),ew._RF.pop(),ew._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),ew._RF.pop(),ew._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),ew._RF.pop(),ew._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),ew._RF.pop(),ew._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),ew._RF.pop(),ew._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),ew._RF.pop(),ew._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),ew._RF.pop(),ew._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),ew._RF.pop(),ew._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);var l8=GameCore.Utils.Object;function uc(n,w){var k=w.getCoord(),C=k.x,E=k.y;return l8.vals(le).reduce(function(w,k){var _=k.x,T=k.y,I=C+_,L=E+T;return n.isInBounds(I,L)&&w.push(n.get(I,L)),w},[])}function cc(n){return Array.isArray(n)}function hc(n,w){var k=arguments.length>1&&void 0!==w?w:Date.now(),C=cc(n)?n:n.asArray();return C[tt(k,0,C.length)]}ew._RF.pop(),ew._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),ew._RF.pop(),ew._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);var l9=GameCore.Utils.Array;function dc(n,w){var k=arguments.length>1&&void 0!==w?w:Date.now(),C=_instanceof(n,l2)?n.asArray():n,E=hc(C,k),_=l9.search(C,function(n){return n.isSimilarTo(E)&&!n.inSamePositionAs(E)});if(void 0===_)throw new Error("Could not find a matching tile");return[E,_]}ew._RF.pop(),ew._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var yc=function(n){return n};function vc(n,w,k){var C=arguments.length>2&&void 0!==k?k:yc;return function(){var k,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:k=n,E=w;k<=0&&(k=Number.POSITIVE_INFINITY);_=0;T.label=1;case 1:if(!(_<k))return[3,4];return[4,C(E)];case 2:T.sent(),E=1e9*tn(E);T.label=3;case 3:_++;return[3,1];case 4:return[2]}})}()}function fc(n){return Array.isArray(n)}function gc(n,w,k){var C=arguments.length>2&&void 0!==k?k:Date.now(),E=fc(n)?n:n.asArray();if(E.length<w)return new Set(E);for(var _=new Set,T=vc(-1,C),I=T.next();_.size<w;){if(I.done)throw new Error("RNG exhausted");_.add(hc(E,I.value)),I=T.next()}return _}ew._RF.pop(),ew._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),ew._RF.pop(),ew._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),ew._RF.pop(),ew._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var l7=[1,4];function bc(n,w,k){var C,E=arguments.length>2&&void 0!==k?k:Date.now(),_=w.specials,T=_.bomb,I=tt.apply(void 0,[E].concat(l7)),D=gc(n,T,E),M=n.asArray().filter(function(n){return!D.has(n)}),N=gc(M,I,E),z=L(D);try{for(z.s();!(C=z.n()).done;){var B=C.value,F=2*w.time/3;B.setSpecialType($.bomb,F)}}catch(n){z.e(n)}finally{z.f()}var x,U=L(N);try{for(U.s();!(x=U.n()).done;){var G=x.value;G.setSpecialType($.star)}}catch(n){U.e(n)}finally{U.f()}}ew._RF.pop(),ew._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),ew._RF.pop(),ew._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);var ue=GameCore.Utils.Array;function Sc(n){var w=n.levelData,k=w.columns,C=w.rows,E=n.identities,_=n.createTile,T=n.seed,I=function(n,w,k){var C,E=[],_=L(vc(w/2,n,function(n){return tt(n,0,k.length)}));try{for(_.s();!(C=_.n()).done;){var T=C.value;E.push(k[T]),E.push(k[T])}}catch(n){_.e(n)}finally{_.f()}return ue.shuffle(E),E}(void 0===T?Date.now():T,k*C,E),D=kc(n.levelData,E,I),M=kc(n.levelData,E,D.reverse()).reverse().map(function(n){var w=_(n);return w.setIdentity(n),w});return new l2({width:k,height:C,content:M})}function kc(n,w,k){var C=n.rows,E=n.columns,_=n.rules;if(!_.maxSpaceOfPair)return k;for(var T=function(n,w,k){for(var C=[],E=0;E<w;E++){C[E]=[];for(var _=0;_<k;_++)C[E][_]=n[E*k+_]}return C}(k,C,E),I=0;I<w.length;I++)for(var L=null,D=null,M=0;M<C;M++)for(var N=0;N<E;N++)if(T[M][N]===w[I]){if(!L||!D){L=M,D=N;continue}var z=_.maxSpaceOfPair+1;if(Math.abs(M-L)+Math.abs(N-D)<=z){D=N,L=M;continue}var B=Cc(L,D,M,N),F=T[B.row][B.column];T[B.row][B.column]=T[M][N],T[M][N]=F}return function(n){for(var w=[],k=0;k<n.length;k++)for(var C=0;C<n[k].length;C++)w.push(n[k][C]);return w}(T)}function Cc(n,w,k,C){var E=n,_=w;return k>n&&(E=n+1),k<n&&(E=n-1),C>w&&(_=w+1),C<w&&(_=w-1),{row:E,column:_}}ew._RF.pop(),ew._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);var ut=GameCore.Utils.Array;function Ac(n){var w=n.customFen,k=n.identities,C=n.createTile,E=w.idSize,_=w.cols,T=w.rows,I=w.code;if(k.length<w.idSize)throw new Error("Invalid grid code. There are not enough identities/frames ".concat(k.length," to fill it according to fen code ").concat(E));var D=I.split(":");if(D.length!==T)throw new Error("Invalid grid code");var M=/[a-zA-Z]+\d+|./g,N=/[a-zA-Z]+/,z=/\d+/,B=D.reduceRight(function(n,E){var _,T=[],I=E.matchAll(M),D=L(I);try{for(D.s();!(_=D.n()).done;){var B,F,x=_.value[0],U=null===(B=z.exec(x))||void 0===B?void 0:B[0],G=void 0!==U?Number.parseInt(U,10):void 0,H=void 0!==G&&!Number.isNaN(G)&&G<k.length?k[G]:void 0,V=C(void 0!==H?H:k[0]),q=null===(F=N.exec(x))||void 0===F?void 0:F[0],W=void 0!==q?Tc(q,w.encoding):void 0;W&&H?V.setSpecialType(W):V.setEmpty(),T.push(V)}}catch(n){D.e(n)}finally{D.f()}return n.concat(T)},[]);return new l2({width:_,height:T,content:B})}function Tc(n,w){var k=ut.search(Object.entries(w),function(w){var k=Q(w,2);k[0];return k[1]===n});if(void 0===k)throw new Error("Invalid special type ".concat(n));return k[0]}ew._RF.pop(),ew._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),ew._RF.pop(),ew._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);var un=GameCore.Utils.Array;function Rc(n,w){var k=arguments.length>1&&void 0!==w?w:Date.now(),C=n.asArray(),E=hc(n,k),_=uc(n,E);if(!_.some(function(n){return n.isSimilarTo(E)})){var T=hc(_,k),I=un.search(C,function(n){return!n.inSamePositionAs(E)&&!n.inSamePositionAs(T)&&n.isSimilarTo(T)});I.setIdentity(E.id),T.setIdentity(E.id)}}ew._RF.pop(),ew._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),ew._RF.pop(),ew._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var ui=[{startTile:{x:0,y:1},endTile:{x:3,y:1},localeTextKey:"guide.step1"},{startTile:{x:2,y:2},endTile:{x:3,y:0},localeTextKey:"guide.step2"},{startTile:{x:0,y:0},endTile:{x:3,y:3},localeTextKey:"guide.step3"},{startTile:{x:0,y:4},endTile:{x:2,y:3},localeTextKey:"guide.step4"},{startTile:{x:1,y:4},endTile:{x:1,y:2},localeTextKey:"guide.step5"}];ew._RF.pop(),ew._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var ur=GameCore.Utils.Array;function Oc(n,w){return n[0]===w[0]&&n[1]===w[1]}function _c(n){return new e4(n[0],n[1])}function Dc(n,w){return n.x>=-1&&n.x<w.width+1&&n.y>=-1&&n.y<w.height+1}function Mc(n,w){var k=arguments.length>1&&void 0!==w?w:uo;return k.map(function(w){return[n.tile[0]+w.x,n.tile[1]+w.y]})}var ua,uo=[le.Up,le.Down,le.Left,le.Right],us=function(){function e(n,w){var k;if(C(this,e),this.f=0,this.g=0,this.h=0,w&&Oc(n,w.tile))throw new Error("Tile cannot be its own parent");this.tile=n,this.parent=w;var E=e.calcDirection(this),_=w&&E&&w.cache.direction&&!E.equals(w.cache.direction)?1:0;this.cache={direction:E,turns:_+(null!==(k=null==w?void 0:w.cache.turns)&&void 0!==k?k:0)}}return T(e,[{key:"getKey",value:function(){var n;return"x:".concat(this.tile[0],",y:").concat(this.tile[1],",d:").concat(null===(n=this.cache.direction)||void 0===n?void 0:n.toString())}},{key:"equals",value:function(n){return this.getKey()===n.getKey()}}],[{key:"calcDirection",value:function(n){if(n.parent){var w=n.parent.tile,k=n.tile;return new e4(k[0]-w[0],k[1]-w[1])}return null}}]),e}();function Fc(n,w,k){var C=Gc(n,w),E=Gc(n,k);if(0===C.length||0===E.length)return xc(w,k);var _=function(n,w,k){var C=[],E=[],_=new us(w,null),T=new us(k,null),I=[T.tile];C.push(_);for(;C.length>0;){var D=C.shift();if(E.push(D),Oc(D.tile,T.tile)){for(var M=[],N=D,z=D,B=D.parent;B;)B.cache.turns!==z.cache.turns&&(M.unshift({a:_c(B.tile),b:_c(N.tile)}),N=B),z=B,B=B.parent;return M.unshift({a:_c(z.tile),b:_c(N.tile)}),M}var F,x=Mc(D,Gc(n,D.tile,I)),U=L(x);try{var g=function(){var n=F.value,w=new us(n,D);if(w.cache.turns>8)return 0;var k=Oc(w.tile,T.tile),_=E.some(function(n){return n.equals(w)});if(C.some(function(n){return n.equals(w)})||_&&!k)return 0;w.g=D.g+1+w.cache.turns,w.h=Uc(w,T),w.f=w.g+w.h,C.push(w)};for(U.s();!(F=U.n()).done;)g()}catch(n){U.e(n)}finally{U.f()}C.sort(function(n,w){return n.f-w.f})}return null}(n,w,k);return _||xc(w,k)}function xc(n,w){var k=_c(n),C=_c(w);return k.x===C.x||k.y===C.y?[{a:k,b:C}]:[{a:k,b:{x:k.x,y:C.y}},{a:{x:k.x,y:C.y},b:C}]}function Uc(n,w){var k=n.tile,C=w.tile;return Math.abs(k[0]-C[0])+Math.abs(k[1]-C[1])}function Gc(n,w,k){var C,E=arguments.length>2&&void 0!==k?k:[],_=[],T=L(uo);try{var r=function(){var k=C.value,T={x:w[0]+k.x,y:w[1]+k.y};if(n.isInBounds(T.x,T.y))return(n.get(T.x,T.y).isHidden()||ur.search(E,function(n){return Oc(n,[T.x,T.y])}))&&_.push(k),1;Dc(T,n)&&_.push(k)};for(T.s();!(C=T.n()).done;)r()}catch(n){T.e(n)}finally{T.f()}return _}ew._RF.pop(),ew._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),ew._RF.pop(),ew._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var ul=(X(ua={},$.bomb,"b"),X(ua,$.star,"s"),X(ua,$.none,"t"),ua);function Vc(n){return n.reduce(function(n,w,k,C){return w.inSamePositionAs(k,C)||n.push([w,[k,C]]),n},[])}function qc(n,w){var k,C,E,_,T,I,L,D;return _ts_generator(this,function(M){switch(M.label){case 0:k=0,C=n-1,E=0,_=w-1;M.label=1;case 1:if(!(k<=C&&E<=_))return[3,19];T=k;M.label=2;case 2:if(!(T<=C))return[3,5];return[4,{x:T,y:E}];case 3:M.sent();M.label=4;case 4:T++;return[3,2];case 5:I=++E;M.label=6;case 6:if(!(I<=_))return[3,9];return[4,{x:C,y:I}];case 7:M.sent();M.label=8;case 8:I++;return[3,6];case 9:L=--C;M.label=10;case 10:if(!(L>=k))return[3,13];return[4,{x:L,y:_}];case 11:M.sent();M.label=12;case 12:L--;return[3,10];case 13:D=--_;M.label=14;case 14:if(!(D>=E))return[3,17];return[4,{x:k,y:D}];case 15:M.sent();M.label=16;case 16:D--;return[3,14];case 17:k++;M.label=18;case 18:return[3,1];case 19:return[2]}})}ew._RF.pop(),ew._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),ew._RF.pop(),ew._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),ew._RF.pop(),ew._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var uu,up,ud,uy,uf,uv,ug,um,ub,uw,uS,uk,uC=GameCore.Utils.Array,uE=function(){function e(n,w){C(this,e),this.coord=new e4(n,w)}return T(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function oh(n){return new e4(n[0],n[1])}function rh(n,w,k){if(void 0===w||void 0===k)return function(n,w){var k,C=arguments.length>1&&void 0!==w?w:qc,E=[],_=L(C(n.width,n.height));try{for(_.s();!(k=_.n()).done;){var T=k.value,I=n.get(T.x,T.y);I.isHidden()||E.push([I,[T.x,T.y]])}}catch(n){_.e(n)}finally{_.f()}var D,M=[],c=function(){var w=E.shift(),k=Q(w,2),C=k[0],_=k[1];if(uC.search(M,function(n){return uh(n,_)}))return 0;M.push(_);for(var T,l=function(){var w=Q(L[I],2),k=w[0],E=w[1];if(!k.isSimilarTo(C)||uC.search(M,function(n){return uh(n,E)}))return 0;var T=rh(n,_,E);return null!==T?{v:{v:T}}:void 0},I=0,L=E;I<L.length;I++)if(0!==(T=l())&&T)return T.v};for(;E.length>0;)if(0!==(D=c())&&D)return D.v;return null}(n);var C,E=[w[0]+1,w[1]+1],_=[k[0]+1,k[1]+1],T=function(n){var w=uC.fillWith(n.width+2,function(n){return new uE(n-1,-1)}),k=uC.fillWith(n.width+2,function(w){return new uE(w-1,n.height)}),C=uC.fillWith(n.height,function(n){return new uE(-1,n)}),E=uC.fillWith(n.height,function(w){return new uE(n.width,w)}),o=function(_,T){var I=_-1,L=T-1;return -1===I?C[L]:I===n.width?E[L]:-1===L?w[I]:L===n.height?k[I]:n.get(I,L)};return{get:function(n,w){return o(n,w)},width:n.width+2,height:n.height+2}}(n),I=[E,_];if(E[0]===_[0]&&hh(T,I,E[1],_[1],E[0])||E[1]===_[1]&&ph(T,I,E[0],_[0],E[1]))return vh([{a:oh(E),b:oh(_)}],{x:-1,y:-1});var D=E[1]<=_[1]?E:_,M=E[1]<=_[1]?_:E,N=E[0]<=_[0]?E:_,z=E[0]<=_[0]?_:E,B=[],F=[],x=dh(T,I,1,oh(D),oh(M)),U=dh(T,I,-1,oh(D),oh(M));-1===x&&-1===U||(C=-1!==x?x:U,B=[{a:oh(E),b:{x:E[0],y:C}},{a:{x:E[0],y:C},b:{x:_[0],y:C}},{a:{x:_[0],y:C},b:oh(_)}]);var G=yh(T,I,1,oh(N),oh(z)),H=yh(T,I,-1,oh(N),oh(z));-1===G&&-1===H||(C=-1!==G?G:H,B=[{a:oh(E),b:{x:C,y:E[1]}},{a:{x:C,y:E[1]},b:{x:C,y:_[1]}},{a:{x:C,y:_[1]},b:oh(_)}]);var V=function(n,w,k,C){for(var E=k.y+1;E<C.y;E++)if(hh(n,w,k.y,E,k.x)&&ph(n,w,k.x,C.x,E)&&hh(n,w,E,C.y,C.x))return E;return -1}(T,I,oh(D),oh(M));-1!==V&&(C=V,F=[{a:oh(E),b:{x:E[0],y:C}},{a:{x:E[0],y:C},b:{x:_[0],y:C}},{a:{x:_[0],y:C},b:oh(_)}]);var q=function(n,w,k,C){for(var E=k.x+1;E<C.x;E++)if(ph(n,w,k.x,E,k.y)&&hh(n,w,k.y,C.y,E)&&ph(n,w,E,C.x,C.y))return E;return -1}(T,I,oh(N),oh(z));return -1!==q&&(C=q,F=[{a:oh(E),b:{x:C,y:E[1]}},{a:{x:C,y:E[1]},b:{x:C,y:_[1]}},{a:{x:C,y:_[1]},b:oh(_)}]),B.length>0&&F.length>0?vh(lh(B)<=lh(F)?B:F,{x:-1,y:-1}):B.length>0?vh(B,{x:-1,y:-1}):F.length>0?vh(F,{x:-1,y:-1}):null}function lh(n){var w,k=0,C=L(n);try{for(C.s();!(w=C.n()).done;)k+=sh(w.value)}catch(n){C.e(n)}finally{C.f()}return k}function sh(n){return n.a.x===n.b.x?Math.abs(n.a.y-n.b.y):n.a.y===n.b.y?Math.abs(n.a.x-n.b.x):0}function uh(n,w){return n[0]===w[0]&&n[1]===w[1]}function ch(n,w,k){var C=arguments.length>2&&void 0!==k?k:[],E=n.get.apply(n,Y(w));return E.isHidden()||C.some(function(n){return uh(n,w)})}function hh(n,w,k,C,E){for(var _=Math.min(k,C),T=Math.max(k,C),I=_;I<=T;I++)if(!ch(n,[E,I],w))return!1;return!0}function ph(n,w,k,C,E){for(var _=Math.min(k,C),T=Math.max(k,C),I=_;I<=T;I++)if(!ch(n,[I,E],w))return!1;return!0}function dh(n,w,k,C,E){var _=1===k?E.y:C.y,T=1===k?C.x:E.x;if(hh(n,w,C.y,E.y,T))for(;_>=0&&_<n.height&&ch(n,[C.x,_],w)&&ch(n,[E.x,_],w);){if(ph(n,w,C.x,E.x,_))return _;_+=k}return -1}function yh(n,w,k,C,E){var _=1===k?E.x:C.x,T=1===k?C.y:E.y;if(ph(n,w,C.x,E.x,T))for(;_>=0&&_<n.width&&ch(n,[_,C.y],w)&&ch(n,[_,E.y],w);){if(hh(n,w,C.y,E.y,_))return _;_+=k}return -1}function vh(n,w){return n.map(function(n){return{a:{x:n.a.x+w.x,y:n.a.y+w.y},b:{x:n.b.x+w.x,y:n.b.y+w.y}}})}ew._RF.pop(),ew._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var u_=eS.ccclass,uA=eS.property,uT=eS.requireComponent,uP=globalThis.game.monitorError,uR=GameCore.Utils,uI=uR.Array,uO=uR.Function,uL=uR.Valid,uD=W.Layout,uM=(uu=u_("Board"),up=uT(e_),ud=B.required,uy=uA(l6),uf=B.required,uv=uA(ek),ug=uA({displayName:"Tile Spacing",group:"Create config"}),uu(um=up((uw=n((ub=function(n){w(v,n);var I,D,M,F=k(v);function v(){var n;C(this,v);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=F.call.apply(F,[this].concat(k)),E(n,"tilePrefab",uw,_(n)),E(n,"tilesHolder",uS,_(n)),E(n,"tileTrim",uk,_(n)),n.tileSize=[0,0],n.selectedTile=null,n.parsedGravityRules=[],n.normalMatches=0,n.normalMatchesSinceLastSpawn=0,n.spawnAttempts=0,n.hintPath=null,n.hintTiles=null,n.isAnimating=!1,n.animationQueue=[],n.isConsumingAnimation=!1,n.handleViewResized=uO.debounce(function(){n.updateTilesHolderScale()},100),n}return T(v,[{key:"onLoad",value:function(){this.widget=this.getComponent(eN),this.uiTransform=this.getComponent(e_),B.validateRequiredProperties(this,v),this.tilePrefab.node.active=!1,this.listenEvents()}},{key:"onDestroy",value:function(){this.unlistenEvents()}},{key:"hasActiveGrid",value:function(){return void 0!==this.grid}},{key:"create",value:(M=N(function(n,w){var k,C,E,_,T,I,L;var D=arguments;return _ts_generator(this,function(M){switch(M.label){case 0:k=this,C=D.length>2&&void 0!==D[2]?D[2]:Date.now();this.levelData=w,this.handleOrientationChanged(s7.getCurrentLayout());return[4,z.waitTweenAsync(0)];case 1:M.sent();E=Y(n);uI.shuffle(E);_=E.slice(0,w.colors);null==uP||uP.addMetadata({frames:_.map(function(n){return n.name})}),this.parsedGravityRules=ac(w.mode,s7.isLandscape());T=function(n){var w=eA(k.tilePrefab.node),C=w.getComponent(l6);return C.setIdentity(n),k.tilesHolder.addChild(w),w.active=!0,C},I=!1;if(void 0!==w.customFen)try{I=!0,this.grid=Ac({customFen:w.customFen,identities:_,createTile:T}),this.grid.forEach(function(n,w,k){n.setCoord(w,k),n.setIgnoreInput(!1),n.node.setSiblingIndex(0)})}catch(n){console.error("Error creating grid from custom fen",n,"falling back to random grid"),I=!1}I||(this.grid=Sc({levelData:w,seed:C,identities:_,createTile:T}),this.grid.forEach(function(n,w,k){n.setCoord(w,k),n.setIgnoreInput(!1),n.node.setSiblingIndex(0)}),Rc(this.grid,C),bc(this.grid,w,C)),this.handleBoardLayout();L=[this.tileTrim.x,this.tileTrim.y];this.tileSize=ic(this.tilePrefab.getSize(),L),this.updateTilesHolderScale(),this.node.scene.emit(i7.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle();return[2]}})}),function(n,w){return M.apply(this,arguments)})},{key:"updateTilesHolderScale",value:function(){if(this.grid){var n=[this.grid.width,this.grid.height],w=[this.uiTransform.width,this.uiTransform.height],k=function(n,w,k){var C=Q(n,2),E=C[0],_=C[1],T=Q(w,2),I=T[0],L=T[1],D=Q(k,2),M=D[0]/(E*I),N=D[1]/(_*L);return Math.min(M,N)}(n,this.tilePrefab.getSize(),w);this.tilesHolder.setScale(k,k),this.node.scene.emit(i7.GRID_RESIZE,k)}}},{key:"handleBoardLayout",value:function(){var n,w;this.grid&&s7.isLandscape()&&0!==this.levelData.level&&(this.grid=(n=this.grid,(w=n.toRotated()).forEach(function(n,w,k){n.setCoord(w,k)}),w))}},{key:"destroyTiles",value:function(){var n;null===(n=this.grid)||void 0===n||n.forEach(function(n){return n.node.destroy()})}},{key:"animateTilesAppear",value:function(){var n=this;if(void 0===this.grid){var w=new Error("animateTilesAppear: Grid is not initialized");if(uL.isDebugger())throw w;return null==uP||uP.sendException(w),Promise.resolve()}var k=this.grid;return new Promise(function(w){var C=function(){var C=N(function(){var C;return _ts_generator(this,function(E){switch(E.label){case 0:C=function(w){return nc(k,n.tileSize,w)};return[4,Promise.all(k.map(function(w,E,_){var T=ti(0,.5),I=w.node.scale.clone(),D=function(w,k){var C,E=e4.ZERO.clone(),_=L(n.parsedGravityRules);try{for(_.s();!(C=_.n()).done;){var T=C.value,I=n.getPrimitiveDirection(w,k,T);E.subtract2f(I.x,I.y)}}catch(n){_.e(n)}finally{_.f()}return E.normalize()}(E,_),M=nc(k,n.tileSize,{x:E,y:_}),N=D.multiplyScalar(100).add2f(M.x,M.y);return w.node.setPosition(N.x,N.y),w.node.setScale(0,0),Promise.all([z.runTweenAsync(ez(w.node).delay(T).to(.5,{scale:I},{easing:"elasticOut"})),w.sync({getTargetPosition:C,easing:"backOut",duration:.5,delay:T})])}))];case 1:E.sent(),w();return[2]}})});return function(){return C.apply(this,arguments)}}();n.animationQueue.push(C),n.consumeAnimationQueue()})}},{key:"animateTilesWave",value:function(){var n=this;if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","animateTilesWave"),Promise.resolve();var w=this.grid;return new Promise(function(k){var C=function(){var n=N(function(){var n;return _ts_generator(this,function(C){switch(C.label){case 0:n=function(n,w){for(var k=w.x,C=w.y,E="center"===n?{x:(k-1)/2,y:(C-1)/2}:n,_=E.x,T=E.y,I=[],L=0;L<k;L++){for(var D=[],M=0;M<C;M++){var N=_-L,z=T-M,B=Math.sqrt(N*N+z*z);D.push(B)}I.push(D)}return I}("center",{x:w.width,y:w.height});return[4,Promise.all(w.map(function(w,k,C){var E,_,T=.1*(null!==(E=null===(_=n[k])||void 0===_?void 0:_[C])&&void 0!==E?E:0),I=w.node.scale.clone();return Promise.all([z.runTweenAsync(ez(w.node).delay(T).to(.25,{scale:I.clone().multiplyScalar(1.2)},{easing:"quadOut"}).to(.25,{scale:I},{easing:"quadIn"}))])}))];case 1:C.sent(),k();return[2]}})});return function(){return n.apply(this,arguments)}}();n.animationQueue.push(C),n.consumeAnimationQueue()})}},{key:"animateTilesError",value:(D=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:if(void 0===this.grid)return[2,(this.reportOrThrowInDebugger("Grid is not initialized","animateTilesError"),Promise.resolve())];n=this.isAnimating;if(n)return[3,2];this.isAnimating=!0;return[4,Promise.all(this.grid.map(function(n){return n.moveAround()}))];case 1:n=(w.sent(),this.isAnimating=!1);w.label=2;case 2:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"handleTileClick",value:function(n){if(!n.isHidden()){if(this.selectedTile===n)return H.playSound(nI.TILE_SELECT),this.selectedTile=null,void n.setFocused(!1);if(!this.selectedTile)return H.playSound(nI.TILE_SELECT),this.selectedTile=n,void n.setFocused(!0);if(!this.selectedTile.isSimilarTo(n))return H.playSound(nI.TILE_SELECT),this.selectedTile.setFocused(!1),this.selectedTile=n,void n.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,n),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(n,w){if(void 0!==this.grid){var k=[n.getCoord().x,n.getCoord().y],C=[w.getCoord().x,w.getCoord().y],E=rh(this.grid,k,C);if(null===E){H.playSound(nI.INVALID_MATCH),this.animateTilesError();var _=0===this.levelData.level,T=function(n,w,k,C){if(C){var E=ui[4].startTile,_=ui[4].endTile;if(w[0]===E.x&&w[1]===E.y&&k[0]===_.x&&k[1]===_.y)return[{a:E,b:_}];if(w[0]===_.x&&w[1]===_.y&&k[0]===E.x&&k[1]===E.y)return[{a:E,b:_}]}return Fc(n,w,k)}(this.grid,k,C,_);return this.node.scene.emit(i7.GRID_MATCH,[n,w]),void this.node.scene.emit(i7.GRID_MATCH_FAIL,T)}H.playSound(nI.TILE_MATCH),this.node.scene.emit(i7.GRID_MATCH,[n,w]),this.node.scene.emit(i7.GRID_MATCH_SUCCESS,E,[n,w]),this.clear([[n,w]])}else this.reportOrThrowInDebugger("Grid is not initialized","match")}},{key:"clear",value:function(n,w){this.normalMatches+=n.length;for(var k=0;k<n.length;k++){var C=n[k],E=Q(C,2),_=E[0],T=E[1],I=w?2*k*w:0,L=w?(2*k+1)*w:0;_.setEmpty(),T.setEmpty(),_.playClearFX(I),T.playClearFX(L),this.node.scene.emit(i7.GRID_CLEAR,[_,T])}this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var n=this.hintPath[0],w=this.hintPath[this.hintPath.length-1];if(n&&w){var k=n.a,C=w.b,E=this.getTileAt(k.x,k.y),_=this.getTileAt(C.x,C.y);E&&_?(E.setHint(!0),_.setHint(!0),this.hintTiles=[E,_]):this.reportOrThrowInDebugger("Hint tiles are not valid","showHint")}else this.reportOrThrowInDebugger("Hint path is not valid","showHint")}}},{key:"hideHint",value:function(){if(this.hintTiles){var n=Q(this.hintTiles,2),w=n[0],k=n[1];w.setHint(!1),k.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(n,w){return void 0===this.grid?null:this.grid.isInBounds(n,w)?this.grid.get(n,w):null}},{key:"getAnyTileWorldPosition",value:function(n,w){if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getAnyTileWorldPosition"),{x:0,y:0};var k=nc(this.grid,this.tileSize,{x:n,y:w});this.tilePrefab.node.setPosition(k.x,k.y);var C=this.tilePrefab.node.getWorldPosition();return{x:C.x,y:C.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getGridSize",value:function(){return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getGridSize"),[0,0]):[this.grid.width,this.grid.height]}},{key:"getUncleared",value:function(){return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getUncleared"),[]):rc(this.grid)}},{key:"getCleared",value:function(){return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getCleared"),[]):lc(this.grid)}},{key:"getBombTiles",value:function(){var n;return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getBombTiles"),[]):rc(_instanceof(n=this.grid,l2)?n.asArray():n).filter(function(n){var w;return(null===(w=n.special)||void 0===w?void 0:w.type)===$.bomb})}},{key:"getPairs",value:function(n,w){var k=arguments.length>0&&void 0!==n?n:1,C=!(arguments.length>1&&void 0!==w)||w;if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getPairs"),[];for(var E=[],_=C?rc(this.grid):lc(this.grid),a=function(){var n=dc(_),w=Q(n,2),k=w[0],C=w[1];E.push([k,C]),_=_.filter(function(n){return n!==k&&n!==C})};E.length<k;)a();return E}},{key:"setIgnoreInput",value:function(n){var w,k=!(arguments.length>0&&void 0!==n)||n;null===(w=this.grid)||void 0===w||w.forEach(function(n){return n.setIgnoreInput(k)})}},{key:"processShuffleRequest",value:function(n){if(void 0!==this.grid){var w=this.processShuffleStep(this.grid,!0,n);this.grid=w[0],this.hintPath=w[1],this.consumeAnimationQueue()}else this.reportOrThrowInDebugger("Grid is not initialized","processShuffleRequest")}},{key:"generateFenFromCurrentLevel",value:function(n){return v.generateFen(null!=n?n:this.levelData)}},{key:"listenEvents",value:function(){eY.on(q.VIEW_RESIZED,this.handleViewResized),eY.on(q.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"unlistenEvents",value:function(){eY.off(q.VIEW_RESIZED,this.handleViewResized),eY.off(q.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"handleOrientationChanged",value:function(n){var w;n===uD.Portrait||0===(null===(w=this.levelData)||void 0===w?void 0:w.level)?this.widget.left=20:n===uD.Landscape&&(this.widget.left=800)}},{key:"processGameplayCycle",value:function(){if(void 0!==this.grid){var n=rc(this.grid);if(0!==n.length){var w=this.grid,k=n.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,C=this.normalMatchesSinceLastSpawn>=2;k&&(C?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),n.length>14&&(w=this.processGravitationStep(w));var E=this.processShuffleStep(w);this.consumeAnimationQueue(),this.grid=E[0],this.hintPath=E[1]}}else this.reportOrThrowInDebugger("Grid is not initialized","processGameplayCycle")}},{key:"processSpawnStep",value:function(){var n;if(void 0!==this.grid){var w=gc(lc(this.grid),2),k=Q(w,2),C=k[0],E=k[1],_=null!==(n=null==C?void 0:C.id)&&void 0!==n?n:void 0;void 0!==C&&void 0!==_&&void 0!==E?(C.restore(),E.restore(_),this.node.scene.emit(i7.GRID_SPAWN,[C,E])):this.reportOrThrowInDebugger("Failed to get random tiles","processSpawnStep")}else this.reportOrThrowInDebugger("Grid is not initialized","processSpawnStep")}},{key:"processGravitationStep",value:function(n){var w,k=this,C=n,E=[],_=L(this.parsedGravityRules);try{var r=function(){var n=w.value,_=Vc(C=k.toGravitated(C,n));if(0===_.length)return 1;var T,I=L(_);try{for(I.s();!(T=I.n()).done;){var D=Q(T.value,2),M=D[0],z=Q(D[1],2),B=z[0],F=z[1];M.setCoord(B,F)}}catch(n){I.e(n)}finally{I.f()}C.forEach(function(n){n.node.setSiblingIndex(0)});var x=function(){var n=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,Promise.all(_.map(function(n){var w=Q(n,2),E=w[0],_=Q(w[1],2),T=_[0],I=_[1];return E.sync({delay:.25,duration:.25,getTargetPosition:function(){return nc(C,k.tileSize,{x:T,y:I})}})}))];case 1:n.sent();return[2]}})});return function(){return n.apply(this,arguments)}}();E.push(x)};for(_.s();!(w=_.n()).done;)r()}catch(n){_.e(n)}finally{_.f()}var T=function(){var n=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=0,w=E;C.label=1;case 1:if(!(n<w.length))return[3,4];k=w[n];return[4,k()];case 2:C.sent();C.label=3;case 3:n++;return[3,1];case 4:return[2]}})});return function(){return n.apply(this,arguments)}}();return this.animationQueue.push(T),C}},{key:"toGravitated",value:function(n,w){var k=new l2(n),C=n.height-1,E=n.width-1,_=[0,C],T=[0,E],I=Math.floor(n.height/2),L=Math.floor(n.width/2),u=function(n){return n.isHidden()};switch(w){case lt:k.gravitate({rowRange:_,colRange:T,direction:le.Down,isLighter:u});break;case ln:k.gravitate({rowRange:_,colRange:T,direction:le.Up,isLighter:u});break;case li:k.gravitate({rowRange:_,colRange:T,direction:le.Left,isLighter:u});break;case lr:k.gravitate({rowRange:_,colRange:T,direction:le.Right,isLighter:u});break;case la:k.gravitate({rowRange:_,colRange:[L,E],direction:le.Left,isLighter:u,out:k.gravitate({rowRange:_,colRange:[0,L-1],direction:le.Right,isLighter:u})});break;case lo:k.gravitate({rowRange:[I,C],colRange:T,direction:le.Down,isLighter:u,out:k.gravitate({rowRange:[0,I-1],colRange:T,direction:le.Up,isLighter:u})})}return k}},{key:"getPrimitiveDirection",value:function(n,w,k){if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getPrimitiveDirection"),le.Down;var C=Math.floor(this.grid.height/2),E=Math.floor(this.grid.width/2);switch(k){case lt:return le.Down;case ln:return le.Up;case li:return le.Left;case lr:return le.Right;case la:return n>=E?le.Left:le.Right;case lo:return w>=C?le.Down:le.Up}}},{key:"processShuffleStep",value:function(n,w,k){var C,E,_=arguments.length>1&&void 0!==w&&w,T=arguments.length>2?k:void 0,I=rh(n),D=rc(n).map(function(n){var w=n.getCoord();return[w.x,w.y]});if(null!==I&&!_)return[n,I];var M=100;do{var N=n.toShuffled(D),z=Q(N,1);I=rh(E=z[0]),M--}while(null===I&&M>0);if(M<=0){var B,F=E.asArray().map(function(n){var w,k;return{name:null===(w=n.id)||void 0===w?void 0:w.name,type:null===(k=n.special)||void 0===k?void 0:k.type,active:!n.isHidden()}});return null==uP||uP.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",level:this.levelData.level,gridAsArray:F}),this.node.scene.emit(i7.GAME_EXIT),[n,null!==(B=I)&&void 0!==B?B:[]]}var x,U=Vc(E),G=L(U);try{for(G.s();!(x=G.n()).done;){var H=Q(x.value,2),V=H[0],q=Q(H[1],2),W=q[0],K=q[1];V.setCoord(W,K)}}catch(n){G.e(n)}finally{G.f()}var j=void 0!==T?function(){return T(n,E)}:this.createShuffleAnimationHandler(n,E);return this.animationQueue.push(j),[E,null!==(C=I)&&void 0!==C?C:[]]}},{key:"createShuffleAnimationHandler",value:function(n,w){var k=this,C=function(){var C=N(function(){return _ts_generator(this,function(C){switch(C.label){case 0:return[4,Promise.all(n.map(function(n,C,E){return n.sync({duration:.3,easing:"smooth",getTargetPosition:function(){return nc(w,k.tileSize,{x:C,y:E},10)}})}))];case 1:C.sent();return[2]}})});return function(){return C.apply(this,arguments)}}(),E=function(){var n=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:w.forEach(function(n){n.node.setSiblingIndex(0)});return[4,Promise.all(w.map(function(n){return n.sync({duration:.4,easing:"smooth",delay:ti(0,.2),getTargetPosition:function(n){return nc(w,k.tileSize,n)}})}))];case 1:n.sent();return[2]}})});return function(){return n.apply(this,arguments)}}();return function(){var n=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,C()];case 1:n.sent();return[4,E()];case 2:n.sent();return[2]}})});return function(){return n.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(I=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:if(!!this.isConsumingAnimation)return[3,5];this.isConsumingAnimation=!0;w.label=1;case 1:if(!(this.animationQueue.length>0))return[3,4];if(0===this.getUncleared().length){this.animationQueue=[];return[3,4]}n=this.animationQueue.shift();return[4,null==n?void 0:n()];case 2:w.sent();w.label=3;case 3:return[3,1];case 4:this.isConsumingAnimation=!1;w.label=5;case 5:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"clearAnimationQueue",value:function(){this.isConsumingAnimation=!1,this.animationQueue=[]}},{key:"reportOrThrowInDebugger",value:function(n,w){var k=arguments.length>0&&void 0!==n?n:"Unknown error thrown",C=arguments.length>1&&void 0!==w?w:"Board",E=new Error("".concat(C,": ").concat(k));if(uL.isDebugger())throw E;null==uP||uP.sendException(E)}}],[{key:"generateFen",value:function(n){for(var w=n,k=[],C=0;C<w.colors;C++)k.push(C+1);var E=Date.now(),_=Sc({levelData:w,seed:E,identities:k,createTile:function(n){var w=n,k=void 0,C=new e4(0,0);return{get id(){return w},get special(){return k},get coord(){return C},setIdentity:function(n){w=n},isHidden:function(){return!1},setSpecialType:function(n){k={type:n}},setCoord:function(n,w){return C.set(n,w)},getCoord:function(){return C},isSimilarTo:function(n){return n.id===w},inSamePositionAs:function(n){return n.getCoord().equals(C)}}}});return _.forEach(function(n,w,k){n.setCoord(w,k)}),Rc(_,E),bc(_,w,E),function(n,w){for(var k=arguments.length>1&&void 0!==w?w:ul,C=n.width,E=n.height,_=[],T=new Map,I=E-1;I>=0;I--){for(var L=[],D=0;D<C;D++){var M,N,z=n.get(D,I),B=z.isHidden()?null:z.id;if(null!==B){var F=k[null!==(M=null===(N=z.special)||void 0===N?void 0:N.type)&&void 0!==M?M:$.none];if(!T.has(B)){var x=T.size.toString();T.set(B,x)}var U="".concat(F).concat(T.get(B));L.push(U)}else L.push(".")}_.push(L.join(""))}return{code:_.join(":"),idSize:T.size,encoding:k,rows:E,cols:C}}(_)}}]),v}(eL)).prototype,"tilePrefab",[ud,uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uS=n(ub.prototype,"tilesHolder",[uf,uv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uk=n(ub.prototype,"tileTrim",[ug],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e4(.025,.1)}}),um=ub))||um)||um);ew._RF.pop(),ew._RF.push({},"f7e1byg/txJGqnuJJ7xQV1M","withItemAnalytics",void 0);var uN=GameCore.Plugins.Analytics.Events,uz=globalThis.game.analytics,Rh=function(n,w){return function(){return uz.event(uN.USE_ITEM,{item_name:n}),w.apply(void 0,arguments)}};ew._RF.pop(),ew._RF.push({},"bc704Yz8bdJzYja7TsWcGMN","useHintItem",void 0);var uB=Rh(Z.PLIERS,function(n,w){if(!w.isDrawingHint){var k=n.getHintPath();null!==k&&(H.playSound(nI.HINT_ITEM),w.drawHintPath(k,function(w){return n.getAnyTileWorldPosition(w.x,w.y)}),n.showHint())}});ew._RF.pop(),ew._RF.push({},"0a2423JE25HLIm5td77YE7e","usePliersItem",void 0);var uF=Rh(Z.PLIERS,function(n,w){var k,C=hc(n.getBombTiles()),E=C.node.worldPosition;w.createDefuseExplosionAt(E.x,E.y),H.playSound(nI.BOMB_DEFUSE),null===(k=C.special)||void 0===k||k.switch($.none)});ew._RF.pop(),ew._RF.push({},"d2cd0VZLwhNMJwc3ppHvOtA","withLoweredVolume",void 0);var Oh=function(n){return N(function(){var w;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:H.setVolumeMusic(0,!0);return[4,n.apply(void 0,k)];case 1:w=C.sent();return[2,(H.setVolumeMusic(.3,!0),w)]}})})};ew._RF.pop(),ew._RF.push({},"a62ebriH15FfI8l0x1GBX1p","useThunderItem",void 0);var ux,uU=function(){var n=N(function(n,w){var k;return _ts_generator(this,function(C){switch(C.label){case 0:if(n.getUncleared().length<4)return[3,2];k=n.getPairs(2);n.clearSelectedTile();return[4,w.playThunderAnimation(k,n)];case 1:C.sent();C.label=2;case 2:return[2]}})});return function(w,k){return n.apply(this,arguments)}}(),uG=Rh(Z.THUNDER,Oh((ux=uU,N(function(){var n;var w=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:F.setBlockInput(!0);return[4,ux.apply(void 0,w)];case 1:n=k.sent();return[2,(F.setBlockInput(!1),n)]}})}))));ew._RF.pop(),ew._RF.push({},"0e50bRTLUtMgYDDkS0nbFm5","useTornadoItem",void 0);var uH,uV=GameCore.Utils.Function,uq=function(){var n=N(function(n,w){var k;return _ts_generator(this,function(C){switch(C.label){case 0:return[4,uV.allSettled(n.map(function(k,C,E){return k.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return nc(n,w,{x:C,y:E},10)}})}))];case 1:k=C.sent();k.some(function(n){return"rejected"===n.status})&&console.error("Error playing padding animation",k.filter(function(n){return"rejected"===n.status}));return[2]}})});return function(w,k){return n.apply(this,arguments)}}(),uW=function(){var n=N(function(n,w){var k,C;return _ts_generator(this,function(E){switch(E.label){case 0:k=n.asArray().length;n.forEach(function(w,C,E){w.node.setSiblingIndex(k-1-(C+E*n.width))});return[4,uV.allSettled(n.map(function(k){return k.fly({getTilePosition:function(k){return nc(n,w,k)}})}))];case 1:C=E.sent();C.some(function(n){return"rejected"===n.status})&&console.error("Error playing shuffle animation",C.filter(function(n){return"rejected"===n.status}));return[2]}})});return function(w,k){return n.apply(this,arguments)}}(),uK=function(){var n=N(function(n,w,k,C){return _ts_generator(this,function(E){switch(E.label){case 0:H.playSound(nI.SHUFFLE_ITEM),H.playSound(nI.WIND);return[4,uq(n,k())];case 1:E.sent(),C();return[4,uW(w,k())];case 2:E.sent();return[2]}})});return function(w,k,C,E){return n.apply(this,arguments)}}(),uj=function(){var n=N(function(n,w){var k,C,E;return _ts_generator(this,function(_){k=function(){return n.getTileSize()},C=function(){return w.playTornadoAnimation()},E=Oh(function(n,w){return uK(n,w,k,C)});return[2,new Promise(function(w){n.processShuffleRequest(function(){var n=N(function(n,k){return _ts_generator(this,function(C){switch(C.label){case 0:return[4,E(n,k)];case 1:C.sent(),w();return[2]}})});return function(w,k){return n.apply(this,arguments)}}())})]})});return function(w,k){return n.apply(this,arguments)}}(),uY=Rh(Z.THUNDER,Oh(uj));ew._RF.pop(),ew._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var uX=(0,eS.ccclass)("Line")(uH=function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(e_)}},{key:"setPoints",value:function(n,w){this.node.setWorldPosition((n.x+w.x)/2,(n.y+w.y)/2,0),this.uiTransform.width=e4.distance(n,w)+10,this.uiTransform.width/=this.node.worldScale.x;var k=180*Math.atan2(w.y-n.y,w.x-n.x)/Math.PI;this.node.eulerAngles=new eQ(0,0,k)}}]),o}(eL))||uH;ew._RF.pop(),ew._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var uZ,uJ,uQ,u$,u0,u1,u2,u4,u3,u5,u6,u8=function(n){w(o,n);var E=k(o);function o(n,w,k,_,T){var I;return C(this,o),(I=E.call(this,n,w,T)).ator=k,I.ftor=_,I}return T(o,[{key:"alloc",value:function(){var n=D(M(o.prototype),"alloc",this).call(this);return this.ator&&this.ator(n),n}},{key:"free",value:function(n){this.ftor&&this.ftor(n),D(M(o.prototype),"free",this).call(this,n)}}]),o}(tr);ew._RF.pop(),ew._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var u9,u7,ce,ct,cn,ci,cr,ca,co,cs=eS.ccclass,cl=eS.property,cu=(uZ=cs("PathDrawer"),uJ=cl({group:"Line",displayName:"Prefab",type:ta}),uQ=cl({group:"Line",displayName:"Holder",type:ek,tooltip:"Line Prefab"}),u$=cl({group:"Point",displayName:"Prefab",type:ta}),u0=cl({group:"Point",displayName:"Holder",type:ek}),uZ((u4=n((u2=function(n){w(u,n);var I=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"linePrefab",u4,_(n)),E(n,"lineHolder",u3,_(n)),n.lineNodes=[],E(n,"pointPrefab",u5,_(n)),E(n,"pointHolder",u6,_(n)),n.pointNodes=[],n}return T(u,[{key:"start",value:function(){var n=this;this.linePool=new u8(function(){var w=eA(n.linePrefab);return n.lineHolder.addChild(w),w.parent=n.lineHolder,w.active=!1,w},0,function(w){n.lineNodes.push(w),w.active=!0},function(n){n.active=!1},function(n){n.isValid&&n.destroy()}),this.pointPool=new u8(function(){var w=eA(n.pointPrefab);return n.pointHolder.addChild(w),w.active=!1,w},0,function(w){n.pointNodes.push(w),w.active=!0},function(n){n.active=!1},function(n){n.isValid&&n.destroy()})}},{key:"drawPath",value:function(n){this.clearPath();var w,k=L(n);try{for(k.s();!(w=k.n()).done;){var C,E=w.value;null===(C=this.linePool.alloc().getComponent(uX))||void 0===C||C.setPoints(E.a,E.b)}}catch(n){k.e(n)}finally{k.f()}}},{key:"clearPath",value:function(){var n,w=L(this.lineNodes);try{for(w.s();!(n=w.n()).done;){var k=n.value;this.linePool.free(k)}}catch(n){w.e(n)}finally{w.f()}this.lineNodes=[];var C,E=L(this.pointNodes);try{for(E.s();!(C=E.n()).done;){var _=C.value;this.pointPool.free(_)}}catch(n){E.e(n)}finally{E.f()}this.pointNodes=[]}}]),u}(eL)).prototype,"linePrefab",[uJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u3=n(u2.prototype,"lineHolder",[uQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u5=n(u2.prototype,"pointPrefab",[u$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u6=n(u2.prototype,"pointHolder",[u0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u1=u2))||u1);ew._RF.pop(),ew._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var cp,cd=eS.ccclass,cy=eS.property,cf=(u9=cd("ErrorDrawer"),u7=cy(e7),ce=cy(e7),ct=cy(e7),u9((cr=n((ci=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"one",cr,_(n)),E(n,"two",ca,_(n)),E(n,"error",co,_(n)),n}return T(s,[{key:"start",value:function(){D(M(s.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(n){var w=this;if(this.clearPath(),n.forEach(function(k,C){var E;if(null===(E=w.linePool.alloc().getComponent(uX))||void 0===E||E.setPoints(k.a,k.b),0!==C){var _=w.pointPool.alloc();_.setWorldPosition(new eQ(k.a.x,k.a.y,0));var T=_.getComponent(ex);1===C&&n.length>3?T.spriteFrame=w.one:2===C&&n.length>3?T.spriteFrame=w.two:T.spriteFrame=w.error}}),1===n.length){var k=this.pointPool.alloc();k.setWorldPosition(new eQ(n[0].a.x+n[0].b.x,n[0].a.y+n[0].b.y,0).multiplyScalar(.5)),k.getComponent(ex).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(n){this.pathAppearDuration>0&&(this.pathAppearDuration-=n,this.pathAppearDuration<=0&&this.clearPath())}}]),s}(cu)).prototype,"one",[u7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ca=n(ci.prototype,"two",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),co=n(ci.prototype,"error",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cn=ci))||cn);ew._RF.pop(),ew._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var cv,cg=(0,eS.ccclass)("HintDrawer")(cp=function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"drawPath",value:function(n){this.clearPath(),this.createPath(n),this.showPath()}},{key:"createPath",value:function(n){var w,k=L(n);try{for(k.s();!(w=k.n()).done;){var C,E=w.value;null===(C=this.linePool.alloc().getComponent(uX))||void 0===C||C.setPoints(E.a,E.b),this.pointPool.alloc().setWorldPosition(E.a.x,E.a.y,0)}}catch(n){k.e(n)}finally{k.f()}this.pointPool.alloc().setWorldPosition(n[n.length-1].b.x,n[n.length-1].b.y,0)}},{key:"showPath",value:function(){var n,w=L(this.lineNodes);try{for(w.s();!(n=w.n()).done;){var k=n.value.getComponent(eH);k.opacity=0,ez(k).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(n){w.e(n)}finally{w.f()}var C,E=L(this.pointNodes);try{for(E.s();!(C=E.n()).done;){var _=C.value.getComponent(eH);_.opacity=0,ez(_).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(n){E.e(n)}finally{E.f()}}},{key:"clearPath",value:function(){var n,w=this,k=L(this.lineNodes);try{var i=function(){var k=n.value,C=k.getComponent(eH);ez(C).to(.15,{opacity:0},{onComplete:function(){C.opacity=255,w.linePool.free(k)}}).start()};for(k.s();!(n=k.n()).done;)i()}catch(n){k.e(n)}finally{k.f()}var C,E=L(this.pointNodes);try{var r=function(){var n=C.value,k=n.getComponent(eH);ez(k).to(.15,{opacity:0},{onComplete:function(){k.opacity=255,w.pointPool.free(n)}}).start()};for(E.s();!(C=E.n()).done;)r()}catch(n){E.e(n)}finally{E.f()}this.lineNodes=[],this.pointNodes=[]}}]),o}(cu))||cp;ew._RF.pop(),ew._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var cm,cb,cw,cS,ck,cC,cE,c_,cA,cT=(0,eS.ccclass)("MatchDrawer")(cv=function(n){w(s,n);var E,_,I=k(s);function s(){return C(this,s),I.apply(this,arguments)}return T(s,[{key:"drawPath",value:function(n){var w=this;n.forEach(function(n,k){var C,E=w.linePool.alloc();null===(C=E.getComponent(uX))||void 0===C||C.setPoints(n.a,n.b),w.animateLine(E);var _=w.pointPool.alloc();_.setWorldPosition(n.a.x,n.a.y,0),w.animatePoint(_,k)});var k=this.pointPool.alloc();k.setWorldPosition(n[n.length-1].b.x,n[n.length-1].b.y,0),this.animatePoint(k,n.length)}},{key:"animateLine",value:(_=N(function(n){var w,k;return _ts_generator(this,function(C){switch(C.label){case 0:w=n.getComponent(eH);w.opacity=0;k=ez(w).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});return[4,z.runTweenAsync(k)];case 1:C.sent(),w.opacity=255,this.linePool.free(n);return[2]}})}),function(n){return _.apply(this,arguments)})},{key:"animatePoint",value:(E=N(function(n,w){var k;return _ts_generator(this,function(C){switch(C.label){case 0:n.scale=eQ.ZERO;k=ez(n).delay(.03*w).to(.2,{scale:eQ.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:eQ.ZERO},{easing:"backIn"});return[4,z.runTweenAsync(k)];case 1:C.sent(),this.pointPool.free(n);return[2]}})}),function(n,w){return E.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),s}(cu))||cv;ew._RF.pop(),ew._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var cP,cR=eS.ccclass,cI=eS.property,cO=(cm=cR("PathDraw"),cb=cI({group:{name:"Path Drawer"},type:cT}),cw=cI({group:{name:"Path Drawer"},type:cg}),cS=cI({group:{name:"Path Drawer"},type:cf}),cm((cE=n((cC=function(n){w(c,n);var D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"matchPath",cE,_(n)),E(n,"hintPath",c_,_(n)),E(n,"errorPath",cA,_(n)),n.isDrawingHint=!1,n}return T(c,[{key:"onLoad",value:function(){var n=this;this.node.scene.on(i7.GRID_RESIZE,function(w){n.node.setScale(w,w)})}},{key:"drawMatchPath",value:function(n,w){var k,C=n.map(function(n){return I({},n)}),E=L(C);try{for(E.s();!(k=E.n()).done;){var _=k.value;_.a=w(_.a),_.b=w(_.b)}}catch(n){E.e(n)}finally{E.f()}this.matchPath.drawPath(C)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(n,w){if(!this.isDrawingHint){this.isDrawingHint=!0;var k,C=n.map(function(n){return I({},n)}),E=L(C);try{for(E.s();!(k=E.n()).done;){var _=k.value;_.a=w(_.a),_.b=w(_.b)}}catch(n){E.e(n)}finally{E.f()}this.hintPath.drawPath(C)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(n,w){var k,C=n.map(function(n){return I({},n)}),E=L(C);try{for(E.s();!(k=E.n()).done;){var _=k.value;_.a=w(_.a),_.b=w(_.b)}}catch(n){E.e(n)}finally{E.f()}this.errorPath.drawPath(C)}}]),c}(eL)).prototype,"matchPath",[cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c_=n(cC.prototype,"hintPath",[cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cA=n(cC.prototype,"errorPath",[cS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ck=cC))||ck);ew._RF.pop(),ew._RF.push({},"1a5c0RyWQJOipSvNtPLsTHS","ClockManager",void 0);var cL,cD=eS.ccclass,cM=eS.disallowMultiple,cN=cD("ClockManager")(cP=cM(cP=function(n){w(l,n);var E,_=k(l);function l(){var n;C(this,l);for(var w=arguments.length,k=new Array(w),E=0;E<w;E++)k[E]=arguments[E];return(n=_.call.apply(_,[this].concat(k))).time=0,n.remaining=0,n.running=!1,n.halfTime=!1,n}return T(l,[{key:"onLoad",value:function(){this.node.scene.on(i7.RESCUE_START,this.refillTime,this)}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"setTime",value:function(n){this.time=n,this.remaining=n,this.node.scene.emit(i7.TIME_UPDATED,this.remaining)}},{key:"getRemainingTime",value:function(){return this.remaining}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(i7.TIME_OUT)}},{key:"update",value:function(n){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=n,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(i7.HALF_TIME)),this.remaining>=0&&this.node.scene.emit(i7.TIME_UPDATED,this.remaining)))}},{key:"refillTime",value:(E=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:n=this,w=ez(this.node).to(3,{},{onUpdate:function(w,k){if(k){var C=e0.lerp(0,120,k);n.setTime(C)}}});return[4,z.runTweenAsync(w)];case 1:k.sent(),this.setTime(120),this.node.scene.emit(i7.RESCUE_FINISHED);return[2]}})}),function(){return E.apply(this,arguments)})}]),l}(eL))||cP)||cP;ew._RF.pop(),ew._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var cz,cB,cF,cx,cU,cG,cH,cV,cq,cW,cK,cj=eS.ccclass,cY=[nI.COMBO_1,nI.COMBO_2,nI.COMBO_3,nI.COMBO_4,nI.COMBO_5,nI.COMBO_6,nI.COMBO_7,nI.COMBO_8,nI.COMBO_9,nI.COMBO_10,nI.COMBO_11,nI.COMBO_12,nI.COMBO_13],cX=cj("ComboManager")(cL=function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(i7.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(i7.GAME_FINISH,this.resetCombo,this),this.node.scene.on(i7.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(i7.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(i7.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(n){if(this.currentCombo=n,n>0){var w=Math.min(n-1,cY.length-1);H.playSound(cY[w]),this.vibrate(n)}this.emitEvent&&this.node.scene.emit(i7.COMBO_UPDATED,n)}},{key:"vibrate",value:function(n){var w;null===(w=e8("Vibrate"))||void 0===w||null===(w=w.getComponent(sw))||void 0===w||w.vibrate(Math.min(20+20*n,220))}},{key:"setEmitEvent",value:function(n){this.emitEvent=n}}]),o}(eL))||cL;ew._RF.pop(),ew._RF.push({},"78746Q4viBIlbRROK4J1bSl","Burst",void 0);var cZ,cJ=eS.ccclass,cQ=eS.property,c$=(cz=cJ("Burst"),cB=cQ(eM),cF=cQ(eD),cx=cQ(eM),cU=cQ(eD),cz((cV=n((cH=function(){function e(){C(this,e),E(this,"time",cV,this),E(this,"repeatCount",cq,this),E(this,"repeatInterval",cW,this),E(this,"count",cK,this),this.remainingCount=0,this.curTime=0}return T(e,[{key:"update",value:function(n,w){if(0===this.remainingCount&&(this.remainingCount=this.repeatCount,this.curTime=this.time),this.remainingCount>0){var k=to(n.time-n.startDelay.evaluate(0,1),n.duration)-w;k=k>0?k:0;var C=to(n.time-n.startDelay.evaluate(0,1),n.duration);this.curTime>=k&&this.curTime<C&&(n.emit(this.count,w-(C-this.curTime)),this.curTime+=this.repeatInterval,--this.remainingCount)}}},{key:"reset",value:function(){this.remainingCount=0,this.curTime=0}}]),e}()).prototype,"time",[cB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cq=n(cH.prototype,"repeatCount",[cF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),cW=n(cH.prototype,"repeatInterval",[cx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),cK=n(cH.prototype,"count",[cU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),cG=cH))||cG);ew._RF.pop(),ew._RF.push({},"726cc2e08FBqpVIg/tPM7H2","Particle",void 0);var c0,c1,c2,c4,c3,c5,c6,c8,c9,c7,he,ht,hn,hi,hr,ha,ho,hs=eS.ccclass,hl=eS.executeInEditMode,hu=hs("Particle")(cZ=hl(!0)(cZ=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).remainingLifetime=0,n.startLifetime=0,n}return T(o,[{key:"onLoad",value:function(){this.node.layer=e6.Enum.UI_2D}},{key:"init",value:function(n){this.sprite=this.getComponent(ex),this.particleSystem=n,this.velocity=eQ.ZERO,this.remainingLifetime=0,this.startLifetime=0,this.startSize=eQ.ZERO,this.startColor=eC.WHITE.clone(),this.randomSeed=0}},{key:"reset",value:function(){this.node.rotation.set(0,0,0)}}]),o}(eL))||cZ)||cZ;ew._RF.pop(),ew._RF.push({},"00eb3NBo0tM/qcD6ViMjx0A","CurveRange",void 0);var hp,hd,hy,hf,hv,hg,hm,hb,hw,hS,hk,hC,hE,h_,hA,hT,hP,hR=eS.ccclass,hI=eS.property,hO=eU({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),hL=(c0=hR("CurveRange"),c1=hI({type:eU(hO)}),c2=hI({visible:function(){return this.mode===hO.Constant}}),c4=hI({visible:function(){return this.mode===hO.Curve}}),c3=hI({visible:function(){return this.mode===hO.TwoCurves}}),c5=hI({visible:function(){return this.mode===hO.TwoCurves}}),c6=hI({visible:function(){return this.mode===hO.TwoConstants}}),c8=hI({visible:function(){return this.mode===hO.TwoConstants}}),c0((he=n((c7=function(){function e(){C(this,e),E(this,"mode",he,this),E(this,"constant",ht,this),E(this,"spline",hn,this),E(this,"splineMin",hi,this),E(this,"splineMax",hr,this),E(this,"constantMin",ha,this),E(this,"constantMax",ho,this),this.spline.assignSorted([0,1],[0,1]),this.splineMin.assignSorted([0,1],[0,1]),this.splineMax.assignSorted([0,1],[0,1])}return T(e,[{key:"evaluate",value:function(n,w){switch(this.mode){case hO.Curve:return this.spline.evaluate(n);case hO.TwoCurves:return ts(this.splineMin.evaluate(n),this.splineMax.evaluate(n),w);case hO.TwoConstants:return ts(this.constantMin,this.constantMax,w);default:return this.constant}}},{key:"getMax",value:function(){switch(this.mode){case hO.Curve:return 1;case hO.TwoConstants:return this.constantMax;case hO.TwoCurves:return 1;default:return this.constant}}},{key:"isZero",value:function(){switch(this.mode){case hO.Curve:return tl(1,0,tu);case hO.TwoConstants:return tl(Math.max(Math.abs(this.constantMax),Math.abs(this.constantMin)),0,tu);case hO.TwoCurves:return tl(1,0,tu);default:return tl(this.constant,0,tu)}}}]),e}()).prototype,"mode",[c1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hO.Constant}}),ht=n(c7.prototype,"constant",[c2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hn=n(c7.prototype,"spline",[c4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tc}}),hi=n(c7.prototype,"splineMin",[c3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tc}}),hr=n(c7.prototype,"splineMax",[c5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tc}}),ha=n(c7.prototype,"constantMin",[c6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ho=n(c7.prototype,"constantMax",[c8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c9=c7))||c9);ew._RF.pop(),ew._RF.push({},"3fe5eBRNTJFCZgeD7SqFSh5","GradientRange",void 0);var hD=eS.ccclass,hM=eS.property,hN=eU({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),hz=new eC,hB=new eC,hF=(hp=hD("GradientRange"),hd=hM({type:eU(hN)}),hy=hM({visible:function(){return this.mode===hN.Color}}),hf=hM({visible:function(){return this.mode===hN.TwoColors}}),hv=hM({visible:function(){return this.mode===hN.TwoColors}}),hg=hM({visible:function(){return this.mode===hN.Gradient||this.mode===hN.RandomColor}}),hm=hM({visible:function(){return this.mode===hN.TwoGradients}}),hb=hM({visible:function(){return this.mode===hN.TwoGradients}}),hp((hk=n((hS=function(){function e(){C(this,e),E(this,"mode",hk,this),E(this,"color",hC,this),E(this,"colorMin",hE,this),E(this,"colorMax",h_,this),E(this,"gradient",hA,this),E(this,"gradientMin",hT,this),E(this,"gradientMax",hP,this),this._color=eC.WHITE.clone()}return T(e,[{key:"evaluate",value:function(n,w){switch(this.mode){case hN.Color:return this.color;case hN.TwoColors:return eC.lerp(this._color,this.colorMin,this.colorMax,w),this._color;case hN.RandomColor:return this.gradient.getRandomColor(this._color);case hN.Gradient:return this.gradient.evaluateFast(this._color,n);case hN.TwoGradients:return eC.lerp(this._color,this.gradientMin.evaluateFast(hz,n),this.gradientMax.evaluateFast(hB,n),w),this._color;default:return this.color}}}]),e}()).prototype,"mode",[hd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hN.Color}}),hC=n(hS.prototype,"color",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return eC.WHITE.clone()}}),hE=n(hS.prototype,"colorMin",[hf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return eC.WHITE.clone()}}),h_=n(hS.prototype,"colorMax",[hv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return eC.WHITE.clone()}}),hA=n(hS.prototype,"gradient",[hg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new th}}),hT=n(hS.prototype,"gradientMin",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new th}}),hP=n(hS.prototype,"gradientMax",[hb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new th}}),hw=hS))||hw);function Yd(n,w,k,C){!function(n,w){e4.set(n,Math.cos(w),Math.sin(w))}(n,C),n.z=0,eQ.multiplyScalar(n,n,w+(k-w)*td())}function Xd(n){var w=hO;switch(n.mode){case w.TwoCurves:case w.TwoConstants:return!0;default:return!1}}ew._RF.pop(),ew._RF.push({},"1a4c4Z/fWpFuL5b3emrVLug","ParticleFunction",void 0),ew._RF.pop(),ew._RF.push({},"c2fc2/T2apMGZCPX5a4abo/","ModuleRandSeed",void 0);var hx,hU,hG,hH,hV,hq,hW,hK=23541,hj=39825,hY=90794,hX=91041,hZ=125292,hJ=197866,hQ=156497;ew._RF.pop(),ew._RF.push({},"39785+APfBJU5kvcdjZGiLr","ColorOvertimeModule",void 0);var h$,h0,h1,h2,h4,h3,h5,h6,h8,h9=eS.ccclass,h7=eS.property,pe=hX,pt=(hx=h9("ColorOvertimeModule"),hU=h7({type:eW}),hG=h7({type:hF}),hx((hq=n((hV=function(){function e(){C(this,e),E(this,"enable",hq,this),E(this,"color",hW,this)}return T(e,[{key:"update",value:function(n){if(this.enable){var w=n.randomSeed+pe,k=function(n){var w=hN;switch(n.mode){case w.TwoGradients:case w.TwoColors:return!0;default:return!1}}(this.color)?tn(w):0,C=1-n.remainingLifetime/n.startLifetime;n.sprite.color=n.startColor.clone().multiply(this.color.evaluate(C,k))}}}]),e}()).prototype,"enable",[hU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hW=n(hV.prototype,"color",[hG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hF}}),hH=hV))||hH);ew._RF.pop(),ew._RF.push({},"c397apirpxFfJTJN1KLAcGi","LimitVelocityOvertimeModule",void 0);var pn,pi,pr,pa,po,ps,pl,pu=eS.ccclass,pc=eS.property,pp=hK,pd=(h$=pu("LimitVelocityOvertimeModule"),h0=pc({type:eW}),h1=pc({type:hL}),h2=pc({type:hL}),h$((h5=n((h3=function(){function e(){C(this,e),E(this,"enable",h5,this),E(this,"limit",h6,this),E(this,"dampen",h8,this),this.limit.constant=500,this.dampen.constant=.2}return T(e,[{key:"update",value:function(n,w){if(this.enable){var k=1-n.remainingLifetime/n.startLifetime,C=n.velocity.clone().normalize(),E=Xd(this.limit)?tn(n.randomSeed+pp):0,_=Xd(this.dampen)?tn(n.randomSeed+pp+1):0,T=n.velocity.length(),I=this.limit.evaluate(k,E),L=this.dampen.evaluate(k,_);n.velocity=C.multiplyScalar(this.dampenBeyondLimit(T,I,L,w))}}},{key:"dampenBeyondLimit",value:function(n,w,k,C){if(n<=w)return n;var E=1-Math.exp(-k*C);return e0.lerp(n,w,E)}}]),e}()).prototype,"enable",[h0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h6=n(h3.prototype,"limit",[h1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),h8=n(h3.prototype,"dampen",[h2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),h4=h3))||h4);ew._RF.pop(),ew._RF.push({},"442c2KaGHdNip4TBoeKOOoY","RendererModule",void 0);var py,pf,pv,pg,pm,pb,pw,pS,pk,pC,pE,p_,pA,pT,pP=eS.ccclass,pR=eS.property,pI=(pn=pP("RendererModule"),pi=pR(ty),pr=pR(e7),pn((ps=n((po=T(function e(){C(this,e),E(this,"material",ps,this),E(this,"spriteFrame",pl,this)})).prototype,"material",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pl=n(po.prototype,"spriteFrame",[pr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pa=po))||pa);ew._RF.pop(),ew._RF.push({},"c6cfbhYVctHt53aUXC4oSWy","RotationOvertimeModule",void 0);var pO,pL,pD,pM,pN,pz,pB,pF,px,pU,pG,pH,pV,pq,pW,pK,pj,pY,pX,pZ,pJ,pQ,p$,p0=eS.ccclass,p1=eS.property,p2=hZ,p4=(py=p0("RotationOvertimeModule"),pf=p1({type:eW}),pv=p1(eW),pg=p1({type:hL}),pm=p1({type:hL,visible:function(){return this.separateAxes}}),pb=p1({type:hL,visible:function(){return this.separateAxes}}),pw=p1({type:hL}),py((pC=n((pk=function(){function e(){C(this,e),E(this,"enable",pC,this),E(this,"separateAxes",pE,this),E(this,"x",p_,this),E(this,"y",pA,this),E(this,"z",pT,this)}return T(e,[{key:"update",value:function(n,w){if(this.enable){var k=1-n.remainingLifetime/n.startLifetime,C=n.randomSeed+p2,E=Xd(this.z)?tn(C):0,_=this.z.evaluate(k,E)*w,T=0,I=0;if(this.separateAxes){var L=Xd(this.x)?tn(C):0,D=Xd(this.y)?tn(C):0;T=this.x.evaluate(k,L)*w,I=this.y.evaluate(k,D)*w}n.node.eulerAngles=new eQ(n.node.eulerAngles.x+T,n.node.eulerAngles.y+I,n.node.eulerAngles.z+_)}}}]),e}()).prototype,"enable",[pf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pE=n(pk.prototype,"separateAxes",[pv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),p_=n(pk.prototype,"x",[pg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),pA=n(pk.prototype,"y",[pm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),pT=n(pk.prototype,"z",[pb,pw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),pS=pk))||pS);ew._RF.pop(),ew._RF.push({},"f63cd4ScDJFPrnTLNT4+QKu","ShapeModule",void 0);var p3,p5,p6,p8,p9,p7,de,dt=eS.ccclass,dn=eS.property,di=eU({Circle:0,Rectangle:1}),dr=eU({Base:0,Edge:1}),Nv=function(){return this.shape===di.Circle},zv=function(){return this.shape===di.Rectangle},da=[0,0],ds=(pO=dt("ShapeModule"),pL=dn({type:eU(di)}),pD=dn({type:eU(dr),visible:zv}),pM=dn({}),pN=dn({}),pz=dn({}),pB=dn({range:[0,360],visible:Nv}),pF=dn({range:[-360,360],visible:Nv}),px=dn({min:0,visible:Nv}),pU=dn({range:[0,1],step:.01,visible:Nv}),pG=dn({visible:zv}),pO((pq=n((pV=function(){function e(){C(this,e),E(this,"shape",pq,this),E(this,"emitFrom",pW,this),E(this,"position",pK,this),E(this,"rotation",pj,this),E(this,"scale",pY,this),E(this,"arc",pX,this),E(this,"angle",pZ,this),E(this,"radius",pJ,this),E(this,"radiusThickness",pQ,this),E(this,"rectangleThickness",p$,this)}return T(e,[{key:"emit",value:function(n){switch(this.shape){case di.Circle:this.circleEmit(this.radius,this.radiusThickness,tf(this.generateArcAngle()),n);break;case di.Rectangle:this.rectangleEmit(this.emitFrom,this.rectangleThickness,n)}}},{key:"circleEmit",value:function(n,w,k,C){var E=C.node.position;Yd(E,n*(1-w),n,k+tf(this.angle)),C.velocity=E.clone().normalize()}},{key:"rectangleEmit",value:function(n,w,k){var C,E,_,T=k.node.position;switch(n){case dr.Base:E=T,_=w,e4.set(E,ti(-_.x,_.x),ti(-_.y,_.y));break;case dr.Edge:da[0]=ti(-1,1),da[1]=(0===(C=ti(-1,1))&&C++,tp.sign(C)),function(n){for(var w=0;w<n.length;w++){var k=w+e9(0,n.length-w),C=n[k];n[k]=n[w],n[w]=C}}(da),this.applyRectThickness(da,w),e4.set(T,da[0],da[1])}k.velocity=T.clone().normalize()}},{key:"generateArcAngle",value:function(){return ti(0,this.arc)}},{key:"applyRectThickness",value:function(n,w){w.x>0&&(n[0]*=w.x),w.y>0&&(n[1]*=w.y)}},{key:"gizmo",value:function(n){switch(n.strokeColor.fromHEX("#46C4FFB0"),n.fillColor.fromHEX("#46C4FF77"),n.lineWidth=8,this.shape){case di.Circle:this.gizmoCircle(n);break;case di.Rectangle:this.gizmoRectangle(n)}}},{key:"gizmoCircle",value:function(n){n.clear();var w=this.angle,k=this.angle+this.arc;if(this.createArcPath(n,this.radius,w,k),this.createArcPath(n,this.radius*(1-this.radiusThickness),w,k),this.arc<360&&this.radius>0){var C=this.radius*Math.cos(tf(this.angle)),E=this.radius*Math.sin(tf(this.angle)),_=this.radius*Math.cos(tf(this.arc+this.angle)),T=this.radius*Math.sin(tf(this.arc+this.angle));n.moveTo(C,E),n.lineTo(0,0),n.moveTo(_,T),n.lineTo(0,0)}n.stroke()}},{key:"gizmoRectangle",value:function(n){n.clear();var w=this.rectangleThickness.x,k=this.rectangleThickness.y;n.moveTo(w,k),n.lineTo(-w,k),n.lineTo(-w,-k),n.lineTo(w,-k),n.close(),n.stroke()}},{key:"createArcPath",value:function(n,w,k,C){if(!(w<=0))for(var E=(C-k)/48,_=0;_<=48;_++){var T=k+_*E,I=w*Math.cos(tf(T)),L=w*Math.sin(tf(T));0===_?n.moveTo(I,L):n.lineTo(I,L)}}}]),e}()).prototype,"shape",[pL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return di.Circle}}),pW=n(pV.prototype,"emitFrom",[pD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dr.Base}}),pK=n(pV.prototype,"position",[pM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eQ(0,0,0)}}),pj=n(pV.prototype,"rotation",[pN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eQ(0,0,0)}}),pY=n(pV.prototype,"scale",[pz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eQ(1,1,1)}}),pX=n(pV.prototype,"arc",[pB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 360}}),pZ=n(pV.prototype,"angle",[pF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),pJ=n(pV.prototype,"radius",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),pQ=n(pV.prototype,"radiusThickness",[pU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),p$=n(pV.prototype,"rectangleThickness",[pG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e4(20,50)}}),pH=pV))||pH);ew._RF.pop(),ew._RF.push({},"1b7c1WztGdLzKO8gh4ulm2c","SizeOvertimeModule",void 0);var dl,du,dp,dd,dy,df,dv,dg,dm,db,dw,dS,dk,dC=eS.ccclass,dE=eS.property,d_=hj,dA=(p3=dC("SizeOvertimeModule"),p5=dE({type:eW}),p6=dE({type:hL}),p3((p7=n((p9=function(){function e(){C(this,e),E(this,"enable",p7,this),E(this,"size",de,this),this.size.constant=1}return T(e,[{key:"update",value:function(n){if(this.enable){var w=1-n.remainingLifetime/n.startLifetime,k=n.randomSeed+d_,C=Xd(this.size)?tn(k):0,E=this.size.evaluate(w,C);n.node.scale=new eQ(E*n.startSize.x,E*n.startSize.y,1)}}}]),e}()).prototype,"enable",[p5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),de=n(p9.prototype,"size",[p6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),p8=p9))||p8);ew._RF.pop(),ew._RF.push({},"530341yf3ZOmaqdU+AYM0/U","SpriteAnimationModule",void 0);var dT,dP,dR,dI,dO,dL,dD,dM,dN,dz=eS.ccclass,dB=eS.property,dF=hY,dx=(dl=dz("SpriteAnimationModule"),du=dB({type:eW}),dp=dB({type:e7}),dd=dB({type:hL}),dy=dB({type:hL}),df=dB({type:eD}),dl((dm=n((dg=function(){function e(){C(this,e),E(this,"enable",dm,this),E(this,"frames",db,this),E(this,"frameOverTime",dw,this),E(this,"startFrame",dS,this),E(this,"cycleCount",dk,this),this.frameOverTime.constant=0,this.startFrame.constant=0}return T(e,[{key:"update",value:function(n){if(this.enable){var w=1-n.remainingLifetime/n.startLifetime,k=Xd(this.startFrame)?tn(n.randomSeed+dF):0,C=Xd(this.frameOverTime)?tn(n.randomSeed+dF):0,E=this.startFrame.evaluate(w,k),_=to(this.cycleCount*(this.frameOverTime.evaluate(w,C)+E),this.frames.length);n.sprite.spriteFrame=this.frames[Math.floor(_)]}}}]),e}()).prototype,"enable",[du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),db=n(dg.prototype,"frames",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dw=n(dg.prototype,"frameOverTime",[dd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),dS=n(dg.prototype,"startFrame",[dy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),dk=n(dg.prototype,"cycleCount",[df],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dv=dg))||dv);ew._RF.pop(),ew._RF.push({},"f6ad5Yz6wpE2ZzModn16CYQ","VelocityOvertimeModule",void 0);var dU,dG,dH,dV,dq,dW,dK,dj,dY,dX,dZ,dJ,dQ,d$,d0,d1,d2,d4,d3,d5,d6,d8,d9,d7,ye,yt,yn,yi,yr,ya,yo,ys,yl,yu,yp,yd,yy,yf,yv,yg,ym,yb,yw,yS,yk,yC,yE,y_,yA,yT,yP,yR,yI=eS.ccclass,yO=eS.property,yL=(dT=yI("VelocityOvertimeModule"),dP=yO({type:eW}),dR=yO({type:hL}),dI=yO({type:hL}),dT((dD=n((dL=function(){function e(){C(this,e),E(this,"enable",dD,this),E(this,"x",dM,this),E(this,"y",dN,this),this._temp_v3=new eQ,this.x.constant=0,this.y.constant=0}return T(e,[{key:"update",value:function(n,w){if(this.enable){var k=1-n.remainingLifetime/n.startLifetime,C=Xd(this.x)?tn(n.randomSeed+hJ):0,E=Xd(this.y)?tn(n.randomSeed+hQ):0,_=eQ.set(this._temp_v3,this.x.evaluate(k,C),this.y.evaluate(k,E),0);eQ.add(n.velocity,n.velocity,_.multiplyScalar(w))}}}]),e}()).prototype,"enable",[dP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dM=n(dL.prototype,"x",[dR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),dN=n(dL.prototype,"y",[dI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),dO=dL))||dO);ew._RF.pop(),ew._RF.push({},"10bc3IfFqBLtpSgVri/NVeX","ParticleSystem",void 0);var yD,yM,yN,yz,yB,yF,yx,yU=eS.ccclass,yG=eS.property,yH=eS.executeInEditMode,yV=eS.disallowMultiple,yq=(dU=yU("ParticleSystem"),dG=yH(!0),dH=yV(!0),dV=yG({}),dq=yG(eW),dW=yG(eM),dK=yG(eW),dj=yG({type:hL}),dY=yG({type:hL}),dX=yG(hF),dZ=yG(eW),dJ=yG({type:hL,formerlySerializedAs:"startSize"}),dQ=yG({type:hL,visible:function(){return this.startSize2D}}),d$=yG({type:hL}),d0=yG(eW),d1=yG({type:hL,formerlySerializedAs:"startRotation"}),d2=yG({type:hL}),d4=yG({type:hL}),d3=yG({type:ds}),d5=yG({type:yL}),d6=yG({type:dA}),d8=yG({type:p4}),d9=yG({type:pt}),d7=yG({type:dx}),ye=yG({type:pd}),yt=yG(c$),yn=yG({type:pI}),dU(yi=dG(yi=dH((n((yr=function(n){w(u,n);var I=k(u);function u(){var n;return C(this,u),(n=I.call(this))._preview=!1,E(n,"playOnAwake",ya,_(n)),E(n,"duration",yo,_(n)),E(n,"loop",ys,_(n)),E(n,"startDelay",yl,_(n)),E(n,"startLifetime",yu,_(n)),E(n,"startColor",yp,_(n)),E(n,"startSize2D",yd,_(n)),E(n,"startSizeX",yy,_(n)),E(n,"startSizeY",yf,_(n)),E(n,"startSpeed",yv,_(n)),E(n,"startRotation3D",yg,_(n)),E(n,"startRotation",ym,_(n)),E(n,"gravityModifier",yb,_(n)),E(n,"rateOverTime",yw,_(n)),E(n,"shapeModule",yS,_(n)),E(n,"velocityOvertimeModule",yk,_(n)),E(n,"sizeOvertimeModule",yC,_(n)),E(n,"rotationOvertimeModule",yE,_(n)),E(n,"colorOvertimeModule",y_,_(n)),E(n,"spriteAnimationModule",yA,_(n)),E(n,"limitVelocityOvertimeModule",yT,_(n)),E(n,"bursts",yP,_(n)),E(n,"rendererModule",yR,_(n)),n.particles=[],n.time=0,n.emitRateTimeCounter=0,n.isPlaying=!1,n.isStopped=!0,n.isEmitting=!1,n.needToRestart=!1,n.startLifetime.constant=5,n.startSizeX.constant=1,n.startSpeed.constant=5,n.rateOverTime.constant=10,n}return T(u,[{key:"preview",get:function(){return this._preview},set:function(n){this._preview=n,this.graphics&&this.graphics.destroy()}},{key:"onEnable",value:function(){}},{key:"onLoad",value:function(){this.preview=null!==this.getComponent(ej),this.node.removeAllChildren()}},{key:"start",value:function(){this.node.position=new eQ(this.node.position.x,this.node.position.y,100),(this.playOnAwake&&!et||this.preview&&et)&&this.play()}},{key:"update",value:function(n){this.isPlaying&&(this.time+=n,this.emitting(n))}},{key:"play",value:function(){this.needToRestart&&(this.needToRestart=!1),this.isStopped&&(this.isStopped=!1),this.time=0,this.isPlaying=!0,this.isEmitting=!0}},{key:"stop",value:function(){this.isPlaying||(this.isPlaying=!1),this.isEmitting||(this.isEmitting=!1),this.isStopped=!0}},{key:"emitting",value:function(n){var w=this,k=this.startDelay.evaluate(0,1);if(this.time>k&&this.time>this.duration+k&&(this.loop||(this.isEmitting=!1)),this.isEmitting){if(this.emitRateTimeCounter+=this.rateOverTime.evaluate(this.time/this.duration,1)*n,this.emitRateTimeCounter>1){var C=Math.floor(this.emitRateTimeCounter);this.emitRateTimeCounter-=C,this.emit(C,n)}var E,_=L(this.bursts);try{for(_.s();!(E=_.n()).done;)E.value.update(this,n)}catch(n){_.e(n)}finally{_.f()}}var T=this.gravityModifier.evaluate(this.time/this.duration,1);this.particles.forEach(function(k,C){k.node.active&&(w.spriteAnimationModule.update(k),w.sizeOvertimeModule.update(k),w.rotationOvertimeModule.update(k,n),w.colorOvertimeModule.update(k),w.velocityOvertimeModule.update(k,n),w.applyGravityModifier(k,T),w.limitVelocityOvertimeModule.update(k,n),k.node.position.add(k.velocity.clone().multiplyScalar(n)),k.remainingLifetime-=n,k.remainingLifetime<=0&&(k.node.active=!1))})}},{key:"emit",value:function(n,w){if(null!==this.rendererModule.spriteFrame)for(var k=this.time%this.duration/this.duration,C=0;C<n;C++){var E=this.getFreeParticle();E.init(this),E.reset(),this.shapeModule.emit(E);var _=this.startSpeed.evaluate(k,this.rand());E.velocity=E.velocity.clone().multiplyScalar(_);var T=this.startSizeX.evaluate(k,this.rand()),I=this.startSize2D?new eQ(T,this.startSizeY.evaluate(k,this.rand()),1):new eQ(T,T,1);E.startSize=I.clone(),E.node.scale=I.clone();var L=this.startRotation.evaluate(k,this.rand());E.node.eulerAngles=new eQ(0,0,L),E.startColor=this.startColor.evaluate(k,this.rand()).clone(),E.sprite.color=E.startColor.clone(),E.startLifetime=this.startLifetime.evaluate(k,this.rand())+w,E.remainingLifetime=E.startLifetime,E.randomSeed=e9(0,233280)}}},{key:"applyGravityModifier",value:function(n,w){n.velocity.add(new eQ(0,-9.8*w,0))}},{key:"rand",value:function(){return tn(e9(0,tp.INT_MAX))}},{key:"getFreeParticle",value:function(){var n=this.particles.find(function(n){return!n.node.active});return n||(n=this.createParticle()),n.node.active=!0,n}},{key:"createParticle",value:function(){var n=new ek,w=eA(n),k=w.addComponent(hu),C=w.addComponent(ex);return this.particles.push(k),C.spriteFrame=this.rendererModule.spriteFrame,C.customMaterial=this.rendererModule.material,this.node.addChild(w),k}}]),u}(eL)).prototype,"preview",[dV],Object.getOwnPropertyDescriptor(yr.prototype,"preview"),yr.prototype),ya=n(yr.prototype,"playOnAwake",[dq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),yo=n(yr.prototype,"duration",[dW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),ys=n(yr.prototype,"loop",[dK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yl=n(yr.prototype,"startDelay",[dj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),yu=n(yr.prototype,"startLifetime",[dY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),yp=n(yr.prototype,"startColor",[dX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hF}}),yd=n(yr.prototype,"startSize2D",[dZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yy=n(yr.prototype,"startSizeX",[dJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),yf=n(yr.prototype,"startSizeY",[dQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),yv=n(yr.prototype,"startSpeed",[d$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),yg=n(yr.prototype,"startRotation3D",[d0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ym=n(yr.prototype,"startRotation",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),yb=n(yr.prototype,"gravityModifier",[d2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),yw=n(yr.prototype,"rateOverTime",[d4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new hL}}),yS=n(yr.prototype,"shapeModule",[d3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ds}}),yk=n(yr.prototype,"velocityOvertimeModule",[d5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new yL}}),yC=n(yr.prototype,"sizeOvertimeModule",[d6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dA}}),yE=n(yr.prototype,"rotationOvertimeModule",[d8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p4}}),y_=n(yr.prototype,"colorOvertimeModule",[d9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pt}}),yA=n(yr.prototype,"spriteAnimationModule",[d7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dx}}),yT=n(yr.prototype,"limitVelocityOvertimeModule",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pd}}),yP=n(yr.prototype,"bursts",[yG,yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yR=n(yr.prototype,"rendererModule",[yn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pI}}),yi=yr))||yi)||yi)||yi);ew._RF.pop(),ew._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var yW,yK,yj,yY,yX,yZ,yJ,yQ,y$,y0,y1,y2,y4,y3,y5,y6=eS.ccclass,y8=eS.property,y9=(yD=y6("ItemCollectionFX"),yM=y8(ex),yN=y8(yq),yD((yF=n((yB=function(n){w(u,n);var I=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"sprite",yF,_(n)),E(n,"particles",yx,_(n)),n}return T(u,[{key:"__preload",value:function(){B.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){var n,w=L(this.particles);try{for(w.s();!(n=w.n()).done;)n.value.play()}catch(n){w.e(n)}finally{w.f()}}}]),u}(eL)).prototype,"sprite",[yM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yx=n(yB.prototype,"particles",[yN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yz=yB))||yz);ew._RF.pop(),ew._RF.push({},"a7ff8uVnP1G3ppM9F/A5DYq","Cloud",void 0);var y7=eS.ccclass,fe=eS.property,ft=new eQ(1.2,1.2),fn=new eQ(0,300),fi=(yW=y7("Cloud"),yK=fe({type:ek}),yj=B.required,yY=fe(ek),yX=B.required,yZ=fe(ta),yJ=B.required,yQ=B.onlyRunInLifeCycleAsync,y$=B.onlyRunInLifeCycleAsync,yW((y2=n((y1=function(n){w(f,n);var I,L,D,M,F=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=F.call.apply(F,[this].concat(k)),E(n,"cloudSprites",y2,_(n)),E(n,"raysContainer",y4,_(n)),E(n,"rayPrefab",y3,_(n)),E(n,"rayPool",y5,_(n)),n.cacheDirectionVector=new eQ,n.scaleTweenSignal=new x,n.canvas=null,n}return T(f,[{key:"onLoad",value:function(){this.rayPool=new u8(this.createRay.bind(this),2,this.allocRay.bind(this),this.freeRay.bind(this),this.destroyRay.bind(this)),B.validateRequiredProperties(this,f)}},{key:"createRay",value:function(){var n=eA(this.rayPrefab);n.active=!1,this.raysContainer.addChild(n);var w=n.getComponent(e_),k=n.getComponent(te);if(!w||!k)throw new Error("Cloud.createRay: Invalid prefab");return{node:n,uiTransform:w,animation:k}}},{key:"allocRay",value:function(n){n.node.active=!0}},{key:"freeRay",value:function(n){n.node.active=!1}},{key:"destroyRay",value:function(n){n.node.isValid&&n.node.destroy()}},{key:"playInitAnimation",value:(M=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.moveToScreenCenter()];case 1:n.sent();return[2]}})}),function(){return M.apply(this,arguments)})},{key:"playLightningAnimation",value:(D=N(function(n){var w,k,C,E,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:w=this.rayPool.alloc(),k=w.node,C=w.uiTransform,E=w.animation;k.setWorldPosition(this.node.worldPosition),this.cacheDirectionVector.set(n),this.cacheDirectionVector.subtract(k.worldPosition);_=Math.atan2(this.cacheDirectionVector.y,this.cacheDirectionVector.x)*(180/Math.PI)+180-90,T=this.cacheDirectionVector.length()/C.height;k.setScale(T<1?T:1,T,1),k.angle=_;return[4,z.runAnimationAsync(E)];case 1:I.sent(),this.rayPool.free(w);return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"playScaleTween",value:(L=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:this.scaleTweenSignal.abort();n=new x;this.scaleTweenSignal=n;return[4,Promise.all(this.cloudSprites.map(function(w){return z.runTweenAsync(ez(w).to(.1,{scale:ft},{easing:"quadOut"}).to(.1,{scale:eQ.ONE},{easing:"quadOut"}),n)}))];case 1:w.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"moveToScreenCenter",value:(I=N(function(){var n,w,k,C,E,_,T,I,L;return _ts_generator(this,function(D){switch(D.label){case 0:if(this.canvas=null!==(n=null!==(w=this.canvas)&&void 0!==w?w:null===(k=e8("Canvas"))||void 0===k?void 0:k.getComponent(e_))&&void 0!==n?n:null,!this.canvas)return[3,2];C=this.canvas,E=C.width,_=C.height,T=0,I=0;switch(Math.floor(4*Math.random())){case 0:T=Math.random()*E-E/2,I=_/2+300;break;case 1:T=Math.random()*E-E/2,I=-_/2-300;break;case 2:T=-E/2-300,I=Math.random()*_-_/2;break;case 3:T=E/2+300,I=Math.random()*_-_/2}this.node.setPosition(T,I);L=ez(this.node).to(.8,{position:fn},{easing:"quadOut"});return[4,z.runTweenAsync(L)];case 1:D.sent();D.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})}]),f}(eL)).prototype,"cloudSprites",[yK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),y4=n(y1.prototype,"raysContainer",[yj,yY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y3=n(y1.prototype,"rayPrefab",[yX,yZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y5=n(y1.prototype,"rayPool",[yJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(y1.prototype,"playLightningAnimation",[yQ],Object.getOwnPropertyDescriptor(y1.prototype,"playLightningAnimation"),y1.prototype),n(y1.prototype,"playScaleTween",[y$],Object.getOwnPropertyDescriptor(y1.prototype,"playScaleTween"),y1.prototype),y0=y1))||y0);ew._RF.pop(),ew._RF.push({},"7df59GGBIxFo7OyHCGrEKe5","addItemEffect",void 0);var fr,fa,fo,fs,fl,fu,fh,fp,fd,fy,ff,fv,fg,fm,fb,fw,fS,fk=function(){var n=N(function(n,w){return _ts_generator(this,function(k){switch(k.label){case 0:n.playExplosionParticles(),H.playSound("sounds/item_reward");return[4,fC(n)];case 1:k.sent();return[4,z.waitTweenAsync(.8)];case 2:k.sent();return[4,fE(n,w)];case 3:k.sent();return[4,f_(n,w)];case 4:k.sent();return[2]}})});return function(w,k){return n.apply(this,arguments)}}(),fC=function(){var n=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=ez(n.node).to(.1,{scale:new eQ(.8,1.2,1)}).to(.1,{scale:new eQ(1.2,.8,1)}).to(.1,{scale:new eQ(1,1,1)});return[4,z.runTweenAsync(w)];case 1:k.sent();return[2]}})});return function(w){return n.apply(this,arguments)}}(),fE=function(){var n=N(function(n,w){var k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:k=w.node.worldPosition.clone().add3f(0,30,0),C=new eQ(.5,.5,.5),E=ez(n.node).to(1,{worldPosition:k,scale:C},{easing:"cubicInOut"});return[4,z.runTweenAsync(E)];case 1:_.sent();return[2]}})});return function(w,k){return n.apply(this,arguments)}}(),f_=function(){var n=N(function(n,w){var k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:k=w.node.worldPosition.clone(),C=k.clone().add3f(0,70,0),E=new eQ(.65,.65,.65),_=ez(n.node).to(.3,{worldPosition:C,scale:E},{easing:"cubicOut"}).to(.5,{worldPosition:k},{easing:"cubicIn"});return[4,z.runTweenAsync(_)];case 1:T.sent();return[2]}})});return function(w,k){return n.apply(this,arguments)}}();ew._RF.pop(),ew._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var fA,fT,fP,fR,fI,fO=eS.ccclass,fL=eS.property,fD=eS.disallowMultiple,fM=(fr=fO("ShiningStar"),fa=fL(ex),fo=fL({serializable:!0,visible:!1}),fs=fL({type:eM,displayName:"Scale up duration",min:.001}),fl=fL({serializable:!0,visible:!1}),fu=fL({type:eM,displayName:"Bounce and Fall duration",min:.001}),fh=fL({serializable:!0,visible:!1}),fp=fL({type:eM,displayName:"Start scale"}),fd=fL({serializable:!0,visible:!1}),fy=fL({type:eM,displayName:"End scale"}),fr(ff=fD((fg=n((fv=function(n){w(m,n);var I,L,D,M,F,x,U,G=k(m);function m(){var n;C(this,m);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=G.call.apply(G,[this].concat(k)),E(n,"shine",fg,_(n)),E(n,"twScaleUpDuration",fm,_(n)),E(n,"twBounceAndFallDuration",fb,_(n)),E(n,"twStartScale",fw,_(n)),E(n,"twEndScale",fS,_(n)),n.isBeingAnimated=!1,n}return T(m,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(n){this.twScaleUpDuration=n}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(n){this.twBounceAndFallDuration=n}},{key:"startScale",get:function(){return this.twStartScale},set:function(n){this.twStartScale=n}},{key:"endScale",get:function(){return this.twEndScale},set:function(n){this.twEndScale=n}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(eH),this.uiOpacity=this.node.getComponent(eH),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(U=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0;return[4,this.animateAppear()];case 1:n.sent();return[4,this.animateDisappear()];case 2:n.sent(),this.isBeingAnimated=!1;return[2]}})}),function(){return U.apply(this,arguments)})},{key:"animateAppear",value:(x=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:this.shineOpacity.opacity=255;return[4,Promise.all([this.animateFadeIn(),this.animateScaleUp()])];case 1:n.sent();return[2]}})}),function(){return x.apply(this,arguments)})},{key:"animateDisappear",value:(F=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,Promise.all([this.animateBounceAndFall(),this.animateScaleDown()])];case 1:n.sent(),this.node.setScale(0,0),this.uiOpacity.opacity=0;return[2]}})}),function(){return F.apply(this,arguments)})},{key:"animateBounceAndFall",value:(M=N(function(){var n,w,k,C,E,_,T,I,L,D;return _ts_generator(this,function(M){switch(M.label){case 0:n=this.node.position.x,w=this.node.position.y,k=[60,120],C=(Math.random()*(k[1]-k[0])+k[0])*(Math.PI/180),E=n+200*Math.cos(C),_=w+200*Math.sin(C),T=w-500,I=z.runTweenAsync(ez(this.node).to(.2*this.twBounceAndFallDuration,{position:new eQ(E,_,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new eQ(E,T,this.node.position.z)},{easing:"cubicIn"})),L=[0,360],D=z.runTweenAsync(ez(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new eQ(0,0,Math.random()*(L[1]-L[0])*(E>n?-1:1))},{easing:"sineOut"}));return[4,Promise.all([I,D])];case 1:M.sent(),this.node.eulerAngles=new eQ(0,0,0);return[2]}})}),function(){return M.apply(this,arguments)})},{key:"animateFadeIn",value:(D=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:n=Math.max(this.scaleUpDuration/4,.01);return[4,z.runTweenAsync(ez(this.uiOpacity).to(n,{opacity:255}))];case 1:w.sent();return[2]}})}),function(){return D.apply(this,arguments)})},{key:"animateScaleUp",value:(L=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:this.node.setScale(this.startScale,this.startScale);n=new eQ(this.endScale,this.endScale,1);return[4,z.runTweenAsync(ez(this.node).to(this.scaleUpDuration,{scale:n},{easing:"cubicOut"}))];case 1:w.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"animateScaleDown",value:(I=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:n=new eQ(0,0,1);return[4,z.runTweenAsync(ez(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:n},{easing:"cubicIn"}))];case 1:w.sent();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}}]),m}(eL)).prototype,"shine",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm=n(fv.prototype,"twScaleUpDuration",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),n(fv.prototype,"scaleUpDuration",[fs],Object.getOwnPropertyDescriptor(fv.prototype,"scaleUpDuration"),fv.prototype),fb=n(fv.prototype,"twBounceAndFallDuration",[fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),n(fv.prototype,"bounceAndFallDuration",[fu],Object.getOwnPropertyDescriptor(fv.prototype,"bounceAndFallDuration"),fv.prototype),fw=n(fv.prototype,"twStartScale",[fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),n(fv.prototype,"startScale",[fp],Object.getOwnPropertyDescriptor(fv.prototype,"startScale"),fv.prototype),fS=n(fv.prototype,"twEndScale",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),n(fv.prototype,"endScale",[fy],Object.getOwnPropertyDescriptor(fv.prototype,"endScale"),fv.prototype),ff=fv))||ff)||ff);ew._RF.pop(),ew._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var fN,fz,fB,fF,fx,fU,fG,fH,fV,fq,fW,fK,fj,fY,fX,fZ,fJ,fQ,f$,f0,f1,f2,f4,f3,f5,f6,f8,f9,f7,ve,vt,vn,vi,vr,va,vo,vs,vl,vu,vp,vd,vy,vf,vv,vg,vm=eS.ccclass,vb=eS.property,vw=eS.disallowMultiple,vS=GameCore.Utils.Array,vk=(fA=vm("StarParticles"),fT=vb({type:[fM],displayName:"Prebuilt Shining stars"}),fA(fP=vw((fI=n((fR=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"shiningStars",fI,_(n)),n}return T(u,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(I=N(function(n){var w,k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:w=this.getFirstAvailableShiningStar();if(void 0===w)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");k=Q(n,2),C=k[0],E=k[1],_=new eQ(C,E,this.node.worldPosition.z);w.node.worldPosition=_;return[4,w.playAnimation()];case 1:T.sent();return[2]}})}),function(n){return I.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return vS.search(this.shiningStars,function(n){return n.isAvailable})}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}}]),u}(eL)).prototype,"shiningStars",[fT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fP=fR))||fP)||fP);ew._RF.pop(),ew._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var vC=GameCore.Utils.Valid,vE=eS.ccclass,v_=eS.property,vA=globalThis.game.monitorError,vT=eQ.ONE.clone().multiplyScalar(.5),vP=(fN=vE("EffectManager"),fz=B.required,fB=v_({group:"Thunder Effect",type:fi}),fF=B.required,fx=v_({group:"Mask Effect",type:iA}),fU=B.required,fG=v_({group:"Mask Effect",type:ek}),fH=B.required,fV=v_({group:"Tornado Effect",type:ek}),fq=B.required,fW=v_({group:"Clear Particle Effect",type:ek,displayName:"Particle holder node"}),fK=B.required,fj=v_({group:"Clear Particle Effect",type:yq,displayName:"Emitter 1"}),fY=B.required,fX=v_({group:"Clear Particle Effect",type:yq,displayName:"Emitter 2"}),fZ=B.required,fJ=v_({group:"Star Particles Effect",type:vk}),fQ=B.required,f$=v_({group:"Confetti Effect",type:yq}),f0=v_({group:"Add Item Effect",type:y9}),f1=v_({group:"Add Item Effect",type:e7}),f2=v_({group:"Add Item Effect",type:e7}),f4=v_({group:"Add Item Effect",type:e7}),f3=v_({group:"Add Item Effect",type:e7}),f5=B.required,f6=v_({type:ek,displayName:"Clear Explosion Container",group:"Clear Explosion Effect"}),f8=B.onlyRunInLifeCycle,f9=B.onlyRunInLifeCycleAsync,fN((vt=n((ve=function(n){w(O,n);var I,D,M,U,G,V,q,W,K,j,Y,X,J,$=k(O);function O(){var n;C(this,O);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=$.call.apply($,[this].concat(k)),E(n,"cloud",vt,_(n)),E(n,"backgroundMask",vn,_(n)),E(n,"masks",vi,_(n)),E(n,"tornado",vr,_(n)),E(n,"clearParticleHolder",va,_(n)),E(n,"clearParticle1",vo,_(n)),E(n,"clearParticle2",vs,_(n)),E(n,"starParticle",vl,_(n)),E(n,"confetti",vu,_(n)),E(n,"itemEffect",vp,_(n)),E(n,"hintSpriteFrame",vd,_(n)),E(n,"thunderSpriteFrame",vy,_(n)),E(n,"tornadoSpriteFrame",vf,_(n)),E(n,"pliersSpriteFrame",vv,_(n)),n.maskTargets=[],n.vibrate=null,n.gameShakeSignal=new x,E(n,"clearExplosionContainer",vg,_(n)),n}return T(O,[{key:"__preload",value:function(){B.validateRequiredProperties(this,O)}},{key:"update",value:function(){if(this.maskTargets.length>0)for(var n=0;n<this.maskTargets.length;n++){var w=this.maskTargets[n];if(!w.isHidden()){var k=this.masks[n];k&&k.setWorldPosition(w.node.worldPosition)}}}},{key:"onEnable",value:function(){this.node.scene.on(i7.GRID_RESIZE,this.handleBoardResize,this)}},{key:"onDisable",value:function(){this.node.scene.off(i7.GRID_RESIZE,this.handleBoardResize,this)}},{key:"handleBoardResize",value:function(n){this.clearParticleHolder.setScale(n,n),this.clearExplosionContainer.setScale(n,n)}},{key:"playClearEffectAt",value:function(n){this.clearParticle1.node.setWorldPosition(n[0].x,n[0].y,1),this.clearParticle2.node.setWorldPosition(n[1].x,n[1].y,1),this.clearParticle1.play(),this.clearParticle2.play()}},{key:"playStarEffectAt",value:function(n){this.starParticle.fireShiningStarAt(n)}},{key:"playConfettiEffect",value:function(){var n,w=L(this.confetti);try{for(w.s();!(n=w.n()).done;)n.value.play()}catch(n){w.e(n)}finally{w.f()}}},{key:"playTornadoAnimation",value:(J=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:F.setBlockInput(!0),this.tornado.active=!0,this.tornado.setScale(eQ.ZERO);return[4,z.runTweenAsync(ez(this.tornado).to(.5,{scale:eQ.ONE},{easing:"quadOut"}).to(.5,{scale:vT},{easing:"quadInOut"}).to(.5,{scale:eQ.ONE},{easing:"quadInOut"}).to(.5,{scale:eQ.ZERO},{easing:"quadInOut"}))];case 1:n.sent(),this.tornado.active=!1,F.setBlockInput(!1);return[2]}})}),function(){return J.apply(this,arguments)})},{key:"playThunderAnimation",value:(X=N(function(n,w){var k,C,E,_,T,I,L,D;return _ts_generator(this,function(M){switch(M.label){case 0:this.resetMasks();k=Q(n,2),C=Q(k[0],2),E=C[0],_=C[1],T=Q(k[1],2),I=T[0],L=T[1];this.setMaskProperties(0,E.node.worldPosition,E.node.worldScale),this.setMaskProperties(1,_.node.worldPosition,_.node.worldScale),this.setMaskProperties(2,I.node.worldPosition,I.node.worldScale),this.setMaskProperties(3,L.node.worldPosition,L.node.worldScale),this.maskTargets=[E,_,I,L];return[4,this.setBackgroundMaskActive(!0)];case 1:M.sent(),this.cloud.node.active=!0;return[4,this.cloud.playInitAnimation()];case 2:M.sent();return[4,z.waitTweenAsync(.2)];case 3:M.sent();D=[];D.push(this.performCloudEffectToTiles(E,_,w,.1));return[4,z.waitTweenAsync(.5)];case 4:M.sent(),D.push(this.performCloudEffectToTiles(I,L,w,.1));return[4,Promise.all(D)];case 5:M.sent(),this.cloud.node.active=!1;return[4,this.setBackgroundMaskActive(!1)];case 6:M.sent(),this.maskTargets=[];return[2]}})}),function(n,w){return X.apply(this,arguments)})},{key:"playItemAddAnimation",value:(Y=N(function(n,w){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=w.itemType;if(!k)return[3,3];return[4,z.waitTweenAsync(.2)];case 1:switch(C.sent(),this.itemEffect.node.active=!0,this.itemEffect.node.parent=e8("Canvas"),this.itemEffect.node.worldPosition=n,this.itemEffect.node.scale=eQ.ONE,k){case Z.HINT:this.itemEffect.sprite.spriteFrame=this.hintSpriteFrame;break;case Z.THUNDER:this.itemEffect.sprite.spriteFrame=this.thunderSpriteFrame;break;case Z.STORM:this.itemEffect.sprite.spriteFrame=this.tornadoSpriteFrame;break;case Z.PLIERS:this.itemEffect.sprite.spriteFrame=this.pliersSpriteFrame}return[4,fk(this.itemEffect,w)];case 2:C.sent(),this.itemEffect.node.active=!1;C.label=3;case 3:return[2]}})}),function(n,w){return Y.apply(this,arguments)})},{key:"playMultiThunderAnimation",value:(j=N(function(n,w,k){var C,E,_,T,I,L,D;return _ts_generator(this,function(M){switch(M.label){case 0:this.resetMasks(),this.cloud.node.active=!0;return[4,this.cloud.playInitAnimation()];case 1:M.sent();return[4,z.waitTweenAsync(.2)];case 2:M.sent(),w.clear(n,k);C=[],E=0,_=2*n.length;M.label=3;case 3:if(!(E<_))return[3,8];T=n[Math.floor(E/2)];if(!(void 0!==T))return[3,7];I=T[E%2];L=void 0!==I;if(!L)return[3,6];0!==E&&E%2==0&&(this.node.scene.emit(i7.ADD_COMBO),this.node.scene.emit(i7.ADD_SCORE)),this.shakeGame(),this.shakeScreen(500),H.playSound(nI.THUNDERBOLT),C.push(this.cloud.playLightningAnimation(I.node.worldPosition)),C.push(this.cloud.playScaleTween());D=k;if(!D)return[3,5];return[4,z.waitTweenAsync(k)];case 4:D=M.sent();M.label=5;case 5:L=D;M.label=6;case 6:M.label=7;case 7:E++;return[3,3];case 8:return[4,Promise.all(C)];case 9:M.sent(),this.cloud.node.active=!1;return[4,this.setBackgroundMaskActive(!1)];case 10:M.sent();return[2]}})}),function(n,w,k){return j.apply(this,arguments)})},{key:"performCloudEffectToTiles",value:(K=N(function(n,w,k,C){var E,_;return _ts_generator(this,function(T){switch(T.label){case 0:this.shakeGame(),this.shakeScreen(500),H.playSound(nI.THUNDERBOLT),k.clear([[n,w]],C),this.node.scene.emit(i7.ADD_COMBO),this.node.scene.emit(i7.ADD_SCORE);E=[];E.push(this.createClearExplosionAt(n.node.worldPosition)),E.push(this.cloud.playLightningAnimation(n.node.worldPosition)),E.push(this.cloud.playScaleTween());_=C;if(!_)return[3,2];return[4,z.waitTweenAsync(C)];case 1:_=T.sent();T.label=2;case 2:E.push(this.createClearExplosionAt(w.node.worldPosition)),E.push(this.cloud.playLightningAnimation(w.node.worldPosition));return[4,Promise.all(E)];case 3:T.sent();return[2]}})}),function(n,w,k,C){return K.apply(this,arguments)})},{key:"shakeScreen",value:function(n){var w,k,C=arguments.length>0&&void 0!==n?n:500;this.vibrate=null!==(w=this.vibrate)&&void 0!==w?w:this.node.getComponent(sw),null===(k=this.vibrate)||void 0===k||k.vibrate(C)}},{key:"loadDefuseExplosionPool",value:(W=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:if(this.defuseExplosionPool)return[2,this.defuseExplosionPool];return[4,F.loadPrefabAsync(ee.BOMB_DEFUSE_PREFAB)];case 1:n=w.sent();if(null!==n)return[2,(this.defuseExplosionPool=function(n,w){return new u8(function(){var k=eA(n),C=k.getComponent(te);if(!C)throw new Error("DefuseExplosion: No animation component found in bombDefuseExplosionPrefab");return w.addChild(k),k.active=!1,{node:k,animation:C}},1,function(n){n.node.active=!0},function(n){n.node.active=!1},function(n){n.node.destroy()})}(n,this.node),this.defuseExplosionPool)];this.reportOrThrowInDebugger("Failed to load prefab","createDefuseExplosionAt");return[2]}})}),function(){return W.apply(this,arguments)})},{key:"loadBombExplosionPool",value:(q=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:if(this.bombExplosionPool)return[2,this.bombExplosionPool];return[4,F.loadPrefabAsync(ee.BOMB_EXPLODE_PREFAB)];case 1:n=w.sent();if(null!==n)return[2,(this.bombExplosionPool=function(n,w){return new u8(function(){var k=eA(n),C=k.getComponent(te);if(!C)throw new Error("BombExplosion: No animation component found in bombExplosionPrefab");return w.addChild(k),k.active=!1,{node:k,animation:C}},1,function(n){n.node.active=!0},function(n){n.node.active=!1},function(n){n.node.destroy()})}(n,this.node),this.bombExplosionPool)];this.reportOrThrowInDebugger("Failed to load prefab","createBombExplosionAt");return[2]}})}),function(){return q.apply(this,arguments)})},{key:"loadClearExplosionPool",value:(V=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:if(this.clearExplosionPool)return[2,this.clearExplosionPool];return[4,F.loadPrefabAsync(ee.CLEAR_EXPLOSION_PREFAB)];case 1:n=w.sent();if(null!==n)return[2,(this.clearExplosionPool=function(n,w){return new u8(function(){var k=eA(n),C=k.getComponent(e_),E=k.getComponent(te);if(!C||!E)throw new Error("ClearExplosion: Invalid prefab");return w.addChild(k),k.active=!1,{node:k,uiTransform:C,animation:E}},2,function(n){n.node.active=!0},function(n){n.node.active=!1},function(n){n.node.destroy()})}(n,this.clearExplosionContainer),this.clearExplosionPool)];this.reportOrThrowInDebugger("Failed to load prefab","createClearExplosionAt");return[2]}})}),function(){return V.apply(this,arguments)})},{key:"createDefuseExplosionAt",value:(G=N(function(n,w){var k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:return[4,this.loadDefuseExplosionPool()];case 1:k=T.sent();if(!k)return[3,3];C=k.alloc(),E=C.node,_=C.animation;E.setWorldPosition(n,w,0);return[4,z.runAnimationAsync(_)];case 2:T.sent(),k.free(C);T.label=3;case 3:return[2]}})}),function(n,w){return G.apply(this,arguments)})},{key:"createBombExplosionAt",value:(U=N(function(n){var w,k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,this.loadBombExplosionPool()];case 1:w=_.sent();if(!w)return[3,3];k=w.alloc(),C=k.node,E=k.animation;C.setWorldPosition(n);return[4,z.runAnimationAsync(E)];case 2:_.sent(),w.free(k);_.label=3;case 3:return[2]}})}),function(n){return U.apply(this,arguments)})},{key:"createClearExplosionAt",value:(M=N(function(n){var w,k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,this.loadClearExplosionPool()];case 1:w=_.sent();if(!w)return[3,3];k=w.alloc(),C=k.node,E=k.animation;C.setWorldPosition(n);return[4,z.runAnimationAsync(E)];case 2:_.sent(),w.free(k);_.label=3;case 3:return[2]}})}),function(n){return M.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(D=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:n&&(this.backgroundMask.node.active=!0);return[4,this.backgroundMask.changeStateFade(n,.25)];case 1:w.sent(),n||(this.backgroundMask.node.active=!1);return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"resetMasks",value:function(){var n,w=L(this.masks);try{for(w.s();!(n=w.n()).done;)n.value.worldPosition=new eQ(-9999,-9999,0)}catch(n){w.e(n)}finally{w.f()}}},{key:"setMaskProperties",value:function(n,w,k){var C=this.masks[n];C&&(k&&(C.worldScale=k),C.worldPosition=w)}},{key:"shakeGame",value:(I=N(function(){var n,w,k,C,E,_,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:n=this;this.gameShakeSignal.abort();w=new x;this.gameShakeSignal=w;k=this.node.position.clone(),C=ti(-10,10),E=ti(-10,10),_=k.clone().add3f(C,E,0),T=k.clone().add3f(-C,-E,0),I=ez(this.node).to(.05,{position:_}).to(.05,{position:T}).to(.05,{position:k});w.addAbortListener(function(){n.node.setPosition(k)});return[4,z.runTweenAsync(I,w)];case 1:L.sent();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"reportOrThrowInDebugger",value:function(n,w){var k=arguments.length>0&&void 0!==n?n:"Unknown error thrown",C=arguments.length>1&&void 0!==w?w:"Board",E=new Error("".concat(C,": ").concat(k));if(vC.isDebugger())throw E;null==vA||vA.sendException(E)}}]),O}(eL)).prototype,"cloud",[fz,fB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vn=n(ve.prototype,"backgroundMask",[fF,fx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vi=n(ve.prototype,"masks",[fU,fG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vr=n(ve.prototype,"tornado",[fH,fV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),va=n(ve.prototype,"clearParticleHolder",[fq,fW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vo=n(ve.prototype,"clearParticle1",[fK,fj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vs=n(ve.prototype,"clearParticle2",[fY,fX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vl=n(ve.prototype,"starParticle",[fZ,fJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vu=n(ve.prototype,"confetti",[fQ,f$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vp=n(ve.prototype,"itemEffect",[f0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vd=n(ve.prototype,"hintSpriteFrame",[f1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vy=n(ve.prototype,"thunderSpriteFrame",[f2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vf=n(ve.prototype,"tornadoSpriteFrame",[f4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vv=n(ve.prototype,"pliersSpriteFrame",[f3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vg=n(ve.prototype,"clearExplosionContainer",[f5,f6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(ve.prototype,"shakeScreen",[f8],Object.getOwnPropertyDescriptor(ve.prototype,"shakeScreen"),ve.prototype),n(ve.prototype,"shakeGame",[f9],Object.getOwnPropertyDescriptor(ve.prototype,"shakeGame"),ve.prototype),f7=ve))||f7);ew._RF.pop(),ew._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var vR="newbie",vI="timer",vO="combo",vL="hint-item",vD="thunder-item",vM="storm-item",vN="pliers-item";ew._RF.pop(),ew._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var vz=function(){function e(n){var w=this;C(this,e),this.alignSkipButton=function(){var n=w.gameplay.board,k=w.manager.guideUi.guideSkipButton;if(k){var C=k.parent;if(C){var E=n.getTileAt(n.getGridSize()[0]-1,n.getGridSize()[1]-1);if(E){var _=n.tilesHolder.getWorldScale(),T=n.getTileSize()[1]*_.y,I=E.node.worldPosition.clone().add3f(T/2,T/2,0),L=U.cssSizeToWorldSize(U.getScreenHeightCss()),D=I.x-C.getComponent(e_).width/2,M=Math.min(I.y+100,L-(L-I.y)/2);C.setWorldPosition(D,M,0)}}}},this.manager=n,this.gameplay=n.gameplay}var n,w;return T(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(i7.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(i7.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.on(i7.GRID_RESIZE,this.handleViewResized,this),this.manager.guideUi.guideSkipButton.on(e_.EventType.SIZE_CHANGED,this.alignSkipButton,this),this.showStep(this.currentStep),this.manager.node.scene.emit(i7.HIDE_UI)}},{key:"showNextStep",value:function(){this.currentStep+1<ui.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(w=N(function(n){var w,k,C,E,_,T,I,L,D,M,N,z,B;return _ts_generator(this,function(F){switch(F.label){case 0:w=this.gameplay,k=w.board,C=w.effectManager,E=ui[n].startTile,_=ui[n].endTile,T=k.getTileAt(E.x,E.y),I=k.getTileAt(_.x,_.y);if(!(T&&I))return[3,3];L=T.node.worldPosition,D=I.node.worldPosition;C.resetMasks(),C.setMaskProperties(0,L,T.node.worldScale),C.setMaskProperties(1,D,I.node.worldScale),C.setBackgroundMaskActive(!0);M=this.manager.guideUi,N=M.guideHand,z=M.guideTextBox,B=M.guideSkipButton;N.node.active=!0,B.active=!0,N.playHandAnimation(L,D),this.alignGuideTextBox(),this.alignSkipButton();return[4,z.hide()];case 1:F.sent(),z.setLocalizedText(ui[n].localeTextKey);return[4,z.show()];case 2:F.sent(),k.setIgnoreInput(!0),T.setIgnoreInput(!1),I.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1);F.label=3;case 3:return[2]}})}),function(n){return w.apply(this,arguments)})},{key:"handleViewResized",value:function(){var n=this.gameplay,w=n.board,k=n.effectManager,C=ui[this.currentStep].startTile,E=ui[this.currentStep].endTile,_=w.getTileAt(C.x,C.y),T=w.getTileAt(E.x,E.y);if(_&&T){var I=_.node.worldPosition,L=T.node.worldPosition;k.setMaskProperties(0,I,_.node.worldScale),k.setMaskProperties(1,L,T.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}}},{key:"alignGuideTextBox",value:function(){var n=this.gameplay.board,w=this.manager.guideUi.guideTextBox,k=n.getTileAt(0,0);if(k){var C=n.tilesHolder.getWorldScale(),E=n.getTileSize()[1]*C.y,_=k.node.worldPosition.y-E/2,T=w.widget.bottom+(_-w.widget.bottom)/2;w.node.setWorldPosition(w.node.worldPosition.x,T,0);var I=Math.max(Math.min(223,.85*(_-w.widget.bottom)),10),L=.7261538461538461*C.x;w.uiTransform.setContentSize(628*L,I)}}},{key:"close",value:(n=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=this.gameplay,w=n.board,k=n.effectManager;this.manager.node.scene.off(i7.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(i7.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.off(i7.GRID_RESIZE,this.handleViewResized,this),this.manager.guideUi.guideSkipButton.off(e_.EventType.SIZE_CHANGED,this.alignSkipButton,this),w.setIgnoreInput(!1);return[4,Promise.all([this.manager.guideUi.guideTextBox.hide(),k.setBackgroundMaskActive(!1)])];case 1:C.sent(),this.manager.guideUi.guideHand.node.active=!1,this.manager.completeGuide(vR);return[2]}})}),function(){return n.apply(this,arguments)})}]),e}();ew._RF.pop(),ew._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var vB=function(){function e(n){C(this,e),this.manager=n,this.gameplay=n.gameplay}var n,w;return T(e,[{key:"setup",value:(w=N(function(){var n,w,k,C,E,_,T,I,L;return _ts_generator(this,function(D){switch(D.label){case 0:n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=n.guideInfoTextLocalizer,E=this.gameplay.uiManager.currentLayout.clock,_=E.getComponent(e_).contentSize,T=_.width,I=_.height,L=E.node.worldPosition;T*=1.5,I*=1.5;return[4,this.gameplay.handleShowUI()];case 1:D.sent(),w.node.active=!0,w.setOtherMaskTransform(L.x,L.y,T,I),k.node.active=!0,C.key="guide.timer",k.node.setWorldPosition(L.x,L.y-I/2-50,0),k.horizontalAlign=tv.CENTER,k.getComponent(e_).setAnchorPoint(.5,.5);return[4,w.show()];case 2:D.sent(),this.manager.node.scene.once(i7.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(i7.PAUSE_TIME),eY.on(q.VIEW_RESIZED,this.handleViewResized,this),eY.on(q.ORIENTATION_CHANGED,this.handleViewResized,this);return[2]}})}),function(){return w.apply(this,arguments)})},{key:"handleViewResized",value:function(){var n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=this.gameplay.uiManager.currentLayout.clock,E=C.getComponent(e_).contentSize,_=E.width,T=E.height,I=C.node.worldPosition;_*=1.5,T*=1.5,w.setOtherMaskTransform(I.x,I.y,_,T),k.node.setWorldPosition(I.x,I.y-T/2-50,0)}},{key:"close",value:(n=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=this.manager.guideUi,w=n.guideInfoText,k=n.guideMasks;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(i7.RESUME_TIME);return[4,k.hide()];case 1:C.sent(),w.node.active=!1,this.manager.completeGuide(vI),this.unlistenEvents();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){eY.off(q.VIEW_RESIZED,this.handleViewResized,this),eY.off(q.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();ew._RF.pop(),ew._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var vF=function(){function e(n){C(this,e),this.manager=n,this.gameplay=n.gameplay}var n,w;return T(e,[{key:"setup",value:(w=N(function(){var n,w,k,C,E,_,T,I,L;return _ts_generator(this,function(D){switch(D.label){case 0:n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=n.guideInfoTextLocalizer,E=this.gameplay.uiManager.comboContainer,_=E.getComponent(e_).contentSize,T=_.width,I=_.height,L=E.node.worldPosition;T*=1.5,I*=1.5,w.node.active=!0,w.setOtherMaskTransform(L.x,L.y,T,I),k.node.active=!0,C.key="guide.combo",k.node.setWorldPosition(L.x-T/2-10,L.y,0),k.horizontalAlign=tv.RIGHT,k.getComponent(e_).setAnchorPoint(1,.5);return[4,w.show()];case 1:D.sent(),this.manager.node.scene.once(i7.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(i7.PAUSE_TIME),eY.on(q.VIEW_RESIZED,this.handleViewResized,this),eY.on(q.ORIENTATION_CHANGED,this.handleViewResized,this);return[2]}})}),function(){return w.apply(this,arguments)})},{key:"handleViewResized",value:function(){var n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=this.gameplay.uiManager.comboContainer,E=C.getComponent(e_).contentSize,_=E.width,T=E.height,I=C.node.worldPosition;_*=1.5,T*=1.5,w.setOtherMaskTransform(I.x,I.y,_,T),k.node.setWorldPosition(I.x-_/2-10,I.y,0)}},{key:"close",value:(n=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText;this.manager.node.scene.emit(i7.RESUME_TIME),w.node.off(ek.EventType.TOUCH_START,this.close,this);return[4,w.hide()];case 1:C.sent(),k.node.active=!1,this.manager.completeGuide(vO),this.unlistenEvents();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){eY.off(q.VIEW_RESIZED,this.handleViewResized,this),eY.off(q.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();ew._RF.pop(),ew._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var vx=GameCore.Utils.Array,vU=function(){function e(n){C(this,e),this.manager=n,this.gameplay=n.gameplay}var n,w;return T(e,[{key:"setup",value:(w=N(function(){var n,w,k,C,E,_,T,I,L;return _ts_generator(this,function(D){switch(D.label){case 0:n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=n.guideInfoTextLocalizer,E=vx.search(this.gameplay.uiManager.items,function(n){return n.itemType===Z.HINT});if(!E)return[3,2];_=E.node.worldPosition,T=E.getComponent(e_).contentSize,I=T.width,L=T.height;I+=40,L+=40,w.node.active=!0,w.setItemMaskTransform(_.x,_.y,I,L),k.node.active=!0,C.key="guide.hint",k.node.setPosition(0,0),k.node.setWorldPosition(k.node.worldPosition.x,_.y+L/2+30,0),k.horizontalAlign=tv.CENTER,k.getComponent(e_).setAnchorPoint(.5,.5);return[4,w.show()];case 1:D.sent(),this.manager.node.scene.once(i7.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(i7.PAUSE_TIME),eY.on(q.VIEW_RESIZED,this.handleViewResized,this),eY.on(q.ORIENTATION_CHANGED,this.handleViewResized,this);D.label=2;case 2:return[2]}})}),function(){return w.apply(this,arguments)})},{key:"handleViewResized",value:function(){var n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=vx.search(this.gameplay.uiManager.items,function(n){return n.itemType===Z.HINT});if(C){var E=C.node.worldPosition,_=C.getComponent(e_).contentSize,T=_.width,I=_.height;T+=40,I+=40,w.setItemMaskTransform(E.x,E.y,T,I),k.node.setWorldPosition(k.node.worldPosition.x,E.y+I/2+30,0)}}},{key:"close",value:(n=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText;this.manager.node.scene.emit(i7.RESUME_TIME);return[4,w.hide()];case 1:C.sent(),k.node.active=!1,this.manager.completeGuide(vL),this.unlistenEvents();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){eY.off(q.VIEW_RESIZED,this.handleViewResized,this),eY.off(q.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();ew._RF.pop(),ew._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var vG=GameCore.Utils.Array,vH=function(){function e(n){C(this,e),this.manager=n,this.gameplay=n.gameplay}var n,w;return T(e,[{key:"setup",value:(w=N(function(){var n,w,k,C,E,_,T,I,L;return _ts_generator(this,function(D){switch(D.label){case 0:n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=n.guideInfoTextLocalizer,E=vG.search(this.gameplay.uiManager.items,function(n){return n.itemType===Z.THUNDER});if(!E)return[3,2];_=E.node.worldPosition,T=E.getComponent(e_).contentSize,I=T.width,L=T.height;I+=40,L+=40,w.node.active=!0,w.setItemMaskTransform(_.x,_.y,I,L),k.node.active=!0,C.key="guide.thunder",k.node.setPosition(0,0),k.node.setWorldPosition(k.node.worldPosition.x,_.y+L/2+30,0),k.horizontalAlign=tv.CENTER,k.getComponent(e_).setAnchorPoint(.5,.5);return[4,w.show()];case 1:D.sent(),this.manager.node.scene.once(i7.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(i7.PAUSE_TIME),eY.on(q.VIEW_RESIZED,this.handleViewResized,this),eY.on(q.ORIENTATION_CHANGED,this.handleViewResized,this);D.label=2;case 2:return[2]}})}),function(){return w.apply(this,arguments)})},{key:"handleViewResized",value:function(){var n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=vG.search(this.gameplay.uiManager.items,function(n){return n.itemType===Z.THUNDER});if(C){var E=C.node.worldPosition,_=C.getComponent(e_).contentSize,T=_.width,I=_.height;T+=40,I+=40,w.setItemMaskTransform(E.x,E.y,T,I),k.node.setWorldPosition(k.node.worldPosition.x,E.y+I/2+30,0)}}},{key:"close",value:(n=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText;this.manager.node.scene.emit(i7.RESUME_TIME);return[4,w.hide()];case 1:C.sent(),k.node.active=!1,this.manager.completeGuide(vD),this.unlistenEvents();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){eY.off(q.VIEW_RESIZED,this.handleViewResized,this),eY.off(q.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();ew._RF.pop(),ew._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var vV=GameCore.Utils.Array,vq=function(){function e(n){C(this,e),this.manager=n,this.gameplay=n.gameplay}var n,w;return T(e,[{key:"setup",value:(w=N(function(){var n,w,k,C,E,_,T,I,L;return _ts_generator(this,function(D){switch(D.label){case 0:n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=n.guideInfoTextLocalizer,E=vV.search(this.gameplay.uiManager.items,function(n){return n.itemType===Z.STORM});if(!E)return[3,2];_=E.node.worldPosition,T=E.getComponent(e_).contentSize,I=T.width,L=T.height;I+=40,L+=40,w.node.active=!0,w.setItemMaskTransform(_.x,_.y,I,L),k.node.active=!0,C.key="guide.storm",k.node.setPosition(0,0),k.node.setWorldPosition(k.node.worldPosition.x,_.y+L/2+30,0),k.horizontalAlign=tv.CENTER,k.getComponent(e_).setAnchorPoint(.5,.5);return[4,w.show()];case 1:D.sent(),this.manager.node.scene.once(i7.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(i7.PAUSE_TIME),eY.on(q.VIEW_RESIZED,this.handleViewResized,this),eY.on(q.ORIENTATION_CHANGED,this.handleViewResized,this);D.label=2;case 2:return[2]}})}),function(){return w.apply(this,arguments)})},{key:"handleViewResized",value:function(){var n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=vV.search(this.gameplay.uiManager.items,function(n){return n.itemType===Z.STORM});if(C){var E=C.node.worldPosition,_=C.getComponent(e_).contentSize,T=_.width,I=_.height;T+=40,I+=40,w.setItemMaskTransform(E.x,E.y,T,I),k.node.setWorldPosition(k.node.worldPosition.x,E.y+I/2+30,0)}}},{key:"close",value:(n=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText;this.manager.node.scene.emit(i7.RESUME_TIME);return[4,w.hide()];case 1:C.sent(),k.node.active=!1,this.manager.completeGuide(vM),this.unlistenEvents();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){eY.off(q.VIEW_RESIZED,this.handleViewResized,this),eY.off(q.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();ew._RF.pop(),ew._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var vW,vK,vj,vY,vX,vZ,vJ,vQ,v$,v0=GameCore.Utils.Array,v1=function(){function e(n){C(this,e),this.manager=n,this.gameplay=n.gameplay}var n,w;return T(e,[{key:"setup",value:(w=N(function(){var n,w,k,C,E,_,T,I,L;return _ts_generator(this,function(D){switch(D.label){case 0:n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=n.guideInfoTextLocalizer,E=v0.search(this.gameplay.uiManager.items,function(n){return n.itemType===Z.PLIERS});if(!E)return[3,2];_=E.node.worldPosition,T=E.getComponent(e_).contentSize,I=T.width,L=T.height;I+=40,L+=40,w.node.active=!0,w.setItemMaskTransform(_.x,_.y,I,L),k.node.active=!0,C.key="guide.pliers",k.node.setPosition(0,0),k.node.setWorldPosition(k.node.worldPosition.x,_.y+L/2+30,0),k.horizontalAlign=tv.CENTER,k.getComponent(e_).setAnchorPoint(.5,.5);return[4,w.show()];case 1:D.sent(),this.manager.node.scene.once(i7.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(i7.PAUSE_TIME),eY.on(q.VIEW_RESIZED,this.handleViewResized,this),eY.on(q.ORIENTATION_CHANGED,this.handleViewResized,this);D.label=2;case 2:return[2]}})}),function(){return w.apply(this,arguments)})},{key:"handleViewResized",value:function(){var n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText,C=v0.search(this.gameplay.uiManager.items,function(n){return n.itemType===Z.PLIERS});if(C){var E=C.node.worldPosition,_=C.getComponent(e_).contentSize,T=_.width,I=_.height;T+=40,I+=40,w.setItemMaskTransform(E.x,E.y,T,I),k.node.setWorldPosition(k.node.worldPosition.x,E.y+I/2+30,0)}}},{key:"close",value:(n=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=this.manager.guideUi,w=n.guideMasks,k=n.guideInfoText;this.manager.node.scene.emit(i7.RESUME_TIME);return[4,w.hide()];case 1:C.sent(),k.node.active=!1,this.manager.completeGuide(vN),this.unlistenEvents();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"unlistenEvents",value:function(){eY.off(q.VIEW_RESIZED,this.handleViewResized,this),eY.off(q.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();ew._RF.pop(),ew._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var v2,v4,v3,v5,v6,v8,v9,v7=eS.ccclass,ge=eS.property,gt=(vW=v7("GuideHand"),vK=ge(ek),vj=ge(ek),vY=ge(eH),vW((vJ=n((vZ=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"hand",vJ,_(n)),E(n,"circleHighlight",vQ,_(n)),E(n,"circleHighlightOpacity",v$,_(n)),n}return T(s,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(n,w){var k=this;this.handTween&&this.handTween.stop();var C=ez(this.hand).to(.8,{worldPosition:w},{easing:"quartOut"}).to(.2,{scale:new eQ(.9,.9,.9),angle:15}).call(function(){k.playHighlightAnimation()}).to(.2,{scale:eQ.ONE,angle:0}).to(.8,{worldPosition:n},{easing:"quartOut"}).to(.2,{scale:new eQ(.9,.9,.9),angle:15}).call(function(){k.playHighlightAnimation()}).to(.2,{scale:eQ.ONE,angle:0});this.handTween=ez(this.hand).repeatForever(C).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),ez(this.circleHighlight).to(.6,{scale:new eQ(1.5,1.5)},{easing:"quadOut"}).start(),ez(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),s}(eL)).prototype,"hand",[vK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vQ=n(vZ.prototype,"circleHighlight",[vj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v$=n(vZ.prototype,"circleHighlightOpacity",[vY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vX=vZ))||vX);ew._RF.pop(),ew._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var gn,gi,gr,ga,go,gs,gl=eS.ccclass,gu=eS.property,gh=(v2=gl("GameMask"),v4=gu(e_),v3=gu(ex),v2((v8=n((v6=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"uiTransform",v8,_(n)),E(n,"sprite",v9,_(n)),n}return T(s,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),s}(eL)).prototype,"uiTransform",[v4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v9=n(v6.prototype,"sprite",[v3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v5=v6))||v5);ew._RF.pop(),ew._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var gp,gd,gy,gf,gv,gg,gm,gb=eS.ccclass,gw=eS.property,gS=eS.executeInEditMode,gk=(gn=gb("AlphaMasks"),gi=gS(!0),gr=gw(gh),gn(ga=gi((gs=n((go=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"masks",gs,_(n)),n}return T(s,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent(e_)}},{key:"start",value:function(){this.material=this.getComponent(ex).getMaterialInstance(0)}},{key:"update",value:function(){var n=this,w=this.UITransform,k=w.width,C=w.height;this.masks.forEach(function(w,E){var _=w.uiTransform,T=_.width,I=_.height,L=_.anchorX,D=_.anchorY,M=T*w.node.scale.x,N=I*w.node.scale.y,z=new e4(M/k,N/C),B=new e4(.5+(.5-L)*z.x,.5-(.5-D)*z.y),F=new e4(B.x+(w.node.worldPosition.x-n.node.worldPosition.x)/k,B.y-(w.node.worldPosition.y-n.node.worldPosition.y)/C);n.material.setProperty("mask".concat(E,"Texture"),w.texture),n.material.setProperty("ratio".concat(E),z),n.material.setProperty("center".concat(E),F)})}},{key:"setMaskActive",value:function(n,w){n>=this.masks.length||this.material.setProperty("useMask".concat(n),w?1:0)}}]),s}(eL)).prototype,"masks",[gr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ga=go))||ga)||ga);ew._RF.pop(),ew._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var gC,gE,g_,gA,gT,gP,gR,gI,gO,gL,gD,gM,gN,gz,gB,gF,gx,gU,gG=eS.ccclass,gH=eS.property,gV=(gp=gG("GuideMasks"),gd=gH(iA),gy=gH(gk),gp((gg=n((gv=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"background",gg,_(n)),E(n,"alphaMasks",gm,_(n)),n}return T(c,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"show",value:(L=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:n.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"hide",value:(I=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:n.sent(),this.background.node.active=!1;return[2]}})}),function(){return I.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(i7.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(n,w,k,C){this.alphaMasks.masks[1].node.worldPosition=new eQ(-9999,-9999,0);var E=this.alphaMasks.masks[0];this.setMaskTransform(E,n,w,k,C)}},{key:"setItemMaskTransform",value:function(n,w,k,C){this.alphaMasks.masks[0].node.worldPosition=new eQ(-9999,-9999,0);var E=this.alphaMasks.masks[1];this.setMaskTransform(E,n,w,k,C)}},{key:"setMaskTransform",value:function(n,w,k,C,E){n.uiTransform.setContentSize(C,E),n.node.setWorldPosition(w,k,0)}}]),c}(eL)).prototype,"background",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gm=n(gv.prototype,"alphaMasks",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gf=gv))||gf);ew._RF.pop(),ew._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var gq,gW,gK,gj,gY,gX,gZ,gJ,gQ,g$,g0,g1,g2,g4,g3,g5,g6,g8,g9,g7,me,mt=eS.ccclass,mn=eS.property,mi=(gC=mt("GuideTextBox"),gE=B.required(),g_=mn(eT),gA=B.required(),gT=mn(eN),gP=B.required(),gR=mn(e_),gI=B.required(),gO=mn(iA),gL=B.required(),gD=mn(j),gC((gz=n((gN=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"guideText",gz,_(n)),E(n,"widget",gB,_(n)),E(n,"uiTransform",gF,_(n)),E(n,"opacityToggler",gx,_(n)),E(n,"localizer",gU,_(n)),n}return T(c,[{key:"__preload",value:function(){B.validateRequiredProperties(this)}},{key:"setLocalizedText",value:function(n){this.localizer.key=n}},{key:"show",value:(L=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.opacityToggler.changeStateFade(!0)];case 1:n.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"hide",value:(I=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.opacityToggler.changeStateFade(!1)];case 1:n.sent();return[2]}})}),function(){return I.apply(this,arguments)})}]),c}(eL)).prototype,"guideText",[gE,g_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gB=n(gN.prototype,"widget",[gA,gT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gF=n(gN.prototype,"uiTransform",[gP,gR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gx=n(gN.prototype,"opacityToggler",[gI,gO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gU=n(gN.prototype,"localizer",[gL,gD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gM=gN))||gM);ew._RF.pop(),ew._RF.push({},"a2522Y5Q6JGSr90yCp/4qCm","GuideUI",void 0);var mr,ma,mo,ms,ml,mu=eS.ccclass,mc=eS.property,mh=(gq=mu("GuideUI"),gW=B.required(),gK=mc(gt),gj=B.required(),gY=mc(mi),gX=B.required(),gZ=mc(eT),gJ=B.required(),gQ=mc(j),g$=B.required(),g0=mc(gV),g1=B.required(),g2=mc(ek),gq((g5=n((g3=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"guideHand",g5,_(n)),E(n,"guideTextBox",g6,_(n)),E(n,"guideInfoText",g8,_(n)),E(n,"guideInfoTextLocalizer",g9,_(n)),E(n,"guideMasks",g7,_(n)),E(n,"guideSkipButton",me,_(n)),n}return T(s,[{key:"__preload",value:function(){B.validateRequiredProperties(this)}}]),s}(eL)).prototype,"guideHand",[gW,gK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g6=n(g3.prototype,"guideTextBox",[gj,gY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g8=n(g3.prototype,"guideInfoText",[gX,gZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g9=n(g3.prototype,"guideInfoTextLocalizer",[gJ,gQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g7=n(g3.prototype,"guideMasks",[g$,g0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),me=n(g3.prototype,"guideSkipButton",[g1,g2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g4=g3))||g4);ew._RF.pop(),ew._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var mp=game,md=mp.player,my=mp.analytics,mf=eS.ccclass,mv=eS.property,mg=GameCore,mm=mg.Match.Modes,mb=mg.Plugins.Analytics.Events,mw=mg.Utils.Array,mS=new e4(0,10),mk=new e4(0,10),mC="READY",mE="RUNNING",m_=(mr=mf("GuidelinesManager"),ma=mv(mh),mr((ml=n((ms=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"guideUi",ml,_(n)),n.guideHintDelay=null,n.guideStormDelay=null,n}return T(u,[{key:"init",value:function(n){this.gameplay=n,this.status=mC,this.node.scene.on(i7.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(i7.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(i7.USE_ITEM,this.handleUseItem,this),this.node.scene.on(i7.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(i7.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(i7.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(vR)&&this.resetGuideItemShowed(),this.startGuide(vR)):this.startGuide(vI)}},{key:"startGuide",value:function(n){if(this.status===mE)return!1;if(this.hasGuideItemShowed(n))return!1;switch(this.addGuideItemShowed(n),this.status=mE,n){case vR:my.event(mb.TUTORIAL_BEGIN),this.guide1=new vz(this),this.guide1.setup();break;case vI:this.guide2=new vB(this),this.guide2.setup();break;case vO:this.guide3=new vF(this),this.guide3.setup();break;case vL:this.guide4=new vU(this),this.guide4.setup();break;case vD:this.guide5=new vH(this),this.guide5.setup();break;case vM:this.guide6=new vq(this),this.guide6.setup();break;case vN:this.guide7=new v1(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(n){my.event(mb.TUTORIAL_STEP,{step:n}),this.status=mC,this.addGuideItemShowed(n),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){var n=this.getCurrentLevel(),w=mS.x,k=mS.y;return n>=w&&n<=k}},{key:"isShowErrorPathLevel",value:function(){if(s2.getMatchMode()===mm.TOURNAMENT)return!1;var n=this.getCurrentLevel(),w=mk.x,k=mk.y;return n>=w&&n<=k}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(n){return mw.has(this.getGuideItemShowed(),n)}},{key:"addGuideItemShowed",value:function(n){if(!this.hasGuideItemShowed(n)){var w=this.getGuideItemShowed();w.push(n),md.setGameData({guideItemShowed:w})}}},{key:"resetGuideItemShowed",value:function(){md.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var n,w;return null!==(n=null===(w=md.getGameData())||void 0===w?void 0:w.guideItemShowed)&&void 0!==n?n:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(n){this.isNewbieGuideLevel()||n<2||(this.startGuide(vO),this.node.scene.off(i7.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var n=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=ez(this.node).delay(5).call(function(){n.isNewbieGuideLevel()||(n.hasGuideItemShowed(vL)&&n.status===mC?n.node.scene.emit(i7.SHOW_HINT):n.startGuide(vL),n.startHintGuide())})),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var n=this;null===this.guideStormDelay&&(this.guideStormDelay=new tg(this.node).delay(10).call(function(){n.isNewbieGuideLevel()||n.hasGuideItemShowed(vM)||n.gameplay.itemManager.canUseItem(Z.STORM)&&(n.startGuide(vM)||n.startStormGuide())})),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(vD)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(vN)}},{key:"handleUseItem",value:function(n){switch(this.startAutoGuides(),n){case Z.HINT:this.addGuideItemShowed(vL);break;case Z.THUNDER:this.addGuideItemShowed(vD);break;case Z.STORM:this.addGuideItemShowed(vM);break;case Z.PLIERS:this.addGuideItemShowed(vN)}}},{key:"skipNewbieGuide",value:(I=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:this.guideUi.guideSkipButton.active=!1;return[4,this.guide1.close()];case 1:w.sent();n=this.getCurrentLevel()+1;md.setGameData({level:n}),this.node.scene.emit(i7.NEXT_LEVEL);return[2]}})}),function(){return I.apply(this,arguments)})},{key:"onDestroy",value:function(){var n,w,k,C,E,_;null===(n=this.guide2)||void 0===n||n.unlistenEvents(),null===(w=this.guide3)||void 0===w||w.unlistenEvents(),null===(k=this.guide4)||void 0===k||k.unlistenEvents(),null===(C=this.guide5)||void 0===C||C.unlistenEvents(),null===(E=this.guide6)||void 0===E||E.unlistenEvents(),null===(_=this.guide7)||void 0===_||_.unlistenEvents()}}]),u}(eL)).prototype,"guideUi",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mo=ms))||mo);ew._RF.pop(),ew._RF.push({},"aa973zMvtZFD6GO7rUb6TBF","canUseHintItem",void 0);ew._RF.pop(),ew._RF.push({},"f3464SQfFhIs5PVRx8JpCO1","canUsePliersItem",void 0);ew._RF.pop(),ew._RF.push({},"ad5b3eazZ1B3YR8JJm+qvM6","canUseThunderItem",void 0);ew._RF.pop(),ew._RF.push({},"3b5b1bQTVlDaaFOGKDB5VZk","canUseTornadoItem",void 0);var mA,mT;ew._RF.pop(),ew._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var mP,mR=eS.ccclass,mI=globalThis.game.player,mO=(X(mA={},Z.HINT,{canActivate:!1,quantity:0}),X(mA,Z.THUNDER,{canActivate:!1,quantity:0}),X(mA,Z.STORM,{canActivate:!1,quantity:0}),X(mA,Z.PLIERS,{canActivate:!1,quantity:0}),mA),mL=mR("ItemManager")(mT=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).itemConfigs=mO,n}return T(o,[{key:"onLoad",value:function(){this.node.scene.on(i7.GRID_CREATE,this.updateItemsConfig,this),this.node.scene.on(i7.GRID_MATCH,this.updateItemsConfig,this),this.node.scene.on(i7.GRID_CLEAR,this.updateItemsConfig,this),this.node.scene.on(i7.GRID_SPAWN,this.updateItemsConfig,this),this.node.scene.on(i7.BOMB_EXPLODE,this.updateItemsConfig,this),this.node.scene.on(i7.REFRESH_ITEMS,this.updateItemsConfig,this)}},{key:"init",value:function(n){this.game=n}},{key:"getQuantity",value:function(n){return this.itemConfigs[n].quantity}},{key:"setQuantity",value:function(n,w,k){var C=arguments.length>2&&void 0!==k&&k,E=Math.max(0,w);this.itemConfigs[n].quantity=E,this.saveQuantity(n,w),this.updateItemConfig(n,C)}},{key:"saveQuantity",value:function(n,w){var k=mI.getGameData();k&&mI.setGameData({items:I(I({},k.items),{},X({},n,w))})}},{key:"canUseItem",value:function(n){var w=this.game,k=w.board,C=w.pathDraw;switch(n){case Z.HINT:return function(n,w){return n.getUncleared().length>0&&!1===w.isDrawingHint}(k,C);case Z.PLIERS:return function(n){return n.getBombTiles().length>0}(k);case Z.STORM:return function(n){return n.getUncleared().length>4}(k);case Z.THUNDER:return function(n){return n.getUncleared().length>=4}(k);default:return!1}}},{key:"updateItemsConfig",value:function(){var n=mI.getGameData();if(n){for(var w=0,k=Object.keys(this.itemConfigs);w<k.length;w++){var C=k[w],E=this.itemConfigs[C];E.canActivate=this.canUseItem(C),E.quantity=n.items[C]||0}this.game.uiManager.currentLayout.updateStatus(I({items:this.itemConfigs},this.game.uiManager.config))}}},{key:"updateItemConfig",value:function(n,w){var k=arguments.length>1&&void 0!==w&&w,C=mI.getGameData();C&&(this.itemConfigs[n].canActivate=this.canUseItem(n),this.itemConfigs[n].quantity=C.items[n]||0,this.game.uiManager.currentLayout.updateStatus(I({items:I(I({},this.itemConfigs),{},X({},n,I({animate:k},this.itemConfigs[n])))},this.game.uiManager.config)))}}]),o}(eL))||mT;ew._RF.pop(),ew._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var mD,mM=eS.ccclass,mN=GameCore.Utils,mz=mN.Device,mB=mN.Array,mF=globalThis.game.monitorError,mx={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},mU=mM("LevelManager")(mP=function(n){w(c,n);var E,_,I,L,D=k(c);function c(){return C(this,c),D.apply(this,arguments)}return T(c,[{key:"loadLevel",value:(L=N(function(){var n,w,k,C,E,_;var T=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:n=T.length>0&&void 0!==T[0]?T[0]:1,w=T.length>1?T[1]:void 0;return[4,this.loadLevelData(n)];case 1:k=I.sent();this.levelData=k||this.levelData||mx;C=this.levelData,E=C.rows,_=C.columns;return[2,(mz.isMobile()&&_>=6&&E>=10&&(this.levelData.columns=5,this.levelData.rows=10),null==mF||mF.addMetadata({level:n}),this.getLevelSpriteFrames(n,w))]}})}),function(){return L.apply(this,arguments)})},{key:"loadLevelData",value:(I=N(function(){var n,w,k,C,E;var _=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:n=_.length>0&&void 0!==_[0]?_[0]:1,w=10,k=this.paddingZero("".concat(Math.floor(n/w)+1),3),C=n%w;return[4,F.loadJsonAsync("".concat(ee.LEVEL_DATA_FOLDER,"/").concat(k))];case 1:E=T.sent();return[2,E?E[C]:null]}})}),function(){return I.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"getLevelSpriteFrames",value:(_=N(function(n,w){var k,C,E,_,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:if(!(w&&e0.random()<=.5))return[3,2];k=sG.getThemeSkins(w),C=k[e0.randomRangeInt(0,k.length)];return[4,this.loadSkinFrames(C)];case 1:return[2,L.sent()];case 2:E=sG.getLevelSkins(n);if(0===E.length)throw new Error("No skins found for level ".concat(n));if(!(E.length>1))return[3,4];return[4,this.loadSkinFrames(E)];case 3:return[2,L.sent()];case 4:_=E[0],T=sG.getUnlockedSkins();if(T.length>1&&e0.random()<=.5){I=T.filter(function(n){return n!==_});_=I[e0.randomRangeInt(0,I.length)]}return[4,this.loadSkinFrames(_)];case 5:return[2,L.sent()]}})}),function(n,w){return _.apply(this,arguments)})},{key:"loadSkinFrames",value:(E=N(function(n){var w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:if(!Array.isArray(n))return[3,2];w=n.map(function(){var n=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w="".concat(ee.TILE_SKIN_FOLDER,"/").concat(n);return[4,F.loadSpriteFramesDirAsync(w)];case 1:return[2,k.sent()]}})});return function(w){return n.apply(this,arguments)}}());k=mB.flatten;return[4,Promise.all(w)];case 1:return[2,k.apply(mB,[E.sent()])];case 2:C="".concat(ee.TILE_SKIN_FOLDER,"/").concat(n);return[4,F.loadSpriteFramesDirAsync(C)];case 3:return[2,E.sent()]}})}),function(n){return E.apply(this,arguments)})},{key:"paddingZero",value:function(n,w){for(var k="",C=0;C<w-n.length;C++)k+="0";return k+n}}]),c}(eL))||mP;ew._RF.pop(),ew._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var mG=eS.ccclass,mH=GameCore.Match.Modes,mV=mG("ScoreManager")(mD=function(n){w(l,n);var E,_=k(l);function l(){var n;C(this,l);for(var w=arguments.length,k=new Array(w),E=0;E<w;E++)k[E]=arguments[E];return(n=_.call.apply(_,[this].concat(k))).currentScore=0,n.tournamentStartScore=0,n}return T(l,[{key:"addScore",value:function(n,w,k){var C=this.getLevelMultiplier(n),E=this.getComboMultiplier(w),_=this.getTimeMultiplier(n,k),T=Math.floor(this.currentScore+10*C*E*_),I=10*Math.ceil(T/10);this.setScore(I)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var n=s2.getMatchMode();this.currentScore=n===mH.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(n){this.currentScore=n,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"resetTournamentStartScore",value:function(){this.tournamentStartScore=0}},{key:"updateScore",value:(E=N(function(){return _ts_generator(this,function(n){this.node.scene.emit(i7.SCORE_UPDATED,this.currentScore);return[2]})}),function(){return E.apply(this,arguments)})},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(n){return 1+.1*(n-1)}},{key:"getComboMultiplier",value:function(n){return 1+.1*(n-1)}},{key:"getTimeMultiplier",value:function(n,w){return n<=2?4:1+.05*w}}]),l}(eL))||mD;ew._RF.pop(),ew._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var mq=function(){function e(n){C(this,e),this.game=null,this.data={},this.game=n.getGameplay(),this.manager=n,this.updateStateData(),this.logDebug()}return T(e,[{key:"logDebug",value:function(){var n=this.constructor.name;console.info("[STATE] ".concat(n),this.data)}},{key:"updateStateData",value:function(){if(this.game){var n=this.game.getGameData();n&&(this.data=n)}}},{key:"updateGameData",value:function(n){var w;null===(w=this.game)||void 0===w||w.setGameData(n)}}]),e}();ew._RF.pop(),ew._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var mW=globalThis.game,mK=mW.analytics,mj=mW.match,mY=mW.storage,mX=GameCore,mZ=mX.Match.Modes,mJ=mX.Dtos.Match.Data,mQ=function(n){w(c,n);var E,_,I,L,D=k(c);function c(n,w){var k;return C(this,c),k=D.call(this,n),H.stopAllSounds(),k.vibrateDevice(),k.pauseCountdown(),k.updateMatchCustomData(),k.handleGameOver(w),k.logLevelFailAnalytics(),k}return T(c,[{key:"pauseCountdown",value:function(){var n;null===(n=this.game)||void 0===n||n.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var n;null===(n=e8("Vibrate"))||void 0===n||null===(n=n.getComponent(sw))||void 0===n||n.vibrate(500)}},{key:"handleGameOver",value:(L=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=s2.getMatchMode();if(F.setBlockInput(!0),w===mZ.SINGLE)return[3,5];if(w!==mZ.TOURNAMENT)return[3,2];return[4,this.handleTournamentGameOver()];case 1:k.sent();return[3,4];case 2:if(w!==mZ.CHALLENGE_FRIEND)return[2,void this.showFailScreen(n)];return[4,this.handleChallengeGameOver()];case 3:k.sent();k.label=4;case 4:F.setBlockInput(!1);return[3,6];case 5:this.showFailScreen(n);k.label=6;case 6:return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(I=N(function(){var n,w,k,C,E,_,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:k=this;if(!this.game)return[3,5];C=(null!==(n=s2.getMatchCustomData())&&void 0!==n?n:{}).tournamentId;if(!C)return[3,5];if(en.validateTournamentExpired(C))return[2,(mY.setStorageData("tournament","animateTournamentLeader",!1),ei.showNotificationScreenWithLocalizedKey("error.tourEnded",2),void(null===(E=this.game)||void 0===E||E.scheduleOnce(function(){var n;null===(n=k.game)||void 0===n||n.node.scene.emit(i7.GAME_EXIT)},2)))];L.label=1;case 1:L.trys.push([1,3,,4]);_=mY.getStorageData("tournament","previousScore"),T=this.game.scoreManager.getCurrentScore()>_;mY.setStorageData("tournament","animateTournamentLeader",T);return[4,s2.finishMatchAsync()];case 2:L.sent();return[3,4];case 3:I=L.sent();console.warn(I);return[3,4];case 4:null===(w=this.game)||void 0===w||w.node.scene.emit(i7.GAME_EXIT);L.label=5;case 5:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(_=N(function(){var n,w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:if(!this.game)return[3,6];E.label=1;case 1:E.trys.push([1,4,,5]);n=mj.getMatchState().id;return[4,mj.api.getMatchAPI().getMatchDetailByIdAsync(n)];case 2:w=E.sent(),k=new mJ(w).toObject().extraData;return[4,s2.finishMatchAsync({extraData:null!=k?k:void 0})];case 3:E.sent();return[3,5];case 4:C=E.sent();console.warn(C);return[3,5];case 5:this.game.node.scene.emit(i7.SHOW_CHALLENGE_RESULTS);E.label=6;case 6:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"showFailScreen",value:(E=N(function(n){var w;return _ts_generator(this,function(k){w=this.data.level;n===s3&&H.playSound(nI.LEVEL_FAIL_TIMEOUT),H.playSound(nI.LEVEL_FAIL),ei.openScreen(er.RESCUES_SCREEN,{level:w,failKey:n});return[2]})}),function(n){return E.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var n;if(this.game){var w=this.data.level,k=void 0===w?1:w,C=null===(n=this.game)||void 0===n?void 0:n.scoreManager.getCurrentScore();s2.updateMatchStateAfterLevelFinish(k,C)}}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var n=this.data.level,w=void 0===n?0:n,k=this.game.scoreManager.getCurrentScore(),C=s2.getMatchMode()||void 0;mK.levelFail(w,k,C)}}},{key:"initialize",value:function(){var n=this.manager.createInitializeState(this.manager);this.manager.change(n)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var n=this.manager.createPlayingState(this.manager);this.manager.change(n)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var n=this.manager.createFinishState(this.manager);this.manager.change(n)}},{key:"update",value:function(){}}]),c}(mq);ew._RF.pop(),ew._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var m$=globalThis.game,m0=m$.analytics,m1=m$.player,m2=m$.leaderboard,m4=m$.match,m3=GameCore,m5=m3.Match.Modes,m6=m3.Utils.Time,m8=GameCore.Configs.Ads.NotifyPlayerBeforeShow,m9=function(n){w(v,n);var E,_,L,D,M,z,B,F=k(v);function v(n){var w;return C(this,v),(w=F.call(this,n)).handleFinishStateFlow(),w}return T(v,[{key:"handleFinishStateFlow",value:(B=N(function(){var n;return _ts_generator(this,function(w){if(this.game){this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),this.game.uiManager.pauseTime();n=s2.getMatchMode();n!==m5.CHALLENGE_FRIEND&&n!==m5.TOURNAMENT&&this.updatePlayerProgress(),this.updateMatchCustomData(),n===m5.CHALLENGE_FRIEND?this.handleFinishChallenge():n===m5.TOURNAMENT?this.handleFinishTournament():this.handleFinishSingle(),this.logLevelCompleteAnalytics()}return[2]})}),function(){return B.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"attemptCallCreateShortcut",value:function(){var n=this.data.level;(void 0===n?0:n)<2||ea.canShowInterstitialAd()||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(n){console.warn("createShortcutAsync",n)})}},{key:"updatePlayerProgress",value:function(){if(this.game){var n=this.data.level;if(n){var w=n+1,k=m1.getGameData();if(k){var C=k.totalLevel,E=k.level,_=Math.max(E,w),T=I({},k);_<C&&(T.level=_),m1.setGameData(T)}}}}},{key:"updateMatchCustomData",value:function(){if(this.game){var n=this.data.level,w=void 0===n?1:n,k=this.game.scoreManager.getCurrentScore();s2.updateMatchStateAfterLevelFinish(w,k)}}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var n=this.data.level,w=void 0===n?0:n,k=this.game.scoreManager.getCurrentScore(),C=s2.getMatchMode()||void 0;m0.levelComplete(w,k,C)}}},{key:"handleFinishChallenge",value:(z=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.game)return[3,7];C.label=1;case 1:C.trys.push([1,4,,6]);n=m4.getMatchState().id;return[4,s2.getMatchExtraDataAsync(n)];case 2:w=C.sent();return[4,s2.finishMatchAsync({extraData:null!=w?w:void 0})];case 3:C.sent();return[3,6];case 4:k=C.sent();console.warn(k);return[4,s2.finishMatchAsync()];case 5:C.sent();return[3,6];case 6:this.game.node.scene.emit(i7.SHOW_CHALLENGE_RESULTS);C.label=7;case 7:return[2]}})}),function(){return z.apply(this,arguments)})},{key:"handleFinishTournament",value:(M=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(this.handlePostTournamentScore(),!this.game)return[3,4];n=this.data.level,w=void 0===n?1:n;H.playSound(nI.LEVEL_COMPLETE,{volume:.5}),this.game.effectManager.playConfettiEffect();return[4,m6.sleepAsync(500)];case 1:C.sent();k=ea.canShowInterstitialAd();if(!k)return[3,3];return[4,ea.showInterstitialAdAsync({forLevel:w})];case 2:k=C.sent();C.label=3;case 3:this.game.node.scene.emit(i7.NEXT_LEVEL);C.label=4;case 4:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"handlePostTournamentScore",value:(D=N(function(){var n,w,k,C,E,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:if(!this.game)return[3,7];w=null===(n=this.game)||void 0===n?void 0:n.scoreManager.getCurrentScore();if(!w)return[3,7];I.label=1;case 1:I.trys.push([1,3,,4]);return[4,GameSDK.tournament.postScoreAsync(w)];case 2:I.sent();return[3,4];case 3:k=I.sent();console.warn("GameSDK post score async",k);return[3,4];case 4:C=s2.getMatchCustomData();if(!C)return[3,7];E=C.leaderboardId,_=C.playerId;T=E&&_;if(!T)return[3,6];return[4,m2.setLeaderboardScoreAsync(E,_,w)];case 5:T=I.sent();I.label=6;case 6:I.label=7;case 7:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"handleFinishSingle",value:(L=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:H.turnUpMusic();n=this.data.level,w=void 0===n?0:n;if(!(w>0&&w%5==0))return[3,2];return[4,this.handleFinishHardLevel()];case 1:k.sent();return[3,4];case 2:return[4,this.handleFinishNormalLevel()];case 3:k.sent();k.label=4;case 4:this.handleNextLevelSingle();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"handleFinishNormalLevel",value:(_=N(function(){var n,w,k,C,E,_,T,I,L,D,M;return _ts_generator(this,function(N){switch(N.label){case 0:_=this.data.level,T=void 0===_?0:_,I=null!==(n=null===(w=m1.getGameData())||void 0===w?void 0:w.coins)&&void 0!==n?n:0,L=null!==(k=null===(C=s2.getMatchCustomData())||void 0===C?void 0:C.score)&&void 0!==k?k:0;D=ea.canShowInterstitialAd();if(!D)return[3,4];M=m8;if(!M)return[3,2];return[4,null===(E=this.game)||void 0===E?void 0:E.uiManager.interstitialAdIndicator.flash()];case 1:M=N.sent();N.label=2;case 2:return[4,ea.showInterstitialAdAsync({forLevel:T})];case 3:D=N.sent();N.label=4;case 4:H.playSound(nI.LEVEL_COMPLETE,{volume:.5});return[4,ei.openScreenAndWaitForClose(er.LEVEL_COMPLETE_SCREEN,{level:T,coins:I,score:L,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!1})];case 5:N.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleFinishHardLevel",value:(E=N(function(){var n,w,k,C,E,_,T,I,L,D,M,N,z,B;return _ts_generator(this,function(F){switch(F.label){case 0:_=this.data.level,T=void 0===_?0:_,I=null!==(n=null===(w=m1.getGameData())||void 0===w?void 0:w.coins)&&void 0!==n?n:0,L=null!==(k=null===(C=s2.getMatchCustomData())||void 0===C?void 0:C.score)&&void 0!==k?k:0;H.playSound(nI.LEVEL_COMPLETE,{volume:.5});return[4,ei.openScreenAndWaitForClose(er.LEVEL_COMPLETE_SCREEN,{level:T,coins:I,score:L,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!0})];case 1:D=F.sent().screenData,M=(null!=D?D:{}).canShowRewardsAd;if(!(void 0!==M&&M))return[3,6];return[4,ei.openScreenAndWaitForClose(er.GET_REWARDS_SCREEN)];case 2:N=F.sent().screenData,z=null!==(E=null==N?void 0:N.getRewardsSuccess)&&void 0!==E&&E;z&&this.getRewardItems();return[4,ei.openScreenAndWaitForClose(er.LEVEL_COMPLETE_SCREEN,{level:T,coins:I,score:L,getRewardsSuccess:z,lookingForRewards:!1})];case 3:F.sent();B=z;if(B)return[3,5];return[4,ea.showInterstitialAdAsync({forLevel:T})];case 4:B=F.sent();F.label=5;case 5:return[3,8];case 6:return[4,ea.showInterstitialAdAsync({forLevel:T})];case 7:F.sent();F.label=8;case 8:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleNextLevelSingle",value:function(){var n=this.data.level,w=m1.getGameData();this.game&&n&&w&&(n>=w.totalLevel?this.game.node.scene.emit(i7.MAX_LEVEL):this.game.node.scene.emit(i7.NEXT_LEVEL))}},{key:"getRewardItems",value:function(){this.game&&(this.game.node.scene.emit(i7.ADD_ITEM,{item:Z.STORM,quantity:1}),this.game.node.scene.emit(i7.ADD_ITEM,{item:Z.THUNDER,quantity:1}))}},{key:"initialize",value:function(){var n=this.manager.createInitializeState(this.manager);this.manager.change(n)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),v}(mq);ew._RF.pop(),ew._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var m7=globalThis.game,be=m7.player,bt=m7.match,bn=GameCore.Match.Modes,bi=function(n){w(v,n);var E,_,L,D,M,B,F=k(v);function v(n){var w;return C(this,v),(w=F.call(this,n)).clearBoard(),w.initCountdown(),w.initScore(),w.loadLevel().then(function(){w.updateUI()}),w}return T(v,[{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.board.clearAnimationQueue(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(B=N(function(){var n,w,k,C,E,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:if(!this.game)return[3,8];n=s2.getMatchMode();I.label=1;case 1:I.trys.push([1,6,,8]);if(n!==bn.CHALLENGE_FRIEND)return[3,3];return[4,this.loadChallengeFriendMode()];case 2:w=I.sent(),k=w.frames,C=w.extraData;H.playSound(nI.LEVEL_START),this.handleChallengeFriendModeStart(k,C);return[3,5];case 3:return[4,this.loadSingleMode()];case 4:E=I.sent();H.playSound(nI.LEVEL_START),n===bn.SINGLE?this.handleSingleModeStart(E):n===bn.TOURNAMENT&&this.handleTournamentModeStart(E);I.label=5;case 5:return[3,8];case 6:_=I.sent();console.error("Error loading level:",_);return[4,this.loadSingleMode()];case 7:T=I.sent();H.playSound(nI.LEVEL_START),this.handleSingleModeStart(T);return[3,8];case 8:return[2]}})}),function(){return B.apply(this,arguments)})},{key:"loadChallengeFriendMode",value:(M=N(function(){var n,w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:n=bt.getMatchState().id;return[4,s2.getMatchExtraDataAsync(n)];case 1:w=E.sent();if(!w)throw new Error("Match mode ".concat(bn.CHALLENGE_FRIEND," but no extraData (for opponent initialization) was found in match data."));k=this.game.levelManager;return[4,k.loadLevel(w.level)];case 2:C=E.sent();return[2,(this.updateGameData({level:w.level,levelData:k.getLevelData()}),{frames:C,extraData:w})]}})}),function(){return M.apply(this,arguments)})},{key:"loadSingleMode",value:(D=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:n=this.game.levelManager;return[4,n.loadLevel(this.data.level,this.data.themeId)];case 1:w=k.sent();return[2,(this.updateGameData({levelData:n.getLevelData()}),w)]}})}),function(){return D.apply(this,arguments)})},{key:"handleChallengeFriendModeStart",value:(L=N(function(n,w){var k,C,E,_,T,L,D;return _ts_generator(this,function(M){switch(M.label){case 0:if(!this.game)return[3,4];k=this.game.levelManager.getLevelData(),C=w.level,E=w.fen,_=w.gravity,T=w.rules,L=w.time,D=be.getPlayerId();return[4,Promise.all([s2.setMatchCustomDataAsync({level:C,score:0}),s2.setProfileMatchDataAsync({id:D,score:0})])];case 1:M.sent();return[4,this.game.board.create(n,I(I({},k),{},{level:C,customFen:E,mode:_,rules:T,time:L}))];case 2:M.sent(),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 3:M.sent(),this.game.board.setIgnoreInput(!1),this.ready();M.label=4;case 4:return[2]}})}),function(n,w){return L.apply(this,arguments)})},{key:"handleSingleModeStart",value:(_=N(function(n){var w,k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:if(!this.game)return[3,7];k=this.game.levelManager.getLevelData(),C=this.data.level,E=be.getPlayerId();return[4,Promise.all([s2.setMatchCustomDataAsync({level:C,score:0}),s2.setProfileMatchDataAsync({id:E,score:0})])];case 1:T.sent();return[4,this.game.board.create(n,k)];case 2:T.sent(),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 3:T.sent(),null!==(w=this.game.guidelinesManager)&&void 0!==w&&w.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1);_=C&&C>0&&C%5==0;if(!_)return[3,6];s7.isLandscape()&&this.game.handleShowUI(),ei.openScreen(er.HARD_LEVEL_SCREEN);return[4,z.waitTweenAsync(1.3)];case 4:T.sent(),ei.closeScreen(er.HARD_LEVEL_SCREEN);return[4,this.game.board.animateTilesWave()];case 5:_=T.sent();T.label=6;case 6:this.ready();T.label=7;case 7:return[2]}})}),function(n){return _.apply(this,arguments)})},{key:"handleTournamentModeStart",value:(E=N(function(n){var w,k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!this.game)return[3,4];k=this.game.levelManager.getLevelData(),C=this.data.level,E=be.getPlayerId();return[4,Promise.all([s2.setMatchCustomDataAsync({level:C}),s2.setProfileMatchDataAsync({id:E})])];case 1:_.sent();return[4,this.game.board.create(n,k)];case 2:_.sent(),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 3:_.sent(),null!==(w=this.game.guidelinesManager)&&void 0!==w&&w.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),this.ready();_.label=4;case 4:return[2]}})}),function(n){return E.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.init()}},{key:"initCountdown",value:function(){this.game&&this.game.clockManager.init()}},{key:"updateUI",value:function(){if(this.game){var n=this.game.getGameData();if(n){var w=n.level,k=void 0===w?0:w,C=n.levelData;this.game.uiManager.setLevelText(k),C&&this.game.clockManager.setTime(C.time)}}}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var n=this.manager.createReadyState(this.manager);this.manager.change(n)}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),v}(mq);ew._RF.pop(),ew._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var br=function(n){w(o,n);var E=k(o);function o(n){var w;return C(this,o),(w=E.call(this,n)).startCountdown(),w}return T(o,[{key:"startCountdown",value:function(){this.game&&(this.game.clockManager.startCountdown(),this.game.uiManager.startCountdown())}},{key:"initialize",value:function(){var n=this.manager.createInitializeState(this.manager);this.manager.change(n)}},{key:"ready",value:function(){var n=this.manager.createReadyState(this.manager);this.manager.change(n)}},{key:"playing",value:function(){}},{key:"fail",value:function(n){var w=this.manager.createFailState(this.manager,n);this.manager.change(w)}},{key:"finish",value:function(){var n=this.manager.createFinishState(this.manager);this.manager.change(n)}},{key:"update",value:function(){this.updateStateData()}}]),o}(mq);ew._RF.pop(),ew._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var ba,bo=globalThis.game.analytics,bs=GameCore.Utils.Valid,bl=function(n){w(o,n);var E=k(o);function o(n){var w;return C(this,o),w=E.call(this,n),H.stopAllSounds(),H.turnDownMusic(),w.handleGuideFlow(),w.setGridPlayable(),w.logLevelStartAnalytics(),w}return T(o,[{key:"initialize",value:function(){var n=this.manager.createInitializeState(this.manager);this.manager.change(n)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var n=this.manager.createPlayingState(this.manager);this.manager.change(n)}},{key:"fail",value:function(n){if(bs.isDebugger()){var w=this.manager.createFailState(this.manager);this.manager.change(w)}}},{key:"finish",value:function(){if(bs.isDebugger()){var n=this.manager.createFinishState(this.manager);this.manager.change(n)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var n;null!==(n=this.manager.getGameplay().guidelinesManager)&&void 0!==n&&n.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var n,w;this.game&&(null!==(n=this.game.guidelinesManager)&&void 0!==n&&n.isNewbieGuideLevel()||this.game.handleShowUI(),null===(w=this.game.guidelinesManager)||void 0===w||w.show())}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var n=this.data.level,w=void 0===n?0:n,k=(s2.getMatchCustomData()||{}).score,C=void 0===k?0:k,E=s2.getMatchMode()||void 0;bo.levelStart(w,C,E)}}}]),o}(mq);ew._RF.pop(),ew._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var bu,bh=(0,eS.ccclass)("StateManager")(ba=function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(n){this.gameplay=n,this.state=new bi(this)}},{key:"change",value:function(n){this.state=n}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return _instanceof(this.state,bi)}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return _instanceof(this.state,bl)}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return _instanceof(this.state,br)}},{key:"fail",value:function(n){this.state.fail(n)}},{key:"isFail",value:function(){return _instanceof(this.state,mQ)}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return _instanceof(this.state,m9)}},{key:"update",value:function(n){this.state&&this.state.update(n)}},{key:"createInitializeState",value:function(){for(var n=arguments.length,w=new Array(n),k=0;k<n;k++)w[k]=arguments[k];return eo(bi,w)}},{key:"createReadyState",value:function(){for(var n=arguments.length,w=new Array(n),k=0;k<n;k++)w[k]=arguments[k];return eo(bl,w)}},{key:"createPlayingState",value:function(){for(var n=arguments.length,w=new Array(n),k=0;k<n;k++)w[k]=arguments[k];return eo(br,w)}},{key:"createFailState",value:function(){for(var n=arguments.length,w=new Array(n),k=0;k<n;k++)w[k]=arguments[k];return eo(mQ,w)}},{key:"createFinishState",value:function(){for(var n=arguments.length,w=new Array(n),k=0;k<n;k++)w[k]=arguments[k];return eo(m9,w)}}]),o}(eL))||ba;ew._RF.pop(),ew._RF.push({},"a95ba1U+uJB66zZU7UYL4e5","TournamentManager",void 0);var bp,bd,by,bf,bv,bg,bm,bb,bw,bS=eS.ccclass,bk=GameCore.Utils.Object,bC=globalThis.game.player,bE=bS("TournamentManager")(bu=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).leaderData=[],n.isInited=!1,n}return T(o,[{key:"init",value:function(n){var w=this,k=bC.getPlayerId();this.leaderData=bk.vals(n.leaders).reduce(function(n,w){if(w.playerId!==k&&w.score>0){var C={score:w.score,rank:w.rank};n.push(C)}return n},[]),this.leaderData.sort(function(n,w){return n.score-w.score}),this.leaderData.forEach(function(n,k){n.rank=w.leaderData.length-k}),this.isInited=!0}}]),o}(eL))||bu;ew._RF.pop(),ew._RF.push({},"2b89dXjcudIaZRJFuh5TAAI","InterstitialAdIndicator",void 0);var b_=eS.ccclass,bA=eS.property,bT=["ads.interNotice.backInSec","ads.interNotice.hangTight","ads.interNotice.quickAd"];var bP,bR=GameCore.Configs.Ads.NotifyPlayerBeforeShow,bI=(bp=b_("InterstitialAdIndicator"),bd=B.required(),by=bA(eH),bf=B.required(),bv=bA(j),bp((bb=n((bm=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"uiOpacity",bb,_(n)),E(n,"labelLocalizer",bw,_(n)),n}return T(u,[{key:"__preload",value:function(){B.validateRequiredProperties(this)}},{key:"flash",value:(I=N(function(){var n,w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:if(!1===bR)return[2,Promise.resolve()];null===(n=this.signal)||void 0===n||n.abort();k=new x;this.signal=k,this.labelLocalizer.key=(w=Math.floor(Math.random()*bT.length),bT[w]);C=ez(this.uiOpacity).to(.25,{opacity:255},{easing:"linear"}).delay(.25).to(.25,{opacity:100},{easing:"linear"}).delay(.125);return[4,z.runTweenAsync(ez(this.uiOpacity).repeat(2,C).to(.25,{opacity:0},{easing:"linear"}),k)];case 1:E.sent(),this.uiOpacity.opacity=0;return[2]}})}),function(){return I.apply(this,arguments)})}]),u}(eL)).prototype,"uiOpacity",[bd,by],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bw=n(bm.prototype,"labelLocalizer",[bf,bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bg=bm))||bg);ew._RF.pop(),ew._RF.push({},"dfab8xSeglD/abIKphEhi4g","ComboContainer",void 0);var bO,bL=eS.ccclass,bD=GameCore.Match.Modes,bM=bL("ComboContainer")(bP=function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"__preload",value:function(){this.widget=this.node.getComponent(eN)}},{key:"onLoad",value:function(){B.lazyValidateProperties(this)}},{key:"updateStatus",value:function(){s2.getMatchMode()===bD.TOURNAMENT?this.widget.top=180:this.widget.top=160}}]),o}(eL))||bP;ew._RF.pop(),ew._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var bN,bz,bB,bF,bx,bU,bG,bH,bV,bq,bW,bK,bj,bY,bX,bZ,bJ,bQ,b$,b0,b1,b2,b4,b3,b5,b6,b8=eS.ccclass,b9=b8("ComboProgressBar")(bO=function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"start",value:function(){this.progressBar=this.getComponent(ak),this.opacity=this.getComponent(eH),this.comboTimer=0,this.isActive=!1,this.node.scene.on(i7.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(n){this.isActive&&(this.comboTimer>0?(this.comboTimer-=n,this.progressBar.progress=this.comboTimer/2):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(i7.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(n){0===n?this.opacity.opacity=0:n>0&&(this.isActive=!0,this.comboTimer=2),n>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),o}(eL))||bO;ew._RF.pop(),ew._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var b7,we,wt,wn,wi,wr,wa,wo=eS.ccclass,ws=eS.property,wl=(X(bN={},Z.HINT,"item.hintDesc"),X(bN,Z.PLIERS,"item.pliersDesc"),X(bN,Z.STORM,"item.stormDesc"),X(bN,Z.THUNDER,"item.thunderDesc"),bN),wu=(bz=wo("SpecialItem"),bB=ws({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),bF=B.required,bx=ws({type:eI,tooltip:"The button that activates the item"}),bU=ws({type:eD,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),bG=B.required,bH=ws({type:eT,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),bV=B.required,bq=ws({type:ek,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),bW=B.required,bK=ws({type:ek,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),bj=B.required,bY=ws({type:eH,group:"Animation"}),bX=B.required,bZ=ws({type:eH,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),bz((b$=n((bQ=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"isDevButton",b$,_(n)),E(n,"button",b0,_(n)),E(n,"quantity",b1,_(n)),E(n,"quantityLabel",b2,_(n)),E(n,"quantityNode",b4,_(n)),E(n,"plusNode",b3,_(n)),E(n,"glowUIOpacity",b5,_(n)),E(n,"uiOpacity",b6,_(n)),n.vibrateComp=null,n}return T(c,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){B.validateRequiredProperties(this,c)}},{key:"updateStatus",value:function(n){var w;if(void 0!==this.itemType){var k=null===(w=n.items)||void 0===w?void 0:w[this.itemType];k&&(this.setActiveStatus(k.canActivate),this.setQuantity(k.quantity,k.animate))}}},{key:"setActiveStatus",value:function(n){var w;null===(w=this.signal)||void 0===w||w.abort();var k=new x;this.signal=k,this.button.interactable=n,z.runTweenAsync(ez(this.uiOpacity).to(.2,{opacity:n?255:128}),k)}},{key:"activate",value:(L=N(function(){return _ts_generator(this,function(n){this.quantity<=0?this.requestItem():(this.vibrate(),this.node.scene.emit(i7.USE_ITEM,this.itemType));return[2]})}),function(){return L.apply(this,arguments)})},{key:"setQuantity",value:function(n,w){var k=arguments.length>1&&void 0!==w&&w,C=n;if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,void(this.plusNode.active=!1);C=Math.max(0,C),this.quantity=C,this.quantityLabel.string="".concat(this.quantity),C<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),k&&this.animateAddItem()}},{key:"requestItem",value:function(){void 0!==this.itemType?ei.openScreen(er.GET_ITEM_SCREEN,{item:this.itemType,localizedMessageKey:wl[this.itemType],quantity:1}):console.warn("Item type is not defined")}},{key:"vibrate",value:function(){var n,w;this.vibrateComp=null!==(n=this.vibrateComp)&&void 0!==n?n:this.node.getComponent(sw),null===(w=this.vibrateComp)||void 0===w||w.vibrate(50)}},{key:"animateAddItem",value:(I=N(function(){return _ts_generator(this,function(n){return[2,(this.glowUIOpacity.opacity=0,Promise.all([z.runTweenAsync(ez(this.node).to(.1,{scale:new eQ(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:eQ.ONE},{easing:"elasticOut"})),z.runTweenAsync(ez(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))]))]})}),function(){return I.apply(this,arguments)})}]),c}(eL)).prototype,"isDevButton",[bB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),b0=n(bQ.prototype,"button",[bF,bx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b1=n(bQ.prototype,"quantity",[bU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),b2=n(bQ.prototype,"quantityLabel",[bG,bH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b4=n(bQ.prototype,"quantityNode",[bV,bq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b3=n(bQ.prototype,"plusNode",[bW,bK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b5=n(bQ.prototype,"glowUIOpacity",[bj,bY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b6=n(bQ.prototype,"uiOpacity",[bX,bZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bJ=bQ))||bJ);ew._RF.pop(),ew._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var wc=eS.ccclass,wh=eS.disallowMultiple,wp=eS.property,wd=(b7=wc("Clock"),we=wp(ek),wt=wp(eT),b7(wn=wh((wr=n((wi=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"clockIcon",wr,_(n)),E(n,"timeLabel",wa,_(n)),n}return T(c,[{key:"__preload",value:function(){this.node.scene.on(i7.TIME_UPDATED,this.updateTimeLabel,this),this.node.scene.on(i7.RESCUE_START,this.handleRescueStart,this),this.node.scene.on(i7.RESCUE_FINISHED,this.handleRescueFinished,this)}},{key:"updateStatus",value:function(n){n.time&&this.updateTimeLabel(n.time)}},{key:"updateTimeLabel",value:function(n){var w=this.convertSecondsToMmSs(n);this.timeLabel.string=w}},{key:"convertSecondsToMmSs",value:function(n){var w=Math.floor(n/60),k=Math.floor(n%60),C=this.padZero(w),E=this.padZero(k);return"".concat(C,":").concat(E)}},{key:"padZero",value:function(n){return n<10?"0".concat(n):"".concat(n)}},{key:"handleRescueStart",value:(L=N(function(){var n,w,k;return _ts_generator(this,function(C){n=ez(this.node).to(.5,{scale:new eQ(1.1,1.1,1)}),w=ez(this.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),k=ez(this.clockIcon).repeat(5,w);z.runTweenAsync(k),z.runTweenAsync(n);return[2]})}),function(){return L.apply(this,arguments)})},{key:"handleRescueFinished",value:(I=N(function(){var n;return _ts_generator(this,function(w){n=ez(this.node).to(.5,{scale:new eQ(1,1,1)});z.runTweenAsync(n);return[2]})}),function(){return I.apply(this,arguments)})}]),c}(eL)).prototype,"clockIcon",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wa=n(wi.prototype,"timeLabel",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wn=wi))||wn)||wn);ew._RF.pop(),ew._RF.push({},"af947t5g91EkZVWXv5upZaV","CacheUtils",void 0);var wy,wf,wv,wg,wm,wb,ww,wS,wk,wC,wE,w_=GameCore.Utils.Image,wA=globalThis.game.frameCapture,wT=function(){function e(){C(this,e)}var n,w,k;return T(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getPlayerAvatar",value:(k=N(function(n,w,k,C){var E,_;return _ts_generator(this,function(T){switch(T.label){case 0:E=this.playerAvatarCache.get("".concat(w,":").concat(k));_=E;if(_)return[3,2];return[4,this.loadPlayerAvatar(n,w,k,C)];case 1:_=E=T.sent();T.label=2;case 2:return[2,E]}})}),function(n,w,C,E){return k.apply(this,arguments)})},{key:"loadPlayerAvatar",value:(w=N(function(n,w,k,C){var E,_;return _ts_generator(this,function(T){switch(T.label){case 0:return[4,this.loadImage(n,k,k,"".concat(w,":").concat(k))];case 1:E=T.sent();if((null==C||!C.aborted)&&E){_=e7.createWithImage(E);return[2,(this.playerAvatarCache.set("".concat(w,":").concat(k),_),_)]}return[2]}})}),function(n,k,C,E){return w.apply(this,arguments)})},{key:"isAvatarCached",value:function(n,w){return this.playerAvatarCache.has("".concat(n,":").concat(w))}},{key:"loadImage",value:(n=N(function(n,w,k,C){var E,_;return _ts_generator(this,function(T){switch(T.label){case 0:T.trys.push([0,5,,6]);return[4,wA.captureAsync({width:w,height:k,name:"LeaderAvatar",renderOptions:X({},C,{name:C,type:"image",depth:0,position:[0,0],size:[w,k],image:n})})];case 1:E=T.sent();if(!E)return[3,3];return[4,w_.loadImage(E)];case 2:_=T.sent();return[3,4];case 3:_=null;T.label=4;case 4:return[2,_];case 5:T.sent();return[2,null];case 6:return[2]}})}),function(w,k,C,E){return n.apply(this,arguments)})}]),e}();wT.playerAvatarCache=new Map;try{new wT}catch(n){console.error("CacheUtils",n)}ew._RF.pop(),ew._RF.push({},"540108ucKBPYbN9gW5TFh/q","LeaderRail",void 0);var wP,wR,wI,wO,wL,wD=eS.ccclass,wM=eS.property,wN=(wy=wD("LeaderRail"),wf=wM(eT),wv=wM(ek),wg=wM(ex),wm=wM(yq),wy((wS=n((ww=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"scoreLabel",wS,_(n)),E(n,"crown",wk,_(n)),E(n,"avatar",wC,_(n)),E(n,"spark",wE,_(n)),n.score=0,n}return T(c,[{key:"__preload",value:function(){this.defaultAvatar=this.avatar.spriteFrame,this.uiOpacity=this.getComponent(eH)}},{key:"updateScore",value:(L=N(function(n,w){var k,C,E,_,T;var I=arguments;return _ts_generator(this,function(L){switch(L.label){case 0:k=this,C=I.length>2&&void 0!==I[2]&&I[2],E=n-this.score,_=C?0:.5,T=ez(this.node).to(_,{},{onUpdate:function(n,w){if(w){var C=Math.floor(E*w)+k.score;k.scoreLabel.string=C.toString()}}});return[4,z.runTweenAsync(T,w)];case 1:L.sent(),this.score=n,this.scoreLabel.string=n.toString();return[2]}})}),function(n,w){return L.apply(this,arguments)})},{key:"updatePhoto",value:(I=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=GameSDK.player.getPhoto(),w=GameSDK.player.getID();if(!(n&&w))return[3,2];return[4,wT.getPlayerAvatar(n,w,50)];case 1:k=C.sent();k?(k.packable=!0,this.avatar.spriteFrame=k):this.avatar.spriteFrame=this.defaultAvatar;C.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"setCrown",value:function(n){this.crown.active=n}},{key:"setOpacity",value:function(n){this.uiOpacity.opacity=n}},{key:"playSparkParticle",value:function(){this.spark.play()}},{key:"stopSparkParticle",value:function(){this.spark.stop()}}]),c}(eL)).prototype,"scoreLabel",[wf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wk=n(ww.prototype,"crown",[wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wC=n(ww.prototype,"avatar",[wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wE=n(ww.prototype,"spark",[wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wb=ww))||wb);ew._RF.pop(),ew._RF.push({},"00759vwS/dHS6GvHKvVE5Q1","TournamentProgressBar",void 0);var wz,wB,wF,wx,wU,wG,wH,wV,wq,wW,wK,wj,wY,wX,wZ,wJ,wQ=eS.ccclass,w$=eS.property,w0=474,w1=(wP=wQ("TournamentProgressBar"),wR=w$(wN),wP((wL=n((wO=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"playerLeader",wL,_(n)),n.onUpdate=function(){n.playerLeader&&n.playerLeader.node&&(n.playerLeader.node.position=new eQ(n.progressBar.progress*w0-237,0,0))},n}return T(u,[{key:"__preload",value:function(){this.progressBar=this.getComponent(e2)}},{key:"updateProgress",value:(I=N(function(n,w){var k,C,E;var _=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:k=_.length>2&&void 0!==_[2]?_[2]:.5,C=_.length>3&&void 0!==_[3]?_[3]:"cubicOut",E=ez(this.progressBar).to(k,{progress:n},{easing:C,onUpdate:this.onUpdate});return[4,z.runTweenAsync(E,w)];case 1:T.sent();return[2]}})}),function(n,w){return I.apply(this,arguments)})},{key:"getProgress",value:function(){return this.progressBar.progress}}]),u}(eL)).prototype,"playerLeader",[wR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wI=wO))||wI);ew._RF.pop(),ew._RF.push({},"16d68fBLT1Ha7lXADThDtfC","TournamentRail",void 0);var w2,w4,w3,w5,w6,w8,w9,w7,Se,St=eS.ccclass,Sn=eS.property,Si=GameCore,Sr=Si.Utils.Array,Sa=Si.Match.Modes,So=(wz=St("TournamentRail"),wB=Sn(w1),wF=Sn(wN),wx=Sn(ek),wU=Sn(ek),wG=Sn(j),wH=Sn(j),wV=B.onlyRunInLifeCycleAsync,wz((wK=n((wW=function(n){w(f,n);var I,L,D,M,B,F=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=F.call.apply(F,[this].concat(k)),E(n,"progressBar",wK,_(n)),E(n,"playerLeader",wj,_(n)),E(n,"flag",wY,_(n)),E(n,"sword",wX,_(n)),E(n,"currentRankLocalizer",wZ,_(n)),E(n,"nextRankLocalizer",wJ,_(n)),n.nextLeaderIndex=0,n.score=0,n.minScore=0,n.maxScore=0,n.signal=new x,n}return T(f,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eH),this.playerLeader.updatePhoto()}},{key:"updateStatus",value:(B=N(function(n){var w,k,C;return _ts_generator(this,function(E){if(s2.getMatchMode()===Sa.TOURNAMENT){this.signal.abort();k=new x;this.signal=k,this.uiOpacity.opacity=255,this.score=null!==(w=n.score)&&void 0!==w?w:this.score;C=n.leaderData;C&&(this.nextLeaderIndex=this.getScoreReachedLeaderIndex(this.score,C),this.syncRail(C,k,!0))}else this.uiOpacity.opacity=0;return[2]})}),function(n){return B.apply(this,arguments)})},{key:"syncRail",value:(M=N(function(n,w){var k,C,E,_,T,I,L;var D=arguments;return _ts_generator(this,function(M){switch(M.label){case 0:k=D.length>2&&void 0!==D[2]&&D[2],C=n[this.nextLeaderIndex-1],E=n[this.nextLeaderIndex],_=C?C.rank:E?E.rank+1:1;this.setRankLabel(_,this.currentRankLocalizer);T=!E;this.nextRankLocalizer.node.active=!T,this.runActiveAnimation(this.sword,!T,w,k),this.playerLeader.setCrown(T),this.playerLeader.updateScore(this.score,w,k);I=k?0:void 0;if(!T)return[3,2];this.playerLeader.playSparkParticle();return[4,this.progressBar.updateProgress(1,w,I)];case 1:M.sent();return[3,4];case 2:this.playerLeader.stopSparkParticle(),this.setRankLabel(E.rank,this.nextRankLocalizer),this.minScore=C?C.score:0,this.maxScore=E.score;L=(this.score-this.minScore)/(this.maxScore-this.minScore);L=.8*L+.1;return[4,this.progressBar.updateProgress(L,w,I)];case 3:M.sent();M.label=4;case 4:return[2]}})}),function(n,w){return M.apply(this,arguments)})},{key:"handleScoreUpdated",value:(D=N(function(n){var w,k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:w=n.score,k=n.leaderData;if(!(void 0!==w&&k&&this.score!==w))return[3,4];this.signal.abort();C=new x;this.signal=C,this.score=w;E=this.getScoreReachedLeaderIndex(w,k);if(!(E>this.nextLeaderIndex))return[3,3];this.nextLeaderIndex=E;_=(1-this.progressBar.getProgress())/1.5;_=Math.min(_,.5);return[4,this.progressBar.updateProgress(1,C,_,"cubicIn")];case 1:T.sent(),this.runBubbleAnimation(this.sword,C);return[4,this.progressBar.updateProgress(0,C,0)];case 2:T.sent(),this.runBubbleAnimation(this.flag,C);T.label=3;case 3:this.syncRail(k,C);T.label=4;case 4:return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"runBubbleAnimation",value:(L=N(function(n,w){var k;return _ts_generator(this,function(C){switch(C.label){case 0:n.scale=eQ.ONE;k=ez(n).to(.1,{scale:new eQ(1.2,1.2,1.2)}).to(.2,{scale:eQ.ONE},{easing:"backOut"});return[4,z.runTweenAsync(k,w)];case 1:C.sent(),n.scale=eQ.ONE;return[2]}})}),function(n,w){return L.apply(this,arguments)})},{key:"runActiveAnimation",value:(I=N(function(n,w,k){var C,E,_,T,I;var L=arguments;return _ts_generator(this,function(D){switch(D.label){case 0:C=L.length>3&&void 0!==L[3]&&L[3],E=w?eQ.ZERO:eQ.ONE,_=w?eQ.ONE:eQ.ZERO;if(!C)return[3,1];n.scale=_;return[3,3];case 1:if(!!n.scale.equals(_))return[3,3];T=w?"backOut":"quadOut";n.scale=E;I=ez(n).to(.1,{scale:new eQ(1.2,1.2,1.2)}).to(.2,{scale:_},{easing:T});return[4,z.runTweenAsync(I,k)];case 2:D.sent(),n.scale=_;D.label=3;case 3:return[2]}})}),function(n,w,k){return I.apply(this,arguments)})},{key:"getScoreReachedLeaderIndex",value:function(n,w){var k=Sr.searchIndex(w,function(w){return w.score>=n});return -1===k?w.length:k}},{key:"setRankLabel",value:function(n,w){1!==n?2!==n?3!==n?(w.key="status.nth",w.setParams([n.toString()])):w.key="status.third":w.key="status.second":w.key="status.first"}}]),f}(eL)).prototype,"progressBar",[wB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wj=n(wW.prototype,"playerLeader",[wF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wY=n(wW.prototype,"flag",[wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wX=n(wW.prototype,"sword",[wU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wZ=n(wW.prototype,"currentRankLocalizer",[wG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wJ=n(wW.prototype,"nextRankLocalizer",[wH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(wW.prototype,"updateStatus",[wV],Object.getOwnPropertyDescriptor(wW.prototype,"updateStatus"),wW.prototype),wq=wW))||wq);ew._RF.pop(),ew._RF.push({},"ac5371+oVZBLoBKwAM7rH3r","GameSceneLayout",void 0);var Ss,Sl,Su,Sh,Sp,Sd,Sy,Sf,Sv,Sg=eS.ccclass,Sm=eS.property,Sb=(w2=Sg("GameSceneLayout"),w4=Sm(So),w3=Sm(wd),w5=Sm(wu),w2((w9=n((w8=function(n){w(d,n);var I,D,M,z=k(d);function d(){var n;C(this,d);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=z.call.apply(z,[this].concat(k)),E(n,"tournamentRail",w9,_(n)),E(n,"clock",w7,_(n)),E(n,"items",Se,_(n)),n.isInited=!1,n.entranceSignal=new x,n.exitSignal=new x,n}return T(d,[{key:"waitForInitAsync",value:(M=N(function(){var n;return _ts_generator(this,function(w){n=this;if(!this.isInited)return[2,new Promise(function(w){var k=setInterval(function(){n.isInited&&(clearInterval(k),w())},100)})];return[2]})}),function(){return M.apply(this,arguments)})},{key:"setLevelText",value:function(n){}},{key:"disableLayout",value:function(){}},{key:"enableLayout",value:function(){}},{key:"updateStatus",value:function(n){this.clock.updateStatus(n),this.tournamentRail.updateStatus(n);var w,k=L(this.items);try{for(k.s();!(w=k.n()).done;)w.value.updateStatus(n)}catch(n){k.e(n)}finally{k.f()}}},{key:"playExitAnimUI",value:(D=N(function(){return _ts_generator(this,function(n){return[2]})}),function(){return D.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(I=N(function(){return _ts_generator(this,function(n){return[2]})}),function(){return I.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){}},{key:"unHighlightCoinContainer",value:function(){}}]),d}(eL)).prototype,"tournamentRail",[w4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w7=n(w8.prototype,"clock",[w3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Se=n(w8.prototype,"items",[w5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),w6=w8))||w6);ew._RF.pop(),ew._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var Sw,SS,Sk,SC,SE,S_,SA,ST,SP,SR,SI,SO,SL,SD=eS.ccclass,SM=eS.property,SN=eS.disallowMultiple,Sz=(Ss=SD("ScoreBlock"),Sl=SM(eT),Su=SM(eW),Sh=SM({visible:function(){return this.isResizeWidth}}),Ss(Sp=SN((Sy=n((Sd=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"scoreText",Sy,_(n)),E(n,"isResizeWidth",Sf,_(n)),E(n,"maxScoreWidth",Sv,_(n)),n.panelWidthDiff=0,n}return T(c,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(e_),this.scoreUITransform=this.scoreText.node.getComponent(e_),this.panelWidthDiff=this.uiTransform.width-this.maxScoreWidth,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"updateScore",value:(L=N(function(n){var w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:w=this,k=n-this.score,C=ez(this.node).to(.1,{},{onUpdate:function(n,C){if(C){var E=Math.floor(k*C)+w.score;w.scoreText.string=E.toString(),w.resizeWidth()}}});return[4,z.runTweenAsync(C)];case 1:E.sent(),this.setScore(n);return[4,this.resizeWidth()];case 2:E.sent();return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"setScore",value:function(n){var w=null!=n?n:0;this.score=w,this.scoreText.string=w.toString()}},{key:"resizeWidth",value:(I=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=this;if(!this.isResizeWidth)return[3,2];w=this.uiTransform.width,k=(this.scoreUITransform.width>this.maxScoreWidth?this.scoreUITransform.width:this.maxScoreWidth)+this.panelWidthDiff;this.uiTween&&this.uiTween.stop(),this.uiTween=ez(this.node).to(.05,{},{easing:"sineOut",onUpdate:function(C,E){E&&(n.uiTransform.width=e0.lerp(w,k,E))}});return[4,z.runTweenAsync(this.uiTween)];case 1:C.sent(),this.uiTransform.width=k;C.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})}]),c}(eL)).prototype,"scoreText",[Sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sf=n(Sd.prototype,"isResizeWidth",[Su],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Sv=n(Sd.prototype,"maxScoreWidth",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Sp=Sd))||Sp)||Sp);ew._RF.pop(),ew._RF.push({},"b1ef276tNtH+oc5BqYfDMXl","Sidebar",void 0);var SB,SF,Sx,SU,SG,SH,SV,Sq,SW,SK,Sj,SY=eS.ccclass,SX=eS.property,SZ=eS.disallowMultiple,SJ=(Sw=SY("Sidebar"),SS=SX(Sz),Sk=SX(eT),SC=SX(ek),SE=SX(ek),S_=SX(tc),Sw(SA=SZ((SP=n((ST=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"scoreBlock",SP,_(n)),E(n,"levelNumber",SR,_(n)),E(n,"sidebarContainer",SI,_(n)),E(n,"leavesContainer",SO,_(n)),E(n,"entranceCurve",SL,_(n)),n.originSidebarPosition=0,n.originLeavesPosition=0,n}return T(s,[{key:"onLoad",value:function(){this.node.scene.on(i7.SCORE_UPDATED,this.updateScore,this)}},{key:"onDestroy",value:function(){this.node.scene.off(i7.SCORE_UPDATED,this.updateScore,this)}},{key:"saveOriginPos",value:function(){this.originSidebarPosition=this.sidebarContainer.position.y,this.originLeavesPosition=this.leavesContainer.position.y}},{key:"initUIPos",value:function(){this.sidebarContainer.setPosition(this.sidebarContainer.position.x,this.originSidebarPosition+1200),this.leavesContainer.setPosition(this.leavesContainer.position.x,this.originLeavesPosition+150)}},{key:"playExitAnimUI",value:function(n){var w=ez(this.sidebarContainer).to(.2,{position:new eQ(this.sidebarContainer.position.x,this.originSidebarPosition+1200,0)},{easing:"quadIn"}),k=ez(this.leavesContainer);return k.delay(.1).to(.2,{position:new eQ(this.leavesContainer.position.x,this.originLeavesPosition+150,0)},{easing:"quadIn"}),[z.runTweenAsync(w,n),z.runTweenAsync(k,n)]}},{key:"playEntranceAnimUI",value:function(n){var w=this,k=ez(this.sidebarContainer).to(.3,{position:new eQ(this.sidebarContainer.position.x,this.originSidebarPosition,0)},{easing:function(n){return w.entranceCurve.evaluate(n)}}),C=ez(this.leavesContainer);return C.to(.2,{position:new eQ(this.leavesContainer.position.x,this.originLeavesPosition,0)},{easing:"quadIn"}),[z.runTweenAsync(k,n),z.runTweenAsync(C,n)]}},{key:"setLevelText",value:function(n){this.levelNumber.string=n.toString()}},{key:"updateStatus",value:function(n){this.scoreBlock.setScore(n.score),n.level&&this.setLevelText(n.level)}},{key:"updateScore",value:function(n){this.scoreBlock.updateScore(n)}}]),s}(eL)).prototype,"scoreBlock",[SS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SR=n(ST.prototype,"levelNumber",[Sk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SI=n(ST.prototype,"sidebarContainer",[SC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SO=n(ST.prototype,"leavesContainer",[SE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SL=n(ST.prototype,"entranceCurve",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tc}}),SA=ST))||SA)||SA);ew._RF.pop(),ew._RF.push({},"0ff4fFbKylIvaONtaTZkRQV","LandscapeLayout",void 0);var SQ,S$,S0,S1,S2,S4,S3,S5=eS.ccclass,S6=eS.property,S8=(SB=S5("LandscapeLayout"),SF=S6(SJ),Sx=S6(ek),SU=S6(ek),SG=S6(ek),SB((Sq=n((SV=function(n){w(f,n);var I,B,F=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=F.call.apply(F,[this].concat(k)),E(n,"sidebar",Sq,_(n)),E(n,"tournamentContainer",SW,_(n)),E(n,"leftAnimNodes",SK,_(n)),n.originLeftNodesPos=[],E(n,"rightAnimNodes",Sj,_(n)),n.originRightNodesPos=[],n}return T(f,[{key:"onLoad",value:function(){var n=this;eO.once(e5.EVENT_AFTER_UPDATE,function(){n.saveOriginPos(),n.initUIPos(),n.isInited=!0})}},{key:"saveOriginPos",value:function(){this.sidebar.saveOriginPos();var n,w=L(this.leftAnimNodes);try{for(w.s();!(n=w.n()).done;){var k=n.value;this.originLeftNodesPos.push(k.position.clone())}}catch(n){w.e(n)}finally{w.f()}var C,E=L(this.rightAnimNodes);try{for(E.s();!(C=E.n()).done;){var _=C.value;this.originRightNodesPos.push(_.position.clone())}}catch(n){E.e(n)}finally{E.f()}}},{key:"initUIPos",value:function(){var n=this;this.sidebar.initUIPos(),this.leftAnimNodes.forEach(function(w,k){var C=n.originLeftNodesPos[k].clone();C.y+=1200,w.setPosition(C)}),this.rightAnimNodes.forEach(function(w,k){var C=n.originRightNodesPos[k].clone();C.x+=750,w.setPosition(C)})}},{key:"playExitAnimUI",value:(B=N(function(){var n,w,k;var C=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:n=this,w=C.length>0&&void 0!==C[0]?C[0]:.2;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new x;k=[];this.leftAnimNodes.forEach(function(C,E){var _=new eQ(n.node.position.x,n.originLeftNodesPos[E].y+1200,0),T=ez(C);T.to(w,{position:_},{easing:"quadIn"}),k.push(z.runTweenAsync(T,n.exitSignal))}),this.rightAnimNodes.forEach(function(C,E){var _=new eQ(n.originRightNodesPos[E].x+750,C.position.y,0),T=ez(C);T.to(w,{position:_},{easing:"backIn"}),k.push(z.runTweenAsync(T,n.exitSignal))}),k.push.apply(k,Y(this.sidebar.playExitAnimUI(this.exitSignal)));return[4,Promise.all(k)];case 1:E.sent();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(I=N(function(){var n,w,k;var C=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:n=this,w=C.length>0&&void 0!==C[0]?C[0]:.4;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new x;k=[];this.leftAnimNodes.forEach(function(C,E){var _=new eQ(n.node.position.x,n.originLeftNodesPos[E].y,0),T=ez(C);T.to(w,{position:_},{easing:"quadOut"}),k.push(z.runTweenAsync(T,n.entranceSignal))}),this.rightAnimNodes.forEach(function(C,E){var _=new eQ(n.originRightNodesPos[E].x,C.position.y,0),T=ez(C);T.to(w,{position:_},{easing:"backOut"}),k.push(z.runTweenAsync(T,n.entranceSignal))}),k.push.apply(k,Y(this.sidebar.playEntranceAnimUI(this.entranceSignal)));return[4,Promise.all(k)];case 1:E.sent();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"setLevelText",value:function(n){this.sidebar.setLevelText(n)}},{key:"updateStatus",value:function(n){D(M(f.prototype),"updateStatus",this).call(this,n),this.sidebar.updateStatus(n)}}]),f}(Sb)).prototype,"sidebar",[SF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SW=n(SV.prototype,"tournamentContainer",[Sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SK=n(SV.prototype,"leftAnimNodes",[SU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Sj=n(SV.prototype,"rightAnimNodes",[SG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SH=SV))||SH);ew._RF.pop(),ew._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var S9,S7,ke,kt,kn,ki,kr,ka=eS.ccclass,ko=eS.property,ks=(SQ=ka("UIMasks"),S$=ko(iA),S0=ko(gk),SQ((S4=n((S2=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"background",S4,_(n)),E(n,"alphaMasks",S3,_(n)),n}return T(c,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"show",value:(L=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:this.alphaMasks.setMaskActive(0,s7.isPortrait()),this.alphaMasks.setMaskActive(1,s7.isLandscape()),this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:n.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"hide",value:(I=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:n.sent(),this.background.node.active=!1;return[2]}})}),function(){return I.apply(this,arguments)})}]),c}(eL)).prototype,"background",[S$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S3=n(S2.prototype,"alphaMasks",[S0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S1=S2))||S1);ew._RF.pop(),ew._RF.push({},"424745QWUlDPabdCe8UcRwy","ChallengeScoreBlock",void 0);var kl,ku,kh,kp,kd,ky,kf,kv,kg,km=eS.ccclass,kb=eS.property,kw=(S9=km("ChallengeScoreBlock"),S7=kb(ex),ke=kb(e7),S9((ki=n((kn=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"avatar",ki,_(n)),E(n,"defaultAvatar",kr,_(n)),n}return T(u,[{key:"updateInfo",value:(I=N(function(n,w,k){var C,E;return _ts_generator(this,function(_){switch(_.label){case 0:C=this;this.setScore(k),this.scheduleOnce(function(){return C.resizeWidth()},0);_.label=1;case 1:_.trys.push([1,3,,4]);return[4,wT.getPlayerAvatar(n,w,50)];case 2:E=_.sent();if(!E)return[2];E.packable=!0,this.avatar.spriteFrame=E;return[3,4];case 3:_.sent();this.avatar.spriteFrame=this.defaultAvatar;return[3,4];case 4:return[2]}})}),function(n,w,k){return I.apply(this,arguments)})}]),u}(Sz)).prototype,"avatar",[S7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kr=n(kn.prototype,"defaultAvatar",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kt=kn))||kt);ew._RF.pop(),ew._RF.push({},"f963aJjCvtD0Y2LplwjDer1","ScoreContainer",void 0);var kS,kk,kC,kE,k_,kA,kT,kP,kR,kI,kO,kL,kD,kM,kN,kz,kB=eS.ccclass,kF=eS.property,kx=GameCore.Match.Modes,kU=globalThis.game.match,kG=(kl=kB("ScoreContainer"),ku=kF(Sz),kh=kF(kw),kp=kF(kw),kl((kf=n((ky=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"scoreBlock",kf,_(n)),E(n,"playerScoreBlock",kv,_(n)),E(n,"opponentScoreBlock",kg,_(n)),n.scoreBlockShown=!1,n.challengeScoreBlockShown=!1,n}return T(s,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}},{key:"listenGameEvents",value:function(){this.node.scene.on(i7.SCORE_UPDATED,this.updateScore,this)}},{key:"unlistenGameEvents",value:function(){this.node.scene.off(i7.SCORE_UPDATED,this.updateScore,this)}},{key:"updateStatus",value:function(n){switch(kU.getMatchState().mode){case kx.CHALLENGE_FRIEND:this.showChallengeScoreBlock(),this.hideScoreBlock(),this.playerScoreBlock.setScore(n.score);break;case kx.SINGLE:this.hideChallengeScoreBlock(),this.showScoreBlock(),this.scoreBlock.setScore(n.score);break;default:this.hideScoreBlock(),this.hideChallengeScoreBlock()}}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"showChallengeScoreBlock",value:function(){var n;if(!this.challengeScoreBlockShown){this.challengeScoreBlockShown=!0;var w=kU.getMatchState(),k=null!==(n=s2.getMatchCustomData())&&void 0!==n?n:{},C=k.playerId,E=k.opponentId;if(C&&E){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var _=w.profiles[C],T=w.profiles[E];this.playerScoreBlock.updateInfo(_.photo,C,_.score),this.opponentScoreBlock.updateInfo(T.photo,E,T.score)}}}},{key:"hideChallengeScoreBlock",value:function(){this.challengeScoreBlockShown&&(this.challengeScoreBlockShown=!1,this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1)}},{key:"showScoreBlock",value:function(){var n;if(!this.scoreBlockShown){this.scoreBlockShown=!0;var w=(null!==(n=s2.getMatchCustomData())&&void 0!==n?n:{}).score;this.scoreBlock.node.active=!0,this.scoreBlock.setScore(w)}}},{key:"hideScoreBlock",value:function(){this.scoreBlockShown&&(this.scoreBlockShown=!1,this.scoreBlock.node.active=!1)}},{key:"updateScore",value:function(n){this.challengeScoreBlockShown?this.playerScoreBlock.updateScore(n):this.scoreBlockShown&&this.scoreBlock.updateScore(n)}}]),s}(eL)).prototype,"scoreBlock",[ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kv=n(ky.prototype,"playerScoreBlock",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kg=n(ky.prototype,"opponentScoreBlock",[kp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kd=ky))||kd);ew._RF.pop(),ew._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var kH,kV,kq,kW,kK,kj,kY,kX,kZ,kJ=eS.ccclass,kQ=eS.property,k$=(kS=kJ("Header"),kk=kQ(j),kC=kQ(ek),kE=kQ(ek),k_=kQ(ek),kA=kQ(ek),kT=kQ(kG),kP=B.onlyRunInLifeCycle,kS((kO=n((kI=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"levelTextLocalizer",kO,_(n)),E(n,"settingNode",kL,_(n)),E(n,"homeNode",kD,_(n)),E(n,"leftNode",kM,_(n)),E(n,"coinNode",kN,_(n)),E(n,"scoreContainer",kz,_(n)),n}return T(s,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(eH),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"updateStatus",value:function(n){this.scoreContainer.updateStatus(n),n.level&&this.setLevelText(n.level)}},{key:"highlightCoinContainer",value:function(){var n=e8("Canvas/Screens");if(n){var w=this.coinNode.worldPosition.clone();this.coinNode.parent=n,this.coinNode.worldPosition=w}}},{key:"removeCoinContainerHighlight",value:function(){var n=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=n}},{key:"setLevelText",value:function(n){this.levelTextLocalizer.setParams([n.toString()])}},{key:"setButtonsInteractable",value:function(n){var w=!(arguments.length>0&&void 0!==n)||n;this.settingNode.getComponent(eI).interactable=w,this.homeNode.getComponent(eI).interactable=w}},{key:"setActive",value:function(n){this.uiOpacity.opacity=n?255:0}}]),s}(eL)).prototype,"levelTextLocalizer",[kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kL=n(kI.prototype,"settingNode",[kC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kD=n(kI.prototype,"homeNode",[kE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kM=n(kI.prototype,"leftNode",[k_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kN=n(kI.prototype,"coinNode",[kA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kz=n(kI.prototype,"scoreContainer",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(kI.prototype,"setActive",[kP],Object.getOwnPropertyDescriptor(kI.prototype,"setActive"),kI.prototype),kR=kI))||kR);ew._RF.pop(),ew._RF.push({},"456584ngz9FupmxndAXqCbY","PortraitLayout",void 0);var k0=eS.ccclass,k1=eS.property,k2=(kH=k0("PortraitLayout"),kV=k1(k$),kq=k1([ek]),kW=k1([ek]),kH((kY=n((kj=function(n){w(g,n);var I,F,U=k(g);function g(){var n;C(this,g);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=U.call.apply(U,[this].concat(k)),E(n,"header",kY,_(n)),E(n,"topAnimNodes",kX,_(n)),n.originTopNodesPos=[],E(n,"botAnimNodes",kZ,_(n)),n.originBotNodesPos=[],n.hideBotWorldY=-80,n}return T(g,[{key:"onLoad",value:function(){var n=this;this.validateRequiredComponents(),eO.once(e5.EVENT_AFTER_UPDATE,function(){n.saveOriginPos(),n.initUIPos(),n.isInited=!0})}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var n,w=L(this.topAnimNodes);try{for(w.s();!(n=w.n()).done;){var k=n.value;this.originTopNodesPos.push(k.position.clone())}}catch(n){w.e(n)}finally{w.f()}var C,E=L(this.botAnimNodes);try{for(E.s();!(C=E.n()).done;){var _=C.value;this.originBotNodesPos.push(_.position.clone())}}catch(n){E.e(n)}finally{E.f()}}},{key:"initUIPos",value:function(){var n=this;this.topAnimNodes.forEach(function(w,k){var C=n.originTopNodesPos[k].clone();C.y+=200,w.setPosition(C)});var w=new eQ(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(function(k,C){var E,_,T=n.originBotNodesPos[C].clone();w.y=n.hideBotWorldY;var I=null!==(E=null===(_=k.parent)||void 0===_?void 0:_.inverseTransformPoint(w,w).y)&&void 0!==E?E:200;T.y=I,k.setPosition(T)})}},{key:"setLevelText",value:function(n){this.header.setLevelText(n)}},{key:"disableLayout",value:function(){this.header.setButtonsInteractable(!1)}},{key:"enableLayout",value:function(){this.header.setButtonsInteractable()}},{key:"updateStatus",value:function(n){D(M(g.prototype),"updateStatus",this).call(this,n),this.header.updateStatus(n)}},{key:"playExitAnimUI",value:(F=N(function(){var n,w,k,C,E,_,T,I,D,M,N,B;var F=arguments;return _ts_generator(this,function(U){switch(U.label){case 0:n=this,w=F.length>0&&void 0!==F[0]?F[0]:.17;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new x;k=[];this.topAnimNodes.forEach(function(C,E){var _=new eQ(C.position.x,n.originTopNodesPos[E].y+200,0),T=ez(C);T.to(w,{position:_},{easing:"backIn"}),k.push(z.runTweenAsync(T,n.exitSignal))});E=new eQ(0,this.hideBotWorldY,0),_=L(this.botAnimNodes);try{for(_.s();!(C=_.n()).done;){D=C.value;E.y=this.hideBotWorldY;M=null!==(T=null===(I=D.parent)||void 0===I?void 0:I.inverseTransformPoint(E,E).y)&&void 0!==T?T:200,N=new eQ(D.position.x,M,0),B=ez(D);B.to(w,{position:N},{easing:"backIn"}),k.push(z.runTweenAsync(B,this.exitSignal))}}catch(n){_.e(n)}finally{_.f()}return[4,Promise.all(k)];case 1:U.sent(),this.exitSignal.aborted||this.header.setActive(!1);return[2]}})}),function(){return F.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(I=N(function(){var n,w,k;var C=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:n=this,w=C.length>0&&void 0!==C[0]?C[0]:.2;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new x,this.header.setActive(!0);k=[];this.topAnimNodes.forEach(function(C,E){var _=new eQ(C.position.x,n.originTopNodesPos[E].y,0),T=ez(C);T.to(w,{position:_},{easing:"backOut"}),k.push(z.runTweenAsync(T,n.entranceSignal))}),this.botAnimNodes.forEach(function(C,E){var _=new eQ(C.position.x,n.originBotNodesPos[E].y,0),T=ez(C);T.to(w,{position:_},{easing:"backOut"}),k.push(z.runTweenAsync(T,n.entranceSignal))});return[4,Promise.all(k)];case 1:E.sent();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}}]),g}(Sb)).prototype,"header",[kV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kX=n(kj.prototype,"topAnimNodes",[kq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kZ=n(kj.prototype,"botAnimNodes",[kW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kK=kj))||kK);ew._RF.pop(),ew._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var k4,k3,k5,k6,k8,k9="bomb";ew._RF.pop(),ew._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var k7,Ce,Ct,Cn,Ci,Cr,Ca,Co,Cs,Cl,Cu,Ch,Cp,Cd,Cy,Cf,Cv,Cg=GameCore,Cm=Cg.Dtos.Player,Cb=Cg.Utils.Function,Cw=eS.ccclass,CS=eS.property,Ck=globalThis.game,CC=Ck.player,CE=Ck.language,C_=Object.keys(K),CA=(k4=Cw("DevToolsContainer"),k3=CS(ek),k4((k8=n((k6=function(n){w(y,n);var I,D,M,z,B=k(y);function y(){var n;C(this,y);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=B.call.apply(B,[this].concat(k)),E(n,"devToolsToggle",k8,_(n)),n.isActive=!0,n.game=null,n.bundleName="lowest",n.currentLocaleIndex=0,n.debouncedStarsNotification=Cb.debounce(function(){var n=CC.getGameData();n&&ei.showNotificationScreen("Stars added. Current stars: ".concat(n.stars))},700),n}return T(y,[{key:"injectGameplay",value:function(n){this.game=n}},{key:"start",value:function(){this.initCurrentLocale()}},{key:"initCurrentLocale",value:function(){var n=CE.getCurrentLocale();this.currentLocaleIndex=C_.indexOf(n)}},{key:"hideAllButtons",value:function(){var n,w=this.getComponentsInChildren(eI),k=L(w);try{for(k.s();!(n=k.n()).done;){var C=n.value.node.parent;C&&C.name!==this.devToolsToggle.name&&(C.active=!1)}}catch(n){k.e(n)}finally{k.f()}}},{key:"showAllButtons",value:function(){var n,w=this.getComponentsInChildren(eI),k=L(w);try{for(k.s();!(n=k.n()).done;){var C=n.value.node.parent;C&&C.name!==this.devToolsToggle.name&&(C.active=!0)}}catch(n){k.e(n)}finally{k.f()}}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){CC.setPlayerData(Cm.Data.getDefaultData()),ei.openScreen(er.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(i7.START_OVER,0)}},{key:"handleNextLevel",value:(z=N(function(){var n,w,k,C;return _ts_generator(this,function(E){C=(null!==(n=null===(w=this.game)||void 0===w||null===(w=w.getGameData())||void 0===w?void 0:w.level)&&void 0!==n?n:1)+1;null===(k=this.game)||void 0===k||k.setGameData({level:C-1}),CC.setGameData({level:C}),this.node.scene.emit(i7.NEXT_LEVEL);return[2]})}),function(){return z.apply(this,arguments)})},{key:"handlePrevLevel",value:(M=N(function(){var n,w,k,C;return _ts_generator(this,function(E){C=Math.max((null!==(n=null===(w=this.game)||void 0===w||null===(w=w.getGameData())||void 0===w?void 0:w.level)&&void 0!==n?n:2)-1,1);null===(k=this.game)||void 0===k||k.setGameData({level:C-1}),CC.setGameData({level:C}),this.node.scene.emit(i7.NEXT_LEVEL);return[2]})}),function(){return M.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(D=N(function(n){var w,k;return _ts_generator(this,function(C){k=Number(n.string);null===(w=this.game)||void 0===w||w.setGameData({level:k-1}),CC.setGameData({level:k}),this.node.scene.emit(i7.NEXT_LEVEL);return[2]})}),function(n){return D.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var n=globalThis.game.getBuildVersion();ei.showNotificationScreen("Build version: ".concat(n))}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(i7.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){var n;null===(n=this.game)||void 0===n||n.clockManager.setTime(.1)}},{key:"handleClickExplodeButton",value:function(){var n,w,k=this.game;if(k){var C=null===(n=k.getGameData())||void 0===n||null===(n=n.levelData)||void 0===n?void 0:n.specials.bomb;if(C&&!(C<=0)){var E=k.board.getBombTiles();if(0!==E.length){var _=E[0];if(!_||(null===(w=_.special)||void 0===w?void 0:w.type)!==k9)throw new Error("Invalid bomb tile");_.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(i7.ADD_ITEM,{item:Z.HINT,quantity:2}),this.node.scene.emit(i7.ADD_ITEM,{item:Z.STORM,quantity:2}),this.node.scene.emit(i7.ADD_ITEM,{item:Z.THUNDER,quantity:2}),this.node.scene.emit(i7.ADD_ITEM,{item:Z.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(i7.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var n=CC.getGameData();n&&(CC.setGameData({stars:n.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchQualityAssets",value:function(){switch(this.bundleName){case"lowest":this.bundleName="highest";break;case"highest":this.bundleName="lowest"}eY.emit(q.CHANGE_QUALITY_ASSETS,{quality:this.bundleName})}},{key:"handleSwitchLocale",value:(I=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:this.currentLocaleIndex=(this.currentLocaleIndex+1)%C_.length;n=C_[this.currentLocaleIndex];ei.showLoadingNotificationScreen();k.label=1;case 1:k.trys.push([1,3,,4]);if(!n)throw new Error("Locale is undefined");return[4,this.preloadLanguageAsync(n)];case 2:k.sent(),eY.emit(q.CHOOSE_LANGUAGE,{locale:n,saveToPlayerData:!0}),ei.showNotificationScreen("Language changed to ".concat(n));return[3,4];case 3:w=k.sent();console.error(w),ei.showNotificationScreen("Failed to change language");return[3,4];case 4:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"preloadLanguageAsync",value:function(n){return new Promise(function(w,k){eY.emit(q.PRELOAD_LANGUAGE,{locale:n,onLoad:w,onError:k})})}}]),y}(eL)).prototype,"devToolsToggle",[k3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k5=k6))||k5);ew._RF.pop(),ew._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var CT,CP,CR,CI,CO,CL,CD,CM,CN=eS.ccclass,Cz=eS.property,CB=GameCore,CF=CB.Utils.Valid,Cx=CB.Match.Modes,CU=W.Layout,CG=(k7=CN("UIManager"),Ce=Cz(bI),Ct=Cz(k2),Cn=Cz(S8),Ci=Cz(CA),Cr=Cz(b9),Ca=Cz(bM),Co=Cz(ks),k7((Cu=n((Cl=function(n){w(v,n);var I,D,M,z,B,F=k(v);function v(){var n;C(this,v);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=F.call.apply(F,[this].concat(k)),E(n,"interstitialAdIndicator",Cu,_(n)),E(n,"portraitLayout",Ch,_(n)),E(n,"landscapeLayout",Cp,_(n)),E(n,"devTools",Cd,_(n)),E(n,"comboProgressBar",Cy,_(n)),E(n,"comboContainer",Cf,_(n)),E(n,"uiMasks",Cv,_(n)),n.uiShown=!1,n.config={},n.showDevTools=function(){n.devTools&&(n.devTools.node.active=!0)},n}return T(v,[{key:"onLoad",value:function(){this.node.scene.on(sI.Events.UNLOCK_DEV_TOOLS,this.showDevTools),this.node.scene.on(i7.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(i7.RESCUE_FINISHED,this.hideRescueAnimation,this),this.node.scene.on(i7.SCORE_UPDATED,this.handleScoreUpdated,this),eY.on(q.ORIENTATION_CHANGED,this.onOrientationChanged,this),this.onOrientationChanged(s7.getCurrentLayout())}},{key:"onDestroy",value:function(){this.node.scene.off(sI.Events.UNLOCK_DEV_TOOLS,this.showDevTools),this.node.scene.off(i7.RESCUE_START,this.showRescueAnimation,this),this.node.scene.off(i7.RESCUE_FINISHED,this.hideRescueAnimation,this),this.node.scene.off(i7.SCORE_UPDATED,this.handleScoreUpdated,this),eY.off(q.ORIENTATION_CHANGED,this.onOrientationChanged,this)}},{key:"init",value:function(n){this.game=n,this.initDevTools(n)}},{key:"initDevTools",value:function(n){var w=this;window.addEventListener("reset-game-data",function(){var n;null===(n=w.devTools)||void 0===n||n.handleResetData()}),this.devTools&&(this.devTools.node.active=CF.isDebugger(),this.devTools.injectGameplay(n))}},{key:"setLevelText",value:function(n){this.config.level=n,this.currentLayout.setLevelText(n)}},{key:"startCountdown",value:function(){this.comboProgressBar.resume()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume()}},{key:"setComboUI",value:function(n){this.comboContainer.getComponent(iA).changeStateFade(n,.1)}},{key:"disableLayout",value:function(){this.currentLayout.disableLayout()}},{key:"enableLayout",value:function(){this.currentLayout.enableLayout()}},{key:"updateStatus",value:function(){var n;this.currentLayout.updateStatus({score:this.game.scoreManager.getCurrentScore(),leaderData:null===(n=this.game.tournamentManager)||void 0===n?void 0:n.leaderData,items:this.game.itemManager.itemConfigs}),this.comboContainer.updateStatus()}},{key:"showRescueAnimation",value:(B=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.uiMasks.show()];case 1:n.sent();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"hideRescueAnimation",value:(z=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.uiMasks.hide()];case 1:n.sent();return[2]}})}),function(){return z.apply(this,arguments)})},{key:"playExitAnimUI",value:(M=N(function(){var n;var w=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:n=w.length>0&&void 0!==w[0]?w[0]:.2;this.uiShown=!1;return[4,this.currentLayout.playExitAnimUI(n)];case 1:k.sent();return[2]}})}),function(){return M.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(D=N(function(){var n;var w=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:n=w.length>0&&void 0!==w[0]?w[0]:.17;this.uiShown=!0;return[4,this.currentLayout.playEntranceAnimUI(n)];case 1:k.sent();return[2]}})}),function(){return D.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.currentLayout.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.currentLayout.unHighlightCoinContainer()}},{key:"handleClickedPauseGame",value:function(){ei.openScreen(er.PAUSE_SCREEN),this.node.scene.emit(i7.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){ei.openScreen(er.QUIT_LEVEL_SCREEN),this.node.scene.emit(i7.GAME_PAUSE)}},{key:"items",get:function(){return this.currentLayout.items}},{key:"setInteractableItems",value:function(n){var w,k=!(arguments.length>0&&void 0!==n)||n,C=L(this.items);try{for(C.s();!(w=C.n()).done;){var E=w.value;k?void 0!==E.itemType?E.button.interactable=this.game.itemManager.canUseItem(E.itemType):console.warn("Item type is not defined"):E.button.interactable=!1}}catch(n){C.e(n)}finally{C.f()}}},{key:"onOrientationChanged",value:(I=N(function(n){var w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n===CU.Portrait?(this.landscapeLayout.node.active=!1,this.portraitLayout.node.active=!0,this.currentLayout=this.portraitLayout):n===CU.Landscape&&(this.portraitLayout.node.active=!1,this.landscapeLayout.node.active=!0,this.currentLayout=this.landscapeLayout);k=this.currentLayout;if(!k)return[3,2];this.currentLayout.updateStatus({level:this.config.level,score:this.game.scoreManager.getCurrentScore(),time:this.game.clockManager.getRemainingTime(),leaderData:null===(w=this.game.tournamentManager)||void 0===w?void 0:w.leaderData,items:this.game.itemManager.itemConfigs});return[4,this.currentLayout.waitForInitAsync()];case 1:k=(C.sent(),this.uiShown?this.playEntranceAnimUI(0):this.playExitAnimUI(0));C.label=2;case 2:return[2]}})}),function(n){return I.apply(this,arguments)})},{key:"handleScoreUpdated",value:function(n){var w;this.config.score=n,s2.getMatchMode()===Cx.TOURNAMENT&&this.currentLayout.tournamentRail.handleScoreUpdated({score:n,leaderData:null===(w=this.game.tournamentManager)||void 0===w?void 0:w.leaderData})}}]),v}(eL)).prototype,"interstitialAdIndicator",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch=n(Cl.prototype,"portraitLayout",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cp=n(Cl.prototype,"landscapeLayout",[Cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd=n(Cl.prototype,"devTools",[Ci],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cy=n(Cl.prototype,"comboProgressBar",[Cr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cf=n(Cl.prototype,"comboContainer",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cv=n(Cl.prototype,"uiMasks",[Co],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cs=Cl))||Cs);ew._RF.pop(),ew._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var CH=globalThis.game,CV=CH.player,Cq=CH.ads,CW=CH.event,CK=CH.match,Cj=CH.storage,CY=CH.analytics,CX=CH.monitorError,CZ=CH.leaderboard,CJ=GameCore,CQ=CJ.Events,C$=CJ.Utils,C0=C$.Time,C1=C$.Array,C2=C$.Valid,C4=CJ.Configs.Gameplay,C3=CJ.Match.Modes,C5=eS.ccclass,C6=eS.property,C8=[],C9={level:1,isFromLoader:!1};CT=C5("Gameplay"),CP=C6(uM),CR=C6(iA),CI=C6(cO),CT((CL=n((CO=function(n){w(p,n);var L,D,M=k(p);function p(){var n;C(this,p);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=M.call.apply(M,[this].concat(k)),E(n,"board",CL,_(n)),E(n,"opacityToggler",CD,_(n)),E(n,"pathDraw",CM,_(n)),n.gameData=null,n.rescueTiles=[],n.isAutoPlayEnabled=!1,n.handleOpenScreen=function(w){w.screenName===es[er.GET_ITEM_SCREEN]&&n.uiManager.highlightCoinContainer()},n.handleShowUI=N(function(){return _ts_generator(this,function(w){switch(w.label){case 0:n.uiManager.updateStatus(),n.uiManager.disableLayout(),n.uiManager.setInteractableItems(!1);return[4,n.uiManager.playEntranceAnimUI()];case 1:w.sent(),n.uiManager.enableLayout(),n.uiManager.setInteractableItems(!0);return[2]}})}),n.handleHideUI=N(function(){return _ts_generator(this,function(w){switch(w.label){case 0:n.uiManager.disableLayout(),n.uiManager.setInteractableItems(!1);return[4,n.uiManager.playExitAnimUI()];case 1:w.sent();return[2]}})}),n.handleCloseScreen=function(w){w.screenName===es[er.GET_ITEM_SCREEN]&&n.uiManager.unHighlightCoinContainer()},n.handlePauseGame=function(){n.node.scene.emit(i7.PAUSE_TIME),n.node.pauseSystemEvents(!0),n.opacityToggler.changeStateFade(!1,.1),n.uiManager.setComboUI(!1),n.processCrazyGamesGameplayStop()},n.handleResumeGame=function(){var w;n.node.resumeSystemEvents(!0),n.stateManager.isPlaying()&&n.node.scene.emit(i7.RESUME_TIME),n.processCrazyGamesGameplayStart(),n.opacityToggler.changeStateFade(!0,.1),n.uiManager.setComboUI(!0),null===(w=n.guidelinesManager)||void 0===w||w.startAutoGuides()},n.handleReplayGame=N(function(){var w,k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:n.handleHideHint();_.label=1;case 1:_.trys.push([1,6,,7]);w=s2.getMatchMode();k=w===C3.SINGLE;if(!k)return[3,3];return[4,s2.finishMatchAsync()];case 2:k=_.sent();_.label=3;case 3:C=w!==C3.CHALLENGE_FRIEND;if(!C)return[3,5];return[4,s2.startMatchAsync()];case 4:C=_.sent();_.label=5;case 5:w===C3.TOURNAMENT&&(n.scoreManager.resetTournamentStartScore(),n.setGameData({level:1}));return[3,7];case 6:E=_.sent();console.warn("handleReplayGame",E);return[3,7];case 7:n.stateManager.initialize();return[2]}})}),n.handleFinishGame=function(){var w;n.attemptCallCreateShortcut(),null!==(w=n.guidelinesManager)&&void 0!==w&&w.isNewbieGuideLevel()?(n.guidelinesManager.guideUi.guideSkipButton.active=!1,n.handleNextLevel()):n.stateManager.finish()},n.handleNextLevel=N(function(){var w,k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!n.gameData)return[3,12];k=s2.getMatchMode();_.label=1;case 1:_.trys.push([1,5,,6]);if(k!==C3.SINGLE)return[3,3];return[4,s2.finishMatchAsync()];case 2:_.sent();return[3,4];case 3:k===C3.TOURNAMENT&&n.scoreManager.updateTournamentStartScore();_.label=4;case 4:return[3,6];case 5:C=_.sent();console.warn("handleNextLevel",C);return[3,6];case 6:E=(null!==(w=n.gameData.level)&&void 0!==w?w:1)+1;n.setGameData({level:E});if(k!==C3.TOURNAMENT)return[3,8];return[4,s2.setMatchCustomDataAsync({level:E})];case 7:_.sent();return[3,11];case 8:return[4,s2.setMatchCustomDataAsync({level:E,score:0})];case 9:_.sent();return[4,s2.startMatchAsync()];case 10:_.sent();_.label=11;case 11:n.stateManager.initialize(),console.log("Next level",n.gameData.level);_.label=12;case 12:return[2]}})}),n.handleStartOver=function(){var w=N(function(w){var k;return _ts_generator(this,function(C){CV.setGameData({level:null!=w?w:1}),n.gameData=CV.getGameData(),n.stateManager.initialize(),console.info("Start over",null===(k=n.gameData)||void 0===k?void 0:k.level);return[2]})});return function(n){return w.apply(this,arguments)}}(),n.handleMaxLevel=function(){n.gameData&&(n.initData(),ei.openScreen(er.CONGRATULATION_SCREEN,{level:n.gameData.level}),console.info("Max level",n.gameData.level))},n.handleExitGame=N(function(){return _ts_generator(this,function(n){try{Cj.setStorageData("dashboard","animateToCurrentLevel",!0),Cj.setStorageData("collection","animateMapPackUnlock",!0)}catch(n){console.warn("handleExitGame",n)}return[2]})}),n.handleTileClick=function(w){n.stateManager.playing(),n.board.handleTileClick(w),n.handleHideHint()},n.handleGridMatchSuccess=function(w,k){n.pathDraw.drawMatchPath(w,function(w){var k=w.x,C=w.y;return n.board.getAnyTileWorldPosition(k,C)}),n.comboManager.addCombo(),n.handleAddScore(),n.effectManager.playClearEffectAt([k[0].node.worldPosition,k[1].node.worldPosition])},n.handleGridMatchFail=function(w){var k;null!==(k=n.guidelinesManager)&&void 0!==k&&k.isShowErrorPathLevel()&&n.pathDraw.drawErrorPath(w,function(w){var k=w.x,C=w.y;return n.board.getAnyTileWorldPosition(k,C)})},n.checkIfGameIsFinish=function(){0===n.board.getUncleared().length&&n.node.scene.emit(i7.GAME_FINISH)},n.handlePauseTime=function(){n.clockManager.pause(),n.uiManager.pauseTime()},n.handleResumeTime=function(){n.clockManager.resume(),n.uiManager.resumeTime()},n.handleClockTimeout=function(){n.stateManager.fail(s3)},n.handleHalfTime=function(){void 0!==n.guidelinesManager&&(n.board.getUncleared().length>=n.board.getCleared().length&&n.guidelinesManager.startThunderGuide()||n.board.getBombTiles().length>0&&n.guidelinesManager.startPliersGuide())},n.handleStartRescue=function(){var w,k,C;for(H.turnDownMusic(),F.setBlockInput(!0),n.board.setIgnoreInput(!0);n.rescueTiles.length>0;){var E=n.rescueTiles.pop();null==E||E.restore()}var _=null!==(w=s2.getMatchMode())&&void 0!==w?w:void 0;CY.levelRescue(null!==(k=null===(C=n.gameData)||void 0===C?void 0:C.level)&&void 0!==k?k:1,void 0,_)},n.handleFinishRescue=function(){F.setBlockInput(!1),n.board.setIgnoreInput(!1)},n.handleBombExplode=function(){var w=N(function(w){var k;return _ts_generator(this,function(C){switch(C.label){case 0:n.rescueTiles.push(w),n.board.setIgnoreInput(!0),F.getBlockInput()||(H.playSound(nI.BOMB_EXPLODE_1),F.setBlockInput(!0));k=w.node.worldPosition;return[4,n.effectManager.createBombExplosionAt(new eQ(k.x,k.y,0))];case 1:C.sent(),F.setBlockInput(!1),n.stateManager.isFail()||n.stateManager.fail(s5);return[2]}})});return function(n){return w.apply(this,arguments)}}(),n.handleShowHint=function(){if(!n.pathDraw.isDrawingHint){var w=n.board.getHintPath();w&&(H.playSound(nI.HINT_ITEM),n.pathDraw.drawHintPath(w,function(w){return n.board.getAnyTileWorldPosition(w.x,w.y)}),n.board.showHint(),n.node.scene.emit(i7.REFRESH_ITEMS))}},n.handleHideHint=function(){n.pathDraw.isDrawingHint&&(n.pathDraw.clearHintPath(),n.board.hideHint(),n.node.scene.emit(i7.REFRESH_ITEMS))},n.handleAddScore=function(){var w=n.levelManager.getLevelData().level,k=n.comboManager.getCombo(),C=n.clockManager.getRemainingTime();n.scoreManager.addScore(w,k,C)},n.handleUseItem=function(){var w=N(function(w){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=(n.stateManager.playing(),w!==Z.HINT&&n.handleHideHint(),n.itemManager.setQuantity(w,n.itemManager.getQuantity(w)-1),w);switch(k){case Z.HINT:return[3,1];case Z.PLIERS:return[3,2];case Z.STORM:return[3,3];case Z.THUNDER:return[3,5]}return[3,7];case 1:uB(n.board,n.pathDraw),n.node.scene.emit(i7.REFRESH_ITEMS);return[3,7];case 2:uF(n.board,n.effectManager),n.node.scene.emit(i7.REFRESH_ITEMS);return[3,7];case 3:n.node.scene.emit(i7.HIDE_UI);return[4,uY(n.board,n.effectManager)];case 4:C.sent(),n.node.scene.emit(i7.SHOW_UI);return[3,7];case 5:n.node.scene.emit(i7.HIDE_UI);return[4,uG(n.board,n.effectManager)];case 6:C.sent(),n.board.getUncleared().length>0&&n.node.scene.emit(i7.SHOW_UI);C.label=7;case 7:return[2]}})});return function(n){return w.apply(this,arguments)}}(),n.handleAutoPlay=function(){n.isAutoPlayEnabled?n.disableAutoPlay():n.enableAutoPlay()},n.enableAutoPlay=function(){n.isAutoPlayEnabled=!0,n.schedule(n.autoPlay,.5)},n.disableAutoPlay=function(){n.isAutoPlayEnabled=!1,n.unschedule(n.autoPlay)},n.autoPlay=function(){if(n.stateManager.isReady()||n.stateManager.isPlaying()){var w=n.board.getHintPath();if(!w)throw new Error("No path found");var k=w[0],C=w.slice(-1)[0];if(void 0!==k&&void 0!==C){var E=k.a,_=C.b,T=n.board.getTileAt(E.x,E.y),I=n.board.getTileAt(_.x,_.y);if(!T||!I)throw new Error("Tile is null");T.onClick(),I.onClick()}else{var L=new Error("No path found");if(C2.isDebugger())throw L;null==CX||CX.sendException(L)}}},n.handleAddStars=function(w){var k=CV.getGameData();if(!k)return Promise.resolve([]);CV.setGameData({stars:k.stars+1});var C=w.startAnimationAt;C&&n.effectManager.playStarEffectAt(C)},n.handleChallengeFriends=N(function(){var w,k,C,E,_,T,I,L,D,M,N,z,B,F,x;return _ts_generator(this,function(U){switch(U.label){case 0:U.trys.push([0,4,,5]);ei.showLoadingScreen();E=n.board.generateFenFromCurrentLevel(),_=(null!==(w=CV.getGameData())&&void 0!==w?w:{}).level,T=void 0===_?1:_;T=Math.max(1,T);I=null!==(k=null===(C=n.gameData)||void 0===C?void 0:C.levelData)&&void 0!==k?k:{},L=I.mode,D=void 0===L?"":L,M=I.rules,N=void 0===M?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:M,z=I.time,B=void 0===z?0:z;return[4,CK.context.choose.processAsync({playerId:CV.getPlayerId(),fallbackSingleMode:!1,extraData:{level:T,fen:E,gravity:D,rules:N,time:B}})];case 1:U.sent();F=s2.getMatchMode()===C3.TOURNAMENT;if(!F)return[3,3];return[4,n.tryInitTournamentMode(!0)];case 2:F=U.sent();U.label=3;case 3:ei.closeLoadingScreen(),n.node.scene.emit(i7.GAME_RESUME),n.node.scene.emit(i7.GAME_REPLAY,{level:T});return[3,5];case 4:x=U.sent();if(console.warn("Unable to invite friends",x),ei.closeLoadingScreen(),ei.showNotificationScreenWithLocalizedKey("error.tryLater"),!_instanceof(x,Error))return[2];null==CX||CX.sendException(x),n.node.scene.emit(i7.GAME_RESUME),n.node.scene.emit(i7.SHOW_UI);return[3,5];case 5:return[2]}})}),n.handleAdShow=function(w){var k=w.placementId;k&&-1!==C8.indexOf(k)&&(C8.splice(C8.indexOf(k),1),Cq.hideBannerAdAsync(k).catch(function(){}),0===C8.length&&CW.off(CQ.AD_SHOWING,n.handleAdShow))},n.handleAddItem=function(){var w=N(function(w){var k,C,E,_,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:k=w.animate,C=w.item,E=w.quantity,_=C1.search(n.uiManager.items,function(n){return n.itemType===C});if(!(void 0!==_))return[3,3];T=n.itemManager.getQuantity(C)+E;if(n.itemManager.saveQuantity(C,T),n.uiManager.setInteractableItems(!1),n.handlePauseGame(),!k)return[3,2];I=k.startWorldPosition;return[4,n.effectManager.playItemAddAnimation(new eQ(I.x,I.y),_)];case 1:L.sent();L.label=2;case 2:n.itemManager.setQuantity(C,T,!0),n.uiManager.setInteractableItems(!0),n.handleResumeGame();return[3,4];case 3:console.warn("Item ".concat(C," not found"));L.label=4;case 4:return[2]}})});return function(n){return w.apply(this,arguments)}}(),n}return T(p,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function(){sG.init()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initClockManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}},{key:"initUIManager",value:function(){var n;this.uiManager=null===(n=this.node.parent)||void 0===n?void 0:n.getComponentInChildren(CG),this.uiManager.init(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(mU)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(bh)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(s8)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(vP)}},{key:"initItemManager",value:function(){this.itemManager=this.getComponent(mL),this.itemManager.init(this)}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(cX),this.comboManager.init()}},{key:"initClockManager",value:function(){this.clockManager=this.getComponent(cN),this.clockManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(mV),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){C4.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(m_),this.guidelinesManager.init(this))}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){C8=[],CW.off(CQ.AD_SHOWING,this.handleAdShow),CW.clear(CQ.OPENING_SCREEN),CW.clear(CQ.CLOSING_SCREEN),CW.on(CQ.OPENING_SCREEN,this.handleOpenScreen),CW.on(CQ.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(i7.SHOW_UI,this.handleShowUI),this.node.scene.on(i7.HIDE_UI,this.handleHideUI),this.node.scene.on(i7.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(i7.GAME_RESUME,this.handleResumeGame),this.node.scene.on(i7.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(i7.GAME_FINISH,this.handleFinishGame),this.node.scene.on(i7.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(i7.START_OVER,this.handleStartOver),this.node.scene.on(i7.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(i7.GAME_EXIT,this.handleExitGame),this.node.scene.on(i7.TILE_CLICK,this.handleTileClick),this.node.scene.on(i7.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(i7.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(i7.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(i7.RESUME_TIME,this.handleResumeTime),this.node.scene.on(i7.TIME_OUT,this.handleClockTimeout),this.node.scene.on(i7.HALF_TIME,this.handleHalfTime),this.node.scene.on(i7.RESCUE_START,this.handleStartRescue),this.node.scene.on(i7.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(i7.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(i7.SHOW_HINT,this.handleShowHint),this.node.scene.on(i7.ADD_SCORE,this.handleAddScore),this.node.scene.on(i7.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(i7.USE_ITEM,this.handleUseItem),this.node.scene.on(i7.ADD_ITEM,this.handleAddItem),this.node.scene.on(i7.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(i7.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(i7.CHALLENGE_FRIENDS,this.handleChallengeFriends)}},{key:"start",value:(D=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:this.initDataFirstTime();return[4,this.tryInitTournamentMode()];case 1:n.sent(),this.initGame();return[2]}})}),function(){return D.apply(this,arguments)})},{key:"initDataFirstTime",value:function(){var n,w,k=this.getSceneData(),C=(null!=k?k:{}).isFromLoader,E=void 0!==C&&C,_=(null!=k?k:{}).level;void 0===_&&(_=s2.getMatchMode()===C3.TOURNAMENT?1:null!==(n=null===(w=CV.getGameData())||void 0===w?void 0:w.level)&&void 0!==n?n:0);this.initData(),this.setGameData({level:_,isFromLoader:E})}},{key:"initData",value:function(){var n,w=this.getSceneData(),k=(null!=w?w:{}).isFromLoader,C=void 0!==k&&k,E=null!==(n=CV.getGameData())&&void 0!==n?n:{},_=E.level,T=void 0===_?1:_,L=E.items;0===T&&C&&L?(L.hint=2,L.thunder=1,L.storm=1,L.pliers=0,CV.setGameData({items:L,coins:500,lastRewardedItems:Date.now()}),this.node.scene.emit(i7.ADD_COINS,{coins:500,playSound:!1})):L&&this.checkItemsRewardable()&&(L.hint<5&&(L.hint+=1),L.thunder<5&&(L.thunder+=1),L.storm<5&&(L.storm+=1),L.pliers<5&&(L.pliers+=1),CV.setGameData({items:L,lastRewardedItems:Date.now()})),this.setGameData(I(I({},C9),{},{level:T}))}},{key:"checkItemsRewardable",value:function(){var n,w=(null!==(n=CV.getGameData())&&void 0!==n?n:{}).lastRewardedItems,k=void 0===w?0:w;return!C0.isToday(k)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"tryInitTournamentMode",value:(L=N(function(){var n,w,k,C,E,_,T,I,L,D,M,N,z,B,F,x;var U=arguments;return _ts_generator(this,function(G){switch(G.label){case 0:k=U.length>0&&void 0!==U[0]&&U[0],C=s2.getMatchMode();if(C!==C3.TOURNAMENT)return[3,8];E=null!==(n=s2.getMatchCustomData())&&void 0!==n?n:{},_=E.leaderboardId,T=E.tournamentId;if(!(_&&T))return[3,8];return[4,en.requestTournamentDataAsync()];case 1:G.sent();I=en.getTournamentDataById(T);if(!I)return[3,8];L=I.payload.themeId;this.setGameData({themeId:L});D=CZ.getLeaderboardName(_);if(!D)return[3,8];M=null;if(!(null!==(w=this.gameData)&&void 0!==w&&w.isFromLoader||k))return[3,3];return[4,sN.getAllLeaderboardAsync(_)];case 2:M=G.sent();return[3,5];case 3:return[4,sN.waitForLeaderboardFinishAsync(D)];case 4:G.sent(),M=CZ.getLeaderboard(D);G.label=5;case 5:if(!M)return[3,8];this.tournamentManager=this.getComponent(bE),this.tournamentManager.init(M);N=CV.getPlayerId(),z=M.leaders[N];if(!!z)return[3,7];return[4,CZ.getLeadersByPlayerIdsAsync(D,[N])];case 6:B=G.sent();if(0===B.length)return[2];z=B[0];G.label=7;case 7:if(z){F=z,x=F.score;Cj.setStorageData("tournament","previousScore",x)}G.label=8;case 8:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"setGameData",value:function(n){var w,k,C,E=null!==(w=null!==(k=n.level)&&void 0!==k?k:null===(C=this.gameData)||void 0===C?void 0:C.level)&&void 0!==w?w:1;this.gameData=I(I(I({},this.gameData),n),{},{level:E})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return el.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var n,w=null!==(n=this.getGameData())&&void 0!==n?n:{},k=w.level,C=void 0===k?0:k,E=w.nextLevelCount;C<2||(void 0===E?0:E)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(n){console.warn("checkAndCreateShortcutAsync",n)})}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),p}(eL)).prototype,"board",[CP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CD=n(CO.prototype,"opacityToggler",[CR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CM=n(CO.prototype,"pathDraw",[CI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CO));ew._RF.pop(),ew._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var C7=function(n){return n[n.STAR_CHEST=0]="STAR_CHEST",n[n.BALLOON=1]="BALLOON",n}(C7||{});eF(C7),ew._RF.pop(),ew._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var Ee=function(n){return n.WORLD_TAB_SELECTED="world-tab-selected",n.FRIENDS_TAB_SELECTED="friends-tab-selected",n}(Ee||{}),Et="#AE4212",En="#3D5172",Ei="#92200C",Er="#8F5542",Ea="#8A4733",Eo="#3e7110",Es="#3e7110";ew._RF.pop(),ew._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),ew._RF.pop(),ew._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);var El;ew._RF.pop(),ew._RF.push({},"2737dY5lxxEY6mKDXeUQJUc","ThemeLocaleKeys",void 0);var Eu=(X(El={},eu.SUMMER,"theme.summer"),X(El,eu.AUTUMN,"theme.autumn"),X(El,eu.WINTER,"theme.winter"),X(El,eu.SPRING_FESTIVAL,"theme.springFestival"),X(El,eu.TREE_PLANTING_FESTIVAL,"theme.treePlantingFestival"),X(El,eu.BLUE_SEA_FESTIVAL,"theme.blueSeaFestival"),X(El,eu.MUSIC_FESTIVAL,"theme.musicFestival"),X(El,eu.HARVEST_FESTIVAL,"theme.harvestFestival"),X(El,eu.FOOD_FESTIVAL,"theme.foodFestival"),X(El,eu.SNOW_FESTIVAL,"theme.snowFestival"),X(El,eu.LIGHT_FESTIVAL,"theme.lightFestival"),X(El,eu.PEACE_FESTIVAL,"theme.peaceFestival"),X(El,eu.FLOWER_FESTIVAL,"theme.flowerFestival"),X(El,eu.STREET_FESTIVAL,"theme.streetFestival"),X(El,eu.COLOR_GARDEN,"theme.colorGarden"),X(El,eu.COLOR_FESTIVAL,"theme.colorFestival"),X(El,eu.NATURE_SUMMER,"theme.natureSummer"),X(El,eu.SNOW_MOUNTAIN,"theme.snowMountain"),X(El,eu.ICE_FESTIVAL,"theme.iceFestival"),X(El,eu.GREEN_GRASS_FESTIVAL,"theme.greenGrassFestival"),X(El,eu.COMMUNITY_FESTIVAL,"theme.communityFestival"),X(El,eu.WATER_FESTIVAL,"theme.waterFestival"),X(El,eu.ANIMAL_FESTIVAL,"theme.animalFestival"),X(El,eu.LOST_FESTIVAL,"theme.lostFestival"),X(El,eu.HALLOWEEN_FESTIVAL,"theme.halloweenFestival"),X(El,eu.SNOW_MUSIC_FESTIVAL,"theme.snowMusicFestival"),X(El,eu.CHRISTMAS,"theme.christmas"),X(El,eu.SPRING_FLOWER_FESTIVAL,"theme.springFlowerFestival"),X(El,eu.TET_HOLIDAY,"theme.tetHoliday"),X(El,eu.SEA_FESTIVAL,"theme.seaFestival"),X(El,eu.FIREWORK_FESTIVAL,"theme.fireworkFestival"),X(El,eu.HALLOWEEN_HORROR,"theme.halloweenHorror"),X(El,eu.MID_AUTUMN,"theme.midAutumn"),X(El,eu.CHRISTMAS_SWEET,"theme.christmasSweet"),X(El,eu.NEW_YEAR_COUNTDOWN,"theme.newYearCountdown"),X(El,eu.HAPPY_NEW_YEAR,"theme.happyNewYear"),El);ew._RF.pop(),ew._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),ew._RF.pop(),ew._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),ew._RF.pop(),ew._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);(0,eS.ccclass)("HintItem")(function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"itemType",get:function(){return Z.HINT}}]),o}(wu));ew._RF.pop(),ew._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);(0,eS.ccclass)("PliersItem")(function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"itemType",get:function(){return Z.PLIERS}}]),o}(wu));ew._RF.pop(),ew._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);(0,eS.ccclass)("StormItem")(function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"itemType",get:function(){return Z.STORM}}]),o}(wu));ew._RF.pop(),ew._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var Ec,Eh,Ep,Ed,Ey,Ef,Ev,Eg,Em,Eb,Ew,ES,Ek,EC,EE,E_,EA,ET;(0,eS.ccclass)("ThunderItem")(function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"itemType",get:function(){return Z.THUNDER}}]),o}(wu));ew._RF.pop(),ew._RF.push({},"28c5eNXZLBE+50Dno043fmy","useTornadoThunderCombined",void 0),ew._RF.pop(),ew._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var EP,ER,EI,EO,EL,ED,EM,EN,Ez,EB,EF,Ex=eS.ccclass,EU=eS.property,EG=(Ec=Ex("Coin"),Eh=EU(e$),Ep=EU(te),Ed=EU(tm),Ey=EU(tm),Ef=B.onlyRunInLifeCycle,Ev=B.onlyRunInLifeCycle,Eg=B.onlyRunInLifeCycle,Em=B.onlyRunInLifeCycle,Eb=B.onlyRunInLifeCycleAsync,Ew=B.onlyRunInLifeCycleAsync,ES=B.onlyRunInLifeCycle,Ec((EE=n((EC=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"emittingParticles",EE,_(n)),E(n,"animation",E_,_(n)),E(n,"spin",EA,_(n)),E(n,"rest",ET,_(n)),n}return T(u,[{key:"__preload",value:function(){B.lazyValidateProperties(this)}},{key:"resetDisabled",value:function(){this.stopParticles(),this.stopAnimation(),this.hide(),this.node.active=!1,this.node.setPosition(0,0,this.node.position.z)}},{key:"hide",value:function(){this.node.setScale(eQ.ZERO)}},{key:"stopParticles",value:function(){this.emittingParticles.stopSystem()}},{key:"playTrailParticles",value:function(){this.emittingParticles.resetSystem()}},{key:"playSpinAnimationAfterDelay",value:(I=N(function(){var n,w,k;var C=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:n=C.length>0&&void 0!==C[0]?C[0]:0,w=C.length>1?C[1]:void 0;k=n>0;if(!k)return[3,2];return[4,z.waitTweenAsync(n)];case 1:k=E.sent();E.label=2;case 2:return[4,this.playSpinAnimation(w)];case 3:E.sent();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"playSpinAnimation",value:function(n){return z.runAnimationAsync(this.animation,this.spin.name,n)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),u}(eL)).prototype,"emittingParticles",[Eh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E_=n(EC.prototype,"animation",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EA=n(EC.prototype,"spin",[Ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ET=n(EC.prototype,"rest",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(EC.prototype,"resetDisabled",[Ef],Object.getOwnPropertyDescriptor(EC.prototype,"resetDisabled"),EC.prototype),n(EC.prototype,"hide",[Ev],Object.getOwnPropertyDescriptor(EC.prototype,"hide"),EC.prototype),n(EC.prototype,"stopParticles",[Eg],Object.getOwnPropertyDescriptor(EC.prototype,"stopParticles"),EC.prototype),n(EC.prototype,"playTrailParticles",[Em],Object.getOwnPropertyDescriptor(EC.prototype,"playTrailParticles"),EC.prototype),n(EC.prototype,"playSpinAnimationAfterDelay",[Eb],Object.getOwnPropertyDescriptor(EC.prototype,"playSpinAnimationAfterDelay"),EC.prototype),n(EC.prototype,"playSpinAnimation",[Ew],Object.getOwnPropertyDescriptor(EC.prototype,"playSpinAnimation"),EC.prototype),n(EC.prototype,"stopAnimation",[ES],Object.getOwnPropertyDescriptor(EC.prototype,"stopAnimation"),EC.prototype),Ek=EC))||Ek);ew._RF.pop(),ew._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var EH,EV,Eq,EW,EK,Ej,EY,EX,EZ,EJ,EQ,E$,E0,E1,E2,E4,E3,E5,E6=eS.ccclass,E8=eS.property,E9=eQ.ZERO.clone().add3f(0,-100,0),E7=eQ.ZERO.clone().add3f(0,100,0),_e=GameCore.Utils.Number,_t=(EP=E6("CoinTextPopup"),ER=E8(eT),EI=E8(eH),EO=B.onlyRunInLifeCycle,EL=B.onlyRunInLifeCycle,ED=B.onlyRunInLifeCycleAsync,EM=B.onlyRunInLifeCycleAsync,EP((EB=n((Ez=function(n){w(y,n);var I,L,D,M=k(y);function y(){var n;C(this,y);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=M.call.apply(M,[this].concat(k)),E(n,"label",EB,_(n)),E(n,"uiOpacity",EF,_(n)),n}return T(y,[{key:"__preload",value:function(){B.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(D=N(function(n,w){return _ts_generator(this,function(k){switch(k.label){case 0:this.enableNode(),this.initializePopup(n);return[4,this.showTextPopupAnimation(w)];case 1:k.sent();return[4,this.hidePopup()];case 2:k.sent(),this.disableNode();return[2]}})}),function(n,w){return D.apply(this,arguments)})},{key:"enableNode",value:function(){this.node.active=!0}},{key:"disableNode",value:function(){this.node.active=!1}},{key:"initializePopup",value:function(n){var w=_e.getShortNumber(n,3);this.label.string=w,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(E9)}},{key:"hidePopup",value:(L=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:this.node.setScale(eQ.ONE),this.node.setPosition(E7);return[4,z.runTweenAsync(ez(this.uiOpacity).to(.5,{opacity:0}))];case 1:n.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"showTextPopupAnimation",value:(I=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:return[4,Promise.all([z.runTweenAsync(ez(this.node).to(1.5,{position:E7},{easing:"sineOut"}),n),z.runTweenAsync(ez(this.node).to(.5,{scale:eQ.ONE},{easing:"backOut"}),n)])];case 1:w.sent();return[2]}})}),function(n){return I.apply(this,arguments)})}]),y}(eL)).prototype,"label",[ER],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EF=n(Ez.prototype,"uiOpacity",[EI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(Ez.prototype,"disableNode",[EO],Object.getOwnPropertyDescriptor(Ez.prototype,"disableNode"),Ez.prototype),n(Ez.prototype,"initializePopup",[EL],Object.getOwnPropertyDescriptor(Ez.prototype,"initializePopup"),Ez.prototype),n(Ez.prototype,"hidePopup",[ED],Object.getOwnPropertyDescriptor(Ez.prototype,"hidePopup"),Ez.prototype),n(Ez.prototype,"showTextPopupAnimation",[EM],Object.getOwnPropertyDescriptor(Ez.prototype,"showTextPopupAnimation"),Ez.prototype),EN=Ez))||EN);ew._RF.pop(),ew._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var _n,_i=eS.ccclass,_r=eS.disallowMultiple,_a=eS.property,_o=globalThis.game,_s=_o.player,_l=_o.monitorError,_u=0x3b9ac9ff,_h=10,_p=1,_d=1,_y=(EH=_i("CoinManager"),EV=B.required(),Eq=_a(ta),EW=B.required(),EK=_a(ta),Ej=B.required(),EY=_a(ek),EX=B.onlyRunInLifeCycleAsync,EZ=B.onlyRunInLifeCycleAsync,EJ=B.onlyRunInLifeCycleAsync,EQ=B.onlyRunInLifeCycleAsync,E$=B.onlyRunInLifeCycleAsync,E0=B.onlyRunInLifeCycleAsync,EH(E1=_r((E4=n((E2=function(n){w(g,n);var L,D,M,F,U=k(g);function g(){var n;C(this,g);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return(n=U.call.apply(U,[this].concat(k))).coins=0,E(n,"coinPrefab",E4,_(n)),E(n,"coinTextPopup",E3,_(n)),E(n,"coinAnimContainer",E5,_(n)),n.coinObjects=[],n}return T(g,[{key:"onLoad",value:function(){B.validateRequiredProperties(this),this.getCoinsFromPlayerData(),this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(){this.updateCoins({coins:this.coins})}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(i7.ADD_COINS,this.addCoins,this),this.node.scene.on(i7.REMOVE_COINS,this.removeCoins,this),this.node.scene.on(i7.ABORT_COIN_ANIMATION,this.abortCoinAnimation,this)}},{key:"prepareCoinCollection",value:function(){for(var n=0;n<_h;n++){var w=eA(this.coinPrefab);w.setParent(this.coinAnimContainer),w.setPosition(0,0),w.active=!1,this.coinObjects.push(w.getComponent(EG))}}},{key:"prepareCoinTextPopup",value:function(){var n=eA(this.coinTextPopup);n.setParent(this.node),n.active=!1,this.coinTextPopupNode=n.getComponent(_t)}},{key:"handleCollectionAnim",value:(F=N(function(n,w,k,C,E){var _,T;return _ts_generator(this,function(I){switch(I.label){case 0:_=this;if(!w)return[3,2];T=this.coinObjects.slice(0,this.getShortAmount(n));if(0===T.length)return[2,(console.warn("Requested coins amount is ".concat(n,". Shortened to ").concat(this.getShortAmount(n),". No coin objects was found to animate collection.")),void(null==_l||_l.sendException(new Error("Requested coins amount is ".concat(n,". Shortened to ").concat(this.getShortAmount(n),". No coin objects was found to animate collection.")),{coins:n,animatedCoins:T.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!w,coinCollectionCount:this.coinObjects.length})))];H.playSound(nI.COLLECT_STOCK_COINS);return[4,Promise.all([this.playCoinFlyAndexplodeAnimation(w,T,k,C,E),z.waitTweenAsync(k+C/2,E).then(function(){return _.animateCoinTextPopup(n,E)})])];case 1:I.sent(),E.abort();return[3,3];case 2:console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played");I.label=3;case 3:return[2]}})}),function(n,w,k,C,E){return F.apply(this,arguments)})},{key:"playCoinFlyAndexplodeAnimation",value:(M=N(function(n,w,k,C,E){var _,T;return _ts_generator(this,function(I){switch(I.label){case 0:_=this,T=k+C;return[4,Promise.all([].concat(Y(w.flatMap(function(w){w.node.active=!0,w.stopParticles();var T=[0,.5*Math.min(k,C)],I=ti.apply(void 0,T),L=k-I,D=C+I;return[_.animateCoinExplode(w.node,L,E),z.waitTweenAsync(L,E).then(function(){return _.animateCoinFlyBack(n,w,D,E)})]})),[z.waitTweenAsync(T,E).then(function(){return n.emitExplodeEffect(E)})]))];case 1:I.sent();return[2]}})}),function(n,w,k,C,E){return M.apply(this,arguments)})},{key:"animateCoinTextPopup",value:function(n,w){return this.coinTextPopupNode.show(n,w)}},{key:"animateCoinFlyBack",value:(D=N(function(n,w,k,C){var E,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:E=w.node.worldPosition.clone(),_=eQ.ZERO.clone(),T=n.getCoinIconWorldScale();return[4,z.runTweenAsync(ez(w.node).to(k,{scale:T},{onStart:function(){w.playSpinAnimationAfterDelay(0,C),w.playTrailParticles()},onUpdate:function(k,C){if(void 0!==C){var T=eG.cubicIn(C),I=n.getCoinIconWorldPosition();w.node.worldPosition=eQ.lerp(_,E,I,T)}},onComplete:function(){w.emittingParticles.stopSystem(),w.stopAnimation(),w.hide()}}),C)];case 1:I.sent();return[4,z.waitTweenAsync(1,C)];case 2:I.sent(),w.resetDisabled();return[2]}})}),function(n,w,k,C){return D.apply(this,arguments)})},{key:"animateCoinExplode",value:(L=N(function(n,w,k){var C,E,_,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:C=[-200,200],E=[-200,200],_=ti(C[0],C[1]),T=ti(E[0],E[1]);n.setPosition(0,0,n.position.z),n.setScale(eQ.ZERO);I=new eQ(_,T,n.position.z);return[4,Promise.all([z.runTweenAsync(ez(n).delay(.1*w).to(.8*w,{scale:eQ.ONE},{easing:"elasticOut"}),k),z.runTweenAsync(ez(n).to(w,{position:I},{easing:"circOut"}),k)])];case 1:L.sent();return[2]}})}),function(n,w,k){return L.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var n=_s.getGameData();this.coins=n?n.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(n){var w,k;if(this.coins>_u&&(this.coins=_u),n.coins!==this.coins){var C=Math.max(0,n.coins-this.coins);this.coins=n.coins,_s.setGameData({coins:this.coins});var E=n.collectionAnimation;null===(w=this.collectionAnimSignal)||void 0===w||w.abort();var _=new x;if(this.collectionAnimSignal=_,null==E||null===(k=E.signal)||void 0===k||k.chain(_),void 0===E||E.animateTextOnly)this.node.scene.emit(i7.COIN_CHANGED,I(I({},n),{},{collectionAnimation:{animateTextOnly:!0,signal:null==E?void 0:E.signal}}));else{var T=E.floatDuration,L=void 0===T?_p:T,D=E.flyDuration,M=void 0===D?_d:D,N=E.target,z=void 0===N?this.targetContainer:N;this.collectionAnimSignal=_,this.targetContainer=z;var B=I(I({},n),{},{collectionAnimation:{floatDuration:L,flyDuration:M,animateTextOnly:!1,signal:_,target:z}});this.node.scene.emit(i7.COIN_CHANGED,B),this.handleCollectionAnim(C,this.targetContainer,L,M,_)}}}},{key:"addCoins",value:function(n){this.updateCoins(I(I({},n),{},{coins:this.coins+n.coins}))}},{key:"removeCoins",value:function(n){this.coins<n.coins?this.node.scene.emit(i7.REMOVE_COINS_FAILED):(this.updateCoins(I(I({},n),{},{coins:this.coins-n.coins})),this.node.scene.emit(i7.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(i7.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(n){return Math.min(n,_h)}},{key:"abortCoinAnimation",value:function(){var n;null===(n=this.collectionAnimSignal)||void 0===n||n.abort()}},{key:"untilFinishesCollectAnim",value:function(){return void 0===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(n){this.targetContainer=n}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var n;null===(n=this.collectionAnimSignal)||void 0===n||n.abort()}}]),g}(eL)).prototype,"coinPrefab",[EV,Eq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E3=n(E2.prototype,"coinTextPopup",[EW,EK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E5=n(E2.prototype,"coinAnimContainer",[Ej,EY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(E2.prototype,"handleCollectionAnim",[EX],Object.getOwnPropertyDescriptor(E2.prototype,"handleCollectionAnim"),E2.prototype),n(E2.prototype,"playCoinFlyAndexplodeAnimation",[EZ],Object.getOwnPropertyDescriptor(E2.prototype,"playCoinFlyAndexplodeAnimation"),E2.prototype),n(E2.prototype,"animateCoinTextPopup",[EJ],Object.getOwnPropertyDescriptor(E2.prototype,"animateCoinTextPopup"),E2.prototype),n(E2.prototype,"animateCoinFlyBack",[EQ],Object.getOwnPropertyDescriptor(E2.prototype,"animateCoinFlyBack"),E2.prototype),n(E2.prototype,"animateCoinExplode",[E$],Object.getOwnPropertyDescriptor(E2.prototype,"animateCoinExplode"),E2.prototype),n(E2.prototype,"untilFinishesCollectAnim",[E0],Object.getOwnPropertyDescriptor(E2.prototype,"untilFinishesCollectAnim"),E2.prototype),E1=E2))||E1)||E1);ew._RF.pop(),ew._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),ew._RF.pop(),ew._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),ew._RF.pop(),ew._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),ew._RF.pop(),ew._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),ew._RF.pop(),ew._RF.push({},"c20acgKcuRFP6+Am/XjOFeP","ParticleSystem2DExtra",void 0);var _f=eS.ccclass,_v=eS.disallowMultiple,_g=eS.executeInEditMode,_m=eS.requireComponent,_b=_f("ParticleSystem2DExtra")(_n=_g(!0)(_n=_v(!0)(_n=_m(e$)(_n=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).emitParticle=function(w){return function(k){w(k);var C=n.particleSystem._simulator.particles.length,E=n.particleSystem._simulator.particles[C-1];n.initParticle(E)}},n.step=function(w){return function(k){for(var C=n.particleSystem._simulator.particles,E=0;E<C.length;E++){var _=C[E];n.updateParticle(_,k)}w(k)}},n}return T(o,[{key:"__preload",value:function(){this.particleSystem=this.getComponent(e$),this.validateRequiredComponents(),this.overrideFunctions()}},{key:"overrideFunctions",value:function(){var n=this.particleSystem._simulator.emitParticle.bind(this.particleSystem._simulator);this.particleSystem._simulator.emitParticle=this.emitParticle(n);var w=this.particleSystem._simulator.step.bind(this.particleSystem._simulator);this.particleSystem._simulator.step=this.step(w)}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}}]),o}(eL))||_n)||_n)||_n)||_n;ew._RF.pop(),ew._RF.push({},"664feJL84ZOTaM99dgWY4x0","ExampleParticleSystem2DExtra",void 0);var _w;(0,eS.ccclass)("ExampleParticleSystem2DExtra")(function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"initParticle",value:function(n){n.maxSize=e0.randomRange(.25,1)*n.size,n.size=0,n.deltaSize=0,n.cycleDuration=e0.randomRange(.4,.6),n.life=n.timeToLive,this.setInitPosition(n.pos)}},{key:"updateParticle",value:function(n,w){this.updateScale(n)}},{key:"setInitPosition",value:function(n){var w=n.x,k=n.y;return n.x=w+e0.randomRange(-350,350),n.y=k+e0.randomRange(-350,350),n}},{key:"updateScale",value:function(n){var w=1-(n.life-n.timeToLive)%n.cycleDuration/n.cycleDuration;n.size=n.maxSize*Math.sin(w*Math.PI)}}]),o}(_b));ew._RF.pop(),ew._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var _S,_k,_C,_E,__,_A,_T,_P,_R,_I,_O=eS.ccclass,_L=eS.disallowMultiple,_D=GameCore,_M=_D.Events,_N=_D.Configs,_z=_D.Utils.Valid,_B=globalThis.game,_F=_B.ads,_x=_B.player,_U=_B.event;_O("BootScene")(_w=_L(_w=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).processWhenGameSdkStarted=function(){n.setupGameData(),n.processPreloadAssets()},n.processPreloadAssets=N(function(){var w;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,3]);return[4,n.loadCurrentPlayerTheme()];case 1:k.sent();return[3,3];case 2:w=k.sent();console.error("loadCurrentPlayerTheme",w);return[3,3];case 3:return[2]}})}),n.handlePauseAudio=function(){_U.on(_M.VISIBILITY_HIDDEN,n.handleMuteAudio),_U.on(_M.VISIBILITY_VISIBLE,n.handleUnMuteAudio)},n.handleMuteAudio=function(){H.muteAudio(!0)},n.handleUnMuteAudio=function(){_F.isAdFullSizeShowing()||H.muteAudio(!1)},n}return T(o,[{key:"__preload",value:function(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.listenEvents()}},{key:"onLoad",value:function(){this.handlePauseAudio(),_N.Core.StartSDKAfterLoadGame||ei.showLoadingFullScreen(ec.BOOT_SCENE)}},{key:"start",value:function(){this.processCrazyGamesLoadingStop()}},{key:"listenEvents",value:function(){_U.catchUp(_M.GAME_SDK_STARTED,this.processWhenGameSdkStarted)}},{key:"setupGameData",value:function(){var n=_x.getGameData();if(n){var w=n.totalLevel,k=Math.max(w,eh),C=I(I({},n),{},{totalLevel:k});_x.setGameData(C)}}},{key:"loadCurrentPlayerTheme",value:function(){var n=sz.mapOrder,w=n[0];if(_z.isObject(w)){var k=_x.getGameData(),C=null==k?void 0:k.level;if(!_z.isNumber(C))return F.loadThemeAsync(w.theme);var E,_=L(n);try{for(_.s();!(E=_.n()).done;){var T=E.value;if((C-=T.levelCount)<=0){w=T;break}}}catch(n){_.e(n)}finally{_.f()}return F.loadThemeAsync(w.theme)}}},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}}]),o}(eL))||_w);ew._RF.pop(),ew._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var _G,_H,_V,_q,_W,_K,_j,_Y,_X,_Z,_J,_Q,_$=eS.ccclass,_0=eS.property;_S=_$("RigidBodyObject"),_k=_0(eM),_C=_0(e4),_E=_0(eM),__=_0(eW),_S((_T=n((_A=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"gravityScale",_T,_(n)),E(n,"linearVelocity",_P,_(n)),E(n,"bounce",_R,_(n)),E(n,"simulate",_I,_(n)),n}return T(s,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(eE).getComponent(e_),this.uiTransform=this.node.getComponent(e_)}},{key:"update",value:function(n){if(this.simulate){this.applyGravity();var w=this.node.worldPosition.clone();w.add(new eQ(this.linearVelocity.x*n,this.linearVelocity.y*n,0)),w=this.applyBounce(w),this.node.setWorldPosition(w)}}},{key:"applyForce",value:function(n){this.linearVelocity.add(n)}},{key:"applyGravity",value:function(){var n=new e4(0,-9.8*this.gravityScale);this.applyForce(n)}},{key:"applyBounce",value:function(n){var w=this.uiTransform.getBoundingBoxToWorld();w.yMin<0&&(n.y=w.height/2,this.linearVelocity.y*=-this.bounce),w.xMin<0&&(n.x=w.width/2,this.linearVelocity.x*=-1);var k=this.canvas.width;return w.xMax>k&&(n.x=k-w.width/2,this.linearVelocity.x*=-1),n}}]),s}(eL)).prototype,"gravityScale",[_k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_P=n(_A.prototype,"linearVelocity",[_C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e4(0,0)}}),_R=n(_A.prototype,"bounce",[_E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_I=n(_A.prototype,"simulate",[__],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_A));ew._RF.pop(),ew._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var _1,_2,_4,_3,_5,_6,_8,_9,_7,Ae,At,An,Ai,Ar,Aa,Ao,As=eS.ccclass,Al=eS.property,Au=eS.disallowMultiple,aO=function(){},Ah=(_G=As("AnimSkipOverlay"),_H=Al(eH),_V=Al(eH),_q=Al(eI),_W=B.onlyRunInLifeCycleAsync,_K=B.onlyRunInLifeCycleAsync,_j=B.onlyRunInLifeCycleAsync,_G(_Y=Au((_Z=n((_X=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"containerUIOpacity",_Z,_(n)),E(n,"maskUIOpacity",_J,_(n)),E(n,"skipButton",_Q,_(n)),n.isOpened=!1,n.currentCallback=aO,n}return T(c,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"open",value:(L=N(function(n){var w,k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:this.containerUIOpacity.node.active=!0;w=n.onSkip,k=n.opacity,C=void 0===k?255:k,E=n.transitionDuration,_=void 0===E?.2:E;this.maskUIOpacity.opacity=C;return[4,this.animateUIOpacity(0,255,_)];case 1:T.sent(),this.currentCallback=w,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(q.OPENED_SKIP_OVERLAY,n);return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"close",value:(I=N(function(){var n;var w=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:n=w.length>0&&void 0!==w[0]?w[0]:.2;this.skipButton.interactable=!1,this.currentCallback=aO;return[4,this.animateUIOpacity(255,0,n)];case 1:k.sent(),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(q.CLOSED_SKIP_OVERLAY);return[2]}})}),function(){return I.apply(this,arguments)})},{key:"animateUIOpacity",value:function(n,w,k){return this.containerUIOpacity.opacity=n,z.runTweenAsync(ez(this.containerUIOpacity).to(k,{opacity:w}))}},{key:"untilClosed",value:function(){var n=this;return!1===this.isOpened?Promise.resolve():new Promise(function(w){n.node.scene.once(q.CLOSED_SKIP_OVERLAY,w)})}}]),c}(eL)).prototype,"containerUIOpacity",[_H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_J=n(_X.prototype,"maskUIOpacity",[_V],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_Q=n(_X.prototype,"skipButton",[_q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(_X.prototype,"open",[_W],Object.getOwnPropertyDescriptor(_X.prototype,"open"),_X.prototype),n(_X.prototype,"close",[_K],Object.getOwnPropertyDescriptor(_X.prototype,"close"),_X.prototype),n(_X.prototype,"untilClosed",[_j],Object.getOwnPropertyDescriptor(_X.prototype,"untilClosed"),_X.prototype),_Y=_X))||_Y)||_Y);ew._RF.pop(),ew._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var Ap,Ad,Ay,Af,Av,Ag,Am,Ab,Aw,AS=eS.ccclass,Ak=eS.property,AC=GameCore.Utils.Number,AE=(_1=AS("CoinContainer"),_2=Ak(eT),_4=Ak(ex),_3=Ak(eH),_5=Ak(e$),_6=B.onlyRunInLifeCycle,_8=B.onlyRunInLifeCycleAsync,_9=B.onlyRunInLifeCycleAsync,_7=B.onlyRunInLifeCycle,Ae=B.onlyRunInLifeCycle,_1((Ai=n((An=function(n){w(y,n);var I,L,D,M=k(y);function y(){var n;C(this,y);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=M.call.apply(M,[this].concat(k)),E(n,"coinLabel",Ai,_(n)),E(n,"coinIcon",Ar,_(n)),E(n,"explosionCircle",Aa,_(n)),E(n,"explosionParticles",Ao,_(n)),n.currentCoin=0,n}return T(y,[{key:"setCoinTextFromNumber",value:function(n){var w=AC.getShortNumber(n,3);this.coinLabel.string=w}},{key:"handleAddCoinButton",value:function(){ei.openScreen(er.GET_COIN_SCREEN,{quantity:sT})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(i7.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(D=N(function(n){var w,k,C,E,_,T,I,L,D;return _ts_generator(this,function(M){switch(M.label){case 0:E=n.coins,_=n.collectionAnimation,T=n.playSound;if(!(void 0!==_&&!1!==this.node.activeInHierarchy))return[3,4];I=_.signal;if(null===(w=this.animAbortSignal)||void 0===w||w.abort(),this.animAbortSignal=null!=I?I:new x,!_.animateTextOnly)return[3,2];return[4,this.animateCoinText(E,0,T,I)];case 1:return[2,(M.sent(),void this.setCoins(E))];case 2:L=null!==(k=_.flyDuration)&&void 0!==k?k:0,D=(null!==(C=_.floatDuration)&&void 0!==C?C:0)+L;return[4,this.animateCoinText(E,D,T,I)];case 3:M.sent(),this.setCoins(E);return[3,5];case 4:this.setCoins(E);M.label=5;case 5:return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"setCoins",value:function(n){this.setCoinTextFromNumber(n),this.currentCoin=n}},{key:"animateCoinText",value:(L=N(function(n,w){var k,C,E,_;var T=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:k=this,C=!(T.length>2&&void 0!==T[2])||T[2],E=T.length>3?T[3]:void 0,_=this.currentCoin;return[4,z.waitTweenAsync(w,E)];case 1:I.sent(),C&&H.playSound(nI.COLLECT_COINS);return[4,z.runOnUpdateAsync(this.node,1,function(w){var C=Math.round(_+(n-_)*w);k.setCoinTextFromNumber(C)},E)];case 2:I.sent();return[2]}})}),function(n,w){return L.apply(this,arguments)})},{key:"emitExplodeEffect",value:(I=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:this.initializeExplosionCircle(),this.explosionParticles.resetSystem();return[4,Promise.all([z.runTweenAsync(ez(this.explosionCircle.node).to(.4,{scale:new eQ(3,3,3)},{easing:"quadOut"}),n),z.runTweenAsync(ez(this.explosionCircle).delay(.2).to(.2,{opacity:0}),n)])];case 1:w.sent(),this.resetExplosionCircle();return[2]}})}),function(n){return I.apply(this,arguments)})},{key:"resetExplosionCircle",value:function(){this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0}},{key:"initializeExplosionCircle",value:function(){this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0)}},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var n;null===(n=this.animAbortSignal)||void 0===n||n.abort()}}]),y}(eL)).prototype,"coinLabel",[_2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ar=n(An.prototype,"coinIcon",[_4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa=n(An.prototype,"explosionCircle",[_3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ao=n(An.prototype,"explosionParticles",[_5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(An.prototype,"setCoins",[_6],Object.getOwnPropertyDescriptor(An.prototype,"setCoins"),An.prototype),n(An.prototype,"animateCoinText",[_8],Object.getOwnPropertyDescriptor(An.prototype,"animateCoinText"),An.prototype),n(An.prototype,"emitExplodeEffect",[_9],Object.getOwnPropertyDescriptor(An.prototype,"emitExplodeEffect"),An.prototype),n(An.prototype,"resetExplosionCircle",[_7],Object.getOwnPropertyDescriptor(An.prototype,"resetExplosionCircle"),An.prototype),n(An.prototype,"initializeExplosionCircle",[Ae],Object.getOwnPropertyDescriptor(An.prototype,"initializeExplosionCircle"),An.prototype),At=An))||At);ew._RF.pop(),ew._RF.push({},"95ba56f1qVFfLLdPv++OfLw","SmoothScrollView",void 0);var A_,AA=eS.ccclass,AT=eS.property,AP=(Ap=AA("SmoothScrollView"),Ad=AT({type:eW,group:"Mouse Scroll"}),Ay=AT({type:eM,group:"Mouse Scroll",visible:function(){return this.mouseScroll}}),Af=AT({type:eM,group:"Mouse Scroll",visible:function(){return this.mouseScroll}}),Ap((Am=n((Ag=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"mouseScroll",Am,_(n)),E(n,"mouseScrollSpeed",Ab,_(n)),E(n,"mouseScrollDuration",Aw,_(n)),n}return T(s,[{key:"_onMouseWheel",value:function(n,w){if(this.mouseScroll){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(n,w)){var k=new eQ,C=n.getScrollY()<0?1:-1;this.vertical?k.set(0,C*this.mouseScrollSpeed,0):this.horizontal&&k.set(C*this.mouseScrollSpeed,0,0),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._startAutoScroll(k,this.mouseScrollDuration,!0),this._stopPropagationIfTargetIsMe(n)}}else D(M(s.prototype),"_onMouseWheel",this).call(this,n,w)}}]),s}(tb)).prototype,"mouseScroll",[Ad],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ab=n(Ag.prototype,"mouseScrollSpeed",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),Aw=n(Ag.prototype,"mouseScrollDuration",[Af],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Av=Ag))||Av);ew._RF.pop(),ew._RF.push({},"904917NfYBJy781QxKjEPIO","ViewNode",void 0);var AR,AI,AO,AL,AD,AM,AN,Az,AB,AF,Ax,AU,AG,AH,AV,Aq,AW,AK,Aj,AY,AX=eS.ccclass,AZ=eS.requireComponent,AJ=AX("ViewNode")(A_=AZ(eH)(A_=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).order=0,n}return T(o,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eH),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"setVisible",value:function(n){this.uiOpacity.opacity=n?255:0}},{key:"isVisible",value:function(){return this.uiOpacity.opacity>0}}]),o}(eL))||A_)||A_;ew._RF.pop(),ew._RF.push({},"0b250nSw/RHRq8vKigzgfhs","ScrollViewLayout",void 0);var AQ,A$,A0,A1,A2,A4,A3,A5,A6,A8,A9,A7,Te,Tt,Tn,Ti,Tr,Ta,To,Ts,Tl,Tu,Th,Tp,Td,Ty,Tf,Tv,Tg,Tm,Tb,Tw,TS=eS.ccclass,Tk=eS.property,TC=eS.requireComponent,TE=GameCore.Utils.Array,T_=(AR=TS("ScrollViewLayout"),AI=TC(AP),AO=Tk(e_),AL=Tk(eM),AD=Tk(ta),AM=Tk(eD),AN=Tk(eD),Az=B.onlyRunInLifeCycleAsync,AB=B.onlyRunInLifeCycleAsync,AF=B.onlyRunInLifeCycleAsync,Ax=B.onlyRunInLifeCycle,AU=B.onlyRunInLifeCycle,AG=B.onlyRunInLifeCycle,AR(AH=AI((Aq=n((AV=function(n){w(f,n);var I,D,M,F=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=F.call.apply(F,[this].concat(k)),E(n,"viewport",Aq,_(n)),E(n,"spacing",AW,_(n)),E(n,"nodePrefab",AK,_(n)),E(n,"maxNodeCount",Aj,_(n)),E(n,"extendCount",AY,_(n)),n.nodePool=[],n.nodeHeight=0,n.scrollSignal=new x,n.onNodeVisible=function(){},n.onNodeInvisible=function(){},n}return T(f,[{key:"__preload",value:function(){this.scrollView=this.getComponent(AP),this.uiTransform=this.getComponent(e_)}},{key:"start",value:function(){var n=eA(this.nodePrefab);this.nodeHeight=n.getComponent(e_).height,n.destroy(),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"init",value:function(n,w){this.createNodePool(),this.onNodeVisible=null!=n?n:this.onNodeVisible,this.onNodeInvisible=null!=w?w:this.onNodeInvisible;for(var k=0;k<this.nodePool.length;k++)this.nodePool[k].setVisible(!1);this.updateVisibility()}},{key:"updateNodeVisibility",value:function(){for(var n=0;n<this.nodePool.length;n++)this.nodePool[n].isVisible()?this.onNodeVisible(this.nodePool[n]):this.onNodeInvisible(this.nodePool[n])}},{key:"listenEvents",value:function(){this.scrollView.node.on(tb.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.on(tw.TOUCH_MOVE,this.abortScrollSignal,this),this.scrollView.node.on(tw.MOUSE_WHEEL,this.abortScrollSignal,this)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(tb.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.off(tw.TOUCH_MOVE,this.abortScrollSignal,this),this.scrollView.node.off(tw.MOUSE_WHEEL,this.abortScrollSignal,this)}},{key:"scrollToOrder",value:(M=N(function(n,w){var k,C,E,_,T;var I=arguments;return _ts_generator(this,function(L){switch(L.label){case 0:k=I.length>2&&void 0!==I[2]?I[2]:2,C=this.getNodeScrollOffset(n),E=this.scrollView.getScrollOffset().y,_=(C=Math.max(C,0))-(E=Math.max(E,0));T=Math.abs(_)<5;if(T)return[3,2];return[4,this.scrollToOffset(new e4(0,C),k,w)];case 1:T=L.sent();L.label=2;case 2:return[2]}})}),function(n,w){return M.apply(this,arguments)})},{key:"scrollToTop",value:(D=N(function(n){var w;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:w=k.length>1&&void 0!==k[1]?k[1]:2;return[4,this.scrollToOffset(new e4(0,0),w,n)];case 1:C.sent();return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"scrollToOffset",value:(I=N(function(n,w,k){var C;return _ts_generator(this,function(E){switch(E.label){case 0:C=new x;this.scrollSignal=C,this.scrollView.scrollToOffset(n,w),C.addAbortListener(this.handleScrollSignalAborted.bind(this)),k.addAbortListener(this.handleExternalSignalAborted.bind(this,n,C));return[4,z.waitTweenAsync(w,k)];case 1:E.sent();return[2]}})}),function(n,w,k){return I.apply(this,arguments)})},{key:"updateVisibility",value:function(){for(var n=this.viewport.getBoundingBoxToWorld(),w=n.yMax,k=n.yMin,C=0;C<this.maxNodeCount;C++){var E=this.getNodeBoundingBoxWorld(C),_=E.top,T=E.bot;if(_<k||T>w){var I=this.getNodeByOrder(C);I&&(this.onNodeInvisible(I),I.setVisible(!1))}else{var L=this.getNodeByOrder(C);if(L)L.isVisible()||(L.order=C,this.onNodeVisible(L),L.setVisible(!0));else{var D=this.getInvisibleNode();D&&(D.node.setPosition(this.getNodePosition(C)),D.order=C,this.onNodeVisible(D),D.setVisible(!0))}}}}},{key:"updateLayout",value:function(){var n,w=this.getVisibleNodes(),k=L(w);try{for(k.s();!(n=k.n()).done;){var C=n.value;C.node.setPosition(this.getNodePosition(C.order))}}catch(n){k.e(n)}finally{k.f()}}},{key:"setMaxNodeCount",value:function(n){this.maxNodeCount=n,this.scrollView.content.getComponent(e_).height=(this.nodeHeight+this.spacing)*this.maxNodeCount}},{key:"getAllNodes",value:function(){return this.nodePool}},{key:"getVisibleNodes",value:function(){return this.nodePool.filter(function(n){return n.isVisible()})}},{key:"getNodePosition",value:function(n){return new eQ(0,-(this.nodeHeight+this.spacing)*n-this.nodeHeight/2,0)}},{key:"getNodeScrollOffset",value:function(n){return-this.getNodePosition(n).y-this.uiTransform.node.worldPosition.y-this.uiTransform.height/2+this.viewport.node.worldPosition.y}},{key:"getNodeByOrder",value:function(n){return TE.search(this.nodePool,function(w){return w.order===n})}},{key:"getInvisibleNode",value:function(){return TE.search(this.nodePool,function(n){return!n.isVisible()})}},{key:"createNodePool",value:function(){if(!(this.nodePool.length>0)){var n=Math.ceil(this.viewport.height/this.nodeHeight)+1+this.extendCount;this.setMaxNodeCount(this.maxNodeCount);for(var w=0;w<n;w++){var k,C=eA(this.nodePrefab);null===(k=this.scrollView.content)||void 0===k||k.addChild(C),C.setPosition(this.getNodePosition(this.nodePool.length));var E=C.addComponent(AJ);E.order=w,E.setVisible(!1),this.nodePool.push(E)}}}},{key:"getNodeBoundingBoxWorld",value:function(n){var w,k,C=this.getNodePosition(n).y+(null!==(w=null===(k=this.scrollView.content)||void 0===k?void 0:k.worldPosition.y)&&void 0!==w?w:0);return{top:C+this.nodeHeight/2,bot:C-this.nodeHeight/2}}},{key:"abortScrollSignal",value:function(){this.scrollSignal.abort()}},{key:"handleScrollSignalAborted",value:function(){this.scrollView.stopAutoScroll(),this.updateVisibility()}},{key:"handleExternalSignalAborted",value:function(n,w){w.aborted||(this.scrollView.stopAutoScroll(),this.scrollView.scrollToOffset(n,0),this.updateVisibility())}}]),f}(eL)).prototype,"viewport",[AO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AW=n(AV.prototype,"spacing",[AL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),AK=n(AV.prototype,"nodePrefab",[AD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aj=n(AV.prototype,"maxNodeCount",[AM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),AY=n(AV.prototype,"extendCount",[AN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),n(AV.prototype,"scrollToOrder",[Az],Object.getOwnPropertyDescriptor(AV.prototype,"scrollToOrder"),AV.prototype),n(AV.prototype,"scrollToTop",[AB],Object.getOwnPropertyDescriptor(AV.prototype,"scrollToTop"),AV.prototype),n(AV.prototype,"scrollToOffset",[AF],Object.getOwnPropertyDescriptor(AV.prototype,"scrollToOffset"),AV.prototype),n(AV.prototype,"updateVisibility",[Ax],Object.getOwnPropertyDescriptor(AV.prototype,"updateVisibility"),AV.prototype),n(AV.prototype,"handleScrollSignalAborted",[AU],Object.getOwnPropertyDescriptor(AV.prototype,"handleScrollSignalAborted"),AV.prototype),n(AV.prototype,"handleExternalSignalAborted",[AG],Object.getOwnPropertyDescriptor(AV.prototype,"handleExternalSignalAborted"),AV.prototype),AH=AV))||AH)||AH);ew._RF.pop(),ew._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var TA,TT,TP,TR,TI,TO,TL,TD,TM,TN,Tz,TB=eS.ccclass,TF=eS.property,Tx=eS.disallowMultiple,TU=eS.requireComponent,TG=(AQ=TB("DashboardPage"),A$=TU(eN),A0=TU(eH),A1=B.required(),A2=TF({type:ek,displayName:"Page's container"}),A4=B.required(),A3=B.required(),A5=TF({type:ek,displayName:"Placeholder"}),A6=B.required(),A8=TF({displayName:"Don't create prefab",tooltip:"Tell the component to not create the prefab even if it hasn't create yet"}),A9=TF({displayName:"Darken background"}),A7=TF({type:eD,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),Te=TF({displayName:"Use navbar shadow"}),Tt=TF({type:eD,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),Tn=B.required(),Ti=B.required(),Tr=B.onlyRunInLifeCycleAsync,Ta=B.onlyRunInLifeCycle,To=B.onlyRunInLifeCycleAsync,AQ(Ts=Tx(Ts=A$(Ts=A0((Tu=n((Tl=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"container",Tu,_(n)),E(n,"containerUIOpacity",Th,_(n)),E(n,"placeholder",Tp,_(n)),E(n,"placeholderUIOpacity",Td,_(n)),E(n,"hasCreated",Ty,_(n)),n.pagePrefab=null,E(n,"darkenBackground",Tf,_(n)),E(n,"backgroundOpacity",Tv,_(n)),E(n,"useNavbarShadow",Tg,_(n)),E(n,"navbarShadowOpacity",Tm,_(n)),E(n,"uiOpacity",Tb,_(n)),E(n,"widgetComponent",Tw,_(n)),n}return T(c,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eH),this.widgetComponent=this.getComponent(eN),this.containerUIOpacity=this.container.getComponent(eH),this.placeholderUIOpacity=this.placeholder.getComponent(eH),B.validateRequiredProperties(this)}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(L=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:n=this.hasCreated;if(n)return[3,2];return[4,this.create()];case 1:n=w.sent();w.label=2;case 2:this.mountInLifeCycle();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"mountInLifeCycle",value:function(){this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,V.trackCurrentPage(this.node.name,!0)}},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return!0}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(I=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:if(!(this.pagePrefab&&!this.hasCreated))return[3,2];n=eA(this.pagePrefab);this.container.addChild(n);return[4,z.waitTweenAsync(0)];case 1:w.sent(),this.hasCreated=!0;w.label=2;case 2:return[2]}})}),function(){return I.apply(this,arguments)})}]),c}(eL)).prototype,"container",[A1,A2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Th=n(Tl.prototype,"containerUIOpacity",[A4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tp=n(Tl.prototype,"placeholder",[A3,A5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Td=n(Tl.prototype,"placeholderUIOpacity",[A6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ty=n(Tl.prototype,"hasCreated",[A8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Tf=n(Tl.prototype,"darkenBackground",[A9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Tv=n(Tl.prototype,"backgroundOpacity",[A7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),Tg=n(Tl.prototype,"useNavbarShadow",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Tm=n(Tl.prototype,"navbarShadowOpacity",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),Tb=n(Tl.prototype,"uiOpacity",[Tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tw=n(Tl.prototype,"widgetComponent",[Ti],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(Tl.prototype,"mount",[Tr],Object.getOwnPropertyDescriptor(Tl.prototype,"mount"),Tl.prototype),n(Tl.prototype,"mountInLifeCycle",[Ta],Object.getOwnPropertyDescriptor(Tl.prototype,"mountInLifeCycle"),Tl.prototype),n(Tl.prototype,"create",[To],Object.getOwnPropertyDescriptor(Tl.prototype,"create"),Tl.prototype),Ts=Tl))||Ts)||Ts)||Ts)||Ts);ew._RF.pop(),ew._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var TH,TV,Tq,TW,TK,Tj,TY,TX,TZ,TJ,TQ,T$,T0,T1,T2,T4,T3,T5=eS.ccclass,T6=eS.property,T8=(TA=T5("ThemeProgressBar"),TT=T6(ek),TP=T6(ek),TR=T6(ek),TI=T6(ek),TA((TD=n((TL=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"progressBar",TD,_(n)),E(n,"progressText",TM,_(n)),E(n,"leftCap",TN,_(n)),E(n,"rightCap",Tz,_(n)),n}return T(s,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(n,w){n<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var k=this.progressBar.getComponent(e2);if(!k)throw new Error("ThemeProgressBar: progressBarComponent not found");k.progress=n/w;var C=this.progressText.getComponent(eT);if(!C)throw new Error("ThemeProgressBar: progressTextComponent not found");C.string="".concat(n,"/").concat(w)}}]),s}(eL)).prototype,"progressBar",[TT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TM=n(TL.prototype,"progressText",[TP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TN=n(TL.prototype,"leftCap",[TR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tz=n(TL.prototype,"rightCap",[TI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TO=TL))||TO);ew._RF.pop(),ew._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var T9,T7,Pe,Pt,Pn,Pi,Pr,Pa,Po,Ps,Pl,Pu,Pc,Ph,Pp,Pd,Py,Pf,Pv,Pg,Pm,Pb,Pw,PS,Pk,PC,PE,P_=eS.ccclass,PA=eS.disallowMultiple,PT=eS.property,PP=[50,160],PR=(TH=P_("LockAnimator"),TV=PT(e$),Tq=PT(te),TW=PT(tm),TK=PT(tm),Tj=PT(tm),TY=PT(so),TX=PT({type:eD,min:0}),TH(TZ=PA((TQ=n((TJ=function(n){w(y,n);var I,L,D,M=k(y);function y(){var n;C(this,y);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=M.call.apply(M,[this].concat(k)),E(n,"floatingParticles",TQ,_(n)),E(n,"iconAnimation",T$,_(n)),E(n,"lockClip",T0,_(n)),E(n,"unlockClip",T1,_(n)),E(n,"tryToUnlockClip",T2,_(n)),E(n,"trailTemplate",T4,_(n)),E(n,"trailCount",T3,_(n)),n.trails=[],n}return T(y,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(D=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem();return[4,this.playAnimation(this.unlockClip.name,n)];case 1:w.sent(),this.floatingParticles.stopSystem();return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var n=this;return Promise.all(this.trails.map(function(w){return z.runTweenAsync(n.getExplodeTrail(w))}))}},{key:"getExplodeTrail",value:function(n,w){var k=arguments.length>1&&void 0!==w?w:0,C=ti(0,2*Math.PI),E=ti(PP[0],PP[1])*Math.cos(C),_=ti(PP[0],PP[1])*Math.sin(C),T=new eQ(E,_,n.node.position.z),I=n.node.scale.clone();return ez(n.node).delay(k).call(function(){n.node.setPosition(0,0),n.reset(),n.node.active=!0}).to(.5,{position:T.clone()},{easing:"expoOut"}).to(.5,{scale:new eQ(0,0,1)},{easing:"expoIn"}).call(function(){n.node.setPosition(0,0),n.node.scale=I,n.reset(),n.node.active=!1})}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var n=0;n<this.trailCount;n++){var w=eA(this.trailTemplate.node);w.setParent(this.node),w.active=!1,this.trails.push(w.getComponent(so))}}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"playAnimation",value:(L=N(function(n,w){var k;return _ts_generator(this,function(C){k=this;return[2,null!=w&&w.aborted?Promise.resolve():new Promise(function(C){k.iconAnimation.once(te.EventType.FINISHED,function(){C()}),null==w||w.addAbortListener(function(){k.iconAnimation.off(te.EventType.FINISHED),k.iconAnimation.stop(),C()}),k.iconAnimation.play(n)})]})}),function(n,w){return L.apply(this,arguments)})},{key:"playTryToUnlockAnimation",value:(I=N(function(){return _ts_generator(this,function(n){return[2,this.playAnimation(this.tryToUnlockClip.name)]})}),function(){return I.apply(this,arguments)})}]),y}(eL)).prototype,"floatingParticles",[TV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T$=n(TJ.prototype,"iconAnimation",[Tq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T0=n(TJ.prototype,"lockClip",[TW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T1=n(TJ.prototype,"unlockClip",[TK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T2=n(TJ.prototype,"tryToUnlockClip",[Tj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T4=n(TJ.prototype,"trailTemplate",[TY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T3=n(TJ.prototype,"trailCount",[TX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),TZ=TJ))||TZ)||TZ);ew._RF.pop(),ew._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var PI,PO,PL,PD,PM,PN,Pz,PB,PF,Px,PU,PG,PH,PV=eS.ccclass,Pq=eS.property,PW={progress:0,max:10,isLocked:!0,theme:eu.SUMMER,skins:["fruit"]},PK=GameCore.Utils.Array,Pj=(T9=PV("ThemeBlock"),T7=Pq(ek),Pe=Pq(ek),Pt=Pq(PR),Pn=Pq({type:ek,group:"Container"}),Pi=Pq({type:eH,group:"Container"}),Pr=Pq({type:ek,group:"Theme"}),Pa=Pq({type:ex,group:"Theme"}),Po=Pq({type:j,group:"Title"}),Ps=Pq({type:eH,group:"Title"}),Pl=Pq({type:ex,group:"Tile"}),Pu=Pq({type:eH,group:"Tile"}),Pc=Pq(eW),Ph=B.onlyRunInLifeCycleAsync,T9((Py=n((Pd=function(n){w(m,n);var L,D,M,U,G=k(m);function m(){var n;C(this,m);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=G.call.apply(G,[this].concat(k)),E(n,"mask",Py,_(n)),E(n,"progressBar",Pf,_(n)),E(n,"lockAnimator",Pv,_(n)),E(n,"container",Pg,_(n)),E(n,"containerOpacity",Pm,_(n)),E(n,"themeLoadingRing",Pb,_(n)),E(n,"themeSprite",Pw,_(n)),E(n,"titleLocalizer",PS,_(n)),E(n,"titleOpacity",Pk,_(n)),E(n,"tileBlockIconSprite",PC,_(n)),E(n,"newTilesOpacity",PE,_(n)),n.signal=new x,n.payload=PW,n}return T(m,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(n){this.payload.isLocked=n,this.updateInfo()}},{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"updateInfo",value:function(n){var w=arguments.length>0&&void 0!==n?n:PW;this.payload=w;var k=w.progress,C=w.max,E=w.isLocked,_=w.theme,T=w.skins;this.signal.abort();var I=new x;this.signal=I,this.updateTitle(_),this.updateSkinAsync(T,I),this.updateThemeAsync(_,I);var L=this.progressBar.getComponent(T8);if(!L)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=E,this.progressBar.active=!E,this.lockAnimator.node.active=E,E||L.setProgress(k,C)}},{key:"playUnlockAnim",value:(U=N(function(n){var w,k,C,E;var _=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:w=_.length>1&&void 0!==_[1]?_[1]:PW;this.payload=I(I({},w),{},{isLocked:!1});k=w.progress,C=w.max,E=this.progressBar.getComponent(T8);if(!E)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,E.setProgress(k,C);return[4,this.animateUnlockedState(n)];case 1:T.sent();return[2]}})}),function(n){return U.apply(this,arguments)})},{key:"updateTitle",value:function(n){var w=Eu[n];this.titleLocalizer.key=w}},{key:"updateSkinAsync",value:(M=N(function(n,w){var k,C,E,_,T,I,L,D,M,z,B;return _ts_generator(this,function(x){switch(x.label){case 0:k=this.tileBlockIconSprite.length,C=n.length,E=n.map(function(){var n=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:return[4,F.loadSkinPreviewAsync(n)];case 1:return[2,w.sent()]}})});return function(w){return n.apply(this,arguments)}}());return[4,Promise.all(E)];case 1:_=x.sent();if(!w.aborted&&this.tileBlockIconSprite){if(C<=k){for(T=Math.floor(k/C),I=k%C,L=Y(PK.fillWith(C,function(){return T})),D=0;D<I;D++)L[D]++;for(M=0,z=0;z<C;z++)for(B=0;B<L[z]&&M<k;B++,M++)this.tileBlockIconSprite[M].spriteFrame=_[z][B]}else this.tileBlockIconSprite.forEach(function(n,w){n.spriteFrame=_[w%C][0]})}return[2]}})}),function(n,w){return M.apply(this,arguments)})},{key:"updateThemeAsync",value:(D=N(function(n,w){var k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:this.themeSprite.spriteFrame=null;k=F.getAsset("".concat(ep[n],"/spriteFrame"),e7);C=k;if(C)return[3,2];this.themeLoadingRing.active=!0;return[4,F.loadThemePreviewAsync(n)];case 1:C=k=_.sent();_.label=2;case 2:E=k;if(E)return[3,4];return[4,F.loadThemePreviewAsync(eu.SUMMER)];case 3:E=k=_.sent();_.label=4;case 4:this.themeSprite&&k&&!w.aborted&&(this.themeSprite.spriteFrame=k,this.themeLoadingRing.active=!1);return[2]}})}),function(n,w){return D.apply(this,arguments)})},{key:"animateUnlockedState",value:(L=N(function(n){var w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:k=this.mask.getComponent(eH),C=this.progressBar.getComponent(eH);if(!k)throw new Error("ThemeBlock: maskUIOpacity not found");if(!C)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,k.opacity=null!==(w=k.opacity)&&void 0!==w?w:255,this.progressBar.active=!0,C.opacity=0;return[4,this.lockAnimator.unlock(n)];case 1:E.sent(),this.lockAnimator.node.active=!1;return[4,Promise.all([z.runTweenAsync(ez(k).to(.25,{opacity:0}),n),z.runTweenAsync(ez(C).to(.25,{opacity:255}),n)])];case 2:E.sent(),this.mask.active=!1,k.opacity=0,C.opacity=255;return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"setVisible",value:function(n){this.containerOpacity.opacity=n?255:0,this.titleOpacity.opacity=n?255:0,this.newTilesOpacity.opacity=n?255:0}}]),m}(eL)).prototype,"mask",[T7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pf=n(Pd.prototype,"progressBar",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv=n(Pd.prototype,"lockAnimator",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pg=n(Pd.prototype,"container",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm=n(Pd.prototype,"containerOpacity",[Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pb=n(Pd.prototype,"themeLoadingRing",[Pr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pw=n(Pd.prototype,"themeSprite",[Pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PS=n(Pd.prototype,"titleLocalizer",[Po],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pk=n(Pd.prototype,"titleOpacity",[Ps],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PC=n(Pd.prototype,"tileBlockIconSprite",[Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),PE=n(Pd.prototype,"newTilesOpacity",[Pu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(Pd.prototype,"isLocked",[Pc],Object.getOwnPropertyDescriptor(Pd.prototype,"isLocked"),Pd.prototype),n(Pd.prototype,"updateSkinAsync",[Ph],Object.getOwnPropertyDescriptor(Pd.prototype,"updateSkinAsync"),Pd.prototype),Pp=Pd))||Pp);ew._RF.pop(),ew._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var PY,PX,PZ,PJ,PQ,P$,P0,P1,P2,P4=eS.ccclass,P3=eS.property,P5=globalThis.game.storage,P6=(PI=P4("CollectionsContent"),PO=P3(rA),PL=P3(T_),PD=P3(iA),PM=P3({type:eM,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),PN=B.onlyRunInLifeCycleAsync,Pz=B.onlyRunInLifeCycleAsync,PI((Px=n((PF=function(n){w(p,n);var L,D,M=k(p);function p(){var n;C(this,p);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return(n=M.call.apply(M,[this].concat(k))).animateThemeBlockUnlockIndex=null,E(n,"panelAnimator",Px,_(n)),E(n,"themeScrollView",PU,_(n)),E(n,"contentOpacity",PG,_(n)),n.themeScrollViewInited=!1,n.payloads=[],n.preservedScrollPosition=new e4,E(n,"offsetFromTopOfScrollView",PH,_(n)),n.hideContent=function(){n.contentOpacity.changeStateFade(!1,.1)},n.showContent=function(){n.contentOpacity.changeStateFade(!0,.1)},n}return T(p,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.node.scene.on(i7.HIDE_UI,this.hideContent),this.node.scene.on(i7.SHOW_UI,this.showContent),this.themeScrollView.listenEvents()}},{key:"unlistenEvents",value:function(){this.unlistenUIEvents(),this.themeScrollView.unlistenEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(i7.HIDE_UI,this.hideContent),this.node.scene.off(i7.SHOW_UI,this.showContent)}},{key:"init",value:function(n){var w=this;this.payloads=n,this.themeScrollViewInited||(this.themeScrollViewInited=!0,this.themeScrollView.init(function(n){var k=w.animateThemeBlockUnlockIndex===n.order,C=w.payloads[n.order],E=n.getComponent(Pj);E.updateInfo(I(I({},C),{},{isLocked:!!k||C.isLocked})),E.setVisible(!0),E.container.scale=new eQ(.4,.4,.4),ez(E.container).to(.3,{scale:eQ.ONE},{easing:"quadOut"}).start()}))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.scrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.scrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(n){var w=this,k=P5.getStorageData("collection","animateMapPackUnlock"),C=P5.getStorageData("collection","lastMapPack");n.forEach(function(n,E){var _=n.progress,T=n.max,I=n.isLocked;if(_<T&&!I&&k&&C!==E+1)return w.animateThemeBlockUnlockIndex=E,P5.setStorageData("collection","animateMapPackUnlock",!1),void P5.setStorageData("collection","lastMapPack",E+1)})}},{key:"shouldAnimateThemeBlockUnlock",value:function(){return null!==this.animateThemeBlockUnlockIndex}},{key:"playThemeTabUnlockAnim",value:(D=N(function(n){var w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:if(!this.animateThemeBlockUnlockIndex)return[3,2];w=this.themeScrollView.getNodeByOrder(this.animateThemeBlockUnlockIndex);if(!(w&&w.isVisible()))return[3,2];k=w.getComponent(Pj);if(!k)return[3,2];C=sG.getCollectionUnlockProgress()[this.animateThemeBlockUnlockIndex];return[4,k.playUnlockAnim(n,I(I({},C),{},{isLocked:!0}))];case 1:E.sent(),this.animateThemeBlockUnlockIndex=null;E.label=2;case 2:return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(L=N(function(n,w){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.themeScrollView.scrollToOrder(n,w)];case 1:k.sent();return[2]}})}),function(n,w){return L.apply(this,arguments)})},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}}]),p}(eL)).prototype,"panelAnimator",[PO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PU=n(PF.prototype,"themeScrollView",[PL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PG=n(PF.prototype,"contentOpacity",[PD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PH=n(PF.prototype,"offsetFromTopOfScrollView",[PM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),n(PF.prototype,"playThemeTabUnlockAnim",[PN],Object.getOwnPropertyDescriptor(PF.prototype,"playThemeTabUnlockAnim"),PF.prototype),n(PF.prototype,"scrollToCurrentUnlockingTheme",[Pz],Object.getOwnPropertyDescriptor(PF.prototype,"scrollToCurrentUnlockingTheme"),PF.prototype),PB=PF))||PB);ew._RF.pop(),ew._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var P8,P9,P7,Re,Rt,Rn,Ri,Rr,Ra,Ro,Rs,Rl,Ru,Rp,Rd,Ry,Rf,Rv,Rg,Rm,Rb,Rw,RS,Rk,RC,RE,R_,RA,RT,RP,RR,RI,RO,RL,RD,RM,RN,Rz,RB,RF=(PY=(0,eS.ccclass)("CollectionsPage"),PX=B.required(),PZ=B.onlyRunInLifeCycleAsync,PJ=B.onlyRunInLifeCycle,PQ=B.onlyRunInLifeCycleAsync,P$=B.onlyRunInLifeCycleAsync,PY((P2=n((P1=function(n){w(f,n);var I,L,B,F,x=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return(n=x.call.apply(x,[this].concat(k))).payload=null,E(n,"panelAnimationController",P2,_(n)),n}return T(f,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(rw),D(M(f.prototype),"onLoad",this).call(this)}},{key:"start",value:(F=N(function(){return _ts_generator(this,function(n){D(M(f.prototype),"start",this).call(this);return[2]})}),function(){return F.apply(this,arguments)})},{key:"setPayload",value:function(n){this.payload=n}},{key:"mount",value:(B=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,D(M(f.prototype),"mount",this).call(this)];case 1:n.sent(),this.onMount();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(P6),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload);var n=sG.getCollectionUnlockProgress();this.themeContent.updateUnlockedProgress(n)}},{key:"transitionIn",value:(L=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,D(M(f.prototype),"transitionIn",this).call(this)];case 1:k.sent(),this.themeContent.restoreScrollPosition(),this.themeContent.listenEvents();n=z.runTweenAsync(ez(this.containerUIOpacity).to(.2,{opacity:255})),w=this.panelAnimationController.showUI();return[4,Promise.all([n,w])];case 2:k.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"transitionOut",value:(I=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,D(M(f.prototype),"transitionOut",this).call(this)];case 1:n.sent(),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents();return[4,this.panelAnimationController.hideUI()];case 2:n.sent(),this.themeContent.unlistenEvents();return[2]}})}),function(){return I.apply(this,arguments)})}]),f}(TG)).prototype,"panelAnimationController",[PX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(P1.prototype,"mount",[PZ],Object.getOwnPropertyDescriptor(P1.prototype,"mount"),P1.prototype),n(P1.prototype,"onMount",[PJ],Object.getOwnPropertyDescriptor(P1.prototype,"onMount"),P1.prototype),n(P1.prototype,"transitionIn",[PQ],Object.getOwnPropertyDescriptor(P1.prototype,"transitionIn"),P1.prototype),n(P1.prototype,"transitionOut",[P$],Object.getOwnPropertyDescriptor(P1.prototype,"transitionOut"),P1.prototype),P0=P1))||P0);ew._RF.pop(),ew._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var Rx,RU,RG,RH,RV,Rq,RW,RK,Rj,RY,RX,RZ,RJ,RQ=eS.ccclass,R$=eS.property,R0=eS.disallowMultiple,R1=eS.requireComponent,R2=GameCore.Utils.Array,R4=(P8=RQ("PageManagerItem"),P9=R$(TG),P7=R$({type:eU(nS)}),P8((Rn=n((Rt=T(function e(){C(this,e),E(this,"page",Rn,this),E(this,"pageType",Ri,this)})).prototype,"page",[P9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ri=n(Rt.prototype,"pageType",[P7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Re=Rt))||Re),R3=(Rr=RQ("PageManager"),Ra=R1(e_),Ro=B.required(),Rs=R$({type:eH,displayName:"Background Mask",group:"Background Mask"}),Rl=R$({type:eM,displayName:"Transition duration",group:"Background Mask"}),Ru=R$({type:eM,displayName:"Transition delay",group:"Background Mask"}),Rp=B.required(),Rd=R$({type:eH,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),Ry=R$({type:eM,displayName:"Transition duration",group:"Nav Bar Shadow"}),Rf=R$({type:eM,displayName:"Transition delay",group:"Nav Bar Shadow"}),Rv=R$({type:[R4]}),Rg=R$({type:eU(nS)}),Rm=B.required(),Rb=B.onlyRunInLifeCycleAsync,Rw=B.onlyRunInLifeCycleAsync,RS=B.onlyRunInLifeCycle,Rk=B.onlyRunInLifeCycle,RC=B.onlyRunInLifeCycle,RE=B.onlyRunInLifeCycleAsync,R_=B.onlyRunInLifeCycleAsync,RA=B.onlyRunInLifeCycleAsync,Rr(RT=R0(RT=Ra((RR=n((RP=function(n){w(S,n);var I,L,D,M,F,x,U,G,H,V=k(S);function S(){var n;C(this,S);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=V.call.apply(V,[this].concat(k)),E(n,"backgroundMask",RR,_(n)),E(n,"backgroundMaskTransitionDuration",RI,_(n)),E(n,"backgroundMaskTransitionDelay",RO,_(n)),E(n,"navBarShadow",RL,_(n)),E(n,"navBarShadowTransitionDuration",RD,_(n)),E(n,"navBarShadowTransitionDelay",RM,_(n)),E(n,"pageItems",RN,_(n)),E(n,"currentScreen",Rz,_(n)),E(n,"uiTransform",RB,_(n)),n}return T(S,[{key:"unmountAndHideAll",value:function(){var n=this;this.pageItems.forEach(function(w){var k=w.page;w.pageType!==n.currentScreen&&(k.unmount(),k.hide())})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(e_),B.validateRequiredProperties(this),eY.on(q.VIEW_RESIZED,this.init,this)}},{key:"onDestroy",value:function(){eY.off(q.VIEW_RESIZED,this.init,this)}},{key:"init",value:function(){var n=this;this.pageItems.forEach(function(w,k){var C=w.page.getWidget(),E=n.getPageIndex(n.currentScreen);C.right=-(k-E)*n.uiTransform.width,C.left=(k-E)*n.uiTransform.width,C.updateAlignment()})}},{key:"updateCollectionsContentPayload",value:function(n){var w=this.getPage(nS.collections);w&&_instanceof(w,RF)&&w.setPayload(n)}},{key:"navigate",value:(H=N(function(n,w,k,C){var E,_;return _ts_generator(this,function(T){switch(T.label){case 0:E=n.from,_=n.to;if(!(null!==E))return[3,2];return[4,this.navigateFromPage(E,_,w,k,C)];case 1:T.sent();return[3,4];case 2:return[4,this.navigateFromNull(_,k,C)];case 3:T.sent();T.label=4;case 4:return[2]}})}),function(n,w,k,C){return H.apply(this,arguments)})},{key:"navigateFromPage",value:(G=N(function(n,w,k,C,E){var _,T,I,L,D,M,N,z,B,F,x,U,G;return _ts_generator(this,function(H){switch(H.label){case 0:_=this,T=this.validateNavigationRequest(n,w),I=T.toPage,L=T.fromPage;this.currentScreen=w;D=this.uiTransform.width,M=this.getPageIndex(n),N=this.getPageIndex(w),z=Math.min(M,N),B=Math.max(M,N),F=(B-z)*D,x=M<N?1:-1,U=this.pageItems.slice(z,B+1);U.forEach(function(n,w){var k=n.page;k.show(),k.getWidget().enabled=!1,k.node.position=new eQ((w+z-M)*D,k.node.position.y,k.node.position.z)});G=!I.hasLoadedPage();G&&this.showLoadingScreen();return[4,this.mountPage(I,C)];case 1:H.sent();return[4,k.callAsync(function(){return _.performFullTransition({from:n,to:w,fromPage:L,toPage:I,distance:F,direction:x,items:U})})];case 2:H.sent(),k.call(function(){return _.cleanupPages(I,U.filter(function(n){return n.pageType!==w}))});return[4,k.callAsync(function(){return _.transitionInPage(I,E)})];case 3:H.sent(),G&&this.hideLoadingScreen();return[2]}})}),function(n,w,k,C,E){return G.apply(this,arguments)})},{key:"hideLoadingScreen",value:function(){ei.closeLoadingScreen()}},{key:"showLoadingScreen",value:function(){ei.showLoadingScreen()}},{key:"cleanupPages",value:function(n,w){var k=n.getWidget();k.enabled=!0,k.left=0,k.right=0,e1.instance.emit("canvas-resize"),w.forEach(function(n){n.page.unmount(),n.page.hide()})}},{key:"performFullTransition",value:(U=N(function(n){var w,k,C,E,_,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:w=n.from,k=n.to,C=n.fromPage,E=n.distance,_=n.direction,T=n.items,I=n.toPage;this.node.scene.emit(t5,{from:w,to:k});return[4,Promise.all([C.transitionOut(),this.transition(E,_,T),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,I.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,I.getNavbarShadow())])];case 1:L.sent();return[2]}})}),function(n){return U.apply(this,arguments)})},{key:"mountPage",value:(x=N(function(n,w){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,n.mount()];case 1:k.sent();return[4,null==w?void 0:w(n)];case 2:k.sent();return[2]}})}),function(n,w){return x.apply(this,arguments)})},{key:"validateNavigationRequest",value:function(n,w){if(n!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");var k=this.getPage(this.currentScreen),C=this.getPage(w);if(!C||!k)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");return{toPage:C,fromPage:k}}},{key:"navigateFromNull",value:(F=N(function(n,w,k){var C;return _ts_generator(this,function(E){switch(E.label){case 0:C=this.getPage(this.currentScreen);C.show(),this.currentScreen=n;return[4,this.mountPage(C,w)];case 1:E.sent(),this.node.scene.emit(t5,{from:null,to:n});return[4,this.transitionInPage(C,k)];case 2:E.sent();return[2]}})}),function(n,w,k){return F.apply(this,arguments)})},{key:"transitionInPage",value:(M=N(function(n,w){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,n.transitionIn()];case 1:k.sent();return[4,null==w?void 0:w(n)];case 2:k.sent();return[2]}})}),function(n,w){return M.apply(this,arguments)})},{key:"getPage",value:function(n){var w=this.getPageIndex(n);return -1!==w?this.pageItems[w].page:null}},{key:"handleBackgroundMask",value:(D=N(function(n,w){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,z.runTweenAsync(ez(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(n,{opacity:w}).start())];case 1:k.sent();return[2]}})}),function(n,w){return D.apply(this,arguments)})},{key:"handleNavBarShadow",value:(L=N(function(n,w){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,z.runTweenAsync(ez(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(n,{opacity:w}).start())];case 1:k.sent();return[2]}})}),function(n,w){return L.apply(this,arguments)})},{key:"getPageIndex",value:function(n){return R2.searchIndex(this.pageItems,function(w){return w.pageType===n})}},{key:"transition",value:(I=N(function(n,w,k){return _ts_generator(this,function(C){switch(C.label){case 0:return[4,Promise.all(k.map(function(k){var C=k.page;return z.runTweenAsync(ez(C.node).to(.5,{position:new eQ(C.node.position.x-n*w,C.node.position.y,C.node.position.z)},{easing:eG.quintInOut}))}))];case 1:C.sent();return[2]}})}),function(n,w,k){return I.apply(this,arguments)})}]),S}(eL)).prototype,"backgroundMask",[Ro,Rs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RI=n(RP.prototype,"backgroundMaskTransitionDuration",[Rl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),RO=n(RP.prototype,"backgroundMaskTransitionDelay",[Ru],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),RL=n(RP.prototype,"navBarShadow",[Rp,Rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RD=n(RP.prototype,"navBarShadowTransitionDuration",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),RM=n(RP.prototype,"navBarShadowTransitionDelay",[Rf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),RN=n(RP.prototype,"pageItems",[Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Rz=n(RP.prototype,"currentScreen",[Rg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nS.home}}),RB=n(RP.prototype,"uiTransform",[Rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(RP.prototype,"navigate",[Rb],Object.getOwnPropertyDescriptor(RP.prototype,"navigate"),RP.prototype),n(RP.prototype,"navigateFromPage",[Rw],Object.getOwnPropertyDescriptor(RP.prototype,"navigateFromPage"),RP.prototype),n(RP.prototype,"hideLoadingScreen",[RS],Object.getOwnPropertyDescriptor(RP.prototype,"hideLoadingScreen"),RP.prototype),n(RP.prototype,"showLoadingScreen",[Rk],Object.getOwnPropertyDescriptor(RP.prototype,"showLoadingScreen"),RP.prototype),n(RP.prototype,"cleanupPages",[RC],Object.getOwnPropertyDescriptor(RP.prototype,"cleanupPages"),RP.prototype),n(RP.prototype,"performFullTransition",[RE],Object.getOwnPropertyDescriptor(RP.prototype,"performFullTransition"),RP.prototype),n(RP.prototype,"mountPage",[R_],Object.getOwnPropertyDescriptor(RP.prototype,"mountPage"),RP.prototype),n(RP.prototype,"navigateFromNull",[RA],Object.getOwnPropertyDescriptor(RP.prototype,"navigateFromNull"),RP.prototype),RT=RP))||RT)||RT)||RT);ew._RF.pop(),ew._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var R5,R6,R8,R9,R7,Ie,It=eS.ccclass,In=eS.property,Ii=(Rx=It("StarProgressBar"),RU=In(ak),RG=In(eT),RH=In(eD),RV=In(eD),Rq=In(e3),Rx((Rj=n((RK=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"progressBar",Rj,_(n)),E(n,"progressLabel",RY,_(n)),E(n,"current",RX,_(n)),E(n,"total",RZ,_(n)),E(n,"separator",RJ,_(n)),n}return T(u,[{key:"setRange",value:function(n,w){this.total=w,this.current=n,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string="".concat(this.current).concat(this.separator).concat(this.total)}},{key:"animateTo",value:(I=N(function(n,w,k){var C,E,_,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:C=this,E=Math.min(n,this.total)/this.total,_=this.current,T=1,I=ez(this.progressBar).to(3,{progress:E},{easing:"quadOut",onUpdate:function(w,E){E&&(C.current=_+Math.floor((n-_)*E),null==k||k(C.current),C.current===_-T&&(T++,ez(C.progressLabel.node).to(.05,{scale:new eQ(1.2,1.2,1.2)}).to(.05,{scale:eQ.ONE}).start()),C.updateProgressLabel())}});null==w||w.addAbortListener(function(){C.current=n,C.updateProgress()});return[4,z.runTweenAsync(I,w)];case 1:L.sent();return[2]}})}),function(n,w,k){return I.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),u}(eL)).prototype,"progressBar",[RU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RY=n(RK.prototype,"progressLabel",[RG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RX=n(RK.prototype,"current",[RH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RZ=n(RK.prototype,"total",[RV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RJ=n(RK.prototype,"separator",[Rq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RW=RK))||RW);ew._RF.pop(),ew._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var Ir,Ia,Io,Is,Il,Iu,Ic,Ih,Ip,Id,Iy,If=eS.ccclass,Iv=eS.property,Ig=(R5=If("EventButton"),R6=Iv({type:eU(C7)}),R8=Iv(eW),R5((Ie=n((R7=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"eventType",Ie,_(n)),n._isAvailable=!1,n}return T(s,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(n){this._isAvailable=n,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(t6,{type:this.eventType})}},{key:"setAnimationState",value:function(n){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),D(M(s.prototype),"setAnimationState",this).call(this,n)}}]),s}(ib)).prototype,"eventType",[R6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return C7.STAR_CHEST}}),n(R7.prototype,"isAvailable",[R8],Object.getOwnPropertyDescriptor(R7.prototype,"isAvailable"),R7.prototype),R9=R7))||R9);ew._RF.pop(),ew._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var Im,Ib,Iw,IS,Ik,IC,IE,I_,IA,IT,IP,IR,II,IO,IL,ID,IM,IN,Iz=eS.ccclass,IB=eS.property,IF=globalThis.game.player,Ix=(Ir=Iz("DashboardHeader"),Ia=IB({type:Ii,displayName:"Progress bar",group:"Star Chest"}),Io=IB({type:Ig,displayName:"Button Component",group:"Star Chest"}),Is=IB({type:tm,displayName:"Default Rest animation",group:"Star Chest"}),Il=IB({type:tm,displayName:"Special Rest animation",group:"Star Chest"}),Ir((Ih=n((Ic=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"starProgressBar",Ih,_(n)),E(n,"chestButton",Ip,_(n)),E(n,"defaultRestAnimation",Id,_(n)),E(n,"specialRestAnimation",Iy,_(n)),n.handleStarsUpdateEvent=function(w){var k,C=null!=w?w:null===(k=IF.getGameData())||void 0===k?void 0:k.stars;void 0!==C&&(n.starProgressBar.setRange(C,20),n.updateStarChestButtonAnimation(C))},n}return T(s,[{key:"__preload",value:function(){this.validateRequiredComponents(),eY.on(t2,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function(){eY.off(t2,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function(n){this.handleStarsUpdateEvent(n)}},{key:"updateStarChestButtonAnimation",value:function(n){this.chestButton.isAvailable=n>=20}},{key:"validateRequiredComponents",value:function(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}},{key:"handleClickedSettingsButton",value:function(){ei.openScreen(er.SETTINGS_SCREEN)}}]),s}(eL)).prototype,"starProgressBar",[Ia],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ip=n(Ic.prototype,"chestButton",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Id=n(Ic.prototype,"defaultRestAnimation",[Is],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iy=n(Ic.prototype,"specialRestAnimation",[Il],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iu=Ic))||Iu);ew._RF.pop(),ew._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var IU,IG,IH,IV,Iq,IW,IK,Ij,IY,IX,IZ,IJ,IQ=eS.ccclass,I$=eS.property,I0=eS.executeInEditMode,I1=(Im=IQ("JourneyLevelAvatar"),Ib=I$({type:ex,displayName:"Avatar node"}),Iw=I$(ek),IS=I$(te),Ik=I$(eH),IC=I$({type:tm,group:"Animation"}),IE=I$({type:tm,group:"Animation"}),I_=I$({type:tm,group:"Animation"}),IA=I$({type:e7,displayName:"Avatar sprite"}),Im(IT=I0((IR=n((IP=function(n){w(d,n);var I,L,D,M=k(d);function d(){var n;C(this,d);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=M.call.apply(M,[this].concat(k)),E(n,"sprite",IR,_(n)),E(n,"lockIcon",II,_(n)),E(n,"animation",IO,_(n)),E(n,"opacity",IL,_(n)),E(n,"flashAnimation",ID,_(n)),E(n,"unlockAnimation",IM,_(n)),E(n,"spawnAnimation",IN,_(n)),n}return T(d,[{key:"avatarSprite",get:function(){var n,w;return null!==(n=null===(w=this.sprite)||void 0===w?void 0:w.spriteFrame)&&void 0!==n?n:null},set:function(n){this.sprite&&(this.sprite.spriteFrame=n)}},{key:"playUnlockAnimation",value:(D=N(function(){var n,w,k,C,E,_,T,I,L,D,M;return _ts_generator(this,function(N){switch(N.label){case 0:n=this.playAnimation(this.unlockAnimation),w=this.lockIcon.position.x,k=this.lockIcon.position.y,C=[45,135],E=(Math.random()*(C[1]-C[0])+C[0])*(Math.PI/180),_=this.lockIcon.position.x+150*Math.cos(E),T=this.lockIcon.position.y+150*Math.sin(E),I=k-400,L=z.runTweenAsync(ez(this.lockIcon).delay(.3).to(.2,{position:new eQ(_,T,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new eQ(_,I,this.lockIcon.position.z)},{easing:"cubicIn"})),D=[0,360],M=z.runTweenAsync(ez(this.lockIcon).delay(.3).to(.6,{eulerAngles:new eQ(0,0,Math.random()*(D[1]-D[0])*(_>w?-1:1))},{easing:"sineOut"}));return[4,Promise.all([n,L,M])];case 1:N.sent(),this.lockIcon.position=new eQ(w,k,this.lockIcon.position.z),this.lockIcon.eulerAngles=new eQ(0,0,0);return[2]}})}),function(){return D.apply(this,arguments)})},{key:"playFlashAnimation",value:(L=N(function(n){var w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:w=this.node.position.y,k=this.playAnimation(this.flashAnimation),C=z.runTweenAsync(ez(this.node).to(.1,{position:new eQ(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new eQ(this.node.position.x,w,this.node.position.z)},{easing:"sineIn"}),n);return[4,Promise.all([k,C])];case 1:E.sent();return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(eQ.ZERO)}},{key:"playAnimation",value:(I=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:return[4,z.runAnimationAsync(this.animation,n.name)];case 1:w.sent();return[2]}})}),function(n){return I.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var n=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some(function(w){return null!==w&&(w.name===n.flashAnimation.name||w.name===n.unlockAnimation.name||w.name===n.spawnAnimation.name)}))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),d}(eL)).prototype,"sprite",[Ib],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),II=n(IP.prototype,"lockIcon",[Iw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IO=n(IP.prototype,"animation",[IS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IL=n(IP.prototype,"opacity",[Ik],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ID=n(IP.prototype,"flashAnimation",[IC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IM=n(IP.prototype,"unlockAnimation",[IE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IN=n(IP.prototype,"spawnAnimation",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(IP.prototype,"avatarSprite",[IA],Object.getOwnPropertyDescriptor(IP.prototype,"avatarSprite"),IP.prototype),IT=IP))||IT)||IT);ew._RF.pop(),ew._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var I2,I4,I3,I5,I6,I8,I9,I7,Oe,Ot,On,Oi,Or,Oa,Oo,Os,Ol,Ou,Op,Od,Oy,Of=eS.ccclass,Ov=eS.property,Og=eS.executeInEditMode,Om=(IU=Of("JourneyProgressBar"),IG=Ov(ak),IH=Ov(eT),IV=Ov(eH),Iq=Ov(eD),IW=Ov(eD),IK=Ov(e3),IU(Ij=Og((IX=n((IY=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"progressBar",IX,_(n)),E(n,"progressLabel",IZ,_(n)),E(n,"labelUIOpacity",IJ,_(n)),n.currentProgress=10,n.totalProgress=10,n.labelSeparator="/",n}return T(u,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(n){this.labelSeparator=n,this.updateProgress()}},{key:"setRange",value:function(n,w){this.totalProgress=w;var k=n;k>w&&(k=w),this.currentProgress=k,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(I=N(function(n){var w,k,C,E,_,T,I,L,D,M,N,B,F,x,U,G;return _ts_generator(this,function(H){switch(H.label){case 0:w=this,k=n.nextCurr,C=n.nextTotal,E=n.numberOfProgressBar,_=void 0===E?0:E,T=n.onProgressBarPassed,I=n.signal,L=k/C,D=ez(this.labelUIOpacity).to(.2,{opacity:0}),M=ez(this.labelUIOpacity).to(.2,{opacity:255}),N=_<1?1:Math.sqrt(_)+1,B=0===_?L:_+L,F=1,x=this.progressBar.progress,U=B,G=z.runOnUpdateAsync(this.node,N,function(n){var k=eG.sineInOut(n),C=ts(x,U,k);w.progressBar.progress=C%1,C>F&&(F=0===C?1:Math.ceil(C),null==T||T())},I);return[4,Promise.all([z.runTweenAsync(D,I),G])];case 1:H.sent(),this.currentProgress=k,this.totalProgress=C,this.updateProgress();return[4,z.runTweenAsync(M,I)];case 2:return[2,(H.sent(),this.labelUIOpacity.opacity=255,L)]}})}),function(n){return I.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string="".concat(this.currentProgress).concat(this.separator).concat(this.totalProgress)}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),u}(eL)).prototype,"progressBar",[IG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IZ=n(IY.prototype,"progressLabel",[IH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IJ=n(IY.prototype,"labelUIOpacity",[IV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(IY.prototype,"total",[Iq],Object.getOwnPropertyDescriptor(IY.prototype,"total"),IY.prototype),n(IY.prototype,"current",[IW],Object.getOwnPropertyDescriptor(IY.prototype,"current"),IY.prototype),n(IY.prototype,"separator",[IK],Object.getOwnPropertyDescriptor(IY.prototype,"separator"),IY.prototype),Ij=IY))||Ij)||Ij);ew._RF.pop(),ew._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var Ob,Ow,OS,Ok,OC,OE,O_,OA,OT,OP,OR,OI,OO,OL,OD,OM,ON,Oz,OB,OF,Ox,OU,OG,OH,OV,Oq,OW,OK,Oj,OY,OX,OZ,OJ=eS.ccclass,OQ=eS.property,O$=(I2=OJ("ProgressConfiguration"),I4=OQ(e7),I3=OQ(e3),I2((I6=n((I5=T(function e(){C(this,e),E(this,"avatar",I6,this),E(this,"themeId",I8,this)})).prototype,"avatar",[I4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I8=n(I5.prototype,"themeId",[I3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I5)),I9=OJ("JourneyProgressAnimator"),I7=OQ(Om),Oe=OQ(ek),Ot=OQ(ex),On=OQ(I1),Oi=OQ({type:eM,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),Or=B.onlyRunInLifeCycleAsync,Oa=B.onlyRunInLifeCycle,I9((Ol=n((Os=function(n){w(m,n);var I,L,D,M,x,U,G=k(m);function m(){var n;C(this,m);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=G.call.apply(G,[this].concat(k)),E(n,"progressBar",Ol,_(n)),E(n,"currentLevelAvatarNode",Ou,_(n)),E(n,"currentLevelAvatar",Op,_(n)),E(n,"nextLevelAvatar",Od,_(n)),E(n,"nextLevelYOffset",Oy,_(n)),n.isAnimating=!1,n}return T(m,[{key:"setRange",value:function(n,w){this.progressBar.setRange(n,w)}},{key:"animateTo",value:(U=N(function(n,w){var k;return _ts_generator(this,function(C){switch(C.label){case 0:if(this.isAnimating)return[2,(console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve())];this.isAnimating=!0;k=n!==this.progressBar.current;if(!k)return[3,2];return[4,this.progressBar.animateTo({nextCurr:n,nextTotal:this.progressBar.total,signal:w})];case 1:k=C.sent();C.label=2;case 2:this.isAnimating=!1;return[2]}})}),function(n,w){return U.apply(this,arguments)})},{key:"animateToNextLevel",value:(x=N(function(n){var w,k,C,E,_,T,I,L,D,M;return _ts_generator(this,function(N){switch(N.label){case 0:w=this,k=n.nextCurr,C=n.nextTotal,E=n.mapsPassed,_=n.signal;if(!this.isAnimating)return[3,1];console.warn("JourneyProgressAnimator: animation already in progress");return[3,8];case 1:this.isAnimating=!0;T=E.length-2;if(0!==T)return[3,3];return[4,this.progressBar.animateTo({nextCurr:k,nextTotal:C,signal:_})];case 2:return[2,(N.sent(),void(this.isAnimating=!1))];case 3:return[4,this.animateTargetAvaToCenter(_)];case 4:N.sent();I=1;return[4,this.progressBar.animateTo({signal:_,nextCurr:k,nextTotal:C,numberOfProgressBar:T,onProgressBarPassed:function(){if(1===I)return w.nextLevelAvatar.playUnlockAnimation(),void(I+=1);if(I>=E.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");w.nextLevelAvatar.playFlashAnimation(_),w.setNextLevelAvatar(E[I].theme),I+=1}})];case 5:N.sent();return[4,this.animateTargetAvaToPrev(_)];case 6:N.sent();L=E[E.length-1].theme,D=E[E.length-2].theme;this.setCurrentLevelAvatar(D),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal();M=this.nextLevelAvatar;return[4,this.getSpriteFrameByThemeId(L)];case 7:M.avatarSprite=N.sent(),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1;N.label=8;case 8:return[2]}})}),function(n){return x.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(M=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=new eQ(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);return[4,z.runTweenAsync(ez(this.nextLevelAvatar.node).to(1,{position:w},{easing:"cubicInOut"}),n)];case 1:k.sent(),this.nextLevelAvatar.node.position=w;return[2]}})}),function(n){return M.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(D=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=this.currentLevelAvatarNode.position.clone();return[4,z.runTweenAsync(ez(this.nextLevelAvatar.node).to(1,{position:w},{easing:"cubicInOut"}),n)];case 1:k.sent(),this.nextLevelAvatar.node.position=w;return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:(L=N(function(n){return _ts_generator(this,function(w){return[2,F.loadThemeThumbnailAsync(n)]})}),function(n){return L.apply(this,arguments)})},{key:"loadAndSetAvatar",value:(I=N(function(n,w){var k;return _ts_generator(this,function(C){switch(C.label){case 0:return[4,this.getSpriteFrameByThemeId(n)];case 1:k=C.sent();k?this.setAvatar(k,w):console.warn("JourneyProgressAnimator: ".concat(n," is null"));return[2]}})}),function(n,w){return I.apply(this,arguments)})},{key:"setAvatar",value:function(n,w){_instanceof(w,I1)?w.avatarSprite=n:w.spriteFrame=n}},{key:"setCurrentLevelAvatar",value:function(n){this.loadAndSetAvatar(n,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(n){this.loadAndSetAvatar(n,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}}]),m}(eL)).prototype,"progressBar",[I7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ou=n(Os.prototype,"currentLevelAvatarNode",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Op=n(Os.prototype,"currentLevelAvatar",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Od=n(Os.prototype,"nextLevelAvatar",[On],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oy=n(Os.prototype,"nextLevelYOffset",[Oi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),n(Os.prototype,"loadAndSetAvatar",[Or],Object.getOwnPropertyDescriptor(Os.prototype,"loadAndSetAvatar"),Os.prototype),n(Os.prototype,"setAvatar",[Oa],Object.getOwnPropertyDescriptor(Os.prototype,"setAvatar"),Os.prototype),Oo=Os))||Oo);ew._RF.pop(),ew._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var O0,O1,O2,O4,O3,O5,O6,O8,O9,O7,Le,Lt,Ln,Li,Lr,La,Lo,Ls=eS.ccclass,Ll=eS.property,Lu=globalThis.game,Lc=Lu.storage,Lh=Lu.monitorError,Lp=GameCore.Utils,Ld=Lp.Array,Ly=Lp.Json,Lf=(Ob=Ls("HomeContent"),Ow=B.required(),OS=Ll({type:j,group:"Play Button"}),Ok=B.required(),OC=Ll({type:eI,group:"Play Button"}),OE=B.required(),O_=Ll({type:ek,group:"Play Button"}),OA=B.required(),OT=Ll({type:ek,group:"Play Button"}),OP=B.required(),OR=Ll(O$),OI=B.required(),OO=Ll(Ix),OL=B.required(),OD=Ll(eH),OM=B.required(),ON=Ll(AE),Oz=B.onlyRunInLifeCycleAsync,OB=B.onlyRunInLifeCycleAsync,OF=B.onlyRunInLifeCycleAsync,Ox=B.onlyRunInLifeCycleAsync,OU=B.onlyRunInLifeCycleAsync,Ob((OV=n((OH=function(n){w(f,n);var L,D,M,F,x=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=x.call.apply(x,[this].concat(k)),E(n,"playButtonLocalizer",OV,_(n)),E(n,"playButton",Oq,_(n)),E(n,"playBackground",OW,_(n)),E(n,"hardLevelBackground",OK,_(n)),E(n,"journeyProgressAnimator",Oj,_(n)),E(n,"dashboardHeader",OY,_(n)),E(n,"overlayDuringAnim",OX,_(n)),E(n,"coinContainer",OZ,_(n)),n}return T(f,[{key:"onLoad",value:function(){B.validateRequiredProperties(this)}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(t4)}},{key:"setPlayButton",value:function(n){this.playButtonLocalizer.setParams([n.toString()]);var w=n%5==0;this.playBackground.active=!w,this.hardLevelBackground.active=w}},{key:"updateStarProgress",value:function(n){this.dashboardHeader.updateStarProgress(n)}},{key:"setUnlockProgress",value:function(n,w){var k=arguments.length>1&&void 0!==w&&w;this.setProgress(n),this.updateCurrentMapInStorage(n,k)}},{key:"shouldPlayUnlockAnimation",value:function(){var n,w,k=Lc.getStorage("dashboard");if(null==k)return null==Lh||Lh.sendException(new Error("DashboardScene: dashboardStorage not found")),!1;if(!(null!==(n=k.animateToCurrentLevel)&&void 0!==n&&n))return!1;var C=Lc.getStorage("tournament");if(null==C)return null==Lh||Lh.sendException(new Error("DashboardScene: tournamentStorage not found")),!1;if(null!==(w=C.animateTournamentLeader)&&void 0!==w&&w)return!1;var E=k.lastMapPayload,_=sG.getCurrentMapProgress();return Ly.encode(E)!==Ly.encode(_)&&!(Ld.searchIndex(sz.mapOrder,function(n){return n.id===E.id})>Ld.searchIndex(sz.mapOrder,function(n){return n.id===_.id}))}},{key:"playUnlockProgressAnimation",value:function(n){var w=Lc.getStorage("dashboard");if(null==w)throw new Error("DashboardScene: dashboardStorage not found");var k=w.lastMapPayload,C=sG.getCurrentMapProgress(),E=Ld.searchIndex(sz.mapOrder,function(n){return n.id===k.id}),_=Ld.searchIndex(sz.mapOrder,function(n){return n.id===C.id}),T=sz.mapOrder.slice(E,_+2);return k.id===C.id?this.playUnlockProgressAnimationOnly(C,k,n):this.playUnlockProgressAndPackAnimation(k,C,T,n)}},{key:"playUnlockProgressAndPackAnimation",value:(F=N(function(n,w,k,C){return _ts_generator(this,function(E){switch(E.label){case 0:this.setProgress(I({},n)),this.updateCurrentMapInStorage(I({},w),!0),this.playButton.interactable=!1;return[4,this.showOwnOverlay(C)];case 1:E.sent();return[4,this.journeyProgressAnimator.animateToNextLevel({nextCurr:w.progress,nextTotal:w.max,mapsPassed:k,signal:C})];case 2:E.sent();return[4,this.hideOwnOverlay(C)];case 3:E.sent(),this.playButton.interactable=!0;return[2]}})}),function(n,w,k,C){return F.apply(this,arguments)})},{key:"playUnlockProgressAnimationOnly",value:(M=N(function(n,w,k){var C;return _ts_generator(this,function(E){switch(E.label){case 0:this.setProgress(I(I({},n),{},{progress:w.progress})),this.updateCurrentMapInStorage(I({},n),!0);C=n.progress;return[4,this.showOwnOverlay(k)];case 1:E.sent();return[4,this.journeyProgressAnimator.animateTo(C,k)];case 2:E.sent();return[4,this.hideOwnOverlay(k)];case 3:E.sent();return[2]}})}),function(n,w,k){return M.apply(this,arguments)})},{key:"hideOwnOverlay",value:(D=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:return[4,z.runTweenAsync(ez(this.overlayDuringAnim).to(.3,{opacity:0}),n)];case 1:w.sent(),this.overlayDuringAnim.opacity=0;return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"showOwnOverlay",value:(L=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:return[4,z.runTweenAsync(ez(this.overlayDuringAnim).to(.3,{opacity:150}),n)];case 1:w.sent();return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"setProgress",value:function(n){var w=n.currentTheme,k=n.nextTheme,C=n.progress,E=n.max;this.journeyProgressAnimator.setCurrentLevelAvatar(w),this.journeyProgressAnimator.setNextLevelAvatar(null!=k?k:w),this.journeyProgressAnimator.setRange(C,E)}},{key:"updateCurrentMapInStorage",value:function(n,w){var k=arguments.length>1&&void 0!==w&&w,C=Lc.getStorage("dashboard");if(null!=C){var E=C.animateToCurrentLevel;Lc.setStorageData("dashboard","animateToCurrentLevel",!k&&E),Lc.setStorageData("dashboard","lastMapPayload",n)}else null==Lh||Lh.sendException(new Error("DashboardScene: dashboardStorage not found"))}}]),f}(eL)).prototype,"playButtonLocalizer",[Ow,OS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oq=n(OH.prototype,"playButton",[Ok,OC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OW=n(OH.prototype,"playBackground",[OE,O_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OK=n(OH.prototype,"hardLevelBackground",[OA,OT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oj=n(OH.prototype,"journeyProgressAnimator",[OP,OR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OY=n(OH.prototype,"dashboardHeader",[OI,OO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OX=n(OH.prototype,"overlayDuringAnim",[OL,OD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OZ=n(OH.prototype,"coinContainer",[OM,ON],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(OH.prototype,"playUnlockProgressAnimation",[Oz],Object.getOwnPropertyDescriptor(OH.prototype,"playUnlockProgressAnimation"),OH.prototype),n(OH.prototype,"playUnlockProgressAndPackAnimation",[OB],Object.getOwnPropertyDescriptor(OH.prototype,"playUnlockProgressAndPackAnimation"),OH.prototype),n(OH.prototype,"playUnlockProgressAnimationOnly",[OF],Object.getOwnPropertyDescriptor(OH.prototype,"playUnlockProgressAnimationOnly"),OH.prototype),n(OH.prototype,"hideOwnOverlay",[Ox],Object.getOwnPropertyDescriptor(OH.prototype,"hideOwnOverlay"),OH.prototype),n(OH.prototype,"showOwnOverlay",[OU],Object.getOwnPropertyDescriptor(OH.prototype,"showOwnOverlay"),OH.prototype),OG=OH))||OG);ew._RF.pop(),ew._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var Lv,Lg,Lm,Lb,Lw,LS,Lk,LC,LE,L_,LA,LT,LP,LR,LI,LO,LL,LD,LM,LN,Lz,LB,LF,Lx,LU,LG,LH,LV,Lq,LW,LK,Lj,LY,LX=eS.ccclass,LZ=eS.property,LJ=GameCore.Utils.Array,LQ=W.Layout,L$=(O0=LX("NavManager"),O1=LZ(ek),O2=LZ(ek),O4=LZ(t1),O3=LZ({type:eN,group:"Widgets"}),O5=LZ({type:eN,group:"Widgets"}),O6=LZ({type:eN,group:"Widgets"}),O8=LZ(e_),O0((Le=n((O7=function(n){w(f,n);var I,D,M,B,F,x=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=x.call.apply(x,[this].concat(k)),E(n,"selectorNode",Le,_(n)),E(n,"selectedButtonNode",Lt,_(n)),E(n,"autoLayout",Ln,_(n)),E(n,"navWidget",Li,_(n)),E(n,"backgroundWidget",Lr,_(n)),E(n,"layoutWidget",La,_(n)),E(n,"uiTransform",Lo,_(n)),n.navButtons=[],n.isNavigating=!1,n}return T(f,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var n;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(n=this.selectedButtonNode)||void 0===n?void 0:n.getComponentInChildren("NavButton"),eY.on(q.ORIENTATION_CHANGED,this.handleOrientationChanged,this),eY.on(q.VIEW_RESIZED,this.handleViewResized,this),this.handleOrientationChanged(s7.getCurrentLayout())}},{key:"onDestroy",value:function(){eY.off(q.ORIENTATION_CHANGED,this.handleOrientationChanged,this),eY.off(q.VIEW_RESIZED,this.handleViewResized,this)}},{key:"select",value:(F=N(function(n){var w;return _ts_generator(this,function(k){w=this;if(!this.isNavigating){if(!LJ.has(this.navButtons,n))throw new Error("NavManager: Button not found");if(n!==this.selectedButton){if(!n.isWIP)return[2,(this.isNavigating=!0,this.node.scene.emit(t3,{from:this.selectedButton.buttonType,to:n.buttonType}),new Promise(function(k){w.node.scene.once(t5,function(){var C=w.selectedButton.deselect();w.autoLayout.selectedIndex=w.navButtons.indexOf(n),w.selectedButton=n;var E=w.autoLayout.getSelectedWorldX()-n.getSelectedWorldDistanceX(),_=w.playSelectorAnimation(E),T=n.select();Promise.all([C,T,_]).then(function(){w.isNavigating=!1,k()})})}))];this.handleWIPButton()}}return[2]})}),function(n){return F.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(B=N(function(n){var w,k;return _ts_generator(this,function(C){switch(C.label){case 0:w=this.isNavigating;if(w)return[3,4];if(!LJ.has([nS.store],n.buttonType))return[3,1];k=this.handleWIPButton();return[3,3];case 1:return[4,this.select(n)];case 2:k=C.sent();C.label=3;case 3:w=k;C.label=4;case 4:return[2]}})}),function(n){return B.apply(this,arguments)})},{key:"selectByType",value:(M=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=LJ.search(this.navButtons,function(w){return w.buttonType===n});if(!w)throw new Error("NavManager: Button not found");return[4,this.selectUsingSceneTransition(w)];case 1:k.sent();return[2]}})}),function(n){return M.apply(this,arguments)})},{key:"handleWIPButton",value:function(){ei.openScreen(er.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(D=N(function(){var n,w;return _ts_generator(this,function(k){n=this;if(!this.currentButton||!LJ.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");w=this.currentButton.buttonType;return[2,(this.node.scene.emit(t3,{from:null,to:w}),new Promise(function(w){n.node.scene.once(t5,function(){n.autoLayout.selectedIndex=n.navButtons.indexOf(n.currentButton);var k=n.navButtons.map(function(w){return w===n.currentButton?w.select(!1):w.deselect(!1,!0)}),C=n.autoLayout.getSelectedWorldX()-n.currentButton.getSelectedWorldDistanceX();n.selectorNode.worldPosition=new eQ(C,n.selectorNode.worldPosition.y,0),Promise.all(k).then(function(){w()})})}))]})}),function(){return D.apply(this,arguments)})},{key:"playSelectorAnimation",value:(I=N(function(n){var w,k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:w=this,k=new eQ(1,1,1),C=this.selectorNode.worldPosition.clone(),E=new eQ(1.2*k.x,.8*k.y,1);return[4,z.runTweenAsync(ez(this.selectorNode).to(.3,{worldPosition:new eQ(n,C.y,0)},{easing:"quintInOut",onUpdate:function(n,C){if(void 0!==C){var _=w.calculateCurrentSquashScale(k,E,C);w.selectorNode.scale=_}}}))];case 1:_.sent();return[2]}})}),function(n){return I.apply(this,arguments)})},{key:"setIgnoreInput",value:function(n){var w,k=!(arguments.length>0&&void 0!==n)||n,C=L(this.navButtons);try{for(C.s();!(w=C.n()).done;){var E=w.value,_=E.getComponentInChildren(eI);_&&(_.interactable=!k)}}catch(n){C.e(n)}finally{C.f()}}},{key:"calculateCurrentSquashScale",value:function(n,w,k){var C=this.splitIntoSquashRatio(k);return n.clone().lerp(w,C)}},{key:"splitIntoSquashRatio",value:function(n){return n<.5?2*n:1-2*(n-.5)}},{key:"handleOrientationChanged",value:function(n){n===LQ.Portrait?(this.navWidget.isAlignLeft=!0,this.navWidget.isAlignRight=!0,this.backgroundWidget.left=-50,this.backgroundWidget.right=-50,this.layoutWidget.left=0,this.layoutWidget.right=0):n===LQ.Landscape&&(this.navWidget.isAlignLeft=!1,this.navWidget.isAlignRight=!1,this.backgroundWidget.left=0,this.backgroundWidget.right=0,this.layoutWidget.left=25,this.layoutWidget.right=25,this.uiTransform.width=1e3)}},{key:"handleViewResized",value:function(){this.selectedButton&&this.selectorNode.setWorldPosition(this.selectedButton.node.worldPosition.x,this.selectorNode.worldPosition.y,0)}}]),f}(eL)).prototype,"selectorNode",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lt=n(O7.prototype,"selectedButtonNode",[O2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ln=n(O7.prototype,"autoLayout",[O4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Li=n(O7.prototype,"navWidget",[O3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lr=n(O7.prototype,"backgroundWidget",[O5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La=n(O7.prototype,"layoutWidget",[O6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lo=n(O7.prototype,"uiTransform",[O8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O9=O7))||O9);ew._RF.pop(),ew._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var L0=eS.ccclass,L1=eS.disallowMultiple,L2=eS.property,L4=globalThis.game,L3=L4.event,L5=L4.storage,L6=L4.player,L8=L4.leaderboard,L9=GameCore,L7=L9.Events,De=L9.Match.Modes,Dt=L9.Configs.DailyRewards,Dn=L9.Utils,Di=Dn.Time,Dr=Dn.Array;Lv=L0("DashboardScene"),Lg=B.required(),Lm=L2(_y),Lb=B.required(),Lw=L2(L$),LS=B.required(),Lk=L2(nA),LC=B.required(),LE=L2(R3),L_=B.required(),LA=L2(Ah),LT=B.onlyRunInLifeCycle,LP=B.onlyRunInLifeCycle,LR=B.onlyRunInLifeCycleAsync,LI=B.onlyRunInLifeCycleAsync,LO=B.onlyRunInLifeCycleAsync,LL=B.onlyRunInLifeCycleAsync,LD=B.onlyRunInLifeCycle,LM=B.onlyRunInLifeCycleAsync,LN=B.onlyRunInLifeCycleAsync,Lz=B.onlyRunInLifeCycleAsync,LB=B.onlyRunInLifeCycleAsync,LF=B.onlyRunInLifeCycleAsync,Lx=B.onlyRunInLifeCycleAsync,LU=B.onlyRunInLifeCycleAsync,LG=B.onlyRunInLifeCycle,Lv(LH=L1((Lq=n((LV=function(n){w(R,n);var L,D,M,F,U,G,V,q,W,K,j,Y,X,Z,J=k(R);function R(){var n;C(this,R);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=J.call.apply(J,[this].concat(k)),E(n,"coinManager",Lq,_(n)),E(n,"navManager",LW,_(n)),E(n,"bgComp",LK,_(n)),E(n,"pageManager",Lj,_(n)),E(n,"pageAnimSkipOverlay",LY,_(n)),n.firstNavigation=!0,n.isFirstNavToCollections=!0,n.isFirstNavToTournament=!0,n.navigationSignal=null,n.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch(function(n){console.warn("subscribeBotAsync",n)})},n.playBgAnim=N(function(){var w,k,C,E,_,T,L;return _ts_generator(this,function(D){switch(D.label){case 0:k=L5.getStorage("dashboard");if(null==k)throw new Error("DashboardScene: dashboardStorage not found");C=null!==(w=k.animateToCurrentLevel)&&void 0!==w&&w,E=I({},k.lastMapPayload),_=sG.getCurrentMapProgress(),T=E.currentTheme===_.currentTheme&&E.nextTheme===_.nextTheme,L=_.currentTheme;if(!(C&&!T))return[3,5];return[4,z.waitTweenAsync(2)];case 1:D.sent();D.label=2;case 2:D.trys.push([2,4,,5]);return[4,n.bgComp.animateToNextTheme(L)];case 3:D.sent();return[3,5];case 4:D.sent();return[3,5];case 5:return[2]}})}),n}return T(R,[{key:"__preload",value:function(){}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(t3,this.onNavigate,this)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(t4,this.handlePlayButtonPress,this),this.node.scene.on(t6,this.handleEventButtonPress,this)}},{key:"onLoad",value:function(){B.validateRequiredProperties(this),this.listenNavigationEvents(),this.listenDashboardEvents(),this.coinManager.init(),sG.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(sG.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var n,w=(null!==(n=L6.getGameData())&&void 0!==n?n:{}).level,k=void 0===w?1:w;k=0===k?1:k,L6.setGameData({level:k})}},{key:"start",value:function(){L6.getPlayerSetting("music")&&this.updateMusic(),this.playBgAnim(),this.pageManager.init(),this.navManager.selectDefaultNavBtn(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadScenes",value:function(){el.preloadGameScene()}},{key:"initBgComp",value:function(){var n,w=L5.getStorage("dashboard");if(null==w)throw new Error("DashboardScene: dashboardStorage not found");var k=null!==(n=w.animateToCurrentLevel)&&void 0!==n&&n,C=I({},w.lastMapPayload),E=sG.getCurrentMapProgress(),_=C.currentTheme===E.currentTheme&&C.nextTheme===E.nextTheme,T=E.currentTheme;k&&!_?this.bgComp.setCurrentTheme(C.currentTheme):this.bgComp.setCurrentTheme(T)}},{key:"handlePlayButtonPress",value:(Z=N(function(){var n,w,k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:T.trys.push([0,3,,4]);w=sG.getCurrentMapProgress(),k=(null!==(n=L6.getGameData())&&void 0!==n?n:{}).level,C=void 0===k?1:k;return[4,s2.setMatchCustomDataAsync({level:C})];case 1:T.sent();return[4,s2.startMatchAsync(De.SINGLE)];case 2:T.sent(),this.updateCurrentMapInStorage(w),L5.setStorageData("collection","lastMapPack",w.id),L5.setStorageData("collection","animateMapPackUnlock",!1);E=L5.getStorage("leaderboard_content").lastTabOpened;this.getPlayerLeader(E).then(function(n){if(n){var w=n.score;L5.setStorageData("leaderboard_content","previousScore",w)}}),el.switchScene(ec.GAME_SCENE,{level:C});return[3,4];case 3:_=T.sent();return[2,void console.error(_)];case 4:return[2]}})}),function(){return Z.apply(this,arguments)})},{key:"getPlayerLeader",value:(X=N(function(n){var w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:w="global"===n?ed.GLOBAL:ed.FRIENDS;if(!w)return[2,null];k=L6.getPlayerId();return[4,L8.getLeadersByPlayerIdsAsync(w,[k])];case 1:C=E.sent();return[2,0===C.length?null:C[0]]}})}),function(n){return X.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(n){L5.setStorageData("dashboard","animateToCurrentLevel",!1),L5.setStorageData("dashboard","lastMapPayload",n)}},{key:"updateMusic",value:(Y=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:n=H.getCurrentMusic()!==nI.BG_MUSIC;if(!n)return[3,3];return[4,H.setVolumeMusic(0,!0)];case 1:w.sent();return[4,z.waitTweenAsync(1)];case 2:n=w.sent();w.label=3;case 3:H.playMusic(nI.BG_MUSIC),H.turnUpMusic();return[2]}})}),function(){return Y.apply(this,arguments)})},{key:"checkDailyRewardsOpenable",value:function(){var n=L6.getPlayerData().dailyRewarded,w=n.logDays,k=void 0===w?[]:w,C=n.lastRewarded,E=void 0===C?0:C;if(k.length>Dt.MaxDays)return!0;if(Dt.MockTime>0&&Date.now()-E>=1e3*Dt.MockTime)return!0;return!Di.isToday(E)}},{key:"onNavigate",value:(j=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=(this.firstNavigation&&(this.firstNavigation=!1,this.pageManager.unmountAndHideAll()),n.to);switch(w){case nS.store:return[3,1];case nS.collections:return[3,2];case nS.tournaments:return[3,5];case nS.leaderboard:return[3,5];case nS.home:return[3,7]}return[3,9];case 1:return[3,10];case 2:return[4,this.triggerPageNavigation(n)];case 3:k.sent();return[4,this.handleLogicAfterNavigateToCollections()];case 4:k.sent(),this.cleanupAfterPageNavigation();return[3,10];case 5:return[4,this.triggerPageNavigation(n)];case 6:k.sent(),this.cleanupAfterPageNavigation();return[3,10];case 7:return[4,this.handleNavigateToHome(n)];case 8:k.sent();return[3,10];case 9:throw new Error("DashboardScene: Unhandled page name");case 10:return[2]}})}),function(n){return j.apply(this,arguments)})},{key:"handleLogicAfterNavigateToCollections",value:(K=N(function(){var n,w,k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:w=null===(n=this.pageManager.getPage(nS.collections))||void 0===n?void 0:n.getContainer().getComponentInChildren(P6);if(null==w)throw new Error("CollectionsContent not found");k=new x,C=w.shouldAnimateThemeBlockUnlock();E=C;if(!E)return[3,2];return[4,this.openSkipOverlay(k)];case 1:E=T.sent();T.label=2;case 2:return[4,this.tryPlayScrollToCollectionAnim(w,k)];case 3:T.sent();return[4,w.playThemeTabUnlockAnim(k)];case 4:T.sent();_=C;if(!_)return[3,6];return[4,this.closeSkipOverlay()];case 5:_=T.sent();T.label=6;case 6:k.abort();return[2]}})}),function(){return K.apply(this,arguments)})},{key:"closeSkipOverlay",value:(W=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.pageAnimSkipOverlay.close()];case 1:n.sent();return[2]}})}),function(){return W.apply(this,arguments)})},{key:"openSkipOverlay",value:(q=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:return[4,this.pageAnimSkipOverlay.open({onSkip:function(){return n.abort()},opacity:200})];case 1:w.sent();return[2]}})}),function(n){return q.apply(this,arguments)})},{key:"tryPlayScrollToCollectionAnim",value:(V=N(function(n,w){var k,C;return _ts_generator(this,function(E){switch(E.label){case 0:k=sG.getCurrentUnlockingThemeIndex();C=this.isFirstNavToCollections&&null!==k;if(!C)return[3,2];return[4,n.scrollToCurrentUnlockingTheme(k,w)];case 1:C=(E.sent(),this.isFirstNavToCollections=!1);E.label=2;case 2:return[2]}})}),function(n,w){return V.apply(this,arguments)})},{key:"cleanupAfterPageNavigation",value:function(){this.navManager.setIgnoreInput(!1)}},{key:"triggerPageNavigation",value:(G=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:null===(w=this.navigationSignal)||void 0===w||w.abort(),this.navigationSignal=new x;return[4,this.pageManager.navigate(n,this.navigationSignal)];case 1:k.sent();return[2]}})}),function(n){return G.apply(this,arguments)})},{key:"handleNavigateToHome",value:(U=N(function(n){var w,k;return _ts_generator(this,function(C){switch(C.label){case 0:k=this;null===(w=this.navigationSignal)||void 0===w||w.abort(),this.navigationSignal=new x;return[4,this.pageManager.navigate(n,this.navigationSignal,N(function(){return _ts_generator(this,function(n){k.initializeHomepageCoinManager();return[2]})}))];case 1:C.sent();return[4,this.handleLogicAfterNavigateToHome()];case 2:C.sent();return[2]}})}),function(n){return U.apply(this,arguments)})},{key:"handleLogicAfterNavigateToHome",value:(F=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.tryOpenDailyRewardsScreen()];case 1:n.sent(),this.attemptCallSubscribeBot();return[4,this.waitUntilCoinManagerFinishesAnyAnimation()];case 2:n.sent();return[4,this.waitUntilPageAnimSkipOverlayCloses()];case 3:n.sent();return[4,this.tryNavigateToTournament()];case 4:n.sent();return[4,this.tryPlayLevelUpAnimation()];case 5:n.sent();return[2]}})}),function(){return F.apply(this,arguments)})},{key:"waitUntilCoinManagerFinishesAnyAnimation",value:function(){return this.coinManager.untilFinishesCollectAnim()}},{key:"waitUntilPageAnimSkipOverlayCloses",value:function(){return this.pageAnimSkipOverlay.untilClosed()}},{key:"tryNavigateToTournament",value:(M=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:if(!L5.getStorage("tournament").animateTournamentLeader)return[3,2];return[4,this.navManager.selectByType(nS.tournaments)];case 1:return[2,n.sent()];case 2:if(!this.isFirstNavToTournament)return[3,8];this.isFirstNavToTournament=!1;n.label=3;case 3:n.trys.push([3,7,,8]);if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");return[4,GameSDK.getTournamentAsync()];case 4:if(!(n.sent().getEndTime()<Date.now()/1e3))return[3,6];return[4,this.navManager.selectByType(nS.tournaments)];case 5:return[2,n.sent()];case 6:return[3,8];case 7:n.sent();return[3,8];case 8:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"tryPlayLevelUpAnimation",value:(D=N(function(){var n,w,k,C,E,_,T,I,L;return _ts_generator(this,function(D){switch(D.label){case 0:w=this,k=null===(n=this.pageManager.getPage(nS.home))||void 0===n?void 0:n.getContainer().getComponentInChildren(Lf);if(null==k)throw new Error("DashboardScene: Homepage not found");C=new x;C.chain(this.navigationSignal);E=k.shouldPlayUnlockAnimation(),_=this.shouldPlayPackUnlockAnimation();T=E;if(!T)return[3,7];I=_;if(!I)return[3,2];return[4,this.pageAnimSkipOverlay.open({onSkip:function(){return C.abort()},opacity:150})];case 1:I=D.sent();D.label=2;case 2:return[4,k.playUnlockProgressAnimation(C)];case 3:D.sent();L=_;if(!L)return[3,6];return[4,this.pageAnimSkipOverlay.close()];case 4:D.sent();return[4,C.callAsync(function(){return w.navManager.selectByType(nS.collections)})];case 5:L=D.sent();D.label=6;case 6:T=L;D.label=7;case 7:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"shouldPlayPackUnlockAnimation",value:function(){var n=L5.getStorage("dashboard");if(null==n)throw new Error("DashboardScene: dashboardStorage not found");var w=n.lastMapPayload,k=sG.getCurrentMapProgress();return Dr.searchIndex(sz.mapOrder,function(n){return n.id===w.id})!==Dr.searchIndex(sz.mapOrder,function(n){return n.id===k.id})}},{key:"initializeHomepageCoinManager",value:function(){var n,w=null===(n=this.pageManager.getPage(nS.home))||void 0===n?void 0:n.getContainer().getComponentInChildren(Lf);if(null==w)throw new Error("DashboardScene: Homepage not found");this.coinManager.setTargetContainer(w.getCoinContainer()),this.coinManager.emitCoinAmount()}},{key:"tryOpenDailyRewardsScreen",value:(L=N(function(){return _ts_generator(this,function(n){if(this.checkDailyRewardsOpenable())return[2,(ei.openScreen(er.DAILY_REWARDS_SCREEN),new Promise(function(n){L3.on(L7.CLOSED_SCREEN,function t(w){w.screenName===es[er.DAILY_REWARDS_SCREEN]&&(n(),L3.off(L7.CLOSED_SCREEN,t))})}))];return[2]})}),function(){return L.apply(this,arguments)})},{key:"handleEventButtonPress",value:function(n){switch(n.type){case C7.STAR_CHEST:ei.openScreen(er.STAR_CHEST_SCREEN);break;case C7.BALLOON:ei.showNotificationScreenWithLocalizedKey("error.soon");break;default:throw new Error("DashboardScene: Unhandled event button type")}}},{key:"handleTestLayoutButtonClicked",value:function(){}}]),R}(eL)).prototype,"coinManager",[Lg,Lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LW=n(LV.prototype,"navManager",[Lb,Lw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LK=n(LV.prototype,"bgComp",[LS,Lk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lj=n(LV.prototype,"pageManager",[LC,LE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LY=n(LV.prototype,"pageAnimSkipOverlay",[L_,LA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(LV.prototype,"preloadScenes",[LT],Object.getOwnPropertyDescriptor(LV.prototype,"preloadScenes"),LV.prototype),n(LV.prototype,"initBgComp",[LP],Object.getOwnPropertyDescriptor(LV.prototype,"initBgComp"),LV.prototype),n(LV.prototype,"handlePlayButtonPress",[LR],Object.getOwnPropertyDescriptor(LV.prototype,"handlePlayButtonPress"),LV.prototype),n(LV.prototype,"onNavigate",[LI],Object.getOwnPropertyDescriptor(LV.prototype,"onNavigate"),LV.prototype),n(LV.prototype,"handleLogicAfterNavigateToCollections",[LO],Object.getOwnPropertyDescriptor(LV.prototype,"handleLogicAfterNavigateToCollections"),LV.prototype),n(LV.prototype,"tryPlayScrollToCollectionAnim",[LL],Object.getOwnPropertyDescriptor(LV.prototype,"tryPlayScrollToCollectionAnim"),LV.prototype),n(LV.prototype,"cleanupAfterPageNavigation",[LD],Object.getOwnPropertyDescriptor(LV.prototype,"cleanupAfterPageNavigation"),LV.prototype),n(LV.prototype,"triggerPageNavigation",[LM],Object.getOwnPropertyDescriptor(LV.prototype,"triggerPageNavigation"),LV.prototype),n(LV.prototype,"handleNavigateToHome",[LN],Object.getOwnPropertyDescriptor(LV.prototype,"handleNavigateToHome"),LV.prototype),n(LV.prototype,"waitUntilCoinManagerFinishesAnyAnimation",[Lz],Object.getOwnPropertyDescriptor(LV.prototype,"waitUntilCoinManagerFinishesAnyAnimation"),LV.prototype),n(LV.prototype,"waitUntilPageAnimSkipOverlayCloses",[LB],Object.getOwnPropertyDescriptor(LV.prototype,"waitUntilPageAnimSkipOverlayCloses"),LV.prototype),n(LV.prototype,"tryNavigateToTournament",[LF],Object.getOwnPropertyDescriptor(LV.prototype,"tryNavigateToTournament"),LV.prototype),n(LV.prototype,"tryPlayLevelUpAnimation",[Lx],Object.getOwnPropertyDescriptor(LV.prototype,"tryPlayLevelUpAnimation"),LV.prototype),n(LV.prototype,"tryOpenDailyRewardsScreen",[LU],Object.getOwnPropertyDescriptor(LV.prototype,"tryOpenDailyRewardsScreen"),LV.prototype),n(LV.prototype,"handleEventButtonPress",[LG],Object.getOwnPropertyDescriptor(LV.prototype,"handleEventButtonPress"),LV.prototype),LH=LV))||LH);ew._RF.pop(),ew._RF.push({},"1be4fAboTNK3IFk6IiygYLZ","PageContent",void 0);var Da,Do,Ds,Dl,Du,Dh,Dp=eS.ccclass,Dd=W.Layout;Dp("PageContent")(function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"__preload",value:function(){this.widget=this.getComponent(eN),this.uiTransform=this.getComponent(e_)}},{key:"onLoad",value:function(){eY.on(q.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(s7.getCurrentLayout())}},{key:"onDestroy",value:function(){eY.off(q.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"handleOrientationChanged",value:function(n){n===Dd.Portrait?(this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0):n===Dd.Landscape&&(this.widget.isAlignLeft=!1,this.widget.isAlignRight=!1,this.uiTransform.width=1e3)}}]),o}(eL));ew._RF.pop(),ew._RF.push({},"c68178FyxlCOqbCt/+wktvw","PageHeader",void 0);var Dy,Df,Dv,Dg,Dm,Db,Dw,DS,Dk,DC,DE,D_=eS.ccclass,DA=eS.property,DT=W.Layout;Da=D_("PageHeader"),Do=DA(eN),Ds=DA(ek),Da((Du=n((Dl=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"widget",Du,_(n)),E(n,"leaves",Dh,_(n)),n}return T(s,[{key:"onLoad",value:function(){eY.on(q.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(s7.getCurrentLayout())}},{key:"onDestroy",value:function(){eY.off(q.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"handleOrientationChanged",value:function(n){n===DT.Portrait?(this.leaves.active=!1,this.widget.left=-80,this.widget.right=-80):n===DT.Landscape&&(this.leaves.active=!0,this.widget.left=0,this.widget.right=0)}}]),s}(eL)).prototype,"widget",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=n(Dl.prototype,"leaves",[Ds],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dl));ew._RF.pop(),ew._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var DP,DR=eS.ccclass,DI=eS.property,DO=globalThis.game,DL=DO.player,DD=DO.storage,DM=DO.monitorError,DN=GameCore.Utils.Number;Dy=DR("HomePage"),Df=B.required(),Dv=DI({type:eT,group:"Placeholders"}),Dg=B.required(),Dm=B.onlyRunInLifeCycleAsync,Db=B.onlyRunInLifeCycle,Dw=B.onlyRunInLifeCycleAsync,DS=B.onlyRunInLifeCycleAsync,Dy((DC=n((Dk=function(n){w(f,n);var L,z,B,F,x=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=x.call.apply(x,[this].concat(k)),E(n,"coinLabel",DC,_(n)),E(n,"panelAnimationController",DE,_(n)),n}return T(f,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(rw),D(M(f.prototype),"onLoad",this).call(this)}},{key:"onEnable",value:function(){this.node.scene.on(i7.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"onDisable",value:function(){this.node.scene.off(i7.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"updatePlaceholderCoins",value:(F=N(function(n){return _ts_generator(this,function(w){this.coinLabel.string=DN.getShortNumber(n.coins,3);return[2]})}),function(n){return F.apply(this,arguments)})},{key:"mount",value:(B=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,D(M(f.prototype),"mount",this).call(this)];case 1:n.sent(),this.onMount();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"onMount",value:function(){var n,w,k;if(!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(Lf),!this.homeContent))throw new Error("HomePage: homeContent not found");var C=DL.getGameData(),E=null!==(n=null==C?void 0:C.coins)&&void 0!==n?n:0;this.updatePlaceholderCoins({coins:E});var _=null!==(w=null==C?void 0:C.level)&&void 0!==w?w:1;this.homeContent.setPlayButton(_);var T=null!==(k=null==C?void 0:C.stars)&&void 0!==k?k:0;this.homeContent.updateStarProgress(T),this.initUnlockProgressData()}},{key:"initUnlockProgressData",value:function(){var n=this.homeContent.shouldPlayUnlockAnimation(),w=I({},sG.getCurrentMapProgress()),k=DD.getStorage("dashboard");if(null==k)return null==DM||DM.sendException(new Error("DashboardScene: dashboardStorage not found")),void(n||this.homeContent.setUnlockProgress(w));var C=I({},k.lastMapPayload);n?this.homeContent.setUnlockProgress(C):this.homeContent.setUnlockProgress(w)}},{key:"transitionIn",value:(z=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,D(M(f.prototype),"transitionIn",this).call(this)];case 1:n.sent();return[4,this.panelAnimationController.showUI()];case 2:n.sent();return[2]}})}),function(){return z.apply(this,arguments)})},{key:"transitionOut",value:(L=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,D(M(f.prototype),"transitionOut",this).call(this)];case 1:n.sent();return[4,this.panelAnimationController.hideUI()];case 2:n.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"hasLoadedPage",value:function(){return!0}}]),f}(TG)).prototype,"coinLabel",[Df,Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DE=n(Dk.prototype,"panelAnimationController",[Dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(Dk.prototype,"mount",[Dm],Object.getOwnPropertyDescriptor(Dk.prototype,"mount"),Dk.prototype),n(Dk.prototype,"onMount",[Db],Object.getOwnPropertyDescriptor(Dk.prototype,"onMount"),Dk.prototype),n(Dk.prototype,"transitionIn",[Dw],Object.getOwnPropertyDescriptor(Dk.prototype,"transitionIn"),Dk.prototype),n(Dk.prototype,"transitionOut",[DS],Object.getOwnPropertyDescriptor(Dk.prototype,"transitionOut"),Dk.prototype),Dk));ew._RF.pop(),ew._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var Dz,DB,DF,Dx,DU,DG,DH,DV,Dq,DW,DK,Dj,DY,DX,DZ,DJ,DQ,D$,D0,D1,D2=(0,eS.ccclass)("LeaderboardIsEmpty")(DP=function(n){w(l,n);var E,_=k(l);function l(){return C(this,l),_.apply(this,arguments)}return T(l,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eH),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"show",value:(E=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:this.uiOpacity.opacity=255;n=this.node.position.clone(),w=ez(this.node);w.to(.05,{position:n.clone().add3f(5,0,0)}),w.to(.05,{position:n.clone().add3f(-5,0,0)});k=ez(this.node).repeat(2,w);k.to(.05,{position:n});return[4,z.runTweenAsync(k)];case 1:C.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),l}(eL))||DP;ew._RF.pop(),ew._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var D4,D3,D5,D6,D8,D9,D7,Me=eS.ccclass,Mt=eS.property,Mn=eS.requireComponent,Mi=globalThis.game.analytics,Mr=GameCore,Ma=Mr.Utils.Array,Mo=Mr.Plugins.Analytics.Events,Ms=(Dz=Me("SwitchButton"),DB=Mn([eI,te]),DF=Mt(eW),Dx=Mt(ek),DU=Mt(ek),DG=Mt(eW),DH=Mt({visible:function(){return this.useSound},type:nL}),DV=Mt(eW),Dq=Mt({visible:function(){return this.useDesktopHover},type:tm}),DW=Mt({visible:function(){return this.useDesktopHover},type:tm}),Dz(DK=DB((DY=n((Dj=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"enable",DY,_(n)),E(n,"nodeOn",DX,_(n)),E(n,"nodeOff",DZ,_(n)),E(n,"useSound",DJ,_(n)),E(n,"soundKey",DQ,_(n)),E(n,"useDesktopHover",D$,_(n)),E(n,"mouseEnterClip",D0,_(n)),E(n,"mouseLeaveClip",D1,_(n)),n.isMouseLeaved=!1,n.onMouseEnter=function(w){n.useDesktopHover&&n.buttonComponent.interactable&&(n.isMouseLeaved=!1,n.animationComponent.play(n.mouseEnterClip.name))},n.onMouseLeave=function(w){n.useDesktopHover&&n.buttonComponent.interactable&&(n.isMouseLeaved||(n.isMouseLeaved=!0,n.animationComponent.play(n.mouseLeaveClip.name)))},n}return T(s,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(eI),this.animationComponent=this.getComponent(te),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var n=this.animationComponent.clips.map(function(n){return null==n?void 0:n.name}).filter(function(n){return null!=n&&"string"==typeof n});this.useDesktopHover&&(Ma.has(n,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),Ma.has(n,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(ek.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(ek.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(ek.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(ek.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(Mi.event(Mo.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&H.playSound(ia[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(n){this.node.active&&this.updateStatus(n)}},{key:"updateStatus",value:function(n){return this.enable===n||(this.onMouseLeave(null),this.enable=n,this.nodeOn.active=n,this.nodeOff.active=!n),this.enable}}]),s}(eL)).prototype,"enable",[DF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),DX=n(Dj.prototype,"nodeOn",[Dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DZ=n(Dj.prototype,"nodeOff",[DU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DJ=n(Dj.prototype,"useSound",[DG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),DQ=n(Dj.prototype,"soundKey",[DH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nL[nI.BUTTON_CLICK]}}),D$=n(Dj.prototype,"useDesktopHover",[DV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),D0=n(Dj.prototype,"mouseEnterClip",[Dq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D1=n(Dj.prototype,"mouseLeaveClip",[DW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DK=Dj))||DK)||DK);ew._RF.pop(),ew._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var Ml,Mu,Mh,Mp,Md,My,Mf,Mv,Mg,Mm=eS.ccclass,Mb=eS.property,Mw=globalThis.game.analytics,MS=GameCore.Plugins.Analytics.Events,Mk=(D4=Mm("Tabs"),D3=Mb(Ms),D5=Mb(Ms),D4((D9=n((D8=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"tabWorld",D9,_(n)),E(n,"tabFriends",D7,_(n)),n}return T(s,[{key:"onLoad",value:function(){"MsGames"===GameSDK.getSDKName()&&(this.tabWorld.node.active=!1,this.tabFriends.node.active=!1)}},{key:"setInteractableButtons",value:function(n){this.tabWorld.getComponent(eI).interactable=n,this.tabFriends.getComponent(eI).interactable=n}},{key:"updateStatus",value:function(n){this.tabWorld.setEnabled("global"===n),this.tabFriends.setEnabled("friends"===n)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),H.playSound(nI.BUTTON_CLICK),Mw.event(MS.BUTTON_CLICK,{button_name:this.node.name,screen_name:V.getCurrentPage()}),this.node.scene.emit(Ee.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),H.playSound(nI.BUTTON_CLICK),Mw.event(MS.BUTTON_CLICK,{button_name:this.node.name,screen_name:V.getCurrentPage()}),this.node.scene.emit(Ee.FRIENDS_TAB_SELECTED)}}]),s}(eL)).prototype,"tabWorld",[D3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D7=n(D8.prototype,"tabFriends",[D5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D6=D8))||D6);ew._RF.pop(),ew._RF.push({},"91613SO4bxPDq9dH9zxyIef","LeaderboardTimer",void 0);var MC,ME,M_,MA,MT,MP=eS.ccclass,MR=eS.property,MI=GameCore.Utils.Time,MO=globalThis.game.language,ML=(Ml=MP("LeaderboardTimer"),Mu=MR(e_),Mh=MR(ek),Mp=MR(j),Ml((Mf=n((My=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"background",Mf,_(n)),E(n,"calendar",Mv,_(n)),E(n,"timerLocalizer",Mg,_(n)),n.alreadyShown=!1,n}return T(u,[{key:"onLoad",value:function(){this.timerOpacity=this.timerLocalizer.node.getComponent(eH),this.validateRequiredComponents(),this.backgroundDefaultWidth=this.background.width,this.calendarDefaultPosition=this.calendar.position.clone()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"show",value:(I=N(function(n){var w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:if(!(!this.alreadyShown&&!n.aborted))return[3,3];this.alreadyShown=!0;w=ez(this.calendar).to(.3,{scale:eQ.ONE},{easing:"backOut"}).to(.3,{position:this.calendarDefaultPosition.clone()},{easing:"quadOut"}),k=ez(this.background).delay(.3).to(.3,{width:this.backgroundDefaultWidth},{easing:"quadOut"}),C=ez(this.timerOpacity).to(.3,{opacity:255});return[4,Promise.all([z.runTweenAsync(w,n),z.runTweenAsync(k,n)])];case 1:E.sent(),this.calendar.scale=eQ.ONE,this.calendar.position=this.calendarDefaultPosition.clone(),this.background.width=this.backgroundDefaultWidth;return[4,z.runTweenAsync(C,n)];case 2:E.sent(),this.timerOpacity.opacity=255;E.label=3;case 3:return[2]}})}),function(n){return I.apply(this,arguments)})},{key:"reset",value:function(){this.alreadyShown||(this.calendar.position=this.background.node.position.clone(),this.calendar.scale=eQ.ZERO,this.background.width=0,this.timerOpacity.opacity=0)}},{key:"setTimeLabel",value:function(n){if(n){var w=new Date,k=0;if("manually"===n)k=0;else if("daily"===n)k=Date.UTC(w.getUTCFullYear(),w.getUTCMonth(),w.getUTCDate()+1);else if("weekly"===n){var C=w.getUTCDay(),E=0===C?1:8-C;k=Date.UTC(w.getUTCFullYear(),w.getUTCMonth(),w.getUTCDate()+E)}else k="monthly"===n?Date.UTC(w.getUTCFullYear(),w.getUTCMonth()+1):Date.UTC(w.getUTCFullYear(),w.getUTCMonth(),w.getUTCDate()+1);try{var _=MI.getRelativeTime(k/1e3,MO.getCurrentLocale());this.timerLocalizer.key="game.endsIn",this.timerLocalizer.setParams([_])}catch(n){this.timerLocalizer.key="game.endsSoon"}}else this.timerLocalizer.key="game.endsSoon"}}]),u}(eL)).prototype,"background",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mv=n(My.prototype,"calendar",[Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mg=n(My.prototype,"timerLocalizer",[Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Md=My))||Md);ew._RF.pop(),ew._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var MD,MM,MN,Mz,MB,MF,Mx,MU,MG,MH,MV,Mq,MW,MK,Mj,MY,MX,MZ,MJ,MQ,M$,M0,M1,M2,M4,M3,M5,M6,M8,M9,M7,Ne,Nt,Nn,Ni,Nr,Na,No,Ns,Nl,Nu,Nc,Nh,Np,Nd=eS.ccclass,Ny=eS.disallowMultiple,Nf=eS.property,Ng=(MC=Nd("LeaderSkeleton"),ME=Nf(ek),MC(M_=Ny((MT=n((MA=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"container",MT,_(n)),n}return T(c,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eH),this.validateRequiredComponents()}},{key:"hide",value:(L=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=this;return[4,z.runTweenAsync(ez(this.uiOpacity).to(.2,{opacity:0}).call(function(){w.node.active=!1}),n)];case 1:k.sent();return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"show",value:(I=N(function(n,w){var k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:k=this;this.node.active=!0,this.uiOpacity.opacity=0;C=this.container.position.clone();this.container.position=new eQ(C.x,C.y-100,C.z);E=ez(this.container).delay(n);E.to(.2,{position:C},{easing:"cubicOut"});_=ez(this.uiOpacity).delay(n);_.to(.2,{opacity:255},{easing:"cubicOut"}),w.addAbortListener(function(){k.container.position=C,k.uiOpacity.opacity=255});return[4,Promise.all([z.runTweenAsync(E,w),z.runTweenAsync(_,w)])];case 1:T.sent();return[2]}})}),function(n,w){return I.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),c}(eL)).prototype,"container",[ME],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=MA))||M_)||M_);ew._RF.pop(),ew._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var Nm,Nb,Nw,NS,Nk,NC,NE,N_,NA,NT,NP,NR,NI,NO=eS.ccclass,NL=eS.property,ND=GameCore.Utils.Number,NM=(MD=NO("Leader"),MM=NL(eT),MN=NL(eH),Mz=NL({type:ek,group:"Container"}),MB=NL({type:ex,group:"Background"}),MF=NL({type:e7,group:"Background"}),Mx=NL({type:ex,group:"Rank"}),MU=NL({type:eT,group:"Rank"}),MG=NL({type:e7,group:"Rank"}),MH=NL({type:e7,group:"Rank"}),MV=NL({type:e7,group:"Rank"}),Mq=NL({type:e7,group:"Rank"}),MW=NL({type:ex,group:"Avatar"}),MK=NL({type:eH,group:"Avatar"}),Mj=NL({type:ex,group:"Score"}),MY=NL({type:eT,group:"Score"}),MX=NL({type:e7,group:"Score"}),MZ=NL({type:eH,group:"Score"}),MJ=NL({type:eH}),MQ=NL({type:e_}),M$=B.onlyRunInLifeCycle,M0=B.onlyRunInLifeCycleAsync,M1=B.onlyRunInLifeCycle,MD((M3=n((M4=function(n){w(g,n);var I,L,D,M,F,U=k(g);function g(){var n;C(this,g);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=U.call.apply(U,[this].concat(k)),E(n,"nameLabel",M3,_(n)),E(n,"nameOpacity",M5,_(n)),E(n,"container",M6,_(n)),E(n,"background",M8,_(n)),E(n,"highlightBackground",M9,_(n)),E(n,"rankSprite",M7,_(n)),E(n,"rankLabel",Ne,_(n)),E(n,"goldRank",Nt,_(n)),E(n,"silverRank",Nn,_(n)),E(n,"bronzeRank",Ni,_(n)),E(n,"highlightRank",Nr,_(n)),E(n,"avatar",Na,_(n)),E(n,"avatarOpacity",No,_(n)),E(n,"scoreBackground",Ns,_(n)),E(n,"scoreLabel",Nl,_(n)),E(n,"highlightScoreBackground",Nu,_(n)),E(n,"scoreOpacity",Nc,_(n)),E(n,"uiOpacity",Nh,_(n)),E(n,"uiTransform",Np,_(n)),n.signal=new x,n}return T(g,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.defaultAvatar=this.avatar.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"updateInfo",value:function(n,w){this.updateBackground(n),this.updateRank(n,w),this.updatePhoto(n),this.updateUsername(n),this.updateScore(n)}},{key:"updateBackground",value:function(n){this.background.spriteFrame=n.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(n,w){var k=n.rank;this.rankLabel.string=w&&k>w?"".concat(w,"+"):k.toString(),this.rankSprite.spriteFrame=this.defaultRank;var C=new eC(Ea);switch(n.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,C=new eC(Es)),k){case 1:this.rankSprite.spriteFrame=this.goldRank,C=new eC(Et);break;case 2:this.rankSprite.spriteFrame=this.silverRank,C=new eC(En);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,C=new eC(Ei)}this.rankLabel.shadowColor=C,this.rankLabel.outlineColor=C}},{key:"updatePhoto",value:(F=N(function(n){var w,k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:this.signal.abort();w=new x;if(this.signal=w,!this.avatar)return[3,5];k=n.playerId,C=n.photo;if(!wT.isAvatarCached(n.playerId,70))return[3,2];return[4,wT.getPlayerAvatar(C,k,70,w)];case 1:E=T.sent();if(!E||w.aborted)return[2];this.setPhoto(E);return[3,5];case 2:this.avatar.spriteFrame=this.defaultAvatar;return[4,z.waitTweenAsync(.1,w)];case 3:if(T.sent(),!!w.aborted)return[3,5];return[4,wT.getPlayerAvatar(C,k,70,w)];case 4:_=T.sent();_&&!w.aborted&&this.setPhoto(_);T.label=5;case 5:return[2]}})}),function(n){return F.apply(this,arguments)})},{key:"setPhoto",value:function(n){this.node.active&&(n.packable=!0,this.avatar.spriteFrame=n)}},{key:"updateUsername",value:function(n){this.nameLabel.string=n.name,this.nameLabel.color=new eC(n.isHighlight?Eo:Er)}},{key:"updateScore",value:function(n){var w=Math.floor(n.score);this.scoreLabel.string=ND.getShortNumber(w,7);var k=this.scoreLabel.getComponent(eT);k.outlineColor=new eC(n.isHighlight?Es:Ea),k.shadowColor=new eC(n.isHighlight?Es:Ea),this.scoreBackground.spriteFrame=n.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(M=N(function(n,w){var k,C,E,_,T;var I=arguments;return _ts_generator(this,function(L){switch(L.label){case 0:k=this,C=I.length>2&&void 0!==I[2]?I[2]:.3;this.setVisible(!1);E=this.container.position.clone();this.container.position=new eQ(E.x,E.y-100,E.z);_=ez(this.container).delay(w);_.to(C,{position:E},{easing:"backOut"});T=ez(this.uiOpacity).delay(w);T.to(C,{opacity:255},{easing:"cubicOut",onUpdate:function(){k.nameOpacity.opacity=k.uiOpacity.opacity,k.scoreOpacity.opacity=k.uiOpacity.opacity,k.avatarOpacity.opacity=k.uiOpacity.opacity}}),n.addAbortListener(function(){k.container.position=E,k.uiOpacity.opacity=255,k.avatar.node.active=!0});return[4,Promise.all([z.runTweenAsync(_,n),z.runTweenAsync(T,n)])];case 1:L.sent();return[2]}})}),function(n,w){return M.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(D=N(function(n,w,k){var C;return _ts_generator(this,function(E){switch(E.label){case 0:C=ez(this.node).to(w,{worldPosition:n},{easing:"quadOut"});return[4,z.runTweenAsync(C,k)];case 1:E.sent();return[2]}})}),function(n,w,k){return D.apply(this,arguments)})},{key:"runScaleAnimation",value:(L=N(function(n,w,k){var C;return _ts_generator(this,function(E){switch(E.label){case 0:C=ez(this.node).to(w,{scale:new eQ(n,n,n)},{easing:"backOut"});return[4,z.runTweenAsync(C,k)];case 1:E.sent();return[2]}})}),function(n,w,k){return L.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(I=N(function(n,w,k,C,E,_){var T;return _ts_generator(this,function(I){switch(I.label){case 0:T=this;return[4,z.runOnUpdateAsync(this.node,E,function(E){var _=Math.floor(n+(w-n)*E),I=Math.floor(k+(C-k)*E);T.updateRank({rank:_,isHighlight:!0}),T.updateScore({score:I,isHighlight:!0})},_)];case 1:I.sent();return[2]}})}),function(n,w,k,C,E,_){return I.apply(this,arguments)})},{key:"setVisible",value:function(n){var w=n?255:0;this.uiOpacity.opacity=w,this.nameOpacity.opacity=w,this.scoreOpacity.opacity=w,this.avatarOpacity.opacity=w}}]),g}(eL)).prototype,"nameLabel",[MM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M5=n(M4.prototype,"nameOpacity",[MN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M6=n(M4.prototype,"container",[Mz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M8=n(M4.prototype,"background",[MB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M9=n(M4.prototype,"highlightBackground",[MF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M7=n(M4.prototype,"rankSprite",[Mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ne=n(M4.prototype,"rankLabel",[MU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nt=n(M4.prototype,"goldRank",[MG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nn=n(M4.prototype,"silverRank",[MH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ni=n(M4.prototype,"bronzeRank",[MV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nr=n(M4.prototype,"highlightRank",[Mq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Na=n(M4.prototype,"avatar",[MW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),No=n(M4.prototype,"avatarOpacity",[MK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ns=n(M4.prototype,"scoreBackground",[Mj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nl=n(M4.prototype,"scoreLabel",[MY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nu=n(M4.prototype,"highlightScoreBackground",[MX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nc=n(M4.prototype,"scoreOpacity",[MZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh=n(M4.prototype,"uiOpacity",[MJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Np=n(M4.prototype,"uiTransform",[MQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(M4.prototype,"updateInfo",[M$],Object.getOwnPropertyDescriptor(M4.prototype,"updateInfo"),M4.prototype),n(M4.prototype,"updatePhoto",[M0],Object.getOwnPropertyDescriptor(M4.prototype,"updatePhoto"),M4.prototype),n(M4.prototype,"setPhoto",[M1],Object.getOwnPropertyDescriptor(M4.prototype,"setPhoto"),M4.prototype),M2=M4))||M2);ew._RF.pop(),ew._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var NN,Nz,NB,NF,Nx,NU,NG,NH,NV,Nq,NW,NK,Nj,NY,NX,NZ,NJ,NQ,N$,N0,N1,N2,N4,N3,N5,N6,N8=eS.ccclass,N9=eS.property,N7=globalThis.game.player,ze=GameCore.Utils.Array,zt=(Nm=N8("Leaders"),Nb=N9(T_),Nw=N9(NM),NS=N9(eD),Nk=B.onlyRunInLifeCycleAsync,NC=B.onlyRunInLifeCycleAsync,NE=B.onlyRunInLifeCycleAsync,N_=B.onlyRunInLifeCycleAsync,Nm((NP=n((NT=function(n){w(m,n);var D,M,z,F,x,U,G=k(m);function m(){var n;C(this,m);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=G.call.apply(G,[this].concat(k)),E(n,"scrollView",NP,_(n)),E(n,"tempLeader",NR,_(n)),E(n,"maxLeader",NI,_(n)),n.leaderData=[],n.displayLeaderData=[],n.displayPlayerLeader=null,n.isHidden=!0,n}return T(m,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(e_),this.batchNodes=this.getComponents(sv),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=N7.getPlayerId()}},{key:"updateData",value:(U=N(function(n){return _ts_generator(this,function(w){this.isHidden=!1,this.leaderData=n,this.leaderData.forEach(function(n,w){n.rank=w+1}),this.setupDisplayLeadersData();return[2]})}),function(n){return U.apply(this,arguments)})},{key:"initScrollViews",value:function(){var n=this;this.scrollView.setMaxNodeCount(this.leaderData.length),this.scrollView.init(function(w){var k=w.getComponent(NM),C=n.displayLeaderData[w.order],E=C.playerId,_=C.photo,T=C.name,I=C.score;k.setVisible(!0),k.updateInfo({playerId:E,isHighlight:n.currentPlayerId===E,name:T,photo:_,rank:w.order+1,score:I},n.maxLeader)}),this.setBatchNodes(!0)}},{key:"playRankChangeAnimation",value:(x=N(function(n,w,k,C){var E,_,T,I,L,D,M,N,z,B,F,x;return _ts_generator(this,function(U){switch(U.label){case 0:if(w>=k)return[3,4];E=this.displayLeaderData,_=ze.search(E,function(n){return n.playerId===N7.getPlayerId()});if(!_)return[3,4];T=_.rank;if(!E[C-1])return[3,4];I=this.scrollView.getNodeByOrder(_.rank-1);if(!I)return[3,4];L=null==I?void 0:I.getComponent(NM);if(!L)return[3,4];L.setVisible(!1),this.tempLeader.setVisible(!0),this.tempLeader.updatePhoto({playerId:N7.getPlayerId(),photo:_.photo}),this.tempLeader.node.worldPosition=I.node.worldPosition.clone();return[4,this.tempLeader.runScaleAnimation(1.1,.5,n)];case 1:U.sent();D=Math.min(.5*(T-C),2),M=[this.tempLeader.runUpdateDataAnimation(T,C,w,k,D,n),this.scrollToLeaderRank(C,D,n)],N=this.scrollView.scrollView.getMaxScrollOffset().y,z=this.scrollView.getNodeScrollOffset(C-1),B=eQ.ZERO;if(z<0)B=new eQ(this.tempLeader.node.worldPosition.x,this.node.worldPosition.y+this.scrollView.getNodePosition(C-1).y+this.uiTransform.height/2,this.tempLeader.node.worldPosition.z);else if(this.scrollView.scrollView.getScrollOffset().y>=N-5){if(z<N)B=new eQ(this.tempLeader.node.worldPosition.x,this.scrollView.viewport.node.worldPosition.y,this.tempLeader.node.worldPosition.z);else{x=this.scrollView.getNodeByOrder(C-1);B=null!==(F=null==x?void 0:x.node.worldPosition.clone())&&void 0!==F?F:eQ.ZERO}}B.equals(eQ.ZERO)||M.push(this.tempLeader.runWorldPositionAnimation(B,D,n));return[4,Promise.all(M)];case 2:U.sent();return[4,Promise.all([this.tempLeader.runScaleAnimation(1,.25,n),this.playPostRankChangeAnimation(C,T,n)])];case 3:U.sent(),this.tempLeader.setVisible(!1),I.node.worldPosition=this.tempLeader.node.worldPosition.clone(),this.setupDisplayLeadersData(),this.scrollView.updateNodeVisibility(),this.scrollView.updateLayout();U.label=4;case 4:return[2]}})}),function(n,w,k,C){return x.apply(this,arguments)})},{key:"playShowLeadersAnimation",value:(F=N(function(n){var w,k,C,E,_;var T=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:w=this,k=T.length>1&&void 0!==T[1]?T[1]:.1;if(!!this.isHidden)return[3,2];C=[],E=this.scrollView.getAllNodes();if(E.sort(function(n,w){return n.order-w.order}).forEach(function(n,k){var E=n.getComponent(NM);E.setVisible(k<w.leaderData.length),n.isVisible()&&C.push(E)}),C.length<1)return[3,2];C=C.slice(0,E.length-1);_=.3;return[4,Promise.all(C.map(function(){var C=N(function(C,E){var T;return _ts_generator(this,function(I){switch(I.label){case 0:T=w.isHidden;if(T)return[3,2];return[4,C.runShowUpAnimation(n,E*k,_)];case 1:T=I.sent();I.label=2;case 2:return[2]}})});return function(n,w){return C.apply(this,arguments)}}()))];case 1:I.sent();I.label=2;case 2:return[2]}})}),function(n){return F.apply(this,arguments)})},{key:"scrollToPlayerLeader",value:(z=N(function(n,w){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=this.displayPlayerLeader;if(!k)return[3,2];return[4,this.scrollToLeaderRank(this.displayPlayerLeader.rank,n,w)];case 1:k=C.sent();C.label=2;case 2:return[2]}})}),function(n,w){return z.apply(this,arguments)})},{key:"updateDisplayPlayerLeaderForRankChanging",value:function(n,w,k){if(!this.displayPlayerLeader)return!1;this.displayPlayerLeader.score=n,this.displayLeaderData.sort(function(n,w){return w.score-n.score});var C=this.displayLeaderData.indexOf(this.displayPlayerLeader)+1;return k===C?(this.displayPlayerLeader.score=w,this.displayPlayerLeader.rank=k,!1):(this.displayPlayerLeader.rank=C,this.tempLeader.updateInfo({playerId:N7.getPlayerId(),isHighlight:!0,name:this.displayPlayerLeader.name,photo:this.displayPlayerLeader.photo,rank:this.displayPlayerLeader.rank,score:n}),!0)}},{key:"hideLeaders",value:function(){this.isHidden=!0;var n,w=this.scrollView.getAllNodes().map(function(n){return n.getComponent(NM)}),k=L(w);try{for(k.s();!(n=k.n()).done;){var C=n.value;null==C||C.setVisible(!1)}}catch(n){k.e(n)}finally{k.f()}this.setBatchNodes(!1)}},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"setBatchNodes",value:function(n){this.batchNodes.every(function(w){w.enabled=n})}},{key:"setupDisplayLeadersData",value:function(){var n=this,w=ze.search(this.leaderData,function(w){return w.playerId===n.currentPlayerId});w?(this.displayLeaderData=this.leaderData.filter(function(w){return w.playerId!==n.currentPlayerId}),this.displayPlayerLeader=I({},w),this.displayLeaderData.splice(w.rank-1,0,this.displayPlayerLeader)):(this.displayPlayerLeader=null,this.displayLeaderData=this.leaderData)}},{key:"playPostRankChangeAnimation",value:(M=N(function(n,w,k){var C,E,_,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:C=null!=n?n:0,E=this.scrollView.getVisibleNodes().filter(function(n){return n.order>=C-1&&n.order<w}),_=E.map(function(n){return n.getComponent(NM)}),T=this.scrollView.nodeHeight+this.scrollView.spacing,I=[];_.forEach(function(n,w){n.updateRank({rank:E[w].order+2,isHighlight:!1});var C=n.node.worldPosition.clone();I.push(n.runWorldPositionAnimation(C.add3f(0,-T,0),.25,k))});return[4,Promise.all(I)];case 1:L.sent();return[2]}})}),function(n,w,k){return M.apply(this,arguments)})},{key:"scrollToLeaderRank",value:(D=N(function(n,w,k){return _ts_generator(this,function(C){switch(C.label){case 0:return[4,this.scrollView.scrollToOrder(n-1,k,w)];case 1:C.sent();return[2]}})}),function(n,w,k){return D.apply(this,arguments)})}]),m}(eL)).prototype,"scrollView",[Nb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NR=n(NT.prototype,"tempLeader",[Nw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NI=n(NT.prototype,"maxLeader",[NS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(NT.prototype,"updateData",[Nk],Object.getOwnPropertyDescriptor(NT.prototype,"updateData"),NT.prototype),n(NT.prototype,"playRankChangeAnimation",[NC],Object.getOwnPropertyDescriptor(NT.prototype,"playRankChangeAnimation"),NT.prototype),n(NT.prototype,"scrollToPlayerLeader",[NE],Object.getOwnPropertyDescriptor(NT.prototype,"scrollToPlayerLeader"),NT.prototype),n(NT.prototype,"scrollToLeaderRank",[N_],Object.getOwnPropertyDescriptor(NT.prototype,"scrollToLeaderRank"),NT.prototype),NA=NT))||NA);ew._RF.pop(),ew._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var zn,zi,zr,za,zo,zs,zl,zu=eS.ccclass,zc=eS.property,zh=globalThis.game,zp=zh.storage,zd=zh.leaderboard,zy=zh.player,zf=zh.monitorError,zg=GameCore,zm=zg.Utils.Object,zb=zg.Configs.Leaderboards,zw=function(n){w(o,n);var E=k(o);function o(n){var w;return C(this,o),(w=E.call(this,n)).name="EmptyLeaderboardError",w}return T(o)}(J(Error)),zS=(NN=zu("LeaderboardContent"),Nz=B.required(),NB=zc(Mk),NF=B.required(),Nx=zc(ML),NU=B.required(),NG=zc(zt),NH=zc({type:[Ng]}),NV=B.required(),Nq=zc(D2),NW=B.required(),NK=zc(iA),Nj=B.onlyRunInLifeCycleAsync,NY=B.onlyRunInLifeCycleAsync,NX=B.onlyRunInLifeCycleAsync,NZ=B.onlyRunInLifeCycleAsync,NJ=B.onlyRunInLifeCycleAsync,NQ=B.onlyRunInLifeCycleAsync,NN((N1=n((N0=function(n){w(g,n);var I,L,D,M,z,F,U=k(g);function g(){var n;C(this,g);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=U.call.apply(U,[this].concat(k)),E(n,"tabs",N1,_(n)),E(n,"timer",N2,_(n)),E(n,"leaders",N4,_(n)),E(n,"leaderSkeletons",N3,_(n)),E(n,"leaderboardIsEmpty",N5,_(n)),E(n,"contentOpacity",N6,_(n)),n.isHidden=!0,n.currentLb=null,n.animAbortSignal=new x,n.hasPlayedAppearAnim={friends:!1,global:!1,tournament:!1},n.handleFriendsTabSelected=N(function(){var w,k;return _ts_generator(this,function(C){switch(C.label){case 0:zp.setStorageData("leaderboard_content","lastTabOpened","friends"),n.cleanupSideEffects();w=n.animAbortSignal;C.label=1;case 1:C.trys.push([1,3,,4]);return[4,n.updateStatus(w,"friends")];case 2:C.sent();return[3,4];case 3:k=C.sent();w.call(function(){var n=_instanceof(k,Error)?k:new Error("Unknown error during loading friends leaderboard.");console.error("LeaderboardContent",n),null==zf||zf.sendException(n),ei.showNotificationScreenWithLocalizedKey("error.noFriendsLb",2)});return[3,4];case 4:return[2]}})}),n.handleWorldTabSelected=N(function(){var w,k;return _ts_generator(this,function(C){switch(C.label){case 0:zp.setStorageData("leaderboard_content","lastTabOpened","global"),n.cleanupSideEffects();w=n.animAbortSignal;C.label=1;case 1:C.trys.push([1,3,,4]);return[4,n.updateStatus(w,"global")];case 2:C.sent();return[3,4];case 3:k=C.sent();w.call(function(){var n=_instanceof(k,Error)?k:new Error("Unknown error during loading global leaderboard.");console.error("LeaderboardContent",n),null==zf||zf.sendException(n),ei.showNotificationScreenWithLocalizedKey("error.noWorldLb",2)});return[3,4];case 4:return[2]}})}),n.hideContent=function(){n.contentOpacity.changeStateFade(!1,.1)},n.showContent=function(){n.contentOpacity.changeStateFade(!0,.1)},n}return T(g,[{key:"__preload",value:function(){this.leaders.maxLeader=zb.Limit}},{key:"onLoad",value:function(){B.validateRequiredProperties(this)}},{key:"listenEvents",value:function(){this.node.scene.on(Ee.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(Ee.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(i7.HIDE_UI,this.hideContent),this.node.scene.on(i7.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.node.scene.off(Ee.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(Ee.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(i7.HIDE_UI,this.hideContent),this.node.scene.off(i7.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(F=N(function(n,w){var k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:k=this,C=this.getLeaderboardName(n);E=null!==C;if(!E)return[3,3];return[4,w.callAsync(function(){return zd.requestLeaderboardAsync(C,zb.Limit)})];case 1:_.sent(),w.call(function(){var n=zd.getLeaderboard(C);k.currentLb=null!=n?n:k.currentLb});return[4,w.callAsync(N(function(){return _ts_generator(this,function(w){return[2,k.loadPlayerLeaderData(n)]})}))];case 2:E=_.sent();_.label=3;case 3:return[2]}})}),function(n,w){return F.apply(this,arguments)})},{key:"getLeaderboardName",value:function(n){return"friends"===n?ed.FRIENDS:ed.GLOBAL}},{key:"showLoading",value:(z=N(function(n){var w,k;var C=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:w=this,k=C.length>1&&void 0!==C[1]?C[1]:0;return[4,Promise.all([this.leaders.scrollView.unlistenEvents(),this.leaders.scrollView.scrollToTop(n).then(function(){w.leaders&&(w.leaders.scrollView.scrollView.enabled=!1,w.leaders.scrollView.listenEvents())}),this.leaderSkeletons.map(function(w,C){return w.show(C*k,n)})])];case 1:E.sent();return[2]}})}),function(n){return z.apply(this,arguments)})},{key:"hideLoading",value:(M=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(w){return w.hide(n)}))];case 1:w.sent();return[2]}})}),function(n){return M.apply(this,arguments)})},{key:"entering",value:function(){this.timer.reset(),this.isHidden=!1;var n=zp.getStorageData("leaderboard_content","lastTabOpened");"friends"===n?this.handleFriendsTabSelected():"global"===n&&this.handleWorldTabSelected()}},{key:"enter",value:function(){this.listenEvents()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){this.animAbortSignal.abort(),this.animAbortSignal=new x,this.leaders.hideLeaders(),this.leaderboardIsEmpty.hide()}},{key:"updateStatus",value:(D=N(function(n,w){var k,C,E,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:_=this;if(!(void 0!==n&&!this.isHidden))return[3,7];this.tabs.updateStatus(w);return[4,this.showLoading(n)];case 1:I.sent();I.label=2;case 2:I.trys.push([2,4,,5]);return[4,this.loadLeaderboard(w,n)];case 3:I.sent();return[3,5];case 4:T=I.sent();if(!_instanceof(T,zw))throw T;return[2,void n.call(function(){_.leaderboardIsEmpty.show(),_.hideLoading(n)})];case 5:null===(k=this.timer)||void 0===k||k.setTimeLabel(null===(C=this.currentLb)||void 0===C?void 0:C.resettable),null===(E=this.timer)||void 0===E||E.show(n),this.hideLoading(n);return[4,n.callAsync(function(n){return _.playLeadersShowupAnimation(w,n)})];case 6:I.sent();I.label=7;case 7:return[2]}})}),function(n,w){return D.apply(this,arguments)})},{key:"playLeadersShowupAnimation",value:(L=N(function(n,w){var k,C,E,_,T,I,L,D,M,N,z,B,F;return _ts_generator(this,function(x){switch(x.label){case 0:k=this;if(!this.currentLb)return[3,6];C=zy.getPlayerId(),E=this.currentLb.leaders[C],_=zp.getStorage("leaderboard_content").previousScore,T=null!=E?E:{},I=T.score,L=T.rank,D=zm.vals(this.currentLb.leaders);D.sort(function(n,w){return w.score-n.score});M=-1!==_&&_<I&&L<=zb.Limit;this.leaders.updateData(D);N=!1;E&&M&&(N=this.leaders.updateDisplayPlayerLeaderForRankChanging(_,I,L)),this.leaders.initScrollViews(),this.leaders.scrollView.scrollView.enabled=!0;z=this.hasPlayedAppearAnim[n]?0:.1;return[4,w.callAsync(function(){return k.leaders.playShowLeadersAnimation(w,z)})];case 1:x.sent(),this.hasPlayedAppearAnim[n]=!0;B=E;if(!B)return[3,5];return[4,w.callAsync(function(){return k.leaders.scrollToPlayerLeader(1,w)})];case 2:x.sent();F=N&&-1!==_;if(!F)return[3,4];return[4,w.callAsync(function(n){return k.leaders.playRankChangeAnimation(n,_,I,L)})];case 3:F=(x.sent(),zp.setStorageData("leaderboard_content","previousScore",I));x.label=4;case 4:B=F;x.label=5;case 5:x.label=6;case 6:return[2]}})}),function(n,w){return L.apply(this,arguments)})},{key:"loadPlayerLeaderData",value:(I=N(function(n){var w,k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:w=zy.getPlayerId();if(null===this.currentLb)throw new Error("LeaderboardContent: Leaderboard is not found.");k=this.currentLb.leaders;if(0===Object.keys(k).length)throw new zw("LeaderboardContent: Leaderboard is empty.");if(!!k[w])return[3,2];C=this.getLeaderboardName(n);if(null===C)throw new Error("LeaderboardContent: Leaderboard name is not found.");return[4,zd.getLeadersByPlayerIdsAsync(C,[w])];case 1:E=T.sent();if(0!==E.length){_=E[0];k[w]=_}T.label=2;case 2:return[2]}})}),function(n){return I.apply(this,arguments)})}]),g}(eL)).prototype,"tabs",[Nz,NB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N2=n(N0.prototype,"timer",[NF,Nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N4=n(N0.prototype,"leaders",[NU,NG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N3=n(N0.prototype,"leaderSkeletons",[NH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),N5=n(N0.prototype,"leaderboardIsEmpty",[NV,Nq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N6=n(N0.prototype,"contentOpacity",[NW,NK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(N0.prototype,"loadLeaderboard",[Nj],Object.getOwnPropertyDescriptor(N0.prototype,"loadLeaderboard"),N0.prototype),n(N0.prototype,"showLoading",[NY],Object.getOwnPropertyDescriptor(N0.prototype,"showLoading"),N0.prototype),n(N0.prototype,"hideLoading",[NX],Object.getOwnPropertyDescriptor(N0.prototype,"hideLoading"),N0.prototype),n(N0.prototype,"updateStatus",[NZ],Object.getOwnPropertyDescriptor(N0.prototype,"updateStatus"),N0.prototype),n(N0.prototype,"playLeadersShowupAnimation",[NJ],Object.getOwnPropertyDescriptor(N0.prototype,"playLeadersShowupAnimation"),N0.prototype),n(N0.prototype,"loadPlayerLeaderData",[NQ],Object.getOwnPropertyDescriptor(N0.prototype,"loadPlayerLeaderData"),N0.prototype),N$=N0))||N$);ew._RF.pop(),ew._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var zk,zC,zE,z_,zA,zT,zP,zR,zI,zO,zL,zD,zM,zN,zz,zB,zF,zx;zn=(0,eS.ccclass)("LeaderboardPage"),zi=B.required(),zr=B.onlyRunInLifeCycleAsync,za=B.onlyRunInLifeCycleAsync,zo=B.onlyRunInLifeCycleAsync,zn((zl=n((zs=function(n){w(f,n);var I,L,B,F,x=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=x.call.apply(x,[this].concat(k)),E(n,"panelAnimationController",zl,_(n)),n}return T(f,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(rw),D(M(f.prototype),"onLoad",this).call(this)}},{key:"start",value:(F=N(function(){return _ts_generator(this,function(n){D(M(f.prototype),"start",this).call(this);return[2]})}),function(){return F.apply(this,arguments)})},{key:"mount",value:(B=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,D(M(f.prototype),"mount",this).call(this)];case 1:if(n.sent(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(zS),!this.content)throw new Error("LeaderboardPage: Leaders not found");return[2]}})}),function(){return B.apply(this,arguments)})},{key:"transitionIn",value:(L=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:this.content.entering();return[4,D(M(f.prototype),"transitionIn",this).call(this)];case 1:k.sent();n=z.runTweenAsync(ez(this.containerUIOpacity).to(.2,{opacity:255})),w=this.panelAnimationController.showUI();return[4,Promise.all([n,w])];case 2:k.sent(),this.content.enter();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"transitionOut",value:(I=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,D(M(f.prototype),"transitionOut",this).call(this)];case 1:n.sent(),this.content.unlistenUIEvents(),this.content.leaders.setBatchNodes(!1);return[4,this.panelAnimationController.hideUI()];case 2:n.sent();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"unmount",value:function(){var n,w;null===(n=this.content)||void 0===n||n.hide(),null===(w=this.content)||void 0===w||w.cleanup(),D(M(f.prototype),"unmount",this).call(this)}}]),f}(TG)).prototype,"panelAnimationController",[zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(zs.prototype,"mount",[zr],Object.getOwnPropertyDescriptor(zs.prototype,"mount"),zs.prototype),n(zs.prototype,"transitionIn",[za],Object.getOwnPropertyDescriptor(zs.prototype,"transitionIn"),zs.prototype),n(zs.prototype,"transitionOut",[zo],Object.getOwnPropertyDescriptor(zs.prototype,"transitionOut"),zs.prototype),zs));ew._RF.pop(),ew._RF.push({},"0d1c02Npp9IXrjlFdl8co2L","TopLeader",void 0);var zU,zG,zH,zV,zq,zW,zK,zj,zY,zX,zZ,zJ,zQ,z$,z0,z1,z2,z4,z3,z5,z6,z8,z9,z7,Be,Bt,Bn,Bi=eS.ccclass,Br=eS.property,Ba=GameCore.Utils.Number,Bo=(zk=Bi("TopLeader"),zC=Br(eT),zE=Br(ek),z_=Br({type:ex}),zA=Br({type:eH}),zT=Br({type:eT}),zP=Br({type:eH}),zR=B.onlyRunInLifeCycle,zI=B.onlyRunInLifeCycleAsync,zO=B.onlyRunInLifeCycleAsync,zk((zM=n((zD=function(n){w(y,n);var I,L,D,M=k(y);function y(){var n;C(this,y);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=M.call.apply(M,[this].concat(k)),E(n,"nameLabel",zM,_(n)),E(n,"defaultAvatar",zN,_(n)),E(n,"avatar",zz,_(n)),E(n,"avatarOpacity",zB,_(n)),E(n,"scoreLabel",zF,_(n)),E(n,"uiOpacity",zx,_(n)),n.signal=new x,n}return T(y,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"updateInfo",value:function(n){this.updateUsername(n),this.updatePhoto(n),this.updateScore(n)}},{key:"updateUsername",value:function(n){this.nameLabel&&(this.nameLabel.string=n.name)}},{key:"updatePhoto",value:(D=N(function(n){var w,k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:this.signal.abort();w=new x;this.signal=w,this.defaultAvatar.active=!wT.isAvatarCached(n.playerId,128),this.avatar.spriteFrame=null;k=n.playerId,C=n.photo;return[4,wT.getPlayerAvatar(C,k,128,w)];case 1:E=_.sent();E&&!w.aborted&&this.setPhoto(E);return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"setPhoto",value:(L=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:if(!this.node.active)return[3,2];n.packable=!0,this.avatar.spriteFrame=n;w=ez(this.avatarOpacity).to(.2,{opacity:255});return[4,z.runTweenAsync(w,this.signal)];case 1:k.sent(),this.defaultAvatar.active=!1;k.label=2;case 2:return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"updateScore",value:function(n){if(this.scoreLabel){var w=Math.floor(n.score);this.scoreLabel.string=Ba.getShortNumber(w,7)}}},{key:"runShowUpAnimation",value:(I=N(function(n){var w,k,C,E;var _=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:w=_.length>1&&void 0!==_[1]?_[1]:.3,k=_.length>2?_[2]:void 0;this.node.scale=eQ.ZERO;C=ez(this.node).delay(n).to(w,{scale:new eQ(1,1,1)},{easing:"backOut"}),E=ez(this.uiOpacity).delay(n).to(w,{opacity:255});return[4,Promise.all([z.runTweenAsync(C,k),z.runTweenAsync(E,k)])];case 1:T.sent();return[2]}})}),function(n){return I.apply(this,arguments)})},{key:"setVisible",value:function(n){var w=n?255:0;this.uiOpacity.opacity=w,this.avatarOpacity.opacity=w}}]),y}(eL)).prototype,"nameLabel",[zC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zN=n(zD.prototype,"defaultAvatar",[zE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zz=n(zD.prototype,"avatar",[z_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zB=n(zD.prototype,"avatarOpacity",[zA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zF=n(zD.prototype,"scoreLabel",[zT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zx=n(zD.prototype,"uiOpacity",[zP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(zD.prototype,"updateInfo",[zR],Object.getOwnPropertyDescriptor(zD.prototype,"updateInfo"),zD.prototype),n(zD.prototype,"updatePhoto",[zI],Object.getOwnPropertyDescriptor(zD.prototype,"updatePhoto"),zD.prototype),n(zD.prototype,"setPhoto",[zO],Object.getOwnPropertyDescriptor(zD.prototype,"setPhoto"),zD.prototype),zL=zD))||zL);ew._RF.pop(),ew._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var Bs,Bl,Bu,Bc,Bh,Bp=eS.ccclass,Bd=eS.property,By=globalThis.game,Bf=By.leaderboard,Bv=By.player,Bg=By.language,Bm=GameCore.Utils,Bb=Bm.Time,Bw=Bm.Object,BS=Bm.Array,Bk=Bm.Number,BC=(zU=Bp("TournamentBlock"),zG=Bd(ek),zH=Bd(eT),zV=Bd(j),zq=Bd(j),zW=Bd(j),zK=Bd(j),zj=Bd(e_),zY=Bd({type:ex}),zX=Bd(ek),zZ=Bd(ek),zJ=Bd(Bo),zQ=B.onlyRunInLifeCycleAsync,z$=B.onlyRunInLifeCycle,zU((z2=n((z1=function(n){w(m,n);var I,L,D,M,x,U,G=k(m);function m(){var n;C(this,m);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=G.call.apply(G,[this].concat(k)),E(n,"container",z2,_(n)),E(n,"title",z4,_(n)),E(n,"titleLocalizer",z3,_(n)),E(n,"timeLocalizer",z5,_(n)),E(n,"playerCountLocalizer",z6,_(n)),E(n,"playButtonLocalize",z8,_(n)),E(n,"uiTransform",z9,_(n)),E(n,"banner",z7,_(n)),E(n,"bannerMask",Be,_(n)),E(n,"bannerLoadingRing",Bt,_(n)),E(n,"topLeader",Bn,_(n)),n.hasPlayedAnimation=!1,n}return T(m,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(eH),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"updateInfo",value:(U=N(function(n){var w,k,C,E,_,T,I,L;return _ts_generator(this,function(D){switch(D.label){case 0:this.payload=n;w=n.endTime,k=n.title,C=n.payload.playerName,E=n.tournamentType,_=n.payload,T=_.leaderboardId,I=_.themeId;L=T;if(!L)return[3,2];this.topLeader.setVisible(!1),this.topLeader.node.active=!1,this.setPlayerCountWaiting(),"PAGE_HOSTED"===E?this.updateTitleTournamentTitle(k):this.updateTitleWithPlayerName(null!=C?C:k),this.updateEndTime(w),this.updateTournamentBanner(I);return[4,this.fetchAndUpdateLeadersPayload(T,{leaders:[],amountPlayer:0},k)];case 1:L=D.sent();D.label=2;case 2:return[2]}})}),function(n){return U.apply(this,arguments)})},{key:"fetchAndUpdateLeadersPayload",value:(x=N(function(n,w,k){var C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:C=w;T.label=1;case 1:T.trys.push([1,3,,4]);return[4,this.getLeadersPayload(n)];case 2:E=T.sent();E&&(C=E);return[3,4];case 3:_=T.sent();console.error("Fetch lb for tournament ".concat(k),_);return[3,4];case 4:this.updateLeadersPayload(C);return[2]}})}),function(n,w,k){return x.apply(this,arguments)})},{key:"updateLeadersPayload",value:function(n){this.leadersPayload=n;var w=this.leadersPayload,k=w.player,C=w.amountPlayer,E=w.leaders;this.updatePlayerCount(C),this.updatePlayButtonLabel(void 0!==k),this.updateTopLeader(null!=E?E:[])}},{key:"updateTitleWithPlayerName",value:function(n){void 0!==n&&(this.titleLocalizer.enabled=!0,this.titleLocalizer.setParams([n]))}},{key:"updateTitleTournamentTitle",value:function(n){this.titleLocalizer.enabled=!1,this.title.string=n}},{key:"updateEndTime",value:function(n){try{var w=Bb.getRelativeTime(n,Bg.getCurrentLocale());this.timeLocalizer.key="game.endsIn",this.timeLocalizer.setParams([w])}catch(n){this.timeLocalizer.key="game.endsSoon"}}},{key:"updatePlayerCount",value:function(n){var w=Bk.getShortNumber(n,3);1===n?this.playerCountLocalizer.key="game.player":(this.playerCountLocalizer.key="game.nPlayers",this.playerCountLocalizer.setParams([w]))}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLocalizer.key="status.loading"}},{key:"updateTopLeader",value:(M=N(function(n){var w,k;return _ts_generator(this,function(C){if(0!==n.length){k=n[0];GameCore.Configs.Mockup.Leaderboards.Enabled&&(k=null!==(w=BS.search(n,function(n){return 1===n.rank}))&&void 0!==w?w:k),this.topLeader.node.active=!0,this.topLeader.updateInfo(k),this.topLeader.runShowUpAnimation(0,.2)}return[2]})}),function(n){return M.apply(this,arguments)})},{key:"updateTournamentBanner",value:(D=N(function(n){var w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:w=F.getAsset("".concat(ep[n],"/spriteFrame"),e7);k=w;if(k)return[3,2];this.bannerMask.active=!0,this.bannerLoadingRing.active=!0;return[4,F.loadThemePreviewAsync(n)];case 1:k=w=E.sent();E.label=2;case 2:C=w;if(C)return[3,4];return[4,F.loadThemePreviewAsync(eu.SUMMER)];case 3:C=w=E.sent();E.label=4;case 4:this.banner&&w&&(this.banner.spriteFrame=w,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1);return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"updatePlayButtonLabel",value:function(n){this.playButtonLocalize.key=n?"game.continue":"game.join"}},{key:"getLeadersPayload",value:(L=N(function(n){var w,k,C,E,_,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:k=Bf.getLeaderboardName(n);if(!k)return[2,null];return[4,sN.getAllLeaderboardAsync(n)];case 1:C=L.sent();if(!C)return[2,null];E=Bw.vals(C.leaders);E.sort(function(n,w){return n.rank-w.rank});_=Bv.getPlayerId();return[4,Bf.getLeadersByPlayerIdsAsync(k,[_])];case 2:T=L.sent(),I={leaders:E,amountPlayer:null!==(w=C.amountPlayer)&&void 0!==w?w:0};return[2,(T.length>0&&(I.player=T[0]),I)]}})}),function(n){return L.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(I=N(function(n,w,k){var C,E,_,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:C=this;this.node.scale=new eQ(.8,.8,.8),this.uiOpacity.opacity=0;E=this.container.position.clone();this.container.position=new eQ(E.x,E.y-100,E.z);_=ez(this.node).delay(n);_.to(w,{scale:eQ.ONE},{easing:"elasticOut"});T=ez(this.container).delay(n);T.to(w,{position:E},{easing:"backOut"});I=ez(this.uiOpacity).delay(n);I.to(w,{opacity:255},{easing:"cubicOut"}),k.addAbortListener(function(){C.node.scale=eQ.ONE,C.container.position=E,C.uiOpacity.opacity=255});return[4,Promise.all([z.runTweenAsync(_,k),z.runTweenAsync(T,k),z.runTweenAsync(I,k)])];case 1:L.sent();return[2]}})}),function(n,w,k){return I.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var n=this.payload.id||"";if(en.validateTournamentExpired(n))return this.node.scene.emit(sO.RELOAD_TOURNAMENT),void ei.showNotificationScreenWithLocalizedKey("error.tourEnded",2);try{var w=JSON.stringify(this.payload);ei.showTournamentDetailScreen(w,"tournament_start",this.hasPlayedAnimation),this.hasPlayedAnimation=!0}catch(n){console.warn("handleOnTournamentClicked",n)}}}]),m}(eL)).prototype,"container",[zG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z4=n(z1.prototype,"title",[zH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z3=n(z1.prototype,"titleLocalizer",[zV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z5=n(z1.prototype,"timeLocalizer",[zq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z6=n(z1.prototype,"playerCountLocalizer",[zW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z8=n(z1.prototype,"playButtonLocalize",[zK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z9=n(z1.prototype,"uiTransform",[zj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z7=n(z1.prototype,"banner",[zY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Be=n(z1.prototype,"bannerMask",[zX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bt=n(z1.prototype,"bannerLoadingRing",[zZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bn=n(z1.prototype,"topLeader",[zJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(z1.prototype,"fetchAndUpdateLeadersPayload",[zQ],Object.getOwnPropertyDescriptor(z1.prototype,"fetchAndUpdateLeadersPayload"),z1.prototype),n(z1.prototype,"updateLeadersPayload",[z$],Object.getOwnPropertyDescriptor(z1.prototype,"updateLeadersPayload"),z1.prototype),z0=z1))||z0);ew._RF.pop(),ew._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var BE,B_,BA,BT,BP,BR,BI,BO,BL,BD,BM,BN,Bz,BB=eS.ccclass,BF=eS.property,Bx=(Bs=BB("TournamentBlockSkeleton"),Bl=BF(ek),Bs((Bh=n((Bc=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"container",Bh,_(n)),n}return T(c,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eH),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"hide",value:(L=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=this;return[4,z.runTweenAsync(ez(this.uiOpacity).to(.2,{opacity:0}).call(function(){w.node.active=!1}),n)];case 1:k.sent();return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"show",value:(I=N(function(n,w){var k,C,E,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:k=this;this.node.active=!0,this.node.scale=new eQ(.8,.8,.8),this.uiOpacity.opacity=0;C=this.container.position.clone();this.container.position=new eQ(C.x,C.y-100,C.z);E=ez(this.node).delay(n);E.to(.2,{scale:eQ.ONE},{easing:"elasticOut"});_=ez(this.container).delay(n);_.to(.2,{position:C},{easing:"backOut"});T=ez(this.uiOpacity).delay(n);T.to(.2,{opacity:255},{easing:"cubicOut"}),w.addAbortListener(function(){k.node.scale=eQ.ONE,k.container.position=C,k.uiOpacity.opacity=255});return[4,Promise.all([z.runTweenAsync(E,w),z.runTweenAsync(_,w),z.runTweenAsync(T,w)])];case 1:I.sent();return[2]}})}),function(n,w){return I.apply(this,arguments)})}]),c}(eL)).prototype,"container",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bu=Bc))||Bu);ew._RF.pop(),ew._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var BU,BG,BH,BV,Bq,BW=eS.ccclass,BK=eS.property,Bj=globalThis.game.player,BY=(BE=BW("TournamentsBoard"),B_=BK(ta),BA=BK(ek),BT=BK(eB),BP=BK(ek),BR=BK(e_),BE((BL=n((BO=function(n){w(c,n);var I,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"tournamentBlockPrefab",BL,_(n)),n.tournamentBlockArray=[],E(n,"inactiveNodeContainer",BD,_(n)),E(n,"layout",BM,_(n)),E(n,"createTournamentButton",BN,_(n)),E(n,"viewport",Bz,_(n)),n}return T(c,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eH),this.validateRequiredComponents()}},{key:"start",value:function(){for(var n=0;n<20;n++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"updateData",value:function(n){var w=this,k=!1;n.forEach(function(n,C){var E=w.tournamentBlockArray[C];n.payload.playerId===Bj.getPlayerId()&&(k=!0),E||(E=w.addTournamentBlock()),w.layout.node.addChild(E.node),E.updateInfo(n)}),k||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var n=eA(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(n);var w=n.getComponent(BC);return this.tournamentBlockArray.push(w),w}},{key:"removeTournamentBlocks",value:function(){var n,w=this.getActiveTournamentBlocks(),k=L(w);try{for(k.s();!(n=k.n()).done;){var C=n.value;this.inactiveNodeContainer.addChild(C.node)}}catch(n){k.e(n)}finally{k.f()}this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var n=this;return this.tournamentBlockArray.filter(function(w){return w.node.parent===n.layout.node})}},{key:"setCreateTournamentButtonActive",value:function(n){n?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=n}},{key:"showTournamentBlocks",value:(I=N(function(n,w){var k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:k=this.getActiveTournamentBlocks();if(k.length<1)return[3,2];C=Math.ceil(n/this.tournamentBlockContentHeight),E=Math.min(k.length,C);return[4,Promise.all(k.map(function(){var n=N(function(n,k){return _ts_generator(this,function(C){switch(C.label){case 0:if(!(k<E))return[3,2];return[4,n.runShowPopUpAnimation(.1*k,.3,w)];case 1:C.sent();return[3,3];case 2:n.uiOpacity.opacity=255;C.label=3;case 3:return[2]}})});return function(w,k){return n.apply(this,arguments)}}()))];case 1:_.sent();_.label=2;case 2:return[2]}})}),function(n,w){return I.apply(this,arguments)})},{key:"updateVisibility",value:function(){var n,w=this.viewport.getBoundingBoxToWorld(),k=w.yMax,C=w.yMin,E=this.getActiveTournamentBlocks(),_=L(E);try{for(_.s();!(n=_.n()).done;){var T=n.value,I=T.uiTransform;if(void 0!==I){var D=I.getBoundingBoxToWorld(),M=D.yMax,N=D.yMin,z=M<C||N>k;T.uiOpacity.opacity=z?0:255}}}catch(n){_.e(n)}finally{_.f()}}}]),c}(eL)).prototype,"tournamentBlockPrefab",[B_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BD=n(BO.prototype,"inactiveNodeContainer",[BA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=n(BO.prototype,"layout",[BT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BN=n(BO.prototype,"createTournamentButton",[BP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bz=n(BO.prototype,"viewport",[BR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=BO))||BI);ew._RF.pop(),ew._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var BX,BZ,BJ,BQ,B$,B0,B1,B2,B4,B3,B5,B6,B8,B9,B7,Fe=eS.ccclass,Ft=eS.property,Fn=(BU=Fe("TournamentsNotAvailable"),BG=Ft(ek),BU((Bq=n((BV=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"createButton",Bq,_(n)),n}return T(u,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eH),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"show",value:(I=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:this.createButton.active=!0,this.uiOpacity.opacity=255;n=this.node.position.clone(),w=ez(this.node);w.to(.05,{position:n.clone().add3f(5,0,0)}),w.to(.05,{position:n.clone().add3f(-5,0,0)});k=ez(this.node).repeat(2,w);k.to(.05,{position:n});return[4,z.runTweenAsync(k)];case 1:C.sent();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"hide",value:function(){this.createButton.active=!1,this.uiOpacity.opacity=0}}]),u}(eL)).prototype,"createButton",[BG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BH=BV))||BH);ew._RF.pop(),ew._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var Fi,Fr,Fa,Fo,Fs,Fl,Fu,Fh,Fp=eS.ccclass,Fd=eS.property,Fy=globalThis.game,Ff=Fy.storage,Fv=Fy.match,Fg=GameCore.Utils,Fm=Fg.Object,Fb=Fg.Array,Fw=(BX=Fp("TournamentContent"),BZ=Fd({type:rA}),BJ=Fd(BY),BQ=Fd(Fn),B$=Fd(tb),B0=Fd({type:[Bx]}),B1=Fd(iA),BX((B3=n((B4=function(n){w(y,n);var I,L,D,M,z=k(y);function y(){var n;C(this,y);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=z.call.apply(z,[this].concat(k)),E(n,"panelAnimator",B3,_(n)),E(n,"tournamentsBoard",B5,_(n)),E(n,"tournamentsNotAvailable",B6,_(n)),E(n,"scrollView",B8,_(n)),E(n,"skeletons",B9,_(n)),E(n,"contentOpacity",B7,_(n)),n.animAbortSignal=null,n.softAbortSignal=null,n.hideContent=function(){n.contentOpacity.changeStateFade(!1,.1)},n.showContent=function(){n.contentOpacity.changeStateFade(!0,.1)},n}return T(y,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(e_),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(tb.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(sO.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(i7.HIDE_UI,this.hideContent),this.node.scene.on(i7.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(tb.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(sO.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(i7.HIDE_UI,this.hideContent),this.node.scene.off(i7.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(M=N(function(){var n,w,k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:this.listenEvents();w=null===this.animAbortSignal&&null===this.softAbortSignal;if(!w)return[3,2];this.animAbortSignal=new x,this.softAbortSignal=new x;return[4,this.showLoading(this.animAbortSignal)];case 1:w=(T.sent(),!this.isAborted());T.label=2;case 2:if(!w)return[3,10];return[4,en.requestTournamentDataAsync()];case 3:k=T.sent();C=this.isAborted();if(C)return[3,9];return[4,this.hideLoading(this.animAbortSignal)];case 4:T.sent();E=this.isAborted();if(E)return[3,8];if(!(0!==k.length||null!==(n=this.softAbortSignal)&&void 0!==n&&n.aborted))return[3,6];this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(k);return[4,this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal)];case 5:_=(T.sent(),this.tournamentsBoard.updateVisibility());return[3,7];case 6:_=this.tournamentsNotAvailable.show();T.label=7;case 7:E=_;T.label=8;case 8:C=E;T.label=9;case 9:T.label=10;case 10:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"showLoading",value:(D=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:this.scrollView.scrollToTop(0),this.scrollView.enabled=!1;return[4,Promise.all([this.skeletons.map(function(w){return w.show(0,n)})])];case 1:w.sent();return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"hideLoading",value:(L=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:return[4,Promise.all([this.skeletons.map(function(w){return w.hide(n)})])];case 1:w.sent();return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!Ff.getStorage("tournament").animateTournamentLeader)return;var n=en.getAllTournamentData(),w=Fv.getMatchState().customData.tournamentId;if(!w)throw new Error("Tournament ID not found");var k=Fb.search(n,function(n){return n.id===w});if(!k)throw new Error("Tournament not found");var C=JSON.stringify(k);ei.showTournamentDetailScreen(C,"tournament_end")}catch(n){Ff.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",n)}}},{key:"processCreateTournament",value:(I=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,2,,3]);return[4,s2.processCreateTournamentAsync()];case 1:w.sent();return[3,3];case 2:n=w.sent();if(!Fm.hasOwn(n,"code"))return[2,void ei.showNotificationScreenWithLocalizedKey("error.createTourFail",2)];if("USER_INPUT"===n.code)return[2];if("PLAYER_HAS_TOURNAMENT"===n.code)return[2,void ei.showNotificationScreenWithLocalizedKey("error.tourExists",2)];"INVALID_OPERATION"===n.code&&Fm.hasOwn(n,"message")&&"string"==typeof n.message&&ei.showNotificationScreen(n.message,2),ei.showNotificationScreenWithLocalizedKey("error.createTourFail",2);return[3,3];case 3:this.reload();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"isAborted",value:function(){var n,w;return null===(n=null===(w=this.animAbortSignal)||void 0===w?void 0:w.aborted)||void 0===n||n}},{key:"cleanup",value:function(){var n;this.unlistenEvents(),null===(n=this.animAbortSignal)||void 0===n||n.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var n;null===(n=this.softAbortSignal)||void 0===n||n.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.enter()}}]),y}(eL)).prototype,"panelAnimator",[BZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B5=n(B4.prototype,"tournamentsBoard",[BJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B6=n(B4.prototype,"tournamentsNotAvailable",[BQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B8=n(B4.prototype,"scrollView",[B$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B9=n(B4.prototype,"skeletons",[B0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),B7=n(B4.prototype,"contentOpacity",[B1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B2=B4))||B2);ew._RF.pop(),ew._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var FS,Fk,FC,FE,F_;Fi=(0,eS.ccclass)("TournamentPage"),Fr=B.required(),Fa=B.onlyRunInLifeCycleAsync,Fo=B.onlyRunInLifeCycle,Fs=B.onlyRunInLifeCycleAsync,Fl=B.onlyRunInLifeCycleAsync,Fi((Fh=n((Fu=function(n){w(f,n);var I,L,B,F,x=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=x.call.apply(x,[this].concat(k)),E(n,"panelAnimationController",Fh,_(n)),n}return T(f,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(rw),D(M(f.prototype),"onLoad",this).call(this)}},{key:"start",value:(F=N(function(){return _ts_generator(this,function(n){D(M(f.prototype),"start",this).call(this);return[2]})}),function(){return F.apply(this,arguments)})},{key:"mount",value:(B=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,D(M(f.prototype),"mount",this).call(this)];case 1:n.sent(),this.onMount();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(Fw),!this.content)throw new Error("LeaderboardPage: Leaders not found")}},{key:"transitionIn",value:(L=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,D(M(f.prototype),"transitionIn",this).call(this)];case 1:k.sent();n=z.runTweenAsync(ez(this.containerUIOpacity).to(.2,{opacity:255})),w=this.panelAnimationController.showUI();return[4,Promise.all([n,w])];case 2:k.sent(),this.content.enter();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"transitionOut",value:(I=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:null===(n=this.content)||void 0===n||n.softAbort(),this.content.unlistenUIEvents();return[4,D(M(f.prototype),"transitionOut",this).call(this)];case 1:w.sent();return[4,this.panelAnimationController.hideUI()];case 2:w.sent();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"unmount",value:function(){var n;null===(n=this.content)||void 0===n||n.cleanup(),D(M(f.prototype),"unmount",this).call(this)}}]),f}(TG)).prototype,"panelAnimationController",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(Fu.prototype,"mount",[Fa],Object.getOwnPropertyDescriptor(Fu.prototype,"mount"),Fu.prototype),n(Fu.prototype,"onMount",[Fo],Object.getOwnPropertyDescriptor(Fu.prototype,"onMount"),Fu.prototype),n(Fu.prototype,"transitionIn",[Fs],Object.getOwnPropertyDescriptor(Fu.prototype,"transitionIn"),Fu.prototype),n(Fu.prototype,"transitionOut",[Fl],Object.getOwnPropertyDescriptor(Fu.prototype,"transitionOut"),Fu.prototype),Fu));ew._RF.pop(),ew._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var FA,FT,FP,FR,FI,FO,FL,FD,FM=eS.ccclass,FN=eS.property;FS=FM("EventBadge"),Fk=FN(eT),FC=FN(e3),FS((F_=n((FE=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"label",F_,_(n)),n}return T(s,[{key:"text",get:function(){return this.label.string},set:function(n){this.label.string=n}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),s}(eL)).prototype,"label",[Fk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(FE.prototype,"text",[FC],Object.getOwnPropertyDescriptor(FE.prototype,"text"),FE.prototype),FE));ew._RF.pop(),ew._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var Fz,FB,FF,Fx,FU,FG,FH,FV,Fq,FW,FK,Fj,FY,FX,FZ,FJ,FQ,F$,F0,F1,F2,F4,F3,F5,F6,F8,F9,F7,xe,xt,xn,xi,xr,xa,xo,xs,xl,xu,xh,xp,xd,xy,xf,xv,xg,xm,xb,xw=eS.ccclass,xS=eS.property;FA=xw("EventProgressBar"),FT=xS(ak),FP=xS(eT),FR=xS(e3),FI=xS({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),FA((FL=n((FO=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"progressBar",FL,_(n)),E(n,"progressLabel",FD,_(n)),n}return T(s,[{key:"text",get:function(){return this.progressLabel.string},set:function(n){this.progressLabel.string=n}},{key:"progress",get:function(){return this.progressBar.progress},set:function(n){this.progressBar.progress=n}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),s}(eL)).prototype,"progressBar",[FT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FD=n(FO.prototype,"progressLabel",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(FO.prototype,"text",[FR],Object.getOwnPropertyDescriptor(FO.prototype,"text"),FO.prototype),n(FO.prototype,"progress",[FI],Object.getOwnPropertyDescriptor(FO.prototype,"progress"),FO.prototype),FO));ew._RF.pop(),ew._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var xk,xC,xE,x_,xA,xT=eS.ccclass,xP=eS.property,xR=eS.executeInEditMode,xI=globalThis.game.analytics,xO=GameCore.Plugins.Analytics.Events;Fz=xT("NavButton"),FB=xP(eW),FF=xP({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),Fx=xP({type:eM,group:{name:"Animation"}}),FU=xP({type:eM,group:{name:"Animation"}}),FG=xP({type:eM,group:{name:"Animation"}}),FH=xP({type:eM,group:{name:"Animation"}}),FV=xP({type:eM,group:{name:"Animation"}}),Fq=xP({group:{name:"Animation"}}),FW=xP({type:eM,group:{name:"Animation"}}),FK=xP({type:eM,group:{name:"Animation"}}),Fj=xP({group:{name:"Animation"}}),FY=xP({type:eM,group:{name:"Animation"}}),FX=xP({type:eM,group:{name:"Animation"}}),FZ=xP({type:eM,group:{name:"Animation"}}),FJ=xP({type:eM,group:{name:"Animation"}}),FQ=xP({type:eM,group:{name:"Animation"}}),F$=xP({type:e_}),F0=xP(ek),F1=xP(eH),F2=xP({type:e_}),F4=xP({type:eU(nS)}),F3=xP(L$),Fz(F5=xR((F8=n((F6=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"wip",F8,_(n)),E(n,"isSelectedInEditor",F9,_(n)),E(n,"animationDuration",F7,_(n)),E(n,"selectedSpacing",xe,_(n)),E(n,"deselectedSpacing",xt,_(n)),E(n,"selectedIconY",xn,_(n)),E(n,"selectedIconX",xi,_(n)),E(n,"selectedIconScale",xr,_(n)),E(n,"deselectedIconY",xa,_(n)),E(n,"deselectedIconX",xo,_(n)),E(n,"deselectedIconScale",xs,_(n)),E(n,"initTextY",xl,_(n)),E(n,"selectedTextY",xu,_(n)),E(n,"selectedTextX",xh,_(n)),E(n,"deselectedTextY",xp,_(n)),E(n,"deselectedTextX",xd,_(n)),E(n,"spacer",xy,_(n)),E(n,"icon",xf,_(n)),E(n,"text",xv,_(n)),E(n,"uiTransform",xg,_(n)),E(n,"screenType",xm,_(n)),E(n,"navManager",xb,_(n)),n.isSelected=!1,n.onMouseEnter=function(w){n.isSelected||n.playHoverOnAnimation()},n.onMouseLeave=function(w){n.isSelected||n.playHoverOffAnimation()},n}return T(c,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(ek.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(ek.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(ek.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(ek.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.initTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var n,w;this.isSelected||(H.playSound(nI.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),xI.event(xO.BUTTON_CLICK,{button_name:null!==(n=null===(w=this.node.parent)||void 0===w?void 0:w.name)&&void 0!==n?n:this.node.name,screen_name:V.getCurrentPage()}))}},{key:"select",value:(L=N(function(){var n;var w=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:n=!(w.length>0&&void 0!==w[0])||w[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0;if(!n)return[3,2];return[4,z.runTweenAsync(this.playSelectAnimation())];case 1:k.sent();return[3,3];case 2:this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255;k.label=3;case 3:return[2]}})}),function(){return L.apply(this,arguments)})},{key:"deselect",value:(I=N(function(){var n,w;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:n=!(k.length>0&&void 0!==k[0])||k[0],w=k.length>1&&void 0!==k[1]&&k[1];if(!this.isSelected&&!w)throw new Error("NavButton: Already deselected");this.isSelected=!1;if(!n)return[3,2];return[4,z.runTweenAsync(this.deselectAnimation())];case 1:C.sent();return[3,3];case 2:this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0;C.label=3;case 3:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var n=new eQ(this.selectedIconX,this.selectedIconY,0),w=new eQ(this.deselectedIconX,this.deselectedIconY,0),k=this.node.scale.clone();this.node.scale=this.selectedIconScale;var C=this.uiTransform.convertToWorldSpaceAR(n),E=this.uiTransform.convertToWorldSpaceAR(w);return this.node.scale=k,E.x-C.x}},{key:"playHoverOnAnimation",value:function(){var n=ez(this.icon);return n.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),z.runTweenAsync(n)}},{key:"playHoverOffAnimation",value:function(){var n=ez(this.icon);return n.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),z.runTweenAsync(n)}},{key:"playSelectAnimation",value:function(){var n=this;return ez(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(w,k){if(void 0!==k){var C=eG.quintInOut(k),E=eG.backOut(k),_=eG.linear(k),T=k<.5?2*k:1,I=n.deselectedIconY+(n.selectedIconY-n.deselectedIconY)*E,L=n.deselectedIconX+(n.selectedIconX-n.deselectedIconX)*_;n.icon.setPosition(L,I,0);var D=n.deselectedIconScale.clone().lerp(n.selectedIconScale,C);n.icon.setScale(D.x,D.y,n.icon.scale.z);var M=255*T,N=n.deselectedTextY+(n.selectedTextY-n.deselectedTextY)*_,z=n.deselectedTextX+(n.selectedTextX-n.deselectedTextX)*_;n.text.opacity=M,n.text.node.setPosition(z,N,0)}}})}},{key:"deselectAnimation",value:function(){var n=this;return ez(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(w,k){if(void 0!==k){var C=ts(n.selectedIconY,n.deselectedIconY,k),E=ts(n.selectedIconX,n.deselectedIconX,k);n.icon.setPosition(E,C,0);var _=ts(255,0,k<.5?2*k:1);n.text.opacity=_;var T=ts(n.selectedTextY,n.deselectedTextY,k),I=ts(n.selectedTextX,n.deselectedTextX,k);n.text.node.setPosition(I,T,0);var L=n.selectedIconScale.clone().lerp(n.deselectedIconScale,eG.quintInOut(k));n.icon.setScale(L.x,L.y,n.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(e_),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}}]),c}(eL)).prototype,"wip",[FB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),F9=n(F6.prototype,"isSelectedInEditor",[FF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),F7=n(F6.prototype,"animationDuration",[Fx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),xe=n(F6.prototype,"selectedSpacing",[FU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),xt=n(F6.prototype,"deselectedSpacing",[FG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),xn=n(F6.prototype,"selectedIconY",[FH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),xi=n(F6.prototype,"selectedIconX",[FV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xr=n(F6.prototype,"selectedIconScale",[Fq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eQ(1,1,1)}}),xa=n(F6.prototype,"deselectedIconY",[FW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xo=n(F6.prototype,"deselectedIconX",[FK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xs=n(F6.prototype,"deselectedIconScale",[Fj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eQ(.8,.8,1)}}),xl=n(F6.prototype,"initTextY",[FY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -100}}),xu=n(F6.prototype,"selectedTextY",[FX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -10}}),xh=n(F6.prototype,"selectedTextX",[FZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xp=n(F6.prototype,"deselectedTextY",[FJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xd=n(F6.prototype,"deselectedTextX",[FQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xy=n(F6.prototype,"spacer",[F$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xf=n(F6.prototype,"icon",[F0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xv=n(F6.prototype,"text",[F1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xg=n(F6.prototype,"uiTransform",[F2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xm=n(F6.prototype,"screenType",[F4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xb=n(F6.prototype,"navManager",[F3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F5=F6))||F5);ew._RF.pop(),ew._RF.push({},"091aai5+ANDeZfFN8JFkbyi","TournamentButton",void 0);var xL,xD,xM,xN,xz,xB,xF=eS.ccclass,xx=eS.property,xU=globalThis.game.leaderboard;xk=xF("TournamentButton"),xC=xx(ek),xE=B.onlyRunInLifeCycleAsync,xk((xA=n((x_=function(n){w(d,n);var I,D,M=k(d);function d(){var n;C(this,d);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=M.call.apply(M,[this].concat(k)),E(n,"hotIcon",xA,_(n)),n}return T(d,[{key:"onLoad",value:(D=N(function(){var n,w,k,C,E,_,T,I,D,M;return _ts_generator(this,function(N){switch(N.label){case 0:N.trys.push([0,11,,12]);return[4,en.requestTournamentDataAsync()];case 1:w=N.sent(),k=L(w);N.label=2;case 2:N.trys.push([2,8,9,10]);k.s();N.label=3;case 3:if(!!(n=k.n()).done)return[3,7];C=n.value.payload,E=C.leaderboardId,_=C.playerId;if(!(E&&"global"===_))return[3,6];T=xU.getLeaderboardName(E);I=T;if(!I)return[3,5];return[4,xU.requestLeaderboardAsync(T,0)];case 4:I=(N.sent(),this.checkAndShowHotIcon(T));N.label=5;case 5:if(I)return[3,7];N.label=6;case 6:return[3,3];case 7:return[3,10];case 8:D=N.sent();k.e(D);return[3,10];case 9:k.f();return[7];case 10:return[3,12];case 11:M=N.sent();console.info("Error in TournamentButton",M);return[3,12];case 12:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"checkAndShowHotIcon",value:function(n){if(!this.node.activeInHierarchy)return!1;var w=xU.getLeaderboard(n);return!!w&&!(w.amountPlayer<30)&&(this.showHotIcon(),!0)}},{key:"showHotIcon",value:(I=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:this.hotIcon.active=!0,this.hotIcon.scale=eQ.ZERO;n=ez(this.hotIcon).to(.5,{scale:eQ.ONE},{easing:"backOut"});return[4,z.runTweenAsync(n)];case 1:k.sent();w=ez(this.hotIcon).delay(1).to(.3,{scale:new eQ(1.1,1.1)},{easing:"backIn"}).to(.3,{scale:eQ.ONE},{easing:"backOut"});ez(this.hotIcon).repeatForever(w).start();return[2]}})}),function(){return I.apply(this,arguments)})}]),d}(eL)).prototype,"hotIcon",[xC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(x_.prototype,"showHotIcon",[xE],Object.getOwnPropertyDescriptor(x_.prototype,"showHotIcon"),x_.prototype),x_));ew._RF.pop(),ew._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var xG,xH,xV,xq,xW,xK,xj=eS.ccclass,xY=eS.property,xX=eS.disallowMultiple,xZ=globalThis.game.player,xJ=W.Layout,xQ=GameCore.Match.Modes,x$=[nI.COMBO_1,nI.COMBO_2,nI.COMBO_3,nI.COMBO_4,nI.COMBO_5,nI.COMBO_6,nI.COMBO_7,nI.COMBO_8,nI.COMBO_9,nI.COMBO_10,nI.COMBO_11,nI.COMBO_12,nI.COMBO_13,nI.TILE_MATCH,nI.BOMB_DEFUSE,nI.BOMB_EXPLODE_1,nI.BOMB_EXPLODE_2,nI.TILE_SELECT,nI.THUNDERBOLT,nI.SHUFFLE_ITEM,nI.LEVEL_START,nI.LEVEL_COMPLETE,nI.LEVEL_FAIL];xL=xj("GameScene"),xD=B.required,xM=xY(_y),xL(xN=xX((xB=n((xz=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"coinManager",xB,_(n)),n.handleGameExit=function(){el.switchScene(ec.DASHBOARD_SCENE)},n.handleShowResults=function(){el.switchScene(ec.CHALLENGE_RESULT_SCENE)},n.handleGameMaskWhenLayoutChanged=function(n){var w=e8("Canvas/Game/GameObjects");if(w){var k=w.getComponent(tS);k&&(k.enabled=n===xJ.Landscape)}},n}return T(u,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onLoad",value:function(){this.coinManager.init()}},{key:"validateRequiredComponents",value:function(){B.validateRequiredProperties(this,u)}},{key:"listenGameEvents",value:function(){eY.on(q.ORIENTATION_CHANGED,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(i7.GAME_EXIT,this.handleGameExit),this.node.scene.on(i7.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}},{key:"start",value:function(){xZ.getPlayerSetting("music")&&this.updateMusic(),this.preloadSounds(),this.preloadTileAnimations(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadTileAnimations",value:function(){return l6.preloadTileAnimations()}},{key:"preloadSounds",value:function(){for(var n=0,w=x$;n<w.length;n++){var k=w[n];F.loadAudioClipAsync(k)}}},{key:"preloadScenes",value:function(){el.preloadDashboardScene()}},{key:"updateMusic",value:(I=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=s2.getMatchMode()===xQ.TOURNAMENT,w=n?nI.TOURNAMENT_MUSIC:nI.BG_MUSIC;k=H.getCurrentMusic()!==w;if(!k)return[3,3];return[4,H.setVolumeMusic(0,!0)];case 1:C.sent();return[4,z.waitTweenAsync(1)];case 2:k=C.sent();C.label=3;case 3:H.playMusic(w,n),H.setVolumeMusic(n?.4:.3,!0);return[2]}})}),function(){return I.apply(this,arguments)})}]),u}(eL)).prototype,"coinManager",[xD,xM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xN=xz))||xN);ew._RF.pop(),ew._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var x0,x1,x2,x4,x3,x5,x6=eS.ccclass,x8=eS.property;xG=x6("ComboEffect"),xH=x8(eH),xV=x8(e$),xG((xW=n((xq=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"circleOpacity",xW,_(n)),E(n,"particle",xK,_(n)),n}return T(s,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(i7.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(n){n>1&&(this.circleOpacity.node.scale=eQ.ZERO,this.circleOpacity.opacity=60,this.particle.resetSystem(),ez(this.circleOpacity.node).to(.2,{scale:new eQ(1.3,1.3,1.3)},{easing:"quadOut"}).start(),ez(this.circleOpacity).delay(.3).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),s}(eL)).prototype,"circleOpacity",[xH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xK=n(xq.prototype,"particle",[xV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xq));ew._RF.pop(),ew._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var x9,x7,Ue,Ut,Un,Ui,Ur,Ua,Uo=eS.ccclass,Us=eS.property;x0=Uo("ComboLabel"),x1=Us(eT),x2=Us(ek),x0((x3=n((x4=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"comboNumber",x3,_(n)),E(n,"comboContainer",x5,_(n)),n}return T(s,[{key:"onLoad",value:function(){this.opacity=this.getComponent(eH),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(i7.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(n){0===n?this.opacity.opacity=0:n>1?(this.opacity.opacity=255,this.comboNumber.string="".concat(n),ez(this.comboContainer).to(.1,{scale:new eQ(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:eQ.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),s}(eL)).prototype,"comboNumber",[x1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x5=n(x4.prototype,"comboContainer",[x2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x4));ew._RF.pop(),ew._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var Ul,Uu,Uh,Up,Ud,Uy,Uf,Uv,Ug,Um,Ub,Uw,US,Uk=eS.ccclass,UC=eS.property,UE=W.Layout,U_=["good","great","excellent"];x9=Uk("ComboPopup"),x7=B.required(),Ue=UC(j),Ut=B.required(),Un=UC(te),x9((Ur=n((Ui=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"spriteLocalizer",Ur,_(n)),E(n,"animation",Ua,_(n)),n}return T(s,[{key:"__preload",value:function(){this.widget=this.getComponent(eN),B.validateRequiredProperties(this)}},{key:"onLoad",value:function(){eY.on(q.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(s7.getCurrentLayout())}},{key:"onDestroy",value:function(){eY.off(q.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"start",value:function(){this.node.scene.on(i7.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(n){if(!(n<2))for(var w=U_.length-1;w>=0;w--){var k=U_[w];if(n>=w+2){this.spriteLocalizer.key=k,this.animation.play();break}}}},{key:"handleOrientationChanged",value:function(n){n===UE.Portrait?this.widget.left=20:n===UE.Landscape&&(this.widget.left=800)}}]),s}(eL)).prototype,"spriteLocalizer",[x7,Ue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ua=n(Ui.prototype,"animation",[Ut,Un],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ui));ew._RF.pop(),ew._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var UA,UT,UP,UR,UI,UO,UL,UD,UM,UN,Uz,UB,UF,Ux,UU,UG,UH,UV,Uq,UW,UK,Uj,UY,UX=eS.ccclass,UZ=eS.property,UJ=(Ul=UX("PlayerScore"),Uu=UZ(ek),Uh=UZ(eT),Up=UZ(eH),Ud=UZ(eH),Uy=UZ(ex),Ul((Ug=n((Uv=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"crown",Ug,_(n)),E(n,"playerScore",Um,_(n)),E(n,"playerScoreUiOpacity",Ub,_(n)),E(n,"waitingUiOpacity",Uw,_(n)),E(n,"avatar",US,_(n)),n}return T(u,[{key:"showCrown",value:function(n){this.crown.active=n}},{key:"setPlayerScore",value:function(n){this.playerScore.string=n.toString()}},{key:"playWaitingAnimation",value:function(){this.waitingUiOpacity.node.active=!0,this.playerScoreUiOpacity.node.active=!1,this.waitingUiOpacity.opacity=130,this.playerScoreUiOpacity.opacity=0;var n=ez(this.waitingUiOpacity).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=ez(this.waitingUiOpacity).repeatForever(n).start()}},{key:"stopWaitingAnimation",value:function(){this.waitingAnimation&&this.waitingAnimation.stop(),this.waitingUiOpacity.opacity=0,this.playerScoreUiOpacity.opacity=255,this.waitingUiOpacity.node.active=!1,this.playerScoreUiOpacity.node.active=!0}},{key:"loadPhoto",value:(I=N(function(n,w){var k,C;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,wT.getPlayerAvatar(n,w,128)];case 1:k=E.sent();if(!k)throw new Error("Failed to create sprite frame");k.packable=!0,this.avatar.spriteFrame=k;return[3,3];case 2:C=E.sent();return[2,void console.error(C)];case 3:return[2]}})}),function(n,w){return I.apply(this,arguments)})}]),u}(eL)).prototype,"crown",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Um=n(Uv.prototype,"playerScore",[Uh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ub=n(Uv.prototype,"playerScoreUiOpacity",[Up],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uw=n(Uv.prototype,"waitingUiOpacity",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),US=n(Uv.prototype,"avatar",[Uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uf=Uv))||Uf);ew._RF.pop(),ew._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var UQ,U$,U0,U1,U2,U4=eS.ccclass,U3=eS.disallowMultiple,U5=eS.property,U6=globalThis.game,U8=U6.match,U9=U6.player,U7=U6.monitorError,Ge=GameCore.Utils.Object;UA=U4("ChallengeResultScene"),UT=U5(j),UP=U5(j),UR=U5(j),UI=U5({type:UJ,group:"Score"}),UO=U5({type:UJ,group:"Score"}),UL=U5(yq),UD=U5(mU),UM=U5(te),UN=B.onlyRunInLifeCycle,Uz=B.onlyRunInLifeCycle,UB=B.onlyRunInLifeCycle,UF=B.onlyRunInLifeCycle,UA(Ux=U3((UG=n((UU=function(n){w(c,n);var I,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"drawLocalizer",UG,_(n)),E(n,"winLocalizer",UH,_(n)),E(n,"loseLocalizer",UV,_(n)),E(n,"playerScore",Uq,_(n)),E(n,"opponentScore",UW,_(n)),E(n,"paperConfetti",UK,_(n)),E(n,"levelManager",Uj,_(n)),E(n,"headerAnimation",UY,_(n)),n.goToDashboardScene=function(){el.switchScene(ec.DASHBOARD_SCENE)},n}return T(c,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.node.scene.on(q.RESULT_SCENE_HOME,this.goToDashboardScene),this.node.scene.on(q.RESULT_SCENE_REPLAY,this.handleTryAgainClicked,this)}},{key:"start",value:function(){this.scheduleOnce(this.preloadScenes,3);try{var n,w,k=U8.getMatchState(),C=k.customData,E=C.playerId,_=C.opponentId;if(null===E||null===_)throw new Error("ResultScene: playerId is ".concat(E," and opponentId is ").concat(_,". Expected to not be null."));var T=U9.getPlayer().photo,I=null!==(n=k.profiles[E])&&void 0!==n?n:{},L=I.score,D=void 0===L?0:L,M=I.finished,N=void 0!==M&&M,z=null!==(w=k.profiles[_])&&void 0!==w?w:{},B=z.photo,F=void 0===B?"":B,x=z.score,U=void 0===x?0:x,G=z.finished,H=void 0!==G&&G,V=N&&H,q=V&&D>U,W=V&&U>D;this.playerScore.loadPhoto(T,E),this.opponentScore.loadPhoto(F,_),this.playerScore.setPlayerScore(D),this.opponentScore.setPlayerScore(U),this.playerScore.showCrown(q),this.opponentScore.showCrown(W),N&&H?D===U?this.playStatusAnimation("Draw"):q?this.playStatusAnimation("Win"):W&&this.playStatusAnimation("Lose"):(N||this.playerScore.playWaitingAnimation(),H||this.opponentScore.playWaitingAnimation(),this.playWinAnimation())}catch(n){console.warn("ResultScene: Error on load",n),this.goToDashboardScene()}}},{key:"preloadScenes",value:function(){el.preloadDashboardScene()}},{key:"handleTryAgainClicked",value:(I=N(function(){var n,w,k,C,E,_,T,I,L,D,M,N,z,B;return _ts_generator(this,function(F){switch(F.label){case 0:w=(null!==(n=U9.getGameData())&&void 0!==n?n:{}).level,k=void 0===w?1:w;k=Math.max(1,k);return[4,this.levelManager.loadLevelData(k)];case 1:C=F.sent();F.label=2;case 2:F.trys.push([2,4,,5]);if(!C)throw new Error("Level data is not found");E=U8.getMatchState().customData.opponentId;if(!E)throw new Error("Opponent id is not found");ei.showLoadingScreen();_=uM.generateFen(C),T=C.mode,I=void 0===T?"":T,L=C.rules,D=void 0===L?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:L,M=C.time,N=void 0===M?0:M,z=C.level;return[4,U8.challenge.friend.processAsync({playerId:U9.getPlayerId(),opponentId:E,extraData:{level:z,fen:_,gravity:I,rules:D,time:N}})];case 3:F.sent(),ei.closeLoadingScreen(),this.goToGameScene();return[3,5];case 4:B=F.sent();if(Ge.hasOwn(B,"code")&&"USER_INPUT"===B.code)return[2,void ei.closeLoadingScreen()];console.warn("ReplayChallengeFriend",B),ei.closeLoadingScreen(),ei.showNotificationScreenWithLocalizedKey("error.challengeFail",2),null==U7||U7.sendException(_instanceof(B,Error)?B:new Error("ReplayChallengeFriend"+JSON.stringify(B))),this.scheduleOnce(this.goToDashboardScene,2);return[3,5];case 5:return[2]}})}),function(){return I.apply(this,arguments)})},{key:"handleHomeClicked",value:function(){this.goToDashboardScene()}},{key:"goToGameScene",value:function(){el.switchScene(ec.GAME_SCENE)}},{key:"playWaitingAnimation",value:function(){this.triggerConfettiAnimation(),H.playSound(nI.LEVEL_COMPLETE)}},{key:"playStatusAnimation",value:function(n){var w=this;"Win"===n&&this.triggerConfettiAnimation();var k=this.getSpriteLocalizer(n);k.node.active=!0,k.waitLocalized().then(function(){switch(n){case"Draw":w.playDrawAnimation();break;case"Win":w.playWinAnimation();break;case"Lose":w.playLoseAnimation()}})}},{key:"getSpriteLocalizer",value:function(n){switch(n){case"Draw":return this.drawLocalizer;case"Win":return this.winLocalizer;case"Lose":return this.loseLocalizer}}},{key:"playDrawAnimation",value:function(){this.headerAnimation.play("RibbonDraw"),H.playSound(nI.LEVEL_FAIL)}},{key:"playWinAnimation",value:function(){this.headerAnimation.play("RibbonWin"),H.playSound(nI.LEVEL_COMPLETE)}},{key:"playLoseAnimation",value:function(){this.headerAnimation.play("RibbonLose"),H.playSound(nI.LEVEL_FAIL)}},{key:"triggerConfettiAnimation",value:function(){var n=this;this.scheduleOnce(function(){var w,k=L(n.paperConfetti);try{for(k.s();!(w=k.n()).done;)w.value.play()}catch(n){k.e(n)}finally{k.f()}},.2)}}]),c}(eL)).prototype,"drawLocalizer",[UT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UH=n(UU.prototype,"winLocalizer",[UP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UV=n(UU.prototype,"loseLocalizer",[UR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uq=n(UU.prototype,"playerScore",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UW=n(UU.prototype,"opponentScore",[UO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UK=n(UU.prototype,"paperConfetti",[UL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Uj=n(UU.prototype,"levelManager",[UD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UY=n(UU.prototype,"headerAnimation",[UM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(UU.prototype,"playDrawAnimation",[UN],Object.getOwnPropertyDescriptor(UU.prototype,"playDrawAnimation"),UU.prototype),n(UU.prototype,"playWinAnimation",[Uz],Object.getOwnPropertyDescriptor(UU.prototype,"playWinAnimation"),UU.prototype),n(UU.prototype,"playLoseAnimation",[UB],Object.getOwnPropertyDescriptor(UU.prototype,"playLoseAnimation"),UU.prototype),n(UU.prototype,"triggerConfettiAnimation",[UF],Object.getOwnPropertyDescriptor(UU.prototype,"triggerConfettiAnimation"),UU.prototype),Ux=UU))||Ux);ew._RF.pop(),ew._RF.push({},"c0a5fPghzxBxpXiudxt+Qd4","TestParticleSystemScene",void 0);var Gt,Gn=eS.ccclass,Gi=eS.property;UQ=Gn("TestParticleSystemScene"),U$=Gi(ek),U0=B.required(),UQ((U2=n((U1=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"stars",U2,_(n)),n}return T(s,[{key:"__preload",value:function(){el.markIsTestScene(ec.TEST_PARTICLE_SYSTEM_SCENE)}},{key:"onLoad",value:function(){GameSDK.startGameAsync().catch(function(n){console.warn("GameSDK.startGameAsync",n)})}},{key:"start",value:function(){var n=this.stars.getComponent(yq);null==n||n.play()}}]),s}(eL)).prototype,"stars",[U$,U0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U1));ew._RF.pop(),ew._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var Gr,Ga,Go,Gs,Gl,Gu,Gh,Gp,Gd,Gy,Gf,Gv,Gg,Gm,Gb=eS.ccclass,Gw=eS.requireComponent;Gb("BackgroundMask")(Gt=Gw([eH])(Gt=function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"onLoad",value:function(){var n=this.getComponent(eH);n?(this.opacity=n,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var n,w,k=this.opacity.opacity/255;n=k,(w=document.getElementById("app-mask"))&&(w.style.background="rgb(0 0 0 / ".concat(n,")"))}}]),o}(eL))||Gt);ew._RF.pop(),ew._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var GS,Gk,GC,GE,G_,GA,GT,GP,GR,GI,GO,GL,GD,GM,GN,Gz,GB,GF,Gx,GU,GG,GH,GV,Gq=eS.ccclass,GW=eS.property,GK=eS.disallowMultiple,Gj=eS.requireComponent,GY=GameCore.Events,GX=globalThis.game.event;Gr=Gq("CongratulationScreen"),Ga=Gj(ey),Go=GW(ek),Gs=GW(ek),Gl=GW(eI),Gu=GW(eI),Gh=GW(eI),Gr(Gp=GK(Gp=Ga((Gy=n((Gd=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"congratulation",Gy,_(n)),E(n,"confirmation",Gf,_(n)),E(n,"closeButtonComponent",Gv,_(n)),E(n,"yesButtonComponent",Gg,_(n)),E(n,"noButtonComponent",Gm,_(n)),n.handleOpeningScreen=function(w){if(!n.screen)throw new Error("CongratulationScreen: screen not found");n.validateEventPayload(w)&&(n.closeButtonComponent.interactable=!0,n.yesButtonComponent.interactable=!0,n.noButtonComponent.interactable=!0)},n.handleOpenedScreen=function(w){n.validateEventPayload(w)&&n.open()},n}return T(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.confirmationUIOpacity=this.confirmation.getComponent(eH),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){GX.on(GY.OPENING_SCREEN,this.handleOpeningScreen),GX.on(GY.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){GX.off(GY.OPENING_SCREEN,this.handleOpeningScreen),GX.off(GY.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(n){return n.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,ei.closeScreen(er.CONGRATULATION_SCREEN)}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,ez(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),ez(this.confirmation).set({scale:new eQ(.8,.8,.8)}).to(.2,{scale:new eQ(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(i7.START_OVER,1)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(i7.GAME_REPLAY,{level:this.screen.data.level})}}]),s}(eL)).prototype,"congratulation",[Go],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gf=n(Gd.prototype,"confirmation",[Gs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gv=n(Gd.prototype,"closeButtonComponent",[Gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gg=n(Gd.prototype,"yesButtonComponent",[Gu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gm=n(Gd.prototype,"noButtonComponent",[Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gp=Gd))||Gp)||Gp);ew._RF.pop(),ew._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var GZ,GJ,GQ,G$,G0,G1,G2,G4,G3,G5,G6,G8,G9,G7,He,Ht,Hn,Hi,Hr,Ha,Ho,Hs=eS.ccclass,Hl=eS.property,Hu=(GS=Hs("DayBlock"),Gk=Hl({type:ex,group:"Background"}),GC=Hl({type:ex,group:"Background"}),GE=Hl({type:e7,group:"Background"}),G_=Hl({type:e7,group:"Background"}),GA=Hl(eT),GT=Hl(j),GP=Hl(eT),GR=Hl(ek),GI=Hl(ek),GO=Hl(ek),GS((GM=n((GD=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"background",GM,_(n)),E(n,"topBackground",GN,_(n)),E(n,"blueBackground",Gz,_(n)),E(n,"blueTopBackground",GB,_(n)),E(n,"dayLabel",GF,_(n)),E(n,"dayLocalizer",Gx,_(n)),E(n,"coinLabel",GU,_(n)),E(n,"rewardItemsNode",GG,_(n)),E(n,"checkNode",GH,_(n)),E(n,"glowNodes",GV,_(n)),n}return T(s,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eH),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new eC(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new eC("#3469bf")}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"updateInfo",value:function(n){this.updateBackground(n),this.updateDayLabel(n),this.coinLabel.string=n.value.toString(),this.updateRewardItems(n)}},{key:"updateBackground",value:function(n){if(this.blueTopBackground&&this.blueBackground)switch(n.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(n){this.dayLocalizer.setParams([n.day.toString()]);var w=this.defaultDayLabelOutlineColor;"rewarded"!==n.status&&(w=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=w,this.dayLabel.shadowColor=w}},{key:"updateRewardItems",value:function(n){switch(n.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(n){this.glowNodes&&this.glowNodes.forEach(function(w){w.active=n})}}]),s}(eL)).prototype,"background",[Gk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GN=n(GD.prototype,"topBackground",[GC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gz=n(GD.prototype,"blueBackground",[GE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GB=n(GD.prototype,"blueTopBackground",[G_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GF=n(GD.prototype,"dayLabel",[GA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gx=n(GD.prototype,"dayLocalizer",[GT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GU=n(GD.prototype,"coinLabel",[GP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GG=n(GD.prototype,"rewardItemsNode",[GR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GH=n(GD.prototype,"checkNode",[GI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GV=n(GD.prototype,"glowNodes",[GO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GL=GD))||GL);ew._RF.pop(),ew._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var Hc=eS.ccclass,Hh=eS.property,Hp=eS.requireComponent,Hd=GameCore,Hy=Hd.Events,Hf=Hd.Utils,Hv=Hf.Object,Hg=Hf.Array,Hm=Hd.Configs.DailyRewards,Hb=globalThis.game,Hw=Hb.event,HS=Hb.dailyRewards,Hk=Hb.player,HC=Hb.monitorError;GZ=Hc("DailyRewardsScreen"),GJ=Hp(ey),GQ=B.required(),G$=B.required(),G0=Hh(ek),G1=B.required(),G2=Hh(eI),G4=B.required(),G3=Hh(eI),G5=Hh([Hu]),G6=B.onlyRunInLifeCycleAsync,G8=B.onlyRunInLifeCycle,G9=B.onlyRunInLifeCycleAsync,G7=B.onlyRunInLifeCycle,GZ(He=GJ((Hn=n((Ht=function(n){w(b,n);var D,M,F,U,G,H=k(b);function b(){var n;C(this,b);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=H.call.apply(H,[this].concat(k)),E(n,"screen",Hn,_(n)),n.rewardsData=[],n.debugScreenOpened=!1,n.debugUpdatedRewardsData=!1,E(n,"loadingRing",Hi,_(n)),E(n,"claimButton",Hr,_(n)),E(n,"claimX2Button",Ha,_(n)),E(n,"dailyBlocks",Ho,_(n)),n.handleOpeningScreen=function(w){n.validateEventPayload(w)&&(n.enabled=!0)},n.handleOpenedScreen=function(){var w=N(function(w){return _ts_generator(this,function(k){n.validateEventPayload(w)&&n.open();return[2]})});return function(n){return w.apply(this,arguments)}}(),n}return T(b,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),B.validateRequiredProperties(this),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"listenScreenEvents",value:function(){Hw.on(Hy.OPENING_SCREEN,this.handleOpeningScreen),Hw.on(Hy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Hw.off(Hy.OPENING_SCREEN,this.handleOpeningScreen),Hw.off(Hy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(n){return(null!=n?n:{}).screenName===this.node.name}},{key:"open",value:function(){this.prepareScreen(),this.openAsync()}},{key:"openAsync",value:(G=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.updateRewardsData()];case 1:n.sent();return[4,this.updateScreenToMatchData()];case 2:n.sent();return[2]}})}),function(){return G.apply(this,arguments)})},{key:"updateScreenToMatchData",value:function(){return this.loginDailyRewards(),this.updateDayBlocks(),this.loadingRing.active=!1,this.setInteractableButtons(!0),this.runPopUpAnimation()}},{key:"prepareScreen",value:function(){this.debugScreenOpened=!0,this.loadingRing.active=!0,this.setInteractableButtons(!1),this.node.scene.emit(i7.HIDE_UI),this.resetState()}},{key:"close",value:function(){Hw.emit(Hy.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(i7.SHOW_UI)}},{key:"resetState",value:function(){var n,w=L(this.dailyBlocks);try{for(w.s();!(n=w.n()).done;){var k=n.value;k.uiOpacity.opacity=0,k.node.scale=new eQ(1.2,1.2,1.2)}}catch(n){w.e(n)}finally{w.f()}}},{key:"runPopUpAnimation",value:(U=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:n=this;this.screen.container||console.warn("DailyRewardScreen: screen not found");return[4,Promise.all(this.dailyBlocks.map(function(w,k){return n.runAppearTween(w,.15*k)}))];case 1:w.sent();return[2]}})}),function(){return U.apply(this,arguments)})},{key:"runAppearTween",value:(F=N(function(n,w){var k,C;return _ts_generator(this,function(E){switch(E.label){case 0:k=ez(n.uiOpacity).delay(w).to(.3,{opacity:255},{easing:"quadOut"}),C=ez(n.node).delay(w).to(.3,{scale:eQ.ONE},{easing:"backOut"});return[4,Promise.all([z.runTweenAsync(k),z.runTweenAsync(C)])];case 1:E.sent();return[2]}})}),function(n,w){return F.apply(this,arguments)})},{key:"handleOnClaim",value:function(){this.setInteractableButtons(!1);var n=this.getCurrentRewardData();if(!n)return null==HC||HC.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),ei.showNotificationScreenWithLocalizedKey("error.rewardFail",2),void this.setInteractableButtons(!0);this.claimReward(n)}},{key:"handleOnClaimX2",value:(M=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:this.setInteractableButtons(!1);n=this.getCurrentRewardData();if(!n)return[2,(null==HC||HC.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),ei.showNotificationScreenWithLocalizedKey("error.rewardFail",2),void this.setInteractableButtons(!0))];return[4,ea.showRewardVideoAdAsync({})];case 1:w.sent()?this.claimReward(n,!0):this.setInteractableButtons(!0);return[2]}})}),function(){return M.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return Hg.search(this.rewardsData,function(n){return"ready"===n.status})}},{key:"claimReward",value:function(n,w){var k=arguments.length>1&&void 0!==w&&w,C=n.value*(k?2:1),E=new x;if(this.node.scene.emit(i7.ADD_COINS,{coins:C,collectionAnimation:{animateTextOnly:!1,signal:E}}),n.items){var _=n.items.hint*(k?2:1),T=n.items.thunder*(k?2:1),I=n.items.storm*(k?2:1),L=Hk.getGameData();L?(Hk.setGameData({items:{hint:L.items.hint+_,thunder:L.items.thunder+T,storm:L.items.storm+I,pliers:L.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(D=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,HS.requestDailyRewardsAsync()];case 1:k.sent();for(n=I({},HS.getDailyRewards()),w=0;w<Hm.MaxDays;w++)n[w]=I(I({},n[w]),{},{value:sP[w].value,items:sP[w].items});n&&(this.rewardsData=Hv.vals(n),this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData));return[2]}})}),function(){return D.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){HS.logLoginReward()}},{key:"updateDayBlocks",value:function(){var n=this;this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),null==HC||HC.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach(function(w,k){if(!(k>=n.rewardsData.length)){var C=n.rewardsData[k],E=C.id,_=C.type,T=C.value,I=C.status;w.updateInfo({day:E,type:_,value:T,status:I})}})}},{key:"setInteractableButtons",value:function(n){this.claimButton.interactable=n,this.claimX2Button.interactable=n,this.screen.backgroundMask.getComponent(eI).interactable=n}}]),b}(eL)).prototype,"screen",[GQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hi=n(Ht.prototype,"loadingRing",[G$,G0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hr=n(Ht.prototype,"claimButton",[G1,G2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ha=n(Ht.prototype,"claimX2Button",[G4,G3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ho=n(Ht.prototype,"dailyBlocks",[G5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),n(Ht.prototype,"updateScreenToMatchData",[G6],Object.getOwnPropertyDescriptor(Ht.prototype,"updateScreenToMatchData"),Ht.prototype),n(Ht.prototype,"claimReward",[G8],Object.getOwnPropertyDescriptor(Ht.prototype,"claimReward"),Ht.prototype),n(Ht.prototype,"updateRewardsData",[G9],Object.getOwnPropertyDescriptor(Ht.prototype,"updateRewardsData"),Ht.prototype),n(Ht.prototype,"setInteractableButtons",[G7],Object.getOwnPropertyDescriptor(Ht.prototype,"setInteractableButtons"),Ht.prototype),He=Ht))||He);ew._RF.pop(),ew._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var HE,H_,HA,HT,HP,HR,HI,HO,HL,HD;(0,eS.ccclass)("DayBlockRed")(function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o,[{key:"updateBackground",value:function(n){if(this.blueTopBackground&&this.blueBackground)switch(n.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(n){this.dayLocalizer.setParams([n.day.toString()]);var w=this.defaultDayLabelOutlineColor;"ready"===n.status&&(w=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=w,this.dayLabel.outlineColor=w}}]),o}(Hu));ew._RF.pop(),ew._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var HM,HN,Hz,HB,HF,Hx,HU,HG,HH,HV,Hq,HW,HK,Hj,HY,HX,HZ,HJ,HQ,H$,H0,H1,H2,H4,H3,H5,H6,H8,H9,H7,Ve=eS.ccclass,Vt=eS.property,Vn=eS.requireComponent,Vi=globalThis.game.event,Vr=GameCore.Events;HE=Ve("GetCoinScreen"),H_=Vn(ey),HA=Vt(eT),HT=Vt(eI),HP=Vt(eI),HE(HR=H_((HO=n((HI=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"quantityLabel",HO,_(n)),E(n,"closeButtonComponent",HL,_(n)),E(n,"getNowButtonComponent",HD,_(n)),n.handleOpeningScreen=function(w){console.log("GetCoinScreen.OPENING_SCREEN",w),n.validateEventPayload(w)&&(n.setInteractableButtons(!0),n.updateStatus())},n.handleOpenedScreen=function(w){n.validateEventPayload(w)&&n.open()},n}return T(u,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Vi.on(Vr.OPENING_SCREEN,this.handleOpeningScreen),Vi.on(Vr.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Vi.off(Vr.OPENING_SCREEN,this.handleOpeningScreen),Vi.off(Vr.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(n){return"screenName"in n&&n.screenName===this.node.name&&(this.payload=n,!0)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(i7.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),Vi.emit(Vr.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(i7.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var n=this.getQuantity();n&&this.updateQuantityLabel(n)}},{key:"updateQuantityLabel",value:function(n){this.quantityLabel.string="x".concat(n.toString())}},{key:"getQuantity",value:function(){var n=this.payload.screenData;return n&&"quantity"in n&&n.quantity&&"number"==typeof n.quantity?n.quantity:0}},{key:"handleAddCoin",value:function(){var n=this.getQuantity();this.node.scene.emit(i7.ADD_COINS,{coins:n,collectionAnimation:{animateTextOnly:!1},skipAnimation:!0}),this.close()}},{key:"handleGetNowButtonClicked",value:(I=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:H.stopAllSounds();return[4,ea.showRewardVideoAdAsync({})];case 1:n.sent()&&this.handleAddCoin();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"setInteractableButtons",value:function(n){this.closeButtonComponent.interactable=n,this.getNowButtonComponent.interactable=n,this.screen.backgroundMask.getComponent(eI).interactable=n}}]),u}(eL)).prototype,"quantityLabel",[HA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HL=n(HI.prototype,"closeButtonComponent",[HT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HD=n(HI.prototype,"getNowButtonComponent",[HP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HR=HI))||HR);ew._RF.pop(),ew._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var Va,Vo,Vs,Vl,Vu,Vh,Vp,Vd,Vy=eS.ccclass,Vf=eS.property,Vv=globalThis.game,Vg=Vv.event,Vm=Vv.player,Vb=Vv.analytics,Vw=Vv.language,VS=GameCore,Vk=VS.Events,VC=VS.Utils.Array,VE=VS.Plugins.Analytics.Events,V_=Object.values(Z);HM=Vy("GetItemScreen"),HN=Vf({type:ta,group:"Item"}),Hz=Vf({type:ex,group:"Item"}),HB=Vf({type:e7,group:"Item"}),HF=Vf({type:e7,group:"Item"}),Hx=Vf({type:e7,group:"Item"}),HU=Vf({type:e7,group:"Item"}),HG=Vf({type:eT,group:"Title"}),HH=Vf({type:j,group:"Title"}),HV=Vf({type:eT,group:"Description"}),Hq=Vf({type:j,group:"Description"}),HW=Vf(eT),HK=Vf({type:eI,group:"Buttons"}),Hj=Vf({type:eI,group:"Buttons"}),HY=Vf({type:eI,group:"Buttons"}),HM((HZ=n((HX=function(n){w(p,n);var I,L,D,M=k(p);function p(){var n;C(this,p);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=M.call.apply(M,[this].concat(k)),E(n,"itemFxPrefab",HZ,_(n)),E(n,"itemSprite",HJ,_(n)),E(n,"hintSpriteFrame",HQ,_(n)),E(n,"stormSpriteFrame",H$,_(n)),E(n,"thunderSpriteFrame",H0,_(n)),E(n,"pliersSpriteFrame",H1,_(n)),E(n,"titleLabel",H2,_(n)),E(n,"titleLocalizer",H4,_(n)),E(n,"descriptionLabel",H3,_(n)),E(n,"descriptionLocalizer",H5,_(n)),E(n,"coinLabel",H6,_(n)),E(n,"closeButtonComponent",H8,_(n)),E(n,"buyItemButtonComponent",H9,_(n)),E(n,"getNowButtonComponent",H7,_(n)),n.handleOpeningScreen=function(w){if(!n.screen)throw new Error("GetItemScreen: screen not found");n.validateEventPayload(w)&&n.validateEventPayloadData(w.screenData)&&(n.setInteractableButtons(!0),n.data=w.screenData,n.updateStatus(w.screenData))},n.handleOpenedScreen=function(w){n.validateEventPayload(w)&&n.open()},n}return T(p,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Vg.on(Vk.OPENING_SCREEN,this.handleOpeningScreen),Vg.on(Vk.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Vg.off(Vk.OPENING_SCREEN,this.handleOpeningScreen),Vg.off(Vk.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(n){return(null!=n?n:{}).screenName===this.node.name}},{key:"validateEventPayloadData",value:function(n){return!!n&&!(!("item"in n)||!VC.has(V_,n.item))&&"quantity"in n&&"number"==typeof n.quantity&&!("localizedMessageKey"in n&&void 0!==n.localizedMessageKey&&!Vw.hasTextKey(n.localizedMessageKey))}},{key:"open",value:function(){this.node.scene.emit(i7.GAME_PAUSE)}},{key:"close",value:function(){this.setInteractableButtons(!1),Vg.emit(Vk.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(i7.GAME_RESUME)}},{key:"updateStatus",value:function(n){this.updateItemIcon(n.item),this.updateTitle(n.item),n.localizedMessageKey&&this.updateDescription(n.localizedMessageKey),this.updateButtons(n.item)}},{key:"updateItemIcon",value:function(n){switch(n){case Z.HINT:this.itemSprite.spriteFrame=this.hintSpriteFrame;break;case Z.STORM:this.itemSprite.spriteFrame=this.stormSpriteFrame;break;case Z.THUNDER:this.itemSprite.spriteFrame=this.thunderSpriteFrame;break;case Z.PLIERS:this.itemSprite.spriteFrame=this.pliersSpriteFrame}}},{key:"getItemLocalizedTitleKey",value:function(n){switch(n){case Z.HINT:return"item.hint";case Z.STORM:return"item.storm";case Z.THUNDER:return"item.thunder";case Z.PLIERS:return"item.pliers"}}},{key:"updateTitle",value:function(n){this.titleLocalizer.key=this.getItemLocalizedTitleKey(n)}},{key:"updateDescription",value:function(n){this.descriptionLocalizer.key=n}},{key:"updateButtons",value:function(n){var w=this.canBuyItem(n);this.buyItemButtonComponent.node.active=w,this.getNowButtonComponent.node.active=!w,w&&(this.coinLabel.string="".concat(3*s_[n]))}},{key:"canBuyItem",value:function(n){var w=Vm.getGameData();return!!w&&w.coins>=3*s_[n]}},{key:"handleAddItem",value:(D=N(function(){return _ts_generator(this,function(n){this.data.item&&(Vb.event(VE.EARN_ITEM,{item_name:this.data.item,value:3}),this.node.scene.emit(i7.ADD_ITEM,{animate:{startWorldPosition:this.itemSprite.node.worldPosition.clone()},item:this.data.item,quantity:3}));return[2]})}),function(){return D.apply(this,arguments)})},{key:"handleGetNowButtonClicked",value:(L=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:this.stopAllSounds();return[4,ea.showRewardVideoAdAsync({})];case 1:n.sent()&&(this.handleAddItem(),this.close());return[2]}})}),function(){return L.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(I=N(function(){return _ts_generator(this,function(n){this.node.scene.emit(i7.REMOVE_COINS,{coins:3*s_[this.data.item],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close();return[2]})}),function(){return I.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var n;null===(n=e8("Sound"))||void 0===n||null===(n=n.getComponent(ef))||void 0===n||n.stopAll()}},{key:"setInteractableButtons",value:function(n){this.closeButtonComponent.interactable=n,this.buyItemButtonComponent.interactable=n,this.getNowButtonComponent.interactable=n,this.screen.backgroundMask.getComponent(eI).interactable=n}}]),p}(eL)).prototype,"itemFxPrefab",[HN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HJ=n(HX.prototype,"itemSprite",[Hz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HQ=n(HX.prototype,"hintSpriteFrame",[HB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H$=n(HX.prototype,"stormSpriteFrame",[HF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H0=n(HX.prototype,"thunderSpriteFrame",[Hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H1=n(HX.prototype,"pliersSpriteFrame",[HU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H2=n(HX.prototype,"titleLabel",[HG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H4=n(HX.prototype,"titleLocalizer",[HH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H3=n(HX.prototype,"descriptionLabel",[HV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H5=n(HX.prototype,"descriptionLocalizer",[Hq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H6=n(HX.prototype,"coinLabel",[HW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H8=n(HX.prototype,"closeButtonComponent",[HK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H9=n(HX.prototype,"buyItemButtonComponent",[Hj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H7=n(HX.prototype,"getNowButtonComponent",[HY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HX));ew._RF.pop(),ew._RF.push({},"4d6710xA7hAk65cGA4Dgdrc","GetRewardsScreen",void 0);var VA,VT=eS.ccclass,VP=eS.requireComponent,VR=eS.property,VI=GameCore.Events,VO=globalThis.game.event;Va=VT("GetRewardsScreen"),Vo=VP(ey),Vs=VR(j),Vl=VR(eI),Va(Vu=Vo((Vp=n((Vh=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"adStartingLocalizer",Vp,_(n)),E(n,"skipButton",Vd,_(n)),n.handleOpeningScreen=function(w){n.validateEventPayload(w)&&n.setInteractableButtons(!0)},n.handleOpenedScreen=function(w){n.validateEventPayload(w)&&n.open()},n}return T(u,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){VO.on(VI.OPENING_SCREEN,this.handleOpeningScreen),VO.on(VI.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){VO.off(VI.OPENING_SCREEN,this.handleOpeningScreen),VO.off(VI.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(n){return(null!=n?n:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.runAdStartingAnimation()}},{key:"close",value:function(n){this.setInteractableButtons(!1),VO.emit(VI.CLOSE_SCREEN,{screenName:this.node.name,screenData:{getRewardsSuccess:n}})}},{key:"runAdStartingAnimation",value:function(){var n=this,w=5;this.adStartingLocalizer.setParams([w.toString()]);this.schedule(function(){w<=0?n.stopAdStartingAnimation():(w--,n.adStartingLocalizer.setParams([w.toString()]))},1,6)}},{key:"stopAdStartingAnimation",value:(I=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:this.unscheduleAllCallbacks();return[4,ea.showRewardedInterstitialAdAsync({})];case 1:n=w.sent();this.close(n);return[2]}})}),function(){return I.apply(this,arguments)})},{key:"handleClickedSkip",value:function(){this.unscheduleAllCallbacks(),this.close(!1)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(n){this.skipButton.interactable=n}}]),u}(eL)).prototype,"adStartingLocalizer",[Vs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=n(Vh.prototype,"skipButton",[Vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vu=Vh))||Vu);ew._RF.pop(),ew._RF.push({},"bfe1eXch0ZMKIz1ofLKc2Iv","HardLevelScreen",void 0);var VL,VD,VM,VN,Vz,VB,VF,Vx,VU,VG,VH,VV,Vq,VW=eS.ccclass,VK=eS.requireComponent,Vj=GameCore.Events,VY=globalThis.game.event;VW("HardLevelScreen")(VA=VK(ey)(VA=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).handleOpeningScreen=function(w){n.validateEventPayload(w)},n.handleOpenedScreen=function(w){n.validateEventPayload(w)&&n.open()},n}return T(o,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){VY.on(Vj.OPENING_SCREEN,this.handleOpeningScreen),VY.on(Vj.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){VY.off(Vj.OPENING_SCREEN,this.handleOpeningScreen),VY.off(Vj.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(n){return(null!=n?n:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation()}},{key:"close",value:function(){ei.closeScreen(ev[this.node.name])}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}}]),o}(eL))||VA);ew._RF.pop(),ew._RF.push({},"2db0dg4dI9GCKCdFOMrBFsQ","GetRewardsEffect",void 0);var VX,VZ,VJ,VQ,V$,V0,V1,V2,V4,V3,V5,V6,V8,V9,V7,qe,qt,qn,qi,qr,qa,qo,qs,ql,qu,qh,qp,qd,qy,qf,qv,qg,qm,qb,qw,qS=eS.ccclass,qk=eS.property,qC=(VL=qS("GetRewardsEffect"),VD=qk(e7),VM=qk(e7),VN=qk(e7),Vz=qk(e7),VB=qk(yq),VL((VU=n((Vx=function(n){w(c,n);var I,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"hint",VU,_(n)),E(n,"thunder",VG,_(n)),E(n,"storm",VH,_(n)),E(n,"pliers",VV,_(n)),E(n,"particles",Vq,_(n)),n}return T(c,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"playAnimation",value:(I=N(function(n,w){var k,C;return _ts_generator(this,function(E){switch(E.label){case 0:k=this,C=-30*(n.length-1)/2+90;return[4,Promise.all(n.map(function(n,E){var _=k.createSprite(n),T=C+30*E,I=.15*E;_.node.position=new eQ(300*Math.cos(Math.PI/180*T),300*Math.sin(Math.PI/180*T),0);var L=ez(_.node);return L.delay(I),L.to(.6,{position:eQ.ZERO,scale:new eQ(.7,.7,.7)},{easing:"backIn"}),z.runTweenAsync(L).then(function(){w(),H.playSound(nI.COLLECT_STARS),k.playExplodeEffect(),_.node.destroy()})}))];case 1:E.sent();return[2]}})}),function(n,w){return I.apply(this,arguments)})},{key:"playExplodeEffect",value:function(){var n,w=L(this.particles);try{for(w.s();!(n=w.n()).done;){var k=n.value;k.stop(),k.play()}}catch(n){w.e(n)}finally{w.f()}}},{key:"createSprite",value:function(n){var w=this.getSpriteFrame(n),k=(new ek).addComponent(ex);return k.spriteFrame=w,k.node.parent=this.node,k.node.scale=new eQ(1.5,1.5,1.5),k}},{key:"getSpriteFrame",value:function(n){switch(n){case"hint":return this.hint;case"thunder":return this.thunder;case"storm":return this.storm;case"pliers":return this.pliers;default:return null}}}]),c}(eL)).prototype,"hint",[VD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VG=n(Vx.prototype,"thunder",[VM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VH=n(Vx.prototype,"storm",[VN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VV=n(Vx.prototype,"pliers",[Vz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vq=n(Vx.prototype,"particles",[VB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),VF=Vx))||VF);ew._RF.pop(),ew._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var qE,q_=eS.ccclass,qA=eS.property,qT=eS.requireComponent,qP=GameCore,qR=qP.Events,qI=qP.Utils.Valid,qO=globalThis.game,qL=qO.event,qD=qO.player,qM="Coin Container";VX=q_("LevelCompleteScreen"),VZ=qT(ey),VJ=qA(eT),VQ=qA(eT),V$=qA(eH),V0=qA(qC),V1=qA({type:eI,group:"Play Button"}),V2=qA({type:ek,group:"Play Button"}),V4=qA({type:eH,group:"Play Button"}),V3=qA({type:ek,group:"Play Button"}),V5=qA({type:ek,group:"Play Button"}),V6=qA({type:te,group:qM}),V8=qA({type:AE,group:qM}),V9=qA({type:te,group:qM}),V7=qA({type:tm,group:qM}),qe=qA({type:tm,group:qM}),qt=qA(yq),qn=B.onlyRunInLifeCycleAsync,VX(qi=VZ((qa=n((qr=function(n){w(S,n);var I,D,M,F,U,G,H,V,q=k(S);function S(){var n;C(this,S);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return(n=q.call.apply(q,[this].concat(k))).level=1,n.coins=40,n.currentCoins=0,n.score=0,n.playAnimation=!1,n.getRewardsSuccess=!1,n.lookingForRewards=!1,n.playButtonSignal=new x,E(n,"coinText",qa,_(n)),E(n,"scoreText",qo,_(n)),E(n,"lookingForRewardsText",qs,_(n)),E(n,"getRewardsEffect",ql,_(n)),E(n,"playButton",qu,_(n)),E(n,"playBackground",qh,_(n)),E(n,"shineBackground",qp,_(n)),E(n,"hardLevelBackground",qd,_(n)),E(n,"playButtonContainer",qy,_(n)),E(n,"coinAnimation",qf,_(n)),E(n,"coinContainer",qv,_(n)),E(n,"coinContainerAnimation",qg,_(n)),E(n,"coinContainerEnterClip",qm,_(n)),E(n,"coinContainerExitClip",qb,_(n)),E(n,"particles",qw,_(n)),n.handleOpeningScreen=function(w){if(!n.screen)throw new Error("StarChestScreen: screen not found");n.validateEventPayload(w)&&(n.playButton.interactable=!0)},n.handleOpenedScreen=function(w){n.validateEventPayload(w)&&n.open()},n.handleParticleEnd=N(function(){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=n.level;if(!w)return[3,2];return[4,z.waitTweenAsync(.15)];case 1:w=k.sent();k.label=2;case 2:return[4,Promise.all([n.animateCoin(),n.animateScore()])];case 3:k.sent();if(!n.lookingForRewards)return[3,5];return[4,n.handleLookingForRewards()];case 4:k.sent();return[3,7];case 5:return[4,n.animateVisiblePlayButton(!0)];case 6:k.sent();k.label=7;case 7:return[2]}})}),n}return T(S,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){qL.on(qR.OPENING_SCREEN,this.handleOpeningScreen),qL.on(qR.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){qL.off(qR.OPENING_SCREEN,this.handleOpeningScreen),qL.off(qR.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(n){var w=null!=n?n:{},k=w.screenName,C=w.screenData;return k===this.node.name&&!!qI.isObject(C)&&(qI.isNumber(C.level)&&(this.level=C.level,this.coins=this.level<5?sk:sC),qI.isNumber(C.coins)&&(this.currentCoins=C.coins),qI.isNumber(C.score)&&(this.score=C.score),this.playAnimation=!1,qI.isObject(C.overrideAnimation)&&(this.playAnimation="LevelCompleteOpenScreen"===C.overrideAnimation.openScreen),this.lookingForRewards=!1,qI.isBoolean(C.lookingForRewards)&&(this.lookingForRewards=C.lookingForRewards),this.getRewardsSuccess=!1,qI.isBoolean(C.getRewardsSuccess)&&(this.getRewardsSuccess=C.getRewardsSuccess),!0)}},{key:"open",value:function(){this.updateStatus(),this.node.scene.emit(i7.HIDE_UI),this.tryPlayAnimation()}},{key:"close",value:(V=N(function(){var n,w,k,C;var E=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:w=E.length>0&&void 0!==E[0]&&E[0],k=L(this.particles);try{for(k.s();!(n=k.n()).done;){C=n.value;C.stop()}}catch(n){k.e(n)}finally{k.f()}return[4,z.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name)];case 1:_.sent(),qL.emit(qR.CLOSE_SCREEN,{screenName:this.node.name,screenData:{canShowRewardsAd:w}}),this.node.scene.emit(i7.ABORT_COIN_ANIMATION);return[2]}})}),function(){return V.apply(this,arguments)})},{key:"updateStatus",value:function(){this.updateCoinContainer(),this.updatePlayButton(),this.lookingForRewardsText.opacity=0}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoins})}},{key:"updatePlayButton",value:function(){var n=qD.getGameData();if(n){var w=(this.level+1>n.totalLevel?this.level:this.level+1)%5==0;this.playBackground.active=!w,this.hardLevelBackground.active=w}}},{key:"tryPlayAnimation",value:function(){if(this.playAnimation){this.screen.setScreenOpacity(255),this.coinText.string="x0",this.scoreText.string="0",this.animateVisiblePlayButton(!1,!1);var n,w=L(this.particles);try{for(w.s();!(n=w.n()).done;)n.value.play()}catch(n){w.e(n)}finally{w.f()}var k=this.screen.getComponent(te);k?k.once(te.EventType.FINISHED,this.handleParticleEnd):this.handleParticleEnd()}else{if(this.animateVisiblePlayButton(!0,!1),!this.getRewardsSuccess)return;this.getRewardsEffect.playAnimation(["storm","thunder"],this.animateCollectItemPlayButton.bind(this))}}},{key:"handleLookingForRewards",value:(H=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.animateLookingForRewards()];case 1:n.sent(),ea.canShowRewardedInterstitialAd()?this.close(!0):this.animateVisiblePlayButton(!0);return[2]}})}),function(){return H.apply(this,arguments)})},{key:"animateCoin",value:(G=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:n=this;if(!this.screen.container)return[3,3];this.coinAnimation.play();return[4,z.runOnUpdateAsync(this.node,.8,function(w){var k=ts(0,n.coins,w),C=Math.floor(k);n.coinText.string="x".concat(C)})];case 1:w.sent();return[4,this.animateCoinCollection()];case 2:w.sent(),this.coinText.string="x".concat(this.coins);return[3,4];case 3:console.warn("LevelCompleteScreen: screen not found");w.label=4;case 4:return[2]}})}),function(){return G.apply(this,arguments)})},{key:"animateScore",value:(U=N(function(){var n;return _ts_generator(this,function(w){n=this;z.runOnUpdateAsync(this.scoreText.node,.8,function(w){var k=ts(0,n.score,w);n.scoreText.string="".concat(Math.floor(k))}),this.scoreText.node.setScale(1,1,1),this.scoreText.string="".concat(this.score);return[2]})}),function(){return U.apply(this,arguments)})},{key:"animateCoinCollection",value:(F=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,z.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name)];case 1:n.sent(),this.node.scene.emit(i7.ADD_COINS,{coins:this.coins,collectionAnimation:{floatDuration:.5,flyDuration:.5,animateTextOnly:!1,target:this.coinContainer}});return[2]}})}),function(){return F.apply(this,arguments)})},{key:"animateLookingForRewards",value:(M=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:n=ez(this.lookingForRewardsText);n.to(.25,{opacity:255},{easing:"linear"}).delay(.25),n.to(.25,{opacity:100},{easing:"linear"}).delay(.125);return[4,z.runTweenAsync(ez(this.lookingForRewardsText).repeat(2,n).to(.25,{opacity:0},{easing:"linear"}))];case 1:w.sent(),this.lookingForRewardsText.opacity=0;return[2]}})}),function(){return M.apply(this,arguments)})},{key:"animateVisiblePlayButton",value:(D=N(function(n){var w,k,C,E,_;var T=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:w=!(T.length>1&&void 0!==T[1])||T[1],k=n?1:0;if(!w)return[3,2];this.playButtonSignal.abort();C=new x;this.playButtonSignal=C;E=n?0:1;this.playButtonContainer.setScale(E,E,this.playButtonContainer.scale.z);_=ez(this.playButtonContainer).to(.5,{scale:new eQ(k,k,1)},{easing:"backOut"});n||(this.playButton.interactable=!1);return[4,z.runTweenAsync(_,C)];case 1:I.sent(),n&&(this.playButton.interactable=!0);return[3,3];case 2:this.playButton.interactable=n,this.playButtonContainer.setScale(k,k,this.playButtonContainer.scale.z);I.label=3;case 3:return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"animateCollectItemPlayButton",value:(I=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:this.playButtonSignal.abort();n=new x;this.playButtonSignal=n;w=ez(this.playButtonContainer).to(.08,{scale:new eQ(.95,1.05,1)}).to(.08,{scale:new eQ(1.05,.95,1)}).to(.08,{scale:new eQ(1,1,1)}),k=ez(this.shineBackground).to(.08,{opacity:50},{easing:"quadOut"}).to(.08,{opacity:0},{easing:"quadIn"});return[4,Promise.all([z.runTweenAsync(w,n),z.runTweenAsync(k,n)])];case 1:C.sent();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"handleClickedPlay",value:function(){this.playButton.interactable=!1,this.close()}}]),S}(eL)).prototype,"coinText",[VJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qo=n(qr.prototype,"scoreText",[VQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qs=n(qr.prototype,"lookingForRewardsText",[V$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ql=n(qr.prototype,"getRewardsEffect",[V0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qu=n(qr.prototype,"playButton",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qh=n(qr.prototype,"playBackground",[V2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qp=n(qr.prototype,"shineBackground",[V4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd=n(qr.prototype,"hardLevelBackground",[V3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qy=n(qr.prototype,"playButtonContainer",[V5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qf=n(qr.prototype,"coinAnimation",[V6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qv=n(qr.prototype,"coinContainer",[V8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qg=n(qr.prototype,"coinContainerAnimation",[V9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qm=n(qr.prototype,"coinContainerEnterClip",[V7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qb=n(qr.prototype,"coinContainerExitClip",[qe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qw=n(qr.prototype,"particles",[qt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),n(qr.prototype,"animateCoin",[qn],Object.getOwnPropertyDescriptor(qr.prototype,"animateCoin"),qr.prototype),qi=qr))||qi);ew._RF.pop(),ew._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var qN,qz,qB,qF,qx,qU,qG,qH,qV,qq,qW=eS.ccclass,qK=eS.disallowMultiple,qj=eS.requireComponent,qY=GameCore.Events,qX=globalThis.game.event;qW("LoadingScreen")(qE=qK(qE=qj(ey)(qE=function(n){w(o,n);var E=k(o);function o(){var n;C(this,o);for(var w=arguments.length,k=new Array(w),_=0;_<w;_++)k[_]=arguments[_];return(n=E.call.apply(E,[this].concat(k))).handleOpeningScreen=function(w){n.validateEventPayload(w)&&(n.enabled=!0)},n.handleOpenedScreen=function(w){n.validateEventPayload(w)&&n.open()},n.handleClosingScreen=function(w){n.validateEventPayload(w)&&n.unscheduleAllCallbacks()},n.handleClosedScreen=function(w){n.validateEventPayload(w)&&(n.enabled=!1)},n.handleOnCloseScreen=function(){ei.closeScreen(er.LOADING_SCREEN)},n}return T(o,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){qX.on(qY.OPENING_SCREEN,this.handleOpeningScreen),qX.on(qY.OPENED_SCREEN,this.handleOpenedScreen),qX.on(qY.CLOSING_SCREEN,this.handleClosingScreen),qX.on(qY.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){qX.off(qY.OPENING_SCREEN,this.handleOpeningScreen),qX.off(qY.OPENED_SCREEN,this.handleOpenedScreen),qX.off(qY.CLOSING_SCREEN,this.handleClosingScreen),qX.off(qY.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(n){return n.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var n=this.screen.data.duration;n&&n>0&&this.scheduleOnce(this.handleOnCloseScreen,n)}}}]),o}(eL))||qE)||qE);ew._RF.pop(),ew._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var qZ,qJ,qQ,q$,q0,q1,q2,q4,q3,q5,q6,q8,q9,q7,We,Wt,Wn=eS.ccclass,Wi=eS.disallowMultiple,Wr=eS.requireComponent,Wa=eS.property,Wo=GameCore,Ws=Wo.Events,Wl=Wo.Utils.Valid,Wu=globalThis.game.event;qN=Wn("NotificationScreen"),qz=Wr(ey),qB=Wa(eT),qF=Wa(j),qx=Wa(eI),qN(qU=Wi(qU=qz((qH=n((qG=function(n){w(s,n);var I=k(s);function s(){var n;C(this,s);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=I.call.apply(I,[this].concat(k)),E(n,"message",qH,_(n)),E(n,"messageLocalizer",qV,_(n)),E(n,"touchZone",qq,_(n)),n.enableCloseOnTouch=!0,n.handleOpeningScreen=function(w){n.validateEventPayload(w)&&n.updateScreenData(w)},n.handleClosingScreen=function(w){n.validateEventPayload(w)&&n.unscheduleAllCallbacks()},n}return T(s,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Wu.on(Ws.OPENING_SCREEN,this.handleOpeningScreen),Wu.on(Ws.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){Wu.off(Ws.OPENING_SCREEN,this.handleOpeningScreen),Wu.off(Ws.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(n){return n.screenName===this.node.name}},{key:"updateScreenData",value:function(n){var w=n.screenData;Wl.isObject(w)?(void 0!==w.message?this.setMessageManually(w.message):void 0!==w.localizedMessageKey&&this.setMessageUsingLocalizeKey(w.localizedMessageKey),w.duration&&w.duration>0&&this.scheduleOnce(function(){ei.closeScreen(er.NOTIFICATION_SCREEN)},w.duration),!1===w.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"setMessageManually",value:function(n){this.messageLocalizer.enabled=!1,this.message.string=n}},{key:"setMessageUsingLocalizeKey",value:function(n){this.messageLocalizer.enabled=!0,this.messageLocalizer.key=n}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),ei.closeScreen(er.NOTIFICATION_SCREEN)}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),s}(eL)).prototype,"message",[qB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qV=n(qG.prototype,"messageLocalizer",[qF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qq=n(qG.prototype,"touchZone",[qx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qU=qG))||qU)||qU);ew._RF.pop(),ew._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var Wc,Wh,Wp,Wd,Wy,Wf,Wv,Wg,Wm,Wb,Ww,WS,Wk,WC,WE,W_,WA,WT,WP,WR,WI,WO,WL=eS.ccclass,WD=eS.property,WM=eS.requireComponent,WN=GameCore,Wz=WN.Events,WB=WN.Match.Modes,WF=globalThis.game,Wx=WF.event,WU=WF.storage;qZ=WL("QuitLevelScreen"),qJ=WM(ey),qQ=WD(eT),q$=WD(eT),q0=WD(eI),q1=WD(eT),q2=WD(eT),q4=WD(eI),qZ(q3=qJ((q6=n((q5=function(n){w(u,n);var I,L=k(u);function u(){var n;C(this,u);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=L.call.apply(L,[this].concat(k)),E(n,"singleDescription",q6,_(n)),E(n,"tournamentDescription",q8,_(n)),E(n,"quitButton",q9,_(n)),E(n,"quitLabel",q7,_(n)),E(n,"endLabel",We,_(n)),E(n,"continueButton",Wt,_(n)),n.handleOpeningScreen=function(w){n.validateEventPayload(w)&&n.setInteractableButtons(!0)},n.handleOpenedScreen=function(w){n.validateEventPayload(w)&&n.open()},n}return T(u,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Wx.on(Wz.OPENING_SCREEN,this.handleOpeningScreen),Wx.on(Wz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Wx.off(Wz.OPENING_SCREEN,this.handleOpeningScreen),Wx.off(Wz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(n){return(null!=n?n:{}).screenName===this.node.name}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(i7.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),ei.closeScreen(ev[this.node.name]),this.node.scene.emit(i7.SHOW_UI),this.node.scene.emit(i7.GAME_RESUME)}},{key:"updateStatus",value:function(){var n=s2.getMatchMode()===WB.TOURNAMENT;this.singleDescription.node.active=!n,this.tournamentDescription.node.active=n,this.quitLabel.node.active=!n,this.endLabel.node.active=n}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(n){this.quitButton.interactable=n,this.continueButton.interactable=n,this.screen.backgroundMask.getComponent(eI).interactable=n}},{key:"handleClickedContinue",value:function(){this.close()}},{key:"handleClickedQuit",value:(I=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(this.setInteractableButtons(!1),s2.getMatchMode()!==WB.TOURNAMENT)return[3,2];w=(null!==(n=s2.getMatchCustomData())&&void 0!==n?n:{}).score,k=(void 0===w?0:w)>WU.getStorageData("tournament","previousScore");WU.setStorageData("tournament","animateTournamentLeader",k);return[4,s2.finishMatchAsync()];case 1:C.sent();C.label=2;case 2:this.node.scene.emit(i7.GAME_EXIT);return[2]}})}),function(){return I.apply(this,arguments)})}]),u}(eL)).prototype,"singleDescription",[qQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q8=n(q5.prototype,"tournamentDescription",[q$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q9=n(q5.prototype,"quitButton",[q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q7=n(q5.prototype,"quitLabel",[q1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),We=n(q5.prototype,"endLabel",[q2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wt=n(q5.prototype,"continueButton",[q4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q3=q5))||q3);ew._RF.pop(),ew._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var WG,WH,WV,Wq,WW,WK,Wj,WY,WX,WZ,WJ,WQ,W$,W0,W1,W2,W4,W3,W5,W6,W8,W9,W7,Ke,Kt,Kn,Ki=eS.ccclass,Kr=eS.property,Ka=eS.disallowMultiple,Ko=eS.requireComponent,Ks=GameCore.Events,Kl=globalThis.game,Ku=Kl.event,Kc=Kl.player;Wc=Ki("RescuesScreen"),Wh=Ko(ey),Wp=Kr(eH),Wd=Kr([ek]),Wy=Kr(j),Wf=Kr(j),Wv=Kr(ek),Wg=Kr(ek),Wm=Kr(te),Wb=Kr(ek),Ww=Kr(ek),Wc(WS=Ka(WS=Wh((WC=n((Wk=function(n){w(f,n);var I,L,D,M,F,x=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=x.call.apply(x,[this].concat(k)),E(n,"adOpacity",WC,_(n)),E(n,"animNodes",WE,_(n)),E(n,"titleLocalizer",W_,_(n)),E(n,"descriptionLocalizer",WA,_(n)),E(n,"timer",WT,_(n)),E(n,"bomb",WP,_(n)),E(n,"bombAnim",WR,_(n)),E(n,"replayButton",WI,_(n)),E(n,"buyTimeButton",WO,_(n)),n.handleOpeningScreen=function(w){if(!n.screen)throw new Error("RescuesScreen: screen not found");n.validateEventPayload(w)},n.handleOpenedScreen=function(w){n.validateEventPayload(w)&&n.open()},n}return T(f,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Ku.on(Ks.OPENING_SCREEN,this.handleOpeningScreen),Ku.on(Ks.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Ku.off(Ks.OPENING_SCREEN,this.handleOpeningScreen),Ku.off(Ks.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(n){return n.screenName===this.node.name&&(this.payload=n,!0)}},{key:"open",value:(F=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:H.turnOffMusic();return[4,this.resetState()];case 1:n.sent(),this.runOpenAnimation(),this.node.scene.emit(i7.HIDE_UI);return[2]}})}),function(){return F.apply(this,arguments)})},{key:"close",value:function(){H.turnUpMusic(),Ku.emit(Ks.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(M=N(function(){var n,w,k,C;return _ts_generator(this,function(E){w=(null===(n=this.payload.screenData)||void 0===n?void 0:n.failKey)===s5;this.titleLocalizer.key=w?"game.boom":"game.timesUp",this.descriptionLocalizer.key=w?"game.bombDesc":"game.timesUpDesc",this.timer.active=!w,this.bomb.active=w,w&&this.bombAnim.play();k=Kc.getGameData();if(k){C=k.coins>=sA;this.replayButton.active=!C,this.buyTimeButton.active=C,this.adOpacity.opacity=0}return[2]})}),function(){return M.apply(this,arguments)})},{key:"runOpenAnimation",value:(D=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:n=this;if(!this.screen.container)return[3,3];return[4,Promise.all(this.animNodes.map(function(w,k){n.runAppearTween(w,.1*k)}))];case 1:w.sent();return[4,this.runShowAdContainer()];case 2:w.sent();return[3,4];case 3:console.warn("TimeUpScreen: screen not found");w.label=4;case 4:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"runAppearTween",value:(L=N(function(n,w){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,z.runTweenAsync(ez(n).set({scale:new eQ(0,0,0)}).delay(w).to(1,{scale:new eQ(1,1,1)},{easing:function(n){return z.elasticOut(n,.1,.45)}}))];case 1:k.sent();return[2]}})}),function(n,w){return L.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var n=ez(this.adOpacity);return n.delay(1),n.to(.5,{opacity:255}),z.runTweenAsync(n)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit(i7.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit(i7.REMOVE_COINS,{coins:sA,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(I=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,ea.showRewardVideoAdAsync({})];case 1:n.sent()&&this.startRescue();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit(i7.SHOW_UI),this.node.scene.emit(i7.RESCUE_START),this.close()}}]),f}(eL)).prototype,"adOpacity",[Wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WE=n(Wk.prototype,"animNodes",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),W_=n(Wk.prototype,"titleLocalizer",[Wy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WA=n(Wk.prototype,"descriptionLocalizer",[Wf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WT=n(Wk.prototype,"timer",[Wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WP=n(Wk.prototype,"bomb",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WR=n(Wk.prototype,"bombAnim",[Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WI=n(Wk.prototype,"replayButton",[Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WO=n(Wk.prototype,"buyTimeButton",[Ww],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WS=Wk))||WS)||WS);ew._RF.pop(),ew._RF.push({},"726c9oCUUBDpboDnHRz7SGZ","PauseScreen",void 0);var Kh,Kp,Kd,Ky,Kf,Kv,Kg,Km,Kb,Kw,KS,Kk,KC,KE,K_,KA,KT,KP,KR,KI,KO,KL,KD,KM,KN,Kz,KB=eS.ccclass,KF=eS.property,Kx=eS.requireComponent,KU=GameCore,KG=KU.Events,KH=KU.Utils.Device,KV=KU.Match.Modes,Kq=globalThis.game,KW=Kq.player,KK=Kq.event;WG=KB("PauseScreen"),WH=Kx(ey),WV=KF(ek),Wq=KF(ek),WW=KF(ek),WK=KF(Ms),Wj=KF(Ms),WY=KF(Ms),WX=KF(eI),WZ=KF(eI),WJ=KF(eI),WQ=KF(eI),W$=KF(ek),WG(W0=WH((W2=n((W1=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"musicSetting",W2,_(n)),E(n,"soundSetting",W4,_(n)),E(n,"vibrateSetting",W3,_(n)),E(n,"musicSwitch",W5,_(n)),E(n,"soundSwitch",W6,_(n)),E(n,"vibrateSwitch",W8,_(n)),E(n,"closeButtonComponent",W9,_(n)),E(n,"continueButtonComponent",W7,_(n)),E(n,"restartButtonComponent",Ke,_(n)),E(n,"challengeFriendsButtonComponent",Kt,_(n)),E(n,"animNodes",Kn,_(n)),n.triggerSequence="",n.handleOpeningScreen=function(w){n.validateSwitchScreenPayload(w)&&(n.setInteractableButtons(!0),n.updateStatus())},n.handleOpenedScreen=function(w){n.validateSwitchScreenPayload(w)&&n.open()},n.handleResetSequence=function(){n.triggerSequence=""},n.handleTriggerUnlockKey=function(w){if("code"in w){var k=w.code,C=sI.UNLOCK_SEQUENCE;"number"==typeof k&&-1!==C.indexOf(k.toString())&&(n.triggerSequence+=k.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",k,n.triggerSequence,n.triggerSequence===C),n.triggerSequence===C&&(n.node.scene.emit(sI.Events.UNLOCK_DEV_TOOLS),n.node.off(sI.Events.TRIGGER_UNLOCK_KEY)))}},n.updateVibrateButton=function(){var w=n.vibrateSetting.getComponentInChildren(eI),k=n.vibrateSetting.getComponentInChildren(Ms),C=n.vibrateSetting.getComponentInChildren(iA);if(w&&k&&C){if(KH.isMobile()){var E,_=null!==(E=KW.getPlayerSetting("vibrate"))&&void 0!==E&&E;k.setEnabled(_)}else w.interactable=!1,k.setEnabled(!1),C.changeState(!1)}else console.warn("SettingsScreen: vibrate button missing components")},n}return T(c,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){KK.on(KG.OPENING_SCREEN,this.handleOpeningScreen),KK.on(KG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){KK.off(KG.OPENING_SCREEN,this.handleOpeningScreen),KK.off(KG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(n){return n.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(sI.Events.TRIGGER_UNLOCK_KEY),this.node.on(sI.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(sI.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(sI.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(sI.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(sI.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(i7.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(sI.Events.TRIGGER_RESET_SEQUENCE),ei.closeScreen(ev[this.node.name])}},{key:"updateStatus",value:function(){var n,w,k,C={music:null!==(n=KW.getPlayerSetting("music"))&&void 0!==n&&n,sound:null!==(w=KW.getPlayerSetting("sound"))&&void 0!==w&&w,vibrate:null!==(k=KW.getPlayerSetting("vibrate"))&&void 0!==k&&k};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(C.music),this.soundSwitch.setEnabled(C.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var n=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(w,k){n.runAppearTween(w,.1*k)})}},{key:"runAppearTween",value:function(n,w){var k=ez(n);k.set({scale:new eQ(0,0,0)}),k.delay(w),k.to(1,{scale:new eQ(1,1,1)},{easing:function(n){return z.elasticOut(n,.1,.45)}}),k.start()}},{key:"setInteractableButtons",value:function(n){this.closeButtonComponent.interactable=n,this.continueButtonComponent.interactable=n,this.restartButtonComponent.interactable=n,this.challengeFriendsButtonComponent.interactable=n,this.screen.backgroundMask.getComponent(eI).interactable=n}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var n=this.musicSwitch.switch();if(KW.setSetting("music",n),this.node.emit(sI.Events.TRIGGER_UNLOCK_KEY,{code:n?1:0}),n){var w=s2.getMatchMode();H.playMusic(w===KV.TOURNAMENT?nI.TOURNAMENT_MUSIC:nI.BG_MUSIC)}else H.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var n=this.soundSwitch.switch();KW.setSetting("sound",n),this.node.emit(sI.Events.TRIGGER_UNLOCK_KEY,{code:n?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var n=this.vibrateSwitch.switch();KW.setSetting("vibrate",n)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:(L=N(function(){var n,w,k,C;return _ts_generator(this,function(E){switch(E.label){case 0:this.close();w=(null!==(n=KW.getGameData())&&void 0!==n?n:{}).level,k=void 0===w?1:w;C=ea.canShowInterstitialAd();if(!C)return[3,2];return[4,ea.showInterstitialAdAsync({forLevel:k})];case 1:C=E.sent();E.label=2;case 2:s2.getMatchMode()!==KV.TOURNAMENT?(this.node.scene.emit(i7.GAME_RESUME),this.node.scene.emit(i7.GAME_REPLAY,{level:k})):ei.openScreen(er.START_OVER_SCREEN);return[2]}})}),function(){return L.apply(this,arguments)})},{key:"handleClickedChallengeFriends",value:(I=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:if("MsGames"!==GameSDK.getSDKName())return[3,2];ei.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 1:return[2,(n.sent(),void ei.closeLoadingScreen())];case 2:this.close(),this.node.scene.emit(i7.CHALLENGE_FRIENDS);return[2]}})}),function(){return I.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(i7.GAME_RESUME),this.node.scene.emit(i7.SHOW_UI)}}]),c}(eL)).prototype,"musicSetting",[WV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W4=n(W1.prototype,"soundSetting",[Wq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W3=n(W1.prototype,"vibrateSetting",[WW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W5=n(W1.prototype,"musicSwitch",[WK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W6=n(W1.prototype,"soundSwitch",[Wj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W8=n(W1.prototype,"vibrateSwitch",[WY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W9=n(W1.prototype,"closeButtonComponent",[WX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W7=n(W1.prototype,"continueButtonComponent",[WZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ke=n(W1.prototype,"restartButtonComponent",[WJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kt=n(W1.prototype,"challengeFriendsButtonComponent",[WQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kn=n(W1.prototype,"animNodes",[W$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),W0=W1))||W0);ew._RF.pop(),ew._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var Kj,KY,KX,KZ,KJ,KQ,K$,K0,K1,K2,K4,K3,K5,K6,K8,K9,K7,je,jt,jn,ji,jr,ja,jo=eS.ccclass,js=eS.property,jl=eS.requireComponent,ju=GameCore,jc=ju.Events,jh=ju.Utils.Device,jp=ju.Match.Modes,jd=ju.Configs.Debugger.MonitorError,jy=globalThis.game,jf=jy.player,jv=jy.event,jg=jy.monitorError,jm=jy.frameCapture;Kh=jo("SettingsScreen"),Kp=jl(ey),Kd=js(ek),Ky=js(ek),Kf=js(ek),Kv=js(Ms),Kg=js(Ms),Km=js(Ms),Kb=js(eI),Kw=js(eI),KS=js(eI),Kk=js(eI),KC=js(ek),Kh(KE=Kp((KA=n((K_=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"musicSetting",KA,_(n)),E(n,"soundSetting",KT,_(n)),E(n,"vibrateSetting",KP,_(n)),E(n,"musicSwitch",KR,_(n)),E(n,"soundSwitch",KI,_(n)),E(n,"vibrateSwitch",KO,_(n)),E(n,"closeButtonComponent",KL,_(n)),E(n,"reportButtonComponent",KD,_(n)),E(n,"shareButtonComponent",KM,_(n)),E(n,"inviteFriendsButtonComponent",KN,_(n)),E(n,"animNodes",Kz,_(n)),n.triggerSequence="",n.handleOpeningScreen=function(w){n.validateSwitchScreenPayload(w)&&(n.setInteractableButtons(!0),n.updateStatus())},n.handleOpenedScreen=function(w){n.validateSwitchScreenPayload(w)&&n.open()},n.handleResetSequence=function(){n.triggerSequence=""},n.handleTriggerUnlockKey=function(w){if("code"in w){var k=w.code,C=sI.UNLOCK_SEQUENCE;"number"==typeof k&&-1!==C.indexOf(k.toString())&&(n.triggerSequence+=k.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",k,n.triggerSequence,n.triggerSequence===C),n.triggerSequence===C&&(n.node.scene.emit(sI.Events.UNLOCK_DEV_TOOLS),n.node.off(sI.Events.TRIGGER_UNLOCK_KEY)))}},n.updateVibrateButton=function(){var w=n.vibrateSetting.getComponentInChildren(eI),k=n.vibrateSetting.getComponentInChildren(Ms),C=n.vibrateSetting.getComponentInChildren(iA);if(w&&k&&C){if(jh.isMobile()){var E,_=null!==(E=jf.getPlayerSetting("vibrate"))&&void 0!==E&&E;k.setEnabled(_)}else w.interactable=!1,k.setEnabled(!1),C.changeState(!1)}else console.warn("SettingsScreen: vibrate button missing components")},n}return T(c,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools(),this.reportButtonComponent.node.parent.active=jd.Feedback}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){jv.on(jc.OPENING_SCREEN,this.handleOpeningScreen),jv.on(jc.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){jv.off(jc.OPENING_SCREEN,this.handleOpeningScreen),jv.off(jc.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(n){return n.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(sI.Events.TRIGGER_UNLOCK_KEY),this.node.on(sI.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(sI.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(sI.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(sI.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(sI.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(i7.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(sI.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(i7.SHOW_UI),ei.closeScreen(er.SETTINGS_SCREEN)}},{key:"updateStatus",value:function(){var n,w,k,C={music:null!==(n=jf.getPlayerSetting("music"))&&void 0!==n&&n,sound:null!==(w=jf.getPlayerSetting("sound"))&&void 0!==w&&w,vibrate:null!==(k=jf.getPlayerSetting("vibrate"))&&void 0!==k&&k};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(C.music),this.soundSwitch.setEnabled(C.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var n=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(w,k){("ReportButton"!==w.name||jd.Feedback)&&n.runAppearTween(w,.1*k)})}},{key:"runAppearTween",value:function(n,w){var k=ez(n);k.set({scale:new eQ(0,0,0)}),k.delay(w),k.to(1,{scale:new eQ(1,1,1)},{easing:function(n){return z.elasticOut(n,.1,.45)}}),k.start()}},{key:"setInteractableButtons",value:function(n){this.closeButtonComponent.interactable=n,this.reportButtonComponent.interactable=n,this.shareButtonComponent.interactable=n,this.inviteFriendsButtonComponent.interactable=n,this.screen.backgroundMask.getComponent(eI).interactable=n}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var n=this.musicSwitch.switch();if(jf.setSetting("music",n),this.node.emit(sI.Events.TRIGGER_UNLOCK_KEY,{code:n?1:0}),n){var w=s2.getMatchMode();H.playMusic(w===jp.TOURNAMENT?nI.TOURNAMENT_MUSIC:nI.BG_MUSIC)}else H.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var n=this.soundSwitch.switch();jf.setSetting("sound",n),this.node.emit(sI.Events.TRIGGER_UNLOCK_KEY,{code:n?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var n=this.vibrateSwitch.switch();jf.setSetting("vibrate",n)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedClose",value:function(){this.close()}},{key:"handleClickedReport",value:function(){null==jg||jg.feedbackAsync()}},{key:"handleClickedShare",value:(L=N(function(){return _ts_generator(this,function(n){switch(n.label){case 0:if("FacebookInstant"!==GameSDK.getSDKName())return[3,2];jm.addWideframeRender("renderShareScore",eg),ei.showLoadingScreen();return[4,GameSDK.extra.shareBestScoreAsync()];case 1:return[2,(n.sent(),void ei.closeLoadingScreen())];case 2:this.close();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"handleClickedInviteFriends",value:(I=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:n=GameSDK.getSDKName();switch(n){case"MsGames":return[3,1];case"FacebookInstant":return[3,3]}return[3,5];case 1:ei.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 2:w.sent(),ei.closeLoadingScreen();return[3,5];case 3:jm.addWideframeRender("renderShareScore",em),ei.showLoadingScreen();return[4,GameSDK.extra.inviteWithBestScoreAsync()];case 4:w.sent(),ei.closeLoadingScreen();w.label=5;case 5:return[2]}})}),function(){return I.apply(this,arguments)})}]),c}(eL)).prototype,"musicSetting",[Kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KT=n(K_.prototype,"soundSetting",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KP=n(K_.prototype,"vibrateSetting",[Kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KR=n(K_.prototype,"musicSwitch",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KI=n(K_.prototype,"soundSwitch",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KO=n(K_.prototype,"vibrateSwitch",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KL=n(K_.prototype,"closeButtonComponent",[Kb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KD=n(K_.prototype,"reportButtonComponent",[Kw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KM=n(K_.prototype,"shareButtonComponent",[KS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KN=n(K_.prototype,"inviteFriendsButtonComponent",[Kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kz=n(K_.prototype,"animNodes",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),KE=K_))||KE);ew._RF.pop(),ew._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var jb,jw,jS,jk,jC,jE,j_,jA,jT,jP,jR,jI,jO,jL,jD,jM,jN,jz,jB,jF,jx=eS.ccclass,jU=eS.property,jG=(Kj=jx("StarChest"),KY=jU(ex),KX=jU(eH),KZ=jU(e$),KJ=jU(eH),KQ=jU(eH),K$=jU({type:eM,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),K0=jU({type:eM,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),K1=jU({type:eM,displayName:"Centered Offset X",group:"Reward Animations"}),K2=jU({type:eM,displayName:"Centered Offset Y",group:"Reward Animations"}),K4=jU({type:eM,min:0,displayName:"Starting Scale",group:"Reward Animations"}),K3=jU({type:eM,min:0,displayName:"Ending Scale",group:"Reward Animations"}),Kj((K8=n((K6=function(n){w(f,n);var I,L,D,M,F,x=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=x.call.apply(x,[this].concat(k)),E(n,"sprite",K8,_(n)),E(n,"glowOpacity",K9,_(n)),E(n,"explosionParticles",K7,_(n)),E(n,"circle",je,_(n)),E(n,"uiOpacity",jt,_(n)),n.ogCenterX=0,n.ogCenterY=0,E(n,"endingOffsetX",jn,_(n)),E(n,"endingOffsetY",ji,_(n)),E(n,"startingScale",jr,_(n)),E(n,"endingScale",ja,_(n)),n}return T(f,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"moveToCenter",value:(F=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=new eQ(this.endingOffsetX,this.endingOffsetY,this.node.position.z);return[4,z.runTweenAsync(ez(this.node).to(.7,{position:w},{easing:"quintInOut"}),n)];case 1:k.sent(),this.node.position=w;return[2]}})}),function(n){return F.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new eQ(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(M=N(function(n,w){var k,C;return _ts_generator(this,function(E){switch(E.label){case 0:k=this.startingScale+(this.endingScale-this.startingScale)*n,C=new eQ(k,k,k);return[4,Promise.all([z.runTweenAsync(ez(this.sprite.node).to(.2,{scale:C},{easing:"backOut"}),w),z.runTweenAsync(ez(this.glowOpacity.node).to(.2,{scale:C},{easing:"backOut"}),w)])];case 1:E.sent(),this.sprite.node.setScale(C),this.glowOpacity.node.setScale(C);return[2]}})}),function(n,w){return M.apply(this,arguments)})},{key:"startShaking",value:function(){var n=this,w=this.node.position.clone();this.shakingTween={ogPos:w,tw:ez(this.node).to(.1,{},{onUpdate:function(k,C){if(C){var E=w.x+10*(C-.5);n.node.position=new eQ(E,w.y,w.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(D=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=this.sprite.node.scale.clone().multiplyScalar(1.1);return[4,Promise.all([z.runTweenAsync(ez(this.sprite.node).to(.2,{scale:w},{easing:"cubicInOut"}),n),z.runTweenAsync(ez(this.glowOpacity.node).to(.2,{scale:w}),n),z.runTweenAsync(ez(this.glowOpacity).to(.5,{opacity:255}),n)])];case 1:k.sent();return[2]}})}),function(n){return D.apply(this,arguments)})},{key:"explode",value:(L=N(function(n){var w,k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:w=this,k=new eQ(8,8,8),C=function(){var C=N(function(){return _ts_generator(this,function(C){switch(C.label){case 0:w.circle.opacity=255,w.circle.node.setScale(eQ.ZERO);return[4,Promise.all([z.runTweenAsync(ez(w.circle).to(.3,{opacity:0}),n),z.runTweenAsync(ez(w.circle.node).to(.3,{scale:k},{easing:"cubicOut"}),n)])];case 1:C.sent(),w.circle.opacity=0,w.circle.node.scale=k;return[2]}})});return function(){return C.apply(this,arguments)}}(),E=function(){var k=N(function(){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,Promise.all([z.runTweenAsync(ez(w.glowOpacity.node).to(.3,{scale:eQ.ZERO},{easing:"cubicOut"}),n),z.runTweenAsync(ez(w.sprite.node).to(.3,{scale:eQ.ZERO},{easing:"cubicOut"}),n)])];case 1:k.sent(),w.sprite.node.setScale(eQ.ZERO),w.glowOpacity.node.setScale(eQ.ZERO);return[2]}})});return function(){return k.apply(this,arguments)}}();return[4,Promise.all([this.explodeParticles(n),C(),E()])];case 1:_.sent();return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"explodeParticles",value:(I=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=n.aborted;if(w)return[3,2];this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem();return[4,z.waitTweenAsync(1)];case 1:w=(k.sent(),this.explosionParticles.node.active=!1);k.label=2;case 2:return[2]}})}),function(n){return I.apply(this,arguments)})}]),f}(eL)).prototype,"sprite",[KY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K9=n(K6.prototype,"glowOpacity",[KX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K7=n(K6.prototype,"explosionParticles",[KZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),je=n(K6.prototype,"circle",[KJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jt=n(K6.prototype,"uiOpacity",[KQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(K6.prototype,"startingOffsetX",[K$],Object.getOwnPropertyDescriptor(K6.prototype,"startingOffsetX"),K6.prototype),n(K6.prototype,"startingOffsetY",[K0],Object.getOwnPropertyDescriptor(K6.prototype,"startingOffsetY"),K6.prototype),jn=n(K6.prototype,"endingOffsetX",[K1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ji=n(K6.prototype,"endingOffsetY",[K2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jr=n(K6.prototype,"startingScale",[K4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),ja=n(K6.prototype,"endingScale",[K3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),K5=K6))||K5);ew._RF.pop(),ew._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var jH,jV,jq,jW,jK,jj=eS.ccclass,jY=eS.property,jX=eS.requireComponent,jZ=GameCore.Events,jJ=globalThis.game,jQ=jJ.event,j$=jJ.player;jb=jj("StarChestScreen"),jw=jX(ey),jS=jY(Ii),jk=jY(eI),jC=jY(eI),jE=jY(te),j_=jY(jG),jA=jY(eH),jT=jY(Ah),jP=jY(j),jb(jR=jw((jO=n((jI=function(n){w(f,n);var I,L,D,M,F=k(f);function f(){var n;C(this,f);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=F.call.apply(F,[this].concat(k)),E(n,"starProgressBar",jO,_(n)),E(n,"openButton",jL,_(n)),E(n,"continueButton",jD,_(n)),E(n,"chestAnimation",jM,_(n)),E(n,"starChest",jN,_(n)),E(n,"chestUnlockFXMask",jz,_(n)),E(n,"skipOverlay",jB,_(n)),E(n,"messageLabelLocalizer",jF,_(n)),n.handleOpeningScreen=function(w){if(!n.screen)throw new Error("StarChestScreen: screen not found");n.validateEventPayload(w)},n.handleOpenedScreen=function(w){n.validateEventPayload(w)&&n.open()},n}return T(f,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){jQ.on(jZ.OPENING_SCREEN,this.handleOpeningScreen),jQ.on(jZ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){jQ.off(jZ.OPENING_SCREEN,this.handleOpeningScreen),jQ.off(jZ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(n){return(null!=n?n:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(i7.HIDE_UI);var n=j$.getGameData();if(n){var w=n.stars;this.numChestAvailable=Math.floor(w/20),this.starProgressBar.setRange(w,20);var k=this.numChestAvailable>0;this.setInteractableButtons(!0),this.openButton.node.active=k,this.openButton.interactable=k,this.continueButton.node.active=!k,this.continueButton.interactable=!k,this.messageLabelLocalizer.key=this.numChestAvailable?"reward.starChestAvailable":"reward.starChestUnavailable",this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){jQ.emit(jZ.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(i7.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(M=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(0!==this.numChestAvailable))return[3,5];H.turnDownMusic();n=j$.getGameData();if(!n)return[3,4];this.setInteractableButtons(!1);w=n.stars;j$.setGameData({stars:n.stars-20*this.numChestAvailable});k=new x;return[4,this.skipOverlay.open({opacity:200,onSkip:function(){return k.abort()}})];case 1:C.sent();return[4,this.handleUnlockAnimation(w,n.stars,k)];case 2:C.sent();return[4,this.skipOverlay.close()];case 3:C.sent(),H.turnUpMusic(),eY.emit(t2),this.close();C.label=4;case 4:return[3,6];case 5:this.close();C.label=6;case 6:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(D=N(function(n,w,k){var C,E,_,T;return _ts_generator(this,function(I){switch(I.label){case 0:C=this;return[4,Promise.all([this.starChest.moveToCenter(k),this.fadeInChestUnlockFX(k)])];case 1:I.sent(),this.chestAnimation.stop(),this.starChest.startShaking();return[4,H.playSound(nI.STAR_CHEST_DRUM_ROLL,{loop:!0})];case 2:I.sent();return[4,z.waitTweenAsync(0)];case 3:I.sent();E=n,_=this.numChestAvailable;return[4,Promise.all([this.starProgressBar.animateTo(w,k,function(n){var w;E-n>=20&&(E=n,_--,C.starChest.scale((w=_,C.numChestAvailable>2?1-w/C.numChestAvailable:.35*(1-w/C.numChestAvailable)),k),H.playSound(nI.STAR_CHEST_OPEN))})])];case 4:I.sent();return[4,z.waitTweenAsync(1,k)];case 5:I.sent(),this.starChest.stopShaking();return[4,this.starChest.glow(k)];case 6:I.sent(),H.stopSound(nI.STAR_CHEST_DRUM_ROLL);T=sE*this.numChestAvailable;this.node.scene.emit(i7.ADD_COINS,{coins:T,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:k},skipAnimation:!0});return[4,this.starChest.explode(k)];case 7:I.sent();return[4,z.waitTweenAsync(1,k)];case 8:I.sent();return[4,Promise.all([this.fadeOutChestUnlockFX(k)])];case 9:I.sent();return[2]}})}),function(n,w,k){return D.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(L=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:this.chestUnlockFXMask.node.active=!0;return[4,z.runTweenAsync(ez(this.chestUnlockFXMask).to(.5,{opacity:150}),n)];case 1:w.sent();return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(I=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:return[4,z.runTweenAsync(ez(this.chestUnlockFXMask).to(.3,{opacity:0}),n)];case 1:w.sent(),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1;return[2]}})}),function(n){return I.apply(this,arguments)})},{key:"setInteractableButtons",value:function(n){this.openButton.interactable=n,this.continueButton.interactable=n,this.screen.backgroundMask.getComponent(eI).interactable=n}}]),f}(eL)).prototype,"starProgressBar",[jS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jL=n(jI.prototype,"openButton",[jk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jD=n(jI.prototype,"continueButton",[jC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jM=n(jI.prototype,"chestAnimation",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jN=n(jI.prototype,"starChest",[j_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jz=n(jI.prototype,"chestUnlockFXMask",[jA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jB=n(jI.prototype,"skipOverlay",[jT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jF=n(jI.prototype,"messageLabelLocalizer",[jP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jR=jI))||jR);ew._RF.pop(),ew._RF.push({},"d6d78U+W5xDwqln9pXXQOaF","TopLeaders",void 0);var j0,j1,j2,j4,j3,j5=eS.ccclass,j6=eS.property,j8=(jH=j5("TopLeaders"),jV=j6(Bo),jH((jK=n((jW=function(n){w(c,n);var I,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"topLeaders",jK,_(n)),n.leaderData=[],n}return T(c,[{key:"updateData",value:function(n){var w=this;this.leaderData=n.slice(0,3),this.leaderData.slice(0,3).forEach(function(n,k){w.topLeaders[k].updateInfo({playerId:n.playerId,name:n.name,photo:n.photo,score:n.score})})}},{key:"playShowLeadersAnimation",value:(I=N(function(n){var w,k,C;var E=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:w=this,k=E.length>1&&void 0!==E[1]?E[1]:.1,C=.3;return[4,Promise.all(this.leaderData.map(function(){var E=N(function(E,_){var T;return _ts_generator(this,function(E){switch(E.label){case 0:T=w.topLeaders[_];return[4,T.runShowUpAnimation(_*k,C,n)];case 1:E.sent();return[2]}})});return function(n,w){return E.apply(this,arguments)}}()))];case 1:_.sent();return[2]}})}),function(n){return I.apply(this,arguments)})},{key:"hideLeaders",value:function(){var n,w=L(this.topLeaders);try{for(w.s();!(n=w.n()).done;)n.value.setVisible(!1)}catch(n){w.e(n)}finally{w.f()}}}]),c}(eL)).prototype,"topLeaders",[jV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jq=jW))||jq);ew._RF.pop(),ew._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var j9,j7,Ye,Yt,Yn,Yi,Yr,Ya,Yo,Ys,Yl,Yu,Yc,Yh,Yp,Yy,Yf,Yv,Yg,Ym,Yb,Yw,YS,Yk,YC,YE,Y_,YA,YT,YP,YR,YI,YO,YL,YD,YM,YN,Yz,YB,YF,Yx,YU,YG,YH=eS.ccclass,YV=eS.property,Yq=(j0=YH("TournamentLeaderSkeleton"),j1=YV(ek),j0((j3=n((j4=function(n){w(c,n);var I,L,D=k(c);function c(){var n;C(this,c);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=D.call.apply(D,[this].concat(k)),E(n,"container",j3,_(n)),n}return T(c,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eH),this.validateRequiredComponents()}},{key:"hide",value:(L=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=this;return[4,z.runTweenAsync(ez(this.uiOpacity).to(.2,{opacity:0}).call(function(){w.node.active=!1}),n)];case 1:k.sent();return[2]}})}),function(n){return L.apply(this,arguments)})},{key:"show",value:(I=N(function(n,w){var k,C,E,_;return _ts_generator(this,function(T){switch(T.label){case 0:this.node.active=!0,this.node.scale=new eQ(.8,.8,.8),this.uiOpacity.opacity=0;k=this.container.position.clone();this.container.position=new eQ(k.x,k.y-100,k.z);C=ez(this.node).delay(n);C.to(.2,{scale:eQ.ONE},{easing:"elasticOut"});E=ez(this.container).delay(n);E.to(.2,{position:k},{easing:"backOut"});_=ez(this.uiOpacity).delay(n);_.to(.2,{opacity:255},{easing:"cubicOut"});return[4,Promise.all([z.runTweenAsync(C,w),z.runTweenAsync(E,w),z.runTweenAsync(_,w)])];case 1:T.sent(),this.node.scale=eQ.ONE,this.container.position=k,this.uiOpacity.opacity=255;return[2]}})}),function(n,w){return I.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),c}(eL)).prototype,"container",[j1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j2=j4))||j2);ew._RF.pop(),ew._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var YW=eS.ccclass,YK=eS.property,Yj=eS.requireComponent,YY=GameCore,YX=YY.Events,YZ=YY.Utils,YJ=YZ.Object,YQ=YZ.Time,Y$=YZ.Number,Y0=globalThis.game,Y1=Y0.event,Y2=Y0.storage,Y4=Y0.player,Y3=Y0.leaderboard,Y5=Y0.language,Y6=1166;j9=YW("TournamentDetailScreen"),j7=Yj(ey),Ye=YK(eT),Yt=YK(j),Yn=YK(j),Yi=YK(j),Yr=YK(zt),Ya=YK(j8),Yo=YK({type:ek,group:"Buttons"}),Ys=YK({type:ek,group:"Buttons"}),Yl=YK({type:ek,group:"Buttons"}),Yu=YK({type:ex}),Yc=YK({type:ek}),Yh=YK({type:ek}),Yp=YK({type:[Yq]}),Yy=YK(yq),Yf=YK({type:e_,group:"Container"}),Yv=YK({type:e_,group:"Container"}),Yg=B.onlyRunInLifeCycleAsync,Ym=B.onlyRunInLifeCycleAsync,Yb=B.onlyRunInLifeCycleAsync,Yw=B.onlyRunInLifeCycleAsync,YS=B.onlyRunInLifeCycleAsync,Yk=B.onlyRunInLifeCycle,YC=B.onlyRunInLifeCycle,j9(YE=j7((YA=n((Y_=function(n){w(P,n);var I,D,M,z,U,G,V,q,W,K,j,Y,X,Z=k(P);function P(){var n;C(this,P);for(var w=arguments.length,k=new Array(w),T=0;T<w;T++)k[T]=arguments[T];return n=Z.call.apply(Z,[this].concat(k)),E(n,"title",YA,_(n)),E(n,"titleLocalizer",YT,_(n)),E(n,"timeLocalizer",YP,_(n)),E(n,"playerCountLocalizer",YR,_(n)),E(n,"tournamentLeaders",YI,_(n)),E(n,"topLeaders",YO,_(n)),E(n,"playButton",YL,_(n)),E(n,"continueButton",YD,_(n)),E(n,"replayButton",YM,_(n)),E(n,"banner",YN,_(n)),E(n,"bannerLoadingRing",Yz,_(n)),E(n,"bannerMask",YB,_(n)),E(n,"leaderSkeletons",YF,_(n)),E(n,"paperConfetti",Yx,_(n)),E(n,"container",YU,_(n)),E(n,"tempContainer",YG,_(n)),n.signal=new x,n.leadersPayload=null,n.handleOpeningScreen=function(w){if(!n.screen)throw new Error("TournamentDetailScreen: screen not found");n.validateEventPayload(w)&&(n.enabled=!0)},n.handleOpenedScreen=function(w){n.validateEventPayload(w)&&n.open()},n}return T(P,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(ey),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){B.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Y1.on(YX.OPENING_SCREEN,this.handleOpeningScreen),Y1.on(YX.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Y1.off(YX.OPENING_SCREEN,this.handleOpeningScreen),Y1.off(YX.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(n){return(null!=n?n:{}).screenName===this.node.name&&(this.payload=n,!0)}},{key:"open",value:function(){this.updateContainer(),this.setInteractableButtons(!0),this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders(),this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(i7.HIDE_UI),this.updateInfo()}},{key:"close",value:function(){ei.closeTournamentDetailScreen(),this.setInteractableButtons(!1),this.node.scene.emit(i7.SHOW_UI),this.cleanup()}},{key:"cleanup",value:function(){var n;null===(n=this.signal)||void 0===n||n.abort(),this.signal=new x,this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(X=N(function(){var n,w,k,C,E,_,T,I,L,D,M,N,z,B,F,x,U,G,H,V,q,W,K,j,Y,X,Z,J,Q,$,ee,et;return _ts_generator(this,function(en){switch(en.label){case 0:T=this,I=this.signal,L=null===(n=this.payload)||void 0===n||null===(n=n.screenData)||void 0===n?void 0:n.tournament;if(!L)return[3,9];D=null===(w=null===(k=this.payload.screenData)||void 0===k?void 0:k.playAnimation)||void 0===w||w,M=JSON.parse(L);M.id=M.id.toString(),this.tournamentPayload=M;N=this.tournamentPayload,z=N.endTime,B=N.payload,F=N.title,x=N.tournamentType,U=B.leaderboardId,G=void 0===U?"":U,H=B.themeId,V=B.playerName;"PAGE_HOSTED"===x?this.updateTitleTournamentTitle(F):this.updateTitleWithPlayerName(null!=V?V:F),this.updateEndTime(z),this.updateTournamentBanner(H,I);q=Y2.getStorage("tournament"),W=q.previousScore,K=q.animateTournamentLeader;Y2.setStorageData("tournament","animateTournamentLeader",!1),this.updateButtonsVisibility(K);return[4,this.showLoading(I)];case 1:en.sent();return[4,this.loadLeaders(G)];case 2:if(en.sent(),!!this.leadersPayload&&0!==this.leadersPayload.leaders.length&&!I.aborted)return[3,4];this.updatePlayerCount(0);return[4,this.hideLoading(I)];case 3:return[2,void en.sent()];case 4:j=this.leadersPayload,Y=j.player,X=j.amountPlayer,Z=null!==(C=this.leadersPayload.leaders)&&void 0!==C?C:[];Z.sort(function(n,w){return n.rank-w.rank});return[4,this.hideLoading(I)];case 5:if(en.sent(),!this.topLeaders||!this.tournamentLeaders||!!I.aborted)return[3,9];this.updatePlayerCount(X),this.topLeaders.updateData(Z),this.topLeaders.playShowLeadersAnimation(I);J=null!==(E=null==Y?void 0:Y.score)&&void 0!==E?E:0,Q=null!==(_=null==Y?void 0:Y.rank)&&void 0!==_?_:0,$=K&&-1!==W&&W<J;this.tournamentLeaders.updateData(Z);ee=!1;Y&&$&&(ee=this.tournamentLeaders.updateDisplayPlayerLeaderForRankChanging(W,J,Q)),this.tournamentLeaders.initScrollViews(),this.tournamentLeaders.scrollView.scrollView.enabled=!0;return[4,I.callAsync(function(n){return T.runShowUpAnimation(n,D)})];case 6:en.sent();et=K&&ee&&-1!==W&&this.tournamentLeaders;if(!et)return[3,8];return[4,I.callAsync(function(n){return T.tournamentLeaders.playRankChangeAnimation(n,W,J,Q)})];case 7:et=(en.sent(),this.tryPlayConfettiEffect(Q));en.label=8;case 8:en.label=9;case 9:return[2]}})}),function(){return X.apply(this,arguments)})},{key:"updateContainer",value:(Y=N(function(){var n;return _ts_generator(this,function(w){n=this.tempContainer.height;this.container.node.position=this.tempContainer.node.position.clone(),n<Y6&&this.container.height!==n?(this.container.height=n,e1.instance.emit("canvas-resize")):n>Y6&&this.container.height<Y6&&(this.container.height=Y6,e1.instance.emit("canvas-resize"));return[2]})}),function(){return Y.apply(this,arguments)})},{key:"loadLeaders",value:(j=N(function(n){var w;return _ts_generator(this,function(k){switch(k.label){case 0:w=this;return[4,this.getLeadersPayload(n)];case 1:w.leadersPayload=k.sent();return[2]}})}),function(n){return j.apply(this,arguments)})},{key:"showLoading",value:(K=N(function(n){var w,k;var C=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:w=this,k=C.length>1&&void 0!==C[1]?C[1]:0;return[4,Promise.all([this.tournamentLeaders.scrollView.unlistenEvents(),this.tournamentLeaders.scrollView.scrollToTop(n,.1).then(function(){w.tournamentLeaders.scrollView.scrollView.enabled=!1,w.tournamentLeaders.scrollView.listenEvents()}),this.leaderSkeletons.map(function(w,C){return w.show(C*k,n)})])];case 1:E.sent();return[2]}})}),function(n){return K.apply(this,arguments)})},{key:"hideLoading",value:(W=N(function(n){return _ts_generator(this,function(w){switch(w.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(w){return w.hide(n)}))];case 1:w.sent();return[2]}})}),function(n){return W.apply(this,arguments)})},{key:"runShowUpAnimation",value:(q=N(function(n){var w,k;var C=arguments;return _ts_generator(this,function(E){switch(E.label){case 0:w=!(C.length>1&&void 0!==C[1])||C[1],k=w?0:.1;return[4,this.tournamentLeaders.playShowLeadersAnimation(n,k)];case 1:E.sent();return[4,this.tournamentLeaders.scrollToPlayerLeader(1.5,n)];case 2:E.sent();return[2]}})}),function(n){return q.apply(this,arguments)})},{key:"tryPlayConfettiEffect",value:function(n){if(!(n>10)){var w,k=L(this.paperConfetti);try{for(k.s();!(w=k.n()).done;)w.value.play()}catch(n){k.e(n)}finally{k.f()}H.playSound(nI.LEADERBOARD_TRIUMPH)}}},{key:"updateTitleWithPlayerName",value:function(n){void 0!==n&&(this.titleLocalizer.enabled=!0,this.titleLocalizer.setParams([n]))}},{key:"updateTitleTournamentTitle",value:function(n){this.titleLocalizer.enabled=!1,this.title.string=n}},{key:"updateEndTime",value:function(n){try{var w=YQ.getRelativeTime(n,Y5.getCurrentLocale(),{style:"short"});this.timeLocalizer.key="game.endsIn",this.timeLocalizer.setParams([w])}catch(n){this.timeLocalizer.key="game.endsSoon"}}},{key:"updateTournamentBanner",value:(V=N(function(n,w){var k,C,E;return _ts_generator(this,function(_){switch(_.label){case 0:this.banner.spriteFrame=null;k=F.getAsset("".concat(eb[n],"/spriteFrame"),e7);C=k;if(C)return[3,2];this.bannerMask.active=!0,this.bannerLoadingRing.active=!0;return[4,F.loadThemeTournamentAsync(n)];case 1:C=k=_.sent();_.label=2;case 2:E=k;if(E)return[3,4];return[4,F.loadThemeTournamentAsync(eu.SUMMER)];case 3:E=k=_.sent();_.label=4;case 4:this.banner&&k&&!w.aborted&&(this.banner.spriteFrame=k,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1);return[2]}})}),function(n,w){return V.apply(this,arguments)})},{key:"updatePlayerCount",value:function(n){var w=Y$.getShortNumber(n,3);1===n?this.playerCountLocalizer.key="game.player":(this.playerCountLocalizer.key="game.nPlayers",this.playerCountLocalizer.setParams([w]))}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLocalizer.key="status.loading"}},{key:"getLeadersPayload",value:(G=N(function(n){var w,k,C,E,_,T,I,D,M;return _ts_generator(this,function(N){switch(N.label){case 0:w=Y3.getLeaderboardName(n);if(!w)return[2,null];return[4,sN.getAllLeaderboardAsync(n)];case 1:k=N.sent();if(!k)return[2,null];E=YJ.vals(k.leaders),_=Y4.getPlayerId(),T={leaders:[],amountPlayer:k.amountPlayer},I=L(E);try{for(I.s();!(C=I.n()).done;){D=C.value;D.playerId===_?(T.player=D,T.leaders.push(D)):T.leaders.push(D)}}catch(n){I.e(n)}finally{I.f()}if(!!T.player)return[3,3];return[4,Y3.getLeadersByPlayerIdsAsync(w,[_])];case 2:M=N.sent();M&&M.length>0&&(T.player=M[0],T.leaders.push(M[0]));N.label=3;case 3:return[2,T]}})}),function(n){return G.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(n){this.playButton.active=!n,this.continueButton.active=n,this.replayButton.active=n}},{key:"handleOnPlay",value:(U=N(function(){var n,w,k;return _ts_generator(this,function(C){switch(C.label){case 0:n=this.tournamentPayload.id||"";if(en.validateTournamentExpired(n))return[2,(this.close(),this.node.scene.emit(sO.RELOAD_TOURNAMENT),void ei.showNotificationScreenWithLocalizedKey("error.tourEnded",2))];C.label=1;case 1:C.trys.push([1,4,9,10]);ei.showLoadingScreen();return[4,s2.setMatchCustomDataAsync({level:1,score:0})];case 2:C.sent();return[4,this.processJoinTournament()];case 3:C.sent();return[3,10];case 4:w=C.sent();if(YJ.hasOwn(w,"code")&&"USER_INPUT"===w.code)return[2];C.label=5;case 5:C.trys.push([5,7,,8]);return[4,this.processContinueTournament()];case 6:C.sent();return[3,8];case 7:k=C.sent();if(YJ.hasOwn(k,"code")&&"USER_INPUT"===k.code)return[2];console.error("processPlayButtonPressed",k),ei.showNotificationScreenWithLocalizedKey("error.tourJoinFail",2);return[3,8];case 8:return[3,10];case 9:ei.closeLoadingScreen();return[7];case 10:return[2]}})}),function(){return U.apply(this,arguments)})},{key:"processJoinTournament",value:(z=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,2,,3]);return[4,this.joinTournamentAsync()];case 1:w.sent(),el.switchScene(ec.GAME_SCENE,{level:1});return[3,3];case 2:n=w.sent();throw console.warn("processJoinTournament",n),n;case 3:return[2]}})}),function(){return z.apply(this,arguments)})},{key:"processContinueTournament",value:(M=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:w.trys.push([0,2,,3]);return[4,this.continueTournamentAsync()];case 1:w.sent(),el.switchScene(ec.GAME_SCENE,{level:1});return[3,3];case 2:n=w.sent();throw console.warn("processContinueTournament",n),n;case 3:return[2]}})}),function(){return M.apply(this,arguments)})},{key:"joinTournamentAsync",value:(D=N(function(){var n;return _ts_generator(this,function(w){switch(w.label){case 0:n=this.tournamentPayload.id||"";return[4,s2.joinTournamentAsync(n)];case 1:w.sent();return[2]}})}),function(){return D.apply(this,arguments)})},{key:"continueTournamentAsync",value:(I=N(function(){var n,w;return _ts_generator(this,function(k){switch(k.label){case 0:w=null!==(n=GameSDK.context.getID())&&void 0!==n?n:"";return[4,s2.continueTournamentAsync(w)];case 1:k.sent();return[2]}})}),function(){return I.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var n,w,k=(null!==(n=null===(w=this.payload)||void 0===w?void 0:w.screenData)&&void 0!==n?n:{}).tournamentContextType;switch(void 0===k?"tournament_start":k){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}},{key:"setInteractableButtons",value:function(n){this.screen.backgroundMask.getComponent(eI).interactable=n}}]),P}(eL)).prototype,"title",[Ye],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YT=n(Y_.prototype,"titleLocalizer",[Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YP=n(Y_.prototype,"timeLocalizer",[Yn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YR=n(Y_.prototype,"playerCountLocalizer",[Yi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YI=n(Y_.prototype,"tournamentLeaders",[Yr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YO=n(Y_.prototype,"topLeaders",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YL=n(Y_.prototype,"playButton",[Yo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YD=n(Y_.prototype,"continueButton",[Ys],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YM=n(Y_.prototype,"replayButton",[Yl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YN=n(Y_.prototype,"banner",[Yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yz=n(Y_.prototype,"bannerLoadingRing",[Yc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YB=n(Y_.prototype,"bannerMask",[Yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YF=n(Y_.prototype,"leaderSkeletons",[Yp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yx=n(Y_.prototype,"paperConfetti",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YU=n(Y_.prototype,"container",[Yf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YG=n(Y_.prototype,"tempContainer",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n(Y_.prototype,"updateInfo",[Yg],Object.getOwnPropertyDescriptor(Y_.prototype,"updateInfo"),Y_.prototype),n(Y_.prototype,"loadLeaders",[Ym],Object.getOwnPropertyDescriptor(Y_.prototype,"loadLeaders"),Y_.prototype),n(Y_.prototype,"showLoading",[Yb],Object.getOwnPropertyDescriptor(Y_.prototype,"showLoading"),Y_.prototype),n(Y_.prototype,"hideLoading",[Yw],Object.getOwnPropertyDescriptor(Y_.prototype,"hideLoading"),Y_.prototype),n(Y_.prototype,"runShowUpAnimation",[YS],Object.getOwnPropertyDescriptor(Y_.prototype,"runShowUpAnimation"),Y_.prototype),n(Y_.prototype,"tryPlayConfettiEffect",[Yk],Object.getOwnPropertyDescriptor(Y_.prototype,"tryPlayConfettiEffect"),Y_.prototype),n(Y_.prototype,"updatePlayerCount",[YC],Object.getOwnPropertyDescriptor(Y_.prototype,"updatePlayerCount"),Y_.prototype),YE=Y_))||YE);ew._RF.pop(),ew._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,eS.ccclass)("TournamentLeader")(function(n){w(o,n);var E=k(o);function o(){return C(this,o),E.apply(this,arguments)}return T(o)}(NM));ew._RF.pop()}}});(function(n){n("virtual:///prerequisite-imports/main","chunks:///main.js")})(function(n,w){System.register(n,[w],function(n,w){return{setters:[function(w){var k={};for(var C in w)if("default"!==C&&"__esModule"!==C)k[C]=w[C];n(k)}],execute:function(){}}})});