function _instanceof(g,E){if(null!=E&&"undefined"!=typeof Symbol&&E[Symbol.hasInstance])return!!E[Symbol.hasInstance](g);return g instanceof E}function _type_of(g){return g&&"undefined"!=typeof Symbol&&g.constructor===Symbol?"symbol":typeof g}function _ts_generator(g,E){var _,k,C,A,T={label:0,sent:function(){if(1&C[0])throw C[1];return C[1]},trys:[],ops:[]};return A={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(A[Symbol.iterator]=function(){return this}),A;function verb(g){return function(E){return step([g,E])}}function step(A){if(_)throw new TypeError("Generator is already executing.");while(T)try{if(_=1,k&&(C=2&A[0]?k.return:A[0]?k.throw||((C=k.return)&&C.call(k),0):k.next)&&!(C=C.call(k,A[1])).done)return C;if(k=0,C)A=[2&A[0],C.value];switch(A[0]){case 0:case 1:C=A;break;case 4:T.label++;return{value:A[1],done:false};case 5:T.label++;k=A[1];A=[0];continue;case 7:A=T.ops.pop();T.trys.pop();continue;default:if(C=T.trys,!(C=C.length>0&&C[C.length-1])&&(6===A[0]||2===A[0])){T=0;continue}if(3===A[0]&&(!C||A[1]>C[0]&&A[1]<C[3])){T.label=A[1];break}if(6===A[0]&&T.label<C[1]){T.label=C[1];C=A;break}if(C&&T.label<C[2]){T.label=C[2];T.ops.push(A);break}if(C[2])T.ops.pop();T.trys.pop();continue}A=E.call(g,T)}catch(g){A=[6,g];k=0}finally{_=C=0}if(5&A[0])throw A[1];return{value:A[0]?A[1]:void 0,done:true}}}System.register("chunks:///main.js",["cc"],function(g,E){var _,k,C,A,T,R,I,L,P,O,B,N,D,M,F,U,z,x,G,V,K,H,q,W,j,X,Y,J,Q,Z,$,ee,en,ei,ea,er,eo,es,el,eu,ec,eh,ep,ef,ey,ev,eg,em,eb,ew,eS,eE,e_,ek,eC,eA,eT,eR,eI,eP,eO,eB,eN,eD,eM,eF,eU,ez,ex,eG,eV,eK,eH,eq,eW,ej,eX,eY,eJ,eQ,eZ,e$,e0,e1,e2,e4;return{setters:[function(g){_=g.cclegacy,k=g._decorator,C=g.Node,A=g.Color,T=g.Canvas,R=g.UITransform,I=g.instantiate,L=g.Label,P=g.RichText,O=g.Toggle,B=g.Button,N=g.director,D=g.Component,M=g.AudioSource,F=g.resources,U=g.AudioClip,z=g.CCString,x=g.tween,G=g.Animation,V=g.CCInteger,K=g.CCFloat,H=g.Widget,q=g.Layout,W=g.view,j=g.screen,X=g.math,Y=g.isCCObject,J=g.CCBoolean,Q=g.game,Z=g.ccenum,$=g.find,ee=g.Prefab,en=g.JsonAsset,ei=g.AnimationClip,ea=g.ImageAsset,er=g.SpriteFrame,eo=g.Sprite,es=g.Enum,el=g.easing,eu=g.UIOpacity,ec=g.EventHandler,eh=g.animation,ep=g.Input,ef=g.Graphics,ey=g.profiler,ev=g.sys,eg=g.EventTarget,em=g.Vec3,eb=g.View,ew=g.ProgressBar,eS=g.Vec2,eE=g.Font,e_=g.Director,ek=g.Layers,eC=g.randomRangeInt,eA=g.pseudoRandomRangeInt,eT=g.pseudoRandom,eR=g.randomRange,eI=g.Pool,eP=g.repeat,eO=g.lerp,eB=g.approx,eN=g.EPSILON,eD=g.RealCurve,eM=g.Gradient,eF=g.bits,eU=g.random,ez=g.Material,ex=g.toRadian,eG=g.HorizontalTextAlignment,eV=g.Tween,eK=g.ParticleSystem2D,eH=g.ScrollView,eq=g.NodeEventType,eW=g.Mask,ej=g.settings,eX=g.Settings,eY=g.AssetManager,eJ=g.input,eQ=g.macro,eZ=g.DynamicAtlasManager,e$=g.ResolutionPolicy,e0=g.Texture2D,e1=g.UIRenderer,e2=g.CCObject,e4=g.Game}],execute:function(){function e(g,E){var _=Object.keys(g);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(g);E&&(k=k.filter(function(E){return Object.getOwnPropertyDescriptor(g,E).enumerable})),_.push.apply(_,k)}return _}function De(g){for(var E=1;E<arguments.length;E++){var _=null!=arguments[E]?arguments[E]:{};E%2?e(Object(_),!0).forEach(function(E){Ge(g,E,_[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(g,Object.getOwnPropertyDescriptors(_)):e(Object(_)).forEach(function(E){Object.defineProperty(g,E,Object.getOwnPropertyDescriptor(_,E))})}return g}function Me(g,E,_,k,C,A,T){try{var R=g[A](T),I=R.value}catch(g){return void _(g)}R.done?E(I):Promise.resolve(I).then(k,C)}function Be(g){return function(){var E=this,_=arguments;return new Promise(function(k,C){var A=g.apply(E,_);function r(g){Me(A,k,C,r,s,"next",g)}function s(g){Me(A,k,C,r,s,"throw",g)}r(void 0)})}}function Fe(g,E){if(!_instanceof(g,E))throw new TypeError("Cannot call a class as a function")}function xe(g,E){for(var _=0;_<E.length;_++){var k=E[_];k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(g,ot(k.key),k)}}function Ue(g,E,_){return E&&xe(g.prototype,E),_&&xe(g,_),Object.defineProperty(g,"prototype",{writable:!1}),g}function Ge(g,E,_){return(E=ot(E))in g?Object.defineProperty(g,E,{value:_,enumerable:!0,configurable:!0,writable:!0}):g[E]=_,g}function ze(g,E){if("function"!=typeof E&&null!==E)throw new TypeError("Super expression must either be null or a function");g.prototype=Object.create(E&&E.prototype,{constructor:{value:g,writable:!0,configurable:!0}}),Object.defineProperty(g,"prototype",{writable:!1}),E&&He(g,E)}function Ve(g){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)})(g)}function He(g,E){return(He=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(g,E){return g.__proto__=E,g})(g,E)}function qe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(g){return!1}}function We(){return(We=qe()?Reflect.construct.bind():function(g,E,_){var k=[null];k.push.apply(k,E);var C=new(Function.bind.apply(g,k));return _&&He(C,_.prototype),C}).apply(null,arguments)}function je(g){var E="function"==typeof Map?new Map:void 0;return(je=function(g){if(null===g||(_=g,-1===Function.toString.call(_).indexOf("[native code]")))return g;var _;if("function"!=typeof g)throw new TypeError("Super expression must either be null or a function");if(void 0!==E){if(E.has(g))return E.get(g);E.set(g,i)}function i(){return We(g,arguments,Ve(this).constructor)}return i.prototype=Object.create(g.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),He(i,g)})(g)}function Ke(g){if(void 0===g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return g}function Ye(g,E){if(E&&("object"==(void 0===E?"undefined":_type_of(E))||"function"==typeof E))return E;if(void 0!==E)throw new TypeError("Derived constructors may only return object or undefined");return Ke(g)}function Xe(g){var E=qe();return function(){var _,k=Ve(g);if(E){var C=Ve(this).constructor;_=Reflect.construct(k,arguments,C)}else _=k.apply(this,arguments);return Ye(this,_)}}function Qe(g,E){for(;!Object.prototype.hasOwnProperty.call(g,E)&&null!==(g=Ve(g)););return g}function Je(){return(Je="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(g,E,_){var k=Qe(g,E);if(k){var C=Object.getOwnPropertyDescriptor(k,E);return C.get?C.get.call(arguments.length<3?g:_):C.value}}).apply(this,arguments)}function Ze(g,E,_,k){return(Ze="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(g,E,_,k){var C,A=Qe(g,E);if(A){if((C=Object.getOwnPropertyDescriptor(A,E)).set)return C.set.call(k,_),!0;if(!C.writable)return!1}if(C=Object.getOwnPropertyDescriptor(k,E)){if(!C.writable)return!1;C.value=_,Object.defineProperty(k,E,C)}else Ge(k,E,_);return!0})(g,E,_,k)}function $e(g,E,_,k,C){if(!Ze(g,E,_,k||g)&&C)throw new TypeError("failed to set property");return _}function et(g,E){return function(g){if(Array.isArray(g))return g}(g)||function(g,E){var _=null==g?null:"undefined"!=typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(null!=_){var k,C,A,T,R=[],I=!0,L=!1;try{if(A=(_=_.call(g)).next,0===E){if(Object(_)!==_)return;I=!1}else for(;!(I=(k=A.call(_)).done)&&(R.push(k.value),R.length!==E);I=!0);}catch(g){L=!0,C=g}finally{try{if(!I&&null!=_.return&&(T=_.return(),Object(T)!==T))return}finally{if(L)throw C}}return R}}(g,E)||nt(g,E)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(g){return function(g){if(Array.isArray(g))return it(g)}(g)||function(g){if("undefined"!=typeof Symbol&&null!=g[Symbol.iterator]||null!=g["@@iterator"])return Array.from(g)}(g)||nt(g)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nt(g,E){if(g){if("string"==typeof g)return it(g,E);var _=Object.prototype.toString.call(g).slice(8,-1);return"Object"===_&&g.constructor&&(_=g.constructor.name),"Map"===_||"Set"===_?Array.from(g):"Arguments"===_||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(_)?it(g,E):void 0}}function it(g,E){(null==E||E>g.length)&&(E=g.length);for(var _=0,k=new Array(E);_<E;_++)k[_]=g[_];return k}function at(g,E){var _="undefined"!=typeof Symbol&&g[Symbol.iterator]||g["@@iterator"];if(!_){if(Array.isArray(g)||(_=nt(g))||E&&g&&"number"==typeof g.length){_&&(g=_);var k=0,a=function(){};return{s:a,n:function(){return k>=g.length?{done:!0}:{done:!1,value:g[k++]}},e:function(g){throw g},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var C,A=!0,T=!1;return{s:function(){_=_.call(g)},n:function(){var g=_.next();return A=g.done,g},e:function(g){T=!0,C=g},f:function(){try{A||null==_.return||_.return()}finally{if(T)throw C}}}}function ot(g){var E=function(g,E){if("object"!=(void 0===g?"undefined":_type_of(g))||null===g)return g;var _=g[Symbol.toPrimitive];if(void 0!==_){var k=_.call(g,E||"default");if("object"!=(void 0===k?"undefined":_type_of(k)))return k;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===E?String:Number)(g)}(g,"string");return"symbol"==(void 0===E?"undefined":_type_of(E))?E:String(E)}function rt(g,E,_,k){_&&Object.defineProperty(g,E,{enumerable:_.enumerable,configurable:_.configurable,writable:_.writable,value:_.initializer?_.initializer.call(k):void 0})}function st(g,E,_,k,C){var A={};return Object.keys(k).forEach(function(g){A[g]=k[g]}),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=_.slice().reverse().reduce(function(_,k){return k(g,E,_)||_},A),C&&void 0!==A.initializer&&(A.value=A.initializer?A.initializer.call(C):void 0,A.initializer=void 0),void 0===A.initializer&&(Object.defineProperty(g,E,A),A=null),A}var g,e3,e5,e6,e8,e9,e7,te;_._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var tn=k.ccclass,ti=k.property;g=tn("internal.DebugViewRuntimeControl"),e3=ti(C),e5=ti(C),e6=ti(C),g((e9=st((e8=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"compositeModeToggle",e9,Ke(g)),rt(g,"singleModeToggle",e7,Ke(g)),rt(g,"EnableAllCompositeModeButton",te,Ke(g)),g._single=0,g.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],g.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],g.strMisc=["CSM Layer Coloration","Lighting With Albedo"],g.compositeModeToggleList=[],g.singleModeToggleList=[],g.miscModeToggleList=[],g.textComponentList=[],g.labelComponentList=[],g.textContentList=[],g._currentColorIndex=0,g.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],g.color=[A.WHITE,A.BLACK,A.RED,A.GREEN,A.BLUE],g}return Ue(n,[{key:"start",value:function(){if(this.node.parent.getComponent(T)){var g=this.node.parent.getComponent(R),E=.5*g.width,_=.5*g.height,k=.1*E-E,C=_-.1*_,N=this.node.getChildByName("MiscMode"),D=I(N);D.parent=this.node,D.name="Buttons";var M=I(N);M.parent=this.node,M.name="Titles";for(var F=0;F<2;F++){var U=I(this.EnableAllCompositeModeButton.getChildByName("Label"));U.setPosition(k+(F>0?450:150),C,0),U.setScale(.75,.75,.75),U.parent=M;var z=U.getComponent(L);z.string=F?"----------Composite Mode----------":"----------Single Mode----------",z.color=A.WHITE,z.overflow=0,this.labelComponentList[this.labelComponentList.length]=z}C-=20;for(var x=0,G=0;G<this.strSingle.length;G++,x++){G===this.strSingle.length>>1&&(k+=200,x=0);var V=G?I(this.singleModeToggle):this.singleModeToggle;V.setPosition(k,C-20*x,0),V.setScale(.5,.5,.5),V.parent=this.singleModeToggle.parent;var K=V.getComponentInChildren(P);K.string=this.strSingle[G],this.textComponentList[this.textComponentList.length]=K,this.textContentList[this.textContentList.length]=K.string,V.on(O.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[G]=V}k+=200,this.EnableAllCompositeModeButton.setPosition(k+15,C,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(B.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=D;var H=this.EnableAllCompositeModeButton.getComponentInChildren(L);this.labelComponentList[this.labelComponentList.length]=H;var q=I(this.EnableAllCompositeModeButton);q.setPosition(k+90,C,0),q.setScale(.5,.5,.5),q.on(B.EventType.CLICK,this.changeTextColor,this),q.parent=D,(H=q.getComponentInChildren(L)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=H;var W=I(this.EnableAllCompositeModeButton);W.setPosition(k+200,C,0),W.setScale(.5,.5,.5),W.on(B.EventType.CLICK,this.hideUI,this),W.parent=this.node.parent,(H=W.getComponentInChildren(L)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=H,this.hideButtonLabel=H,C-=40;for(var j=0;j<this.strMisc.length;j++){var X=I(this.compositeModeToggle);X.setPosition(k,C-20*j,0),X.setScale(.5,.5,.5),X.parent=N;var Y=X.getComponentInChildren(P);Y.string=this.strMisc[j],this.textComponentList[this.textComponentList.length]=Y,this.textContentList[this.textContentList.length]=Y.string,X.getComponent(O).isChecked=!!j,X.on(O.EventType.TOGGLE,j?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[j]=X}C-=150;for(var J=0;J<this.strComposite.length;J++){var Q=J?I(this.compositeModeToggle):this.compositeModeToggle;Q.setPosition(k,C-20*J,0),Q.setScale(.5,.5,.5),Q.parent=this.compositeModeToggle.parent;var Z=Q.getComponentInChildren(P);Z.string=this.strComposite[J],this.textComponentList[this.textComponentList.length]=Z,this.textContentList[this.textContentList.length]=Z.string,Q.on(O.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[J]=Q}}else console.error("debug-view-runtime-control should be child of Canvas")}},{key:"isTextMatched",value:function(g,E){var _=new String(g),k=_.search(">");return -1===k?g===E:(_=(_=_.substr(k+1)).substr(0,_.search("<")))===E}},{key:"toggleSingleMode",value:function(g){for(var E=N.root.debugView,_=g.getComponentInChildren(P),k=0;k<this.strSingle.length;k++)this.isTextMatched(_.string,this.strSingle[k])&&(E.singleMode=k)}},{key:"toggleCompositeMode",value:function(g){for(var E=N.root.debugView,_=g.getComponentInChildren(P),k=0;k<this.strComposite.length;k++)this.isTextMatched(_.string,this.strComposite[k])&&E.enableCompositeMode(k,g.isChecked)}},{key:"toggleLightingWithAlbedo",value:function(g){N.root.debugView.lightingWithAlbedo=g.isChecked}},{key:"toggleCSMColoration",value:function(g){N.root.debugView.csmLayerColoration=g.isChecked}},{key:"enableAllCompositeMode",value:function(g){var E=N.root.debugView;E.enableAllCompositeMode(!0);for(var _=0;_<this.compositeModeToggleList.length;_++)this.compositeModeToggleList[_].getComponent(O).isChecked=!0;var k=this.miscModeToggleList[0].getComponent(O);k.isChecked=!1,E.csmLayerColoration=!1,(k=this.miscModeToggleList[1].getComponent(O)).isChecked=!0,E.lightingWithAlbedo=!0}},{key:"hideUI",value:function(g){var E=this.node.getChildByName("Titles"),_=!E.active;this.singleModeToggleList[0].parent.active=_,this.miscModeToggleList[0].parent.active=_,this.compositeModeToggleList[0].parent.active=_,this.EnableAllCompositeModeButton.parent.active=_,E.active=_,this.hideButtonLabel.string=_?"Hide UI":"Show UI"}},{key:"changeTextColor",value:function(g){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var E=0;E<this.textComponentList.length;E++)this.textComponentList[E].string=this.strColor[this._currentColorIndex]+this.textContentList[E]+"</color>";for(var _=0;_<this.labelComponentList.length;_++)this.labelComponentList[_].color=this.color[this._currentColorIndex]}},{key:"onLoad",value:function(){}},{key:"update",value:function(g){}}]),n}(D)).prototype,"compositeModeToggle",[e3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e7=st(e8.prototype,"singleModeToggle",[e5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),te=st(e8.prototype,"EnableAllCompositeModeButton",[e6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),e8));_._RF.pop(),_._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var ta=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,g)).audioSource=_,k}return Ue(n,[{key:"play",value:function(g){if(g){var E=g.volume,_=void 0===E?1:E,k=g.loop,C=void 0!==k&&k;this.audioSource.volume=_,this.audioSource.loop=C}this.audioSource.play()}},{key:"pause",value:function(){this.audioSource.pause()}},{key:"resume",value:function(){this.audioSource.state===M.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function(){this.audioSource.stop()}},{key:"setVolume",value:function(g){this.audioSource.volume=g}},{key:"getVolume",value:function(){return this.audioSource.volume}},{key:"getAudioSource",value:function(){return this.audioSource}}]),n}(GameCore.Plugins.Audio.BaseAudioPlayer);_._RF.pop(),_._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var tr=GameCore,to=tr.Plugins.Audio.BaseChannelManager,ts=tr.Utils.Array,tl=function(g){ze(i,g);var E,_=Xe(i);function i(g,E){var k;return Fe(this,i),(k=_.call(this,E)).allowMultipleTracking={},k.handleLoadedAudio=function(g,E){var _=k.node.addComponent(M);return _.clip=E,_.playOnAwake=!1,new ta(g,_)},k.node=g,k}return Ue(i,[{key:"playing",value:function(g){var E,_=null===(E=this.getAudioClip(g))||void 0===E?void 0:E.audioPlayer;return!!_&&_.getAudioSource().state===M.AudioState.PLAYING}},{key:"onLoadAudio",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(E){_=this;return[2,new Promise(function(E,k){F.load(g,U,function(C,A){try{if(C)throw new Error(C.message);if(!_.node.isValid)return;var T=_.handleLoadedAudio(g,A);E(T)}catch(g){_instanceof(g,Error)?k(g):k(new Error("Audio load: Unknown error"))}})})]})}),function(g,_){return E.apply(this,arguments)})},{key:"playWithRealConfig",value:function(g,E){if(this.isCanPlay(E)){if(E){var _=E.volume,k=void 0===_?1:_,C=E.allowMultiple,A=void 0!==C&&C;if(E.volume=this.getVolume()*k,A){var T=g.getAudioSource().clip;if(!T)return;return void this.requestDuplicateAudioPlayer(g.getKey(),T,E).play(E)}}g.play(E)}}},{key:"isCanPlay",value:function(g){var E=this;if(g){var _=g.checkList;if((void 0===_?[]:_).some(function(g){var _=E.getAudioClip(g);return!!_&&_.audioPlayer.getAudioSource().state===M.AudioState.PLAYING}))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function(g,E,_){var k=this.getDuplicateAudioFromPool(g);if(k){if(_){var C=k.key,A=_.volume,T=void 0===A?1:A;this.setAudioClip(C,{volume:T})}return k.audioPlayer}var R="".concat(g,"_").concat(this.allowMultipleTracking[g].currentPostFix),I=this.handleLoadedAudio(R,E);return this.allowMultipleTracking[g].list.push({audioPlayer:I,key:R}),this.allowMultipleTracking[g].currentPostFix+=1,this.setAudioClip(R,{audioPlayer:I,volume:1}),I}},{key:"getDuplicateAudioFromPool",value:function(g){if(this.allowMultipleTracking[g]){var E=this.allowMultipleTracking[g].list,_=ts.search(E,function(g){return g.audioPlayer.getAudioSource().state!==M.AudioState.PLAYING});if(_)return _}else this.allowMultipleTracking[g]={currentPostFix:1,list:[]};return null}}]),i}(to);_._RF.pop();var tu,tc,th,tp,td,tf=!1;_._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var ty,tv,tg,tm,tb,tw=k.ccclass,tS=k.property,tE=globalThis.game,t_=tE.audio,tk=tE.player,tC=(tu=tw("Music"),tc=tS(z),tu((td=st((tp=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"channelId",td,Ke(g)),g.channel=null,g.isMute=!1,g.volume=1,g}return Ue(n,[{key:"__preload",value:function(){this.makePersistent(),this.channel=new tl(this.node,this.channelId),t_.addChannel(this.channel)}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"playing",value:function(g){var E,_;return null!==(E=null===(_=this.channel)||void 0===_?void 0:_.playing(g))&&void 0!==E&&E}},{key:"play",value:function(g,E){if(!this.isMusicEnable())return Promise.resolve();var _=null!=E?E:{};return _.loop||(_.loop=!0),t_.play(g,_,this.channelId)}},{key:"isMusicEnable",value:function(){return!!tk.getPlayerSetting("music")}},{key:"setVolume",value:function(g){this.volume=g,this.isMute||t_.setVolume(g,this.channelId)}},{key:"getVolume",value:function(){return t_.getVolume(this.channelId)}},{key:"pause",value:function(g){t_.pause(g,this.channelId)}},{key:"resume",value:function(g){this.isMusicEnable()&&t_.resume(g,this.channelId)}},{key:"stop",value:function(g){t_.stop(g,this.channelId)}},{key:"mute",value:function(g){this.isMute=g,g?t_.mute(this.channelId):(this.setVolume(this.volume),t_.unmute(this.channelId))}}]),n}(D)).prototype,"channelId",[tc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),th=tp))||th);_._RF.pop(),_._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var tA=k.ccclass,tT=k.property,tR=globalThis.game,tI=tR.audio,tL=tR.player,tP=(ty=tA("Sound"),tv=tT(z),ty((tb=st((tm=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"channelId",tb,Ke(g)),g.channel=null,g}return Ue(n,[{key:"__preload",value:function(){this.channel=new tl(this.node,this.channelId),tI.addChannel(this.channel)}},{key:"onLoad",value:function(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"removePersistent",value:function(){N.removePersistRootNode(this.node)}},{key:"play",value:function(g,E){return this.isSoundEnable()?tI.play(g,E,this.channelId):Promise.resolve()}},{key:"isSoundEnable",value:function(){return!!tL.getPlayerSetting("sound")}},{key:"setVolume",value:function(g){tI.setVolume(g,this.channelId)}},{key:"pause",value:function(g){tI.pause(g,this.channelId)}},{key:"resume",value:function(g){this.isSoundEnable()&&tI.resume(g,this.channelId)}},{key:"stop",value:function(g){tI.stop(g,this.channelId)}},{key:"stopAll",value:function(){tI.stopAll(this.channelId)}},{key:"mute",value:function(g){g?tI.mute(this.channelId):tI.unmute(this.channelId)}}]),n}(D)).prototype,"channelId",[tv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),tg=tm))||tg);_._RF.pop(),_._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);var tO,tB,tN,tD,tM,tF,tU,tz,tx,tG,tV,tK,tH,tq,tW,tj,tX,tY,tJ,tQ,tZ=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"elasticOut",value:function(g,E,_){var k=E||.1,C=_||.1;if(0===g)return 0;if(1===g)return 1;var A=C/4;return k<1?k=1:A=C*Math.asin(1/k)/(2*Math.PI),k*Math.pow(2,-10*g)*Math.sin(2*Math.PI*(g-A)/C)+1}},{key:"easeOutExpo",value:function(g){return 1===g?1:1-Math.pow(2,-10*g)}},{key:"easeInExpo",value:function(g){return 0===g?0:Math.pow(2,10*g-10)}},{key:"runTweenAsync",value:function(g,E){return new Promise(function(_){var k=g.call(function(){_({tween:g})}).start();E&&(E.aborted?(k.stop(),_({tween:g})):E.addAbortListener(function(){k.stop(),_({tween:g})}))})}},{key:"runOnUpdateAsync",value:function(g,E,_,k){return new Promise(function(C,A){var T=x(g).to(E,{},{onUpdate:function(g,E){if(void 0!==E)try{_(E)}catch(g){A(_instanceof(g,Error)?g:new Error(JSON.stringify(g)))}}}).call(function(){C({tween:T})}).start();k&&(k.aborted?(T.stop(),C({tween:T})):k.addAbortListener(function(){T.stop(),C({tween:T})}))})}},{key:"waitTweenAsync",value:function(g,E){return new Promise(function(_){var k=x({});k.delay(g),k.call(function(){_()}),k.start(),E&&(E.aborted?(k.stop(),_()):E.addAbortListener(function(){k.stop(),_()}))})}},{key:"runAnimationAsync",value:function(g,E,_){return void 0===_?new Promise(function(_){g.play(E),g.once(G.EventType.FINISHED,_)}):_.aborted?Promise.resolve():new Promise(function(k){_.addAbortListener(function(){g.off(G.EventType.FINISHED,k),g.stop(),k()}),g.play(E),g.once(G.EventType.FINISHED,k)})}}]),e}();_._RF.pop(),_._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var t$=k.ccclass,t0=k.property,t1=(tO=t$("AutoLayoutWrappee"),tB=t0({type:R}),tN=t0({type:R}),tO((tF=st((tM=Ue(function e(){Fe(this,e),rt(this,"wrapeeContainer",tF,this),rt(this,"wrapee",tU,this)})).prototype,"wrapeeContainer",[tB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tU=st(tM.prototype,"wrapee",[tN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tD=tM))||tD),t2=(tz=t$("AutoLayout"),tx=t0({displayName:"Use Auto Layout"}),tG=t0({type:[t1],displayName:"Children",visible:function(){return this.useAutoLayout}}),tV=t0({visible:!1,serializable:!0}),tK=t0({type:V,displayName:"Selected Index",visible:function(){return this.useAutoLayout}}),tH=t0({type:K,displayName:"Deselected Icon Width",group:"Edge Icons",visible:function(){return this.useAutoLayout}}),tq=t0({visible:!1,serializable:!0}),tz((tX=st((tj=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"useAutoLayout",tX,Ke(g)),rt(g,"children",tY,Ke(g)),g.mappedChildren=[],rt(g,"selected",tJ,Ke(g)),rt(g,"deselectedIconW",tQ,Ke(g)),g.tweens=[],g}return Ue(i,[{key:"selectedIndex",get:function(){return this.selected},set:function(g){this.selected=g,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(g){this.deselectedIconW=g,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map(function(g){var E=g.wrapeeContainer.getComponent(H);if(!E)throw new Error("AutoLayout: Widget component not found");return De(De({},g),{},{wrapeeContainerWidget:E})})}},{key:"updateLayout",value:function(g){var E=arguments.length>0&&void 0!==g&&g;if(this._layoutDirty||E){this.updateChildrenAnchors();var _,k=at(this.mappedChildren);try{for(k.s();!(_=k.n()).done;){var C=_.value;C.wrapeeContainerWidget.updateAlignment()}}catch(g){k.e(g)}finally{k.f()}}Je(Ve(i.prototype),"updateLayout",this).call(this,E)}},{key:"getSelectedWorldX",value:function(){var g=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?g.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*g.width:g.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(g){if(g<this.selectedIndex)return 0;if(g>this.selectedIndex)return 1;if(0===g){var E=this.mappedChildren[g].wrapeeContainer.width,_=this.deselectedIconWidth/2,k=this.paddingLeft;return((k+E+(E-_+this.spacingX))/2-k)/E}if(g===this.children.length-1){var C=this.mappedChildren[g].wrapeeContainer.width,A=C-this.deselectedIconWidth/2+this.spacingX;return((A+C+this.paddingRight)/2-A)/C}return .5}},{key:"updateChildrenAnchors",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=this,_=at(this.tweens);try{for(_.s();!(g=_.n()).done;)g.value.stop()}catch(g){_.e(g)}finally{_.f()}this.tweens=[];return[4,Promise.all([this.children.flatMap(function(g,_){return E.getChildrenAnchorsTweens(g,E.getAnchorX(_))}).map(function(g){return tZ.runTweenAsync(g)})])];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var g=this;this.children.forEach(function(E,_){var k=g.getAnchorX(_);E.wrapee.setAnchorPoint(k,E.wrapee.anchorY),E.wrapeeContainer.setAnchorPoint(k,E.wrapeeContainer.anchorY)})}},{key:"getChildrenAnchorsTweens",value:function(g,E){return[x(g.wrapee).to(.3,{anchorX:E},{easing:"sineInOut"}).call(function(){g.wrapee.setAnchorPoint(E,g.wrapee.anchorY)}),x(g.wrapeeContainer).to(.3,{anchorX:E},{easing:"sineInOut"}).call(function(){g.wrapeeContainer.setAnchorPoint(E,g.wrapeeContainer.anchorY)})]}}]),i}(q)).prototype,"useAutoLayout",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),tY=st(tj.prototype,"children",[tG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tJ=st(tj.prototype,"selected",[tV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),st(tj.prototype,"selectedIndex",[tK],Object.getOwnPropertyDescriptor(tj.prototype,"selectedIndex"),tj.prototype),st(tj.prototype,"deselectedIconWidth",[tH],Object.getOwnPropertyDescriptor(tj.prototype,"deselectedIconWidth"),tj.prototype),tQ=st(tj.prototype,"deselectedIconW",[tq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tW=tj))||tW);_._RF.pop(),_._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);var t4="view-resize",t3="view-resized",t5="request-view-resize",t6="layout-changed",t8="gameplay-update-config",t9="opened-skip-overlay",t7="closed-skip-overlay",ne="result-scene-replay",nn="result-scene-home",ni="upgrade-dynamic-atlas",na="asset-quality-change",nr="change-quality-assets",no="widget-resized";_._RF.pop(),_._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);var ns=function(){function e(){Fe(this,e)}return Ue(e,[{key:"getWindowSizeVsWorldGameRatio",value:function(){var g=W.getVisibleSize(),E=j.windowSize.width,_=window.devicePixelRatio;return E/(_=_>2?2:_)/g.width}},{key:"getBoundingBoxTo",value:function(g,E){var _=X.mat4();X.Mat4.fromSRT(_,E.getRotation(),E.getPosition(),E.getScale());var k=E.getComponent(R);if(!k)throw new Error("Node must have UITransform component");var C=k.anchorPoint,A=k.contentSize,T=A.width,I=A.height,L=new X.Rect(-C.x*T,-C.y*I,T,I),P=X.mat4();if(X.Mat4.multiply(P,g,_),L.transformMat4(P),!E.children||0===E.children.length)return L;var O,B=E.children,N=E.getWorldMatrix(),D=at(B);try{for(D.s();!(O=D.n()).done;){var M=O.value;if(null!=M&&M.active){if(M.getComponent(R)){var F=this.getBoundingBoxTo(N,M);F&&X.Rect.union(L,L,F)}}}}catch(g){D.e(g)}finally{D.f()}return L}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getBoundingBoxToWorld",value:function(g){if(g.parent){var E=g.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(E,g)}var _=g.getComponent(R);if(!_)throw new Error("Node must have UITransform component");return _.getBoundingBox()}},{key:"worldSizeToCssSize",value:function(g){return g*this.inst.getWindowSizeVsWorldGameRatio()}},{key:"cssSizeToWorldSize",value:function(g){return g/this.inst.getWindowSizeVsWorldGameRatio()}},{key:"getScreenWidthCss",value:function(){var g=document,E=g.body,_=g.documentElement,k=E.clientWidth,C=_.clientWidth;return Math.max(C,k)||0}},{key:"getScreenHeightCss",value:function(){var g=document,E=g.body,_=g.documentElement,k=E.clientHeight,C=_.clientHeight;return Math.max(C,k)||0}}]),e}();_._RF.pop(),_._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);var nl,nu,nc,nh,np=GameCore.Utils,nf=np.Array,ny=np.Object,nv=np.Valid,ng=np.String,nm=globalThis.game.monitorError,nb="compUtils",nw="".concat(nb,"_validateProperty"),jn=function(g){return"".concat(nw,"_").concat(ng.capitalize(g))},nS="".concat(nb,"_getComponent"),nE=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"".concat(g," is missing the required property: <").concat(_,">"))).className=g,k.propertyName=_,k}return Ue(n)}(je(Error)),n_=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"".concat(g," is missing these required properties: [").concat(_.map(function(g){return g.propertyName}).join(", "),"]"))).className=g,k.errors=_,k}return Ue(n)}(je(Error)),nk=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"],nC=function(){function e(){Fe(this,e),this.validComponentCalled={}}return Ue(e,[{key:"validateRequiredComponents",value:function(g){var E,_=g.name,k=g.constructor,C=at(this.getRequiredComponentNames(k));try{for(C.s();!(E=C.n()).done;){var A=E.value;if(!g.getComponent(A))throw new Error("".concat(_,": Missing required ").concat(A," component"))}}catch(g){C.e(g)}finally{C.f()}}},{key:"validateRequiredProperties",value:function(g){var E,_=g.name,k=g.constructor,C=at(this.getRequiredPropNames(k));try{for(C.s();!(E=C.n()).done;){var A=E.value;if(!ny.hasOwn(g,A))throw new Error("".concat(_,": Missing required ").concat(A," property"));var T=this.getProperty(A,g);if(!Y(T))throw new Error("".concat(_,": ").concat(A," property is not a cc object"))}}catch(g){C.e(g)}finally{C.f()}}},{key:"validateCustomProperties",value:function(g){var E,_=g.name,k=at(this.getCustomPropNames(g));try{for(k.s();!(E=k.n()).done;){var C=E.value;if(!ny.hasOwn(g,C))throw new Error("".concat(_,": Missing required ").concat(C," property"));var A=this.getProperty(C,g);if(!Y(A))throw new Error("".concat(_,": ").concat(C," property is not a cc object"))}}catch(g){k.e(g)}finally{k.f()}}},{key:"getProperty",value:function(g,E){var _;if(ny.hasOwn(E,g))return(null!==(_=Object.getOwnPropertyDescriptor(E,g))&&void 0!==_?_:{}).value}},{key:"getProps",value:function(g){if(!ny.hasOwn(g,"__props__"))return[];var E=g.__props__;return Array.isArray(E)?E:[]}},{key:"getRequiredPropNames",value:function(g){return this.getProps(g).filter(function(E){return"node"!==E&&!!ny.hasOwn(g,E)&&!!Y(g[E])&&!E.startsWith("_")})}},{key:"getBaseComponentName",value:function(g){for(var E=0,_=nk;E<_.length;E++){var k=_[E];if(k.indexOf(g)>=0)return k}return g}},{key:"getRequiredComponentNames",value:function(g){var E=this;if(!ny.hasOwn(g,"_requireComponent"))return[];var _=g._requireComponent;return Array.isArray(_)?_.map(function(g){return E.getBaseComponentName(g)}):[]}},{key:"getCustomPropNames",value:function(g){var E=this,_=Object.keys(g),k=this.getProps(g.constructor);return nf.difference(_,k).filter(function(g){return g.indexOf("_")<0}).filter(function(_){if(!ny.hasOwn(g,_))return!1;var k=E.getProperty(_,g);return!(!nv.isObject(k)||!Y(k))})}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"required",value:function(g){var E=arguments.length>0&&void 0!==g?g:"both",t=function(g){if("function"==typeof E)return E(g);switch(E){case"null-check":return null!==g;case"undefined-check":return void 0!==g;case"both":return null!=g;default:return!1}};return function(g,E){if("function"==typeof g)throw new Error("The required decorator can only be applied to non-static class properties.");var _=jn(E);if(void 0!==g[_])throw new Error("The required decorator found that property name ".concat(_," already exists. The reserved method name ").concat(_," is used already or the decorator was applied multiple times."));g[_]=function(g){if(!t(this[E]))throw new nE(g,E)}}}},{key:"validateDecoratedProperties",value:function(g){var E,_=g.constructor.name,k=[],C=g;for(var A in C)if("function"==typeof C[A]&&(E=A,ng.matchStart(E,nw)))try{C[A]()}catch(g){if(_instanceof(g,nE)){k.push(g);continue}throw g}if(0!==k.length){var T=new n_(_,k);if(nv.isDebugger())throw T;console.error(T),null==nm||nm.sendException(T,{componentName:T.className,missingProperties:T.errors.map(function(g){return g.propertyName})})}}},{key:"getComponent",value:function(g){return function(E,_){if("function"==typeof E)throw new Error("The getComponent decorator can only be applied to non-static class properties.");var k,C=(k=_,"".concat(nS,"_").concat(ng.capitalize(k)));if(void 0!==E[C])throw new Error("The getComponent decorator found that property name ".concat(C," already exists. The reserved method name ").concat(C," is used already or the decorator was applied multiple times."));E[C]=function(E){E[_]=E.getComponent(g)}}}},{key:"getDecoratedComponent",value:function(g){var E,_=g;for(var k in _)"function"==typeof _[k]&&(E=k,ng.matchStart(E,nS)&&_[k](g))}},{key:"onlyRunInLifeCycle",value:function(g,E,_){var k=_.value;_.value=function(){if(this.enabledInHierarchy){for(var g=arguments.length,_=new Array(g),C=0;C<g;C++)_[C]=arguments[C];return k.apply(this,_)}console.info("Skipping method call ".concat(String(E)," because component ").concat(this.constructor.name," is not enabled in hierarchy"))}}},{key:"onlyRunInLifeCycleAsync",value:function(g,E,_){var k=_.value,C=function(){var g=Be(function(){var g,_,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:if(!this.enabledInHierarchy)return[3,2];for(g=A.length,_=new Array(g),C=0;C<g;C++)_[C]=A[C];return[4,k.apply(this,_)];case 1:return[2,T.sent()];case 2:return[2,(console.info("Skipping method call ".concat(String(E)," because component ").concat(this.constructor.name," is not enabled in hierarchy")),Promise.resolve())]}})});return function(){return g.apply(this,arguments)}}();_.value=C}},{key:"decorateComponent",value:function(g){this.getDecoratedComponent(g),this.validateDecoratedProperties(g)}},{key:"lazyValidateProperties",value:function(g,E){var _=!(arguments.length>1&&void 0!==E)||E;if(_){var k=g.constructor,C=k.name;if(!this.inst.validComponentCalled[C])try{this.inst.validateRequiredComponents(g),this.inst.validateRequiredProperties(g),this.inst.validateCustomProperties(g)}catch(E){g.enabled=!1,console.error(E)}finally{this.inst.validComponentCalled[C]=!0}}}}]),e}();_._RF.pop(),_._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);var nA=k.ccclass,nT=k.property;nl=nA("Background"),nu=nT(J),nl((nh=st((nc=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"fitHeight",nh,Ke(g)),g.resize=function(){if(g.fitHeight){var E=ns.cssSizeToWorldSize(ns.getScreenHeightCss());g.uiTransform.width=E*g.ratio,g.uiTransform.height=E}},g}return Ue(n,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.ratio=this.uiTransform.width/this.uiTransform.height,this.validateRequiredComponents(),this.listenGameEvents(),this.resize()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t3,this.resize)}},{key:"unlistenGameEvents",value:function(){Q.off(t3,this.resize)}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}}]),n}(D)).prototype,"fitHeight",[nu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nc));_._RF.pop(),_._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var nR="STARS_UPDATED",nI="PLAY_BUTTON_PRESS",nL="REQUEST_NAVIGATION",nP="REQUEST_NAVIGATION_ANIMATION",nO="DASHBOARD_EVENTS_BUTTON_PRESS";_._RF.pop(),_._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var nB=function(g){return g[g.store=0]="store",g[g.collections=1]="collections",g[g.home=2]="home",g[g.leaderboard=3]="leaderboard",g[g.tournaments=4]="tournaments",g}(nB||{});Z(nB),_._RF.pop(),_._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);var nN=GameCore.Utils.Array,nD=function(){function e(){Fe(this,e),this.callbacks=[],this.isAborted=!1,this.abortReason="",this.callbacks=[]}var g;return Ue(e,[{key:"aborted",get:function(){return this.isAborted}},{key:"reason",get:function(){return this.abortReason}},{key:"addAbortListener",value:function(g){this.callbacks.push(g)}},{key:"removeAbortListener",value:function(g){var E=nN.searchIndex(this.callbacks,function(E){return E===g});-1!==E?this.callbacks.splice(E,1):console.warn("Abort listener not found")}},{key:"abort",value:function(g){if(!this.isAborted){this.isAborted=!0,this.abortReason=g;var E,_=at(this.callbacks);try{for(_.s();!(E=_.n()).done;){var k=E.value;"function"==typeof k&&k()}}catch(g){_.e(g)}finally{_.f()}this.callbacks=[]}}},{key:"untilAborted",value:(g=Be(function(){var g;return _ts_generator(this,function(E){g=this;if(!this.isAborted)return[2,new Promise(function(E){g.addAbortListener(function(){return E()})})];return[2]})}),function(){return g.apply(this,arguments)})},{key:"call",value:function(g){this.aborted||g(this)}},{key:"callAsync",value:function(g){return this.aborted?Promise.resolve():g(this)}},{key:"chain",value:function(g){var E=this;_instanceof(g,e)?g.addAbortListener(function(){return E.abort()}):g.addEventListener("abort",function(){return E.abort()})}}],[{key:"hasBeenAborted",value:function(g){return null==g||g.aborted}}]),e}();_._RF.pop(),_._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var nM=function(g){return g.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",g.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",g.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",g.CLOUD_IDLE_ANIM="animations/CloudIdle",g.TORNADO_IDLE_ANIM="animations/TornadoIdle",g.TILE_BREAK_ANIM="animations/TileBreak",g.TILE_CLEAR_ANIM="animations/TileClear",g.TILE_SHAKE_ANIM="animations/TileShake",g.TILE_SKIN_FOLDER="loadable/tiles",g.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",g.ITEM_POPUP_FOLDER="loadable/item-popup",g.SUMMER_BG="images/bg/summer",g.AUTUMN_BG="images/bg/autumn",g.WINTER_BG="images/bg/winter",g.FLOWER_FIELD_BG="images/bg/flower-field",g.TREE_PLANTING_FESTIVAL_BG="images/bg/tree-planting-festival",g.MUSIC_FESTIVAL_BG="images/bg/music-festival",g.HARVEST_FESTIVAL_BG="images/bg/harvest-festival",g.FOOD_FESTIVAL_BG="images/bg/food-festival",g.LIGHT_FESTIVAL_BG="images/bg/light-festival",g.PEACE_FESTIVAL_BG="images/bg/peace-festival",g.FLOWER_FESTIVAL_BG="images/bg/flower-festival",g.STREET_FESTIVAL_BG="images/bg/street-festival",g.COLOR_GARDEN_BG="images/bg/color-garden",g.COLOR_FESTIVAL_BG="images/bg/color-festival",g.NATURE_SUMMER_BG="images/bg/nature-summer",g.SNOW_MOUNTAIN_BG="images/bg/snow-mountain",g.ICE_FESTIVAL_BG="images/bg/ice-festival",g.NIGHT_FESTIVAL_BG="images/bg/night-festival",g.LOST_FESTIVAL_BG="images/bg/lost-festival",g.HALLOWEEN_BG="images/bg/halloween",g.CHRISTMAS_BG="images/bg/christmas",g.SPRING_FLOWER_FESTIVAL_BG="images/bg/spring-flower-festival",g.TET_HOLIDAY_BG="images/bg/tet-holiday",g.SEA_FESTIVAL_BG="images/bg/sea-festival",g.FIREWORK_FESTIVAL_BG="images/bg/firework-festival",g.SUMMER_BG_PREVIEW="images/preview/summer",g.AUTUMN_BG_PREVIEW="images/preview/autumn",g.WINTER_BG_PREVIEW="images/preview/winter",g.FLOWER_FIELD_BG_PREVIEW="images/preview/flower-field",g.TREE_PLANTING_FESTIVAL_BG_PREVIEW="images/preview/tree-planting-festival",g.MUSIC_FESTIVAL_BG_PREVIEW="images/preview/music-festival",g.HARVEST_FESTIVAL_BG_PREVIEW="images/preview/harvest-festival",g.FOOD_FESTIVAL_BG_PREVIEW="images/preview/food-festival",g.LIGHT_FESTIVAL_BG_PREVIEW="images/preview/light-festival",g.PEACE_FESTIVAL_BG_PREVIEW="images/preview/peace-festival",g.FLOWER_FESTIVAL_BG_PREVIEW="images/preview/flower-festival",g.STREET_FESTIVAL_BG_PREVIEW="images/preview/street-festival",g.COLOR_GARDEN_BG_PREVIEW="images/preview/color-garden",g.COLOR_FESTIVAL_BG_PREVIEW="images/preview/color-festival",g.NATURE_SUMMER_BG_PREVIEW="images/preview/nature-summer",g.SNOW_MOUNTAIN_BG_PREVIEW="images/preview/snow-mountain",g.ICE_FESTIVAL_BG_PREVIEW="images/preview/ice-festival",g.NIGHT_FESTIVAL_BG_PREVIEW="images/preview/night-festival",g.LOST_FESTIVAL_BG_PREVIEW="images/preview/lost-festival",g.HALLOWEEN_BG_PREVIEW="images/preview/halloween",g.CHRISTMAS_BG_PREVIEW="images/preview/christmas",g.SPRING_FLOWER_FESTIVAL_BG_PREVIEW="images/preview/spring-flower-festival",g.TET_HOLIDAY_BG_PREVIEW="images/preview/tet-holiday",g.SEA_FESTIVAL_BG_PREVIEW="images/preview/sea-festival",g.FIREWORK_FESTIVAL_BG_PREVIEW="images/preview/firework-festival",g.SUMMER_BG_TOURNAMENT="images/tournament/summer",g.AUTUMN_BG_TOURNAMENT="images/tournament/autumn",g.WINTER_BG_TOURNAMENT="images/tournament/winter",g.FLOWER_FIELD_BG_TOURNAMENT="images/tournament/flower-field",g.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT="images/tournament/tree-planting-festival",g.MUSIC_FESTIVAL_BG_TOURNAMENT="images/tournament/music-festival",g.HARVEST_FESTIVAL_BG_TOURNAMENT="images/tournament/harvest-festival",g.FOOD_FESTIVAL_BG_TOURNAMENT="images/tournament/food-festival",g.LIGHT_FESTIVAL_BG_TOURNAMENT="images/tournament/light-festival",g.PEACE_FESTIVAL_BG_TOURNAMENT="images/tournament/peace-festival",g.FLOWER_FESTIVAL_BG_TOURNAMENT="images/tournament/flower-festival",g.STREET_FESTIVAL_BG_TOURNAMENT="images/tournament/street-festival",g.COLOR_GARDEN_BG_TOURNAMENT="images/tournament/color-garden",g.COLOR_FESTIVAL_BG_TOURNAMENT="images/tournament/color-festival",g.NATURE_SUMMER_BG_TOURNAMENT="images/tournament/nature-summer",g.SNOW_MOUNTAIN_BG_TOURNAMENT="images/tournament/snow-mountain",g.ICE_FESTIVAL_BG_TOURNAMENT="images/tournament/ice-festival",g.NIGHT_FESTIVAL_BG_TOURNAMENT="images/tournament/night-festival",g.LOST_FESTIVAL_BG_TOURNAMENT="images/tournament/lost-festival",g.HALLOWEEN_BG_TOURNAMENT="images/tournament/halloween",g.CHRISTMAS_BG_TOURNAMENT="images/tournament/christmas",g.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT="images/tournament/spring-flower-festival",g.TET_HOLIDAY_BG_TOURNAMENT="images/tournament/tet-holiday",g.SEA_FESTIVAL_BG_TOURNAMENT="images/tournament/sea-festival",g.FIREWORK_FESTIVAL_BG_TOURNAMENT="images/tournament/firework-festival",g.SUMMER_BG_THUMBNAIL="images/thumbnail/summer",g.AUTUMN_BG_THUMBNAIL="images/thumbnail/autumn",g.WINTER_BG_THUMBNAIL="images/thumbnail/winter",g.FLOWER_FIELD_BG_THUMBNAIL="images/thumbnail/flower-field",g.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL="images/thumbnail/tree-planting-festival",g.MUSIC_FESTIVAL_BG_THUMBNAIL="images/thumbnail/music-festival",g.HARVEST_FESTIVAL_BG_THUMBNAIL="images/thumbnail/harvest-festival",g.FOOD_FESTIVAL_BG_THUMBNAIL="images/thumbnail/food-festival",g.LIGHT_FESTIVAL_BG_THUMBNAIL="images/thumbnail/light-festival",g.PEACE_FESTIVAL_BG_THUMBNAIL="images/thumbnail/peace-festival",g.FLOWER_FESTIVAL_BG_THUMBNAIL="images/thumbnail/flower-festival",g.STREET_FESTIVAL_BG_THUMBNAIL="images/thumbnail/street-festival",g.COLOR_GARDEN_BG_THUMBNAIL="images/thumbnail/color-garden",g.COLOR_FESTIVAL_BG_THUMBNAIL="images/thumbnail/color-festival",g.NATURE_SUMMER_BG_THUMBNAIL="images/thumbnail/nature-summer",g.SNOW_MOUNTAIN_BG_THUMBNAIL="images/thumbnail/snow-mountain",g.ICE_FESTIVAL_BG_THUMBNAIL="images/thumbnail/ice-festival",g.NIGHT_FESTIVAL_BG_THUMBNAIL="images/thumbnail/night-festival",g.LOST_FESTIVAL_BG_THUMBNAIL="images/thumbnail/lost-festival",g.HALLOWEEN_BG_THUMBNAIL="images/thumbnail/halloween",g.CHRISTMAS_BG_THUMBNAIL="images/thumbnail/christmas",g.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL="images/thumbnail/spring-flower-festival",g.TET_HOLIDAY_BG_THUMBNAIL="images/thumbnail/tet-holiday",g.SEA_FESTIVAL_BG_THUMBNAIL="images/thumbnail/sea-festival",g.FIREWORK_FESTIVAL_BG_THUMBNAIL="images/thumbnail/firework-festival",g.COLLECTIONS_PAGE="pages/CollectionsContent",g.LEADERBOARD_PAGE="pages/LeaderboardContent",g.TOURNAMENTS_PAGE="pages/TournamentsContent",g.LEVEL_DATA_FOLDER="levels-json",g}(nM||{});_._RF.pop(),_._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);var nF={summer:nM.SUMMER_BG,autumn:nM.AUTUMN_BG,winter:nM.WINTER_BG,"spring-festival":nM.FLOWER_FIELD_BG,"tree-planting-festival":nM.TREE_PLANTING_FESTIVAL_BG,"blue-sea-festival":nM.SEA_FESTIVAL_BG,"music-festival":nM.MUSIC_FESTIVAL_BG,"harvest-festival":nM.HARVEST_FESTIVAL_BG,"food-festival":nM.FOOD_FESTIVAL_BG,"snow-festival":nM.WINTER_BG,"light-festival":nM.LIGHT_FESTIVAL_BG,"peace-festival":nM.PEACE_FESTIVAL_BG,"flower-festival":nM.FLOWER_FESTIVAL_BG,"street-festival":nM.STREET_FESTIVAL_BG,"color-garden":nM.COLOR_GARDEN_BG,"color-festival":nM.COLOR_FESTIVAL_BG,"nature-summer":nM.NATURE_SUMMER_BG,"snow-mountain":nM.SNOW_MOUNTAIN_BG,"ice-festival":nM.ICE_FESTIVAL_BG,"green-grass-festival":nM.FLOWER_FIELD_BG,"community-festival":nM.NIGHT_FESTIVAL_BG,"water-festival":nM.SEA_FESTIVAL_BG,"animal-festival":nM.TREE_PLANTING_FESTIVAL_BG,"lost-festival":nM.LOST_FESTIVAL_BG,"halloween-festival":nM.HALLOWEEN_BG,"snow-music-festival":nM.MUSIC_FESTIVAL_BG,christmas:nM.CHRISTMAS_BG,"spring-flower-festival":nM.SPRING_FLOWER_FESTIVAL_BG,"tet-holiday":nM.TET_HOLIDAY_BG,"sea-festival":nM.SEA_FESTIVAL_BG,"firework-festival":nM.FIREWORK_FESTIVAL_BG,"halloween-horror":nM.HALLOWEEN_BG,"mid-autumn":nM.SPRING_FLOWER_FESTIVAL_BG,"christmas-sweet":nM.CHRISTMAS_BG,"new-year-countdown":nM.TET_HOLIDAY_BG},nU={summer:nM.SUMMER_BG_PREVIEW,autumn:nM.AUTUMN_BG_PREVIEW,winter:nM.WINTER_BG_PREVIEW,"spring-festival":nM.FLOWER_FIELD_BG_PREVIEW,"tree-planting-festival":nM.TREE_PLANTING_FESTIVAL_BG_PREVIEW,"blue-sea-festival":nM.SEA_FESTIVAL_BG_PREVIEW,"music-festival":nM.MUSIC_FESTIVAL_BG_PREVIEW,"harvest-festival":nM.HARVEST_FESTIVAL_BG_PREVIEW,"food-festival":nM.FOOD_FESTIVAL_BG_PREVIEW,"snow-festival":nM.WINTER_BG_PREVIEW,"light-festival":nM.LIGHT_FESTIVAL_BG_PREVIEW,"peace-festival":nM.PEACE_FESTIVAL_BG_PREVIEW,"flower-festival":nM.FLOWER_FESTIVAL_BG_PREVIEW,"street-festival":nM.STREET_FESTIVAL_BG_PREVIEW,"color-garden":nM.COLOR_GARDEN_BG_PREVIEW,"color-festival":nM.COLOR_FESTIVAL_BG_PREVIEW,"nature-summer":nM.NATURE_SUMMER_BG_PREVIEW,"snow-mountain":nM.SNOW_MOUNTAIN_BG_PREVIEW,"ice-festival":nM.ICE_FESTIVAL_BG_PREVIEW,"green-grass-festival":nM.FLOWER_FIELD_BG_PREVIEW,"community-festival":nM.NIGHT_FESTIVAL_BG_PREVIEW,"water-festival":nM.SEA_FESTIVAL_BG_PREVIEW,"animal-festival":nM.TREE_PLANTING_FESTIVAL_BG_PREVIEW,"lost-festival":nM.LOST_FESTIVAL_BG_PREVIEW,"halloween-festival":nM.HALLOWEEN_BG_PREVIEW,"snow-music-festival":nM.MUSIC_FESTIVAL_BG_PREVIEW,christmas:nM.CHRISTMAS_BG_PREVIEW,"spring-flower-festival":nM.SPRING_FLOWER_FESTIVAL_BG_PREVIEW,"tet-holiday":nM.TET_HOLIDAY_BG_PREVIEW,"sea-festival":nM.SEA_FESTIVAL_BG_PREVIEW,"firework-festival":nM.FIREWORK_FESTIVAL_BG_PREVIEW,"halloween-horror":nM.HALLOWEEN_BG_PREVIEW,"mid-autumn":nM.SPRING_FLOWER_FESTIVAL_BG_PREVIEW,"christmas-sweet":nM.CHRISTMAS_BG_PREVIEW,"new-year-countdown":nM.TET_HOLIDAY_BG_PREVIEW},nz={summer:nM.SUMMER_BG_TOURNAMENT,autumn:nM.AUTUMN_BG_TOURNAMENT,winter:nM.WINTER_BG_TOURNAMENT,"spring-festival":nM.FLOWER_FIELD_BG_TOURNAMENT,"tree-planting-festival":nM.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT,"blue-sea-festival":nM.SEA_FESTIVAL_BG_TOURNAMENT,"music-festival":nM.MUSIC_FESTIVAL_BG_TOURNAMENT,"harvest-festival":nM.HARVEST_FESTIVAL_BG_TOURNAMENT,"food-festival":nM.FOOD_FESTIVAL_BG_TOURNAMENT,"snow-festival":nM.WINTER_BG_TOURNAMENT,"light-festival":nM.LIGHT_FESTIVAL_BG_TOURNAMENT,"peace-festival":nM.PEACE_FESTIVAL_BG_TOURNAMENT,"flower-festival":nM.FLOWER_FESTIVAL_BG_TOURNAMENT,"street-festival":nM.STREET_FESTIVAL_BG_TOURNAMENT,"color-garden":nM.COLOR_GARDEN_BG_TOURNAMENT,"color-festival":nM.COLOR_FESTIVAL_BG_TOURNAMENT,"nature-summer":nM.NATURE_SUMMER_BG_TOURNAMENT,"snow-mountain":nM.SNOW_MOUNTAIN_BG_TOURNAMENT,"ice-festival":nM.ICE_FESTIVAL_BG_TOURNAMENT,"green-grass-festival":nM.FLOWER_FIELD_BG_TOURNAMENT,"community-festival":nM.NIGHT_FESTIVAL_BG_TOURNAMENT,"water-festival":nM.SEA_FESTIVAL_BG_TOURNAMENT,"animal-festival":nM.TREE_PLANTING_FESTIVAL_BG_TOURNAMENT,"lost-festival":nM.LOST_FESTIVAL_BG_TOURNAMENT,"halloween-festival":nM.HALLOWEEN_BG_TOURNAMENT,"snow-music-festival":nM.MUSIC_FESTIVAL_BG_TOURNAMENT,christmas:nM.CHRISTMAS_BG_TOURNAMENT,"spring-flower-festival":nM.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT,"tet-holiday":nM.TET_HOLIDAY_BG_TOURNAMENT,"sea-festival":nM.SEA_FESTIVAL_BG_TOURNAMENT,"firework-festival":nM.FIREWORK_FESTIVAL_BG_TOURNAMENT,"halloween-horror":nM.HALLOWEEN_BG_TOURNAMENT,"mid-autumn":nM.SPRING_FLOWER_FESTIVAL_BG_TOURNAMENT,"christmas-sweet":nM.CHRISTMAS_BG_TOURNAMENT,"new-year-countdown":nM.TET_HOLIDAY_BG_TOURNAMENT},nx={summer:nM.SUMMER_BG_THUMBNAIL,autumn:nM.AUTUMN_BG_THUMBNAIL,winter:nM.WINTER_BG_THUMBNAIL,"spring-festival":nM.FLOWER_FIELD_BG_THUMBNAIL,"tree-planting-festival":nM.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL,"blue-sea-festival":nM.SEA_FESTIVAL_BG_THUMBNAIL,"music-festival":nM.MUSIC_FESTIVAL_BG_THUMBNAIL,"harvest-festival":nM.HARVEST_FESTIVAL_BG_THUMBNAIL,"food-festival":nM.FOOD_FESTIVAL_BG_THUMBNAIL,"snow-festival":nM.WINTER_BG_THUMBNAIL,"light-festival":nM.LIGHT_FESTIVAL_BG_THUMBNAIL,"peace-festival":nM.PEACE_FESTIVAL_BG_THUMBNAIL,"flower-festival":nM.FLOWER_FESTIVAL_BG_THUMBNAIL,"street-festival":nM.STREET_FESTIVAL_BG_THUMBNAIL,"color-garden":nM.COLOR_GARDEN_BG_THUMBNAIL,"color-festival":nM.COLOR_FESTIVAL_BG_THUMBNAIL,"nature-summer":nM.NATURE_SUMMER_BG_THUMBNAIL,"snow-mountain":nM.SNOW_MOUNTAIN_BG_THUMBNAIL,"ice-festival":nM.ICE_FESTIVAL_BG_THUMBNAIL,"green-grass-festival":nM.FLOWER_FIELD_BG_THUMBNAIL,"community-festival":nM.NIGHT_FESTIVAL_BG_THUMBNAIL,"water-festival":nM.SEA_FESTIVAL_BG_THUMBNAIL,"animal-festival":nM.TREE_PLANTING_FESTIVAL_BG_THUMBNAIL,"lost-festival":nM.LOST_FESTIVAL_BG_THUMBNAIL,"halloween-festival":nM.HALLOWEEN_BG_THUMBNAIL,"snow-music-festival":nM.MUSIC_FESTIVAL_BG_THUMBNAIL,christmas:nM.CHRISTMAS_BG_THUMBNAIL,"spring-flower-festival":nM.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL,"tet-holiday":nM.TET_HOLIDAY_BG_THUMBNAIL,"sea-festival":nM.SEA_FESTIVAL_BG_THUMBNAIL,"firework-festival":nM.FIREWORK_FESTIVAL_BG_THUMBNAIL,"halloween-horror":nM.HALLOWEEN_BG_THUMBNAIL,"mid-autumn":nM.SPRING_FLOWER_FESTIVAL_BG_THUMBNAIL,"christmas-sweet":nM.CHRISTMAS_BG_THUMBNAIL,"new-year-countdown":nM.TET_HOLIDAY_BG_THUMBNAIL};_._RF.pop(),_._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);var nG,nV,nK,nH,nq,nW,nj,nX,nY,nJ,nQ,nZ,n$,n0,n1,n2,n4,n3,n5,n6,n8,n9,n7,ie=function(){function e(){Fe(this,e)}var g,E,_,k,C,A,T,R,I,L,P,O;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"setBlockInput",value:function(g){var E=$("Canvas/InputBlocker");E?E.active=g:console.warn("InputBlocker not found")}},{key:"getBlockInput",value:function(){var g=$("Canvas/InputBlocker");return g?g.active:(console.warn("InputBlocker not found"),!1)}},{key:"loadPrefabAsync",value:function(g){var E=this.getAsset(g,ee);return null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,ee,function(g,_){E(g?null:_)})})}},{key:"loadJsonAsync",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){E=this;return[2,new Promise(function(_){var k=E.getAsset(g,en);null===k?F.load(g,en,function(g,E){g?_(null):E&&E.json?_(E.json):_(null)}):_(k.json)})]})}),function(g){return O.apply(this,arguments)})},{key:"loadAudioClipAsync",value:(P=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,U);return[2,null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,U,function(g,_){E(g?null:_)})})]})}),function(g){return P.apply(this,arguments)})},{key:"loadAnimClipAsync",value:(L=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,ei);return[2,null!==E?Promise.resolve(E):new Promise(function(E){F.load(g,ei,function(g,_){E(g?null:_)})})]})}),function(g){return L.apply(this,arguments)})},{key:"loadImageSpriteFrameAsync",value:(I=Be(function(g){var E;return _ts_generator(this,function(_){E=this.getAsset(g,ea);return[2,null!==E?Promise.resolve(er.createWithImage(E)):new Promise(function(E){F.load(g,ea,function(g,_){E(g?null:er.createWithImage(_))})})]})}),function(g){return I.apply(this,arguments)})},{key:"loadSpriteFrameAsync",value:(R=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){E=!(k.length>1&&void 0!==k[1])||k[1],_=this.getAsset(g,er);return[2,null!==_?(_.packable=E,Promise.resolve(_)):new Promise(function(_){F.load(g,er,function(g,k){!g&&k?(k.packable=E,_(k)):_(null)})})]})}),function(g){return R.apply(this,arguments)})},{key:"loadSpriteFramesDirAsync",value:(T=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){E=F.getDirWithPath(g,er);if(E.length>0){k=[],C=at(E);try{for(C.s();!(_=C.n()).done;){A=_.value,T=F.get(A.path,er);if(!T)return[2,this.loadSpriteFramesFromDirAsync(g)];k.push(T)}}catch(g){C.e(g)}finally{C.f()}return[2,k]}return[2,this.loadSpriteFramesFromDirAsync(g)]})}),function(g){return T.apply(this,arguments)})},{key:"loadSpriteFramesFromDirAsync",value:(A=Be(function(g){return _ts_generator(this,function(E){return[2,new Promise(function(E){F.loadDir(g,er,function(g,_){E(g?[]:_)})})]})}),function(g){return A.apply(this,arguments)})},{key:"loadThemeAsync",value:(C=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nF[g],"/spriteFrame"))]})}),function(g){return C.apply(this,arguments)})},{key:"loadThemePreviewAsync",value:(k=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nU[g],"/spriteFrame"))]})}),function(g){return k.apply(this,arguments)})},{key:"loadThemeTournamentAsync",value:(_=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nz[g],"/spriteFrame"))]})}),function(g){return _.apply(this,arguments)})},{key:"loadThemeThumbnailAsync",value:(E=Be(function(g){return _ts_generator(this,function(E){return[2,this.loadSpriteFrameAsync("".concat(nx[g],"/spriteFrame"))]})}),function(g){return E.apply(this,arguments)})},{key:"loadSkinPreviewAsync",value:(g=Be(function(g){var E,_,k;return _ts_generator(this,function(C){for(E=[],_=1;_<=4;_++){k="".concat(nM.TILE_SKIN_PREVIEW_FOLDER,"/").concat(g.replace(/-/g,"_"),"_").concat(_,"/spriteFrame");E.push(this.loadSpriteFrameAsync(k))}return[2,Promise.all(E)]})}),function(E){return g.apply(this,arguments)})},{key:"getAsset",value:function(g,E){var _=F.getInfoWithPath(g,E);return _?F.get(_.path,E):null}}]),e}();_._RF.pop(),_._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var ii=k.ccclass,ia=k.property,ir=globalThis.game.monitorError,io=GameCore.Utils.Number,is=(nG=ii("MultiBackground"),nV=ia({type:eo}),nK=ia({type:eo}),nH=ia({type:R}),nq=ia({type:R}),nW=ia({type:R}),nj=ia(V),nX=ia(H),nY=ia({type:es(nB)}),nJ=ia({type:es(nB)}),nQ=nC.onlyRunInLifeCycleAsync,nZ=nC.onlyRunInLifeCycle,nG((n1=st((n0=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background1",n1,Ke(g)),rt(g,"background2",n2,Ke(g)),rt(g,"screenUiTransform",n4,Ke(g)),rt(g,"background1UiTransform",n3,Ke(g)),rt(g,"background2UiTransform",n5,Ke(g)),rt(g,"backgroundNudgeAmount",n6,Ke(g)),rt(g,"nudgeableWidget",n8,Ke(g)),rt(g,"pageOrder",n9,Ke(g)),rt(g,"homePage",n7,Ke(g)),g.currentThemeId="",g.tryNudgeBackground=function(E){var _=E.to,k=g.getDirection(g.homePage,_),C=io.sign(k),A=Math.abs(k),T=g.backgroundNudgeAmount*A,R=Math.min(g.background1UiTransform.width,g.background2UiTransform.width),I=Math.max(0,(R-g.screenUiTransform.width)/2),L=Math.min(I,T)*C;x(g.nudgeableWidget).to(.5,{horizontalCenter:L},{easing:el.cubicInOut}).start()},g}return Ue(a,[{key:"onLoad",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,nC.lazyValidateProperties(this),this.listenToNavigationEvents()}},{key:"onDestroy",value:function(){var g;null===(g=this.tweenSignal)||void 0===g||g.abort(),this.unlistenToNavigationEvents()}},{key:"listenToNavigationEvents",value:function(){this.node.scene.on(nP,this.tryNudgeBackground)}},{key:"unlistenToNavigationEvents",value:function(){this.node.scene.off(nP,this.tryNudgeBackground)}},{key:"getDirection",value:function(g,E){var _=this.pageOrder.indexOf(g),k=this.pageOrder.indexOf(E);return -1===_||-1===k?(null==ir||ir.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):_-k}},{key:"setCurrentTheme",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,ie.loadThemeAsync(g)];case 1:E=_.sent();E?this.updateBackgroundSprites(E,g):null==ir||ir.sendException(new Error("MultiBackground.setCurrentTheme: Failed to load theme ".concat(g,"'s sprite.")));return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"updateBackgroundSprites",value:function(g,E){g.packable=!1,this.background1.spriteFrame=g,this.background2.spriteFrame=g,this.currentThemeId=E}},{key:"animateToNextTheme",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(this.currentThemeId===g)return[2,Promise.resolve()];return[4,ie.loadThemeAsync(g)];case 1:_=A.sent();if(!_)return[3,3];_.packable=!1,this.currentThemeId=g,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=_,this.nextBackground.node.setSiblingIndex(1);k=this.nextBackground.getComponent(eu);if(!k)throw new Error("".concat(this.nextBackground.node.name," UIOpacity is required"));k.opacity=0,null===(E=this.tweenSignal)||void 0===E||E.abort(),this.tweenSignal=new nD;return[4,tZ.runTweenAsync(x(k).to(1,{opacity:255}),this.tweenSignal)];case 2:if(A.sent(),!this.tweenSignal.aborted){this.currentBackground.node.active=!1;C=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=C}return[3,4];case 3:null==ir||ir.sendException(new Error("MultiBackground.animateToNextTheme: Failed to load theme ".concat(g,"'s sprite.")));A.label=4;case 4:return[2]}})}),function(g){return E.apply(this,arguments)})}]),a}(D)).prototype,"background1",[nV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n2=st(n0.prototype,"background2",[nK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n4=st(n0.prototype,"screenUiTransform",[nH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n3=st(n0.prototype,"background1UiTransform",[nq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n5=st(n0.prototype,"background2UiTransform",[nW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n6=st(n0.prototype,"backgroundNudgeAmount",[nj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),n8=st(n0.prototype,"nudgeableWidget",[nX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n9=st(n0.prototype,"pageOrder",[nY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),n7=st(n0.prototype,"homePage",[nJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nB.home}}),st(n0.prototype,"setCurrentTheme",[nQ],Object.getOwnPropertyDescriptor(n0.prototype,"setCurrentTheme"),n0.prototype),st(n0.prototype,"updateBackgroundSprites",[nZ],Object.getOwnPropertyDescriptor(n0.prototype,"updateBackgroundSprites"),n0.prototype),n$=n0))||n$);_._RF.pop(),_._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var il="musics/",iu="sounds/",ic=GameCore.Utils.Object,ih={BUTTON_CLICK:"".concat(iu,"use_item_click"),BOMB_DEFUSE:"".concat(iu,"bomb_defuse"),BOMB_EXPLODE_1:"".concat(iu,"bomb_explode_1"),BOMB_EXPLODE_2:"".concat(iu,"bomb_explode_2"),CLICKS:"".concat(iu,"clicks"),CLOSE_POPUP_CLICK:"".concat(iu,"close_popup_click"),COLLECT_STARS:"".concat(iu,"collect_stars"),COMBO_1:"".concat(iu,"combo_1"),COMBO_2:"".concat(iu,"combo_2"),COMBO_3:"".concat(iu,"combo_3"),COMBO_4:"".concat(iu,"combo_4"),COMBO_5:"".concat(iu,"combo_5"),DAILY_REWARD:"".concat(iu,"daily_reward"),EXTRA_TIME_SPAWN:"".concat(iu,"extra_time_spawn"),GIFT_CHARGE:"".concat(iu,"gift_charge"),GIFT_EXPLODE:"".concat(iu,"gift_explode"),GIFT_REVEAL:"".concat(iu,"gift_reveal"),HINT_ITEM:"".concat(iu,"hint_item"),INVALID_MATCH:"".concat(iu,"invalid_match"),LEVEL_COMPLETE:"".concat(iu,"level_complete"),LEVEL_FAIL:"".concat(iu,"level_fail"),LEVEL_START:"".concat(iu,"level_start"),PROGRESS_STAR:"".concat(iu,"progress_star"),RESCUE_TIMER:"".concat(iu,"rescue_timer"),ROCKET_FLY:"".concat(iu,"rocket_fly"),SHUFFLE_ITEM:"".concat(iu,"shuffle_item"),THREE_STARS:"".concat(iu,"three_stars"),TICKING_BOMB_BEFORE_EXPLODE:"".concat(iu,"ticking_bomb_before_explode"),TILE_SELECT:"".concat(iu,"tile_select"),USE_ITEM_CLICK:"".concat(iu,"use_item_click"),BG_MUSIC:"".concat(il,"bg_music"),PATCH_SHIFT:"".concat(iu,"patch_shift"),THUNDERBOLT:"".concat(iu,"thunderbolt"),WIND:"".concat(iu,"wind"),COLLECT_COINS:"".concat(iu,"collect_coins"),COLLECT_STOCK_COINS:"".concat(iu,"collect_stock_coins"),LEVEL_FAIL_TIMEOUT:"".concat(iu,"level_fail_timeout"),STAR_CHEST_DRUM_ROLL:"".concat(iu,"star_chest_drum_roll"),STAR_CHEST_OPEN:"".concat(iu,"star_chest_open"),LEADERBOARD_TRIUMPH:"".concat(iu,"leaderboard_triumph"),ITEM_REWARD:"".concat(iu,"item_reward"),COMBO_6:"".concat(iu,"combo_6"),COMBO_7:"".concat(iu,"combo_7"),COMBO_8:"".concat(iu,"combo_8"),COMBO_9:"".concat(iu,"combo_9"),COMBO_10:"".concat(iu,"combo_10"),COMBO_11:"".concat(iu,"combo_11"),COMBO_12:"".concat(iu,"combo_12"),COMBO_13:"".concat(iu,"combo_13"),TILE_MATCH:"".concat(iu,"tile_match"),TOURNAMENT_MUSIC:"".concat(il,"tournament_music")},ip=ic.vals(ih),iy=ip.reduce(function(g,E,_){return g[E]=_,g},{});Z(iy);var iv,ig,im=ip;_._RF.pop(),_._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var ib=function(g){return g[g.RESCUES_SCREEN=0]="RESCUES_SCREEN",g[g.LOADING_SCREEN=1]="LOADING_SCREEN",g[g.GET_ITEM_SCREEN=2]="GET_ITEM_SCREEN",g[g.GET_COIN_SCREEN=3]="GET_COIN_SCREEN",g[g.SETTINGS_SCREEN=4]="SETTINGS_SCREEN",g[g.START_LEVEL_SCREEN=5]="START_LEVEL_SCREEN",g[g.NOTIFICATION_SCREEN=6]="NOTIFICATION_SCREEN",g[g.LEVEL_COMPLETE_SCREEN=7]="LEVEL_COMPLETE_SCREEN",g[g.CONGRATULATION_SCREEN=8]="CONGRATULATION_SCREEN",g[g.QUIT_LEVEL_SCREEN=9]="QUIT_LEVEL_SCREEN",g[g.TOURNAMENT_DETAIL_SCREEN=10]="TOURNAMENT_DETAIL_SCREEN",g[g.DAILY_REWARDS_SCREEN=11]="DAILY_REWARDS_SCREEN",g[g.STAR_CHEST_SCREEN=12]="STAR_CHEST_SCREEN",g[g.START_OVER_SCREEN=13]="START_OVER_SCREEN",g[g.PAUSE_SCREEN=14]="PAUSE_SCREEN",g[g.HARD_LEVEL_SCREEN=15]="HARD_LEVEL_SCREEN",g[g.GET_REWARDS_SCREEN=16]="GET_REWARDS_SCREEN",g}(ib||{}),iw=(Ge(iv={},ib.RESCUES_SCREEN,"RescuesScreen"),Ge(iv,ib.LOADING_SCREEN,"LoadingScreen"),Ge(iv,ib.GET_ITEM_SCREEN,"GetItemScreen"),Ge(iv,ib.GET_COIN_SCREEN,"GetCoinScreen"),Ge(iv,ib.SETTINGS_SCREEN,"SettingsScreen"),Ge(iv,ib.START_LEVEL_SCREEN,"StartLevelScreen"),Ge(iv,ib.NOTIFICATION_SCREEN,"NotificationScreen"),Ge(iv,ib.LEVEL_COMPLETE_SCREEN,"LevelCompleteScreen"),Ge(iv,ib.CONGRATULATION_SCREEN,"CongratulationScreen"),Ge(iv,ib.QUIT_LEVEL_SCREEN,"QuitLevelScreen"),Ge(iv,ib.TOURNAMENT_DETAIL_SCREEN,"TournamentDetailScreen"),Ge(iv,ib.DAILY_REWARDS_SCREEN,"DailyRewardsScreen"),Ge(iv,ib.STAR_CHEST_SCREEN,"StarChestScreen"),Ge(iv,ib.START_OVER_SCREEN,"StartOverScreen"),Ge(iv,ib.PAUSE_SCREEN,"PauseScreen"),Ge(iv,ib.HARD_LEVEL_SCREEN,"HardLevelScreen"),Ge(iv,ib.GET_REWARDS_SCREEN,"GetRewardsScreen"),iv),iS=(Ge(ig={},iw[ib.RESCUES_SCREEN],ib.RESCUES_SCREEN),Ge(ig,iw[ib.LOADING_SCREEN],ib.LOADING_SCREEN),Ge(ig,iw[ib.GET_ITEM_SCREEN],ib.GET_ITEM_SCREEN),Ge(ig,iw[ib.GET_COIN_SCREEN],ib.GET_COIN_SCREEN),Ge(ig,iw[ib.SETTINGS_SCREEN],ib.SETTINGS_SCREEN),Ge(ig,iw[ib.START_LEVEL_SCREEN],ib.START_LEVEL_SCREEN),Ge(ig,iw[ib.NOTIFICATION_SCREEN],ib.NOTIFICATION_SCREEN),Ge(ig,iw[ib.LEVEL_COMPLETE_SCREEN],ib.LEVEL_COMPLETE_SCREEN),Ge(ig,iw[ib.CONGRATULATION_SCREEN],ib.CONGRATULATION_SCREEN),Ge(ig,iw[ib.QUIT_LEVEL_SCREEN],ib.QUIT_LEVEL_SCREEN),Ge(ig,iw[ib.TOURNAMENT_DETAIL_SCREEN],ib.TOURNAMENT_DETAIL_SCREEN),Ge(ig,iw[ib.DAILY_REWARDS_SCREEN],ib.DAILY_REWARDS_SCREEN),Ge(ig,iw[ib.STAR_CHEST_SCREEN],ib.STAR_CHEST_SCREEN),Ge(ig,iw[ib.START_OVER_SCREEN],ib.START_OVER_SCREEN),Ge(ig,iw[ib.PAUSE_SCREEN],ib.PAUSE_SCREEN),Ge(ig,iw[ib.HARD_LEVEL_SCREEN],ib.HARD_LEVEL_SCREEN),Ge(ig,iw[ib.GET_REWARDS_SCREEN],ib.GET_REWARDS_SCREEN),ig),iE=[iw[ib.NOTIFICATION_SCREEN],iw[ib.LOADING_SCREEN]];_._RF.pop(),_._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);var i_=globalThis.game.analytics,ik=GameCore.Utils.Array,iC=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"trackCurrentPage",value:function(g,E){if(!ik.has(iE,g)&&(E||ik.has(this.trackingPages,g))){this.trackingPages=this.trackingPages.filter(function(E){return E!==g}),E&&this.trackingPages.push(g);var _=this.getCurrentPage();i_.pageview(_)}}},{key:"switchSceneTracking",value:function(){this.trackingPages=[];var g=this.getCurrentPage();i_.pageview(g)}},{key:"getCurrentPage",value:function(){var g,E;return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:null!==(g=null===(E=N.getScene())||void 0===E?void 0:E.name)&&void 0!==g?g:"Unknown Scene"}}]),e}();iC.trackingPages=[],_._RF.pop(),_._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);var iA,iT,iR,iI,iL,iP,iO,iB,iN,iD,iM,iF,iU,iz,ix,iG,iV,iK,iH,iq,iW,ij,iX,iY,iJ,iQ,iZ,i$,i0,i1,i2,i4,i3,i5,i6,i8=function(){function e(){Fe(this,e),this.signal=new nD}var g,E,_,k,C;return Ue(e,[{key:"sound",get:function(){var g,E;return null!==(g=null===(E=$("Sound"))||void 0===E?void 0:E.getComponent(tP))&&void 0!==g?g:null}},{key:"music",get:function(){var g,E;return null!==(g=null===(E=$("Music"))||void 0===E?void 0:E.getComponent(tC))&&void 0!==g?g:null}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"muteAudio",value:function(g){this.muteMusic(g),this.muteSound(g)}},{key:"playSound",value:(C=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,null===(_=this.inst.sound)||void 0===_?void 0:_.play(g,E)];case 1:k.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"pauseSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.pause(g)}},{key:"resumeSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.resume(g)}},{key:"stopSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.stop(g)}},{key:"stopAllSounds",value:function(){var g;null===(g=this.inst.sound)||void 0===g||g.stopAll()}},{key:"muteSound",value:function(g){var E;null===(E=this.inst.sound)||void 0===E||E.mute(g)}},{key:"playMusic",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E;this.inst.music&&(this.inst.currentMusic!==g&&this.pauseMusic(),this.inst.currentMusic=g,!_&&this.inst.music.playing(g)||(_&&this.inst.music.stop(g),this.inst.music.play(g)))}},{key:"pauseMusic",value:function(){var g;null===(g=this.inst.music)||void 0===g||g.pause(this.inst.currentMusic)}},{key:"muteMusic",value:function(g){var E;null===(E=this.inst.music)||void 0===E||E.mute(g)}},{key:"getCurrentMusic",value:function(){return this.inst.currentMusic}},{key:"turnUpMusic",value:(k=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=(null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0)>.6;if(_)return[3,2];return[4,this.setVolumeMusic(.6,!0)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"turnDownMusic",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=(null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0)<.2;if(_)return[3,2];return[4,this.setVolumeMusic(.2,!0)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"turnOffMusic",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.setVolumeMusic(0)];case 1:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getVolumeMusic",value:function(){var g,E;return null!==(g=null===(E=this.inst.music)||void 0===E?void 0:E.getVolume())&&void 0!==g?g:0}},{key:"setVolumeMusic",value:(g=Be(function(g){var E,_,k,C,A,T;var R=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:E=this,_=R.length>1&&void 0!==R[1]&&R[1];if(!this.inst.music)return[3,3];this.inst.signal.abort();k=new nD;if(this.inst.signal=k,!_)return[3,2];C=this.inst.music.getVolume(),A=C;return[4,tZ.runOnUpdateAsync(this.inst.music.node,1,function(_){E.inst.music&&(A=C+(g-C)*_,E.inst.music.setVolume(A))},k)];case 1:I.sent();return[3,3];case 2:null===(T=this.inst.music)||void 0===T||T.setVolume(g);I.label=3;case 3:return[2]}})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var i9,i7,ae,an,ai=k.ccclass,aa=k.property,ar=k.disallowMultiple,ao=k.executionOrder,as=globalThis.game.analytics,al=GameCore.Plugins.Analytics.Events,au=(iA=ai("ExtendedButton"),iT=ao(111),iR=aa(ec),iI=aa(ec),iL=aa(eh.AnimationController),iP=aa({override:!0,visible:!1}),iO=aa({override:!0,visible:!1}),iB=aa({override:!0,visible:!1}),iN=aa({override:!0,visible:!1}),iD=aa({override:!0,visible:!1}),iM=aa({override:!0,visible:!1}),iF=aa({override:!0,visible:!1}),iU=aa({override:!0,visible:!1}),iz=aa({override:!0,visible:!1}),ix=aa({override:!0,visible:!1}),iG=aa({override:!0,visible:!1}),iV=aa(J),iK=aa(J),iH=aa(J),iq=aa({visible:function(){return this.makeSound},type:iy}),iW=aa({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),ij=aa({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),iX=aa({}),iA(iY=ar(iY=iT((iQ=st((iJ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"clickStartEvents",iQ,Ke(g)),rt(g,"clickEndEvents",iZ,Ke(g)),rt(g,"animationController",i$,Ke(g)),rt(g,"useDesktopHover",i0,Ke(g)),rt(g,"emitAnalyticsEvents",i1,Ke(g)),rt(g,"makeSound",i2,Ke(g)),rt(g,"soundKey",i4,Ke(g)),rt(g,"disableSpamClick",i3,Ke(g)),rt(g,"disableSpamDelay",i5,Ke(g)),rt(g,"isScrollViewCancelInnerEvents",i6,Ke(g)),g.currentClickBoundingBox=null,g.hasDown=!1,g.hasUp=!1,g.hasFinishClickCycle=!1,g.onTouchStart=function(E){g.interactable&&(g.hasDown||(g.currentClickBoundingBox=ns.getBoundingBoxToWorld(g.node),g.handleDown(E)))},g.onTouchEnd=function(E){g.scheduleOnce(function(){g.interactable&&g.hasDown&&(g.hasUp||g.handleUp(E))},0)},g.onTouchCancel=function(E){if(g.interactable&&g.hasDown&&!g.hasUp){if(!g.isScrollViewCancelInnerEvents){var _,k,C=E.getUILocation();if(null!==(_=null===(k=g.currentClickBoundingBox)||void 0===k?void 0:k.contains(C))&&void 0!==_&&_)return void g.handleUp(E)}g.hasUp=!0,g.hasFinishClickCycle=!0,g.handleResetButtonState(),g.emitClickEndEvents(E)}},g.onMouseEnter=function(E){g.useDesktopHover&&g.interactable&&(g.hasDown||(g.hasFinishClickCycle=!1,g.setAnimationState("HOVER")))},g.onMouseLeave=function(E){g.useDesktopHover&&g.interactable&&(g.hasDown||g.hasUp||g.hasFinishClickCycle||g.handleResetButtonState())},g.handleResetButtonState=function(){g.hasDown=!1,g.hasUp=!1,g.setAnimationState("RESET")},g}return Ue(n,[{key:"transition",get:function(){return B.Transition.NONE},set:function(g){$e(Ve(n.prototype),"transition",B.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return Je(Ve(n.prototype),"normalColor",this)},set:function(g){$e(Ve(n.prototype),"normalColor",g,this,!0)}},{key:"pressedColor",get:function(){return Je(Ve(n.prototype),"pressedColor",this)},set:function(g){$e(Ve(n.prototype),"pressedColor",g,this,!0)}},{key:"hoverColor",get:function(){return Je(Ve(n.prototype),"hoverColor",this)},set:function(g){$e(Ve(n.prototype),"hoverColor",g,this,!0)}},{key:"disabledColor",get:function(){return Je(Ve(n.prototype),"disabledColor",this)},set:function(g){$e(Ve(n.prototype),"disabledColor",g,this,!0)}},{key:"normalSprite",get:function(){return Je(Ve(n.prototype),"normalSprite",this)},set:function(g){$e(Ve(n.prototype),"normalSprite",g,this,!0)}},{key:"pressedSprite",get:function(){return Je(Ve(n.prototype),"pressedSprite",this)},set:function(g){$e(Ve(n.prototype),"pressedSprite",g,this,!0)}},{key:"hoverSprite",get:function(){return Je(Ve(n.prototype),"hoverSprite",this)},set:function(g){$e(Ve(n.prototype),"hoverSprite",g,this,!0)}},{key:"disabledSprite",get:function(){return Je(Ve(n.prototype),"disabledSprite",this)},set:function(g){$e(Ve(n.prototype),"disabledSprite",g,this,!0)}},{key:"duration",get:function(){return Je(Ve(n.prototype),"duration",this)},set:function(g){$e(Ve(n.prototype),"duration",g,this,!0)}},{key:"zoomScale",get:function(){return Je(Ve(n.prototype),"zoomScale",this)},set:function(g){$e(Ve(n.prototype),"zoomScale",g,this,!0)}},{key:"__preload",value:function(){Je(Ve(n.prototype),"__preload",this).call(this),nC.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var g;null===(g=Je(Ve(n.prototype),"onDestroy",this))||void 0===g||g.call(this)}},{key:"onEnable",value:function(){var g;null===(g=Je(Ve(n.prototype),"onEnable",this))||void 0===g||g.call(this),this.node.off(ep.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(C.EventType.TOUCH_START,this.onTouchStart),this.node.on(C.EventType.TOUCH_END,this.onTouchEnd),this.node.on(C.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var g;null===(g=Je(Ve(n.prototype),"onDisable",this))||void 0===g||g.call(this),this.node.off(C.EventType.TOUCH_START,this.onTouchStart),this.node.off(C.EventType.TOUCH_END,this.onTouchEnd),this.node.off(C.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(g){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&i8.playSound(im[this.soundKey]),this.emitClickStartEvents(g)}},{key:"emitClickStartEvents",value:function(g){var E,_=at(this.clickStartEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}},{key:"emitClickEndEvents",value:function(g){var E,_=at(this.clickEndEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}},{key:"handleUp",value:function(g){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(g),this.emitClickEndEvents(g)}},{key:"emitButtonEvents",value:function(g){if(this.interactable){this.emitAnalyticsEvents&&as.event(al.BUTTON_CLICK,{button_name:this.node.name,screen_name:iC.getCurrentPage()});var E,_=at(this.clickEvents);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.emit([g,k.customEventData])}}catch(g){_.e(g)}finally{_.f()}}}},{key:"setAnimationState",value:function(g){this.animationController&&(this.animationController.setValue("DOWN","DOWN"===g),this.animationController.setValue("HOVER","HOVER"===g),this.animationController.setValue("RESET","RESET"===g))}},{key:"fakeClick",value:function(){var g=this;this.setAnimationState("DOWN"),this.scheduleOnce(function(){g.setAnimationState("RESET")},0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),n}(B)).prototype,"clickStartEvents",[iR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iZ=st(iJ.prototype,"clickEndEvents",[iI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),i$=st(iJ.prototype,"animationController",[iL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(iJ.prototype,"transition",[iP],Object.getOwnPropertyDescriptor(iJ.prototype,"transition"),iJ.prototype),st(iJ.prototype,"normalColor",[iO],Object.getOwnPropertyDescriptor(iJ.prototype,"normalColor"),iJ.prototype),st(iJ.prototype,"pressedColor",[iB],Object.getOwnPropertyDescriptor(iJ.prototype,"pressedColor"),iJ.prototype),st(iJ.prototype,"hoverColor",[iN],Object.getOwnPropertyDescriptor(iJ.prototype,"hoverColor"),iJ.prototype),st(iJ.prototype,"disabledColor",[iD],Object.getOwnPropertyDescriptor(iJ.prototype,"disabledColor"),iJ.prototype),st(iJ.prototype,"normalSprite",[iM],Object.getOwnPropertyDescriptor(iJ.prototype,"normalSprite"),iJ.prototype),st(iJ.prototype,"pressedSprite",[iF],Object.getOwnPropertyDescriptor(iJ.prototype,"pressedSprite"),iJ.prototype),st(iJ.prototype,"hoverSprite",[iU],Object.getOwnPropertyDescriptor(iJ.prototype,"hoverSprite"),iJ.prototype),st(iJ.prototype,"disabledSprite",[iz],Object.getOwnPropertyDescriptor(iJ.prototype,"disabledSprite"),iJ.prototype),st(iJ.prototype,"duration",[ix],Object.getOwnPropertyDescriptor(iJ.prototype,"duration"),iJ.prototype),st(iJ.prototype,"zoomScale",[iG],Object.getOwnPropertyDescriptor(iJ.prototype,"zoomScale"),iJ.prototype),i0=st(iJ.prototype,"useDesktopHover",[iV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i1=st(iJ.prototype,"emitAnalyticsEvents",[iK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i2=st(iJ.prototype,"makeSound",[iH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i4=st(iJ.prototype,"soundKey",[iq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iy[ih.BUTTON_CLICK]}}),i3=st(iJ.prototype,"disableSpamClick",[iW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),i5=st(iJ.prototype,"disableSpamDelay",[ij],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),i6=st(iJ.prototype,"isScrollViewCancelInnerEvents",[iX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),iY=iJ))||iY)||iY)||iY);_._RF.pop(),_._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var ac=k.ccclass,ah=k.requireComponent,ap=k.property,ad=ac("OpacityToggler")(i9=ah([eu])((ae=st((i7=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"activeValue",ae,Ke(g)),rt(g,"inActiveValue",an,Ke(g)),g.signal=new nD,g}return Ue(i,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"changeState",value:function(g){var E=arguments.length>0&&void 0!==g&&g;this.signal.abort(),this.opacityComponent.opacity=E?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(E=Be(function(){var g,E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:g=k.length>0&&void 0!==k[0]&&k[0],E=k.length>1&&void 0!==k[1]?k[1]:.2;this.signal.abort(),this.signal=new nD;_=g?this.activeValue:this.inActiveValue;return[4,tZ.runTweenAsync(x(this.opacityComponent).to(E,{opacity:_}),this.signal)];case 1:C.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(D)).prototype,"activeValue",[ap],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),an=st(i7.prototype,"inActiveValue",[ap],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),i9=i7))||i9)||i9;_._RF.pop(),_._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);var ay,av,ag,am={Portrait:"portrait",Landscape:"landscape"},ab={Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}};_._RF.pop(),_._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var aw,aS,aE,a_,ak,aC,aA,aT,aR,aI,aL,aP,aO,aB,aN,aD,aM,aF,aU,az,ax=k.ccclass,aG=k.property,aV=k.requireComponent,aK=k.disallowMultiple,aH=k.executeInEditMode,aq=ab,aW=aq.Portrait,aj=aq.Landscape;ax("DebugResolution")(ay=aK(ay=aV([ef])(ay=aH(!0)(((ag=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleLayoutChange=function(){var E;null===(E=g.graphics)||void 0===E||E.clear(),g.start()},g}return Ue(n,[{key:"drawPortrait",get:function(){return n._drawPortrait},set:function(g){g!==n._drawPortrait&&(g?this.drawPortraitResolution():this.graphics.clear(),n._drawPortrait=g,n._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return n._drawLandscape},set:function(g){g!==n._drawLandscape&&(g?this.drawLandscapeResolution():this.graphics.clear(),n._drawLandscape=g,n._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(ef),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t6,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var g=this.graphics,E=aW.WIDTH,_=aW.HEIGHT,k=-E/2,C=-_/2;g.strokeColor=A.GREEN,g.rect(k,C,E,_),g.stroke()}},{key:"drawLandscapeResolution",value:function(){var g=this.graphics,E=aj.WIDTH,_=aj.HEIGHT,k=-E/2,C=-_/2;g.strokeColor=A.CYAN,g.rect(k,C,E,_),g.stroke()}}]),n}(D))._drawPortrait=!0,ag._drawLandscape=!0,st((av=ag).prototype,"drawPortrait",[aG],Object.getOwnPropertyDescriptor(av.prototype,"drawPortrait"),av.prototype),st(av.prototype,"drawLandscape",[aG],Object.getOwnPropertyDescriptor(av.prototype,"drawLandscape"),av.prototype),ay=av))||ay)||ay)||ay);_._RF.pop(),_._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var aX=k.ccclass,aY=k.executionOrder,aJ=k.property,aQ=GameCore.Utils.Valid,aZ=A.RED,a$=A.BLACK,a0=A.MAGENTA;aw=aX("GameStats"),aS=aY(-1e3),aE=aJ(L),a_=aJ(L),ak=aJ(L),aC=aJ(L),aA=aJ(L),aT=aJ(L),aR=aJ(L),aI=aJ(L),aw(aL=aS((aO=st((aP=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"fpsLabel",aO,Ke(g)),rt(g,"drawCountLabel",aB,Ke(g)),rt(g,"logicTimeLabel",aN,Ke(g)),rt(g,"physicTimeLabel",aD,Ke(g)),rt(g,"renderTimeLabel",aM,Ke(g)),rt(g,"objectMemoryUsageLabel",aF,Ke(g)),rt(g,"textureMemoryUsageLabel",aU,Ke(g)),rt(g,"devicePixelRatioLabel",az,Ke(g)),g.refreshInterval=.5,g.handleMouseDown=function(){g.bg.enabled=!g.bg.enabled},g.waitForStats=function(){ey.stats&&(g.unschedule(g.waitForStats),g.node.active=!0,g.stats=ey.stats,g.startUpdateStats())},g.updateStats=function(){g.updateFps(),g.updateDrawCalls(),g.updateLogicTime(),g.updatePhysicTime(),g.updateRenderTime(),g.updateObjectMemoryUsage(),g.updateTextureMemoryUsage(),g.updateDevicePixelRatio()},g}return Ue(n,[{key:"__preload",value:function(){this.bg=this.getComponent(eo),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(ep.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,ey&&aQ.isDebugger()&&(ey.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var g=this.getFps();this.updateFpsColor(g),this.fpsLabel.string="FPS: ".concat(g)}},{key:"updateFpsColor",value:function(g){this.fpsLabel.color=g<30?aZ:g<48?a0:a$}},{key:"updateDrawCalls",value:function(){var g=this.getDrawCalls();this.updateDrawCallsColor(g),this.drawCountLabel.string="Draw Calls: ".concat(g)}},{key:"updateDrawCallsColor",value:function(g){var E=ev.os===ev.OS.IOS,_=E?80:25,k=E?60:15;this.drawCountLabel.color=g>_?aZ:g>k?a0:a$}},{key:"updateLogicTime",value:function(){var g=this.getLogicTime();this.updateLogicTimeColor(g),this.logicTimeLabel.string="Logic Time: ".concat(g.toFixed(2),"ms")}},{key:"updateLogicTimeColor",value:function(g){this.logicTimeLabel.color=g>10?aZ:g>5?a0:a$}},{key:"updatePhysicTime",value:function(){var g=this.getPhysicTime();this.updatePhysicTimeColor(g),this.physicTimeLabel.string="Physic Time: ".concat(g.toFixed(2),"ms")}},{key:"updatePhysicTimeColor",value:function(g){this.physicTimeLabel.color=g>10?aZ:g>5?a0:a$}},{key:"updateRenderTime",value:function(){var g=this.getRenderTime();this.updateRenderTimeColor(g),this.renderTimeLabel.string="Render Time: ".concat(g.toFixed(2),"ms")}},{key:"updateRenderTimeColor",value:function(g){this.renderTimeLabel.color=g>10?aZ:g>5?a0:a$}},{key:"updateObjectMemoryUsage",value:function(){var g=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(g),this.objectMemoryUsageLabel.string="Object Mem: ".concat(g.toFixed(2),"MB")}},{key:"updateObjectMemoryUsageColor",value:function(g){this.objectMemoryUsageLabel.color=g>40?aZ:g>25?a0:a$}},{key:"updateTextureMemoryUsage",value:function(){var g=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(g),this.textureMemoryUsageLabel.string="Texture Mem: ".concat(g.toFixed(2),"MB")}},{key:"updateTextureMemoryUsageColor",value:function(g){this.textureMemoryUsageLabel.color=g>50?aZ:g>35?a0:a$}},{key:"updateDevicePixelRatio",value:function(){var g=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(g),this.devicePixelRatioLabel.string="Device Pixel Ratio: ".concat(g)}},{key:"updateDevicePixelRatioColor",value:function(g){this.devicePixelRatioLabel.color=g>2?aZ:g<=1?a0:a$}},{key:"getFps",value:function(){var g=this.stats.fps.counter;return Math.floor(g.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var g=this.stats.logic.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getPhysicTime",value:function(){var g=this.stats.physics.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getRenderTime",value:function(){var g=this.stats.render.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var g=this.stats.bufferMemory.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var g=this.stats.textureMemory.counter;return Math.floor(1e3*g.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),n}(D)).prototype,"fpsLabel",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aB=st(aP.prototype,"drawCountLabel",[a_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aN=st(aP.prototype,"logicTimeLabel",[ak],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aD=st(aP.prototype,"physicTimeLabel",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aM=st(aP.prototype,"renderTimeLabel",[aA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aF=st(aP.prototype,"objectMemoryUsageLabel",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aU=st(aP.prototype,"textureMemoryUsageLabel",[aR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),az=st(aP.prototype,"devicePixelRatioLabel",[aI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aL=aP))||aL);_._RF.pop(),_._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var a1,a2=function(g){return g.INVITE_FRIENDS="invite-friends",g.REPLAY_FRIENDS="replay-friends",g.SHOW_CHALLENGE_RESULTS="show-challenge-results",g.NEXT_LEVEL="next-level",g.MAX_LEVEL="max-level",g.START_OVER="start-over",g.SELECT_LEVEL="select-level",g.GAME_START="game-start",g.GAME_PAUSE="game-pause",g.GAME_RESUME="game-resume",g.GAME_REPLAY="game-replay",g.GAME_FINISH="game-finish",g.GAME_EXIT="game-exit",g.USE_ITEM="use-item",g.SKIP_LEVEL="skip-level",g.ADD_ITEM="add-item",g.ADD_ITEMS="add-items",g.ADD_COINS="add-coins",g.REMOVE_COINS="remove-coins",g.REMOVE_COINS_SUCCESS="remove-coins-success",g.REMOVE_COINS_FAILED="remove-coins-failed",g.COIN_CHANGED="coin-changed",g.ABORT_COIN_ANIMATION="abort-coin-animation",g.ADD_STARS="add-stars",g.PAUSE_TIME="pause-time",g.RESUME_TIME="resume-time",g.TIME_OUT="time-out",g.HALF_TIME="half-time",g.RESCUE_START="rescue-time",g.RESCUE_FINISHED="clock-animation-finished",g.APPLY_GRAVITY="apply-gravity",g.IDLE_ENTER="idle-enter",g.IDLE_EXIT="idle-exit",g.GRID_MATCH="grid-match",g.GRID_MATCH_SUCCESS="grid-match-success",g.GRID_MATCH_FAIL="grid-match-fail",g.GRID_CLEAR="grid-clear",g.GRID_SPAWN="grid-spawn",g.GRID_CREATE="grid-create",g.GRID_RESIZE="grid-resize",g.TILE_CLICK="tile-click",g.BOMB_EXPLODE="bomb-explode",g.SHOW_HINT="show-hint",g.ADD_COMBO="add-combo",g.COMBO_UPDATED="combo-updated",g.COMBO_ENDED="combo-ended",g.ADD_SCORE="add-score",g.SCORE_UPDATED="score-updated",g.SHOW_UI="show-ui",g.HIDE_UI="hide-ui",g.AUTO_PLAY="auto-play",g.GUIDE_MASK_CLICKED="guide-mask-clicked",g}(a2||{});_._RF.pop(),_._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var a4,a3,a5,a6,a8,a9,a7,re,rn,ri,ra,rr,ro,rs,rl,ru,rc,rh,rp=(0,k.ccclass)("PanelAnimationController")(a1=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).animators=new Set,g.eventTarget=new eg,g.handleRegistration=function(E){if(!E)throw new Error("Invalid event payload.");g.animators.has(E)&&console.warn("Animator already registered."),g.animators.add(E)},g.handleUnregistration=function(E){if(!E)throw new Error("Invalid event payload.");g.animators.has(E)||console.warn("Animator not registered."),g.animators.delete(E)},g.handleShowUIs=function(){var E=Be(function(E){var _,k,C,A,T,R,I,L,P,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:C=!1,A=[],T=at(g.animators);try{for(T.s();!(k=T.n()).done;){R=k.value;A.push(R)}}catch(g){T.e(g)}finally{T.f()}for(I=[],L=0,P=A;L<P.length;L++){B=P[L];if(!B.isReadyForAnimation()&&!C)C=!0,null==E||null===(O=E.fallback)||void 0===O||O.call(E);I.push(B.handleShowUI())}return[4,Promise.all(I)];case 1:N.sent(),null==E||null===(_=E.onComplete)||void 0===_||_.call(E),g.eventTarget.emit(a2.SHOW_UI);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g.handleHideUIs=function(){var E=Be(function(E){var _,k,C,A,T,R,I,L,P,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:C=!1,A=[],T=at(g.animators);try{for(T.s();!(k=T.n()).done;){R=k.value;A.push(R)}}catch(g){T.e(g)}finally{T.f()}for(I=[],L=0,P=A;L<P.length;L++){B=P[L];if(!B.isReadyForAnimation()&&!C)C=!0,null==E||null===(O=E.fallback)||void 0===O||O.call(E);I.push(B.handleHideUI())}return[4,Promise.all(I)];case 1:N.sent(),null==E||null===(_=E.onComplete)||void 0===_||_.call(E),g.eventTarget.emit(a2.HIDE_UI);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(n,[{key:"onEnable",value:function(){this.node.scene.on(a2.SHOW_UI,this.handleShowUIs,this),this.node.scene.on(a2.HIDE_UI,this.handleHideUIs,this)}},{key:"onDisable",value:function(){this.node.scene.off(a2.SHOW_UI,this.handleShowUIs,this),this.node.scene.off(a2.HIDE_UI,this.handleHideUIs,this)}},{key:"showUI",value:function(){return this.handleShowUIs()}},{key:"hideUI",value:function(){return this.handleHideUIs()}},{key:"on",value:function(g,E,_,k){this.eventTarget.on(g,E,_,k)}},{key:"off",value:function(g,E,_){this.eventTarget.off(g,E,_)}}],[{key:"getController",value:function(g){for(var E=null,_=g;null!==_;){if(E=_.getComponent(n))break;_=_.parent}return E}},{key:"registerAnimator",value:function(g){var E=this.getController(g.node);E?E.handleRegistration(g):console.warn("No PanelAnimationController found for animator ".concat(g.node.name))}},{key:"unregisterAnimator",value:function(g){var E=this.getController(g.node);E?E.handleUnregistration(g):console.warn("No PanelAnimationController found for animator ".concat(g.node.name))}}]),n}(D))||a1;_._RF.pop(),_._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var rd,rf,ry,rv,rg,rm,rb,rw,rS,rE,r_,rk,rC=k.ccclass,rA=k.property,rT=GameCore.Utils.Object,rR=(a4=rC("AnimationConfig"),a3=rA({type:[H]}),a4((a8=st((a6=function(){function e(){Fe(this,e),rt(this,"startHidden",a8,this),rt(this,"nodes",a9,this),rt(this,"posOffset",a7,this),rt(this,"showEase",re,this),rt(this,"hideEase",rn,this),rt(this,"showDuration",ri,this),rt(this,"hideDuration",ra,this)}return Ue(e,[{key:"setConfig",value:function(g){g&&rT.assign(this,g)}}]),e}()).prototype,"startHidden",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),a9=st(a6.prototype,"nodes",[a3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),a7=st(a6.prototype,"posOffset",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),re=st(a6.prototype,"showEase",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),rn=st(a6.prototype,"hideEase",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),ri=st(a6.prototype,"showDuration",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ra=st(a6.prototype,"hideDuration",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a5=a6))||a5),rI=(rr=rC("PanelAnimator"),ro=rA({type:rR,displayName:"Top animation nodes"}),rs=rA({type:rR,displayName:"Bottom animation nodes"}),rr((rc=st((ru=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"topConfig",rc,Ke(g)),rt(g,"botConfig",rh,Ke(g)),g.isReady=!1,g}return Ue(a,[{key:"onEnable",value:function(){rp.registerAnimator(this)}},{key:"onDisable",value:function(){rp.unregisterAnimator(this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(_=Be(function(){return _ts_generator(this,function(g){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return _.apply(this,arguments)})},{key:"handleHideUI",value:(E=Be(function(){return _ts_generator(this,function(g){if(this.isReady)return[2,Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")])];console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"));return[2]})}),function(){return E.apply(this,arguments)})},{key:"createAnimator",value:function(g,E){var _=g.nodes,k=g.posOffset,C=g.showEase,A=g.hideEase,T=g.showDuration,R=g.hideDuration,I=_.map(function(g){return"top"===E&&g.isAlignTop?{mode:"top",value:g.top}:"bottom"===E&&g.isAlignBottom?{mode:"bottom",value:g.bottom}:{mode:"position",value:g.node.position.y}}),L=_.map(function(g){return"top"===E&&g.isAlignTop?{mode:"top",value:g.top+k}:"bottom"===E&&g.isAlignBottom?{mode:"bottom",value:g.bottom-k}:{mode:"position",value:g.node.position.y+k}}),P="shown",O=new nD;return{switchState:function(g,E){var k=arguments.length>1&&void 0!==E&&E;if(O.abort(),O=new nD,P===g)return Promise.resolve(null);P=g;var B="hidden"===g?I:L,N="hidden"===g?L:I,D="hidden"===g?R:T,M="hidden"===g?A:C;return k?(_.forEach(function(g,E){var _=B[E],k=N[E].value;"top"===_.mode&&(g.top=k),"bottom"===_.mode&&(g.bottom=k),"position"===_.mode&&(g.node.position=new em(g.node.position.x,k,g.node.position.z))}),Promise.resolve(null)):Promise.all(_.map(function(g,E){var _=B[E],k=N[E].value;return tZ.runTweenAsync(a.getTween({widget:g,config:_,target:k,easing:M,duration:D}),O)}))}}}},{key:"setAnimator",value:function(g){var E=g.topConfig,_=g.botConfig,k=new rR,C=new rR;k.setConfig(E),C.setConfig(_),this.topConfig=k,this.botConfig=C,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(g){var E=g.widget,_=g.config,k=g.target,C=g.easing,A=g.duration;return"top"===_.mode?x(E).call(function(){E.top=_.value}).to(A,{top:k},{easing:C}):"bottom"===_.mode?x(E).call(function(){E.bottom=_.value}).to(A,{bottom:k},{easing:C}):x(E.node.position).call(function(){E.node.position=new em(E.node.position.x,_.value,E.node.position.z)}).to(A,{y:k},{easing:C})}}]),a}(D)).prototype,"topConfig",[ro],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rR}}),rh=st(ru.prototype,"botConfig",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rR}}),rl=ru))||rl);_._RF.pop(),_._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var rL,rP,rO,rB,rN,rD,rM,rF,rU,rz,rx,rG=k.ccclass,rV=k.requireComponent,rK=k.property,rH=globalThis.game,rq=rH.ads,rW=rH.event,rj=GameCore,rX=rj.Events,rY=rj.Configs.Ads.BannerDisplayAdOptions,rJ=rj.Plugins.Ads,rQ=rJ.Types,rZ=rJ.Status,r$=rj.Utils,r0=r$.Array,r1=r$.Function,r2=["top","topleft","topright"],r4=["bottom","bottomleft","bottomright"],r3=["left","topleft","bottomleft"],r5=["right","topright","bottomright"];rd=rG("ResizeWithBannerAd"),rf=rV(H),ry=rK(J),rv=rK(J),rg=rK(J),rm=rK(J),rd(rb=rf((rS=st((rw=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"includeSAB",rS,Ke(g)),rt(g,"includeRightBanner",rE,Ke(g)),rt(g,"includeBottomBanner",r_,Ke(g)),rt(g,"includeLeftBanner",rk,Ke(g)),g.handleOnAdShowing=function(E){var _=E.placementId;g.checkValid()&&_&&rq.getAd(rQ.BANNER,_)&&(g.resizeWhenBannerAdShow(_),g.emitResizeEvent())},g.handleOnAdClosed=function(E){var _=E.placementId;g.checkValid()&&_&&rq.getAd(rQ.BANNER,_)&&(g.resizeWhenBannerAdClose(_),g.emitResizeEvent())},g.handleOnResize=function(){g.checkValid()&&rY.forEach(function(E){var _=E.PlacementId,k=rq.getAdStatus(rQ.BANNER,_);k&&(k===rZ.SHOWING?g.resizeWhenBannerAdShow(_):k===rZ.IDLE&&g.resizeWhenBannerAdClose(_))})},g.resizeWhenBannerAdShow=function(E){var _=void 0,k=void 0,C=void 0,A=void 0,T=ns.cssSizeToWorldSize(1),R=rq.getBannerConfig(E),I=R.PlacementId,L=R.BannerWidth,P=R.Position;if("top"===P)_=rq.getBannerHeight(I,T);else if("bottom"===P)g.includeBottomBanner?k=rq.getBannerHeight(I,T,g.includeSAB):g.includeSAB&&(k=rq.getSafeAreaBottom(T));else if("left"===P||"right"===P){if(void 0===L)return;var O=L;"getBannerOffset"in GameSDK.extra&&(O+=GameSDK.extra.getBannerOffset()),"left"===P&&g.includeLeftBanner?C=O*T:"right"===P&&g.includeRightBanner&&(A=O*T)}g.updateWidgets({top:_,bottom:k,left:C,right:A})},g.resizeWhenBannerAdClose=function(E){var _=rq.getBannerConfig(E).Position,k=ns.cssSizeToWorldSize(1),C=g.includeSAB?rq.getSafeAreaBottom(k):0;g.updateWidgets({top:r0.has(r2,_)?0:void 0,bottom:r0.has(r4,_)?C:void 0,left:r0.has(r3,_)?0:void 0,right:r0.has(r5,_)?0:void 0})},g.emitResizeEvent=r1.debounce(function(){Q.emit(no)},100),g}return Ue(n,[{key:"__preload",value:function(){this.widget=this.getComponent(H),nC.lazyValidateProperties(this),rW.on(rX.AD_SHOWING,this.handleOnAdShowing),rW.on(rX.AD_CLOSED,this.handleOnAdClosed),Q.on(t3,this.handleOnResize)}},{key:"onDestroy",value:function(){rW.off(rX.AD_SHOWING,this.handleOnAdShowing),rW.off(rX.AD_CLOSED,this.handleOnAdClosed),Q.off(t3,this.handleOnResize)}},{key:"start",value:function(){this.handleOnResize()}},{key:"updateWidgets",value:function(g){var E=g.top,_=g.bottom,k=g.left,C=g.right;this.widget.top=null!=E?E:this.widget.top,this.widget.bottom=null!=_?_:this.widget.bottom,this.widget.left=null!=k?k:this.widget.left,this.widget.right=null!=C?C:this.widget.right,eb.instance.emit("canvas-resize")}},{key:"checkValid",value:function(){return this.node.activeInHierarchy&&null!==this.node.parent&&void 0!==this.node.parent}}]),n}(D)).prototype,"includeSAB",[ry],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rE=st(rw.prototype,"includeRightBanner",[rv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),r_=st(rw.prototype,"includeBottomBanner",[rg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rk=st(rw.prototype,"includeLeftBanner",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rb=rw))||rb);_._RF.pop(),_._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var r6,r8,r9,r7,oe,on,oi,oa=k.ccclass,or=k.property,oo=k.executeInEditMode,os=k.requireComponent,ol=(rL=oa("TapperedProgressBar"),rP=os(eu),rO=or({type:eu,displayName:"Fill opacity"}),rB=or({type:eo,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),rN=or({type:eo,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),rD=or({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),rL(rM=oo(rM=rP((rU=st((rF=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"uiOpacity",rU,Ke(g)),rt(g,"leftCap",rz,Ke(g)),rt(g,"rightCap",rx,Ke(g)),g}return Ue(n,[{key:"progress",get:function(){return Je(Ve(n.prototype),"progress",this)},set:function(g){$e(Ve(n.prototype),"progress",g,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity){if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var g=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=g}}}},{key:"start",value:function(){this.updateAppearance()}}]),n}(ew)).prototype,"uiOpacity",[rO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rz=st(rF.prototype,"leftCap",[rB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rx=st(rF.prototype,"rightCap",[rN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),st(rF.prototype,"progress",[rD],Object.getOwnPropertyDescriptor(rF.prototype,"progress"),rF.prototype),rM=rF))||rM)||rM)||rM);_._RF.pop(),_._RF.push({},"aa60frMJLtIlJZh2yJhMp1s","DynamicLabel",void 0);var ou,oc,oh,op,oy,ov,og,om,ob,ow,oS=k.ccclass,oE=k.property,o_=k.executeInEditMode,ok=k.requireComponent;r6=oS("DynamicLabel"),r8=ok(L),r9=o_(!0),r7=oE({type:K,min:1,max:200}),oe=oE({type:K,min:.1,max:4}),r6(on=r8(on=r9((st((oi=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k)))._quality=1,g._size=1,g._outlineWidth=0,g._shadowOffset=new eS(0,0),g}return Ue(n,[{key:"size",get:function(){return this._size},set:function(g){this._size=g,this.label.fontSize=this.size*this.quality}},{key:"quality",get:function(){return this._quality},set:function(g){this._quality=g,this.node.scale=new em(1/this.quality,1/this.quality,1),this.label.fontSize=this.size*this.quality,this.label.outlineWidth=this._outlineWidth*this.quality,this.label.shadowOffset=this._shadowOffset.multiplyScalar(this.quality)}},{key:"__preload",value:function(){this.label=this.getComponent(L)}},{key:"start",value:function(){this._quality=1/this.node.scale.x,this._size=this.label.fontSize/this.quality,this._outlineWidth=this.label.outlineWidth,this._shadowOffset=this.label.shadowOffset,this.quality=window.devicePixelRatio,console.info("\uD83D\uDD20 ".concat(this.node.name,"<Label> quality:"),this.quality)}}]),n}(D)).prototype,"size",[r7],Object.getOwnPropertyDescriptor(oi.prototype,"size"),oi.prototype),st(oi.prototype,"quality",[oe],Object.getOwnPropertyDescriptor(oi.prototype,"quality"),oi.prototype),on=oi))||on)||on);_._RF.pop(),_._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var oC,oA,oT,oR,oI,oL,oP,oO,oB,oN=k.ccclass,oD=k.property,oM=k.requireComponent,oF=k.executeInEditMode,oU=k.disallowMultiple,oz=globalThis.game.language;ou=oN("Localize"),oc=oM(L),oh=oF(!0),op=oD({visible:!0}),oy=oD({group:{name:"Fonts",id:"fonts",displayOrder:1},type:eE}),ov=oD({group:{name:"Fonts",id:"fonts",displayOrder:2},type:eE}),ou(og=oU(og=oc(og=oh((st((om=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"enFont",ob,Ke(g)),rt(g,"ruFont",ow,Ke(g)),g.handleLanguageChanged=function(){g.updateTransToNode()},g}return Ue(n,[{key:"key",get:function(){return this._key},set:function(g){g&&(this._key=g,this.updateTransToNode())}},{key:"__preload",value:function(){this.label=this.getComponent(L),this.validateRequiredComponents(),this.updateTransToNode()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"start",value:function(){this.listenEvent()}},{key:"listenEvent",value:function(){Q.on("update-language",this.handleLanguageChanged)}},{key:"updateTransToNode",value:function(){if(this.node.active&&this._key)try{var g=oz.getText(this._key),E=this.getFontByLang();this.label.font=E,this.label.string=g,this.node.emit("update-trans",g)}catch(g){console.warn(g)}}},{key:"getFontByLang",value:function(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(oz.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}]),n}(D)).prototype,"key",[op],Object.getOwnPropertyDescriptor(om.prototype,"key"),om.prototype),ob=st(om.prototype,"enFont",[oy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ow=st(om.prototype,"ruFont",[ov],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),og=om))||og)||og)||og);_._RF.pop(),_._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var ox,oG,oV,oK,oH,oq,oW,oj,oX,oY=k.ccclass,oJ=k.property,oQ=function(){function e(g,E){Fe(this,e);var _=null!=E?E:{response:1,dampen:1,eager:1};this.k1=e.calcK1(_),this.k2=e.calcK2(_),this.k3=e.calcK3(_),this.xp=g.clone(),this.y=g.clone(),this.yd=new eS(0,0)}return Ue(e,[{key:"update",value:function(g,E,_){var k=arguments.length>2&&void 0!==_?_:null,C=k;null===C&&(C=new eS((E.x-this.xp.x)/g,(E.y-this.xp.y)/g),this.xp.x=E.x,this.xp.y=E.y);var A=Math.max(this.k2,g*g/2+g*this.k1/2,g*this.k1);return this.y.x=this.y.x+g*this.yd.x,this.y.y=this.y.y+g*this.yd.y,this.yd.x=this.yd.x+g*(E.x+this.k3*C.x-this.y.x-this.k1*this.yd.x)/A,this.yd.y=this.yd.y+g*(E.y+this.k3*C.y-this.y.y-this.k1*this.yd.y)/A,this.y}},{key:"setDynamics",value:function(g){this.k1=e.calcK1(g),this.k2=e.calcK2(g),this.k3=e.calcK3(g)}},{key:"reset",value:function(g){this.xp.set(g.x,g.y),this.y.set(g.x,g.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(g){return g.dampen/(Math.PI*g.response)}},{key:"calcK2",value:function(g){return 1/(2*Math.PI*g.response*(2*Math.PI*g.response))}},{key:"calcK3",value:function(g){return g.eager*g.dampen/(2*Math.PI*g.response)}}]),e}(),oZ=(oC=oY("SODConfig"),oA=oJ({type:K,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),oT=oJ({type:K,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),oR=oJ({type:K,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),oC((oP=st((oL=Ue(function e(){Fe(this,e),rt(this,"response",oP,this),rt(this,"dampen",oO,this),rt(this,"eager",oB,this)})).prototype,"response",[oA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),oO=st(oL.prototype,"dampen",[oT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),oB=st(oL.prototype,"eager",[oR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oI=oL))||oI);_._RF.pop(),_._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var o$,o0,o1,o2,o4,o3,o5,o6,o8,o9,o7,se,sn,si,sa,sr,so,ss,sl,su,sc,sh,sp,sd,sf,sy,sv=k.ccclass,sg=k.property,sm=(ox=sv("Trail"),oG=sg({type:C,displayName:"Target"}),oV=sg({type:ef,displayName:"Graphics"}),oK=sg({type:[oZ],displayName:"Trail Nodes"}),ox((oW=st((oq=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"target",oW,Ke(g)),rt(g,"graphics",oj,Ke(g)),rt(g,"trailNodes",oX,Ke(g)),g.trailNodeInstances=[],g}return Ue(n,[{key:"reset",value:function(){var g,E=at(this.trailNodeInstances);try{for(E.s();!(g=E.n()).done;)g.value.reset(new eS(this.node.worldPosition.x,this.node.worldPosition.y))}catch(g){E.e(g)}finally{E.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(g){this.graphics.clear();var E=this.trailNodeInstances[0];this.drawTrail(g,E,this.target.worldPosition.x,this.target.worldPosition.y);for(var _=1;_<this.trailNodeInstances.length;_++){var k=this.trailNodeInstances[_-1],C=this.trailNodeInstances[_];this.drawTrail(g,C,k.currentState.x,k.currentState.y)}}},{key:"drawTrail",value:function(g,E,_,k){var C=this.graphics,A=new eS(_,k),T=E.update(g,A),R=new em(A.x,A.y,0),I=new em(T.x,T.y,0);C.node.inverseTransformPoint(R,R),C.node.inverseTransformPoint(I,I),C.moveTo(R.x,R.y),C.lineTo(I.x,I.y),C.stroke()}},{key:"spawnTrailNodes",value:function(){var g,E=at(this.trailNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value,k=new eS(this.node.worldPosition.x,this.node.worldPosition.y),C=new oQ(k,_);this.trailNodeInstances.push(C)}}catch(g){E.e(g)}finally{E.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(D)).prototype,"target",[oG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oj=st(oq.prototype,"graphics",[oV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oX=st(oq.prototype,"trailNodes",[oK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oH=oq))||oH);_._RF.pop(),_._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var sb,sw=k.ccclass,sS=k.executionOrder,sE=k.property,s_=GameCore.Utils.Function,sk="Batch By Name",sC="Batch Label",sA="Batch Sprite",sT=(o$=sw("BatchNodes"),o0=sS(99999),o1=sE({group:{name:sk}}),o2=sE({type:[V],group:{name:sk}}),o4=sE({type:[z],group:{name:sk}}),o3=sE({group:{name:sC}}),o5=sE({group:{name:sC}}),o6=sE({group:{name:sC}}),o8=sE({group:{name:sA}}),o9=sE({group:{name:sA}}),o7=sE({readonly:!0}),se=sE({readonly:!0}),sn=sE({readonly:!0}),o$(si=o0((sr=st((sa=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"batchByName",sr,Ke(g)),rt(g,"depthNames",so,Ke(g)),rt(g,"listName",ss,Ke(g)),rt(g,"batchLabel",sl,Ke(g)),rt(g,"depthLabel",su,Ke(g)),rt(g,"typeLabel",sc,Ke(g)),rt(g,"batchSprite",sh,Ke(g)),rt(g,"depthSprite",sp,Ke(g)),rt(g,"batchAllNodes",sd,Ke(g)),rt(g,"batchDepth",sf,Ke(g)),rt(g,"checkOverlap",sy,Ke(g)),g.batchNode={},g.labelChildren=[],g.spriteChildren=[],g.allChildren=[],g.nameChildren=[],g.originalParents={},g.isInited=!1,g.handleNodeChange=s_.throttle(function(){g.isInited&&(console.warn("handleNodeChange",g.node.name),g.setupBatchNodes(g.node))},1e3),g.onAfterUpdate=function(){g.isInited&&g.hierarchyChildren()},g.onAfterRender=function(){g.isInited&&g.restoreOriginalChildren()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled&&(N.on(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.on(e_.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){N.off(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.off(e_.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){this.isInited||(N.on(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.on(e_.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"handleActiveChange",value:function(g){g.once(C.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.handleNodeChange)}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),N.off(e_.EVENT_AFTER_UPDATE,this.onAfterUpdate),N.off(e_.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(g){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(g),this.createGlobalNodes(g),this.createGlobalNameNodes(g),this.createGlobalLabelNode(g),this.createGlobalSpriteNode(g),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var g,E,_,k=this;null===(g=this.batchNode.node)||void 0===g||g.setSiblingIndex(0),null===(E=this.batchNode.label)||void 0===E||E.setSiblingIndex(this.depthLabel),null===(_=this.batchNode.sprite)||void 0===_||_.setSiblingIndex(this.depthSprite),this.listName.forEach(function(g,E){var _;console.log("name",g,k.depthNames[E]),null===(_=k.batchNode[g])||void 0===_||_.setSiblingIndex(k.depthNames[E])})}},{key:"createGlobalNodes",value:function(g){if(this.batchAllNodes){var E=new C("GlobalBatchNode");E.active=!0,this.batchNode.node=E,g.addChild(E)}}},{key:"createGlobalNameNodes",value:function(g){if(this.batchByName){var E,_=at(this.listName);try{for(_.s();!(E=_.n()).done;){var k=E.value;if(!this.batchNode[k]){var A=new C(k);A.active=!0,this.batchNode[k]=A,g.addChild(A)}}}catch(g){_.e(g)}finally{_.f()}}}},{key:"createGlobalLabelNode",value:function(g){if(this.batchLabel){var E=new C("GlobalLabelNode");E.active=!0,this.batchNode.label=E,g.addChild(E)}}},{key:"createGlobalSpriteNode",value:function(g){if(this.batchSprite){var E=new C("GlobalSpriteNode");E.active=!0,this.batchNode.sprite=E,g.addChild(E)}}},{key:"saveOriginalParents",value:function(){var g,E=[].concat(tt(this.labelChildren),tt(this.spriteChildren)),_=this.nameChildren,k=at(E);try{for(k.s();!(g=k.n()).done;){var C=g.value;C.node.parent&&(this.handleActiveChange(C.node),this.originalParents[C.uuid]=C.node.parent)}}catch(g){k.e(g)}finally{k.f()}var A,T=at(_);try{for(T.s();!(A=T.n()).done;){var R=A.value;R.parent&&(this.handleActiveChange(R),this.originalParents[R.uuid]=R.parent)}}catch(g){T.e(g)}finally{T.f()}}},{key:"saveOriginalChildren",value:function(g){var E,_=at(g.children);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.saveLabelChildren(k),this.saveSpriteChildren(k),this.saveNodeChildrenByName(k),this.saveNodeChildrenByType(k)}}catch(g){_.e(g)}finally{_.f()}this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(g){var E;if(this.batchLabel){var _=g.getComponentsInChildren(L);"char"===this.typeLabel&&(_=_.filter(function(g){return g.cacheMode===L.CacheMode.CHAR})),0!==_.length&&(E=this.labelChildren).push.apply(E,tt(_))}}},{key:"saveSpriteChildren",value:function(g){var E;if(this.batchSprite){var _=g.getComponentsInChildren(eo);0!==_.length&&(E=this.spriteChildren).push.apply(E,tt(_))}}},{key:"saveNodeChildrenByName",value:function(g){if(this.batchByName){var E,_=at(g.children);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.listName.includes(k.name)?this.nameChildren.push(k):this.saveNodeChildrenByName(k)}}catch(g){_.e(g)}finally{_.f()}}}},{key:"saveNodeChildrenByType",value:function(g,E){var _,k=arguments.length>1&&void 0!==E?E:0;if(this.batchAllNodes){var C=g.getComponentsInChildren(D);if((_=this.allChildren).push.apply(_,tt(C)),!(this.batchDepth<1||k>=this.batchDepth)){var A,T=at(this.allChildren);try{for(T.s();!(A=T.n()).done;){var R=A.value;this.saveNodeChildrenByType(R.node,this.batchDepth)}}catch(g){T.e(g)}finally{T.f()}}}}},{key:"hierarchyChildren",value:function(){var g,t=function(g,E){g.node.isValid&&g.node.activeInHierarchy&&!g.node.isChildOf(E)&&(g.node.setParent(E,!0),g.node.layer=ek.Enum.UI_2D)},E=["GlobalLabelNode","GlobalSpriteNode","GlobalBatchNode"],_=at(this.labelChildren);try{for(_.s();!(g=_.n()).done;)t(g.value,this.batchNode.label)}catch(g){_.e(g)}finally{_.f()}var k,C=at(this.spriteChildren);try{for(C.s();!(k=C.n()).done;)t(k.value,this.batchNode.sprite)}catch(g){C.e(g)}finally{C.f()}var A,T=at(this.allChildren);try{for(T.s();!(A=T.n()).done;)t(A.value,this.batchNode.node)}catch(g){T.e(g)}finally{T.f()}this.allChildren.sort(function(g,E){return g.constructor.name.localeCompare(E.constructor.name)}),this.labelChildren.sort(function(g,E){return g.cacheMode-E.cacheMode});var R,I=at(this.nameChildren);try{for(I.s();!(R=I.n()).done;){var L=R.value;if(L.isValid&&L.activeInHierarchy&&L.isTransformDirty()){var P=L.getComponent(eu);P&&P.opacity<1||E.includes(L.name)||L.isChildOf(this.batchNode[L.name])||(L.setParent(this.batchNode[L.name],!0),L.layer=ek.Enum.UI_2D)}}}catch(g){I.e(g)}finally{I.f()}}},{key:"restoreOriginalChildren",value:function(){var g=[].concat(tt(this.labelChildren),tt(this.spriteChildren));if(g.length>0){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value,C=this.originalParents[k.uuid];C&&(k.node.isChildOf(C)||k.node.setParent(C,!0))}}catch(g){_.e(g)}finally{_.f()}}var A,T=at(this.nameChildren);try{for(T.s();!(A=T.n()).done;){var R=A.value,I=this.originalParents[R.uuid];I&&(R.isChildOf(I)||R.setParent(I,!0))}}catch(g){T.e(g)}finally{T.f()}}}]),n}(D)).prototype,"batchByName",[o1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),so=st(sa.prototype,"depthNames",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ss=st(sa.prototype,"listName",[o4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sl=st(sa.prototype,"batchLabel",[o3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),su=st(sa.prototype,"depthLabel",[o5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),sc=st(sa.prototype,"typeLabel",[o6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),sh=st(sa.prototype,"batchSprite",[o8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sp=st(sa.prototype,"depthSprite",[o9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sd=st(sa.prototype,"batchAllNodes",[o7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sf=st(sa.prototype,"batchDepth",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sy=st(sa.prototype,"checkOverlap",[sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),si=sa))||si)||si);_._RF.pop(),_._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var sR=k.ccclass,sI=GameCore.Utils.Browser,sL=globalThis.game.player,sP=sR("Vibrate")(sb=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"vibrate",value:function(g){if(this.isVibrateEnable()&&!sI.vibrate(g)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!sL.getPlayerSetting("vibrate")}}]),n}(D))||sb;_._RF.pop(),_._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);var sO=1/6;_._RF.pop(),_._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);var sB,sN={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};_._RF.pop(),_._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var sD=10,sM=20,sF=100,sU=(Ge(sB={},sN.HINT,80),Ge(sB,sN.THUNDER,200),Ge(sB,sN.STORM,150),Ge(sB,sN.PLIERS,150),sB),sz=2e3,sx=300;_._RF.pop(),_._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var sG={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};_._RF.pop(),_._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);var sV=De(De({},GameCore.Dtos.Match.Data.getDefaultData()),{},{extraData:null});_._RF.pop(),_._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var sK=function(g){return g.UNLOCK_DEV_TOOLS="unlock-dev-tools",g.TRIGGER_UNLOCK_KEY="trigger-unlock-key",g.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",g}(sK||{}),sH={Events:sK,UNLOCK_SEQUENCE:"101013012031"};_._RF.pop(),_._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);var sq;_._RF.pop(),_._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);var sW={level:0,coins:0,stars:0,totalLevel:400,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:(sq={},Ge(sq,sN.HINT,0),Ge(sq,sN.THUNDER,0),Ge(sq,sN.STORM,0),Ge(sq,sN.PLIERS,0),sq)};_._RF.pop(),_._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);var sj="global-leaderboard-key",sX="friends-leaderboard-key",sY="global-leaderboard-id",sJ="friends-leaderboard-id";_._RF.pop(),_._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);var sQ=De(De({},GameCore.Dtos.Match.CustomData.getDefaultData()),{},{score:0});_._RF.pop(),_._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);var sZ={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:sW,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};_._RF.pop(),_._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);var s$="BootScene",s0="GameScene",s1="DashboardScene",s2="ChallengeResultScene";_._RF.pop(),_._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var s4=function(g){return g.RELOAD_TOURNAMENT="reload-tournament",g}(s4||{});_._RF.pop(),_._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);var s3=GameCore,s5=s3.Configs.FrameCapture,s6=s5.Enabled,s8=s5.WideframeConfigs,s9=s3.Utils.Object,s7=function(){var g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){if(!s6)return[2,(console.warn("FrameCapture is not enabled"),null)];E=ku(g);if(!E)return[2,null];Eu(E,s8.CustomResultChallenge);_=window.game.frameCapture,k=s8.CustomResultChallenge,C=k.Width,A=k.Height;return[2,_.captureAsync({name:"CustomResultChallenge",width:C,height:A,renderOptions:E})]})});return function(E){return g.apply(this,arguments)}}(),Eu=function(g,E){var _=E.Width,k=E.Height,C=E.Wideframe;g.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:C,size:[_,k],position:[0,0]}},ku=function(g){try{var E=g.playerId,_=void 0===E?"10":E,k=g.playerPhoto,C=void 0===k?"":k,A=g.playerScore,T=void 0===A?0:A,R=g.opponentId,I=void 0===R?"20":R,L=g.opponentPhoto,P=void 0===L?"":L,O=g.opponentScore,B=void 0===O?0:O,N=g.isPlayerFinished,D=g.isOpponentFinished,M=s8.CustomResultChallenge.RenderOptions;if(!M)return null;var F=s9.camelCaseKeys(s9.clone(M)||{}),U=F.playerPhoto,z=F.opponentPhoto,x=T===B,G=T>B,V=null!=N?N:D,K=N&&D;return"image"===U.type&&(U.name="".concat(_),U.image=C),"image"===z.type&&(z.name="".concat(I),z.image=P),V&&Cu(F,{playerScore:T,opponentScore:B,isPlayerFinished:N,isOpponentFinished:D}),!K||x?(delete F.leftCrown,delete F.rightCrown,F):(G?delete F.rightCrown:delete F.leftCrown,F)}catch(g){return console.warn("getRenderOptionsShareScore",g),null}},Cu=function(g,E){var _=g.leftScore,k=g.rightScore,C=E.playerScore,A=void 0===C?0:C,T=E.opponentScore,R=void 0===T?0:T,I=E.isPlayerFinished,L=E.isOpponentFinished;"text"===_.type&&(_.text=I?"".concat(A):"???"),"text"===k.type&&(k.text=L?"".concat(R):"???")};_._RF.pop(),_._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var le=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,_)).code=g,k}return Ue(n)}(je(Error));_._RF.pop(),_._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var lt=function(g){ze(n,g);var E=Xe(n);function n(g,_){var k;return Fe(this,n),(k=E.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=g,k.tournamentId=_,k}return Ue(n)}(le);_._RF.pop(),_._RF.push({},"e80e4nIcfdLN56j5b9SMhvH","LeaderboardUtils",void 0);var ln=globalThis.game.leaderboard,li=function(){function e(){Fe(this,e)}var g,E,_;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getAllLeaderboardAsync",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!ln)return[2,null];return[4,ln.getLeaderboardResponseAsync(g)];case 1:E=C.sent();if(!E)return[2,null];_=ln.getLeaderboardName(g);if(!_)return[3,3];return[4,this.requestLeaderboardAsync(_,E.amountPlayer)];case 2:k=(C.sent(),ln.getLeaderboard(_));return[3,4];case 3:k=null;C.label=4;case 4:return[2,k]}})}),function(g){return _.apply(this,arguments)})},{key:"requestLeaderboardAsync",value:(E=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:if(!this.isLeaderboardRequesting(g))return[3,2];return[4,this.waitForLeaderboardFinishAsync(g)];case 1:_.sent();return[3,4];case 2:return[4,ln.requestLeaderboardAsync(g,E)];case 3:_.sent();_.label=4;case 4:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"waitForLeaderboardFinishAsync",value:(g=Be(function(g){var E;return _ts_generator(this,function(_){E=this;return[2,new Promise(function(_){var k=setInterval(function(){E.isLeaderboardRequesting(g)||(clearInterval(k),_())},100)})]})}),function(E){return g.apply(this,arguments)})},{key:"isLeaderboardRequesting",value:function(g){var E;return(null===(E=ln.getLeaderboard(g))||void 0===E?void 0:E.isRequesting)||!1}}]),e}();try{new li}catch(g){console.error("LeaderboardUtils",g)}_._RF.pop(),_._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var la={mapOrder:[{id:1,theme:"summer",skins:["fruit"],levelCount:10},{id:2,theme:"autumn",skins:["flower"],levelCount:10},{id:3,theme:"winter",skins:["tool"],levelCount:10},{id:4,theme:"summer",skins:["sport"],levelCount:10},{id:5,theme:"autumn",skins:["cosmetics"],levelCount:10},{id:6,theme:"winter",skins:["ice-cream"],levelCount:10},{id:7,theme:"summer",skins:["cakes"],levelCount:10},{id:8,theme:"autumn",skins:["car"],levelCount:10},{id:9,theme:"spring-festival",skins:["flower","ice-cream"],levelCount:10},{id:10,theme:"tree-planting-festival",skins:["fruit","car","tool"],levelCount:10},{id:11,theme:"blue-sea-festival",skins:["sport","fruit"],levelCount:10},{id:12,theme:"music-festival",skins:["cakes","car","cosmetics"],levelCount:10},{id:13,theme:"harvest-festival",skins:["fruit","car","tool"],levelCount:10},{id:14,theme:"food-festival",skins:["cakes","ice-cream","cosmetics"],levelCount:10},{id:15,theme:"snow-festival",skins:["cakes","sport"],levelCount:10},{id:16,theme:"light-festival",skins:["ice-cream","car"],levelCount:10},{id:17,theme:"peace-festival",skins:["flower","sport","tool"],levelCount:10},{id:18,theme:"flower-festival",skins:["flower","fruit"],levelCount:10},{id:19,theme:"street-festival",skins:["fruit","ice-cream","sport"],levelCount:10},{id:20,theme:"color-garden",skins:["cakes","cosmetics","tool"],levelCount:10},{id:21,theme:"color-festival",skins:["flower","cakes","fruit"],levelCount:10},{id:22,theme:"nature-summer",skins:["flower","sport"],levelCount:10},{id:23,theme:"snow-mountain",skins:["cakes","ice-cream"],levelCount:10},{id:24,theme:"ice-festival",skins:["ice-cream","cosmetics"],levelCount:10},{id:25,theme:"green-grass-festival",skins:["flower","sport","tool"],levelCount:10},{id:26,theme:"community-festival",skins:["cosmetics","cakes","ice-cream"],levelCount:10},{id:27,theme:"water-festival",skins:["sport","ice-cream","flower"],levelCount:10},{id:28,theme:"animal-festival",skins:["flower","fruit","cakes"],levelCount:10},{id:29,theme:"lost-festival",skins:["sport","tool","car"],levelCount:10},{id:30,theme:"halloween-festival",skins:["cakes","car","fruit"],levelCount:10},{id:31,theme:"snow-music-festival",skins:["ice-cream","sport","tool"],levelCount:10},{id:32,theme:"christmas",skins:["cakes","flower","sport"],levelCount:10},{id:33,theme:"spring-flower-festival",skins:["flower","fruit"],levelCount:10},{id:34,theme:"tet-holiday",skins:["flower","cosmetics","fruit"],levelCount:10},{id:35,theme:"sea-festival",skins:["ice-cream","sport"],levelCount:10},{id:36,theme:"firework-festival",skins:["cosmetics","car","tool"],levelCount:10},{id:37,theme:"halloween-horror",skins:["cakes","car","fruit"],levelCount:10},{id:38,theme:"mid-autumn",skins:["flower","fruit","ice-cream"],levelCount:10},{id:39,theme:"christmas-sweet",skins:["cakes","flower","sport"],levelCount:10},{id:40,theme:"new-year-countdown",skins:["cosmetics","car","tool"],levelCount:10}]};_._RF.pop(),_._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);var lr={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter",SPRING_FESTIVAL:"spring-festival",TREE_PLANTING_FESTIVAL:"tree-planting-festival",BLUE_SEA_FESTIVAL:"blue-sea-festival",MUSIC_FESTIVAL:"music-festival",HARVEST_FESTIVAL:"harvest-festival",FOOD_FESTIVAL:"food-festival",SNOW_FESTIVAL:"snow-festival",LIGHT_FESTIVAL:"light-festival",PEACE_FESTIVAL:"peace-festival",FLOWER_FESTIVAL:"flower-festival",STREET_FESTIVAL:"street-festival",COLOR_GARDEN:"color-garden",COLOR_FESTIVAL:"color-festival",NATURE_SUMMER:"nature-summer",SNOW_MOUNTAIN:"snow-mountain",ICE_FESTIVAL:"ice-festival",GREEN_GRASS_FESTIVAL:"green-grass-festival",COMMUNITY_FESTIVAL:"community-festival",WATER_FESTIVAL:"water-festival",ANIMAL_FESTIVAL:"animal-festival",LOST_FESTIVAL:"lost-festival",HALLOWEEN_FESTIVAL:"halloween-festival",SNOW_MUSIC_FESTIVAL:"snow-music-festival",CHRISTMAS:"christmas",SPRING_FLOWER_FESTIVAL:"spring-flower-festival",TET_HOLIDAY:"tet-holiday",SEA_FESTIVAL:"sea-festival",FIREWORK_FESTIVAL:"firework-festival",HALLOWEEN_HORROR:"halloween-horror","MID-AUTUMN":"mid-autumn",CHRISTMAS_SWEET:"christmas-sweet",NEW_YEAR_COUNTDOWN:"new-year-countdown",HAPPY_NEW_YEAR:"happy-new-year"};Z(lr),_._RF.pop(),_._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var lo=globalThis.game,ls=lo.player,ll=lo.storage,lu={id:0,currentTheme:lr.SUMMER,nextTheme:null,progress:0,max:10},lc={skins:["cakes"],theme:"summer",progress:0,max:10,isLocked:!0},lh=function(){function e(){Fe(this,e),this.mapData=la,this.playerSkinProgress=null}return Ue(e,[{key:"initDashboardSceneStorage",value:function(){var g=ll.getStorage("dashboard");if(null==g){var E=this.getCurrentMapProgressInstance();ll.addStorage("dashboard",{lastMapPayload:E,numOfMapsPassed:0,animateToCurrentLevel:!1});var _=ll.getStorage("collection");if(null==_){ll.addStorage("collection",{lastMapPack:E.id,animateMapPackUnlock:!1});var k=ll.getStorage("leaderboard_content");if(null==k){ll.addStorage("leaderboard_content",{lastTabOpened:"global",previousScore:-1});var C=ll.getStorage("tournament");null==C&&ll.addStorage("tournament",{animateTournamentLeader:!1,previousScore:-1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),lu;for(var g=this.mapData.mapOrder,E=void 0,_=void 0,k=0,C=0,A=0,T=0;T<g.length;T++){var R=this.playerSkinProgress[T];if(R.currentProgress<R.maxProgress){var I,L;A=g[T].id,E=g[T].theme,_=null!==(I=null===(L=g[T+1])||void 0===L?void 0:L.theme)&&void 0!==I?I:E,k=R.currentProgress,C=R.maxProgress;break}}if(void 0===E||void 0===_){var P=g[g.length-1];return A=P.id,E=P.theme,_=P.theme,k=P.levelCount,C=P.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:A,currentTheme:E,nextTheme:_,progress:k,max:C}}return{id:A,currentTheme:E,nextTheme:_,progress:k,max:C}}},{key:"getUnlockedSkinsInstance",value:function(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];var g,E=[],_=at(this.playerSkinProgress);try{for(_.s();!(g=_.n()).done;){var k=g.value;k.isLocked||1!==k.skins.length||E.push(k.skins[0])}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"getLevelSkinsInstance",value:function(g){var E,_=null!=g?g:1,k=this.mapData.mapOrder,C=0,A=at(k);try{for(A.s();!(E=A.n()).done;){var T=E.value;if(C+T.levelCount>=_)return console.log("getMapSkin",T.skins),T.skins;C+=T.levelCount}}catch(g){A.e(g)}finally{A.f()}var R=k[k.length-1];return console.log("getMapSkin",R.skins),R.skins}},{key:"getLevelThemeInstance",value:function(g){var E,_=null!=g?g:1,k=this.mapData.mapOrder,C=0,A=at(k);try{for(A.s();!(E=A.n()).done;){var T=E.value;if(C+T.levelCount>=_)return console.log("getMapTheme",T.theme),T.theme;C+=T.levelCount}}catch(g){A.e(g)}finally{A.f()}var R=k[k.length-1];return console.log("getMapTheme",R.theme),R.theme}},{key:"getThemeSkinsInstance",value:function(g){var E,_=at(this.mapData.mapOrder);try{for(_.s();!(E=_.n()).done;){var k=E.value;if(k.theme===g)return console.log("getThemeSkins",k.skins),k.skins}}catch(g){_.e(g)}finally{_.f()}return console.warn("getThemeSkins: theme not found",g),[]}},{key:"getCollectionUnlockProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[lc];var g,E=[],_=at(this.playerSkinProgress);try{for(_.s();!(g=_.n()).done;){var k=g.value;E.push({skins:k.skins,theme:k.themeId,progress:k.currentProgress,max:k.maxProgress,isLocked:k.isLocked})}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"updatePlayerSkinProgress",value:function(){console.log("getPlayerSkinProgress: playerData not found, use data from level");var g=this.mapData.mapOrder;this.playerSkinProgress=[];var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value;this.playerSkinProgress.push({skins:k.skins,themeId:k.theme,currentProgress:0,maxProgress:k.levelCount,isLocked:!0})}}catch(g){_.e(g)}finally{_.f()}this.updatePlayerSkinProgressByLevel()}},{key:"updatePlayerSkinProgressByLevel",value:function(){var g,E=ls.getGameData(),_=(null!==(g=null==E?void 0:E.level)&&void 0!==g?g:1)-1,k=this.mapData.mapOrder;this.playerSkinProgress[0].isLocked=!1;for(var C=0;C<k.length;C++){var A=k[C];if(!(_<=0)){var T=_-A.levelCount>=0?A.levelCount:_;_-=T,this.increaseProgress(C,T)}}}},{key:"increaseProgress",value:function(g,E){if(null!==this.playerSkinProgress){if(g>=this.playerSkinProgress.length)console.warn("increaseProgress: index out of range",g);else{var _,k=this.playerSkinProgress[g],C=k.currentProgress,A=k.maxProgress,T=C+E>A?A:C+E;if(T>0&&(this.playerSkinProgress[g].isLocked=!1),T===A)(null===(_=this.mapData.mapOrder[g+1])||void 0===_?void 0:_.skins)&&this.unlockSkin(g+1);this.playerSkinProgress[g].currentProgress=T,this.playerSkinProgress[g].maxProgress=A}}else console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?")}},{key:"unlockSkin",value:function(g){null!==this.playerSkinProgress?g>=this.playerSkinProgress.length?console.warn("unlockSkin: index out of range",g):this.playerSkinProgress[g].isLocked=!1:console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var g=this.getInstance();g.updatePlayerSkinProgress(),g.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkins",value:function(g){return this.getInstance().getLevelSkinsInstance(g)}},{key:"getLevelTheme",value:function(g){return this.getInstance().getLevelThemeInstance(g)}},{key:"getThemeSkins",value:function(g){return this.getInstance().getThemeSkinsInstance(g)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"getCurrentUnlockingThemeIndex",value:function(){var g=this.getCollectionUnlockProgress();if(0===g.length)return null;var E=0;return g.forEach(function(g,_){g.isLocked||(E=_)}),E}}]),e}();_._RF.pop(),_._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var lp=globalThis.game,lf=lp.match,ly=lp.player,lv=lp.leaderboard,lg=lp.frameCapture,lm=GameCore,lb=lm.Utils,lw=lb.Object,lS=lb.Valid,lE=lb.String,l_=lb.Array,lk=lm.Match.Modes,lC=lm.Dtos.Match.Data,lA=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],lT=function(){function e(){Fe(this,e)}var g,E,_,k,C,A,T,R,I,L,P,O,B,N,D,M,F,U,z;return Ue(e,[{key:"processStartSingleModeAsync",value:(z=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=ly.getPlayerId();return[4,lf.single.start.processAsync({playerId:g})];case 1:E.sent();return[2]}})}),function(){return z.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(U=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,lf.single.finish.processAsync()];case 1:g.sent();return[2]}})}),function(){return U.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(F=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=ly.getPlayerId(),E=GameSDK.context.getID();return[4,lf.tournament.continue.processAsync({playerId:g,contextId:E})];case 1:_.sent();return[2]}})}),function(){return F.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(M=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=ly.getPlayerId(),E=ly.getBestScore();return[4,lf.tournament.finish.processAsync({playerId:g,bestScore:E})];case 1:_.sent();return[2]}})}),function(){return M.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(D=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,2,,7]);return[4,this.processContinueChallengeAsync()];case 1:k.sent();return[3,7];case 2:g=k.sent();if(!lw.hasOwn(g,"name")||lS.isString(g.name))throw g;E="PlayerHasFinishedMatch"===g.name;if(!E)return[3,4];return[4,this.processChallengeNewOpponentAsync()];case 3:E=k.sent();k.label=4;case 4:_="PlayerNotJoinInMatch"===g.name;if(!_)return[3,6];return[4,this.processJoinChallengeAsync()];case 5:_=k.sent();k.label=6;case 6:return[3,7];case 7:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(N=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:lg.addWideframeRender("renderResultChallenge",lg.wideframe.renderResultChallenge);return[4,lf.challenge.finish.processAsync(g)];case 1:E.sent();return[2]}})}),function(g){return N.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(B=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=this.getMatchState(),E=g.id,_=g.customData,k=_.playerId,C=_.opponentId;if(!lS.isString(E))throw new Error("Invalid match id");if(!lS.isString(k))throw new Error("Invalid player id");if(!lS.isString(C))throw new Error("Invalid opponent id");A=GameSDK.context.getID();if(!A)throw new Error("Cannot get contextId");return[4,lf.challenge.continue.processAsync({matchId:E,contextId:A,playerId:k,opponentId:C})];case 1:T.sent();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(O=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:g=ly.getConnectedPlayerIds(100,0),E=Math.floor(Math.random()*g.length),_=ly.getPlayerId(),k=g[E];return[4,lf.challenge.friend.processAsync({playerId:_,opponentId:k})];case 1:C.sent();return[2]}})}),function(){return O.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(P=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=this.getMatchState(),E=g.id,_=g.customData,k=_.playerId,C=_.opponentId;if(!lS.isString(E))throw new Error("Invalid match id");if(!lS.isString(k))throw new Error("Invalid player id");if(!lS.isString(C))throw new Error("Invalid opponent id");return[4,lf.challenge.join.processAsync({matchId:E,playerId:k,opponentId:C})];case 1:A.sent();return[2]}})}),function(){return P.apply(this,arguments)})},{key:"getMatchState",value:function(){var g=lf.getMatchState();if(!g)throw new Error("Match state not found");return g}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(L=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,10,,11]);E=null!=g?g:this.getMatchMode();switch(E){case lk.SINGLE:return[3,1];case lk.TOURNAMENT:return[3,3];case lk.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processStartSingleModeAsync()];case 2:k.sent();return[3,9];case 3:return[4,this.inst.processStartTournamentModeAsync()];case 4:k.sent();return[3,9];case 5:return[4,this.inst.processStartChallengeModeAsync()];case 6:k.sent();return[3,9];case 7:return[4,this.inst.processStartSingleModeAsync()];case 8:k.sent();k.label=9;case 9:return[3,11];case 10:_=k.sent();console.warn("startMatchAsync",_);return[3,11];case 11:return[2]}})}),function(g){return L.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(I=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lf.handler.setProfileData(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setProfileMatchDataAsync",E);return[3,3];case 3:return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(R=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lf.handler.setMatchCustomData(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setMatchCustomDataAsync",E);return[3,3];case 3:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lf.handler.setLeaderboardScore(g)];case 1:_.sent();return[3,3];case 2:E=_.sent();console.warn("setLeaderboardScoreAsync",E);return[3,3];case 3:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"finishMatchAsync",value:(A=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,10,,11]);E=this.getMatchMode();switch(E){case lk.SINGLE:return[3,1];case lk.TOURNAMENT:return[3,3];case lk.CHALLENGE_FRIEND:return[3,5]}return[3,7];case 1:return[4,this.inst.processFinishSingleModeAsync()];case 2:k.sent();return[3,9];case 3:return[4,this.inst.processFinishTournamentModeAsync()];case 4:k.sent();return[3,9];case 5:return[4,this.inst.processFinishChallengeModeAsync(g)];case 6:k.sent();return[3,9];case 7:return[4,this.inst.processFinishSingleModeAsync()];case 8:k.sent();k.label=9;case 9:return[3,11];case 10:_=k.sent();console.warn("finishMatchAsync",_);return[3,11];case 11:return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"joinTournamentAsync",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=ly.getPlayerId();return[4,lf.tournament.join.processAsync({tournamentId:g,playerId:E})];case 1:_.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"continueTournamentAsync",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=ly.getPlayerId();return[4,lf.tournament.continue.processAsync({playerId:E,contextId:g})];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"createTournamentName",value:function(){var g=lA[X.randomRangeInt(0,lA.length-1)],E="".concat(g," Tournament"),_=lE.removeDiacritics(E);return"".concat(_)}},{key:"getShortName",value:function(g,E){var _,k=arguments.length>1&&void 0!==E?E:50,C=g.split(" "),A=0,T="",R=at(C);try{for(R.s();!(_=R.n()).done;){var I=_.value;if(A+I.length+1>k)break;T+="".concat(I," "),A+=I.length+1}}catch(g){R.e(g)}finally{R.f()}return T.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var g,E,_,k=lE.generateObjectId(),C=ly.getPlayerId(),A=ly.getPlayer().name,T=ly.getGameData(),R=null!==(g=null==T?void 0:T.level)&&void 0!==g?g:1,I=lh.getLevelTheme(R),L=this.inst.getMatchState().profiles;return{score:null!==(E=null===(_=(void 0===L?{}:L)[C])||void 0===_?void 0:_.score)&&void 0!==E?E:0,playerId:C,mode:lk.TOURNAMENT,name:this.createTournamentName(),leaderboardId:k,payload:{playerId:C,playerName:A,leaderboardId:k,themeId:I}}}},{key:"getTournamentsAsync",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,GameSDK.tournament.getTournamentsAsync()];case 1:return[2,E.sent()];case 2:g=E.sent();return[2,(console.error(g),[])];case 3:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(E=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:return[4,this.getTournamentsAsync()];case 1:g=C.sent(),E=l_.search(g,function(g){var E,_=JSON.parse(null!==(E=g.getPayload())&&void 0!==E?E:"{}");return"DEFAULT"===g.getTournamentType()&&_.playerId===ly.getPlayerId()});if(E)throw new lt(ly.getPlayerId(),E.getID());_=this.createTournamentPayload();ly.setGameData({lastCreateTournamentShown:Date.now()});return[4,lf.tournament.create.processAsync(_)];case 2:C.sent();k=_.leaderboardId;lv.addLeaderboard({name:k,type:"tournament",autoSortRank:!0,leaderboardId:k});return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getMatchMode",value:function(){var g=this.inst.getMatchState();return lS.isString(g.mode)?g.mode:null}},{key:"getMatchCustomData",value:function(){var g=this.inst.getMatchState();return lS.isObject(g.customData)?g.customData:null}},{key:"getMatchExtraDataAsync",value:(g=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,lf.api.getMatchAPI().getMatchDetailByIdAsync(g)];case 1:E=_.sent();return[2,new lC(E).toObject().extraData]}})}),function(E){return g.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(g,E){this.setMatchCustomDataAsync({level:g,score:E});var _=ly.getPlayerId();this.setProfileMatchDataAsync({id:_,score:E})}}]),e}();_._RF.pop(),_._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);var lR,lI,lL,lP,lO,lB,lN,lD,lM,lF,lU,lz,lx=globalThis.game.event,lG=GameCore.Events,lV=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"switchScene",value:function(g,E){lx.emit(lG.SWITCH_SCENE,{sceneName:g,sceneData:E})}},{key:"preloadScene",value:function(g){lx.emit(lG.PRELOAD_SCENE,{sceneName:g})}},{key:"preloadDashboardScene",value:function(){this.preloadScene(s1)}},{key:"switchToDashboardScene",value:function(g){this.switchScene(s1,g)}},{key:"preloadGameScene",value:function(){this.preloadScene(s0)}},{key:"switchToGameScene",value:function(g){this.switchScene(s0,g)}},{key:"getSceneData",value:function(g){return"data"in g.scene&&g.scene.data||{}}}]),e}();_._RF.pop(),_._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);var lK,lH,lq,lW,lj,lX=k.ccclass,lY=k.property,lJ=["Watch an ad to revive yourself\nKeep playing and don't give up!","Watching an ad doubles your rewards!","Test your skills\nin ranked tournaments","Challenge your friend\nSee who can score higher!","Send a challenge to your friend\nClaim bragging rights!","Clear all tiles to\nwin the level!","Beat the clock before\ntime runs out!","Clear bombs before\nthey explode","A season pack unlock\nnew tile sets!","The more stars you collect\nThe more coins you'll be rewarded!","Compete globally or with friends\nRise to the top in tournaments!","You can challenge a friend\nTest each other's reflexes!","The Thunder power-up\nblasts tiles away","A Hint power-up reveals\nthe next pair","Pliers can remove\nany bomb instantly","The Tornado power-up\nshuffles the board!","Earn coins by completing levels\nWin tournaments for even more!","A new tile set is unlocked\nevery season packs","Log in daily to claim\nbetter rewards!","Level up and earn coins\nwith each victory!","Each season pack offers\nnew tiles!"],lQ=(lR=lX("LoadingFullScreen"),lI=nC.required(),lL=lY(ew),lP=nC.required(),lO=nC.getComponent(eu),lB=nC.required(),lN=lY(L),lR((lF=st((lM=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"progressBar",lF,Ke(g)),rt(g,"uiOpacity",lU,Ke(g)),rt(g,"loadingLabel",lz,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){nC.decorateComponent(this)}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0,this.progressBar.progress=0}},{key:"show",value:(_=Be(function(g){var E,_;return _ts_generator(this,function(g){switch(g.label){case 0:this.uiOpacity.opacity=0,this.progressBar.progress=0;E=x(this.uiOpacity).to(.5,{opacity:255},{easing:"cubicOut"}),_=x(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"});this.runLoadingTextAnimation(),tZ.runTweenAsync(E);return[4,tZ.runTweenAsync(_)];case 1:g.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(g){switch(g.label){case 0:if(!(this.uiOpacity&&this.progressBar))return[3,3];this.uiOpacity.opacity=255,this.progressBar.progress=.9;E=x(this.uiOpacity).to(.5,{opacity:0},{easing:"cubicIn"}),_=x(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"});this.runLoadingTextAnimation();return[4,tZ.runTweenAsync(_)];case 1:g.sent(),this.stopLoadingTextAnimation();return[4,tZ.runTweenAsync(E)];case 2:g.sent(),this.node.active=!1;g.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"runLoadingTextAnimation",value:function(){var g=this;this.updateHintText(),this.schedule(function(){return g.updateHintText()},5)}},{key:"updateHintText",value:function(){this.loadingLabel.string=this.getHintText()}},{key:"stopLoadingTextAnimation",value:function(){this.unscheduleAllCallbacks()}},{key:"getHintText",value:function(){return lJ[Math.floor(Math.random()*lJ.length)]}}]),a}(D)).prototype,"progressBar",[lI,lL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lU=st(lM.prototype,"uiOpacity",[lP,lO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lz=st(lM.prototype,"loadingLabel",[lB,lN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lD=lM))||lD);_._RF.pop(),_._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);var lZ=k.ccclass,l$=k.property,l0=(lK=lZ("Loading"),lH=l$(ee),lK((lj=st((lW=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"loadingPrefab",lj,Ke(g)),g.loadingNode=null,g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){N.addPersistRootNode(this.node)}},{key:"createLoadingFullScreen",value:function(){var g,E=$("Canvas");if(E&&!E.getChildByName("Loading")){this.loadingNode||(this.loadingNode=I(this.loadingPrefab));var _=I._clone(this.loadingNode);this.loadingFullScreen=_.getComponent(lQ),this.node.active=!1,null===(g=$("Canvas"))||void 0===g||g.addChild(_)}}},{key:"show",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:this.createLoadingFullScreen();E=this.node.active;if(E)return[3,2];this.node.active=!0;return[4,this.loadingFullScreen.show(g)];case 1:E=_.sent();_.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=null!==(E=this.node)&&void 0!==E&&E.active&&this.loadingFullScreen;if(!_)return[3,2];return[4,this.loadingFullScreen.hide(g)];case 1:_=(k.sent(),this.node.active=!1);k.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),a}(D)).prototype,"loadingPrefab",[lH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lq=lW))||lq);_._RF.pop(),_._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);var l1=globalThis.game.event,l2=GameCore,l4=l2.Events,l3=l2.Utils.Array,l5=function(){function e(){Fe(this,e),this.showedScreens=[]}var g,E;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"openScreen",value:function(g,E){var _=iw[g];l1.emit(l4.OPEN_SCREEN,{screenName:_,screenData:E})}},{key:"closeScreen",value:function(g){var E=iw[g];l1.emit(l4.CLOSE_SCREEN,{screenName:E})}},{key:"openScreenAndWaitForClose",value:function(g,E){var _=this;return new Promise(function(k){_.openScreen(g,E);l1.on(l4.CLOSE_SCREEN,function t(E){E.screenName===iw[g]&&(l1.off(l4.CLOSE_SCREEN,t),k(E))})})}},{key:"showLoadingScreen",value:function(g){this.openScreen(ib.LOADING_SCREEN,{duration:g})}},{key:"closeLoadingScreen",value:function(){this.closeScreen(ib.LOADING_SCREEN)}},{key:"showNotificationScreen",value:function(g,E){this.openScreen(ib.NOTIFICATION_SCREEN,{message:g,duration:E})}},{key:"closeNotificationScreen",value:function(){this.closeScreen(ib.NOTIFICATION_SCREEN)}},{key:"addShowedScene",value:function(g){l3.has(this.inst.showedScreens,g)||this.inst.showedScreens.push(g)}},{key:"showLoadingFullScreen",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!!l3.has(this.inst.showedScreens,g))return[3,3];this.addShowedScene(g);_=$("Loading");k=_;if(!k)return[3,2];_.active=!0;return[4,null===(E=_.getComponent(l0))||void 0===E?void 0:E.show(g)];case 1:k=C.sent();C.label=2;case 2:C.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"hideLoadingFullScreen",value:(g=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=l3.has(this.inst.showedScreens,g);if(_)return[3,2];return[4,null===(E=$("Loading"))||void 0===E||null===(E=E.getComponent(l0))||void 0===E?void 0:E.hide(g)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"showLoadingNotificationScreen",value:function(){this.openScreen(ib.NOTIFICATION_SCREEN,{message:"Loading",enableCloseOnTouch:!1})}},{key:"showTournamentDetailScreen",value:function(g,E,_){var k=!(arguments.length>2&&void 0!==_)||_;this.openScreen(ib.TOURNAMENT_DETAIL_SCREEN,{playAnimation:k,tournament:g,tournamentContextType:E})}},{key:"closeTournamentDetailScreen",value:function(){this.closeScreen(ib.TOURNAMENT_DETAIL_SCREEN)}}]),e}();_._RF.pop(),_._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);var l6=GameCore,l8=l6.Utils,l9=l8.String,l7=l8.Valid,ue=l8.Array,ut=l6.Configs.Mockup.Leaderboards,un=globalThis.game,ui=un.leaderboard,ua=un.player,ur=function(){function e(){var g=this;Fe(this,e),this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,3,,4]);E=Date.now()-g.lastFetchGlobalTournament>g.maxTimeRefetch;if(!E)return[3,2];return[4,ui.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"})];case 1:E=(g.globalTournamentLBData=k.sent(),g.globalTournamentLBData.sort(function(g,E){return g.expireTime-E.expireTime}));k.label=2;case 2:return[3,4];case 3:_=k.sent();console.warn("fetchGlobalTournamentLeaderboardAsync",_);return[3,4];case 4:return[2,g.globalTournamentLBData]}})}),this.fetchTournamentsAsync=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:k.trys.push([0,3,,4]);E=Date.now()-g.lastFetchTournamentsData>g.maxTimeRefetch;if(!E)return[3,2];return[4,GameSDK.tournament.getTournamentsAsync()];case 1:E=(g.playerTournaments=k.sent(),g.playerTournaments.sort(function(g,E){return g.getEndTime()-E.getEndTime()}));k.label=2;case 2:return[3,4];case 3:_=k.sent();console.warn("fetchTournamentsAsync",_);return[3,4];case 4:return[2,g.playerTournaments]}})})}var g;return Ue(e,[{key:"processPlayerTournamentData",value:function(){var g,E=[],_=at(this.playerTournaments);try{for(_.s();!(g=_.n()).done;){var k,C,A=g.value,T="".concat(A.getID()),R=A.getContextID(),I=A.getEndTime(),L=this.parseTournamentPayload(A.getPayload());if(this.validateGameSDKTournamentPayload(L)){if(!(I<Date.now()/1e3)&&"PAGE_HOSTED"!==A.getTournamentType()){var P=null!==(k=L.playerName)&&void 0!==k?k:"Player",O={id:T,title:null!==(C=A.getTitle())&&void 0!==C?C:this.createDefaultTournamentName(P),endTime:I,contextId:R,payload:L};E.push(O)}}}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"processGlobalTournamentLeaderboardData",value:function(){var g=[];if(ut.Enabled){for(var E=0;E<this.playerTournaments.length;E++){var _,k=this.playerTournaments[E],C=k.getTournamentType();if("PAGE_HOSTED"===C){var A="".concat(k.getID()),T=k.getContextID(),R=k.getEndTime(),I=this.parseTournamentPayload(k.getPayload()),L={id:A,title:null!==(_=k.getTitle())&&void 0!==_?_:"Global Tournament",endTime:R,contextId:T,payload:I,tournamentType:C};g.push(L)}}return g}for(var P=0;P<this.globalTournamentLBData.length;P++){var O,B={tournamentId:"",contextId:""},N=this.globalTournamentLBData[P];try{B=JSON.parse(N.description)}catch(g){continue}if(this.validateExpireTime(N)&&this.validateGlobalTournamentPayload(B)){var D={id:B.tournamentId,title:N.name,endTime:this.getTournamentEndTime(N),contextId:B.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:N._id,themeId:null!==(O=B.themeId)&&void 0!==O?O:lr.SUMMER}};g.push(D)}}return g}},{key:"validateGlobalTournamentPayload",value:function(g){var E=g.tournamentId,_=g.contextId;return!(!l7.isString(E)||""===E)&&!(!l7.isString(_)||""===_)}},{key:"getTournamentEndTime",value:function(g){var E=new Date(g.createdAt).getTime();return Math.round((1e3*g.expireTime+E)/1e3)}},{key:"validateExpireTime",value:function(g){return 1e3*this.getTournamentEndTime(g)-Date.now()>0}},{key:"validateGameSDKTournamentPayload",value:function(g){return!(!l7.isString(g.playerId)||""===g.playerId)&&!(!l7.isString(g.playerName)||""===g.playerName)&&!(!l7.isString(g.leaderboardId)||""===g.leaderboardId)}},{key:"createDefaultTournamentName",value:function(g){var E=g.substring(0,7),_="".concat(E.split(" ")[0]||E,"'s Tournament"),k=l9.removeDiacritics(_);return"".concat(k)}},{key:"parseTournamentPayload",value:function(g){if("string"!=typeof g)return{};try{return JSON.parse(g)}catch(g){return{}}}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"requestTournamentDataAsync",value:(g=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=e.getInstance();return[4,Promise.all([g.fetchTournamentsAsync(),g.fetchGlobalTournamentLeaderboardAsync()])];case 1:T.sent();E=g.processPlayerTournamentData(),_=g.processGlobalTournamentLeaderboardData();E.sort(function(g,E){return g.endTime-E.endTime}),_.sort(function(g,E){return g.endTime-E.endTime}),g.tournamentData=[].concat(tt(_),tt(E));C=at(g.tournamentData);try{for(C.s();!(k=C.n()).done;){A=k.value.payload.leaderboardId;A&&(ui.isExistLeaderboardId(A)||ui.addLeaderboard({type:"tournament",name:A,autoSortRank:!0,leaderboardId:A}))}}catch(g){C.e(g)}finally{C.f()}return[2,g.tournamentData]}})}),function(){return g.apply(this,arguments)})},{key:"getAllTournamentData",value:function(){return e.getInstance().tournamentData}},{key:"getTournamentDataById",value:function(g){var E=e.getInstance();return ue.search(E.tournamentData,function(E){return E.id===g})}},{key:"getPlayerTournamentData",value:function(){var g=e.getInstance(),E=ua.getPlayerId();return g.tournamentData.filter(function(g){return g.payload.playerId===E})}},{key:"getFriendsTournamentData",value:function(){var g=e.getInstance(),E=ua.getPlayerId();return g.tournamentData.filter(function(g){var _=g.payload;return _.playerId!==E&&"global"!==_.playerId})}},{key:"getGlobalTournamentData",value:function(){return e.getInstance().tournamentData.filter(function(g){return"global"===g.payload.playerId})}},{key:"validateTournamentExpired",value:function(g){var E=e.getTournamentDataById(g);return!!E&&E.endTime<Date.now()/1e3}}]),e}();_._RF.pop(),_._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var uo,us="time",ul="bomb";_._RF.pop(),_._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var uu=(0,k.ccclass)("InputController")(uo=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleElementPointerDown=function(){},g.handleElementPointerUp=function(g){},g}return Ue(n,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){ev.os!==ev.OS.WINDOWS&&ev.os!==ev.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){ev.os!==ev.OS.WINDOWS&&ev.os!==ev.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(D))||uo;_._RF.pop(),_._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var uc={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};_._RF.pop(),_._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var uh="fall-down",up="fly-up",uf="push-left",uy="push-right",uv="put-column-middle",ug="put-row-middle";function Jc(g){for(var E=g.array,_=g.isLighter,k=g.out,C=void 0===k?new Set:k,A=0;A<E.length;A++)if(_(E.get(A))){for(var T=A+1;T<E.length;T++)if(!_(E.get(T))){E.swap(A,T),C.add(E.get(A));break}}return C}_._RF.pop(),_._RF.push({},"bfb989Gr/dArq4M9uSSrF5/","stagger",void 0),_._RF.pop(),_._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var um=function(){function e(g){var E;Fe(this,e),this.array=[];var _=null!=g?g:{},k=_.width,C=void 0===k?1:k,A=_.height,T=void 0===A?1:A,R=_instanceof(g,e)?g.array:null!==(E=null==g?void 0:g.content)&&void 0!==E?E:[];if(R.length!==C*T)throw new Error("Invalid content length");this.width=C,this.height=T,this.array=tt(R)}return Ue(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(g,E){return this.array[E*this.width+g]}},{key:"set",value:function(g,E,_){this.array[E*this.width+g]=_}},{key:"isInBounds",value:function(g,E){return g>=0&&g<this.width&&E>=0&&E<this.height}},{key:"forEach",value:function(g){for(var E=0;E<this.height;E++)for(var _=0;_<this.width;_++)g(this.get(_,E),_,E)}},{key:"map",value:function(g){for(var E=[],_=0;_<this.height;_++)for(var k=0;k<this.width;k++)E.push(g(this.get(k,_),k,_));return E}},{key:"reduce",value:function(g,E){for(var _=E,k=0;k<this.height;k++)for(var C=0;C<this.width;C++)_=g(_,this.get(C,k),C,k);return _}},{key:"swap",value:function(g,E){var _=et(g,2),k=_[0],C=_[1],A=et(E,2),T=A[0],R=A[1],I=this.get(k,C);this.set(k,C,this.get(T,R)),this.set(T,R,I)}},{key:"shuffle",value:function(g){for(var E=null!=g?g:this.map(function(g,E,_){return[E,_]}),_=tt(E),k=new Set,C=_.length-1;C>0;C--){var A=eC(0,C+1),T=[_[A],_[C]];_[C]=T[0],_[A]=T[1],k.add(this.get(_[C][0],_[C][1])),k.add(this.get(_[A][0],_[A][1]))}for(var R=0;R<_.length;R++){var I=et(E[R],2),L=I[0],P=I[1],O=et(_[R],2),B=O[0],N=O[1];this.swap([L,P],[B,N])}return k}},{key:"toShuffled",value:function(g){var E=new e({width:this.width,height:this.height,content:this.array}),_=E.shuffle(g);return[E,_]}},{key:"gravitate",value:function(g){var E=this,_=et(g.rowRange,2),k=_[0],C=_[1],A=et(g.colRange,2),T=A[0],R=A[1],I=g.direction,L=g.isLighter,P=g.onSwap,O=g.out,B=void 0===O?new Set:O,N=R-T+1,D=C-k+1;switch(I){case uc.Up:for(var f=function(g){Jc({array:{length:D,get:function(_){return E.get(g,C-_)},swap:function(_,k){var A=E.get(g,C-_),T=E.get(g,C-k);E.swap([g,C-_],[g,C-k]),null==P||P(A,T)}},isLighter:L,out:B})},M=T;M<=R;M++)f(M);return B;case uc.Down:for(var m=function(g){Jc({array:{length:D,get:function(_){return E.get(g,k+_)},swap:function(_,C){var A=E.get(g,k+_),T=E.get(g,k+C);E.swap([g,k+_],[g,k+C]),null==P||P(A,T)}},isLighter:L,out:B})},F=T;F<=R;F++)m(F);return B;case uc.Left:for(var b=function(g){Jc({array:{length:N,get:function(_){return E.get(T+_,g)},swap:function(_,k){var C=E.get(T+_,g),A=E.get(T+k,g);E.swap([T+_,g],[T+k,g]),null==P||P(C,A)}},isLighter:L,out:B})},U=k;U<=C;U++)b(U);return B;case uc.Right:for(var w=function(g){Jc({array:{length:N,get:function(_){return E.get(R-_,g)},swap:function(_,k){var C=E.get(R-_,g),A=E.get(R-k,g);E.swap([R-_,g],[R-k,g]),null==P||P(C,A)}},isLighter:L,out:B})},z=k;z<=C;z++)w(z);return B;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var g=new e({width:this.width,height:this.height,content:this.array}),E=g.gravitate.apply(g,arguments);return[g,E]}},{key:"toRotated",value:function(){for(var g=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),E=0;E<this.height;E++)for(var _=0;_<this.width;_++)g.set(this.height-1-E,_,this.get(_,E));return g}}]),e}();_._RF.pop(),_._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),_._RF.pop(),_._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);var ub,uw,uS,uE,u_,uk,uC,uA,uT,uR,uI,uL,uP,uO,uB,uN,uD,uM,uF,uU,uz,ux,uG,uV,uK,uH,uq,uW,uj,uX={bomb:"bomb",star:"star",none:"none"};_._RF.pop(),_._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var uY=k.ccclass,uJ=k.property,uQ=k.requireComponent,uZ=(ub=uY("Tile"),uw=uQ([R]),uS=uQ([eu]),uE=uJ(eo),u_=uJ(eo),uk=uJ(eo),uC=uJ(eo),uA=uJ({type:R,displayName:"Background's UI Transform"}),uT=uJ(er),uR=uJ({type:eu,displayName:"This UI Opacity"}),uI=uJ(eu),uL=uJ(eu),uP=uJ(eu),uO=uJ(au),uB=uJ(G),ub(uN=uw(uN=uS((uM=st((uD=function(g){ze(h,g);var E,_,k,C,A,T,R,I,L,P=Xe(h);function h(){var g;Fe(this,h);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=P.call.apply(P,[this].concat(_)),"icon",uM,Ke(g)),rt(g,"bombComponent",uF,Ke(g)),rt(g,"starComponent",uU,Ke(g)),rt(g,"background",uz,Ke(g)),rt(g,"bgUITransform",ux,Ke(g)),rt(g,"defaultBackground",uG,Ke(g)),rt(g,"uiOpacity",uV,Ke(g)),rt(g,"shineOpacity",uK,Ke(g)),rt(g,"glowOpacity",uH,Ke(g)),rt(g,"iconOpacity",uq,Ke(g)),rt(g,"button",uW,Ke(g)),rt(g,"animationComponent",uj,Ke(g)),g.id=null,g.isEmpty=!1,g.coord=new eS,g.signal=new nD,g}return Ue(h,[{key:"onLoad",value:function(){nC.lazyValidateProperties(this),this.special=this.createSpecialHandler(uX.none)}},{key:"update",value:function(g){var E;(null===(E=this.special)||void 0===E?void 0:E.type)===uX.bomb&&this.special.update(g)}},{key:"onDestroy",value:function(){var g,E;(null===(g=this.special)||void 0===g?void 0:g.type)===uX.bomb&&(null===(E=this.special)||void 0===E||E.onDestroy())}},{key:"setIgnoreInput",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.button.interactable=!E}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(g,E){this.coord.set(g,E)}},{key:"isSimilarTo",value:function(g){return this.id===g.id}},{key:"inSamePositionAs",value:function(g,E){return _instanceof(g,h)?this.coord.equals(g.getCoord()):this.coord.x===g&&this.coord.y===E}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(a2.TILE_CLICK,this)}},{key:"setIdentity",value:function(g){this.id=g,this.icon.spriteFrame=g;var E=et(this.getSize(),2),_=E[0],k=E[1],C=g.originalSize,A=C.width,T=C.height,R=Math.max(A/(.7*_),T/(.7*k));R>1&&this.icon.node.setScale(new em(1/R,1/R,1))}},{key:"setSpecialType",value:function(g,E){var _,k=arguments.length>0&&void 0!==g?g:uX.none,C=arguments.length>1?E:void 0;null===(_=this.special)||void 0===_||_.switch(k,C)}},{key:"setFocused",value:(L=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=x(this.shineOpacity).to(.15,{opacity:g?255:0},{easing:"cubicOut"});this.shineOpacity.node.scale=g?em.ZERO:em.ONE;_=x(this.shineOpacity.node).to(.15,{scale:g?em.ONE:em.ZERO},{easing:"cubicOut"});if(g){k=x(this.glowOpacity).to(2,{opacity:150});k.to(2,{opacity:20}),this.glowOpacityTween=x(this.glowOpacity).repeatForever(k).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;return[4,Promise.all([tZ.runTweenAsync(E),tZ.runTweenAsync(_)])];case 1:C.sent();return[2]}})}),function(g){return L.apply(this,arguments)})},{key:"setEmpty",value:function(g){var E,_,k,C=arguments.length>0&&void 0!==g&&g;if(!this.isEmpty){var A;if(this.signal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),C)return this.uiOpacity.opacity=0,void(null===(A=this.special)||void 0===A||A.switch(uX.none));(null===(E=this.special)||void 0===E?void 0:E.type)!==uX.star&&(null===(_=this.special)||void 0===_?void 0:_.type)!==uX.bomb||this.special.clear(),null===(k=this.special)||void 0===k||k.switch(uX.none),this.uiOpacity.opacity=0}}},{key:"setHint",value:(I=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!g)return[3,2];return[4,this.loadShakeClip()];case 1:k.sent(),this.shakeClip&&tZ.runAnimationAsync(this.animationComponent,this.shakeClip.name,this.signal);return[3,4];case 2:if(null===(E=this.animationComponent)||void 0===E||E.stop(),!this.background)return[2];_=x(this.background.node).to(.1,{scale:em.ONE,eulerAngles:em.ZERO});return[4,tZ.runTweenAsync(_,this.signal)];case 3:k.sent();k.label=4;case 4:return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"playClearFX",value:(R=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:this.signal.abort();E=new nD;this.signal=E;_=null;if("clear"!==g)return[3,2];return[4,this.loadClearClip()];case 1:C.sent(),_=this.clearClip;return[3,4];case 2:return[4,this.loadBreakClip()];case 3:C.sent(),_=this.breakClip;C.label=4;case 4:k=null===_||E.aborted;if(k)return[3,6];return[4,tZ.runAnimationAsync(this.animationComponent,_.name,E)];case 5:k=C.sent();C.label=6;case 6:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"restore",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:this.signal.abort();E=new nD;this.signal=E,this.animationComponent.stop(),this.isEmpty=!1,this.setIgnoreInput(!0),g&&this.setIdentity(g),this.uiOpacity.opacity=255,this.iconOpacity.opacity=255,this.node.setScale(em.ZERO),this.background.spriteFrame=this.defaultBackground,this.button.fakeClick();return[4,tZ.runTweenAsync(x(this.node).to(.3,{scale:em.ONE},{easing:"backOut"}),E)];case 1:_.sent(),this.node.setScale(em.ONE),this.setIgnoreInput(!1);return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"sync",value:(A=Be(function(g){var E,_,k,C,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:E=g.duration,_=void 0===E?.3:E,k=g.delay,C=void 0===k?0:k,A=g.easing,T=void 0===A?"cubicOut":A,R=(0,g.getTargetPosition)(this.coord),I=new em(R.x,R.y,this.node.position.z);return[4,tZ.runTweenAsync(x(this.node).delay(C).to(_,{position:I},{easing:T}))];case 1:L.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"fly",value:(C=Be(function(g){var E,_,k,C,A,T,R,I,L,P,O,B,N,D,M,F,U,z;return _ts_generator(this,function(G){E=this,_=300,k=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),C=Math.max(_-.7*k,0),A=k/1e3,T=this.node.position.clone(),R=g.getTilePosition(this.coord),I=new em(R.x,R.y,this.node.position.z),L=this.background.node,P=2,O=1,B=360,N=.0025*C,D=0,M=new em(0,0,0),F=.75-N,U={value:0,prevElapsed:0},z=x(U);return[2,(z.delay(A),z.to(.5,{value:0},{progress:function(g,_,k,C){var A=(P*=-1)*C,R=T.clone();return R.x+=A,E.node.setPosition(R),k}}),z.to(N,{value:1},{progress:function(g,k,A,T){var R=tZ.easeOutExpo(T),I=N*T-U.prevElapsed,P=N*T,D=C*R;E.setHeight(D,_);var M=E.node.position.clone();O+=.1,em.rotateZ(M,M,new em(0,0,0),O*Math.PI*I),E.node.setPosition(new em(M.x,M.y,M.z));var F=(B+=10)*I;return L.angle+=F,U.prevElapsed=P,A}}),z.call(function(){M.set((E.node.position.x+I.x)/2,(E.node.position.y+I.y)/2,0),U.prevElapsed=0,L.angle%=360,L.angle-=360,D=L.angle}),z.to(F,{value:0},{progress:function(g,k,A,T){var R=F*T-U.prevElapsed,I=F*T,P=C*(1-T);E.setHeight(P,_);var O=E.node.position.clone();return em.rotateZ(O,O,M,Math.PI/F*R),E.node.setPosition(new em(O.x,O.y,O.z)),L.angle+=-D/F*R,U.prevElapsed=I,A}}),z.call(function(){E.node.setPosition(I),E.setHeight(0,_),L.angle=0}),tZ.runTweenAsync(z))]})}),function(g){return C.apply(this,arguments)})},{key:"loadBreakClip",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.breakClip)return[3,2];return[4,ie.loadAnimClipAsync(nM.TILE_BREAK_ANIM)];case 1:g=E.sent();g&&this.animationComponent&&(this.breakClip=g,this.animationComponent.addClip(this.breakClip));E.label=2;case 2:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadClearClip",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.clearClip)return[3,2];return[4,ie.loadAnimClipAsync(nM.TILE_CLEAR_ANIM)];case 1:g=E.sent();g&&this.animationComponent&&(this.clearClip=g,this.animationComponent.addClip(this.clearClip));E.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"loadShakeClip",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.shakeClip)return[2,Promise.resolve()];return[4,ie.loadAnimClipAsync(nM.TILE_SHAKE_ANIM)];case 1:g=E.sent();if(!g||!this.animationComponent)return[2,Promise.resolve()];this.shakeClip=g,this.animationComponent.addClip(this.shakeClip);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setHeight",value:function(g,E){if(this.background){var _=this.background.node;_.setPosition(new em(_.position.x,g,0)),_.setScale(new em(1+g/E*.3,1+g/E*.3,1))}}},{key:"createSpecialHandler",value:function(g,E){var _=this;switch(g){case uX.bomb:return this.createBombHandler(null!=E?E:90);case uX.star:return this.createStarHandler();default:return{type:uX.none,switch:function(g,E){_.special=_.createSpecialHandler(g,E)}}}}},{key:"createBombHandler",value:function(g){var E=this,_=!1,k=g,a=function(){_=!0},o=function(){_=!1};this.node.scene.on(a2.TILE_CLICK,a),this.node.scene.on(a2.USE_ITEM,a),this.node.scene.on(a2.RESUME_TIME,a),this.node.scene.on(a2.PAUSE_TIME,o),this.node.scene.on(a2.TIME_OUT,o),this.bombComponent.node.active=!0;var r=function(){_=!1,E.bombComponent.node.active=!1,k=g,E.node.scene.off(a2.TILE_CLICK,a),E.node.scene.off(a2.USE_ITEM,a),E.node.scene.off(a2.GAME_RESUME,a),E.node.scene.off(a2.GAME_PAUSE,o),E.node.scene.off(a2.TIME_OUT,o)};return{type:uX.bomb,update:function(C){_&&(k-=C,E.bombComponent.fillRange=-k/g,k<=0&&(_=!1,E.bombComponent.node.active=!1,E.setEmpty(!0),E.node.scene.emit(a2.BOMB_EXPLODE,E)))},clear:function(){i8.playSound(ih.BOMB_DEFUSE)},cleanup:r,onDestroy:function(){E.node.scene.off(a2.TILE_CLICK,a),E.node.scene.off(a2.USE_ITEM,a),E.node.scene.off(a2.GAME_RESUME,a),E.node.scene.off(a2.GAME_PAUSE,o),E.node.scene.off(a2.TIME_OUT,o)},switch:function(g,_){r(),E.special=E.createSpecialHandler(g,_)},detonateImmediately:function(){k=0}}}},{key:"createStarHandler",value:function(){var g=this;this.starComponent.node.active=!0;var t=function(){g.starComponent.node.active=!1};return{type:uX.star,clear:function(){g.starComponent.node.active=!1,i8.playSound(ih.COLLECT_STARS);var E=g.node.worldPosition,_=E.x,k=E.y;g.node.scene.emit(a2.ADD_STARS,{startAnimationAt:[_,k]})},cleanup:t,switch:function(E){t(),g.special=g.createSpecialHandler(E)}}}}]),h}(D)).prototype,"icon",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uF=st(uD.prototype,"bombComponent",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uU=st(uD.prototype,"starComponent",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uz=st(uD.prototype,"background",[uC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ux=st(uD.prototype,"bgUITransform",[uA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uG=st(uD.prototype,"defaultBackground",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uV=st(uD.prototype,"uiOpacity",[uR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uK=st(uD.prototype,"shineOpacity",[uI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uH=st(uD.prototype,"glowOpacity",[uL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uq=st(uD.prototype,"iconOpacity",[uP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uW=st(uD.prototype,"button",[uO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uj=st(uD.prototype,"animationComponent",[uB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uN=uD))||uN)||uN)||uN);function Nh(g,E,_,k){var C=arguments.length>3&&void 0!==k?k:0,A=_.x,T=_.y,R=et(E,2),I=R[0],L=R[1],P=I*(A-(g.width-1)/2)+C*(A-g.width/2),O=L*(T-(g.height-1)/2)+C*(T-g.height/2);return -1===A&&(P+=E[0]/4),A===g.width&&(P-=E[0]/4),-1===T&&(O+=E[1]/4),T===g.height&&(O-=E[1]/4),{x:P,y:O}}function Dh(g,E){var _=arguments.length>1&&void 0!==E?E:[0,0],k=et(g,2),C=k[0],A=k[1],T=et(_,2),R=T[0],I=T[1],L=1-R,P=1-I,O=C*L,B=A*P;return[O,B]}function Mh(g,E){for(var _=arguments.length>1&&void 0!==E&&E,k=g.split("-"),C=[],A=0;A<k.length;){var T=null,R=k[A];switch(R){case"normal":A+=1;break;case"fall":T=uh,A+=2;break;case"fly":T=up,A+=2;break;case"push":"left"===k[A+1]?(T=uf,A+=2):(T=uy,A+=2);break;case"put":"columns"===k[A+1]?(T=uv,A+=3):(T=ug,A+=3)}T&&(_&&(T=Bh(T)),C.push(T))}return C}function Bh(g){switch(g){case uh:return uy;case up:return uf;case uf:return uh;case uy:return up;case uv:return ug;case ug:return uv}}function Fh(g){return(_instanceof(g,um)?g.asArray():g).filter(function(g){return!g.isHidden()})}function xh(g){return(_instanceof(g,um)?g.asArray():g).filter(function(g){return g.isHidden()})}_._RF.pop(),_._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),_._RF.pop(),_._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),_._RF.pop(),_._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),_._RF.pop(),_._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),_._RF.pop(),_._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),_._RF.pop(),_._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),_._RF.pop(),_._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),_._RF.pop(),_._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),_._RF.pop(),_._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);var u$=GameCore.Utils.Object;function Gh(g,E){var _=E.getCoord(),k=_.x,C=_.y;return u$.vals(uc).reduce(function(E,_){var A=_.x,T=_.y,R=k+A,I=C+T;return g.isInBounds(R,I)&&E.push(g.get(R,I)),E},[])}function zh(g){return Array.isArray(g)}function Vh(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=zh(g)?g:g.asArray();return k[eA(_,0,k.length)]}_._RF.pop(),_._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),_._RF.pop(),_._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);var u0=GameCore.Utils.Array;function qh(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=_instanceof(g,um)?g.asArray():g,C=Vh(k,_),A=u0.search(k,function(g){return g.isSimilarTo(C)&&!g.inSamePositionAs(C)});if(void 0===A)throw new Error("Could not find a matching tile");return[C,A]}_._RF.pop(),_._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var Wh=function(g){return g};function jh(g,E,_){var k=arguments.length>2&&void 0!==_?_:Wh;return function(){var _,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=g,C=E;_<=0&&(_=Number.POSITIVE_INFINITY);A=0;T.label=1;case 1:if(!(A<_))return[3,4];return[4,k(C)];case 2:T.sent(),C=1e9*eT(C);T.label=3;case 3:A++;return[3,1];case 4:return[2]}})}()}function Kh(g){return Array.isArray(g)}function Yh(g,E,_){var k=arguments.length>2&&void 0!==_?_:Date.now(),C=Kh(g)?g:g.asArray();if(C.length<E)return new Set(C);for(var A=new Set,T=jh(-1,k),R=T.next();A.size<E;){if(R.done)throw new Error("RNG exhausted");A.add(Vh(C,R.value)),R=T.next()}return A}_._RF.pop(),_._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),_._RF.pop(),_._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),_._RF.pop(),_._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var u1=[1,4];function Qh(g,E,_){var k,C=arguments.length>2&&void 0!==_?_:Date.now(),A=E.specials,T=A.bomb,R=eA.apply(void 0,[C].concat(u1)),I=Yh(g,T,C),L=g.asArray().filter(function(g){return!I.has(g)}),P=Yh(L,R,C),O=at(I);try{for(O.s();!(k=O.n()).done;){var B=k.value,N=2*E.time/3;B.setSpecialType(uX.bomb,N)}}catch(g){O.e(g)}finally{O.f()}var D,M=at(P);try{for(M.s();!(D=M.n()).done;){var F=D.value;F.setSpecialType(uX.star)}}catch(g){M.e(g)}finally{M.f()}}_._RF.pop(),_._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),_._RF.pop(),_._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);var u2=GameCore.Utils.Array;function Zh(g){var E=g.levelData,_=E.columns,k=E.rows,C=g.identities,A=g.createTile,T=g.seed,R=function(g,E,_){var k,C=[],A=at(jh(E/2,g,function(g){return eA(g,0,_.length)}));try{for(A.s();!(k=A.n()).done;){var T=k.value;C.push(_[T]),C.push(_[T])}}catch(g){A.e(g)}finally{A.f()}return u2.shuffle(C),C}(void 0===T?Date.now():T,_*k,C),I=$h(g.levelData,C,R),L=$h(g.levelData,C,I.reverse()).reverse().map(function(g){var E=A(g);return E.setIdentity(g),E});return new um({width:_,height:k,content:L})}function $h(g,E,_){var k=g.rows,C=g.columns,A=g.rules;if(!A.maxSpaceOfPair)return _;for(var T=function(g,E,_){for(var k=[],C=0;C<E;C++){k[C]=[];for(var A=0;A<_;A++)k[C][A]=g[C*_+A]}return k}(_,k,C),R=0;R<E.length;R++)for(var I=null,L=null,P=0;P<k;P++)for(var O=0;O<C;O++)if(T[P][O]===E[R]){if(!I||!L){I=P,L=O;continue}var B=A.maxSpaceOfPair+1;if(Math.abs(P-I)+Math.abs(O-L)<=B){L=O,I=P;continue}var N=ed(I,L,P,O),D=T[N.row][N.column];T[N.row][N.column]=T[P][O],T[P][O]=D}return function(g){for(var E=[],_=0;_<g.length;_++)for(var k=0;k<g[_].length;k++)E.push(g[_][k]);return E}(T)}function ed(g,E,_,k){var C=g,A=E;return _>g&&(C=g+1),_<g&&(C=g-1),k>E&&(A=E+1),k<E&&(A=E-1),{row:C,column:A}}_._RF.pop(),_._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);var u4=GameCore.Utils.Array;function nd(g){var E=g.customFen,_=g.identities,k=g.createTile,C=E.idSize,A=E.cols,T=E.rows,R=E.code;if(_.length<E.idSize)throw new Error("Invalid grid code. There are not enough identities/frames ".concat(_.length," to fill it according to fen code ").concat(C));var I=R.split(":");if(I.length!==T)throw new Error("Invalid grid code");var L=/[a-zA-Z]+\d+|./g,P=/[a-zA-Z]+/,O=/\d+/,B=I.reduceRight(function(g,C){var A,T=[],R=at(C.matchAll(L));try{for(R.s();!(A=R.n()).done;){var I,B,N=A.value[0],D=null===(I=O.exec(N))||void 0===I?void 0:I[0],M=void 0!==D?Number.parseInt(D,10):void 0,F=void 0!==M&&!Number.isNaN(M)&&M<_.length?_[M]:void 0,U=k(void 0!==F?F:_[0]),z=null===(B=P.exec(N))||void 0===B?void 0:B[0],x=void 0!==z?id(z,E.encoding):void 0;x&&F?U.setSpecialType(x):U.setEmpty(),T.push(U)}}catch(g){R.e(g)}finally{R.f()}return g.concat(T)},[]);return new um({width:A,height:T,content:B})}function id(g,E){var _=u4.search(Object.entries(E),function(E){var _=et(E,2);_[0];return _[1]===g});if(void 0===_)throw new Error("Invalid special type ".concat(g));return _[0]}_._RF.pop(),_._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),_._RF.pop(),_._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);var u5=GameCore.Utils.Array;function od(g,E){var _=arguments.length>1&&void 0!==E?E:Date.now(),k=g.asArray(),C=Vh(g,_),A=Gh(g,C);if(!A.some(function(g){return g.isSimilarTo(C)})){var T=Vh(A,_),R=u5.search(k,function(g){return!g.inSamePositionAs(C)&&!g.inSamePositionAs(T)&&g.isSimilarTo(T)});R.setIdentity(C.id),T.setIdentity(C.id)}}_._RF.pop(),_._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),_._RF.pop(),_._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var u6=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];_._RF.pop(),_._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var u8=GameCore.Utils.Array;function ld(g,E){return g[0]===E[0]&&g[1]===E[1]}function ud(g){return new eS(g[0],g[1])}function cd(g,E){return g.x>=-1&&g.x<E.width+1&&g.y>=-1&&g.y<E.height+1}function hd(g,E){var _=arguments.length>1&&void 0!==E?E:u7;return _.map(function(E){return[g.tile[0]+E.x,g.tile[1]+E.y]})}var u9,u7=[uc.Up,uc.Down,uc.Left,uc.Right],ce=function(){function e(g,E){var _;if(Fe(this,e),this.f=0,this.g=0,this.h=0,E&&ld(g,E.tile))throw new Error("Tile cannot be its own parent");this.tile=g,this.parent=E;var k=e.calcDirection(this),C=E&&k&&E.cache.direction&&!k.equals(E.cache.direction)?1:0;this.cache={direction:k,turns:C+(null!==(_=null==E?void 0:E.cache.turns)&&void 0!==_?_:0)}}return Ue(e,[{key:"getKey",value:function(){var g;return"x:".concat(this.tile[0],",y:").concat(this.tile[1],",d:").concat(null===(g=this.cache.direction)||void 0===g?void 0:g.toString())}},{key:"equals",value:function(g){return this.getKey()===g.getKey()}}],[{key:"calcDirection",value:function(g){if(g.parent){var E=g.parent.tile,_=g.tile;return new eS(_[0]-E[0],_[1]-E[1])}return null}}]),e}();function fd(g,E,_){var k=gd(g,E),C=gd(g,_);if(0===k.length||0===C.length)return vd(E,_);var A=function(g,E,_){var k=[],C=[],A=new ce(E,null),T=new ce(_,null),R=[T.tile];k.push(A);for(;k.length>0;){var I=k.shift();if(C.push(I),ld(I.tile,T.tile)){for(var L=[],P=I,O=I,B=I.parent;B;)B.cache.turns!==O.cache.turns&&(L.unshift({a:ud(B.tile),b:ud(P.tile)}),P=B),O=B,B=B.parent;return L.unshift({a:ud(O.tile),b:ud(P.tile)}),L}var N,D=at(hd(I,gd(g,I.tile,R)));try{var f=function(){var g=N.value,E=new ce(g,I);if(E.cache.turns>8)return 0;var _=ld(E.tile,T.tile),A=C.some(function(g){return g.equals(E)});if(k.some(function(g){return g.equals(E)})||A&&!_)return 0;E.g=I.g+1+E.cache.turns,E.h=md(E,T),E.f=E.g+E.h,k.push(E)};for(D.s();!(N=D.n()).done;)f()}catch(g){D.e(g)}finally{D.f()}k.sort(function(g,E){return g.f-E.f})}return null}(g,E,_);return A||vd(E,_)}function vd(g,E){var _=ud(g),k=ud(E);return _.x===k.x||_.y===k.y?[{a:_,b:k}]:[{a:_,b:{x:_.x,y:k.y}},{a:{x:_.x,y:k.y},b:k}]}function md(g,E){var _=g.tile,k=E.tile;return Math.abs(_[0]-k[0])+Math.abs(_[1]-k[1])}function gd(g,E,_){var k,C=arguments.length>2&&void 0!==_?_:[],A=[],T=at(u7);try{var r=function(){var _=k.value,T={x:E[0]+_.x,y:E[1]+_.y};if(g.isInBounds(T.x,T.y))return(g.get(T.x,T.y).isHidden()||u8.search(C,function(g){return ld(g,[T.x,T.y])}))&&A.push(_),1;cd(T,g)&&A.push(_)};for(T.s();!(k=T.n()).done;)r()}catch(g){T.e(g)}finally{T.f()}return A}_._RF.pop(),_._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),_._RF.pop(),_._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var ct=(Ge(u9={},uX.bomb,"b"),Ge(u9,uX.star,"s"),Ge(u9,uX.none,"t"),u9);function Sd(g,E){for(var _=arguments.length>1&&void 0!==E?E:ct,k=g.width,C=g.height,A=[],T=new Map,R=C-1;R>=0;R--){for(var I=[],L=0;L<k;L++){var P,O,B=g.get(L,R),N=B.isHidden()?null:B.id;if(null!==N){var D=null!==(P=null===(O=B.special)||void 0===O?void 0:O.type)&&void 0!==P?P:uX.none,M=_[D];if(!T.has(N)){var F=T.size.toString();T.set(N,F)}var U="".concat(M).concat(T.get(N));I.push(U)}else I.push(".")}A.push(I.join(""))}return{code:A.join(":"),idSize:T.size,encoding:_,rows:C,cols:k}}function wd(g){return g.reduce(function(g,E,_,k){return E.inSamePositionAs(_,k)||g.push([E,[_,k]]),g},[])}function Ed(g,E){var _,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:_=0,k=g-1,C=0,A=E-1;P.label=1;case 1:if(!(_<=k&&C<=A))return[3,19];T=_;P.label=2;case 2:if(!(T<=k))return[3,5];return[4,{x:T,y:C}];case 3:P.sent();P.label=4;case 4:T++;return[3,2];case 5:R=++C;P.label=6;case 6:if(!(R<=A))return[3,9];return[4,{x:k,y:R}];case 7:P.sent();P.label=8;case 8:R++;return[3,6];case 9:I=--k;P.label=10;case 10:if(!(I>=_))return[3,13];return[4,{x:I,y:A}];case 11:P.sent();P.label=12;case 12:I--;return[3,10];case 13:L=--A;P.label=14;case 14:if(!(L>=C))return[3,17];return[4,{x:_,y:L}];case 15:P.sent();P.label=16;case 16:L--;return[3,14];case 17:_++;P.label=18;case 18:return[3,1];case 19:return[2]}})}_._RF.pop(),_._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),_._RF.pop(),_._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),_._RF.pop(),_._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var cn,ci,ca,cr,co,cs,cl,cu,cc,ch,cp=GameCore.Utils.Array,cf=function(){function e(g,E){Fe(this,e),this.coord=new eS(g,E)}return Ue(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function Md(g){return new eS(g[0],g[1])}function Bd(g,E,_){if(void 0===E||void 0===_)return function(g,E){var _,k=arguments.length>1&&void 0!==E?E:Ed,C=[],A=at(k(g.width,g.height));try{for(A.s();!(_=A.n()).done;){var T=_.value,R=g.get(T.x,T.y);R.isHidden()||C.push([R,[T.x,T.y]])}}catch(g){A.e(g)}finally{A.f()}var I,L=[],u=function(){var E=et(C.shift(),2),_=E[0],k=E[1];if(cp.search(L,function(g){return Ud(g,k)}))return 0;L.push(k);for(var A,r=function(){var E=et(R[T],2),C=E[0],A=E[1];if(!C.isSimilarTo(_)||cp.search(L,function(g){return Ud(g,A)}))return 0;var I=Bd(g,k,A);return null!==I?{v:{v:I}}:void 0},T=0,R=C;T<R.length;T++)if(0!==(A=r())&&A)return A.v};for(;C.length>0;)if(0!==(I=u())&&I)return I.v;return null}(g);var k,C=[E[0]+1,E[1]+1],A=[_[0]+1,_[1]+1],T=function(g){var E=cp.fillWith(g.width+2,function(g){return new cf(g-1,-1)}),_=cp.fillWith(g.width+2,function(E){return new cf(E-1,g.height)}),k=cp.fillWith(g.height,function(g){return new cf(-1,g)}),C=cp.fillWith(g.height,function(E){return new cf(g.width,E)}),o=function(A,T){var R=A-1,I=T-1;return -1===R?k[I]:R===g.width?C[I]:-1===I?E[R]:I===g.height?_[R]:g.get(R,I)};return{get:function(g,E){return o(g,E)},width:g.width+2,height:g.height+2}}(g),R=[C,A];if(C[0]===A[0]&&zd(T,R,C[1],A[1],C[0])||C[1]===A[1]&&Vd(T,R,C[0],A[0],C[1]))return Wd([{a:Md(C),b:Md(A)}],{x:-1,y:-1});var I=C[1]<=A[1]?C:A,L=C[1]<=A[1]?A:C,P=C[0]<=A[0]?C:A,O=C[0]<=A[0]?A:C,B=[],N=[],D=Hd(T,R,1,Md(I),Md(L)),M=Hd(T,R,-1,Md(I),Md(L));-1===D&&-1===M||(k=-1!==D?D:M,B=[{a:Md(C),b:{x:C[0],y:k}},{a:{x:C[0],y:k},b:{x:A[0],y:k}},{a:{x:A[0],y:k},b:Md(A)}]);var F=qd(T,R,1,Md(P),Md(O)),U=qd(T,R,-1,Md(P),Md(O));-1===F&&-1===U||(k=-1!==F?F:U,B=[{a:Md(C),b:{x:k,y:C[1]}},{a:{x:k,y:C[1]},b:{x:k,y:A[1]}},{a:{x:k,y:A[1]},b:Md(A)}]);var z=function(g,E,_,k){for(var C=_.y+1;C<k.y;C++)if(zd(g,E,_.y,C,_.x)&&Vd(g,E,_.x,k.x,C)&&zd(g,E,C,k.y,k.x))return C;return -1}(T,R,Md(I),Md(L));-1!==z&&(k=z,N=[{a:Md(C),b:{x:C[0],y:k}},{a:{x:C[0],y:k},b:{x:A[0],y:k}},{a:{x:A[0],y:k},b:Md(A)}]);var x=function(g,E,_,k){for(var C=_.x+1;C<k.x;C++)if(Vd(g,E,_.x,C,_.y)&&zd(g,E,_.y,k.y,C)&&Vd(g,E,C,k.x,k.y))return C;return -1}(T,R,Md(P),Md(O));return -1!==x&&(k=x,N=[{a:Md(C),b:{x:k,y:C[1]}},{a:{x:k,y:C[1]},b:{x:k,y:A[1]}},{a:{x:k,y:A[1]},b:Md(A)}]),B.length>0&&N.length>0?Wd(Fd(B)<=Fd(N)?B:N,{x:-1,y:-1}):B.length>0?Wd(B,{x:-1,y:-1}):N.length>0?Wd(N,{x:-1,y:-1}):null}function Fd(g){var E,_=0,k=at(g);try{for(k.s();!(E=k.n()).done;)_+=xd(E.value)}catch(g){k.e(g)}finally{k.f()}return _}function xd(g){return g.a.x===g.b.x?Math.abs(g.a.y-g.b.y):g.a.y===g.b.y?Math.abs(g.a.x-g.b.x):0}function Ud(g,E){return g[0]===E[0]&&g[1]===E[1]}function Gd(g,E,_){var k=arguments.length>2&&void 0!==_?_:[],C=g.get.apply(g,tt(E));return C.isHidden()||k.some(function(g){return Ud(g,E)})}function zd(g,E,_,k,C){for(var A=Math.min(_,k),T=Math.max(_,k),R=A;R<=T;R++)if(!Gd(g,[C,R],E))return!1;return!0}function Vd(g,E,_,k,C){for(var A=Math.min(_,k),T=Math.max(_,k),R=A;R<=T;R++)if(!Gd(g,[R,C],E))return!1;return!0}function Hd(g,E,_,k,C){var A=1===_?C.y:k.y,T=1===_?k.x:C.x;if(zd(g,E,k.y,C.y,T))for(;A>=0&&A<g.height&&Gd(g,[k.x,A],E)&&Gd(g,[C.x,A],E);){if(Vd(g,E,k.x,C.x,A))return A;A+=_}return -1}function qd(g,E,_,k,C){var A=1===_?C.x:k.x,T=1===_?k.y:C.y;if(Vd(g,E,k.x,C.x,T))for(;A>=0&&A<g.width&&Gd(g,[A,k.y],E)&&Gd(g,[A,C.y],E);){if(zd(g,E,k.y,C.y,A))return A;A+=_}return -1}function Wd(g,E){return g.map(function(g){return{a:{x:g.a.x+E.x,y:g.a.y+E.y},b:{x:g.b.x+E.x,y:g.b.y+E.y}}})}_._RF.pop(),_._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var cy,cv=k.ccclass,cg=k.property,cm=k.requireComponent,cb=globalThis.game.monitorError,cw=GameCore.Utils,cS=cw.Array,cE=cw.Function,c_=(cn=cv("Board"),ci=cm(R),ca=cg(uZ),cr=cg(C),co=cg({displayName:"Tile Spacing",group:"Create config"}),cn(cs=ci((cu=st((cl=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"tilePrefab",cu,Ke(g)),rt(g,"tilesHolder",cc,Ke(g)),rt(g,"tileTrim",ch,Ke(g)),g.tileSize=[0,0],g.selectedTile=null,g.layoutType="portrait",g.parsedGravityRules=[],g.normalMatches=0,g.normalMatchesSinceLastSpawn=0,g.spawnAttempts=0,g.hintPath=null,g.hintTiles=null,g.animationQueue=[],g.isConsumingAnimation=!1,g.handleViewResized=cE.debounce(function(){g.updateTilesHolderScale()},100),g.onLayoutChanged=function(E){g.layoutType=E},g}return Ue(a,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),nC.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenEvents()}},{key:"onDestroy",value:function(){this.unlistenEvents()}},{key:"create",value:function(g,E,_){var k=this,C=arguments.length>2&&void 0!==_?_:Date.now(),A=tt(g);cS.shuffle(A);var T=A.slice(0,E.colors);null==cb||cb.addMetadata({frames:T.map(function(g){return g.name})}),this.levelData=E,this.parsedGravityRules=Mh(E.mode,this.layoutType===am.Landscape);var r=function(g){var E=I(k.tilePrefab.node),_=E.getComponent(uZ);return _.setIdentity(g),k.tilesHolder.addChild(E),E.active=!0,_},R=!1;if(void 0!==E.customFen)try{R=!0,this.grid=nd({customFen:E.customFen,identities:T,createTile:r}),this.grid.forEach(function(g,E,_){g.setCoord(E,_),g.setIgnoreInput(!1),g.node.setSiblingIndex(0)})}catch(g){console.error("Error creating grid from custom fen",g,"falling back to random grid"),R=!1}R||(this.grid=Zh({levelData:E,seed:C,identities:T,createTile:r}),this.grid.forEach(function(g,E,_){g.setCoord(E,_),g.setIgnoreInput(!1),g.node.setSiblingIndex(0)}),od(this.grid,C),Qh(this.grid,E,C)),this.handleBoardLayout();var L=[this.tileTrim.x,this.tileTrim.y];this.tileSize=Dh(this.tilePrefab.getSize(),L),this.updateTilesHolderScale(),this.node.scene.emit(a2.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}},{key:"updateTilesHolderScale",value:function(){if(this.grid){var g=[this.grid.width,this.grid.height],E=[this.uiTransform.width,this.uiTransform.height],_=function(g,E,_){var k=et(g,2),C=k[0],A=k[1],T=et(E,2),R=T[0],I=T[1],L=et(_,2),P=L[0]/(C*R),O=L[1]/(A*I);return Math.min(P,O)}(g,this.tilePrefab.getSize(),E);this.tilesHolder.setScale(_,_),this.node.scene.emit(a2.GRID_RESIZE,_)}}},{key:"handleBoardLayout",value:function(){var g,E;this.layoutType===am.Landscape&&0!==this.levelData.level&&(this.grid=(g=this.grid,(E=g.toRotated()).forEach(function(g,E,_){g.setCoord(E,_)}),E))}},{key:"destroyTiles",value:function(){var g;null===(g=this.grid)||void 0===g||g.forEach(function(g){return g.node.destroy()})}},{key:"animateTilesAppear",value:function(){var g=this;return new Promise(function(E){var _=function(){var _=Be(function(){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Promise.all(g.grid.map(function(E,_,k){var C=eR(0,.5),A=E.node.scale.clone(),T=function(E,_){var k,C=eS.ZERO.clone(),A=at(g.parsedGravityRules);try{for(A.s();!(k=A.n()).done;){var T=k.value,R=g.getPrimitiveDirection(E,_,T);C.subtract2f(R.x,R.y)}}catch(g){A.e(g)}finally{A.f()}return C.normalize()}(_,k),R=Nh(g.grid,g.tileSize,{x:_,y:k}),I=T.multiplyScalar(100).add2f(R.x,R.y);return E.node.setPosition(I.x,I.y),E.node.setScale(0,0),Promise.all([tZ.runTweenAsync(x(E.node).delay(C).to(.5,{scale:A},{easing:"elasticOut"})),E.sync({getTargetPosition:function(E){return Nh(g.grid,g.tileSize,E)},easing:"backOut",duration:.5,delay:C})])}))];case 1:_.sent(),E();return[2]}})});return function(){return _.apply(this,arguments)}}();g.animationQueue.push(_),g.consumeAnimationQueue()})}},{key:"animateTilesWave",value:function(){var g=this;return new Promise(function(E){var _=function(){var _=Be(function(){var _;return _ts_generator(this,function(k){switch(k.label){case 0:_=function(g,E){for(var _=E.x,k=E.y,C="center"===g?{x:(_-1)/2,y:(k-1)/2}:g,A=C.x,T=C.y,R=[],I=0;I<_;I++){for(var L=[],P=0;P<k;P++){var O=A-I,B=T-P,N=Math.sqrt(O*O+B*B);L.push(N)}R.push(L)}return R}("center",{x:g.grid.width,y:g.grid.height});return[4,Promise.all(g.grid.map(function(g,E,k){var C=.1*_[E][k],A=g.node.scale.clone();return Promise.all([tZ.runTweenAsync(x(g.node).delay(C).to(.25,{scale:A.clone().multiplyScalar(1.2)},{easing:"quadOut"}).to(.25,{scale:A},{easing:"quadIn"}))])}))];case 1:k.sent(),E();return[2]}})});return function(){return _.apply(this,arguments)}}();g.animationQueue.push(_),g.consumeAnimationQueue()})}},{key:"handleTileClick",value:function(g){if(!g.isHidden()){if(this.selectedTile===g)return i8.playSound(ih.TILE_SELECT),this.selectedTile=null,void g.setFocused(!1);if(!this.selectedTile)return i8.playSound(ih.TILE_SELECT),this.selectedTile=g,void g.setFocused(!0);if(!this.selectedTile.isSimilarTo(g))return i8.playSound(ih.TILE_SELECT),this.selectedTile.setFocused(!1),this.selectedTile=g,void g.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,g),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(g,E){var _=[g.getCoord().x,g.getCoord().y],k=[E.getCoord().x,E.getCoord().y],C=Bd(this.grid,_,k);if(null===C){i8.playSound(ih.INVALID_MATCH),this.shakeGrid();var A=0===this.levelData.level,T=function(g,E,_,k){if(k){var C=u6[4].startTile,A=u6[4].endTile;if(E[0]===C.x&&E[1]===C.y&&_[0]===A.x&&_[1]===A.y)return[{a:C,b:A}];if(E[0]===A.x&&E[1]===A.y&&_[0]===C.x&&_[1]===C.y)return[{a:C,b:A}]}return fd(g,E,_)}(this.grid,_,k,A);return this.node.scene.emit(a2.GRID_MATCH,[g,E]),void this.node.scene.emit(a2.GRID_MATCH_FAIL,T)}i8.playSound(ih.TILE_MATCH),this.node.scene.emit(a2.GRID_MATCH,[g,E]),this.node.scene.emit(a2.GRID_MATCH_SUCCESS,C,[g,E]),this.clear([[g,E]],"clear")}},{key:"clear",value:function(g,E){var _=arguments.length>1&&void 0!==E?E:"clear";this.normalMatches+=g.length;var k,C=at(g);try{for(C.s();!(k=C.n()).done;){var A=et(k.value,2),T=A[0],R=A[1];T.setEmpty(),R.setEmpty(),T.playClearFX(_),R.playClearFX(_),this.node.scene.emit(a2.GRID_CLEAR,[T,R])}}catch(g){C.e(g)}finally{C.f()}this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var g=this.hintPath[0].a,E=this.hintPath[this.hintPath.length-1].b,_=this.getTileAt(g.x,g.y),k=this.getTileAt(E.x,E.y);_.setHint(!0),k.setHint(!0),this.hintTiles=[_,k]}}},{key:"hideHint",value:function(){if(this.hintTiles){var g=et(this.hintTiles,2),E=g[0],_=g[1];E.setHint(!1),_.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(g,E){return this.grid.isInBounds(g,E)?this.grid.get(g,E):null}},{key:"getAnyTileWorldPosition",value:function(g,E){var _=Nh(this.grid,this.tileSize,{x:g,y:E});this.tilePrefab.node.setPosition(_.x,_.y);var k=this.tilePrefab.node.getWorldPosition();return{x:k.x,y:k.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getGridSize",value:function(){return[this.grid.width,this.grid.height]}},{key:"getUncleared",value:function(){return Fh(this.grid)}},{key:"getCleared",value:function(){return xh(this.grid)}},{key:"getBombTiles",value:function(){var g;return Fh(_instanceof(g=this.grid,um)?g.asArray():g).filter(function(g){var E;return(null===(E=g.special)||void 0===E?void 0:E.type)===uX.bomb})}},{key:"getPairs",value:function(g,E){for(var _=arguments.length>0&&void 0!==g?g:1,k=!(arguments.length>1&&void 0!==E)||E,C=[],A=k?Fh(this.grid):xh(this.grid),_$a=function(){var g=et(qh(A),2),E=g[0],_=g[1];C.push([E,_]),A=A.filter(function(g){return g!==E&&g!==_})};C.length<_;)_$a();return C}},{key:"setIgnoreInput",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.grid.forEach(function(g){return g.setIgnoreInput(E)})}},{key:"processShuffleRequest",value:function(g){var E=this.processShuffleStep(this.grid,!0,g);this.grid=E[0],this.hintPath=E[1],this.consumeAnimationQueue()}},{key:"getCurrentFen",value:function(){return Sd(this.grid)}},{key:"generateFenFromCurrentLevel",value:function(g){return a.generateFen(null!=g?g:this.levelData)}},{key:"listenEvents",value:function(){Q.on(t6,this.onLayoutChanged),Q.on(no,this.handleViewResized)}},{key:"unlistenEvents",value:function(){Q.off(t6,this.onLayoutChanged),Q.off(no,this.handleViewResized)}},{key:"shakeGrid",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.tilesHolder.position.clone(),E=x(this.tilesHolder).to(.05,{position:g.clone().add3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g.clone().subtract3f(eR(5,10),eR(5,10),0)}),_=x(this.tilesHolder).repeat(2,E).to(.05,{position:g});return[4,tZ.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"processGameplayCycle",value:function(){var g=Fh(this.grid);if(0!==g.length){var E=this.grid,_=g.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,k=this.normalMatchesSinceLastSpawn>=2;_&&(k?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),g.length>14&&(E=this.processGravitationStep(E));var C=this.processShuffleStep(E);this.consumeAnimationQueue(),this.grid=C[0],this.hintPath=C[1]}}},{key:"processSpawnStep",value:function(){var g=et(Yh(xh(this.grid),2),2),E=g[0],_=g[1];E.restore(),_.restore(E.id),this.node.scene.emit(a2.GRID_SPAWN,[E,_])}},{key:"processGravitationStep",value:function(g){var E,_=this,k=g,C=[],A=at(this.parsedGravityRules);try{var r=function(){var g=E.value,A=wd(k=_.toGravitated(k,g));if(0===A.length)return 1;var T,R=at(A);try{for(R.s();!(T=R.n()).done;){var I=et(T.value,2),L=I[0],P=et(I[1],2),O=P[0],B=P[1];L.setCoord(O,B)}}catch(g){R.e(g)}finally{R.f()}k.forEach(function(g){g.node.setSiblingIndex(0)});var N=function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Promise.all(A.map(function(g){var E=et(g,2),C=E[0],A=et(E[1],2),T=A[0],R=A[1];return C.sync({delay:.25,duration:.25,getTargetPosition:function(){return Nh(k,_.tileSize,{x:T,y:R})}})}))];case 1:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}();C.push(N)};for(A.s();!(E=A.n()).done;)r()}catch(g){A.e(g)}finally{A.f()}var T=function(){var g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=0,E=C;k.label=1;case 1:if(!(g<E.length))return[3,4];_=E[g];return[4,_()];case 2:k.sent();k.label=3;case 3:g++;return[3,1];case 4:return[2]}})});return function(){return g.apply(this,arguments)}}();return this.animationQueue.push(T),k}},{key:"toGravitated",value:function(g,E){var _=new um(g),k=g.height-1,C=g.width-1,A=[0,k],T=[0,C],R=Math.floor(g.height/2),I=Math.floor(g.width/2),u=function(g){return g.isHidden()};switch(E){case uh:_.gravitate({rowRange:A,colRange:T,direction:uc.Down,isLighter:u});break;case up:_.gravitate({rowRange:A,colRange:T,direction:uc.Up,isLighter:u});break;case uf:_.gravitate({rowRange:A,colRange:T,direction:uc.Left,isLighter:u});break;case uy:_.gravitate({rowRange:A,colRange:T,direction:uc.Right,isLighter:u});break;case uv:_.gravitate({rowRange:A,colRange:[I,C],direction:uc.Left,isLighter:u,out:_.gravitate({rowRange:A,colRange:[0,I-1],direction:uc.Right,isLighter:u})});break;case ug:_.gravitate({rowRange:[R,k],colRange:T,direction:uc.Down,isLighter:u,out:_.gravitate({rowRange:[0,R-1],colRange:T,direction:uc.Up,isLighter:u})})}return _}},{key:"getPrimitiveDirection",value:function(g,E,_){var k=Math.floor(this.grid.height/2),C=Math.floor(this.grid.width/2);switch(_){case uh:return uc.Down;case up:return uc.Up;case uf:return uc.Left;case uy:return uc.Right;case uv:return g>=C?uc.Left:uc.Right;case ug:return E>=k?uc.Down:uc.Up}}},{key:"processShuffleStep",value:function(g,E,_){var k,C=arguments.length>1&&void 0!==E&&E,A=arguments.length>2?_:void 0,T=Bd(g),R=Fh(g).map(function(g){var E=g.getCoord();return[E.x,E.y]});if(null!==T&&!C)return[g,T];var I=100;do{var L=g.toShuffled(R),P=et(L,1);T=Bd(k=P[0]),I--}while(null===T&&I>0);if(I<=0){var O=k.asArray().map(function(g){var E,_;return{name:null===(E=g.id)||void 0===E?void 0:E.name,type:null===(_=g.special)||void 0===_?void 0:_.type,active:!g.isHidden()}});return null==cb||cb.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",level:this.levelData.level,gridAsArray:O}),this.node.scene.emit(a2.GAME_EXIT),[g,T]}var B,N=wd(k),D=at(N);try{for(D.s();!(B=D.n()).done;){var M=et(B.value,2),F=M[0],U=et(M[1],2),z=U[0],x=U[1];F.setCoord(z,x)}}catch(g){D.e(g)}finally{D.f()}var G=void 0!==A?function(){return A(g,k)}:this.createShuffleAnimationHandler(g,k);return this.animationQueue.push(G),[k,T]}},{key:"createShuffleAnimationHandler",value:function(g,E){var _=this,k=function(){var k=Be(function(){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,Promise.all(g.map(function(g,k,C){return g.sync({duration:.3,easing:"smooth",getTargetPosition:function(){return Nh(E,_.tileSize,{x:k,y:C},10)}})}))];case 1:k.sent();return[2]}})});return function(){return k.apply(this,arguments)}}(),C=function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:E.forEach(function(g){g.node.setSiblingIndex(0)});return[4,Promise.all(E.map(function(g){return g.sync({duration:.4,easing:"smooth",delay:eR(0,.2),getTargetPosition:function(g){return Nh(E,_.tileSize,g)}})}))];case 1:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}();return function(){var g=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,k()];case 1:g.sent();return[4,C()];case 2:g.sent();return[2]}})});return function(){return g.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this.isConsumingAnimation)return[3,5];this.isConsumingAnimation=!0;E.label=1;case 1:if(!(this.animationQueue.length>0))return[3,4];if(0===this.getUncleared().length){this.animationQueue=[];return[3,4]}g=this.animationQueue.shift();return[4,g()];case 2:E.sent();E.label=3;case 3:return[3,1];case 4:this.isConsumingAnimation=!1;E.label=5;case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"clearAnimationQueue",value:function(){this.isConsumingAnimation=!1,this.animationQueue=[]}}],[{key:"generateFen",value:function(g){for(var E=g,_=[],k=0;k<E.colors;k++)_.push(k+1);var C=Date.now(),A=Zh({levelData:E,seed:C,identities:_,createTile:function(g){var E=g,_=void 0,k=new eS(0,0);return{get id(){return E},get special(){return _},get coord(){return k},setIdentity:function(g){E=g},isHidden:function(){return!1},setSpecialType:function(g){_={type:g}},setCoord:function(g,E){return k.set(g,E)},getCoord:function(){return k},isSimilarTo:function(g){return g.id===E},inSamePositionAs:function(g){return g.getCoord().equals(k)}}}});return A.forEach(function(g,E,_){g.setCoord(E,_)}),od(A,C),Qh(A,E,C),Sd(A)}}]),a}(D)).prototype,"tilePrefab",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cc=st(cl.prototype,"tilesHolder",[cr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=st(cl.prototype,"tileTrim",[co],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(.025,.1)}}),cs=cl))||cs)||cs);_._RF.pop(),_._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var ck=(0,k.ccclass)("Line")(cy=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R)}},{key:"setPoints",value:function(g,E){this.node.setWorldPosition((g.x+E.x)/2,(g.y+E.y)/2,0),this.uiTransform.width=eS.distance(g,E)+10,this.uiTransform.width/=this.node.worldScale.x;var _=180*Math.atan2(E.y-g.y,E.x-g.x)/Math.PI;this.node.eulerAngles=new em(0,0,_)}}]),n}(D))||cy;_._RF.pop(),_._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var cC,cA,cT,cR,cI,cL,cP,cO,cB,cN,cD,cM=function(g){ze(n,g);var E=Xe(n);function n(g,_,k,C,A){var T;return Fe(this,n),(T=E.call(this,g,_,A)).ator=k,T.ftor=C,T}return Ue(n,[{key:"alloc",value:function(){var g=Je(Ve(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(g),g}},{key:"free",value:function(g){this.ftor&&this.ftor(g),Je(Ve(n.prototype),"free",this).call(this,g)}}]),n}(eI);_._RF.pop(),_._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var cF,cU,cz,cx,cG,cV,cK,cH,cq,cW=k.ccclass,cj=k.property,cX=(cC=cW("PathDrawer"),cA=cj({group:"Line",displayName:"Prefab",type:ee}),cT=cj({group:"Line",displayName:"Holder",type:C,tooltip:"Line Prefab"}),cR=cj({group:"Point",displayName:"Prefab",type:ee}),cI=cj({group:"Point",displayName:"Holder",type:C}),cC((cO=st((cP=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"linePrefab",cO,Ke(g)),rt(g,"lineHolder",cB,Ke(g)),g.lineNodes=[],rt(g,"pointPrefab",cN,Ke(g)),rt(g,"pointHolder",cD,Ke(g)),g.pointNodes=[],g}return Ue(n,[{key:"start",value:function(){var g=this;this.linePool=new cM(function(){var E=I(g.linePrefab);return g.lineHolder.addChild(E),E.parent=g.lineHolder,E.active=!1,E},0,function(E){g.lineNodes.push(E),E.active=!0},function(g){g.active=!1},function(g){g.isValid&&g.destroy()}),this.pointPool=new cM(function(){var E=I(g.pointPrefab);return g.pointHolder.addChild(E),E.active=!1,E},0,function(E){g.pointNodes.push(E),E.active=!0},function(g){g.active=!1},function(g){g.isValid&&g.destroy()})}},{key:"drawPath",value:function(g){this.clearPath();var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k,C=E.value;null===(k=this.linePool.alloc().getComponent(ck))||void 0===k||k.setPoints(C.a,C.b)}}catch(g){_.e(g)}finally{_.f()}}},{key:"clearPath",value:function(){var g,E=at(this.lineNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value;this.linePool.free(_)}}catch(g){E.e(g)}finally{E.f()}this.lineNodes=[];var k,C=at(this.pointNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value;this.pointPool.free(A)}}catch(g){C.e(g)}finally{C.f()}this.pointNodes=[]}}]),n}(D)).prototype,"linePrefab",[cA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cB=st(cP.prototype,"lineHolder",[cT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cN=st(cP.prototype,"pointPrefab",[cR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cD=st(cP.prototype,"pointHolder",[cI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cL=cP))||cL);_._RF.pop(),_._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var cY,cJ=k.ccclass,cQ=k.property,cZ=(cF=cJ("ErrorDrawer"),cU=cQ(er),cz=cQ(er),cx=cQ(er),cF((cK=st((cV=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"one",cK,Ke(g)),rt(g,"two",cH,Ke(g)),rt(g,"error",cq,Ke(g)),g}return Ue(n,[{key:"start",value:function(){Je(Ve(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(g){var E=this;if(this.clearPath(),g.forEach(function(_,k){var C;if(null===(C=E.linePool.alloc().getComponent(ck))||void 0===C||C.setPoints(_.a,_.b),0!==k){var A=E.pointPool.alloc();A.setWorldPosition(new em(_.a.x,_.a.y,0));var T=A.getComponent(eo);1===k&&g.length>3?T.spriteFrame=E.one:2===k&&g.length>3?T.spriteFrame=E.two:T.spriteFrame=E.error}}),1===g.length){var _=this.pointPool.alloc();_.setWorldPosition(new em(g[0].a.x+g[0].b.x,g[0].a.y+g[0].b.y,0).multiplyScalar(.5)),_.getComponent(eo).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(g){this.pathAppearDuration>0&&(this.pathAppearDuration-=g,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(cX)).prototype,"one",[cU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cH=st(cV.prototype,"two",[cz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cq=st(cV.prototype,"error",[cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cG=cV))||cG);_._RF.pop(),_._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var c$,c0=(0,k.ccclass)("HintDrawer")(cY=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"drawPath",value:function(g){this.clearPath(),this.createPath(g),this.showPath()}},{key:"createPath",value:function(g){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k,C=E.value;null===(k=this.linePool.alloc().getComponent(ck))||void 0===k||k.setPoints(C.a,C.b),this.pointPool.alloc().setWorldPosition(C.a.x,C.a.y,0)}}catch(g){_.e(g)}finally{_.f()}this.pointPool.alloc().setWorldPosition(g[g.length-1].b.x,g[g.length-1].b.y,0)}},{key:"showPath",value:function(){var g,E=at(this.lineNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value.getComponent(eu);_.opacity=0,x(_).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(g){E.e(g)}finally{E.f()}var k,C=at(this.pointNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value.getComponent(eu);A.opacity=0,x(A).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(g){C.e(g)}finally{C.f()}}},{key:"clearPath",value:function(){var g,E=this,_=at(this.lineNodes);try{var i=function(){var _=g.value,k=_.getComponent(eu);x(k).to(.15,{opacity:0},{onComplete:function(){k.opacity=255,E.linePool.free(_)}}).start()};for(_.s();!(g=_.n()).done;)i()}catch(g){_.e(g)}finally{_.f()}var k,C=at(this.pointNodes);try{var r=function(){var g=k.value,_=g.getComponent(eu);x(_).to(.15,{opacity:0},{onComplete:function(){_.opacity=255,E.pointPool.free(g)}}).start()};for(C.s();!(k=C.n()).done;)r()}catch(g){C.e(g)}finally{C.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(cX))||cY;_._RF.pop(),_._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var c1,c2,c4,c3,c5,c6,c8,c9,c7,he=(0,k.ccclass)("MatchDrawer")(c$=function(g){ze(a,g);var E,_,k=Xe(a);function a(){return Fe(this,a),k.apply(this,arguments)}return Ue(a,[{key:"drawPath",value:function(g){var E=this;g.forEach(function(g,_){var k,C=E.linePool.alloc();null===(k=C.getComponent(ck))||void 0===k||k.setPoints(g.a,g.b),E.animateLine(C);var A=E.pointPool.alloc();A.setWorldPosition(g.a.x,g.a.y,0),E.animatePoint(A,_)});var _=this.pointPool.alloc();_.setWorldPosition(g[g.length-1].b.x,g[g.length-1].b.y,0),this.animatePoint(_,g.length)}},{key:"animateLine",value:(_=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=g.getComponent(eu);E.opacity=0;_=x(E).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});return[4,tZ.runTweenAsync(_)];case 1:k.sent(),E.opacity=255,this.linePool.free(g);return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"animatePoint",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.scale=em.ZERO;_=x(g).delay(.03*E).to(.2,{scale:em.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:em.ZERO},{easing:"backIn"});return[4,tZ.runTweenAsync(_)];case 1:k.sent(),this.pointPool.free(g);return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),a}(cX))||c$;_._RF.pop(),_._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var ht,hn=k.ccclass,hi=k.property,ha=(c1=hn("PathDraw"),c2=hi({group:{name:"Path Drawer"},type:he}),c4=hi({group:{name:"Path Drawer"},type:c0}),c3=hi({group:{name:"Path Drawer"},type:cZ}),c1((c8=st((c6=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"matchPath",c8,Ke(g)),rt(g,"hintPath",c9,Ke(g)),rt(g,"errorPath",c7,Ke(g)),g.isDrawingHint=!1,g}return Ue(n,[{key:"onLoad",value:function(){var g=this;this.node.scene.on(a2.GRID_RESIZE,function(E){g.node.setScale(E,E)})}},{key:"drawMatchPath",value:function(g,E){var _,k=g.map(function(g){return De({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.matchPath.drawPath(k)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(g,E){if(!this.isDrawingHint){this.isDrawingHint=!0;var _,k=g.map(function(g){return De({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.hintPath.drawPath(k)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(g,E){var _,k=g.map(function(g){return De({},g)}),C=at(k);try{for(C.s();!(_=C.n()).done;){var A=_.value;A.a=E(A.a),A.b=E(A.b)}}catch(g){C.e(g)}finally{C.f()}this.errorPath.drawPath(k)}}]),n}(D)).prototype,"matchPath",[c2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c9=st(c6.prototype,"hintPath",[c4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c7=st(c6.prototype,"errorPath",[c3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c5=c6))||c5);_._RF.pop(),_._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var hr,ho,hs,hl,hu,hc,hh,hp,hf,hy,hv,hg=k.ccclass,hm=[ih.COMBO_1,ih.COMBO_2,ih.COMBO_3,ih.COMBO_4,ih.COMBO_5,ih.COMBO_6,ih.COMBO_7,ih.COMBO_8,ih.COMBO_9,ih.COMBO_10,ih.COMBO_11,ih.COMBO_12,ih.COMBO_13],hb=hg("ComboManager")(ht=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(a2.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(a2.GAME_FINISH,this.resetCombo,this),this.node.scene.on(a2.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(a2.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(a2.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(g){if(this.currentCombo=g,g>0){var E=Math.min(g-1,hm.length-1);i8.playSound(hm[E]),this.vibrate(g)}this.emitEvent&&this.node.scene.emit(a2.COMBO_UPDATED,g)}},{key:"vibrate",value:function(g){var E;null===(E=$("Vibrate"))||void 0===E||null===(E=E.getComponent(sP))||void 0===E||E.vibrate(Math.min(20+20*g,220))}},{key:"setEmitEvent",value:function(g){this.emitEvent=g}}]),n}(D))||ht;_._RF.pop(),_._RF.push({},"78746Q4viBIlbRROK4J1bSl","Burst",void 0);var hw,hS=k.ccclass,hE=k.property,h_=(hr=hS("Burst"),ho=hE(K),hs=hE(V),hl=hE(K),hu=hE(V),hr((hp=st((hh=function(){function e(){Fe(this,e),rt(this,"time",hp,this),rt(this,"repeatCount",hf,this),rt(this,"repeatInterval",hy,this),rt(this,"count",hv,this),this.remainingCount=0,this.curTime=0}return Ue(e,[{key:"update",value:function(g,E){if(0===this.remainingCount&&(this.remainingCount=this.repeatCount,this.curTime=this.time),this.remainingCount>0){var _=eP(g.time-g.startDelay.evaluate(0,1),g.duration)-E;_=_>0?_:0;var k=eP(g.time-g.startDelay.evaluate(0,1),g.duration);this.curTime>=_&&this.curTime<k&&(g.emit(this.count,E-(k-this.curTime)),this.curTime+=this.repeatInterval,--this.remainingCount)}}},{key:"reset",value:function(){this.remainingCount=0,this.curTime=0}}]),e}()).prototype,"time",[ho],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hf=st(hh.prototype,"repeatCount",[hs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hy=st(hh.prototype,"repeatInterval",[hl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hv=st(hh.prototype,"count",[hu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hc=hh))||hc);_._RF.pop(),_._RF.push({},"726cc2e08FBqpVIg/tPM7H2","Particle",void 0);var hk,hC,hA,hT,hR,hI,hL,hP,hO,hB,hN,hD,hM,hF,hU,hz,hx,hG=k.ccclass,hV=k.executeInEditMode,hK=hG("Particle")(hw=hV(!0)(hw=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).remainingLifetime=0,g.startLifetime=0,g}return Ue(n,[{key:"onLoad",value:function(){this.node.layer=ek.Enum.UI_2D}},{key:"init",value:function(g){this.sprite=this.getComponent(eo),this.particleSystem=g,this.velocity=em.ZERO,this.remainingLifetime=0,this.startLifetime=0,this.startSize=em.ZERO,this.startColor=A.WHITE.clone(),this.randomSeed=0}},{key:"reset",value:function(){this.node.rotation.set(0,0,0)}}]),n}(D))||hw)||hw;_._RF.pop(),_._RF.push({},"00eb3NBo0tM/qcD6ViMjx0A","CurveRange",void 0);var hH,hq,hW,hj,hX,hY,hJ,hQ,hZ,h$,h0,h1,h2,h4,h3,h5,h6,h8=k.ccclass,h9=k.property,h7=es({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),pe=(hk=h8("CurveRange"),hC=h9({type:es(h7)}),hA=h9({visible:function(){return this.mode===h7.Constant}}),hT=h9({visible:function(){return this.mode===h7.Curve}}),hR=h9({visible:function(){return this.mode===h7.TwoCurves}}),hI=h9({visible:function(){return this.mode===h7.TwoCurves}}),hL=h9({visible:function(){return this.mode===h7.TwoConstants}}),hP=h9({visible:function(){return this.mode===h7.TwoConstants}}),hk((hN=st((hB=function(){function e(){Fe(this,e),rt(this,"mode",hN,this),rt(this,"constant",hD,this),rt(this,"spline",hM,this),rt(this,"splineMin",hF,this),rt(this,"splineMax",hU,this),rt(this,"constantMin",hz,this),rt(this,"constantMax",hx,this),this.spline.assignSorted([0,1],[0,1]),this.splineMin.assignSorted([0,1],[0,1]),this.splineMax.assignSorted([0,1],[0,1])}return Ue(e,[{key:"evaluate",value:function(g,E){switch(this.mode){case h7.Curve:return this.spline.evaluate(g);case h7.TwoCurves:return eO(this.splineMin.evaluate(g),this.splineMax.evaluate(g),E);case h7.TwoConstants:return eO(this.constantMin,this.constantMax,E);default:return this.constant}}},{key:"getMax",value:function(){switch(this.mode){case h7.Curve:return 1;case h7.TwoConstants:return this.constantMax;case h7.TwoCurves:return 1;default:return this.constant}}},{key:"isZero",value:function(){switch(this.mode){case h7.Curve:return eB(1,0,eN);case h7.TwoConstants:return eB(Math.max(Math.abs(this.constantMax),Math.abs(this.constantMin)),0,eN);case h7.TwoCurves:return eB(1,0,eN);default:return eB(this.constant,0,eN)}}}]),e}()).prototype,"mode",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return h7.Constant}}),hD=st(hB.prototype,"constant",[hA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hM=st(hB.prototype,"spline",[hT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eD}}),hF=st(hB.prototype,"splineMin",[hR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eD}}),hU=st(hB.prototype,"splineMax",[hI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eD}}),hz=st(hB.prototype,"constantMin",[hL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hx=st(hB.prototype,"constantMax",[hP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hO=hB))||hO);_._RF.pop(),_._RF.push({},"3fe5eBRNTJFCZgeD7SqFSh5","GradientRange",void 0);var pt=k.ccclass,pn=k.property,pi=es({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),pa=new A,pr=new A,po=(hH=pt("GradientRange"),hq=pn({type:es(pi)}),hW=pn({visible:function(){return this.mode===pi.Color}}),hj=pn({visible:function(){return this.mode===pi.TwoColors}}),hX=pn({visible:function(){return this.mode===pi.TwoColors}}),hY=pn({visible:function(){return this.mode===pi.Gradient||this.mode===pi.RandomColor}}),hJ=pn({visible:function(){return this.mode===pi.TwoGradients}}),hQ=pn({visible:function(){return this.mode===pi.TwoGradients}}),hH((h0=st((h$=function(){function e(){Fe(this,e),rt(this,"mode",h0,this),rt(this,"color",h1,this),rt(this,"colorMin",h2,this),rt(this,"colorMax",h4,this),rt(this,"gradient",h3,this),rt(this,"gradientMin",h5,this),rt(this,"gradientMax",h6,this),this._color=A.WHITE.clone()}return Ue(e,[{key:"evaluate",value:function(g,E){switch(this.mode){case pi.Color:return this.color;case pi.TwoColors:return A.lerp(this._color,this.colorMin,this.colorMax,E),this._color;case pi.RandomColor:return this.gradient.getRandomColor(this._color);case pi.Gradient:return this.gradient.evaluateFast(this._color,g);case pi.TwoGradients:return A.lerp(this._color,this.gradientMin.evaluateFast(pa,g),this.gradientMax.evaluateFast(pr,g),E),this._color;default:return this.color}}}]),e}()).prototype,"mode",[hq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pi.Color}}),h1=st(h$.prototype,"color",[hW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),h2=st(h$.prototype,"colorMin",[hj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),h4=st(h$.prototype,"colorMax",[hX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return A.WHITE.clone()}}),h3=st(h$.prototype,"gradient",[hY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),h5=st(h$.prototype,"gradientMin",[hJ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),h6=st(h$.prototype,"gradientMax",[hQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eM}}),hZ=h$))||hZ);function af(g,E,_,k){!function(g,E){eS.set(g,Math.cos(E),Math.sin(E))}(g,k),g.z=0,em.multiplyScalar(g,g,E+(_-E)*eU())}function of(g){var E=h7;switch(g.mode){case E.TwoCurves:case E.TwoConstants:return!0;default:return!1}}_._RF.pop(),_._RF.push({},"1a4c4Z/fWpFuL5b3emrVLug","ParticleFunction",void 0),_._RF.pop(),_._RF.push({},"c2fc2/T2apMGZCPX5a4abo/","ModuleRandSeed",void 0);var ps,pl,pu,pc,ph,pp,pd,pf=23541,py=39825,pv=90794,pg=91041,pm=125292,pb=197866,pw=156497;_._RF.pop(),_._RF.push({},"39785+APfBJU5kvcdjZGiLr","ColorOvertimeModule",void 0);var pS,pE,p_,pk,pC,pA,pT,pR,pI,pL=k.ccclass,pP=k.property,pO=pg,pB=(ps=pL("ColorOvertimeModule"),pl=pP({type:J}),pu=pP({type:po}),ps((pp=st((ph=function(){function e(){Fe(this,e),rt(this,"enable",pp,this),rt(this,"color",pd,this)}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=g.randomSeed+pO,_=function(g){var E=pi;switch(g.mode){case E.TwoGradients:case E.TwoColors:return!0;default:return!1}}(this.color)?eT(E):0,k=1-g.remainingLifetime/g.startLifetime;g.sprite.color=g.startColor.clone().multiply(this.color.evaluate(k,_))}}}]),e}()).prototype,"enable",[pl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pd=st(ph.prototype,"color",[pu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new po}}),pc=ph))||pc);_._RF.pop(),_._RF.push({},"c397apirpxFfJTJN1KLAcGi","LimitVelocityOvertimeModule",void 0);var pN,pD,pM,pF,pU,pz,px,pG=k.ccclass,pV=k.property,pK=pf,pH=(pS=pG("LimitVelocityOvertimeModule"),pE=pV({type:J}),p_=pV({type:pe}),pk=pV({type:pe}),pS((pT=st((pA=function(){function e(){Fe(this,e),rt(this,"enable",pT,this),rt(this,"limit",pR,this),rt(this,"dampen",pI,this),this.limit.constant=500,this.dampen.constant=.2}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=g.velocity.clone().normalize(),C=of(this.limit)?eT(g.randomSeed+pK):0,A=of(this.dampen)?eT(g.randomSeed+pK+1):0,T=g.velocity.length(),R=this.limit.evaluate(_,C),I=this.dampen.evaluate(_,A);g.velocity=k.multiplyScalar(this.dampenBeyondLimit(T,R,I,E))}}},{key:"dampenBeyondLimit",value:function(g,E,_,k){if(g<=E)return g;var C=1-Math.exp(-_*k);return X.lerp(g,E,C)}}]),e}()).prototype,"enable",[pE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pR=st(pA.prototype,"limit",[p_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),pI=st(pA.prototype,"dampen",[pk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),pC=pA))||pC);_._RF.pop(),_._RF.push({},"442c2KaGHdNip4TBoeKOOoY","RendererModule",void 0);var pq,pW,pj,pX,pY,pJ,pQ,pZ,p$,p0,p1,p2,p4,p3,p5=k.ccclass,p6=k.property,p8=(pN=p5("RendererModule"),pD=p6(ez),pM=p6(er),pN((pz=st((pU=Ue(function e(){Fe(this,e),rt(this,"material",pz,this),rt(this,"spriteFrame",px,this)})).prototype,"material",[pD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),px=st(pU.prototype,"spriteFrame",[pM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pF=pU))||pF);_._RF.pop(),_._RF.push({},"c6cfbhYVctHt53aUXC4oSWy","RotationOvertimeModule",void 0);var p9,p7,de,dt,dn,di,da,dr,ds,dl,du,dc,dh,dp,dd,df,dy,dv,dg,dm,db,dw,dS,dE=k.ccclass,d_=k.property,dk=pm,dC=(pq=dE("RotationOvertimeModule"),pW=d_({type:J}),pj=d_(J),pX=d_({type:pe}),pY=d_({type:pe,visible:function(){return this.separateAxes}}),pJ=d_({type:pe,visible:function(){return this.separateAxes}}),pQ=d_({type:pe}),pq((p0=st((p$=function(){function e(){Fe(this,e),rt(this,"enable",p0,this),rt(this,"separateAxes",p1,this),rt(this,"x",p2,this),rt(this,"y",p4,this),rt(this,"z",p3,this)}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=g.randomSeed+dk,C=of(this.z)?eT(k):0,A=this.z.evaluate(_,C)*E,T=0,R=0;if(this.separateAxes){var I=of(this.x)?eT(k):0,L=of(this.y)?eT(k):0;T=this.x.evaluate(_,I)*E,R=this.y.evaluate(_,L)*E}g.node.eulerAngles=new em(g.node.eulerAngles.x+T,g.node.eulerAngles.y+R,g.node.eulerAngles.z+A)}}}]),e}()).prototype,"enable",[pW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p1=st(p$.prototype,"separateAxes",[pj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),p2=st(p$.prototype,"x",[pX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),p4=st(p$.prototype,"y",[pY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),p3=st(p$.prototype,"z",[pJ,pQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),pZ=p$))||pZ);_._RF.pop(),_._RF.push({},"f63cd4ScDJFPrnTLNT4+QKu","ShapeModule",void 0);var dA,dT,dR,dI,dL,dP,dO,dB=k.ccclass,dN=k.property,dD=es({Circle:0,Rectangle:1}),dM=es({Base:0,Edge:1}),Wv=function(){return this.shape===dD.Circle},jv=function(){return this.shape===dD.Rectangle},dF=[0,0],dU=(p9=dB("ShapeModule"),p7=dN({type:es(dD)}),de=dN({type:es(dM),visible:jv}),dt=dN({}),dn=dN({}),di=dN({}),da=dN({range:[0,360],visible:Wv}),dr=dN({range:[-360,360],visible:Wv}),ds=dN({min:0,visible:Wv}),dl=dN({range:[0,1],step:.01,visible:Wv}),du=dN({visible:jv}),p9((dp=st((dh=function(){function e(){Fe(this,e),rt(this,"shape",dp,this),rt(this,"emitFrom",dd,this),rt(this,"position",df,this),rt(this,"rotation",dy,this),rt(this,"scale",dv,this),rt(this,"arc",dg,this),rt(this,"angle",dm,this),rt(this,"radius",db,this),rt(this,"radiusThickness",dw,this),rt(this,"rectangleThickness",dS,this)}return Ue(e,[{key:"emit",value:function(g){switch(this.shape){case dD.Circle:this.circleEmit(this.radius,this.radiusThickness,ex(this.generateArcAngle()),g);break;case dD.Rectangle:this.rectangleEmit(this.emitFrom,this.rectangleThickness,g)}}},{key:"circleEmit",value:function(g,E,_,k){var C=k.node.position;af(C,g*(1-E),g,_+ex(this.angle)),k.velocity=C.clone().normalize()}},{key:"rectangleEmit",value:function(g,E,_){var k,C,A,T=_.node.position;switch(g){case dM.Base:C=T,A=E,eS.set(C,eR(-A.x,A.x),eR(-A.y,A.y));break;case dM.Edge:dF[0]=eR(-1,1),dF[1]=(0===(k=eR(-1,1))&&k++,eF.sign(k)),function(g){for(var E=0;E<g.length;E++){var _=E+eC(0,g.length-E),k=g[_];g[_]=g[E],g[E]=k}}(dF),this.applyRectThickness(dF,E),eS.set(T,dF[0],dF[1])}_.velocity=T.clone().normalize()}},{key:"generateArcAngle",value:function(){return eR(0,this.arc)}},{key:"applyRectThickness",value:function(g,E){E.x>0&&(g[0]*=E.x),E.y>0&&(g[1]*=E.y)}},{key:"gizmo",value:function(g){switch(g.strokeColor.fromHEX("#46C4FFB0"),g.fillColor.fromHEX("#46C4FF77"),g.lineWidth=8,this.shape){case dD.Circle:this.gizmoCircle(g);break;case dD.Rectangle:this.gizmoRectangle(g)}}},{key:"gizmoCircle",value:function(g){g.clear();var E=this.angle,_=this.angle+this.arc;if(this.createArcPath(g,this.radius,E,_),this.createArcPath(g,this.radius*(1-this.radiusThickness),E,_),this.arc<360&&this.radius>0){var k=this.radius*Math.cos(ex(this.angle)),C=this.radius*Math.sin(ex(this.angle)),A=this.radius*Math.cos(ex(this.arc+this.angle)),T=this.radius*Math.sin(ex(this.arc+this.angle));g.moveTo(k,C),g.lineTo(0,0),g.moveTo(A,T),g.lineTo(0,0)}g.stroke()}},{key:"gizmoRectangle",value:function(g){g.clear();var E=this.rectangleThickness.x,_=this.rectangleThickness.y;g.moveTo(E,_),g.lineTo(-E,_),g.lineTo(-E,-_),g.lineTo(E,-_),g.close(),g.stroke()}},{key:"createArcPath",value:function(g,E,_,k){if(!(E<=0))for(var C=(k-_)/48,A=0;A<=48;A++){var T=_+A*C,R=E*Math.cos(ex(T)),I=E*Math.sin(ex(T));0===A?g.moveTo(R,I):g.lineTo(R,I)}}}]),e}()).prototype,"shape",[p7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dD.Circle}}),dd=st(dh.prototype,"emitFrom",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dM.Base}}),df=st(dh.prototype,"position",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(0,0,0)}}),dy=st(dh.prototype,"rotation",[dn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(0,0,0)}}),dv=st(dh.prototype,"scale",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(1,1,1)}}),dg=st(dh.prototype,"arc",[da],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 360}}),dm=st(dh.prototype,"angle",[dr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),db=st(dh.prototype,"radius",[ds],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),dw=st(dh.prototype,"radiusThickness",[dl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),dS=st(dh.prototype,"rectangleThickness",[du],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(20,50)}}),dc=dh))||dc);_._RF.pop(),_._RF.push({},"1b7c1WztGdLzKO8gh4ulm2c","SizeOvertimeModule",void 0);var dz,dx,dG,dV,dK,dH,dq,dW,dj,dX,dY,dJ,dQ,dZ=k.ccclass,d$=k.property,d0=py,d1=(dA=dZ("SizeOvertimeModule"),dT=d$({type:J}),dR=d$({type:pe}),dA((dP=st((dL=function(){function e(){Fe(this,e),rt(this,"enable",dP,this),rt(this,"size",dO,this),this.size.constant=1}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=1-g.remainingLifetime/g.startLifetime,_=g.randomSeed+d0,k=of(this.size)?eT(_):0,C=this.size.evaluate(E,k);g.node.scale=new em(C*g.startSize.x,C*g.startSize.y,1)}}}]),e}()).prototype,"enable",[dT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dO=st(dL.prototype,"size",[dR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),dI=dL))||dI);_._RF.pop(),_._RF.push({},"530341yf3ZOmaqdU+AYM0/U","SpriteAnimationModule",void 0);var d2,d4,d3,d5,d6,d8,d9,d7,fe,ft=k.ccclass,fn=k.property,fi=pv,fa=(dz=ft("SpriteAnimationModule"),dx=fn({type:J}),dG=fn({type:er}),dV=fn({type:pe}),dK=fn({type:pe}),dH=fn({type:V}),dz((dj=st((dW=function(){function e(){Fe(this,e),rt(this,"enable",dj,this),rt(this,"frames",dX,this),rt(this,"frameOverTime",dY,this),rt(this,"startFrame",dJ,this),rt(this,"cycleCount",dQ,this),this.frameOverTime.constant=0,this.startFrame.constant=0}return Ue(e,[{key:"update",value:function(g){if(this.enable){var E=1-g.remainingLifetime/g.startLifetime,_=of(this.startFrame)?eT(g.randomSeed+fi):0,k=of(this.frameOverTime)?eT(g.randomSeed+fi):0,C=this.startFrame.evaluate(E,_),A=eP(this.cycleCount*(this.frameOverTime.evaluate(E,k)+C),this.frames.length);g.sprite.spriteFrame=this.frames[Math.floor(A)]}}}]),e}()).prototype,"enable",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dX=st(dW.prototype,"frames",[dG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dY=st(dW.prototype,"frameOverTime",[dV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),dJ=st(dW.prototype,"startFrame",[dK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),dQ=st(dW.prototype,"cycleCount",[dH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dq=dW))||dq);_._RF.pop(),_._RF.push({},"f6ad5Yz6wpE2ZzModn16CYQ","VelocityOvertimeModule",void 0);var fr,fo,fs,fl,fu,fc,fh,fp,ff,fy,fv,fg,fm,fb,fw,fS,fE,f_,fk,fC,fA,fT,fR,fI,fL,fP,fO,fB,fN,fD,fM,fF,fU,fz,fx,fG,fV,fK,fH,fq,fW,fj,fX,fY,fJ,fQ,fZ,f$,f0,f1,f2,f4,f3=k.ccclass,f5=k.property,f6=(d2=f3("VelocityOvertimeModule"),d4=f5({type:J}),d3=f5({type:pe}),d5=f5({type:pe}),d2((d9=st((d8=function(){function e(){Fe(this,e),rt(this,"enable",d9,this),rt(this,"x",d7,this),rt(this,"y",fe,this),this._temp_v3=new em,this.x.constant=0,this.y.constant=0}return Ue(e,[{key:"update",value:function(g,E){if(this.enable){var _=1-g.remainingLifetime/g.startLifetime,k=of(this.x)?eT(g.randomSeed+pb):0,C=of(this.y)?eT(g.randomSeed+pw):0,A=em.set(this._temp_v3,this.x.evaluate(_,k),this.y.evaluate(_,C),0);em.add(g.velocity,g.velocity,A.multiplyScalar(E))}}}]),e}()).prototype,"enable",[d4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d7=st(d8.prototype,"x",[d3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),fe=st(d8.prototype,"y",[d5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),d6=d8))||d6);_._RF.pop(),_._RF.push({},"10bc3IfFqBLtpSgVri/NVeX","ParticleSystem",void 0);var f8,f9,f7,ye,yt,yn,yi,ya,yr,yo=k.ccclass,ys=k.property,yl=k.executeInEditMode,yu=k.disallowMultiple,yc=(fr=yo("ParticleSystem"),fo=yl(!0),fs=yu(!0),fl=ys({}),fu=ys(J),fc=ys(K),fh=ys(J),fp=ys({type:pe}),ff=ys({type:pe}),fy=ys(po),fv=ys(J),fg=ys({type:pe,formerlySerializedAs:"startSize"}),fm=ys({type:pe,visible:function(){return this.startSize2D}}),fb=ys({type:pe}),fw=ys(J),fS=ys({type:pe,formerlySerializedAs:"startRotation"}),fE=ys({type:pe}),f_=ys({type:pe}),fk=ys({type:dU}),fC=ys({type:f6}),fA=ys({type:d1}),fT=ys({type:dC}),fR=ys({type:pB}),fI=ys({type:fa}),fL=ys({type:pH}),fP=ys(h_),fO=ys({type:p8}),fr(fB=fo(fB=fs((st((fN=function(g){ze(n,g);var E=Xe(n);function n(){var g;return Fe(this,n),(g=E.call(this))._preview=!1,rt(g,"playOnAwake",fD,Ke(g)),rt(g,"duration",fM,Ke(g)),rt(g,"loop",fF,Ke(g)),rt(g,"startDelay",fU,Ke(g)),rt(g,"startLifetime",fz,Ke(g)),rt(g,"startColor",fx,Ke(g)),rt(g,"startSize2D",fG,Ke(g)),rt(g,"startSizeX",fV,Ke(g)),rt(g,"startSizeY",fK,Ke(g)),rt(g,"startSpeed",fH,Ke(g)),rt(g,"startRotation3D",fq,Ke(g)),rt(g,"startRotation",fW,Ke(g)),rt(g,"gravityModifier",fj,Ke(g)),rt(g,"rateOverTime",fX,Ke(g)),rt(g,"shapeModule",fY,Ke(g)),rt(g,"velocityOvertimeModule",fJ,Ke(g)),rt(g,"sizeOvertimeModule",fQ,Ke(g)),rt(g,"rotationOvertimeModule",fZ,Ke(g)),rt(g,"colorOvertimeModule",f$,Ke(g)),rt(g,"spriteAnimationModule",f0,Ke(g)),rt(g,"limitVelocityOvertimeModule",f1,Ke(g)),rt(g,"bursts",f2,Ke(g)),rt(g,"rendererModule",f4,Ke(g)),g.particles=[],g.time=0,g.emitRateTimeCounter=0,g.isPlaying=!1,g.isStopped=!0,g.isEmitting=!1,g.needToRestart=!1,g.startLifetime.constant=5,g.startSizeX.constant=1,g.startSpeed.constant=5,g.rateOverTime.constant=10,g}return Ue(n,[{key:"preview",get:function(){return this._preview},set:function(g){this._preview=g,this.graphics&&this.graphics.destroy()}},{key:"onEnable",value:function(){}},{key:"onLoad",value:function(){this.preview=null!==this.getComponent(ef),this.node.removeAllChildren()}},{key:"start",value:function(){this.node.position=new em(this.node.position.x,this.node.position.y,100),this.playOnAwake?this.play():this.preview}},{key:"update",value:function(g){this.isPlaying&&(this.time+=g,this.emitting(g))}},{key:"play",value:function(){this.needToRestart&&(this.needToRestart=!1),this.isStopped&&(this.isStopped=!1),this.time=0,this.isPlaying=!0,this.isEmitting=!0}},{key:"stop",value:function(){this.isPlaying||(this.isPlaying=!1),this.isEmitting||(this.isEmitting=!1),this.isStopped=!0}},{key:"emitting",value:function(g){var E=this,_=this.startDelay.evaluate(0,1);if(this.time>_&&this.time>this.duration+_&&(this.loop||(this.isEmitting=!1)),this.isEmitting){if(this.emitRateTimeCounter+=this.rateOverTime.evaluate(this.time/this.duration,1)*g,this.emitRateTimeCounter>1){var k=Math.floor(this.emitRateTimeCounter);this.emitRateTimeCounter-=k,this.emit(k,g)}var C,A=at(this.bursts);try{for(A.s();!(C=A.n()).done;)C.value.update(this,g)}catch(g){A.e(g)}finally{A.f()}}var T=this.gravityModifier.evaluate(this.time/this.duration,1);this.particles.forEach(function(_,k){_.node.active&&(E.spriteAnimationModule.update(_),E.sizeOvertimeModule.update(_),E.rotationOvertimeModule.update(_,g),E.colorOvertimeModule.update(_),E.velocityOvertimeModule.update(_,g),E.applyGravityModifier(_,T),E.limitVelocityOvertimeModule.update(_,g),_.node.position.add(_.velocity.clone().multiplyScalar(g)),_.remainingLifetime-=g,_.remainingLifetime<=0&&(_.node.active=!1))})}},{key:"emit",value:function(g,E){if(null!==this.rendererModule.spriteFrame)for(var _=this.time%this.duration/this.duration,k=0;k<g;k++){var C=this.getFreeParticle();C.init(this),C.reset(),this.shapeModule.emit(C);var A=this.startSpeed.evaluate(_,this.rand());C.velocity=C.velocity.clone().multiplyScalar(A);var T=this.startSizeX.evaluate(_,this.rand()),R=this.startSize2D?new em(T,this.startSizeY.evaluate(_,this.rand()),1):new em(T,T,1);C.startSize=R.clone(),C.node.scale=R.clone();var I=this.startRotation.evaluate(_,this.rand());C.node.eulerAngles=new em(0,0,I),C.startColor=this.startColor.evaluate(_,this.rand()).clone(),C.sprite.color=C.startColor.clone(),C.startLifetime=this.startLifetime.evaluate(_,this.rand())+E,C.remainingLifetime=C.startLifetime,C.randomSeed=eC(0,233280)}}},{key:"applyGravityModifier",value:function(g,E){g.velocity.add(new em(0,-9.8*E,0))}},{key:"rand",value:function(){return eT(eC(0,eF.INT_MAX))}},{key:"getFreeParticle",value:function(){var g=this.particles.find(function(g){return!g.node.active});return g||(g=this.createParticle()),g.node.active=!0,g}},{key:"createParticle",value:function(){var g=new C,E=I(g),_=E.addComponent(hK),k=E.addComponent(eo);return this.particles.push(_),k.spriteFrame=this.rendererModule.spriteFrame,k.customMaterial=this.rendererModule.material,this.node.addChild(E),_}}]),n}(D)).prototype,"preview",[fl],Object.getOwnPropertyDescriptor(fN.prototype,"preview"),fN.prototype),fD=st(fN.prototype,"playOnAwake",[fu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),fM=st(fN.prototype,"duration",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),fF=st(fN.prototype,"loop",[fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fU=st(fN.prototype,"startDelay",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),fz=st(fN.prototype,"startLifetime",[ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),fx=st(fN.prototype,"startColor",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new po}}),fG=st(fN.prototype,"startSize2D",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fV=st(fN.prototype,"startSizeX",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),fK=st(fN.prototype,"startSizeY",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),fH=st(fN.prototype,"startSpeed",[fb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),fq=st(fN.prototype,"startRotation3D",[fw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fW=st(fN.prototype,"startRotation",[fS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),fj=st(fN.prototype,"gravityModifier",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),fX=st(fN.prototype,"rateOverTime",[f_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pe}}),fY=st(fN.prototype,"shapeModule",[fk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dU}}),fJ=st(fN.prototype,"velocityOvertimeModule",[fC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new f6}}),fQ=st(fN.prototype,"sizeOvertimeModule",[fA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new d1}}),fZ=st(fN.prototype,"rotationOvertimeModule",[fT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dC}}),f$=st(fN.prototype,"colorOvertimeModule",[fR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pB}}),f0=st(fN.prototype,"spriteAnimationModule",[fI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new fa}}),f1=st(fN.prototype,"limitVelocityOvertimeModule",[fL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pH}}),f2=st(fN.prototype,"bursts",[ys,fP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f4=st(fN.prototype,"rendererModule",[fO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new p8}}),fB=fN))||fB)||fB)||fB);_._RF.pop(),_._RF.push({},"a7ff8uVnP1G3ppM9F/A5DYq","Cloud",void 0);var yh,yp,yd,yf,yy,yv,yg,ym,yb,yw,yS,yE,y_,yk,yC,yA,yT,yR=k.ccclass,yI=k.property,yL=(f8=yR("Cloud"),f9=yI({type:C}),f7=yI({type:C}),ye=yI({type:G}),f8((yi=st((yn=function(g){ze(l,g);var E,_,k,C,A,T=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"cloudSprites",yi,Ke(g)),rt(g,"lightnings",ya,Ke(g)),rt(g,"animation",yr,Ke(g)),g}return Ue(l,[{key:"playInitAnimation",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.moveToScreenCenter()];case 1:g.sent();return[2]}})}),function(){return A.apply(this,arguments)})},{key:"playLightningAnimation",value:(C=Be(function(g,E){var _,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=this.lightnings[E],k=g.subtract(_.worldPosition),C=Math.atan2(k.y,k.x)*(180/Math.PI)+180,A=k.length();_.getComponent(R).width=A,_.angle=C,_.active=!0;return[4,tZ.waitTweenAsync(.2)];case 1:T.sent(),_.active=!1;return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"playScaleTween",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.cloudSprites.map(function(g){var E=x(g).to(.1,{scale:new em(1.2,1.2)},{easing:"quadOut"}).to(.1,{scale:new em(1,1)},{easing:"quadOut"});return tZ.runTweenAsync(E)});return[4,Promise.all(g)];case 1:E.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadAnimation",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(null!==this.animation.defaultClip)return[3,2];return[4,ie.loadAnimClipAsync(nM.CLOUD_IDLE_ANIM)];case 1:g=E.sent();g&&this.animation&&(this.animation.defaultClip=g);E.label=2;case 2:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"moveToScreenCenter",value:(E=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=$("Canvas").getComponent(R),E=g.width,_=g.height,k=0,C=0;switch(Math.floor(4*Math.random())){case 0:k=Math.random()*E-E/2,C=_/2+300;break;case 1:k=Math.random()*E-E/2,C=-_/2-300;break;case 2:k=-E/2-300,C=Math.random()*_-_/2;break;case 3:k=E/2+300,C=Math.random()*_-_/2}this.node.position=new em(k,C);A=x(this.node).to(.8,{position:new em(0,300)},{easing:"quadOut"});return[4,tZ.runTweenAsync(A)];case 1:T.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),l}(D)).prototype,"cloudSprites",[f9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ya=st(yn.prototype,"lightnings",[f7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yr=st(yn.prototype,"animation",[ye],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yt=yn))||yt);_._RF.pop(),_._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var yP,yO,yB,yN,yD,yM=k.ccclass,yF=k.property,yU=k.disallowMultiple,yz=(yh=yM("ShiningStar"),yp=yF(eo),yd=yF({serializable:!0,visible:!1}),yf=yF({type:K,displayName:"Scale up duration",min:.001}),yy=yF({serializable:!0,visible:!1}),yv=yF({type:K,displayName:"Bounce and Fall duration",min:.001}),yg=yF({serializable:!0,visible:!1}),ym=yF({type:K,displayName:"Start scale"}),yb=yF({serializable:!0,visible:!1}),yw=yF({type:K,displayName:"End scale"}),yh(yS=yU((y_=st((yE=function(g){ze(u,g);var E,_,k,C,A,T,R,I=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=I.call.apply(I,[this].concat(_)),"shine",y_,Ke(g)),rt(g,"twScaleUpDuration",yk,Ke(g)),rt(g,"twBounceAndFallDuration",yC,Ke(g)),rt(g,"twStartScale",yA,Ke(g)),rt(g,"twEndScale",yT,Ke(g)),g.isBeingAnimated=!1,g}return Ue(u,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(g){this.twScaleUpDuration=g}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(g){this.twBounceAndFallDuration=g}},{key:"startScale",get:function(){return this.twStartScale},set:function(g){this.twStartScale=g}},{key:"endScale",get:function(){return this.twEndScale},set:function(g){this.twEndScale=g}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(eu),this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(R=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0;return[4,this.animateAppear()];case 1:g.sent();return[4,this.animateDisappear()];case 2:g.sent(),this.isBeingAnimated=!1;return[2]}})}),function(){return R.apply(this,arguments)})},{key:"animateAppear",value:(T=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.shineOpacity.opacity=255;return[4,Promise.all([this.animateFadeIn(),this.animateScaleUp()])];case 1:g.sent();return[2]}})}),function(){return T.apply(this,arguments)})},{key:"animateDisappear",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Promise.all([this.animateBounceAndFall(),this.animateScaleDown()])];case 1:g.sent(),this.node.setScale(0,0),this.uiOpacity.opacity=0;return[2]}})}),function(){return A.apply(this,arguments)})},{key:"animateBounceAndFall",value:(C=Be(function(){var g,E,_,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:g=this.node.position.x,E=this.node.position.y,_=[60,120],k=(Math.random()*(_[1]-_[0])+_[0])*(Math.PI/180),C=g+200*Math.cos(k),A=E+200*Math.sin(k),T=E-500,R=tZ.runTweenAsync(x(this.node).to(.2*this.twBounceAndFallDuration,{position:new em(C,A,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new em(C,T,this.node.position.z)},{easing:"cubicIn"})),I=[0,360],L=tZ.runTweenAsync(x(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new em(0,0,Math.random()*(I[1]-I[0])*(C>g?-1:1))},{easing:"sineOut"}));return[4,Promise.all([R,L])];case 1:P.sent(),this.node.eulerAngles=new em(0,0,0);return[2]}})}),function(){return C.apply(this,arguments)})},{key:"animateFadeIn",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=Math.max(this.scaleUpDuration/4,.01);return[4,tZ.runTweenAsync(x(this.uiOpacity).to(g,{opacity:255}))];case 1:E.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"animateScaleUp",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.node.setScale(this.startScale,this.startScale);g=new em(this.endScale,this.endScale,1);return[4,tZ.runTweenAsync(x(this.node).to(this.scaleUpDuration,{scale:g},{easing:"cubicOut"}))];case 1:E.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"animateScaleDown",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=new em(0,0,1);return[4,tZ.runTweenAsync(x(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:g},{easing:"cubicIn"}))];case 1:E.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}}]),u}(D)).prototype,"shine",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yk=st(yE.prototype,"twScaleUpDuration",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(yE.prototype,"scaleUpDuration",[yf],Object.getOwnPropertyDescriptor(yE.prototype,"scaleUpDuration"),yE.prototype),yC=st(yE.prototype,"twBounceAndFallDuration",[yy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(yE.prototype,"bounceAndFallDuration",[yv],Object.getOwnPropertyDescriptor(yE.prototype,"bounceAndFallDuration"),yE.prototype),yA=st(yE.prototype,"twStartScale",[yg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),st(yE.prototype,"startScale",[ym],Object.getOwnPropertyDescriptor(yE.prototype,"startScale"),yE.prototype),yT=st(yE.prototype,"twEndScale",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),st(yE.prototype,"endScale",[yw],Object.getOwnPropertyDescriptor(yE.prototype,"endScale"),yE.prototype),yS=yE))||yS)||yS);_._RF.pop(),_._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var yx,yG,yV,yK,yH,yq,yW,yj,yX,yY,yJ,yQ,yZ,y$,y0,y1,y2,y4,y3,y5,y6,y8=k.ccclass,y9=k.property,y7=k.disallowMultiple,ve=GameCore.Utils.Array,vt=(yP=y8("StarParticles"),yO=y9({type:[yz],displayName:"Prebuilt Shining stars"}),yP(yB=y7((yD=st((yN=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"shiningStars",yD,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=this.getFirstAvailableShiningStar();if(void 0===E)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");_=et(g,2),k=_[0],C=_[1],A=new em(k,C,this.node.worldPosition.z);E.node.worldPosition=A;return[4,E.playAnimation()];case 1:T.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return ve.search(this.shiningStars,function(g){return g.isAvailable})}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}}]),i}(D)).prototype,"shiningStars",[yO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yB=yN))||yB)||yB);_._RF.pop(),_._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var vn=k.ccclass,vi=k.property,va=(yx=vn("EffectManager"),yG=vi({group:"Thunder Effect",type:yL}),yV=vi({group:"Mask Effect",type:ad}),yK=vi({group:"Mask Effect",type:C}),yH=vi({group:"Tornado Effect",type:C}),yq=vi({group:"Clear Particle Effect",type:C,displayName:"Particle holder node"}),yW=vi({group:"Clear Particle Effect",type:yc,displayName:"Emitter 1"}),yj=vi({group:"Clear Particle Effect",type:yc,displayName:"Emitter 2"}),yX=vi({group:"Star Particles Effect",type:vt}),yY=vi({group:"Confetti Effect",type:yc}),yx((yZ=st((yQ=function(g){ze(p,g);var E,_,k,C,A,T,R,I,L,P,O,B=Xe(p);function p(){var g;Fe(this,p);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=B.call.apply(B,[this].concat(_)),"cloud",yZ,Ke(g)),rt(g,"backgroundMask",y$,Ke(g)),rt(g,"masks",y0,Ke(g)),rt(g,"tornado",y1,Ke(g)),g.bombExplosion=null,g.bombExplosionPool=null,g.defuseExplosion=null,g.defuseExplosionPool=null,rt(g,"clearParticleHolder",y2,Ke(g)),rt(g,"clearParticle1",y4,Ke(g)),rt(g,"clearParticle2",y3,Ke(g)),rt(g,"starParticle",y5,Ke(g)),rt(g,"confetti",y6,Ke(g)),g.maskTargets=[],g}return Ue(p,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"update",value:function(){var g=this;this.maskTargets.length>0&&this.maskTargets.forEach(function(E,_){E.isHidden()||(g.masks[_].worldPosition=E.node.worldPosition.clone())})}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(a2.GRID_RESIZE,this.handleBoardResize,this)}},{key:"handleBoardResize",value:function(g){this.clearParticleHolder.setScale(g,g)}},{key:"playClearEffectAt",value:function(g){this.clearParticle1.node.setWorldPosition(new em(g[0].x,g[0].y,1)),this.clearParticle2.node.setWorldPosition(new em(g[1].x,g[1].y,1)),this.clearParticle1.play(),this.clearParticle2.play()}},{key:"playStarEffectAt",value:function(g){this.starParticle.fireShiningStarAt(g)}},{key:"playConfettiEffect",value:function(){var g,E=at(this.confetti);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}}},{key:"playTornadoAnimation",value:(O=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=null===(g=this.tornado.getChildByName("Sprite"))||void 0===g?void 0:g.getComponent(G);if(!(null!==(null==E?void 0:E.defaultClip)))return[3,2];this.tornado.active=!0;_=x(this.tornado);_.set({scale:new em(0,0,0)}),_.delay(.5),_.to(.5,{scale:new em(1,1,1)},{easing:"backOut"}),_.delay(.6),_.to(.3,{scale:new em(0,0,0)},{easing:"quadIn"}),_.set({active:!1}),ie.setBlockInput(!0);return[4,tZ.runTweenAsync(_)];case 1:k.sent(),ie.setBlockInput(!1);return[3,3];case 2:console.warn("EffectManager: Tornado animation is not loaded when animation play request was made.");k.label=3;case 3:return[2]}})}),function(){return O.apply(this,arguments)})},{key:"playThunderAnimation",value:(P=Be(function(g,E){var _,k,C,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:this.resetMasks();_=et(g,2),k=et(_[0],2),C=k[0],A=k[1],T=et(_[1],2),R=T[0],I=T[1];this.setMaskProperties(0,C.node.worldPosition,C.node.worldScale),this.setMaskProperties(1,A.node.worldPosition,A.node.worldScale),this.setMaskProperties(2,R.node.worldPosition,R.node.worldScale),this.setMaskProperties(3,I.node.worldPosition,I.node.worldScale),this.maskTargets=[C,A,R,I];return[4,this.setBackgroundMaskActive(!0)];case 1:L.sent(),this.cloud.node.active=!0;return[4,this.cloud.playInitAnimation()];case 2:L.sent();return[4,tZ.waitTweenAsync(.2)];case 3:L.sent();return[4,this.performCloudEffectToTiles(C,A,E)];case 4:L.sent();return[4,this.performCloudEffectToTiles(R,I,E)];case 5:L.sent(),this.cloud.node.active=!1;return[4,this.setBackgroundMaskActive(!1)];case 6:L.sent(),this.maskTargets=[];return[2]}})}),function(g,E){return P.apply(this,arguments)})},{key:"performCloudEffectToTiles",value:(L=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:this.shakeGame(),null===(k=$("Vibrate"))||void 0===k||null===(k=k.getComponent(sP))||void 0===k||k.vibrate(500),i8.playSound(ih.THUNDERBOLT),_.clear([[g,E]],"break");return[4,Promise.all([this.cloud.playLightningAnimation(g.node.worldPosition.clone(),0),this.cloud.playLightningAnimation(E.node.worldPosition.clone(),1),this.cloud.playScaleTween()])];case 1:C.sent(),this.node.scene.emit(a2.ADD_COMBO),this.node.scene.emit(a2.ADD_SCORE);return[2]}})}),function(g,E,_){return L.apply(this,arguments)})},{key:"createDefuseExplosionAt",value:(I=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.loadDefuseExplosionPrefab()];case 1:k.sent(),this.defuseExplosionPool||(this.defuseExplosionPool=new cM(this.createDefuseExplosion.bind(this),1,vr.getBombDefuseExplosion,vr.returnBombDefuseExplosion,vr.destroyBombDefuseExplosion));E=this.defuseExplosionPool.alloc();E.setWorldPosition(g);_=E.getComponent(G);return[4,tZ.runAnimationAsync(_)];case 2:if(k.sent(),!this.defuseExplosionPool)throw new Error("EffectManager: defuseExplosionPool is null");this.defuseExplosionPool.free(E);return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"createBombExplosionAt",value:(R=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.loadBombExplosionPrefab()];case 1:if(k.sent(),this.bombExplosionPool||(this.bombExplosionPool=new cM(this.createBombExplosion.bind(this),1,vo.getBombExplosion,vo.returnBombExplosion,vo.destroyBombExplosion)),!this.bombExplosionPool)return[3,3];E=this.bombExplosionPool.alloc();E.setWorldPosition(g);_=E.getComponent(G);return[4,tZ.runAnimationAsync(_)];case 2:k.sent(),this.bombExplosionPool&&this.bombExplosionPool.free(E);k.label=3;case 3:return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(T=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:g&&(this.backgroundMask.node.active=!0);return[4,this.backgroundMask.changeStateFade(g,.25)];case 1:E.sent(),g||(this.backgroundMask.node.active=!1);return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"resetMasks",value:function(){var g,E=at(this.masks);try{for(E.s();!(g=E.n()).done;)g.value.worldPosition=new em(-9999,-9999,0)}catch(g){E.e(g)}finally{E.f()}}},{key:"setMaskProperties",value:function(g,E,_){_&&(this.masks[g].worldScale=_),this.masks[g].worldPosition=E}},{key:"createDefuseExplosion",value:function(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return vr.createDefuseExplosion(this.defuseExplosion,this.node)}},{key:"createBombExplosion",value:function(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return vo.createBombExplosion(this.bombExplosion,this.node)}},{key:"loadBombExplosionPrefab",value:(A=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.bombExplosion)return[2,Promise.resolve()];return[4,ie.loadPrefabAsync(nM.BOMB_EXPLODE_PREFAB)];case 1:g=E.sent();return[2,(g&&(this.bombExplosion=g),Promise.resolve())]}})}),function(){return A.apply(this,arguments)})},{key:"loadDefuseExplosionPrefab",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(this.defuseExplosion)return[2,Promise.resolve()];return[4,ie.loadPrefabAsync(nM.BOMB_DEFUSE_PREFAB)];case 1:g=E.sent();return[2,(g&&(this.defuseExplosion=g),Promise.resolve())]}})}),function(){return C.apply(this,arguments)})},{key:"loadThunderAnimation",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.cloud.loadAnimation()];case 1:g.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"loadTornadoAnimation",value:(_=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=null===(g=this.tornado.getChildByName("Sprite"))||void 0===g?void 0:g.getComponent(G);if(null!==(null==E?void 0:E.defaultClip))return[2,Promise.resolve()];return[4,ie.loadAnimClipAsync(nM.TORNADO_IDLE_ANIM)];case 1:_=k.sent();return[2,(_&&(E.defaultClip=_),Promise.resolve())]}})}),function(){return _.apply(this,arguments)})},{key:"shakeGame",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.node.position.clone(),E=x(this.node).to(.05,{position:g.clone().add3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g.clone().subtract3f(eR(5,10),eR(5,10),0)}).to(.05,{position:g});return[4,tZ.runTweenAsync(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),p}(D)).prototype,"cloud",[yG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y$=st(yQ.prototype,"backgroundMask",[yV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y0=st(yQ.prototype,"masks",[yK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),y1=st(yQ.prototype,"tornado",[yH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y2=st(yQ.prototype,"clearParticleHolder",[yq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y4=st(yQ.prototype,"clearParticle1",[yW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y3=st(yQ.prototype,"clearParticle2",[yj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y5=st(yQ.prototype,"starParticle",[yX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y6=st(yQ.prototype,"confetti",[yY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yJ=yQ))||yJ),vr=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"createDefuseExplosion",value:function(g,E){var _=I(g);return E.addChild(_),_.active=!1,_}},{key:"destroyBombDefuseExplosion",value:function(g){g.destroy()}},{key:"getBombDefuseExplosion",value:function(g){g.active=!0}},{key:"returnBombDefuseExplosion",value:function(g){g.active=!1}}]),e}(),vo=function(){function e(){Fe(this,e)}return Ue(e,null,[{key:"createBombExplosion",value:function(g,E){var _=I(g);return E.addChild(_),_.active=!1,_}},{key:"destroyBombExplosion",value:function(g){g.destroy()}},{key:"getBombExplosion",value:function(g){g.active=!0}},{key:"returnBombExplosion",value:function(g){g.active=!1}}]),e}();_._RF.pop(),_._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var vs="newbie",vl="timer",vu="combo",vc="hint-item",vh="thunder-item",vp="storm-item",vf="pliers-item";_._RF.pop(),_._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var vy=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(a2.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(a2.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.on(a2.GRID_RESIZE,this.handleViewResized,this),this.manager.guideSkipButton.active=!0,this.showStep(this.currentStep),this.manager.node.scene.emit(a2.HIDE_UI)}},{key:"showNextStep",value:function(){this.currentStep+1<u6.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(E=Be(function(g){var E,_,k,C,A,T,R,I,L,P,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:E=this.gameplay,_=E.board,k=E.effectManager,C=u6[g].startTile,A=u6[g].endTile,T=_.getTileAt(C.x,C.y),R=_.getTileAt(A.x,A.y);if(!(T&&R))return[3,3];I=T.node.worldPosition,L=R.node.worldPosition;k.resetMasks(),k.setMaskProperties(0,I,T.node.worldScale),k.setMaskProperties(1,L,R.node.worldScale),k.setBackgroundMaskActive(!0);P=this.manager,O=P.guideHand,B=P.guideTextBox;O.node.active=!0,O.playHandAnimation(I,L),this.alignGuideTextBox(),this.alignSkipButton();return[4,B.hide()];case 1:N.sent(),B.setText(u6[g].description);return[4,B.show()];case 2:N.sent(),_.setIgnoreInput(!0),T.setIgnoreInput(!1),R.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1);N.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.gameplay,E=g.board,_=g.effectManager,k=u6[this.currentStep].startTile,C=u6[this.currentStep].endTile,A=E.getTileAt(k.x,k.y),T=E.getTileAt(C.x,C.y);if(A&&T){var R=A.node.worldPosition,I=T.node.worldPosition;_.setMaskProperties(0,R,A.node.worldScale),_.setMaskProperties(1,I,T.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}}},{key:"alignGuideTextBox",value:function(){var g=this.gameplay.board,E=this.manager.guideTextBox,_=g.getTileAt(0,0);if(_){var k=g.tilesHolder.getWorldScale(),C=g.getTileSize()[1]*k.y,A=_.node.worldPosition.y-C/2,T=E.widget.bottom+(A-E.widget.bottom)/2;E.node.setWorldPosition(E.node.worldPosition.x,T,0);var R=Math.max(Math.min(223,.85*(A-E.widget.bottom)),10),I=.7261538461538461*k.x;E.uiTransform.setContentSize(628*I,R)}}},{key:"alignSkipButton",value:function(){var g=this.gameplay.board,E=this.manager.guideSkipButton;if(E){var _=E.parent;if(_){var k=g.getTileAt(g.getGridSize()[0]-1,g.getGridSize()[1]-1);if(k){var C=g.tilesHolder.getWorldScale(),A=g.getTileSize()[1]*C.y,T=k.node.worldPosition.clone().add3f(A/2,A/2,0),I=ns.cssSizeToWorldSize(ns.getScreenHeightCss()),L=T.x-_.getComponent(R).width/2,P=Math.min(T.y+100,I-(I-T.y)/2);_.setWorldPosition(L,P,0)}}}}},{key:"close",value:(g=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=this.gameplay,E=g.board,_=g.effectManager;this.manager.node.scene.off(a2.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(a2.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.off(a2.GRID_RESIZE,this.handleViewResized,this),E.setIgnoreInput(!1);k=Promise.all;return[4,this.manager.guideTextBox.hide()];case 1:C=[A.sent()];return[4,_.setBackgroundMaskActive(!1)];case 2:return[4,k.apply(Promise,[C.concat([A.sent()])])];case 3:A.sent(),this.manager.guideHand.node.active=!1,this.manager.completeGuide(vs);return[2]}})}),function(){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var vv=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.clock,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5;return[4,this.gameplay.handleShowUI()];case 1:L.sent(),E.node.active=!0,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.active=!0,_.string="Remove all tiles before\nthe time end",_.node.setWorldPosition(I.x,I.y-T/2-50,0),_.horizontalAlign=eG.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 2:L.sent(),this.manager.node.scene.once(a2.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a2.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.clock,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.setWorldPosition(I.x,I.y-T/2-50,0)}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideInfoText,_=g.guideMasks;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(a2.RESUME_TIME);return[4,_.hide()];case 1:k.sent(),E.node.active=!1,this.manager.completeGuide(vl),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var vg=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.comboContainer,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.node.active=!0,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.active=!0,_.string="Remove tiles continuously\nto increase combo!",_.node.setWorldPosition(I.x-A/2-10,I.y,0),_.horizontalAlign=eG.RIGHT,_.getComponent(R).setAnchorPoint(1,.5);return[4,E.show()];case 1:L.sent(),this.manager.node.scene.once(a2.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a2.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=this.gameplay.uiManager.comboContainer,C=k.getComponent(R).contentSize,A=C.width,T=C.height,I=k.node.worldPosition;A*=1.5,T*=1.5,E.setOtherMaskTransform(I.x,I.y,A,T),_.node.setWorldPosition(I.x-A/2-10,I.y,0)}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideInfoText,_=g.guideMasks;this.manager.node.scene.emit(a2.RESUME_TIME),_.node.off(C.EventType.TOUCH_START,this.close,this);return[4,_.hide()];case 1:k.sent(),E.node.active=!1,this.manager.completeGuide(vu),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var vm=GameCore.Utils.Array,vb=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vm.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.HINT});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to reveal a connectable pair",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=eG.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:L.sent(),this.manager.node.scene.once(a2.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a2.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);L.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vm.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.HINT});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(a2.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vc),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var vw=GameCore.Utils.Array,vS=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vw.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.THUNDER});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to remove 2 pairs",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=eG.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:L.sent(),this.manager.node.scene.once(a2.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a2.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);L.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vw.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.THUNDER});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(a2.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vh),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var vE=GameCore.Utils.Array,v_=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vE.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.STORM});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to rearrange the tiles",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=eG.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:L.sent(),this.manager.node.scene.once(a2.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a2.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);L.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vE.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.STORM});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(a2.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vp),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var vk,vC,vA,vT,vR,vI,vL,vP,vO,vB=GameCore.Utils.Array,vN=function(){function e(g){Fe(this,e),this.manager=g,this.gameplay=g.gameplay}var g,E;return Ue(e,[{key:"setup",value:(E=Be(function(){var g,E,_,k,C,A,T,I;return _ts_generator(this,function(L){switch(L.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vB.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.PLIERS});if(!k)return[3,2];C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.node.active=!0,E.setItemMaskTransform(C.x,C.y,T,I),_.node.active=!0,_.string="Tap to remove bomb",_.node.setPosition(0,0),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0),_.horizontalAlign=eG.CENTER,_.getComponent(R).setAnchorPoint(.5,.5);return[4,E.show()];case 1:L.sent(),this.manager.node.scene.once(a2.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(a2.PAUSE_TIME),Q.on(t3,this.handleViewResized,this),Q.on(t6,this.handleViewResized,this);L.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleViewResized",value:function(){var g=this.manager,E=g.guideMasks,_=g.guideInfoText,k=vB.search(this.gameplay.itemManager.items,function(g){return g.itemType===sN.PLIERS});if(k){var C=k.node.worldPosition,A=k.getComponent(R).contentSize,T=A.width,I=A.height;T+=40,I+=40,E.setItemMaskTransform(C.x,C.y,T,I),_.node.setWorldPosition(_.node.worldPosition.x,C.y+I/2+30,0)}}},{key:"close",value:(g=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.manager,E=g.guideMasks,_=g.guideInfoText;this.manager.node.scene.emit(a2.RESUME_TIME);return[4,E.hide()];case 1:k.sent(),_.node.active=!1,this.manager.completeGuide(vf),this.unlistenEvents();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"unlistenEvents",value:function(){Q.off(t3,this.handleViewResized,this),Q.off(t6,this.handleViewResized,this)}}]),e}();_._RF.pop(),_._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var vD,vM,vF,vU,vz,vx,vG,vV=k.ccclass,vK=k.property,vH=(vk=vV("GuideHand"),vC=vK(C),vA=vK(C),vT=vK(eu),vk((vL=st((vI=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"hand",vL,Ke(g)),rt(g,"circleHighlight",vP,Ke(g)),rt(g,"circleHighlightOpacity",vO,Ke(g)),g}return Ue(n,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(g,E){var _=this;this.handTween&&this.handTween.stop();var k=x(this.hand).to(.8,{worldPosition:E},{easing:"quartOut"}).to(.2,{scale:new em(.9,.9,.9),angle:15}).call(function(){_.playHighlightAnimation()}).to(.2,{scale:em.ONE,angle:0}).to(.8,{worldPosition:g},{easing:"quartOut"}).to(.2,{scale:new em(.9,.9,.9),angle:15}).call(function(){_.playHighlightAnimation()}).to(.2,{scale:em.ONE,angle:0});this.handTween=x(this.hand).repeatForever(k).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),x(this.circleHighlight).to(.6,{scale:new em(1.5,1.5)},{easing:"quadOut"}).start(),x(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(D)).prototype,"hand",[vC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vP=st(vI.prototype,"circleHighlight",[vA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vO=st(vI.prototype,"circleHighlightOpacity",[vT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vR=vI))||vR);_._RF.pop(),_._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var vq,vW,vj,vX,vY,vJ,vQ=k.ccclass,vZ=k.property,v$=(vD=vQ("GameMask"),vM=vZ(R),vF=vZ(eo),vD((vx=st((vz=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"uiTransform",vx,Ke(g)),rt(g,"sprite",vG,Ke(g)),g}return Ue(n,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),n}(D)).prototype,"uiTransform",[vM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vG=st(vz.prototype,"sprite",[vF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vU=vz))||vU);_._RF.pop(),_._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var v0,v1,v2,v4,v3,v5,v6,v8=k.ccclass,v9=k.property,v7=k.executeInEditMode,ge=(vq=v8("AlphaMasks"),vW=v7(!0),vj=v9(v$),vq(vX=vW((vJ=st((vY=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"masks",vJ,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent(R)}},{key:"start",value:function(){this.material=this.getComponent(eo).getMaterialInstance(0)}},{key:"update",value:function(){var g=this,E=this.UITransform,_=E.width,k=E.height;this.masks.forEach(function(E,C){var A=E.uiTransform,T=A.width,R=A.height,I=A.anchorX,L=A.anchorY,P=T*E.node.scale.x,O=R*E.node.scale.y,B=new eS(P/_,O/k),N=new eS(.5+(.5-I)*B.x,.5-(.5-L)*B.y),D=new eS(N.x+(E.node.worldPosition.x-g.node.worldPosition.x)/_,N.y-(E.node.worldPosition.y-g.node.worldPosition.y)/k);g.material.setProperty("mask".concat(C,"Texture"),E.texture),g.material.setProperty("ratio".concat(C),B),g.material.setProperty("center".concat(C),D)})}},{key:"setMaskActive",value:function(g,E){g>=this.masks.length||this.material.setProperty("useMask".concat(g),E?1:0)}}]),n}(D)).prototype,"masks",[vj],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vX=vY))||vX)||vX);_._RF.pop(),_._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var gt,gn,gi,ga,gr,go,gs,gl=k.ccclass,gu=k.property,gc=(v0=gl("GuideMasks"),v1=gu(ad),v2=gu(ge),v0((v5=st((v3=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background",v5,Ke(g)),rt(g,"alphaMasks",v6,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:g.sent(),this.background.node.active=!1;return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(a2.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(g,E,_,k){this.alphaMasks.masks[1].node.worldPosition=new em(-9999,-9999,0);var C=this.alphaMasks.masks[0];this.setMaskTransform(C,g,E,_,k)}},{key:"setItemMaskTransform",value:function(g,E,_,k){this.alphaMasks.masks[0].node.worldPosition=new em(-9999,-9999,0);var C=this.alphaMasks.masks[1];this.setMaskTransform(C,g,E,_,k)}},{key:"setMaskTransform",value:function(g,E,_,k,C){g.uiTransform.setContentSize(k,C),g.node.setWorldPosition(E,_,0)}}]),a}(D)).prototype,"background",[v1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v6=st(v3.prototype,"alphaMasks",[v2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v4=v3))||v4);_._RF.pop(),_._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var gh,gp,gf,gy,gv,gg,gm,gb,gw,gS,gE,g_,gk,gC=k.ccclass,gA=k.property,gT=(gt=gC("GuideTextBox"),gn=gA(L),gi=gA(H),gt((go=st((gr=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"guideText",go,Ke(g)),rt(g,"widget",gs,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.opacityToggler=this.getComponent(ad),nC.lazyValidateProperties(this)}},{key:"setText",value:function(g){this.guideText.string=g}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.opacityToggler.changeStateFade(!0)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.opacityToggler.changeStateFade(!1)];case 1:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(D)).prototype,"guideText",[gn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gs=st(gr.prototype,"widget",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ga=gr))||ga);_._RF.pop(),_._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var gR,gI,gL,gP,gO,gB,gN,gD,gM,gF,gU,gz,gx,gG,gV,gK,gH,gq,gW,gj=game,gX=gj.player,gY=gj.analytics,gJ=k.ccclass,gQ=k.property,gZ=GameCore,g$=gZ.Match.Modes,g0=gZ.Plugins.Analytics.Events,g1=gZ.Utils.Array,g2=gZ.Events,g4=globalThis.game.event,g3=new eS(0,10),g5=new eS(0,10),g6="READY",g8="RUNNING",g9=(gh=gJ("GuidelinesManager"),gp=gQ(vH),gf=gQ(gT),gy=gQ(L),gv=gQ(gc),gg=gQ(C),gh((gw=st((gb=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"guideHand",gw,Ke(g)),rt(g,"guideTextBox",gS,Ke(g)),rt(g,"guideInfoText",gE,Ke(g)),rt(g,"guideMasks",g_,Ke(g)),rt(g,"guideSkipButton",gk,Ke(g)),g.guideHintDelay=null,g.guideStormDelay=null,g}return Ue(i,[{key:"init",value:function(g){this.gameplay=g,this.status=g6,this.node.scene.on(a2.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(a2.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(a2.USE_ITEM,this.handleUseItem,this),this.node.scene.on(a2.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(a2.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(a2.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(vs)&&this.resetGuideItemShowed(),this.startGuide(vs)):this.startGuide(vl)}},{key:"startGuide",value:function(g){if(this.status===g8)return!1;if(this.hasGuideItemShowed(g))return!1;switch(this.addGuideItemShowed(g),this.status=g8,g){case vs:gY.event(g0.TUTORIAL_BEGIN),this.guide1=new vy(this),this.guide1.setup();break;case vl:this.guide2=new vv(this),this.guide2.setup();break;case vu:this.guide3=new vg(this),this.guide3.setup();break;case vc:this.guide4=new vb(this),this.guide4.setup();break;case vh:this.guide5=new vS(this),this.guide5.setup();break;case vp:this.guide6=new v_(this),this.guide6.setup();break;case vf:this.guide7=new vN(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(g){gY.event(g0.TUTORIAL_STEP,{step:g}),this.status=g6,this.addGuideItemShowed(g),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){var g=this.getCurrentLevel(),E=g3.x,_=g3.y;return g>=E&&g<=_}},{key:"isShowErrorPathLevel",value:function(){if(lT.getMatchMode()===g$.TOURNAMENT)return!1;var g=this.getCurrentLevel(),E=g5.x,_=g5.y;return g>=E&&g<=_}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(g){return g1.has(this.getGuideItemShowed(),g)}},{key:"addGuideItemShowed",value:function(g){if(!this.hasGuideItemShowed(g)){var E=this.getGuideItemShowed();E.push(g),gX.setGameData({guideItemShowed:E})}}},{key:"resetGuideItemShowed",value:function(){gX.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var g,E;return null!==(g=null===(E=gX.getGameData())||void 0===E?void 0:E.guideItemShowed)&&void 0!==g?g:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(g){this.isNewbieGuideLevel()||g<2||(this.startGuide(vu),this.node.scene.off(a2.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var g=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=x(this.node).delay(5).call(function(){g.isNewbieGuideLevel()||(g.hasGuideItemShowed(vc)&&g.status===g6?g.node.scene.emit(a2.SHOW_HINT):g.startGuide(vc),g.startHintGuide())})),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var g=this;null===this.guideStormDelay&&(this.guideStormDelay=new eV(this.node).delay(10).call(function(){if(!g.isNewbieGuideLevel()&&!g.hasGuideItemShowed(vp)){var E=g1.search(g.gameplay.itemManager.items,function(g){return g.itemType===sN.STORM});E&&E.canActivate()&&(g.startGuide(vp)||g.startStormGuide())}})),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(vh)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(vf)}},{key:"handleUseItem",value:function(g){switch(this.startAutoGuides(),g){case sN.HINT:this.addGuideItemShowed(vc);break;case sN.THUNDER:this.addGuideItemShowed(vh);break;case sN.STORM:this.addGuideItemShowed(vp);break;case sN.PLIERS:this.addGuideItemShowed(vf)}}},{key:"skipNewbieGuide",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.guideSkipButton.active=!1;return[4,this.guide1.close()];case 1:E.sent();g=this.getCurrentLevel()+1;gX.setGameData({level:g}),this.node.scene.emit(a2.NEXT_LEVEL),g4.emit(g2.REQUEST_SHOW_BANNER_ADS);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"onDestroy",value:function(){var g,E,_,k,C,A;null===(g=this.guide2)||void 0===g||g.unlistenEvents(),null===(E=this.guide3)||void 0===E||E.unlistenEvents(),null===(_=this.guide4)||void 0===_||_.unlistenEvents(),null===(k=this.guide5)||void 0===k||k.unlistenEvents(),null===(C=this.guide6)||void 0===C||C.unlistenEvents(),null===(A=this.guide7)||void 0===A||A.unlistenEvents()}}]),i}(D)).prototype,"guideHand",[gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gS=st(gb.prototype,"guideTextBox",[gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gE=st(gb.prototype,"guideInfoText",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g_=st(gb.prototype,"guideMasks",[gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gk=st(gb.prototype,"guideSkipButton",[gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gm=gb))||gm);_._RF.pop(),_._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var g7,me=k.ccclass,mt=k.property,mn=(gR=me("SpecialItem"),gI=mt({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),gL=mt({type:B,tooltip:"The button that activates the item"}),gP=mt({type:V,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),gO=mt({type:L,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),gB=mt({type:C,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),gN=mt({type:C,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),gD=mt({type:eu,group:"Animation"}),gM=mt({type:eu,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),gR((gz=st((gU=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"isDevButton",gz,Ke(g)),rt(g,"button",gx,Ke(g)),rt(g,"quantity",gG,Ke(g)),rt(g,"quantityLabel",gV,Ke(g)),rt(g,"quantityNode",gK,Ke(g)),rt(g,"plusNode",gH,Ke(g)),rt(g,"glowUIOpacity",gq,Ke(g)),rt(g,"uiOpacity",gW,Ke(g)),g.requestItem=null,g.loadQuantity=null,g}return Ue(o,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"init",value:function(g){var E=this;this.node.scene.on(a2.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(a2.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(a2.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(a2.GRID_SPAWN,this.applyActivationStatus,this),this.node.scene.on(a2.BOMB_EXPLODE,this.applyActivationStatus,this),this.node.scene.on(a2.IDLE_EXIT,function(){E.button.interactable=!1,E.applyActivationStatus()}),this.node.scene.on(a2.IDLE_ENTER,function(){E.button.interactable=!0,E.applyActivationStatus()})}},{key:"start",value:function(){var g=this.loadQuantity();this.setQuantity(g)}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"applyActivationStatus",value:(k=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:null===(g=this.signal)||void 0===g||g.abort();E=new nD;this.signal=E;_=this.canActivate();this.button.interactable=_;return[4,tZ.runTweenAsync(x(this.uiOpacity).to(.2,{opacity:_?255:128}),E)];case 1:k.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"activate",value:(_=Be(function(){return _ts_generator(this,function(g){this.quantity<=0?this.requestItem():(this.vibrate(),this.setQuantity(this.quantity-1));return[2]})}),function(){return _.apply(this,arguments)})},{key:"canActivate",value:function(){return!1}},{key:"setQuantity",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=g;if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();k=Math.max(0,k),this.quantity=k,this.quantityLabel.string="".concat(this.quantity),k<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),_&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}},{key:"getQuantity",value:function(){return this.quantity}},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;this.isDevButton||k&&this.setQuantity(_,k.animate)}},{key:"vibrate",value:function(){var g;null===(g=$("Vibrate"))||void 0===g||null===(g=g.getComponent(sP))||void 0===g||g.vibrate(50)}},{key:"animateAddItem",value:(E=Be(function(){return _ts_generator(this,function(g){return[2,(this.glowUIOpacity.opacity=0,Promise.all([tZ.runTweenAsync(x(this.node).to(.1,{scale:new em(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:em.ONE},{easing:"elasticOut"})),tZ.runTweenAsync(x(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))]))]})}),function(){return E.apply(this,arguments)})}]),o}(D)).prototype,"isDevButton",[gI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gx=st(gU.prototype,"button",[gL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gG=st(gU.prototype,"quantity",[gP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gV=st(gU.prototype,"quantityLabel",[gO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gK=st(gU.prototype,"quantityNode",[gB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gH=st(gU.prototype,"plusNode",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gq=st(gU.prototype,"glowUIOpacity",[gD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gW=st(gU.prototype,"uiOpacity",[gM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gF=gU))||gF);_._RF.pop(),_._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var mi,ma=(0,k.ccclass)("ItemManager")(g7=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).sceneItems=new Set,g}return Ue(n,[{key:"items",get:function(){return tt(this.sceneItems)}},{key:"onLoad",value:function(){this.syncItems()}},{key:"syncItems",value:function(){var g=$("Canvas/UI");if(g){var E,_=at(g.getComponentsInChildren(mn));try{for(_.s();!(E=_.n()).done;){var k=E.value;k.node.activeInHierarchy&&this.sceneItems.add(k)}}catch(g){_.e(g)}finally{_.f()}}}}]),n}(D))||g7;_._RF.pop(),_._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var mr,mo=k.ccclass,ms=GameCore.Utils,ml=ms.Device,mu=ms.Array,mc=globalThis.game.monitorError,mh={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},mp=mo("LevelManager")(mi=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){return Fe(this,r),A.apply(this,arguments)}return Ue(r,[{key:"loadLevel",value:(C=Be(function(){var g,E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:g=T.length>0&&void 0!==T[0]?T[0]:1,E=T.length>1?T[1]:void 0;return[4,this.loadLevelData(g)];case 1:_=R.sent();this.levelData=_||this.levelData||mh;k=this.levelData,C=k.rows,A=k.columns;return[2,(ml.isMobile()&&A>=6&&C>=10&&(this.levelData.columns=5,this.levelData.rows=10),null==mc||mc.addMetadata({level:g}),this.getLevelSpriteFrames(g,E))]}})}),function(){return C.apply(this,arguments)})},{key:"loadLevelData",value:(k=Be(function(){var g,E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:g=A.length>0&&void 0!==A[0]?A[0]:1,E=10,_=this.paddingZero("".concat(Math.floor(g/E)+1),3),k=g%E;return[4,ie.loadJsonAsync("".concat(nM.LEVEL_DATA_FOLDER,"/").concat(_))];case 1:C=T.sent();return[2,C?C[k]:null]}})}),function(){return k.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"getLevelSpriteFrames",value:(_=Be(function(g,E){var _,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:if(!(E&&X.random()<=.5))return[3,2];_=lh.getThemeSkins(E),k=_[X.randomRangeInt(0,_.length)];return[4,this.loadSkinFrames(k)];case 1:return[2,I.sent()];case 2:C=lh.getLevelSkins(g);if(!(C.length>1))return[3,4];return[4,this.loadSkinFrames(C)];case 3:return[2,I.sent()];case 4:A=C[0],T=lh.getUnlockedSkins();if(T.length>1&&X.random()<=.5){R=T.filter(function(g){return g!==A});A=R[X.randomRangeInt(0,R.length)]}return[4,this.loadSkinFrames(A)];case 5:return[2,I.sent()]}})}),function(g,E){return _.apply(this,arguments)})},{key:"loadSkinFrames",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!Array.isArray(g))return[3,2];E=g.map(function(){var g=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E="".concat(nM.TILE_SKIN_FOLDER,"/").concat(g);return[4,ie.loadSpriteFramesDirAsync(E)];case 1:return[2,_.sent()]}})});return function(E){return g.apply(this,arguments)}}());_=mu.flatten;return[4,Promise.all(E)];case 1:return[2,_.apply(mu,[C.sent()])];case 2:k="".concat(nM.TILE_SKIN_FOLDER,"/").concat(g);return[4,ie.loadSpriteFramesDirAsync(k)];case 3:return[2,C.sent()]}})}),function(g){return E.apply(this,arguments)})},{key:"paddingZero",value:function(g,E){for(var _="",k=0;k<E-g.length;k++)_+="0";return _+g}}]),r}(D))||mi;_._RF.pop(),_._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var mf=k.ccclass,my=GameCore.Match.Modes,mv=mf("ScoreManager")(mr=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).currentScore=0,g.tournamentStartScore=0,g}return Ue(i,[{key:"addScore",value:function(g,E,_){var k=this.getLevelMultiplier(g),C=this.getComboMultiplier(E),A=this.getTimeMultiplier(g,_),T=Math.floor(this.currentScore+10*k*C*A),R=10*Math.ceil(T/10);this.setScore(R)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var g=lT.getMatchMode();this.currentScore=g===my.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(g){this.currentScore=g,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"resetTournamentStartScore",value:function(){this.tournamentStartScore=0}},{key:"updateScore",value:(E=Be(function(){return _ts_generator(this,function(g){this.node.scene.emit(a2.SCORE_UPDATED,this.currentScore);return[2]})}),function(){return E.apply(this,arguments)})},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(g){return 1+.1*(g-1)}},{key:"getComboMultiplier",value:function(g){return 1+.1*(g-1)}},{key:"getTimeMultiplier",value:function(g,E){return g<=2?4:1+.05*E}}]),i}(D))||mr;_._RF.pop(),_._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var mg=function(){function e(g){Fe(this,e),this.game=null,this.data={},this.game=g.getGameplay(),this.manager=g,this.updateStateData(),this.logDebug()}return Ue(e,[{key:"logDebug",value:function(){var g=this.constructor.name;console.info("[STATE] ".concat(g),this.data)}},{key:"updateStateData",value:function(){if(this.game){var g=this.game.getGameData();g&&(this.data=g)}}},{key:"updateGameData",value:function(g){var E;null===(E=this.game)||void 0===E||E.setGameData(g)}}]),e}();_._RF.pop(),_._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var mm=globalThis.game,mb=mm.analytics,mw=mm.match,mS=mm.storage,mE=GameCore,m_=mE.Match.Modes,mk=mE.Dtos.Match.Data,mC=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(g,E){var _;return Fe(this,r),_=A.call(this,g),i8.stopAllSounds(),_.vibrateDevice(),_.pauseCountdown(),_.updateMatchCustomData(),_.handleGameOver(E),_.logLevelFailAnalytics(),_}return Ue(r,[{key:"pauseCountdown",value:function(){var g;null===(g=this.game)||void 0===g||g.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var g;null===(g=$("Vibrate"))||void 0===g||null===(g=g.getComponent(sP))||void 0===g||g.vibrate(500)}},{key:"handleGameOver",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=lT.getMatchMode();if(ie.setBlockInput(!0),E===m_.SINGLE)return[3,5];if(E!==m_.TOURNAMENT)return[3,2];return[4,this.handleTournamentGameOver()];case 1:_.sent();return[3,4];case 2:if(E!==m_.CHALLENGE_FRIEND)return[2,void this.showFailScreen(g)];return[4,this.handleChallengeGameOver()];case 3:_.sent();_.label=4;case 4:ie.setBlockInput(!1);return[3,6];case 5:this.showFailScreen(g);_.label=6;case 6:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(k=Be(function(){var g,E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=this;if(!this.game)return[3,5];k=(null!==(g=lT.getMatchCustomData())&&void 0!==g?g:{}).tournamentId;if(!k)return[3,5];if(ur.validateTournamentExpired(k))return[2,(mS.setStorageData("tournament","animateTournamentLeader",!1),l5.showNotificationScreen("Tournament has ended",2),void(null===(C=this.game)||void 0===C||C.scheduleOnce(function(){var g;null===(g=_.game)||void 0===g||g.node.scene.emit(a2.GAME_EXIT)},2)))];I.label=1;case 1:I.trys.push([1,3,,4]);A=mS.getStorageData("tournament","previousScore"),T=this.game.scoreManager.getCurrentScore()>A;mS.setStorageData("tournament","animateTournamentLeader",T);return[4,lT.finishMatchAsync()];case 2:I.sent();return[3,4];case 3:R=I.sent();console.warn(R);return[3,4];case 4:null===(E=this.game)||void 0===E||E.node.scene.emit(a2.GAME_EXIT);I.label=5;case 5:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.game)return[3,6];C.label=1;case 1:C.trys.push([1,4,,5]);g=mw.getMatchState().id;return[4,mw.api.getMatchAPI().getMatchDetailByIdAsync(g)];case 2:E=C.sent(),_=new mk(E).toObject().extraData;return[4,lT.finishMatchAsync({extraData:null!=_?_:void 0})];case 3:C.sent();return[3,5];case 4:k=C.sent();console.warn(k);return[3,5];case 5:this.game.node.scene.emit(a2.SHOW_CHALLENGE_RESULTS);C.label=6;case 6:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"showFailScreen",value:(E=Be(function(g){var E;return _ts_generator(this,function(_){E=this.data.level;g===us&&i8.playSound(ih.LEVEL_FAIL_TIMEOUT),i8.playSound(ih.LEVEL_FAIL),l5.openScreen(ib.RESCUES_SCREEN,{level:E,failKey:g});return[2]})}),function(g){return E.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var g;if(this.game){var E=this.data.level,_=void 0===E?1:E,k=null===(g=this.game)||void 0===g?void 0:g.scoreManager.getCurrentScore();lT.updateMatchStateAfterLevelFinish(_,k)}}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=this.game.scoreManager.getCurrentScore(),k=lT.getMatchMode()||void 0;mb.levelFail(E,_,k)}}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var g=this.manager.createPlayingState(this.manager);this.manager.change(g)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}},{key:"update",value:function(){}}]),r}(mg);_._RF.pop(),_._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);var mA=GameCore,mT=mA.Configs,mR=mA.Plugins.Ads,mI=mR.Types,mL=mR.Status,mP=mA.Utils.Array,mO=globalThis.game.ads,mB=function(){function e(){Fe(this,e),this.isAvoidBannerShowed=!1}var g,E,_,k;return Ue(e,[{key:"canbeShowInSDK",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:[],k=arguments.length>1&&void 0!==E?E:[],C=GameSDK.getSDKName();return(null==k||!k.length||!mP.has(k,C))&&!(null!=_&&_.length&&!mP.has(_,C))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"preloadAds",value:(k=Be(function(){var g,E,_,k,C,A,T,R;return _ts_generator(this,function(I){g=mT.Ads,E=g.Enabled,_=g.InterstitialAdOptions,k=g.RewardedVideoAdOptions,C=g.RewardedInterstitialAdOptions;if(E){A=mI.INTERSTITIAL,T=mI.REWARDED_VIDEO,R=mI.REWARDED_INTERSTITIAL;_.forEach(function(g){var E=g.PlacementId;mO.loadAdAsync(A,E).catch(function(){})}),k.forEach(function(g){var E=g.PlacementId;mO.loadAdAsync(T,E).catch(function(){})}),C.forEach(function(g){var E=g.PlacementId;mO.loadAdAsync(R,E).catch(function(){})})}return[2]})}),function(){return k.apply(this,arguments)})},{key:"setAvoidBannerShowed",value:function(g){this._instance.isAvoidBannerShowed=g}},{key:"showBannerAds",value:function(){var g=this,E=mT.Ads,_=E.Enabled,k=E.BannerDisplayAdOptions;if(_&&!this.inst.isAvoidBannerShowed){var C=eb.instance.getVisibleSize(),A=ns.worldSizeToCssSize(C.height*sO);k.forEach(function(E){var _=E.PlacementId,k=E.Position,C=E.BannerHeight;"bottom"===k&&C>A||g.showBannerAd(_)})}}},{key:"hideBannerAds",value:function(){var g=this,E=mT.Ads,_=E.Enabled,k=E.BannerDisplayAdOptions;_&&k.forEach(function(E){var _=E.PlacementId;g.hideBannerAd(_)})}},{key:"showBannerAd",value:function(g){this.inst.isAvoidBannerShowed||mO.showBannerAdAsync(g).catch(function(g){})}},{key:"hideBannerAd",value:function(g){mO.hideBannerAdAsync(g).catch(function(g){})}},{key:"canShowInterstitialAd",value:function(){var g=mO.getAdStatus(mI.INTERSTITIAL)===mL.FILLED;return mO.canbeShowInterstitialAd()&&g}},{key:"canShowRewardedVideoAd",value:function(){return mO.getAdStatus(mI.REWARDED_VIDEO)===mL.FILLED}},{key:"canShowRewardedInterstitialAd",value:function(){return mO.getAdStatus(mI.REWARDED_INTERSTITIAL)===mL.FILLED}},{key:"showInterstitialAdAsync",value:(_=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:E=g.forLevel,_=g.includeSDK,k=g.excludeSDK;if(!this.inst.canbeShowInSDK(_,k))return[2,!1];if(E&&mT.Gameplay.StartAdAtLevel>=E)return[2,!1];if(!mO.canbeShowInterstitialAd())return[2,!1];C=i8.getVolumeMusic();R.label=1;case 1:R.trys.push([1,4,5,6]);i8.muteSound(!0),i8.setVolumeMusic(0,!0);A=mO.getAdStatus(mI.INTERSTITIAL)===mL.FILLED;if(!A)return[3,3];return[4,mO.showAdAsync(mI.INTERSTITIAL)];case 2:A=R.sent();R.label=3;case 3:return[2,!0];case 4:T=R.sent();return[2,(console.warn("showInterstitialAdAsync failed",T),!1)];case 5:Q.resume(),i8.muteAudio(!1),i8.setVolumeMusic(C,!0),mO.loadAdAsync(mI.INTERSTITIAL).catch(function(){});return[7];case 6:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"showRewardVideoAdAsync",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=g.includeSDK,_=g.excludeSDK;if(!this.inst.canbeShowInSDK(E,_))return[2,!1];k=i8.getVolumeMusic();T.label=1;case 1:T.trys.push([1,5,6,7]);i8.muteSound(!0),i8.setVolumeMusic(0,!0),l5.showLoadingScreen();C=mO.getAdStatus(mI.REWARDED_VIDEO)!==mL.FILLED;if(!C)return[3,3];return[4,mO.loadAdAsync(mI.REWARDED_VIDEO)];case 2:C=T.sent();T.label=3;case 3:return[4,mO.showAdAsync(mI.REWARDED_VIDEO)];case 4:return[2,(T.sent(),!0)];case 5:A=T.sent();return[2,(console.warn("showRewardVideoAdAsync failed",A),_instanceof(A,Object)&&"code"in A&&"USER_INPUT"===A.code?l5.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2):l5.showNotificationScreen("No ads to display.",2),!1)];case 6:Q.resume(),l5.closeLoadingScreen(),i8.muteAudio(!1),i8.setVolumeMusic(k,!0),mO.loadAdAsync(mI.REWARDED_VIDEO).catch(function(){});return[7];case 7:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"showRewardedInterstitialAdAsync",value:(g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=g.includeSDK,_=g.excludeSDK;if(!this.inst.canbeShowInSDK(E,_))return[2,!1];k=i8.getVolumeMusic();T.label=1;case 1:T.trys.push([1,5,6,7]);i8.muteSound(!0),i8.setVolumeMusic(0,!0),l5.showLoadingScreen();C=mO.getAdStatus(mI.REWARDED_INTERSTITIAL)!==mL.FILLED;if(!C)return[3,3];return[4,mO.loadAdAsync(mI.REWARDED_INTERSTITIAL)];case 2:C=T.sent();T.label=3;case 3:return[4,mO.showAdAsync(mI.REWARDED_INTERSTITIAL)];case 4:return[2,(T.sent(),!0)];case 5:A=T.sent();return[2,(console.warn("showRewardedInterstitialAdAsync failed",A),!1)];case 6:Q.resume(),l5.closeLoadingScreen(),i8.muteAudio(!1),i8.setVolumeMusic(k,!0),mO.loadAdAsync(mI.REWARDED_INTERSTITIAL).catch(function(){});return[7];case 7:return[2]}})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var mN=globalThis.game,mD=mN.analytics,mM=mN.player,mF=mN.leaderboard,mU=mN.match,mz=GameCore,mx=mz.Match.Modes,mG=mz.Utils.Time,mV=function(g){ze(u,g);var E,_,k,C,A,T,R,I=Xe(u);function u(g){var E;return Fe(this,u),(E=I.call(this,g)).handleFinishStateFlow(),E}return Ue(u,[{key:"handleFinishStateFlow",value:(R=Be(function(){var g;return _ts_generator(this,function(E){if(this.game){this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),this.game.uiManager.pauseTime();g=lT.getMatchMode();g!==mx.CHALLENGE_FRIEND&&g!==mx.TOURNAMENT&&this.updatePlayerProgress(),this.updateMatchCustomData(),g===mx.CHALLENGE_FRIEND?this.handleFinishChallenge():g===mx.TOURNAMENT?this.handleFinishTournament():this.handleFinishSingle(),this.logLevelCompleteAnalytics()}return[2]})}),function(){return R.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"attemptCallCreateShortcut",value:function(){var g=this.data.level;(void 0===g?0:g)<2||mB.canShowInterstitialAd()||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(g){console.warn("createShortcutAsync",g)})}},{key:"updatePlayerProgress",value:function(){if(this.game){var g=this.data.level;if(g){var E=g+1,_=mM.getGameData();if(_){var k=_.totalLevel,C=_.level,A=Math.max(C,E),T=De({},_);A<k&&(T.level=A),mM.setGameData(T)}}}}},{key:"updateMatchCustomData",value:function(){if(this.game){var g=this.data.level,E=void 0===g?1:g,_=this.game.scoreManager.getCurrentScore();lT.updateMatchStateAfterLevelFinish(E,_)}}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=this.game.scoreManager.getCurrentScore(),k=lT.getMatchMode()||void 0;mD.levelComplete(E,_,k)}}},{key:"handleFinishChallenge",value:(T=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!this.game)return[3,7];k.label=1;case 1:k.trys.push([1,4,,6]);g=mU.getMatchState().id;return[4,lT.getMatchExtraDataAsync(g)];case 2:E=k.sent();return[4,lT.finishMatchAsync({extraData:null!=E?E:void 0})];case 3:k.sent();return[3,6];case 4:_=k.sent();console.warn(_);return[4,lT.finishMatchAsync()];case 5:k.sent();return[3,6];case 6:this.game.node.scene.emit(a2.SHOW_CHALLENGE_RESULTS);k.label=7;case 7:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"handleFinishTournament",value:(A=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.handlePostTournamentScore(),!this.game)return[3,4];g=this.data.level,E=void 0===g?1:g;i8.playSound(ih.LEVEL_COMPLETE,{volume:.5}),this.game.effectManager.playConfettiEffect();return[4,mG.sleepAsync(500)];case 1:k.sent();_=mB.canShowInterstitialAd();if(!_)return[3,3];return[4,mB.showInterstitialAdAsync({forLevel:E})];case 2:_=k.sent();k.label=3;case 3:this.game.node.scene.emit(a2.NEXT_LEVEL);k.label=4;case 4:return[2]}})}),function(){return A.apply(this,arguments)})},{key:"handlePostTournamentScore",value:(C=Be(function(){var g,E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:if(!this.game)return[3,7];E=null===(g=this.game)||void 0===g?void 0:g.scoreManager.getCurrentScore();if(!E)return[3,7];R.label=1;case 1:R.trys.push([1,3,,4]);return[4,GameSDK.tournament.postScoreAsync(E)];case 2:R.sent();return[3,4];case 3:_=R.sent();console.warn("GameSDK post score async",_);return[3,4];case 4:k=lT.getMatchCustomData();if(!k)return[3,7];C=k.leaderboardId,A=k.playerId;T=C&&A;if(!T)return[3,6];return[4,mF.setLeaderboardScoreAsync(C,A,E)];case 5:T=R.sent();R.label=6;case 6:R.label=7;case 7:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleFinishSingle",value:(k=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:i8.turnUpMusic();g=this.data.level,E=void 0===g?0:g;if(!(E>0&&E%5==0))return[3,2];return[4,this.handleFinishHardLevel()];case 1:_.sent();return[3,4];case 2:return[4,this.handleFinishNormalLevel()];case 3:_.sent();_.label=4;case 4:this.handleNextLevelSingle();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"handleFinishNormalLevel",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:A=this.data.level,T=void 0===A?0:A,R=null!==(g=null===(E=mM.getGameData())||void 0===E?void 0:E.coins)&&void 0!==g?g:0,I=null!==(_=null===(k=lT.getMatchCustomData())||void 0===k?void 0:k.score)&&void 0!==_?_:0;L=mB.canShowInterstitialAd();if(!L)return[3,3];return[4,null===(C=this.game)||void 0===C?void 0:C.uiManager.interstitialAdIndicator.flash()];case 1:P.sent();return[4,mB.showInterstitialAdAsync({forLevel:T})];case 2:L=P.sent();P.label=3;case 3:i8.playSound(ih.LEVEL_COMPLETE,{volume:.5});return[4,l5.openScreenAndWaitForClose(ib.LEVEL_COMPLETE_SCREEN,{level:T,coins:R,score:I,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!1})];case 4:P.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleFinishHardLevel",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,L,P,O,B,N,D;return _ts_generator(this,function(M){switch(M.label){case 0:T=this.data.level,R=void 0===T?0:T,I=null!==(g=null===(E=mM.getGameData())||void 0===E?void 0:E.coins)&&void 0!==g?g:0,L=null!==(_=null===(k=lT.getMatchCustomData())||void 0===k?void 0:k.score)&&void 0!==_?_:0;P=mB.canShowInterstitialAd();if(!P)return[3,3];return[4,null===(A=this.game)||void 0===A?void 0:A.uiManager.interstitialAdIndicator.flash()];case 1:M.sent();return[4,mB.showInterstitialAdAsync({forLevel:R})];case 2:P=M.sent();M.label=3;case 3:i8.playSound(ih.LEVEL_COMPLETE,{volume:.5});return[4,l5.openScreenAndWaitForClose(ib.LEVEL_COMPLETE_SCREEN,{level:R,coins:I,score:L,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!0})];case 4:O=M.sent().screenData,B=(null!=O?O:{}).canShowRewardsAd;if(!(void 0!==B&&B))return[3,7];return[4,l5.openScreenAndWaitForClose(ib.GET_REWARDS_SCREEN)];case 5:N=M.sent().screenData,D=null!==(C=null==N?void 0:N.getRewardsSuccess)&&void 0!==C&&C;D&&this.getRewardItems();return[4,l5.openScreenAndWaitForClose(ib.LEVEL_COMPLETE_SCREEN,{level:R,coins:I,score:L,getRewardsSuccess:D,lookingForRewards:!1})];case 6:M.sent();M.label=7;case 7:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleNextLevelSingle",value:function(){var g=this.data.level,E=mM.getGameData();this.game&&g&&E&&(g>=E.totalLevel?this.game.node.scene.emit(a2.MAX_LEVEL):this.game.node.scene.emit(a2.NEXT_LEVEL))}},{key:"getRewardItems",value:function(){this.game&&(this.game.node.scene.emit(a2.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.STORM,quantity:1}),this.game.node.scene.emit(a2.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.THUNDER,quantity:1}))}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),u}(mg);_._RF.pop(),_._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var mK=globalThis.game,mH=mK.player,mq=mK.match,mW=GameCore.Match.Modes,mj=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(g){var E;return Fe(this,l),(E=R.call(this,g)).clearBoard(),E.loadLevel(),E.initCountdown(),E.initScore(),E}return Ue(l,[{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.board.clearAnimationQueue(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(T=Be(function(){var g,E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:if(!this.game)return[3,8];g=lT.getMatchMode();R.label=1;case 1:R.trys.push([1,6,,8]);if(g!==mW.CHALLENGE_FRIEND)return[3,3];return[4,this.loadChallengeFriendMode()];case 2:E=R.sent(),_=E.frames,k=E.extraData;i8.playSound(ih.LEVEL_START),this.handleChallengeFriendModeStart(_,k);return[3,5];case 3:return[4,this.loadSingleMode()];case 4:C=R.sent();i8.playSound(ih.LEVEL_START),g===mW.SINGLE?this.handleSingleModeStart(C):g===mW.TOURNAMENT&&this.handleTournamentModeStart(C);R.label=5;case 5:return[3,8];case 6:A=R.sent();console.error("Error loading level:",A);return[4,this.loadSingleMode()];case 7:T=R.sent();i8.playSound(ih.LEVEL_START),this.handleSingleModeStart(T);return[3,8];case 8:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"loadChallengeFriendMode",value:(A=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:g=mq.getMatchState().id;return[4,lT.getMatchExtraDataAsync(g)];case 1:E=C.sent();if(!E)throw new Error("Match mode ".concat(mW.CHALLENGE_FRIEND," but no extraData (for opponent initialization) was found in match data."));_=this.game.levelManager;return[4,_.loadLevel(E.level)];case 2:k=C.sent();return[2,(this.updateGameData({level:E.level,levelData:_.getLevelData()}),{frames:k,extraData:E})]}})}),function(){return A.apply(this,arguments)})},{key:"loadSingleMode",value:(C=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.game.levelManager;return[4,g.loadLevel(this.data.level,this.data.themeId)];case 1:E=_.sent();return[2,(this.updateGameData({levelData:g.getLevelData()}),E)]}})}),function(){return C.apply(this,arguments)})},{key:"handleChallengeFriendModeStart",value:(k=Be(function(g,E){var _,k,C,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:if(!this.game)return[3,3];_=this.game.levelManager.getLevelData(),k=E.level,C=E.fen,A=E.gravity,T=E.rules,R=E.time,I=mH.getPlayerId();return[4,Promise.all([lT.setMatchCustomDataAsync({level:k,score:0}),lT.setProfileMatchDataAsync({id:I,score:0})])];case 1:L.sent(),this.game.board.create(g,De(De({},_),{},{level:k,customFen:C,mode:A,rules:T,time:R})),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:L.sent(),this.game.board.setIgnoreInput(!1),this.ready();L.label=3;case 3:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleSingleModeStart",value:(_=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:if(!this.game)return[3,6];_=this.game.levelManager.getLevelData(),k=this.data.level,C=mH.getPlayerId();return[4,Promise.all([lT.setMatchCustomDataAsync({level:k,score:0}),lT.setProfileMatchDataAsync({id:C,score:0})])];case 1:T.sent(),this.game.board.create(g,_),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:T.sent(),null!==(E=this.game.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1);A=k&&k>0&&k%5==0;if(!A)return[3,5];l5.openScreen(ib.HARD_LEVEL_SCREEN);return[4,tZ.waitTweenAsync(1.3)];case 3:T.sent(),l5.closeScreen(ib.HARD_LEVEL_SCREEN);return[4,this.game.board.animateTilesWave()];case 4:A=T.sent();T.label=5;case 5:this.ready();T.label=6;case 6:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"handleTournamentModeStart",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!this.game)return[3,3];_=this.game.levelManager.getLevelData(),k=this.data.level,C=mH.getPlayerId();return[4,Promise.all([lT.setMatchCustomDataAsync({level:k}),lT.setProfileMatchDataAsync({id:C})])];case 1:A.sent(),this.game.board.create(g,_),this.game.board.setIgnoreInput(!0);return[4,this.game.board.animateTilesAppear()];case 2:A.sent(),null!==(E=this.game.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),this.ready();A.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.init()}},{key:"initCountdown",value:function(){this.game&&this.game.uiManager.initCountdown()}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var g=this.manager.createReadyState(this.manager);this.manager.change(g)}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),l}(mg);_._RF.pop(),_._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var mX=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),(_=E.call(this,g)).startCountdown(),_}return Ue(n,[{key:"startCountdown",value:function(){var g;null===(g=this.game)||void 0===g||g.uiManager.startCountdown()}},{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){var g=this.manager.createReadyState(this.manager);this.manager.change(g)}},{key:"playing",value:function(){}},{key:"fail",value:function(g){var E=this.manager.createFailState(this.manager,g);this.manager.change(E)}},{key:"finish",value:function(){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}},{key:"update",value:function(){this.updateStateData()}}]),n}(mg);_._RF.pop(),_._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var mY,mJ=globalThis.game,mQ=mJ.analytics,mZ=(mJ.match,GameCore.Utils.Valid),m$=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),_=E.call(this,g),i8.stopAllSounds(),i8.turnDownMusic(),_.handleGuideFlow(),_.setLevelText(),_.setLevelTime(),_.setGridPlayable(),_.logLevelStartAnalytics(),_}return Ue(n,[{key:"initialize",value:function(){var g=this.manager.createInitializeState(this.manager);this.manager.change(g)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var g=this.manager.createPlayingState(this.manager);this.manager.change(g)}},{key:"fail",value:function(g){if(mZ.isDebugger()){var E=this.manager.createFailState(this.manager);this.manager.change(E)}}},{key:"finish",value:function(){if(mZ.isDebugger()){var g=this.manager.createFinishState(this.manager);this.manager.change(g)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var g;null!==(g=this.manager.getGameplay().guidelinesManager)&&void 0!==g&&g.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var g,E;this.game&&(null!==(g=this.game.guidelinesManager)&&void 0!==g&&g.isNewbieGuideLevel()||this.game.handleShowUI(),null===(E=this.game.guidelinesManager)||void 0===E||E.show())}},{key:"setLevelTime",value:function(){if(this.game){var g=this.data.levelData;g&&this.game.uiManager.setCountdownTime(g.time)}}},{key:"setLevelText",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g;this.game.uiManager.setLevelText(E)}}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var g=this.data.level,E=void 0===g?0:g,_=(lT.getMatchCustomData()||{}).score,k=void 0===_?0:_,C=lT.getMatchMode()||void 0;mQ.levelStart(E,k,C)}}}]),n}(mg);_._RF.pop(),_._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var m0,m1,m2,m4,m3,m5,m6,m8,m9,m7=(0,k.ccclass)("StateManager")(mY=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(g){this.gameplay=g,this.state=new mj(this)}},{key:"change",value:function(g){this.state=g}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return _instanceof(this.state,mj)}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return _instanceof(this.state,m$)}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return _instanceof(this.state,mX)}},{key:"fail",value:function(g){this.state.fail(g)}},{key:"isFail",value:function(){return _instanceof(this.state,mC)}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return _instanceof(this.state,mV)}},{key:"update",value:function(g){this.state&&this.state.update(g)}},{key:"createInitializeState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mj,E)}},{key:"createReadyState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(m$,E)}},{key:"createPlayingState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mX,E)}},{key:"createFailState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mC,E)}},{key:"createFinishState",value:function(){for(var g=arguments.length,E=new Array(g),_=0;_<g;_++)E[_]=arguments[_];return We(mV,E)}}]),n}(D))||mY;_._RF.pop(),_._RF.push({},"2b89dXjcudIaZRJFuh5TAAI","InterstitialAdIndicator",void 0);var be=k.ccclass,bt=k.property,bn=["Short ad break, hang tight!","Back to the game in just a sec!","Quick ad, then more fun!"];var bi,ba,br,bo,bs,bl=(m0=be("InterstitialAdIndicator"),m1=nC.required(),m2=bt(eu),m4=nC.required(),m3=bt(L),m0((m8=st((m6=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"uiOpacity",m8,Ke(g)),rt(g,"label",m9,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){nC.decorateComponent(this)}},{key:"flash",value:(E=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:null===(g=this.signal)||void 0===g||g.abort();_=new nD;this.signal=_,this.label.string=(E=Math.floor(Math.random()*bn.length),bn[E]);k=x(this.uiOpacity).to(.25,{opacity:255},{easing:"linear"}).delay(.25).to(.25,{opacity:100},{easing:"linear"}).delay(.125);return[4,tZ.runTweenAsync(x(this.uiOpacity).repeat(2,k).to(.25,{opacity:0},{easing:"linear"}),_)];case 1:C.sent(),this.uiOpacity.opacity=0;return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(D)).prototype,"uiOpacity",[m1,m2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m9=st(m6.prototype,"label",[m4,m3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m5=m6))||m5);_._RF.pop(),_._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);var bu,bc,bh,bp,bd,bf,by,bv=k.ccclass,bg=k.property,bm=(bi=bv("Digit"),ba=bg(L),bi((bs=st((bo=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"numberLabels",bs,Ke(g)),g.labelUITransforms=[],g.labelUIOpacitys=[],g.previousNumber=0,g}return Ue(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.labelUITransforms=this.numberLabels.map(function(g){return g.getComponent(R)}),this.labelUIOpacitys=this.numberLabels.map(function(g){return g.getComponent(eu)}),nC.lazyValidateProperties(this)}},{key:"setNumber",value:function(g){this.previousNumber!==g&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[g].node.active||(this.numberLabels[g].node.active=!0),this.labelUIOpacitys[g].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[g].contentSize),this.previousNumber=g)}}]),n}(D)).prototype,"numberLabels",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),br=bo))||br);_._RF.pop(),_._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var bb,bw=k.ccclass,bS=k.disallowMultiple,bE=k.property,b_=(bu=bw("Clock"),bc=bE(C),bh=bE(bm),bu(bp=bS((bf=st((bd=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"clockIcon",bf,Ke(g)),rt(g,"digits",by,Ke(g)),g.time=0,g.remaining=0,g.running=!1,g.halfTime=!1,g.handleUpdateConfig=function(E){g.enabled&&console.log("Clock: handleUpdateConfig",E)},g.refillTime=function(){var E=Date.now(),_=x(g.node).to(.5,{scale:new em(1.1,1.1,1)}),k=x(g.node).to(.5,{scale:new em(1,1,1)}),C=x(g.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),A=x(g.clockIcon).repeat(5,C),T=x(g.node).to(3,{position:new em(0,0,0)},{onUpdate:function(){var _=Date.now(),k=(_-E)/3e3>1?1:(_-E)/3e3,C=X.lerp(0,120,k);g.setTime(C)}}).call(function(){g.setTime(120),k.start(),g.node.scene.emit(a2.RESCUE_FINISHED)});x(g.node).parallel(_,T).start(),A.start()},g}return Ue(n,[{key:"__preload",value:function(){this.listenEvents()}},{key:"start",value:function(){this.init()}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"listenEvents",value:function(){this.node.scene.on(t8,this.handleUpdateConfig),this.node.scene.on(a2.RESCUE_START,this.refillTime)}},{key:"setTime",value:function(g){this.time=g,this.updateTimeLabel(g),this.remaining=g}},{key:"getRemainingTime",value:function(){return this.remaining}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(a2.TIME_OUT)}},{key:"update",value:function(g){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=g,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(a2.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}},{key:"updateTimeLabel",value:function(g){for(var E=this.convertSecondsToMmSs(g),_=0;_<E.length;_++)this.digits[_].setNumber(Number.parseInt(E[_]))}},{key:"convertSecondsToMmSs",value:function(g){var E=Math.floor(g/60),_=Math.floor(g%60),k=this.padZero(E),C=this.padZero(_);return"".concat(k).concat(C)}},{key:"padZero",value:function(g){return g<10?"0".concat(g):"".concat(g)}}]),n}(D)).prototype,"clockIcon",[bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),by=st(bd.prototype,"digits",[bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bp=bd))||bp)||bp);_._RF.pop(),_._RF.push({},"dfab8xSeglD/abIKphEhi4g","ComboContainer",void 0);var bk,bC=k.ccclass,bA=GameCore.Match.Modes,bT=bC("ComboContainer")(bb=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"__preload",value:function(){this.widget=this.node.getComponent(H)}},{key:"onLoad",value:function(){nC.lazyValidateProperties(this)}},{key:"updateStatus",value:function(){lT.getMatchMode()===bA.TOURNAMENT?this.widget.top=180:this.widget.top=160}}]),n}(D))||bb;_._RF.pop(),_._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var bR=k.ccclass,bI=bR("ComboProgressBar")(bk=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"start",value:function(){this.progressBar=this.getComponent(ol),this.opacity=this.getComponent(eu),this.comboTimer=0,this.isActive=!1,this.node.scene.on(a2.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(g){this.isActive&&(this.comboTimer>0?(this.comboTimer-=g,this.progressBar.progress=this.comboTimer/2):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(a2.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(g){0===g?this.opacity.opacity=0:g>0&&(this.isActive=!0,this.comboTimer=2),g>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),n}(D))||bk;_._RF.pop(),_._RF.push({},"af947t5g91EkZVWXv5upZaV","CacheUtils",void 0);var bL,bP,bO,bB,bN,bD,bM,bF=GameCore.Utils.Image,bU=globalThis.game.frameCapture,bz=function(){function e(){Fe(this,e)}var g,E,_;return Ue(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getPlayerAvatar",value:(_=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:C=this.playerAvatarCache.get("".concat(E,":").concat(_));A=C;if(A)return[3,2];return[4,this.loadPlayerAvatar(g,E,_,k)];case 1:A=C=T.sent();T.label=2;case 2:return[2,C]}})}),function(g,E,k,C){return _.apply(this,arguments)})},{key:"loadPlayerAvatar",value:(E=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:return[4,this.loadImage(g,_,_,"".concat(E,":").concat(_))];case 1:C=T.sent();if((null==k||!k.aborted)&&C){A=er.createWithImage(C);return[2,(this.playerAvatarCache.set("".concat(E,":").concat(_),A),A)]}return[2]}})}),function(g,_,k,C){return E.apply(this,arguments)})},{key:"isAvatarCached",value:function(g,E){return this.playerAvatarCache.has("".concat(g,":").concat(E))}},{key:"loadImage",value:(g=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:T.trys.push([0,5,,6]);return[4,bU.captureAsync({width:E,height:_,name:"LeaderAvatar",renderOptions:Ge({},k,{name:k,type:"image",depth:0,position:[0,0],size:[E,_],image:g})})];case 1:C=T.sent();if(!C)return[3,3];return[4,bF.loadImage(C)];case 2:A=T.sent();return[3,4];case 3:A=null;T.label=4;case 4:return[2,A];case 5:T.sent();return[2,null];case 6:return[2]}})}),function(E,_,k,C){return g.apply(this,arguments)})}]),e}();bz.playerAvatarCache=new Map;try{new bz}catch(g){console.error("CacheUtils",g)}_._RF.pop(),_._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var bx,bG,bV,bK,bH,bq,bW,bj=k.ccclass,bX=k.property,bY=k.disallowMultiple,bJ=(bL=bj("ScoreBlock"),bP=bX(L),bO=bX(K),bL(bB=bY((bD=st((bN=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"scoreText",bD,Ke(g)),rt(g,"maxScoreWidth",bM,Ke(g)),g.panelWidthDiff=0,g}return Ue(a,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(R),this.scoreUITransform=this.scoreText.node.getComponent(R),this.panelWidthDiff=this.uiTransform.width-this.maxScoreWidth,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateScore",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=g-this.score,k=x(this.node).to(.1,{},{onUpdate:function(g,k){if(k){var C=Math.floor(_*k)+E.score;E.scoreText.string=C.toString(),E.resizeWidth()}}});return[4,tZ.runTweenAsync(k)];case 1:C.sent(),this.setScore(g);return[4,this.resizeWidth()];case 2:C.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"setScore",value:function(g){var E=null!=g?g:0;this.score=E,this.scoreText.string=E.toString()}},{key:"resizeWidth",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this,E=this.uiTransform.width,_=(this.scoreUITransform.width>this.maxScoreWidth?this.scoreUITransform.width:this.maxScoreWidth)+this.panelWidthDiff;this.uiTween&&this.uiTween.stop(),this.uiTween=x(this.node).to(.05,{},{easing:"sineOut",onUpdate:function(k,C){C&&(g.uiTransform.width=X.lerp(E,_,C))}});return[4,tZ.runTweenAsync(this.uiTween)];case 1:k.sent(),this.uiTransform.width=_;return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(D)).prototype,"scoreText",[bP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bM=st(bN.prototype,"maxScoreWidth",[bO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bB=bN))||bB)||bB);_._RF.pop(),_._RF.push({},"424745QWUlDPabdCe8UcRwy","ChallengeScoreBlock",void 0);var bQ,bZ,b$,b0,b1,b2,b4,b3,b5,b6=k.ccclass,b8=k.property,b9=(bx=b6("ChallengeScoreBlock"),bG=b8(eo),bV=b8(er),bx((bq=st((bH=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"avatar",bq,Ke(g)),rt(g,"defaultAvatar",bW,Ke(g)),g}return Ue(i,[{key:"updateInfo",value:(E=Be(function(g,E,_){var k,C;return _ts_generator(this,function(A){switch(A.label){case 0:k=this;this.setScore(_),this.scheduleOnce(function(){return k.resizeWidth()},0);A.label=1;case 1:A.trys.push([1,3,,4]);return[4,bz.getPlayerAvatar(g,E,50)];case 2:C=A.sent();if(!C)return[2];C.packable=!0,this.avatar.spriteFrame=C;return[3,4];case 3:A.sent();this.avatar.spriteFrame=this.defaultAvatar;return[3,4];case 4:return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),i}(bJ)).prototype,"avatar",[bG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bW=st(bH.prototype,"defaultAvatar",[bV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bK=bH))||bK);_._RF.pop(),_._RF.push({},"f963aJjCvtD0Y2LplwjDer1","ScoreContainer",void 0);var b7,we,wt,wn,wi,wa,wr,wo,ws,wl,wu,wc=k.ccclass,wh=k.property,wp=GameCore.Match.Modes,wf=globalThis.game.match,wy=(bQ=wc("ScoreContainer"),bZ=wh(bJ),b$=wh(b9),b0=wh(b9),bQ((b4=st((b2=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"scoreBlock",b4,Ke(g)),rt(g,"playerScoreBlock",b3,Ke(g)),rt(g,"opponentScoreBlock",b5,Ke(g)),g.scoreBlockShown=!1,g.challengeScoreBlockShown=!1,g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onDestroy",value:function(){this.unlistenGameEvents()}},{key:"listenGameEvents",value:function(){this.node.scene.on(a2.SCORE_UPDATED,this.updateScore,this)}},{key:"unlistenGameEvents",value:function(){this.node.scene.off(a2.SCORE_UPDATED,this.updateScore,this)}},{key:"updateStatus",value:function(){var g=wf.getMatchState().mode;g===wp.CHALLENGE_FRIEND?(this.showChallengeScoreBlock(),this.hideScoreBlock()):g===wp.SINGLE&&(this.hideChallengeScoreBlock(),this.showScoreBlock())}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"showChallengeScoreBlock",value:function(){var g;if(!this.challengeScoreBlockShown){this.challengeScoreBlockShown=!0;var E=wf.getMatchState(),_=null!==(g=lT.getMatchCustomData())&&void 0!==g?g:{},k=_.playerId,C=_.opponentId;if(k&&C){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var A=E.profiles[k],T=E.profiles[C];this.playerScoreBlock.updateInfo(A.photo,k,A.score),this.opponentScoreBlock.updateInfo(T.photo,C,T.score)}}}},{key:"hideChallengeScoreBlock",value:function(){this.challengeScoreBlockShown&&(this.challengeScoreBlockShown=!1,this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1)}},{key:"showScoreBlock",value:function(){var g;if(!this.scoreBlockShown){this.scoreBlockShown=!0;var E=(null!==(g=lT.getMatchCustomData())&&void 0!==g?g:{}).score;this.scoreBlock.node.active=!0,this.scoreBlock.setScore(E)}}},{key:"hideScoreBlock",value:function(){this.scoreBlockShown&&(this.scoreBlockShown=!1,this.scoreBlock.node.active=!1)}},{key:"updateScore",value:function(g){this.challengeScoreBlockShown?this.playerScoreBlock.updateScore(g):this.scoreBlockShown&&this.scoreBlock.updateScore(g)}}]),n}(D)).prototype,"scoreBlock",[bZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b3=st(b2.prototype,"playerScoreBlock",[b$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b5=st(b2.prototype,"opponentScoreBlock",[b0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b1=b2))||b1);_._RF.pop(),_._RF.push({},"540108ucKBPYbN9gW5TFh/q","LeaderRail",void 0);var wv,wg,wm,wb,ww,wS=k.ccclass,wE=k.property,w_=(b7=wS("LeaderRail"),we=wE(L),wt=wE(C),wn=wE(eo),wi=wE(yc),b7((wo=st((wr=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"scoreLabel",wo,Ke(g)),rt(g,"crown",ws,Ke(g)),rt(g,"avatar",wl,Ke(g)),rt(g,"spark",wu,Ke(g)),g.score=0,g}return Ue(a,[{key:"__preload",value:function(){this.defaultAvatar=this.avatar.spriteFrame,this.uiOpacity=this.getComponent(eu)}},{key:"updateScore",value:(_=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this,k=g-this.score,C=x(this.node).to(.5,{},{onUpdate:function(g,E){if(E){var C=Math.floor(k*E)+_.score;_.scoreLabel.string=C.toString()}}});return[4,tZ.runTweenAsync(C,E)];case 1:A.sent(),this.score=g,this.scoreLabel.string=g.toString();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"updatePhoto",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=GameSDK.player.getPhoto(),E=GameSDK.player.getID();if(!(g&&E))return[3,2];return[4,bz.getPlayerAvatar(g,E,50)];case 1:_=k.sent();_?(_.packable=!0,this.avatar.spriteFrame=_):this.avatar.spriteFrame=this.defaultAvatar;k.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setCrown",value:function(g){this.crown.active=g}},{key:"setOpacity",value:function(g){this.uiOpacity.opacity=g}},{key:"playSparkParticle",value:function(){this.spark.play()}},{key:"stopSparkParticle",value:function(){this.spark.stop()}}]),a}(D)).prototype,"scoreLabel",[we],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ws=st(wr.prototype,"crown",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl=st(wr.prototype,"avatar",[wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wu=st(wr.prototype,"spark",[wi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wa=wr))||wa);_._RF.pop(),_._RF.push({},"00759vwS/dHS6GvHKvVE5Q1","TournamentProgressBar",void 0);var wk,wC,wA,wT,wR,wI,wL,wP,wO,wB,wN,wD,wM,wF,wU,wz=k.ccclass,wx=k.property,wG=474,wV=(wv=wz("TournamentProgressBar"),wg=wx(w_),wv((ww=st((wb=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"playerLeader",ww,Ke(g)),g.onUpdate=function(){g.playerLeader&&g.playerLeader.node&&(g.playerLeader.node.position=new em(g.progressBar.progress*wG-237,0,0))},g}return Ue(i,[{key:"__preload",value:function(){this.progressBar=this.getComponent(ew)}},{key:"updateProgress",value:(E=Be(function(g,E){var _,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:_=A.length>2&&void 0!==A[2]?A[2]:.5,k=A.length>3&&void 0!==A[3]?A[3]:"cubicOut",C=x(this.progressBar).to(_,{progress:g},{easing:k,onUpdate:this.onUpdate});return[4,tZ.runTweenAsync(C,E)];case 1:T.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"getProgress",value:function(){return this.progressBar.progress}}]),i}(D)).prototype,"playerLeader",[wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wm=wb))||wm);_._RF.pop(),_._RF.push({},"16d68fBLT1Ha7lXADThDtfC","TournamentRail",void 0);var wK,wH,wq,wW,wj,wX,wY,wJ,wQ,wZ,w$,w0,w1,w2,w4,w3,w5,w6=k.ccclass,w8=k.property,w9=GameCore,w7=w9.Utils,Se=w7.Array,St=w7.Object,Sn=w9.Match.Modes,Si=globalThis.game.player,Sa=(wk=w6("TournamentRail"),wC=w8(wV),wA=w8(w_),wT=w8(C),wR=w8(C),wI=w8(L),wL=w8(L),wk((wB=st((wO=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"progressBar",wB,Ke(g)),rt(g,"playerLeader",wN,Ke(g)),rt(g,"flag",wD,Ke(g)),rt(g,"sword",wM,Ke(g)),rt(g,"currentRank",wF,Ke(g)),rt(g,"nextRank",wU,Ke(g)),g.nextLeaderIndex=0,g.leaderData=[],g.score=0,g.minScore=0,g.maxScore=0,g.signal=new nD,g.isInited=!1,g}return Ue(s,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu)}},{key:"init",value:function(g){var E=this,_=Si.getPlayerId();this.leaderData=St.vals(g.leaders).reduce(function(g,E){if(E.playerId!==_&&E.score>0){var k={score:E.score,rank:E.rank};g.push(k)}return g},[]),this.leaderData.sort(function(g,E){return g.score-E.score}),this.leaderData.forEach(function(g,_){g.rank=E.leaderData.length-_}),this.playerLeader.updatePhoto(),this.isInited=!0}},{key:"updateStatus",value:(A=Be(function(){var g;return _ts_generator(this,function(E){if(lT.getMatchMode()===Sn.TOURNAMENT){this.signal.abort();g=new nD;this.signal=g,this.uiOpacity.opacity=255,this.node.scene.on(a2.SCORE_UPDATED,this.handleScoreUpdated,this),this.nextLeaderIndex=this.getScoreReachedLeaderIndex(this.score),this.syncRail(g,!0)}else this.uiOpacity.opacity=0;return[2]})}),function(){return A.apply(this,arguments)})},{key:"syncRail",value:(C=Be(function(g){var E,_,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(L){switch(L.label){case 0:E=I.length>1&&void 0!==I[1]&&I[1],_=this.leaderData[this.nextLeaderIndex-1],k=this.leaderData[this.nextLeaderIndex],C=_?_.rank:k?k.rank+1:1;this.setRankLabel(C,this.currentRank);A=!k;this.nextRank.node.active=!A,this.runActiveAnimation(this.sword,!A,g),this.playerLeader.setCrown(A),this.playerLeader.updateScore(this.score,g);T=E?0:void 0;if(!A)return[3,2];this.playerLeader.playSparkParticle();return[4,this.progressBar.updateProgress(1,g,T)];case 1:L.sent();return[3,4];case 2:this.playerLeader.stopSparkParticle(),this.setRankLabel(k.rank,this.nextRank),this.minScore=_?_.score:0,this.maxScore=k.score;R=(this.score-this.minScore)/(this.maxScore-this.minScore);R=.8*R+.1;return[4,this.progressBar.updateProgress(R,g,T)];case 3:L.sent();L.label=4;case 4:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"handleScoreUpdated",value:(k=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(this.score!==g))return[3,4];this.signal.abort();E=new nD;if(this.signal=E,this.score=g,!this.isInited)return[3,4];_=this.getScoreReachedLeaderIndex(g);if(!(_>this.nextLeaderIndex))return[3,3];this.nextLeaderIndex=_;k=(1-this.progressBar.getProgress())/1.5;k=Math.min(k,.5);return[4,this.progressBar.updateProgress(1,E,k,"cubicIn")];case 1:C.sent(),this.runBubbleAnimation(this.sword,E);return[4,this.progressBar.updateProgress(0,E,0)];case 2:C.sent(),this.runBubbleAnimation(this.flag,E);C.label=3;case 3:this.syncRail(E);C.label=4;case 4:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"runBubbleAnimation",value:(_=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.scale=em.ONE;_=x(g).to(.1,{scale:new em(1.2,1.2,1.2)}).to(.2,{scale:em.ONE},{easing:"backOut"});return[4,tZ.runTweenAsync(_,E)];case 1:k.sent(),g.scale=em.ONE;return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"runActiveAnimation",value:(E=Be(function(g,E,_){var k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:k=E?em.ZERO:em.ONE,C=E?em.ONE:em.ZERO;if(!!g.scale.equals(C))return[3,2];A=E?"backOut":"quadOut";g.scale=k;T=x(g).to(.1,{scale:new em(1.2,1.2,1.2)}).to(.2,{scale:C},{easing:A});return[4,tZ.runTweenAsync(T,_)];case 1:R.sent(),g.scale=C;R.label=2;case 2:return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"getScoreReachedLeaderIndex",value:function(g){var E=Se.searchIndex(this.leaderData,function(E){return E.score>=g});return -1===E?this.leaderData.length:E}},{key:"setRankLabel",value:function(g,E){var _="";_=1===g?"No.1":2===g?"2nd":3===g?"3rd":"".concat(g,"th"),E.string=_}}]),s}(D)).prototype,"progressBar",[wC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wN=st(wO.prototype,"playerLeader",[wA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wD=st(wO.prototype,"flag",[wT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wM=st(wO.prototype,"sword",[wR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wF=st(wO.prototype,"currentRank",[wI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wU=st(wO.prototype,"nextRank",[wL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wP=wO))||wP);_._RF.pop(),_._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var Sr,So,Ss,Sl,Su,Sc=k.ccclass,Sh=k.property,Sp=(wK=Sc("Header"),wH=Sh(L),wq=Sh(C),wW=Sh(C),wj=Sh(C),wX=Sh(C),wY=Sh(wy),wJ=Sh(Sa),wK((w$=st((wZ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"levelText",w$,Ke(g)),rt(g,"settingNode",w0,Ke(g)),rt(g,"homeNode",w1,Ke(g)),rt(g,"leftNode",w2,Ke(g)),rt(g,"coinNode",w4,Ke(g)),rt(g,"scoreContainer",w3,Ke(g)),rt(g,"tournamentRail",w5,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateStatus",value:function(){this.scoreContainer.updateStatus(),this.tournamentRail.updateStatus()}},{key:"handleClickedPauseGame",value:function(){this.showPauseScreen(),this.node.scene.emit(a2.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){l5.openScreen(ib.QUIT_LEVEL_SCREEN),this.node.scene.emit(a2.GAME_PAUSE)}},{key:"highlightCoinContainer",value:function(){var g=$("Canvas/Screens");if(g){var E=this.coinNode.worldPosition.clone();this.coinNode.parent=g,this.coinNode.worldPosition=E}}},{key:"removeCoinContainerHighlight",value:function(){var g=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=g}},{key:"showPauseScreen",value:function(){l5.openScreen(ib.PAUSE_SCREEN,{})}},{key:"setLevelText",value:function(g){this.levelText.string="Level ".concat(g)}},{key:"setButtonsSelectable",value:function(g){var E=!(arguments.length>0&&void 0!==g)||g;this.enableBtnNode(this.settingNode,E,!0),this.enableBtnNode(this.homeNode,E,!0)}},{key:"enableBtnNode",value:function(g,E,_){var k=g.getComponent(B);if(k&&(k.interactable=E),g.active=_,_)g.getComponent(ad)}},{key:"setActive",value:function(g){this.uiOpacity.opacity=g?255:0}}]),n}(D)).prototype,"levelText",[wH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w0=st(wZ.prototype,"settingNode",[wq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w1=st(wZ.prototype,"homeNode",[wW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w2=st(wZ.prototype,"leftNode",[wj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w4=st(wZ.prototype,"coinNode",[wX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w3=st(wZ.prototype,"scoreContainer",[wY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w5=st(wZ.prototype,"tournamentRail",[wJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wQ=wZ))||wQ);_._RF.pop(),_._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var Sf=k.ccclass,Sy=k.property,Sv=(Sr=Sf("UIMasks"),So=Sy(ad),Sr((Su=st((Sl=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"background",Su,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"show",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.background.node.active=!0;return[4,this.background.changeStateFade(!0,.25)];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"hide",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.background.changeStateFade(!1,.25)];case 1:g.sent(),this.background.node.active=!1;return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(D)).prototype,"background",[So],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ss=Sl))||Ss);_._RF.pop(),_._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var Sg,Sm,Sb,Sw,SS,SE="bomb";_._RF.pop(),_._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var S_,Sk,SC,SA,ST,SR,SI,SL,SP,SO,SB,SN,SD,SM,SF,SU,Sz,Sx,SG,SV,SK,SH=GameCore,Sq=SH.Dtos.Player,SW=SH.Utils.Function,Sj=k.ccclass,SX=k.property,SY=globalThis.game.player,SJ=(Sg=Sj("DevToolsContainer"),Sm=SX(C),Sg((SS=st((Sw=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"devToolsToggle",SS,Ke(g)),g.isActive=!0,g.game=null,g.bundleName="lowest",g.debouncedStarsNotification=SW.debounce(function(){var g=SY.getGameData();g&&l5.showNotificationScreen("Stars added. Current stars: ".concat(g.stars))},700),g}return Ue(o,[{key:"injectGameplay",value:function(g){this.game=g}},{key:"hideAllButtons",value:function(){var g,E=at(this.getComponentsInChildren(B));try{for(E.s();!(g=E.n()).done;){var _=g.value.node.parent;_&&_.name!==this.devToolsToggle.name&&(_.active=!1)}}catch(g){E.e(g)}finally{E.f()}}},{key:"showAllButtons",value:function(){var g,E=at(this.getComponentsInChildren(B));try{for(E.s();!(g=E.n()).done;){var _=g.value.node.parent;_&&_.name!==this.devToolsToggle.name&&(_.active=!0)}}catch(g){E.e(g)}finally{E.f()}}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){SY.setPlayerData(Sq.Data.getDefaultData()),l5.openScreen(ib.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(a2.START_OVER,0)}},{key:"handleNextLevel",value:(k=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){k=(null!==(g=null===(E=this.game)||void 0===E||null===(E=E.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:1)+1;null===(_=this.game)||void 0===_||_.setGameData({level:k-1}),SY.setGameData({level:k}),this.node.scene.emit(a2.NEXT_LEVEL);return[2]})}),function(){return k.apply(this,arguments)})},{key:"handlePrevLevel",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){k=Math.max((null!==(g=null===(E=this.game)||void 0===E||null===(E=E.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:2)-1,1);null===(_=this.game)||void 0===_||_.setGameData({level:k-1}),SY.setGameData({level:k}),this.node.scene.emit(a2.NEXT_LEVEL);return[2]})}),function(){return _.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(E=Be(function(g){var E,_;return _ts_generator(this,function(k){_=Number(g.string);null===(E=this.game)||void 0===E||E.setGameData({level:_-1}),SY.setGameData({level:_}),this.node.scene.emit(a2.NEXT_LEVEL);return[2]})}),function(g){return E.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var g=globalThis.game.getBuildVersion();l5.showNotificationScreen("Build version: ".concat(g))}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(a2.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){this.node.scene.emit(a2.TIME_OUT)}},{key:"handleClickExplodeButton",value:function(){var g,E,_=this.game;if(_){var k=null===(g=_.getGameData())||void 0===g||null===(g=g.levelData)||void 0===g?void 0:g.specials.bomb;if(k&&!(k<=0)){var C=_.board.getBombTiles();if(0!==C.length){var A=C[0];if((null===(E=A.special)||void 0===E?void 0:E.type)!==SE)throw new Error("Invalid bomb tile");A.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(a2.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.HINT,quantity:2}),this.node.scene.emit(a2.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.STORM,quantity:2}),this.node.scene.emit(a2.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.THUNDER,quantity:2}),this.node.scene.emit(a2.ADD_ITEM,{animate:function(){return Promise.resolve()},item:sN.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(a2.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var g=SY.getGameData();g&&(SY.setGameData({stars:g.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchQualityAssets",value:function(){switch(this.bundleName){case"lowest":this.bundleName="highest";break;case"highest":this.bundleName="lowest"}Q.emit(nr,{quality:this.bundleName})}}]),o}(D)).prototype,"devToolsToggle",[Sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sb=Sw))||Sb);_._RF.pop(),_._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var SQ,SZ,S$,S0,S1,S2,S4,S3,S5=k.ccclass,S6=k.property,S8=GameCore.Utils.Valid,S9=(S_=S5("UIManager"),Sk=S6(bl),SC=S6(b_),SA=S6(Sp),ST=S6(SJ),SR=S6(bI),SI=S6(bT),SL=S6(Sv),SP=S6([C]),SO=S6([C]),S_((SD=st((SN=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"interstitialAdIndicator",SD,Ke(g)),rt(g,"clock",SM,Ke(g)),rt(g,"header",SF,Ke(g)),rt(g,"devTools",SU,Ke(g)),rt(g,"comboProgressBar",Sz,Ke(g)),rt(g,"comboContainer",Sx,Ke(g)),rt(g,"uiMasks",SG,Ke(g)),rt(g,"topAnimNodes",SV,Ke(g)),g.originTopNodesPos=[],rt(g,"botAnimNodes",SK,Ke(g)),g.originBotNodesPos=[],g.hideBotWorldY=-80,g.entranceSignal=new nD,g.exitSignal=new nD,g.showDevTools=function(){g.devTools&&(g.devTools.node.active=!0)},g}return Ue(r,[{key:"onLoad",value:function(){var g=this;this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),N.once(e_.EVENT_AFTER_UPDATE,function(){g.saveOriginPos(),g.initUIPos()})}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var g,E=at(this.topAnimNodes);try{for(E.s();!(g=E.n()).done;){var _=g.value;this.originTopNodesPos.push(_.position.clone())}}catch(g){E.e(g)}finally{E.f()}var k,C=at(this.botAnimNodes);try{for(C.s();!(k=C.n()).done;){var A=k.value;this.originBotNodesPos.push(A.position.clone())}}catch(g){C.e(g)}finally{C.f()}}},{key:"initUIPos",value:function(){var g=this;this.topAnimNodes.forEach(function(E,_){var k=g.originTopNodesPos[_].clone();k.y+=200,E.setPosition(k)});var E=new em(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(function(_,k){var C,A,T=g.originBotNodesPos[k].clone();E.y=g.hideBotWorldY;var R=null!==(C=null===(A=_.parent)||void 0===A?void 0:A.inverseTransformPoint(E,E).y)&&void 0!==C?C:200;T.y=R,_.setPosition(T)})}},{key:"listensDevToolsEvents",value:function(){this.node.scene.on(sH.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}},{key:"listenRescueEvents",value:function(){this.node.scene.on(a2.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(a2.RESCUE_FINISHED,this.hideRescueAnimation,this)}},{key:"initDevTools",value:function(g){var E=this;window.addEventListener("reset-game-data",function(){var g;null===(g=E.devTools)||void 0===g||g.handleResetData()}),this.devTools&&(this.devTools.node.active=S8.isDebugger(),this.devTools.injectGameplay(g))}},{key:"setLevelText",value:function(g){this.header.setLevelText(g)}},{key:"initCountdown",value:function(){this.clock.init()}},{key:"setCountdownTime",value:function(g){this.clock.setTime(g)}},{key:"startCountdown",value:function(){this.clock.startCountdown(),this.comboProgressBar.resume()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause(),this.clock.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume(),this.clock.resume()}},{key:"setComboUI",value:function(g){this.comboContainer.getComponent(ad).changeStateFade(g,.1)}},{key:"disableHeader",value:function(){this.header.setButtonsSelectable(!1)}},{key:"enableHeader",value:function(){this.header.setButtonsSelectable()}},{key:"updateStatus",value:function(){this.header.updateStatus(),this.comboContainer.updateStatus()}},{key:"showRescueAnimation",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.uiMasks.show()];case 1:g.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"hideRescueAnimation",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.uiMasks.hide()];case 1:g.sent();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"playExitAnimUI",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I,L,P;return _ts_generator(this,function(O){switch(O.label){case 0:g=this;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new nD;E=[];this.topAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originTopNodesPos[k].y+200,0),A=x(_);A.to(.17,{position:C},{easing:"backIn"}),E.push(tZ.runTweenAsync(A,g.exitSignal))});k=new em(0,this.hideBotWorldY,0),C=at(this.botAnimNodes);try{for(C.s();!(_=C.n()).done;){R=_.value;k.y=this.hideBotWorldY;I=null!==(A=null===(T=R.parent)||void 0===T?void 0:T.inverseTransformPoint(k,k).y)&&void 0!==A?A:200,L=new em(R.position.x,I,0),P=x(R);P.to(.17,{position:L},{easing:"backIn"}),E.push(tZ.runTweenAsync(P,this.exitSignal))}}catch(g){C.e(g)}finally{C.f()}return[4,Promise.all(E)];case 1:O.sent(),this.exitSignal.aborted||this.header.setActive(!1);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new nD,this.header.setActive(!0);E=[];this.topAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originTopNodesPos[k].y,0),A=x(_);A.to(.2,{position:C},{easing:"backOut"}),E.push(tZ.runTweenAsync(A,g.entranceSignal))}),this.botAnimNodes.forEach(function(_,k){var C=new em(_.position.x,g.originBotNodesPos[k].y,0),A=x(_);A.to(.2,{position:C},{easing:"backOut"}),E.push(tZ.runTweenAsync(A,g.entranceSignal))});return[4,Promise.all(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"setInteractableItemButtons",value:function(g){var E,_=!(arguments.length>0&&void 0!==g)||g,k=at(this.botAnimNodes);try{for(k.s();!(E=k.n()).done;){var C=E.value,A=C.getComponent(mn);if(A){if(!_){A.button.interactable=!1;continue}A.canActivate()&&(A.button.interactable=!0)}}}catch(g){k.e(g)}finally{k.f()}}}]),r}(D)).prototype,"interstitialAdIndicator",[Sk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SM=st(SN.prototype,"clock",[SC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SF=st(SN.prototype,"header",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SU=st(SN.prototype,"devTools",[ST],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sz=st(SN.prototype,"comboProgressBar",[SR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sx=st(SN.prototype,"comboContainer",[SI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SG=st(SN.prototype,"uiMasks",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SV=st(SN.prototype,"topAnimNodes",[SP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SK=st(SN.prototype,"botAnimNodes",[SO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SB=SN))||SB);_._RF.pop(),_._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var S7=globalThis.game,Ee=S7.player,Et=S7.ads,En=S7.event,Ei=S7.match,Ea=S7.storage,Er=S7.analytics,Eo=S7.monitorError,Es=S7.frameCapture,El=S7.leaderboard,Ec=GameCore,Eh=Ec.Events,Ep=Ec.Utils,Ef=Ep.Time,Ey=Ep.Array,Ev=Ec.Configs.Gameplay,Eg=Ec.Match.Modes,Em=k.ccclass,Eb=k.property,Ew=[];SQ=Em("Gameplay"),SZ=Eb(c_),S$=Eb(ad),S0=Eb(ha),SQ((S2=st((S1=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"board",S2,Ke(g)),rt(g,"opacityToggler",S4,Ke(g)),rt(g,"pathDraw",S3,Ke(g)),g.gameData=null,g.defaultData={level:1,isFromLoader:!1},g.rescueTiles=[],g.isAutoPlayEnabled=!1,g.handleOpenScreen=function(E){E.screenName===iw[ib.GET_ITEM_SCREEN]&&g.uiManager.highlightCoinContainer()},g.handleShowUI=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.uiManager.updateStatus(),g.uiManager.disableHeader(),g.uiManager.setInteractableItemButtons(!1);return[4,g.uiManager.playEntranceAnimUI()];case 1:E.sent(),g.uiManager.enableHeader(),g.uiManager.setInteractableItemButtons(!0);return[2]}})}),g.handleHideUI=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.uiManager.disableHeader(),g.uiManager.setInteractableItemButtons(!1);return[4,g.uiManager.playExitAnimUI()];case 1:E.sent();return[2]}})}),g.handleCloseScreen=function(E){E.screenName===iw[ib.GET_ITEM_SCREEN]&&g.uiManager.unHighlightCoinContainer()},g.handlePauseGame=function(){g.node.scene.emit(a2.PAUSE_TIME),g.node.pauseSystemEvents(!0),g.opacityToggler.changeStateFade(!1,.1),g.uiManager.setComboUI(!1),g.processCrazyGamesGameplayStop()},g.handleResumeGame=function(){var E;g.node.resumeSystemEvents(!0),g.stateManager.isPlaying()&&g.node.scene.emit(a2.RESUME_TIME),g.processCrazyGamesGameplayStart(),g.opacityToggler.changeStateFade(!0,.1),g.uiManager.setComboUI(!0),null===(E=g.guidelinesManager)||void 0===E||E.startAutoGuides()},g.handleReplayGame=Be(function(){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g.handleHideHint();A.label=1;case 1:A.trys.push([1,6,,7]);E=lT.getMatchMode();_=E===Eg.SINGLE;if(!_)return[3,3];return[4,lT.finishMatchAsync()];case 2:_=A.sent();A.label=3;case 3:k=E!==Eg.CHALLENGE_FRIEND;if(!k)return[3,5];return[4,lT.startMatchAsync()];case 4:k=A.sent();A.label=5;case 5:E===Eg.TOURNAMENT&&(g.scoreManager.resetTournamentStartScore(),g.setGameData({level:1}));return[3,7];case 6:C=A.sent();console.warn("handleReplayGame",C);return[3,7];case 7:g.stateManager.initialize();return[2]}})}),g.handleFinishGame=function(){var E;g.attemptCallCreateShortcut(),null!==(E=g.guidelinesManager)&&void 0!==E&&E.isNewbieGuideLevel()?(g.guidelinesManager.guideSkipButton.active=!1,g.handleNextLevel()):g.stateManager.finish()},g.handleNextLevel=Be(function(){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!g.gameData)return[3,12];_=lT.getMatchMode();A.label=1;case 1:A.trys.push([1,5,,6]);if(_!==Eg.SINGLE)return[3,3];return[4,lT.finishMatchAsync()];case 2:A.sent();return[3,4];case 3:_===Eg.TOURNAMENT&&g.scoreManager.updateTournamentStartScore();A.label=4;case 4:return[3,6];case 5:k=A.sent();console.warn("handleNextLevel",k);return[3,6];case 6:C=(null!==(E=g.gameData.level)&&void 0!==E?E:1)+1;g.setGameData({level:C});if(_!==Eg.TOURNAMENT)return[3,8];return[4,lT.setMatchCustomDataAsync({level:C})];case 7:A.sent();return[3,11];case 8:return[4,lT.setMatchCustomDataAsync({level:C,score:0})];case 9:A.sent();return[4,lT.startMatchAsync()];case 10:A.sent();A.label=11;case 11:g.stateManager.initialize(),console.log("Next level",g.gameData.level);A.label=12;case 12:return[2]}})}),g.handleStartOver=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){Ee.setGameData({level:null!=E?E:1}),g.gameData=Ee.getGameData(),g.stateManager.initialize(),console.info("Start over",null===(_=g.gameData)||void 0===_?void 0:_.level);return[2]})});return function(g){return E.apply(this,arguments)}}(),g.handleMaxLevel=function(){g.gameData&&(g.initData(),l5.openScreen(ib.CONGRATULATION_SCREEN,{level:g.gameData.level}),console.info("Max level",g.gameData.level))},g.handleExitGame=Be(function(){return _ts_generator(this,function(g){try{Ea.setStorageData("dashboard","animateToCurrentLevel",!0),Ea.setStorageData("collection","animateMapPackUnlock",!0)}catch(g){console.warn("handleExitGame",g)}return[2]})}),g.handleTileClick=function(E){g.stateManager.playing(),g.board.handleTileClick(E),g.handleHideHint()},g.handleGridMatchSuccess=function(E,_){g.pathDraw.drawMatchPath(E,function(E){var _=E.x,k=E.y;return g.board.getAnyTileWorldPosition(_,k)}),g.comboManager.addCombo(),g.handleAddScore(),g.effectManager.playClearEffectAt([_[0].node.worldPosition,_[1].node.worldPosition])},g.handleGridMatchFail=function(E){var _;null!==(_=g.guidelinesManager)&&void 0!==_&&_.isShowErrorPathLevel()&&g.pathDraw.drawErrorPath(E,function(E){var _=E.x,k=E.y;return g.board.getAnyTileWorldPosition(_,k)})},g.checkIfGameIsFinish=function(){0===g.board.getUncleared().length&&g.node.scene.emit(a2.GAME_FINISH)},g.handlePauseTime=function(){g.uiManager.pauseTime()},g.handleResumeTime=function(){g.uiManager.resumeTime()},g.handleClockTimeout=function(){g.stateManager.fail(us)},g.handleHalfTime=function(){void 0!==g.guidelinesManager&&(g.board.getUncleared().length>=g.board.getCleared().length&&g.guidelinesManager.startThunderGuide()||g.board.getBombTiles().length>0&&g.guidelinesManager.startPliersGuide())},g.handleStartRescue=function(){var E,_;for(i8.turnDownMusic(),ie.setBlockInput(!0),g.board.setIgnoreInput(!0);g.rescueTiles.length>0;){var k=g.rescueTiles.pop();null==k||k.restore()}var C=lT.getMatchMode()||void 0;Er.levelRescue(null!==(E=null===(_=g.gameData)||void 0===_?void 0:_.level)&&void 0!==E?E:1,void 0,C)},g.handleFinishRescue=function(){ie.setBlockInput(!1),g.board.setIgnoreInput(!1)},g.handleBombExplode=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:g.rescueTiles.push(E),g.board.setIgnoreInput(!0),ie.getBlockInput()||(i8.playSound(ih.BOMB_EXPLODE_1),ie.setBlockInput(!0));_=E.node.worldPosition;return[4,g.effectManager.createBombExplosionAt(new em(_.x,_.y,0))];case 1:k.sent(),ie.setBlockInput(!1),g.stateManager.isFail()||g.stateManager.fail(ul);return[2]}})});return function(g){return E.apply(this,arguments)}}(),g.handleShowHint=function(){if(!g.pathDraw.isDrawingHint){var E=g.board.getHintPath();E&&(i8.playSound(ih.HINT_ITEM),g.pathDraw.drawHintPath(E,function(E){return g.board.getAnyTileWorldPosition(E.x,E.y)}),g.board.showHint())}},g.handleHideHint=function(){g.pathDraw.isDrawingHint&&(g.pathDraw.clearHintPath(),g.board.hideHint())},g.handleAddScore=function(){var E=g.levelManager.getLevelData().level,_=g.comboManager.getCombo(),k=g.uiManager.clock.getRemainingTime();g.scoreManager.addScore(E,_,k)},g.handleUseItem=function(E){g.stateManager.playing(),E!==sN.HINT&&g.handleHideHint()},g.handleAutoPlay=function(){g.isAutoPlayEnabled?g.disableAutoPlay():g.enableAutoPlay()},g.enableAutoPlay=function(){g.isAutoPlayEnabled=!0;g.node.scene.once(a2.GAME_FINISH,function(){g.disableAutoPlay()}),g.schedule(g.autoPlay,.5)},g.disableAutoPlay=function(){g.isAutoPlayEnabled=!1,g.unschedule(g.autoPlay)},g.autoPlay=function(){var E=g.board.getHintPath();if(!E)throw new Error("No path found");var _=E[0].a,k=E.slice(-1)[0].b,C=g.board.getTileAt(_.x,_.y),A=g.board.getTileAt(k.x,k.y);if(!C||!A)throw new Error("Tile is null");C.onClick(),A.onClick()},g.handleAddStars=function(E){var _=Ee.getGameData();if(!_)return Promise.resolve([]);Ee.setGameData({stars:_.stars+1});var k=E.startAnimationAt;k&&g.effectManager.playStarEffectAt(k)},g.handleInviteFriends=Be(function(){var E,_,k,C,A,T,R,I,L,P,O,B,N,D;return _ts_generator(this,function(M){switch(M.label){case 0:M.trys.push([0,2,,3]);l5.showLoadingScreen();C=g.board.generateFenFromCurrentLevel(),A=(null!==(E=Ee.getGameData())&&void 0!==E?E:{}).level,T=void 0===A?1:A;T=Math.max(1,T);R=null!==(_=null===(k=g.gameData)||void 0===k?void 0:k.levelData)&&void 0!==_?_:{},I=R.mode,L=void 0===I?"":I,P=R.rules,O=void 0===P?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:P,B=R.time,N=void 0===B?0:B;Es.addWideframeRender("renderResultChallenge",s7);return[4,Ei.context.choose.processAsync({playerId:Ee.getPlayerId(),fallbackSingleMode:!1,extraData:{level:T,fen:C,gravity:L,rules:O,time:N}})];case 1:M.sent(),l5.closeLoadingScreen(),g.node.scene.emit(a2.GAME_RESUME),g.node.scene.emit(a2.GAME_REPLAY,{level:T});return[3,3];case 2:D=M.sent();if(console.warn("Unable to invite friends",D),l5.closeLoadingScreen(),l5.showNotificationScreen("Sorry, please try again later"),!_instanceof(D,Error))return[2];null==Eo||Eo.sendException(D),g.node.scene.emit(a2.GAME_RESUME),g.node.scene.emit(a2.SHOW_UI);return[3,3];case 3:return[2]}})}),g.handleAdShow=function(E){var _=E.placementId;_&&-1!==Ew.indexOf(_)&&(Ew.splice(Ew.indexOf(_),1),Et.hideBannerAdAsync(_).catch(function(){}),0===Ew.length&&En.off(Eh.AD_SHOWING,g.handleAdShow))},g.handleAddItem=function(){var E=Be(function(E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=E.animate,k=E.item,C=E.quantity,A=Ey.search(g.itemManager.items,function(g){return g.itemType===k});if(!(void 0!==A))return[3,2];T=A.getQuantity()+C;A.saveQuantity(T),g.uiManager.setInteractableItemButtons(!1),g.handlePauseGame();return[4,_()];case 1:R.sent(),A.setQuantity(T,!0),g.uiManager.setInteractableItemButtons(!0),g.handleResumeGame();return[3,3];case 2:console.warn("Item ".concat(k," not found"));R.label=3;case 3:return[2]}})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(a,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function(){lh.init()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}},{key:"initUIManager",value:function(){var g;this.uiManager=null===(g=this.node.parent)||void 0===g?void 0:g.getComponentInChildren(S9),this.uiManager.initDevTools(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(mp)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(m7)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(uu)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(va)}},{key:"initItemManager",value:function(){this.itemManager=this.getComponent(ma),this.itemManager.syncItems();var g,E=at(this.itemManager.items);try{for(E.s();!(g=E.n()).done;)g.value.init(this)}catch(g){E.e(g)}finally{E.f()}}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(hb),this.comboManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(mv),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){Ev.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(g9),this.guidelinesManager.init(this))}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){Ew=[],En.off(Eh.AD_SHOWING,this.handleAdShow),En.clear(Eh.OPENING_SCREEN),En.clear(Eh.CLOSING_SCREEN),En.on(Eh.OPENING_SCREEN,this.handleOpenScreen),En.on(Eh.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(a2.SHOW_UI,this.handleShowUI),this.node.scene.on(a2.HIDE_UI,this.handleHideUI),this.node.scene.on(a2.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(a2.GAME_RESUME,this.handleResumeGame),this.node.scene.on(a2.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(a2.GAME_FINISH,this.handleFinishGame),this.node.scene.on(a2.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(a2.START_OVER,this.handleStartOver),this.node.scene.on(a2.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(a2.GAME_EXIT,this.handleExitGame),this.node.scene.on(a2.TILE_CLICK,this.handleTileClick),this.node.scene.on(a2.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(a2.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(a2.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(a2.RESUME_TIME,this.handleResumeTime),this.node.scene.on(a2.TIME_OUT,this.handleClockTimeout),this.node.scene.on(a2.HALF_TIME,this.handleHalfTime),this.node.scene.on(a2.RESCUE_START,this.handleStartRescue),this.node.scene.on(a2.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(a2.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(a2.SHOW_HINT,this.handleShowHint),this.node.scene.on(a2.ADD_SCORE,this.handleAddScore),this.node.scene.on(a2.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(a2.USE_ITEM,this.handleUseItem),this.node.scene.on(a2.ADD_ITEM,this.handleAddItem),this.node.scene.on(a2.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(a2.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(a2.INVITE_FRIENDS,this.handleInviteFriends)}},{key:"start",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.initDataFirstTime();return[4,this.tryInitTournamentMode()];case 1:g.sent(),this.initGame();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"initDataFirstTime",value:function(){var g,E,_=this.getSceneData(),k=(null!=_?_:{}).isFromLoader,C=void 0!==k&&k,A=(null!=_?_:{}).level;void 0===A&&(A=lT.getMatchMode()===Eg.TOURNAMENT?1:null!==(g=null===(E=Ee.getGameData())||void 0===E?void 0:E.level)&&void 0!==g?g:0);this.initData(),this.setGameData({level:A,isFromLoader:C})}},{key:"initData",value:function(){var g,E=this.getSceneData(),_=(null!=E?E:{}).isFromLoader,k=void 0!==_&&_,C=null!==(g=Ee.getGameData())&&void 0!==g?g:{},A=C.level,T=void 0===A?1:A,R=C.items;0===T&&k&&R?(R.hint=2,R.thunder=1,R.storm=1,R.pliers=0,Ee.setGameData({items:R,coins:500,lastRewardedItems:Date.now()}),this.node.scene.emit(a2.ADD_COINS,{coins:500,playSound:!1})):R&&this.checkItemsRewardable()&&(R.hint<5&&(R.hint+=1),R.thunder<5&&(R.thunder+=1),R.storm<5&&(R.storm+=1),R.pliers<5&&(R.pliers+=1),Ee.setGameData({items:R,lastRewardedItems:Date.now()})),this.setGameData(De(De({},this.defaultData),{},{level:T}))}},{key:"checkItemsRewardable",value:function(){var g,E=(null!==(g=Ee.getGameData())&&void 0!==g?g:{}).lastRewardedItems,_=void 0===E?0:E;return!Ef.isToday(_)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"tryInitTournamentMode",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,L,P,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:if(lT.getMatchMode()!==Eg.TOURNAMENT)return[3,8];_=null!==(g=lT.getMatchCustomData())&&void 0!==g?g:{},k=_.leaderboardId,C=_.tournamentId;if(!(k&&C))return[3,8];return[4,ur.requestTournamentDataAsync()];case 1:N.sent();A=ur.getTournamentDataById(C);if(!A)return[3,8];T=A.payload.themeId;this.setGameData({themeId:T});R=El.getLeaderboardName(k);if(!R)return[3,8];I=null;if(!(null!==(E=this.gameData)&&void 0!==E&&E.isFromLoader))return[3,3];return[4,li.getAllLeaderboardAsync(k)];case 2:I=N.sent();return[3,5];case 3:return[4,li.waitForLeaderboardFinishAsync(R)];case 4:N.sent(),I=El.getLeaderboard(R);N.label=5;case 5:if(!I)return[3,8];this.uiManager.header.tournamentRail.init(I);L=Ee.getPlayerId(),P=I.leaders[L];if(!!P)return[3,7];return[4,El.getLeadersByPlayerIdsAsync(R,[L])];case 6:O=N.sent();if(0===O.length)return[2];P=O[0];N.label=7;case 7:B=P.score;Ea.setStorageData("tournament","previousScore",B);N.label=8;case 8:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setGameData",value:function(g){var E,_,k,C=null!==(E=null!==(_=g.level)&&void 0!==_?_:null===(k=this.gameData)||void 0===k?void 0:k.level)&&void 0!==E?E:1;this.gameData=De(De(De({},this.gameData),g),{},{level:C})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return lV.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var g,E=null!==(g=this.getGameData())&&void 0!==g?g:{},_=E.level,k=void 0===_?0:_,C=E.nextLevelCount;k<2||(void 0===C?0:C)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch(function(g){console.warn("checkAndCreateShortcutAsync",g)})}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),a}(D)).prototype,"board",[SZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S4=st(S1.prototype,"opacityToggler",[S$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S3=st(S1.prototype,"pathDraw",[S0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S1));_._RF.pop(),_._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var ES=function(g){return g[g.STAR_CHEST=0]="STAR_CHEST",g[g.BALLOON=1]="BALLOON",g}(ES||{});Z(ES),_._RF.pop(),_._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var EE=function(g){return g.WORLD_TAB_SELECTED="world-tab-selected",g.FRIENDS_TAB_SELECTED="friends-tab-selected",g}(EE||{}),E_="#AE4212",Ek="#3D5172",EC="#92200C",EA="#8F5542",ET="#8A4733",ER="#3e7110",EI="#3e7110";_._RF.pop(),_._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),_._RF.pop(),_._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);_._RF.pop(),_._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),_._RF.pop(),_._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),_._RF.pop(),_._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var EL=k.ccclass,EP=globalThis.game,EO=EP.player,EB=EP.analytics,EN=GameCore.Plugins.Analytics.Events;EL("HintItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l5.openScreen(ib.GET_ITEM_SCREEN,{item:sN.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},g.loadQuantity=function(){var g=EO.getGameData();return null!=g&&g.items&&g?g.items[sN.HINT]:0},g}return Ue(i,[{key:"itemType",get:function(){return sN.HINT}},{key:"init",value:function(g){this.boardInstance=g.board,this.pathDrawer=g.pathDraw,this.setQuantity(this.loadQuantity()),Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nC.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>0}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:g=this.pathDrawer.isDrawingHint;if(g)return[3,5];if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:E=_.sent();return[3,4];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:E=(_.sent(),EB.event(EN.USE_ITEM,{item_name:sN.HINT}),this.node.scene.emit(a2.USE_ITEM,sN.HINT),this.node.scene.emit(a2.SHOW_HINT));_.label=4;case 4:g=E;_.label=5;case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=EO.getGameData();C&&EO.setGameData({items:De(De({},C.items),{},Ge({},sN.HINT,_))})}}]),i}(mn));_._RF.pop(),_._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var ED=k.ccclass,EM=globalThis.game,EF=EM.player,EU=EM.analytics,Ez=GameCore.Plugins.Analytics.Events;ED("PliersItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l5.openScreen(ib.GET_ITEM_SCREEN,{item:sN.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},g.loadQuantity=function(){var g=EF.getGameData();return null!=g&&g.items&&g?g.items[sN.PLIERS]:0},g}return Ue(i,[{key:"itemType",get:function(){return sN.PLIERS}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nC.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getBombTiles().length>0}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:_.sent();return[3,4];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:_.sent(),EU.event(Ez.USE_ITEM,{item_name:sN.PLIERS}),this.node.scene.emit(a2.USE_ITEM,sN.PLIERS);g=Vh(this.boardInstance.getBombTiles()),E=g.node.worldPosition;this.effectManager.createDefuseExplosionAt(new em(E.x,E.y,0)),i8.playSound(ih.BOMB_DEFUSE),g.special.switch(uX.none),this.applyActivationStatus();_.label=4;case 4:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=EF.getGameData();C&&EF.setGameData({items:De(De({},C.items),{},Ge({},sN.PLIERS,_))})}}]),i}(mn));_._RF.pop(),_._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var Ex=k.ccclass,EG=globalThis.game,EV=EG.player,EK=EG.analytics,EH=GameCore.Plugins.Analytics.Events;Ex("StormItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l5.openScreen(ib.GET_ITEM_SCREEN,{item:sN.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},g.loadQuantity=function(){var g=EV.getGameData();return null!=g&&g.items&&g?g.items[sN.STORM]:0},g}return Ue(i,[{key:"itemType",get:function(){return sN.STORM}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nC.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>2}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this;if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:k.sent();return[3,6];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:if(k.sent(),EK.event(EH.USE_ITEM,{item_name:sN.STORM}),this.node.scene.emit(a2.USE_ITEM,sN.STORM),this.node.scene.emit(a2.HIDE_UI),!this.effectManager)return[3,6];return[4,tZ.waitTweenAsync(.5)];case 4:E=k.sent();return[4,Promise.race([this.effectManager.loadTornadoAnimation(),E])];case 5:if(k.sent(),this.effectManager){_=function(){var E=Be(function(E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:i8.setVolumeMusic(0,!0),i8.playSound(ih.SHUFFLE_ITEM),i8.playSound(ih.WIND);k=function(){var E=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:_.forEach(function(g,E,k){g.node.setSiblingIndex(_.asArray().length-1-(E+k*_.width))});return[4,Promise.all(_.map(function(E){return E.fly({getTilePosition:function(E){return Nh(_,g.boardInstance.getTileSize(),E)}})}))];case 1:E.sent();return[2]}})});return function(){return E.apply(this,arguments)}}();return[4,Promise.all(E.map(function(_,k,C){return _.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return Nh(E,g.boardInstance.getTileSize(),{x:k,y:C},10)}})}))];case 1:C.sent(),g.effectManager.playTornadoAnimation();return[4,k()];case 2:C.sent(),g.node.scene.emit(a2.SHOW_UI),i8.setVolumeMusic(.3,!0);return[2]}})});return function(g,_){return E.apply(this,arguments)}}();this.boardInstance.processShuffleRequest(_)}k.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=EV.getGameData();C&&EV.setGameData({items:De(De({},C.items),{},Ge({},sN.STORM,_))})}}]),i}(mn));_._RF.pop(),_._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var Eq,EW,Ej,EX,EY,EJ,EQ,EZ,E$,E0,E1,E2,E4,E3,E5,E6,E8,E9,E7=k.ccclass,_e=globalThis.game,_t=_e.player,_n=_e.analytics,_i=GameCore.Plugins.Analytics.Events;E7("ThunderItem")(function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return(g=_.call.apply(_,[this].concat(k))).requestItem=function(){l5.openScreen(ib.GET_ITEM_SCREEN,{item:sN.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},g.loadQuantity=function(){var g=_t.getGameData();return null!=g&&g.items&&g?g.items[sN.THUNDER]:0},g}return Ue(i,[{key:"itemType",get:function(){return sN.THUNDER}},{key:"init",value:function(g){this.boardInstance=g.board,this.effectManager=g.effectManager,Je(Ve(i.prototype),"init",this).call(this,g)}},{key:"onDestroy",value:function(){var g;if(this.boardInstance){this.node.scene.targetOff(this);var E,_=this.boardInstance.node;if(null!=_)this.boardInstance.node.targetOff(this),null===(g=Je(Ve(i.prototype),"onDestroy",this))||void 0===g||g.call(this);else null===(E=Je(Ve(i.prototype),"onDestroy",this))||void 0===E||E.call(this)}}},{key:"validateRequiredComponents",value:function(){Je(Ve(i.prototype),"validateRequiredComponents",this).call(this),nC.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>=4}catch(g){return!1}}},{key:"activate",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(this.getQuantity()<=0))return[3,2];return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 1:_.sent();return[3,6];case 2:return[4,Je(Ve(i.prototype),"activate",this).call(this)];case 3:_.sent(),_n.event(_i.USE_ITEM,{item_name:sN.THUNDER}),this.node.scene.emit(a2.USE_ITEM,sN.THUNDER),this.node.scene.emit(a2.HIDE_UI);return[4,this.effectManager.loadThunderAnimation()];case 4:_.sent();g=this.boardInstance.getUncleared();if(g.length<4)return[3,6];i8.setVolumeMusic(0,!0);E=this.boardInstance.getPairs(2);ie.setBlockInput(!0),this.boardInstance.clearSelectedTile();return[4,this.effectManager.playThunderAnimation(E,this.boardInstance)];case 5:_.sent(),(g=this.boardInstance.getUncleared()).length>0&&this.node.scene.emit(a2.SHOW_UI),i8.setVolumeMusic(.3,!0),ie.setBlockInput(!1);_.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"saveQuantity",value:function(g,E){var _=arguments.length>0&&void 0!==g?g:this.getQuantity(),k=arguments.length>1?E:void 0;Je(Ve(i.prototype),"saveQuantity",this).call(this,_,k);var C=_t.getGameData();C&&_t.setGameData({items:De(De({},C.items),{},Ge({},sN.THUNDER,_))})}}]),i}(mn));_._RF.pop(),_._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var _a,_r,_o,_s,_l,_u,_c,_h,_p,_d,_f,_y=k.ccclass,_v=k.property,_g=(Eq=_y("Coin"),EW=_v(eK),Ej=_v(G),EX=_v(ei),EY=_v(ei),EJ=nC.onlyRunInLifeCycle,EQ=nC.onlyRunInLifeCycle,EZ=nC.onlyRunInLifeCycle,E$=nC.onlyRunInLifeCycle,E0=nC.onlyRunInLifeCycleAsync,E1=nC.onlyRunInLifeCycleAsync,E2=nC.onlyRunInLifeCycle,Eq((E5=st((E3=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"emittingParticles",E5,Ke(g)),rt(g,"animation",E6,Ke(g)),rt(g,"spin",E8,Ke(g)),rt(g,"rest",E9,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){nC.lazyValidateProperties(this)}},{key:"resetDisabled",value:function(){this.stopParticles(),this.stopAnimation(),this.hide(),this.node.active=!1,this.node.setPosition(0,0,this.node.position.z)}},{key:"hide",value:function(){this.node.setScale(em.ZERO)}},{key:"stopParticles",value:function(){this.emittingParticles.stopSystem()}},{key:"playTrailParticles",value:function(){this.emittingParticles.resetSystem()}},{key:"playSpinAnimationAfterDelay",value:(E=Be(function(){var g,E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:g=k.length>0&&void 0!==k[0]?k[0]:0,E=k.length>1?k[1]:void 0;_=g>0;if(!_)return[3,2];return[4,tZ.waitTweenAsync(g)];case 1:_=C.sent();C.label=2;case 2:return[4,this.playSpinAnimation(E)];case 3:C.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"playSpinAnimation",value:function(g){return tZ.runAnimationAsync(this.animation,this.spin.name,g)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),i}(D)).prototype,"emittingParticles",[EW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E6=st(E3.prototype,"animation",[Ej],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E8=st(E3.prototype,"spin",[EX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E9=st(E3.prototype,"rest",[EY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(E3.prototype,"resetDisabled",[EJ],Object.getOwnPropertyDescriptor(E3.prototype,"resetDisabled"),E3.prototype),st(E3.prototype,"hide",[EQ],Object.getOwnPropertyDescriptor(E3.prototype,"hide"),E3.prototype),st(E3.prototype,"stopParticles",[EZ],Object.getOwnPropertyDescriptor(E3.prototype,"stopParticles"),E3.prototype),st(E3.prototype,"playTrailParticles",[E$],Object.getOwnPropertyDescriptor(E3.prototype,"playTrailParticles"),E3.prototype),st(E3.prototype,"playSpinAnimationAfterDelay",[E0],Object.getOwnPropertyDescriptor(E3.prototype,"playSpinAnimationAfterDelay"),E3.prototype),st(E3.prototype,"playSpinAnimation",[E1],Object.getOwnPropertyDescriptor(E3.prototype,"playSpinAnimation"),E3.prototype),st(E3.prototype,"stopAnimation",[E2],Object.getOwnPropertyDescriptor(E3.prototype,"stopAnimation"),E3.prototype),E4=E3))||E4);_._RF.pop(),_._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var _m,_b,_w,_S,_E,__,_k,_C,_A,_T,_R,_I,_L,_P,_O,_B,_N,_D,_M=k.ccclass,_F=k.property,_U=em.ZERO.clone().add3f(0,-100,0),_z=em.ZERO.clone().add3f(0,100,0),_x=GameCore.Utils.Number,_G=(_a=_M("CoinTextPopup"),_r=_F(L),_o=_F(eu),_s=nC.onlyRunInLifeCycle,_l=nC.onlyRunInLifeCycle,_u=nC.onlyRunInLifeCycleAsync,_c=nC.onlyRunInLifeCycleAsync,_a((_d=st((_p=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"label",_d,Ke(g)),rt(g,"uiOpacity",_f,Ke(g)),g}return Ue(o,[{key:"__preload",value:function(){nC.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(k=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:this.enableNode(),this.initializePopup(g);return[4,this.showTextPopupAnimation(E)];case 1:_.sent();return[4,this.hidePopup()];case 2:_.sent(),this.disableNode();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"enableNode",value:function(){this.node.active=!0}},{key:"disableNode",value:function(){this.node.active=!1}},{key:"initializePopup",value:function(g){var E=_x.getShortNumber(g,3);this.label.string=E,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(_U)}},{key:"hidePopup",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.node.setScale(em.ONE),this.node.setPosition(_z);return[4,tZ.runTweenAsync(x(this.uiOpacity).to(.5,{opacity:0}))];case 1:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"showTextPopupAnimation",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all([tZ.runTweenAsync(x(this.node).to(1.5,{position:_z},{easing:"sineOut"}),g),tZ.runTweenAsync(x(this.node).to(.5,{scale:em.ONE},{easing:"backOut"}),g)])];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})}]),o}(D)).prototype,"label",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_f=st(_p.prototype,"uiOpacity",[_o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(_p.prototype,"disableNode",[_s],Object.getOwnPropertyDescriptor(_p.prototype,"disableNode"),_p.prototype),st(_p.prototype,"initializePopup",[_l],Object.getOwnPropertyDescriptor(_p.prototype,"initializePopup"),_p.prototype),st(_p.prototype,"hidePopup",[_u],Object.getOwnPropertyDescriptor(_p.prototype,"hidePopup"),_p.prototype),st(_p.prototype,"showTextPopupAnimation",[_c],Object.getOwnPropertyDescriptor(_p.prototype,"showTextPopupAnimation"),_p.prototype),_h=_p))||_h);_._RF.pop(),_._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var _V,_K=k.ccclass,_H=k.disallowMultiple,_q=k.property,_W=globalThis.game,_j=_W.player,_X=_W.monitorError,_Y=999999999,_J=10,_Q=1,_Z=1,_$=(_m=_K("CoinManager"),_b=nC.required(),_w=_q(ee),_S=nC.required(),_E=_q(ee),__=nC.required(),_k=_q(C),_C=nC.onlyRunInLifeCycleAsync,_A=nC.onlyRunInLifeCycleAsync,_T=nC.onlyRunInLifeCycleAsync,_R=nC.onlyRunInLifeCycleAsync,_I=nC.onlyRunInLifeCycleAsync,_L=nC.onlyRunInLifeCycleAsync,_m(_P=_H((_B=st((_O=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=A.call.apply(A,[this].concat(_))).coins=0,rt(g,"coinPrefab",_B,Ke(g)),rt(g,"coinTextPopup",_N,Ke(g)),rt(g,"coinAnimContainer",_D,Ke(g)),g.coinObjects=[],g}return Ue(r,[{key:"onLoad",value:function(){nC.decorateComponent(this),this.getCoinsFromPlayerData(),this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(){this.updateCoins({coins:this.coins})}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(a2.ADD_COINS,this.addCoins,this),this.node.scene.on(a2.REMOVE_COINS,this.removeCoins,this),this.node.scene.on(a2.ABORT_COIN_ANIMATION,this.abortCoinAnimation,this)}},{key:"prepareCoinCollection",value:function(){for(var g=0;g<_J;g++){var E=I(this.coinPrefab);E.setParent(this.coinAnimContainer),E.setPosition(0,0),E.active=!1,this.coinObjects.push(E.getComponent(_g))}}},{key:"prepareCoinTextPopup",value:function(){var g=I(this.coinTextPopup);g.setParent(this.node),g.active=!1,this.coinTextPopupNode=g.getComponent(_G)}},{key:"handleCollectionAnim",value:(C=Be(function(g,E,_,k,C){var A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this;if(!E)return[3,2];T=this.coinObjects.slice(0,this.getShortAmount(g));if(0===T.length)return[2,(console.warn("Requested coins amount is ".concat(g,". Shortened to ").concat(this.getShortAmount(g),". No coin objects was found to animate collection.")),void(null==_X||_X.sendException(new Error("Requested coins amount is ".concat(g,". Shortened to ").concat(this.getShortAmount(g),". No coin objects was found to animate collection.")),{coins:g,animatedCoins:T.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!E,coinCollectionCount:this.coinObjects.length})))];i8.playSound(ih.COLLECT_STOCK_COINS);return[4,Promise.all([this.playCoinFlyAndexplodeAnimation(E,T,_,k,C),tZ.waitTweenAsync(_+k/2,C).then(function(){return A.animateCoinTextPopup(g,C)})])];case 1:R.sent(),C.abort();return[3,3];case 2:console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played");R.label=3;case 3:return[2]}})}),function(g,E,_,k,A){return C.apply(this,arguments)})},{key:"playCoinFlyAndexplodeAnimation",value:(k=Be(function(g,E,_,k,C){var A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this,T=_+k;return[4,Promise.all([].concat(tt(E.flatMap(function(E){E.node.active=!0,E.stopParticles();var T=[0,.5*Math.min(_,k)],R=eR.apply(void 0,T),I=_-R,L=k+R;return[A.animateCoinExplode(E.node,I,C),tZ.waitTweenAsync(I,C).then(function(){return A.animateCoinFlyBack(g,E,L,C)})]})),[tZ.waitTweenAsync(T,C).then(function(){return g.emitExplodeEffect(C)})]))];case 1:R.sent();return[2]}})}),function(g,E,_,C,A){return k.apply(this,arguments)})},{key:"animateCoinTextPopup",value:function(g,E){return this.coinTextPopupNode.show(g,E)}},{key:"animateCoinFlyBack",value:(_=Be(function(g,E,_,k){var C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:C=E.node.worldPosition.clone(),A=em.ZERO.clone(),T=g.getCoinIconWorldScale();return[4,tZ.runTweenAsync(x(E.node).to(_,{scale:T},{onStart:function(){E.playSpinAnimationAfterDelay(0,k),E.playTrailParticles()},onUpdate:function(_,k){if(void 0!==k){var T=el.cubicIn(k),R=g.getCoinIconWorldPosition();E.node.worldPosition=em.lerp(A,C,R,T)}},onComplete:function(){E.emittingParticles.stopSystem(),E.stopAnimation(),E.hide()}}),k)];case 1:R.sent();return[4,tZ.waitTweenAsync(1,k)];case 2:R.sent(),E.resetDisabled();return[2]}})}),function(g,E,k,C){return _.apply(this,arguments)})},{key:"animateCoinExplode",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=[-200,200],C=[-200,200],A=eR(k[0],k[1]),T=eR(C[0],C[1]);g.setPosition(0,0,g.position.z),g.setScale(em.ZERO);R=new em(A,T,g.position.z);return[4,Promise.all([tZ.runTweenAsync(x(g).delay(.1*E).to(.8*E,{scale:em.ONE},{easing:"elasticOut"}),_),tZ.runTweenAsync(x(g).to(E,{position:R},{easing:"circOut"}),_)])];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var g=_j.getGameData();this.coins=g?g.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(g){var E,_;if(this.coins>_Y&&(this.coins=_Y),g.coins!==this.coins){var k=Math.max(0,g.coins-this.coins);this.coins=g.coins,_j.setGameData({coins:this.coins});var C=g.collectionAnimation;null===(E=this.collectionAnimSignal)||void 0===E||E.abort();var A=new nD;if(this.collectionAnimSignal=A,null==C||null===(_=C.signal)||void 0===_||_.chain(A),void 0===C||C.animateTextOnly)this.node.scene.emit(a2.COIN_CHANGED,De(De({},g),{},{collectionAnimation:{animateTextOnly:!0,signal:null==C?void 0:C.signal}}));else{var T=C.floatDuration,R=void 0===T?_Q:T,I=C.flyDuration,L=void 0===I?_Z:I,P=C.target,O=void 0===P?this.targetContainer:P;this.collectionAnimSignal=A,this.targetContainer=O;var B=De(De({},g),{},{collectionAnimation:{floatDuration:R,flyDuration:L,animateTextOnly:!1,signal:A,target:O}});this.node.scene.emit(a2.COIN_CHANGED,B),this.handleCollectionAnim(k,this.targetContainer,R,L,A)}}}},{key:"addCoins",value:function(g){this.updateCoins(De(De({},g),{},{coins:this.coins+g.coins}))}},{key:"removeCoins",value:function(g){this.coins<g.coins?this.node.scene.emit(a2.REMOVE_COINS_FAILED):(this.updateCoins(De(De({},g),{},{coins:this.coins-g.coins})),this.node.scene.emit(a2.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(a2.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(g){return Math.min(g,_J)}},{key:"abortCoinAnimation",value:function(){var g;null===(g=this.collectionAnimSignal)||void 0===g||g.abort()}},{key:"untilFinishesCollectAnim",value:function(){return void 0===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(g){this.targetContainer=g}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var g;null===(g=this.collectionAnimSignal)||void 0===g||g.abort()}}]),r}(D)).prototype,"coinPrefab",[_b,_w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_N=st(_O.prototype,"coinTextPopup",[_S,_E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_D=st(_O.prototype,"coinAnimContainer",[__,_k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(_O.prototype,"handleCollectionAnim",[_C],Object.getOwnPropertyDescriptor(_O.prototype,"handleCollectionAnim"),_O.prototype),st(_O.prototype,"playCoinFlyAndexplodeAnimation",[_A],Object.getOwnPropertyDescriptor(_O.prototype,"playCoinFlyAndexplodeAnimation"),_O.prototype),st(_O.prototype,"animateCoinTextPopup",[_T],Object.getOwnPropertyDescriptor(_O.prototype,"animateCoinTextPopup"),_O.prototype),st(_O.prototype,"animateCoinFlyBack",[_R],Object.getOwnPropertyDescriptor(_O.prototype,"animateCoinFlyBack"),_O.prototype),st(_O.prototype,"animateCoinExplode",[_I],Object.getOwnPropertyDescriptor(_O.prototype,"animateCoinExplode"),_O.prototype),st(_O.prototype,"untilFinishesCollectAnim",[_L],Object.getOwnPropertyDescriptor(_O.prototype,"untilFinishesCollectAnim"),_O.prototype),_P=_O))||_P)||_P);_._RF.pop(),_._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),_._RF.pop(),_._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),_._RF.pop(),_._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),_._RF.pop(),_._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),_._RF.pop(),_._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var _0,_1,_2,_4,_3,_5,_6,_8,_9,_7,ke,kt=k.ccclass,kn=k.disallowMultiple,ki=GameCore,ka=ki.Events,kr=ki.Configs,ko=ki.Utils.Valid,ks=globalThis.game,kl=ks.ads,kc=ks.player,kh=ks.event;kt("BootScene")(_V=kn(_V=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).processWhenGameSdkStarted=function(){g.setupGameData(),g.processPreloadAssets()},g.processPreloadAssets=function(){g.loadCurrentPlayerTheme().catch(function(g){return console.error("loadCurrentPlayerTheme",g)})},g.handlePauseAudio=function(){kh.on(ka.VISIBILITY_HIDDEN,g.handleMuteAudio),kh.on(ka.VISIBILITY_VISIBLE,g.handleUnMuteAudio)},g.handleMuteAudio=function(){i8.muteAudio(!0)},g.handleUnMuteAudio=function(){kl.isAdFullSizeShowing()||i8.muteAudio(!1)},g}return Ue(n,[{key:"__preload",value:function(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.listenEvents()}},{key:"onLoad",value:function(){this.handlePauseAudio(),kr.Core.StartSDKAfterLoadGame||l5.showLoadingFullScreen(s$)}},{key:"start",value:function(){this.processCrazyGamesLoadingStop()}},{key:"listenEvents",value:function(){kh.getEventEmitCount(ka.GAME_SDK_STARTED)>0?this.processWhenGameSdkStarted():kh.once(ka.GAME_SDK_STARTED,this.processWhenGameSdkStarted)}},{key:"setupGameData",value:function(){var g=kc.getGameData();if(g){var E=g.totalLevel,_=Math.max(E,400),k=De(De({},g),{},{totalLevel:_});kc.setGameData(k)}}},{key:"loadCurrentPlayerTheme",value:function(){var g=la.mapOrder,E=g[0],_=kc.getGameData(),k=null==_?void 0:_.level;if(!ko.isNumber(k))return ie.loadThemeAsync(E.theme);var C,A=at(g);try{for(A.s();!(C=A.n()).done;){var T=C.value;if((k-=T.levelCount)<=0){E=T;break}}}catch(g){A.e(g)}finally{A.f()}return ie.loadThemeAsync(E.theme)}},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}}]),n}(D))||_V);_._RF.pop(),_._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var kp,kd,kf,ky,kv,kg,km,kb,kw,kS,kE,k_,kk=k.ccclass,kC=k.property,kA=(_0=kk("RigidBodyObject"),_1=kC(K),_2=kC(eS),_4=kC(K),_3=kC(J),_0((_8=st((_6=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"gravityScale",_8,Ke(g)),rt(g,"linearVelocity",_9,Ke(g)),rt(g,"bounce",_7,Ke(g)),rt(g,"simulate",ke,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(T).getComponent(R),this.uiTransform=this.node.getComponent(R)}},{key:"update",value:function(g){if(this.simulate){this.applyGravity();var E=this.node.worldPosition.clone();E.add(new em(this.linearVelocity.x*g,this.linearVelocity.y*g,0)),E=this.applyBounce(E),this.node.setWorldPosition(E)}}},{key:"applyForce",value:function(g){this.linearVelocity.add(g)}},{key:"applyGravity",value:function(){var g=new eS(0,-9.8*this.gravityScale);this.applyForce(g)}},{key:"applyBounce",value:function(g){var E=this.uiTransform.getBoundingBoxToWorld();E.yMin<0&&(g.y=E.height/2,this.linearVelocity.y*=-this.bounce),E.xMin<0&&(g.x=E.width/2,this.linearVelocity.x*=-1);var _=this.canvas.width;return E.xMax>_&&(g.x=_-E.width/2,this.linearVelocity.x*=-1),g}}]),n}(D)).prototype,"gravityScale",[_1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),_9=st(_6.prototype,"linearVelocity",[_2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new eS(0,0)}}),_7=st(_6.prototype,"bounce",[_4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ke=st(_6.prototype,"simulate",[_3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_5=_6))||_5);_._RF.pop(),_._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var kT,kR,kI,kL,kP,kO,kB,kN,kD,kM,kF,kU,kz,kx,kG,kV,kK=k.ccclass,kH=k.property,kq=k.disallowMultiple,eL=function(){},kW=(kp=kK("AnimSkipOverlay"),kd=kH(eu),kf=kH(eu),ky=kH(B),kv=nC.onlyRunInLifeCycleAsync,kg=nC.onlyRunInLifeCycleAsync,km=nC.onlyRunInLifeCycleAsync,kp(kb=kq((kS=st((kw=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"containerUIOpacity",kS,Ke(g)),rt(g,"maskUIOpacity",kE,Ke(g)),rt(g,"skipButton",k_,Ke(g)),g.isOpened=!1,g.currentCallback=eL,g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"open",value:(_=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.containerUIOpacity.node.active=!0;E=g.onSkip,_=g.opacity,k=void 0===_?255:_,C=g.transitionDuration,A=void 0===C?.2:C;this.maskUIOpacity.opacity=k;return[4,this.animateUIOpacity(0,255,A)];case 1:T.sent(),this.currentCallback=E,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(t9,g);return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"close",value:(E=Be(function(){var g;var E=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:g=E.length>0&&void 0!==E[0]?E[0]:.2;this.skipButton.interactable=!1,this.currentCallback=eL;return[4,this.animateUIOpacity(255,0,g)];case 1:_.sent(),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(t7);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"animateUIOpacity",value:function(g,E,_){return this.containerUIOpacity.opacity=g,tZ.runTweenAsync(x(this.containerUIOpacity).to(_,{opacity:E}))}},{key:"untilClosed",value:function(){var g=this;return!1===this.isOpened?Promise.resolve():new Promise(function(E){g.node.scene.once(t7,E)})}}]),a}(D)).prototype,"containerUIOpacity",[kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kE=st(kw.prototype,"maskUIOpacity",[kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k_=st(kw.prototype,"skipButton",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(kw.prototype,"open",[kv],Object.getOwnPropertyDescriptor(kw.prototype,"open"),kw.prototype),st(kw.prototype,"close",[kg],Object.getOwnPropertyDescriptor(kw.prototype,"close"),kw.prototype),st(kw.prototype,"untilClosed",[km],Object.getOwnPropertyDescriptor(kw.prototype,"untilClosed"),kw.prototype),kb=kw))||kb)||kb);_._RF.pop(),_._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var kj,kX,kY,kJ,kQ,kZ,k$,k0,k1,k2,k4,k3,k5,k6,k8,k9,k7=k.ccclass,Ce=k.property,Ct=GameCore.Utils.Number,Cn=(kT=k7("CoinContainer"),kR=Ce(L),kI=Ce(eo),kL=Ce(eu),kP=Ce(eK),kO=nC.onlyRunInLifeCycle,kB=nC.onlyRunInLifeCycleAsync,kN=nC.onlyRunInLifeCycleAsync,kD=nC.onlyRunInLifeCycle,kM=nC.onlyRunInLifeCycle,kT((kz=st((kU=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"coinLabel",kz,Ke(g)),rt(g,"coinIcon",kx,Ke(g)),rt(g,"explosionCircle",kG,Ke(g)),rt(g,"explosionParticles",kV,Ke(g)),g.currentCoin=0,g}return Ue(o,[{key:"setCoinText",value:function(g){this.coinLabel.string=g}},{key:"handleAddCoinButton",value:function(){l5.openScreen(ib.GET_COIN_SCREEN,{quantity:sx})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(a2.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(k=Be(function(g){var E,_,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:C=g.coins,A=g.collectionAnimation,T=g.playSound;if(!(void 0!==A&&!1!==this.node.activeInHierarchy))return[3,4];R=A.signal;if(null===(E=this.animAbortSignal)||void 0===E||E.abort(),this.animAbortSignal=null!=R?R:new nD,!A.animateTextOnly)return[3,2];return[4,this.animateCoinText(C,0,T,R)];case 1:return[2,(P.sent(),void this.setCoins(C))];case 2:I=null!==(_=A.flyDuration)&&void 0!==_?_:0,L=(null!==(k=A.floatDuration)&&void 0!==k?k:0)+I;return[4,this.animateCoinText(C,L,T,R)];case 3:P.sent(),this.setCoins(C);return[3,5];case 4:this.setCoins(C);P.label=5;case 5:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setCoins",value:function(g){this.setCoinText(Ct.getShortNumber(g,3)),this.currentCoin=g}},{key:"animateCoinText",value:(_=Be(function(g,E){var _,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:_=this,k=!(T.length>2&&void 0!==T[2])||T[2],C=T.length>3?T[3]:void 0,A=this.currentCoin;return[4,tZ.waitTweenAsync(E,C)];case 1:R.sent(),k&&i8.playSound(ih.COLLECT_COINS);return[4,tZ.runOnUpdateAsync(this.node,1,function(E){var k=Math.round(A+(g-A)*E);_.setCoinText(Ct.getShortNumber(k,3))},C)];case 2:R.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"emitExplodeEffect",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.initializeExplosionCircle(),this.explosionParticles.resetSystem();return[4,Promise.all([tZ.runTweenAsync(x(this.explosionCircle.node).to(.4,{scale:new em(3,3,3)},{easing:"quadOut"}),g),tZ.runTweenAsync(x(this.explosionCircle).delay(.2).to(.2,{opacity:0}),g)])];case 1:E.sent(),this.resetExplosionCircle();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"resetExplosionCircle",value:function(){this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0}},{key:"initializeExplosionCircle",value:function(){this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0)}},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var g;null===(g=this.animAbortSignal)||void 0===g||g.abort()}}]),o}(D)).prototype,"coinLabel",[kR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kx=st(kU.prototype,"coinIcon",[kI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kG=st(kU.prototype,"explosionCircle",[kL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kV=st(kU.prototype,"explosionParticles",[kP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(kU.prototype,"setCoins",[kO],Object.getOwnPropertyDescriptor(kU.prototype,"setCoins"),kU.prototype),st(kU.prototype,"animateCoinText",[kB],Object.getOwnPropertyDescriptor(kU.prototype,"animateCoinText"),kU.prototype),st(kU.prototype,"emitExplodeEffect",[kN],Object.getOwnPropertyDescriptor(kU.prototype,"emitExplodeEffect"),kU.prototype),st(kU.prototype,"resetExplosionCircle",[kD],Object.getOwnPropertyDescriptor(kU.prototype,"resetExplosionCircle"),kU.prototype),st(kU.prototype,"initializeExplosionCircle",[kM],Object.getOwnPropertyDescriptor(kU.prototype,"initializeExplosionCircle"),kU.prototype),kF=kU))||kF);_._RF.pop(),_._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);var Ci,Ca=k.ccclass,Cr=k.property,Co=globalThis.game.player,Cs=[1e3,1500];kj=Ca("ItemContainer"),kX=Cr({type:C,group:"Hint"}),kY=Cr({type:L,group:"Hint"}),kJ=Cr({type:C,group:"Thunder"}),kQ=Cr({type:L,group:"Thunder"}),kZ=Cr({type:C,group:"Storm"}),k$=Cr({type:L,group:"Storm"}),k0=Cr(ee),kj((k2=st((k1=function(g){ze(u,g);var E,_,k,C,A,R=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"hintNode",k2,Ke(g)),rt(g,"hintLabel",k4,Ke(g)),g.hintCollection=[],rt(g,"thunderNode",k3,Ke(g)),rt(g,"thunderLabel",k5,Ke(g)),g.thunderCollection=[],rt(g,"stormNode",k6,Ke(g)),rt(g,"stormLabel",k8,Ke(g)),g.stormCollection=[],rt(g,"itemPrefab",k9,Ke(g)),g}return Ue(u,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(T).node,this.widget=this.getComponent(H),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents(),this.listenToEvents()}},{key:"start",value:function(){this.prepareItemCollection()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(a2.ADD_ITEMS,this.handleAddItems,this)}},{key:"prepareItemCollection",value:function(){for(var g=0;g<9;g++){var E=I(this.itemPrefab),_=I(this.itemPrefab),k=I(this.itemPrefab);E.parent=this.canvas,_.parent=this.canvas,k.parent=this.canvas,E.active=!1,_.active=!1,k.active=!1,this.hintCollection.push(E.getComponent(kA)),this.thunderCollection.push(_.getComponent(kA)),this.stormCollection.push(k.getComponent(kA))}}},{key:"updateStatus",value:function(g){var E=g.items;this.hintLabel.string="".concat(E.hint),this.thunderLabel.string="".concat(E.thunder),this.stormLabel.string="".concat(E.storm)}},{key:"show",value:(A=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.uiOpacity.opacity=255;g=x(this.widget).to(1.5,{right:0},{easing:"quadOut"});return[4,tZ.runTweenAsync(g,this.animAbortSignal)];case 1:E.sent(),this.widget.right=0;return[2]}})}),function(){return A.apply(this,arguments)})},{key:"hide",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=x(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"});return[4,tZ.runTweenAsync(g)];case 1:E.sent(),this.uiOpacity.opacity=0;return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleAddItems",value:(k=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:_=this;this.animAbortSignal=null!==(E=g.signal)&&void 0!==E?E:new nD;k=Co.getGameData();if(!k)return[3,3];this.updateStatus(k);C=this.show(),A=g.items.map(function(g){return _.animateItemCollection(g.item,g.quantity,1.5)});return[4,Promise.all([C].concat(tt(A)))];case 1:T.sent(),k.items=De(De({},k.items),{},{hint:k.items.hint+g.items[0].quantity,thunder:k.items.thunder+g.items[1].quantity,storm:k.items.storm+g.items[2].quantity}),Co.setGameData(k),this.updateStatus(k);return[4,this.hide()];case 2:T.sent();T.label=3;case 3:return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"animateItemCollection",value:(_=Be(function(g,E,_){var k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:k=this,C=this.getItemCollection(g).slice(0,E);if(!(0!==C.length))return[3,2];A=C.map(function(E,C){E.node.active=!0,E.node.position=new em(0,0,E.node.position.z),E.linearVelocity=new eS(0,0),E.simulate=!0;var A=eR(Math.PI/3,2*Math.PI/3),T=eR(Cs[0],Cs[1])*Math.cos(A),R=eR(Cs[0],Cs[1])*Math.sin(A);E.applyForce(new eS(T,R));var I=k.getTargetNode(g);if(I)return E.getComponent(eo).spriteFrame=I.getComponent(eo).spriteFrame,k.getItemAnimation(E,I,_+.03*C)});return[4,Promise.all(A)];case 1:T.sent();T.label=2;case 2:return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"getItemCollection",value:function(g){switch(g){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}},{key:"getTargetNode",value:function(g){switch(g){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}},{key:"getItemAnimation",value:(E=Be(function(g,E){var _,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:_=A.length>2&&void 0!==A[2]?A[2]:0;g.node.scale=new em(2,2,2);return[4,tZ.waitTweenAsync(_,this.animAbortSignal)];case 1:T.sent();k=g.node.worldPosition.clone(),C=x(g.node).to(1,{scale:E.scale},{onUpdate:function(_,C){if(_&&C){var A=el.cubicIn(C);E&&(g.node.worldPosition=k.lerp(E.worldPosition,A))}},onComplete:function(){g.node.setPosition(0,0),g.node.active=!1}});return[4,tZ.runTweenAsync(C,this.animAbortSignal)];case 2:T.sent(),g.node.scale=E.scale.clone(),g.node.setPosition(0,0),g.node.active=!1;return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"onDestroy",value:function(){var g;null===(g=this.animAbortSignal)||void 0===g||g.abort()}}]),u}(D)).prototype,"hintNode",[kX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k4=st(k1.prototype,"hintLabel",[kY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k3=st(k1.prototype,"thunderNode",[kJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k5=st(k1.prototype,"thunderLabel",[kQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k6=st(k1.prototype,"stormNode",[kZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k8=st(k1.prototype,"stormLabel",[k$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k9=st(k1.prototype,"itemPrefab",[k0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k1));_._RF.pop(),_._RF.push({},"904917NfYBJy781QxKjEPIO","ViewNode",void 0);var Cl,Cc,Ch,Cp,Cd,Cf,Cy,Cv,Cg,Cm,Cb,Cw,CS,CE,C_,Ck,CC,CA,CT,CR,CI=k.ccclass,CL=k.requireComponent,CP=CI("ViewNode")(Ci=CL(eu)(Ci=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).order=0,g}return Ue(n,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"setVisible",value:function(g){this.uiOpacity.opacity=g?255:0}},{key:"isVisible",value:function(){return this.uiOpacity.opacity>0}}]),n}(D))||Ci)||Ci;_._RF.pop(),_._RF.push({},"0b250nSw/RHRq8vKigzgfhs","ScrollViewLayout",void 0);var CO,CB,CN,CD,CM,CF,CU,Cz,Cx,CG,CV,CK,CH,Cq,CW,Cj,CX,CY,CJ,CQ,CZ,C$,C0,C1,C2,C4,C3,C5,C6,C8,C9,C7,Ae,At,An=k.ccclass,Ai=k.property,Aa=k.requireComponent,Ar=GameCore.Utils.Array,Ao=(Cl=An("ScrollViewLayout"),Cc=Aa(eH),Ch=Ai(R),Cp=Ai(K),Cd=Ai(ee),Cf=Ai(V),Cy=Ai(V),Cv=nC.onlyRunInLifeCycleAsync,Cg=nC.onlyRunInLifeCycleAsync,Cm=nC.onlyRunInLifeCycleAsync,Cb=nC.onlyRunInLifeCycle,Cw=nC.onlyRunInLifeCycle,CS=nC.onlyRunInLifeCycle,Cl(CE=Cc((Ck=st((C_=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"viewport",Ck,Ke(g)),rt(g,"spacing",CC,Ke(g)),rt(g,"nodePrefab",CA,Ke(g)),rt(g,"maxNodeCount",CT,Ke(g)),rt(g,"extendCount",CR,Ke(g)),g.nodePool=[],g.nodeHeight=0,g.scrollSignal=new nD,g.onNodeVisible=function(){},g.onNodeInvisible=function(){},g}return Ue(o,[{key:"__preload",value:function(){this.scrollView=this.getComponent(eH),this.uiTransform=this.getComponent(R)}},{key:"start",value:function(){var g=I(this.nodePrefab);this.nodeHeight=g.getComponent(R).height,g.destroy(),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"init",value:function(g,E){this.createNodePool(),this.onNodeVisible=null!=g?g:this.onNodeVisible,this.onNodeInvisible=null!=E?E:this.onNodeInvisible;for(var _=0;_<this.nodePool.length;_++)this.nodePool[_].setVisible(!1);this.updateVisibility()}},{key:"updateNodeVisibility",value:function(){for(var g=0;g<this.nodePool.length;g++)this.nodePool[g].isVisible()?this.onNodeVisible(this.nodePool[g]):this.onNodeInvisible(this.nodePool[g])}},{key:"listenEvents",value:function(){this.scrollView.node.on(eH.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.on(eq.TOUCH_MOVE,this.abortScrollSignal,this)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(eH.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.off(eq.TOUCH_MOVE,this.abortScrollSignal,this)}},{key:"scrollToOrder",value:(k=Be(function(g,E){var _,k,C,A,T;var R=arguments;return _ts_generator(this,function(I){switch(I.label){case 0:_=R.length>2&&void 0!==R[2]?R[2]:2,k=this.getNodeScrollOffset(g),C=this.scrollView.getScrollOffset().y,A=(k=Math.max(k,0))-(C=Math.max(C,0));T=Math.abs(A)<5;if(T)return[3,2];return[4,this.scrollToOffset(new eS(0,k),_,E)];case 1:T=I.sent();I.label=2;case 2:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"scrollToTop",value:(_=Be(function(g){var E;var _=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:E=_.length>1&&void 0!==_[1]?_[1]:2;return[4,this.scrollToOffset(new eS(0,0),E,g)];case 1:k.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"scrollToOffset",value:(E=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=new nD;this.scrollSignal=k,this.scrollView.scrollToOffset(g,E),k.addAbortListener(this.handleScrollSignalAborted.bind(this)),_.addAbortListener(this.handleExternalSignalAborted.bind(this,g,k));return[4,tZ.waitTweenAsync(E,_)];case 1:C.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"updateVisibility",value:function(){for(var g=this.viewport.getBoundingBoxToWorld(),E=g.yMax,_=g.yMin,k=0;k<this.maxNodeCount;k++){var C=this.getNodeBoundingBoxWorld(k),A=C.top,T=C.bot;if(A<_||T>E){var R=this.getNodeByOrder(k);R&&(this.onNodeInvisible(R),R.setVisible(!1))}else{var I=this.getNodeByOrder(k);if(I)I.isVisible()||(I.order=k,this.onNodeVisible(I),I.setVisible(!0));else{var L=this.getInvisibleNode();L&&(L.node.setPosition(this.getNodePosition(k)),L.order=k,this.onNodeVisible(L),L.setVisible(!0))}}}}},{key:"updateLayout",value:function(){var g,E=at(this.getVisibleNodes());try{for(E.s();!(g=E.n()).done;){var _=g.value;_.node.setPosition(this.getNodePosition(_.order))}}catch(g){E.e(g)}finally{E.f()}}},{key:"setMaxNodeCount",value:function(g){this.maxNodeCount=g,this.scrollView.content.getComponent(R).height=(this.nodeHeight+this.spacing)*this.maxNodeCount}},{key:"getAllNodes",value:function(){return this.nodePool}},{key:"getVisibleNodes",value:function(){return this.nodePool.filter(function(g){return g.isVisible()})}},{key:"getNodePosition",value:function(g){return new em(0,-(this.nodeHeight+this.spacing)*g-this.nodeHeight/2,0)}},{key:"getNodeScrollOffset",value:function(g){return-this.getNodePosition(g).y-this.uiTransform.node.worldPosition.y-this.uiTransform.height/2+this.viewport.node.worldPosition.y}},{key:"getNodeByOrder",value:function(g){return Ar.search(this.nodePool,function(E){return E.order===g})}},{key:"getInvisibleNode",value:function(){return Ar.search(this.nodePool,function(g){return!g.isVisible()})}},{key:"createNodePool",value:function(){if(!(this.nodePool.length>0)){var g=Math.ceil(this.viewport.height/this.nodeHeight)+1+this.extendCount;this.setMaxNodeCount(this.maxNodeCount);for(var E=0;E<g;E++){var _,k=I(this.nodePrefab);null===(_=this.scrollView.content)||void 0===_||_.addChild(k),k.setPosition(this.getNodePosition(this.nodePool.length));var C=k.addComponent(CP);C.order=E,C.setVisible(!1),this.nodePool.push(C)}}}},{key:"getNodeBoundingBoxWorld",value:function(g){var E,_,k=this.getNodePosition(g).y+(null!==(E=null===(_=this.scrollView.content)||void 0===_?void 0:_.worldPosition.y)&&void 0!==E?E:0);return{top:k+this.nodeHeight/2,bot:k-this.nodeHeight/2}}},{key:"abortScrollSignal",value:function(){this.scrollSignal.abort()}},{key:"handleScrollSignalAborted",value:function(){this.scrollView.stopAutoScroll(),this.updateVisibility()}},{key:"handleExternalSignalAborted",value:function(g,E){E.aborted||(this.scrollView.stopAutoScroll(),this.scrollView.scrollToOffset(g,0),this.updateVisibility())}}]),o}(D)).prototype,"viewport",[Ch],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CC=st(C_.prototype,"spacing",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),CA=st(C_.prototype,"nodePrefab",[Cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CT=st(C_.prototype,"maxNodeCount",[Cf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),CR=st(C_.prototype,"extendCount",[Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),st(C_.prototype,"scrollToOrder",[Cv],Object.getOwnPropertyDescriptor(C_.prototype,"scrollToOrder"),C_.prototype),st(C_.prototype,"scrollToTop",[Cg],Object.getOwnPropertyDescriptor(C_.prototype,"scrollToTop"),C_.prototype),st(C_.prototype,"scrollToOffset",[Cm],Object.getOwnPropertyDescriptor(C_.prototype,"scrollToOffset"),C_.prototype),st(C_.prototype,"updateVisibility",[Cb],Object.getOwnPropertyDescriptor(C_.prototype,"updateVisibility"),C_.prototype),st(C_.prototype,"handleScrollSignalAborted",[Cw],Object.getOwnPropertyDescriptor(C_.prototype,"handleScrollSignalAborted"),C_.prototype),st(C_.prototype,"handleExternalSignalAborted",[CS],Object.getOwnPropertyDescriptor(C_.prototype,"handleExternalSignalAborted"),C_.prototype),CE=C_))||CE)||CE);_._RF.pop(),_._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var As,Al,Au,Ac,Ah,Ap,Ad,Af,Ay,Av,Ag,Am=k.ccclass,Ab=k.property,Aw=k.disallowMultiple,AS=k.requireComponent,AE=(CO=Am("DashboardPage"),CB=AS(H),CN=AS(eu),CD=nC.required(),CM=Ab({type:C,displayName:"Page's container"}),CF=nC.required(),CU=nC.required(),Cz=Ab({type:C,displayName:"Placeholder"}),Cx=nC.required(),CG=Ab({displayName:"Don't create prefab",tooltip:"Tell the component to not create the prefab even if it hasn't create yet"}),CV=Ab({displayName:"Darken background"}),CK=Ab({type:V,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),CH=Ab({displayName:"Use navbar shadow"}),Cq=Ab({type:V,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),CW=nC.required(),Cj=nC.getComponent(eu),CX=nC.required(),CY=nC.getComponent(H),CJ=nC.onlyRunInLifeCycleAsync,CQ=nC.onlyRunInLifeCycle,CZ=nC.onlyRunInLifeCycleAsync,CO(C$=Aw(C$=CB(C$=CN((C1=st((C0=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",C1,Ke(g)),rt(g,"containerUIOpacity",C2,Ke(g)),rt(g,"placeholder",C4,Ke(g)),rt(g,"placeholderUIOpacity",C3,Ke(g)),rt(g,"hasCreated",C5,Ke(g)),g.pagePrefab=null,rt(g,"darkenBackground",C6,Ke(g)),rt(g,"backgroundOpacity",C8,Ke(g)),rt(g,"useNavbarShadow",C9,Ke(g)),rt(g,"navbarShadowOpacity",C7,Ke(g)),rt(g,"uiOpacity",Ae,Ke(g)),rt(g,"widgetComponent",At,Ke(g)),g}return Ue(a,[{key:"onLoad",value:function(){this.containerUIOpacity=this.container.getComponent(eu),this.placeholderUIOpacity=this.placeholder.getComponent(eu),nC.decorateComponent(this);var g=this.container.getComponent(q);this.layoutComponents=g?[g]:[],this.widgetComponents=[this.widgetComponent].concat(tt(this.container.getComponentsInChildren(H)))}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"updateWidgets",value:function(){var g,E=at(this.widgetComponents);try{for(E.s();!(g=E.n()).done;)g.value.updateAlignment()}catch(g){E.e(g)}finally{E.f()}}},{key:"updateLayouts",value:function(){var g,E=at(this.layoutComponents);try{for(E.s();!(g=E.n()).done;)g.value.updateLayout()}catch(g){E.e(g)}finally{E.f()}}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.hasCreated;if(g)return[3,2];return[4,this.create()];case 1:g=E.sent();E.label=2;case 2:this.mountInLifeCycle();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"mountInLifeCycle",value:function(){this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,iC.trackCurrentPage(this.node.name,!0)}},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return!0}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(E=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:if(!(this.pagePrefab&&!this.hasCreated))return[3,2];_=I(this.pagePrefab),k=_.getComponentsInChildren(H);(g=this.widgetComponents).push.apply(g,tt(k));C=_.getComponentsInChildren(q);(E=this.layoutComponents).push.apply(E,tt(C)),this.container.addChild(_);return[4,tZ.waitTweenAsync(0)];case 1:A.sent(),this.hasCreated=!0;A.label=2;case 2:return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(D)).prototype,"container",[CD,CM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C2=st(C0.prototype,"containerUIOpacity",[CF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C4=st(C0.prototype,"placeholder",[CU,Cz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C3=st(C0.prototype,"placeholderUIOpacity",[Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C5=st(C0.prototype,"hasCreated",[CG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C6=st(C0.prototype,"darkenBackground",[CV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C8=st(C0.prototype,"backgroundOpacity",[CK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),C9=st(C0.prototype,"useNavbarShadow",[CH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),C7=st(C0.prototype,"navbarShadowOpacity",[Cq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),Ae=st(C0.prototype,"uiOpacity",[CW,Cj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),At=st(C0.prototype,"widgetComponent",[CX,CY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(C0.prototype,"mount",[CJ],Object.getOwnPropertyDescriptor(C0.prototype,"mount"),C0.prototype),st(C0.prototype,"mountInLifeCycle",[CQ],Object.getOwnPropertyDescriptor(C0.prototype,"mountInLifeCycle"),C0.prototype),st(C0.prototype,"create",[CZ],Object.getOwnPropertyDescriptor(C0.prototype,"create"),C0.prototype),C$=C0))||C$)||C$)||C$)||C$);_._RF.pop(),_._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var A_,Ak,AC,AA,AT,AR,AI,AL,AP,AO,AB,AN,AD,AM,AF,AU,Az,Ax=k.ccclass,AG=k.property,AV=(As=Ax("ThemeProgressBar"),Al=AG(C),Au=AG(C),Ac=AG(C),Ah=AG(C),As((Af=st((Ad=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"progressBar",Af,Ke(g)),rt(g,"progressText",Ay,Ke(g)),rt(g,"leftCap",Av,Ke(g)),rt(g,"rightCap",Ag,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(g,E){g<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var _=this.progressBar.getComponent(ew);if(!_)throw new Error("ThemeProgressBar: progressBarComponent not found");_.progress=g/E;var k=this.progressText.getComponent(L);if(!k)throw new Error("ThemeProgressBar: progressTextComponent not found");k.string="".concat(g,"/").concat(E)}}]),n}(D)).prototype,"progressBar",[Al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ay=st(Ad.prototype,"progressText",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Av=st(Ad.prototype,"leftCap",[Ac],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ag=st(Ad.prototype,"rightCap",[Ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ap=Ad))||Ap);_._RF.pop(),_._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var AK,AH,Aq,AW,Aj,AX,AY,AJ,AQ,AZ,A$,A0,A1,A2,A4,A3,A5,A6,A8,A9,A7,Te,Tt,Tn,Ti,Ta,Tr,To=k.ccclass,Ts=k.disallowMultiple,Tl=k.property,Tu=[50,160],Tc=(A_=To("LockAnimator"),Ak=Tl(eK),AC=Tl(G),AA=Tl(ei),AT=Tl(ei),AR=Tl(ei),AI=Tl(sm),AL=Tl({type:V,min:0}),A_(AP=Ts((AB=st((AO=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"floatingParticles",AB,Ke(g)),rt(g,"iconAnimation",AN,Ke(g)),rt(g,"lockClip",AD,Ke(g)),rt(g,"unlockClip",AM,Ke(g)),rt(g,"tryToUnlockClip",AF,Ke(g)),rt(g,"trailTemplate",AU,Ke(g)),rt(g,"trailCount",Az,Ke(g)),g.trails=[],g}return Ue(o,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(k=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem();return[4,this.playAnimation(this.unlockClip.name,g)];case 1:E.sent(),this.floatingParticles.stopSystem();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var g=this;return Promise.all(this.trails.map(function(E){return tZ.runTweenAsync(g.getExplodeTrail(E))}))}},{key:"getExplodeTrail",value:function(g,E){var _=arguments.length>1&&void 0!==E?E:0,k=eR(0,2*Math.PI),C=eR(Tu[0],Tu[1])*Math.cos(k),A=eR(Tu[0],Tu[1])*Math.sin(k),T=new em(C,A,g.node.position.z),R=g.node.scale.clone();return x(g.node).delay(_).call(function(){g.node.setPosition(0,0),g.reset(),g.node.active=!0}).to(.5,{position:T.clone()},{easing:"expoOut"}).to(.5,{scale:new em(0,0,1)},{easing:"expoIn"}).call(function(){g.node.setPosition(0,0),g.node.scale=R,g.reset(),g.node.active=!1})}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var g=0;g<this.trailCount;g++){var E=I(this.trailTemplate.node);E.setParent(this.node),E.active=!1,this.trails.push(E.getComponent(sm))}}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"playAnimation",value:(_=Be(function(g,E){var _;return _ts_generator(this,function(k){_=this;return[2,null!=E&&E.aborted?Promise.resolve():new Promise(function(k){_.iconAnimation.once(G.EventType.FINISHED,function(){k()}),null==E||E.addAbortListener(function(){_.iconAnimation.off(G.EventType.FINISHED),_.iconAnimation.stop(),k()}),_.iconAnimation.play(g)})]})}),function(g,E){return _.apply(this,arguments)})},{key:"playTryToUnlockAnimation",value:(E=Be(function(){return _ts_generator(this,function(g){return[2,this.playAnimation(this.tryToUnlockClip.name)]})}),function(){return E.apply(this,arguments)})}]),o}(D)).prototype,"floatingParticles",[Ak],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AN=st(AO.prototype,"iconAnimation",[AC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AD=st(AO.prototype,"lockClip",[AA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AM=st(AO.prototype,"unlockClip",[AT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AF=st(AO.prototype,"tryToUnlockClip",[AR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AU=st(AO.prototype,"trailTemplate",[AI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Az=st(AO.prototype,"trailCount",[AL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),AP=AO))||AP)||AP);_._RF.pop(),_._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var Th,Tp,Td,Tf,Ty,Tv,Tg,Tm,Tb,Tw,TS,TE,T_,Tk=k.ccclass,TC=k.property,TA={progress:0,max:10,isLocked:!0,theme:lr.SUMMER,skins:["fruit"]},TT=GameCore.Utils.Array,TR=(AK=Tk("ThemeBlock"),AH=TC(C),Aq=TC(eu),AW=TC(C),Aj=TC(eu),AX=TC(Tc),AY=TC(C),AJ=TC(eo),AQ=TC([eo]),AZ=TC(L),A$=TC(eu),A0=TC(eu),A1=TC(J),A2=nC.onlyRunInLifeCycleAsync,AK((A5=st((A3=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"mask",A5,Ke(g)),rt(g,"nodeUIOpacity",A6,Ke(g)),rt(g,"progressBar",A8,Ke(g)),rt(g,"backgroundUI",A9,Ke(g)),rt(g,"lockAnimator",A7,Ke(g)),rt(g,"themeLoadingRing",Te,Ke(g)),rt(g,"themeSprite",Tt,Ke(g)),rt(g,"tileBlockIconSprite",Tn,Ke(g)),rt(g,"titleLabel",Ti,Ke(g)),rt(g,"titleOpacity",Ta,Ke(g)),rt(g,"newTilesOpacity",Tr,Ke(g)),g.signal=new nD,g.payload=TA,g}return Ue(r,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(g){this.payload.isLocked=g,this.updateInfo()}},{key:"__preload",value:function(){this.uiTransform=this.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){var E=arguments.length>0&&void 0!==g?g:TA;this.payload=E;var _=E.progress,k=E.max,C=E.isLocked,A=E.theme,T=E.skins;this.signal.abort();var R=new nD;this.signal=R,this.updateTitle(A),this.updateSkinAsync(T,R),this.updateThemeAsync(A,R);var I=this.progressBar.getComponent(AV);if(!I)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=C,this.progressBar.active=!C,this.lockAnimator.node.active=C,C||I.setProgress(_,k)}},{key:"playUnlockAnim",value:(C=Be(function(g){var E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:E=A.length>1&&void 0!==A[1]?A[1]:TA;this.payload=De(De({},E),{},{isLocked:!1});_=E.progress,k=E.max,C=this.progressBar.getComponent(AV);if(!C)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,C.setProgress(_,k);return[4,this.animateUnlockedState(g)];case 1:T.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"updateTitle",value:function(g){var E=g.replace(/-/g," ").replace(/\b\w/g,function(g){return g.toUpperCase()});this.titleLabel.string="".concat(E," levels")}},{key:"updateSkinAsync",value:(k=Be(function(g,E){var _,k,C,A,T,R,I,L,P,O,B;return _ts_generator(this,function(N){switch(N.label){case 0:_=this.tileBlockIconSprite.length,k=g.length,C=g.map(function(){var g=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,ie.loadSkinPreviewAsync(g)];case 1:return[2,E.sent()]}})});return function(E){return g.apply(this,arguments)}}());return[4,Promise.all(C)];case 1:A=N.sent();if(!E.aborted&&this.tileBlockIconSprite){if(k<=_){for(T=Math.floor(_/k),R=_%k,I=tt(TT.fillWith(k,function(){return T})),L=0;L<R;L++)I[L]++;for(P=0,O=0;O<k;O++)for(B=0;B<I[O]&&P<_;B++,P++)this.tileBlockIconSprite[P].spriteFrame=A[O][B]}else this.tileBlockIconSprite.forEach(function(g,E){g.spriteFrame=A[E%k][0]})}return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"updateThemeAsync",value:(_=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.themeSprite.spriteFrame=null;_=ie.getAsset("".concat(nU[g],"/spriteFrame"),er);k=_;if(k)return[3,2];this.themeLoadingRing.active=!0;return[4,ie.loadThemePreviewAsync(g)];case 1:k=_=A.sent();A.label=2;case 2:C=_;if(C)return[3,4];return[4,ie.loadThemePreviewAsync(lr.SUMMER)];case 3:C=_=A.sent();A.label=4;case 4:this.themeSprite&&_&&!E.aborted&&(this.themeSprite.spriteFrame=_,this.themeLoadingRing.active=!1);return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"animateUnlockedState",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this.mask.getComponent(eu),k=this.progressBar.getComponent(eu);if(!_)throw new Error("ThemeBlock: maskUIOpacity not found");if(!k)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,_.opacity=null!==(E=_.opacity)&&void 0!==E?E:255,this.progressBar.active=!0,k.opacity=0;return[4,this.lockAnimator.unlock(g)];case 1:C.sent(),this.lockAnimator.node.active=!1;return[4,Promise.all([tZ.runTweenAsync(x(_).to(.25,{opacity:0}),g),tZ.runTweenAsync(x(k).to(.25,{opacity:255}),g)])];case 2:C.sent(),this.mask.active=!1,_.opacity=0,k.opacity=255;return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"getUITransform",value:function(){return this.uiTransform}},{key:"setVisible",value:function(g){this.nodeUIOpacity.opacity=g?255:0,this.titleOpacity.opacity=g?255:0,this.newTilesOpacity.opacity=g?255:0}}]),r}(D)).prototype,"mask",[AH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A6=st(A3.prototype,"nodeUIOpacity",[Aq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A8=st(A3.prototype,"progressBar",[AW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A9=st(A3.prototype,"backgroundUI",[Aj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A7=st(A3.prototype,"lockAnimator",[AX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te=st(A3.prototype,"themeLoadingRing",[AY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tt=st(A3.prototype,"themeSprite",[AJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tn=st(A3.prototype,"tileBlockIconSprite",[AQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ti=st(A3.prototype,"titleLabel",[AZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta=st(A3.prototype,"titleOpacity",[A$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tr=st(A3.prototype,"newTilesOpacity",[A0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(A3.prototype,"isLocked",[A1],Object.getOwnPropertyDescriptor(A3.prototype,"isLocked"),A3.prototype),st(A3.prototype,"updateSkinAsync",[A2],Object.getOwnPropertyDescriptor(A3.prototype,"updateSkinAsync"),A3.prototype),A4=A3))||A4);_._RF.pop(),_._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var TI,TL,TP,TO,TB,TN,TD,TM,TF,TU,Tz=k.ccclass,Tx=k.property,TG=globalThis.game.storage,TV=(Th=Tz("CollectionsContent"),Tp=Tx(rI),Td=Tx(Ao),Tf=Tx(ad),Ty=Tx({type:K,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),Tv=nC.onlyRunInLifeCycleAsync,Tg=nC.onlyRunInLifeCycleAsync,Th((Tw=st((Tb=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return(g=k.call.apply(k,[this].concat(_))).animateThemeBlockUnlockIndex=null,rt(g,"panelAnimator",Tw,Ke(g)),rt(g,"themeScrollView",TS,Ke(g)),rt(g,"contentOpacity",TE,Ke(g)),g.themeScrollViewInited=!1,g.payloads=[],g.preservedScrollPosition=new eS,rt(g,"offsetFromTopOfScrollView",T_,Ke(g)),g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.node.scene.on(a2.HIDE_UI,this.hideContent),this.node.scene.on(a2.SHOW_UI,this.showContent),this.themeScrollView.listenEvents()}},{key:"unlistenEvents",value:function(){this.unlistenUIEvents(),this.themeScrollView.unlistenEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(a2.HIDE_UI,this.hideContent),this.node.scene.off(a2.SHOW_UI,this.showContent)}},{key:"init",value:function(g){var E=this;this.payloads=g,this.themeScrollViewInited||(this.themeScrollViewInited=!0,this.themeScrollView.init(function(g){var _=E.animateThemeBlockUnlockIndex===g.order,k=E.payloads[g.order],C=g.getComponent(TR);C.updateInfo(De(De({},k),{},{isLocked:!!_||k.isLocked})),C.setVisible(!0)}))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.scrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.scrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(g){var E=this,_=TG.getStorageData("collection","animateMapPackUnlock"),k=TG.getStorageData("collection","lastMapPack");g.forEach(function(g,C){var A=g.progress,T=g.max,R=g.isLocked;if(A<T&&!R&&_&&k!==C+1)return E.animateThemeBlockUnlockIndex=C,TG.setStorageData("collection","animateMapPackUnlock",!1),void TG.setStorageData("collection","lastMapPack",C+1)})}},{key:"shouldAnimateThemeBlockUnlock",value:function(){return null!==this.animateThemeBlockUnlockIndex}},{key:"playThemeTabUnlockAnim",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!this.animateThemeBlockUnlockIndex)return[3,2];E=this.themeScrollView.getNodeByOrder(this.animateThemeBlockUnlockIndex);if(!(E&&E.isVisible()))return[3,2];_=E.getComponent(TR);if(!_)return[3,2];k=lh.getCollectionUnlockProgress()[this.animateThemeBlockUnlockIndex];return[4,_.playUnlockAnim(g,De(De({},k),{},{isLocked:!0}))];case 1:C.sent(),this.animateThemeBlockUnlockIndex=null;C.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(E=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,this.themeScrollView.scrollToOrder(g,E)];case 1:_.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}}]),a}(D)).prototype,"panelAnimator",[Tp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TS=st(Tb.prototype,"themeScrollView",[Td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TE=st(Tb.prototype,"contentOpacity",[Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T_=st(Tb.prototype,"offsetFromTopOfScrollView",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),st(Tb.prototype,"playThemeTabUnlockAnim",[Tv],Object.getOwnPropertyDescriptor(Tb.prototype,"playThemeTabUnlockAnim"),Tb.prototype),st(Tb.prototype,"scrollToCurrentUnlockingTheme",[Tg],Object.getOwnPropertyDescriptor(Tb.prototype,"scrollToCurrentUnlockingTheme"),Tb.prototype),Tm=Tb))||Tm);_._RF.pop(),_._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var TK,TH,Tq,TW,Tj,TX,TY,TJ,TQ,TZ,T$,T0,T1,T2,T4,T3,T5,T6,T8,T9,T7,Re,Rt,Rn,Ri,Ra,Rr,Ro,Rs,Rl,Ru,Rc,Rh,Rp,Rd,Rf,Ry,Rv,Rg,Rm,Rb=(TI=(0,k.ccclass)("CollectionsPage"),TL=nC.required(),TP=nC.getComponent(rp),TO=nC.onlyRunInLifeCycleAsync,TB=nC.onlyRunInLifeCycle,TN=nC.onlyRunInLifeCycleAsync,TD=nC.onlyRunInLifeCycleAsync,TI((TU=st((TF=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=A.call.apply(A,[this].concat(_))).payload=null,rt(g,"panelAnimationController",TU,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nC.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"setPayload",value:function(g){this.payload=g}},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(TV),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload);var g=lh.getCollectionUnlockProgress();this.themeContent.updateUnlockedProgress(g)}},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent(),this.themeContent.restoreScrollPosition(),this.themeContent.listenEvents();g=tZ.runTweenAsync(x(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent(),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents();return[4,this.panelAnimationController.hideUI()];case 2:g.sent(),this.themeContent.unlistenEvents();return[2]}})}),function(){return E.apply(this,arguments)})}]),r}(AE)).prototype,"panelAnimationController",[TL,TP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(TF.prototype,"mount",[TO],Object.getOwnPropertyDescriptor(TF.prototype,"mount"),TF.prototype),st(TF.prototype,"onMount",[TB],Object.getOwnPropertyDescriptor(TF.prototype,"onMount"),TF.prototype),st(TF.prototype,"transitionIn",[TN],Object.getOwnPropertyDescriptor(TF.prototype,"transitionIn"),TF.prototype),st(TF.prototype,"transitionOut",[TD],Object.getOwnPropertyDescriptor(TF.prototype,"transitionOut"),TF.prototype),TM=TF))||TM);_._RF.pop(),_._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var Rw,RS,RE,R_,Rk,RC,RA,RT,RR,RI,RL,RP,RO,RB=k.ccclass,RN=k.property,RD=k.disallowMultiple,RM=k.requireComponent,RF=GameCore.Utils.Array,RU=(TK=RB("PageManagerItem"),TH=RN(AE),Tq=RN({type:es(nB)}),TK((TX=st((Tj=Ue(function e(){Fe(this,e),rt(this,"page",TX,this),rt(this,"pageType",TY,this)})).prototype,"page",[TH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TY=st(Tj.prototype,"pageType",[Tq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TW=Tj))||TW),Rz=(TJ=RB("PageManager"),TQ=RM(R),TZ=nC.required(),T$=RN({type:eu,displayName:"Background Mask",group:"Background Mask"}),T0=RN({type:K,displayName:"Transition duration",group:"Background Mask"}),T1=RN({type:K,displayName:"Transition delay",group:"Background Mask"}),T2=nC.required(),T4=RN({type:eu,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),T3=RN({type:K,displayName:"Transition duration",group:"Nav Bar Shadow"}),T5=RN({type:K,displayName:"Transition delay",group:"Nav Bar Shadow"}),T6=RN({type:[RU]}),T8=RN({type:es(nB)}),T9=nC.required(),T7=nC.getComponent(R),Re=nC.onlyRunInLifeCycleAsync,Rt=nC.onlyRunInLifeCycleAsync,Rn=nC.onlyRunInLifeCycle,Ri=nC.onlyRunInLifeCycle,Ra=nC.onlyRunInLifeCycle,Rr=nC.onlyRunInLifeCycleAsync,Ro=nC.onlyRunInLifeCycleAsync,Rs=nC.onlyRunInLifeCycleAsync,TJ(Rl=RD(Rl=TQ((Rc=st((Ru=function(g){ze(h,g);var E,_,k,C,A,T,R,I,L,P=Xe(h);function h(){var g;Fe(this,h);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=P.call.apply(P,[this].concat(_)),"backgroundMask",Rc,Ke(g)),rt(g,"backgroundMaskTransitionDuration",Rh,Ke(g)),rt(g,"backgroundMaskTransitionDelay",Rp,Ke(g)),rt(g,"navBarShadow",Rd,Ke(g)),rt(g,"navBarShadowTransitionDuration",Rf,Ke(g)),rt(g,"navBarShadowTransitionDelay",Ry,Ke(g)),rt(g,"pageItems",Rv,Ke(g)),rt(g,"currentScreen",Rg,Ke(g)),rt(g,"uiTransform",Rm,Ke(g)),g}return Ue(h,[{key:"unmountAndHideAll",value:function(){var g=this;this.pageItems.forEach(function(E){var _=E.page;E.pageType!==g.currentScreen&&(_.unmount(),_.hide())})}},{key:"onLoad",value:function(){nC.decorateComponent(this)}},{key:"init",value:function(){var g=this;this.pageItems.forEach(function(E,_){var k=E.page.getWidget();k.right=-(_-1)*g.uiTransform.width,k.left=(_-1)*g.uiTransform.width})}},{key:"updateCollectionsContentPayload",value:function(g){var E=this.getPage(nB.collections);E&&_instanceof(E,Rb)&&E.setPayload(g)}},{key:"navigate",value:(L=Be(function(g,E,_,k){var C,A;return _ts_generator(this,function(T){switch(T.label){case 0:C=g.from,A=g.to;if(!(null!==C))return[3,2];return[4,this.navigateFromPage(C,A,E,_,k)];case 1:T.sent();return[3,4];case 2:return[4,this.navigateFromNull(A,_,k)];case 3:T.sent();T.label=4;case 4:return[2]}})}),function(g,E,_,k){return L.apply(this,arguments)})},{key:"navigateFromPage",value:(I=Be(function(g,E,_,k,C){var A,T,R,I,L,P,O,B,N,D,M,F,U;return _ts_generator(this,function(z){switch(z.label){case 0:A=this,T=this.validateNavigationRequest(g,E),R=T.toPage,I=T.fromPage;this.currentScreen=E;L=this.uiTransform.width,P=this.getPageIndex(g),O=this.getPageIndex(E),B=Math.min(P,O),N=Math.max(P,O),D=(N-B)*L,M=P<O?1:-1,F=this.pageItems.slice(B,N+1);F.forEach(function(g,E){var _=g.page;_.show(),_.getWidget().enabled=!1,_.node.position=new em((E+B-P)*L,_.node.position.y,_.node.position.z)});U=!R.hasLoadedPage();U&&this.showLoadingScreen();return[4,this.mountPage(R,k)];case 1:z.sent();return[4,_.callAsync(function(){return A.performFullTransition({from:g,to:E,fromPage:I,toPage:R,distance:D,direction:M,items:F})})];case 2:z.sent(),_.call(function(){return A.cleanupPages(R,F.filter(function(g){return g.pageType!==E}))});return[4,_.callAsync(function(){return A.transitionInPage(R,C)})];case 3:z.sent(),U&&this.hideLoadingScreen();return[2]}})}),function(g,E,_,k,C){return I.apply(this,arguments)})},{key:"hideLoadingScreen",value:function(){l5.closeLoadingScreen()}},{key:"showLoadingScreen",value:function(){l5.showLoadingScreen()}},{key:"cleanupPages",value:function(g,E){var _=g.getWidget();_.enabled=!0,_.left=0,_.right=0,g.updateWidgets(),g.updateLayouts(),E.forEach(function(g){g.page.unmount(),g.page.hide()})}},{key:"performFullTransition",value:(R=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:E=g.from,_=g.to,k=g.fromPage,C=g.distance,A=g.direction,T=g.items,R=g.toPage;this.node.scene.emit(nP,{from:E,to:_});return[4,Promise.all([k.transitionOut(),this.transition(C,A,T),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,R.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,R.getNavbarShadow())])];case 1:I.sent();return[2]}})}),function(g){return R.apply(this,arguments)})},{key:"mountPage",value:(T=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,g.mount()];case 1:_.sent();return[4,null==E?void 0:E(g)];case 2:_.sent();return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"validateNavigationRequest",value:function(g,E){if(g!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");var _=this.getPage(this.currentScreen),k=this.getPage(E);if(!k||!_)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");return{toPage:k,fromPage:_}}},{key:"navigateFromNull",value:(A=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=this.getPage(this.currentScreen);k.show(),this.currentScreen=g;return[4,this.mountPage(k,E)];case 1:C.sent(),this.node.scene.emit(nP,{from:null,to:g});return[4,this.transitionInPage(k,_)];case 2:C.sent();return[2]}})}),function(g,E,_){return A.apply(this,arguments)})},{key:"transitionInPage",value:(C=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,g.transitionIn()];case 1:_.sent();return[4,null==E?void 0:E(g)];case 2:_.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"getPage",value:function(g){var E=this.getPageIndex(g);return -1!==E?this.pageItems[E].page:null}},{key:"handleBackgroundMask",value:(k=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,tZ.runTweenAsync(x(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(g,{opacity:E}).start())];case 1:_.sent();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleNavBarShadow",value:(_=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,tZ.runTweenAsync(x(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(g,{opacity:E}).start())];case 1:_.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"getPageIndex",value:function(g){return RF.searchIndex(this.pageItems,function(E){return E.pageType===g})}},{key:"transition",value:(E=Be(function(g,E,_){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,Promise.all(_.map(function(_){var k=_.page;return tZ.runTweenAsync(x(k.node).to(.5,{position:new em(k.node.position.x-g*E,k.node.position.y,k.node.position.z)},{easing:el.quintInOut}))}))];case 1:k.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),h}(D)).prototype,"backgroundMask",[TZ,T$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rh=st(Ru.prototype,"backgroundMaskTransitionDuration",[T0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Rp=st(Ru.prototype,"backgroundMaskTransitionDelay",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),Rd=st(Ru.prototype,"navBarShadow",[T2,T4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rf=st(Ru.prototype,"navBarShadowTransitionDuration",[T3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Ry=st(Ru.prototype,"navBarShadowTransitionDelay",[T5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),Rv=st(Ru.prototype,"pageItems",[T6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Rg=st(Ru.prototype,"currentScreen",[T8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return nB.home}}),Rm=st(Ru.prototype,"uiTransform",[T9,T7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Ru.prototype,"navigate",[Re],Object.getOwnPropertyDescriptor(Ru.prototype,"navigate"),Ru.prototype),st(Ru.prototype,"navigateFromPage",[Rt],Object.getOwnPropertyDescriptor(Ru.prototype,"navigateFromPage"),Ru.prototype),st(Ru.prototype,"hideLoadingScreen",[Rn],Object.getOwnPropertyDescriptor(Ru.prototype,"hideLoadingScreen"),Ru.prototype),st(Ru.prototype,"showLoadingScreen",[Ri],Object.getOwnPropertyDescriptor(Ru.prototype,"showLoadingScreen"),Ru.prototype),st(Ru.prototype,"cleanupPages",[Ra],Object.getOwnPropertyDescriptor(Ru.prototype,"cleanupPages"),Ru.prototype),st(Ru.prototype,"performFullTransition",[Rr],Object.getOwnPropertyDescriptor(Ru.prototype,"performFullTransition"),Ru.prototype),st(Ru.prototype,"mountPage",[Ro],Object.getOwnPropertyDescriptor(Ru.prototype,"mountPage"),Ru.prototype),st(Ru.prototype,"navigateFromNull",[Rs],Object.getOwnPropertyDescriptor(Ru.prototype,"navigateFromNull"),Ru.prototype),Rl=Ru))||Rl)||Rl)||Rl);_._RF.pop(),_._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var Rx,RG,RV,RK,RH,Rq,RW=k.ccclass,Rj=k.property,RX=(Rw=RW("StarProgressBar"),RS=Rj(ol),RE=Rj(L),R_=Rj(V),Rk=Rj(V),RC=Rj(z),Rw((RR=st((RT=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"progressBar",RR,Ke(g)),rt(g,"progressLabel",RI,Ke(g)),rt(g,"current",RL,Ke(g)),rt(g,"total",RP,Ke(g)),rt(g,"separator",RO,Ke(g)),g}return Ue(i,[{key:"setRange",value:function(g,E){this.total=E,this.current=g,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string="".concat(this.current).concat(this.separator).concat(this.total)}},{key:"animateTo",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=this,C=Math.min(g,this.total)/this.total,A=this.current,T=1,R=x(this.progressBar).to(3,{progress:C},{easing:"quadOut",onUpdate:function(E,C){C&&(k.current=A+Math.floor((g-A)*C),null==_||_(k.current),k.current===A-T&&(T++,x(k.progressLabel.node).to(.05,{scale:new em(1.2,1.2,1.2)}).to(.05,{scale:em.ONE}).start()),k.updateProgressLabel())}});null==E||E.addAbortListener(function(){k.current=g,k.updateProgress()});return[4,tZ.runTweenAsync(R,E)];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(D)).prototype,"progressBar",[RS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RI=st(RT.prototype,"progressLabel",[RE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RL=st(RT.prototype,"current",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RP=st(RT.prototype,"total",[Rk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RO=st(RT.prototype,"separator",[RC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RA=RT))||RA);_._RF.pop(),_._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var RY,RJ,RQ,RZ,R$,R0,R1,R2,R4,R3,R5,R6=k.ccclass,R8=k.property,R9=(Rx=R6("EventButton"),RG=R8({type:es(ES)}),RV=R8(J),Rx((Rq=st((RH=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"eventType",Rq,Ke(g)),g._isAvailable=!1,g}return Ue(n,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(g){this._isAvailable=g,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(nO,{type:this.eventType})}},{key:"setAnimationState",value:function(g){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),Je(Ve(n.prototype),"setAnimationState",this).call(this,g)}}]),n}(au)).prototype,"eventType",[RG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ES.STAR_CHEST}}),st(RH.prototype,"isAvailable",[RV],Object.getOwnPropertyDescriptor(RH.prototype,"isAvailable"),RH.prototype),RK=RH))||RK);_._RF.pop(),_._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var R7,Ie,It,In,Ii,Ia,Ir,Io,Is,Il,Iu,Ic,Ih,Ip,Id,If,Iy,Iv,Ig=k.ccclass,Im=k.property,Ib=globalThis.game.player,Iw=(RY=Ig("DashboardHeader"),RJ=Im({type:RX,displayName:"Progress bar",group:"Star Chest"}),RQ=Im({type:R9,displayName:"Button Component",group:"Star Chest"}),RZ=Im({type:ei,displayName:"Default Rest animation",group:"Star Chest"}),R$=Im({type:ei,displayName:"Special Rest animation",group:"Star Chest"}),RY((R2=st((R1=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"starProgressBar",R2,Ke(g)),rt(g,"chestButton",R4,Ke(g)),rt(g,"defaultRestAnimation",R3,Ke(g)),rt(g,"specialRestAnimation",R5,Ke(g)),g.handleStarsUpdateEvent=function(E){var _,k=null!=E?E:null===(_=Ib.getGameData())||void 0===_?void 0:_.stars;void 0!==k&&(g.starProgressBar.setRange(k,20),g.updateStarChestButtonAnimation(k))},g}return Ue(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),Q.on(nR,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function(){Q.off(nR,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function(g){this.handleStarsUpdateEvent(g)}},{key:"updateStarChestButtonAnimation",value:function(g){this.chestButton.isAvailable=g>=20}},{key:"validateRequiredComponents",value:function(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}},{key:"handleClickedSettingsButton",value:function(){l5.openScreen(ib.SETTINGS_SCREEN)}}]),n}(D)).prototype,"starProgressBar",[RJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R4=st(R1.prototype,"chestButton",[RQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R3=st(R1.prototype,"defaultRestAnimation",[RZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R5=st(R1.prototype,"specialRestAnimation",[R$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R0=R1))||R0);_._RF.pop(),_._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var IS,IE,I_,Ik,IC,IA,IT,IR,II,IL,IP,IO,IB=k.ccclass,IN=k.property,ID=k.executeInEditMode,IM=(R7=IB("JourneyLevelAvatar"),Ie=IN({type:eo,displayName:"Avatar node"}),It=IN(C),In=IN(G),Ii=IN(eu),Ia=IN({type:ei,group:"Animation"}),Ir=IN({type:ei,group:"Animation"}),Io=IN({type:ei,group:"Animation"}),Is=IN({type:er,displayName:"Avatar sprite"}),R7(Il=ID((Ic=st((Iu=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"sprite",Ic,Ke(g)),rt(g,"lockIcon",Ih,Ke(g)),rt(g,"animation",Ip,Ke(g)),rt(g,"opacity",Id,Ke(g)),rt(g,"flashAnimation",If,Ke(g)),rt(g,"unlockAnimation",Iy,Ke(g)),rt(g,"spawnAnimation",Iv,Ke(g)),g}return Ue(o,[{key:"avatarSprite",get:function(){var g,E;return null!==(g=null===(E=this.sprite)||void 0===E?void 0:E.spriteFrame)&&void 0!==g?g:null},set:function(g){this.sprite&&(this.sprite.spriteFrame=g)}},{key:"playUnlockAnimation",value:(k=Be(function(){var g,E,_,k,C,A,T,R,I,L,P;return _ts_generator(this,function(O){switch(O.label){case 0:g=this.playAnimation(this.unlockAnimation),E=this.lockIcon.position.x,_=this.lockIcon.position.y,k=[45,135],C=(Math.random()*(k[1]-k[0])+k[0])*(Math.PI/180),A=this.lockIcon.position.x+150*Math.cos(C),T=this.lockIcon.position.y+150*Math.sin(C),R=_-400,I=tZ.runTweenAsync(x(this.lockIcon).delay(.3).to(.2,{position:new em(A,T,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new em(A,R,this.lockIcon.position.z)},{easing:"cubicIn"})),L=[0,360],P=tZ.runTweenAsync(x(this.lockIcon).delay(.3).to(.6,{eulerAngles:new em(0,0,Math.random()*(L[1]-L[0])*(A>E?-1:1))},{easing:"sineOut"}));return[4,Promise.all([g,I,P])];case 1:O.sent(),this.lockIcon.position=new em(E,_,this.lockIcon.position.z),this.lockIcon.eulerAngles=new em(0,0,0);return[2]}})}),function(){return k.apply(this,arguments)})},{key:"playFlashAnimation",value:(_=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=this.node.position.y,_=this.playAnimation(this.flashAnimation),k=tZ.runTweenAsync(x(this.node).to(.1,{position:new em(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new em(this.node.position.x,E,this.node.position.z)},{easing:"sineIn"}),g);return[4,Promise.all([_,k])];case 1:C.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(em.ZERO)}},{key:"playAnimation",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runAnimationAsync(this.animation,g.name)];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var g=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some(function(E){return null!==E&&(E.name===g.flashAnimation.name||E.name===g.unlockAnimation.name||E.name===g.spawnAnimation.name)}))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),o}(D)).prototype,"sprite",[Ie],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ih=st(Iu.prototype,"lockIcon",[It],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ip=st(Iu.prototype,"animation",[In],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Id=st(Iu.prototype,"opacity",[Ii],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),If=st(Iu.prototype,"flashAnimation",[Ia],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iy=st(Iu.prototype,"unlockAnimation",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv=st(Iu.prototype,"spawnAnimation",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Iu.prototype,"avatarSprite",[Is],Object.getOwnPropertyDescriptor(Iu.prototype,"avatarSprite"),Iu.prototype),Il=Iu))||Il)||Il);_._RF.pop(),_._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var IF,IU,Iz,Ix,IG,IV,IK,IH,Iq,IW,Ij,IX,IY,IJ,IQ,IZ,I$,I0,I1,I2,I4,I3=k.ccclass,I5=k.property,I6=k.executeInEditMode,I8=(IS=I3("JourneyProgressBar"),IE=I5(ol),I_=I5(L),Ik=I5(eu),IC=I5(V),IA=I5(V),IT=I5(z),IS(IR=I6((IL=st((II=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"progressBar",IL,Ke(g)),rt(g,"progressLabel",IP,Ke(g)),rt(g,"labelUIOpacity",IO,Ke(g)),g.currentProgress=10,g.totalProgress=10,g.labelSeparator="/",g}return Ue(i,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(g){this.labelSeparator=g,this.updateProgress()}},{key:"setRange",value:function(g,E){this.totalProgress=E;var _=g;_>E&&(_=E),this.currentProgress=_,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(E=Be(function(g){var E,_,k,C,A,T,R,I,L,P,O,B,N,D,M,F;return _ts_generator(this,function(U){switch(U.label){case 0:E=this,_=g.nextCurr,k=g.nextTotal,C=g.numberOfProgressBar,A=void 0===C?0:C,T=g.onProgressBarPassed,R=g.signal,I=_/k,L=x(this.labelUIOpacity).to(.2,{opacity:0}),P=x(this.labelUIOpacity).to(.2,{opacity:255}),O=A<1?1:Math.sqrt(A)+1,B=0===A?I:A+I,N=1,D=this.progressBar.progress,M=B,F=tZ.runOnUpdateAsync(this.node,O,function(g){var _=el.sineInOut(g),k=eO(D,M,_);E.progressBar.progress=k%1,k>N&&(N=0===k?1:Math.ceil(k),null==T||T())},R);return[4,Promise.all([tZ.runTweenAsync(L,R),F])];case 1:U.sent(),this.currentProgress=_,this.totalProgress=k,this.updateProgress();return[4,tZ.runTweenAsync(P,R)];case 2:return[2,(U.sent(),this.labelUIOpacity.opacity=255,I)]}})}),function(g){return E.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string="".concat(this.currentProgress).concat(this.separator).concat(this.totalProgress)}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(D)).prototype,"progressBar",[IE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IP=st(II.prototype,"progressLabel",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IO=st(II.prototype,"labelUIOpacity",[Ik],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(II.prototype,"total",[IC],Object.getOwnPropertyDescriptor(II.prototype,"total"),II.prototype),st(II.prototype,"current",[IA],Object.getOwnPropertyDescriptor(II.prototype,"current"),II.prototype),st(II.prototype,"separator",[IT],Object.getOwnPropertyDescriptor(II.prototype,"separator"),II.prototype),IR=II))||IR)||IR);_._RF.pop(),_._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var I9,I7,Le,Lt,Ln,Li,La,Lr,Lo,Ls,Ll,Lu,Lc,Lh,Lp,Ld,Lf,Ly,Lv,Lg,Lm,Lb,Lw,LS,LE,L_,Lk,LC,LA,LT,LR,LI,LL=k.ccclass,LP=k.property,LO=(IF=LL("ProgressConfiguration"),IU=LP(er),Iz=LP(z),IF((IG=st((Ix=Ue(function e(){Fe(this,e),rt(this,"avatar",IG,this),rt(this,"themeId",IV,this)})).prototype,"avatar",[IU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IV=st(Ix.prototype,"themeId",[Iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ix)),IK=LL("JourneyProgressAnimator"),IH=LP(I8),Iq=LP(C),IW=LP(eo),Ij=LP(IM),IX=LP({type:K,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),IY=nC.onlyRunInLifeCycleAsync,IJ=nC.onlyRunInLifeCycle,IK((I$=st((IZ=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"progressBar",I$,Ke(g)),rt(g,"currentLevelAvatarNode",I0,Ke(g)),rt(g,"currentLevelAvatar",I1,Ke(g)),rt(g,"nextLevelAvatar",I2,Ke(g)),rt(g,"nextLevelYOffset",I4,Ke(g)),g.isAnimating=!1,g}return Ue(l,[{key:"setRange",value:function(g,E){this.progressBar.setRange(g,E)}},{key:"animateTo",value:(T=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.isAnimating)return[2,(console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve())];this.isAnimating=!0;_=g!==this.progressBar.current;if(!_)return[3,2];return[4,this.progressBar.animateTo({nextCurr:g,nextTotal:this.progressBar.total,signal:E})];case 1:_=k.sent();k.label=2;case 2:this.isAnimating=!1;return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"animateToNextLevel",value:(A=Be(function(g){var E,_,k,C,A,T,R,I,L,P;return _ts_generator(this,function(O){switch(O.label){case 0:E=this,_=g.nextCurr,k=g.nextTotal,C=g.mapsPassed,A=g.signal;if(!this.isAnimating)return[3,1];console.warn("JourneyProgressAnimator: animation already in progress");return[3,8];case 1:this.isAnimating=!0;T=C.length-2;if(0!==T)return[3,3];return[4,this.progressBar.animateTo({nextCurr:_,nextTotal:k,signal:A})];case 2:return[2,(O.sent(),void(this.isAnimating=!1))];case 3:return[4,this.animateTargetAvaToCenter(A)];case 4:O.sent();R=1;return[4,this.progressBar.animateTo({signal:A,nextCurr:_,nextTotal:k,numberOfProgressBar:T,onProgressBarPassed:function(){if(1===R)return E.nextLevelAvatar.playUnlockAnimation(),void(R+=1);if(R>=C.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");E.nextLevelAvatar.playFlashAnimation(A),E.setNextLevelAvatar(C[R].theme),R+=1}})];case 5:O.sent();return[4,this.animateTargetAvaToPrev(A)];case 6:O.sent();I=C[C.length-1].theme,L=C[C.length-2].theme;this.setCurrentLevelAvatar(L),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal();P=this.nextLevelAvatar;return[4,this.getSpriteFrameByThemeId(I)];case 7:P.avatarSprite=O.sent(),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1;O.label=8;case 8:return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(C=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=new em(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);return[4,tZ.runTweenAsync(x(this.nextLevelAvatar.node).to(1,{position:E},{easing:"cubicInOut"}),g)];case 1:_.sent(),this.nextLevelAvatar.node.position=E;return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this.currentLevelAvatarNode.position.clone();return[4,tZ.runTweenAsync(x(this.nextLevelAvatar.node).to(1,{position:E},{easing:"cubicInOut"}),g)];case 1:_.sent(),this.nextLevelAvatar.node.position=E;return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:(_=Be(function(g){return _ts_generator(this,function(E){return[2,ie.loadThemeThumbnailAsync(g)]})}),function(g){return _.apply(this,arguments)})},{key:"loadAndSetAvatar",value:(E=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.getSpriteFrameByThemeId(g)];case 1:_=k.sent();_?this.setAvatar(_,E):console.warn("JourneyProgressAnimator: ".concat(g," is null"));return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"setAvatar",value:function(g,E){_instanceof(E,IM)?E.avatarSprite=g:E.spriteFrame=g}},{key:"setCurrentLevelAvatar",value:function(g){this.loadAndSetAvatar(g,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(g){this.loadAndSetAvatar(g,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}}]),l}(D)).prototype,"progressBar",[IH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I0=st(IZ.prototype,"currentLevelAvatarNode",[Iq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I1=st(IZ.prototype,"currentLevelAvatar",[IW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I2=st(IZ.prototype,"nextLevelAvatar",[Ij],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I4=st(IZ.prototype,"nextLevelYOffset",[IX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),st(IZ.prototype,"loadAndSetAvatar",[IY],Object.getOwnPropertyDescriptor(IZ.prototype,"loadAndSetAvatar"),IZ.prototype),st(IZ.prototype,"setAvatar",[IJ],Object.getOwnPropertyDescriptor(IZ.prototype,"setAvatar"),IZ.prototype),IQ=IZ))||IQ);_._RF.pop(),_._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var LB,LN,LD,LM,LF,LU,Lz,Lx,LG,LV=k.ccclass,LK=k.property,LH=globalThis.game,Lq=LH.storage,LW=LH.monitorError,Lj=GameCore.Utils,LX=Lj.Array,LY=Lj.Json,LJ=(I9=LV("HomeContent"),I7=nC.required(),Le=LK({type:L,group:"Play Button"}),Lt=nC.required(),Ln=LK({type:B,group:"Play Button"}),Li=nC.required(),La=LK({type:C,group:"Play Button"}),Lr=nC.required(),Lo=LK({type:C,group:"Play Button"}),Ls=nC.required(),Ll=LK(LO),Lu=nC.required(),Lc=LK(Iw),Lh=nC.required(),Lp=LK(eu),Ld=nC.required(),Lf=LK(Cn),Ly=nC.onlyRunInLifeCycleAsync,Lv=nC.onlyRunInLifeCycleAsync,Lg=nC.onlyRunInLifeCycleAsync,Lm=nC.onlyRunInLifeCycleAsync,Lb=nC.onlyRunInLifeCycleAsync,I9((LE=st((LS=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"playButtonLabel",LE,Ke(g)),rt(g,"playButton",L_,Ke(g)),rt(g,"playBackground",Lk,Ke(g)),rt(g,"hardLevelBackground",LC,Ke(g)),rt(g,"journeyProgressAnimator",LA,Ke(g)),rt(g,"dashboardHeader",LT,Ke(g)),rt(g,"overlayDuringAnim",LR,Ke(g)),rt(g,"coinContainer",LI,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){nC.decorateComponent(this)}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(nI)}},{key:"setPlayButton",value:function(g){var E="Level ".concat(g);this.playButtonLabel.string=E;var _=g%5==0;this.playBackground.active=!_,this.hardLevelBackground.active=_}},{key:"updateStarProgress",value:function(g){this.dashboardHeader.updateStarProgress(g)}},{key:"setUnlockProgress",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E;this.setProgress(g),this.updateCurrentMapInStorage(g,_)}},{key:"shouldPlayUnlockAnimation",value:function(){var g,E,_=Lq.getStorage("dashboard");if(null==_)return null==LW||LW.sendException(new Error("DashboardScene: dashboardStorage not found")),!1;if(!(null!==(g=_.animateToCurrentLevel)&&void 0!==g&&g))return!1;var k=Lq.getStorage("tournament");if(null==k)return null==LW||LW.sendException(new Error("DashboardScene: tournamentStorage not found")),!1;if(null!==(E=k.animateTournamentLeader)&&void 0!==E&&E)return!1;var C=_.lastMapPayload,A=lh.getCurrentMapProgress();return LY.encode(C)!==LY.encode(A)&&!(LX.searchIndex(la.mapOrder,function(g){return g.id===C.id})>LX.searchIndex(la.mapOrder,function(g){return g.id===A.id}))}},{key:"playUnlockProgressAnimation",value:function(g){var E=Lq.getStorage("dashboard");if(null==E)throw new Error("DashboardScene: dashboardStorage not found");var _=E.lastMapPayload,k=lh.getCurrentMapProgress(),C=LX.searchIndex(la.mapOrder,function(g){return g.id===_.id}),A=LX.searchIndex(la.mapOrder,function(g){return g.id===k.id}),T=la.mapOrder.slice(C,A+2);return _.id===k.id?this.playUnlockProgressAnimationOnly(k,_,g):this.playUnlockProgressAndPackAnimation(_,k,T,g)}},{key:"playUnlockProgressAndPackAnimation",value:(C=Be(function(g,E,_,k){return _ts_generator(this,function(C){switch(C.label){case 0:this.setProgress(De({},g)),this.updateCurrentMapInStorage(De({},E),!0),this.playButton.interactable=!1;return[4,this.showOwnOverlay(k)];case 1:C.sent();return[4,this.journeyProgressAnimator.animateToNextLevel({nextCurr:E.progress,nextTotal:E.max,mapsPassed:_,signal:k})];case 2:C.sent();return[4,this.hideOwnOverlay(k)];case 3:C.sent(),this.playButton.interactable=!0;return[2]}})}),function(g,E,_,k){return C.apply(this,arguments)})},{key:"playUnlockProgressAnimationOnly",value:(k=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:this.setProgress(De(De({},g),{},{progress:E.progress})),this.updateCurrentMapInStorage(De({},g),!0);k=g.progress;return[4,this.showOwnOverlay(_)];case 1:C.sent();return[4,this.journeyProgressAnimator.animateTo(k,_)];case 2:C.sent();return[4,this.hideOwnOverlay(_)];case 3:C.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"hideOwnOverlay",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runTweenAsync(x(this.overlayDuringAnim).to(.3,{opacity:0}),g)];case 1:E.sent(),this.overlayDuringAnim.opacity=0;return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"showOwnOverlay",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runTweenAsync(x(this.overlayDuringAnim).to(.3,{opacity:150}),g)];case 1:E.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setProgress",value:function(g){var E=g.currentTheme,_=g.nextTheme,k=g.progress,C=g.max;this.journeyProgressAnimator.setCurrentLevelAvatar(E),this.journeyProgressAnimator.setNextLevelAvatar(null!=_?_:E),this.journeyProgressAnimator.setRange(k,C)}},{key:"updateCurrentMapInStorage",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=Lq.getStorage("dashboard");if(null!=k){var C=k.animateToCurrentLevel;Lq.setStorageData("dashboard","animateToCurrentLevel",!_&&C),Lq.setStorageData("dashboard","lastMapPayload",g)}else null==LW||LW.sendException(new Error("DashboardScene: dashboardStorage not found"))}}]),r}(D)).prototype,"playButtonLabel",[I7,Le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L_=st(LS.prototype,"playButton",[Lt,Ln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lk=st(LS.prototype,"playBackground",[Li,La],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LC=st(LS.prototype,"hardLevelBackground",[Lr,Lo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LA=st(LS.prototype,"journeyProgressAnimator",[Ls,Ll],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LT=st(LS.prototype,"dashboardHeader",[Lu,Lc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LR=st(LS.prototype,"overlayDuringAnim",[Lh,Lp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LI=st(LS.prototype,"coinContainer",[Ld,Lf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(LS.prototype,"playUnlockProgressAnimation",[Ly],Object.getOwnPropertyDescriptor(LS.prototype,"playUnlockProgressAnimation"),LS.prototype),st(LS.prototype,"playUnlockProgressAndPackAnimation",[Lv],Object.getOwnPropertyDescriptor(LS.prototype,"playUnlockProgressAndPackAnimation"),LS.prototype),st(LS.prototype,"playUnlockProgressAnimationOnly",[Lg],Object.getOwnPropertyDescriptor(LS.prototype,"playUnlockProgressAnimationOnly"),LS.prototype),st(LS.prototype,"hideOwnOverlay",[Lm],Object.getOwnPropertyDescriptor(LS.prototype,"hideOwnOverlay"),LS.prototype),st(LS.prototype,"showOwnOverlay",[Lb],Object.getOwnPropertyDescriptor(LS.prototype,"showOwnOverlay"),LS.prototype),Lw=LS))||Lw);_._RF.pop(),_._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var LQ,LZ,L$,L0,L1,L2,L4,L3,L5,L6,L8,L9,L7,Pe,Pt,Pn,Pi,Pa,Pr,Po,Ps,Pl,Pu,Pc,Ph,Pp,Pd,Pf,Py,Pv,Pg,Pm,Pb,Pw=k.ccclass,PS=k.property,PE=GameCore.Utils.Array,P_=(LB=Pw("NavManager"),LN=PS(C),LD=PS(C),LM=PS(t2),LB((Lz=st((LU=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"selectorNode",Lz,Ke(g)),rt(g,"selectedButtonNode",Lx,Ke(g)),rt(g,"autoLayout",LG,Ke(g)),g.navButtons=[],g.isNavigating=!1,g}return Ue(s,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var g;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(g=this.selectedButtonNode)||void 0===g?void 0:g.getComponentInChildren("NavButton"),nC.lazyValidateProperties(this)}},{key:"select",value:(A=Be(function(g){var E;return _ts_generator(this,function(_){E=this;if(!this.isNavigating){if(!PE.has(this.navButtons,g))throw new Error("NavManager: Button not found");if(g!==this.selectedButton){if(!g.isWIP)return[2,(this.isNavigating=!0,this.node.scene.emit(nL,{from:this.selectedButton.buttonType,to:g.buttonType}),new Promise(function(_){E.node.scene.once(nP,function(){var k=E.selectedButton.deselect();E.autoLayout.selectedIndex=E.navButtons.indexOf(g),E.selectedButton=g;var C=E.autoLayout.getSelectedWorldX()-g.getSelectedWorldDistanceX(),A=E.playSelectorAnimation(C),T=g.select();Promise.all([k,T,A]).then(function(){E.isNavigating=!1,_()})})}))];this.handleWIPButton()}}return[2]})}),function(g){return A.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(C=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:E=this.isNavigating;if(E)return[3,4];if(!PE.has([nB.store],g.buttonType))return[3,1];_=this.handleWIPButton();return[3,3];case 1:return[4,this.select(g)];case 2:_=k.sent();k.label=3;case 3:E=_;k.label=4;case 4:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"selectByType",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=PE.search(this.navButtons,function(E){return E.buttonType===g});if(!E)throw new Error("NavManager: Button not found");return[4,this.selectUsingSceneTransition(E)];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"handleWIPButton",value:function(){l5.openScreen(ib.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){g=this;if(!this.currentButton||!PE.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");E=this.currentButton.buttonType;return[2,(this.node.scene.emit(nL,{from:null,to:E}),new Promise(function(E){g.node.scene.once(nP,function(){g.autoLayout.selectedIndex=g.navButtons.indexOf(g.currentButton);var _=g.navButtons.map(function(E){return E===g.currentButton?E.select(!1):E.deselect(!1,!0)}),k=g.autoLayout.getSelectedWorldX()-g.currentButton.getSelectedWorldDistanceX();g.selectorNode.worldPosition=new em(k,g.selectorNode.worldPosition.y,0),Promise.all(_).then(function(){E()})})}))]})}),function(){return _.apply(this,arguments)})},{key:"playSelectorAnimation",value:(E=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=new em(1,1,1),k=this.selectorNode.worldPosition.clone(),C=new em(1.2*_.x,.8*_.y,1);return[4,tZ.runTweenAsync(x(this.selectorNode).to(.3,{worldPosition:new em(g,k.y,0)},{easing:"quintInOut",onUpdate:function(g,k){if(void 0!==k){var A=E.calculateCurrentSquashScale(_,C,k);E.selectorNode.scale=A}}}))];case 1:A.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setIgnoreInput",value:function(g){var E,_=!(arguments.length>0&&void 0!==g)||g,k=at(this.navButtons);try{for(k.s();!(E=k.n()).done;){var C=E.value,A=C.getComponentInChildren(B);A&&(A.interactable=!_)}}catch(g){k.e(g)}finally{k.f()}}},{key:"calculateCurrentSquashScale",value:function(g,E,_){var k=this.splitIntoSquashRatio(_);return g.clone().lerp(E,k)}},{key:"splitIntoSquashRatio",value:function(g){return g<.5?2*g:1-2*(g-.5)}}]),s}(D)).prototype,"selectorNode",[LN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lx=st(LU.prototype,"selectedButtonNode",[LD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LG=st(LU.prototype,"autoLayout",[LM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LF=LU))||LF);_._RF.pop(),_._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var Pk,PC,PA,PT,PR,PI,PL,PP,PO,PB,PN,PD,PM=k.ccclass,PF=k.disallowMultiple,PU=k.property,Pz=globalThis.game,Px=Pz.event,PG=Pz.storage,PV=Pz.player,PK=Pz.leaderboard,PH=GameCore,Pq=PH.Events,PW=PH.Match.Modes,Pj=PH.Configs.DailyRewards,PX=PH.Utils,PY=PX.Time,PJ=PX.Array;LQ=PM("DashboardScene"),LZ=nC.required(),L$=PU(_$),L0=nC.required(),L1=PU(P_),L2=nC.required(),L4=PU(is),L3=nC.required(),L5=PU(Rz),L6=nC.required(),L8=PU(kW),L9=nC.onlyRunInLifeCycle,L7=nC.onlyRunInLifeCycle,Pe=nC.onlyRunInLifeCycleAsync,Pt=nC.onlyRunInLifeCycleAsync,Pn=nC.onlyRunInLifeCycleAsync,Pi=nC.onlyRunInLifeCycleAsync,Pa=nC.onlyRunInLifeCycle,Pr=nC.onlyRunInLifeCycleAsync,Po=nC.onlyRunInLifeCycleAsync,Ps=nC.onlyRunInLifeCycleAsync,Pl=nC.onlyRunInLifeCycleAsync,Pu=nC.onlyRunInLifeCycleAsync,Pc=nC.onlyRunInLifeCycleAsync,Ph=nC.onlyRunInLifeCycleAsync,Pp=nC.onlyRunInLifeCycle,LQ(Pd=PF((Py=st((Pf=function(g){ze(v,g);var E,_,k,C,A,T,R,I,L,P,O,B,N,D,M=Xe(v);function v(){var g;Fe(this,v);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=M.call.apply(M,[this].concat(_)),"coinManager",Py,Ke(g)),rt(g,"navManager",Pv,Ke(g)),rt(g,"bgComp",Pg,Ke(g)),rt(g,"pageManager",Pm,Ke(g)),rt(g,"pageAnimSkipOverlay",Pb,Ke(g)),g.firstNavigation=!0,g.isFirstNavToCollections=!0,g.isFirstNavToTournament=!0,g.navigationSignal=null,g.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch(function(g){console.warn("subscribeBotAsync",g)})},g.playBgAnim=Be(function(){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=PG.getStorage("dashboard");if(null==_)throw new Error("DashboardScene: dashboardStorage not found");k=null!==(E=_.animateToCurrentLevel)&&void 0!==E&&E,C=De({},_.lastMapPayload),A=lh.getCurrentMapProgress(),T=C.currentTheme===A.currentTheme&&C.nextTheme===A.nextTheme,R=A.currentTheme;if(!(k&&!T))return[3,5];return[4,tZ.waitTweenAsync(2)];case 1:I.sent();I.label=2;case 2:I.trys.push([2,4,,5]);return[4,g.bgComp.animateToNextTheme(R)];case 3:I.sent();return[3,5];case 4:I.sent();return[3,5];case 5:return[2]}})}),g}return Ue(v,[{key:"__preload",value:function(){}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(nL,this.onNavigate,this)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(nI,this.handlePlayButtonPress,this),this.node.scene.on(nO,this.handleEventButtonPress,this)}},{key:"onLoad",value:function(){nC.decorateComponent(this),this.listenNavigationEvents(),this.listenDashboardEvents(),this.coinManager.init(),lh.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(lh.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var g,E=(null!==(g=PV.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;_=0===_?1:_,PV.setGameData({level:_})}},{key:"start",value:function(){PV.getPlayerSetting("music")&&this.updateMusic(),this.playBgAnim(),this.pageManager.init(),this.navManager.selectDefaultNavBtn(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadScenes",value:function(){lV.preloadGameScene()}},{key:"initBgComp",value:function(){var g,E=PG.getStorage("dashboard");if(null==E)throw new Error("DashboardScene: dashboardStorage not found");var _=null!==(g=E.animateToCurrentLevel)&&void 0!==g&&g,k=De({},E.lastMapPayload),C=lh.getCurrentMapProgress(),A=k.currentTheme===C.currentTheme&&k.nextTheme===C.nextTheme,T=C.currentTheme;_&&!A?this.bgComp.setCurrentTheme(k.currentTheme):this.bgComp.setCurrentTheme(T)}},{key:"handlePlayButtonPress",value:(D=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:T.trys.push([0,3,,4]);E=lh.getCurrentMapProgress(),_=(null!==(g=PV.getGameData())&&void 0!==g?g:{}).level,k=void 0===_?1:_;return[4,lT.setMatchCustomDataAsync({level:k})];case 1:T.sent();return[4,lT.startMatchAsync(PW.SINGLE)];case 2:T.sent(),this.updateCurrentMapInStorage(E),PG.setStorageData("collection","lastMapPack",E.id),PG.setStorageData("collection","animateMapPackUnlock",!1);C=PG.getStorage("leaderboard_content").lastTabOpened;this.getPlayerLeader(C).then(function(g){if(g){var E=g.score;PG.setStorageData("leaderboard_content","previousScore",E)}}),lV.switchScene(s0,{level:k});return[3,4];case 3:A=T.sent();return[2,void console.error(A)];case 4:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"getPlayerLeader",value:(N=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E="global"===g?sj:sX;if(!E)return[2,null];_=PV.getPlayerId();return[4,PK.getLeadersByPlayerIdsAsync(E,[_])];case 1:k=C.sent();return[2,0===k.length?null:k[0]]}})}),function(g){return N.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(g){PG.setStorageData("dashboard","animateToCurrentLevel",!1),PG.setStorageData("dashboard","lastMapPayload",g)}},{key:"updateMusic",value:(B=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=i8.getCurrentMusic()!==ih.BG_MUSIC;if(!g)return[3,3];return[4,i8.setVolumeMusic(0,!0)];case 1:E.sent();return[4,tZ.waitTweenAsync(1)];case 2:g=E.sent();E.label=3;case 3:i8.playMusic(ih.BG_MUSIC),i8.turnUpMusic();return[2]}})}),function(){return B.apply(this,arguments)})},{key:"checkDailyRewardsOpenable",value:function(){var g=PV.getPlayerData().dailyRewarded,E=g.logDays,_=void 0===E?[]:E,k=g.lastRewarded,C=void 0===k?0:k;if(_.length>Pj.MaxDays)return!0;if(Pj.MockTime>0&&Date.now()-C>=1e3*Pj.MockTime)return!0;return!PY.isToday(C)}},{key:"onNavigate",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=(this.firstNavigation&&(this.firstNavigation=!1,this.pageManager.unmountAndHideAll()),g.to);switch(E){case nB.store:return[3,1];case nB.collections:return[3,2];case nB.tournaments:return[3,5];case nB.leaderboard:return[3,5];case nB.home:return[3,7]}return[3,9];case 1:return[3,10];case 2:return[4,this.triggerPageNavigation(g)];case 3:_.sent();return[4,this.handleLogicAfterNavigateToCollections()];case 4:_.sent(),this.cleanupAfterPageNavigation();return[3,10];case 5:return[4,this.triggerPageNavigation(g)];case 6:_.sent(),this.cleanupAfterPageNavigation();return[3,10];case 7:return[4,this.handleNavigateToHome(g)];case 8:_.sent();return[3,10];case 9:throw new Error("DashboardScene: Unhandled page name");case 10:return[2]}})}),function(g){return O.apply(this,arguments)})},{key:"handleLogicAfterNavigateToCollections",value:(P=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=null===(g=this.pageManager.getPage(nB.collections))||void 0===g?void 0:g.getContainer().getComponentInChildren(TV);if(null==E)throw new Error("CollectionsContent not found");_=new nD,k=E.shouldAnimateThemeBlockUnlock();C=k;if(!C)return[3,2];return[4,this.openSkipOverlay(_)];case 1:C=T.sent();T.label=2;case 2:return[4,this.tryPlayScrollToCollectionAnim(E,_)];case 3:T.sent();return[4,E.playThemeTabUnlockAnim(_)];case 4:T.sent();A=k;if(!A)return[3,6];return[4,this.closeSkipOverlay()];case 5:A=T.sent();T.label=6;case 6:_.abort();return[2]}})}),function(){return P.apply(this,arguments)})},{key:"closeSkipOverlay",value:(L=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.pageAnimSkipOverlay.close()];case 1:g.sent();return[2]}})}),function(){return L.apply(this,arguments)})},{key:"openSkipOverlay",value:(I=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,this.pageAnimSkipOverlay.open({onSkip:function(){return g.abort()},opacity:200})];case 1:E.sent();return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"tryPlayScrollToCollectionAnim",value:(R=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=lh.getCurrentUnlockingThemeIndex();k=this.isFirstNavToCollections&&null!==_;if(!k)return[3,2];return[4,g.scrollToCurrentUnlockingTheme(_,E)];case 1:k=(C.sent(),this.isFirstNavToCollections=!1);C.label=2;case 2:return[2]}})}),function(g,E){return R.apply(this,arguments)})},{key:"cleanupAfterPageNavigation",value:function(){this.navManager.setIgnoreInput(!1)}},{key:"triggerPageNavigation",value:(T=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:null===(E=this.navigationSignal)||void 0===E||E.abort(),this.navigationSignal=new nD;return[4,this.pageManager.navigate(g,this.navigationSignal)];case 1:_.sent();return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"handleNavigateToHome",value:(A=Be(function(g){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:_=this;null===(E=this.navigationSignal)||void 0===E||E.abort(),this.navigationSignal=new nD;return[4,this.pageManager.navigate(g,this.navigationSignal,Be(function(){return _ts_generator(this,function(g){_.initializeHomepageCoinManager();return[2]})}))];case 1:k.sent();return[4,this.handleLogicAfterNavigateToHome()];case 2:k.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"handleLogicAfterNavigateToHome",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.tryOpenDailyRewardsScreen()];case 1:g.sent(),this.attemptCallSubscribeBot();return[4,this.waitUntilCoinManagerFinishesAnyAnimation()];case 2:g.sent();return[4,this.waitUntilPageAnimSkipOverlayCloses()];case 3:g.sent();return[4,this.tryNavigateToTournament()];case 4:g.sent();return[4,this.tryPlayLevelUpAnimation()];case 5:g.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"waitUntilCoinManagerFinishesAnyAnimation",value:function(){return this.coinManager.untilFinishesCollectAnim()}},{key:"waitUntilPageAnimSkipOverlayCloses",value:function(){return this.pageAnimSkipOverlay.untilClosed()}},{key:"tryNavigateToTournament",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if(!PG.getStorage("tournament").animateTournamentLeader)return[3,2];return[4,this.navManager.selectByType(nB.tournaments)];case 1:return[2,g.sent()];case 2:if(!this.isFirstNavToTournament)return[3,8];this.isFirstNavToTournament=!1;g.label=3;case 3:g.trys.push([3,7,,8]);if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");return[4,GameSDK.getTournamentAsync()];case 4:if(!(g.sent().getEndTime()<Date.now()/1e3))return[3,6];return[4,this.navManager.selectByType(nB.tournaments)];case 5:return[2,g.sent()];case 6:return[3,8];case 7:g.sent();return[3,8];case 8:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"tryPlayLevelUpAnimation",value:(_=Be(function(){var g,E,_,k,C,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:E=this,_=null===(g=this.pageManager.getPage(nB.home))||void 0===g?void 0:g.getContainer().getComponentInChildren(LJ);if(null==_)throw new Error("DashboardScene: Homepage not found");k=new nD;k.chain(this.navigationSignal);C=_.shouldPlayUnlockAnimation(),A=this.shouldPlayPackUnlockAnimation();T=C;if(!T)return[3,7];R=A;if(!R)return[3,2];return[4,this.pageAnimSkipOverlay.open({onSkip:function(){return k.abort()},opacity:150})];case 1:R=L.sent();L.label=2;case 2:return[4,_.playUnlockProgressAnimation(k)];case 3:L.sent();I=A;if(!I)return[3,6];return[4,this.pageAnimSkipOverlay.close()];case 4:L.sent();return[4,k.callAsync(function(){return E.navManager.selectByType(nB.collections)})];case 5:I=L.sent();L.label=6;case 6:T=I;L.label=7;case 7:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"shouldPlayPackUnlockAnimation",value:function(){var g=PG.getStorage("dashboard");if(null==g)throw new Error("DashboardScene: dashboardStorage not found");var E=g.lastMapPayload,_=lh.getCurrentMapProgress();return PJ.searchIndex(la.mapOrder,function(g){return g.id===E.id})!==PJ.searchIndex(la.mapOrder,function(g){return g.id===_.id})}},{key:"initializeHomepageCoinManager",value:function(){var g,E=null===(g=this.pageManager.getPage(nB.home))||void 0===g?void 0:g.getContainer().getComponentInChildren(LJ);if(null==E)throw new Error("DashboardScene: Homepage not found");this.coinManager.setTargetContainer(E.getCoinContainer()),this.coinManager.emitCoinAmount()}},{key:"tryOpenDailyRewardsScreen",value:(E=Be(function(){return _ts_generator(this,function(g){if(this.checkDailyRewardsOpenable())return[2,(l5.openScreen(ib.DAILY_REWARDS_SCREEN),new Promise(function(g){Px.on(Pq.CLOSED_SCREEN,function t(E){E.screenName===iw[ib.DAILY_REWARDS_SCREEN]&&(g(),Px.off(Pq.CLOSED_SCREEN,t))})}))];return[2]})}),function(){return E.apply(this,arguments)})},{key:"handleEventButtonPress",value:function(g){switch(g.type){case ES.STAR_CHEST:l5.openScreen(ib.STAR_CHEST_SCREEN);break;case ES.BALLOON:l5.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}}}]),v}(D)).prototype,"coinManager",[LZ,L$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv=st(Pf.prototype,"navManager",[L0,L1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pg=st(Pf.prototype,"bgComp",[L2,L4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm=st(Pf.prototype,"pageManager",[L3,L5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pb=st(Pf.prototype,"pageAnimSkipOverlay",[L6,L8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Pf.prototype,"preloadScenes",[L9],Object.getOwnPropertyDescriptor(Pf.prototype,"preloadScenes"),Pf.prototype),st(Pf.prototype,"initBgComp",[L7],Object.getOwnPropertyDescriptor(Pf.prototype,"initBgComp"),Pf.prototype),st(Pf.prototype,"handlePlayButtonPress",[Pe],Object.getOwnPropertyDescriptor(Pf.prototype,"handlePlayButtonPress"),Pf.prototype),st(Pf.prototype,"onNavigate",[Pt],Object.getOwnPropertyDescriptor(Pf.prototype,"onNavigate"),Pf.prototype),st(Pf.prototype,"handleLogicAfterNavigateToCollections",[Pn],Object.getOwnPropertyDescriptor(Pf.prototype,"handleLogicAfterNavigateToCollections"),Pf.prototype),st(Pf.prototype,"tryPlayScrollToCollectionAnim",[Pi],Object.getOwnPropertyDescriptor(Pf.prototype,"tryPlayScrollToCollectionAnim"),Pf.prototype),st(Pf.prototype,"cleanupAfterPageNavigation",[Pa],Object.getOwnPropertyDescriptor(Pf.prototype,"cleanupAfterPageNavigation"),Pf.prototype),st(Pf.prototype,"triggerPageNavigation",[Pr],Object.getOwnPropertyDescriptor(Pf.prototype,"triggerPageNavigation"),Pf.prototype),st(Pf.prototype,"handleNavigateToHome",[Po],Object.getOwnPropertyDescriptor(Pf.prototype,"handleNavigateToHome"),Pf.prototype),st(Pf.prototype,"waitUntilCoinManagerFinishesAnyAnimation",[Ps],Object.getOwnPropertyDescriptor(Pf.prototype,"waitUntilCoinManagerFinishesAnyAnimation"),Pf.prototype),st(Pf.prototype,"waitUntilPageAnimSkipOverlayCloses",[Pl],Object.getOwnPropertyDescriptor(Pf.prototype,"waitUntilPageAnimSkipOverlayCloses"),Pf.prototype),st(Pf.prototype,"tryNavigateToTournament",[Pu],Object.getOwnPropertyDescriptor(Pf.prototype,"tryNavigateToTournament"),Pf.prototype),st(Pf.prototype,"tryPlayLevelUpAnimation",[Pc],Object.getOwnPropertyDescriptor(Pf.prototype,"tryPlayLevelUpAnimation"),Pf.prototype),st(Pf.prototype,"tryOpenDailyRewardsScreen",[Ph],Object.getOwnPropertyDescriptor(Pf.prototype,"tryOpenDailyRewardsScreen"),Pf.prototype),st(Pf.prototype,"handleEventButtonPress",[Pp],Object.getOwnPropertyDescriptor(Pf.prototype,"handleEventButtonPress"),Pf.prototype),Pd=Pf))||Pd);_._RF.pop(),_._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var PQ,PZ=k.ccclass,P$=k.property,P0=globalThis.game,P1=P0.player,P2=P0.storage,P4=P0.monitorError,P3=GameCore.Utils.Number;Pk=PZ("HomePage"),PC=nC.required(),PA=P$({type:L,group:"Placeholders"}),PT=nC.required(),PR=nC.getComponent(rp),PI=nC.onlyRunInLifeCycleAsync,PL=nC.onlyRunInLifeCycle,PP=nC.onlyRunInLifeCycleAsync,PO=nC.onlyRunInLifeCycleAsync,Pk((PN=st((PB=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"coinLabel",PN,Ke(g)),rt(g,"panelAnimationController",PD,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nC.decorateComponent(this)}},{key:"onEnable",value:function(){this.node.scene.on(a2.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"onDisable",value:function(){this.node.scene.off(a2.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"updatePlaceholderCoins",value:(C=Be(function(g){return _ts_generator(this,function(E){this.coinLabel.string=P3.getShortNumber(g.coins,3);return[2]})}),function(g){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){var g,E,_;if(!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(LJ),!this.homeContent))throw new Error("HomePage: homeContent not found");var k=P1.getGameData(),C=null!==(g=null==k?void 0:k.coins)&&void 0!==g?g:0;this.updatePlaceholderCoins({coins:C});var A=null!==(E=null==k?void 0:k.level)&&void 0!==E?E:1;this.homeContent.setPlayButton(A);var T=null!==(_=null==k?void 0:k.stars)&&void 0!==_?_:0;this.homeContent.updateStarProgress(T),this.initUnlockProgressData()}},{key:"initUnlockProgressData",value:function(){var g=this.homeContent.shouldPlayUnlockAnimation(),E=De({},lh.getCurrentMapProgress()),_=P2.getStorage("dashboard");if(null==_)return null==P4||P4.sendException(new Error("DashboardScene: dashboardStorage not found")),void(g||this.homeContent.setUnlockProgress(E));var k=De({},_.lastMapPayload);g?this.homeContent.setUnlockProgress(k):this.homeContent.setUnlockProgress(E)}},{key:"transitionIn",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:g.sent();return[4,this.panelAnimationController.showUI()];case 2:g.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent();return[4,this.panelAnimationController.hideUI()];case 2:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hasLoadedPage",value:function(){return!0}}]),r}(AE)).prototype,"coinLabel",[PC,PA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PD=st(PB.prototype,"panelAnimationController",[PT,PR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(PB.prototype,"mount",[PI],Object.getOwnPropertyDescriptor(PB.prototype,"mount"),PB.prototype),st(PB.prototype,"onMount",[PL],Object.getOwnPropertyDescriptor(PB.prototype,"onMount"),PB.prototype),st(PB.prototype,"transitionIn",[PP],Object.getOwnPropertyDescriptor(PB.prototype,"transitionIn"),PB.prototype),st(PB.prototype,"transitionOut",[PO],Object.getOwnPropertyDescriptor(PB.prototype,"transitionOut"),PB.prototype),PB));_._RF.pop(),_._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var P5,P6,P8,P9,P7,Oe,Ot,On,Oi,Oa,Or,Oo,Os,Ol,Ou,Oc,Oh,Op,Od,Of,Oy=(0,k.ccclass)("LeaderboardIsEmpty")(PQ=function(g){ze(i,g);var E,_=Xe(i);function i(){return Fe(this,i),_.apply(this,arguments)}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.uiOpacity.opacity=255;g=this.node.position.clone(),E=x(this.node);E.to(.05,{position:g.clone().add3f(5,0,0)}),E.to(.05,{position:g.clone().add3f(-5,0,0)});_=x(this.node).repeat(2,E);_.to(.05,{position:g});return[4,tZ.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),i}(D))||PQ;_._RF.pop(),_._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var Ov,Og,Om,Ob,Ow,OS,OE,O_=k.ccclass,Ok=k.property,OC=k.requireComponent,OA=globalThis.game.analytics,OT=GameCore,OR=OT.Utils.Array,OI=OT.Plugins.Analytics.Events,OL=(P5=O_("SwitchButton"),P6=OC([B,G]),P8=Ok(J),P9=Ok(C),P7=Ok(C),Oe=Ok(J),Ot=Ok({visible:function(){return this.useSound},type:iy}),On=Ok(J),Oi=Ok({visible:function(){return this.useDesktopHover},type:ei}),Oa=Ok({visible:function(){return this.useDesktopHover},type:ei}),P5(Or=P6((Os=st((Oo=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"enable",Os,Ke(g)),rt(g,"nodeOn",Ol,Ke(g)),rt(g,"nodeOff",Ou,Ke(g)),rt(g,"useSound",Oc,Ke(g)),rt(g,"soundKey",Oh,Ke(g)),rt(g,"useDesktopHover",Op,Ke(g)),rt(g,"mouseEnterClip",Od,Ke(g)),rt(g,"mouseLeaveClip",Of,Ke(g)),g.isMouseLeaved=!1,g.onMouseEnter=function(E){g.useDesktopHover&&g.buttonComponent.interactable&&(g.isMouseLeaved=!1,g.animationComponent.play(g.mouseEnterClip.name))},g.onMouseLeave=function(E){g.useDesktopHover&&g.buttonComponent.interactable&&(g.isMouseLeaved||(g.isMouseLeaved=!0,g.animationComponent.play(g.mouseLeaveClip.name)))},g}return Ue(n,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(B),this.animationComponent=this.getComponent(G),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var g=this.animationComponent.clips.map(function(g){return null==g?void 0:g.name}).filter(function(g){return null!=g&&"string"==typeof g});this.useDesktopHover&&(OR.has(g,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),OR.has(g,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(OA.event(OI.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&i8.playSound(im[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(g){this.node.active&&this.updateStatus(g)}},{key:"updateStatus",value:function(g){return this.enable===g||(this.onMouseLeave(null),this.enable=g,this.nodeOn.active=g,this.nodeOff.active=!g),this.enable}}]),n}(D)).prototype,"enable",[P8],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ol=st(Oo.prototype,"nodeOn",[P9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ou=st(Oo.prototype,"nodeOff",[P7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oc=st(Oo.prototype,"useSound",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Oh=st(Oo.prototype,"soundKey",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iy[ih.BUTTON_CLICK]}}),Op=st(Oo.prototype,"useDesktopHover",[On],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Od=st(Oo.prototype,"mouseEnterClip",[Oi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Of=st(Oo.prototype,"mouseLeaveClip",[Oa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Or=Oo))||Or)||Or);_._RF.pop(),_._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var OP,OO,OB,ON,OD,OM,OF,OU,Oz,Ox=k.ccclass,OG=k.property,OV=globalThis.game.analytics,OK=GameCore.Plugins.Analytics.Events,OH=(Ov=Ox("Tabs"),Og=OG(OL),Om=OG(OL),Ov((OS=st((Ow=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"tabWorld",OS,Ke(g)),rt(g,"tabFriends",OE,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents(),"MsGames"===GameSDK.getSDKName()&&(this.tabWorld.node.active=!1,this.tabFriends.node.active=!1)}},{key:"validateRequiredComponents",value:function(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}},{key:"setInteractableButtons",value:function(g){this.tabWorld.getComponent(B).interactable=g,this.tabFriends.getComponent(B).interactable=g}},{key:"updateStatus",value:function(g){this.tabWorld.setEnabled("global"===g),this.tabFriends.setEnabled("friends"===g)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),i8.playSound(ih.BUTTON_CLICK),OV.event(OK.BUTTON_CLICK,{button_name:this.node.name,screen_name:iC.getCurrentPage()}),this.node.scene.emit(EE.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),i8.playSound(ih.BUTTON_CLICK),OV.event(OK.BUTTON_CLICK,{button_name:this.node.name,screen_name:iC.getCurrentPage()}),this.node.scene.emit(EE.FRIENDS_TAB_SELECTED)}}]),n}(D)).prototype,"tabWorld",[Og],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OE=st(Ow.prototype,"tabFriends",[Om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ob=Ow))||Ob);_._RF.pop(),_._RF.push({},"91613SO4bxPDq9dH9zxyIef","LeaderboardTimer",void 0);var Oq,OW,Oj,OX,OY,OJ=k.ccclass,OQ=k.property,OZ=GameCore.Utils.Time,O$=(OP=OJ("LeaderboardTimer"),OO=OQ(R),OB=OQ(C),ON=OQ(L),OP((OF=st((OM=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"background",OF,Ke(g)),rt(g,"calendar",OU,Ke(g)),rt(g,"timerLabel",Oz,Ke(g)),g.alreadyShown=!1,g}return Ue(i,[{key:"onLoad",value:function(){this.timerOpacity=this.timerLabel.node.getComponent(eu),this.validateRequiredComponents(),this.backgroundDefaultWidth=this.background.width,this.calendarDefaultPosition=this.calendar.position.clone()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:if(!(!this.alreadyShown&&!g.aborted))return[3,3];this.alreadyShown=!0;E=x(this.calendar).to(.3,{scale:em.ONE},{easing:"backOut"}).to(.3,{position:this.calendarDefaultPosition.clone()},{easing:"quadOut"}),_=x(this.background).delay(.3).to(.3,{width:this.backgroundDefaultWidth},{easing:"quadOut"}),k=x(this.timerOpacity).to(.3,{opacity:255});return[4,Promise.all([tZ.runTweenAsync(E,g),tZ.runTweenAsync(_,g)])];case 1:C.sent(),this.calendar.scale=em.ONE,this.calendar.position=this.calendarDefaultPosition.clone(),this.background.width=this.backgroundDefaultWidth;return[4,tZ.runTweenAsync(k,g)];case 2:C.sent(),this.timerOpacity.opacity=255;C.label=3;case 3:return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"reset",value:function(){this.alreadyShown||(this.calendar.position=this.background.node.position.clone(),this.calendar.scale=em.ZERO,this.background.width=0,this.timerOpacity.opacity=0)}},{key:"setTimeLabel",value:function(g){if(g){var E=new Date,_=0;if("manually"===g)_=0;else if("daily"===g)_=Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+1);else if("weekly"===g){var k=E.getUTCDay(),C=0===k?1:8-k;_=Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+C)}else _="monthly"===g?Date.UTC(E.getUTCFullYear(),E.getUTCMonth()+1):Date.UTC(E.getUTCFullYear(),E.getUTCMonth(),E.getUTCDate()+1);this.timerLabel.string="Ends ".concat(OZ.getRelativeTime(_/1e3))}else this.timerLabel.string="Ends soon"}}]),i}(D)).prototype,"background",[OO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OU=st(OM.prototype,"calendar",[OB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oz=st(OM.prototype,"timerLabel",[ON],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OD=OM))||OD);_._RF.pop(),_._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var O0,O1,O2,O4,O3,O5,O6,O8,O9,O7,Bt,Bn,Bi,Ba,Br,Bo,Bs,Bl,Bu,Bc,Bp,Bf,By,Bv,Bg,Bm,Bb,Bw,BS,BE,B_,Bk,BC,BA,BT,BR,BI,BL,BP,BO,BB,BN,BD,BM,BF=k.ccclass,BU=k.disallowMultiple,Bz=k.property,Bx=(Oq=BF("LeaderSkeleton"),OW=Bz(C),Oq(Oj=BU((OY=st((OX=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",OY,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,tZ.runTweenAsync(x(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=this;this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;k=this.container.position.clone();this.container.position=new em(k.x,k.y-100,k.z);C=x(this.node).delay(g);C.to(.2,{scale:em.ONE},{easing:"cubicOut"});A=x(this.container).delay(g);A.to(.2,{position:k},{easing:"cubicOut"});T=x(this.uiOpacity).delay(g);T.to(.2,{opacity:255},{easing:"cubicOut"}),E.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=k,_.uiOpacity.opacity=255});return[4,Promise.all([tZ.runTweenAsync(C,E),tZ.runTweenAsync(A,E),tZ.runTweenAsync(T,E)])];case 1:R.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(D)).prototype,"container",[OW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oj=OX))||Oj)||Oj);_._RF.pop(),_._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var BG,BV,BK,BH,Bq,BW,Bj,BX,BY,BJ,BQ,BZ,B$,B0=k.ccclass,B1=k.property,B2=GameCore.Utils.Number,B4=(O0=B0("Leader"),O1=B1(L),O2=B1(eu),O4=B1({type:C,group:"Container"}),O3=B1({type:eo,group:"Background"}),O5=B1({type:er,group:"Background"}),O6=B1({type:eo,group:"Rank"}),O8=B1({type:L,group:"Rank"}),O9=B1({type:er,group:"Rank"}),O7=B1({type:er,group:"Rank"}),Bt=B1({type:er,group:"Rank"}),Bn=B1({type:er,group:"Rank"}),Bi=B1({type:eo,group:"Avatar"}),Ba=B1({type:eu,group:"Avatar"}),Br=B1({type:eo,group:"Score"}),Bo=B1({type:L,group:"Score"}),Bs=B1({type:er,group:"Score"}),Bl=B1({type:eu,group:"Score"}),Bu=B1({type:eu}),Bc=B1({type:R}),Bp=nC.onlyRunInLifeCycle,Bf=nC.onlyRunInLifeCycleAsync,By=nC.onlyRunInLifeCycle,O0((Bm=st((Bg=function(g){ze(l,g);var E,_,k,C,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"nameLabel",Bm,Ke(g)),rt(g,"nameOpacity",Bb,Ke(g)),rt(g,"container",Bw,Ke(g)),rt(g,"background",BS,Ke(g)),rt(g,"highlightBackground",BE,Ke(g)),rt(g,"rankSprite",B_,Ke(g)),rt(g,"rankLabel",Bk,Ke(g)),rt(g,"goldRank",BC,Ke(g)),rt(g,"silverRank",BA,Ke(g)),rt(g,"bronzeRank",BT,Ke(g)),rt(g,"highlightRank",BR,Ke(g)),rt(g,"avatar",BI,Ke(g)),rt(g,"avatarOpacity",BL,Ke(g)),rt(g,"scoreBackground",BP,Ke(g)),rt(g,"scoreLabel",BO,Ke(g)),rt(g,"highlightScoreBackground",BB,Ke(g)),rt(g,"scoreOpacity",BN,Ke(g)),rt(g,"uiOpacity",BD,Ke(g)),rt(g,"uiTransform",BM,Ke(g)),g.signal=new nD,g}return Ue(l,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.defaultAvatar=this.avatar.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g,E){this.updateBackground(g),this.updateRank(g,E),this.updatePhoto(g),this.updateUsername(g),this.updateScore(g)}},{key:"updateBackground",value:function(g){this.background.spriteFrame=g.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(g,E){var _=g.rank;this.rankLabel.string=E&&_>E?"".concat(E,"+"):_.toString(),this.rankSprite.spriteFrame=this.defaultRank;var k=new A(ET);switch(g.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,k=new A(EI)),_){case 1:this.rankSprite.spriteFrame=this.goldRank,k=new A(E_);break;case 2:this.rankSprite.spriteFrame=this.silverRank,k=new A(Ek);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,k=new A(EC)}this.rankLabel.shadowColor=k,this.rankLabel.outlineColor=k}},{key:"updatePhoto",value:(T=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.signal.abort();E=new nD;if(this.signal=E,!this.avatar)return[3,5];_=g.playerId,k=g.photo;if(!bz.isAvatarCached(g.playerId,70))return[3,2];return[4,bz.getPlayerAvatar(k,_,70,E)];case 1:C=T.sent();if(!C||E.aborted)return[2];this.setPhoto(C);return[3,5];case 2:this.avatar.spriteFrame=this.defaultAvatar;return[4,tZ.waitTweenAsync(.1,E)];case 3:if(T.sent(),!!E.aborted)return[3,5];return[4,bz.getPlayerAvatar(k,_,70,E)];case 4:A=T.sent();A&&!E.aborted&&this.setPhoto(A);T.label=5;case 5:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"setPhoto",value:function(g){this.node.active&&(g.packable=!0,this.avatar.spriteFrame=g)}},{key:"updateUsername",value:function(g){this.nameLabel.string=g.name,this.nameLabel.color=new A(g.isHighlight?ER:EA)}},{key:"updateScore",value:function(g){var E=Math.floor(g.score);this.scoreLabel.string=B2.getShortNumber(E,7);var _=this.scoreLabel.getComponent(L);_.outlineColor=new A(g.isHighlight?EI:ET),_.shadowColor=new A(g.isHighlight?EI:ET),this.scoreBackground.spriteFrame=g.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(C=Be(function(g,E){var _,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(L){switch(L.label){case 0:_=this,k=I.length>2&&void 0!==I[2]?I[2]:.3;this.node.scale=new em(.8,.8,.8),this.setVisible(!1);C=this.container.position.clone();this.container.position=new em(C.x,C.y-100,C.z);A=x(this.node).delay(E);A.to(k,{scale:em.ONE},{easing:"elasticOut"});T=x(this.container).delay(E);T.to(k,{position:C},{easing:"backOut"});R=x(this.uiOpacity).delay(E);R.to(k,{opacity:255},{easing:"cubicOut",onUpdate:function(){_.nameOpacity.opacity=_.uiOpacity.opacity,_.scoreOpacity.opacity=_.uiOpacity.opacity,_.avatarOpacity.opacity=_.uiOpacity.opacity}}),g.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=C,_.uiOpacity.opacity=255,_.avatar.node.active=!0});return[4,Promise.all([tZ.runTweenAsync(A,g),tZ.runTweenAsync(T,g),tZ.runTweenAsync(R,g)])];case 1:L.sent();return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(k=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=x(this.node).to(E,{worldPosition:g},{easing:"quadOut"});return[4,tZ.runTweenAsync(k,_)];case 1:C.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"runScaleAnimation",value:(_=Be(function(g,E,_){var k;return _ts_generator(this,function(C){switch(C.label){case 0:k=x(this.node).to(E,{scale:new em(g,g,g)},{easing:"backOut"});return[4,tZ.runTweenAsync(k,_)];case 1:C.sent();return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(E=Be(function(g,E,_,k,C,A){var T;return _ts_generator(this,function(R){switch(R.label){case 0:T=this;return[4,tZ.runOnUpdateAsync(this.node,C,function(C){var A=Math.floor(g+(E-g)*C),R=Math.floor(_+(k-_)*C);T.updateRank({rank:A,isHighlight:!0}),T.updateScore({score:R,isHighlight:!0})},A)];case 1:R.sent();return[2]}})}),function(g,_,k,C,A,T){return E.apply(this,arguments)})},{key:"setVisible",value:function(g){var E=g?255:0;this.uiOpacity.opacity=E,this.nameOpacity.opacity=E,this.scoreOpacity.opacity=E,this.avatarOpacity.opacity=E}}]),l}(D)).prototype,"nameLabel",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bb=st(Bg.prototype,"nameOpacity",[O2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bw=st(Bg.prototype,"container",[O4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BS=st(Bg.prototype,"background",[O3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BE=st(Bg.prototype,"highlightBackground",[O5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=st(Bg.prototype,"rankSprite",[O6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bk=st(Bg.prototype,"rankLabel",[O8],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BC=st(Bg.prototype,"goldRank",[O9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BA=st(Bg.prototype,"silverRank",[O7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BT=st(Bg.prototype,"bronzeRank",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BR=st(Bg.prototype,"highlightRank",[Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=st(Bg.prototype,"avatar",[Bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BL=st(Bg.prototype,"avatarOpacity",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BP=st(Bg.prototype,"scoreBackground",[Br],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BO=st(Bg.prototype,"scoreLabel",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BB=st(Bg.prototype,"highlightScoreBackground",[Bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BN=st(Bg.prototype,"scoreOpacity",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BD=st(Bg.prototype,"uiOpacity",[Bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=st(Bg.prototype,"uiTransform",[Bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Bg.prototype,"updateInfo",[Bp],Object.getOwnPropertyDescriptor(Bg.prototype,"updateInfo"),Bg.prototype),st(Bg.prototype,"updatePhoto",[Bf],Object.getOwnPropertyDescriptor(Bg.prototype,"updatePhoto"),Bg.prototype),st(Bg.prototype,"setPhoto",[By],Object.getOwnPropertyDescriptor(Bg.prototype,"setPhoto"),Bg.prototype),Bv=Bg))||Bv);_._RF.pop(),_._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var B3,B5,B6,B8,B9,B7,Ne,Nt,Nn,Ni,Na,Nr,No,Ns,Nl,Nu,Nc,Np,Nd,Nf,Ny,Nv,Ng,Nm,Nb,Nw,NS=k.ccclass,NE=k.property,N_=globalThis.game.player,Nk=GameCore.Utils.Array,NC=(BG=NS("Leaders"),BV=NE(Ao),BK=NE(B4),BH=NE(V),Bq=nC.onlyRunInLifeCycleAsync,BW=nC.onlyRunInLifeCycleAsync,Bj=nC.onlyRunInLifeCycleAsync,BX=nC.onlyRunInLifeCycleAsync,BG((BQ=st((BJ=function(g){ze(u,g);var E,_,k,C,A,T,I=Xe(u);function u(){var g;Fe(this,u);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=I.call.apply(I,[this].concat(_)),"scrollView",BQ,Ke(g)),rt(g,"tempLeader",BZ,Ke(g)),rt(g,"maxLeader",B$,Ke(g)),g.leaderData=[],g.displayLeaderData=[],g.displayPlayerLeader=null,g.isHidden=!0,g}return Ue(u,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.batchNodes=this.getComponents(sT),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=N_.getPlayerId()}},{key:"updateData",value:(T=Be(function(g){return _ts_generator(this,function(E){this.isHidden=!1,this.leaderData=g,this.leaderData.forEach(function(g,E){g.rank=E+1}),this.setupDisplayLeadersData();return[2]})}),function(g){return T.apply(this,arguments)})},{key:"initScrollViews",value:function(){var g=this;this.scrollView.setMaxNodeCount(this.leaderData.length),this.scrollView.init(function(E){var _=E.getComponent(B4),k=g.displayLeaderData[E.order],C=k.playerId,A=k.photo,T=k.name,R=k.score;_.setVisible(!0),_.updateInfo({playerId:C,isHighlight:g.currentPlayerId===C,name:T,photo:A,rank:E.order+1,score:R},g.maxLeader)}),this.setBatchNodes(!0)}},{key:"playRankChangeAnimation",value:(A=Be(function(g,E,_,k){var C,A,T,R,I,L,P,O,B,N,D,M;return _ts_generator(this,function(F){switch(F.label){case 0:if(E>=_)return[3,4];C=this.displayLeaderData,A=Nk.search(C,function(g){return g.playerId===N_.getPlayerId()});if(!A)return[3,4];T=A.rank;if(!C[k-1])return[3,4];R=this.scrollView.getNodeByOrder(A.rank-1);if(!R)return[3,4];I=null==R?void 0:R.getComponent(B4);if(!I)return[3,4];I.setVisible(!1),this.tempLeader.setVisible(!0),this.tempLeader.updatePhoto({playerId:N_.getPlayerId(),photo:A.photo}),this.tempLeader.node.worldPosition=R.node.worldPosition.clone();return[4,this.tempLeader.runScaleAnimation(1.1,.5,g)];case 1:F.sent();L=Math.min(.5*(T-k),2),P=[this.tempLeader.runUpdateDataAnimation(T,k,E,_,L,g),this.scrollToLeaderRank(k,L,g)],O=this.scrollView.scrollView.getMaxScrollOffset().y,B=this.scrollView.getNodeScrollOffset(k-1),N=em.ZERO;if(B<0)N=new em(this.tempLeader.node.worldPosition.x,this.node.worldPosition.y+this.scrollView.getNodePosition(k-1).y+this.uiTransform.height/2,this.tempLeader.node.worldPosition.z);else if(this.scrollView.scrollView.getScrollOffset().y>=O-5){if(B<O)N=new em(this.tempLeader.node.worldPosition.x,this.scrollView.viewport.node.worldPosition.y,this.tempLeader.node.worldPosition.z);else{M=this.scrollView.getNodeByOrder(k-1);N=null!==(D=null==M?void 0:M.node.worldPosition.clone())&&void 0!==D?D:em.ZERO}}N.equals(em.ZERO)||P.push(this.tempLeader.runWorldPositionAnimation(N,L,g));return[4,Promise.all(P)];case 2:F.sent();return[4,Promise.all([this.tempLeader.runScaleAnimation(1,.25,g),this.playPostRankChangeAnimation(k,T,g)])];case 3:F.sent(),this.tempLeader.setVisible(!1),R.node.worldPosition=this.tempLeader.node.worldPosition.clone(),this.setupDisplayLeadersData(),this.scrollView.updateNodeVisibility(),this.scrollView.updateLayout();F.label=4;case 4:return[2]}})}),function(g,E,_,k){return A.apply(this,arguments)})},{key:"playShowLeadersAnimation",value:(C=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:E=this,_=T.length>1&&void 0!==T[1]?T[1]:.1;if(!!this.isHidden)return[3,2];k=[],C=this.scrollView.getAllNodes();if(C.sort(function(g,E){return g.order-E.order}).forEach(function(g,_){var C=g.getComponent(B4);C.setVisible(_<E.leaderData.length),g.isVisible()&&k.push(C)}),k.length<1)return[3,2];k=k.slice(0,C.length-1);A=.3;return[4,Promise.all(k.map(function(){var k=Be(function(k,C){var T;return _ts_generator(this,function(R){switch(R.label){case 0:T=E.isHidden;if(T)return[3,2];return[4,k.runShowUpAnimation(g,C*_,A)];case 1:T=R.sent();R.label=2;case 2:return[2]}})});return function(g,E){return k.apply(this,arguments)}}()))];case 1:R.sent();R.label=2;case 2:return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"scrollToPlayerLeader",value:(k=Be(function(g,E){var _;return _ts_generator(this,function(k){switch(k.label){case 0:_=this.displayPlayerLeader;if(!_)return[3,2];return[4,this.scrollToLeaderRank(this.displayPlayerLeader.rank,g,E)];case 1:_=k.sent();k.label=2;case 2:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"updateDisplayPlayerLeaderForRankChanging",value:function(g,E,_){if(!this.displayPlayerLeader)return!1;this.displayPlayerLeader.score=g,this.displayLeaderData.sort(function(g,E){return E.score-g.score});var k=this.displayLeaderData.indexOf(this.displayPlayerLeader)+1;return _===k?(this.displayPlayerLeader.score=E,this.displayPlayerLeader.rank=_,!1):(this.displayPlayerLeader.rank=k,this.tempLeader.updateInfo({playerId:N_.getPlayerId(),isHighlight:!0,name:this.displayPlayerLeader.name,photo:this.displayPlayerLeader.photo,rank:this.displayPlayerLeader.rank,score:g}),!0)}},{key:"hideLeaders",value:function(){this.isHidden=!0;var g,E=at(this.scrollView.getAllNodes().map(function(g){return g.getComponent(B4)}));try{for(E.s();!(g=E.n()).done;){var _=g.value;null==_||_.setVisible(!1)}}catch(g){E.e(g)}finally{E.f()}this.setBatchNodes(!1)}},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"setBatchNodes",value:function(g){this.batchNodes.every(function(E){E.enabled=g})}},{key:"setupDisplayLeadersData",value:function(){var g=this,E=Nk.search(this.leaderData,function(E){return E.playerId===g.currentPlayerId});E?(this.displayLeaderData=this.leaderData.filter(function(E){return E.playerId!==g.currentPlayerId}),this.displayPlayerLeader=De({},E),this.displayLeaderData.splice(E.rank-1,0,this.displayPlayerLeader)):(this.displayPlayerLeader=null,this.displayLeaderData=this.leaderData)}},{key:"playPostRankChangeAnimation",value:(_=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=null!=g?g:0,C=this.scrollView.getVisibleNodes().filter(function(g){return g.order>=k-1&&g.order<E}),A=C.map(function(g){return g.getComponent(B4)}),T=this.scrollView.nodeHeight+this.scrollView.spacing,R=[];A.forEach(function(g,E){g.updateRank({rank:C[E].order+2,isHighlight:!1});var k=g.node.worldPosition.clone();R.push(g.runWorldPositionAnimation(k.add3f(0,-T,0),.25,_))});return[4,Promise.all(R)];case 1:I.sent();return[2]}})}),function(g,E,k){return _.apply(this,arguments)})},{key:"scrollToLeaderRank",value:(E=Be(function(g,E,_){return _ts_generator(this,function(k){switch(k.label){case 0:return[4,this.scrollView.scrollToOrder(g-1,_,E)];case 1:k.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})}]),u}(D)).prototype,"scrollView",[BV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BZ=st(BJ.prototype,"tempLeader",[BK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B$=st(BJ.prototype,"maxLeader",[BH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(BJ.prototype,"updateData",[Bq],Object.getOwnPropertyDescriptor(BJ.prototype,"updateData"),BJ.prototype),st(BJ.prototype,"playRankChangeAnimation",[BW],Object.getOwnPropertyDescriptor(BJ.prototype,"playRankChangeAnimation"),BJ.prototype),st(BJ.prototype,"scrollToPlayerLeader",[Bj],Object.getOwnPropertyDescriptor(BJ.prototype,"scrollToPlayerLeader"),BJ.prototype),st(BJ.prototype,"scrollToLeaderRank",[BX],Object.getOwnPropertyDescriptor(BJ.prototype,"scrollToLeaderRank"),BJ.prototype),BY=BJ))||BY);_._RF.pop(),_._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var NA,NT,NR,NI,NL,NP,NO,NB,NN=k.ccclass,ND=k.property,NM=globalThis.game,NF=NM.storage,NU=NM.leaderboard,Nz=NM.player,Nx=NM.monitorError,NG=GameCore,NV=NG.Utils.Object,NK=NG.Configs.Leaderboards,NH=function(g){ze(n,g);var E=Xe(n);function n(g){var _;return Fe(this,n),(_=E.call(this,g)).name="EmptyLeaderboardError",_}return Ue(n)}(je(Error)),Nq=(B3=NN("LeaderboardContent"),B5=nC.required(),B6=ND(OH),B8=nC.required(),B9=ND(O$),B7=nC.required(),Ne=ND(NC),Nt=ND({type:[Bx]}),Nn=nC.required(),Ni=ND(Oy),Na=nC.required(),Nr=ND(ad),No=nC.onlyRunInLifeCycleAsync,Ns=nC.onlyRunInLifeCycleAsync,Nl=nC.onlyRunInLifeCycleAsync,Nu=nC.onlyRunInLifeCycleAsync,Nc=nC.onlyRunInLifeCycleAsync,Np=nC.onlyRunInLifeCycleAsync,B3((Ny=st((Nf=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"tabs",Ny,Ke(g)),rt(g,"timer",Nv,Ke(g)),rt(g,"leaders",Ng,Ke(g)),rt(g,"leaderSkeletons",Nm,Ke(g)),rt(g,"leaderboardIsEmpty",Nb,Ke(g)),rt(g,"contentOpacity",Nw,Ke(g)),g.isHidden=!0,g.currentLb=null,g.animAbortSignal=new nD,g.hasPlayedAppearAnim={friends:!1,global:!1,tournament:!1},g.handleFriendsTabSelected=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:NF.setStorageData("leaderboard_content","lastTabOpened","friends"),g.cleanupSideEffects();E=g.animAbortSignal;k.label=1;case 1:k.trys.push([1,3,,4]);return[4,g.updateStatus(E,"friends")];case 2:k.sent();return[3,4];case 3:_=k.sent();E.call(function(){var g=_instanceof(_,Error)?_:new Error("Unknown error during loading friends leaderboard.");console.error("LeaderboardContent",g),null==Nx||Nx.sendException(g),l5.showNotificationScreen("Unable to load friends leaderboard. Please try again later.",2)});return[3,4];case 4:return[2]}})}),g.handleWorldTabSelected=Be(function(){var E,_;return _ts_generator(this,function(k){switch(k.label){case 0:NF.setStorageData("leaderboard_content","lastTabOpened","global"),g.cleanupSideEffects();E=g.animAbortSignal;k.label=1;case 1:k.trys.push([1,3,,4]);return[4,g.updateStatus(E,"global")];case 2:k.sent();return[3,4];case 3:_=k.sent();E.call(function(){var g=_instanceof(_,Error)?_:new Error("Unknown error during loading global leaderboard.");console.error("LeaderboardContent",g),null==Nx||Nx.sendException(g),l5.showNotificationScreen("Unable to load global leaderboard. Please try again later.",2)});return[3,4];case 4:return[2]}})}),g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(l,[{key:"__preload",value:function(){this.leaders.maxLeader=NK.Limit}},{key:"onLoad",value:function(){nC.decorateComponent(this)}},{key:"listenEvents",value:function(){this.node.scene.on(EE.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(EE.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(a2.HIDE_UI,this.hideContent),this.node.scene.on(a2.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.node.scene.off(EE.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(EE.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(a2.HIDE_UI,this.hideContent),this.node.scene.off(a2.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(T=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this,k=this.getLeaderboardName(g);C=null!==k;if(!C)return[3,3];return[4,E.callAsync(function(){return NU.requestLeaderboardAsync(k,NK.Limit)})];case 1:A.sent(),E.call(function(){var g=NU.getLeaderboard(k);_.currentLb=null!=g?g:_.currentLb});return[4,E.callAsync(Be(function(){return _ts_generator(this,function(E){return[2,_.loadPlayerLeaderData(g)]})}))];case 2:C=A.sent();A.label=3;case 3:return[2]}})}),function(g,E){return T.apply(this,arguments)})},{key:"getLeaderboardName",value:function(g){return"friends"===g?sX:sj}},{key:"showLoading",value:(A=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=k.length>1&&void 0!==k[1]?k[1]:0;return[4,Promise.all([this.leaders.scrollView.unlistenEvents(),this.leaders.scrollView.scrollToTop(g).then(function(){E.leaders&&(E.leaders.scrollView.scrollView.enabled=!1,E.leaders.scrollView.listenEvents())}),this.leaderSkeletons.map(function(E,k){return E.show(k*_,g)})])];case 1:C.sent();return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"hideLoading",value:(C=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(E){return E.hide(g)}))];case 1:E.sent();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"entering",value:function(){this.timer.reset(),this.isHidden=!1;var g=NF.getStorageData("leaderboard_content","lastTabOpened");"friends"===g?this.handleFriendsTabSelected():"global"===g&&this.handleWorldTabSelected()}},{key:"enter",value:function(){this.listenEvents()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){this.animAbortSignal.abort(),this.animAbortSignal=new nD,this.leaders.hideLeaders(),this.leaderboardIsEmpty.hide()}},{key:"updateStatus",value:(k=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:A=this;if(!(void 0!==g&&!this.isHidden))return[3,7];this.tabs.updateStatus(E);return[4,this.showLoading(g)];case 1:R.sent();R.label=2;case 2:R.trys.push([2,4,,5]);return[4,this.loadLeaderboard(E,g)];case 3:R.sent();return[3,5];case 4:T=R.sent();if(!_instanceof(T,NH))throw T;return[2,void g.call(function(){A.leaderboardIsEmpty.show(),A.hideLoading(g)})];case 5:null===(_=this.timer)||void 0===_||_.setTimeLabel(null===(k=this.currentLb)||void 0===k?void 0:k.resettable),null===(C=this.timer)||void 0===C||C.show(g),this.hideLoading(g);return[4,g.callAsync(function(g){return A.playLeadersShowupAnimation(E,g)})];case 6:R.sent();R.label=7;case 7:return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"playLeadersShowupAnimation",value:(_=Be(function(g,E){var _,k,C,A,T,R,I,L,P,O,B,N,D;return _ts_generator(this,function(M){switch(M.label){case 0:_=this;if(!this.currentLb)return[3,6];k=Nz.getPlayerId(),C=this.currentLb.leaders[k],A=NF.getStorage("leaderboard_content").previousScore,T=null!=C?C:{},R=T.score,I=T.rank,L=NV.vals(this.currentLb.leaders);L.sort(function(g,E){return E.score-g.score});P=-1!==A&&A<R&&I<=NK.Limit;this.leaders.updateData(L);O=!1;C&&P&&(O=this.leaders.updateDisplayPlayerLeaderForRankChanging(A,R,I)),this.leaders.initScrollViews(),this.leaders.scrollView.scrollView.enabled=!0;B=this.hasPlayedAppearAnim[g]?0:.1;return[4,E.callAsync(function(){return _.leaders.playShowLeadersAnimation(E,B)})];case 1:M.sent(),this.hasPlayedAppearAnim[g]=!0;N=C;if(!N)return[3,5];return[4,E.callAsync(function(){return _.leaders.scrollToPlayerLeader(1,E)})];case 2:M.sent();D=O&&-1!==A;if(!D)return[3,4];return[4,E.callAsync(function(g){return _.leaders.playRankChangeAnimation(g,A,R,I)})];case 3:D=(M.sent(),NF.setStorageData("leaderboard_content","previousScore",R));M.label=4;case 4:N=D;M.label=5;case 5:M.label=6;case 6:return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"loadPlayerLeaderData",value:(E=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:E=Nz.getPlayerId();if(null===this.currentLb)throw new Error("LeaderboardContent: Leaderboard is not found.");_=this.currentLb.leaders;if(0===Object.keys(_).length)throw new NH("LeaderboardContent: Leaderboard is empty.");if(!!_[E])return[3,2];k=this.getLeaderboardName(g);if(null===k)throw new Error("LeaderboardContent: Leaderboard name is not found.");return[4,NU.getLeadersByPlayerIdsAsync(k,[E])];case 1:C=T.sent();if(0!==C.length){A=C[0];_[E]=A}T.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),l}(D)).prototype,"tabs",[B5,B6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv=st(Nf.prototype,"timer",[B8,B9],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ng=st(Nf.prototype,"leaders",[B7,Ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nm=st(Nf.prototype,"leaderSkeletons",[Nt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nb=st(Nf.prototype,"leaderboardIsEmpty",[Nn,Ni],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nw=st(Nf.prototype,"contentOpacity",[Na,Nr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Nf.prototype,"loadLeaderboard",[No],Object.getOwnPropertyDescriptor(Nf.prototype,"loadLeaderboard"),Nf.prototype),st(Nf.prototype,"showLoading",[Ns],Object.getOwnPropertyDescriptor(Nf.prototype,"showLoading"),Nf.prototype),st(Nf.prototype,"hideLoading",[Nl],Object.getOwnPropertyDescriptor(Nf.prototype,"hideLoading"),Nf.prototype),st(Nf.prototype,"updateStatus",[Nu],Object.getOwnPropertyDescriptor(Nf.prototype,"updateStatus"),Nf.prototype),st(Nf.prototype,"playLeadersShowupAnimation",[Nc],Object.getOwnPropertyDescriptor(Nf.prototype,"playLeadersShowupAnimation"),Nf.prototype),st(Nf.prototype,"loadPlayerLeaderData",[Np],Object.getOwnPropertyDescriptor(Nf.prototype,"loadPlayerLeaderData"),Nf.prototype),Nd=Nf))||Nd);_._RF.pop(),_._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var NW,Nj,NX,NY,NJ,NQ,NZ,N$,N0,N1,N2,N4,N3,N5,N6,N8,N9,N7;NA=(0,k.ccclass)("LeaderboardPage"),NT=nC.required(),NR=nC.getComponent(rp),NI=nC.onlyRunInLifeCycleAsync,NL=nC.onlyRunInLifeCycleAsync,NP=nC.onlyRunInLifeCycleAsync,NA((NB=st((NO=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimationController",NB,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nC.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:if(g.sent(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(Nq),!this.content)throw new Error("LeaderboardPage: Leaders not found");return[2]}})}),function(){return k.apply(this,arguments)})},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:this.content.entering();return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent();g=tZ.runTweenAsync(x(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent(),this.content.enter();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:g.sent(),this.content.unlistenUIEvents(),this.content.leaders.setBatchNodes(!1);return[4,this.panelAnimationController.hideUI()];case 2:g.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"unmount",value:function(){var g,E;null===(g=this.content)||void 0===g||g.hide(),null===(E=this.content)||void 0===E||E.cleanup(),Je(Ve(r.prototype),"unmount",this).call(this)}}]),r}(AE)).prototype,"panelAnimationController",[NT,NR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(NO.prototype,"mount",[NI],Object.getOwnPropertyDescriptor(NO.prototype,"mount"),NO.prototype),st(NO.prototype,"transitionIn",[NL],Object.getOwnPropertyDescriptor(NO.prototype,"transitionIn"),NO.prototype),st(NO.prototype,"transitionOut",[NP],Object.getOwnPropertyDescriptor(NO.prototype,"transitionOut"),NO.prototype),NO));_._RF.pop(),_._RF.push({},"0d1c02Npp9IXrjlFdl8co2L","TopLeader",void 0);var Dt,Dn,Di,Da,Dr,Do,Ds,Dl,Du,Dc,Dp,Dd,Df,Dy,Dv,Dg,Dm,Db,Dw,DS,DE,D_,Dk,DC,DA,DT=k.ccclass,DR=k.property,DI=GameCore.Utils.Number,DL=(NW=DT("TopLeader"),Nj=DR(L),NX=DR(C),NY=DR({type:eo}),NJ=DR({type:eu}),NQ=DR({type:L}),NZ=DR({type:eu}),N$=nC.onlyRunInLifeCycle,N0=nC.onlyRunInLifeCycleAsync,N1=nC.onlyRunInLifeCycleAsync,NW((N3=st((N4=function(g){ze(o,g);var E,_,k,C=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=C.call.apply(C,[this].concat(_)),"nameLabel",N3,Ke(g)),rt(g,"defaultAvatar",N5,Ke(g)),rt(g,"avatar",N6,Ke(g)),rt(g,"avatarOpacity",N8,Ke(g)),rt(g,"scoreLabel",N9,Ke(g)),rt(g,"uiOpacity",N7,Ke(g)),g.signal=new nD,g}return Ue(o,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){this.updateUsername(g),this.updatePhoto(g),this.updateScore(g)}},{key:"updateUsername",value:function(g){this.nameLabel&&(this.nameLabel.string=g.name)}},{key:"updatePhoto",value:(k=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.signal.abort();E=new nD;this.signal=E,this.defaultAvatar.active=!bz.isAvatarCached(g.playerId,128),this.avatar.spriteFrame=null;_=g.playerId,k=g.photo;return[4,bz.getPlayerAvatar(k,_,128,E)];case 1:C=A.sent();C&&!E.aborted&&this.setPhoto(C);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setPhoto",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!this.node.active)return[3,2];g.packable=!0,this.avatar.spriteFrame=g;E=x(this.avatarOpacity).to(.2,{opacity:255});return[4,tZ.runTweenAsync(E,this.signal)];case 1:_.sent(),this.defaultAvatar.active=!1;_.label=2;case 2:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"updateScore",value:function(g){if(this.scoreLabel){var E=Math.floor(g.score);this.scoreLabel.string=DI.getShortNumber(E,7)}}},{key:"runShowUpAnimation",value:(E=Be(function(g){var E,_,k,C;var A=arguments;return _ts_generator(this,function(T){switch(T.label){case 0:E=A.length>1&&void 0!==A[1]?A[1]:.3,_=A.length>2?A[2]:void 0;this.node.scale=em.ZERO;k=x(this.node).delay(g).to(E,{scale:new em(1,1,1)},{easing:"backOut"}),C=x(this.uiOpacity).delay(g).to(E,{opacity:255});return[4,Promise.all([tZ.runTweenAsync(k,_),tZ.runTweenAsync(C,_)])];case 1:T.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setVisible",value:function(g){var E=g?255:0;this.uiOpacity.opacity=E,this.avatarOpacity.opacity=E}}]),o}(D)).prototype,"nameLabel",[Nj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N5=st(N4.prototype,"defaultAvatar",[NX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N6=st(N4.prototype,"avatar",[NY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N8=st(N4.prototype,"avatarOpacity",[NJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N9=st(N4.prototype,"scoreLabel",[NQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N7=st(N4.prototype,"uiOpacity",[NZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(N4.prototype,"updateInfo",[N$],Object.getOwnPropertyDescriptor(N4.prototype,"updateInfo"),N4.prototype),st(N4.prototype,"updatePhoto",[N0],Object.getOwnPropertyDescriptor(N4.prototype,"updatePhoto"),N4.prototype),st(N4.prototype,"setPhoto",[N1],Object.getOwnPropertyDescriptor(N4.prototype,"setPhoto"),N4.prototype),N2=N4))||N2);_._RF.pop(),_._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var DP,DO,DB,DN,DD,DM=k.ccclass,DF=k.property,DU=globalThis.game,Dz=DU.leaderboard,Dx=DU.player,DG=GameCore.Utils,DV=DG.Time,DK=DG.Object,DH=DG.Array,Dq=(Dt=DM("TournamentBlock"),Dn=DF(C),Di=DF(L),Da=DF(L),Dr=DF(L),Do=DF(L),Ds=DF(R),Dl=DF({type:eo}),Du=DF(C),Dc=DF(C),Dp=DF(DL),Dd=nC.onlyRunInLifeCycleAsync,Df=nC.onlyRunInLifeCycle,Dt((Dg=st((Dv=function(g){ze(l,g);var E,_,k,C,A,T,R=Xe(l);function l(){var g;Fe(this,l);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=R.call.apply(R,[this].concat(_)),"container",Dg,Ke(g)),rt(g,"titleLabel",Dm,Ke(g)),rt(g,"timeLabel",Db,Ke(g)),rt(g,"playerCountLabel",Dw,Ke(g)),rt(g,"playButtonLabel",DS,Ke(g)),rt(g,"uiTransform",DE,Ke(g)),rt(g,"banner",D_,Ke(g)),rt(g,"bannerMask",Dk,Ke(g)),rt(g,"bannerLoadingRing",DC,Ke(g)),rt(g,"topLeader",DA,Ke(g)),g.hasPlayedAnimation=!1,g}return Ue(l,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateInfo",value:(T=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:this.payload=g;E=g.endTime,_=g.title,k=g.payload,C=k.leaderboardId,A=k.themeId;T=C;if(!T)return[3,2];this.topLeader.setVisible(!1),this.topLeader.node.active=!1,this.setPlayerCountWaiting(),this.updateTitle(_),this.updateEndTime(E),this.updateTournamentBanner(A);return[4,this.fetchAndUpdateLeadersPayload(C,{leaders:[],amountPlayer:0},_)];case 1:T=R.sent();R.label=2;case 2:return[2]}})}),function(g){return T.apply(this,arguments)})},{key:"fetchAndUpdateLeadersPayload",value:(A=Be(function(g,E,_){var k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:k=E;T.label=1;case 1:T.trys.push([1,3,,4]);return[4,this.getLeadersPayload(g)];case 2:C=T.sent();C&&(k=C);return[3,4];case 3:A=T.sent();console.error("Fetch lb for tournament ".concat(_),A);return[3,4];case 4:this.updateLeadersPayload(k);return[2]}})}),function(g,E,_){return A.apply(this,arguments)})},{key:"updateLeadersPayload",value:function(g){this.leadersPayload=g;var E=this.leadersPayload,_=E.player,k=E.amountPlayer,C=E.leaders;this.updatePlayerCount(k),this.updatePlayButtonLabel(void 0!==_),this.updateTopLeader(null!=C?C:[])}},{key:"updateTitle",value:function(g){g&&(this.titleLabel.string=g)}},{key:"updateEndTime",value:function(g){var E=DV.getRelativeTime(g);this.timeLabel.string="Ends ".concat(E)}},{key:"updatePlayerCount",value:function(g){this.playerCountLabel.string="".concat(g," ").concat(g>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"updateTopLeader",value:(C=Be(function(g){var E,_;return _ts_generator(this,function(k){if(0!==g.length){_=g[0];GameCore.Configs.Mockup.Leaderboards.Enabled&&(_=null!==(E=DH.search(g,function(g){return 1===g.rank}))&&void 0!==E?E:_),this.topLeader.node.active=!0,this.topLeader.updateInfo(_),this.topLeader.runShowUpAnimation(0,.2)}return[2]})}),function(g){return C.apply(this,arguments)})},{key:"updateTournamentBanner",value:(k=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:E=ie.getAsset("".concat(nU[g],"/spriteFrame"),er);_=E;if(_)return[3,2];this.bannerMask.active=!0,this.bannerLoadingRing.active=!0;return[4,ie.loadThemePreviewAsync(g)];case 1:_=E=C.sent();C.label=2;case 2:k=E;if(k)return[3,4];return[4,ie.loadThemePreviewAsync(lr.SUMMER)];case 3:k=E=C.sent();C.label=4;case 4:this.banner&&E&&(this.banner.spriteFrame=E,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"updatePlayButtonLabel",value:function(g){this.playButtonLabel.string=g?"Continue":"Join"}},{key:"getLeadersPayload",value:(_=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:_=Dz.getLeaderboardName(g);if(!_)return[2,null];return[4,li.getAllLeaderboardAsync(g)];case 1:k=I.sent();if(!k)return[2,null];C=DK.vals(k.leaders);C.sort(function(g,E){return g.rank-E.rank});A=Dx.getPlayerId();return[4,Dz.getLeadersByPlayerIdsAsync(_,[A])];case 2:T=I.sent(),R={leaders:C,amountPlayer:null!==(E=k.amountPlayer)&&void 0!==E?E:0};return[2,(T.length>0&&(R.player=T[0]),R)]}})}),function(g){return _.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(E=Be(function(g,E,_){var k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:k=this;this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;C=this.container.position.clone();this.container.position=new em(C.x,C.y-100,C.z);A=x(this.node).delay(g);A.to(E,{scale:em.ONE},{easing:"elasticOut"});T=x(this.container).delay(g);T.to(E,{position:C},{easing:"backOut"});R=x(this.uiOpacity).delay(g);R.to(E,{opacity:255},{easing:"cubicOut"}),_.addAbortListener(function(){k.node.scale=em.ONE,k.container.position=C,k.uiOpacity.opacity=255});return[4,Promise.all([tZ.runTweenAsync(A,_),tZ.runTweenAsync(T,_),tZ.runTweenAsync(R,_)])];case 1:I.sent();return[2]}})}),function(g,_,k){return E.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var g=this.payload.id||"";if(ur.validateTournamentExpired(g))return this.node.scene.emit(s4.RELOAD_TOURNAMENT),void l5.showNotificationScreen("Tournament has ended",2);try{var E=JSON.stringify(this.payload);l5.showTournamentDetailScreen(E,"tournament_start",this.hasPlayedAnimation),this.hasPlayedAnimation=!0}catch(g){console.warn("handleOnTournamentClicked",g)}}}]),l}(D)).prototype,"container",[Dn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dm=st(Dv.prototype,"titleLabel",[Di],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Db=st(Dv.prototype,"timeLabel",[Da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dw=st(Dv.prototype,"playerCountLabel",[Dr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DS=st(Dv.prototype,"playButtonLabel",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DE=st(Dv.prototype,"uiTransform",[Ds],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_=st(Dv.prototype,"banner",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dk=st(Dv.prototype,"bannerMask",[Du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DC=st(Dv.prototype,"bannerLoadingRing",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DA=st(Dv.prototype,"topLeader",[Dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(Dv.prototype,"fetchAndUpdateLeadersPayload",[Dd],Object.getOwnPropertyDescriptor(Dv.prototype,"fetchAndUpdateLeadersPayload"),Dv.prototype),st(Dv.prototype,"updateLeadersPayload",[Df],Object.getOwnPropertyDescriptor(Dv.prototype,"updateLeadersPayload"),Dv.prototype),Dy=Dv))||Dy);_._RF.pop(),_._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var DW,Dj,DX,DY,DJ,DQ,DZ,D$,D0,D1,D2,D4,D3,D5=k.ccclass,D6=k.property,D8=(DP=D5("TournamentBlockSkeleton"),DO=D6(C),DP((DD=st((DN=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",DD,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,tZ.runTweenAsync(x(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:_=this;this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;k=this.container.position.clone();this.container.position=new em(k.x,k.y-100,k.z);C=x(this.node).delay(g);C.to(.2,{scale:em.ONE},{easing:"elasticOut"});A=x(this.container).delay(g);A.to(.2,{position:k},{easing:"backOut"});T=x(this.uiOpacity).delay(g);T.to(.2,{opacity:255},{easing:"cubicOut"}),E.addAbortListener(function(){_.node.scale=em.ONE,_.container.position=k,_.uiOpacity.opacity=255});return[4,Promise.all([tZ.runTweenAsync(C,E),tZ.runTweenAsync(A,E),tZ.runTweenAsync(T,E)])];case 1:R.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})}]),a}(D)).prototype,"container",[DO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DB=DN))||DB);_._RF.pop(),_._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var D9,D7,Mt,Mn,Mi,Ma=k.ccclass,Mr=k.property,Mo=globalThis.game.player,Ms=(DW=Ma("TournamentsBoard"),Dj=Mr(ee),DX=Mr(C),DY=Mr(q),DJ=Mr(C),DQ=Mr(R),DW((D0=st((D$=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"tournamentBlockPrefab",D0,Ke(g)),g.tournamentBlockArray=[],rt(g,"inactiveNodeContainer",D1,Ke(g)),rt(g,"layout",D2,Ke(g)),rt(g,"createTournamentButton",D4,Ke(g)),rt(g,"viewport",D3,Ke(g)),g}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"start",value:function(){for(var g=0;g<20;g++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateData",value:function(g){var E=this,_=!1;g.forEach(function(g,k){var C=E.tournamentBlockArray[k];g.payload.playerId===Mo.getPlayerId()&&(_=!0),C||(C=E.addTournamentBlock()),E.layout.node.addChild(C.node),C.updateInfo(g)}),_||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var g=I(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(g);var E=g.getComponent(Dq);return this.tournamentBlockArray.push(E),E}},{key:"removeTournamentBlocks",value:function(){var g,E=at(this.getActiveTournamentBlocks());try{for(E.s();!(g=E.n()).done;){var _=g.value;this.inactiveNodeContainer.addChild(_.node)}}catch(g){E.e(g)}finally{E.f()}this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var g=this;return this.tournamentBlockArray.filter(function(E){return E.node.parent===g.layout.node})}},{key:"setCreateTournamentButtonActive",value:function(g){g?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=g}},{key:"showTournamentBlocks",value:(E=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:_=this.getActiveTournamentBlocks();if(_.length<1)return[3,2];k=Math.ceil(g/this.tournamentBlockContentHeight),C=Math.min(_.length,k);return[4,Promise.all(_.map(function(){var g=Be(function(g,_){return _ts_generator(this,function(k){switch(k.label){case 0:if(!(_<C))return[3,2];return[4,g.runShowPopUpAnimation(.1*_,.3,E)];case 1:k.sent();return[3,3];case 2:g.uiOpacity.opacity=255;k.label=3;case 3:return[2]}})});return function(E,_){return g.apply(this,arguments)}}()))];case 1:A.sent();A.label=2;case 2:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"updateVisibility",value:function(){var g,E=this.viewport.getBoundingBoxToWorld(),_=E.yMax,k=E.yMin,C=at(this.getActiveTournamentBlocks());try{for(C.s();!(g=C.n()).done;){var A=g.value,T=A.uiTransform;if(void 0!==T){var R=T.getBoundingBoxToWorld(),I=R.yMax,L=R.yMin,P=I<k||L>_;A.uiOpacity.opacity=P?0:255}}}catch(g){C.e(g)}finally{C.f()}}}]),i}(D)).prototype,"tournamentBlockPrefab",[Dj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D1=st(D$.prototype,"inactiveNodeContainer",[DX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D2=st(D$.prototype,"layout",[DY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D4=st(D$.prototype,"createTournamentButton",[DJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D3=st(D$.prototype,"viewport",[DQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DZ=D$))||DZ);_._RF.pop(),_._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var Ml,Mu,Mc,Mp,Mf,My,Mv,Mg,Mm,Mb,Mw,MS,ME,M_,Mk,MC=k.ccclass,MA=k.property,MT=(D9=MC("TournamentsNotAvailable"),D7=MA(C),D9((Mi=st((Mn=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"createButton",Mi,Ke(g)),g}return Ue(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"show",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.createButton.active=!0,this.uiOpacity.opacity=255;g=this.node.position.clone(),E=x(this.node);E.to(.05,{position:g.clone().add3f(5,0,0)}),E.to(.05,{position:g.clone().add3f(-5,0,0)});_=x(this.node).repeat(2,E);_.to(.05,{position:g});return[4,tZ.runTweenAsync(_)];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"hide",value:function(){this.createButton.active=!1,this.uiOpacity.opacity=0}}]),i}(D)).prototype,"createButton",[D7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mt=Mn))||Mt);_._RF.pop(),_._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var MR,MI,ML,MP,MO,MB,MN,MD,MM,MF=k.ccclass,MU=k.property,Mz=globalThis.game,Mx=Mz.storage,MG=Mz.match,MV=GameCore.Utils,MK=MV.Object,MH=MV.Array,Mq=(Ml=MF("TournamentContent"),Mu=MU({type:rI}),Mc=MU(Ms),Mp=MU(MT),Mf=MU(eH),My=MU({type:[D8]}),Mv=MU(ad),Ml((Mb=st((Mm=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimator",Mb,Ke(g)),rt(g,"tournamentsBoard",Mw,Ke(g)),rt(g,"tournamentsNotAvailable",MS,Ke(g)),rt(g,"scrollView",ME,Ke(g)),rt(g,"skeletons",M_,Ke(g)),rt(g,"contentOpacity",Mk,Ke(g)),g.animAbortSignal=null,g.softAbortSignal=null,g.hideContent=function(){g.contentOpacity.changeStateFade(!1,.1)},g.showContent=function(){g.contentOpacity.changeStateFade(!0,.1)},g}return Ue(r,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(eH.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(s4.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(a2.HIDE_UI,this.hideContent),this.node.scene.on(a2.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(eH.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(s4.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(a2.HIDE_UI,this.hideContent),this.node.scene.off(a2.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(C=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.listenEvents();E=null===this.animAbortSignal&&null===this.softAbortSignal;if(!E)return[3,2];this.animAbortSignal=new nD,this.softAbortSignal=new nD;return[4,this.showLoading(this.animAbortSignal)];case 1:E=(T.sent(),!this.isAborted());T.label=2;case 2:if(!E)return[3,10];return[4,ur.requestTournamentDataAsync()];case 3:_=T.sent();k=this.isAborted();if(k)return[3,9];return[4,this.hideLoading(this.animAbortSignal)];case 4:T.sent();C=this.isAborted();if(C)return[3,8];if(!(0!==_.length||null!==(g=this.softAbortSignal)&&void 0!==g&&g.aborted))return[3,6];this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(_);return[4,this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal)];case 5:A=(T.sent(),this.tournamentsBoard.updateVisibility());return[3,7];case 6:A=this.tournamentsNotAvailable.show();T.label=7;case 7:C=A;T.label=8;case 8:k=C;T.label=9;case 9:T.label=10;case 10:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"showLoading",value:(k=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.scrollView.scrollToTop(0),this.scrollView.enabled=!1;return[4,Promise.all([this.skeletons.map(function(E){return E.show(0,g)})])];case 1:E.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"hideLoading",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all([this.skeletons.map(function(E){return E.hide(g)})])];case 1:E.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!Mx.getStorage("tournament").animateTournamentLeader)return;var g=ur.getAllTournamentData(),E=MG.getMatchState().customData.tournamentId;if(!E)throw new Error("Tournament ID not found");var _=MH.search(g,function(g){return g.id===E});if(!_)throw new Error("Tournament not found");var k=JSON.stringify(_);l5.showTournamentDetailScreen(k,"tournament_end")}catch(g){Mx.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",g)}}},{key:"processCreateTournament",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:_.trys.push([0,2,,3]);return[4,lT.processCreateTournamentAsync()];case 1:_.sent();return[3,3];case 2:g=_.sent();if(!MK.hasOwn(g,"code"))return[2,void l5.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament",2)];if("USER_INPUT"===g.code)return[2];if("PLAYER_HAS_TOURNAMENT"===g.code)return[2,void l5.showNotificationScreen("You already have a tournament",2)];if("INVALID_OPERATION"===g.code&&MK.hasOwn(g,"message")){E="string"==typeof g.message?g.message:"Failed to Create Tournament";return[2,void l5.showNotificationScreen(E,2)]}l5.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament",2);return[3,3];case 3:this.reload();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"isAborted",value:function(){var g,E;return null===(g=null===(E=this.animAbortSignal)||void 0===E?void 0:E.aborted)||void 0===g||g}},{key:"cleanup",value:function(){var g;this.unlistenEvents(),null===(g=this.animAbortSignal)||void 0===g||g.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var g;null===(g=this.softAbortSignal)||void 0===g||g.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.enter()}}]),r}(D)).prototype,"panelAnimator",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mw=st(Mm.prototype,"tournamentsBoard",[Mc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MS=st(Mm.prototype,"tournamentsNotAvailable",[Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=st(Mm.prototype,"scrollView",[Mf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=st(Mm.prototype,"skeletons",[My],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mk=st(Mm.prototype,"contentOpacity",[Mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mg=Mm))||Mg);_._RF.pop(),_._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var MW,Mj,MX,MY,MJ;MR=(0,k.ccclass)("TournamentPage"),MI=nC.required(),ML=nC.getComponent(rp),MP=nC.onlyRunInLifeCycleAsync,MO=nC.onlyRunInLifeCycle,MB=nC.onlyRunInLifeCycleAsync,MN=nC.onlyRunInLifeCycleAsync,MR((MM=st((MD=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"panelAnimationController",MM,Ke(g)),g}return Ue(r,[{key:"onLoad",value:function(){Je(Ve(r.prototype),"onLoad",this).call(this),nC.decorateComponent(this)}},{key:"start",value:(C=Be(function(){return _ts_generator(this,function(g){Je(Ve(r.prototype),"start",this).call(this);return[2]})}),function(){return C.apply(this,arguments)})},{key:"mount",value:(k=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,Je(Ve(r.prototype),"mount",this).call(this)];case 1:g.sent(),this.onMount();return[2]}})}),function(){return k.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(Mq),!this.content)throw new Error("LeaderboardPage: Leaders not found")}},{key:"transitionIn",value:(_=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Je(Ve(r.prototype),"transitionIn",this).call(this)];case 1:_.sent();g=tZ.runTweenAsync(x(this.containerUIOpacity).to(.2,{opacity:255})),E=this.panelAnimationController.showUI();return[4,Promise.all([g,E])];case 2:_.sent(),this.content.enter();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"transitionOut",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:null===(g=this.content)||void 0===g||g.softAbort(),this.content.unlistenUIEvents();return[4,Je(Ve(r.prototype),"transitionOut",this).call(this)];case 1:E.sent();return[4,this.panelAnimationController.hideUI()];case 2:E.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"unmount",value:function(){var g;null===(g=this.content)||void 0===g||g.cleanup(),Je(Ve(r.prototype),"unmount",this).call(this)}}]),r}(AE)).prototype,"panelAnimationController",[MI,ML],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(MD.prototype,"mount",[MP],Object.getOwnPropertyDescriptor(MD.prototype,"mount"),MD.prototype),st(MD.prototype,"onMount",[MO],Object.getOwnPropertyDescriptor(MD.prototype,"onMount"),MD.prototype),st(MD.prototype,"transitionIn",[MB],Object.getOwnPropertyDescriptor(MD.prototype,"transitionIn"),MD.prototype),st(MD.prototype,"transitionOut",[MN],Object.getOwnPropertyDescriptor(MD.prototype,"transitionOut"),MD.prototype),MD));_._RF.pop(),_._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var MQ,MZ,M$,M0,M1,M2,M4,M3,M5=k.ccclass,M6=k.property;MW=M5("EventBadge"),Mj=M6(L),MX=M6(z),MW((MJ=st((MY=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"label",MJ,Ke(g)),g}return Ue(n,[{key:"text",get:function(){return this.label.string},set:function(g){this.label.string=g}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(D)).prototype,"label",[Mj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(MY.prototype,"text",[MX],Object.getOwnPropertyDescriptor(MY.prototype,"text"),MY.prototype),MY));_._RF.pop(),_._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var M8,M9,M7,Ft,Fn,Fi,Fa,Fr,Fo,Fs,Fl,Fu,Fc,Fp,Ff,Fy,Fv,Fg,Fm,Fb,Fw,FS,FE,F_,Fk,FC,FA,FT,FR,FI,FL,FP,FO,FB,FN,FD,FM,FF,FU,Fz,Fx,FG,FV,FK,FH,Fq,FW,Fj=k.ccclass,FX=k.property;MQ=Fj("EventProgressBar"),MZ=FX(ol),M$=FX(L),M0=FX(z),M1=FX({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),MQ((M4=st((M2=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"progressBar",M4,Ke(g)),rt(g,"progressLabel",M3,Ke(g)),g}return Ue(n,[{key:"text",get:function(){return this.progressLabel.string},set:function(g){this.progressLabel.string=g}},{key:"progress",get:function(){return this.progressBar.progress},set:function(g){this.progressBar.progress=g}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(D)).prototype,"progressBar",[MZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M3=st(M2.prototype,"progressLabel",[M$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(M2.prototype,"text",[M0],Object.getOwnPropertyDescriptor(M2.prototype,"text"),M2.prototype),st(M2.prototype,"progress",[M1],Object.getOwnPropertyDescriptor(M2.prototype,"progress"),M2.prototype),M2));_._RF.pop(),_._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var FY,FJ,FQ,FZ,F$,F0=k.ccclass,F1=k.property,F2=k.executeInEditMode,F4=globalThis.game.analytics,F3=GameCore.Plugins.Analytics.Events;M8=F0("NavButton"),M9=F1(J),M7=F1({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),Ft=F1({type:K,group:{name:"Animation"}}),Fn=F1({type:K,group:{name:"Animation"}}),Fi=F1({type:K,group:{name:"Animation"}}),Fa=F1({type:K,group:{name:"Animation"}}),Fr=F1({type:K,group:{name:"Animation"}}),Fo=F1({group:{name:"Animation"}}),Fs=F1({type:K,group:{name:"Animation"}}),Fl=F1({type:K,group:{name:"Animation"}}),Fu=F1({group:{name:"Animation"}}),Fc=F1({type:K,group:{name:"Animation"}}),Fp=F1({type:K,group:{name:"Animation"}}),Ff=F1({type:K,group:{name:"Animation"}}),Fy=F1({type:K,group:{name:"Animation"}}),Fv=F1({type:K,group:{name:"Animation"}}),Fg=F1({type:R}),Fm=F1(C),Fb=F1(eu),Fw=F1({type:R}),FS=F1({type:es(nB)}),FE=F1(P_),M8(F_=F2((FC=st((Fk=function(g){ze(o,g);var E,_,k=Xe(o);function o(){var g;Fe(this,o);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"wip",FC,Ke(g)),rt(g,"isSelectedInEditor",FA,Ke(g)),rt(g,"animationDuration",FT,Ke(g)),rt(g,"selectedSpacing",FR,Ke(g)),rt(g,"deselectedSpacing",FI,Ke(g)),rt(g,"selectedIconY",FL,Ke(g)),rt(g,"selectedIconX",FP,Ke(g)),rt(g,"selectedIconScale",FO,Ke(g)),rt(g,"deselectedIconY",FB,Ke(g)),rt(g,"deselectedIconX",FN,Ke(g)),rt(g,"deselectedIconScale",FD,Ke(g)),rt(g,"initTextY",FM,Ke(g)),rt(g,"selectedTextY",FF,Ke(g)),rt(g,"selectedTextX",FU,Ke(g)),rt(g,"deselectedTextY",Fz,Ke(g)),rt(g,"deselectedTextX",Fx,Ke(g)),rt(g,"spacer",FG,Ke(g)),rt(g,"icon",FV,Ke(g)),rt(g,"text",FK,Ke(g)),rt(g,"uiTransform",FH,Ke(g)),rt(g,"screenType",Fq,Ke(g)),rt(g,"navManager",FW,Ke(g)),g.isSelected=!1,g.onMouseEnter=function(E){g.isSelected||g.playHoverOnAnimation()},g.onMouseLeave=function(E){g.isSelected||g.playHoverOffAnimation()},g}return Ue(o,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(C.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(C.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.initTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var g,E;this.isSelected||(i8.playSound(ih.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),F4.event(F3.BUTTON_CLICK,{button_name:null!==(g=null===(E=this.node.parent)||void 0===E?void 0:E.name)&&void 0!==g?g:this.node.name,screen_name:iC.getCurrentPage()}))}},{key:"select",value:(_=Be(function(){var g;var E=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:g=!(E.length>0&&void 0!==E[0])||E[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0;if(!g)return[3,2];return[4,tZ.runTweenAsync(this.playSelectAnimation())];case 1:_.sent();return[3,3];case 2:this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255;_.label=3;case 3:return[2]}})}),function(){return _.apply(this,arguments)})},{key:"deselect",value:(E=Be(function(){var g,E;var _=arguments;return _ts_generator(this,function(k){switch(k.label){case 0:g=!(_.length>0&&void 0!==_[0])||_[0],E=_.length>1&&void 0!==_[1]&&_[1];if(!this.isSelected&&!E)throw new Error("NavButton: Already deselected");this.isSelected=!1;if(!g)return[3,2];return[4,tZ.runTweenAsync(this.deselectAnimation())];case 1:k.sent();return[3,3];case 2:this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0;k.label=3;case 3:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var g=new em(this.selectedIconX,this.selectedIconY,0),E=new em(this.deselectedIconX,this.deselectedIconY,0),_=this.node.scale.clone();this.node.scale=this.selectedIconScale;var k=this.uiTransform.convertToWorldSpaceAR(g),C=this.uiTransform.convertToWorldSpaceAR(E);return this.node.scale=_,C.x-k.x}},{key:"playHoverOnAnimation",value:function(){var g=x(this.icon);return g.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),tZ.runTweenAsync(g)}},{key:"playHoverOffAnimation",value:function(){var g=x(this.icon);return g.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),tZ.runTweenAsync(g)}},{key:"playSelectAnimation",value:function(){var g=this;return x(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(E,_){if(void 0!==_){var k=el.quintInOut(_),C=el.backOut(_),A=el.linear(_),T=_<.5?2*_:1,R=g.deselectedIconY+(g.selectedIconY-g.deselectedIconY)*C,I=g.deselectedIconX+(g.selectedIconX-g.deselectedIconX)*A;g.icon.setPosition(I,R,0);var L=g.deselectedIconScale.clone().lerp(g.selectedIconScale,k);g.icon.setScale(L.x,L.y,g.icon.scale.z);var P=255*T,O=g.deselectedTextY+(g.selectedTextY-g.deselectedTextY)*A,B=g.deselectedTextX+(g.selectedTextX-g.deselectedTextX)*A;g.text.opacity=P,g.text.node.setPosition(B,O,0)}}})}},{key:"deselectAnimation",value:function(){var g=this;return x(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(E,_){if(void 0!==_){var k=eO(g.selectedIconY,g.deselectedIconY,_),C=eO(g.selectedIconX,g.deselectedIconX,_);g.icon.setPosition(C,k,0);var A=eO(255,0,_<.5?2*_:1);g.text.opacity=A;var T=eO(g.selectedTextY,g.deselectedTextY,_),R=eO(g.selectedTextX,g.deselectedTextX,_);g.text.node.setPosition(R,T,0);var I=g.selectedIconScale.clone().lerp(g.deselectedIconScale,el.quintInOut(_));g.icon.setScale(I.x,I.y,g.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(R),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}}]),o}(D)).prototype,"wip",[M9],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),FA=st(Fk.prototype,"isSelectedInEditor",[M7],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),FT=st(Fk.prototype,"animationDuration",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .3}}),FR=st(Fk.prototype,"selectedSpacing",[Fn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),FI=st(Fk.prototype,"deselectedSpacing",[Fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),FL=st(Fk.prototype,"selectedIconY",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),FP=st(Fk.prototype,"selectedIconX",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FO=st(Fk.prototype,"selectedIconScale",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(1,1,1)}}),FB=st(Fk.prototype,"deselectedIconY",[Fs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FN=st(Fk.prototype,"deselectedIconX",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FD=st(Fk.prototype,"deselectedIconScale",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new em(.8,.8,1)}}),FM=st(Fk.prototype,"initTextY",[Fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -100}}),FF=st(Fk.prototype,"selectedTextY",[Fp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return -10}}),FU=st(Fk.prototype,"selectedTextX",[Ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fz=st(Fk.prototype,"deselectedTextY",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fx=st(Fk.prototype,"deselectedTextX",[Fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),FG=st(Fk.prototype,"spacer",[Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FV=st(Fk.prototype,"icon",[Fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FK=st(Fk.prototype,"text",[Fb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FH=st(Fk.prototype,"uiTransform",[Fw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fq=st(Fk.prototype,"screenType",[FS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FW=st(Fk.prototype,"navManager",[FE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F_=Fk))||F_);_._RF.pop(),_._RF.push({},"091aai5+ANDeZfFN8JFkbyi","TournamentButton",void 0);var F5,F6,F8,F9,F7,Ut=k.ccclass,Un=k.property,Ui=globalThis.game.leaderboard;FY=Ut("TournamentButton"),FJ=Un(C),FQ=nC.onlyRunInLifeCycle,FY((F$=st((FZ=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"hotIcon",F$,Ke(g)),g}return Ue(i,[{key:"onLoad",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:L.trys.push([0,11,,12]);return[4,ur.requestTournamentDataAsync()];case 1:E=at.apply(void 0,[L.sent()]);L.label=2;case 2:L.trys.push([2,8,9,10]);E.s();L.label=3;case 3:if(!!(g=E.n()).done)return[3,7];_=g.value.payload,k=_.leaderboardId,C=_.playerId;if(!(k&&"global"===C))return[3,6];A=Ui.getLeaderboardName(k);T=A;if(!T)return[3,5];return[4,Ui.requestLeaderboardAsync(A,0)];case 4:T=(L.sent(),this.checkAndShowHotIcon(A));L.label=5;case 5:L.label=6;case 6:return[3,3];case 7:return[3,10];case 8:R=L.sent();E.e(R);return[3,10];case 9:E.f();return[7];case 10:return[3,12];case 11:I=L.sent();console.info("Error in TournamentButton",I);return[3,12];case 12:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"checkAndShowHotIcon",value:function(g){var E=Ui.getLeaderboard(g);E&&E.amountPlayer>=30&&(this.hotIcon.active=!0)}}]),i}(D)).prototype,"hotIcon",[FJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(FZ.prototype,"checkAndShowHotIcon",[FQ],Object.getOwnPropertyDescriptor(FZ.prototype,"checkAndShowHotIcon"),FZ.prototype),FZ));_._RF.pop(),_._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var Ua,Ur,Uo,Us,Ul,Uu,Uc,Uh,Up,Uf,Uy,Uv,Ug,Um,Ub=k.ccclass,Uw=k.property,US=k.disallowMultiple,UE=globalThis.game.player,U_=am,Uk=GameCore.Match.Modes,UC=[ih.COMBO_1,ih.COMBO_2,ih.COMBO_3,ih.COMBO_4,ih.COMBO_5,ih.COMBO_6,ih.COMBO_7,ih.COMBO_8,ih.COMBO_9,ih.COMBO_10,ih.COMBO_11,ih.COMBO_12,ih.COMBO_13,ih.TILE_MATCH,ih.BOMB_DEFUSE,ih.BOMB_EXPLODE_1,ih.BOMB_EXPLODE_2,ih.TILE_SELECT,ih.THUNDERBOLT,ih.SHUFFLE_ITEM,ih.LEVEL_START,ih.LEVEL_COMPLETE,ih.LEVEL_FAIL];F5=Ub("GameScene"),F6=Uw(_$),F5(F8=US((F7=st((F9=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"coinManager",F7,Ke(g)),g.handleGameExit=function(){lV.switchScene(s1)},g.handleShowResults=function(){lV.switchScene(s2)},g.handleGameMaskWhenLayoutChanged=function(g){var E=$("Canvas/Game/GameObjects");if(E){var _=E.getComponent(eW);_&&(_.enabled=g===U_.Landscape)}},g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onLoad",value:function(){this.coinManager.init()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){Q.on(t6,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(a2.GAME_EXIT,this.handleGameExit),this.node.scene.on(a2.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}},{key:"start",value:function(){UE.getPlayerSetting("music")&&this.updateMusic(),this.preloadSounds(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadSounds",value:function(){for(var g=0,E=UC;g<E.length;g++){var _=E[g];ie.loadAudioClipAsync(_)}}},{key:"preloadScenes",value:function(){lV.preloadDashboardScene()}},{key:"updateMusic",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=lT.getMatchMode()===Uk.TOURNAMENT,E=g?ih.TOURNAMENT_MUSIC:ih.BG_MUSIC;_=i8.getCurrentMusic()!==E;if(!_)return[3,3];return[4,i8.setVolumeMusic(0,!0)];case 1:k.sent();return[4,tZ.waitTweenAsync(1)];case 2:_=k.sent();k.label=3;case 3:i8.playMusic(E,g),i8.setVolumeMusic(g?.4:.3,!0);return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(D)).prototype,"coinManager",[F6],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F8=F9))||F8);_._RF.pop(),_._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);var UA,UT,UR,UI,UL,UP,UO=k.ccclass,UB=k.property;Ua=UO("ItemButton"),Ur=UB(J),Uo=UB(B),Us=UB({type:V}),Ul=UB(L),Uu=UB(C),Uc=UB(C),Ua((Up=st((Uh=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"isDebug",Up,Ke(g)),rt(g,"button",Uf,Ke(g)),rt(g,"quantity",Uy,Ke(g)),rt(g,"quantityLabel",Uv,Ke(g)),rt(g,"plusNode",Ug,Ke(g)),rt(g,"quantityNode",Um,Ke(g)),g}return Ue(n,[{key:"__preload",value:function(){this.item=this.getComponent(mn),this.validateRequiredComponents()}},{key:"start",value:function(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string="".concat(this.quantity),this.validateButton(),this.node.scene.on(a2.GRID_CREATE,this.validateButton,this),this.node.scene.on(a2.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(a2.GRID_CLEAR,this.validateButton,this)}},{key:"validateRequiredComponents",value:function(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}},{key:"validateButton",value:function(){var g=this;console.log("VALIDATE BUTTON"),this.canActivate().then(function(E){g.button.interactable=!0,g.plusNode.active=0===g.quantity,g.quantityNode.active=g.quantity>0})}},{key:"activate",value:function(){var g=this;return new Promise(function(E){if(g.quantity<=0)return g.handleShowAddItemScreen(),void E();g.item.activate().then(function(){g.isDebug||(g.quantity--,g.quantityLabel.string="".concat(g.quantity),g.item.saveQuantity()),g.validateButton(),E()})})}},{key:"canActivate",value:function(){return Promise.resolve(!0)}},{key:"addQuantity",value:function(g){this.quantity+=g,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"clearQuantity",value:function(){this.quantity=0,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"handleShowAddItemScreen",value:function(){l5.openScreen(ib.GET_ITEM_SCREEN,{item:sN.HINT,quantity:1})}}]),n}(D)).prototype,"isDebug",[Ur],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Uf=st(Uh.prototype,"button",[Uo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uy=st(Uh.prototype,"quantity",[Us],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Uv=st(Uh.prototype,"quantityLabel",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ug=st(Uh.prototype,"plusNode",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Um=st(Uh.prototype,"quantityNode",[Uc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uh));_._RF.pop(),_._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var UN,UD,UM,UF,UU,Uz,Ux=k.ccclass,UG=k.property;UA=Ux("ComboEffect"),UT=UG(eu),UR=UG(eK),UA((UL=st((UI=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"circleOpacity",UL,Ke(g)),rt(g,"particle",UP,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(a2.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(g){g>1&&(this.circleOpacity.node.scale=em.ZERO,this.circleOpacity.opacity=60,this.particle.resetSystem(),x(this.circleOpacity.node).to(.2,{scale:new em(1.3,1.3,1.3)},{easing:"quadOut"}).start(),x(this.circleOpacity).delay(.3).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),n}(D)).prototype,"circleOpacity",[UT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UP=st(UI.prototype,"particle",[UR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UI));_._RF.pop(),_._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var UV,UK,UH,Uq,UW,Uj,UX,UY,UJ=k.ccclass,UQ=k.property;UN=UJ("ComboLabel"),UD=UQ(L),UM=UQ(C),UN((UU=st((UF=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"comboNumber",UU,Ke(g)),rt(g,"comboContainer",Uz,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.opacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(a2.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(g){0===g?this.opacity.opacity=0:g>1?(this.opacity.opacity=255,this.comboNumber.string="".concat(g),x(this.comboContainer).to(.1,{scale:new em(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:em.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),n}(D)).prototype,"comboNumber",[UD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uz=st(UF.prototype,"comboContainer",[UM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UF));_._RF.pop(),_._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var UZ,U$,U0,U1,U2,U4,U3,U5,U6,U8=k.ccclass,U9=k.property;UV=U8("ComboPopup"),UK=U9(eo),UH=U9(er),Uq=U9(G),UV((Uj=st((UW=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"textSprite",Uj,Ke(g)),rt(g,"comboSprites",UX,Ke(g)),rt(g,"animation",UY,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"start",value:function(){this.node.scene.on(a2.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"validateRequiredComponents",value:function(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}},{key:"handleOnComboUpdated",value:function(g){if(!(g<2)){for(var E=this.comboSprites.length-1;E>=0;E--)if(g>=E+2){this.textSprite.spriteFrame=this.comboSprites[E],this.animation.play();break}}}}]),n}(D)).prototype,"textSprite",[UK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UX=st(UW.prototype,"comboSprites",[UH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),UY=st(UW.prototype,"animation",[Uq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UW));_._RF.pop(),_._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var U7,zt,zn,zi,za,zr,zo,zs,zl,zu,zc,zp,zf,zy,zv,zg=k.ccclass,zm=k.property,zb=(UZ=zg("PlayerScore"),U$=zm(C),U0=zm(L),U1=zm(eo),UZ((U3=st((U4=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"crown",U3,Ke(g)),rt(g,"playerScore",U5,Ke(g)),rt(g,"avatar",U6,Ke(g)),g}return Ue(i,[{key:"showCrown",value:function(g){this.crown.active=g}},{key:"setPlayerScore",value:function(g){this.playerScore.string=g.toString()}},{key:"playWaitingAnimation",value:function(){var g=this,E=0;this.playerScore.schedule(function(){E=(E+1)%4;var _=Array(E+1).join(".");g.playerScore.string="Waiting"+_},.5);var _=this.playerScore.getComponent(eu),k=x(_).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=x(_).repeatForever(k).start()}},{key:"stopWaitingAnimation",value:function(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(eu).opacity=255}},{key:"loadPhoto",value:(E=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,2,,3]);return[4,bz.getPlayerAvatar(g,E,128)];case 1:_=C.sent();if(!_)throw new Error("Failed to create sprite frame");_.packable=!0,this.avatar.spriteFrame=_;return[3,3];case 2:k=C.sent();return[2,void console.error(k)];case 3:return[2]}})}),function(g,_){return E.apply(this,arguments)})}]),i}(D)).prototype,"crown",[U$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U5=st(U4.prototype,"playerScore",[U0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U6=st(U4.prototype,"avatar",[U1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U2=U4))||U2);_._RF.pop(),_._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var zw,zS,zE,z_,zk,zC,zA,zT,zR,zI=k.ccclass,zL=k.disallowMultiple,zP=k.property,zO=globalThis.game,zB=zO.match,zN=zO.player,zD=zO.monitorError,zM=GameCore.Utils.Object;U7=zI("ChallengeResultScene"),zt=zP(V),zn=zP({type:zb,group:"Score"}),zi=zP({type:zb,group:"Score"}),za=zP(yc),zr=zP(mp),zo=zP(G),U7(zs=zL((zu=st((zl=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"pollingInterval",zu,Ke(g)),rt(g,"playerScore",zc,Ke(g)),rt(g,"opponentScore",zp,Ke(g)),rt(g,"paperConfetti",zf,Ke(g)),rt(g,"levelManager",zy,Ke(g)),rt(g,"animation",zv,Ke(g)),g.goToDashboardScene=function(){lV.switchScene(s1)},g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.node.scene.on(nn,this.goToDashboardScene),this.node.scene.on(ne,this.handleTryAgainClicked,this)}},{key:"start",value:function(){this.scheduleOnce(this.preloadScenes,3);try{var g=zB.getMatchState(),E=g.customData,_=E.playerId,k=E.opponentId;if(null===_||null===k)throw new Error("ResultScene: playerId is ".concat(_," and opponentId is ").concat(k,". Expected to not be null."));var C=zN.getPlayer().photo,A=g.profiles[_],T=A.score,R=void 0===T?0:T,I=A.finished,L=void 0!==I&&I,P=g.profiles[k],O=P.photo,B=P.score,N=void 0===B?0:B,D=P.finished,M=void 0!==D&&D,F=L&&M,U=F&&R>N,z=F&&N>R;this.playerScore.loadPhoto(C,_),this.opponentScore.loadPhoto(O,k),this.playerScore.setPlayerScore(R),this.opponentScore.setPlayerScore(N),this.playerScore.showCrown(U),this.opponentScore.showCrown(z),L&&M?R===N?this.playDrawAnimation():U?this.playWinAnimation():z&&this.playLoseAnimation():(L||this.playerScore.playWaitingAnimation(),M||this.opponentScore.playWaitingAnimation(),this.playWaitingAnimation())}catch(g){console.warn("ResultScene: Error on load",g),this.goToDashboardScene()}}},{key:"preloadScenes",value:function(){lV.preloadDashboardScene()}},{key:"handleTryAgainClicked",value:(E=Be(function(){var g,E,_,k,C,A,T,R,I,L,P,O,B,N;return _ts_generator(this,function(D){switch(D.label){case 0:E=(null!==(g=zN.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;_=Math.max(1,_);return[4,this.levelManager.loadLevelData(_)];case 1:k=D.sent();D.label=2;case 2:D.trys.push([2,4,,5]);if(!k)throw new Error("Level data is not found");C=zB.getMatchState().customData.opponentId;if(!C)throw new Error("Opponent id is not found");l5.showLoadingScreen();A=c_.generateFen(k),T=k.mode,R=void 0===T?"":T,I=k.rules,L=void 0===I?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:I,P=k.time,O=void 0===P?0:P,B=k.level;return[4,zB.challenge.friend.processAsync({playerId:zN.getPlayerId(),opponentId:C,extraData:{level:B,fen:A,gravity:R,rules:L,time:O}})];case 3:D.sent(),l5.closeLoadingScreen(),this.goToGameScene();return[3,5];case 4:N=D.sent();if(zM.hasOwn(N,"code")&&"USER_INPUT"===N.code)return[2,void l5.closeLoadingScreen()];console.warn("ReplayChallengeFriend",N),l5.closeLoadingScreen(),l5.showNotificationScreen("Sorry, you cannot replay\nat this time.",2),null==zD||zD.sendException(_instanceof(N,Error)?N:new Error("ReplayChallengeFriend"+JSON.stringify(N))),this.scheduleOnce(this.goToDashboardScene,2);return[3,5];case 5:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleHomeClicked",value:function(){this.goToDashboardScene()}},{key:"goToGameScene",value:function(){lV.switchScene(s0)}},{key:"playWaitingAnimation",value:function(){var g=this;this.scheduleOnce(function(){var E,_=at(g.paperConfetti);try{for(_.s();!(E=_.n()).done;)E.value.play()}catch(g){_.e(g)}finally{_.f()}},.2),i8.playSound(ih.LEVEL_COMPLETE)}},{key:"playDrawAnimation",value:function(){this.animation.play("Draw"),i8.playSound(ih.LEVEL_FAIL)}},{key:"playWinAnimation",value:function(){var g=this;this.scheduleOnce(function(){var E,_=at(g.paperConfetti);try{for(_.s();!(E=_.n()).done;)E.value.play()}catch(g){_.e(g)}finally{_.f()}},.2),this.animation.play("Win"),i8.playSound(ih.LEVEL_COMPLETE)}},{key:"playLoseAnimation",value:function(){this.animation.play("Lose"),i8.playSound(ih.LEVEL_FAIL)}}]),i}(D)).prototype,"pollingInterval",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),zc=st(zl.prototype,"playerScore",[zn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zp=st(zl.prototype,"opponentScore",[zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zf=st(zl.prototype,"paperConfetti",[za],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zy=st(zl.prototype,"levelManager",[zr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zv=st(zl.prototype,"animation",[zo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zs=zl))||zs);_._RF.pop(),_._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var zF,zU=k.ccclass,zz=k.property,zx=k.disallowMultiple,zG=GameCore.Events,zV=globalThis.game.event,zK=(zw=zU("BaseScreen"),zS=zz(C),zE=zz(C),z_=zz(eu),zw(zk=zx((zA=st((zC=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"container",zA,Ke(g)),rt(g,"backgroundMask",zT,Ke(g)),rt(g,"screenOpacity",zR,Ke(g)),g.data={},g}return Ue(n,[{key:"__preload",value:function(){this.animation=this.getComponent(G),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function(){var g=this.getMaskOpacity(),E=this.getContainerOpacity();g&&E&&(g.opacity=0,E.opacity=0)}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function(g){this.screenOpacity.opacity=g}},{key:"open",value:function(g){var E,_;g&&(this.data=g),this.show(),this.runAnimation(null!==(E=null===(_=this.data.overrideAnimation)||void 0===_?void 0:_.openScreen)&&void 0!==E?E:"OpenScreen")}},{key:"close",value:function(){var g,E,_=this;this.node.active&&(this.animation.once(G.EventType.FINISHED,function(){zV.emit(zG.CLOSED_SCREEN,{screenName:_.node.name}),_.hide()}),this.runAnimation(null!==(g=null===(E=this.data.overrideAnimation)||void 0===E?void 0:E.closeScreen)&&void 0!==g?g:"CloseScreen"))}},{key:"runAnimation",value:function(g){if(!this.isAnimationExist(g))throw new Error("".concat(this.node.name,": Animation component must have ").concat(g," clip"));this.animation.play(g)}},{key:"isAnimationExist",value:function(g){return this.animation.clips.some(function(E){return!(!E||E.name!==g)})}},{key:"getMaskOpacity",value:function(){var g=this.backgroundMask.getComponent(eu);return g||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function(){var g=this.container.getComponent(eu);return g||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function(){this.setScreenOpacity(255);var g=this.node.getComponent(H);if(g){g.enabled=!0,g.updateAlignment();var E,_=at(this.node.getComponentsInChildren(H));try{for(_.s();!(E=_.n()).done;)E.value.updateAlignment()}catch(g){_.e(g)}finally{_.f()}}}},{key:"hide",value:function(){this.setScreenOpacity(0),this.node.setWorldPosition(new em(-1e3,-1e3,0));var g=this.node.getComponent(H);g&&(g.enabled=!1)}}]),n}(D)).prototype,"container",[zS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zT=st(zC.prototype,"backgroundMask",[zE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zR=st(zC.prototype,"screenOpacity",[z_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zk=zC))||zk)||zk);_._RF.pop(),_._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var zH,zq,zW,zj,zX,zY=k.ccclass,zJ=k.requireComponent;zY("BackgroundMask")(zF=zJ([eu])(zF=function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"onLoad",value:function(){var g=this.getComponent(eu);g?(this.opacity=g,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var g,E,_=this.opacity.opacity/255;g=_,(E=document.getElementById("app-mask"))&&(E.style.background="rgb(0 0 0 / ".concat(g,")"))}}]),n}(D))||zF);_._RF.pop(),_._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);var zQ,zZ,z$,z0,z1,z2,z4,z3,z5,z6,z8,z9,z7,xt,xn=k.ccclass,xi=k.property,xa=(zH=xn("Screens"),zq=xi({type:es(ib)}),zH((zX=st((zj=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"screenKeys",zX,Ke(g)),g}return Ue(n)}(D)).prototype,"screenKeys",[zq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zW=zj))||zW);_._RF.pop(),_._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var xr,xo,xs,xl,xu,xc,xp,xf,xy,xv,xg,xm,xb,xw,xS,xE,x_,xk,xC,xA,xT,xR=k.ccclass,xI=k.property,xL=k.disallowMultiple,xP=k.requireComponent,xO=GameCore.Events,xB=globalThis.game.event;zQ=xR("CongratulationScreen"),zZ=xP(zK),z$=xI(C),z0=xI(C),z1=xI(B),z2=xI(B),z4=xI(B),zQ(z3=xL(z3=zZ((z6=st((z5=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"congratulation",z6,Ke(g)),rt(g,"confirmation",z8,Ke(g)),rt(g,"closeButtonComponent",z9,Ke(g)),rt(g,"yesButtonComponent",z7,Ke(g)),rt(g,"noButtonComponent",xt,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("CongratulationScreen: screen not found");g.validateEventPayload(E)&&(g.closeButtonComponent.interactable=!0,g.yesButtonComponent.interactable=!0,g.noButtonComponent.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.confirmationUIOpacity=this.confirmation.getComponent(eu),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){xB.on(xO.OPENING_SCREEN,this.handleOpeningScreen),xB.on(xO.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){xB.off(xO.OPENING_SCREEN,this.handleOpeningScreen),xB.off(xO.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,l5.closeScreen(iS[this.node.name])}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,x(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),x(this.confirmation).set({scale:new em(.8,.8,.8)}).to(.2,{scale:new em(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(a2.START_OVER,1)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(a2.GAME_REPLAY,{level:this.screen.data.level})}}]),n}(D)).prototype,"congratulation",[z$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z8=st(z5.prototype,"confirmation",[z0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z9=st(z5.prototype,"closeButtonComponent",[z1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z7=st(z5.prototype,"yesButtonComponent",[z2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xt=st(z5.prototype,"noButtonComponent",[z4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z3=z5))||z3)||z3);_._RF.pop(),_._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var xN,xD,xM,xF,xU,xz,xx,xG,xV,xK,xH,xq,xW,xj,xX,xY,xJ,xQ,xZ,x$,x0,x1,x2=k.ccclass,x4=k.property,x3=(xr=x2("DayBlock"),xo=x4({type:eo,group:"Background"}),xs=x4({type:eo,group:"Background"}),xl=x4({type:er,group:"Background"}),xu=x4({type:er,group:"Background"}),xc=x4(L),xp=x4(L),xf=x4(C),xy=x4(C),xv=x4(C),xr((xb=st((xm=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"background",xb,Ke(g)),rt(g,"topBackground",xw,Ke(g)),rt(g,"blueBackground",xS,Ke(g)),rt(g,"blueTopBackground",xE,Ke(g)),rt(g,"dayLabel",x_,Ke(g)),rt(g,"coinLabel",xk,Ke(g)),rt(g,"rewardItemsNode",xC,Ke(g)),rt(g,"checkNode",xA,Ke(g)),rt(g,"glowNodes",xT,Ke(g)),g}return Ue(n,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(eu),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new A(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new A("#3469bf")}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"updateInfo",value:function(g){this.updateBackground(g),this.updateDayLabel(g),this.coinLabel.string=g.value.toString(),this.updateRewardItems(g)}},{key:"updateBackground",value:function(g){if(this.blueTopBackground&&this.blueBackground)switch(g.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(g){this.dayLabel.string="Day ".concat(g.day.toString());var E=this.defaultDayLabelOutlineColor;"rewarded"!==g.status&&(E=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=E,this.dayLabel.shadowColor=E}},{key:"updateRewardItems",value:function(g){switch(g.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(g){this.glowNodes&&this.glowNodes.forEach(function(E){E.active=g})}}]),n}(D)).prototype,"background",[xo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xw=st(xm.prototype,"topBackground",[xs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xS=st(xm.prototype,"blueBackground",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xE=st(xm.prototype,"blueTopBackground",[xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x_=st(xm.prototype,"dayLabel",[xc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xk=st(xm.prototype,"coinLabel",[xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xC=st(xm.prototype,"rewardItemsNode",[xf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xA=st(xm.prototype,"checkNode",[xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xT=st(xm.prototype,"glowNodes",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xg=xm))||xg);_._RF.pop(),_._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var x5=k.ccclass,x6=k.property,x8=k.requireComponent,x9=GameCore,x7=x9.Events,Gt=x9.Utils,Gn=Gt.Object,Gi=Gt.Array,Ga=x9.Configs.DailyRewards,Gr=globalThis.game,Go=Gr.event,Gs=Gr.dailyRewards,Gl=Gr.player,Gu=Gr.monitorError;xN=x5("DailyRewardsScreen"),xD=x8(zK),xM=nC.required(),xF=nC.getComponent(zK),xU=nC.required(),xz=x6(C),xx=nC.required(),xG=x6(B),xV=nC.required(),xK=x6(B),xH=x6([x3]),xq=nC.onlyRunInLifeCycleAsync,xW=nC.onlyRunInLifeCycle,xj=nC.onlyRunInLifeCycleAsync,xX=nC.onlyRunInLifeCycle,xN(xY=xD((xQ=st((xJ=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"screen",xQ,Ke(g)),g.rewardsData=[],g.debugScreenOpened=!1,g.debugUpdatedRewardsData=!1,rt(g,"loadingRing",xZ,Ke(g)),rt(g,"claimButton",x$,Ke(g)),rt(g,"claimX2Button",x0,Ke(g)),rt(g,"dailyBlocks",x1,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(){var E=Be(function(E){return _ts_generator(this,function(_){g.validateEventPayload(E)&&g.open();return[2]})});return function(g){return E.apply(this,arguments)}}(),g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,nC.decorateComponent(this),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"listenScreenEvents",value:function(){Go.on(x7.OPENING_SCREEN,this.handleOpeningScreen),Go.on(x7.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Go.off(x7.OPENING_SCREEN,this.handleOpeningScreen),Go.off(x7.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.prepareScreen(),this.openAsync()}},{key:"openAsync",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.updateRewardsData()];case 1:g.sent();return[4,this.updateScreenToMatchData()];case 2:g.sent();return[2]}})}),function(){return A.apply(this,arguments)})},{key:"updateScreenToMatchData",value:function(){return this.loginDailyRewards(),this.updateDayBlocks(),this.loadingRing.active=!1,this.setInteractableButtons(!0),this.runPopUpAnimation()}},{key:"prepareScreen",value:function(){this.debugScreenOpened=!0,this.loadingRing.active=!0,this.setInteractableButtons(!1),this.node.scene.emit(a2.HIDE_UI),this.resetState()}},{key:"close",value:function(){Go.emit(x7.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(a2.SHOW_UI)}},{key:"resetState",value:function(){var g,E=at(this.dailyBlocks);try{for(E.s();!(g=E.n()).done;){var _=g.value;_.uiOpacity.opacity=0,_.node.scale=new em(1.2,1.2,1.2)}}catch(g){E.e(g)}finally{E.f()}}},{key:"runPopUpAnimation",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;this.screen.container||console.warn("DailyRewardScreen: screen not found");return[4,Promise.all(this.dailyBlocks.map(function(E,_){return g.runAppearTween(E,.15*_)}))];case 1:E.sent();return[2]}})}),function(){return C.apply(this,arguments)})},{key:"runAppearTween",value:(k=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=x(g.uiOpacity).delay(E).to(.3,{opacity:255},{easing:"quadOut"}),k=x(g.node).delay(E).to(.3,{scale:em.ONE},{easing:"backOut"});return[4,Promise.all([tZ.runTweenAsync(_),tZ.runTweenAsync(k)])];case 1:C.sent();return[2]}})}),function(g,E){return k.apply(this,arguments)})},{key:"handleOnClaim",value:function(){this.setInteractableButtons(!1);var g=this.getCurrentRewardData();if(!g)return null==Gu||Gu.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),l5.showNotificationScreen("Unable to validate rewards. Please try again later...",2),void this.setInteractableButtons(!0);this.claimReward(g)}},{key:"handleOnClaimX2",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.setInteractableButtons(!1);g=this.getCurrentRewardData();if(!g)return[2,(null==Gu||Gu.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),l5.showNotificationScreen("Unable to validate rewards. Please try again later...",2),void this.setInteractableButtons(!0))];return[4,mB.showRewardVideoAdAsync({})];case 1:E.sent()?this.claimReward(g,!0):this.setInteractableButtons(!0);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return Gi.search(this.rewardsData,function(g){return"ready"===g.status})}},{key:"claimReward",value:function(g,E){var _=arguments.length>1&&void 0!==E&&E,k=g.value*(_?2:1),C=new nD;if(this.node.scene.emit(a2.ADD_COINS,{coins:k,collectionAnimation:{animateTextOnly:!1,signal:C}}),g.items){var A=g.items.hint*(_?2:1),T=g.items.thunder*(_?2:1),R=g.items.storm*(_?2:1),I=Gl.getGameData();I?(Gl.setGameData({items:{hint:I.items.hint+A,thunder:I.items.thunder+T,storm:I.items.storm+R,pliers:I.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Gs.requestDailyRewardsAsync()];case 1:_.sent();for(g=De({},Gs.getDailyRewards()),E=0;E<Ga.MaxDays;E++)g[E]=De(De({},g[E]),{},{value:sG[E].value,items:sG[E].items});g&&(this.rewardsData=Gn.vals(g),this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData));return[2]}})}),function(){return E.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){Gs.logLoginReward()}},{key:"updateDayBlocks",value:function(){var g=this;this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),null==Gu||Gu.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach(function(E,_){if(!(_>=g.rewardsData.length)){var k=g.rewardsData[_],C=k.id,A=k.type,T=k.value,R=k.status;E.updateInfo({day:C,type:A,value:T,status:R})}})}},{key:"setInteractableButtons",value:function(g){this.claimButton.interactable=g,this.claimX2Button.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),s}(D)).prototype,"screen",[xM,xF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xZ=st(xJ.prototype,"loadingRing",[xU,xz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x$=st(xJ.prototype,"claimButton",[xx,xG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x0=st(xJ.prototype,"claimX2Button",[xV,xK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x1=st(xJ.prototype,"dailyBlocks",[xH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),st(xJ.prototype,"updateScreenToMatchData",[xq],Object.getOwnPropertyDescriptor(xJ.prototype,"updateScreenToMatchData"),xJ.prototype),st(xJ.prototype,"claimReward",[xW],Object.getOwnPropertyDescriptor(xJ.prototype,"claimReward"),xJ.prototype),st(xJ.prototype,"updateRewardsData",[xj],Object.getOwnPropertyDescriptor(xJ.prototype,"updateRewardsData"),xJ.prototype),st(xJ.prototype,"setInteractableButtons",[xX],Object.getOwnPropertyDescriptor(xJ.prototype,"setInteractableButtons"),xJ.prototype),xY=xJ))||xY);_._RF.pop(),_._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var Gc,Gp,Gf,Gy,Gv,Gg,Gm,Gb,Gw,GS;(0,k.ccclass)("DayBlockRed")(function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n,[{key:"updateBackground",value:function(g){if(this.blueTopBackground&&this.blueBackground)switch(g.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(g){this.dayLabel.string="Day ".concat(g.day.toString());var E=this.defaultDayLabelOutlineColor;"ready"===g.status&&(E=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=E,this.dayLabel.outlineColor=E}}]),n}(x3));_._RF.pop(),_._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var GE,G_,Gk,GC,GA,GT,GR,GI=k.ccclass,GL=k.property,GP=k.requireComponent,GO=globalThis.game.event,GB=GameCore.Events;Gc=GI("GetCoinScreen"),Gp=GP(zK),Gf=GL(L),Gy=GL(B),Gv=GL(B),Gc(Gg=Gp((Gb=st((Gm=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"quantityLabel",Gb,Ke(g)),rt(g,"closeButtonComponent",Gw,Ke(g)),rt(g,"getNowButtonComponent",GS,Ke(g)),g.handleOpeningScreen=function(E){console.log("GetCoinScreen.OPENING_SCREEN",E),g.validateEventPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){GO.on(GB.OPENING_SCREEN,this.handleOpeningScreen),GO.on(GB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){GO.off(GB.OPENING_SCREEN,this.handleOpeningScreen),GO.off(GB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return"screenName"in g&&g.screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(a2.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),GO.emit(GB.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(a2.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var g=this.getQuantity();g&&this.updateQuantityLabel(g)}},{key:"updateQuantityLabel",value:function(g){this.quantityLabel.string="x".concat(g.toString())}},{key:"getQuantity",value:function(){var g=this.payload.screenData;return g&&"quantity"in g&&g.quantity&&"number"==typeof g.quantity?g.quantity:0}},{key:"handleAddCoin",value:function(){var g=this.getQuantity();this.node.scene.emit(a2.ADD_COINS,{coins:g,collectionAnimation:{animateTextOnly:!1},skipAnimation:!0}),this.close()}},{key:"handleGetNowButtonClicked",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:i8.stopAllSounds();return[4,mB.showRewardVideoAdAsync({})];case 1:g.sent()&&this.handleAddCoin();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.getNowButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),i}(D)).prototype,"quantityLabel",[Gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gw=st(Gm.prototype,"closeButtonComponent",[Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GS=st(Gm.prototype,"getNowButtonComponent",[Gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gg=Gm))||Gg);_._RF.pop(),_._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var GN,GD,GM,GF,GU,Gz,Gx,GG,GV,GK,GH,Gq,GW,Gj,GX,GY,GJ,GQ,GZ,G$,G0,G1,G2,G4,G3=k.ccclass,G5=k.property,G6=(GE=G3("ItemCollectionFX"),G_=G5(eo),Gk=G5(yc),GE((GT=st((GA=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"sprite",GT,Ke(g)),rt(g,"particles",GR,Ke(g)),g}return Ue(n,[{key:"__preload",value:function(){nC.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}}}]),n}(D)).prototype,"sprite",[G_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GR=st(GA.prototype,"particles",[Gk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GC=GA))||GC);_._RF.pop(),_._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var G8,G9,G7,Vt,Vn,Vi,Va,Vr,Vo=k.ccclass,Vs=k.property,Vl=globalThis.game,Vu=Vl.event,Vc=Vl.player,Vp=Vl.analytics,Vf=GameCore,Vy=Vf.Events,Vv=Vf.Utils,Vg=Vv.Object,Vm=Vv.Array,Vb=Vf.Plugins.Analytics.Events;GN=Vo("GetItemScreen"),GD=Vs(ee),GM=Vs(eo),GF=Vs(eo),GU=Vs(eo),Gz=Vs(eo),Gx=Vs(L),GG=Vs(L),GV=Vs(L),GK=Vs(B),GH=Vs(B),Gq=Vs(B),GN((Gj=st((GW=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"itemFxPrefab",Gj,Ke(g)),rt(g,"hintSprite",GX,Ke(g)),rt(g,"stormSprite",GY,Ke(g)),rt(g,"pliersSprite",GJ,Ke(g)),rt(g,"thunderSprite",GQ,Ke(g)),rt(g,"titleLabel",GZ,Ke(g)),rt(g,"descriptionLabel",G$,Ke(g)),rt(g,"coinLabel",G0,Ke(g)),rt(g,"closeButtonComponent",G1,Ke(g)),rt(g,"buyItemButtonComponent",G2,Ke(g)),rt(g,"getNowButtonComponent",G4,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("GetItemScreen: screen not found");if(g.validateEventPayload(E)){g.setInteractableButtons(!0);var _=g.getItemType();_&&g.updateStatus(_)}},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Vu.on(Vy.OPENING_SCREEN,this.handleOpeningScreen),Vu.on(Vy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Vu.off(Vy.OPENING_SCREEN,this.handleOpeningScreen),Vu.off(Vy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.node.scene.emit(a2.GAME_PAUSE)}},{key:"close",value:function(){this.setInteractableButtons(!1),Vu.emit(Vy.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(a2.GAME_RESUME)}},{key:"updateStatus",value:function(g){this.updateItemIcon(g),this.updateTitle(g),this.updateDescription(),this.updateButtons(g)}},{key:"updateItemIcon",value:function(g){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach(function(g){g.node.active=!1}),g){case sN.HINT:this.activeIcon=this.hintSprite;break;case sN.STORM:this.activeIcon=this.stormSprite;break;case sN.THUNDER:this.activeIcon=this.thunderSprite;break;case sN.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}},{key:"updateTitle",value:function(g){var E=g.charAt(0).toUpperCase()+g.slice(1);this.titleLabel.string=E}},{key:"updateDescription",value:function(){var g,E=null===(g=this.payload.screenData)||void 0===g?void 0:g.message;E&&(this.descriptionLabel.string=E)}},{key:"updateButtons",value:function(g){var E=this.canBuyItem(g);this.buyItemButtonComponent.node.active=E,this.getNowButtonComponent.node.active=!E,E&&(this.coinLabel.string="".concat(3*sU[g]))}},{key:"canBuyItem",value:function(g){var E=Vc.getGameData();return!!E&&E.coins>=3*sU[g]}},{key:"getItemType",value:function(){var g=this.payload.screenData;return g&&g.item&&Vm.has(Vg.vals(sN),g.item)?g.item:null}},{key:"handleAddItem",value:(A=Be(function(){var g,E;return _ts_generator(this,function(_){g=this,E=this.getItemType();E&&(Vp.event(Vb.EARN_ITEM,{item_name:E,value:3}),this.node.scene.emit(a2.ADD_ITEM,{animate:function(){return g.animateAddItem(E)},item:E,quantity:3}));return[2]})}),function(){return A.apply(this,arguments)})},{key:"animateAddItem",value:(C=Be(function(g){var E,_,k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:E=this.activeIcon.spriteFrame,_=et(this.createItemCollectionNode(E),2),k=_[0],C=_[1],A=this.getItemButtonWorldPosition(g),T=new em(.5,.5,.5);return[4,this.playScaleUpItemAnim(k,C)];case 1:R.sent();return[4,tZ.waitTweenAsync(.8)];case 2:R.sent();return[4,this.playMoveCloseToItemButtonAnim(k,A,T)];case 3:R.sent();return[4,this.playJumpAnim(k,T,A)];case 4:R.sent(),i8.playSound("sounds/clicks"),k.destroy();return[2]}})}),function(g){return C.apply(this,arguments)})},{key:"playJumpAnim",value:(k=Be(function(g,E,_){var k,C;return _ts_generator(this,function(A){switch(A.label){case 0:k=_.clone().add3f(0,70,0),C=E.clone().multiplyScalar(1.3);return[4,Promise.all([tZ.runTweenAsync(x(g).to(.3,{worldPosition:k},{easing:"cubicOut"})),tZ.runTweenAsync(x(g).to(.3,{scale:C},{easing:"cubicOut"}))])];case 1:A.sent();return[4,tZ.runTweenAsync(x(g).to(.5,{worldPosition:_},{easing:"cubicIn"}))];case 2:A.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"playMoveCloseToItemButtonAnim",value:function(g,E,_){var k=E.clone().add3f(0,30,0);return tZ.runTweenAsync(x(g).to(1,{worldPosition:k,scale:_},{easing:"cubicInOut"}))}},{key:"createItemCollectionNode",value:function(g){var E=I(this.itemFxPrefab),_=E.getComponent(G6);return E.setParent(this.node.parent),_.sprite.spriteFrame=g,E.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[E,_]}},{key:"playScaleUpItemAnim",value:function(g,E){return g.setScale(em.ZERO),tZ.runTweenAsync(x(g).delay(.2).call(function(){E.playExplosionParticles(),i8.playSound("sounds/item_reward")}).to(.1,{scale:new em(.8,1.2,1)}).to(.1,{scale:new em(1.2,.8,1)}).to(.1,{scale:new em(1,1,1)}))}},{key:"getItemButtonWorldPosition",value:function(g){return this.getItemButton(g).worldPosition.clone()}},{key:"handleGetNowButtonClicked",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:this.stopAllSounds();return[4,mB.showRewardVideoAdAsync({})];case 1:g.sent()&&(this.handleAddItem(),this.close());return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(E=Be(function(){return _ts_generator(this,function(g){this.node.scene.emit(a2.REMOVE_COINS,{coins:3*sU[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close();return[2]})}),function(){return E.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var g;null===(g=$("Sound"))||void 0===g||null===(g=g.getComponent(tP))||void 0===g||g.stopAll()}},{key:"getItemButton",value:function(g){switch(g){case sN.HINT:return $("Canvas/UI/Footer/HintItemButton");case sN.STORM:return $("Canvas/UI/Footer/StormItemButton");case sN.THUNDER:return $("Canvas/UI/Footer/ThunderItemButton");case sN.PLIERS:return $("Canvas/UI/Footer/PliersItemButton")}}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.buyItemButtonComponent.interactable=g,this.getNowButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),s}(D)).prototype,"itemFxPrefab",[GD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GX=st(GW.prototype,"hintSprite",[GM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GY=st(GW.prototype,"stormSprite",[GF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GJ=st(GW.prototype,"pliersSprite",[GU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GQ=st(GW.prototype,"thunderSprite",[Gz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GZ=st(GW.prototype,"titleLabel",[Gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G$=st(GW.prototype,"descriptionLabel",[GG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G0=st(GW.prototype,"coinLabel",[GV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G1=st(GW.prototype,"closeButtonComponent",[GK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G2=st(GW.prototype,"buyItemButtonComponent",[GH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G4=st(GW.prototype,"getNowButtonComponent",[Gq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GW));_._RF.pop(),_._RF.push({},"4d6710xA7hAk65cGA4Dgdrc","GetRewardsScreen",void 0);var Vw,VS=k.ccclass,VE=k.requireComponent,V_=k.property,Vk=GameCore.Events,VC=globalThis.game.event;G8=VS("GetRewardsScreen"),G9=VE(zK),G7=V_(L),Vt=V_(B),G8(Vn=G9((Va=st((Vi=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"adStartingLabel",Va,Ke(g)),rt(g,"skipButton",Vr,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){VC.on(Vk.OPENING_SCREEN,this.handleOpeningScreen),VC.on(Vk.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){VC.off(Vk.OPENING_SCREEN,this.handleOpeningScreen),VC.off(Vk.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.runAdStartingAnimation()}},{key:"close",value:function(g){this.setInteractableButtons(!1),VC.emit(Vk.CLOSE_SCREEN,{screenName:this.node.name,screenData:{getRewardsSuccess:g}})}},{key:"runAdStartingAnimation",value:function(){var g=this,E=5;this.adStartingLabel.string="AD starting in ".concat(E,"...");this.schedule(function(){E<=0?g.stopAdStartingAnimation():(E--,g.adStartingLabel.string="AD starting in ".concat(E,"..."))},1,6)}},{key:"stopAdStartingAnimation",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:this.unscheduleAllCallbacks();return[4,mB.showRewardedInterstitialAdAsync({})];case 1:g=E.sent();this.close(g);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleClickedSkip",value:function(){this.unscheduleAllCallbacks(),this.close(!1)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.skipButton.interactable=g}}]),i}(D)).prototype,"adStartingLabel",[G7],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vr=st(Vi.prototype,"skipButton",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vn=Vi))||Vn);_._RF.pop(),_._RF.push({},"bfe1eXch0ZMKIz1ofLKc2Iv","HardLevelScreen",void 0);var VA,VT,VR,VI,VL,VP,VO,VB,VN,VD,VM,VF,VU,Vz=k.ccclass,Vx=k.requireComponent,VG=GameCore.Events,VV=globalThis.game.event;Vz("HardLevelScreen")(Vw=Vx(zK)(Vw=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleOpeningScreen=function(E){g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){VV.on(VG.OPENING_SCREEN,this.handleOpeningScreen),VV.on(VG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){VV.off(VG.OPENING_SCREEN,this.handleOpeningScreen),VV.off(VG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation()}},{key:"close",value:function(){l5.closeScreen(iS[this.node.name])}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}}]),n}(D))||Vw);_._RF.pop(),_._RF.push({},"2db0dg4dI9GCKCdFOMrBFsQ","GetRewardsEffect",void 0);var VK,VH,Vq,VW,Vj,VX,VY,VJ,VQ,VZ,V$,V0,V1,V2,V4,V3,V5,V6,V8,V9,V7,Kt,Kn,Ki,Ka,Kr,Ko,Ks,Kl,Ku,Kc,Kp,Kd,Kf,Ky,Kv,Kg=k.ccclass,Km=k.property,Kb=(VA=Kg("GetRewardsEffect"),VT=Km(er),VR=Km(er),VI=Km(er),VL=Km(er),VP=Km(yc),VA((VN=st((VB=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"hint",VN,Ke(g)),rt(g,"thunder",VD,Ke(g)),rt(g,"storm",VM,Ke(g)),rt(g,"pliers",VF,Ke(g)),rt(g,"particles",VU,Ke(g)),g}return Ue(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"playAnimation",value:(E=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this,k=-30*(g.length-1)/2+90;return[4,Promise.all(g.map(function(g,C){var A=_.createSprite(g),T=k+30*C,R=.15*C;A.node.position=new em(300*Math.cos(Math.PI/180*T),300*Math.sin(Math.PI/180*T),0);var I=x(A.node);return I.delay(R),I.to(.6,{position:em.ZERO,scale:new em(.7,.7,.7)},{easing:"backIn"}),tZ.runTweenAsync(I).then(function(){E(),i8.playSound(ih.COLLECT_STARS),_.playExplodeEffect(),A.node.destroy()})}))];case 1:C.sent();return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"playExplodeEffect",value:function(){var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;){var _=g.value;_.stop(),_.play()}}catch(g){E.e(g)}finally{E.f()}}},{key:"createSprite",value:function(g){var E=this.getSpriteFrame(g),_=(new C).addComponent(eo);return _.spriteFrame=E,_.node.parent=this.node,_.node.scale=new em(1.5,1.5,1.5),_}},{key:"getSpriteFrame",value:function(g){switch(g){case"hint":return this.hint;case"thunder":return this.thunder;case"storm":return this.storm;case"pliers":return this.pliers;default:return null}}}]),i}(D)).prototype,"hint",[VT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VD=st(VB.prototype,"thunder",[VR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VM=st(VB.prototype,"storm",[VI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VF=st(VB.prototype,"pliers",[VL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VU=st(VB.prototype,"particles",[VP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),VO=VB))||VO);_._RF.pop(),_._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var Kw,KS=k.ccclass,KE=k.property,K_=k.requireComponent,Kk=GameCore,KC=Kk.Events,KA=Kk.Utils.Valid,KT=globalThis.game,KR=KT.event,KI=KT.player,KL="Coin Container";VK=KS("LevelCompleteScreen"),VH=K_(zK),Vq=KE(L),VW=KE(L),Vj=KE(eu),VX=KE(Kb),VY=KE({type:L,group:"Play Button"}),VJ=KE({type:B,group:"Play Button"}),VQ=KE({type:C,group:"Play Button"}),VZ=KE({type:eu,group:"Play Button"}),V$=KE({type:C,group:"Play Button"}),V0=KE({type:C,group:"Play Button"}),V1=KE({type:G,group:KL}),V2=KE({type:Cn,group:KL}),V4=KE({type:G,group:KL}),V3=KE({type:ei,group:KL}),V5=KE({type:ei,group:KL}),V6=KE(yc),VK(V8=VH((V7=st((V9=function(g){ze(c,g);var E,_,k,C,A,T,R,I,L=Xe(c);function c(){var g;Fe(this,c);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return(g=L.call.apply(L,[this].concat(_))).level=1,g.coins=40,g.currentCoins=0,g.score=0,g.playAnimation=!1,g.getRewardsSuccess=!1,g.lookingForRewards=!1,g.playButtonSignal=new nD,rt(g,"coinText",V7,Ke(g)),rt(g,"scoreText",Kt,Ke(g)),rt(g,"lookingForRewardsText",Kn,Ke(g)),rt(g,"getRewardsEffect",Ki,Ke(g)),rt(g,"playButtonLabel",Ka,Ke(g)),rt(g,"playButton",Kr,Ke(g)),rt(g,"playBackground",Ko,Ke(g)),rt(g,"shineBackground",Ks,Ke(g)),rt(g,"hardLevelBackground",Kl,Ke(g)),rt(g,"playButtonContainer",Ku,Ke(g)),rt(g,"coinAnimation",Kc,Ke(g)),rt(g,"coinContainer",Kp,Ke(g)),rt(g,"coinContainerAnimation",Kd,Ke(g)),rt(g,"coinContainerEnterClip",Kf,Ke(g)),rt(g,"coinContainerExitClip",Ky,Ke(g)),rt(g,"particles",Kv,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StarChestScreen: screen not found");g.validateEventPayload(E)&&(g.playButton.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g.handleParticleEnd=Be(function(){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=g.level;if(!E)return[3,2];return[4,tZ.waitTweenAsync(.15)];case 1:E=_.sent();_.label=2;case 2:return[4,Promise.all([g.animateCoin(),g.animateScore()])];case 3:_.sent();if(!g.lookingForRewards)return[3,5];return[4,g.handleLookingForRewards()];case 4:_.sent();return[3,7];case 5:return[4,g.animateVisiblePlayButton(!0)];case 6:_.sent();_.label=7;case 7:return[2]}})}),g}return Ue(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){KR.on(KC.OPENING_SCREEN,this.handleOpeningScreen),KR.on(KC.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){KR.off(KC.OPENING_SCREEN,this.handleOpeningScreen),KR.off(KC.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){var E=null!=g?g:{},_=E.screenName,k=E.screenData;return _===this.node.name&&!!KA.isObject(k)&&(KA.isNumber(k.level)&&(this.level=k.level,this.coins=this.level<5?sD:sM),KA.isNumber(k.coins)&&(this.currentCoins=k.coins),KA.isNumber(k.score)&&(this.score=k.score),this.playAnimation=!1,KA.isObject(k.overrideAnimation)&&(this.playAnimation="LevelCompleteOpenScreen"===k.overrideAnimation.openScreen),this.lookingForRewards=!1,KA.isBoolean(k.lookingForRewards)&&(this.lookingForRewards=k.lookingForRewards),this.getRewardsSuccess=!1,KA.isBoolean(k.getRewardsSuccess)&&(this.getRewardsSuccess=k.getRewardsSuccess),!0)}},{key:"open",value:function(){this.updateStatus(),this.node.scene.emit(a2.HIDE_UI),this.tryPlayAnimation()}},{key:"close",value:(I=Be(function(){var g,E,_,k;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:E=C.length>0&&void 0!==C[0]&&C[0],_=at(this.particles);try{for(_.s();!(g=_.n()).done;){k=g.value;k.stop()}}catch(g){_.e(g)}finally{_.f()}return[4,tZ.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name)];case 1:A.sent(),KR.emit(KC.CLOSE_SCREEN,{screenName:this.node.name,screenData:{canShowRewardsAd:E}}),this.node.scene.emit(a2.ABORT_COIN_ANIMATION);return[2]}})}),function(){return I.apply(this,arguments)})},{key:"updateStatus",value:function(){this.updateCoinContainer(),this.updatePlayButton(),this.lookingForRewardsText.opacity=0}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoins})}},{key:"updatePlayButton",value:function(){var g=KI.getGameData();if(g){var E=(this.level+1>g.totalLevel?this.level:this.level+1)%5==0;this.playBackground.active=!E,this.hardLevelBackground.active=E}}},{key:"tryPlayAnimation",value:function(){if(this.playAnimation){this.screen.setScreenOpacity(255),this.coinText.string="x0",this.scoreText.string="0",this.animateVisiblePlayButton(!1,!1);var g,E=at(this.particles);try{for(E.s();!(g=E.n()).done;)g.value.play()}catch(g){E.e(g)}finally{E.f()}var _=this.screen.getComponent(G);_?_.once(G.EventType.FINISHED,this.handleParticleEnd):this.handleParticleEnd()}else{if(this.animateVisiblePlayButton(!0,!1),!this.getRewardsSuccess)return;this.getRewardsEffect.playAnimation(["storm","thunder"],this.animateCollectItemPlayButton.bind(this))}}},{key:"handleLookingForRewards",value:(R=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,this.animateLookingForRewards()];case 1:g.sent(),mB.canShowRewardedInterstitialAd()?this.close(!0):this.animateVisiblePlayButton(!0);return[2]}})}),function(){return R.apply(this,arguments)})},{key:"animateCoin",value:(T=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;if(!this.screen.container)return[3,3];this.coinAnimation.play();return[4,tZ.runOnUpdateAsync(this.node,.8,function(E){var _=eO(0,g.coins,E),k=Math.floor(_);g.coinText.string="x".concat(k)})];case 1:E.sent();return[4,this.animateCoinCollection()];case 2:E.sent(),this.coinText.string="x".concat(this.coins);return[3,4];case 3:console.warn("LevelCompleteScreen: screen not found");E.label=4;case 4:return[2]}})}),function(){return T.apply(this,arguments)})},{key:"animateScore",value:(A=Be(function(){var g;return _ts_generator(this,function(E){g=this;tZ.runOnUpdateAsync(this.scoreText.node,.8,function(E){var _=eO(0,g.score,E);g.scoreText.string="".concat(Math.floor(_))}),this.scoreText.node.setScale(1,1,1),this.scoreText.string="".concat(this.score);return[2]})}),function(){return A.apply(this,arguments)})},{key:"animateCoinCollection",value:(C=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,tZ.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name)];case 1:g.sent(),this.node.scene.emit(a2.ADD_COINS,{coins:this.coins,collectionAnimation:{floatDuration:.5,flyDuration:.5,animateTextOnly:!1,target:this.coinContainer}});return[2]}})}),function(){return C.apply(this,arguments)})},{key:"animateLookingForRewards",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=x(this.lookingForRewardsText);g.to(.25,{opacity:255},{easing:"linear"}).delay(.25),g.to(.25,{opacity:100},{easing:"linear"}).delay(.125);return[4,tZ.runTweenAsync(x(this.lookingForRewardsText).repeat(2,g).to(.25,{opacity:0},{easing:"linear"}))];case 1:E.sent(),this.lookingForRewardsText.opacity=0;return[2]}})}),function(){return k.apply(this,arguments)})},{key:"animateVisiblePlayButton",value:(_=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){switch(R.label){case 0:E=!(T.length>1&&void 0!==T[1])||T[1],_=g?1:0;if(!E)return[3,2];this.playButtonSignal.abort();k=new nD;this.playButtonSignal=k;C=g?0:1;this.playButtonContainer.setScale(C,C,this.playButtonContainer.scale.z);A=x(this.playButtonContainer).to(.5,{scale:new em(_,_,1)},{easing:"backOut"});g||(this.playButton.interactable=!1);return[4,tZ.runTweenAsync(A,k)];case 1:R.sent(),g&&(this.playButton.interactable=!0);return[3,3];case 2:this.playButton.interactable=g,this.playButtonContainer.setScale(_,_,this.playButtonContainer.scale.z);R.label=3;case 3:return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"animateCollectItemPlayButton",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:this.playButtonSignal.abort();g=new nD;this.playButtonSignal=g;E=x(this.playButtonContainer).to(.08,{scale:new em(.95,1.05,1)}).to(.08,{scale:new em(1.05,.95,1)}).to(.08,{scale:new em(1,1,1)}),_=x(this.shineBackground).to(.08,{opacity:50},{easing:"quadOut"}).to(.08,{opacity:0},{easing:"quadIn"});return[4,Promise.all([tZ.runTweenAsync(E,g),tZ.runTweenAsync(_,g)])];case 1:k.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"handleClickedPlay",value:function(){this.playButton.interactable=!1,this.close()}}]),c}(D)).prototype,"coinText",[Vq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kt=st(V9.prototype,"scoreText",[VW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kn=st(V9.prototype,"lookingForRewardsText",[Vj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ki=st(V9.prototype,"getRewardsEffect",[VX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ka=st(V9.prototype,"playButtonLabel",[VY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kr=st(V9.prototype,"playButton",[VJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ko=st(V9.prototype,"playBackground",[VQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ks=st(V9.prototype,"shineBackground",[VZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kl=st(V9.prototype,"hardLevelBackground",[V$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=st(V9.prototype,"playButtonContainer",[V0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kc=st(V9.prototype,"coinAnimation",[V1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kp=st(V9.prototype,"coinContainer",[V2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kd=st(V9.prototype,"coinContainerAnimation",[V4],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kf=st(V9.prototype,"coinContainerEnterClip",[V3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ky=st(V9.prototype,"coinContainerExitClip",[V5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kv=st(V9.prototype,"particles",[V6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),V8=V9))||V8);_._RF.pop(),_._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var KP,KO,KB,KN,KD,KM,KF,KU,Kz=k.ccclass,Kx=k.disallowMultiple,KG=k.requireComponent,KV=GameCore.Events,KK=globalThis.game.event;Kz("LoadingScreen")(Kw=Kx(Kw=KG(zK)(Kw=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return(g=E.call.apply(E,[this].concat(k))).handleOpeningScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g.handleClosingScreen=function(E){g.validateEventPayload(E)&&g.unscheduleAllCallbacks()},g.handleClosedScreen=function(E){g.validateEventPayload(E)&&(g.enabled=!1)},g.handleOnCloseScreen=function(){l5.closeScreen(iS[g.node.name])},g}return Ue(n,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){KK.on(KV.OPENING_SCREEN,this.handleOpeningScreen),KK.on(KV.OPENED_SCREEN,this.handleOpenedScreen),KK.on(KV.CLOSING_SCREEN,this.handleClosingScreen),KK.on(KV.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){KK.off(KV.OPENING_SCREEN,this.handleOpeningScreen),KK.off(KV.OPENED_SCREEN,this.handleOpenedScreen),KK.off(KV.CLOSING_SCREEN,this.handleClosingScreen),KK.off(KV.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var g=this.screen.data.duration;g&&g>0&&this.scheduleOnce(this.handleOnCloseScreen,g)}}}]),n}(D))||Kw)||Kw);_._RF.pop(),_._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var KH,Kq,KW,Kj,KX,KY,KJ,KQ,KZ,K$,K0,K1,K2,K4,K3,K5,K6=k.ccclass,K8=k.disallowMultiple,K9=k.requireComponent,K7=k.property,Ht=GameCore,Hn=Ht.Events,Hi=Ht.Utils.Valid,Ha=globalThis.game.event;KP=K6("NotificationScreen"),KO=K9(zK),KB=K7(L),KN=K7(B),KP(KD=K8(KD=KO((KF=st((KM=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"message",KF,Ke(g)),rt(g,"touchZone",KU,Ke(g)),g.enableCloseOnTouch=!0,g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.updateScreenData(E)},g.handleClosingScreen=function(E){g.validateEventPayload(E)&&g.unscheduleAllCallbacks()},g}return Ue(n,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Ha.on(Hn.OPENING_SCREEN,this.handleOpeningScreen),Ha.on(Hn.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){Ha.off(Hn.OPENING_SCREEN,this.handleOpeningScreen),Ha.off(Hn.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name}},{key:"updateScreenData",value:function(g){var E=this,_=g.screenData;Hi.isObject(_)?(_.message&&(this.message.string=_.message),_.duration&&_.duration>0&&this.scheduleOnce(function(){l5.closeScreen(iS[E.node.name])},_.duration),!1===_.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),l5.closeScreen(iS[this.node.name])}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),n}(D)).prototype,"message",[KB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KU=st(KM.prototype,"touchZone",[KN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KD=KM))||KD)||KD);_._RF.pop(),_._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var Hr,Ho,Hs,Hl,Hu,Hc,Hh,Hp,Hf,Hy,Hv,Hg,Hm,Hb,Hw,HS,HE,H_,Hk,HC,HA,HT,HR=k.ccclass,HI=k.property,HL=k.requireComponent,HP=GameCore,HO=HP.Events,HB=HP.Match.Modes,HN=globalThis.game,HD=HN.event,HM=HN.storage;KH=HR("QuitLevelScreen"),Kq=HL(zK),KW=HI(L),Kj=HI(L),KX=HI(B),KY=HI(L),KJ=HI(L),KQ=HI(B),KH(KZ=Kq((K0=st((K$=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"singleDescription",K0,Ke(g)),rt(g,"tournamentDescription",K1,Ke(g)),rt(g,"quitButton",K2,Ke(g)),rt(g,"quitLabel",K4,Ke(g)),rt(g,"endLabel",K3,Ke(g)),rt(g,"continueButton",K5,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){HD.on(HO.OPENING_SCREEN,this.handleOpeningScreen),HD.on(HO.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){HD.off(HO.OPENING_SCREEN,this.handleOpeningScreen),HD.off(HO.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(a2.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),l5.closeScreen(iS[this.node.name]),this.node.scene.emit(a2.SHOW_UI),this.node.scene.emit(a2.GAME_RESUME)}},{key:"updateStatus",value:function(){var g=lT.getMatchMode()===HB.TOURNAMENT;this.singleDescription.node.active=!g,this.tournamentDescription.node.active=g,this.quitLabel.node.active=!g,this.endLabel.node.active=g}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.quitButton.interactable=g,this.continueButton.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"handleClickedContinue",value:function(){this.close()}},{key:"handleClickedQuit",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(this.setInteractableButtons(!1),lT.getMatchMode()!==HB.TOURNAMENT)return[3,2];E=(null!==(g=lT.getMatchCustomData())&&void 0!==g?g:{}).score,_=(void 0===E?0:E)>HM.getStorageData("tournament","previousScore");HM.setStorageData("tournament","animateTournamentLeader",_);return[4,lT.finishMatchAsync()];case 1:k.sent();k.label=2;case 2:this.node.scene.emit(a2.GAME_EXIT);return[2]}})}),function(){return E.apply(this,arguments)})}]),i}(D)).prototype,"singleDescription",[KW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K1=st(K$.prototype,"tournamentDescription",[Kj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K2=st(K$.prototype,"quitButton",[KX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K4=st(K$.prototype,"quitLabel",[KY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K3=st(K$.prototype,"endLabel",[KJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K5=st(K$.prototype,"continueButton",[KQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KZ=K$))||KZ);_._RF.pop(),_._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var HF,HU,Hz,Hx,HG,HV,HK,HH,Hq,HW,Hj,HX,HY,HJ,HQ,HZ,H$,H0,H1,H2,H4,H3,H5,H6,H8,H9,H7=k.ccclass,qt=k.property,qn=k.disallowMultiple,qi=k.requireComponent,qa=GameCore.Events,qr=globalThis.game,qo=qr.event,qs=qr.player;Hr=H7("RescuesScreen"),Ho=qi(zK),Hs=qt(eu),Hl=qt([C]),Hu=qt(L),Hc=qt(L),Hh=qt(C),Hp=qt(C),Hf=qt(G),Hy=qt(C),Hv=qt(C),Hr(Hg=qn(Hg=Ho((Hb=st((Hm=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"adOpacity",Hb,Ke(g)),rt(g,"animNodes",Hw,Ke(g)),rt(g,"titleLabel",HS,Ke(g)),rt(g,"descriptionLabel",HE,Ke(g)),rt(g,"timer",H_,Ke(g)),rt(g,"bomb",Hk,Ke(g)),rt(g,"bombAnim",HC,Ke(g)),rt(g,"replayButton",HA,Ke(g)),rt(g,"buyTimeButton",HT,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("RescuesScreen: screen not found");g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){qo.on(qa.OPENING_SCREEN,this.handleOpeningScreen),qo.on(qa.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){qo.off(qa.OPENING_SCREEN,this.handleOpeningScreen),qo.off(qa.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return g.screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:(A=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:i8.turnOffMusic();return[4,this.resetState()];case 1:g.sent(),this.runOpenAnimation(),this.node.scene.emit(a2.HIDE_UI);return[2]}})}),function(){return A.apply(this,arguments)})},{key:"close",value:function(){i8.turnUpMusic(),qo.emit(qa.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(C=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){E=(null===(g=this.payload.screenData)||void 0===g?void 0:g.failKey)===ul;this.titleLabel.string=E?"Boom!":"Time's Up!",this.descriptionLabel.string=E?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!E,this.bomb.active=E,E&&this.bombAnim.play();_=qs.getGameData();if(_){k=_.coins>=sz;this.replayButton.active=!k,this.buyTimeButton.active=k,this.adOpacity.opacity=0}return[2]})}),function(){return C.apply(this,arguments)})},{key:"runOpenAnimation",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this;if(!this.screen.container)return[3,3];return[4,Promise.all(this.animNodes.map(function(E,_){g.runAppearTween(E,.1*_)}))];case 1:E.sent();return[4,this.runShowAdContainer()];case 2:E.sent();return[3,4];case 3:console.warn("TimeUpScreen: screen not found");E.label=4;case 4:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"runAppearTween",value:(_=Be(function(g,E){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,tZ.runTweenAsync(x(g).set({scale:new em(0,0,0)}).delay(E).to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*tZ.elasticOut(k,.1,.45)}}))];case 1:_.sent();return[2]}})}),function(g,E){return _.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var g=x(this.adOpacity);return g.delay(1),g.to(.5,{opacity:255}),tZ.runTweenAsync(g)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit(a2.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit(a2.REMOVE_COINS,{coins:sz,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:return[4,mB.showRewardVideoAdAsync({})];case 1:g.sent()&&this.startRescue();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit(a2.SHOW_UI),this.node.scene.emit(a2.RESCUE_START),this.close()}}]),s}(D)).prototype,"adOpacity",[Hs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hw=st(Hm.prototype,"animNodes",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HS=st(Hm.prototype,"titleLabel",[Hu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HE=st(Hm.prototype,"descriptionLabel",[Hc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H_=st(Hm.prototype,"timer",[Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hk=st(Hm.prototype,"bomb",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HC=st(Hm.prototype,"bombAnim",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HA=st(Hm.prototype,"replayButton",[Hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HT=st(Hm.prototype,"buyTimeButton",[Hv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hg=Hm))||Hg)||Hg);_._RF.pop(),_._RF.push({},"726c9oCUUBDpboDnHRz7SGZ","PauseScreen",void 0);var ql,qu,qc,qp,qf,qy,qv,qg,qm,qb,qw,qS,qE,q_,qk,qC,qA,qT,qR,qI,qL,qP,qO,qB,qN,qD,qM=k.ccclass,qF=k.property,qU=k.requireComponent,qz=GameCore,qx=qz.Events,qG=qz.Utils.Device,qV=qz.Match.Modes,qK=globalThis.game,qH=qK.player,qq=qK.event;HF=qM("PauseScreen"),HU=qU(zK),Hz=qF(C),Hx=qF(C),HG=qF(C),HV=qF(OL),HK=qF(OL),HH=qF(OL),Hq=qF(B),HW=qF(B),Hj=qF(B),HX=qF(B),HY=qF(C),HF(HJ=HU((HZ=st((HQ=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"musicSetting",HZ,Ke(g)),rt(g,"soundSetting",H$,Ke(g)),rt(g,"vibrateSetting",H0,Ke(g)),rt(g,"musicSwitch",H1,Ke(g)),rt(g,"soundSwitch",H2,Ke(g)),rt(g,"vibrateSwitch",H4,Ke(g)),rt(g,"closeButtonComponent",H3,Ke(g)),rt(g,"continueButtonComponent",H5,Ke(g)),rt(g,"restartButtonComponent",H6,Ke(g)),rt(g,"challengeFriendsButtonComponent",H8,Ke(g)),rt(g,"animNodes",H9,Ke(g)),g.triggerSequence="",g.handleOpeningScreen=function(E){g.validateSwitchScreenPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateSwitchScreenPayload(E)&&g.open()},g.handleResetSequence=function(){g.triggerSequence=""},g.handleTriggerUnlockKey=function(E){if("code"in E){var _=E.code,k=sH.UNLOCK_SEQUENCE;"number"==typeof _&&-1!==k.indexOf(_.toString())&&(g.triggerSequence+=_.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",_,g.triggerSequence,g.triggerSequence===k),g.triggerSequence===k&&(g.node.scene.emit(sH.Events.UNLOCK_DEV_TOOLS),g.node.off(sH.Events.TRIGGER_UNLOCK_KEY)))}},g.updateVibrateButton=function(){var E=g.vibrateSetting.getComponentInChildren(B),_=g.vibrateSetting.getComponentInChildren(OL),k=g.vibrateSetting.getComponentInChildren(ad);if(E&&_&&k){if(qG.isMobile()){var C,A=null!==(C=qH.getPlayerSetting("vibrate"))&&void 0!==C&&C;_.setEnabled(A)}else E.interactable=!1,_.setEnabled(!1),k.changeState(!1)}else console.warn("SettingsScreen: vibrate button missing components")},g}return Ue(a,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){qq.on(qx.OPENING_SCREEN,this.handleOpeningScreen),qq.on(qx.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){qq.off(qx.OPENING_SCREEN,this.handleOpeningScreen),qq.off(qx.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(g){return g.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(sH.Events.TRIGGER_UNLOCK_KEY),this.node.on(sH.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(sH.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(sH.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(sH.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(sH.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(a2.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(sH.Events.TRIGGER_RESET_SEQUENCE),l5.closeScreen(iS[this.node.name])}},{key:"updateStatus",value:function(){var g,E,_,k={music:null!==(g=qH.getPlayerSetting("music"))&&void 0!==g&&g,sound:null!==(E=qH.getPlayerSetting("sound"))&&void 0!==E&&E,vibrate:null!==(_=qH.getPlayerSetting("vibrate"))&&void 0!==_&&_};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(k.music),this.soundSwitch.setEnabled(k.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var g=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(E,_){g.runAppearTween(E,.1*_)})}},{key:"runAppearTween",value:function(g,E){var _=x(g);_.set({scale:new em(0,0,0)}),_.delay(E),_.to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*tZ.elasticOut(k,.1,.45)}}),_.start()}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.continueButtonComponent.interactable=g,this.restartButtonComponent.interactable=g,this.challengeFriendsButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var g=this.musicSwitch.switch();if(qH.setSetting("music",g),this.node.emit(sH.Events.TRIGGER_UNLOCK_KEY,{code:g?1:0}),g){var E=lT.getMatchMode();i8.playMusic(E===qV.TOURNAMENT?ih.TOURNAMENT_MUSIC:ih.BG_MUSIC)}else i8.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var g=this.soundSwitch.switch();qH.setSetting("sound",g),this.node.emit(sH.Events.TRIGGER_UNLOCK_KEY,{code:g?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var g=this.vibrateSwitch.switch();qH.setSetting("vibrate",g)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:(_=Be(function(){var g,E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:this.close();E=(null!==(g=qH.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;k=mB.canShowInterstitialAd();if(!k)return[3,2];return[4,mB.showInterstitialAdAsync({forLevel:_})];case 1:k=C.sent();C.label=2;case 2:lT.getMatchMode()!==qV.TOURNAMENT?(this.node.scene.emit(a2.GAME_RESUME),this.node.scene.emit(a2.GAME_REPLAY,{level:_})):l5.openScreen(ib.START_OVER_SCREEN);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleClickedChallengeFriends",value:(E=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if("MsGames"!==GameSDK.getSDKName())return[3,2];l5.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 1:return[2,(g.sent(),void l5.closeLoadingScreen())];case 2:this.close(),this.node.scene.emit(a2.INVITE_FRIENDS);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(a2.GAME_RESUME),this.node.scene.emit(a2.SHOW_UI)}}]),a}(D)).prototype,"musicSetting",[Hz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H$=st(HQ.prototype,"soundSetting",[Hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H0=st(HQ.prototype,"vibrateSetting",[HG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H1=st(HQ.prototype,"musicSwitch",[HV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H2=st(HQ.prototype,"soundSwitch",[HK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H4=st(HQ.prototype,"vibrateSwitch",[HH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H3=st(HQ.prototype,"closeButtonComponent",[Hq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H5=st(HQ.prototype,"continueButtonComponent",[HW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H6=st(HQ.prototype,"restartButtonComponent",[Hj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H8=st(HQ.prototype,"challengeFriendsButtonComponent",[HX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H9=st(HQ.prototype,"animNodes",[HY],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HJ=HQ))||HJ);_._RF.pop(),_._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var qW,qj,qX,qY,qJ,qQ,qZ,q$,q0,q1,q2,q4,q3,q5,q6,q8,q9,q7,Wt,Wn,Wi,Wa,Wr,Wo=k.ccclass,Ws=k.property,Wl=k.requireComponent,Wu=GameCore,Wc=Wu.Events,Wp=Wu.Utils.Device,Wf=Wu.Match.Modes,Wy=Wu.Configs.Debugger.MonitorError,Wg=globalThis.game,Wm=Wg.player,Wb=Wg.event,Ww=Wg.monitorError;ql=Wo("SettingsScreen"),qu=Wl(zK),qc=Ws(C),qp=Ws(C),qf=Ws(C),qy=Ws(OL),qv=Ws(OL),qg=Ws(OL),qm=Ws(B),qb=Ws(B),qw=Ws(B),qS=Ws(B),qE=Ws(C),ql(q_=qu((qC=st((qk=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"musicSetting",qC,Ke(g)),rt(g,"soundSetting",qA,Ke(g)),rt(g,"vibrateSetting",qT,Ke(g)),rt(g,"musicSwitch",qR,Ke(g)),rt(g,"soundSwitch",qI,Ke(g)),rt(g,"vibrateSwitch",qL,Ke(g)),rt(g,"closeButtonComponent",qP,Ke(g)),rt(g,"reportButtonComponent",qO,Ke(g)),rt(g,"shareButtonComponent",qB,Ke(g)),rt(g,"inviteFriendsButtonComponent",qN,Ke(g)),rt(g,"animNodes",qD,Ke(g)),g.triggerSequence="",g.handleOpeningScreen=function(E){g.validateSwitchScreenPayload(E)&&(g.setInteractableButtons(!0),g.updateStatus())},g.handleOpenedScreen=function(E){g.validateSwitchScreenPayload(E)&&g.open()},g.handleResetSequence=function(){g.triggerSequence=""},g.handleTriggerUnlockKey=function(E){if("code"in E){var _=E.code,k=sH.UNLOCK_SEQUENCE;"number"==typeof _&&-1!==k.indexOf(_.toString())&&(g.triggerSequence+=_.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",_,g.triggerSequence,g.triggerSequence===k),g.triggerSequence===k&&(g.node.scene.emit(sH.Events.UNLOCK_DEV_TOOLS),g.node.off(sH.Events.TRIGGER_UNLOCK_KEY)))}},g.updateVibrateButton=function(){var E=g.vibrateSetting.getComponentInChildren(B),_=g.vibrateSetting.getComponentInChildren(OL),k=g.vibrateSetting.getComponentInChildren(ad);if(E&&_&&k){if(Wp.isMobile()){var C,A=null!==(C=Wm.getPlayerSetting("vibrate"))&&void 0!==C&&C;_.setEnabled(A)}else E.interactable=!1,_.setEnabled(!1),k.changeState(!1)}else console.warn("SettingsScreen: vibrate button missing components")},g}return Ue(a,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools(),this.reportButtonComponent.node.parent.active=Wy.Feedback}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Wb.on(Wc.OPENING_SCREEN,this.handleOpeningScreen),Wb.on(Wc.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Wb.off(Wc.OPENING_SCREEN,this.handleOpeningScreen),Wb.off(Wc.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(g){return g.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(sH.Events.TRIGGER_UNLOCK_KEY),this.node.on(sH.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(sH.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(sH.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(sH.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(sH.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(a2.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(sH.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(a2.SHOW_UI),l5.closeScreen(iS[this.node.name])}},{key:"updateStatus",value:function(){var g,E,_,k={music:null!==(g=Wm.getPlayerSetting("music"))&&void 0!==g&&g,sound:null!==(E=Wm.getPlayerSetting("sound"))&&void 0!==E&&E,vibrate:null!==(_=Wm.getPlayerSetting("vibrate"))&&void 0!==_&&_};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(k.music),this.soundSwitch.setEnabled(k.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var g=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(function(E,_){("ReportButton"!==E.name||Wy.Feedback)&&g.runAppearTween(E,.1*_)})}},{key:"runAppearTween",value:function(g,E){var _=x(g);_.set({scale:new em(0,0,0)}),_.delay(E),_.to(1,{scale:new em(1,1,1)},{progress:function(g,E,_,k){return g+(E-g)*tZ.elasticOut(k,.1,.45)}}),_.start()}},{key:"setInteractableButtons",value:function(g){this.closeButtonComponent.interactable=g,this.reportButtonComponent.interactable=g,this.shareButtonComponent.interactable=g,this.inviteFriendsButtonComponent.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var g=this.musicSwitch.switch();if(Wm.setSetting("music",g),this.node.emit(sH.Events.TRIGGER_UNLOCK_KEY,{code:g?1:0}),g){var E=lT.getMatchMode();i8.playMusic(E===Wf.TOURNAMENT?ih.TOURNAMENT_MUSIC:ih.BG_MUSIC)}else i8.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var g=this.soundSwitch.switch();Wm.setSetting("sound",g),this.node.emit(sH.Events.TRIGGER_UNLOCK_KEY,{code:g?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var g=this.vibrateSwitch.switch();Wm.setSetting("vibrate",g)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedClose",value:function(){this.close()}},{key:"handleClickedReport",value:function(){null==Ww||Ww.feedbackAsync()}},{key:"handleClickedShare",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:if("FacebookInstant"!==GameSDK.getSDKName())return[3,2];l5.showLoadingScreen();return[4,GameSDK.extra.shareBestScoreAsync()];case 1:return[2,(g.sent(),void l5.closeLoadingScreen())];case 2:this.close();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"handleClickedInviteFriends",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=GameSDK.getSDKName();switch(g){case"MsGames":return[3,1];case"FacebookInstant":return[3,3]}return[3,5];case 1:l5.showLoadingScreen();return[4,GameSDK.extra.shareAsync()];case 2:E.sent(),l5.closeLoadingScreen();return[3,6];case 3:l5.showLoadingScreen();return[4,GameSDK.extra.inviteWithBestScoreAsync()];case 4:E.sent(),l5.closeLoadingScreen();return[3,6];case 5:this.close();E.label=6;case 6:return[2]}})}),function(){return E.apply(this,arguments)})}]),a}(D)).prototype,"musicSetting",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qA=st(qk.prototype,"soundSetting",[qp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qT=st(qk.prototype,"vibrateSetting",[qf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qR=st(qk.prototype,"musicSwitch",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qI=st(qk.prototype,"soundSwitch",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qL=st(qk.prototype,"vibrateSwitch",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qP=st(qk.prototype,"closeButtonComponent",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qO=st(qk.prototype,"reportButtonComponent",[qb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qB=st(qk.prototype,"shareButtonComponent",[qw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qN=st(qk.prototype,"inviteFriendsButtonComponent",[qS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qD=st(qk.prototype,"animNodes",[qE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),q_=qk))||q_);_._RF.pop(),_._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var WS,WE,W_,Wk,WC,WA,WT,WR,WI,WL,WP,WO,WB,WN,WD,WM,WF,WU,Wz,Wx,WG=k.ccclass,WV=k.property,WK=(qW=WG("StarChest"),qj=WV(eo),qX=WV(eu),qY=WV(eK),qJ=WV(eu),qQ=WV(eu),qZ=WV({type:K,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),q$=WV({type:K,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),q0=WV({type:K,displayName:"Centered Offset X",group:"Reward Animations"}),q1=WV({type:K,displayName:"Centered Offset Y",group:"Reward Animations"}),q2=WV({type:K,min:0,displayName:"Starting Scale",group:"Reward Animations"}),q4=WV({type:K,min:0,displayName:"Ending Scale",group:"Reward Animations"}),qW((q6=st((q5=function(g){ze(s,g);var E,_,k,C,A,T=Xe(s);function s(){var g;Fe(this,s);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=T.call.apply(T,[this].concat(_)),"sprite",q6,Ke(g)),rt(g,"glowOpacity",q8,Ke(g)),rt(g,"explosionParticles",q9,Ke(g)),rt(g,"circle",q7,Ke(g)),rt(g,"uiOpacity",Wt,Ke(g)),g.ogCenterX=0,g.ogCenterY=0,rt(g,"endingOffsetX",Wn,Ke(g)),rt(g,"endingOffsetY",Wi,Ke(g)),rt(g,"startingScale",Wa,Ke(g)),rt(g,"endingScale",Wr,Ke(g)),g}return Ue(s,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"moveToCenter",value:(A=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=new em(this.endingOffsetX,this.endingOffsetY,this.node.position.z);return[4,tZ.runTweenAsync(x(this.node).to(.7,{position:E},{easing:"quintInOut"}),g)];case 1:_.sent(),this.node.position=E;return[2]}})}),function(g){return A.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new em(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(C=Be(function(g,E){var _,k;return _ts_generator(this,function(C){switch(C.label){case 0:_=this.startingScale+(this.endingScale-this.startingScale)*g,k=new em(_,_,_);return[4,Promise.all([tZ.runTweenAsync(x(this.sprite.node).to(.2,{scale:k},{easing:"backOut"}),E),tZ.runTweenAsync(x(this.glowOpacity.node).to(.2,{scale:k},{easing:"backOut"}),E)])];case 1:C.sent(),this.sprite.node.setScale(k),this.glowOpacity.node.setScale(k);return[2]}})}),function(g,E){return C.apply(this,arguments)})},{key:"startShaking",value:function(){var g=this,E=this.node.position.clone();this.shakingTween={ogPos:E,tw:x(this.node).to(.1,{},{onUpdate:function(_,k){if(k){var C=E.x+10*(k-.5);g.node.position=new em(C,E.y,E.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this.sprite.node.scale.clone().multiplyScalar(1.1);return[4,Promise.all([tZ.runTweenAsync(x(this.sprite.node).to(.2,{scale:E},{easing:"cubicInOut"}),g),tZ.runTweenAsync(x(this.glowOpacity.node).to(.2,{scale:E}),g),tZ.runTweenAsync(x(this.glowOpacity).to(.5,{opacity:255}),g)])];case 1:_.sent();return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"explode",value:(_=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=new em(8,8,8),k=function(){var k=Be(function(){return _ts_generator(this,function(k){switch(k.label){case 0:E.circle.opacity=255,E.circle.node.setScale(em.ZERO);return[4,Promise.all([tZ.runTweenAsync(x(E.circle).to(.3,{opacity:0}),g),tZ.runTweenAsync(x(E.circle.node).to(.3,{scale:_},{easing:"cubicOut"}),g)])];case 1:k.sent(),E.circle.opacity=0,E.circle.node.scale=_;return[2]}})});return function(){return k.apply(this,arguments)}}(),C=function(){var _=Be(function(){return _ts_generator(this,function(_){switch(_.label){case 0:return[4,Promise.all([tZ.runTweenAsync(x(E.glowOpacity.node).to(.3,{scale:em.ZERO},{easing:"cubicOut"}),g),tZ.runTweenAsync(x(E.sprite.node).to(.3,{scale:em.ZERO},{easing:"cubicOut"}),g)])];case 1:_.sent(),E.sprite.node.setScale(em.ZERO),E.glowOpacity.node.setScale(em.ZERO);return[2]}})});return function(){return _.apply(this,arguments)}}();return[4,Promise.all([this.explodeParticles(g),k(),C()])];case 1:A.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"explodeParticles",value:(E=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=g.aborted;if(E)return[3,2];this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem();return[4,tZ.waitTweenAsync(1)];case 1:E=(_.sent(),this.explosionParticles.node.active=!1);_.label=2;case 2:return[2]}})}),function(g){return E.apply(this,arguments)})}]),s}(D)).prototype,"sprite",[qj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q8=st(q5.prototype,"glowOpacity",[qX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q9=st(q5.prototype,"explosionParticles",[qY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q7=st(q5.prototype,"circle",[qJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wt=st(q5.prototype,"uiOpacity",[qQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(q5.prototype,"startingOffsetX",[qZ],Object.getOwnPropertyDescriptor(q5.prototype,"startingOffsetX"),q5.prototype),st(q5.prototype,"startingOffsetY",[q$],Object.getOwnPropertyDescriptor(q5.prototype,"startingOffsetY"),q5.prototype),Wn=st(q5.prototype,"endingOffsetX",[q0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wi=st(q5.prototype,"endingOffsetY",[q1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wa=st(q5.prototype,"startingScale",[q2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return .5}}),Wr=st(q5.prototype,"endingScale",[q4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),q3=q5))||q3);_._RF.pop(),_._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var WH,Wq,WW,Wj,WX,WY,WJ,WQ,WZ,W$,W0,W1,W2,W4,W3=k.ccclass,W5=k.property,W6=k.requireComponent,W8=GameCore.Events,W9=globalThis.game,W7=W9.event,jt=W9.player;WS=W3("StarChestScreen"),WE=W6(zK),W_=W5(RX),Wk=W5(B),WC=W5(B),WA=W5(G),WT=W5(WK),WR=W5(eu),WI=W5(kW),WL=W5(L),WS(WP=WE((WB=st((WO=function(g){ze(r,g);var E,_,k,C,A=Xe(r);function r(){var g;Fe(this,r);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=A.call.apply(A,[this].concat(_)),"starProgressBar",WB,Ke(g)),rt(g,"openButton",WN,Ke(g)),rt(g,"continueButton",WD,Ke(g)),rt(g,"chestAnimation",WM,Ke(g)),rt(g,"starChest",WF,Ke(g)),rt(g,"chestUnlockFXMask",WU,Ke(g)),rt(g,"skipOverlay",Wz,Ke(g)),rt(g,"messageLabel",Wx,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StarChestScreen: screen not found");g.validateEventPayload(E)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){W7.on(W8.OPENING_SCREEN,this.handleOpeningScreen),W7.on(W8.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){W7.off(W8.OPENING_SCREEN,this.handleOpeningScreen),W7.off(W8.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(a2.HIDE_UI);var g=jt.getGameData();if(g){var E=g.stars;this.numChestAvailable=Math.floor(E/20),this.starProgressBar.setRange(E,20);var _=this.numChestAvailable>0;this.setInteractableButtons(!0),this.openButton.node.active=_,this.openButton.interactable=_,this.continueButton.node.active=!_,this.continueButton.interactable=!_,this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){W7.emit(W8.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(a2.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(C=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:if(!(0!==this.numChestAvailable))return[3,5];i8.turnDownMusic();g=jt.getGameData();if(!g)return[3,4];this.setInteractableButtons(!1);E=g.stars;jt.setGameData({stars:g.stars-20*this.numChestAvailable});_=new nD;return[4,this.skipOverlay.open({opacity:200,onSkip:function(){return _.abort()}})];case 1:k.sent();return[4,this.handleUnlockAnimation(E,g.stars,_)];case 2:k.sent();return[4,this.skipOverlay.close()];case 3:k.sent(),i8.turnUpMusic(),Q.emit(nR),this.close();k.label=4;case 4:return[3,6];case 5:this.close();k.label=6;case 6:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(k=Be(function(g,E,_){var k,C,A,T;return _ts_generator(this,function(R){switch(R.label){case 0:k=this;return[4,Promise.all([this.starChest.moveToCenter(_),this.fadeInChestUnlockFX(_)])];case 1:R.sent(),this.chestAnimation.stop(),this.starChest.startShaking();return[4,i8.playSound(ih.STAR_CHEST_DRUM_ROLL,{loop:!0})];case 2:R.sent();return[4,tZ.waitTweenAsync(0)];case 3:R.sent();C=g,A=this.numChestAvailable;return[4,Promise.all([this.starProgressBar.animateTo(E,_,function(g){var E;C-g>=20&&(C=g,A--,k.starChest.scale((E=A,k.numChestAvailable>2?1-E/k.numChestAvailable:.35*(1-E/k.numChestAvailable)),_),i8.playSound(ih.STAR_CHEST_OPEN))})])];case 4:R.sent();return[4,tZ.waitTweenAsync(1,_)];case 5:R.sent(),this.starChest.stopShaking();return[4,this.starChest.glow(_)];case 6:R.sent(),i8.stopSound(ih.STAR_CHEST_DRUM_ROLL);T=sF*this.numChestAvailable;this.node.scene.emit(a2.ADD_COINS,{coins:T,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:_},skipAnimation:!0});return[4,this.starChest.explode(_)];case 7:R.sent();return[4,tZ.waitTweenAsync(1,_)];case 8:R.sent();return[4,Promise.all([this.fadeOutChestUnlockFX(_)])];case 9:R.sent();return[2]}})}),function(g,E,_){return k.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:this.chestUnlockFXMask.node.active=!0;return[4,tZ.runTweenAsync(x(this.chestUnlockFXMask).to(.5,{opacity:150}),g)];case 1:E.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(E=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,tZ.runTweenAsync(x(this.chestUnlockFXMask).to(.3,{opacity:0}),g)];case 1:E.sent(),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1;return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"setInteractableButtons",value:function(g){this.openButton.interactable=g,this.continueButton.interactable=g,this.screen.backgroundMask.getComponent(B).interactable=g}}]),r}(D)).prototype,"starProgressBar",[W_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WN=st(WO.prototype,"openButton",[Wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WD=st(WO.prototype,"continueButton",[WC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WM=st(WO.prototype,"chestAnimation",[WA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WF=st(WO.prototype,"starChest",[WT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WU=st(WO.prototype,"chestUnlockFXMask",[WR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wz=st(WO.prototype,"skipOverlay",[WI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wx=st(WO.prototype,"messageLabel",[WL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WP=WO))||WP);_._RF.pop(),_._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);var ji,ja,jr,jo,js,jl,ju,jc,jp=k.ccclass,jd=k.property,jf=k.requireComponent,jy=GameCore.Events,jg=globalThis.game.event;WH=jp("StartLevelScreen"),Wq=jf(zK),WW=jd(C),Wj=jd(C),WX=jd(C),WY=jd(C),WJ=jd(B),WH(WQ=Wq((W$=st((WZ=function(g){ze(n,g);var E=Xe(n);function n(){var g;Fe(this,n);for(var _=arguments.length,k=new Array(_),C=0;C<_;C++)k[C]=arguments[C];return rt(g=E.call.apply(E,[this].concat(k)),"playButton",W$,Ke(g)),rt(g,"goalText",W0,Ke(g)),rt(g,"levelText",W1,Ke(g)),rt(g,"missionText",W2,Ke(g)),rt(g,"playButtonComponent",W4,Ke(g)),g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("StartLevelScreen: screen not found");g.validateEventPayload(E)&&(g.playButtonComponent.interactable=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){jg.on(jy.OPENING_SCREEN,this.handleOpeningScreen),jg.on(jy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){jg.off(jy.OPENING_SCREEN,this.handleOpeningScreen),jg.off(jy.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){var E=null!=g?g:{},_=E.screenName,k=E.screenData;return _===this.node.name&&(null!=k&&k.level&&(this.levelId=k.level),null!=k&&k.mission&&(this.mission=k.mission),!0)}},{key:"open",value:function(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(a2.HIDE_UI)}},{key:"close",value:function(){this.playButtonComponent.interactable=!1,jg.emit(jy.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(a2.SHOW_UI)}},{key:"updateComponents",value:function(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}},{key:"updateGoalText",value:function(){var g=this.mission.mission;this.goalText.getComponent(L).string=g>1?"Goals":"Goal"}},{key:"updateLevelText",value:function(){this.levelText.getComponent(L).string="Level ".concat(this.levelId)}},{key:"updateDescriptionText",value:function(){this.missionText.getComponent(L).string=this.mission.description}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedPlay",value:function(){this.node.scene.emit(a2.GAME_START),this.close()}}]),n}(D)).prototype,"playButton",[WW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W0=st(WZ.prototype,"goalText",[Wj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W1=st(WZ.prototype,"levelText",[WX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W2=st(WZ.prototype,"missionText",[WY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W4=st(WZ.prototype,"playButtonComponent",[WJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WQ=WZ))||WQ);_._RF.pop(),_._RF.push({},"2f7694kcVZNWq3iTCp1piqI","StartOverScreen",void 0);var jm,jb,jw,jS,jE,j_=k.ccclass,jk=k.property,jC=k.requireComponent,jA=GameCore.Events,jT=globalThis.game,jR=jT.event,jI=jT.player;ji=j_("StartOverScreen"),ja=jC(zK),jr=jk(B),jo=jk(B),ji(js=ja((ju=st((jl=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"restartButton",ju,Ke(g)),rt(g,"cancelButton",jc,Ke(g)),g.handleOpeningScreen=function(E){g.validateEventPayload(E)&&g.setInteractableButtons(!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){jR.on(jA.OPENING_SCREEN,this.handleOpeningScreen),jR.on(jA.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){jR.off(jA.OPENING_SCREEN,this.handleOpeningScreen),jR.off(jA.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(a2.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),l5.closeScreen(iS[this.node.name])}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(g){this.restartButton.interactable=g,this.cancelButton.interactable=g}},{key:"handleClickedCancel",value:function(){this.close(),this.node.scene.emit(a2.GAME_RESUME),this.node.scene.emit(a2.SHOW_UI)}},{key:"handleClickedRestart",value:(E=Be(function(){var g,E,_;return _ts_generator(this,function(k){this.close();E=(null!==(g=jI.getGameData())&&void 0!==g?g:{}).level,_=void 0===E?1:E;this.node.scene.emit(a2.GAME_RESUME),this.node.scene.emit(a2.GAME_REPLAY,{level:_});return[2]})}),function(){return E.apply(this,arguments)})}]),i}(D)).prototype,"restartButton",[jr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jc=st(jl.prototype,"cancelButton",[jo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),js=jl))||js);_._RF.pop(),_._RF.push({},"d6d78U+W5xDwqln9pXXQOaF","TopLeaders",void 0);var jL,jP,jO,jB,jN,jD=k.ccclass,jM=k.property,jF=(jm=jD("TopLeaders"),jb=jM(DL),jm((jE=st((jS=function(g){ze(i,g);var E,_=Xe(i);function i(){var g;Fe(this,i);for(var E=arguments.length,k=new Array(E),C=0;C<E;C++)k[C]=arguments[C];return rt(g=_.call.apply(_,[this].concat(k)),"topLeaders",jE,Ke(g)),g.leaderData=[],g}return Ue(i,[{key:"updateData",value:function(g){var E=this;this.leaderData=g.slice(0,3),this.leaderData.slice(0,3).forEach(function(g,_){E.topLeaders[_].updateInfo({playerId:g.playerId,name:g.name,photo:g.photo,score:g.score})})}},{key:"playShowLeadersAnimation",value:(E=Be(function(g){var E,_,k;var C=arguments;return _ts_generator(this,function(A){switch(A.label){case 0:E=this,_=C.length>1&&void 0!==C[1]?C[1]:.1,k=.3;return[4,Promise.all(this.leaderData.map(function(){var C=Be(function(C,A){var T;return _ts_generator(this,function(C){switch(C.label){case 0:T=E.topLeaders[A];return[4,T.runShowUpAnimation(A*_,k,g)];case 1:C.sent();return[2]}})});return function(g,E){return C.apply(this,arguments)}}()))];case 1:A.sent();return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"hideLeaders",value:function(){var g,E=at(this.topLeaders);try{for(E.s();!(g=E.n()).done;)g.value.setVisible(!1)}catch(g){E.e(g)}finally{E.f()}}}]),i}(D)).prototype,"topLeaders",[jb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jw=jS))||jw);_._RF.pop(),_._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var jU,jz,jx,jG,jV,jK,jH,jq,jW,jj,jX,jY,jJ,jQ,jZ,j$,j0,j1,j2,j4,j3,j5,j6,j8,j9,j7,Xt,Xn,Xi,Xa,Xr,Xo,Xs,Xl,Xu,Xc,Xh,Xp,Xd,Xf,Xy,Xv=k.ccclass,Xg=k.property,Xm=(jL=Xv("TournamentLeaderSkeleton"),jP=Xg(C),jL((jN=st((jB=function(g){ze(a,g);var E,_,k=Xe(a);function a(){var g;Fe(this,a);for(var E=arguments.length,_=new Array(E),C=0;C<E;C++)_[C]=arguments[C];return rt(g=k.call.apply(k,[this].concat(_)),"container",jN,Ke(g)),g}return Ue(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(eu),this.validateRequiredComponents()}},{key:"hide",value:(_=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,tZ.runTweenAsync(x(this.uiOpacity).to(.2,{opacity:0}).call(function(){E.node.active=!1}),g)];case 1:_.sent();return[2]}})}),function(g){return _.apply(this,arguments)})},{key:"show",value:(E=Be(function(g,E){var _,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:this.node.active=!0,this.node.scale=new em(.8,.8,.8),this.uiOpacity.opacity=0;_=this.container.position.clone();this.container.position=new em(_.x,_.y-100,_.z);k=x(this.node).delay(g);k.to(.2,{scale:em.ONE},{easing:"elasticOut"});C=x(this.container).delay(g);C.to(.2,{position:_},{easing:"backOut"});A=x(this.uiOpacity).delay(g);A.to(.2,{opacity:255},{easing:"cubicOut"});return[4,Promise.all([tZ.runTweenAsync(k,E),tZ.runTweenAsync(C,E),tZ.runTweenAsync(A,E)])];case 1:T.sent(),this.node.scale=em.ONE,this.container.position=_,this.uiOpacity.opacity=255;return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(D)).prototype,"container",[jP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jO=jB))||jO);_._RF.pop(),_._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var Xb=k.ccclass,Xw=k.property,XS=k.requireComponent,XE=GameCore,X_=XE.Events,Xk=XE.Utils,XC=Xk.Object,XA=Xk.Time,XT=Xk.Number,XR=globalThis.game,XI=XR.event,XL=XR.storage,XP=XR.player,XO=XR.leaderboard,XB=1166;jU=Xb("TournamentDetailScreen"),jz=XS(zK),jx=Xw(L),jG=Xw(L),jV=Xw(L),jK=Xw(NC),jH=Xw(jF),jq=Xw({type:C,group:"Buttons"}),jW=Xw({type:C,group:"Buttons"}),jj=Xw({type:C,group:"Buttons"}),jX=Xw({type:eo}),jY=Xw({type:C}),jJ=Xw({type:C}),jQ=Xw({type:[Xm]}),jZ=Xw(yc),j$=Xw({type:R,group:"Container"}),j0=Xw({type:R,group:"Container"}),j1=nC.onlyRunInLifeCycleAsync,j2=nC.onlyRunInLifeCycleAsync,j4=nC.onlyRunInLifeCycleAsync,j3=nC.onlyRunInLifeCycleAsync,j5=nC.onlyRunInLifeCycleAsync,j6=nC.onlyRunInLifeCycle,j8=nC.onlyRunInLifeCycle,jU(j9=jz((Xt=st((j7=function(g){ze(v,g);var E,_,k,C,A,T,R,I,L,P,O,N,D,M=Xe(v);function v(){var g;Fe(this,v);for(var E=arguments.length,_=new Array(E),k=0;k<E;k++)_[k]=arguments[k];return rt(g=M.call.apply(M,[this].concat(_)),"titleLabel",Xt,Ke(g)),rt(g,"timeLabel",Xn,Ke(g)),rt(g,"playerCountLabel",Xi,Ke(g)),rt(g,"tournamentLeaders",Xa,Ke(g)),rt(g,"topLeaders",Xr,Ke(g)),rt(g,"playButton",Xo,Ke(g)),rt(g,"continueButton",Xs,Ke(g)),rt(g,"replayButton",Xl,Ke(g)),rt(g,"banner",Xu,Ke(g)),rt(g,"bannerLoadingRing",Xc,Ke(g)),rt(g,"bannerMask",Xh,Ke(g)),rt(g,"leaderSkeletons",Xp,Ke(g)),rt(g,"paperConfetti",Xd,Ke(g)),rt(g,"container",Xf,Ke(g)),rt(g,"tempContainer",Xy,Ke(g)),g.signal=new nD,g.leadersPayload=null,g.handleOpeningScreen=function(E){if(!g.screen)throw new Error("TournamentDetailScreen: screen not found");g.validateEventPayload(E)&&(g.enabled=!0)},g.handleOpenedScreen=function(E){g.validateEventPayload(E)&&g.open()},g}return Ue(v,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(zK),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){nC.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){XI.on(X_.OPENING_SCREEN,this.handleOpeningScreen),XI.on(X_.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){XI.off(X_.OPENING_SCREEN,this.handleOpeningScreen),XI.off(X_.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(g){return(null!=g?g:{}).screenName===this.node.name&&(this.payload=g,!0)}},{key:"open",value:function(){this.updateContainer(),this.setInteractableButtons(!0),this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders(),this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(a2.HIDE_UI),this.updateInfo()}},{key:"close",value:function(){l5.closeTournamentDetailScreen(),this.setInteractableButtons(!1),this.node.scene.emit(a2.SHOW_UI),this.cleanup()}},{key:"cleanup",value:function(){var g;null===(g=this.signal)||void 0===g||g.abort(),this.signal=new nD,this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(D=Be(function(){var g,E,_,k,C,A,T,R,I,L,P,O,B,N,D,M,F,U,z,x,G,V,K,H,q,W,j,X,Y,J;return _ts_generator(this,function(Q){switch(Q.label){case 0:T=this,R=this.signal,I=null===(g=this.payload)||void 0===g||null===(g=g.screenData)||void 0===g?void 0:g.tournament;if(!I)return[3,9];L=null===(E=null===(_=this.payload.screenData)||void 0===_?void 0:_.playAnimation)||void 0===E||E,P=JSON.parse(I);P.id=P.id.toString(),this.tournamentPayload=P;O=this.tournamentPayload,B=O.endTime,N=O.payload,D=O.title,M=N.leaderboardId,F=void 0===M?"":M,U=N.themeId;this.updateTitle(D),this.updateEndTime(B),this.updateTournamentBanner(U,R);z=XL.getStorage("tournament"),x=z.previousScore,G=z.animateTournamentLeader;XL.setStorageData("tournament","animateTournamentLeader",!1),this.updateButtonsVisibility(G);return[4,this.showLoading(R)];case 1:Q.sent();return[4,this.loadLeaders(F)];case 2:if(Q.sent(),!!this.leadersPayload&&0!==this.leadersPayload.leaders.length&&!R.aborted)return[3,4];this.updatePlayerCount(0);return[4,this.hideLoading(R)];case 3:return[2,void Q.sent()];case 4:V=this.leadersPayload,K=V.player,H=V.amountPlayer,q=null!==(k=this.leadersPayload.leaders)&&void 0!==k?k:[];q.sort(function(g,E){return g.rank-E.rank});return[4,this.hideLoading(R)];case 5:if(Q.sent(),!this.topLeaders||!this.tournamentLeaders||!!R.aborted)return[3,9];this.updatePlayerCount(H),this.topLeaders.updateData(q),this.topLeaders.playShowLeadersAnimation(R);W=null!==(C=null==K?void 0:K.score)&&void 0!==C?C:0,j=null!==(A=null==K?void 0:K.rank)&&void 0!==A?A:0,X=G&&-1!==x&&x<W;this.tournamentLeaders.updateData(q);Y=!1;K&&X&&(Y=this.tournamentLeaders.updateDisplayPlayerLeaderForRankChanging(x,W,j)),this.tournamentLeaders.initScrollViews(),this.tournamentLeaders.scrollView.scrollView.enabled=!0;return[4,R.callAsync(function(g){return T.runShowUpAnimation(g,L)})];case 6:Q.sent();J=G&&Y&&-1!==x&&this.tournamentLeaders;if(!J)return[3,8];return[4,R.callAsync(function(g){return T.tournamentLeaders.playRankChangeAnimation(g,x,W,j)})];case 7:J=(Q.sent(),this.tryPlayConfettiEffect(j));Q.label=8;case 8:Q.label=9;case 9:return[2]}})}),function(){return D.apply(this,arguments)})},{key:"updateContainer",value:(N=Be(function(){var g;return _ts_generator(this,function(E){g=this.tempContainer.height;this.container.node.position=this.tempContainer.node.position.clone(),g<XB&&this.container.height!==g?(this.container.height=g,eb.instance.emit("canvas-resize")):g>XB&&this.container.height<XB&&(this.container.height=XB,eb.instance.emit("canvas-resize"));return[2]})}),function(){return N.apply(this,arguments)})},{key:"loadLeaders",value:(O=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:E=this;return[4,this.getLeadersPayload(g)];case 1:E.leadersPayload=_.sent();return[2]}})}),function(g){return O.apply(this,arguments)})},{key:"showLoading",value:(P=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=this,_=k.length>1&&void 0!==k[1]?k[1]:0;return[4,Promise.all([this.tournamentLeaders.scrollView.unlistenEvents(),this.tournamentLeaders.scrollView.scrollToTop(g,.1).then(function(){E.tournamentLeaders.scrollView.scrollView.enabled=!1,E.tournamentLeaders.scrollView.listenEvents()}),this.leaderSkeletons.map(function(E,k){return E.show(k*_,g)})])];case 1:C.sent();return[2]}})}),function(g){return P.apply(this,arguments)})},{key:"hideLoading",value:(L=Be(function(g){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,Promise.all(this.leaderSkeletons.map(function(E){return E.hide(g)}))];case 1:E.sent();return[2]}})}),function(g){return L.apply(this,arguments)})},{key:"runShowUpAnimation",value:(I=Be(function(g){var E,_;var k=arguments;return _ts_generator(this,function(C){switch(C.label){case 0:E=!(k.length>1&&void 0!==k[1])||k[1],_=E?0:.1;return[4,this.tournamentLeaders.playShowLeadersAnimation(g,_)];case 1:C.sent();return[4,this.tournamentLeaders.scrollToPlayerLeader(1.5,g)];case 2:C.sent();return[2]}})}),function(g){return I.apply(this,arguments)})},{key:"tryPlayConfettiEffect",value:function(g){if(!(g>10)){var E,_=at(this.paperConfetti);try{for(_.s();!(E=_.n()).done;)E.value.play()}catch(g){_.e(g)}finally{_.f()}i8.playSound(ih.LEADERBOARD_TRIUMPH)}}},{key:"updateTitle",value:function(g){g&&(this.titleLabel.string=g)}},{key:"updateEndTime",value:function(g){var E=XA.getRelativeTime(g);E=(E=E.replace("seconds","secs").replace("second","sec")).replace("minutes","mins").replace("minute","min"),this.timeLabel.string="Ends ".concat(E)}},{key:"updateTournamentBanner",value:(R=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:this.banner.spriteFrame=null;_=ie.getAsset("".concat(nz[g],"/spriteFrame"),er);k=_;if(k)return[3,2];this.bannerMask.active=!0,this.bannerLoadingRing.active=!0;return[4,ie.loadThemeTournamentAsync(g)];case 1:k=_=A.sent();A.label=2;case 2:C=_;if(C)return[3,4];return[4,ie.loadThemeTournamentAsync(lr.SUMMER)];case 3:C=_=A.sent();A.label=4;case 4:this.banner&&_&&!E.aborted&&(this.banner.spriteFrame=_,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1);return[2]}})}),function(g,E){return R.apply(this,arguments)})},{key:"updatePlayerCount",value:function(g){var E=XT.getShortNumber(g,3);this.playerCountLabel.string="".concat(E," ").concat(g>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"getLeadersPayload",value:(T=Be(function(g){var E,_,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:E=XO.getLeaderboardName(g);if(!E)return[2,null];return[4,li.getAllLeaderboardAsync(g)];case 1:_=P.sent();if(!_)return[2,null];C=XC.vals(_.leaders),A=XP.getPlayerId(),T={leaders:[],amountPlayer:_.amountPlayer},R=at(C);try{for(R.s();!(k=R.n()).done;){I=k.value;I.playerId===A?(T.player=I,T.leaders.push(I)):T.leaders.push(I)}}catch(g){R.e(g)}finally{R.f()}if(!!T.player)return[3,3];return[4,XO.getLeadersByPlayerIdsAsync(E,[A])];case 2:L=P.sent();L&&L.length>0&&(T.player=L[0],T.leaders.push(L[0]));P.label=3;case 3:return[2,T]}})}),function(g){return T.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(g){this.playButton.active=!g,this.continueButton.active=g,this.replayButton.active=g}},{key:"handleOnPlay",value:(A=Be(function(){var g,E,_;return _ts_generator(this,function(k){switch(k.label){case 0:g=this.tournamentPayload.id||"";if(ur.validateTournamentExpired(g))return[2,(this.close(),this.node.scene.emit(s4.RELOAD_TOURNAMENT),void l5.showNotificationScreen("Tournament has ended",2))];k.label=1;case 1:k.trys.push([1,4,9,10]);l5.showLoadingScreen();return[4,lT.setMatchCustomDataAsync({level:1,score:0})];case 2:k.sent();return[4,this.processJoinTournament()];case 3:k.sent();return[3,10];case 4:E=k.sent();if(XC.hasOwn(E,"code")&&"USER_INPUT"===E.code)return[2];k.label=5;case 5:k.trys.push([5,7,,8]);return[4,this.processContinueTournament()];case 6:k.sent();return[3,8];case 7:_=k.sent();if(XC.hasOwn(_,"code")&&"USER_INPUT"===_.code)return[2];console.error("processPlayButtonPressed",_),l5.showNotificationScreen("Sorry, you cannot join\nat this time.",2);return[3,8];case 8:return[3,10];case 9:l5.closeLoadingScreen();return[7];case 10:return[2]}})}),function(){return A.apply(this,arguments)})},{key:"processJoinTournament",value:(C=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,this.joinTournamentAsync()];case 1:E.sent(),lV.switchScene(s0,{level:1});return[3,3];case 2:g=E.sent();throw console.warn("processJoinTournament",g),g;case 3:return[2]}})}),function(){return C.apply(this,arguments)})},{key:"processContinueTournament",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,this.continueTournamentAsync()];case 1:E.sent(),lV.switchScene(s0,{level:1});return[3,3];case 2:g=E.sent();throw console.warn("processContinueTournament",g),g;case 3:return[2]}})}),function(){return k.apply(this,arguments)})},{key:"joinTournamentAsync",value:(_=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=this.tournamentPayload.id||"";return[4,lT.joinTournamentAsync(g)];case 1:E.sent();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"continueTournamentAsync",value:(E=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:E=null!==(g=GameSDK.context.getID())&&void 0!==g?g:"";return[4,lT.continueTournamentAsync(E)];case 1:_.sent();return[2]}})}),function(){return E.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var g,E,_=(null!==(g=null===(E=this.payload)||void 0===E?void 0:E.screenData)&&void 0!==g?g:{}).tournamentContextType;switch(void 0===_?"tournament_start":_){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}},{key:"setInteractableButtons",value:function(g){this.screen.backgroundMask.getComponent(B).interactable=g}}]),v}(D)).prototype,"titleLabel",[jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xn=st(j7.prototype,"timeLabel",[jG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xi=st(j7.prototype,"playerCountLabel",[jV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xa=st(j7.prototype,"tournamentLeaders",[jK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xr=st(j7.prototype,"topLeaders",[jH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xo=st(j7.prototype,"playButton",[jq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xs=st(j7.prototype,"continueButton",[jW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xl=st(j7.prototype,"replayButton",[jj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xu=st(j7.prototype,"banner",[jX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xc=st(j7.prototype,"bannerLoadingRing",[jY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xh=st(j7.prototype,"bannerMask",[jJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xp=st(j7.prototype,"leaderSkeletons",[jQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xd=st(j7.prototype,"paperConfetti",[jZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xf=st(j7.prototype,"container",[j$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xy=st(j7.prototype,"tempContainer",[j0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st(j7.prototype,"updateInfo",[j1],Object.getOwnPropertyDescriptor(j7.prototype,"updateInfo"),j7.prototype),st(j7.prototype,"loadLeaders",[j2],Object.getOwnPropertyDescriptor(j7.prototype,"loadLeaders"),j7.prototype),st(j7.prototype,"showLoading",[j4],Object.getOwnPropertyDescriptor(j7.prototype,"showLoading"),j7.prototype),st(j7.prototype,"hideLoading",[j3],Object.getOwnPropertyDescriptor(j7.prototype,"hideLoading"),j7.prototype),st(j7.prototype,"runShowUpAnimation",[j5],Object.getOwnPropertyDescriptor(j7.prototype,"runShowUpAnimation"),j7.prototype),st(j7.prototype,"tryPlayConfettiEffect",[j6],Object.getOwnPropertyDescriptor(j7.prototype,"tryPlayConfettiEffect"),j7.prototype),st(j7.prototype,"updatePlayerCount",[j8],Object.getOwnPropertyDescriptor(j7.prototype,"updatePlayerCount"),j7.prototype),j9=j7))||j9);_._RF.pop(),_._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,k.ccclass)("TournamentLeader")(function(g){ze(n,g);var E=Xe(n);function n(){return Fe(this,n),E.apply(this,arguments)}return Ue(n)}(B4));_._RF.pop(),_._RF.push({},"0b4bc6YT6ZGg4lnXfh/zL6J","AdsManager",void 0);var XN=GameCore,XD=XN.Events,XM=XN.Configs,XF=XN.Utils.Time,XU=globalThis.game,Xz=XU.ads,Xx=XU.player,XG=XU.event,XV=function(){function e(){var g=this;Fe(this,e),this.currentLayout="",this.handleShowBannerAds=function(E){E.sceneName!==s$&&(Xx.isFirstLogin()||(g.showBannerAdsByLayout(),XG.off(XD.SCENE_LAUNCHED,g.handleShowBannerAds)))},this.handleWhenGameReady=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:return[4,g.handleShowInterstitialAdWhenGameReady()];case 1:E.sent();return[4,XF.sleepAsync(2e3)];case 2:E.sent(),mB.preloadAds();return[2]}})}),this.handleShowInterstitialAdWhenGameReady=Be(function(){var E,_,k,C,A,T,R,I,L;return _ts_generator(this,function(P){switch(P.label){case 0:E=XM.Ads,_=E.Enabled,k=E.ShowAdOnLoad;if(!_)return[3,6];C=k.Enabled,A=k.DelaySeconds,T=k.PlacementId;if(!C)return[3,6];P.label=1;case 1:P.trys.push([1,5,,6]);R=A>0;if(!R)return[3,3];return[4,XF.sleepAsync(1e3*A)];case 2:R=P.sent();P.label=3;case 3:I=Xz.getAdByPlacementId(T);if(!I)return[2];return[4,g.showAdByConfig(I)];case 4:P.sent();return[3,6];case 5:L=P.sent();console.warn("handleShowAdWhenLoadGame failed",L);return[3,6];case 6:return[2]}})}),this.handleLayoutChanged=function(E){g.currentLayout!==E&&(g.currentLayout=E,g.showBannerAdsByLayout())},this.handleRequestShowBannerAds=function(){g.showBannerAdsByLayout()}}var g;return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Ads Manager: Initialized")}},{key:"listenEvents",value:function(){Q.on(t6,this.handleLayoutChanged),XG.on(XD.REQUEST_SHOW_BANNER_ADS,this.handleRequestShowBannerAds),XG.on(XD.SCENE_LAUNCHED,this.handleShowBannerAds),XG.once(XD.GAME_READY,this.handleWhenGameReady)}},{key:"showAdByConfig",value:(g=Be(function(g){var E,_,k;return _ts_generator(this,function(C){switch(C.label){case 0:C.trys.push([0,3,4,5]);E=g.type,_=g.placementId;return[4,Xz.loadAdAsync(E,_)];case 1:C.sent(),i8.muteAudio(!0);return[4,Xz.showAdAsync(E,_)];case 2:C.sent();return[3,5];case 3:k=C.sent();console.warn("showAdByConfig failed",k);return[3,5];case 4:Q.resume(),i8.muteAudio(!1);return[7];case 5:return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"showBannerAdsByLayout",value:function(){var g=XM.Ads.BannerDisplayAdOptions;this.currentLayout!==am.Landscape?g.forEach(function(g){var E=g.PlacementId,_=g.Position;"bottom"===_||"top"===_?mB.showBannerAd(E):mB.hideBannerAd(E)}):mB.showBannerAds()}}]),e}();_._RF.pop(),_._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var XK=GameCore.Events,XH=globalThis.game,Xq=XH.event,XW=XH.monitorError,Xj=function(){function e(){var g=this;Fe(this,e),this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=function(){if(!g.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void(null==XW||XW.sendException(new Error("Core: Booting callback is not set")));console.info("\uD83D\uDE80 Core: Boot"),g.callbackCoreBooting(),g.callbackCoreBooting=null},this.handleWhenCoreStarting=function(){if(!g.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void(null==XW||XW.sendException(new Error("Core: Starting callback is not set")));console.info("\uD83D\uDE80 Core: Starting"),g.callbackCoreStarting(),g.callbackCoreStarting=null},this.handleWhenCoreReady=function(){if(!g.callbackCoreReady)return console.error("Core: Ready callback is not set"),void(null==XW||XW.sendException(new Error("Core: Ready callback is not set")));console.info("\uD83D\uDE80 Core: Ready"),g.callbackCoreReady(),g.callbackCoreReady=null}}return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Core Manager: Initialized")}},{key:"listenEvents",value:function(){Xq.once(XK.CORE_BOOTING,this.handleWhenCoreBooting),Xq.once(XK.CORE_STARTING,this.handleWhenCoreStarting),Xq.once(XK.CORE_READY,this.handleWhenCoreReady)}},{key:"requestStart",value:function(){Xq.emit(XK.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(g){this.callbackCoreBooting=g,Xq.getEventEmitCount(XK.CORE_BOOTING)>0&&(Xq.off(XK.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}},{key:"onCoreStart",value:function(g){this.callbackCoreStarting=g,Xq.getEventEmitCount(XK.CORE_STARTING)>0&&(Xq.off(XK.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}},{key:"onCoreReady",value:function(g){this.callbackCoreReady=g,Xq.getEventEmitCount(XK.CORE_READY)>0&&(Xq.off(XK.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}]),e}();_._RF.pop(),_._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var XX=GameCore,XY=XX.Events,XJ=XX.Configs.GameEngine.DynamicAtlas,XQ=XX.Utils,XZ=XQ.Valid,X$=XQ.Device,X0=globalThis.game.event,X1=function(){function e(){var g=this;Fe(this,e),this.handlePauseEngine=Be(function(){return _ts_generator(this,function(g){console.info("Engine: Paused",Q.isPaused()),Q.isPaused();return[2]})}),this.handleResumeEngine=Be(function(){return _ts_generator(this,function(g){console.info("Engine: Resumed",Q.isPaused()),Q.isPaused();return[2]})}),this.handleResizeView=function(E){eb.instance.resizeWithBrowserSize(!1);var _=E.width,k=E.height;g.resizeView(_,k)},this.handleViewResized=function(g){var E=g.width,_=g.height;eb.instance.resizeWithBrowserSize(!0),console.info(" New View Size",{width:E,height:_})}}var g;return Ue(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.setupAssetDownloader(),this.setupOptimalPipelines(),this.setupEngineRunningState(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){Q.on(t4,this.handleResizeView),Q.on(t3,this.handleViewResized)}},{key:"overrideSettings",value:function(){ej.overrideSettings(eX.Category.ENGINE,"debug",XZ.isDebugger()),Q.frameRate=X$.isDesktop()?60:48}},{key:"setupAutoAtlas",value:function(){eY.instance.cacheAsset=!0}},{key:"setupAssetDownloader",value:function(){var g=eY.instance.downloader;g.maxConcurrency=10,g.maxRequestsPerFrame=6}},{key:"getPipelineFlows",value:function(){var g,E;return null!==(g=null===(E=N.root)||void 0===E||null===(E=E.pipeline)||void 0===E?void 0:E.flows)&&void 0!==g?g:[]}},{key:"getRenderQueues",value:function(g){var E=this.getPipelineFlows()[0];return null!=E&&E.stages?E.stages[g].renderQueues:[]}},{key:"setupOptimalPipelines",value:(g=Be(function(){var g,E;return _ts_generator(this,function(_){switch(_.label){case 0:eY.instance.transformPipeline.remove(1);return[4,XZ.isValueChangeAsync(function(){return!!N.root},!0,{timeout:1e4})];case 1:_.sent();g=this.getPipelineFlows();g.shift(),g.shift();E=this.getRenderQueues(0);E.shift(),E.shift();return[2]}})}),function(){return g.apply(this,arguments)})},{key:"setupEngineRunningState",value:function(){var g=this;eJ.on(ep.EventType.TOUCH_START,this.handleResumeEngine),X0.once(XY.GAME_READY,function(){X0.on(XY.VISIBILITY_HIDDEN,g.handlePauseEngine),X0.on(XY.VISIBILITY_VISIBLE,g.handleResumeEngine)})}},{key:"setupDynamicAtlas",value:function(){switch(ev.os){case ev.OS.IOS:this.setupDynamicAtlasForIOS();break;case ev.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(g){var E=g.Enabled,_=g.AutoAtlasSize,k=g.MaxAtlasCount,C=g.MaxAtlasSize,A=g.MaxFrameSize;if(eQ.CLEANUP_IMAGE_CACHE=!1,eZ.instance.enabled=E,eZ.instance.textureSize=C,eZ.instance.maxFrameSize=A,eZ.instance.maxAtlasCount=k,eZ.instance.textureBleeding=!0,_){var T=this.getMaxTextureSize();if(!T)return;eZ.instance.maxAtlasCount=1,eZ.instance.textureSize=T}}},{key:"getMaxTextureSize",value:function(){if(!N.root)return -1;var g=N.root.device.capabilities.maxTextureSize,E=1024;return g-E<=eZ.instance.maxFrameSize?-1:g>8192?7168:g-E}},{key:"setupDynamicAtlasForIOS",value:function(){var g=XJ.IOS;this.setDynamicAtlas(g)}},{key:"setupDynamicAtlasForAndroid",value:function(){var g=XJ.Android;this.setDynamicAtlas(g)}},{key:"setupDynamicAtlasForDesktop",value:function(){var g=XJ.Desktop;this.setDynamicAtlas(g)}},{key:"setupBatcherLimit",value:function(){eQ.BATCHER2D_MEM_INCREMENT=288,eQ.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(g,E){var _,k=window.devicePixelRatio,C=k>=2?2/k:1,A=g*k*C,T=E*k*C;null===(_=N.root)||void 0===_||_.resize(A,T),j.windowSize=new X.Size(A,T),N.once(e_.EVENT_AFTER_UPDATE,function(){Q.emit(t3,{width:A,height:T})})}}]),e}();_._RF.pop();var X2,X4=new(function(){function e(){Fe(this,e),this._registry={},this._moduleCache={}}return Ue(e,[{key:"define",value:function(g,E,_){this._registry[g]={factory:E,resolveMap:_}}},{key:"require",value:function(g){return this._require(g)}},{key:"throwInvalidWrapper",value:function(g,E){throw new Error("Module '".concat(g,"' imported from '").concat(E,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(g,E){var _=this._moduleCache[g];if(_)return _.exports;var k={id:g,exports:{}};return this._moduleCache[g]=k,this._tryModuleLoad(k,g),k.exports}},{key:"_resolve",value:function(g,E){return this._resolveFromInfos(g,E)||this._throwUnresolved(g,E)}},{key:"_resolveFromInfos",value:function(g,E){var _,k;return g in cjsInfos?g:E&&null!==(_=null===(k=cjsInfos[E])||void 0===k?void 0:k.resolveCache[g])&&void 0!==_?_:void 0}},{key:"_tryModuleLoad",value:function(g,E){var _=!0;try{this._load(g,E),_=!1}finally{_&&delete this._moduleCache[E]}}},{key:"_load",value:function(g,E){var _=this._loadWrapper(E),k=_.factory,C=_.resolveMap,A=this._createRequire(g),T=C?this._createRequireWithResolveMap("function"==typeof C?C():C,A):A;k(g.exports,T,g)}},{key:"_loadWrapper",value:function(g){return g in this._registry?this._registry[g]:this._loadHostProvidedModules(g)}},{key:"_loadHostProvidedModules",value:function(g){return{factory:function(E,_,k){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(g,"'."));try{k.exports=require(g)}catch(E){throw new Error("Exception thrown when calling host defined require('".concat(g,"')."),{cause:E})}}}}},{key:"_createRequire",value:function(g){var E=this;return function(_){return E._require(_,g)}}},{key:"_createRequireWithResolveMap",value:function(g,E){return function(_){var k=g[_];if(k)return E(k);throw new Error("Unresolved specifier "+_)}}},{key:"_throwUnresolved",value:function(g,E){throw new Error("Unable to resolve ".concat(g," from ").concat(parent,"."))}}]),e}());function u3(g){return(u3="function"==typeof Symbol&&"symbol"==_type_of(Symbol.iterator)?function(g){return void 0===g?"undefined":_type_of(g)}:function(g){return g&&"function"==typeof Symbol&&g.constructor===Symbol&&g!==Symbol.prototype?"symbol":void 0===g?"undefined":_type_of(g)})(g)}var X3="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";X4.define(X3,function(g,E,_,k,C){(function(E,k){"object"===u3(g)&&void 0!==_?_.exports=k():"function"==typeof define&&define.amd?define(k):E.ResizeObserver=k()})(this,function(){var g=function(){if("undefined"!=typeof Map)return Map;function e(g,E){var _=-1;return g.some(function(g,k){return g[0]===E&&(_=k,!0)}),_}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(g){var E=e(this.__entries__,g),_=this.__entries__[E];return _&&_[1]},t.prototype.set=function(g,E){var _=e(this.__entries__,g);~_?this.__entries__[_][1]=E:this.__entries__.push([g,E])},t.prototype.delete=function(g){var E=this.__entries__,_=e(E,g);~_&&E.splice(_,1)},t.prototype.has=function(g){return!!~e(this.__entries__,g)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(g,E){void 0===E&&(E=null);for(var _=0,k=this.__entries__;_<k.length;_++){var C=k[_];g.call(E,C[1],C[0])}},t}()}(),E="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,_="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),k="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(_):function(g){return setTimeout(function(){return g(Date.now())},1e3/60)};var C=["top","right","bottom","left","width","height","size","weight"],A="undefined"!=typeof MutationObserver,T=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(g,E){var _=!1,C=!1,A=0;function r(){_&&(_=!1,g()),C&&l()}function s(){k(r)}function l(){var g=Date.now();if(_){if(g-A<2)return;C=!0}else _=!0,C=!1,setTimeout(s,E);A=g}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(g){~this.observers_.indexOf(g)||this.observers_.push(g),this.connected_||this.connect_()},e.prototype.removeObserver=function(g){var E=this.observers_,_=E.indexOf(g);~_&&E.splice(_,1),!E.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var g=this.observers_.filter(function(g){return g.gatherActive(),g.hasActive()});return g.forEach(function(g){return g.broadcastActive()}),g.length>0},e.prototype.connect_=function(){E&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),A?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){E&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(g){var E=g.propertyName,_=void 0===E?"":E;C.some(function(g){return!!~_.indexOf(g)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(g,E){for(var _=0,k=Object.keys(E);_<k.length;_++){var C=k[_];Object.defineProperty(g,C,{value:E[C],enumerable:!1,writable:!1,configurable:!0})}return g},l=function(g){return g&&g.ownerDocument&&g.ownerDocument.defaultView||_},R=f(0,0,0,0);function c(g){return parseFloat(g)||0}function h(g){for(var E=[],_=1;_<arguments.length;_++)E[_-1]=arguments[_];return E.reduce(function(E,_){return E+c(g["border-"+_+"-width"])},0)}function d(g){var E=g.clientWidth,_=g.clientHeight;if(!E&&!_)return R;var k=l(g).getComputedStyle(g),C=function(g){for(var E={},_=0,k=["top","right","bottom","left"];_<k.length;_++){var C=k[_],A=g["padding-"+C];E[C]=c(A)}return E}(k),A=C.left+C.right,T=C.top+C.bottom,I=c(k.width),L=c(k.height);if("border-box"===k.boxSizing&&(Math.round(I+A)!==E&&(I-=h(k,"left","right")+A),Math.round(L+T)!==_&&(L-=h(k,"top","bottom")+T)),!function(g){return g===l(g).document.documentElement}(g)){var P=Math.round(I+A)-E,O=Math.round(L+T)-_;1!==Math.abs(P)&&(I-=P),1!==Math.abs(O)&&(L-=O)}return f(C.left,C.top,I,L)}var I="undefined"!=typeof SVGGraphicsElement?function(g){return _instanceof(g,l(g).SVGGraphicsElement)}:function(g){return _instanceof(g,l(g).SVGElement)&&"function"==typeof g.getBBox};function y(g){return E?I(g)?function(g){var E=g.getBBox();return f(0,0,E.width,E.height)}(g):d(g):R}function f(g,E,_,k){return{x:g,y:E,width:_,height:k}}var L=function(){function e(g){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=f(0,0,0,0),this.target=g}return e.prototype.isActive=function(){var g=y(this.target);return this.contentRect_=g,g.width!==this.broadcastWidth||g.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var g=this.contentRect_;return this.broadcastWidth=g.width,this.broadcastHeight=g.height,g},e}(),m=function(g,E){var _,k,C,A,T,R,I,L=(k=(_=E).x,C=_.y,A=_.width,T=_.height,R="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,I=Object.create(R.prototype),s(I,{x:k,y:C,width:A,height:T,top:C,right:k+A,bottom:T+C,left:k}),I);s(this,{target:g,contentRect:L})},P=function(){function t(E,_,k){if(this.activeObservations_=[],this.observations_=new g,"function"!=typeof E)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=E,this.controller_=_,this.callbackCtx_=k}return t.prototype.observe=function(g){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(g,l(g).Element))throw new TypeError('parameter 1 is not of type "Element".');var E=this.observations_;E.has(g)||(E.set(g,new L(g)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(g){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(g,l(g).Element))throw new TypeError('parameter 1 is not of type "Element".');var E=this.observations_;E.has(g)&&(E.delete(g),E.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var g=this;this.clearActive(),this.observations_.forEach(function(E){E.isActive()&&g.activeObservations_.push(E)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var g=this.callbackCtx_,E=this.activeObservations_.map(function(g){return new m(g.target,g.broadcastRect())});this.callback_.call(g,E,g),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),O="undefined"!=typeof WeakMap?new WeakMap:new g,S=function e(g){if(!_instanceof(this,e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var E=T.getInstance(),_=new P(g,E,this);O.set(this,_)};return["observe","unobserve","disconnect"].forEach(function(g){S.prototype[g]=function(){var E;return(E=O.get(this))[g].apply(E,arguments)}}),void 0!==_.ResizeObserver?_.ResizeObserver:S}),X2=_.exports},{}),X4.require(X3),_._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var X5=am,X6=ab,X8=X6.Portrait,X9=X6.Landscape,X7=GameCore,Yt=X7.Utils.Function,Yn=X7.Configs.GameEngine,Yi=Yn.AutoResizeCanvas,Ya=Yn.AutoChangeOrientation,Yr=function(){function e(){var g=this;Fe(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(E){console.info("\uD83D\uDCF1 View resize by system"),window.devicePixelRatio=E||window.devicePixelRatio,g.setupOrientationByScreenSize(),g.resizeGameView()},this.handleViewResize=Yt.debounce(function(){console.info("\uD83D\uDCF1 View resize by window"),g.setupOrientationByScreenSize(),g.resizeGameView()},200),this.handleBodyResize=Yt.debounce(function(){g.resizeGameDiv()&&(console.info("\uD83D\uDCF1 View resize by body"),g.setupOrientationByScreenSize(),g.resizeGameView())},200)}return Ue(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){Yi&&(j.on("window-resize",this.handleViewResize,this),j.on("orientation-change",this.handleViewResize,this)),Q.on(t5,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){Yi&&new X2(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){Ya&&(eb.instance.resizeWithBrowserSize(!0),eb.instance.setOrientation(eQ.ORIENTATION_AUTO),eb.instance.setResolutionPolicy(e$.ContentStrategy.FIXED_WIDTH),eb.instance.setResolutionPolicy(e$.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=eb.instance.getResolutionPolicy())}},{key:"setupOrientationByScreenSize",value:function(){if(Ya){var g=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(e$.ContentStrategy.FIXED_WIDTH),g<1?this.setPortraitView():this.setLandscapeView()}}},{key:"resizeGameDiv",value:function(){var g=document.getElementById("GameDiv");if(!g)return!1;var E=ns.getScreenWidthCss(),_=ns.getScreenHeightCss(),k=g.getBoundingClientRect(),C=k.width,A=k.height;return(E!==C||_!==A)&&(g.style.width="".concat(E,"px"),g.style.height="".concat(_,"px"),!0)}},{key:"resizeGameView",value:function(){var g=ns.getScreenWidthCss(),E=ns.getScreenHeightCss();Q.emit(t4,{width:g,height:E})}},{key:"setPortraitView",value:function(){var g=X8.WIDTH,E=X8.HEIGHT;this.currentLayout=X5.Portrait,this.changeDesignResolutionSize(g,E)}},{key:"setLandscapeView",value:function(){var g=X9.WIDTH,E=X9.HEIGHT;this.currentLayout=X5.Landscape,this.changeDesignResolutionSize(g,E)}},{key:"changeDesignResolutionSize",value:function(g,E){eb.instance.setDesignResolutionSize(g,E,this.resolutionPolicy),Q.emit(t6,this.currentLayout),console.info("\uD83D\uDCF1 Change layout to",this.currentLayout)}},{key:"getScreenRatio",value:function(){return ns.getScreenWidthCss()/ns.getScreenHeightCss()}}]),e}();_._RF.pop(),_._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var Yo=GameCore,Ys=Yo.Utils,Yl=Ys.Valid,Yu=Ys.Object,Yc=Ys.Array,Yp=Yo.Dtos.Match,Yd=Yp.CustomData,Yf=Yp.Data,Yy=["code","cols","encoding","idSize","rows"],Yv=["addRandomTilesPerMove","maxSpaceOfPair"],Yg=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function(){Yd.addDefaultData(sQ),Yd.addValidateFunction("score",function(g){if(!Yl.isNumber(g)||g<0)throw new Error("score ".concat(g," is invalid"))})}},{key:"setupMatchData",value:function(){var g=this;Yf.addDefaultData(sV),Yf.addValidateFunction("extraData",function(E){if(null!=E){if(!Yl.isObject(E))throw new Error("extraData ".concat(E," must be a record of string keys"));var _=E,k=Object.keys(_);if(!Yc.has(k,"level"))throw new Error("extraData.level is missing");if(!Yl.isNumber(_.level))throw new Error("extraData.level ".concat(_.level," must be a number"));if(!Yc.has(k,"fen"))throw new Error("extraData.fen is missing");if(g.validateFen(_.fen),!Yc.has(k,"gravity"))throw new Error("extraData.gravity is missing");if(!Yl.isString(_.gravity))throw new Error("extraData.gravity ".concat(_.gravity," must be a string"));if(!Yc.has(k,"rules"))throw new Error("extraData.rules is missing");if(g.validateLevelRules(_.rules),!Yc.has(k,"time"))throw new Error("extraData.time is missing");if(!Yl.isNumber(_.time))throw new Error("extraData.time ".concat(_.time," must be a number"))}})}},{key:"validateFen",value:function(g){if(!Yl.isObject(g))throw new Error("extraData.fen ".concat(g," must be a record of string keys"));var E=this.validateKeys(g,Yy);if(!Yl.isNumber(E.idSize))throw new Error("fen.idSize must be a number");if(!Yl.isString(E.code))throw new Error("fen.code must be a string");if(!Yl.isNumber(E.rows))throw new Error("fen.rows must be a number");if(!Yl.isNumber(E.cols))throw new Error("fen.cols must be a number");if(!Yl.isObject(E.encoding))throw new Error("fen.encoding must be a record of string keys");var _=this.validateKeys(E.encoding,Yu.vals(uX));Object.entries(_).forEach(function(g){var E=et(g,2),_=E[0],k=E[1];if(!Yl.isString(k))throw new Error("fen.encoding.".concat(_," ").concat(k," must be a string"))})}},{key:"validateLevelRules",value:function(g){if(!Yl.isObject(g))throw new Error("extraData.rules ".concat(g," must be a record of string keys"));var E=this.validateKeys(g,Yv);if(!Yl.isNumber(E.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!Yl.isNumber(E.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function(g,E){return Object.keys(g).forEach(function(g){if(!Yc.has(E,g))throw new Error("Key ".concat(g," is missing"))}),g}}]),e}();_._RF.pop(),_._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var Ym=GameCore,Yb=Ym.Utils,Yw=Yb.Valid,YS=Yb.Array,YE=Yb.Object,Y_=Ym.Dtos,Yk=globalThis.game.player,YC=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var g=Y_.Player;g.Data.addDefaultData(sZ),g.GameData.addDefaultData(sW),g.GameData.addValidateFunction("stars",function(g){if(!Yw.isNumber(g)||g<0)throw new Error("stars ".concat(g," is invalid"))}),g.GameData.addValidateFunction("totalLevel",function(g){if(!Yw.isNumber(g)||g<1)throw new Error("totalLevel ".concat(g," is invalid"))}),g.GameData.addValidateFunction("levelVersion",function(g){if(!Yw.isNumber(g)||g<0)throw new Error("levelVersion ".concat(g," is invalid"))}),g.GameData.addValidateFunction("lastRewardedItems",function(g){if(!Yw.isNumber(g)||g<0)throw new Error("lastRewardedItems ".concat(g," is invalid"))}),g.GameData.addValidateFunction("lastCreateTournamentShown",function(g){if(!Yw.isNumber(g)||g<0)throw new Error("lastCreateTournamentShown ".concat(g," is invalid"))}),g.GameData.addValidateFunction("guideItemShowed",function(g){if(!Array.isArray(g))throw new Error("guideItemShowed ".concat(g," is invalid"))}),g.GameData.addValidateFunction("items",function(g){if(!Yw.isObject(g))throw new Error("items ".concat(g," is invalid"));var E=Object.keys(g),_=YE.vals(g);if(!YS.has(E,sN.HINT))throw new Error("item ".concat(sN.HINT," not found"));if(!YS.has(E,sN.THUNDER))throw new Error("item ".concat(sN.THUNDER," not found"));if(!YS.has(E,sN.STORM))throw new Error("item ".concat(sN.STORM," not found"));if(!YS.has(E,sN.PLIERS))throw new Error("item ".concat(sN.PLIERS," not found"));_.forEach(function(g){if(!Yw.isNumber(g)||g<0)throw new Error("item ".concat(g," is invalid"))})}),g.GameData.addValidateFunction("skins",function(g){if(!Yw.isObject(g))throw new Error("skins ".concat(g," is invalid"))})}},{key:"requestConnectedPlayers",value:function(){Yk.requestConnectedPlayers().catch(function(g){console.warn("player.requestConnectedPlayers",g)})}}]),e}();_._RF.pop(),_._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var YA=GameCore,YT=YA.Events,YR=YA.Utils.Valid,YI=globalThis.game,YL=YI.event,YP=YI.adaptivePerformance,YO=function(){function e(){var g=this;Fe(this,e),this.handleBeginFrame=function(){N.on(e_.EVENT_AFTER_UPDATE,g.lateUpdate),N.on(e_.EVENT_BEFORE_UPDATE,g.updateActualFPS)},this.handleAfterSceneLaunch=function(g){YP&&YP.trackingScene(g.name)},this.handleRequestResizeGame=function(g){var E=g.forcePixelRatio;YR.isNumber(E)&&Q.emit(t5,E)},this.lateUpdate=function(){var g=1e3*Q.deltaTime;null==YP||YP.updatePostStepDeltaTime(g)},this.updateActualFPS=function(){var g,E=null===(g=N.root)||void 0===g?void 0:g.fps;YR.isNumber(E)&&(null==YP||YP.updateActualFPS(E))}}return Ue(e,[{key:"init",value:function(){YP&&this.listenEvents()}},{key:"listenEvents",value:function(){YL.on(YT.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),N.once(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.on(e_.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();_._RF.pop(),_._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var YB=globalThis.game.canvasRecorder,YN=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){if(Q.canvas&&YB){YB.setCanvas(Q.canvas);var g=YB.getOptions(),E=YB.waitNextFrame;YB.waitNextFrame=Be(function(){var _;return _ts_generator(this,function(k){switch(k.label){case 0:if(!g.syncFps)return[3,1];_=new Promise(function(g){N.once(e_.EVENT_AFTER_RENDER,g),Q.pause(),Q.step()});return[3,3];case 1:Q.resume();return[4,E.call(YB)];case 2:_=(k.sent(),Promise.resolve());k.label=3;case 3:return[2,_]}})})}}}]),e}();_._RF.pop(),_._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var YD=function(){function e(){var g=this;Fe(this,e),this.hideCocosStats=function(){clearInterval(g.waiter),g.waiter=setInterval(g.checkProfilerReady,100)},this.checkProfilerReady=function(){if(ey){ey._showFPS=!1;var E=ey._rootNode;E&&(E.active=!1,E.isValid&&(E.destroyAllChildren(),E.removeAllChildren(),E.destroy(),clearInterval(g.waiter)))}}}return Ue(e,[{key:"init",value:function(){ey&&N.on(e_.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();_._RF.pop(),_._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var YM=GameCore,YF=YM.Configs.GameEngine.DynamicAssets,YU=YM.Events,Yz=YM.Utils.Array,Yx=globalThis.game,YG=Yx.event,YV=Yx.storage,YK=[".png",".jpg",".jpeg",".webp"],YH=function(){function e(){var g=this;Fe(this,e),this.isProcessing=!1,this.useHighQuality=!1,this.upgradableAssets=new Map,this.handleSceneLaunched=function(g){var E=g.sceneName,_=[s$];Yz.has(_,E)||Q.emit(nr,{quality:"highest"})},this.requestUpdateDynamicAssets=function(){Q.emit(ni,{force:!0})},this.collectUpgradableAssets=function(E){var _,k=E.output=E.input,C=YF.Resolution,A=C.Adjust,T=C.Original,R=at(k);try{for(R.s();!(_=R.n()).done;){var I=_.value;if(Yz.has(YK,I.ext)&&!g.upgradableAssets.has(I.uuid)){g.useHighQuality?(I.url=g.replaceAssetUrl(I.url),I.resolution=T,I.upgradeOnNextRequest=!0):A<T&&(I.resolution=A);var L={ext:I.ext,url:I.url,uuid:I.uuid,options:I.options,upgraded:I.upgraded,resolution:I.resolution,upgradeOnNextRequest:I.upgradeOnNextRequest};g.upgradableAssets.set(I.uuid,L)}}}catch(g){R.e(g)}finally{R.f()}},this.replaceAssetUrl=function(E){return g.useHighQuality?E.replace("native/","native32/"):E},this.handleChangeQuality=Be(function(){var E,_,k,C,A,T,R;return _ts_generator(this,function(I){switch(I.label){case 0:g.isProcessing=!0;_=[],k=at(g.upgradableAssets.values());try{for(k.s();!(E=k.n()).done;){C=E.value,A=g.processUpgradeQualityAsync(C);_.push(A)}}catch(g){k.e(g)}finally{k.f()}return[4,Promise.all(_)];case 1:T=I.sent();g.isProcessing=!1;R=T.filter(function(g){return g}).length;g.requestUpdateDynamicAssets(),console.warn("DynamicAssets: Upgradable Assets Info",{total:R,results:T});return[2]}})})}var g;return Ue(e,[{key:"init",value:function(){var g=YF.Enabled,E=YF.Resolution;console.info("DynamicAssets: init",{EDITOR:tf,Enabled:g}),g&&(eY.instance.transformPipeline.insert(this.collectUpgradableAssets,2),this.initState(),this.listenEvents(),window.requestIdleCallback=window.requestIdleCallback||function(g){g()},E.Adjust,E.Original)}},{key:"initState",value:function(){var g=globalThis.game.getBuildVersion().toString();YV.addStorage("DynamicAssets",{useHighQuality:!1,buildVersion:"0"},!0);var E=YV.getStorage("DynamicAssets"),_=null!=E?E:{},k=_.buildVersion,C=_.useHighQuality;"boolean"==typeof C&&(this.useHighQuality=C&&k===g),YV.setStorageData("DynamicAssets","buildVersion",g)}},{key:"listenEvents",value:function(){var g=this;Q.on(nr,this.handleChangeQuality),setTimeout(function(){g.useHighQuality=!0,g.autoUpgradeQuality(),YG.on(YU.SCENE_LAUNCHED,g.handleSceneLaunched)},4e3)}},{key:"autoUpgradeQuality",value:function(){var g=this;requestIdleCallback(Be(function(){var E;return _ts_generator(this,function(_){switch(_.label){case 0:if(!(!g.isProcessing&&!Q.isPaused()))return[3,2];E=tt(g.upgradableAssets.values()).find(function(g){return!g.upgraded&&!g.upgradeOnNextRequest});if(!E)return[2,(YV.setStorageData("DynamicAssets","useHighQuality",!0),void g.requestUpdateDynamicAssets())];console.info("DynamicAssets: Auto upgrade quality",E),g.isProcessing=!0;return[4,g.processUpgradeQualityAsync(E)];case 1:_.sent(),g.isProcessing=!1,g.autoUpgradeQuality();_.label=2;case 2:return[2]}})}),{timeout:1e3})}},{key:"processUpgradeQualityAsync",value:(g=Be(function(g){var E,_,k,C,A;return _ts_generator(this,function(T){E=this;if(g.upgraded||g.upgradeOnNextRequest)return[2,!0];_=eY.instance,k=_.assets,C=_.loadAny,A=k.get(g.uuid);return[2,_instanceof(A,ea)?(g.url=this.replaceAssetUrl(g.url),new Promise(function(_){C(g,g.options,function(k,C){if(k)return console.warn("DynamicAssets: Upgrade error",k),void _(!1);A.reset(C),g.upgraded=!0,E.upgradableAssets.set(g.uuid,g),Q.emit(na,{asset:A,item:g}),_(!0)})})):(console.warn("DynamicAssets: Asset not found",g.uuid),!1)]})}),function(E){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var Yq=GameCore,YW=Yq.Events,Yj=Yq.Configs.GameEngine.DynamicAtlas,YX=Yj.UsePowerOfTwo,YY=Yj.TextureAtlasOptimize,YJ=Yq.Utils,YQ=YJ.Array,YZ=YJ.Json,Y$=YJ.Object,Y0=YJ.Function,Y1=globalThis.game.event,Y2=function(){function e(){var g=this;Fe(this,e),this.atlasTexId=null,this.drawInfo=[],this.atlasInfo=null,this.lastAtlasInfo=null,this.renderTimes=[],this.lastRenderTime=0,this.renderTimeInterval=5e3,this.isEffective=!0,this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1,this.collectInfo={},this.pendingSprites={},this.checkRenderTimeHighers=function(){var E=g.getMeanRenderTime();E>8&&g.handleLaggyFrame(E),N.once(e_.EVENT_AFTER_RENDER,function(){setTimeout(g.checkRenderTimeHighers,g.renderTimeInterval)})},this.resetPendingSprites=function(){g.pendingSprites={}},this.updateBeforeRenderTime=function(){g.lastRenderTime=performance.now()},this.updateAfterRenderTime=function(){g.renderTimes.push(performance.now()-g.lastRenderTime)},this.requestUpdateDynamicAtlas=Y0.throttle(function(E){g.isProcessing||(g.isProcessing=!0,g.forceUpdateDynamicAtlas=(null==E?void 0:E.force)||!1,N.once(e_.EVENT_AFTER_RENDER,g.updateDynamicAtlas))},5e3),this.updateDynamicAtlas=function(){try{var E=N.getScene();if(!E)return;var _=g.collectPackageInfo();if(Object.keys(_).length<1)return;if(g.drawInfo=[],g.atlasInfo=null,g.generateDrawInfo(Y$.vals(_)),!g.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found");if(!g.updateAtlasData()&&!g.forceUpdateDynamicAtlas)return;var k=E.getComponentsInChildren(e1);g.refreshComponents(k)}catch(g){console.error("DynamicAtlas: Error updating dynamic atlas",g)}finally{g.isProcessing=!1,g.forceUpdateDynamicAtlas=!1}},this.generateDrawInfo=function(E){if(!(E.length<1)){console.info("DynamicAtlas: generate draw info",E);var _=E.sort(function(g,E){return E.usageCount-g.usageCount}),k=eZ.instance.textureSize;if(g.calculateOptimizedAtlas(_,k),g.atlasInfo){var C,A=g.atlasInfo.textures,T=at(A);try{for(T.s();!(C=T.n()).done;){var R=C.value;g.drawInfo.push(R)}}catch(g){T.e(g)}finally{T.f()}var I=_.filter(function(g){return!A.some(function(E){return E.id===g.id})});I.length>0&&(console.warn("DynamicAtlas: Missing textures",I),g.generateDrawInfo(I))}else console.warn("DynamicAtlas: Atlas info not found",{textures:_})}},this.calculateOptimizedAtlas=function(E,_){var k=function(g){var E,_=0,k=0,C=at(g);try{for(C.s();!(E=C.n()).done;){var A=E.value;_+=A.w*A.h,k=Math.max(k,A.w)}}catch(g){C.e(g)}finally{C.f()}g.sort(function(g,E){return E.h-g.h});var T,R=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(_/.95)),k),h:1/0}],I=0,L=0,P=at(g);try{for(P.s();!(T=P.n()).done;)for(var O=T.value,B=R.length-1;B>=0;B--){var N=R[B];if(!(O.w>N.w||O.h>N.h)){if(O.x=N.x,O.y=N.y,L=Math.max(L,O.y+O.h),I=Math.max(I,O.x+O.w),O.w===N.w&&O.h===N.h){var D=R.pop();B<R.length&&(R[B]=D)}else O.h===N.h?(N.x+=O.w,N.w-=O.w):O.w===N.w?(N.y+=O.h,N.h-=O.h):(R.push({x:N.x+O.w,y:N.y,w:N.w-O.w,h:O.h}),N.y+=O.h,N.h-=O.h);break}}}catch(g){P.e(g)}finally{P.f()}return{w:I,h:L,fill:_/(I*L)||0}}(E),C=k.w,A=k.h,T=k.fill;if(T<.6)console.warn("DynamicAtlas: Fill rate is too low",T,tt(E));else{if(C>_||A>_)return console.warn("DynamicAtlas: Packed size is bigger than atlas size",C,A,_),void(E.pop()?g.calculateOptimizedAtlas(E,_):console.warn("DynamicAtlas: Texture size is too big",C,A,_));g.atlasInfo={textures:E,atlasSize:_,packedInfo:{width:Math.round(C),height:Math.round(A),fillRate:T}}}},this.drawTexture=function(E,_,k){var C=_.texture,A=C.image;if(!A||A.width<1||A.height<1)console.warn("DynamicAtlas: Texture image not found",C);else if(!A.data||A.data.width<1||A.data.height<1)console.warn("DynamicAtlas: Texture image data not found",A);else{var T=C.getId(),R=YQ.search(tt(g.drawInfo),function(g){return g.id===T})||{x:-1,y:-1},I=R.x,L=R.y;if(!(I<0||L<0)){var P=E._innerTextureInfos[T];P||(k&&(E._texture.drawTextureAt(A,I-1,L),E._texture.drawTextureAt(A,I+1,L),E._texture.drawTextureAt(A,I,L-1),E._texture.drawTextureAt(A,I,L+1)),E._texture.drawTextureAt(A,I,L),E._count++,E._innerTextureInfos[T]={texture:C,x:I,y:L});var O=_.rect,B=O.x,N=O.y;B+=(null==P?void 0:P.x)||I,N+=(null==P?void 0:P.y)||L;var D={texture:E._texture,x:B,y:N};return E._innerSpriteFrames.push(_),D}g.pendingSprites[_.uuid]=_}},this.refreshComponents=function(g){var E,_=at(g);try{for(_.s();!(E=_.n()).done;){var k=E.value;k.node.active&&(k.node.active=!1,k.node.active=!0)}}catch(g){_.e(g)}finally{_.f()}},this.isSameAtlas=function(g,E){if(!g||!E)return!1;var _=g.packedInfo,k=g.textures,C=E.packedInfo,A=E.textures;return _.width===C.width&&_.height===C.height&&k.length===A.length&&k.every(function(g,E){var _=g.id,k=g.w,C=g.h,T=A[E],R=T.id,I=T.w,L=T.h;return _===R&&k===I&&C===L})}}return Ue(e,[{key:"init",value:function(){YY&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:YY}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){var g=this;Q.on(ni,this.requestUpdateDynamicAtlas),N.on(e_.EVENT_BEFORE_SCENE_LAUNCH,this.resetPendingSprites),Y1.once(YW.GAME_READY,function(){g.setupRenderListeners()})}},{key:"setupRenderListeners",value:function(){var g=this;N.on(e_.EVENT_BEFORE_RENDER,this.updateBeforeRenderTime),N.on(e_.EVENT_AFTER_RENDER,this.updateAfterRenderTime),Y1.once(YW.SCENE_LAUNCHED,function(){N.once(e_.EVENT_AFTER_RENDER,g.checkRenderTimeHighers)})}},{key:"handleLaggyFrame",value:function(g){console.warn("DynamicAtlas: Laggy frame detected, render time: ".concat(g.toFixed(2),"ms")),this.isEffective||(this.renderTimeInterval=Math.min(this.renderTimeInterval+1e3,1e4),console.warn("DynamicAtlas: Atlas update not effective. Increased interval: ".concat(this.renderTimeInterval,"ms"))),this.requestUpdateDynamicAtlas()}},{key:"getMeanRenderTime",value:function(){var g,E=0,_=at(this.renderTimes);try{for(_.s();!(g=_.n()).done;)E+=g.value}catch(g){_.e(g)}finally{_.f()}return E/=this.renderTimes.length,this.renderTimes=[],E}},{key:"overrideDynamicAtlas",value:function(){var g=this,E=eZ.instance;eZ.instance.insertSpriteFrame=function(_){if(E._atlasIndex>=E._maxAtlasCount)return null;if(!_||_.original)return console.warn("DynamicAtlas: Skip original texture",_),null;if(!_.packable)return console.warn("DynamicAtlas: Skip non-packable texture",_),null;var k=g.getAtlas(),C=k?k.insertSpriteFrame(_):null;return!C&&E._atlasIndex<E._maxAtlasCount&&(C=(k=g.getAtlas())?k.insertSpriteFrame(_):null),C}}},{key:"createAtlas",value:function(){return eZ.instance.newAtlas()}},{key:"getAtlas",value:function(){var g=this,E=eZ.instance,_=E._atlases,k=void 0===_?[]:_,C=E._atlasIndex,A=E.textureBleeding,T=k[C];return T||(T=this.createAtlas()),T?(T.originalInsertSpriteFrame||(T.originalInsertSpriteFrame=T.insertSpriteFrame,T.insertSpriteFrame=function(E){return g.drawTexture(T,E,A)}),this.atlasTexId=T._texture.getId(),T):null}},{key:"collectPackageInfo",value:function(){var g,E={},_=at(Y$.vals(this.pendingSprites));try{for(_.s();!(g=_.n()).done;){var k=g.value;if(this.isValidSpriteFrame(k)){var C=k.texture,A=k.original,T=C.getId(),R=null==A?void 0:A._texture.getId();T!==R?(R&&(T=R),this.collectInfo[T]||this.initializeCollectInfo(T,k),this.collectInfo[T].usageCount++,E[T]=this.collectInfo[T]):console.warn("DynamicAtlas: Skip original texture",{texId:T,oriTexId:R})}}}catch(g){_.e(g)}finally{_.f()}return E}},{key:"isValidSpriteFrame",value:function(g){var E=g.packable,_=g.texture,k=g.original,C=g.name,A=g.uuid;if(!E)return console.warn("DynamicAtlas: Skip non-packable texture",C,A),!1;if(!_instanceof(_,e0))return console.warn("DynamicAtlas: Skip non-texture2d texture",C,A),!1;var T=null==k?void 0:k._texture.getId();return this.atlasTexId!==T||(console.warn("DynamicAtlas: Skip texture in atlas",C,A),!1)}},{key:"initializeCollectInfo",value:function(g,E){var _=E.texture,k=E.original,C=E.uuid,A=_.width,T=_.height,R=(null==k?void 0:k._texture)||{width:0,height:0},I=R.width,L=R.height,P=Math.max(A,I)+2,O=Math.max(T,L)+2;P<=1||O<=1?console.warn("DynamicAtlas: Skip invalid texture size",C,{w:P,h:O}):this.collectInfo[g]={id:g,w:P,h:O,x:-1,y:-1,usageCount:0,name:C}}},{key:"updateAtlasData",value:function(){if(!this.atlasInfo)return!1;if(this.lastAtlasInfo&&!this.forceUpdateDynamicAtlas){var g=this.isSameAtlas(this.lastAtlasInfo,this.atlasInfo);if(this.isEffective=!g,g)return console.warn("DynamicAtlas: Last update dynamic atlas is not effective"),!1}console.info("DynamicAtlas: atlas info",this.atlasInfo);var E=this.getAtlas();if(!E||!E._texture)return!1;var _=this.atlasInfo.packedInfo,k=E._texture,C=k.width,A=k.height,T=_.width+20,R=_.height+20,I=Math.max(T,R),L=YX?I:T;return(C!==L||A!==L)&&(eZ.instance.reset(),!(!(E=this.getAtlas())||!E._texture)&&(YX?(E._texture.initWithSize(L,L),console.info("DynamicAtlas: Resize atlas (PO2)",L,E)):(E._texture.initWithSize(T,R),console.info("DynamicAtlas: Resize atlas",T,R,E)),this.lastAtlasInfo=YZ.clone(this.atlasInfo),!0))}}]),e}();_._RF.pop();var Y4={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};_._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var Y3=GameCore.Events,Y5=globalThis.game,Y6=Y5.event,Y8=Y5.language,Y9=function(){function e(){var g=this;Fe(this,e),this.handleLanguageChanged=function(){var E=Be(function(E){var _;return _ts_generator(this,function(k){_=E.locale;Q.emit("update-language",_),g.updateComponentInEditor();return[2]})});return function(g){return E.apply(this,arguments)}}()}var g,_,k;return Ue(e,[{key:"init",value:function(){var g=this;this.addLanguage("en").then(function(){g.setLanguage("en"),g.listenEvent()})}},{key:"listenEvent",value:function(){Y6.on(Y3.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(k=Be(function(g){var E;return _ts_generator(this,function(_){switch(_.label){case 0:return[4,this.getLangData(g)];case 1:E=_.sent();Y8.add(g,E);return[2]}})}),function(g){return k.apply(this,arguments)})},{key:"setLanguage",value:function(g){Y8.choose(g)}},{key:"getLangData",value:(_=Be(function(g){return _ts_generator(this,function(E){switch(g){case"en":return[2,Y4];case"ru":return[2,this.loadLanguageAsync(g)];default:throw new Error("Language ".concat(g," not supported"))}return[2]})}),function(g){return _.apply(this,arguments)})},{key:"loadLanguageAsync",value:(g=Be(function(g){var _;return _ts_generator(this,function(k){switch(k.label){case 0:return[4,E.import("db://assets/resources/locales/".concat(g,".json"))];case 1:_=k.sent().default;Y8.add(g,_);return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"updateComponentInEditor",value:function(){}}]),e}();_._RF.pop(),_._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var Y7=GameCore,Jt=Y7.Configs,Jn=Jt.Mockup,Ji=Jn.Leaderboards,Ja=Jn.GameSDK.Player,Jr=Jt.Leaderboards,Jo=Y7.Utils.Number,Js=globalThis.game.leaderboard,Jl=function(){function e(){var g=this;Fe(this,e),this.handleWhenGameSDKStarted=function(){Ji.Enabled?g.setupLeaderboardsMockup():g.setupLeaderboards()}}var g,E,_,k,C;return Ue(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(C=Be(function(){return _ts_generator(this,function(g){this.setupLeaderboardByConfigs();return[2]})}),function(){return C.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var g=Jr.LeaderboardId;g?(Js.addLeaderboard({name:sj,type:"global",autoSortRank:!0,leaderboardId:g}),Js.addLeaderboard({name:sX,type:"friends",autoSortRank:!0,leaderboardId:g})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(k=Be(function(){return _ts_generator(this,function(g){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard();return[2]})}),function(){return k.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(_=Be(function(){var g,E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:g=sj,E=sY,_=Ji.NumOfLeaders;return[4,Js.createLeaderboardAsync({_id:E,name:g,numberOfLeaders:Jo.random(_.Max-_.Min)+_.Min})];case 1:k=A.sent();Js.addLeaderboard({name:g,type:"global",autoSortRank:!0,leaderboardId:k});return[4,Js.requestLeaderboardAsync(g,10)];case 2:A.sent();C=Js.getLeaderboard(g);console.info("setupGlobalLeaderboard fetch new",C,C&&Object.keys(C.leaders).length),C=Js.getLeaderboard(g),console.info("setupGlobalLeaderboard load more",C,C&&Object.keys(C.leaders).length);return[2]}})}),function(){return _.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(E=Be(function(){var g,E,_,k,C,A;return _ts_generator(this,function(T){switch(T.label){case 0:g=sX,E=sJ,_=0,k=Ja.ConnectedPlayers;k.Enabled&&(_=Jo.random(k.NumOfPlayers-1)+1);return[4,Js.createLeaderboardAsync({_id:E,name:g,numberOfLeaders:_})];case 1:C=T.sent();Js.addLeaderboard({name:g,type:"friends",autoSortRank:!0,leaderboardId:C});return[4,Js.requestLeaderboardAsync(g,10)];case 2:T.sent();A=Js.getLeaderboard(g);console.info("setupFriendsLeaderboard done",A);return[2]}})}),function(){return E.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(g=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:return[4,ur.requestTournamentDataAsync()];case 1:g=E.sent();g.forEach(function(g){var E=g.payload.leaderboardId;E&&(Js.isExistLeaderboardId(E)||Js.addLeaderboard({type:"tournament",name:E,autoSortRank:!0,leaderboardId:E}))}),console.info("setupGlobalTournamentLeaderboard done",g);return[2]}})}),function(){return g.apply(this,arguments)})}]),e}();_._RF.pop(),_._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var Ju=GameCore,Jh=Ju.Utils,Jp=Ju.Events,Jd=Ju.Configs.PerformanceMonitor.FpsTracking,Jf=globalThis.game.event,Jy=function(){function e(){var g=this;Fe(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){g.startTraceFps(),N.on(e_.EVENT_AFTER_UPDATE,g.handleLateUpdate)},this.handleLateUpdate=function(){if(g.mark){if(g.fpsTraceDuration-=Q.deltaTime,g.fpsTraceDuration<=0&&!g.traceStopped)return g.traceStopped=!0,g.unListenEvents(),g.updateFPS(),void g.mark.stop(g.markName);g.fpsTraceIntervalTimer-=Q.deltaTime,g.fpsTraceIntervalTimer>0||(g.fpsTraceIntervalTimer=g.fpsTraceInterval,g.updateFPS(),g.mark.stop(g.markName),g.startTraceFps())}}}return Ue(e,[{key:"mark",get:function(){return Jd.Enabled?Jh.Mark:null}},{key:"init",value:function(){var g=Jd.TrackingDuration,E=Jd.TrackingInterval;this.fpsTraceDuration=null!=g?g:60,this.fpsTraceInterval=null!=E?E:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){Jf.once(Jp.GAME_READY,this.handleStartTraceFps)}},{key:"unListenEvents",value:function(){N.off(e_.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var g,E;if(this.mark){var _=this.getFPS(),k=this.getDrawCalls(),C=this.getDeviceRender(),A=this.getTextureMemory();this.minFps=Math.min(null!==(g=this.minFps)&&void 0!==g?g:_,_),this.maxFps=Math.max(null!==(E=this.maxFps)&&void 0!==E?E:0,_),this.mark.putMetric(this.markName,"FPS Metric",_),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",C),this.mark.putAttr(this.markName,"Draw Calls",k.toString()),this.mark.putAttr(this.markName,"Texture Memory",A.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info("FPS: ".concat(_," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(k,", texture memory: ").concat(A.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!N.root)return 0;var g=N.root.fps;return Math.floor(g)||0}},{key:"getDrawCalls",value:function(){return N.root&&N.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return N.root&&N.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return N.root&&N.root.device.memoryStatus.textureSize/1048576||0}}]),e}();_._RF.pop(),_._RF.push({},"d5789HUcoJBYr7E3NOGuQyN","Profiler",void 0);var Jv=GameCore,Jg=Jv.Utils.Valid,Jm=Jv.Configs.Debugger.Profiler,Jb=globalThis.game.event,Jw=function(){function e(){var g=this;Fe(this,e),this.isUpdated=!1,this.isPost=!1,this.isDrawn=!1,this.isCommitted=!1,this.isRendered=!1,this.isFramed=!1,this.waitOptions={timeout:0,checkInterval:1},this.initState=function(){g.isFramed=!1,g.isUpdated=!1,g.isDrawn=!1,g.isCommitted=!1,g.isRendered=!1,g.isPost=!1},this.startTraceLoop=function(){g.clearLoopEvents(),g.initState(),g.useTickAsync(),g.listenLoopEvents()},this.handleBeginFrame=function(){g.measure("Frame",g.processBeginFrame)},this.processBeginFrame=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isFramed=!1,console.time("Frame");return[4,Jg.isValueChangeAsync(function(){return g.isFramed},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Frame");return[2]}})}),this.handleBeforeUpdate=function(){g.measure("Update",g.processBeforeUpdate)},this.processBeforeUpdate=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isUpdated=!1,console.time("Update");return[4,Jg.isValueChangeAsync(function(){return g.isUpdated},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Update");return[2]}})}),this.handleAfterUpdate=function(){g.isUpdated=!0},this.handleBeforeDraw=function(){g.measure("Draw",g.processBeforeDraw)},this.processBeforeDraw=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isDrawn=!1,console.time("Draw");return[4,Jg.isValueChangeAsync(function(){return g.isDrawn},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Draw");return[2]}})}),this.handleBeforeCommit=function(){g.measure("Commit",g.processBeforeCommit)},this.processBeforeCommit=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isCommitted=!1,console.time("Commit");return[4,Jg.isValueChangeAsync(function(){return g.isCommitted},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Commit");return[2]}})}),this.handleBeforeRender=function(){g.isCommitted=!0,g.measure("Render",g.processBeforeRender)},this.processBeforeRender=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isRendered=!1,console.time("Render");return[4,Jg.isValueChangeAsync(function(){return g.isRendered},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Render");return[2]}})}),this.handleAfterRender=function(){g.isRendered=!0},this.handleAfterDraw=function(){g.isDrawn=!0,g.measure("Post",g.processPost)},this.processPost=Be(function(){return _ts_generator(this,function(E){switch(E.label){case 0:g.isPost=!1,console.time("Post");return[4,Jg.isValueChangeAsync(function(){return g.isPost},!0,g.waitOptions)];case 1:E.sent(),console.timeEnd("Post");return[2]}})}),this.handleEndFrame=function(){g.isPost=!0,g.isFramed=!0,g.restoreTick()}}var g,E;return Ue(e,[{key:"profiler",get:function(){return globalThis.game.profiler}},{key:"init",value:function(){Jm.Enabled&&(this.initState(),this.addTickAsync(),this.listenEvents())}},{key:"addTickAsync",value:function(){var g=this;N.originalTick=N.tick,N.tickAsync=function(){var E=Be(function(E){var _,k,A,T,R,I;return _ts_generator(this,function(L){switch(L.label){case 0:if(!!this._invalid)return[3,8];return[4,g.emitAsync(e_.EVENT_BEGIN_FRAME)];case 1:if(L.sent(),!!this._paused)return[3,4];return[4,g.emitAsync(e_.EVENT_BEFORE_UPDATE)];case 2:L.sent(),this._compScheduler.startPhase(),this._compScheduler.updatePhase(E);for(k=0;k<this._systems.length;++k)this._systems[k].update(E);this._compScheduler.lateUpdatePhase(E);return[4,g.emitAsync(e_.EVENT_AFTER_UPDATE)];case 3:L.sent(),e2._deferredDestroy();for(A=0;A<this._systems.length;++A)this._systems[A].postUpdate(E);L.label=4;case 4:return[4,g.emitAsync(e_.EVENT_BEFORE_DRAW)];case 5:L.sent();T=null===(_=N.getScene())||void 0===_?void 0:_.getComponentsInChildren("UIRenderer");if(!T)return[3,8];I=at(T);try{for(I.s();!(R=I.n()).done;)R.value.updateRenderer()}catch(g){I.e(g)}finally{I.f()}this._root.frameMove(E);return[4,g.emitAsync(e_.EVENT_AFTER_DRAW)];case 6:L.sent(),C.resetHasChangedFlags(),C.clearNodeArray();return[4,g.emitAsync(e_.EVENT_END_FRAME)];case 7:L.sent(),this._totalFrames++;L.label=8;case 8:return[2]}})});return function(g){return E.apply(this,arguments)}}()}},{key:"emitAsync",value:(E=Be(function(g){var E,_,k,C,A,T,R;var I=arguments;return _ts_generator(this,function(L){switch(L.label){case 0:for(E=I.length,_=new Array(E>1?E-1:0),k=1;k<E;k++)_[k-1]=I[k];return[4,this.waitEvent.apply(this,[g].concat(_))];case 1:L.sent(),N.emit.apply(N,[g].concat(_));A=this.getListeners(g),T=at(A);try{for(T.s();!(C=T.n()).done;){R=C.value;R.check=R.originalCheck}}catch(g){T.e(g)}finally{T.f()}return[2]}})}),function(g){return E.apply(this,arguments)})},{key:"useTickAsync",value:function(){N.tick=N.tickAsync}},{key:"restoreTick",value:function(){N.tick=N.originalTick}},{key:"getListeners",value:function(g){return N._callbackTable[g].callbackInfos||[]}},{key:"waitEvent",value:(g=Be(function(g){var E,_,k,C,A;var T=arguments;return _ts_generator(this,function(R){for(E=T.length,_=new Array(E>1?E-1:0),k=1;k<E;k++)_[k-1]=T[k];C=this.getListeners(g);if(0!==C.length){A=C.map(function(E){var k=E.target,C=E.callback;return E.originalCheck||(E.originalCheck=E.check),E.check=function(){return!1},new Promise(function(E){var A="Wait ".concat(g," (").concat(k,":").concat(C.name,")");console.time(A),k?C.call.apply(C,[k].concat(_)):C.apply(void 0,_),E(!0),console.timeEnd(A)})});return[2,Promise.all(A)]}return[2]})}),function(E){return g.apply(this,arguments)})},{key:"listenEvents",value:function(){Jb.on("render",this.startTraceLoop)}},{key:"listenLoopEvents",value:function(){N.once(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.once(e_.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),N.once(e_.EVENT_AFTER_UPDATE,this.handleAfterUpdate),N.once(e_.EVENT_BEFORE_DRAW,this.handleBeforeDraw),N.once(e_.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),N.once(e_.EVENT_BEFORE_RENDER,this.handleBeforeRender),N.once(e_.EVENT_AFTER_RENDER,this.handleAfterRender),N.once(e_.EVENT_AFTER_DRAW,this.handleAfterDraw),N.once(e_.EVENT_END_FRAME,this.handleEndFrame)}},{key:"clearLoopEvents",value:function(){N.off(e_.EVENT_BEGIN_FRAME,this.handleBeginFrame),N.off(e_.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),N.off(e_.EVENT_AFTER_UPDATE,this.handleAfterUpdate),N.off(e_.EVENT_BEFORE_DRAW,this.handleBeforeDraw),N.off(e_.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),N.off(e_.EVENT_BEFORE_RENDER,this.handleBeforeRender),N.off(e_.EVENT_AFTER_RENDER,this.handleAfterRender),N.off(e_.EVENT_AFTER_DRAW,this.handleAfterDraw),N.off(e_.EVENT_END_FRAME,this.handleEndFrame)}},{key:"measure",value:function(g,E,_){var k,C=!(arguments.length>2&&void 0!==_)||_;null===(k=this.profiler)||void 0===k||k.measureCode({name:g,isAsync:C,profile:g,callback:E})}}]),e}();_._RF.pop(),_._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var JS=GameCore.Events,JE=globalThis.game.event,J_=function(){function e(){Fe(this,e),this.handleHotReload=function(){Q.restart()},this.handleUpdateConfig=function(g){if("Gameplay"===g.type){Q.emit(t8,g.config);var E=g.id,_=g.type;JE.emit(JS.REMOTE_CONFIG_UPDATED,{id:E,type:_})}}}return Ue(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){JE.on(JS.REQUEST_HOT_RELOAD,this.handleHotReload),JE.on(JS.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();_._RF.pop(),_._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var Jk=function(){function e(){Fe(this,e)}return Ue(e,[{key:"init",value:function(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}},{key:"initProfiler",value:function(){(new Jw).init()}},{key:"initLanguages",value:function(){(new Y9).init()}},{key:"initCocosStats",value:function(){(new YD).init()}},{key:"initLeaderboards",value:function(){(new Jl).init()}},{key:"initRemoteConfig",value:function(){(new J_).init()}},{key:"initDynamicAtlas",value:function(){(new Y2).init()}},{key:"initDynamicAssets",value:function(){(new YH).init()}},{key:"initCanvasRecorder",value:function(){(new YN).init()}},{key:"initPerformanceMonitor",value:function(){(new Jy).init()}},{key:"initAdaptivePerformance",value:function(){(new YO).init()}}]),e}();_._RF.pop(),_._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var JC=globalThis.game,JA=JC.event,JT=JC.monitorError,JR=GameCore,JI=JR.Events,JL=JR.Configs.PerformanceMonitor,JP=JR.Utils.Mark,JO=function(){function e(){var g=this;Fe(this,e),this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var E=Be(function(E){var _,k,C;return _ts_generator(this,function(A){_=E.sceneName,k=E.sceneData,C=g.correctSceneName(_);console.info("Switching",C,null!=k?k:{}),C&&(l5.showLoadingFullScreen(C),g.startScene({sceneName:C,sceneData:k}));return[2]})});return function(g){return E.apply(this,arguments)}}(),this.preloadScene=function(E,_){var k=E.sceneName;g.startMeasure(k),N.preloadScene(k,g.onSceneProgress,g.onScenePreloaded(k,_))},this.startMeasure=function(E){g.mark&&(g.queueLoadScene[E]&&(g.mark.putAttr(g.markName,"Canceled","true"),g.stopMeasure(E)),console.groupCollapsed("\uD83D\uDCE6 ".concat(E,": loading progress")),g.mark.measure(g.markName),g.mark.putAttr(g.markName,"Cancel","false"),g.mark.putAttr(g.markName,"Success","false"),g.mark.putMetric(g.markName,E),g.mark.start(g.markName),g.queueLoadScene[E]=!0)},this.stopMeasure=function(E){g.mark&&g.queueLoadScene[E]&&(g.mark.rmAttr(g.markName,"File"),g.mark.putAttr(g.markName,"Success","true"),g.mark.stop(g.markName),g.queueLoadScene[E]=!1,console.groupEnd())},this.onSceneProgress=function(E,_,k){var C=E/_;g.mark&&g.mark.putAttr(g.markName,"Last File","".concat(k.id," (").concat(k.ext,")"));var A=Math.floor(70*C+30);GameSDK.setLoadingProgress(A)},this.onScenePreloaded=function(g,E){return function(_){_?console.warn("SceneManager.onScenePreloaded",{sceneName:g,error:_}):(E&&E(g,_),JA.emit(JI.SCENE_LOADED,{sceneName:g,isPreload:!0}))}},this.onDirectorLoadScene=function(E){return function(_,k){if(_)console.warn("SceneManager.onSceneLoaded",_);else if(null!=k&&k.scene){var C=k.name;g.handleBeforeSceneLaunch(k,E)(),N.once(e_.EVENT_AFTER_SCENE_LAUNCH,g.handleSceneLaunched(C,E))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(E,_){return function(){g.setSceneData(E,null!=_?_:{}),Q.emit(t5),JA.emit(JI.SCENE_LOADED,{sceneName:E.name})}},this.handleSceneLaunched=function(E,_){return function(){var k;l5.hideLoadingFullScreen(E),iC.switchSceneTracking(),null==JT||JT.addMetadata({currentScene:E}),null===(k=g.callbackSwitchScene)||void 0===k||k.call(g,{sceneName:E,sceneData:_}),JA.emit(JI.SCENE_LAUNCHED,{sceneName:E})}},this.handleSceneLoaded=function(E){var _=E.sceneName;g.stopMeasure(_)}}return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){JA.on(JI.SWITCH_SCENE,this.switchScene),JA.on(JI.PRELOAD_SCENE,this.preloadScene),JA.on(JI.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(g){var E=this.getCurrentScene();return E&&g===E.name?null:g}},{key:"startScene",value:function(g){var E=this,_=g.sceneName,k=g.sceneData;this.preloadScene({sceneName:_},function(g,C){g===_&&(C?console.warn("SceneManager.startScene",{sceneName:_,error:C}):N.loadScene(_,E.onDirectorLoadScene(k)))})}},{key:"mark",get:function(){return JL.LoadResources?JP:null}},{key:"getCurrentScene",value:function(){return N.getScene()}},{key:"getLoadedScenes",value:function(){var g=this,E=[];return Object.keys(this.queueLoadScene).map(function(_){g.queueLoadScene[_]||E.push(_)}),E}},{key:"onSwitchScene",value:function(g){this.callbackSwitchScene=g}},{key:"setSceneData",value:function(g,E){if(E&&("data"in g||g.scene.attr({data:{}}),"data"in g)){var _=g.data||{};g.scene.attr({data:De(De({},_),E)}),console.info("SceneManager.setSceneData",{sceneName:g.name,sceneData:E,currentData:_})}}}]),e}();_._RF.pop(),_._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var JB=globalThis.game,JN=JB.event,JD=JB.monitorError,JM=GameCore,JF=JM.Events,JU=JM.Utils.Object,Jz=function(){function e(){var g=this;Fe(this,e),this.screens={},this.handleOpenScreen=function(E){var _=E.screenName,k=E.screenData;g.openScreen(_,k)},this.handleCloseScreen=function(E){var _=E.screenName;g.closeScreen(_)}}var g,E,_,k;return Ue(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){JN.on(JF.OPEN_SCREEN,this.handleOpenScreen),JN.on(JF.CLOSE_SCREEN,this.handleCloseScreen)}},{key:"reorderScreens",value:function(){var g=JU.vals(this.screens).filter(function(g){return"ready"===g.state});g.sort(function(g,E){return g.order-E.order});for(var E=0;E<g.length;E++){var _=g[E];_.order=E,_.comp.node.setSiblingIndex(_.order)}}},{key:"addScreenKeys",value:function(g,E){var _=this;g.forEach(function(g,k){_.screens[iw[g]]&&(_.screens[iw[g]].order=k),_.screens[iw[g]]={state:"key",parent:E,key:g,order:k}})}},{key:"addScreens",value:function(g){var E=this;g.forEach(function(g,_){E.screens[g.node.name]={state:"ready",comp:g,order:_}})}},{key:"preloadScreens",value:(k=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:g=JU.vals(this.screens).reduce(function(g,E){if("key"===E.state){var _=ie.loadPrefabAsync("screens/".concat(iw[E.key]));g.push(_)}return g},[]);return[4,Promise.all(g)];case 1:return[2,E.sent()]}})}),function(){return k.apply(this,arguments)})},{key:"getScreen",value:(_=Be(function(g){var E,_,k,C,A,T,R;return _ts_generator(this,function(L){switch(L.label){case 0:E=this.screens[g];if(null==E)return[2,(null==JD||JD.sendException(new Error("ScreenManager.openScreen Screen ".concat(g," not found")),{screenName:g,screens:this.getScreensAsMetadata()}),null)];if("ready"===E.state)return[2,E.comp];console.info("ScreenManager.getScreen","Screen ".concat(g," not found in cache, instantiating it..."));_=E.parent,k=E.key,C=E.order;return[4,ie.loadPrefabAsync("screens/".concat(iw[k]))];case 1:A=L.sent();if(!A)return[2,(null==JD||JD.sendException(new Error("ScreenManager.getScreen: Failed to load Screen ".concat(g," prefab...")),{screenName:g,screens:this.getScreensAsMetadata()}),null)];T=I(A);T.name=g,_.addChild(T),T.active=!1;R=T.getComponent(zK);return[2,R?(this.screens[g]={state:"ready",comp:R,order:C},this.reorderScreens(),R):(null==JD||JD.sendException(new Error("ScreenManager.getScreen: Screen ".concat(g," prefab doesn't have BaseScreen component...")),{screenName:g,screens:this.getScreensAsMetadata()}),null)]}})}),function(g){return _.apply(this,arguments)})},{key:"getScreensAsMetadata",value:function(){var g=this;return Object.keys(this.screens).map(function(E){var _=g.screens[E];return"ready"===_.state?"".concat(_.comp.node.name,"(loaded)"):"".concat(iw[_.key],"(not-loaded)")}).join(", ")}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:(E=Be(function(g,E){var _,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,3,,4]);ie.setBlockInput(!0);return[4,this.getScreen(g)];case 1:_=A.sent();if(ie.setBlockInput(!1),null==_||!_.node)return[2,void console.warn("ScreenManager.openScreen","Screen ".concat(g," not found"))];_.node.active=!0,_.node.setPosition(new em(0,0,0));k={screenName:g,screenData:E};JN.emit(JF.OPENING_SCREEN,k),iC.trackCurrentPage(g,!0),null==JD||JD.addMetadata({currentScreen:g});return[4,tZ.waitTweenAsync(0)];case 2:A.sent(),_.open(E),JN.emit(JF.OPENED_SCREEN,k);return[3,4];case 3:C=A.sent();console.error("ScreenManager.openScreen",C);return[3,4];case 4:return[2]}})}),function(g,_){return E.apply(this,arguments)})},{key:"closeScreen",value:(g=Be(function(g){var E,_,k,C;return _ts_generator(this,function(A){switch(A.label){case 0:A.trys.push([0,2,,3]);return[4,this.getScreen(g)];case 1:_=A.sent();if(!_)return[2,void console.warn("ScreenManager.closeScreen","Screen ".concat(g," not found"))];if(null===(E=_.node)||void 0===E||!E.active)return[2];k={screenName:g};JN.emit(JF.CLOSING_SCREEN,k),_.close(),iC.trackCurrentPage(g,!1),null==JD||JD.removeMetadata("currentScreen");return[3,3];case 2:C=A.sent();console.error("ScreenManager.closeScreen",C);return[3,3];case 3:return[2]}})}),function(E){return g.apply(this,arguments)})},{key:"closeAllScreens",value:function(){for(var g in this.screens)"ready"===this.screens[g].state&&this.closeScreen(g)}}]),e}();_._RF.pop(),_._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var Jx=GameCore,JG=Jx.Configs.Core,JV=Jx.Events,JK=Jx.Plugins.Analytics.Events,JH=globalThis.game,Jq=JH.context,JW=JH.storage,Jj=JH.event,JX=JH.analytics,JY=JH.monitorError;new(function(){function e(){var g=this;Fe(this,e),this.coreManager=new Xj,this.adsManager=new XV,this.matchManager=new Yg,this.sceneManager=new JO,this.screenManager=new Jz,this.engineManager=new X1,this.layoutManager=new Yr,this.playerManager=new YC,this.pluginsManager=new Jk,this.handleWhenCoreBoot=function(){Q.inited?g.handleCocosInit():Q.once(e4.EVENT_POST_PROJECT_INIT,g.handleCocosInit)},this.handleCocosInit=function(){g.coreManager.requestStart()},this.handleWhenCoreStart=function(){g.playerManager.setupDefaultGameData(),g.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){g.initPlugins(),console.groupEnd(),JX.event(JK.LOAD_START),JG.StartSDKAfterLoadGame?Jj.once(JV.SCENE_LOADED,g.handleStartGameWhenMainSceneReady):g.processStartGame(),g.preloadScenes()},this.handleStartGameWhenMainSceneReady=function(){g.processStartGame()},this.handleSwitchScene=function(E){var _=E.sceneName,k=g.sceneManager.getCurrentScene();if((null==k?void 0:k.name)===_){g.screenManager.closeAllScreens(),g.screenManager.clearScreens();var C=null==k?void 0:k.getComponentsInChildren(zK);if(C.length>0){var A=C.map(function(g){return g.node.name}).join(", ");console.info("\uD83D\uDCFA Loaded Screens in ".concat(_,": ").concat(A)),g.screenManager.addScreens(C)}var T=null==k?void 0:k.getComponentInChildren(xa);if(T){var R=T.screenKeys.filter(function(g){return!C.some(function(E){return E.node.name===iw[g]})});if(0!==R.length){var I=R.map(function(g){return iw[g]}).join(", ");console.info("\uD83D\uDCFA Lazy-loading Screens in ".concat(_,": ").concat(I)),g.screenManager.addScreenKeys(R,T.node),g.screenManager.preloadScreens()}}}},console.groupCollapsed("\uD83D\uDCE6 Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}var g,E,_;return Ue(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.adsManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"preloadScenes",value:function(){"solo"===JW.getStorageData("context","sessionContextType")?lV.preloadDashboardScene():lV.preloadGameScene()}},{key:"processStartGame",value:(_=Be(function(){return _ts_generator(this,function(g){switch(g.label){case 0:console.groupEnd(),JX.event(JK.LOAD_COMPLETE);return[4,this.startGameAsync()];case 1:g.sent(),this.startProcessContextData();return[2]}})}),function(){return _.apply(this,arguments)})},{key:"startGameAsync",value:(E=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:E.trys.push([0,2,,3]);return[4,GameSDK.startGameAsync()];case 1:E.sent();return[3,3];case 2:g=E.sent();console.warn("GameSDK.startGameAsync",g),_instanceof(g,Error)&&(null==JY||JY.sendException(g));return[3,3];case 3:return[2]}})}),function(){return E.apply(this,arguments)})},{key:"startProcessContextData",value:(g=Be(function(){var g;return _ts_generator(this,function(E){switch(E.label){case 0:if(!Jj.getEventEmitCount(JV.PLAYER_INFO_LOADED))return[3,6];JX.event(JK.APP_READY);E.label=1;case 1:E.trys.push([1,3,4,5]);this.playerManager.requestConnectedPlayers();return[4,Jq.processContextData()];case 2:E.sent();return[3,5];case 3:g=E.sent();console.error("startProcessContextData",g),_instanceof(g,Error)&&(null==JY||JY.sendException(g));return[3,5];case 4:Jj.emit(JV.GAME_READY);return[7];case 5:return[3,7];case 6:Jj.once(JV.PLAYER_INFO_LOADED,this.startProcessContextData);E.label=7;case 7:return[2]}})}),function(){return g.apply(this,arguments)})},{key:"initPlugins",value:function(){this.pluginsManager.initProfiler(),this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),_._RF.pop()}}});(function(g){g("virtual:///prerequisite-imports/main","chunks:///main.js")})(function(g,E){System.register(g,[E],function(g,E){return{setters:[function(E){var _={};for(var k in E)if("default"!==k&&"__esModule"!==k)_[k]=E[k];g(_)}],execute:function(){}}})});