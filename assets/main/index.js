System.register("chunks:///main.js",["./renderCustomShareScore-08f5c310.js","./rollupPluginModLoBabelHelpers-487c63b6.js","cc"],(function(){var e,t,n,i,a,o,r,l,s,u,c,h,p,d,y,f,v,g,m,b,w,S,k,C,E,A,T,P,R,O,I,L,_,D,M,N,z,B,F,x,U,G,H,V,q,W,K,j,Y,X,Z,J,Q,$,ee,te,ne,ie,ae,oe,re,le,se,ue,ce,he,pe,de,ye,fe,ve,ge,me,be,we,Se,ke,Ce,Ee,Ae,Te,Pe,Re,Oe,Ie,Le,_e,De,Me,Ne,ze,Be,Fe,xe,Ue,Ge,He,Ve,qe,We,Ke,je,Ye,Xe,Ze,Je,Qe,$e,et,tt,nt,it,at,ot,rt,lt;return{setters:[function(M){e=M.A,t=M.C,n=M.G,i=M.a,a=M.b,o=M.c,r=M.d,l=M.e,s=M.f,u=M.R,c=M.g,h=M.L,p=M.h,d=M.I,y=M.T,f=M.i,v=M.E,g=M.j,m=M.k,b=M.S,w=M.l,S=M.m,k=M.n,C=M.o,E=M.p,A=M.q,T=M.r,P=M.s,R=M.B,O=M.t,I=M.u,L=M.v,_=M.w,D=M.x},function(e){M=e._,N=e.f,z=e.c,B=e.d,F=e.a,x=e.b,U=e.e,G=e.g,H=e.h,V=e.i,q=e.j,W=e.k,K=e.l,j=e.m,Y=e.n,X=e.o,Z=e.p,J=e.q},function(e){Q=e.cclegacy,$=e._decorator,ee=e.UITransform,te=e.CCInteger,ne=e.CCFloat,ie=e.Widget,ae=e.tween,oe=e.Layout,re=e.ccenum,le=e.Sprite,se=e.Enum,ue=e.easing,ce=e.Component,he=e.UIOpacity,pe=e.EventHandler,de=e.animation,ye=e.CCBoolean,fe=e.Button,ve=e.Input,ge=e.Node,me=e.Graphics,be=e.game,we=e.Color,Se=e.Label,ke=e.profiler,Ce=e.sys,Ee=e.EventTarget,Ae=e.ParticleSystem2D,Te=e.math,Pe=e.View,Re=e.ProgressBar,Oe=e.Vec2,Ie=e.Vec3,Le=e.CCString,_e=e.director,De=e.Director,Me=e.Layers,Ne=e.find,ze=e.randomRangeInt,Be=e.SpriteFrame,Fe=e.Animation,xe=e.pseudoRandomRangeInt,Ue=e.pseudoRandom,Ge=e.randomRange,He=e.instantiate,Ve=e.Pool,qe=e.Prefab,We=e.repeat,Ke=e.lerp,je=e.approx,Ye=e.EPSILON,Xe=e.RealCurve,Ze=e.Gradient,Je=e.bits,Qe=e.random,$e=e.Material,et=e.toRadian,tt=e.HorizontalTextAlignment,nt=e.Tween,it=e.AnimationClip,at=e.Canvas,ot=e.ScrollView,rt=e.NodeEventType,lt=e.Mask}],execute:function(){var st,ut,ct,ht,pt,dt,yt,ft,vt,gt,mt,bt,wt,St,kt,Ct,Et,At,Tt,Pt;Q._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var Rt=$.ccclass,Ot=$.property,It=(st=Rt("AutoLayoutWrappee"),ut=Ot({type:ee}),ct=Ot({type:ee}),st((dt=M((pt=N((function e(){z(this,e),B(this,"wrapeeContainer",dt,this),B(this,"wrapee",yt,this)}))).prototype,"wrapeeContainer",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yt=M(pt.prototype,"wrapee",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ht=pt))||ht),Lt=(ft=Rt("AutoLayout"),vt=Ot({displayName:"Use Auto Layout"}),gt=Ot({type:[It],displayName:"Children",visible:function(){return this.useAutoLayout}}),mt=Ot({visible:!1,serializable:!0}),bt=Ot({type:te,displayName:"Selected Index",visible:function(){return this.useAutoLayout}}),wt=Ot({type:ne,displayName:"Deselected Icon Width",group:"Edge Icons",visible:function(){return this.useAutoLayout}}),St=Ot({visible:!1,serializable:!0}),ft((Et=M((Ct=function(t){F(a,t);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"useAutoLayout",Et,U(e)),B(e,"children",At,U(e)),e.mappedChildren=[],B(e,"selected",Tt,U(e)),B(e,"deselectedIconW",Pt,U(e)),e.tweens=[],e}return N(a,[{key:"selectedIndex",get:function(){return this.selected},set:function(e){this.selected=e,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(e){this.deselectedIconW=e,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map((function(e){var t=e.wrapeeContainer.getComponent(ie);if(!t)throw new Error("AutoLayout: Widget component not found");return G(G({},e),{},{wrapeeContainerWidget:t})}))}},{key:"updateLayout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._layoutDirty||e){this.updateChildrenAnchors();var t,n=H(this.mappedChildren);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.wrapeeContainerWidget.updateAlignment()}}catch(e){n.e(e)}finally{n.f()}}V(q(a.prototype),"updateLayout",this).call(this,e)}},{key:"getSelectedWorldX",value:function(){var e=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?e.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*e.width:e.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(e){if(e<this.selectedIndex)return 0;if(e>this.selectedIndex)return 1;if(0===e){var t=this.mappedChildren[e].wrapeeContainer.width,n=this.deselectedIconWidth/2,i=this.paddingLeft;return((i+t+(t-n+this.spacingX))/2-i)/t}if(e===this.children.length-1){var a=this.mappedChildren[e].wrapeeContainer.width,o=a-this.deselectedIconWidth/2+this.spacingX;return((o+a+this.paddingRight)/2-o)/a}return.5}},{key:"updateChildrenAnchors",value:(n=W((function*(){var t,n=this,i=H(this.tweens);try{for(i.s();!(t=i.n()).done;)t.value.stop()}catch(e){i.e(e)}finally{i.f()}this.tweens=[],yield Promise.all([this.children.flatMap((function(e,t){return n.getChildrenAnchorsTweens(e,n.getAnchorX(t))})).map((function(t){return e.runTweenAsync(t)}))])})),function(){return n.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var e=this;this.children.forEach((function(t,n){var i=e.getAnchorX(n);t.wrapee.setAnchorPoint(i,t.wrapee.anchorY),t.wrapeeContainer.setAnchorPoint(i,t.wrapeeContainer.anchorY)}))}},{key:"getChildrenAnchorsTweens",value:function(e,t){return[ae(e.wrapee).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapee.setAnchorPoint(t,e.wrapee.anchorY)})),ae(e.wrapeeContainer).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapeeContainer.setAnchorPoint(t,e.wrapeeContainer.anchorY)}))]}}]),a}(oe)).prototype,"useAutoLayout",[vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),At=M(Ct.prototype,"children",[gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tt=M(Ct.prototype,"selected",[mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),M(Ct.prototype,"selectedIndex",[bt],Object.getOwnPropertyDescriptor(Ct.prototype,"selectedIndex"),Ct.prototype),M(Ct.prototype,"deselectedIconWidth",[wt],Object.getOwnPropertyDescriptor(Ct.prototype,"deselectedIconWidth"),Ct.prototype),Pt=M(Ct.prototype,"deselectedIconW",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kt=Ct))||kt);Q._RF.pop(),Q._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var _t="STARS_UPDATED",Dt="PLAY_BUTTON_PRESS",Mt="REQUEST_NAVIGATION",Nt="REQUEST_NAVIGATION_ANIMATION",zt="DASHBOARD_EVENTS_BUTTON_PRESS";Q._RF.pop(),Q._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var Bt,Ft,xt,Ut,Gt,Ht,Vt,qt,Wt,Kt,jt,Yt,Xt,Zt,Jt,Qt,$t,en,tn,nn,an,on,rn,ln=function(e){return e[e.store=0]="store",e[e.collections=1]="collections",e[e.home=2]="home",e[e.leaderboard=3]="leaderboard",e[e.tournaments=4]="tournaments",e}(ln||{});re(ln),Q._RF.pop(),Q._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var sn=$.ccclass,un=$.property,cn=globalThis.game.monitorError,hn=GameCore.Utils.Number,pn=(Bt=sn("MultiBackground"),Ft=un({type:le}),xt=un({type:le}),Ut=un({type:ee}),Gt=un({type:ee}),Ht=un({type:ee}),Vt=un(te),qt=un(ie),Wt=un({type:se(ln)}),Kt=un({type:se(ln)}),jt=t.onlyRunInLifeCycleAsync,Yt=t.onlyRunInLifeCycle,Bt((Jt=M((Zt=function(a){F(s,a);var o,r,l=x(s);function s(){var e;z(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=l.call.apply(l,[this].concat(n)),B(e,"background1",Jt,U(e)),B(e,"background2",Qt,U(e)),B(e,"screenUiTransform",$t,U(e)),B(e,"background1UiTransform",en,U(e)),B(e,"background2UiTransform",tn,U(e)),B(e,"backgroundNudgeAmount",nn,U(e)),B(e,"nudgeableWidget",an,U(e)),B(e,"pageOrder",on,U(e)),B(e,"homePage",rn,U(e)),e.currentThemeId="",e.tryNudgeBackground=function(t){var n=t.to,i=e.getDirection(e.homePage,n),a=hn.sign(i),o=Math.abs(i),r=e.backgroundNudgeAmount*o,l=Math.min(e.background1UiTransform.width,e.background2UiTransform.width),s=Math.max(0,(l-e.screenUiTransform.width)/2),u=Math.min(s,r)*a;ae(e.nudgeableWidget).to(.5,{horizontalCenter:u},{easing:ue.cubicInOut}).start()},e}return N(s,[{key:"onLoad",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,t.lazyValidateProperties(this),this.listenToNavigationEvents()}},{key:"onDestroy",value:function(){var e;null===(e=this.tweenSignal)||void 0===e||e.abort(),this.unlistenToNavigationEvents()}},{key:"listenToNavigationEvents",value:function(){this.node.scene.on(Nt,this.tryNudgeBackground)}},{key:"unlistenToNavigationEvents",value:function(){this.node.scene.off(Nt,this.tryNudgeBackground)}},{key:"getDirection",value:function(e,t){var n=this.pageOrder.indexOf(e),i=this.pageOrder.indexOf(t);return-1===n||-1===i?(null==cn||cn.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):n-i}},{key:"setCurrentTheme",value:(r=W((function*(e){var t=yield n.loadThemeAsync(e);t?this.updateBackgroundSprites(t,e):null==cn||cn.sendException(new Error("MultiBackground.setCurrentTheme: Failed to load theme ".concat(e,"'s sprite.")))})),function(e){return r.apply(this,arguments)})},{key:"updateBackgroundSprites",value:function(e,t){e.packable=!1,this.background1.spriteFrame=e,this.background2.spriteFrame=e,this.currentThemeId=t}},{key:"animateToNextTheme",value:(o=W((function*(t){var a;if(this.currentThemeId===t)return Promise.resolve();var o=yield n.loadThemeAsync(t);if(o){o.packable=!1,this.currentThemeId=t,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=o,this.nextBackground.node.setSiblingIndex(1);var r=this.nextBackground.getComponent(he);if(!r)throw new Error("".concat(this.nextBackground.node.name," UIOpacity is required"));if(r.opacity=0,null===(a=this.tweenSignal)||void 0===a||a.abort(),this.tweenSignal=new i,yield e.runTweenAsync(ae(r).to(1,{opacity:255}),this.tweenSignal),!this.tweenSignal.aborted){this.currentBackground.node.active=!1;var l=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=l}}else null==cn||cn.sendException(new Error("MultiBackground.animateToNextTheme: Failed to load theme ".concat(t,"'s sprite.")))})),function(e){return o.apply(this,arguments)})}]),s}(ce)).prototype,"background1",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qt=M(Zt.prototype,"background2",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$t=M(Zt.prototype,"screenUiTransform",[Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),en=M(Zt.prototype,"background1UiTransform",[Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tn=M(Zt.prototype,"background2UiTransform",[Ht],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nn=M(Zt.prototype,"backgroundNudgeAmount",[Vt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),an=M(Zt.prototype,"nudgeableWidget",[qt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),on=M(Zt.prototype,"pageOrder",[Wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rn=M(Zt.prototype,"homePage",[Kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ln.home}}),M(Zt.prototype,"setCurrentTheme",[jt],Object.getOwnPropertyDescriptor(Zt.prototype,"setCurrentTheme"),Zt.prototype),M(Zt.prototype,"updateBackgroundSprites",[Yt],Object.getOwnPropertyDescriptor(Zt.prototype,"updateBackgroundSprites"),Zt.prototype),Xt=Zt))||Xt);Q._RF.pop(),Q._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var dn="musics/",yn="sounds/",fn=GameCore.Utils.Object,vn={BUTTON_CLICK:"".concat(yn,"use_item_click"),BOMB_DEFUSE:"".concat(yn,"bomb_defuse"),BOMB_EXPLODE_1:"".concat(yn,"bomb_explode_1"),BOMB_EXPLODE_2:"".concat(yn,"bomb_explode_2"),CLICKS:"".concat(yn,"clicks"),CLOSE_POPUP_CLICK:"".concat(yn,"close_popup_click"),COLLECT_STARS:"".concat(yn,"collect_stars"),COMBO_1:"".concat(yn,"combo_1"),COMBO_2:"".concat(yn,"combo_2"),COMBO_3:"".concat(yn,"combo_3"),COMBO_4:"".concat(yn,"combo_4"),COMBO_5:"".concat(yn,"combo_5"),DAILY_REWARD:"".concat(yn,"daily_reward"),EXTRA_TIME_SPAWN:"".concat(yn,"extra_time_spawn"),GIFT_CHARGE:"".concat(yn,"gift_charge"),GIFT_EXPLODE:"".concat(yn,"gift_explode"),GIFT_REVEAL:"".concat(yn,"gift_reveal"),HINT_ITEM:"".concat(yn,"hint_item"),INVALID_MATCH:"".concat(yn,"invalid_match"),LEVEL_COMPLETE:"".concat(yn,"level_complete"),LEVEL_FAIL:"".concat(yn,"level_fail"),LEVEL_START:"".concat(yn,"level_start"),PROGRESS_STAR:"".concat(yn,"progress_star"),RESCUE_TIMER:"".concat(yn,"rescue_timer"),ROCKET_FLY:"".concat(yn,"rocket_fly"),SHUFFLE_ITEM:"".concat(yn,"shuffle_item"),THREE_STARS:"".concat(yn,"three_stars"),TICKING_BOMB_BEFORE_EXPLODE:"".concat(yn,"ticking_bomb_before_explode"),TILE_SELECT:"".concat(yn,"tile_select"),USE_ITEM_CLICK:"".concat(yn,"use_item_click"),BG_MUSIC:"".concat(dn,"bg_music"),PATCH_SHIFT:"".concat(yn,"patch_shift"),THUNDERBOLT:"".concat(yn,"thunderbolt"),WIND:"".concat(yn,"wind"),COLLECT_COINS:"".concat(yn,"collect_coins"),COLLECT_STOCK_COINS:"".concat(yn,"collect_stock_coins"),LEVEL_FAIL_TIMEOUT:"".concat(yn,"level_fail_timeout"),STAR_CHEST_DRUM_ROLL:"".concat(yn,"star_chest_drum_roll"),STAR_CHEST_OPEN:"".concat(yn,"star_chest_open"),LEADERBOARD_TRIUMPH:"".concat(yn,"leaderboard_triumph"),ITEM_REWARD:"".concat(yn,"item_reward"),COMBO_6:"".concat(yn,"combo_6"),COMBO_7:"".concat(yn,"combo_7"),COMBO_8:"".concat(yn,"combo_8"),COMBO_9:"".concat(yn,"combo_9"),COMBO_10:"".concat(yn,"combo_10"),COMBO_11:"".concat(yn,"combo_11"),COMBO_12:"".concat(yn,"combo_12"),COMBO_13:"".concat(yn,"combo_13"),TILE_MATCH:"".concat(yn,"tile_match"),TOURNAMENT_MUSIC:"".concat(dn,"tournament_music")},gn=fn.vals(vn),mn=gn.reduce((function(e,t,n){return e[t]=n,e}),{});re(mn);var bn,wn,Sn,kn,Cn,En,An,Tn,Pn,Rn,On,In,Ln,_n,Dn,Mn,Nn,zn,Bn,Fn,xn,Un,Gn,Hn,Vn,qn,Wn,Kn,jn,Yn,Xn,Zn,Jn,Qn,$n,ei=gn;Q._RF.pop(),Q._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var ti,ni,ii,ai,oi=$.ccclass,ri=$.property,li=$.disallowMultiple,si=$.executionOrder,ui=globalThis.game.analytics,ci=GameCore.Plugins.Analytics.Events,hi=(bn=oi("ExtendedButton"),wn=si(111),Sn=ri(pe),kn=ri(pe),Cn=ri(de.AnimationController),En=ri({override:!0,visible:!1}),An=ri({override:!0,visible:!1}),Tn=ri({override:!0,visible:!1}),Pn=ri({override:!0,visible:!1}),Rn=ri({override:!0,visible:!1}),On=ri({override:!0,visible:!1}),In=ri({override:!0,visible:!1}),Ln=ri({override:!0,visible:!1}),_n=ri({override:!0,visible:!1}),Dn=ri({override:!0,visible:!1}),Mn=ri({override:!0,visible:!1}),Nn=ri(ye),zn=ri(ye),Bn=ri(ye),Fn=ri({visible:function(){return this.makeSound},type:mn}),xn=ri({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),Un=ri({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),Gn=ri({}),bn(Hn=li(Hn=wn((qn=M((Vn=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return e=n.call.apply(n,[this].concat(o)),B(e,"clickStartEvents",qn,U(e)),B(e,"clickEndEvents",Wn,U(e)),B(e,"animationController",Kn,U(e)),B(e,"useDesktopHover",jn,U(e)),B(e,"emitAnalyticsEvents",Yn,U(e)),B(e,"makeSound",Xn,U(e)),B(e,"soundKey",Zn,U(e)),B(e,"disableSpamClick",Jn,U(e)),B(e,"disableSpamDelay",Qn,U(e)),B(e,"isScrollViewCancelInnerEvents",$n,U(e)),e.currentClickBoundingBox=null,e.hasDown=!1,e.hasUp=!1,e.hasFinishClickCycle=!1,e.onTouchStart=function(t){e.interactable&&(e.hasDown||(e.currentClickBoundingBox=a.getBoundingBoxToWorld(e.node),e.handleDown(t)))},e.onTouchEnd=function(t){e.scheduleOnce((function(){e.interactable&&e.hasDown&&(e.hasUp||e.handleUp(t))}),0)},e.onTouchCancel=function(t){if(e.interactable&&e.hasDown&&!e.hasUp){if(!e.isScrollViewCancelInnerEvents){var n,i,a=t.getUILocation();if(null!==(n=null===(i=e.currentClickBoundingBox)||void 0===i?void 0:i.contains(a))&&void 0!==n&&n)return void e.handleUp(t)}e.hasUp=!0,e.hasFinishClickCycle=!0,e.handleResetButtonState(),e.emitClickEndEvents(t)}},e.onMouseEnter=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||(e.hasFinishClickCycle=!1,e.setAnimationState("HOVER")))},e.onMouseLeave=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||e.hasUp||e.hasFinishClickCycle||e.handleResetButtonState())},e.handleResetButtonState=function(){e.hasDown=!1,e.hasUp=!1,e.setAnimationState("RESET")},e}return N(i,[{key:"transition",get:function(){return fe.Transition.NONE},set:function(e){K(q(i.prototype),"transition",fe.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return V(q(i.prototype),"normalColor",this)},set:function(e){K(q(i.prototype),"normalColor",e,this,!0)}},{key:"pressedColor",get:function(){return V(q(i.prototype),"pressedColor",this)},set:function(e){K(q(i.prototype),"pressedColor",e,this,!0)}},{key:"hoverColor",get:function(){return V(q(i.prototype),"hoverColor",this)},set:function(e){K(q(i.prototype),"hoverColor",e,this,!0)}},{key:"disabledColor",get:function(){return V(q(i.prototype),"disabledColor",this)},set:function(e){K(q(i.prototype),"disabledColor",e,this,!0)}},{key:"normalSprite",get:function(){return V(q(i.prototype),"normalSprite",this)},set:function(e){K(q(i.prototype),"normalSprite",e,this,!0)}},{key:"pressedSprite",get:function(){return V(q(i.prototype),"pressedSprite",this)},set:function(e){K(q(i.prototype),"pressedSprite",e,this,!0)}},{key:"hoverSprite",get:function(){return V(q(i.prototype),"hoverSprite",this)},set:function(e){K(q(i.prototype),"hoverSprite",e,this,!0)}},{key:"disabledSprite",get:function(){return V(q(i.prototype),"disabledSprite",this)},set:function(e){K(q(i.prototype),"disabledSprite",e,this,!0)}},{key:"duration",get:function(){return V(q(i.prototype),"duration",this)},set:function(e){K(q(i.prototype),"duration",e,this,!0)}},{key:"zoomScale",get:function(){return V(q(i.prototype),"zoomScale",this)},set:function(e){K(q(i.prototype),"zoomScale",e,this,!0)}},{key:"__preload",value:function(){V(q(i.prototype),"__preload",this).call(this),t.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var e;null===(e=V(q(i.prototype),"onDestroy",this))||void 0===e||e.call(this)}},{key:"onEnable",value:function(){var e;null===(e=V(q(i.prototype),"onEnable",this))||void 0===e||e.call(this),this.node.off(ve.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(ge.EventType.TOUCH_START,this.onTouchStart),this.node.on(ge.EventType.TOUCH_END,this.onTouchEnd),this.node.on(ge.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(ge.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var e;null===(e=V(q(i.prototype),"onDisable",this))||void 0===e||e.call(this),this.node.off(ge.EventType.TOUCH_START,this.onTouchStart),this.node.off(ge.EventType.TOUCH_END,this.onTouchEnd),this.node.off(ge.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(ge.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(e){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&o.playSound(ei[this.soundKey]),this.emitClickStartEvents(e)}},{key:"emitClickStartEvents",value:function(e){var t,n=H(this.clickStartEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}}},{key:"emitClickEndEvents",value:function(e){var t,n=H(this.clickEndEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}}},{key:"handleUp",value:function(e){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}},{key:"emitButtonEvents",value:function(e){if(this.interactable){this.emitAnalyticsEvents&&ui.event(ci.BUTTON_CLICK,{button_name:this.node.name,screen_name:r.getCurrentPage()});var t,n=H(this.clickEvents);try{for(n.s();!(t=n.n()).done;){var i=t.value;i.emit([e,i.customEventData])}}catch(e){n.e(e)}finally{n.f()}}}},{key:"setAnimationState",value:function(e){this.animationController&&(this.animationController.setValue("DOWN","DOWN"===e),this.animationController.setValue("HOVER","HOVER"===e),this.animationController.setValue("RESET","RESET"===e))}},{key:"fakeClick",value:function(){var e=this;this.setAnimationState("DOWN"),this.scheduleOnce((function(){e.setAnimationState("RESET")}),0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),i}(fe)).prototype,"clickStartEvents",[Sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wn=M(Vn.prototype,"clickEndEvents",[kn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kn=M(Vn.prototype,"animationController",[Cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(Vn.prototype,"transition",[En],Object.getOwnPropertyDescriptor(Vn.prototype,"transition"),Vn.prototype),M(Vn.prototype,"normalColor",[An],Object.getOwnPropertyDescriptor(Vn.prototype,"normalColor"),Vn.prototype),M(Vn.prototype,"pressedColor",[Tn],Object.getOwnPropertyDescriptor(Vn.prototype,"pressedColor"),Vn.prototype),M(Vn.prototype,"hoverColor",[Pn],Object.getOwnPropertyDescriptor(Vn.prototype,"hoverColor"),Vn.prototype),M(Vn.prototype,"disabledColor",[Rn],Object.getOwnPropertyDescriptor(Vn.prototype,"disabledColor"),Vn.prototype),M(Vn.prototype,"normalSprite",[On],Object.getOwnPropertyDescriptor(Vn.prototype,"normalSprite"),Vn.prototype),M(Vn.prototype,"pressedSprite",[In],Object.getOwnPropertyDescriptor(Vn.prototype,"pressedSprite"),Vn.prototype),M(Vn.prototype,"hoverSprite",[Ln],Object.getOwnPropertyDescriptor(Vn.prototype,"hoverSprite"),Vn.prototype),M(Vn.prototype,"disabledSprite",[_n],Object.getOwnPropertyDescriptor(Vn.prototype,"disabledSprite"),Vn.prototype),M(Vn.prototype,"duration",[Dn],Object.getOwnPropertyDescriptor(Vn.prototype,"duration"),Vn.prototype),M(Vn.prototype,"zoomScale",[Mn],Object.getOwnPropertyDescriptor(Vn.prototype,"zoomScale"),Vn.prototype),jn=M(Vn.prototype,"useDesktopHover",[Nn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Yn=M(Vn.prototype,"emitAnalyticsEvents",[zn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xn=M(Vn.prototype,"makeSound",[Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Zn=M(Vn.prototype,"soundKey",[Fn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mn[vn.BUTTON_CLICK]}}),Jn=M(Vn.prototype,"disableSpamClick",[xn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Qn=M(Vn.prototype,"disableSpamDelay",[Un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),$n=M(Vn.prototype,"isScrollViewCancelInnerEvents",[Gn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Hn=Vn))||Hn)||Hn)||Hn);Q._RF.pop(),Q._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var pi,di,yi,fi=$.ccclass,vi=$.requireComponent,gi=$.property,mi=fi("OpacityToggler")(ti=vi([he])((ii=M((ni=function(n){F(r,n);var a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=o.call.apply(o,[this].concat(n)),B(e,"activeValue",ii,U(e)),B(e,"inActiveValue",ai,U(e)),e.signal=new i,e}return N(r,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"changeState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.signal.abort(),this.opacityComponent.opacity=e?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(a=W((function*(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;this.signal.abort(),this.signal=new i;var a=t?this.activeValue:this.inActiveValue;yield e.runTweenAsync(ae(this.opacityComponent).to(n,{opacity:a}),this.signal)})),function(){return a.apply(this,arguments)})}]),r}(ce)).prototype,"activeValue",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),ai=M(ni.prototype,"inActiveValue",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),ti=ni))||ti)||ti;Q._RF.pop(),Q._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var bi,wi,Si,ki,Ci,Ei,Ai,Ti,Pi,Ri,Oi,Ii,Li,_i,Di,Mi,Ni,zi,Bi,Fi,xi=$.ccclass,Ui=$.property,Gi=$.requireComponent,Hi=$.disallowMultiple,Vi=$.executeInEditMode,qi=s.DesignSize,Wi=qi.Portrait,Ki=qi.Landscape;xi("DebugResolution")(pi=Hi(pi=Gi([me])(pi=Vi(!0)(((yi=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).handleLayoutChange=function(){var t;null===(t=e.graphics)||void 0===t||t.clear(),e.start()},e}return N(i,[{key:"drawPortrait",get:function(){return i._drawPortrait},set:function(e){e!==i._drawPortrait&&(e?this.drawPortraitResolution():this.graphics.clear(),i._drawPortrait=e,i._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return i._drawLandscape},set:function(e){e!==i._drawLandscape&&(e?this.drawLandscapeResolution():this.graphics.clear(),i._drawLandscape=e,i._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(me),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){be.on(l.LAYOUT_CHANGED,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var e=this.graphics;if(e){var t=Wi.WIDTH,n=Wi.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=we.GREEN,e.rect(i,a,t,n),e.stroke()}}},{key:"drawLandscapeResolution",value:function(){var e=this.graphics;if(e){var t=Ki.WIDTH,n=Ki.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=we.CYAN,e.rect(i,a,t,n),e.stroke()}}}]),i}(ce))._drawPortrait=!0,yi._drawLandscape=!0,M((di=yi).prototype,"drawPortrait",[Ui],Object.getOwnPropertyDescriptor(di.prototype,"drawPortrait"),di.prototype),M(di.prototype,"drawLandscape",[Ui],Object.getOwnPropertyDescriptor(di.prototype,"drawLandscape"),di.prototype),pi=di))||pi)||pi)||pi);Q._RF.pop(),Q._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var ji=$.ccclass,Yi=$.executionOrder,Xi=$.property,Zi=GameCore.Utils.Valid,Ji=we.RED,Qi=we.BLACK,$i=we.MAGENTA;bi=ji("GameStats"),wi=Yi(-1e3),Si=Xi(Se),ki=Xi(Se),Ci=Xi(Se),Ei=Xi(Se),Ai=Xi(Se),Ti=Xi(Se),Pi=Xi(Se),Ri=Xi(Se),bi(Oi=wi((Li=M((Ii=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"fpsLabel",Li,U(e)),B(e,"drawCountLabel",_i,U(e)),B(e,"logicTimeLabel",Di,U(e)),B(e,"physicTimeLabel",Mi,U(e)),B(e,"renderTimeLabel",Ni,U(e)),B(e,"objectMemoryUsageLabel",zi,U(e)),B(e,"textureMemoryUsageLabel",Bi,U(e)),B(e,"devicePixelRatioLabel",Fi,U(e)),e.refreshInterval=.5,e.handleMouseDown=function(){e.bg.enabled=!e.bg.enabled},e.waitForStats=function(){ke.stats&&(e.unschedule(e.waitForStats),e.node.active=!0,e.stats=ke.stats,e.startUpdateStats())},e.updateStats=function(){e.updateFps(),e.updateDrawCalls(),e.updateLogicTime(),e.updatePhysicTime(),e.updateRenderTime(),e.updateObjectMemoryUsage(),e.updateTextureMemoryUsage(),e.updateDevicePixelRatio()},e}return N(i,[{key:"__preload",value:function(){this.bg=this.getComponent(le),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(ve.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,ke&&Zi.isDebugger()&&(ke.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var e=this.getFps();this.updateFpsColor(e),this.fpsLabel.string="FPS: ".concat(e)}},{key:"updateFpsColor",value:function(e){this.fpsLabel.color=e<30?Ji:e<48?$i:Qi}},{key:"updateDrawCalls",value:function(){var e=this.getDrawCalls();this.updateDrawCallsColor(e),this.drawCountLabel.string="Draw Calls: ".concat(e)}},{key:"updateDrawCallsColor",value:function(e){var t=Ce.os===Ce.OS.IOS,n=t?80:25,i=t?60:15;this.drawCountLabel.color=e>n?Ji:e>i?$i:Qi}},{key:"updateLogicTime",value:function(){var e=this.getLogicTime();this.updateLogicTimeColor(e),this.logicTimeLabel.string="Logic Time: ".concat(e.toFixed(2),"ms")}},{key:"updateLogicTimeColor",value:function(e){this.logicTimeLabel.color=e>10?Ji:e>5?$i:Qi}},{key:"updatePhysicTime",value:function(){var e=this.getPhysicTime();this.updatePhysicTimeColor(e),this.physicTimeLabel.string="Physic Time: ".concat(e.toFixed(2),"ms")}},{key:"updatePhysicTimeColor",value:function(e){this.physicTimeLabel.color=e>10?Ji:e>5?$i:Qi}},{key:"updateRenderTime",value:function(){var e=this.getRenderTime();this.updateRenderTimeColor(e),this.renderTimeLabel.string="Render Time: ".concat(e.toFixed(2),"ms")}},{key:"updateRenderTimeColor",value:function(e){this.renderTimeLabel.color=e>10?Ji:e>5?$i:Qi}},{key:"updateObjectMemoryUsage",value:function(){var e=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(e),this.objectMemoryUsageLabel.string="Object Mem: ".concat(e.toFixed(2),"MB")}},{key:"updateObjectMemoryUsageColor",value:function(e){this.objectMemoryUsageLabel.color=e>40?Ji:e>25?$i:Qi}},{key:"updateTextureMemoryUsage",value:function(){var e=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(e),this.textureMemoryUsageLabel.string="Texture Mem: ".concat(e.toFixed(2),"MB")}},{key:"updateTextureMemoryUsageColor",value:function(e){this.textureMemoryUsageLabel.color=e>50?Ji:e>35?$i:Qi}},{key:"updateDevicePixelRatio",value:function(){var e=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(e),this.devicePixelRatioLabel.string="Device Pixel Ratio: ".concat(e)}},{key:"updateDevicePixelRatioColor",value:function(e){this.devicePixelRatioLabel.color=e>2?Ji:e<=1?$i:Qi}},{key:"getFps",value:function(){var e=this.stats.fps.counter;return Math.floor(e.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var e=this.stats.logic.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getPhysicTime",value:function(){var e=this.stats.physics.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getRenderTime",value:function(){var e=this.stats.render.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var e=this.stats.bufferMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var e=this.stats.textureMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),i}(ce)).prototype,"fpsLabel",[Si],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_i=M(Ii.prototype,"drawCountLabel",[ki],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Di=M(Ii.prototype,"logicTimeLabel",[Ci],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mi=M(Ii.prototype,"physicTimeLabel",[Ei],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ni=M(Ii.prototype,"renderTimeLabel",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zi=M(Ii.prototype,"objectMemoryUsageLabel",[Ti],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bi=M(Ii.prototype,"textureMemoryUsageLabel",[Pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fi=M(Ii.prototype,"devicePixelRatioLabel",[Ri],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oi=Ii))||Oi);Q._RF.pop(),Q._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var ea,ta=function(e){return e.CHALLENGE_FRIENDS="challenge-friends",e.REPLAY_FRIENDS="replay-friends",e.SHOW_CHALLENGE_RESULTS="show-challenge-results",e.UPDATE_MUSIC="update-music",e.NEXT_LEVEL="next-level",e.MAX_LEVEL="max-level",e.START_OVER="start-over",e.SELECT_LEVEL="select-level",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_REPLAY="game-replay",e.GAME_FINISH="game-finish",e.GAME_EXIT="game-exit",e.USE_ITEM="use-item",e.SKIP_LEVEL="skip-level",e.ADD_ITEM="add-item",e.ADD_ITEMS="add-items",e.REFRESH_ITEMS="refresh-items",e.ADD_COINS="add-coins",e.REMOVE_COINS="remove-coins",e.REMOVE_COINS_SUCCESS="remove-coins-success",e.REMOVE_COINS_FAILED="remove-coins-failed",e.COIN_CHANGED="coin-changed",e.ABORT_COIN_ANIMATION="abort-coin-animation",e.ADD_STARS="add-stars",e.PAUSE_TIME="pause-time",e.RESUME_TIME="resume-time",e.TIME_OUT="time-out",e.HALF_TIME="half-time",e.RESCUE_START="rescue-time",e.RESCUE_FINISHED="clock-animation-finished",e.TIME_UPDATED="time-updated",e.APPLY_GRAVITY="apply-gravity",e.IDLE_ENTER="idle-enter",e.IDLE_EXIT="idle-exit",e.GRID_MATCH="grid-match",e.GRID_MATCH_SUCCESS="grid-match-success",e.GRID_MATCH_FAIL="grid-match-fail",e.GRID_CLEAR="grid-clear",e.GRID_SPAWN="grid-spawn",e.GRID_CREATE="grid-create",e.GRID_RESIZE="grid-resize",e.TILE_CLICK="tile-click",e.BOMB_EXPLODE="bomb-explode",e.SHOW_HINT="show-hint",e.ADD_COMBO="add-combo",e.COMBO_UPDATED="combo-updated",e.COMBO_ENDED="combo-ended",e.COMBO_PROGRESS="combo-progress",e.ADD_SCORE="add-score",e.SCORE_UPDATED="score-updated",e.SHOW_UI="show-ui",e.HIDE_UI="hide-ui",e.AUTO_PLAY="auto-play",e.GUIDE_MASK_CLICKED="guide-mask-clicked",e}(ta||{});Q._RF.pop(),Q._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var na,ia,aa,oa,ra,la,sa,ua,ca,ha,pa,da,ya,fa,va,ga,ma,ba,wa=(0,$.ccclass)("PanelAnimationController")(ea=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).animators=new Set,e.eventTarget=new Ee,e.handleRegistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)&&console.warn("Animator already registered."),e.animators.add(t)},e.handleUnregistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)||console.warn("Animator not registered."),e.animators.delete(t)},e.handleShowUIs=function(){var t=W((function*(t){var n,i,a=!1,o=[],r=H(e.animators);try{for(r.s();!(i=r.n()).done;){var l=i.value;o.push(l)}}catch(e){r.e(e)}finally{r.f()}for(var s=[],u=0,c=o;u<c.length;u++){var h,p=c[u];if(!p.isReadyForAnimation()&&!a)a=!0,null==t||null===(h=t.fallback)||void 0===h||h.call(t);s.push(p.handleShowUI())}yield Promise.all(s),null==t||null===(n=t.onComplete)||void 0===n||n.call(t),e.eventTarget.emit(ta.SHOW_UI)}));return function(e){return t.apply(this,arguments)}}(),e.handleHideUIs=function(){var t=W((function*(t){var n,i,a=!1,o=[],r=H(e.animators);try{for(r.s();!(i=r.n()).done;){var l=i.value;o.push(l)}}catch(e){r.e(e)}finally{r.f()}for(var s=[],u=0,c=o;u<c.length;u++){var h,p=c[u];if(!p.isReadyForAnimation()&&!a)a=!0,null==t||null===(h=t.fallback)||void 0===h||h.call(t);s.push(p.handleHideUI())}yield Promise.all(s),null==t||null===(n=t.onComplete)||void 0===n||n.call(t),e.eventTarget.emit(ta.HIDE_UI)}));return function(e){return t.apply(this,arguments)}}(),e}return N(n,[{key:"onEnable",value:function(){this.node.scene.on(ta.SHOW_UI,this.handleShowUIs,this),this.node.scene.on(ta.HIDE_UI,this.handleHideUIs,this)}},{key:"onDisable",value:function(){this.node.scene.off(ta.SHOW_UI,this.handleShowUIs,this),this.node.scene.off(ta.HIDE_UI,this.handleHideUIs,this)}},{key:"showUI",value:function(){return this.handleShowUIs()}},{key:"hideUI",value:function(){return this.handleHideUIs()}},{key:"on",value:function(e,t,n,i){this.eventTarget.on(e,t,n,i)}},{key:"off",value:function(e,t,n){this.eventTarget.off(e,t,n)}}],[{key:"getController",value:function(e){for(var t=null,i=e;null!==i;){if(t=i.getComponent(n))return t;i=i.parent}return t}},{key:"registerAnimator",value:function(e){var t=this.getController(e.node);t?t.handleRegistration(e):console.warn("No PanelAnimationController found for animator ".concat(e.node.name))}},{key:"unregisterAnimator",value:function(e){var t=this.getController(e.node);t?t.handleUnregistration(e):console.warn("No PanelAnimationController found for animator ".concat(e.node.name))}}]),n}(ce))||ea;Q._RF.pop(),Q._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var Sa,ka=$.ccclass,Ca=$.property,Ea=GameCore.Utils.Object,Aa=(na=ka("AnimationConfig"),ia=Ca({type:[ie]}),na((ra=M((oa=function(){function e(){z(this,e),B(this,"startHidden",ra,this),B(this,"nodes",la,this),B(this,"posOffset",sa,this),B(this,"showEase",ua,this),B(this,"hideEase",ca,this),B(this,"showDuration",ha,this),B(this,"hideDuration",pa,this)}return N(e,[{key:"setConfig",value:function(e){e&&Ea.assign(this,e)}}]),e}()).prototype,"startHidden",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),la=M(oa.prototype,"nodes",[ia],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sa=M(oa.prototype,"posOffset",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ua=M(oa.prototype,"showEase",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),ca=M(oa.prototype,"hideEase",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),ha=M(oa.prototype,"showDuration",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pa=M(oa.prototype,"hideDuration",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),aa=oa))||aa),Ta=(da=ka("PanelAnimator"),ya=Ca({type:Aa,displayName:"Top animation nodes"}),fa=Ca({type:Aa,displayName:"Bottom animation nodes"}),da((ma=M((ga=function(t){F(r,t);var n,a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),B(e,"topConfig",ma,U(e)),B(e,"botConfig",ba,U(e)),e.isReady=!1,e}return N(r,[{key:"onEnable",value:function(){wa.registerAnimator(this)}},{key:"onDisable",value:function(){wa.unregisterAnimator(this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(a=W((function*(){if(this.isReady)return Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")]);console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"))})),function(){return a.apply(this,arguments)})},{key:"handleHideUI",value:(n=W((function*(){if(this.isReady)return Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")]);console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready"))})),function(){return n.apply(this,arguments)})},{key:"createAnimator",value:function(t,n){var a=t.nodes,o=t.posOffset,l=t.showEase,s=t.hideEase,u=t.showDuration,c=t.hideDuration,h=a.map((function(e){return"top"===n&&e.isAlignTop?{mode:"top",value:e.top}:"bottom"===n&&e.isAlignBottom?{mode:"bottom",value:e.bottom}:{mode:"position",value:e.node.position.y}})),p=a.map((function(e){return"top"===n&&e.isAlignTop?{mode:"top",value:e.top+o}:"bottom"===n&&e.isAlignBottom?{mode:"bottom",value:e.bottom-o}:{mode:"position",value:e.node.position.y+o}})),d="shown",y=new i;return{switchState:function(){var t=W((function*(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];y.abort();var o=new i;if(y=o,d!==t){d=t;var f="hidden"===t?h:p,v="hidden"===t?p:h,g="hidden"===t?c:u,m="hidden"===t?s:l,b=function(){for(var e=0,t=a.length;e<t;e++){var n=a[e],i=f[e],o=v[e].value;r.setToTargetImmediately(n,i,o)}};n?b():(o.addAbortListener(b),yield Promise.all(a.map((function(t,n){var i=f[n],a=v[n].value;return e.runTweenAsync(r.getTween({widget:t,config:i,target:a,easing:m,duration:g}),o)}))),o.aborted||o.removeAbortListener(b))}}));return function(e){return t.apply(this,arguments)}}()}}},{key:"setAnimator",value:function(e){var t=e.topConfig,n=e.botConfig,i=new Aa,a=new Aa;i.setConfig(t),a.setConfig(n),this.topConfig=i,this.botConfig=a,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(e){var t=e.widget,n=e.config,i=e.target,a=e.easing,o=e.duration;return"top"===n.mode?ae(t).call((function(){t.top=n.value})).to(o,{top:i},{easing:a}):"bottom"===n.mode?ae(t).call((function(){t.bottom=n.value})).to(o,{bottom:i},{easing:a}):ae(t.node.position).call((function(){t.node.setPosition(t.node.position.x,n.value,t.node.position.z)})).to(o,{y:i},{easing:a})}},{key:"setToTargetImmediately",value:function(e,t,n){"top"===t.mode&&(e.top=n),"bottom"===t.mode&&(e.bottom=n);var i=e.node.position.x,a=n,o=e.node.position.z;e.node.setPosition(i,a,o)}}]),r}(ce)).prototype,"topConfig",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Aa}}),ba=M(ga.prototype,"botConfig",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Aa}}),va=ga))||va);Q._RF.pop(),Q._RF.push({},"21a9aAlkBtGxKLqip8g0o6l","ParticleSystem2DExtra",void 0);var Pa,Ra=$.ccclass,Oa=$.disallowMultiple,Ia=$.executeInEditMode,La=$.requireComponent,_a=Ra("ParticleSystem2DExtra")(Sa=Ia(!0)(Sa=Oa(!0)(Sa=La(Ae)(Sa=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).emitParticle=function(t){return function(n){t(n);var i=e.particleSystem._simulator.particles.length,a=e.particleSystem._simulator.particles[i-1];e.initParticle(a)}},e.step=function(t){return function(n){for(var i=e.particleSystem._simulator.particles,a=0;a<i.length;a++){var o=i[a];e.updateParticle(o,n)}t(n)}},e}return N(i,[{key:"__preload",value:function(){this.particleSystem=this.getComponent(Ae),this.validateRequiredComponents(),this.overrideFunctions()}},{key:"overrideFunctions",value:function(){var e=this.particleSystem._simulator.emitParticle.bind(this.particleSystem._simulator);this.particleSystem._simulator.emitParticle=this.emitParticle(e);var t=this.particleSystem._simulator.step.bind(this.particleSystem._simulator);this.particleSystem._simulator.step=this.step(t)}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}}]),i}(ce))||Sa)||Sa)||Sa)||Sa;Q._RF.pop(),Q._RF.push({},"9a5a3MgLaRAKbHluGCPsA8j","ExampleParticleSystem2DExtra",void 0);var Da,Ma,Na,za,Ba,Fa,xa,Ua,Ga,Ha,Va,qa;(0,$.ccclass)("ExampleParticleSystem2DExtra")(Pa=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"initParticle",value:function(e){e.maxSize=Te.randomRange(.25,1)*e.size,e.size=0,e.deltaSize=0,e.cycleDuration=Te.randomRange(.4,.6),e.life=e.timeToLive,this.setInitPosition(e.pos)}},{key:"updateParticle",value:function(e,t){this.updateScale(e)}},{key:"setInitPosition",value:function(e){var t=e.x,n=e.y;return e.x=t+Te.randomRange(-350,350),e.y=n+Te.randomRange(-350,350),e}},{key:"updateScale",value:function(e){var t=1-(e.life-e.timeToLive)%e.cycleDuration/e.cycleDuration;e.size=e.maxSize*Math.sin(t*Math.PI)}}]),n}(_a));Q._RF.pop(),Q._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var Wa,Ka=$.ccclass,ja=$.requireComponent,Ya=$.property,Xa=globalThis.game,Za=Xa.ads,Ja=Xa.event,Qa=GameCore,$a=Qa.Events,eo=Qa.Configs.Ads.BannerDisplayAdOptions,to=Qa.Plugins.Ads,no=to.Types,io=to.Status,ao=Qa.Utils,oo=ao.Array,ro=ao.Function,lo=["top","topleft","topright"],so=["bottom","bottomleft","bottomright"],uo=["left","topleft","bottomleft"],co=["right","topright","bottomright"];Da=Ka("ResizeWithBannerAd"),Ma=ja(ie),Na=Ya(ye),za=Ya(ye),Ba=Ya(ye),Fa=Ya(ye),Da(xa=Ma((Ga=M((Ua=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,o=new Array(t),r=0;r<t;r++)o[r]=arguments[r];return e=n.call.apply(n,[this].concat(o)),B(e,"includeSAB",Ga,U(e)),B(e,"includeRightBanner",Ha,U(e)),B(e,"includeBottomBanner",Va,U(e)),B(e,"includeLeftBanner",qa,U(e)),e.handleOnAdShowing=function(t){var n=t.placementId;e.checkValid()&&n&&(Za.getAd(no.BANNER,n)&&(e.resizeWhenBannerAdShow(n),e.emitResizeEvent()))},e.handleOnAdClosed=function(t){var n=t.placementId;e.checkValid()&&n&&(Za.getAd(no.BANNER,n)&&(e.resizeWhenBannerAdClose(n),e.emitResizeEvent()))},e.handleOnResize=function(){e.checkValid()&&eo.forEach((function(t){var n=t.PlacementId,i=Za.getAdStatus(no.BANNER,n);i&&(i===io.SHOWING?e.resizeWhenBannerAdShow(n):i===io.IDLE&&e.resizeWhenBannerAdClose(n))}))},e.resizeWhenBannerAdShow=function(t){var n=void 0,i=void 0,o=void 0,r=void 0,l=a.cssSizeToWorldSize(1),s=Za.getBannerConfig(t),u=s.PlacementId,c=s.BannerWidth,h=s.Position;if("top"===h)n=Za.getBannerHeight(u,l);else if("bottom"===h)e.includeBottomBanner?i=Za.getBannerHeight(u,l,e.includeSAB):e.includeSAB&&(i=Za.getSafeAreaBottom(l));else if("left"===h||"right"===h){if(void 0===c)return;var p=c;"getBannerOffset"in GameSDK.extra&&(p+=GameSDK.extra.getBannerOffset()),"left"===h&&e.includeLeftBanner?o=p*l:"right"===h&&e.includeRightBanner&&(r=p*l)}e.updateWidgets({top:n,bottom:i,left:o,right:r})},e.resizeWhenBannerAdClose=function(t){var n=Za.getBannerConfig(t).Position,i=a.cssSizeToWorldSize(1),o=e.includeSAB?Za.getSafeAreaBottom(i):0;e.updateWidgets({top:oo.has(lo,n)?0:void 0,bottom:oo.has(so,n)?o:void 0,left:oo.has(uo,n)?0:void 0,right:oo.has(co,n)?0:void 0})},e.emitResizeEvent=ro.debounce((function(){be.emit(l.WIDGET_RESIZED)}),100),e}return N(i,[{key:"__preload",value:function(){this.widget=this.getComponent(ie),t.lazyValidateProperties(this),Ja.on($a.AD_SHOWING,this.handleOnAdShowing),Ja.on($a.AD_CLOSED,this.handleOnAdClosed),be.on(l.VIEW_RESIZED,this.handleOnResize)}},{key:"onDestroy",value:function(){Ja.off($a.AD_SHOWING,this.handleOnAdShowing),Ja.off($a.AD_CLOSED,this.handleOnAdClosed),be.off(l.VIEW_RESIZED,this.handleOnResize)}},{key:"start",value:function(){this.handleOnResize()}},{key:"updateWidgets",value:function(e){var t=e.top,n=e.bottom,i=e.left,a=e.right;this.widget.top=null!=t?t:this.widget.top,this.widget.bottom=null!=n?n:this.widget.bottom,this.widget.left=null!=i?i:this.widget.left,this.widget.right=null!=a?a:this.widget.right,Pe.instance.emit("canvas-resize")}},{key:"checkValid",value:function(){return this.node.activeInHierarchy&&null!==this.node.parent&&void 0!==this.node.parent}}]),i}(ce)).prototype,"includeSAB",[Na],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ha=M(Ua.prototype,"includeRightBanner",[za],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Va=M(Ua.prototype,"includeBottomBanner",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),qa=M(Ua.prototype,"includeLeftBanner",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xa=Ua))||xa);Q._RF.pop(),Q._RF.push({},"ed5c6D+6KVEj5lrgtq+D9bJ","LayoutUtils",void 0);var ho,po,yo,fo,vo,go,mo,bo,wo,So,ko=s.Layout,Co=function(){function e(){z(this,e),this.currentLayout="",be.off(l.LAYOUT_CHANGED,e.onLayoutChanged),be.on(l.LAYOUT_CHANGED,e.onLayoutChanged)}return N(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getCurrentLayout",value:function(){return this.inst.currentLayout}},{key:"isPortrait",value:function(){return this.inst.currentLayout===ko.Portrait}},{key:"isLandscape",value:function(){return this.inst.currentLayout===ko.Landscape}}]),e}();Wa=Co,Co.onLayoutChanged=function(e){Wa.inst.currentLayout!==e&&(Wa.inst.currentLayout=e,be.emit(l.ORIENTATION_CHANGED,e))};try{new Co}catch(e){console.error("LayoutUtils",e)}Q._RF.pop(),Q._RF.push({},"3825fBvhGRPUK6d/ohif+v0","PreloadSprite",void 0);var Eo=$.ccclass,Ao=$.property,To=$.requireComponent,Po=s.Layout,Ro=function(e){return e[e.Portrait=0]="Portrait",e[e.Landscape=1]="Landscape",e}(Ro||{}),Oo=[Po.Portrait,Po.Landscape];re(Ro);var Io,Lo,_o,Do,Mo,No,zo,Bo,Fo,xo,Uo;ho=Eo("PreloadSprite"),po=To(le),yo=Ao({type:Ro}),fo=Ao({type:u}),vo=Ao({type:ye}),ho(go=po((bo=M((mo=function(e){F(a,e);var t,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"layout",bo,U(e)),B(e,"path",wo,U(e)),B(e,"packable",So,U(e)),e}return N(a,[{key:"__preload",value:function(){this.sprite=this.getComponent(le),be.on(l.ORIENTATION_CHANGED,this.loadSpriteFrame,this),this.loadSpriteFrame()}},{key:"onDestroy",value:function(){be.off(l.ORIENTATION_CHANGED,this.loadSpriteFrame,this)}},{key:"loadSpriteFrame",value:(t=W((function*(){if(this.sprite.spriteFrame)this.unlistenEvent();else if(Co.getCurrentLayout()===Oo[this.layout]&&this.path){var e="".concat(c[this.path],"/spriteFrame");if(e){var t=yield n.loadSpriteFrameAsync(e,this.packable);this.sprite.spriteFrame||(this.sprite.spriteFrame=t),this.unlistenEvent()}}})),function(){return t.apply(this,arguments)})},{key:"unlistenEvent",value:function(){be.off(l.ORIENTATION_CHANGED,this.loadSpriteFrame,this)}}]),a}(ce)).prototype,"layout",[yo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wo=M(mo.prototype,"path",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),So=M(mo.prototype,"packable",[vo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),go=mo))||go);Q._RF.pop(),Q._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var Go,Ho,Vo,qo,Wo,Ko,jo,Yo=$.ccclass,Xo=$.property,Zo=$.executeInEditMode,Jo=$.requireComponent,Qo=(Io=Yo("TapperedProgressBar"),Lo=Jo(he),_o=Xo({type:he,displayName:"Fill opacity"}),Do=Xo({type:le,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),Mo=Xo({type:le,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),No=Xo({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),Io(zo=Zo(zo=Lo((Fo=M((Bo=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"uiOpacity",Fo,U(e)),B(e,"leftCap",xo,U(e)),B(e,"rightCap",Uo,U(e)),e}return N(n,[{key:"progress",get:function(){return V(q(n.prototype),"progress",this)},set:function(e){K(q(n.prototype),"progress",e,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity)if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var e=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=e}}},{key:"start",value:function(){this.updateAppearance()}}]),n}(Re)).prototype,"uiOpacity",[_o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xo=M(Bo.prototype,"leftCap",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uo=M(Bo.prototype,"rightCap",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M(Bo.prototype,"progress",[No],Object.getOwnPropertyDescriptor(Bo.prototype,"progress"),Bo.prototype),zo=Bo))||zo)||zo)||zo);Q._RF.pop(),Q._RF.push({},"aa60frMJLtIlJZh2yJhMp1s","DynamicLabel",void 0);var $o,er,tr,nr,ir,ar,or,rr,lr,sr,ur,cr,hr,pr,dr,yr,fr,vr,gr,mr=$.ccclass,br=$.property,wr=$.executeInEditMode,Sr=$.requireComponent;Go=mr("DynamicLabel"),Ho=Sr(Se),Vo=wr(!0),qo=br({type:ne,min:1,max:200}),Wo=br({type:ne,min:.1,max:4}),Go(Ko=Ho(Ko=Vo((M((jo=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a)))._quality=1,e._size=1,e._outlineWidth=0,e._shadowOffset=new Oe(0,0),e}return N(n,[{key:"size",get:function(){return this._size},set:function(e){this._size=e,this.label.fontSize=this.size*this.quality}},{key:"quality",get:function(){return this._quality},set:function(e){this._quality=e,this.node.scale=new Ie(1/this.quality,1/this.quality,1),this.label.fontSize=this.size*this.quality,this.label.outlineWidth=this._outlineWidth*this.quality,this.label.shadowOffset=this._shadowOffset.multiplyScalar(this.quality)}},{key:"__preload",value:function(){this.label=this.getComponent(Se)}},{key:"start",value:function(){this._quality=1/this.node.scale.x,this._size=this.label.fontSize/this.quality,this._outlineWidth=this.label.outlineWidth,this._shadowOffset=this.label.shadowOffset,this.quality=window.devicePixelRatio,console.info(" ".concat(this.node.name,"<Label> quality:"),this.quality)}}]),n}(ce)).prototype,"size",[qo],Object.getOwnPropertyDescriptor(jo.prototype,"size"),jo.prototype),M(jo.prototype,"quality",[Wo],Object.getOwnPropertyDescriptor(jo.prototype,"quality"),jo.prototype),Ko=jo))||Ko)||Ko);Q._RF.pop(),Q._RF.push({},"060a722v8VBE68QPm8fKcyQ","LocalizePreloader",void 0);var kr,Cr,Er,Ar,Tr,Pr,Rr,Or,Ir,Lr,_r,Dr,Mr,Nr,zr,Br,Fr,xr,Ur,Gr,Hr,Vr,qr=$.ccclass,Wr=$.property,Kr=GameCore.Utils,jr=Kr.Array,Yr=Kr.Valid,Xr=globalThis.game.language,Zr=Object.keys(h),Jr=($o=qr("LocalizeTextureKey"),er=Wr({visible:!1}),tr=Wr(Le),$o((ar=M((ir=function(){function e(){z(this,e),B(this,"_key",ar,this)}return N(e,[{key:"key",get:function(){return this._key},set:function(e){Xr.hasTextureKey(e)?this._key=e:console.warn("Key ".concat(e," not found in locales"))}}]),e}()).prototype,"_key",[er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),M(ir.prototype,"key",[tr],Object.getOwnPropertyDescriptor(ir.prototype,"key"),ir.prototype),nr=ir))||nr),Qr=(or=qr("SupportedLocaleKey"),rr=Wr({visible:!1}),lr=Wr(Le),or((cr=M((ur=function(){function e(){z(this,e),B(this,"_key",cr,this)}return N(e,[{key:"key",get:function(){return this._key},set:function(e){Zr.includes(e)?this._key=e:console.warn("Key ".concat(e," not found. Supported locales are ").concat(Zr.join(", ")))}}]),e}()).prototype,"_key",[rr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),M(ur.prototype,"key",[lr],Object.getOwnPropertyDescriptor(ur.prototype,"key"),ur.prototype),sr=ur))||sr);hr=qr("LocalizePreloader"),pr=Wr([Jr]),dr=Wr({type:Qr,tooltip:"Preload only for these locales"}),hr((vr=M((fr=function(e){F(i,e);var t=x(i);function i(){var e;z(this,i);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"keys",vr,U(e)),B(e,"locales",gr,U(e)),e}return N(i,[{key:"__preload",value:function(){var e=Xr.getCurrentLocale(),t=this.locales.map((function(e){return e.key}));if(jr.has(t,e)){var i=this.keys.reduce((function(e,t){if(!1===Xr.hasTextureKey(t.key))return e;var n="".concat(Xr.getTexture(t.key),"/spriteFrame");return e.push(n),e}),[]);n.loadSpriteFramesAsync(i)}else Yr.isDebugger()&&console.info("Skipping preloading of textures because current locale is not in the list of preloading locales")}}]),i}(ce)).prototype,"keys",[pr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gr=M(fr.prototype,"locales",[dr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yr=fr));Q._RF.pop(),Q._RF.push({},"3f364xnTJtDR5yeow2MWHhm","LocalizedLayout",void 0);var $r,el,tl,nl,il,al,ol,rl,ll,sl=$.ccclass,ul=$.property,cl=$.executeInEditMode,hl=$.disallowMultiple,pl=$.requireComponent;kr=sl("LocalizedLayout"),Cr=cl(!0),Er=pl(ee),Ar=ul(p),Tr=t.required(),Pr=ul(ee),Rr=ul({visible:!1}),Or=ul({visible:!1}),Ir=ul({visible:!1}),Lr=ul({visible:!1}),_r=ul({type:ne,group:"Padding"}),Dr=ul({type:ne,group:"Padding"}),Mr=ul({type:ne,group:"Padding"}),Nr=ul({type:ne,group:"Padding"}),kr(zr=hl(zr=Cr(zr=Er((Fr=M((Br=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"label",Fr,U(e)),B(e,"layout",xr,U(e)),B(e,"_top",Ur,U(e)),B(e,"_down",Gr,U(e)),B(e,"_left",Hr,U(e)),B(e,"_right",Vr,U(e)),e.updateContentSize=function(t){var n,i=(null!=t?t:{}).localize;if(void 0!==e.label&&(void 0===i||e.label===i)){var a=null===(n=e.label.getComponent(ee))||void 0===n?void 0:n.contentSize;void 0!==a&&e.layout.setContentSize(a.width+e.left+e.right,a.height+e.top+e.down)}},e}return N(i,[{key:"top",get:function(){return this._top},set:function(e){this._top=e,this.updateContentSize()}},{key:"down",get:function(){return this._down},set:function(e){this._down=e,this.updateContentSize()}},{key:"left",get:function(){return this._left},set:function(e){this._left=e,this.updateContentSize()}},{key:"right",get:function(){return this._right},set:function(e){this._right=e,this.updateContentSize()}},{key:"__preload",value:function(){this.layout=this.getComponent(ee),t.validateRequiredProperties(this)}},{key:"start",value:function(){this.updateContentSize()}},{key:"onEnable",value:function(){this.listenEvent()}},{key:"onDisable",value:function(){this.unlistenEvent()}},{key:"listenEvent",value:function(){be.on(l.LOCALIZE_APPLIED,this.updateContentSize)}},{key:"unlistenEvent",value:function(){be.off(l.LOCALIZE_APPLIED,this.updateContentSize)}}]),i}(ce)).prototype,"label",[Ar],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xr=M(Br.prototype,"layout",[Tr,Pr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ur=M(Br.prototype,"_top",[Rr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gr=M(Br.prototype,"_down",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hr=M(Br.prototype,"_left",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vr=M(Br.prototype,"_right",[Lr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),M(Br.prototype,"top",[_r],Object.getOwnPropertyDescriptor(Br.prototype,"top"),Br.prototype),M(Br.prototype,"down",[Dr],Object.getOwnPropertyDescriptor(Br.prototype,"down"),Br.prototype),M(Br.prototype,"left",[Mr],Object.getOwnPropertyDescriptor(Br.prototype,"left"),Br.prototype),M(Br.prototype,"right",[Nr],Object.getOwnPropertyDescriptor(Br.prototype,"right"),Br.prototype),zr=Br))||zr)||zr)||zr);Q._RF.pop(),Q._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var dl,yl,fl,vl,gl,ml,bl,wl,Sl,kl=$.ccclass,Cl=$.property,El=function(){function e(t,n){z(this,e);var i=null!=n?n:{response:1,dampen:1,eager:1};this.k1=e.calcK1(i),this.k2=e.calcK2(i),this.k3=e.calcK3(i),this.xp=t.clone(),this.y=t.clone(),this.yd=new Oe(0,0)}return N(e,[{key:"update",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=n;null===i&&(i=new Oe((t.x-this.xp.x)/e,(t.y-this.xp.y)/e),this.xp.x=t.x,this.xp.y=t.y);var a=Math.max(this.k2,e*e/2+e*this.k1/2,e*this.k1);return this.y.x=this.y.x+e*this.yd.x,this.y.y=this.y.y+e*this.yd.y,this.yd.x=this.yd.x+e*(t.x+this.k3*i.x-this.y.x-this.k1*this.yd.x)/a,this.yd.y=this.yd.y+e*(t.y+this.k3*i.y-this.y.y-this.k1*this.yd.y)/a,this.y}},{key:"setDynamics",value:function(t){this.k1=e.calcK1(t),this.k2=e.calcK2(t),this.k3=e.calcK3(t)}},{key:"reset",value:function(e){this.xp.set(e.x,e.y),this.y.set(e.x,e.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(e){return e.dampen/(Math.PI*e.response)}},{key:"calcK2",value:function(e){return 1/(2*Math.PI*e.response*(2*Math.PI*e.response))}},{key:"calcK3",value:function(e){return e.eager*e.dampen/(2*Math.PI*e.response)}}]),e}(),Al=($r=kl("SODConfig"),el=Cl({type:ne,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),tl=Cl({type:ne,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),nl=Cl({type:ne,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),$r((ol=M((al=N((function e(){z(this,e),B(this,"response",ol,this),B(this,"dampen",rl,this),B(this,"eager",ll,this)}))).prototype,"response",[el],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),rl=M(al.prototype,"dampen",[tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),ll=M(al.prototype,"eager",[nl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),il=al))||il);Q._RF.pop(),Q._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var Tl,Pl,Rl,Ol,Il,Ll,_l,Dl,Ml,Nl,zl,Bl,Fl,xl,Ul,Gl,Hl,Vl,ql,Wl,Kl,jl,Yl,Xl,Zl,Jl,Ql=$.ccclass,$l=$.property,es=(dl=Ql("Trail"),yl=$l({type:ge,displayName:"Target"}),fl=$l({type:me,displayName:"Graphics"}),vl=$l({type:[Al],displayName:"Trail Nodes"}),dl((bl=M((ml=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"target",bl,U(e)),B(e,"graphics",wl,U(e)),B(e,"trailNodes",Sl,U(e)),e.trailNodeInstances=[],e}return N(n,[{key:"reset",value:function(){var e,t=H(this.trailNodeInstances);try{for(t.s();!(e=t.n()).done;){e.value.reset(new Oe(this.node.worldPosition.x,this.node.worldPosition.y))}}catch(e){t.e(e)}finally{t.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(e){this.graphics.clear();var t=this.trailNodeInstances[0];this.drawTrail(e,t,this.target.worldPosition.x,this.target.worldPosition.y);for(var n=1;n<this.trailNodeInstances.length;n++){var i=this.trailNodeInstances[n-1],a=this.trailNodeInstances[n];this.drawTrail(e,a,i.currentState.x,i.currentState.y)}}},{key:"drawTrail",value:function(e,t,n,i){var a=this.graphics,o=new Oe(n,i),r=t.update(e,o),l=new Ie(o.x,o.y,0),s=new Ie(r.x,r.y,0);a.node.inverseTransformPoint(l,l),a.node.inverseTransformPoint(s,s),a.moveTo(l.x,l.y),a.lineTo(s.x,s.y),a.stroke()}},{key:"spawnTrailNodes",value:function(){var e,t=H(this.trailNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=new Oe(this.node.worldPosition.x,this.node.worldPosition.y),a=new El(i,n);this.trailNodeInstances.push(a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(ce)).prototype,"target",[yl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl=M(ml.prototype,"graphics",[fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sl=M(ml.prototype,"trailNodes",[vl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gl=ml))||gl);Q._RF.pop(),Q._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var ts,ns=$.ccclass,is=$.executionOrder,as=$.property,os=GameCore.Utils.Function,rs="Batch By Name",ls="Batch Label",ss="Batch Sprite",us=(Tl=ns("BatchNodes"),Pl=is(99999),Rl=as({group:{name:rs}}),Ol=as({type:[te],group:{name:rs}}),Il=as({type:[Le],group:{name:rs}}),Ll=as({group:{name:ls}}),_l=as({group:{name:ls}}),Dl=as({group:{name:ls}}),Ml=as({group:{name:ss}}),Nl=as({group:{name:ss}}),zl=as({readonly:!0}),Bl=as({readonly:!0}),Fl=as({readonly:!0}),Tl(xl=Pl((Gl=M((Ul=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"batchByName",Gl,U(e)),B(e,"depthNames",Hl,U(e)),B(e,"listName",Vl,U(e)),B(e,"batchLabel",ql,U(e)),B(e,"depthLabel",Wl,U(e)),B(e,"typeLabel",Kl,U(e)),B(e,"batchSprite",jl,U(e)),B(e,"depthSprite",Yl,U(e)),B(e,"batchAllNodes",Xl,U(e)),B(e,"batchDepth",Zl,U(e)),B(e,"checkOverlap",Jl,U(e)),e.batchNode={},e.labelChildren=[],e.spriteChildren=[],e.allChildren=[],e.nameChildren=[],e.originalParents={},e.isInited=!1,e.handleNodeChange=os.throttle((function(){e.isInited&&(console.warn("handleNodeChange",e.node.name),e.setupBatchNodes(e.node))}),1e3),e.onAfterUpdate=function(){e.isInited&&e.hierarchyChildren()},e.onAfterRender=function(){e.isInited&&e.restoreOriginalChildren()},e}return N(n,[{key:"__preload",value:function(){this.enabled&&(_e.on(De.EVENT_AFTER_UPDATE,this.onAfterUpdate),_e.on(De.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){_e.off(De.EVENT_AFTER_UPDATE,this.onAfterUpdate),_e.off(De.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){this.isInited||(_e.on(De.EVENT_AFTER_UPDATE,this.onAfterUpdate),_e.on(De.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"handleActiveChange",value:function(e){e.once(ge.EventType.ACTIVE_IN_HIERARCHY_CHANGED,this.handleNodeChange)}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),_e.off(De.EVENT_AFTER_UPDATE,this.onAfterUpdate),_e.off(De.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(e){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(e),this.createGlobalNodes(e),this.createGlobalNameNodes(e),this.createGlobalLabelNode(e),this.createGlobalSpriteNode(e),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var e,t,n,i=this;null===(e=this.batchNode.node)||void 0===e||e.setSiblingIndex(0),null===(t=this.batchNode.label)||void 0===t||t.setSiblingIndex(this.depthLabel),null===(n=this.batchNode.sprite)||void 0===n||n.setSiblingIndex(this.depthSprite),this.listName.forEach((function(e,t){var n,a=i.depthNames[t];void 0!==a?null===(n=i.batchNode[e])||void 0===n||n.setSiblingIndex(a):console.warn("BatchNodes: depth is undefined",e,t,a)}))}},{key:"createGlobalNodes",value:function(e){if(this.batchAllNodes){var t=new ge("GlobalBatchNode");t.active=!0,this.batchNode.node=t,e.addChild(t)}}},{key:"createGlobalNameNodes",value:function(e){if(this.batchByName){var t,n=H(this.listName);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(!this.batchNode[i]){var a=new ge(i);a.active=!0,this.batchNode[i]=a,e.addChild(a)}}}catch(e){n.e(e)}finally{n.f()}}}},{key:"createGlobalLabelNode",value:function(e){if(this.batchLabel){var t=new ge("GlobalLabelNode");t.active=!0,this.batchNode.label=t,e.addChild(t)}}},{key:"createGlobalSpriteNode",value:function(e){if(this.batchSprite){var t=new ge("GlobalSpriteNode");t.active=!0,this.batchNode.sprite=t,e.addChild(t)}}},{key:"saveOriginalParents",value:function(){var e,t=[].concat(j(this.labelChildren),j(this.spriteChildren)),n=this.nameChildren,i=H(t);try{for(i.s();!(e=i.n()).done;){var a=e.value;a.node.parent&&(this.handleActiveChange(a.node),this.originalParents[a.uuid]=a.node.parent)}}catch(e){i.e(e)}finally{i.f()}var o,r=H(n);try{for(r.s();!(o=r.n()).done;){var l=o.value;l.parent&&(this.handleActiveChange(l),this.originalParents[l.uuid]=l.parent)}}catch(e){r.e(e)}finally{r.f()}}},{key:"saveOriginalChildren",value:function(e){var t,n=e.children,i=H(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;this.saveLabelChildren(a),this.saveSpriteChildren(a),this.saveNodeChildrenByName(a),this.saveNodeChildrenByType(a)}}catch(e){i.e(e)}finally{i.f()}this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(e){var t;if(this.batchLabel){var n=e.getComponentsInChildren(Se),i={none:Se.CacheMode.NONE,char:Se.CacheMode.CHAR,bitmap:Se.CacheMode.BITMAP}[this.typeLabel];i&&(n=n.filter((function(e){return e.cacheMode===i}))),0!==n.length&&(t=this.labelChildren).push.apply(t,j(n))}}},{key:"saveSpriteChildren",value:function(e){var t;if(this.batchSprite){var n=e.getComponentsInChildren(le);0!==n.length&&(t=this.spriteChildren).push.apply(t,j(n))}}},{key:"saveNodeChildrenByName",value:function(e){if(this.batchByName){var t,n=H(e.children);try{for(n.s();!(t=n.n()).done;){var i=t.value;this.listName.includes(i.name)?this.nameChildren.push(i):this.saveNodeChildrenByName(i)}}catch(e){n.e(e)}finally{n.f()}}}},{key:"saveNodeChildrenByType",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.batchAllNodes){var i=e.getComponentsInChildren(ce);if((t=this.allChildren).push.apply(t,j(i)),!(this.batchDepth<1||n>=this.batchDepth)){var a,o=H(this.allChildren);try{for(o.s();!(a=o.n()).done;){var r=a.value;this.saveNodeChildrenByType(r.node,this.batchDepth)}}catch(e){o.e(e)}finally{o.f()}}}}},{key:"hierarchyChildren",value:function(){var e,t=function(e,t){e.node.isValid&&e.node.activeInHierarchy&&t&&!e.node.isChildOf(t)&&(e.node.setParent(t,!0),e.node.layer=Me.Enum.UI_2D)},n=["GlobalLabelNode","GlobalSpriteNode","GlobalBatchNode"],i=H(this.labelChildren);try{for(i.s();!(e=i.n()).done;){t(e.value,this.batchNode.label)}}catch(e){i.e(e)}finally{i.f()}var a,o=H(this.spriteChildren);try{for(o.s();!(a=o.n()).done;){t(a.value,this.batchNode.sprite)}}catch(e){o.e(e)}finally{o.f()}var r,l=H(this.allChildren);try{for(l.s();!(r=l.n()).done;){t(r.value,this.batchNode.node)}}catch(e){l.e(e)}finally{l.f()}this.allChildren.sort((function(e,t){return e.constructor.name.localeCompare(t.constructor.name)})),this.labelChildren.sort((function(e,t){return e.cacheMode-t.cacheMode}));var s,u=H(this.nameChildren);try{for(u.s();!(s=u.n()).done;){var c=s.value;if(c.isValid&&c.activeInHierarchy&&c.isTransformDirty()){var h=c.getComponent(he);if(!(h&&h.opacity<1||n.includes(c.name))){var p=this.batchNode[c.name];p&&(c.isChildOf(p)||(c.setParent(p,!0),c.layer=Me.Enum.UI_2D))}}}}catch(e){u.e(e)}finally{u.f()}}},{key:"restoreOriginalChildren",value:function(){var e=[].concat(j(this.labelChildren),j(this.spriteChildren));if(e.length>0){var t,n=H(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=this.originalParents[i.uuid];a&&(i.node.isChildOf(a)||i.node.setParent(a,!0))}}catch(e){n.e(e)}finally{n.f()}}var o,r=H(this.nameChildren);try{for(r.s();!(o=r.n()).done;){var l=o.value,s=this.originalParents[l.uuid];s&&(l.isChildOf(s)||l.setParent(s,!0))}}catch(e){r.e(e)}finally{r.f()}}}]),n}(ce)).prototype,"batchByName",[Rl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Hl=M(Ul.prototype,"depthNames",[Ol],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vl=M(Ul.prototype,"listName",[Il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ql=M(Ul.prototype,"batchLabel",[Ll],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Wl=M(Ul.prototype,"depthLabel",[_l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Kl=M(Ul.prototype,"typeLabel",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),jl=M(Ul.prototype,"batchSprite",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Yl=M(Ul.prototype,"depthSprite",[Nl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xl=M(Ul.prototype,"batchAllNodes",[zl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zl=M(Ul.prototype,"batchDepth",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Jl=M(Ul.prototype,"checkOverlap",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xl=Ul))||xl)||xl);Q._RF.pop(),Q._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var cs,hs=$.ccclass,ps=GameCore.Utils.Browser,ds=globalThis.game.player,ys=hs("Vibrate")(ts=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"vibrate",value:function(e){if(this.isVibrateEnable()&&!ps.vibrate(e)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!ds.getPlayerSetting("vibrate")}}]),n}(ce))||ts;Q._RF.pop(),Q._RF.push({},"21fbd1aIo9DNoKfAoZaF1DC","WidgetCanvasTarget",void 0);var fs;(0,$.ccclass)("WidgetCanvasTarget")(cs=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"__preload",value:function(){var e=this.getComponent(ie);if(e){var t=Ne("Canvas");t&&(e.target=t)}}}]),n}(ce));Q._RF.pop(),Q._RF.push({},"4231ekw8TxKt6dwgto3CKYu","CloudAnimation",void 0),Q._RF.pop(),Q._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var vs=10,gs=20,ms=100,bs=(Y(fs={},d.HINT,80),Y(fs,d.THUNDER,200),Y(fs,d.STORM,150),Y(fs,d.PLIERS,150),fs),ws=2e3,Ss=300;Q._RF.pop(),Q._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var ks={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};Q._RF.pop(),Q._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var Cs=function(e){return e.UNLOCK_DEV_TOOLS="unlock-dev-tools",e.TRIGGER_UNLOCK_KEY="trigger-unlock-key",e.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",e}(Cs||{}),Es={Events:Cs,UNLOCK_SEQUENCE:"101013012031"};Q._RF.pop(),Q._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var As=function(e){return e.RELOAD_TOURNAMENT="reload-tournament",e}(As||{});Q._RF.pop(),Q._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var Ts=function(e){F(n,e);var t=x(n);function n(e,i){var a;return z(this,n),(a=t.call(this,i)).code=e,a}return N(n)}(X(Error));Q._RF.pop(),Q._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var Ps=function(e){F(n,e);var t=x(n);function n(e,i){var a;return z(this,n),(a=t.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=e,a.tournamentId=i,a}return N(n)}(Ts);Q._RF.pop(),Q._RF.push({},"e80e4nIcfdLN56j5b9SMhvH","LeaderboardUtils",void 0);var Rs=globalThis.game.leaderboard,Os=function(){function e(){z(this,e)}var t,n,i;return N(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getAllLeaderboardAsync",value:(i=W((function*(e){if(!Rs)return null;var t=yield Rs.getLeaderboardResponseAsync(e);if(!t)return null;var n=Rs.getLeaderboardName(e);return n?(yield this.requestLeaderboardAsync(n,t.amountPlayer),Rs.getLeaderboard(n)):null})),function(e){return i.apply(this,arguments)})},{key:"requestLeaderboardAsync",value:(n=W((function*(e,t){this.isLeaderboardRequesting(e)?yield this.waitForLeaderboardFinishAsync(e):yield Rs.requestLeaderboardAsync(e,t)})),function(e,t){return n.apply(this,arguments)})},{key:"waitForLeaderboardFinishAsync",value:(t=W((function*(e){var t=this;if(this.isLeaderboardRequesting(e))return new Promise((function(n){var i=setInterval((function(){t.isLeaderboardRequesting(e)||(clearInterval(i),n())}),100)}))})),function(e){return t.apply(this,arguments)})},{key:"isLeaderboardRequesting",value:function(e){var t;return(null===(t=Rs.getLeaderboard(e))||void 0===t?void 0:t.isRequesting)||!1}}]),e}();try{new Os}catch(e){console.error("LeaderboardUtils",e)}Q._RF.pop(),Q._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var Is={mapOrder:[{id:1,theme:"summer",skins:["fruit"],levelCount:10},{id:2,theme:"autumn",skins:["flower"],levelCount:10},{id:3,theme:"winter",skins:["tool"],levelCount:10},{id:4,theme:"summer",skins:["sport"],levelCount:10},{id:5,theme:"autumn",skins:["cosmetics"],levelCount:10},{id:6,theme:"winter",skins:["ice-cream"],levelCount:10},{id:7,theme:"summer",skins:["cakes"],levelCount:10},{id:8,theme:"autumn",skins:["car"],levelCount:10},{id:9,theme:"spring-festival",skins:["flower","ice-cream"],levelCount:10},{id:10,theme:"tree-planting-festival",skins:["fruit","car","tool"],levelCount:10},{id:11,theme:"blue-sea-festival",skins:["sport","fruit"],levelCount:10},{id:12,theme:"music-festival",skins:["cakes","car","cosmetics"],levelCount:10},{id:13,theme:"harvest-festival",skins:["fruit","car","tool"],levelCount:10},{id:14,theme:"food-festival",skins:["cakes","ice-cream","cosmetics"],levelCount:10},{id:15,theme:"snow-festival",skins:["cakes","sport"],levelCount:10},{id:16,theme:"light-festival",skins:["ice-cream","car"],levelCount:10},{id:17,theme:"peace-festival",skins:["flower","sport","tool"],levelCount:10},{id:18,theme:"flower-festival",skins:["flower","fruit"],levelCount:10},{id:19,theme:"street-festival",skins:["fruit","ice-cream","sport"],levelCount:10},{id:20,theme:"color-garden",skins:["cakes","cosmetics","tool"],levelCount:10},{id:21,theme:"color-festival",skins:["flower","cakes","fruit"],levelCount:10},{id:22,theme:"nature-summer",skins:["flower","sport"],levelCount:10},{id:23,theme:"snow-mountain",skins:["cakes","ice-cream"],levelCount:10},{id:24,theme:"ice-festival",skins:["ice-cream","cosmetics"],levelCount:10},{id:25,theme:"green-grass-festival",skins:["flower","sport","tool"],levelCount:10},{id:26,theme:"community-festival",skins:["cosmetics","cakes","ice-cream"],levelCount:10},{id:27,theme:"water-festival",skins:["sport","ice-cream","flower"],levelCount:10},{id:28,theme:"animal-festival",skins:["flower","fruit","cakes"],levelCount:10},{id:29,theme:"lost-festival",skins:["sport","tool","car"],levelCount:10},{id:30,theme:"halloween-festival",skins:["cakes","car","fruit"],levelCount:10},{id:31,theme:"snow-music-festival",skins:["ice-cream","sport","tool"],levelCount:10},{id:32,theme:"christmas",skins:["cakes","flower","sport"],levelCount:10},{id:33,theme:"spring-flower-festival",skins:["flower","fruit"],levelCount:10},{id:34,theme:"tet-holiday",skins:["flower","cosmetics","fruit"],levelCount:10},{id:35,theme:"sea-festival",skins:["ice-cream","sport"],levelCount:10},{id:36,theme:"firework-festival",skins:["cosmetics","car","tool"],levelCount:10},{id:37,theme:"halloween-horror",skins:["cakes","car","fruit"],levelCount:10},{id:38,theme:"mid-autumn",skins:["flower","fruit","ice-cream"],levelCount:10},{id:39,theme:"christmas-sweet",skins:["cakes","flower","sport"],levelCount:10},{id:40,theme:"new-year-countdown",skins:["cosmetics","car","tool"],levelCount:10}]};Q._RF.pop(),Q._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var Ls=globalThis.game,_s=Ls.player,Ds=Ls.storage,Ms=Is.mapOrder.map((function(e){return{skins:e.skins,themeId:e.theme,currentProgress:0,maxProgress:e.levelCount,isLocked:!0}})),Ns=function(){function e(){z(this,e),this.playerSkinProgress=Ms.map((function(e){return G({},e)}))}return N(e,[{key:"initDefaultPlayerSkinProgress",value:function(){this.playerSkinProgress=Ms.map((function(e){return G({},e)}))}},{key:"initDashboardSceneStorage",value:function(){var e=Ds.getStorage("dashboard");if(null==e){var t=this.getCurrentMapProgressInstance();Ds.addStorage("dashboard",{lastMapPayload:t,numOfMapsPassed:0,animateToCurrentLevel:!1});var n=Ds.getStorage("collection");if(null==n){Ds.addStorage("collection",{lastMapPack:t.id,animateMapPackUnlock:!1});var i=Ds.getStorage("leaderboard_content");if(null==i){Ds.addStorage("leaderboard_content",{lastTabOpened:"global",previousScore:-1});var a=Ds.getStorage("tournament");null==a&&Ds.addStorage("tournament",{animateTournamentLeader:!1,previousScore:-1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){for(var e=void 0,t=void 0,n=0,i=0,a=0,o=0,r=Is.mapOrder.length;o<r;o++){var l=this.playerSkinProgress[o],s=Is.mapOrder[o],u=Is.mapOrder[o+1];if(l.currentProgress<l.maxProgress){var c;a=s.id,e=s.theme,t=null!==(c=null==u?void 0:u.theme)&&void 0!==c?c:e,n=l.currentProgress,i=l.maxProgress;break}}if(void 0===e||void 0===t){var h=Is.mapOrder[Is.mapOrder.length-1];return{id:a=h.id,currentTheme:e=h.theme,nextTheme:t=h.theme,progress:n=h.levelCount,max:i=h.levelCount}}return{id:a,currentTheme:e,nextTheme:t,progress:n,max:i}}},{key:"getUnlockedSkinsInstance",value:function(){var e,t=[],n=H(this.playerSkinProgress);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(!i.isLocked&&1===i.skins.length){var a=i.skins[0];a&&t.push(a)}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"getLevelSkinsInstance",value:function(e){var t,n=null!=e?e:1,i=0,a=H(Is.mapOrder);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(i+o.levelCount>=n)return o.skins;i+=o.levelCount}}catch(e){a.e(e)}finally{a.f()}return Is.mapOrder[Is.mapOrder.length-1].skins}},{key:"getLevelThemeInstance",value:function(e){var t,n=null!=e?e:1,i=0,a=H(Is.mapOrder);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(i+o.levelCount>=n)return o.theme;i+=o.levelCount}}catch(e){a.e(e)}finally{a.f()}return Is.mapOrder[Is.mapOrder.length-1].theme}},{key:"getThemeSkinsInstance",value:function(e){var t,n=H(Is.mapOrder);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.theme===e)return i.skins}}catch(e){n.e(e)}finally{n.f()}return[]}},{key:"getCollectionUnlockProgressInstance",value:function(){var e,t=[],n=H(this.playerSkinProgress);try{for(n.s();!(e=n.n()).done;){var i=e.value;t.push({skins:i.skins,theme:i.themeId,progress:i.currentProgress,max:i.maxProgress,isLocked:i.isLocked})}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"updatePlayerSkinProgress",value:function(){var e,t=_s.getGameData(),n=(null!==(e=null==t?void 0:t.level)&&void 0!==e?e:1)-1;this.playerSkinProgress[0].isLocked=!1;for(var i=0,a=Is.mapOrder.length;i<a;i++){var o=Is.mapOrder[i];if(!(n<=0)){var r=n-o.levelCount>=0?o.levelCount:n;n-=r,this.increaseProgress(i,r)}}}},{key:"increaseProgress",value:function(e,t){if(e<0||e>=this.playerSkinProgress.length)throw new Error("increaseProgress: index out of range");var n,i=this.playerSkinProgress[e],a=i.currentProgress,o=i.maxProgress,r=a+t>o?o:a+t;(r>0&&(i.isLocked=!1),r===o)&&((null===(n=Is.mapOrder[e+1])||void 0===n?void 0:n.skins)&&(this.playerSkinProgress[e+1].isLocked=!1));i.currentProgress=r,i.maxProgress=o}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var e=this.getInstance();e.initDefaultPlayerSkinProgress(),e.updatePlayerSkinProgress(),e.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkins",value:function(e){return this.getInstance().getLevelSkinsInstance(e)}},{key:"getLevelTheme",value:function(e){return this.getInstance().getLevelThemeInstance(e)}},{key:"getThemeSkins",value:function(e){return this.getInstance().getThemeSkinsInstance(e)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"getCurrentUnlockingThemeIndex",value:function(){var e=this.getCollectionUnlockProgress();if(0===e.length)return null;var t=0;return e.forEach((function(e,n){e.isLocked||(t=n)})),t}}]),e}();Q._RF.pop(),Q._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var zs=globalThis.game,Bs=zs.match,Fs=zs.player,xs=zs.leaderboard,Us=zs.frameCapture,Gs=GameCore,Hs=Gs.Utils,Vs=Hs.Object,qs=Hs.Valid,Ws=Hs.String,Ks=Hs.Array,js=Gs.Match.Modes,Ys=Gs.Dtos.Match.Data,Xs=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],Zs=function(){function e(){z(this,e)}var t,n,i,a,o,r,l,s,u,c,h,p,d,y,f,v,g,m,b;return N(e,[{key:"processStartSingleModeAsync",value:(b=W((function*(){var e=Fs.getPlayerId();yield Bs.single.start.processAsync({playerId:e})})),function(){return b.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(m=W((function*(){yield Bs.single.finish.processAsync()})),function(){return m.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(g=W((function*(){var e=Fs.getPlayerId(),t=GameSDK.context.getID();yield Bs.tournament.continue.processAsync({playerId:e,contextId:t})})),function(){return g.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(v=W((function*(){var e=Fs.getPlayerId(),t=Fs.getBestScore();yield Bs.tournament.finish.processAsync({playerId:e,bestScore:t})})),function(){return v.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(f=W((function*(){try{yield this.processContinueChallengeAsync()}catch(e){if(!Vs.hasOwn(e,"name")||qs.isString(e.name))throw e;"PlayerHasFinishedMatch"===e.name&&(yield this.processChallengeNewOpponentAsync()),"PlayerNotJoinInMatch"===e.name&&(yield this.processJoinChallengeAsync())}})),function(){return f.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(y=W((function*(e){Us.addWideframeRender("renderResultChallenge",Us.wideframe.renderResultChallenge),yield Bs.challenge.finish.processAsync(e)})),function(e){return y.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(d=W((function*(){var e=this.getMatchState(),t=e.id,n=e.customData,i=n.playerId,a=n.opponentId;if(!qs.isString(t))throw new Error("Invalid match id");if(!qs.isString(i))throw new Error("Invalid player id");if(!qs.isString(a))throw new Error("Invalid opponent id");var o=GameSDK.context.getID();if(!o)throw new Error("Cannot get contextId");yield Bs.challenge.continue.processAsync({matchId:t,contextId:o,playerId:i,opponentId:a})})),function(){return d.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(p=W((function*(){var e=Fs.getConnectedPlayerIds(100,0),t=Math.floor(Math.random()*e.length),n=Fs.getPlayerId(),i=e[t];yield Bs.challenge.friend.processAsync({playerId:n,opponentId:i})})),function(){return p.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(h=W((function*(){var e=this.getMatchState(),t=e.id,n=e.customData,i=n.playerId,a=n.opponentId;if(!qs.isString(t))throw new Error("Invalid match id");if(!qs.isString(i))throw new Error("Invalid player id");if(!qs.isString(a))throw new Error("Invalid opponent id");yield Bs.challenge.join.processAsync({matchId:t,playerId:i,opponentId:a})})),function(){return h.apply(this,arguments)})},{key:"getMatchState",value:function(){var e=Bs.getMatchState();if(!e)throw new Error("Match state not found");return e}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(c=W((function*(e){try{switch(null!=e?e:this.getMatchMode()){case js.SINGLE:yield this.inst.processStartSingleModeAsync();break;case js.TOURNAMENT:yield this.inst.processStartTournamentModeAsync();break;case js.CHALLENGE_FRIEND:yield this.inst.processStartChallengeModeAsync();break;default:yield this.inst.processStartSingleModeAsync()}}catch(e){console.warn("startMatchAsync",e)}})),function(e){return c.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(u=W((function*(e){try{yield Bs.handler.setProfileData(e)}catch(e){console.warn("setProfileMatchDataAsync",e)}})),function(e){return u.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(s=W((function*(e){try{yield Bs.handler.setMatchCustomData(e)}catch(e){console.warn("setMatchCustomDataAsync",e)}})),function(e){return s.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(l=W((function*(e){try{yield Bs.handler.setLeaderboardScore(e)}catch(e){console.warn("setLeaderboardScoreAsync",e)}})),function(e){return l.apply(this,arguments)})},{key:"finishMatchAsync",value:(r=W((function*(e){try{switch(this.getMatchMode()){case js.SINGLE:yield this.inst.processFinishSingleModeAsync();break;case js.TOURNAMENT:yield this.inst.processFinishTournamentModeAsync();break;case js.CHALLENGE_FRIEND:yield this.inst.processFinishChallengeModeAsync(e);break;default:yield this.inst.processFinishSingleModeAsync()}}catch(e){console.warn("finishMatchAsync",e)}})),function(e){return r.apply(this,arguments)})},{key:"joinTournamentAsync",value:(o=W((function*(e){var t=Fs.getPlayerId();yield Bs.tournament.join.processAsync({tournamentId:e,playerId:t})})),function(e){return o.apply(this,arguments)})},{key:"continueTournamentAsync",value:(a=W((function*(e){var t=Fs.getPlayerId();yield Bs.tournament.continue.processAsync({playerId:t,contextId:e})})),function(e){return a.apply(this,arguments)})},{key:"createTournamentName",value:function(){var e=Xs[Te.randomRangeInt(0,Xs.length-1)],t="".concat(e," Tournament"),n=Ws.removeDiacritics(t);return"".concat(n)}},{key:"getShortName",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,i=e.split(" "),a=0,o="",r=H(i);try{for(r.s();!(t=r.n()).done;){var l=t.value;if(a+l.length+1>n)break;o+="".concat(l," "),a+=l.length+1}}catch(e){r.e(e)}finally{r.f()}return o.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var e,t,n,i=Ws.generateObjectId(),a=Fs.getPlayerId(),o=Fs.getPlayer().name,r=Fs.getGameData(),l=null!==(e=null==r?void 0:r.level)&&void 0!==e?e:1,s=Ns.getLevelTheme(l),u=this.inst.getMatchState().profiles;return{score:null!==(t=null===(n=(void 0===u?{}:u)[a])||void 0===n?void 0:n.score)&&void 0!==t?t:0,playerId:a,mode:js.TOURNAMENT,name:this.createTournamentName(),leaderboardId:i,payload:{playerId:a,playerName:o,leaderboardId:i,themeId:s}}}},{key:"getTournamentsAsync",value:(i=W((function*(){try{return yield GameSDK.tournament.getTournamentsAsync()}catch(e){return console.error(e),[]}})),function(){return i.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(n=W((function*(){var e=yield this.getTournamentsAsync(),t=Ks.search(e,(function(e){var t,n=JSON.parse(null!==(t=e.getPayload())&&void 0!==t?t:"{}");return"DEFAULT"===e.getTournamentType()&&n.playerId===Fs.getPlayerId()}));if(t)throw new Ps(Fs.getPlayerId(),t.getID());var n=this.createTournamentPayload();Fs.setGameData({lastCreateTournamentShown:Date.now()}),yield Bs.tournament.create.processAsync(n);var i=n.leaderboardId;xs.addLeaderboard({name:i,type:"tournament",autoSortRank:!0,leaderboardId:i})})),function(){return n.apply(this,arguments)})},{key:"getMatchMode",value:function(){var e=this.inst.getMatchState();return qs.isString(e.mode)?e.mode:null}},{key:"getMatchCustomData",value:function(){var e=this.inst.getMatchState();return qs.isObject(e.customData)?e.customData:null}},{key:"getMatchExtraDataAsync",value:(t=W((function*(e){var t=yield Bs.api.getMatchAPI().getMatchDetailByIdAsync(e);return new Ys(t).toObject().extraData})),function(e){return t.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(e,t){this.setMatchCustomDataAsync({level:e,score:t});var n=Fs.getPlayerId();this.setProfileMatchDataAsync({id:n,score:t})}}]),e}();Q._RF.pop(),Q._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var Js,Qs="time",$s="bomb";Q._RF.pop(),Q._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var eu=(0,$.ccclass)("InputController")(Js=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).handleElementPointerDown=function(){},e.handleElementPointerUp=function(e){},e}return N(n,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){Ce.os!==Ce.OS.WINDOWS&&Ce.os!==Ce.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){Ce.os!==Ce.OS.WINDOWS&&Ce.os!==Ce.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(ce))||Js;Q._RF.pop(),Q._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var tu={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};Q._RF.pop(),Q._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var nu="fall-down",iu="fly-up",au="push-left",ou="push-right",ru="put-columns-middle",lu="put-rows-middle",su=[nu,iu,au,ou,ru,lu],uu=[nu,iu,lu],cu=[au,ou,ru];function hu(e){for(var t=e.array,n=e.isLighter,i=e.out,a=void 0===i?new Set:i,o=0;o<t.length;o++)if(n(t.get(o)))for(var r=o+1;r<t.length;r++)if(!n(t.get(r))){t.swap(o,r),a.add(t.get(o));break}return a}Q._RF.pop(),Q._RF.push({},"bfb989Gr/dArq4M9uSSrF5/","stagger",void 0),Q._RF.pop(),Q._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var pu,du,yu,fu,vu,gu,mu,bu,wu,Su,ku,Cu,Eu,Au,Tu,Pu,Ru,Ou,Iu,Lu,_u,Du,Mu,Nu,zu,Bu,Fu,xu,Uu,Gu,Hu,Vu,qu,Wu,Ku,ju,Yu,Xu,Zu,Ju,Qu,$u,ec,tc,nc,ic,ac,oc=function(){function e(t){var n;z(this,e),this.array=[];var i=null!=t?t:{},a=i.width,o=void 0===a?1:a,r=i.height,l=void 0===r?1:r,s=t instanceof e?t.array:null!==(n=null==t?void 0:t.content)&&void 0!==n?n:[];if(s.length!==o*l)throw new Error("Invalid content length");this.width=o,this.height=l,this.array=j(s)}return N(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(e,t){if(!this.isInBounds(e,t))throw new Error("Out of bounds");return this.array[t*this.width+e]}},{key:"set",value:function(e,t,n){this.array[t*this.width+e]=n}},{key:"isInBounds",value:function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}},{key:"forEach",value:function(e){for(var t=0;t<this.height;t++)for(var n=0;n<this.width;n++)e(this.get(n,t),n,t)}},{key:"map",value:function(e){for(var t=[],n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.push(e(this.get(i,n),i,n));return t}},{key:"reduce",value:function(e,t){for(var n=t,i=0;i<this.height;i++)for(var a=0;a<this.width;a++)n=e(n,this.get(a,i),a,i);return n}},{key:"swap",value:function(e,t){var n=Z(e,2),i=n[0],a=n[1],o=Z(t,2),r=o[0],l=o[1],s=this.get(i,a);this.set(i,a,this.get(r,l)),this.set(r,l,s)}},{key:"shuffle",value:function(e){for(var t=null!=e?e:this.map((function(e,t,n){return[t,n]})),n=j(t),i=new Set,a=n.length-1;a>0;a--){var o=ze(0,a+1),r=n[a],l=n[o];n[a]=l,n[o]=r,i.add(this.get(r[0],r[1])),i.add(this.get(l[0],l[1]))}for(var s=0;s<n.length;s++){var u=t[s],c=Z(u,2),h=c[0],p=c[1],d=n[s],y=Z(d,2),f=y[0],v=y[1];this.swap([h,p],[f,v])}return i}},{key:"toShuffled",value:function(t){var n=new e({width:this.width,height:this.height,content:this.array}),i=n.shuffle(t);return[n,i]}},{key:"gravitate",value:function(e){var t=this,n=Z(e.rowRange,2),i=n[0],a=n[1],o=Z(e.colRange,2),r=o[0],l=o[1],s=e.direction,u=e.isLighter,c=e.onSwap,h=e.out,p=void 0===h?new Set:h,d=l-r+1,y=a-i+1;switch(s){case tu.Up:for(var f=function(e){hu({array:{length:y,get:function(n){return t.get(e,a-n)},swap:function(n,i){var o=t.get(e,a-n),r=t.get(e,a-i);t.swap([e,a-n],[e,a-i]),null==c||c(o,r)}},isLighter:u,out:p})},v=r;v<=l;v++)f(v);return p;case tu.Down:for(var g=function(e){hu({array:{length:y,get:function(n){return t.get(e,i+n)},swap:function(n,a){var o=t.get(e,i+n),r=t.get(e,i+a);t.swap([e,i+n],[e,i+a]),null==c||c(o,r)}},isLighter:u,out:p})},m=r;m<=l;m++)g(m);return p;case tu.Left:for(var b=function(e){hu({array:{length:d,get:function(n){return t.get(r+n,e)},swap:function(n,i){var a=t.get(r+n,e),o=t.get(r+i,e);t.swap([r+n,e],[r+i,e]),null==c||c(a,o)}},isLighter:u,out:p})},w=i;w<=a;w++)b(w);return p;case tu.Right:for(var S=function(e){hu({array:{length:d,get:function(n){return t.get(l-n,e)},swap:function(n,i){var a=t.get(l-n,e),o=t.get(l-i,e);t.swap([l-n,e],[l-i,e]),null==c||c(a,o)}},isLighter:u,out:p})},k=i;k<=a;k++)S(k);return p;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var t=new e({width:this.width,height:this.height,content:this.array}),n=t.gravitate.apply(t,arguments);return[t,n]}},{key:"toRotated",value:function(){for(var t=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.set(this.height-1-n,i,this.get(i,n));return t}}]),e}();Q._RF.pop(),Q._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),Q._RF.pop(),Q._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var rc=$.ccclass,lc=$.property,sc=$.requireComponent,uc=(pu=rc("Tile"),du=sc([ee]),yu=sc([he]),fu=t.required,vu=lc({type:le,group:"Sprite"}),gu=t.required,mu=lc({type:le,group:"Sprite"}),bu=t.required,wu=lc({type:le,group:"Sprite"}),Su=t.required,ku=lc({type:le,group:"Sprite"}),Cu=t.required,Eu=lc({type:ee,displayName:"Background UI Transform"}),Au=t.required,Tu=lc(Be),Pu=t.required,Ru=lc({type:he,group:"Opacity"}),Ou=t.required,Iu=lc({type:he,group:"Opacity"}),Lu=t.required,_u=lc({type:he,group:"Opacity"}),Du=t.required,Mu=lc({type:he,group:"Opacity"}),Nu=t.required,zu=lc(hi),Bu=t.required,Fu=lc(Fe),xu=t.required,Uu=lc(ge),Gu=t.onlyRunInLifeCycle,Hu=t.onlyRunInLifeCycleAsync,Vu=t.onlyRunInLifeCycleAsync,pu(qu=du(qu=yu((Ku=M((Wu=function(a){F(k,a);var r,l,s,u,c,h,p,d,v,g,m,b,w,S=x(k);function k(){var e;z(this,k);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=S.call.apply(S,[this].concat(n)),B(e,"icon",Ku,U(e)),B(e,"bombComponent",ju,U(e)),B(e,"starComponent",Yu,U(e)),B(e,"background",Xu,U(e)),B(e,"bgUITransform",Zu,U(e)),B(e,"defaultBackground",Ju,U(e)),B(e,"uiOpacity",Qu,U(e)),B(e,"shineOpacity",$u,U(e)),B(e,"glowOpacity",ec,U(e)),B(e,"iconOpacity",tc,U(e)),B(e,"button",nc,U(e)),B(e,"animationComponent",ic,U(e)),B(e,"container",ac,U(e)),e.clearClip=null,e.shakeClip=null,e.breakClip=null,e.id=null,e.isEmpty=!1,e.coord=new Oe,e.signal=new i,e}return N(k,[{key:"onLoad",value:function(){t.validateRequiredProperties(this,k),this.special=this.createSpecialHandler(y.none)}},{key:"update",value:function(e){var t;(null===(t=this.special)||void 0===t?void 0:t.type)===y.bomb&&this.special.update(e)}},{key:"onDestroy",value:function(){var e,t;(null===(e=this.special)||void 0===e?void 0:e.type)===y.bomb&&(null===(t=this.special)||void 0===t||t.onDestroy())}},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.button.interactable=!e}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(e,t){this.coord.set(e,t)}},{key:"isSimilarTo",value:function(e){return this.id===e.id}},{key:"inSamePositionAs",value:function(e,t){return e instanceof k?this.coord.equals(e.getCoord()):this.coord.x===e&&this.coord.y===t}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(ta.TILE_CLICK,this)}},{key:"setIdentity",value:function(e){this.id=e,this.icon.spriteFrame=e;var t=this.getSize(),n=Z(t,2),i=n[0],a=n[1],o=e.originalSize,r=o.width,l=o.height,s=Math.max(r/(.7*i),l/(.7*a));s>1&&this.icon.node.setScale(new Ie(1/s,1/s,1))}},{key:"setSpecialType",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y.none,n=arguments.length>1?arguments[1]:void 0;null===(e=this.special)||void 0===e||e.switch(t,n)}},{key:"setFocused",value:(w=W((function*(t){var n=ae(this.shineOpacity).to(.15,{opacity:t?255:0},{easing:"cubicOut"});this.shineOpacity.node.scale=t?Ie.ZERO:Ie.ONE;var i=ae(this.shineOpacity.node).to(.15,{scale:t?Ie.ONE:Ie.ZERO},{easing:"cubicOut"});if(t){var a=ae(this.glowOpacity).to(2,{opacity:150});a.to(2,{opacity:20}),this.glowOpacityTween=ae(this.glowOpacity).repeatForever(a).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;yield Promise.all([e.runTweenAsync(n),e.runTweenAsync(i)])})),function(e){return w.apply(this,arguments)})},{key:"setEmpty",value:function(){var e,t,n,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty){var a;if(this.signal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),i)return this.setOpacity(0),void(null===(a=this.special)||void 0===a||a.switch(y.none));(null===(e=this.special)||void 0===e?void 0:e.type)!==y.star&&(null===(t=this.special)||void 0===t?void 0:t.type)!==y.bomb||this.special.clear(),null===(n=this.special)||void 0===n||n.switch(y.none),this.setOpacity(0)}}},{key:"setOpacity",value:function(e){this.uiOpacity.opacity=e}},{key:"setHint",value:(b=W((function*(t){var n;if(t){if(!(yield this.getShakeClip()))return;this.shakeClip&&e.runAnimationAsync(this.animationComponent,this.shakeClip.name,this.signal)}else if(null===(n=this.animationComponent)||void 0===n||n.stop(),this.container){var i=ae(this.container).to(.1,{scale:Ie.ONE,eulerAngles:Ie.ZERO});yield e.runTweenAsync(i,this.signal)}})),function(e){return b.apply(this,arguments)})},{key:"playClearFX",value:(m=W((function*(e){var t=this;this.signal.abort();var n=new i;this.signal=n,this.setOpacity(255),n.addAbortListener((function(){return t.setOpacity(0)}));var a=yield this.getClearClip();null!==a&&(yield this.runAnimationAfterDelay(a.name,e,n),n.aborted||this.setOpacity(0))})),function(e){return m.apply(this,arguments)})},{key:"playOldLightningClearFX",value:(g=W((function*(){var e=this;this.signal.abort();var t=new i;this.signal=t,this.setOpacity(255),t.addAbortListener((function(){return e.setOpacity(0)}));var n=yield this.getOldBreakClip();null!==n&&(yield this.runAnimationAfterDelay(n.name,void 0,t),t.aborted||this.setOpacity(0))})),function(){return g.apply(this,arguments)})},{key:"runAnimationAfterDelay",value:(v=W((function*(t,n,i){n&&(yield e.waitTweenAsync(n,i)),yield this.runAnimation(t,i)})),function(e,t,n){return v.apply(this,arguments)})},{key:"runAnimation",value:function(t,n){return e.runAnimationAsync(this.animationComponent,t,n)}},{key:"restore",value:(d=W((function*(t){this.signal.abort();var n=new i;this.signal=n,this.animationComponent.stop(),this.isEmpty=!1,this.setIgnoreInput(!0),t&&this.setIdentity(t),this.setOpacity(255),this.iconOpacity.opacity=255,this.node.setScale(Ie.ZERO),this.background.spriteFrame=this.defaultBackground,this.button.fakeClick(),yield e.runTweenAsync(ae(this.node).to(.3,{scale:Ie.ONE},{easing:"backOut"}),n),this.node.setScale(Ie.ONE),this.setIgnoreInput(!1)})),function(e){return d.apply(this,arguments)})},{key:"sync",value:(p=W((function*(t){var n=t.duration,i=void 0===n?.3:n,a=t.delay,o=void 0===a?0:a,r=t.easing,l=void 0===r?"cubicOut":r,s=(0,t.getTargetPosition)(this.coord),u=new Ie(s.x,s.y,this.node.position.z);yield e.runTweenAsync(ae(this.node).delay(o).to(i,{position:u},{easing:l}))})),function(e){return p.apply(this,arguments)})},{key:"fly",value:(h=W((function*(t){var n=this,i=300,a=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),o=Math.max(i-.7*a,0),r=a/1e3,l=this.node.position.clone(),s=t.getTilePosition(this.coord),u=new Ie(s.x,s.y,this.node.position.z),c=this.background.node,h=2,p=1,d=360,y=.0025*o,f=0,v=new Ie(0,0,0),g=.75-y,m={value:0,prevElapsed:0},b=ae(m);return b.delay(r),b.to(.5,{value:0},{progress:function(e,t,i,a){var o=(h*=-1)*a,r=l.clone();return r.x+=o,n.node.setPosition(r),i}}),b.to(y,{value:1},{progress:function(t,a,r,l){var s=e.expoOut(l),u=y*l-m.prevElapsed,h=y*l,f=o*s;n.setHeight(f,i);var v=n.node.position.clone();p+=.1,Ie.rotateZ(v,v,new Ie(0,0,0),p*Math.PI*u),n.node.setPosition(new Ie(v.x,v.y,v.z));var g=(d+=10)*u;return c.angle+=g,m.prevElapsed=h,r}}),b.call((function(){v.set((n.node.position.x+u.x)/2,(n.node.position.y+u.y)/2,0),m.prevElapsed=0,c.angle%=360,c.angle-=360,f=c.angle})),b.to(g,{value:0},{progress:function(e,t,a,r){var l=g*r-m.prevElapsed,s=g*r,u=o*(1-r);n.setHeight(u,i);var h=n.node.position.clone();return Ie.rotateZ(h,h,v,Math.PI/g*l),n.node.setPosition(new Ie(h.x,h.y,h.z)),c.angle+=-f/g*l,m.prevElapsed=s,a}}),b.call((function(){n.node.setPosition(u),n.setHeight(0,i),c.angle=0})),e.runTweenAsync(b)})),function(e){return h.apply(this,arguments)})},{key:"moveAround",value:(c=W((function*(){for(var t=[{x:1,y:1},{x:-1,y:1},{x:-1,y:-1},{x:1,y:-1}],n=this.container.position.clone(),i=-1,a=0;a<5;a++){for(var o=Te.randomRangeInt(0,4);i===o;)o=Te.randomRangeInt(0,4);i=o;var r=t[o];if(r){var l=n.clone().add(new Ie(5*r.x,5*r.y)),s=ae(this.container).to(.1,{position:l},{easing:"smooth"});yield e.runTweenAsync(s)}}var u=ae(this.container).to(.1,{position:n},{easing:"smooth"});yield e.runTweenAsync(u)})),function(){return c.apply(this,arguments)})},{key:"getClearClip",value:(u=W((function*(){if(this.clearClip)return this.clearClip;var e=yield n.loadAnimClipAsync(f.TILE_CLEAR_ANIM);return e?(this.clearClip=e,this.animationComponent.addClip(e),e):null})),function(){return u.apply(this,arguments)})},{key:"getShakeClip",value:(s=W((function*(){if(this.shakeClip)return this.shakeClip;var e=yield n.loadAnimClipAsync(f.TILE_SHAKE_ANIM);return e?(this.shakeClip=e,this.animationComponent.addClip(e),e):null})),function(){return s.apply(this,arguments)})},{key:"getOldBreakClip",value:(l=W((function*(){if(this.breakClip)return this.breakClip;var e=yield n.loadAnimClipAsync(f.TILE_BREAK_ANIM);return e?(this.breakClip=e,this.animationComponent.addClip(e),e):null})),function(){return l.apply(this,arguments)})},{key:"setHeight",value:function(e,t){if(this.background){var n=this.background.node;n.setPosition(new Ie(n.position.x,e,0)),n.setScale(new Ie(1+e/t*.3,1+e/t*.3,1))}}},{key:"createSpecialHandler",value:function(e,t){var n=this;switch(e){case y.bomb:return this.createBombHandler(null!=t?t:90);case y.star:return this.createStarHandler();default:return{type:y.none,switch:function(e,t){n.special=n.createSpecialHandler(e,t)}}}}},{key:"createBombHandler",value:function(e){var t=this,n=!1,i=e,a=function(){n=!0},r=function(){n=!1};this.node.scene.on(ta.TILE_CLICK,a),this.node.scene.on(ta.USE_ITEM,a),this.node.scene.on(ta.RESUME_TIME,a),this.node.scene.on(ta.PAUSE_TIME,r),this.node.scene.on(ta.TIME_OUT,r),this.bombComponent.node.active=!0;var l=function(){n=!1,t.bombComponent.node.active=!1,i=e,t.node.scene.off(ta.TILE_CLICK,a),t.node.scene.off(ta.USE_ITEM,a),t.node.scene.off(ta.GAME_RESUME,a),t.node.scene.off(ta.GAME_PAUSE,r),t.node.scene.off(ta.TIME_OUT,r)};return{type:y.bomb,update:function(a){n&&(i-=a,t.bombComponent.fillRange=-i/e,i<=0&&(n=!1,t.bombComponent.node.active=!1,t.setEmpty(!0),t.node.scene.emit(ta.BOMB_EXPLODE,t)))},clear:function(){o.playSound(vn.BOMB_DEFUSE)},cleanup:l,onDestroy:function(){t.node.scene.off(ta.TILE_CLICK,a),t.node.scene.off(ta.USE_ITEM,a),t.node.scene.off(ta.GAME_RESUME,a),t.node.scene.off(ta.GAME_PAUSE,r),t.node.scene.off(ta.TIME_OUT,r)},switch:function(e,n){l(),t.special=t.createSpecialHandler(e,n)},detonateImmediately:function(){i=0}}}},{key:"createStarHandler",value:function(){var e=this;this.starComponent.node.active=!0;var t=function(){e.starComponent.node.active=!1};return{type:y.star,clear:function(){e.starComponent.node.active=!1,o.playSound(vn.COLLECT_STARS);var t=e.node.worldPosition,n=t.x,i=t.y;e.node.scene.emit(ta.ADD_STARS,{startAnimationAt:[n,i]})},cleanup:t,switch:function(n){t(),e.special=e.createSpecialHandler(n)}}}}],[{key:"preloadTileAnimations",value:(r=W((function*(){yield Promise.all([n.loadAnimClipAsync(f.TILE_CLEAR_ANIM),n.loadAnimClipAsync(f.TILE_SHAKE_ANIM),n.loadAnimClipAsync(f.TILE_BREAK_ANIM)])})),function(){return r.apply(this,arguments)})}]),k}(ce)).prototype,"icon",[fu,vu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ju=M(Wu.prototype,"bombComponent",[gu,mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yu=M(Wu.prototype,"starComponent",[bu,wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xu=M(Wu.prototype,"background",[Su,ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zu=M(Wu.prototype,"bgUITransform",[Cu,Eu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ju=M(Wu.prototype,"defaultBackground",[Au,Tu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qu=M(Wu.prototype,"uiOpacity",[Pu,Ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$u=M(Wu.prototype,"shineOpacity",[Ou,Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ec=M(Wu.prototype,"glowOpacity",[Lu,_u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tc=M(Wu.prototype,"iconOpacity",[Du,Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nc=M(Wu.prototype,"button",[Nu,zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ic=M(Wu.prototype,"animationComponent",[Bu,Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ac=M(Wu.prototype,"container",[xu,Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(Wu.prototype,"setOpacity",[Gu],Object.getOwnPropertyDescriptor(Wu.prototype,"setOpacity"),Wu.prototype),M(Wu.prototype,"runAnimationAfterDelay",[Hu],Object.getOwnPropertyDescriptor(Wu.prototype,"runAnimationAfterDelay"),Wu.prototype),M(Wu.prototype,"runAnimation",[Vu],Object.getOwnPropertyDescriptor(Wu.prototype,"runAnimation"),Wu.prototype),qu=Wu))||qu)||qu)||qu);function cc(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=n.x,o=n.y,r=Z(t,2),l=r[0],s=r[1],u=l*(a-(e.width-1)/2)+i*(a-e.width/2),c=s*(o-(e.height-1)/2)+i*(o-e.height/2);return-1===a&&(u+=t[0]/4),a===e.width&&(u-=t[0]/4),-1===o&&(c+=t[1]/4),o===e.height&&(c-=t[1]/4),{x:u,y:c}}function hc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],n=Z(e,2),i=n[0],a=n[1],o=Z(t,2),r=o[0],l=o[1],s=1-r,u=1-l,c=i*s,h=a*u;return[c,h]}function pc(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.split("-"),i=[],a=0;a<n.length;){var o=null,r=n[a];switch(r){case"normal":a+=1;break;case"fall":o=nu,a+=2;break;case"fly":o=iu,a+=2;break;case"push":"left"===n[a+1]?(o=au,a+=2):(o=ou,a+=2);break;case"put":"columns"===n[a+1]?(o=ru,a+=3):(o=lu,a+=3)}o&&(t&&(o=dc(o)),i.push(o))}return i}function dc(e){switch(e){case nu:return ou;case iu:return au;case au:return nu;case ou:return iu;case ru:return lu;case lu:return ru}}function yc(e){return(e instanceof oc?e.asArray():e).filter((function(e){return!e.isHidden()}))}function fc(e){return(e instanceof oc?e.asArray():e).filter((function(e){return e.isHidden()}))}Q._RF.pop(),Q._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),Q._RF.pop(),Q._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),Q._RF.pop(),Q._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),Q._RF.pop(),Q._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),Q._RF.pop(),Q._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),Q._RF.pop(),Q._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),Q._RF.pop(),Q._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),Q._RF.pop(),Q._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),Q._RF.pop(),Q._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);var vc=GameCore.Utils.Object;function gc(e,t){var n=t.getCoord(),i=n.x,a=n.y;return vc.vals(tu).reduce((function(t,n){var o=n.x,r=n.y,l=i+o,s=a+r;return e.isInBounds(l,s)&&t.push(e.get(l,s)),t}),[])}function mc(e){return Array.isArray(e)}function bc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=mc(e)?e:e.asArray();return n[xe(t,0,n.length)]}Q._RF.pop(),Q._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),Q._RF.pop(),Q._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);var wc=GameCore.Utils.Array;function Sc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e instanceof oc?e.asArray():e,i=bc(n,t),a=wc.search(n,(function(e){return e.isSimilarTo(i)&&!e.inSamePositionAs(i)}));if(void 0===a)throw new Error("Could not find a matching tile");return[i,a]}Q._RF.pop(),Q._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var kc=function(e){return e};function Cc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:kc;return function*(){var i=e,a=t;i<=0&&(i=Number.POSITIVE_INFINITY);for(var o=0;o<i;o++)yield n(a),a=1e9*Ue(a)}()}function Ec(e){return Array.isArray(e)}function Ac(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=Ec(e)?e:e.asArray();if(i.length<t)return new Set(i);for(var a=new Set,o=Cc(-1,n),r=o.next();a.size<t;){if(r.done)throw new Error("RNG exhausted");a.add(bc(i,r.value)),r=o.next()}return a}Q._RF.pop(),Q._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),Q._RF.pop(),Q._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),Q._RF.pop(),Q._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var Tc=[1,4];function Pc(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),a=t.specials,o=a.bomb,r=xe.apply(void 0,[i].concat(Tc)),l=Ac(e,o,i),s=e.asArray().filter((function(e){return!l.has(e)})),u=Ac(s,r,i),c=H(l);try{for(c.s();!(n=c.n()).done;){var h=n.value,p=2*t.time/3;h.setSpecialType(y.bomb,p)}}catch(e){c.e(e)}finally{c.f()}var d,f=H(u);try{for(f.s();!(d=f.n()).done;){var v=d.value;v.setSpecialType(y.star)}}catch(e){f.e(e)}finally{f.f()}}Q._RF.pop(),Q._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),Q._RF.pop(),Q._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);var Rc=GameCore.Utils.Array;function Oc(e){var t=e.levelData,n=t.columns,i=t.rows,a=e.identities,o=e.createTile,r=e.seed,l=function(e,t,n){var i,a=[],o=H(Cc(t/2,e,(function(e){return xe(e,0,n.length)})));try{for(o.s();!(i=o.n()).done;){var r=i.value;a.push(n[r]),a.push(n[r])}}catch(e){o.e(e)}finally{o.f()}return Rc.shuffle(a),a}(void 0===r?Date.now():r,n*i,a),s=Ic(e.levelData,a,l),u=Ic(e.levelData,a,s.reverse()).reverse().map((function(e){var t=o(e);return t.setIdentity(e),t}));return new oc({width:n,height:i,content:u})}function Ic(e,t,n){var i=e.rows,a=e.columns,o=e.rules;if(!o.maxSpaceOfPair)return n;for(var r=function(e,t,n){for(var i=[],a=0;a<t;a++){i[a]=[];for(var o=0;o<n;o++)i[a][o]=e[a*n+o]}return i}(n,i,a),l=0;l<t.length;l++)for(var s=null,u=null,c=0;c<i;c++)for(var h=0;h<a;h++){if(r[c][h]===t[l]){if(!s||!u){s=c,u=h;continue}var p=o.maxSpaceOfPair+1;if(Math.abs(c-s)+Math.abs(h-u)<=p){u=h,s=c;continue}var d=Lc(s,u,c,h),y=r[d.row][d.column];r[d.row][d.column]=r[c][h],r[c][h]=y}}return function(e){for(var t=[],n=0;n<e.length;n++)for(var i=0;i<e[n].length;i++)t.push(e[n][i]);return t}(r)}function Lc(e,t,n,i){var a=e,o=t;return n>e&&(a=e+1),n<e&&(a=e-1),i>t&&(o=t+1),i<t&&(o=t-1),{row:a,column:o}}Q._RF.pop(),Q._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);var _c=GameCore.Utils.Array;function Dc(e){var t=e.customFen,n=e.identities,i=e.createTile,a=t.idSize,o=t.cols,r=t.rows,l=t.code;if(n.length<t.idSize)throw new Error("Invalid grid code. There are not enough identities/frames ".concat(n.length," to fill it according to fen code ").concat(a));var s=l.split(":");if(s.length!==r)throw new Error("Invalid grid code");var u=/[a-zA-Z]+\d+|./g,c=/[a-zA-Z]+/,h=/\d+/,p=s.reduceRight((function(e,a){var o,r=[],l=a.matchAll(u),s=H(l);try{for(s.s();!(o=s.n()).done;){var p,d,y=o.value[0],f=null===(p=h.exec(y))||void 0===p?void 0:p[0],v=void 0!==f?Number.parseInt(f,10):void 0,g=void 0!==v&&!Number.isNaN(v)&&v<n.length?n[v]:void 0,m=i(void 0!==g?g:n[0]),b=null===(d=c.exec(y))||void 0===d?void 0:d[0],w=void 0!==b?Mc(b,t.encoding):void 0;w&&g?m.setSpecialType(w):m.setEmpty(),r.push(m)}}catch(e){s.e(e)}finally{s.f()}return e.concat(r)}),[]);return new oc({width:o,height:r,content:p})}function Mc(e,t){var n=_c.search(Object.entries(t),(function(t){var n=Z(t,2);n[0];return n[1]===e}));if(void 0===n)throw new Error("Invalid special type ".concat(e));return n[0]}Q._RF.pop(),Q._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),Q._RF.pop(),Q._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);var Nc=GameCore.Utils.Array;function zc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e.asArray(),i=bc(e,t),a=gc(e,i);if(!a.some((function(e){return e.isSimilarTo(i)}))){var o=bc(a,t),r=Nc.search(n,(function(e){return!e.inSamePositionAs(i)&&!e.inSamePositionAs(o)&&e.isSimilarTo(o)}));r.setIdentity(i.id),o.setIdentity(i.id)}}Q._RF.pop(),Q._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),Q._RF.pop(),Q._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var Bc=[{startTile:{x:0,y:1},endTile:{x:3,y:1},localeTextKey:"guide.step1"},{startTile:{x:2,y:2},endTile:{x:3,y:0},localeTextKey:"guide.step2"},{startTile:{x:0,y:0},endTile:{x:3,y:3},localeTextKey:"guide.step3"},{startTile:{x:0,y:4},endTile:{x:2,y:3},localeTextKey:"guide.step4"},{startTile:{x:1,y:4},endTile:{x:1,y:2},localeTextKey:"guide.step5"}];Q._RF.pop(),Q._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var Fc=GameCore.Utils.Array;function xc(e,t){return e[0]===t[0]&&e[1]===t[1]}function Uc(e){return new Oe(e[0],e[1])}function Gc(e,t){return e.x>=-1&&e.x<t.width+1&&e.y>=-1&&e.y<t.height+1}function Hc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qc;return t.map((function(t){return[e.tile[0]+t.x,e.tile[1]+t.y]}))}var Vc,qc=[tu.Up,tu.Down,tu.Left,tu.Right],Wc=function(){function e(t,n){var i;if(z(this,e),this.f=0,this.g=0,this.h=0,n&&xc(t,n.tile))throw new Error("Tile cannot be its own parent");this.tile=t,this.parent=n;var a=e.calcDirection(this),o=n&&a&&n.cache.direction&&!a.equals(n.cache.direction)?1:0;this.cache={direction:a,turns:o+(null!==(i=null==n?void 0:n.cache.turns)&&void 0!==i?i:0)}}return N(e,[{key:"getKey",value:function(){var e;return"x:".concat(this.tile[0],",y:").concat(this.tile[1],",d:").concat(null===(e=this.cache.direction)||void 0===e?void 0:e.toString())}},{key:"equals",value:function(e){return this.getKey()===e.getKey()}}],[{key:"calcDirection",value:function(e){if(e.parent){var t=e.parent.tile,n=e.tile;return new Oe(n[0]-t[0],n[1]-t[1])}return null}}]),e}();function Kc(e,t,n){var i=Xc(e,t),a=Xc(e,n);if(0===i.length||0===a.length)return jc(t,n);var o=function(e,t,n){var i=[],a=[],o=new Wc(t,null),r=new Wc(n,null),l=[r.tile];i.push(o);for(;i.length>0;){var s=i.shift();if(a.push(s),xc(s.tile,r.tile)){for(var u=[],c=s,h=s,p=s.parent;p;)p.cache.turns!==h.cache.turns&&(u.unshift({a:Uc(p.tile),b:Uc(c.tile)}),c=p),h=p,p=p.parent;return u.unshift({a:Uc(h.tile),b:Uc(c.tile)}),u}var d,y=Hc(s,Xc(e,s.tile,l)),f=H(y);try{var v=function(){var e=d.value,t=new Wc(e,s);if(t.cache.turns>8)return 0;var n=xc(t.tile,r.tile),o=a.some((function(e){return e.equals(t)}));if(i.some((function(e){return e.equals(t)}))||o&&!n)return 0;t.g=s.g+1+t.cache.turns,t.h=Yc(t,r),t.f=t.g+t.h,i.push(t)};for(f.s();!(d=f.n()).done;)v()}catch(e){f.e(e)}finally{f.f()}i.sort((function(e,t){return e.f-t.f}))}return null}(e,t,n);return o||jc(t,n)}function jc(e,t){var n=Uc(e),i=Uc(t);return n.x===i.x||n.y===i.y?[{a:n,b:i}]:[{a:n,b:{x:n.x,y:i.y}},{a:{x:n.x,y:i.y},b:i}]}function Yc(e,t){var n=e.tile,i=t.tile;return Math.abs(n[0]-i[0])+Math.abs(n[1]-i[1])}function Xc(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=[],o=H(qc);try{var r=function(){var o=n.value,r={x:t[0]+o.x,y:t[1]+o.y};if(e.isInBounds(r.x,r.y))return(e.get(r.x,r.y).isHidden()||Fc.search(i,(function(e){return xc(e,[r.x,r.y])})))&&a.push(o),1;Gc(r,e)&&a.push(o)};for(o.s();!(n=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}return a}Q._RF.pop(),Q._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),Q._RF.pop(),Q._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var Zc=(Y(Vc={},y.bomb,"b"),Y(Vc,y.star,"s"),Y(Vc,y.none,"t"),Vc);function Jc(e){return e.reduce((function(e,t,n,i){return t.inSamePositionAs(n,i)||e.push([t,[n,i]]),e}),[])}function*Qc(e,t){for(var n=0,i=e-1,a=0,o=t-1;n<=i&&a<=o;){for(var r=n;r<=i;r++)yield{x:r,y:a};for(var l=++a;l<=o;l++)yield{x:i,y:l};for(var s=--i;s>=n;s--)yield{x:s,y:o};for(var u=--o;u>=a;u--)yield{x:n,y:u};n++}}Q._RF.pop(),Q._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),Q._RF.pop(),Q._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),Q._RF.pop(),Q._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var $c,eh,th,nh,ih,ah,oh,rh,lh,sh,uh,ch,hh=GameCore.Utils.Array,ph=function(){function e(t,n){z(this,e),this.coord=new Oe(t,n)}return N(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function dh(e){return new Oe(e[0],e[1])}function yh(e,t,n){if(void 0===t||void 0===n)return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Qc,i=[],a=H(n(e.width,e.height));try{for(a.s();!(t=a.n()).done;){var o=t.value,r=e.get(o.x,o.y);r.isHidden()||i.push([r,[o.x,o.y]])}}catch(e){a.e(e)}finally{a.f()}var l,s=[],u=function(){var t=i.shift(),n=Z(t,2),a=n[0],o=n[1];if(hh.search(s,(function(e){return gh(e,o)})))return 0;s.push(o);for(var r,l=function(){var t=Z(c[u],2),n=t[0],i=t[1];if(!n.isSimilarTo(a)||hh.search(s,(function(e){return gh(e,i)})))return 0;var r=yh(e,o,i);return null!==r?{v:{v:r}}:void 0},u=0,c=i;u<c.length;u++)if(0!==(r=l())&&r)return r.v};for(;i.length>0;)if(0!==(l=u())&&l)return l.v;return null}(e);var i,a=[t[0]+1,t[1]+1],o=[n[0]+1,n[1]+1],r=function(e){var t=hh.fillWith(e.width+2,(function(e){return new ph(e-1,-1)})),n=hh.fillWith(e.width+2,(function(t){return new ph(t-1,e.height)})),i=hh.fillWith(e.height,(function(e){return new ph(-1,e)})),a=hh.fillWith(e.height,(function(t){return new ph(e.width,t)})),o=function(o,r){var l=o-1,s=r-1;return-1===l?i[s]:l===e.width?a[s]:-1===s?t[l]:s===e.height?n[l]:e.get(l,s)};return{get:function(e,t){return o(e,t)},width:e.width+2,height:e.height+2}}(e),l=[a,o];if(a[0]===o[0]&&bh(r,l,a[1],o[1],a[0])||a[1]===o[1]&&wh(r,l,a[0],o[0],a[1]))return Ch([{a:dh(a),b:dh(o)}],{x:-1,y:-1});var s=a[1]<=o[1]?a:o,u=a[1]<=o[1]?o:a,c=a[0]<=o[0]?a:o,h=a[0]<=o[0]?o:a,p=[],d=[],y=Sh(r,l,1,dh(s),dh(u)),f=Sh(r,l,-1,dh(s),dh(u));-1===y&&-1===f||(i=-1!==y?y:f,p=[{a:dh(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:o[0],y:i}},{a:{x:o[0],y:i},b:dh(o)}]);var v=kh(r,l,1,dh(c),dh(h)),g=kh(r,l,-1,dh(c),dh(h));-1===v&&-1===g||(i=-1!==v?v:g,p=[{a:dh(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:o[1]}},{a:{x:i,y:o[1]},b:dh(o)}]);var m=function(e,t,n,i){for(var a=n.y+1;a<i.y;a++)if(bh(e,t,n.y,a,n.x)&&wh(e,t,n.x,i.x,a)&&bh(e,t,a,i.y,i.x))return a;return-1}(r,l,dh(s),dh(u));-1!==m&&(i=m,d=[{a:dh(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:o[0],y:i}},{a:{x:o[0],y:i},b:dh(o)}]);var b=function(e,t,n,i){for(var a=n.x+1;a<i.x;a++)if(wh(e,t,n.x,a,n.y)&&bh(e,t,n.y,i.y,a)&&wh(e,t,a,i.x,i.y))return a;return-1}(r,l,dh(c),dh(h));return-1!==b&&(i=b,d=[{a:dh(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:o[1]}},{a:{x:i,y:o[1]},b:dh(o)}]),p.length>0&&d.length>0?Ch(fh(p)<=fh(d)?p:d,{x:-1,y:-1}):p.length>0?Ch(p,{x:-1,y:-1}):d.length>0?Ch(d,{x:-1,y:-1}):null}function fh(e){var t,n=0,i=H(e);try{for(i.s();!(t=i.n()).done;){n+=vh(t.value)}}catch(e){i.e(e)}finally{i.f()}return n}function vh(e){return e.a.x===e.b.x?Math.abs(e.a.y-e.b.y):e.a.y===e.b.y?Math.abs(e.a.x-e.b.x):0}function gh(e,t){return e[0]===t[0]&&e[1]===t[1]}function mh(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=e.get.apply(e,j(t));return i.isHidden()||n.some((function(e){return gh(e,t)}))}function bh(e,t,n,i,a){for(var o=Math.min(n,i),r=Math.max(n,i),l=o;l<=r;l++)if(!mh(e,[a,l],t))return!1;return!0}function wh(e,t,n,i,a){for(var o=Math.min(n,i),r=Math.max(n,i),l=o;l<=r;l++)if(!mh(e,[l,a],t))return!1;return!0}function Sh(e,t,n,i,a){var o=1===n?a.y:i.y,r=1===n?i.x:a.x;if(bh(e,t,i.y,a.y,r))for(;o>=0&&o<e.height&&mh(e,[i.x,o],t)&&mh(e,[a.x,o],t);){if(wh(e,t,i.x,a.x,o))return o;o+=n}return-1}function kh(e,t,n,i,a){var o=1===n?a.x:i.x,r=1===n?i.y:a.y;if(wh(e,t,i.x,a.x,r))for(;o>=0&&o<e.width&&mh(e,[o,i.y],t)&&mh(e,[o,a.y],t);){if(bh(e,t,i.y,a.y,o))return o;o+=n}return-1}function Ch(e,t){return e.map((function(e){return{a:{x:e.a.x+t.x,y:e.a.y+t.y},b:{x:e.b.x+t.x,y:e.b.y+t.y}}}))}Q._RF.pop(),Q._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var Eh=$.ccclass,Ah=$.property,Th=$.requireComponent,Ph=globalThis.game.monitorError,Rh=GameCore.Utils,Oh=Rh.Array,Ih=Rh.Function,Lh=Rh.Valid,_h=s.Layout,Dh=($c=Eh("Board"),eh=Th(ee),th=t.required,nh=Ah(uc),ih=t.required,ah=Ah(ge),oh=Ah({displayName:"Tile Spacing",group:"Create config"}),$c(rh=eh((sh=M((lh=function(n){F(u,n);var i,a,r,s=x(u);function u(){var e;z(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),B(e,"tilePrefab",sh,U(e)),B(e,"tilesHolder",uh,U(e)),B(e,"tileTrim",ch,U(e)),e.tileSize=[0,0],e.selectedTile=null,e.parsedGravityRules=[],e.normalMatches=0,e.normalMatchesSinceLastSpawn=0,e.spawnAttempts=0,e.hintPath=null,e.hintTiles=null,e.isAnimating=!1,e.animationQueue=[],e.isConsumingAnimation=!1,e.handleViewResized=Ih.debounce((function(){e.updateTilesHolderScale()}),100),e}return N(u,[{key:"onLoad",value:function(){this.widget=this.getComponent(ie),this.uiTransform=this.getComponent(ee),t.validateRequiredProperties(this,u),this.tilePrefab.node.active=!1,this.listenEvents()}},{key:"onDestroy",value:function(){this.unlistenEvents()}},{key:"hasActiveGrid",value:function(){return void 0!==this.grid}},{key:"create",value:(r=W((function*(t,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();this.levelData=n,this.handleOrientationChanged(Co.getCurrentLayout()),yield e.waitTweenAsync(0);var o=j(t);Oh.shuffle(o);var r=o.slice(0,n.colors);null==Ph||Ph.addMetadata({frames:r.map((function(e){return e.name}))}),this.parsedGravityRules=pc(n.mode,Co.isLandscape());var l=function(e){var t=He(i.tilePrefab.node),n=t.getComponent(uc);return n.setIdentity(e),i.tilesHolder.addChild(t),t.active=!0,n},s=!1;if(void 0!==n.customFen)try{s=!0,this.grid=Dc({customFen:n.customFen,identities:r,createTile:l}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)}))}catch(e){console.error("Error creating grid from custom fen",e,"falling back to random grid"),s=!1}s||(this.grid=Oc({levelData:n,seed:a,identities:r,createTile:l}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)})),zc(this.grid,a),Pc(this.grid,n,a)),this.handleBoardLayout();var u=[this.tileTrim.x,this.tileTrim.y];this.tileSize=hc(this.tilePrefab.getSize(),u),this.updateTilesHolderScale(),this.node.scene.emit(ta.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()})),function(e,t){return r.apply(this,arguments)})},{key:"updateTilesHolderScale",value:function(){if(this.grid){var e=[this.grid.width,this.grid.height],t=[this.uiTransform.width,this.uiTransform.height],n=function(e,t,n){var i=Z(e,2),a=i[0],o=i[1],r=Z(t,2),l=r[0],s=r[1],u=Z(n,2),c=u[0]/(a*l),h=u[1]/(o*s);return Math.min(c,h)}(e,this.tilePrefab.getSize(),t);this.tilesHolder.setScale(n,n),this.node.scene.emit(ta.GRID_RESIZE,n)}}},{key:"handleBoardLayout",value:function(){var e,t;this.grid&&Co.isLandscape()&&0!==this.levelData.level&&(this.grid=(e=this.grid,(t=e.toRotated()).forEach((function(e,t,n){e.setCoord(t,n)})),t))}},{key:"destroyTiles",value:function(){var e;null===(e=this.grid)||void 0===e||e.forEach((function(e){return e.node.destroy()}))}},{key:"animateTilesAppear",value:function(){var t=this;if(void 0===this.grid){var n=new Error("animateTilesAppear: Grid is not initialized");if(Lh.isDebugger())throw n;return null==Ph||Ph.sendException(n),Promise.resolve()}var i=this.grid;return new Promise((function(n){var a=function(){var a=W((function*(){var a=function(e){return cc(i,t.tileSize,e)};yield Promise.all(i.map((function(n,o,r){var l=Ge(0,.5),s=n.node.scale.clone(),u=function(e,n){var i,a=Oe.ZERO.clone(),o=H(t.parsedGravityRules);try{for(o.s();!(i=o.n()).done;){var r=i.value,l=t.getPrimitiveDirection(e,n,r);a.subtract2f(l.x,l.y)}}catch(e){o.e(e)}finally{o.f()}return a.normalize()}(o,r),c=cc(i,t.tileSize,{x:o,y:r}),h=u.multiplyScalar(100).add2f(c.x,c.y);return n.node.setPosition(h.x,h.y),n.node.setScale(0,0),Promise.all([e.runTweenAsync(ae(n.node).delay(l).to(.5,{scale:s},{easing:"elasticOut"})),n.sync({getTargetPosition:a,easing:"backOut",duration:.5,delay:l})])}))),n()}));return function(){return a.apply(this,arguments)}}();t.animationQueue.push(a),t.consumeAnimationQueue()}))}},{key:"animateTilesWave",value:function(){var t=this;if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","animateTilesWave"),Promise.resolve();var n=this.grid;return new Promise((function(i){var a=function(){var t=W((function*(){var t=function(e,t){for(var n=t.x,i=t.y,a="center"===e?{x:(n-1)/2,y:(i-1)/2}:e,o=a.x,r=a.y,l=[],s=0;s<n;s++){for(var u=[],c=0;c<i;c++){var h=o-s,p=r-c,d=Math.sqrt(h*h+p*p);u.push(d)}l.push(u)}return l}("center",{x:n.width,y:n.height});yield Promise.all(n.map((function(n,i,a){var o,r,l=.1*(null!==(o=null===(r=t[i])||void 0===r?void 0:r[a])&&void 0!==o?o:0),s=n.node.scale.clone();return Promise.all([e.runTweenAsync(ae(n.node).delay(l).to(.25,{scale:s.clone().multiplyScalar(1.2)},{easing:"quadOut"}).to(.25,{scale:s},{easing:"quadIn"}))])}))),i()}));return function(){return t.apply(this,arguments)}}();t.animationQueue.push(a),t.consumeAnimationQueue()}))}},{key:"animateTilesError",value:(a=W((function*(){if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","animateTilesError"),Promise.resolve();this.isAnimating||(this.isAnimating=!0,yield Promise.all(this.grid.map((function(e){return e.moveAround()}))),this.isAnimating=!1)})),function(){return a.apply(this,arguments)})},{key:"handleTileClick",value:function(e){if(!e.isHidden()){if(this.selectedTile===e)return o.playSound(vn.TILE_SELECT),this.selectedTile=null,void e.setFocused(!1);if(!this.selectedTile)return o.playSound(vn.TILE_SELECT),this.selectedTile=e,void e.setFocused(!0);if(!this.selectedTile.isSimilarTo(e))return o.playSound(vn.TILE_SELECT),this.selectedTile.setFocused(!1),this.selectedTile=e,void e.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,e),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(e,t){if(void 0!==this.grid){var n=[e.getCoord().x,e.getCoord().y],i=[t.getCoord().x,t.getCoord().y],a=yh(this.grid,n,i);if(null===a){o.playSound(vn.INVALID_MATCH),this.animateTilesError();var r=0===this.levelData.level,l=function(e,t,n,i){if(i){var a=Bc[4].startTile,o=Bc[4].endTile;if(t[0]===a.x&&t[1]===a.y&&n[0]===o.x&&n[1]===o.y)return[{a:a,b:o}];if(t[0]===o.x&&t[1]===o.y&&n[0]===a.x&&n[1]===a.y)return[{a:a,b:o}]}return Kc(e,t,n)}(this.grid,n,i,r);return this.node.scene.emit(ta.GRID_MATCH,[e,t]),void this.node.scene.emit(ta.GRID_MATCH_FAIL,l)}o.playSound(vn.TILE_MATCH),this.node.scene.emit(ta.GRID_MATCH,[e,t]),this.node.scene.emit(ta.GRID_MATCH_SUCCESS,a,[e,t]),this.clear([[e,t]])}else this.reportOrThrowInDebugger("Grid is not initialized","match")}},{key:"clear",value:function(e,t){this.normalMatches+=e.length;for(var n=0;n<e.length;n++){var i=e[n],a=Z(i,2),o=a[0],r=a[1],l=t?2*n*t:0,s=t?(2*n+1)*t:0;o.setEmpty(),r.setEmpty(),o.playClearFX(l),r.playClearFX(s),this.node.scene.emit(ta.GRID_CLEAR,[o,r])}this.processGameplayCycle()}},{key:"clearUsingOldLightningFX",value:function(e){this.normalMatches+=e.length;var t,n=H(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=Z(i,2),o=a[0],r=a[1];o.setEmpty(),r.setEmpty(),o.playOldLightningClearFX(),r.playOldLightningClearFX(),this.node.scene.emit(ta.GRID_CLEAR,[o,r])}}catch(e){n.e(e)}finally{n.f()}this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var e=this.hintPath[0],t=this.hintPath[this.hintPath.length-1];if(e&&t){var n=e.a,i=t.b,a=this.getTileAt(n.x,n.y),o=this.getTileAt(i.x,i.y);a&&o?(a.setHint(!0),o.setHint(!0),this.hintTiles=[a,o]):this.reportOrThrowInDebugger("Hint tiles are not valid","showHint")}else this.reportOrThrowInDebugger("Hint path is not valid","showHint")}}},{key:"hideHint",value:function(){if(this.hintTiles){var e=Z(this.hintTiles,2),t=e[0],n=e[1];t.setHint(!1),n.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(e,t){return void 0===this.grid?null:this.grid.isInBounds(e,t)?this.grid.get(e,t):null}},{key:"getAnyTileWorldPosition",value:function(e,t){if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getAnyTileWorldPosition"),{x:0,y:0};var n=cc(this.grid,this.tileSize,{x:e,y:t});this.tilePrefab.node.setPosition(n.x,n.y);var i=this.tilePrefab.node.getWorldPosition();return{x:i.x,y:i.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getGridSize",value:function(){return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getGridSize"),[0,0]):[this.grid.width,this.grid.height]}},{key:"getUncleared",value:function(){return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getUncleared"),[]):yc(this.grid)}},{key:"getCleared",value:function(){return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getCleared"),[]):fc(this.grid)}},{key:"getBombTiles",value:function(){return void 0===this.grid?(this.reportOrThrowInDebugger("Grid is not initialized","getBombTiles"),[]):yc((e=this.grid)instanceof oc?e.asArray():e).filter((function(e){var t;return(null===(t=e.special)||void 0===t?void 0:t.type)===y.bomb}));var e}},{key:"getPairs",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getPairs"),[];for(var n=[],i=t?yc(this.grid):fc(this.grid),a=function(){var e=Sc(i),t=Z(e,2),a=t[0],o=t[1];n.push([a,o]),i=i.filter((function(e){return e!==a&&e!==o}))};n.length<e;)a();return n}},{key:"getBoundingBoxWorld",value:function(){var e=this.tilesHolder.getWorldScale().x,t=this.getGridSize(),n=this.tileSize[0]*e*t[0],i=this.tileSize[1]*e*t[1],a=this.node.getWorldPosition().subtract3f(n/2,i/2,0);return new Te.Rect(a.x,a.y,n,i)}},{key:"setIgnoreInput",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];null===(e=this.grid)||void 0===e||e.forEach((function(e){return e.setIgnoreInput(t)}))}},{key:"processShuffleRequest",value:function(e){if(void 0!==this.grid){var t=this.processShuffleStep(this.grid,!0,e);this.grid=t[0],this.hintPath=t[1],this.consumeAnimationQueue()}else this.reportOrThrowInDebugger("Grid is not initialized","processShuffleRequest")}},{key:"generateFenFromCurrentLevel",value:function(e){return u.generateFen(null!=e?e:this.levelData)}},{key:"listenEvents",value:function(){be.on(l.VIEW_RESIZED,this.handleViewResized),be.on(l.WIDGET_RESIZED,this.handleViewResized),be.on(l.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"unlistenEvents",value:function(){be.off(l.VIEW_RESIZED,this.handleViewResized),be.off(l.WIDGET_RESIZED,this.handleViewResized),be.off(l.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"handleOrientationChanged",value:function(e){var t;e===_h.Portrait||0===(null===(t=this.levelData)||void 0===t?void 0:t.level)?(this.widget.left=20,this.widget.right=20):e===_h.Landscape&&(this.widget.left=700,this.widget.right=120)}},{key:"processGameplayCycle",value:function(){if(void 0!==this.grid){var e=yc(this.grid);if(0!==e.length){var t=this.grid,n=e.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,i=this.normalMatchesSinceLastSpawn>=2;n&&(i?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),e.length>14&&(t=this.processGravitationStep(t));var a=this.processShuffleStep(t);this.consumeAnimationQueue(),this.grid=a[0],this.hintPath=a[1]}}else this.reportOrThrowInDebugger("Grid is not initialized","processGameplayCycle")}},{key:"processSpawnStep",value:function(){var e;if(void 0!==this.grid){var t=Ac(fc(this.grid),2),n=Z(t,2),i=n[0],a=n[1],o=null!==(e=null==i?void 0:i.id)&&void 0!==e?e:void 0;void 0!==i&&void 0!==o&&void 0!==a?(i.restore(),a.restore(o),this.node.scene.emit(ta.GRID_SPAWN,[i,a])):this.reportOrThrowInDebugger("Failed to get random tiles","processSpawnStep")}else this.reportOrThrowInDebugger("Grid is not initialized","processSpawnStep")}},{key:"processGravitationStep",value:function(e){var t,n=this,i=e,a=[],o=H(this.parsedGravityRules);try{var r=function(){var e=t.value,o=Jc(i=n.toGravitated(i,e));if(0===o.length)return 1;var r,l=H(o);try{for(l.s();!(r=l.n()).done;){var s=Z(r.value,2),u=s[0],c=Z(s[1],2),h=c[0],p=c[1];u.setCoord(h,p)}}catch(e){l.e(e)}finally{l.f()}i.forEach((function(e){e.node.setSiblingIndex(0)}));var d=function(){var e=W((function*(){yield Promise.all(o.map((function(e){var t=Z(e,2),a=t[0],o=Z(t[1],2),r=o[0],l=o[1];return a.sync({delay:.25,duration:.25,getTargetPosition:function(){return cc(i,n.tileSize,{x:r,y:l})}})})))}));return function(){return e.apply(this,arguments)}}();a.push(d)};for(o.s();!(t=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}var l=function(){var e=W((function*(){for(var e=0,t=a;e<t.length;e++){var n=t[e];yield n()}}));return function(){return e.apply(this,arguments)}}();return this.animationQueue.push(l),i}},{key:"toGravitated",value:function(e,t){var n=new oc(e),i=e.height-1,a=e.width-1,o=[0,i],r=[0,a],l=Math.floor(e.height/2),s=Math.floor(e.width/2),u=function(e){return e.isHidden()};switch(t){case nu:n.gravitate({rowRange:o,colRange:r,direction:tu.Down,isLighter:u});break;case iu:n.gravitate({rowRange:o,colRange:r,direction:tu.Up,isLighter:u});break;case au:n.gravitate({rowRange:o,colRange:r,direction:tu.Left,isLighter:u});break;case ou:n.gravitate({rowRange:o,colRange:r,direction:tu.Right,isLighter:u});break;case ru:n.gravitate({rowRange:o,colRange:[s,a],direction:tu.Left,isLighter:u,out:n.gravitate({rowRange:o,colRange:[0,s-1],direction:tu.Right,isLighter:u})});break;case lu:n.gravitate({rowRange:[l,i],colRange:r,direction:tu.Down,isLighter:u,out:n.gravitate({rowRange:[0,l-1],colRange:r,direction:tu.Up,isLighter:u})})}return n}},{key:"getPrimitiveDirection",value:function(e,t,n){if(void 0===this.grid)return this.reportOrThrowInDebugger("Grid is not initialized","getPrimitiveDirection"),tu.Down;var i=Math.floor(this.grid.height/2),a=Math.floor(this.grid.width/2);switch(n){case nu:return tu.Down;case iu:return tu.Up;case au:return tu.Left;case ou:return tu.Right;case ru:return e>=a?tu.Left:tu.Right;case lu:return t>=i?tu.Down:tu.Up}}},{key:"processShuffleStep",value:function(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0,o=yh(e),r=yc(e).map((function(e){var t=e.getCoord();return[t.x,t.y]}));if(null!==o&&!i)return[e,o];var l=100;do{var s=e.toShuffled(r),u=Z(s,1);o=yh(n=u[0]),l--}while(null===o&&l>0);if(l<=0){var c,h=n.asArray().map((function(e){var t,n;return{name:null===(t=e.id)||void 0===t?void 0:t.name,type:null===(n=e.special)||void 0===n?void 0:n.type,active:!e.isHidden()}}));return null==Ph||Ph.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",level:this.levelData.level,gridAsArray:h}),this.node.scene.emit(ta.GAME_EXIT),[e,null!==(c=o)&&void 0!==c?c:[]]}var p,d=Jc(n),y=H(d);try{for(y.s();!(p=y.n()).done;){var f=Z(p.value,2),v=f[0],g=Z(f[1],2),m=g[0],b=g[1];v.setCoord(m,b)}}catch(e){y.e(e)}finally{y.f()}var w=void 0!==a?function(){return a(e,n)}:this.createShuffleAnimationHandler(e,n);return this.animationQueue.push(w),[n,null!==(t=o)&&void 0!==t?t:[]]}},{key:"createShuffleAnimationHandler",value:function(e,t){var n=this,i=function(){var i=W((function*(){yield Promise.all(e.map((function(e,i,a){return e.sync({duration:.3,easing:"smooth",getTargetPosition:function(){return cc(t,n.tileSize,{x:i,y:a},10)}})})))}));return function(){return i.apply(this,arguments)}}(),a=function(){var e=W((function*(){t.forEach((function(e){e.node.setSiblingIndex(0)})),yield Promise.all(t.map((function(e){return e.sync({duration:.4,easing:"smooth",delay:Ge(0,.2),getTargetPosition:function(e){return cc(t,n.tileSize,e)}})})))}));return function(){return e.apply(this,arguments)}}();return function(){var e=W((function*(){yield i(),yield a()}));return function(){return e.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(i=W((function*(){if(!this.isConsumingAnimation){for(this.isConsumingAnimation=!0;this.animationQueue.length>0;){if(0===this.getUncleared().length){this.animationQueue=[];break}var e=this.animationQueue.shift();yield null==e?void 0:e()}this.isConsumingAnimation=!1}})),function(){return i.apply(this,arguments)})},{key:"clearAnimationQueue",value:function(){this.isConsumingAnimation=!1,this.animationQueue=[]}},{key:"reportOrThrowInDebugger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown error thrown",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Board",n=new Error("".concat(t,": ").concat(e));if(Lh.isDebugger())throw n;null==Ph||Ph.sendException(n)}}],[{key:"generateFen",value:function(e){for(var t=e,n=[],i=0;i<t.colors;i++)n.push(i+1);var a=Date.now(),o=Oc({levelData:t,seed:a,identities:n,createTile:function(e){var t=e,n=void 0,i=new Oe(0,0);return{get id(){return t},get special(){return n},get coord(){return i},setIdentity:function(e){t=e},isHidden:function(){return!1},setSpecialType:function(e){n={type:e}},setCoord:function(e,t){return i.set(e,t)},getCoord:function(){return i},isSimilarTo:function(e){return e.id===t},inSamePositionAs:function(e){return e.getCoord().equals(i)}}}});return o.forEach((function(e,t,n){e.setCoord(t,n)})),zc(o,a),Pc(o,t,a),function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zc,n=e.width,i=e.height,a=[],o=new Map,r=i-1;r>=0;r--){for(var l=[],s=0;s<n;s++){var u,c,h=e.get(s,r),p=h.isHidden()?null:h.id;if(null!==p){var d=t[null!==(u=null===(c=h.special)||void 0===c?void 0:c.type)&&void 0!==u?u:y.none];if(!o.has(p)){var f=o.size.toString();o.set(p,f)}var v="".concat(d).concat(o.get(p));l.push(v)}else l.push(".")}a.push(l.join(""))}return{code:a.join(":"),idSize:o.size,encoding:t,rows:i,cols:n}}(o)}}]),u}(ce)).prototype,"tilePrefab",[th,nh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uh=M(lh.prototype,"tilesHolder",[ih,ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=M(lh.prototype,"tileTrim",[oh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(.025,.1)}}),rh=lh))||rh)||rh);Q._RF.pop(),Q._RF.push({},"f7e1byg/txJGqnuJJ7xQV1M","withItemAnalytics",void 0);var Mh=GameCore.Plugins.Analytics.Events,Nh=globalThis.game.analytics,zh=function(e,t){return function(){return Nh.event(Mh.USE_ITEM,{item_name:e}),t.apply(void 0,arguments)}};Q._RF.pop(),Q._RF.push({},"bc704Yz8bdJzYja7TsWcGMN","useHintItem",void 0);var Bh=zh(d.PLIERS,(function(e,t){if(!t.isDrawingHint){var n=e.getHintPath();null!==n&&(o.playSound(vn.HINT_ITEM),t.drawHintPath(n,(function(t){return e.getAnyTileWorldPosition(t.x,t.y)})),e.showHint())}}));Q._RF.pop(),Q._RF.push({},"0a2423JE25HLIm5td77YE7e","usePliersItem",void 0);var Fh=zh(d.PLIERS,(function(e,t){var n,i=bc(e.getBombTiles()),a=i.node.worldPosition;t.createDefuseExplosionAt(a.x,a.y),o.playSound(vn.BOMB_DEFUSE),null===(n=i.special)||void 0===n||n.switch(y.none)}));Q._RF.pop(),Q._RF.push({},"d2cd0VZLwhNMJwc3ppHvOtA","withLoweredVolume",void 0);var xh=function(e){return W((function*(){o.setVolumeMusic(0,!0);var t=yield e.apply(void 0,arguments);return o.setVolumeMusic(.3,!0),t}))};Q._RF.pop(),Q._RF.push({},"a62ebriH15FfI8l0x1GBX1p","useThunderItem",void 0);var Uh,Gh=function(){var e=W((function*(e,t){if(!(e.getUncleared().length<4)){var n=e.getPairs(2);e.clearSelectedTile();var i=e.node.position.x;yield Hh(e,0),yield t.playThunderAnimation(n,e),yield Hh(e,i)}}));return function(t,n){return e.apply(this,arguments)}}(),Hh=function(){var t=W((function*(t,n){if(t.node.position.x!==n){var i=new Ie(n,t.node.position.y,t.node.position.z),a=ae(t.node).to(.2,{position:i},{easing:"sineOut"});yield e.runTweenAsync(a)}}));return function(e,n){return t.apply(this,arguments)}}(),Vh=zh(d.THUNDER,xh((Uh=Gh,W((function*(){n.setBlockInput(!0);var e=yield Uh.apply(void 0,arguments);return n.setBlockInput(!1),e})))));Q._RF.pop(),Q._RF.push({},"0e50bRTLUtMgYDDkS0nbFm5","useTornadoItem",void 0);var qh,Wh=GameCore.Utils.Function,Kh=function(){var e=W((function*(e,t){var n=yield Wh.allSettled(e.map((function(n,i,a){return n.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return cc(e,t,{x:i,y:a},10)}})})));n.some((function(e){return"rejected"===e.status}))&&console.error("Error playing padding animation",n.filter((function(e){return"rejected"===e.status})))}));return function(t,n){return e.apply(this,arguments)}}(),jh=function(){var e=W((function*(e,t){var n=e.asArray().length;e.forEach((function(t,i,a){t.node.setSiblingIndex(n-1-(i+a*e.width))}));var i=yield Wh.allSettled(e.map((function(n){return n.fly({getTilePosition:function(n){return cc(e,t,n)}})})));i.some((function(e){return"rejected"===e.status}))&&console.error("Error playing shuffle animation",i.filter((function(e){return"rejected"===e.status})))}));return function(t,n){return e.apply(this,arguments)}}(),Yh=function(){var e=W((function*(e,t,n,i){o.playSound(vn.SHUFFLE_ITEM),o.playSound(vn.WIND),yield Kh(e,n()),i(),yield jh(t,n())}));return function(t,n,i,a){return e.apply(this,arguments)}}(),Xh=function(){var e=W((function*(e,t){var n=function(){return e.getTileSize()},i=function(){return t.playTornadoAnimation()},a=xh((function(e,t){return Yh(e,t,n,i)}));return new Promise((function(t){e.processShuffleRequest(function(){var n=W((function*(n,i){var o=e.node.position.x;yield Zh(e,0),yield a(n,i),yield Zh(e,o),t()}));return function(e,t){return n.apply(this,arguments)}}())}))}));return function(t,n){return e.apply(this,arguments)}}(),Zh=function(){var t=W((function*(t,n){if(t.node.position.x!==n){var i=new Ie(n,t.node.position.y,t.node.position.z),a=ae(t.node).to(.2,{position:i},{easing:"sineOut"});yield e.runTweenAsync(a)}}));return function(e,n){return t.apply(this,arguments)}}(),Jh=zh(d.THUNDER,xh(Xh));Q._RF.pop(),Q._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var Qh=(0,$.ccclass)("Line")(qh=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(ee)}},{key:"setPoints",value:function(e,t){this.node.setWorldPosition((e.x+t.x)/2,(e.y+t.y)/2,0),this.uiTransform.width=Oe.distance(e,t)+10,this.uiTransform.width/=this.node.worldScale.x;var n=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI;this.node.eulerAngles=new Ie(0,0,n)}}]),n}(ce))||qh;Q._RF.pop(),Q._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var $h,ep,tp,np,ip,ap,op,rp,lp,sp,up,cp=function(e){F(n,e);var t=x(n);function n(e,i,a,o,r){var l;return z(this,n),(l=t.call(this,e,i,r)).ator=a,l.ftor=o,l}return N(n,[{key:"alloc",value:function(){var e=V(q(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(e),e}},{key:"free",value:function(e){this.ftor&&this.ftor(e),V(q(n.prototype),"free",this).call(this,e)}}]),n}(Ve);Q._RF.pop(),Q._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var hp,pp,dp,yp,fp,vp,gp,mp,bp,wp=$.ccclass,Sp=$.property,kp=($h=wp("PathDrawer"),ep=Sp({group:"Line",displayName:"Prefab",type:qe}),tp=Sp({group:"Line",displayName:"Holder",type:ge,tooltip:"Line Prefab"}),np=Sp({group:"Point",displayName:"Prefab",type:qe}),ip=Sp({group:"Point",displayName:"Holder",type:ge}),$h((rp=M((op=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"linePrefab",rp,U(e)),B(e,"lineHolder",lp,U(e)),e.lineNodes=[],B(e,"pointPrefab",sp,U(e)),B(e,"pointHolder",up,U(e)),e.pointNodes=[],e}return N(n,[{key:"start",value:function(){var e=this;this.linePool=new cp((function(){var t=He(e.linePrefab);return e.lineHolder.addChild(t),t.parent=e.lineHolder,t.active=!1,t}),0,(function(t){e.lineNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()})),this.pointPool=new cp((function(){var t=He(e.pointPrefab);return e.pointHolder.addChild(t),t.active=!1,t}),0,(function(t){e.pointNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()}))}},{key:"drawPath",value:function(e){this.clearPath();var t,n=H(e);try{for(n.s();!(t=n.n()).done;){var i,a=t.value;null===(i=this.linePool.alloc().getComponent(Qh))||void 0===i||i.setPoints(a.a,a.b)}}catch(e){n.e(e)}finally{n.f()}}},{key:"clearPath",value:function(){var e,t=H(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.linePool.free(n)}}catch(e){t.e(e)}finally{t.f()}this.lineNodes=[];var i,a=H(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.pointPool.free(o)}}catch(e){a.e(e)}finally{a.f()}this.pointNodes=[]}}]),n}(ce)).prototype,"linePrefab",[ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lp=M(op.prototype,"lineHolder",[tp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sp=M(op.prototype,"pointPrefab",[np],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),up=M(op.prototype,"pointHolder",[ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ap=op))||ap);Q._RF.pop(),Q._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var Cp,Ep=$.ccclass,Ap=$.property,Tp=(hp=Ep("ErrorDrawer"),pp=Ap(Be),dp=Ap(Be),yp=Ap(Be),hp((gp=M((vp=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"one",gp,U(e)),B(e,"two",mp,U(e)),B(e,"error",bp,U(e)),e}return N(n,[{key:"start",value:function(){V(q(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(e){var t=this;if(this.clearPath(),e.forEach((function(n,i){var a;if(null===(a=t.linePool.alloc().getComponent(Qh))||void 0===a||a.setPoints(n.a,n.b),0!==i){var o=t.pointPool.alloc();o.setWorldPosition(new Ie(n.a.x,n.a.y,0));var r=o.getComponent(le);1===i&&e.length>3?r.spriteFrame=t.one:2===i&&e.length>3?r.spriteFrame=t.two:r.spriteFrame=t.error}})),1===e.length){var n=this.pointPool.alloc();n.setWorldPosition(new Ie(e[0].a.x+e[0].b.x,e[0].a.y+e[0].b.y,0).multiplyScalar(.5)),n.getComponent(le).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(e){this.pathAppearDuration>0&&(this.pathAppearDuration-=e,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(kp)).prototype,"one",[pp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mp=M(vp.prototype,"two",[dp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bp=M(vp.prototype,"error",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fp=vp))||fp);Q._RF.pop(),Q._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var Pp,Rp=(0,$.ccclass)("HintDrawer")(Cp=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"drawPath",value:function(e){this.clearPath(),this.createPath(e),this.showPath()}},{key:"createPath",value:function(e){var t,n=H(e);try{for(n.s();!(t=n.n()).done;){var i,a=t.value;null===(i=this.linePool.alloc().getComponent(Qh))||void 0===i||i.setPoints(a.a,a.b),this.pointPool.alloc().setWorldPosition(a.a.x,a.a.y,0)}}catch(e){n.e(e)}finally{n.f()}this.pointPool.alloc().setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0)}},{key:"showPath",value:function(){var e,t=H(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value.getComponent(he);n.opacity=0,ae(n).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){t.e(e)}finally{t.f()}var i,a=H(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value.getComponent(he);o.opacity=0,ae(o).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){a.e(e)}finally{a.f()}}},{key:"clearPath",value:function(){var e,t=this,n=H(this.lineNodes);try{var i=function(){var n=e.value,i=n.getComponent(he);ae(i).to(.15,{opacity:0},{onComplete:function(){i.opacity=255,t.linePool.free(n)}}).start()};for(n.s();!(e=n.n()).done;)i()}catch(e){n.e(e)}finally{n.f()}var a,o=H(this.pointNodes);try{var r=function(){var e=a.value,n=e.getComponent(he);ae(n).to(.15,{opacity:0},{onComplete:function(){n.opacity=255,t.pointPool.free(e)}}).start()};for(o.s();!(a=o.n()).done;)r()}catch(e){o.e(e)}finally{o.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(kp))||Cp;Q._RF.pop(),Q._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var Op,Ip,Lp,_p,Dp,Mp,Np,zp,Bp,Fp=(0,$.ccclass)("MatchDrawer")(Pp=function(t){F(o,t);var n,i,a=x(o);function o(){return z(this,o),a.apply(this,arguments)}return N(o,[{key:"drawPath",value:function(e){var t=this;e.forEach((function(e,n){var i,a=t.linePool.alloc();null===(i=a.getComponent(Qh))||void 0===i||i.setPoints(e.a,e.b),t.animateLine(a);var o=t.pointPool.alloc();o.setWorldPosition(e.a.x,e.a.y,0),t.animatePoint(o,n)}));var n=this.pointPool.alloc();n.setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0),this.animatePoint(n,e.length)}},{key:"animateLine",value:(i=W((function*(t){var n=t.getComponent(he);n.opacity=0;var i=ae(n).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});yield e.runTweenAsync(i),n.opacity=255,this.linePool.free(t)})),function(e){return i.apply(this,arguments)})},{key:"animatePoint",value:(n=W((function*(t,n){t.scale=Ie.ZERO;var i=ae(t).delay(.03*n).to(.2,{scale:Ie.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:Ie.ZERO},{easing:"backIn"});yield e.runTweenAsync(i),this.pointPool.free(t)})),function(e,t){return n.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),o}(kp))||Pp;Q._RF.pop(),Q._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var xp,Up=$.ccclass,Gp=$.property,Hp=(Op=Up("PathDraw"),Ip=Gp({group:{name:"Path Drawer"},type:Fp}),Lp=Gp({group:{name:"Path Drawer"},type:Rp}),_p=Gp({group:{name:"Path Drawer"},type:Tp}),Op((Np=M((Mp=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"matchPath",Np,U(e)),B(e,"hintPath",zp,U(e)),B(e,"errorPath",Bp,U(e)),e.isDrawingHint=!1,e}return N(n,[{key:"onLoad",value:function(){var e=this;this.node.scene.on(ta.GRID_RESIZE,(function(t){e.node.setScale(t,t),e.node.position=e.board.node.position.clone()}))}},{key:"init",value:function(e){this.board=e}},{key:"drawMatchPath",value:function(e,t){var n,i=e.map((function(e){return G({},e)})),a=H(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.a=t(o.a),o.b=t(o.b)}}catch(e){a.e(e)}finally{a.f()}this.matchPath.drawPath(i)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(e,t){if(!this.isDrawingHint){this.isDrawingHint=!0;var n,i=e.map((function(e){return G({},e)})),a=H(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.a=t(o.a),o.b=t(o.b)}}catch(e){a.e(e)}finally{a.f()}this.hintPath.drawPath(i)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(e,t){var n,i=e.map((function(e){return G({},e)})),a=H(i);try{for(a.s();!(n=a.n()).done;){var o=n.value;o.a=t(o.a),o.b=t(o.b)}}catch(e){a.e(e)}finally{a.f()}this.errorPath.drawPath(i)}}]),n}(ce)).prototype,"matchPath",[Ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zp=M(Mp.prototype,"hintPath",[Lp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bp=M(Mp.prototype,"errorPath",[_p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp=Mp))||Dp);Q._RF.pop(),Q._RF.push({},"1a5c0RyWQJOipSvNtPLsTHS","ClockManager",void 0);var Vp,qp=$.ccclass,Wp=$.disallowMultiple,Kp=qp("ClockManager")(xp=Wp(xp=function(t){F(a,t);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(e=i.call.apply(i,[this].concat(n))).time=0,e.remaining=0,e.running=!1,e.halfTime=!1,e}return N(a,[{key:"onLoad",value:function(){this.node.scene.on(ta.RESCUE_START,this.refillTime,this)}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"setTime",value:function(e){this.time=e,this.remaining=e,this.node.scene.emit(ta.TIME_UPDATED,this.remaining)}},{key:"getRemainingTime",value:function(){return this.remaining}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(ta.TIME_OUT)}},{key:"update",value:function(e){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=e,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(ta.HALF_TIME)),this.remaining>=0&&this.node.scene.emit(ta.TIME_UPDATED,this.remaining)))}},{key:"refillTime",value:(n=W((function*(){var t=this,n=ae(this.node).to(3,{},{onUpdate:function(e,n){if(n){var i=Te.lerp(0,120,n);t.setTime(i)}}});yield e.runTweenAsync(n),this.setTime(120),this.node.scene.emit(ta.RESCUE_FINISHED)})),function(){return n.apply(this,arguments)})}]),a}(ce))||xp)||xp;Q._RF.pop(),Q._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var jp,Yp,Xp,Zp,Jp,Qp,$p,ed,td,nd,id,ad=$.ccclass,od=[vn.COMBO_1,vn.COMBO_2,vn.COMBO_3,vn.COMBO_4,vn.COMBO_5,vn.COMBO_6,vn.COMBO_7,vn.COMBO_8,vn.COMBO_9,vn.COMBO_10,vn.COMBO_11,vn.COMBO_12,vn.COMBO_13],rd=ad("ComboManager")(Vp=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(ta.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(ta.GAME_FINISH,this.resetCombo,this),this.node.scene.on(ta.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(ta.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(ta.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(e){if(this.currentCombo=e,e>0){var t=Math.min(e-1,od.length-1);o.playSound(od[t]),this.vibrate(e)}this.emitEvent&&this.node.scene.emit(ta.COMBO_UPDATED,e)}},{key:"vibrate",value:function(e){var t;null===(t=Ne("Vibrate"))||void 0===t||null===(t=t.getComponent(ys))||void 0===t||t.vibrate(Math.min(20+20*e,220))}},{key:"setEmitEvent",value:function(e){this.emitEvent=e}}]),n}(ce))||Vp;Q._RF.pop(),Q._RF.push({},"78746Q4viBIlbRROK4J1bSl","Burst",void 0);var ld,sd=$.ccclass,ud=$.property,cd=(jp=sd("Burst"),Yp=ud(ne),Xp=ud(te),Zp=ud(ne),Jp=ud(te),jp((ed=M(($p=function(){function e(){z(this,e),B(this,"time",ed,this),B(this,"repeatCount",td,this),B(this,"repeatInterval",nd,this),B(this,"count",id,this),this.remainingCount=0,this.curTime=0}return N(e,[{key:"update",value:function(e,t){if(0===this.remainingCount&&(this.remainingCount=this.repeatCount,this.curTime=this.time),this.remainingCount>0){var n=We(e.time-e.startDelay.evaluate(0,1),e.duration)-t;n=n>0?n:0;var i=We(e.time-e.startDelay.evaluate(0,1),e.duration);this.curTime>=n&&this.curTime<i&&(e.emit(this.count,t-(i-this.curTime)),this.curTime+=this.repeatInterval,--this.remainingCount)}}},{key:"reset",value:function(){this.remainingCount=0,this.curTime=0}}]),e}()).prototype,"time",[Yp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),td=M($p.prototype,"repeatCount",[Xp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),nd=M($p.prototype,"repeatInterval",[Zp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),id=M($p.prototype,"count",[Jp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Qp=$p))||Qp);Q._RF.pop(),Q._RF.push({},"726cc2e08FBqpVIg/tPM7H2","Particle",void 0);var hd,pd,dd,yd,fd,vd,gd,md,bd,wd,Sd,kd,Cd,Ed,Ad,Td,Pd,Rd=$.ccclass,Od=$.executeInEditMode,Id=Rd("Particle")(ld=Od(!0)(ld=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).remainingLifetime=0,e.startLifetime=0,e}return N(n,[{key:"onLoad",value:function(){this.node.layer=Me.Enum.UI_2D}},{key:"init",value:function(e){this.sprite=this.getComponent(le),this.particleSystem=e,this.velocity=Ie.ZERO,this.remainingLifetime=0,this.startLifetime=0,this.startSize=Ie.ZERO,this.startColor=we.WHITE.clone(),this.randomSeed=0}},{key:"reset",value:function(){this.node.rotation.set(0,0,0)}}]),n}(ce))||ld)||ld;Q._RF.pop(),Q._RF.push({},"00eb3NBo0tM/qcD6ViMjx0A","CurveRange",void 0);var Ld,_d,Dd,Md,Nd,zd,Bd,Fd,xd,Ud,Gd,Hd,Vd,qd,Wd,Kd,jd,Yd=$.ccclass,Xd=$.property,Zd=se({Constant:0,Curve:1,TwoCurves:2,TwoConstants:3}),Jd=(hd=Yd("CurveRange"),pd=Xd({type:se(Zd)}),dd=Xd({visible:function(){return this.mode===Zd.Constant}}),yd=Xd({visible:function(){return this.mode===Zd.Curve}}),fd=Xd({visible:function(){return this.mode===Zd.TwoCurves}}),vd=Xd({visible:function(){return this.mode===Zd.TwoCurves}}),gd=Xd({visible:function(){return this.mode===Zd.TwoConstants}}),md=Xd({visible:function(){return this.mode===Zd.TwoConstants}}),hd((Sd=M((wd=function(){function e(){z(this,e),B(this,"mode",Sd,this),B(this,"constant",kd,this),B(this,"spline",Cd,this),B(this,"splineMin",Ed,this),B(this,"splineMax",Ad,this),B(this,"constantMin",Td,this),B(this,"constantMax",Pd,this),this.spline.assignSorted([0,1],[0,1]),this.splineMin.assignSorted([0,1],[0,1]),this.splineMax.assignSorted([0,1],[0,1])}return N(e,[{key:"evaluate",value:function(e,t){switch(this.mode){case Zd.Curve:return this.spline.evaluate(e);case Zd.TwoCurves:return Ke(this.splineMin.evaluate(e),this.splineMax.evaluate(e),t);case Zd.TwoConstants:return Ke(this.constantMin,this.constantMax,t);default:return this.constant}}},{key:"getMax",value:function(){switch(this.mode){case Zd.Curve:return 1;case Zd.TwoConstants:return this.constantMax;case Zd.TwoCurves:return 1;default:return this.constant}}},{key:"isZero",value:function(){switch(this.mode){case Zd.Curve:return je(1,0,Ye);case Zd.TwoConstants:return je(Math.max(Math.abs(this.constantMax),Math.abs(this.constantMin)),0,Ye);case Zd.TwoCurves:return je(1,0,Ye);default:return je(this.constant,0,Ye)}}}]),e}()).prototype,"mode",[pd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Zd.Constant}}),kd=M(wd.prototype,"constant",[dd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Cd=M(wd.prototype,"spline",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xe}}),Ed=M(wd.prototype,"splineMin",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xe}}),Ad=M(wd.prototype,"splineMax",[vd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xe}}),Td=M(wd.prototype,"constantMin",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Pd=M(wd.prototype,"constantMax",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bd=wd))||bd);Q._RF.pop(),Q._RF.push({},"3fe5eBRNTJFCZgeD7SqFSh5","GradientRange",void 0);var Qd=$.ccclass,$d=$.property,ey=se({Color:0,Gradient:1,TwoColors:2,TwoGradients:3,RandomColor:4}),ty=new we,ny=new we,iy=(Ld=Qd("GradientRange"),_d=$d({type:se(ey)}),Dd=$d({visible:function(){return this.mode===ey.Color}}),Md=$d({visible:function(){return this.mode===ey.TwoColors}}),Nd=$d({visible:function(){return this.mode===ey.TwoColors}}),zd=$d({visible:function(){return this.mode===ey.Gradient||this.mode===ey.RandomColor}}),Bd=$d({visible:function(){return this.mode===ey.TwoGradients}}),Fd=$d({visible:function(){return this.mode===ey.TwoGradients}}),Ld((Gd=M((Ud=function(){function e(){z(this,e),B(this,"mode",Gd,this),B(this,"color",Hd,this),B(this,"colorMin",Vd,this),B(this,"colorMax",qd,this),B(this,"gradient",Wd,this),B(this,"gradientMin",Kd,this),B(this,"gradientMax",jd,this),this._color=we.WHITE.clone()}return N(e,[{key:"evaluate",value:function(e,t){switch(this.mode){case ey.Color:return this.color;case ey.TwoColors:return we.lerp(this._color,this.colorMin,this.colorMax,t),this._color;case ey.RandomColor:return this.gradient.getRandomColor(this._color);case ey.Gradient:return this.gradient.evaluateFast(this._color,e);case ey.TwoGradients:return we.lerp(this._color,this.gradientMin.evaluateFast(ty,e),this.gradientMax.evaluateFast(ny,e),t),this._color;default:return this.color}}}]),e}()).prototype,"mode",[_d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ey.Color}}),Hd=M(Ud.prototype,"color",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return we.WHITE.clone()}}),Vd=M(Ud.prototype,"colorMin",[Md],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return we.WHITE.clone()}}),qd=M(Ud.prototype,"colorMax",[Nd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return we.WHITE.clone()}}),Wd=M(Ud.prototype,"gradient",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ze}}),Kd=M(Ud.prototype,"gradientMin",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ze}}),jd=M(Ud.prototype,"gradientMax",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ze}}),xd=Ud))||xd);function ay(e,t,n,i){!function(e,t){Oe.set(e,Math.cos(t),Math.sin(t))}(e,i),e.z=0,Ie.multiplyScalar(e,e,t+(n-t)*Qe())}function oy(e){var t=Zd;switch(e.mode){case t.TwoCurves:case t.TwoConstants:return!0;default:return!1}}Q._RF.pop(),Q._RF.push({},"1a4c4Z/fWpFuL5b3emrVLug","ParticleFunction",void 0),Q._RF.pop(),Q._RF.push({},"c2fc2/T2apMGZCPX5a4abo/","ModuleRandSeed",void 0);var ry,ly,sy,uy,cy,hy,py,dy=23541,yy=39825,fy=90794,vy=91041,gy=125292,my=197866,by=156497;Q._RF.pop(),Q._RF.push({},"39785+APfBJU5kvcdjZGiLr","ColorOvertimeModule",void 0);var wy,Sy,ky,Cy,Ey,Ay,Ty,Py,Ry,Oy=$.ccclass,Iy=$.property,Ly=vy,_y=(ry=Oy("ColorOvertimeModule"),ly=Iy({type:ye}),sy=Iy({type:iy}),ry((hy=M((cy=function(){function e(){z(this,e),B(this,"enable",hy,this),B(this,"color",py,this)}return N(e,[{key:"update",value:function(e){if(this.enable){var t=e.randomSeed+Ly,n=function(e){var t=ey;switch(e.mode){case t.TwoGradients:case t.TwoColors:return!0;default:return!1}}(this.color)?Ue(t):0,i=1-e.remainingLifetime/e.startLifetime;e.sprite.color=e.startColor.clone().multiply(this.color.evaluate(i,n))}}}]),e}()).prototype,"enable",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),py=M(cy.prototype,"color",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new iy}}),uy=cy))||uy);Q._RF.pop(),Q._RF.push({},"c397apirpxFfJTJN1KLAcGi","LimitVelocityOvertimeModule",void 0);var Dy,My,Ny,zy,By,Fy,xy,Uy=$.ccclass,Gy=$.property,Hy=dy,Vy=(wy=Uy("LimitVelocityOvertimeModule"),Sy=Gy({type:ye}),ky=Gy({type:Jd}),Cy=Gy({type:Jd}),wy((Ty=M((Ay=function(){function e(){z(this,e),B(this,"enable",Ty,this),B(this,"limit",Py,this),B(this,"dampen",Ry,this),this.limit.constant=500,this.dampen.constant=.2}return N(e,[{key:"update",value:function(e,t){if(this.enable){var n=1-e.remainingLifetime/e.startLifetime,i=e.velocity.clone().normalize(),a=oy(this.limit)?Ue(e.randomSeed+Hy):0,o=oy(this.dampen)?Ue(e.randomSeed+Hy+1):0,r=e.velocity.length(),l=this.limit.evaluate(n,a),s=this.dampen.evaluate(n,o);e.velocity=i.multiplyScalar(this.dampenBeyondLimit(r,l,s,t))}}},{key:"dampenBeyondLimit",value:function(e,t,n,i){if(e<=t)return e;var a=1-Math.exp(-n*i);return Te.lerp(e,t,a)}}]),e}()).prototype,"enable",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Py=M(Ay.prototype,"limit",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),Ry=M(Ay.prototype,"dampen",[Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),Ey=Ay))||Ey);Q._RF.pop(),Q._RF.push({},"442c2KaGHdNip4TBoeKOOoY","RendererModule",void 0);var qy,Wy,Ky,jy,Yy,Xy,Zy,Jy,Qy,$y,ef,tf,nf,af,of=$.ccclass,rf=$.property,lf=(Dy=of("RendererModule"),My=rf($e),Ny=rf(Be),Dy((Fy=M((By=N((function e(){z(this,e),B(this,"material",Fy,this),B(this,"spriteFrame",xy,this)}))).prototype,"material",[My],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xy=M(By.prototype,"spriteFrame",[Ny],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zy=By))||zy);Q._RF.pop(),Q._RF.push({},"c6cfbhYVctHt53aUXC4oSWy","RotationOvertimeModule",void 0);var sf,uf,cf,hf,pf,df,yf,ff,vf,gf,mf,bf,wf,Sf,kf,Cf,Ef,Af,Tf,Pf,Rf,Of,If,Lf=$.ccclass,_f=$.property,Df=gy,Mf=(qy=Lf("RotationOvertimeModule"),Wy=_f({type:ye}),Ky=_f(ye),jy=_f({type:Jd}),Yy=_f({type:Jd,visible:function(){return this.separateAxes}}),Xy=_f({type:Jd,visible:function(){return this.separateAxes}}),Zy=_f({type:Jd}),qy(($y=M((Qy=function(){function e(){z(this,e),B(this,"enable",$y,this),B(this,"separateAxes",ef,this),B(this,"x",tf,this),B(this,"y",nf,this),B(this,"z",af,this)}return N(e,[{key:"update",value:function(e,t){if(this.enable){var n=1-e.remainingLifetime/e.startLifetime,i=e.randomSeed+Df,a=oy(this.z)?Ue(i):0,o=this.z.evaluate(n,a)*t,r=0,l=0;if(this.separateAxes){var s=oy(this.x)?Ue(i):0,u=oy(this.y)?Ue(i):0;r=this.x.evaluate(n,s)*t,l=this.y.evaluate(n,u)*t}e.node.eulerAngles=new Ie(e.node.eulerAngles.x+r,e.node.eulerAngles.y+l,e.node.eulerAngles.z+o)}}}]),e}()).prototype,"enable",[Wy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ef=M(Qy.prototype,"separateAxes",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tf=M(Qy.prototype,"x",[jy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),nf=M(Qy.prototype,"y",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),af=M(Qy.prototype,"z",[Xy,Zy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),Jy=Qy))||Jy);Q._RF.pop(),Q._RF.push({},"f63cd4ScDJFPrnTLNT4+QKu","ShapeModule",void 0);var Nf,zf,Bf,Ff,xf,Uf,Gf,Hf=$.ccclass,Vf=$.property,qf=se({Circle:0,Rectangle:1}),Wf=se({Base:0,Edge:1}),Kf=function(){return this.shape===qf.Circle},jf=function(){return this.shape===qf.Rectangle},Yf=[0,0],Xf=(sf=Hf("ShapeModule"),uf=Vf({type:se(qf)}),cf=Vf({type:se(Wf),visible:jf}),hf=Vf({}),pf=Vf({}),df=Vf({}),yf=Vf({range:[0,360],visible:Kf}),ff=Vf({range:[-360,360],visible:Kf}),vf=Vf({min:0,visible:Kf}),gf=Vf({range:[0,1],step:.01,visible:Kf}),mf=Vf({visible:jf}),sf((Sf=M((wf=function(){function e(){z(this,e),B(this,"shape",Sf,this),B(this,"emitFrom",kf,this),B(this,"position",Cf,this),B(this,"rotation",Ef,this),B(this,"scale",Af,this),B(this,"arc",Tf,this),B(this,"angle",Pf,this),B(this,"radius",Rf,this),B(this,"radiusThickness",Of,this),B(this,"rectangleThickness",If,this)}return N(e,[{key:"emit",value:function(e){switch(this.shape){case qf.Circle:this.circleEmit(this.radius,this.radiusThickness,et(this.generateArcAngle()),e);break;case qf.Rectangle:this.rectangleEmit(this.emitFrom,this.rectangleThickness,e)}}},{key:"circleEmit",value:function(e,t,n,i){var a=i.node.position;ay(a,e*(1-t),e,n+et(this.angle)),i.velocity=a.clone().normalize()}},{key:"rectangleEmit",value:function(e,t,n){var i,a,o,r=n.node.position;switch(e){case Wf.Base:a=r,o=t,Oe.set(a,Ge(-o.x,o.x),Ge(-o.y,o.y));break;case Wf.Edge:Yf[0]=Ge(-1,1),Yf[1]=(0===(i=Ge(-1,1))&&i++,Je.sign(i)),function(e){for(var t=0;t<e.length;t++){var n=t+ze(0,e.length-t),i=e[n];e[n]=e[t],e[t]=i}}(Yf),this.applyRectThickness(Yf,t),Oe.set(r,Yf[0],Yf[1])}n.velocity=r.clone().normalize()}},{key:"generateArcAngle",value:function(){return Ge(0,this.arc)}},{key:"applyRectThickness",value:function(e,t){t.x>0&&(e[0]*=t.x),t.y>0&&(e[1]*=t.y)}},{key:"gizmo",value:function(e){switch(e.strokeColor.fromHEX("#46C4FFB0"),e.fillColor.fromHEX("#46C4FF77"),e.lineWidth=8,this.shape){case qf.Circle:this.gizmoCircle(e);break;case qf.Rectangle:this.gizmoRectangle(e)}}},{key:"gizmoCircle",value:function(e){e.clear();var t=this.angle,n=this.angle+this.arc;if(this.createArcPath(e,this.radius,t,n),this.createArcPath(e,this.radius*(1-this.radiusThickness),t,n),this.arc<360&&this.radius>0){var i=this.radius*Math.cos(et(this.angle)),a=this.radius*Math.sin(et(this.angle)),o=this.radius*Math.cos(et(this.arc+this.angle)),r=this.radius*Math.sin(et(this.arc+this.angle));e.moveTo(i,a),e.lineTo(0,0),e.moveTo(o,r),e.lineTo(0,0)}e.stroke()}},{key:"gizmoRectangle",value:function(e){e.clear();var t=this.rectangleThickness.x,n=this.rectangleThickness.y;e.moveTo(t,n),e.lineTo(-t,n),e.lineTo(-t,-n),e.lineTo(t,-n),e.close(),e.stroke()}},{key:"createArcPath",value:function(e,t,n,i){if(!(t<=0))for(var a=(i-n)/48,o=0;o<=48;o++){var r=n+o*a,l=t*Math.cos(et(r)),s=t*Math.sin(et(r));0===o?e.moveTo(l,s):e.lineTo(l,s)}}}]),e}()).prototype,"shape",[uf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qf.Circle}}),kf=M(wf.prototype,"emitFrom",[cf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Wf.Base}}),Cf=M(wf.prototype,"position",[hf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ie(0,0,0)}}),Ef=M(wf.prototype,"rotation",[pf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ie(0,0,0)}}),Af=M(wf.prototype,"scale",[df],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ie(1,1,1)}}),Tf=M(wf.prototype,"arc",[yf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 360}}),Pf=M(wf.prototype,"angle",[ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 25}}),Rf=M(wf.prototype,"radius",[vf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Of=M(wf.prototype,"radiusThickness",[gf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),If=M(wf.prototype,"rectangleThickness",[mf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(20,50)}}),bf=wf))||bf);Q._RF.pop(),Q._RF.push({},"1b7c1WztGdLzKO8gh4ulm2c","SizeOvertimeModule",void 0);var Zf,Jf,Qf,$f,ev,tv,nv,iv,av,ov,rv,lv,sv,uv=$.ccclass,cv=$.property,hv=yy,pv=(Nf=uv("SizeOvertimeModule"),zf=cv({type:ye}),Bf=cv({type:Jd}),Nf((Uf=M((xf=function(){function e(){z(this,e),B(this,"enable",Uf,this),B(this,"size",Gf,this),this.size.constant=1}return N(e,[{key:"update",value:function(e){if(this.enable){var t=1-e.remainingLifetime/e.startLifetime,n=e.randomSeed+hv,i=oy(this.size)?Ue(n):0,a=this.size.evaluate(t,i);e.node.scale=new Ie(a*e.startSize.x,a*e.startSize.y,1)}}}]),e}()).prototype,"enable",[zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gf=M(xf.prototype,"size",[Bf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),Ff=xf))||Ff);Q._RF.pop(),Q._RF.push({},"530341yf3ZOmaqdU+AYM0/U","SpriteAnimationModule",void 0);var dv,yv,fv,vv,gv,mv,bv,wv,Sv,kv=$.ccclass,Cv=$.property,Ev=fy,Av=(Zf=kv("SpriteAnimationModule"),Jf=Cv({type:ye}),Qf=Cv({type:Be}),$f=Cv({type:Jd}),ev=Cv({type:Jd}),tv=Cv({type:te}),Zf((av=M((iv=function(){function e(){z(this,e),B(this,"enable",av,this),B(this,"frames",ov,this),B(this,"frameOverTime",rv,this),B(this,"startFrame",lv,this),B(this,"cycleCount",sv,this),this.frameOverTime.constant=0,this.startFrame.constant=0}return N(e,[{key:"update",value:function(e){if(this.enable){var t=1-e.remainingLifetime/e.startLifetime,n=oy(this.startFrame)?Ue(e.randomSeed+Ev):0,i=oy(this.frameOverTime)?Ue(e.randomSeed+Ev):0,a=this.startFrame.evaluate(t,n),o=We(this.cycleCount*(this.frameOverTime.evaluate(t,i)+a),this.frames.length);e.sprite.spriteFrame=this.frames[Math.floor(o)]}}}]),e}()).prototype,"enable",[Jf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ov=M(iv.prototype,"frames",[Qf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rv=M(iv.prototype,"frameOverTime",[$f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),lv=M(iv.prototype,"startFrame",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),sv=M(iv.prototype,"cycleCount",[tv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nv=iv))||nv);Q._RF.pop(),Q._RF.push({},"f6ad5Yz6wpE2ZzModn16CYQ","VelocityOvertimeModule",void 0);var Tv,Pv,Rv,Ov,Iv,Lv,_v,Dv,Mv,Nv,zv,Bv,Fv,xv,Uv,Gv,Hv,Vv,qv,Wv,Kv,jv,Yv,Xv,Zv,Jv,Qv,$v,eg,tg,ng,ig,ag,og,rg,lg,sg,ug,cg,hg,pg,dg,yg,fg,vg,gg,mg,bg,wg,Sg,kg,Cg,Eg=$.ccclass,Ag=$.property,Tg=(dv=Eg("VelocityOvertimeModule"),yv=Ag({type:ye}),fv=Ag({type:Jd}),vv=Ag({type:Jd}),dv((bv=M((mv=function(){function e(){z(this,e),B(this,"enable",bv,this),B(this,"x",wv,this),B(this,"y",Sv,this),this._temp_v3=new Ie,this.x.constant=0,this.y.constant=0}return N(e,[{key:"update",value:function(e,t){if(this.enable){var n=1-e.remainingLifetime/e.startLifetime,i=oy(this.x)?Ue(e.randomSeed+my):0,a=oy(this.y)?Ue(e.randomSeed+by):0,o=Ie.set(this._temp_v3,this.x.evaluate(n,i),this.y.evaluate(n,a),0);Ie.add(e.velocity,e.velocity,o.multiplyScalar(t))}}}]),e}()).prototype,"enable",[yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wv=M(mv.prototype,"x",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),Sv=M(mv.prototype,"y",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),gv=mv))||gv);Q._RF.pop(),Q._RF.push({},"10bc3IfFqBLtpSgVri/NVeX","ParticleSystem",void 0);var Pg,Rg,Og,Ig,Lg,_g,Dg,Mg=$.ccclass,Ng=$.property,zg=$.executeInEditMode,Bg=$.disallowMultiple,Fg=(Tv=Mg("ParticleSystem"),Pv=zg(!0),Rv=Bg(!0),Ov=Ng({}),Iv=Ng(ye),Lv=Ng(ne),_v=Ng(ye),Dv=Ng({type:Jd}),Mv=Ng({type:Jd}),Nv=Ng(iy),zv=Ng(ye),Bv=Ng({type:Jd,formerlySerializedAs:"startSize"}),Fv=Ng({type:Jd,visible:function(){return this.startSize2D}}),xv=Ng({type:Jd}),Uv=Ng(ye),Gv=Ng({type:Jd,formerlySerializedAs:"startRotation"}),Hv=Ng({type:Jd}),Vv=Ng({type:Jd}),qv=Ng({type:Xf}),Wv=Ng({type:Tg}),Kv=Ng({type:pv}),jv=Ng({type:Mf}),Yv=Ng({type:_y}),Xv=Ng({type:Av}),Zv=Ng({type:Vy}),Jv=Ng(cd),Qv=Ng({type:lf}),Tv($v=Pv($v=Rv((M((eg=function(e){F(n,e);var t=x(n);function n(){var e;return z(this,n),(e=t.call(this))._preview=!1,B(e,"playOnAwake",tg,U(e)),B(e,"duration",ng,U(e)),B(e,"loop",ig,U(e)),B(e,"startDelay",ag,U(e)),B(e,"startLifetime",og,U(e)),B(e,"startColor",rg,U(e)),B(e,"startSize2D",lg,U(e)),B(e,"startSizeX",sg,U(e)),B(e,"startSizeY",ug,U(e)),B(e,"startSpeed",cg,U(e)),B(e,"startRotation3D",hg,U(e)),B(e,"startRotation",pg,U(e)),B(e,"gravityModifier",dg,U(e)),B(e,"rateOverTime",yg,U(e)),B(e,"shapeModule",fg,U(e)),B(e,"velocityOvertimeModule",vg,U(e)),B(e,"sizeOvertimeModule",gg,U(e)),B(e,"rotationOvertimeModule",mg,U(e)),B(e,"colorOvertimeModule",bg,U(e)),B(e,"spriteAnimationModule",wg,U(e)),B(e,"limitVelocityOvertimeModule",Sg,U(e)),B(e,"bursts",kg,U(e)),B(e,"rendererModule",Cg,U(e)),e.particles=[],e.time=0,e.emitRateTimeCounter=0,e.isPlaying=!1,e.isStopped=!0,e.isEmitting=!1,e.needToRestart=!1,e.startLifetime.constant=5,e.startSizeX.constant=1,e.startSpeed.constant=5,e.rateOverTime.constant=10,e}return N(n,[{key:"preview",get:function(){return this._preview},set:function(e){this._preview=e,this.graphics&&this.graphics.destroy()}},{key:"onEnable",value:function(){}},{key:"onLoad",value:function(){this.preview=null!==this.getComponent(me),this.node.removeAllChildren()}},{key:"start",value:function(){this.node.position=new Ie(this.node.position.x,this.node.position.y,100),(this.playOnAwake&&!v||this.preview&&v)&&this.play()}},{key:"update",value:function(e){this.isPlaying&&(this.time+=e,this.emitting(e))}},{key:"play",value:function(){this.needToRestart&&(this.needToRestart=!1),this.isStopped&&(this.isStopped=!1),this.time=0,this.isPlaying=!0,this.isEmitting=!0}},{key:"stop",value:function(){this.isPlaying||(this.isPlaying=!1),this.isEmitting||(this.isEmitting=!1),this.isStopped=!0}},{key:"emitting",value:function(e){var t=this,n=this.startDelay.evaluate(0,1);if(this.time>n&&this.time>this.duration+n&&(this.loop||(this.isEmitting=!1)),this.isEmitting){if(this.emitRateTimeCounter+=this.rateOverTime.evaluate(this.time/this.duration,1)*e,this.emitRateTimeCounter>1){var i=Math.floor(this.emitRateTimeCounter);this.emitRateTimeCounter-=i,this.emit(i,e)}var a,o=H(this.bursts);try{for(o.s();!(a=o.n()).done;){a.value.update(this,e)}}catch(e){o.e(e)}finally{o.f()}}var r=this.gravityModifier.evaluate(this.time/this.duration,1);this.particles.forEach((function(n,i){n.node.active&&(t.spriteAnimationModule.update(n),t.sizeOvertimeModule.update(n),t.rotationOvertimeModule.update(n,e),t.colorOvertimeModule.update(n),t.velocityOvertimeModule.update(n,e),t.applyGravityModifier(n,r),t.limitVelocityOvertimeModule.update(n,e),n.node.position.add(n.velocity.clone().multiplyScalar(e)),n.remainingLifetime-=e,n.remainingLifetime<=0&&(n.node.active=!1))}))}},{key:"emit",value:function(e,t){if(null!==this.rendererModule.spriteFrame)for(var n=this.time%this.duration/this.duration,i=0;i<e;i++){var a=this.getFreeParticle();a.init(this),a.reset(),this.shapeModule.emit(a);var o=this.startSpeed.evaluate(n,this.rand());a.velocity=a.velocity.clone().multiplyScalar(o);var r=this.startSizeX.evaluate(n,this.rand()),l=this.startSize2D?new Ie(r,this.startSizeY.evaluate(n,this.rand()),1):new Ie(r,r,1);a.startSize=l.clone(),a.node.scale=l.clone();var s=this.startRotation.evaluate(n,this.rand());a.node.eulerAngles=new Ie(0,0,s),a.startColor=this.startColor.evaluate(n,this.rand()).clone(),a.sprite.color=a.startColor.clone(),a.startLifetime=this.startLifetime.evaluate(n,this.rand())+t,a.remainingLifetime=a.startLifetime,a.randomSeed=ze(0,233280)}}},{key:"applyGravityModifier",value:function(e,t){e.velocity.add(new Ie(0,-9.8*t,0))}},{key:"rand",value:function(){return Ue(ze(0,Je.INT_MAX))}},{key:"getFreeParticle",value:function(){var e=this.particles.find((function(e){return!e.node.active}));return e||(e=this.createParticle()),e.node.active=!0,e}},{key:"createParticle",value:function(){var e=new ge,t=He(e),n=t.addComponent(Id),i=t.addComponent(le);return this.particles.push(n),i.spriteFrame=this.rendererModule.spriteFrame,i.customMaterial=this.rendererModule.material,this.node.addChild(t),n}}]),n}(ce)).prototype,"preview",[Ov],Object.getOwnPropertyDescriptor(eg.prototype,"preview"),eg.prototype),tg=M(eg.prototype,"playOnAwake",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ng=M(eg.prototype,"duration",[Lv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),ig=M(eg.prototype,"loop",[_v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ag=M(eg.prototype,"startDelay",[Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),og=M(eg.prototype,"startLifetime",[Mv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),rg=M(eg.prototype,"startColor",[Nv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new iy}}),lg=M(eg.prototype,"startSize2D",[zv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sg=M(eg.prototype,"startSizeX",[Bv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),ug=M(eg.prototype,"startSizeY",[Fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),cg=M(eg.prototype,"startSpeed",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),hg=M(eg.prototype,"startRotation3D",[Uv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pg=M(eg.prototype,"startRotation",[Gv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),dg=M(eg.prototype,"gravityModifier",[Hv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),yg=M(eg.prototype,"rateOverTime",[Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Jd}}),fg=M(eg.prototype,"shapeModule",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xf}}),vg=M(eg.prototype,"velocityOvertimeModule",[Wv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Tg}}),gg=M(eg.prototype,"sizeOvertimeModule",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pv}}),mg=M(eg.prototype,"rotationOvertimeModule",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mf}}),bg=M(eg.prototype,"colorOvertimeModule",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new _y}}),wg=M(eg.prototype,"spriteAnimationModule",[Xv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Av}}),Sg=M(eg.prototype,"limitVelocityOvertimeModule",[Zv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Vy}}),kg=M(eg.prototype,"bursts",[Ng,Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cg=M(eg.prototype,"rendererModule",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new lf}}),$v=eg))||$v)||$v)||$v);Q._RF.pop(),Q._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var xg,Ug,Gg,Hg,Vg,qg,Wg,Kg,jg,Yg,Xg,Zg,Jg,Qg,$g,em,tm,nm,im,am,om,rm=$.ccclass,lm=$.property,sm=(Pg=rm("ItemCollectionFX"),Rg=lm(le),Og=lm(Fg),Pg((_g=M((Lg=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"sprite",_g,U(e)),B(e,"particles",Dg,U(e)),e}return N(i,[{key:"__preload",value:function(){t.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){var e,t=H(this.particles);try{for(t.s();!(e=t.n()).done;){e.value.play()}}catch(e){t.e(e)}finally{t.f()}}}]),i}(ce)).prototype,"sprite",[Rg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dg=M(Lg.prototype,"particles",[Og],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ig=Lg))||Ig);Q._RF.pop(),Q._RF.push({},"a7ff8uVnP1G3ppM9F/A5DYq","Cloud",void 0);var um=$.ccclass,cm=$.property,hm=new Ie(1.2,1.2),pm=new Ie(0,300),dm=(xg=um("Cloud"),Ug=cm({type:ge}),Gg=t.required,Hg=cm(ge),Vg=t.required,qg=cm(qe),Wg=t.required,Kg=t.required,jg=cm(qe),Yg=t.required,Xg=t.onlyRunInLifeCycleAsync,Zg=t.onlyRunInLifeCycleAsync,Jg=t.onlyRunInLifeCycleAsync,xg((em=M(($g=function(n){F(c,n);var a,o,r,l,s,u=x(c);function c(){var e;z(this,c);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=u.call.apply(u,[this].concat(n)),B(e,"cloudSprites",em,U(e)),B(e,"raysContainer",tm,U(e)),B(e,"rayPrefab",nm,U(e)),B(e,"rayPool",im,U(e)),B(e,"oldRayPrefab",am,U(e)),B(e,"oldRayPool",om,U(e)),e.cacheDirectionVector=new Ie,e.scaleTweenSignal=new i,e.canvas=null,e}return N(c,[{key:"onLoad",value:function(){this.rayPool=new cp(this.createRay.bind(this),2,this.allocRay.bind(this),this.freeRay.bind(this),this.destroyRay.bind(this)),this.oldRayPool=new cp(this.createOldRay.bind(this),2,this.allocOldRay.bind(this),this.freeOldRay.bind(this),this.destroyOldRay.bind(this)),t.validateRequiredProperties(this,c)}},{key:"createRay",value:function(){var e=He(this.rayPrefab);e.active=!1,this.raysContainer.addChild(e);var t=e.getComponent(ee),n=e.getComponent(Fe);if(!t||!n)throw new Error("Cloud.createRay: Invalid prefab");return{node:e,uiTransform:t,animation:n}}},{key:"allocRay",value:function(e){e.node.active=!0}},{key:"freeRay",value:function(e){e.node.active=!1}},{key:"destroyRay",value:function(e){e.node.isValid&&e.node.destroy()}},{key:"createOldRay",value:function(){var e=He(this.oldRayPrefab);e.active=!1,this.raysContainer.addChild(e);var t=e.getComponent(ee);if(!t)throw new Error("Cloud.createOldRay: Invalid prefab");return{node:e,uiTransform:t}}},{key:"allocOldRay",value:function(e){e.node.active=!0}},{key:"freeOldRay",value:function(e){e.node.active=!1}},{key:"destroyOldRay",value:function(e){e.node.isValid&&e.node.destroy()}},{key:"playInitAnimation",value:(s=W((function*(){yield this.moveToScreenCenter()})),function(){return s.apply(this,arguments)})},{key:"playLightningAnimation",value:(l=W((function*(e){yield this.playOldLightningAnimation(e)})),function(e){return l.apply(this,arguments)})},{key:"playOldLightningAnimation",value:(r=W((function*(t){var n=this.oldRayPool.alloc(),i=n.node,a=n.uiTransform;i.setWorldPosition(this.node.worldPosition),this.cacheDirectionVector.set(t),this.cacheDirectionVector.subtract(i.worldPosition);var o=Math.atan2(this.cacheDirectionVector.y,this.cacheDirectionVector.x)*(180/Math.PI)+180,r=this.cacheDirectionVector.length();a.width=r,i.angle=o,yield e.waitTweenAsync(.2),this.oldRayPool.free(n)})),function(e){return r.apply(this,arguments)})},{key:"playScaleTween",value:(o=W((function*(){this.scaleTweenSignal.abort();var t=new i;this.scaleTweenSignal=t,yield Promise.all(this.cloudSprites.map((function(n){return e.runTweenAsync(ae(n).to(.1,{scale:hm},{easing:"quadOut"}).to(.1,{scale:Ie.ONE},{easing:"quadOut"}),t)})))})),function(){return o.apply(this,arguments)})},{key:"moveToScreenCenter",value:(a=W((function*(){var t,n,i;if(this.canvas=null!==(t=null!==(n=this.canvas)&&void 0!==n?n:null===(i=Ne("Canvas"))||void 0===i?void 0:i.getComponent(ee))&&void 0!==t?t:null,this.canvas){var a=this.canvas,o=a.width,r=a.height,l=0,s=0;switch(Math.floor(4*Math.random())){case 0:l=Math.random()*o-o/2,s=r/2+300;break;case 1:l=Math.random()*o-o/2,s=-r/2-300;break;case 2:l=-o/2-300,s=Math.random()*r-r/2;break;case 3:l=o/2+300,s=Math.random()*r-r/2}this.node.setPosition(l,s);var u=ae(this.node).to(.8,{position:pm},{easing:"quadOut"});yield e.runTweenAsync(u)}})),function(){return a.apply(this,arguments)})}]),c}(ce)).prototype,"cloudSprites",[Ug],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tm=M($g.prototype,"raysContainer",[Gg,Hg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm=M($g.prototype,"rayPrefab",[Vg,qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),im=M($g.prototype,"rayPool",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am=M($g.prototype,"oldRayPrefab",[Kg,jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om=M($g.prototype,"oldRayPool",[Yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M($g.prototype,"playLightningAnimation",[Xg],Object.getOwnPropertyDescriptor($g.prototype,"playLightningAnimation"),$g.prototype),M($g.prototype,"playOldLightningAnimation",[Zg],Object.getOwnPropertyDescriptor($g.prototype,"playOldLightningAnimation"),$g.prototype),M($g.prototype,"playScaleTween",[Jg],Object.getOwnPropertyDescriptor($g.prototype,"playScaleTween"),$g.prototype),Qg=$g))||Qg);Q._RF.pop(),Q._RF.push({},"7df59GGBIxFo7OyHCGrEKe5","addItemEffect",void 0);var ym,fm,vm,gm,mm,bm,wm,Sm,km,Cm,Em,Am,Tm,Pm,Rm,Om,Im,Lm=function(){var t=W((function*(t,n){t.playExplosionParticles(),o.playSound("sounds/item_reward"),yield _m(t),yield e.waitTweenAsync(.8),yield Dm(t,n),yield Mm(t,n)}));return function(e,n){return t.apply(this,arguments)}}(),_m=function(){var t=W((function*(t){var n=ae(t.node).to(.1,{scale:new Ie(.8,1.2,1)}).to(.1,{scale:new Ie(1.2,.8,1)}).to(.1,{scale:new Ie(1,1,1)});yield e.runTweenAsync(n)}));return function(e){return t.apply(this,arguments)}}(),Dm=function(){var t=W((function*(t,n){var i=n.node.worldPosition.clone().add3f(0,30,0),a=new Ie(.5,.5,.5),o=ae(t.node).to(1,{worldPosition:i,scale:a},{easing:"cubicInOut"});yield e.runTweenAsync(o)}));return function(e,n){return t.apply(this,arguments)}}(),Mm=function(){var t=W((function*(t,n){var i=n.node.worldPosition.clone(),a=i.clone().add3f(0,70,0),o=new Ie(.65,.65,.65),r=ae(t.node).to(.3,{worldPosition:a,scale:o},{easing:"cubicOut"}).to(.5,{worldPosition:i},{easing:"cubicIn"});yield e.runTweenAsync(r)}));return function(e,n){return t.apply(this,arguments)}}();Q._RF.pop(),Q._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var Nm,zm,Bm,Fm,xm,Um=$.ccclass,Gm=$.property,Hm=$.disallowMultiple,Vm=(ym=Um("ShiningStar"),fm=Gm(le),vm=Gm({serializable:!0,visible:!1}),gm=Gm({type:ne,displayName:"Scale up duration",min:.001}),mm=Gm({serializable:!0,visible:!1}),bm=Gm({type:ne,displayName:"Bounce and Fall duration",min:.001}),wm=Gm({serializable:!0,visible:!1}),Sm=Gm({type:ne,displayName:"Start scale"}),km=Gm({serializable:!0,visible:!1}),Cm=Gm({type:ne,displayName:"End scale"}),ym(Em=Hm((Tm=M((Am=function(n){F(h,n);var i,a,o,r,l,s,u,c=x(h);function h(){var e;z(this,h);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=c.call.apply(c,[this].concat(n)),B(e,"shine",Tm,U(e)),B(e,"twScaleUpDuration",Pm,U(e)),B(e,"twBounceAndFallDuration",Rm,U(e)),B(e,"twStartScale",Om,U(e)),B(e,"twEndScale",Im,U(e)),e.isBeingAnimated=!1,e}return N(h,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(e){this.twScaleUpDuration=e}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(e){this.twBounceAndFallDuration=e}},{key:"startScale",get:function(){return this.twStartScale},set:function(e){this.twStartScale=e}},{key:"endScale",get:function(){return this.twEndScale},set:function(e){this.twEndScale=e}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(he),this.uiOpacity=this.node.getComponent(he),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(u=W((function*(){if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0,yield this.animateAppear(),yield this.animateDisappear(),this.isBeingAnimated=!1})),function(){return u.apply(this,arguments)})},{key:"animateAppear",value:(s=W((function*(){this.shineOpacity.opacity=255,yield Promise.all([this.animateFadeIn(),this.animateScaleUp()])})),function(){return s.apply(this,arguments)})},{key:"animateDisappear",value:(l=W((function*(){yield Promise.all([this.animateBounceAndFall(),this.animateScaleDown()]),this.node.setScale(0,0),this.uiOpacity.opacity=0})),function(){return l.apply(this,arguments)})},{key:"animateBounceAndFall",value:(r=W((function*(){var t=this.node.position.x,n=this.node.position.y,i=[60,120],a=(Math.random()*(i[1]-i[0])+i[0])*(Math.PI/180),o=t+200*Math.cos(a),r=n+200*Math.sin(a),l=n-500,s=e.runTweenAsync(ae(this.node).to(.2*this.twBounceAndFallDuration,{position:new Ie(o,r,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new Ie(o,l,this.node.position.z)},{easing:"cubicIn"})),u=[0,360],c=e.runTweenAsync(ae(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new Ie(0,0,Math.random()*(u[1]-u[0])*(o>t?-1:1))},{easing:"sineOut"}));yield Promise.all([s,c]),this.node.eulerAngles=new Ie(0,0,0)})),function(){return r.apply(this,arguments)})},{key:"animateFadeIn",value:(o=W((function*(){var t=Math.max(this.scaleUpDuration/4,.01);yield e.runTweenAsync(ae(this.uiOpacity).to(t,{opacity:255}))})),function(){return o.apply(this,arguments)})},{key:"animateScaleUp",value:(a=W((function*(){this.node.setScale(this.startScale,this.startScale);var t=new Ie(this.endScale,this.endScale,1);yield e.runTweenAsync(ae(this.node).to(this.scaleUpDuration,{scale:t},{easing:"cubicOut"}))})),function(){return a.apply(this,arguments)})},{key:"animateScaleDown",value:(i=W((function*(){var t=new Ie(0,0,1);yield e.runTweenAsync(ae(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:t},{easing:"cubicIn"}))})),function(){return i.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}}]),h}(ce)).prototype,"shine",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm=M(Am.prototype,"twScaleUpDuration",[vm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),M(Am.prototype,"scaleUpDuration",[gm],Object.getOwnPropertyDescriptor(Am.prototype,"scaleUpDuration"),Am.prototype),Rm=M(Am.prototype,"twBounceAndFallDuration",[mm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),M(Am.prototype,"bounceAndFallDuration",[bm],Object.getOwnPropertyDescriptor(Am.prototype,"bounceAndFallDuration"),Am.prototype),Om=M(Am.prototype,"twStartScale",[wm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),M(Am.prototype,"startScale",[Sm],Object.getOwnPropertyDescriptor(Am.prototype,"startScale"),Am.prototype),Im=M(Am.prototype,"twEndScale",[km],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),M(Am.prototype,"endScale",[Cm],Object.getOwnPropertyDescriptor(Am.prototype,"endScale"),Am.prototype),Em=Am))||Em)||Em);Q._RF.pop(),Q._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var qm,Wm,Km,jm,Ym,Xm,Zm,Jm,Qm,$m,eb,tb,nb,ib,ab,ob,rb,lb,sb,ub,cb,hb,pb,db,yb,fb,vb,gb,mb,bb,wb,Sb,kb,Cb,Eb,Ab,Tb,Pb,Rb,Ob,Ib,Lb,_b,Db,Mb,Nb=$.ccclass,zb=$.property,Bb=$.disallowMultiple,Fb=GameCore.Utils.Array,xb=(Nm=Nb("StarParticles"),zm=zb({type:[Vm],displayName:"Prebuilt Shining stars"}),Nm(Bm=Bb((xm=M((Fm=function(e){F(a,e);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"shiningStars",xm,U(e)),e}return N(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(n=W((function*(e){var t=this.getFirstAvailableShiningStar();if(void 0===t)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");var n=Z(e,2),i=n[0],a=n[1],o=new Ie(i,a,this.node.worldPosition.z);t.node.worldPosition=o,yield t.playAnimation()})),function(e){return n.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return Fb.search(this.shiningStars,(function(e){return e.isAvailable}))}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}}]),a}(ce)).prototype,"shiningStars",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bm=Fm))||Bm)||Bm);Q._RF.pop(),Q._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var Ub=GameCore.Utils.Valid,Gb=$.ccclass,Hb=$.property,Vb=globalThis.game.monitorError,qb=Ie.ONE.clone().multiplyScalar(.5),Wb=(qm=Gb("EffectManager"),Wm=t.required,Km=Hb({group:"Thunder Effect",type:dm}),jm=t.required,Ym=Hb({group:"Mask Effect",type:mi}),Xm=t.required,Zm=Hb({group:"Mask Effect",type:ge}),Jm=t.required,Qm=Hb({group:"Tornado Effect",type:ge}),$m=t.required,eb=Hb({group:"Clear Particle Effect",type:ge,displayName:"Particle holder node"}),tb=t.required,nb=Hb({group:"Clear Particle Effect",type:Fg,displayName:"Emitter 1"}),ib=t.required,ab=Hb({group:"Clear Particle Effect",type:Fg,displayName:"Emitter 2"}),ob=t.required,rb=Hb({group:"Star Particles Effect",type:xb}),lb=t.required,sb=Hb({group:"Confetti Effect",type:Fg}),ub=Hb({group:"Add Item Effect",type:sm}),cb=Hb({group:"Add Item Effect",type:Be}),hb=Hb({group:"Add Item Effect",type:Be}),pb=Hb({group:"Add Item Effect",type:Be}),db=Hb({group:"Add Item Effect",type:Be}),yb=t.required,fb=Hb({type:ge,displayName:"Clear Explosion Container",group:"Clear Explosion Effect"}),vb=t.onlyRunInLifeCycle,gb=t.onlyRunInLifeCycleAsync,qm((wb=M((bb=function(a){F(k,a);var r,l,s,u,c,h,p,y,v,g,m,b,w,S=x(k);function k(){var e;z(this,k);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=S.call.apply(S,[this].concat(n)),B(e,"cloud",wb,U(e)),B(e,"backgroundMask",Sb,U(e)),B(e,"masks",kb,U(e)),B(e,"tornado",Cb,U(e)),B(e,"clearParticleHolder",Eb,U(e)),B(e,"clearParticle1",Ab,U(e)),B(e,"clearParticle2",Tb,U(e)),B(e,"starParticle",Pb,U(e)),B(e,"confetti",Rb,U(e)),B(e,"itemEffect",Ob,U(e)),B(e,"hintSpriteFrame",Ib,U(e)),B(e,"thunderSpriteFrame",Lb,U(e)),B(e,"tornadoSpriteFrame",_b,U(e)),B(e,"pliersSpriteFrame",Db,U(e)),e.maskTargets=[],e.vibrate=null,e.gameShakeSignal=new i,B(e,"clearExplosionContainer",Mb,U(e)),e}return N(k,[{key:"__preload",value:function(){t.validateRequiredProperties(this,k)}},{key:"onLoad",value:function(){this.loadDefuseExplosionPool(),this.loadBombExplosionPool(),this.loadClearExplosionPool()}},{key:"update",value:function(){if(this.maskTargets.length>0)for(var e=0;e<this.maskTargets.length;e++){var t=this.maskTargets[e];if(!t.isHidden()){var n=this.masks[e];n&&n.setWorldPosition(t.node.worldPosition)}}}},{key:"onEnable",value:function(){this.node.scene.on(ta.GRID_RESIZE,this.handleBoardResize,this)}},{key:"onDisable",value:function(){this.node.scene.off(ta.GRID_RESIZE,this.handleBoardResize,this)}},{key:"handleBoardResize",value:function(e){this.clearParticleHolder.setScale(e,e),this.clearExplosionContainer.setScale(e,e)}},{key:"playClearEffectAt",value:function(e){var t=e[0],n=t.x,i=t.y,a=e[1],o=a.x,r=a.y,l=this.clearParticle1.node.worldPosition.z,s=this.clearParticle2.node.worldPosition.z;this.clearParticle1.node.setWorldPosition(n,i,l),this.clearParticle2.node.setWorldPosition(o,r,s),this.clearParticle1.play(),this.clearParticle2.play()}},{key:"playStarEffectAt",value:function(e){this.starParticle.fireShiningStarAt(e)}},{key:"playConfettiEffect",value:function(){var e,t=H(this.confetti);try{for(t.s();!(e=t.n()).done;){e.value.play()}}catch(e){t.e(e)}finally{t.f()}}},{key:"playTornadoAnimation",value:(w=W((function*(){n.setBlockInput(!0),this.tornado.active=!0,this.tornado.setScale(Ie.ZERO),yield e.runTweenAsync(ae(this.tornado).to(.5,{scale:Ie.ONE},{easing:"quadOut"}).to(.5,{scale:qb},{easing:"quadInOut"}).to(.5,{scale:Ie.ONE},{easing:"quadInOut"}).to(.5,{scale:Ie.ZERO},{easing:"quadInOut"})),this.tornado.active=!1,n.setBlockInput(!1)})),function(){return w.apply(this,arguments)})},{key:"playThunderAnimation",value:(b=W((function*(t,n){this.resetMasks();var i=Z(t,2),a=Z(i[0],2),o=a[0],r=a[1],l=Z(i[1],2),s=l[0],u=l[1];this.setMaskProperties(0,o.node.worldPosition,o.node.worldScale),this.setMaskProperties(1,r.node.worldPosition,r.node.worldScale),this.setMaskProperties(2,s.node.worldPosition,s.node.worldScale),this.setMaskProperties(3,u.node.worldPosition,u.node.worldScale),this.maskTargets=[o,r,s,u],yield this.setBackgroundMaskActive(!0),this.cloud.node.active=!0,yield this.cloud.playInitAnimation(),yield e.waitTweenAsync(.2);var c=[];c.push(this.performCloudEffectToTiles(o,r,n)),yield e.waitTweenAsync(.5),c.push(this.performCloudEffectToTiles(s,u,n)),yield Promise.all(c),this.cloud.node.active=!1,yield this.setBackgroundMaskActive(!1),this.maskTargets=[]})),function(e,t){return b.apply(this,arguments)})},{key:"playItemAddAnimation",value:(m=W((function*(t,n){var i=n.itemType;if(i){switch(yield e.waitTweenAsync(.2),this.itemEffect.node.active=!0,this.itemEffect.node.parent=Ne("Canvas"),this.itemEffect.node.worldPosition=t,this.itemEffect.node.scale=Ie.ONE,i){case d.HINT:this.itemEffect.sprite.spriteFrame=this.hintSpriteFrame;break;case d.THUNDER:this.itemEffect.sprite.spriteFrame=this.thunderSpriteFrame;break;case d.STORM:this.itemEffect.sprite.spriteFrame=this.tornadoSpriteFrame;break;case d.PLIERS:this.itemEffect.sprite.spriteFrame=this.pliersSpriteFrame}yield Lm(this.itemEffect,n),this.itemEffect.node.active=!1}})),function(e,t){return m.apply(this,arguments)})},{key:"playMultiThunderAnimation",value:(g=W((function*(t,n,i){this.resetMasks(),this.cloud.node.active=!0,yield this.cloud.playInitAnimation(),yield e.waitTweenAsync(.2),n.clear(t,i);for(var a=[],r=0,l=2*t.length;r<l;r++){var s=t[Math.floor(r/2)];if(void 0!==s){var u=s[r%2];void 0!==u&&(0!==r&&r%2==0&&(this.node.scene.emit(ta.ADD_COMBO),this.node.scene.emit(ta.ADD_SCORE)),this.shakeGame(),this.shakeScreen(500),o.playSound(vn.THUNDERBOLT),a.push(this.cloud.playLightningAnimation(u.node.worldPosition)),a.push(this.cloud.playScaleTween()),i&&(yield e.waitTweenAsync(i)))}}yield Promise.all(a),this.cloud.node.active=!1,yield this.setBackgroundMaskActive(!1)})),function(e,t,n){return g.apply(this,arguments)})},{key:"performCloudEffectToTiles",value:(v=W((function*(t,n,i,a){this.shakeGame(),this.shakeScreen(500),o.playSound(vn.THUNDERBOLT),i.clearUsingOldLightningFX([[t,n]]),this.node.scene.emit(ta.ADD_COMBO),this.node.scene.emit(ta.ADD_SCORE);var r=[];r.push(this.createClearExplosionAt(t.node.worldPosition)),r.push(this.cloud.playLightningAnimation(t.node.worldPosition)),r.push(this.cloud.playScaleTween()),a&&(yield e.waitTweenAsync(a)),r.push(this.cloud.playLightningAnimation(n.node.worldPosition)),yield Promise.all(r)})),function(e,t,n,i){return v.apply(this,arguments)})},{key:"shakeScreen",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:500;this.vibrate=null!==(e=this.vibrate)&&void 0!==e?e:this.node.getComponent(ys),null===(t=this.vibrate)||void 0===t||t.vibrate(n)}},{key:"loadDefuseExplosionPool",value:(y=W((function*(){if(this.defuseExplosionPool)return this.defuseExplosionPool;var e=yield n.loadPrefabAsync(f.BOMB_DEFUSE_PREFAB);if(null!==e)return this.defuseExplosionPool=function(e,t){return new cp((function(){var n=He(e),i=n.getComponent(Fe);if(!i)throw new Error("DefuseExplosion: No animation component found in bombDefuseExplosionPrefab");return t.addChild(n),n.active=!1,{node:n,animation:i}}),1,(function(e){e.node.active=!0}),(function(e){e.node.active=!1}),(function(e){e.node.destroy()}))}(e,this.node),this.defuseExplosionPool;this.reportOrThrowInDebugger("Failed to load prefab","createDefuseExplosionAt")})),function(){return y.apply(this,arguments)})},{key:"loadBombExplosionPool",value:(p=W((function*(){if(this.bombExplosionPool)return this.bombExplosionPool;var e=yield n.loadPrefabAsync(f.BOMB_EXPLODE_PREFAB);if(null!==e)return this.bombExplosionPool=function(e,t){return new cp((function(){var n=He(e),i=n.getComponent(Fe);if(!i)throw new Error("BombExplosion: No animation component found in bombExplosionPrefab");return t.addChild(n),n.active=!1,{node:n,animation:i}}),1,(function(e){e.node.active=!0}),(function(e){e.node.active=!1}),(function(e){e.node.destroy()}))}(e,this.node),this.bombExplosionPool;this.reportOrThrowInDebugger("Failed to load prefab","createBombExplosionAt")})),function(){return p.apply(this,arguments)})},{key:"loadClearExplosionPool",value:(h=W((function*(){if(this.clearExplosionPool)return this.clearExplosionPool;var e=yield n.loadPrefabAsync(f.CLEAR_EXPLOSION_PREFAB);if(null!==e)return this.clearExplosionPool=function(e,t){return new cp((function(){var n=He(e),i=n.getComponent(ee),a=n.getComponent(Fe);if(!i||!a)throw new Error("ClearExplosion: Invalid prefab");return t.addChild(n),n.active=!1,{node:n,uiTransform:i,animation:a}}),2,(function(e){e.node.active=!0}),(function(e){e.node.active=!1}),(function(e){e.node.destroy()}))}(e,this.clearExplosionContainer),this.clearExplosionPool;this.reportOrThrowInDebugger("Failed to load prefab","createClearExplosionAt")})),function(){return h.apply(this,arguments)})},{key:"createDefuseExplosionAt",value:(c=W((function*(t,n){var i=yield this.loadDefuseExplosionPool();if(i){var a=i.alloc(),o=a.node,r=a.animation;o.setWorldPosition(t,n,0),yield e.runAnimationAsync(r),i.free(a)}})),function(e,t){return c.apply(this,arguments)})},{key:"createBombExplosionAt",value:(u=W((function*(t){var n=yield this.loadBombExplosionPool();if(n){var i=n.alloc(),a=i.node,o=i.animation;a.setWorldPosition(t),yield e.runAnimationAsync(o),n.free(i)}})),function(e){return u.apply(this,arguments)})},{key:"createClearExplosionAt",value:(s=W((function*(t){var n=yield this.loadClearExplosionPool();if(n){var i=n.alloc(),a=i.node,o=i.animation;a.setWorldPosition(t),yield e.runAnimationAsync(o),n.free(i)}})),function(e){return s.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(l=W((function*(e){e&&(this.backgroundMask.node.active=!0),yield this.backgroundMask.changeStateFade(e,.25),e||(this.backgroundMask.node.active=!1)})),function(e){return l.apply(this,arguments)})},{key:"resetMasks",value:function(){var e,t=H(this.masks);try{for(t.s();!(e=t.n()).done;){e.value.worldPosition=new Ie(-9999,-9999,0)}}catch(e){t.e(e)}finally{t.f()}}},{key:"setMaskProperties",value:function(e,t,n){var i=this.masks[e];i&&(n&&(i.worldScale=n),i.worldPosition=t)}},{key:"shakeGame",value:(r=W((function*(){var t=this;this.gameShakeSignal.abort();var n=new i;this.gameShakeSignal=n;var a=this.node.position.clone(),o=Ge(-10,10),r=Ge(-10,10),l=a.clone().add3f(o,r,0),s=a.clone().add3f(-o,-r,0),u=ae(this.node).to(.05,{position:l}).to(.05,{position:s}).to(.05,{position:a});n.addAbortListener((function(){t.node.setPosition(a)})),yield e.runTweenAsync(u,n)})),function(){return r.apply(this,arguments)})},{key:"reportOrThrowInDebugger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unknown error thrown",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Board",n=new Error("".concat(t,": ").concat(e));if(Ub.isDebugger())throw n;null==Vb||Vb.sendException(n)}}]),k}(ce)).prototype,"cloud",[Wm,Km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sb=M(bb.prototype,"backgroundMask",[jm,Ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kb=M(bb.prototype,"masks",[Xm,Zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cb=M(bb.prototype,"tornado",[Jm,Qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eb=M(bb.prototype,"clearParticleHolder",[$m,eb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ab=M(bb.prototype,"clearParticle1",[tb,nb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tb=M(bb.prototype,"clearParticle2",[ib,ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pb=M(bb.prototype,"starParticle",[ob,rb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rb=M(bb.prototype,"confetti",[lb,sb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ob=M(bb.prototype,"itemEffect",[ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ib=M(bb.prototype,"hintSpriteFrame",[cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lb=M(bb.prototype,"thunderSpriteFrame",[hb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_b=M(bb.prototype,"tornadoSpriteFrame",[pb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Db=M(bb.prototype,"pliersSpriteFrame",[db],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mb=M(bb.prototype,"clearExplosionContainer",[yb,fb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(bb.prototype,"shakeScreen",[vb],Object.getOwnPropertyDescriptor(bb.prototype,"shakeScreen"),bb.prototype),M(bb.prototype,"shakeGame",[gb],Object.getOwnPropertyDescriptor(bb.prototype,"shakeGame"),bb.prototype),mb=bb))||mb);Q._RF.pop(),Q._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var Kb="newbie",jb="timer",Yb="combo",Xb="hint-item",Zb="thunder-item",Jb="storm-item",Qb="pliers-item";Q._RF.pop(),Q._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var $b=function(){function e(t){var n=this;z(this,e),this.alignSkipButton=function(){var e=n.gameplay.board,t=n.manager.guideUi.guideSkipButton;if(t){var i=t.parent;if(i){var o=e.getBoundingBoxWorld(),r=o.yMax,l=o.xMax,s=a.cssSizeToWorldSize(a.getScreenHeightCss()),u=l-i.getComponent(ee).width/2,c=Math.min(r+100,r+(s-r)/2);i.setWorldPosition(u,c,0)}}},this.manager=t,this.gameplay=t.gameplay}var t,n;return N(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(ta.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(ta.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.on(ta.GRID_RESIZE,this.handleViewResized,this),this.manager.guideUi.guideSkipButton.on(ee.EventType.SIZE_CHANGED,this.alignSkipButton,this),this.showStep(this.currentStep),this.manager.node.scene.emit(ta.HIDE_UI)}},{key:"showNextStep",value:function(){this.currentStep+1<Bc.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(n=W((function*(e){var t=this.gameplay,n=t.board,i=t.effectManager,a=Bc[e].startTile,o=Bc[e].endTile,r=n.getTileAt(a.x,a.y),l=n.getTileAt(o.x,o.y);if(r&&l){var s=r.node.worldPosition,u=l.node.worldPosition;i.resetMasks(),i.setMaskProperties(0,s,r.node.worldScale),i.setMaskProperties(1,u,l.node.worldScale),i.setBackgroundMaskActive(!0);var c=this.manager.guideUi,h=c.guideHand,p=c.guideTextBox,d=c.guideSkipButton;h.node.active=!0,d.active=!0,h.playHandAnimation(s,u),this.alignGuideTextBox(),this.alignSkipButton(),yield p.hide(),p.setLocalizedText(Bc[e].localeTextKey),yield p.show(),n.setIgnoreInput(!0),r.setIgnoreInput(!1),l.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1)}})),function(e){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.gameplay,t=e.board,n=e.effectManager,i=Bc[this.currentStep].startTile,a=Bc[this.currentStep].endTile,o=t.getTileAt(i.x,i.y),r=t.getTileAt(a.x,a.y);if(o&&r){var l=o.node.worldPosition,s=r.node.worldPosition;n.setMaskProperties(0,l,o.node.worldScale),n.setMaskProperties(1,s,r.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}}},{key:"alignGuideTextBox",value:function(){var e=this.gameplay.board,t=this.manager.guideUi.guideTextBox,n=e.getBoundingBoxWorld(),i=n.width,a=n.yMin,o=t.widget.bottom+(a-t.widget.bottom)/2;t.node.setWorldPosition(t.node.worldPosition.x,o,0);var r=Math.max(Math.min(223,.85*(a-t.widget.bottom)),10);t.uiTransform.setContentSize(i,r)}},{key:"close",value:(t=W((function*(){var e=this.gameplay,t=e.board,n=e.effectManager;this.manager.node.scene.off(ta.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(ta.GRID_MATCH_FAIL,this.showNextStep,this),this.manager.node.scene.off(ta.GRID_RESIZE,this.handleViewResized,this),this.manager.guideUi.guideSkipButton.off(ee.EventType.SIZE_CHANGED,this.alignSkipButton,this),t.setIgnoreInput(!1),yield Promise.all([this.manager.guideUi.guideTextBox.hide(),n.setBackgroundMaskActive(!1)]),this.manager.guideUi.guideHand.node.active=!1,this.manager.completeGuide(Kb)})),function(){return t.apply(this,arguments)})}]),e}();Q._RF.pop(),Q._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var ew=function(){function e(t){z(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return N(e,[{key:"setup",value:(n=W((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer,a=this.gameplay.uiManager.currentLayout.clock,o=a.getComponent(ee).contentSize,r=o.width,s=o.height,u=a.node.worldPosition;r*=1.5,s*=1.5,yield this.gameplay.handleShowUI(),t.node.active=!0,t.setOtherMaskTransform(u.x,u.y,r,s),n.node.active=!0,i.key="guide.timer",n.node.setWorldPosition(u.x,u.y-s/2-50,0),n.horizontalAlign=tt.CENTER,n.getComponent(ee).setAnchorPoint(.5,.5),yield t.show(),this.manager.node.scene.once(ta.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(ta.PAUSE_TIME),be.on(l.VIEW_RESIZED,this.handleViewResized,this),be.on(l.ORIENTATION_CHANGED,this.handleViewResized,this)})),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.uiManager.currentLayout.clock,a=i.getComponent(ee).contentSize,o=a.width,r=a.height,l=i.node.worldPosition;o*=1.5,r*=1.5,t.setOtherMaskTransform(l.x,l.y,o,r),n.node.setWorldPosition(l.x,l.y-r/2-50,0)}},{key:"close",value:(t=W((function*(){var e=this.manager.guideUi,t=e.guideInfoText,n=e.guideMasks;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(ta.RESUME_TIME),yield n.hide(),t.node.active=!1,this.manager.completeGuide(jb),this.unlistenEvents()})),function(){return t.apply(this,arguments)})},{key:"unlistenEvents",value:function(){be.off(l.VIEW_RESIZED,this.handleViewResized,this),be.off(l.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();Q._RF.pop(),Q._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var tw=function(){function e(t){z(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return N(e,[{key:"setup",value:(n=W((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer,a=this.gameplay.uiManager.comboContainer,o=a.getComponent(ee).contentSize,r=o.width,s=o.height,u=a.node.worldPosition;r*=1.5,s*=1.5,t.node.active=!0,t.setOtherMaskTransform(u.x,u.y,r,s),n.node.active=!0,i.key="guide.combo",n.node.setWorldPosition(u.x-r/2-10,u.y,0),n.horizontalAlign=tt.RIGHT,n.getComponent(ee).setAnchorPoint(1,.5),yield t.show(),this.manager.node.scene.once(ta.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(ta.PAUSE_TIME),be.on(l.VIEW_RESIZED,this.handleViewResized,this),be.on(l.ORIENTATION_CHANGED,this.handleViewResized,this)})),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=this.gameplay.uiManager.comboContainer,a=i.getComponent(ee).contentSize,o=a.width,r=a.height,l=i.node.worldPosition;o*=1.5,r*=1.5,t.setOtherMaskTransform(l.x,l.y,o,r),n.node.setWorldPosition(l.x-o/2-10,l.y,0)}},{key:"close",value:(t=W((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText;this.manager.node.scene.emit(ta.RESUME_TIME),t.node.off(ge.EventType.TOUCH_START,this.close,this),yield t.hide(),n.node.active=!1,this.manager.completeGuide(Yb),this.unlistenEvents()})),function(){return t.apply(this,arguments)})},{key:"unlistenEvents",value:function(){be.off(l.VIEW_RESIZED,this.handleViewResized,this),be.off(l.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();Q._RF.pop(),Q._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var nw=GameCore.Utils.Array,iw=function(){function e(t){z(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return N(e,[{key:"setup",value:(n=W((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer,a=nw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.HINT}));if(a){var o=a.node.worldPosition,r=a.getComponent(ee).contentSize,s=r.width,u=r.height;s+=40,u+=40,t.node.active=!0,t.setItemMaskTransform(o.x,o.y,s,u),n.node.active=!0,i.key="guide.hint",n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,o.y+u/2+30,0),n.horizontalAlign=tt.CENTER,n.getComponent(ee).setAnchorPoint(.5,.5),yield t.show(),this.manager.node.scene.once(ta.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(ta.PAUSE_TIME),be.on(l.VIEW_RESIZED,this.handleViewResized,this),be.on(l.ORIENTATION_CHANGED,this.handleViewResized,this)}})),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=nw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.HINT}));if(i){var a=i.node.worldPosition,o=i.getComponent(ee).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=W((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText;this.manager.node.scene.emit(ta.RESUME_TIME),yield t.hide(),n.node.active=!1,this.manager.completeGuide(Xb),this.unlistenEvents()})),function(){return t.apply(this,arguments)})},{key:"unlistenEvents",value:function(){be.off(l.VIEW_RESIZED,this.handleViewResized,this),be.off(l.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();Q._RF.pop(),Q._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var aw=GameCore.Utils.Array,ow=function(){function e(t){z(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return N(e,[{key:"setup",value:(n=W((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer,a=aw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.THUNDER}));if(a){var o=a.node.worldPosition,r=a.getComponent(ee).contentSize,s=r.width,u=r.height;s+=40,u+=40,t.node.active=!0,t.setItemMaskTransform(o.x,o.y,s,u),n.node.active=!0,i.key="guide.thunder",n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,o.y+u/2+30,0),n.horizontalAlign=tt.CENTER,n.getComponent(ee).setAnchorPoint(.5,.5),yield t.show(),this.manager.node.scene.once(ta.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(ta.PAUSE_TIME),be.on(l.VIEW_RESIZED,this.handleViewResized,this),be.on(l.ORIENTATION_CHANGED,this.handleViewResized,this)}})),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=aw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.THUNDER}));if(i){var a=i.node.worldPosition,o=i.getComponent(ee).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=W((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText;this.manager.node.scene.emit(ta.RESUME_TIME),yield t.hide(),n.node.active=!1,this.manager.completeGuide(Zb),this.unlistenEvents()})),function(){return t.apply(this,arguments)})},{key:"unlistenEvents",value:function(){be.off(l.VIEW_RESIZED,this.handleViewResized,this),be.off(l.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();Q._RF.pop(),Q._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var rw=GameCore.Utils.Array,lw=function(){function e(t){z(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return N(e,[{key:"setup",value:(n=W((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer,a=rw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.STORM}));if(a){var o=a.node.worldPosition,r=a.getComponent(ee).contentSize,s=r.width,u=r.height;s+=40,u+=40,t.node.active=!0,t.setItemMaskTransform(o.x,o.y,s,u),n.node.active=!0,i.key="guide.storm",n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,o.y+u/2+30,0),n.horizontalAlign=tt.CENTER,n.getComponent(ee).setAnchorPoint(.5,.5),yield t.show(),this.manager.node.scene.once(ta.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(ta.PAUSE_TIME),be.on(l.VIEW_RESIZED,this.handleViewResized,this),be.on(l.ORIENTATION_CHANGED,this.handleViewResized,this)}})),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=rw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.STORM}));if(i){var a=i.node.worldPosition,o=i.getComponent(ee).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=W((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText;this.manager.node.scene.emit(ta.RESUME_TIME),yield t.hide(),n.node.active=!1,this.manager.completeGuide(Jb),this.unlistenEvents()})),function(){return t.apply(this,arguments)})},{key:"unlistenEvents",value:function(){be.off(l.VIEW_RESIZED,this.handleViewResized,this),be.off(l.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();Q._RF.pop(),Q._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var sw,uw,cw,hw,pw,dw,yw,fw,vw,gw=GameCore.Utils.Array,mw=function(){function e(t){z(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return N(e,[{key:"setup",value:(n=W((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=e.guideInfoTextLocalizer,a=gw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.PLIERS}));if(a){var o=a.node.worldPosition,r=a.getComponent(ee).contentSize,s=r.width,u=r.height;s+=40,u+=40,t.node.active=!0,t.setItemMaskTransform(o.x,o.y,s,u),n.node.active=!0,i.key="guide.pliers",n.node.setPosition(0,0),n.node.setWorldPosition(n.node.worldPosition.x,o.y+u/2+30,0),n.horizontalAlign=tt.CENTER,n.getComponent(ee).setAnchorPoint(.5,.5),yield t.show(),this.manager.node.scene.once(ta.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(ta.PAUSE_TIME),be.on(l.VIEW_RESIZED,this.handleViewResized,this),be.on(l.ORIENTATION_CHANGED,this.handleViewResized,this)}})),function(){return n.apply(this,arguments)})},{key:"handleViewResized",value:function(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText,i=gw.search(this.gameplay.uiManager.items,(function(e){return e.itemType===d.PLIERS}));if(i){var a=i.node.worldPosition,o=i.getComponent(ee).contentSize,r=o.width,l=o.height;r+=40,l+=40,t.setItemMaskTransform(a.x,a.y,r,l),n.node.setWorldPosition(n.node.worldPosition.x,a.y+l/2+30,0)}}},{key:"close",value:(t=W((function*(){var e=this.manager.guideUi,t=e.guideMasks,n=e.guideInfoText;this.manager.node.scene.emit(ta.RESUME_TIME),yield t.hide(),n.node.active=!1,this.manager.completeGuide(Qb),this.unlistenEvents()})),function(){return t.apply(this,arguments)})},{key:"unlistenEvents",value:function(){be.off(l.VIEW_RESIZED,this.handleViewResized,this),be.off(l.ORIENTATION_CHANGED,this.handleViewResized,this)}}]),e}();Q._RF.pop(),Q._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var bw,ww,Sw,kw,Cw,Ew,Aw,Tw=$.ccclass,Pw=$.property,Rw=(sw=Tw("GuideHand"),uw=Pw(ge),cw=Pw(ge),hw=Pw(he),sw((yw=M((dw=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"hand",yw,U(e)),B(e,"circleHighlight",fw,U(e)),B(e,"circleHighlightOpacity",vw,U(e)),e}return N(n,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(e,t){var n=this;this.handTween&&this.handTween.stop();var i=ae(this.hand).to(.8,{worldPosition:t},{easing:"quartOut"}).to(.2,{scale:new Ie(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:Ie.ONE,angle:0}).to(.8,{worldPosition:e},{easing:"quartOut"}).to(.2,{scale:new Ie(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:Ie.ONE,angle:0});this.handTween=ae(this.hand).repeatForever(i).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),ae(this.circleHighlight).to(.6,{scale:new Ie(1.5,1.5)},{easing:"quadOut"}).start(),ae(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(ce)).prototype,"hand",[uw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fw=M(dw.prototype,"circleHighlight",[cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vw=M(dw.prototype,"circleHighlightOpacity",[hw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pw=dw))||pw);Q._RF.pop(),Q._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var Ow,Iw,Lw,_w,Dw,Mw,Nw=$.ccclass,zw=$.property,Bw=(bw=Nw("GameMask"),ww=zw(ee),Sw=zw(le),bw((Ew=M((Cw=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"uiTransform",Ew,U(e)),B(e,"sprite",Aw,U(e)),e}return N(n,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),n}(ce)).prototype,"uiTransform",[ww],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aw=M(Cw.prototype,"sprite",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kw=Cw))||kw);Q._RF.pop(),Q._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var Fw,xw,Uw,Gw,Hw,Vw,qw,Ww=$.ccclass,Kw=$.property,jw=$.executeInEditMode,Yw=(Ow=Ww("AlphaMasks"),Iw=jw(!0),Lw=Kw(Bw),Ow(_w=Iw((Mw=M((Dw=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"masks",Mw,U(e)),e}return N(n,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent(ee)}},{key:"start",value:function(){this.material=this.getComponent(le).getMaterialInstance(0)}},{key:"update",value:function(){var e=this,t=this.UITransform,n=t.width,i=t.height;this.masks.forEach((function(t,a){var o=t.uiTransform,r=o.width,l=o.height,s=o.anchorX,u=o.anchorY,c=r*t.node.scale.x,h=l*t.node.scale.y,p=new Oe(c/n,h/i),d=new Oe(.5+(.5-s)*p.x,.5-(.5-u)*p.y),y=new Oe(d.x+(t.node.worldPosition.x-e.node.worldPosition.x)/n,d.y-(t.node.worldPosition.y-e.node.worldPosition.y)/i);e.material.setProperty("mask".concat(a,"Texture"),t.texture),e.material.setProperty("ratio".concat(a),p),e.material.setProperty("center".concat(a),y)}))}},{key:"setMaskActive",value:function(e,t){e>=this.masks.length||this.material.setProperty("useMask".concat(e),t?1:0)}}]),n}(ce)).prototype,"masks",[Lw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_w=Dw))||_w)||_w);Q._RF.pop(),Q._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var Xw,Zw,Jw,Qw,$w,eS,tS,nS,iS,aS,oS,rS,lS,sS,uS,cS,hS,pS,dS=$.ccclass,yS=$.property,fS=(Fw=dS("GuideMasks"),xw=yS(mi),Uw=yS(Yw),Fw((Vw=M((Hw=function(e){F(o,e);var n,i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"background",Vw,U(e)),B(e,"alphaMasks",qw,U(e)),e}return N(o,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"show",value:(i=W((function*(){this.background.node.active=!0,yield this.background.changeStateFade(!0,.25)})),function(){return i.apply(this,arguments)})},{key:"hide",value:(n=W((function*(){yield this.background.changeStateFade(!1,.25),this.background.node.active=!1})),function(){return n.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(ta.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[1].node.worldPosition=new Ie(-9999,-9999,0);var a=this.alphaMasks.masks[0];this.setMaskTransform(a,e,t,n,i)}},{key:"setItemMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[0].node.worldPosition=new Ie(-9999,-9999,0);var a=this.alphaMasks.masks[1];this.setMaskTransform(a,e,t,n,i)}},{key:"setMaskTransform",value:function(e,t,n,i,a){e.uiTransform.setContentSize(i,a),e.node.setWorldPosition(t,n,0)}}]),o}(ce)).prototype,"background",[xw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qw=M(Hw.prototype,"alphaMasks",[Uw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gw=Hw))||Gw);Q._RF.pop(),Q._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var vS,gS,mS,bS,wS,SS,kS,CS,ES,AS,TS,PS,RS,OS,IS,LS,_S,DS,MS,NS,zS,BS=$.ccclass,FS=$.property,xS=(Xw=BS("GuideTextBox"),Zw=t.required(),Jw=FS(Se),Qw=t.required(),$w=FS(ie),eS=t.required(),tS=FS(ee),nS=t.required(),iS=FS(mi),aS=t.required(),oS=FS(p),Xw((sS=M((lS=function(e){F(o,e);var n,i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"guideText",sS,U(e)),B(e,"widget",uS,U(e)),B(e,"uiTransform",cS,U(e)),B(e,"opacityToggler",hS,U(e)),B(e,"localizer",pS,U(e)),e}return N(o,[{key:"__preload",value:function(){t.validateRequiredProperties(this)}},{key:"setLocalizedText",value:function(e){this.localizer.key=e}},{key:"show",value:(i=W((function*(){yield this.opacityToggler.changeStateFade(!0)})),function(){return i.apply(this,arguments)})},{key:"hide",value:(n=W((function*(){yield this.opacityToggler.changeStateFade(!1)})),function(){return n.apply(this,arguments)})}]),o}(ce)).prototype,"guideText",[Zw,Jw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uS=M(lS.prototype,"widget",[Qw,$w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cS=M(lS.prototype,"uiTransform",[eS,tS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hS=M(lS.prototype,"opacityToggler",[nS,iS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pS=M(lS.prototype,"localizer",[aS,oS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rS=lS))||rS);Q._RF.pop(),Q._RF.push({},"a2522Y5Q6JGSr90yCp/4qCm","GuideUI",void 0);var US,GS,HS,VS,qS,WS=$.ccclass,KS=$.property,jS=(vS=WS("GuideUI"),gS=t.required(),mS=KS(Rw),bS=t.required(),wS=KS(xS),SS=t.required(),kS=KS(Se),CS=t.required(),ES=KS(p),AS=t.required(),TS=KS(fS),PS=t.required(),RS=KS(ge),vS((LS=M((IS=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"guideHand",LS,U(e)),B(e,"guideTextBox",_S,U(e)),B(e,"guideInfoText",DS,U(e)),B(e,"guideInfoTextLocalizer",MS,U(e)),B(e,"guideMasks",NS,U(e)),B(e,"guideSkipButton",zS,U(e)),e}return N(i,[{key:"__preload",value:function(){t.validateRequiredProperties(this)}}]),i}(ce)).prototype,"guideHand",[gS,mS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_S=M(IS.prototype,"guideTextBox",[bS,wS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DS=M(IS.prototype,"guideInfoText",[SS,kS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MS=M(IS.prototype,"guideInfoTextLocalizer",[CS,ES],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NS=M(IS.prototype,"guideMasks",[AS,TS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zS=M(IS.prototype,"guideSkipButton",[PS,RS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OS=IS))||OS);Q._RF.pop(),Q._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var YS=game,XS=YS.player,ZS=YS.analytics,JS=$.ccclass,QS=$.property,$S=GameCore,ek=$S.Match.Modes,tk=$S.Plugins.Analytics.Events,nk=$S.Utils.Array,ik=new Oe(0,10),ak=new Oe(0,10),ok="READY",rk="RUNNING",lk=(US=JS("GuidelinesManager"),GS=QS(jS),US((qS=M((VS=function(e){F(i,e);var t,n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"guideUi",qS,U(e)),e.guideHintDelay=null,e.guideStormDelay=null,e}return N(i,[{key:"init",value:function(e){this.gameplay=e,this.status=ok,this.node.scene.on(ta.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(ta.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(ta.USE_ITEM,this.handleUseItem,this),this.node.scene.on(ta.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(ta.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(ta.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(Kb)&&this.resetGuideItemShowed(),this.startGuide(Kb)):this.startGuide(jb)}},{key:"startGuide",value:function(e){if(this.status===rk)return!1;if(this.hasGuideItemShowed(e))return!1;switch(this.addGuideItemShowed(e),this.status=rk,e){case Kb:ZS.event(tk.TUTORIAL_BEGIN),this.guide1=new $b(this),this.guide1.setup();break;case jb:this.guide2=new ew(this),this.guide2.setup();break;case Yb:this.guide3=new tw(this),this.guide3.setup();break;case Xb:this.guide4=new iw(this),this.guide4.setup();break;case Zb:this.guide5=new ow(this),this.guide5.setup();break;case Jb:this.guide6=new lw(this),this.guide6.setup();break;case Qb:this.guide7=new mw(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(e){ZS.event(tk.TUTORIAL_STEP,{step:e}),this.status=ok,this.addGuideItemShowed(e),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){var e=this.getCurrentLevel(),t=ik.x,n=ik.y;return e>=t&&e<=n}},{key:"isShowErrorPathLevel",value:function(){if(Zs.getMatchMode()===ek.TOURNAMENT)return!1;var e=this.getCurrentLevel(),t=ak.x,n=ak.y;return e>=t&&e<=n}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(e){return nk.has(this.getGuideItemShowed(),e)}},{key:"addGuideItemShowed",value:function(e){if(!this.hasGuideItemShowed(e)){var t=this.getGuideItemShowed();t.push(e),XS.setGameData({guideItemShowed:t})}}},{key:"resetGuideItemShowed",value:function(){XS.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var e,t;return null!==(e=null===(t=XS.getGameData())||void 0===t?void 0:t.guideItemShowed)&&void 0!==e?e:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(e){this.isNewbieGuideLevel()||e<2||(this.startGuide(Yb),this.node.scene.off(ta.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var e=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=ae(this.node).delay(5).call((function(){e.isNewbieGuideLevel()||(e.hasGuideItemShowed(Xb)&&e.status===ok?e.node.scene.emit(ta.SHOW_HINT):e.startGuide(Xb),e.startHintGuide())}))),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var e=this;null===this.guideStormDelay&&(this.guideStormDelay=new nt(this.node).delay(10).call((function(){e.isNewbieGuideLevel()||e.hasGuideItemShowed(Jb)||e.gameplay.itemManager.canUseItem(d.STORM)&&(e.startGuide(Jb)||e.startStormGuide())}))),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(Zb)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(Qb)}},{key:"handleUseItem",value:function(e){switch(this.startAutoGuides(),e){case d.HINT:this.addGuideItemShowed(Xb);break;case d.THUNDER:this.addGuideItemShowed(Zb);break;case d.STORM:this.addGuideItemShowed(Jb);break;case d.PLIERS:this.addGuideItemShowed(Qb)}}},{key:"skipNewbieGuide",value:(t=W((function*(){this.guideUi.guideSkipButton.active=!1,yield this.guide1.close();var e=this.getCurrentLevel()+1;XS.setGameData({level:e}),this.node.scene.emit(ta.NEXT_LEVEL)})),function(){return t.apply(this,arguments)})},{key:"onDestroy",value:function(){var e,t,n,i,a,o;null===(e=this.guide2)||void 0===e||e.unlistenEvents(),null===(t=this.guide3)||void 0===t||t.unlistenEvents(),null===(n=this.guide4)||void 0===n||n.unlistenEvents(),null===(i=this.guide5)||void 0===i||i.unlistenEvents(),null===(a=this.guide6)||void 0===a||a.unlistenEvents(),null===(o=this.guide7)||void 0===o||o.unlistenEvents()}}]),i}(ce)).prototype,"guideUi",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HS=VS))||HS);Q._RF.pop(),Q._RF.push({},"aa973zMvtZFD6GO7rUb6TBF","canUseHintItem",void 0);Q._RF.pop(),Q._RF.push({},"f3464SQfFhIs5PVRx8JpCO1","canUsePliersItem",void 0);Q._RF.pop(),Q._RF.push({},"ad5b3eazZ1B3YR8JJm+qvM6","canUseThunderItem",void 0);Q._RF.pop(),Q._RF.push({},"3b5b1bQTVlDaaFOGKDB5VZk","canUseTornadoItem",void 0);var sk,uk;Q._RF.pop(),Q._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var ck=$.ccclass,hk=globalThis.game.player,pk=(Y(sk={},d.HINT,{canActivate:!1,quantity:0}),Y(sk,d.THUNDER,{canActivate:!1,quantity:0}),Y(sk,d.STORM,{canActivate:!1,quantity:0}),Y(sk,d.PLIERS,{canActivate:!1,quantity:0}),sk),dk=ck("ItemManager")(uk=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).itemConfigs=pk,e}return N(n,[{key:"onLoad",value:function(){this.node.scene.on(ta.GRID_CREATE,this.updateItemsConfig,this),this.node.scene.on(ta.GRID_MATCH,this.updateItemsConfig,this),this.node.scene.on(ta.GRID_CLEAR,this.updateItemsConfig,this),this.node.scene.on(ta.GRID_SPAWN,this.updateItemsConfig,this),this.node.scene.on(ta.BOMB_EXPLODE,this.updateItemsConfig,this),this.node.scene.on(ta.REFRESH_ITEMS,this.updateItemsConfig,this)}},{key:"init",value:function(e){this.game=e}},{key:"getQuantity",value:function(e){return this.itemConfigs[e].quantity}},{key:"setQuantity",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Math.max(0,t);this.itemConfigs[e].quantity=i,this.saveQuantity(e,t),this.updateItemConfig(e,n)}},{key:"saveQuantity",value:function(e,t){var n=hk.getGameData();n&&hk.setGameData({items:G(G({},n.items),{},Y({},e,t))})}},{key:"canUseItem",value:function(e){var t=this.game,n=t.board,i=t.pathDraw;switch(e){case d.HINT:return function(e,t){return e.getUncleared().length>0&&!1===t.isDrawingHint}(n,i);case d.PLIERS:return function(e){return e.getBombTiles().length>0}(n);case d.STORM:return function(e){return e.getUncleared().length>4}(n);case d.THUNDER:return function(e){return e.getUncleared().length>=4}(n);default:return!1}}},{key:"updateItemsConfig",value:function(){var e=hk.getGameData();if(e){for(var t=0,n=Object.keys(this.itemConfigs);t<n.length;t++){var i=n[t],a=this.itemConfigs[i];a.canActivate=this.canUseItem(i),a.quantity=e.items[i]||0}this.game.uiManager.currentLayout.updateStatus({items:this.itemConfigs})}}},{key:"updateItemConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=hk.getGameData();n&&(this.itemConfigs[e].canActivate=this.canUseItem(e),this.itemConfigs[e].quantity=n.items[e]||0,this.game.uiManager.currentLayout.updateStatus(G({items:G(G({},this.itemConfigs),{},Y({},e,G({animate:t},this.itemConfigs[e])))},this.game.uiManager.config)))}}]),n}(ce))||uk;Q._RF.pop(),Q._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);var yk={CAKES:"cakes",CAR:"car",COSMETIC:"cosmetics",FLOWER:"flower",FRUIT:"fruit",ICE_CREAM:"ice-cream",SPORT:"sport",TOOL:"tool"};Q._RF.pop(),Q._RF.push({},"5c321EpuONCAq5BAh+AQCcd","RandomizedLevelDataConfig",void 0);var fk=5,vk=[90,200],gk=[6,30],mk={bombRange:[1,8],rocketRange:[0,2]},bk={maxSpaceOfPairRange:[2,10],addRandomTilesPerMoveRange:[0,8]},wk=[5,7],Sk=[6,12];Q._RF.pop(),Q._RF.push({},"4e7344vPB1EoI9uMkZu5Zd0","createRandomizedLevelData",void 0);var kk,Ck,Ek=function(e,t){return function(n){return n<=0?[e,t]:n>=1?[t,t]:[Math.floor(e+n*(t-e)),t]}},Ak=function(e,t){var n=Math.ceil(e),i=Math.floor(t);return Math.floor(Math.random()*(i-n+1))+n},Tk=function(e){return function(t){return Ak.apply(void 0,j(e(t)))}},Pk={generateDifficulty:(kk=fk,function(e){return kk<=1?0:(e-1)%kk/(kk-1)}),generateTime:Tk(function(e,t){var n=Ek(t,e);return function(e){return n(e)}}.apply(void 0,j(vk))),generateColors:Tk(Ek.apply(void 0,j(gk))),specials:{generateBomb:Tk(Ek.apply(void 0,j(mk.bombRange))),generateRocket:Tk(Ek.apply(void 0,j(mk.rocketRange)))},rules:{generateMaxSpaceOfPair:Tk(Ek.apply(void 0,j(bk.maxSpaceOfPairRange))),generateAddRandomTilesPerMove:Tk(Ek.apply(void 0,j(bk.addRandomTilesPerMoveRange)))},generateColumns:Tk(Ek.apply(void 0,j(wk))),generateRows:Tk(Ek.apply(void 0,j(Sk)))};Q._RF.pop(),Q._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var Rk,Ok=$.ccclass,Ik=GameCore.Utils,Lk=Ik.Device,_k=Ik.Array,Dk=globalThis.game.monitorError,Mk=Object.values(yk),Nk={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},zk=function(){var e={};return function(t){if(e[t])return e[t];var n=function(e){var t=Pk.generateDifficulty(e),n=Pk.generateColumns(t),i=Pk.generateRows(t);return{rows:n%2==1&&i%2==1?i+1:i,columns:n,colors:Pk.generateColors(t),gravity:Math.random()>.75?"normal":Math.random()>.5?su[Math.floor(Math.random()*su.length)]:[uu[Math.floor(Math.random()*uu.length)],cu[Math.floor(Math.random()*cu.length)]].join("-"),rules:{addRandomTilesPerMove:Pk.rules.generateAddRandomTilesPerMove(t),maxSpaceOfPair:Pk.rules.generateMaxSpaceOfPair(t)},specials:{bomb:Pk.specials.generateBomb(t),rocket:Pk.specials.generateRocket(t)},time:Pk.generateTime(t)}}(t);return e[t]={level:t,theme:Mk,rows:n.rows,columns:n.columns,colors:n.colors,mode:n.gravity,rules:{maxSpaceOfPair:n.rules.maxSpaceOfPair,addRandomTilesPerMove:n.rules.addRandomTilesPerMove},specials:{bomb:n.specials.bomb,rocket:n.specials.rocket},time:n.time},e[t]}},Bk=Ok("LevelManager")(Ck=function(e){F(l,e);var t,i,a,o,r=x(l);function l(){var e;z(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=r.call.apply(r,[this].concat(n))).getRandomizedLevelData=zk(),e}return N(l,[{key:"loadLevel",value:(o=W((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,n=yield this.loadLevelData(e);this.levelData=n||this.levelData||Nk;var i=this.levelData,a=i.rows,o=i.columns;return Lk.isMobile()&&o>=6&&a>=10&&(this.levelData.columns=5,this.levelData.rows=10),null==Dk||Dk.addMetadata({level:e}),this.getLevelSpriteFrames(e,t)})),function(){return o.apply(this,arguments)})},{key:"loadLevelData",value:(a=W((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(e>=g)return this.getRandomizedLevelData(e);var t=10,i=this.paddingZero("".concat(Math.floor(e/t)+1),3),a=e%t,o=yield n.loadJsonAsync("".concat(f.LEVEL_DATA_FOLDER,"/").concat(i));return o?o[a]:null})),function(){return a.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"getLevelSpriteFrames",value:(i=W((function*(e,t){if(t&&Te.random()<=.5){var n=Ns.getThemeSkins(t),i=n[Te.randomRangeInt(0,n.length)];return yield this.loadSkinFrames(i)}var a=Ns.getLevelSkins(e);if(0===a.length)throw new Error("No skins found for level ".concat(e));if(a.length>1)return yield this.loadSkinFrames(a);var o=a[0],r=Ns.getUnlockedSkins();if(r.length>1&&Te.random()<=.5){var l=r.filter((function(e){return e!==o}));o=l[Te.randomRangeInt(0,l.length)]}return yield this.loadSkinFrames(o)})),function(e,t){return i.apply(this,arguments)})},{key:"loadSkinFrames",value:(t=W((function*(e){if(Array.isArray(e)){var t=e.map(function(){var e=W((function*(e){var t="".concat(f.TILE_SKIN_FOLDER,"/").concat(e);return yield n.loadSpriteFramesDirAsync(t)}));return function(t){return e.apply(this,arguments)}}());return _k.flatten(yield Promise.all(t))}var i="".concat(f.TILE_SKIN_FOLDER,"/").concat(e);return yield n.loadSpriteFramesDirAsync(i)})),function(e){return t.apply(this,arguments)})},{key:"paddingZero",value:function(e,t){for(var n="",i=0;i<t-e.length;i++)n+="0";return n+e}}]),l}(ce))||Ck;Q._RF.pop(),Q._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var Fk=$.ccclass,xk=GameCore.Match.Modes,Uk=Fk("ScoreManager")(Rk=function(e){F(i,e);var t,n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).currentScore=0,e.tournamentStartScore=0,e}return N(i,[{key:"addScore",value:function(e,t,n){var i=this.getLevelMultiplier(e),a=this.getComboMultiplier(t),o=this.getTimeMultiplier(e,n),r=Math.floor(this.currentScore+10*i*a*o),l=10*Math.ceil(r/10);this.setScore(l)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var e=Zs.getMatchMode();this.currentScore=e===xk.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(e){this.currentScore=e,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"resetTournamentStartScore",value:function(){this.tournamentStartScore=0}},{key:"updateScore",value:(t=W((function*(){this.node.scene.emit(ta.SCORE_UPDATED,this.currentScore)})),function(){return t.apply(this,arguments)})},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(e){return 1+.1*(e-1)}},{key:"getComboMultiplier",value:function(e){return 1+.1*(e-1)}},{key:"getTimeMultiplier",value:function(e,t){return e<=2?4:1+.05*t}}]),i}(ce))||Rk;Q._RF.pop(),Q._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var Gk=function(){function e(t){z(this,e),this.game=null,this.data={},this.game=t.getGameplay(),this.manager=t,this.updateStateData(),this.logDebug()}return N(e,[{key:"logDebug",value:function(){var e=this.constructor.name;console.info("[STATE] ".concat(e),this.data)}},{key:"updateStateData",value:function(){if(this.game){var e=this.game.getGameData();e&&(this.data=e)}}},{key:"updateGameData",value:function(e){var t;null===(t=this.game)||void 0===t||t.setGameData(e)}}]),e}();Q._RF.pop(),Q._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var Hk=globalThis.game,Vk=Hk.analytics,qk=Hk.match,Wk=Hk.storage,Kk=GameCore,jk=Kk.Match.Modes,Yk=Kk.Dtos.Match.Data,Xk=function(e){F(s,e);var t,i,a,r,l=x(s);function s(e,t){var n;return z(this,s),n=l.call(this,e),o.stopAllSounds(),n.vibrateDevice(),n.pauseCountdown(),n.updateMatchCustomData(),n.handleGameOver(t),n.logLevelFailAnalytics(),n}return N(s,[{key:"pauseCountdown",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var e;null===(e=Ne("Vibrate"))||void 0===e||null===(e=e.getComponent(ys))||void 0===e||e.vibrate(500)}},{key:"handleGameOver",value:(r=W((function*(e){var t=Zs.getMatchMode();if(n.setBlockInput(!0),t!==jk.SINGLE){if(t===jk.TOURNAMENT)yield this.handleTournamentGameOver();else{if(t!==jk.CHALLENGE_FRIEND)return void this.showFailScreen(e);yield this.handleChallengeGameOver()}n.setBlockInput(!1)}else this.showFailScreen(e)})),function(e){return r.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(a=W((function*(){var e,t,n=this;if(this.game){var i=(null!==(e=Zs.getMatchCustomData())&&void 0!==e?e:{}).tournamentId;if(i){var a;if(m.validateTournamentExpired(i))return Wk.setStorageData("tournament","animateTournamentLeader",!1),b.showNotificationScreenWithLocalizedKey("error.tourEnded",2),void(null===(a=this.game)||void 0===a||a.scheduleOnce((function(){var e;null===(e=n.game)||void 0===e||e.node.scene.emit(ta.GAME_EXIT)}),2));try{var o=Wk.getStorageData("tournament","previousScore"),r=this.game.scoreManager.getCurrentScore()>o;Wk.setStorageData("tournament","animateTournamentLeader",r),yield Zs.finishMatchAsync()}catch(e){console.warn(e)}null===(t=this.game)||void 0===t||t.node.scene.emit(ta.GAME_EXIT)}}})),function(){return a.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(i=W((function*(){if(this.game){try{var e=qk.getMatchState().id,t=yield qk.api.getMatchAPI().getMatchDetailByIdAsync(e),n=new Yk(t).toObject().extraData;yield Zs.finishMatchAsync({extraData:null!=n?n:void 0})}catch(e){console.warn(e)}this.game.node.scene.emit(ta.SHOW_CHALLENGE_RESULTS)}})),function(){return i.apply(this,arguments)})},{key:"showFailScreen",value:(t=W((function*(e){var t=this.data.level;e===Qs&&o.playSound(vn.LEVEL_FAIL_TIMEOUT),o.playSound(vn.LEVEL_FAIL),b.openScreen(w.RESCUES_SCREEN,{level:t,failKey:e})})),function(e){return t.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var e;if(this.game){var t=this.data.level,n=void 0===t?1:t,i=null===(e=this.game)||void 0===e?void 0:e.scoreManager.getCurrentScore();Zs.updateMatchStateAfterLevelFinish(n,i)}}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore(),i=Zs.getMatchMode()||void 0;Vk.levelFail(t,n,i)}}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){}}]),s}(Gk);Q._RF.pop(),Q._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var Zk=globalThis.game,Jk=Zk.analytics,Qk=Zk.player,$k=Zk.leaderboard,eC=Zk.match,tC=GameCore,nC=tC.Match.Modes,iC=tC.Utils.Time,aC=GameCore.Configs.Ads.NotifyPlayerBeforeShow,oC=function(t){F(h,t);var n,i,a,r,l,s,u,c=x(h);function h(e){var t;return z(this,h),(t=c.call(this,e)).handleFinishStateFlow(),t}return N(h,[{key:"handleFinishStateFlow",value:(u=W((function*(){if(this.game){this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),this.game.uiManager.pauseTime();var e=Zs.getMatchMode();e!==nC.CHALLENGE_FRIEND&&e!==nC.TOURNAMENT&&this.updatePlayerProgress(),this.updateMatchCustomData(),e===nC.CHALLENGE_FRIEND?this.handleFinishChallenge():e===nC.TOURNAMENT?this.handleFinishTournament():this.handleFinishSingle(),this.logLevelCompleteAnalytics()}})),function(){return u.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"attemptCallCreateShortcut",value:function(){var e=this.data.level;(void 0===e?0:e)<2||S.canShowInterstitialAd()||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("createShortcutAsync",e)}))}},{key:"updatePlayerProgress",value:function(){if(this.game){var e=this.data.level;if(e){var t=e+1,n=Qk.getGameData();if(n){var i=n.level,a=Math.max(i,t);Qk.setGameData(G(G({},n),{},{level:a}))}}}}},{key:"updateMatchCustomData",value:function(){if(this.game){var e=this.data.level,t=void 0===e?1:e,n=this.game.scoreManager.getCurrentScore();Zs.updateMatchStateAfterLevelFinish(t,n)}}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore(),i=Zs.getMatchMode()||void 0;Jk.levelComplete(t,n,i)}}},{key:"handleFinishChallenge",value:(s=W((function*(){if(this.game){try{var e=eC.getMatchState().id,t=yield Zs.getMatchExtraDataAsync(e);yield Zs.finishMatchAsync({extraData:null!=t?t:void 0})}catch(e){console.warn(e),yield Zs.finishMatchAsync()}this.game.node.scene.emit(ta.SHOW_CHALLENGE_RESULTS)}})),function(){return s.apply(this,arguments)})},{key:"handleFinishTournament",value:(l=W((function*(){if(this.handlePostTournamentScore(),this.game){var e=this.data.level,t=void 0===e?1:e;o.playSound(vn.LEVEL_COMPLETE,{volume:.5}),this.game.effectManager.playConfettiEffect(),yield iC.sleepAsync(500),S.canShowInterstitialAd()&&(yield S.showInterstitialAdAsync({forLevel:t})),this.game.node.scene.emit(ta.NEXT_LEVEL)}})),function(){return l.apply(this,arguments)})},{key:"handlePostTournamentScore",value:(r=W((function*(){var e;if(this.game){var t=null===(e=this.game)||void 0===e?void 0:e.scoreManager.getCurrentScore();if(t){try{yield GameSDK.tournament.postScoreAsync(t)}catch(e){console.warn("GameSDK post score async",e)}var n=Zs.getMatchCustomData();if(n){var i=n.leaderboardId,a=n.playerId;i&&a&&(yield $k.setLeaderboardScoreAsync(i,a,t))}}}})),function(){return r.apply(this,arguments)})},{key:"handleFinishSingle",value:(a=W((function*(){o.turnUpMusic();var e=this.data.level,t=void 0===e?0:e;t>0&&t%5==0?yield this.handleFinishHardLevel():yield this.handleFinishNormalLevel(),this.handleNextLevelSingle()})),function(){return a.apply(this,arguments)})},{key:"handleFinishNormalLevel",value:(i=W((function*(){var t,n,i,a,r,l,s=this.data.level,u=void 0===s?0:s,c=null!==(t=null===(n=Qk.getGameData())||void 0===n?void 0:n.coins)&&void 0!==t?t:0,h=null!==(i=null===(a=Zs.getMatchCustomData())||void 0===a?void 0:a.score)&&void 0!==i?i:0;aC&&(yield null===(r=this.game)||void 0===r?void 0:r.uiManager.interstitialAdIndicator.flash()),S.canShowInterstitialAd()&&(null===(l=this.game)||void 0===l||l.node.scene.emit(ta.HIDE_UI),yield e.waitTweenAsync(.8),yield S.showInterstitialAdAsync({forLevel:u})),o.playSound(vn.LEVEL_COMPLETE,{volume:.5}),yield b.openScreenAndWaitForClose(w.LEVEL_COMPLETE_SCREEN,{level:u,coins:c,score:h,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!1})})),function(){return i.apply(this,arguments)})},{key:"handleFinishHardLevel",value:(n=W((function*(){var e,t,n,i,a,r=this.data.level,l=void 0===r?0:r,s=null!==(e=null===(t=Qk.getGameData())||void 0===t?void 0:t.coins)&&void 0!==e?e:0,u=null!==(n=null===(i=Zs.getMatchCustomData())||void 0===i?void 0:i.score)&&void 0!==n?n:0;o.playSound(vn.LEVEL_COMPLETE,{volume:.5});var c=(yield b.openScreenAndWaitForClose(w.LEVEL_COMPLETE_SCREEN,{level:l,coins:s,score:u,overrideAnimation:{openScreen:"LevelCompleteOpenScreen"},lookingForRewards:!0})).screenData,h=(null!=c?c:{}).canShowRewardsAd;if(void 0!==h&&h){var p=(yield b.openScreenAndWaitForClose(w.GET_REWARDS_SCREEN)).screenData,d=null!==(a=null==p?void 0:p.getRewardsSuccess)&&void 0!==a&&a;d&&this.getRewardItems(),yield b.openScreenAndWaitForClose(w.LEVEL_COMPLETE_SCREEN,{level:l,coins:s,score:u,getRewardsSuccess:d,lookingForRewards:!1}),d||(yield S.showInterstitialAdAsync({forLevel:l}))}else yield S.showInterstitialAdAsync({forLevel:l})})),function(){return n.apply(this,arguments)})},{key:"handleNextLevelSingle",value:function(){var e=this.data.level,t=Qk.getGameData();this.game&&e&&t&&this.game.node.scene.emit(ta.NEXT_LEVEL)}},{key:"getRewardItems",value:function(){this.game&&(this.game.node.scene.emit(ta.ADD_ITEM,{item:d.STORM,quantity:1}),this.game.node.scene.emit(ta.ADD_ITEM,{item:d.THUNDER,quantity:1}))}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),h}(Gk);Q._RF.pop(),Q._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var rC=globalThis.game,lC=rC.player,sC=rC.match,uC=GameCore.Match.Modes,cC=function(t){F(c,t);var n,i,a,r,l,s,u=x(c);function c(e){var t;return z(this,c),(t=u.call(this,e)).clearBoard(),t.initCountdown(),t.initScore(),t.loadLevel().then((function(){t.updateUI()})),t}return N(c,[{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.board.clearAnimationQueue(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(s=W((function*(){if(this.game){var e=Zs.getMatchMode();try{if(e===uC.CHALLENGE_FRIEND){var t=yield this.loadChallengeFriendMode(),n=t.frames,i=t.extraData;o.playSound(vn.LEVEL_START),this.handleChallengeFriendModeStart(n,i)}else{var a=yield this.loadSingleMode();o.playSound(vn.LEVEL_START),e===uC.SINGLE?this.handleSingleModeStart(a):e===uC.TOURNAMENT&&this.handleTournamentModeStart(a)}}catch(e){console.error("Error loading level:",e);var r=yield this.loadSingleMode();o.playSound(vn.LEVEL_START),this.handleSingleModeStart(r)}}})),function(){return s.apply(this,arguments)})},{key:"loadChallengeFriendMode",value:(l=W((function*(){var e=sC.getMatchState().id,t=yield Zs.getMatchExtraDataAsync(e);if(!t)throw new Error("Match mode ".concat(uC.CHALLENGE_FRIEND," but no extraData (for opponent initialization) was found in match data."));var n=this.game.levelManager,i=yield n.loadLevel(t.level);return this.updateGameData({level:t.level,levelData:n.getLevelData()}),{frames:i,extraData:t}})),function(){return l.apply(this,arguments)})},{key:"loadSingleMode",value:(r=W((function*(){var e=this.game.levelManager,t=yield e.loadLevel(this.data.level,this.data.themeId);return this.updateGameData({levelData:e.getLevelData()}),t})),function(){return r.apply(this,arguments)})},{key:"handleChallengeFriendModeStart",value:(a=W((function*(e,t){if(this.game){var n=this.game.levelManager.getLevelData(),i=t.level,a=t.fen,o=t.gravity,r=t.rules,l=t.time,s=lC.getPlayerId();yield Promise.all([Zs.setMatchCustomDataAsync({level:i,score:0}),Zs.setProfileMatchDataAsync({id:s,score:0})]),yield this.game.board.create(e,G(G({},n),{},{level:i,customFen:a,mode:o,rules:r,time:l})),this.game.board.setIgnoreInput(!0),yield this.game.board.animateTilesAppear(),this.game.board.setIgnoreInput(!1),this.ready()}})),function(e,t){return a.apply(this,arguments)})},{key:"handleSingleModeStart",value:(i=W((function*(t){var n;if(this.game){var i=this.game.levelManager.getLevelData(),a=this.data.level,o=lC.getPlayerId();yield Promise.all([Zs.setMatchCustomDataAsync({level:a,score:0}),Zs.setProfileMatchDataAsync({id:o,score:0})]),yield this.game.board.create(t,i),this.game.board.setIgnoreInput(!0),yield this.game.board.animateTilesAppear(),null!==(n=this.game.guidelinesManager)&&void 0!==n&&n.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),a&&a>0&&a%5==0&&(Co.isLandscape()&&this.game.handleShowUI(),b.openScreen(w.HARD_LEVEL_SCREEN),yield e.waitTweenAsync(1.3),b.closeScreen(w.HARD_LEVEL_SCREEN),yield this.game.board.animateTilesWave()),this.ready()}})),function(e){return i.apply(this,arguments)})},{key:"handleTournamentModeStart",value:(n=W((function*(e){var t;if(this.game){var n=this.game.levelManager.getLevelData(),i=this.data.level,a=lC.getPlayerId();yield Promise.all([Zs.setMatchCustomDataAsync({level:i}),Zs.setProfileMatchDataAsync({id:a})]),yield this.game.board.create(e,n),this.game.board.setIgnoreInput(!0),yield this.game.board.animateTilesAppear(),null!==(t=this.game.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),this.ready()}})),function(e){return n.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.init()}},{key:"initCountdown",value:function(){this.game&&this.game.clockManager.init()}},{key:"updateUI",value:function(){if(this.game){var e=this.game.getGameData();if(e){var t=e.level,n=void 0===t?0:t,i=e.levelData;this.game.uiManager.setLevelText(n),i&&this.game.clockManager.setTime(i.time)}}}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),c}(Gk);Q._RF.pop(),Q._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var hC=function(e){F(n,e);var t=x(n);function n(e){var i;return z(this,n),(i=t.call(this,e)).startCountdown(),i}return N(n,[{key:"startCountdown",value:function(){this.game&&(this.game.clockManager.startCountdown(),this.game.uiManager.startCountdown())}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"playing",value:function(){}},{key:"fail",value:function(e){var t=this.manager.createFailState(this.manager,e);this.manager.change(t)}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){this.updateStateData()}}]),n}(Gk);Q._RF.pop(),Q._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var pC,dC=globalThis.game.analytics,yC=GameCore.Utils.Valid,fC=function(e){F(n,e);var t=x(n);function n(e){var i;return z(this,n),i=t.call(this,e),o.stopAllSounds(),o.turnDownMusic(),i.handleGuideFlow(),i.setGridPlayable(),i.logLevelStartAnalytics(),i}return N(n,[{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(e){if(yC.isDebugger()){var t=this.manager.createFailState(this.manager);this.manager.change(t)}}},{key:"finish",value:function(){if(yC.isDebugger()){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var e;null!==(e=this.manager.getGameplay().guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var e,t;this.game&&(null!==(e=this.game.guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.game.handleShowUI(),null===(t=this.game.guidelinesManager)||void 0===t||t.show())}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=(Zs.getMatchCustomData()||{}).score,i=void 0===n?0:n,a=Zs.getMatchMode()||void 0;dC.levelStart(t,i,a)}}}]),n}(Gk);Q._RF.pop(),Q._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var vC,gC=(0,$.ccclass)("StateManager")(pC=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(e){this.gameplay=e,this.state=new cC(this)}},{key:"change",value:function(e){this.state=e}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return this.state instanceof cC}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return this.state instanceof fC}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return this.state instanceof hC}},{key:"fail",value:function(e){this.state.fail(e)}},{key:"isFail",value:function(){return this.state instanceof Xk}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return this.state instanceof oC}},{key:"update",value:function(e){this.state&&this.state.update(e)}},{key:"createInitializeState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return J(cC,t)}},{key:"createReadyState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return J(fC,t)}},{key:"createPlayingState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return J(hC,t)}},{key:"createFailState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return J(Xk,t)}},{key:"createFinishState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return J(oC,t)}}]),n}(ce))||pC;Q._RF.pop(),Q._RF.push({},"a95ba1U+uJB66zZU7UYL4e5","TournamentManager",void 0);var mC,bC,wC,SC,kC,CC,EC,AC,TC,PC=$.ccclass,RC=GameCore.Utils.Object,OC=globalThis.game.player,IC=PC("TournamentManager")(vC=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).leaderData=[],e.isInited=!1,e}return N(n,[{key:"init",value:function(e){var t=this,n=OC.getPlayerId();this.leaderData=RC.vals(e.leaders).reduce((function(e,t){if(t.playerId!==n&&t.score>0){var i={score:t.score,rank:t.rank};e.push(i)}return e}),[]),this.leaderData.sort((function(e,t){return e.score-t.score})),this.leaderData.forEach((function(e,n){e.rank=t.leaderData.length-n})),this.isInited=!0}}]),n}(ce))||vC;Q._RF.pop(),Q._RF.push({},"2b89dXjcudIaZRJFuh5TAAI","InterstitialAdIndicator",void 0);var LC=$.ccclass,_C=$.property,DC=["ads.interNotice.backInSec","ads.interNotice.hangTight","ads.interNotice.quickAd"];var MC,NC=GameCore.Configs.Ads.NotifyPlayerBeforeShow,zC=(mC=LC("InterstitialAdIndicator"),bC=t.required(),wC=_C(he),SC=t.required(),kC=_C(p),mC((AC=M((EC=function(n){F(r,n);var a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),B(e,"uiOpacity",AC,U(e)),B(e,"labelLocalizer",TC,U(e)),e}return N(r,[{key:"__preload",value:function(){t.validateRequiredProperties(this)}},{key:"flash",value:(a=W((function*(){var t;if(!1===NC)return Promise.resolve();null===(t=this.signal)||void 0===t||t.abort();var n,a=new i;this.signal=a,this.labelLocalizer.key=(n=Math.floor(Math.random()*DC.length),DC[n]);var o=ae(this.uiOpacity).to(.25,{opacity:255},{easing:"linear"}).delay(.25).to(.25,{opacity:100},{easing:"linear"}).delay(.125);yield e.runTweenAsync(ae(this.uiOpacity).repeat(2,o).to(.25,{opacity:0},{easing:"linear"}),a),this.uiOpacity.opacity=0})),function(){return a.apply(this,arguments)})}]),r}(ce)).prototype,"uiOpacity",[bC,wC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TC=M(EC.prototype,"labelLocalizer",[SC,kC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CC=EC))||CC);Q._RF.pop(),Q._RF.push({},"dfab8xSeglD/abIKphEhi4g","ComboContainer",void 0);var BC,FC=$.ccclass,xC=GameCore.Match.Modes,UC=FC("ComboContainer")(MC=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"__preload",value:function(){this.widget=this.node.getComponent(ie),this.node.scene.on(ta.GRID_RESIZE,this.handleViewResized,this)}},{key:"init",value:function(e){this.board=e}},{key:"updateWidget",value:function(){if(Co.isPortrait())return this.widget.right=22.5,void(this.widget.top=Zs.getMatchMode()===xC.TOURNAMENT?180:160);if(this.board){var e=this.board.getBoundingBoxWorld(),t=e.xMax,n=e.yMax,i=a.cssSizeToWorldSize(a.getScreenWidthCss()),o=a.cssSizeToWorldSize(a.getScreenHeightCss());this.widget.right=i-t,this.widget.top=(o-n)/2}}},{key:"updateStatus",value:function(){this.updateWidget()}},{key:"handleViewResized",value:function(){this.updateWidget()}}]),n}(ce))||MC;Q._RF.pop(),Q._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var GC,HC,VC,qC,WC,KC,jC,YC,XC,ZC,JC,QC,$C,eE,tE,nE,iE,aE,oE,rE,lE,sE,uE,cE,hE,pE,dE=$.ccclass,yE=dE("ComboProgressBar")(BC=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"start",value:function(){this.progressBar=this.getComponent(Qo),this.opacity=this.getComponent(he),this.comboTimer=0,this.isActive=!1,this.node.scene.on(ta.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(e){this.isActive&&(this.comboTimer>0?(this.comboTimer-=e,this.progressBar.progress=this.comboTimer/2):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(ta.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>0&&(this.isActive=!0,this.comboTimer=2),e>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),n}(ce))||BC;Q._RF.pop(),Q._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var fE,vE,gE,mE,bE,wE,SE,kE=$.ccclass,CE=$.property,EE=(Y(GC={},d.HINT,"item.hintDesc"),Y(GC,d.PLIERS,"item.pliersDesc"),Y(GC,d.STORM,"item.stormDesc"),Y(GC,d.THUNDER,"item.thunderDesc"),GC),AE=(HC=kE("SpecialItem"),VC=CE({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),qC=t.required,WC=CE({type:fe,tooltip:"The button that activates the item"}),KC=CE({type:te,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),jC=t.required,YC=CE({type:Se,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),XC=t.required,ZC=CE({type:ge,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),JC=t.required,QC=CE({type:ge,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),$C=t.required,eE=CE({type:he,group:"Animation"}),tE=t.required,nE=CE({type:he,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),HC((oE=M((aE=function(n){F(l,n);var a,o,r=x(l);function l(){var e;z(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),B(e,"isDevButton",oE,U(e)),B(e,"button",rE,U(e)),B(e,"quantity",lE,U(e)),B(e,"quantityLabel",sE,U(e)),B(e,"quantityNode",uE,U(e)),B(e,"plusNode",cE,U(e)),B(e,"glowUIOpacity",hE,U(e)),B(e,"uiOpacity",pE,U(e)),e.vibrateComp=null,e}return N(l,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){t.validateRequiredProperties(this,l)}},{key:"updateStatus",value:function(e){var t;if(void 0!==this.itemType){var n=null===(t=e.items)||void 0===t?void 0:t[this.itemType];n&&(this.setActiveStatus(n.canActivate),this.setQuantity(n.quantity,n.animate))}}},{key:"setActiveStatus",value:function(t){var n;null===(n=this.signal)||void 0===n||n.abort();var a=new i;this.signal=a,this.button.interactable=t,e.runTweenAsync(ae(this.uiOpacity).to(.2,{opacity:t?255:128}),a)}},{key:"activate",value:(o=W((function*(){this.quantity<=0?this.requestItem():(this.vibrate(),this.node.scene.emit(ta.USE_ITEM,this.itemType))})),function(){return o.apply(this,arguments)})},{key:"setQuantity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e;if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,void(this.plusNode.active=!1);n=Math.max(0,n),this.quantity=n,this.quantityLabel.string="".concat(this.quantity),n<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),t&&this.animateAddItem()}},{key:"requestItem",value:function(){void 0!==this.itemType?b.openScreen(w.GET_ITEM_SCREEN,{item:this.itemType,localizedMessageKey:EE[this.itemType],quantity:1}):console.warn("Item type is not defined")}},{key:"vibrate",value:function(){var e,t;this.vibrateComp=null!==(e=this.vibrateComp)&&void 0!==e?e:this.node.getComponent(ys),null===(t=this.vibrateComp)||void 0===t||t.vibrate(50)}},{key:"animateAddItem",value:(a=W((function*(){return this.glowUIOpacity.opacity=0,Promise.all([e.runTweenAsync(ae(this.node).to(.1,{scale:new Ie(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:Ie.ONE},{easing:"elasticOut"})),e.runTweenAsync(ae(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))])})),function(){return a.apply(this,arguments)})}]),l}(ce)).prototype,"isDevButton",[VC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rE=M(aE.prototype,"button",[qC,WC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lE=M(aE.prototype,"quantity",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sE=M(aE.prototype,"quantityLabel",[jC,YC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uE=M(aE.prototype,"quantityNode",[XC,ZC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cE=M(aE.prototype,"plusNode",[JC,QC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hE=M(aE.prototype,"glowUIOpacity",[$C,eE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pE=M(aE.prototype,"uiOpacity",[tE,nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iE=aE))||iE);Q._RF.pop(),Q._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var TE=$.ccclass,PE=$.disallowMultiple,RE=$.property,OE=(fE=TE("Clock"),vE=RE(ge),gE=RE(Se),fE(mE=PE((wE=M((bE=function(t){F(o,t);var n,i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"clockIcon",wE,U(e)),B(e,"timeLabel",SE,U(e)),e}return N(o,[{key:"__preload",value:function(){this.node.scene.on(ta.TIME_UPDATED,this.updateTimeLabel,this),this.node.scene.on(ta.RESCUE_START,this.handleRescueStart,this),this.node.scene.on(ta.RESCUE_FINISHED,this.handleRescueFinished,this)}},{key:"updateStatus",value:function(e){e.time&&this.updateTimeLabel(e.time)}},{key:"updateTimeLabel",value:function(e){var t=this.convertSecondsToMmSs(e);this.timeLabel.string=t}},{key:"convertSecondsToMmSs",value:function(e){var t=Math.floor(e/60),n=Math.floor(e%60),i=this.padZero(t),a=this.padZero(n);return"".concat(i,":").concat(a)}},{key:"padZero",value:function(e){return e<10?"0".concat(e):"".concat(e)}},{key:"handleRescueStart",value:(i=W((function*(){var t=ae(this.node).to(.5,{scale:new Ie(1.1,1.1,1)}),n=ae(this.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),i=ae(this.clockIcon).repeat(5,n);e.runTweenAsync(i),e.runTweenAsync(t)})),function(){return i.apply(this,arguments)})},{key:"handleRescueFinished",value:(n=W((function*(){var t=ae(this.node).to(.5,{scale:new Ie(1,1,1)});e.runTweenAsync(t)})),function(){return n.apply(this,arguments)})}]),o}(ce)).prototype,"clockIcon",[vE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SE=M(bE.prototype,"timeLabel",[gE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mE=bE))||mE)||mE);Q._RF.pop(),Q._RF.push({},"af947t5g91EkZVWXv5upZaV","CacheUtils",void 0);var IE,LE,_E,DE,ME,NE,zE,BE,FE,xE,UE,GE=GameCore.Utils.Image,HE=globalThis.game.frameCapture,VE=function(){function e(){z(this,e)}var t,n,i;return N(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getPlayerAvatar",value:(i=W((function*(e,t,n,i){var a=this.playerAvatarCache.get("".concat(t,":").concat(n));return a||(a=yield this.loadPlayerAvatar(e,t,n,i)),a})),function(e,t,n,a){return i.apply(this,arguments)})},{key:"loadPlayerAvatar",value:(n=W((function*(e,t,n,i){var a=yield this.loadImage(e,n,n,"".concat(t,":").concat(n));if((null==i||!i.aborted)&&a){var o=Be.createWithImage(a);return this.playerAvatarCache.set("".concat(t,":").concat(n),o),o}})),function(e,t,i,a){return n.apply(this,arguments)})},{key:"isAvatarCached",value:function(e,t){return this.playerAvatarCache.has("".concat(e,":").concat(t))}},{key:"loadImage",value:(t=W((function*(e,t,n,i){try{var a=yield HE.captureAsync({width:t,height:n,name:"LeaderAvatar",renderOptions:Y({},i,{name:i,type:"image",depth:0,position:[0,0],size:[t,n],image:e})});return a?yield GE.loadImage(a):null}catch(e){return null}})),function(e,n,i,a){return t.apply(this,arguments)})}]),e}();VE.playerAvatarCache=new Map;try{new VE}catch(e){console.error("CacheUtils",e)}Q._RF.pop(),Q._RF.push({},"540108ucKBPYbN9gW5TFh/q","LeaderRail",void 0);var qE,WE,KE,jE,YE,XE=$.ccclass,ZE=$.property,JE=(IE=XE("LeaderRail"),LE=ZE(Se),_E=ZE(ge),DE=ZE(le),ME=ZE(Fg),IE((BE=M((zE=function(t){F(o,t);var n,i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"scoreLabel",BE,U(e)),B(e,"crown",FE,U(e)),B(e,"avatar",xE,U(e)),B(e,"spark",UE,U(e)),e.score=0,e}return N(o,[{key:"__preload",value:function(){this.defaultAvatar=this.avatar.spriteFrame,this.uiOpacity=this.getComponent(he)}},{key:"updateScore",value:(i=W((function*(t,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=t-this.score,r=a?0:.5,l=ae(this.node).to(r,{},{onUpdate:function(e,t){if(t){var n=Math.floor(o*t)+i.score;i.scoreLabel.string=n.toString()}}});yield e.runTweenAsync(l,n),this.score=t,this.scoreLabel.string=t.toString()})),function(e,t){return i.apply(this,arguments)})},{key:"updatePhoto",value:(n=W((function*(){var e=GameSDK.player.getPhoto(),t=GameSDK.player.getID();if(e&&t){var n=yield VE.getPlayerAvatar(e,t,50);n?(n.packable=!0,this.avatar.spriteFrame=n):this.avatar.spriteFrame=this.defaultAvatar}})),function(){return n.apply(this,arguments)})},{key:"setCrown",value:function(e){this.crown.active=e}},{key:"setOpacity",value:function(e){this.uiOpacity.opacity=e}},{key:"playSparkParticle",value:function(){this.spark.play()}},{key:"stopSparkParticle",value:function(){this.spark.stop()}}]),o}(ce)).prototype,"scoreLabel",[LE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FE=M(zE.prototype,"crown",[_E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xE=M(zE.prototype,"avatar",[DE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UE=M(zE.prototype,"spark",[ME],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NE=zE))||NE);Q._RF.pop(),Q._RF.push({},"00759vwS/dHS6GvHKvVE5Q1","TournamentProgressBar",void 0);var QE,$E,eA,tA,nA,iA,aA,oA,rA,lA,sA,uA,cA,hA,pA,dA,yA=$.ccclass,fA=$.property,vA=474,gA=(qE=yA("TournamentProgressBar"),WE=fA(JE),qE((YE=M((jE=function(t){F(a,t);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"playerLeader",YE,U(e)),e.onUpdate=function(){e.playerLeader&&e.playerLeader.node&&(e.playerLeader.node.position=new Ie(e.progressBar.progress*vA-237,0,0))},e}return N(a,[{key:"__preload",value:function(){this.progressBar=this.getComponent(Re)}},{key:"updateProgress",value:(n=W((function*(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"cubicOut",o=ae(this.progressBar).to(i,{progress:t},{easing:a,onUpdate:this.onUpdate});yield e.runTweenAsync(o,n)})),function(e,t){return n.apply(this,arguments)})},{key:"getProgress",value:function(){return this.progressBar.progress}}]),a}(ce)).prototype,"playerLeader",[WE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KE=jE))||KE);Q._RF.pop(),Q._RF.push({},"16d68fBLT1Ha7lXADThDtfC","TournamentRail",void 0);var mA,bA,wA,SA,kA,CA,EA,AA,TA,PA=$.ccclass,RA=$.property,OA=GameCore,IA=OA.Utils.Array,LA=OA.Match.Modes,_A=(QE=PA("TournamentRail"),$E=RA(gA),eA=RA(JE),tA=RA(ge),nA=RA(ge),iA=RA(p),aA=RA(p),oA=t.onlyRunInLifeCycleAsync,QE((sA=M((lA=function(t){F(u,t);var n,a,o,r,l,s=x(u);function u(){var e;z(this,u);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=s.call.apply(s,[this].concat(n)),B(e,"progressBar",sA,U(e)),B(e,"playerLeader",uA,U(e)),B(e,"flag",cA,U(e)),B(e,"sword",hA,U(e)),B(e,"currentRankLocalizer",pA,U(e)),B(e,"nextRankLocalizer",dA,U(e)),e.nextLeaderIndex=0,e.score=0,e.minScore=0,e.maxScore=0,e.signal=new i,e}return N(u,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(he),this.playerLeader.updatePhoto()}},{key:"updateStatus",value:(l=W((function*(e){if(Zs.getMatchMode()===LA.TOURNAMENT){this.uiOpacity.opacity=255;var t=e.leaderData,n=e.score;if(t&&void 0!==n){this.signal.abort();var a=new i;this.signal=a,this.score=n,this.nextLeaderIndex=this.getScoreReachedLeaderIndex(this.score,t),this.syncRail(t,a,!0)}}else this.uiOpacity.opacity=0})),function(e){return l.apply(this,arguments)})},{key:"syncRail",value:(r=W((function*(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e[this.nextLeaderIndex-1],a=e[this.nextLeaderIndex],o=i?i.rank:a?a.rank+1:1;this.setRankLabel(o,this.currentRankLocalizer);var r=!a;this.nextRankLocalizer.node.active=!r,this.runActiveAnimation(this.sword,!r,t,n),this.playerLeader.setCrown(r),this.playerLeader.updateScore(this.score,t,n);var l=n?0:void 0;if(r)this.playerLeader.playSparkParticle(),yield this.progressBar.updateProgress(1,t,l);else{this.playerLeader.stopSparkParticle(),this.setRankLabel(a.rank,this.nextRankLocalizer),this.minScore=i?i.score:0,this.maxScore=a.score;var s=(this.score-this.minScore)/(this.maxScore-this.minScore);s=.8*s+.1,yield this.progressBar.updateProgress(s,t,l)}})),function(e,t){return r.apply(this,arguments)})},{key:"handleScoreUpdated",value:(o=W((function*(e){var t=e.score,n=e.leaderData;if(void 0!==t&&n&&this.score!==t){this.signal.abort();var a=new i;this.signal=a,this.score=t;var o=this.getScoreReachedLeaderIndex(t,n);if(o>this.nextLeaderIndex){this.nextLeaderIndex=o;var r=(1-this.progressBar.getProgress())/1.5;r=Math.min(r,.5),yield this.progressBar.updateProgress(1,a,r,"cubicIn"),this.runBubbleAnimation(this.sword,a),yield this.progressBar.updateProgress(0,a,0),this.runBubbleAnimation(this.flag,a)}this.syncRail(n,a)}})),function(e){return o.apply(this,arguments)})},{key:"runBubbleAnimation",value:(a=W((function*(t,n){t.scale=Ie.ONE;var i=ae(t).to(.1,{scale:new Ie(1.2,1.2,1.2)}).to(.2,{scale:Ie.ONE},{easing:"backOut"});yield e.runTweenAsync(i,n),t.scale=Ie.ONE})),function(e,t){return a.apply(this,arguments)})},{key:"runActiveAnimation",value:(n=W((function*(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=n?Ie.ZERO:Ie.ONE,r=n?Ie.ONE:Ie.ZERO;if(a)t.scale=r;else if(!t.scale.equals(r)){var l=n?"backOut":"quadOut";t.scale=o;var s=ae(t).to(.1,{scale:new Ie(1.2,1.2,1.2)}).to(.2,{scale:r},{easing:l});yield e.runTweenAsync(s,i),t.scale=r}})),function(e,t,i){return n.apply(this,arguments)})},{key:"getScoreReachedLeaderIndex",value:function(e,t){var n=IA.searchIndex(t,(function(t){return t.score>=e}));return-1===n?t.length:n}},{key:"setRankLabel",value:function(e,t){1!==e?2!==e?3!==e?(t.key="status.nth",t.setParams([e.toString()])):t.key="status.third":t.key="status.second":t.key="status.first"}}]),u}(ce)).prototype,"progressBar",[$E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uA=M(lA.prototype,"playerLeader",[eA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cA=M(lA.prototype,"flag",[tA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hA=M(lA.prototype,"sword",[nA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pA=M(lA.prototype,"currentRankLocalizer",[iA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dA=M(lA.prototype,"nextRankLocalizer",[aA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(lA.prototype,"updateStatus",[oA],Object.getOwnPropertyDescriptor(lA.prototype,"updateStatus"),lA.prototype),rA=lA))||rA);Q._RF.pop(),Q._RF.push({},"ac5371+oVZBLoBKwAM7rH3r","GameSceneLayout",void 0);var DA,MA,NA,zA,BA,FA,xA,UA,GA,HA=$.ccclass,VA=$.property,qA=(mA=HA("GameSceneLayout"),bA=VA(_A),wA=VA(OE),SA=VA(AE),mA((EA=M((CA=function(e){F(r,e);var t,n,a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=o.call.apply(o,[this].concat(n)),B(e,"tournamentRail",EA,U(e)),B(e,"clock",AA,U(e)),B(e,"items",TA,U(e)),e.isInited=!1,e.entranceSignal=new i,e.exitSignal=new i,e}return N(r,[{key:"waitForInitAsync",value:(a=W((function*(){var e=this;if(!this.isInited)return new Promise((function(t){var n=setInterval((function(){e.isInited&&(clearInterval(n),t())}),100)}))})),function(){return a.apply(this,arguments)})},{key:"setLevelText",value:function(e){}},{key:"disableLayout",value:function(){}},{key:"enableLayout",value:function(){}},{key:"updateStatus",value:function(e){this.clock.updateStatus(e),this.tournamentRail.updateStatus(e);var t,n=H(this.items);try{for(n.s();!(t=n.n()).done;){t.value.updateStatus(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"playExitAnimUI",value:(n=W((function*(){})),function(){return n.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(t=W((function*(){})),function(){return t.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){}},{key:"unHighlightCoinContainer",value:function(){}},{key:"handleScoreUpdated",value:function(e){}}]),r}(ce)).prototype,"tournamentRail",[bA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AA=M(CA.prototype,"clock",[wA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TA=M(CA.prototype,"items",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kA=CA))||kA);Q._RF.pop(),Q._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var WA,KA,jA,YA,XA,ZA,JA,QA=$.ccclass,$A=$.property,eT=$.disallowMultiple,tT=(DA=QA("ScoreBlock"),MA=$A(Se),NA=$A(ye),zA=$A({visible:function(){return this.isResizeWidth}}),DA(BA=eT((xA=M((FA=function(n){F(r,n);var i,a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),B(e,"scoreText",xA,U(e)),B(e,"isResizeWidth",UA,U(e)),B(e,"maxScoreWidth",GA,U(e)),e.panelWidthDiff=0,e}return N(r,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(ee),this.scoreUITransform=this.scoreText.node.getComponent(ee),this.panelWidthDiff=this.uiTransform.width-this.maxScoreWidth,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"updateScore",value:(a=W((function*(t){var n=this,i=t-this.score,a=ae(this.node).to(.1,{},{onUpdate:function(e,t){if(t){var a=Math.floor(i*t)+n.score;n.scoreText.string=a.toString(),n.resizeWidth()}}});yield e.runTweenAsync(a),this.setScore(t),yield this.resizeWidth()})),function(e){return a.apply(this,arguments)})},{key:"setScore",value:function(e){var t=null!=e?e:0;this.score=t,this.scoreText.string=t.toString()}},{key:"resizeWidth",value:(i=W((function*(){var t=this;if(this.isResizeWidth){var n=this.uiTransform.width,i=(this.scoreUITransform.width>this.maxScoreWidth?this.scoreUITransform.width:this.maxScoreWidth)+this.panelWidthDiff;this.uiTween&&this.uiTween.stop(),this.uiTween=ae(this.node).to(.05,{},{easing:"sineOut",onUpdate:function(e,a){a&&(t.uiTransform.width=Te.lerp(n,i,a))}}),yield e.runTweenAsync(this.uiTween),this.uiTransform.width=i}})),function(){return i.apply(this,arguments)})}]),r}(ce)).prototype,"scoreText",[MA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UA=M(FA.prototype,"isResizeWidth",[NA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),GA=M(FA.prototype,"maxScoreWidth",[zA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),BA=FA))||BA)||BA);Q._RF.pop(),Q._RF.push({},"424745QWUlDPabdCe8UcRwy","ChallengeScoreBlock",void 0);var nT,iT,aT,oT,rT,lT,sT,uT,cT,hT,pT,dT,yT,fT=$.ccclass,vT=$.property,gT=(WA=fT("ChallengeScoreBlock"),KA=vT(le),jA=vT(Be),WA((ZA=M((XA=function(e){F(i,e);var t,n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"avatar",ZA,U(e)),B(e,"defaultAvatar",JA,U(e)),e}return N(i,[{key:"updateInfo",value:(t=W((function*(e,t,n){var i=this;this.setScore(n),this.scheduleOnce((function(){return i.resizeWidth()}),0);try{var a=yield VE.getPlayerAvatar(e,t,50);if(!a)return;a.packable=!0,this.avatar.spriteFrame=a}catch(e){this.avatar.spriteFrame=this.defaultAvatar}})),function(e,n,i){return t.apply(this,arguments)})}]),i}(tT)).prototype,"avatar",[KA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JA=M(XA.prototype,"defaultAvatar",[jA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YA=XA))||YA);Q._RF.pop(),Q._RF.push({},"b1ef276tNtH+oc5BqYfDMXl","Sidebar",void 0);var mT,bT,wT,ST,kT,CT,ET,AT,TT,PT,RT,OT,IT,LT=$.ccclass,_T=$.property,DT=$.disallowMultiple,MT=(nT=LT("Sidebar"),iT=_T(tT),aT=_T(Se),oT=_T(ge),rT=_T(ge),lT=_T(Xe),nT(sT=DT((cT=M((uT=function(t){F(i,t);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"scoreBlock",cT,U(e)),B(e,"levelNumber",hT,U(e)),B(e,"sidebarContainer",pT,U(e)),B(e,"leavesContainer",dT,U(e)),B(e,"entranceCurve",yT,U(e)),e.originSidebarPosition=0,e.originLeavesPosition=0,e}return N(i,[{key:"saveOriginPos",value:function(){this.originSidebarPosition=this.sidebarContainer.position.y,this.originLeavesPosition=this.leavesContainer.position.y}},{key:"initUIPos",value:function(){this.sidebarContainer.setPosition(this.sidebarContainer.position.x,this.originSidebarPosition+1200),this.leavesContainer.setPosition(this.leavesContainer.position.x,this.originLeavesPosition+150)}},{key:"playExitAnimUI",value:function(t){var n=ae(this.sidebarContainer).to(.2,{position:new Ie(this.sidebarContainer.position.x,this.originSidebarPosition+1200,0)},{easing:"quadIn"}),i=ae(this.leavesContainer);return i.delay(.1).to(.2,{position:new Ie(this.leavesContainer.position.x,this.originLeavesPosition+150,0)},{easing:"quadIn"}),[e.runTweenAsync(n,t),e.runTweenAsync(i,t)]}},{key:"playEntranceAnimUI",value:function(t){var n=this,i=ae(this.sidebarContainer).to(.3,{position:new Ie(this.sidebarContainer.position.x,this.originSidebarPosition,0)},{easing:function(e){return n.entranceCurve.evaluate(e)}}),a=ae(this.leavesContainer);return a.to(.2,{position:new Ie(this.leavesContainer.position.x,this.originLeavesPosition,0)},{easing:"quadIn"}),[e.runTweenAsync(i,t),e.runTweenAsync(a,t)]}},{key:"setLevelText",value:function(e){this.levelNumber.string=e.toString()}},{key:"updateStatus",value:function(e){e.score&&this.scoreBlock.setScore(e.score),e.level&&this.setLevelText(e.level)}},{key:"updateScore",value:function(e){this.scoreBlock.updateScore(e)}}]),i}(ce)).prototype,"scoreBlock",[iT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hT=M(uT.prototype,"levelNumber",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pT=M(uT.prototype,"sidebarContainer",[oT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dT=M(uT.prototype,"leavesContainer",[rT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yT=M(uT.prototype,"entranceCurve",[lT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xe}}),sT=uT))||sT)||sT);Q._RF.pop(),Q._RF.push({},"0ff4fFbKylIvaONtaTZkRQV","LandscapeLayout",void 0);var NT,zT,BT,FT,xT,UT,GT,HT=$.ccclass,VT=$.property,qT=globalThis.game.match,WT=GameCore.Match.Modes,KT=(mT=HT("LandscapeLayout"),bT=VT({type:MT,group:"Sidebar"}),wT=VT({type:gT,group:"ChallengeScore"}),ST=VT({type:gT,group:"ChallengeScore"}),kT=VT(ge),CT=VT(ge),mT((TT=M((AT=function(t){F(r,t);var n,a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),B(e,"sidebar",TT,U(e)),B(e,"playerScoreBlock",PT,U(e)),B(e,"opponentScoreBlock",RT,U(e)),B(e,"leftAnimNodes",OT,U(e)),e.originLeftNodesPos=[],B(e,"rightAnimNodes",IT,U(e)),e.originRightNodesPos=[],e}return N(r,[{key:"onLoad",value:function(){var e=this;_e.once(De.EVENT_AFTER_UPDATE,(function(){e.saveOriginPos(),e.initUIPos(),e.isInited=!0}))}},{key:"saveOriginPos",value:function(){this.sidebar.saveOriginPos();var e,t=H(this.leftAnimNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.originLeftNodesPos.push(n.position.clone())}}catch(e){t.e(e)}finally{t.f()}var i,a=H(this.rightAnimNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.originRightNodesPos.push(o.position.clone())}}catch(e){a.e(e)}finally{a.f()}}},{key:"initUIPos",value:function(){var e=this;this.sidebar.initUIPos(),this.leftAnimNodes.forEach((function(t,n){var i=e.originLeftNodesPos[n].clone();i.y+=1200,t.setPosition(i)})),this.rightAnimNodes.forEach((function(t,n){var i=e.originRightNodesPos[n].clone();i.x+=900,t.setPosition(i)}))}},{key:"playExitAnimUI",value:(a=W((function*(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new i;var a=[];this.leftAnimNodes.forEach((function(i,o){var r=new Ie(t.node.position.x,t.originLeftNodesPos[o].y+1200,0),l=ae(i);l.to(n,{position:r},{easing:"quadIn"}),a.push(e.runTweenAsync(l,t.exitSignal))})),this.rightAnimNodes.forEach((function(i,o){var r=new Ie(t.originRightNodesPos[o].x+900,i.position.y,0),l=ae(i);l.to(n,{position:r},{easing:"backIn"}),a.push(e.runTweenAsync(l,t.exitSignal))})),a.push.apply(a,j(this.sidebar.playExitAnimUI(this.exitSignal))),yield Promise.all(a)})),function(){return a.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(n=W((function*(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.4;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new i;var a=[];this.leftAnimNodes.forEach((function(i,o){var r=new Ie(t.node.position.x,t.originLeftNodesPos[o].y,0),l=ae(i);l.to(n,{position:r},{easing:"quadOut"}),a.push(e.runTweenAsync(l,t.entranceSignal))})),this.rightAnimNodes.forEach((function(i,o){var r=new Ie(t.originRightNodesPos[o].x,i.position.y,0),l=ae(i);l.to(n,{position:r},{easing:"backOut"}),a.push(e.runTweenAsync(l,t.entranceSignal))})),a.push.apply(a,j(this.sidebar.playEntranceAnimUI(this.entranceSignal))),yield Promise.all(a)})),function(){return n.apply(this,arguments)})},{key:"setLevelText",value:function(e){this.sidebar.setLevelText(e)}},{key:"updateStatus",value:function(e){V(q(r.prototype),"updateStatus",this).call(this,e),this.sidebar.updateStatus(e),this.updateScoreBlockStatus(e)}},{key:"updateScoreBlockStatus",value:function(e){var t;if(Zs.getMatchMode()!==WT.CHALLENGE_FRIEND)return this.playerScoreBlock.node.active=!1,void(this.opponentScoreBlock.node.active=!1);if(!this.playerScoreBlock.node.active){var n=qT.getMatchState(),i=null!==(t=Zs.getMatchCustomData())&&void 0!==t?t:{},a=i.playerId,o=i.opponentId;if(a&&o){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var r=n.profiles[a],l=n.profiles[o];this.playerScoreBlock.updateInfo(r.photo,a,r.score),this.opponentScoreBlock.updateInfo(l.photo,o,l.score),e.score&&this.playerScoreBlock.setScore(e.score)}}}},{key:"handleScoreUpdated",value:function(e){this.sidebar.updateScore(e),this.playerScoreBlock.node.active&&this.playerScoreBlock.updateScore(e)}}]),r}(qA)).prototype,"sidebar",[bT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PT=M(AT.prototype,"playerScoreBlock",[wT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RT=M(AT.prototype,"opponentScoreBlock",[ST],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OT=M(AT.prototype,"leftAnimNodes",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IT=M(AT.prototype,"rightAnimNodes",[CT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ET=AT))||ET);Q._RF.pop(),Q._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var jT,YT,XT,ZT,JT,QT,$T,eP,tP,nP=$.ccclass,iP=$.property,aP=(NT=nP("UIMasks"),zT=iP(mi),BT=iP(Yw),NT((UT=M((xT=function(e){F(o,e);var n,i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"background",UT,U(e)),B(e,"alphaMasks",GT,U(e)),e}return N(o,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"show",value:(i=W((function*(){this.alphaMasks.setMaskActive(0,Co.isPortrait()),this.alphaMasks.setMaskActive(1,Co.isLandscape()),this.background.node.active=!0,yield this.background.changeStateFade(!0,.25)})),function(){return i.apply(this,arguments)})},{key:"hide",value:(n=W((function*(){yield this.background.changeStateFade(!1,.25),this.background.node.active=!1})),function(){return n.apply(this,arguments)})}]),o}(ce)).prototype,"background",[zT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GT=M(xT.prototype,"alphaMasks",[BT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FT=xT))||FT);Q._RF.pop(),Q._RF.push({},"f963aJjCvtD0Y2LplwjDer1","ScoreContainer",void 0);var oP,rP,lP,sP,uP,cP,hP,pP,dP,yP,fP,vP,gP,mP,bP,wP,SP=$.ccclass,kP=$.property,CP=GameCore.Match.Modes,EP=globalThis.game.match,AP=(jT=SP("ScoreContainer"),YT=kP(tT),XT=kP(gT),ZT=kP(gT),jT(($T=M((QT=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"scoreBlock",$T,U(e)),B(e,"playerScoreBlock",eP,U(e)),B(e,"opponentScoreBlock",tP,U(e)),e.scoreBlockShown=!1,e.challengeScoreBlockShown=!1,e}return N(n,[{key:"updateStatus",value:function(e){switch(EP.getMatchState().mode){case CP.CHALLENGE_FRIEND:this.showChallengeScoreBlock(),this.hideScoreBlock(),e.score&&this.playerScoreBlock.setScore(e.score);break;case CP.SINGLE:this.hideChallengeScoreBlock(),this.showScoreBlock(),e.score&&this.scoreBlock.setScore(e.score);break;default:this.hideScoreBlock(),this.hideChallengeScoreBlock()}}},{key:"showChallengeScoreBlock",value:function(){var e;if(!this.challengeScoreBlockShown){this.challengeScoreBlockShown=!0;var t=EP.getMatchState(),n=null!==(e=Zs.getMatchCustomData())&&void 0!==e?e:{},i=n.playerId,a=n.opponentId;if(i&&a){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0;var o=t.profiles[i],r=t.profiles[a];this.playerScoreBlock.updateInfo(o.photo,i,o.score),this.opponentScoreBlock.updateInfo(r.photo,a,r.score)}}}},{key:"hideChallengeScoreBlock",value:function(){this.challengeScoreBlockShown&&(this.challengeScoreBlockShown=!1,this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1)}},{key:"showScoreBlock",value:function(){var e;if(!this.scoreBlockShown){this.scoreBlockShown=!0;var t=(null!==(e=Zs.getMatchCustomData())&&void 0!==e?e:{}).score;this.scoreBlock.node.active=!0,this.scoreBlock.setScore(t)}}},{key:"hideScoreBlock",value:function(){this.scoreBlockShown&&(this.scoreBlockShown=!1,this.scoreBlock.node.active=!1)}},{key:"updateScore",value:function(e){this.challengeScoreBlockShown?this.playerScoreBlock.updateScore(e):this.scoreBlockShown&&this.scoreBlock.updateScore(e)}}]),n}(ce)).prototype,"scoreBlock",[YT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eP=M(QT.prototype,"playerScoreBlock",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tP=M(QT.prototype,"opponentScoreBlock",[ZT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JT=QT))||JT);Q._RF.pop(),Q._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var TP,PP,RP,OP,IP,LP,_P,DP,MP,NP=$.ccclass,zP=$.property,BP=(oP=NP("Header"),rP=zP(p),lP=zP(ge),sP=zP(ge),uP=zP(ge),cP=zP(ge),hP=zP(AP),pP=t.onlyRunInLifeCycle,oP((fP=M((yP=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"levelTextLocalizer",fP,U(e)),B(e,"settingNode",vP,U(e)),B(e,"homeNode",gP,U(e)),B(e,"leftNode",mP,U(e)),B(e,"coinNode",bP,U(e)),B(e,"scoreContainer",wP,U(e)),e}return N(i,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"updateStatus",value:function(e){this.scoreContainer.updateStatus(e),e.level&&this.setLevelText(e.level)}},{key:"highlightCoinContainer",value:function(){var e=Ne("Canvas/Screens");if(e){var t=this.coinNode.worldPosition.clone();this.coinNode.parent=e,this.coinNode.worldPosition=t}}},{key:"removeCoinContainerHighlight",value:function(){var e=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=e}},{key:"setLevelText",value:function(e){this.levelTextLocalizer.setParams([e.toString()])}},{key:"setButtonsInteractable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.settingNode.getComponent(fe).interactable=e,this.homeNode.getComponent(fe).interactable=e}},{key:"setActive",value:function(e){this.uiOpacity.opacity=e?255:0}}]),i}(ce)).prototype,"levelTextLocalizer",[rP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vP=M(yP.prototype,"settingNode",[lP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gP=M(yP.prototype,"homeNode",[sP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mP=M(yP.prototype,"leftNode",[uP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bP=M(yP.prototype,"coinNode",[cP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wP=M(yP.prototype,"scoreContainer",[hP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(yP.prototype,"setActive",[pP],Object.getOwnPropertyDescriptor(yP.prototype,"setActive"),yP.prototype),dP=yP))||dP);Q._RF.pop(),Q._RF.push({},"456584ngz9FupmxndAXqCbY","PortraitLayout",void 0);var FP=$.ccclass,xP=$.property,UP=(TP=FP("PortraitLayout"),PP=xP(BP),RP=xP([ge]),OP=xP([ge]),TP((_P=M((LP=function(n){F(l,n);var a,o,r=x(l);function l(){var e;z(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),B(e,"header",_P,U(e)),B(e,"topAnimNodes",DP,U(e)),e.originTopNodesPos=[],B(e,"botAnimNodes",MP,U(e)),e.originBotNodesPos=[],e.hideBotWorldY=-80,e}return N(l,[{key:"onLoad",value:function(){var e=this;this.validateRequiredComponents(),_e.once(De.EVENT_AFTER_UPDATE,(function(){e.saveOriginPos(),e.initUIPos(),e.isInited=!0}))}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var e,t=H(this.topAnimNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.originTopNodesPos.push(n.position.clone())}}catch(e){t.e(e)}finally{t.f()}var i,a=H(this.botAnimNodes);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.originBotNodesPos.push(o.position.clone())}}catch(e){a.e(e)}finally{a.f()}}},{key:"initUIPos",value:function(){var e=this;this.topAnimNodes.forEach((function(t,n){var i=e.originTopNodesPos[n].clone();i.y+=200,t.setPosition(i)}));var t=new Ie(0,this.hideBotWorldY,0);this.botAnimNodes.forEach((function(n,i){var a,o,r=e.originBotNodesPos[i].clone();t.y=e.hideBotWorldY;var l=null!==(a=null===(o=n.parent)||void 0===o?void 0:o.inverseTransformPoint(t,t).y)&&void 0!==a?a:200;r.y=l,n.setPosition(r)}))}},{key:"setLevelText",value:function(e){this.header.setLevelText(e)}},{key:"disableLayout",value:function(){this.header.setButtonsInteractable(!1)}},{key:"enableLayout",value:function(){this.header.setButtonsInteractable()}},{key:"updateStatus",value:function(e){V(q(l.prototype),"updateStatus",this).call(this,e),this.header.updateStatus(e)}},{key:"playExitAnimUI",value:(o=W((function*(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new i;var a=[];this.topAnimNodes.forEach((function(i,o){var r=new Ie(i.position.x,t.originTopNodesPos[o].y+200,0),l=ae(i);l.to(n,{position:r},{easing:"backIn"}),a.push(e.runTweenAsync(l,t.exitSignal))}));var o,r=new Ie(0,this.hideBotWorldY,0),l=H(this.botAnimNodes);try{for(l.s();!(o=l.n()).done;){var s,u,c=o.value;r.y=this.hideBotWorldY;var h=null!==(s=null===(u=c.parent)||void 0===u?void 0:u.inverseTransformPoint(r,r).y)&&void 0!==s?s:200,p=new Ie(c.position.x,h,0),d=ae(c);d.to(n,{position:p},{easing:"backIn"}),a.push(e.runTweenAsync(d,this.exitSignal))}}catch(e){l.e(e)}finally{l.f()}yield Promise.all(a),this.exitSignal.aborted||this.header.setActive(!1)})),function(){return o.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(a=W((function*(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new i,this.header.setActive(!0);var a=[];this.topAnimNodes.forEach((function(i,o){var r=new Ie(i.position.x,t.originTopNodesPos[o].y,0),l=ae(i);l.to(n,{position:r},{easing:"backOut"}),a.push(e.runTweenAsync(l,t.entranceSignal))})),this.botAnimNodes.forEach((function(i,o){var r=new Ie(i.position.x,t.originBotNodesPos[o].y,0),l=ae(i);l.to(n,{position:r},{easing:"backOut"}),a.push(e.runTweenAsync(l,t.entranceSignal))})),yield Promise.all(a)})),function(){return a.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"handleScoreUpdated",value:function(e){this.header.scoreContainer.updateScore(e)}}]),l}(qA)).prototype,"header",[PP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DP=M(LP.prototype,"topAnimNodes",[RP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),MP=M(LP.prototype,"botAnimNodes",[OP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IP=LP))||IP);Q._RF.pop(),Q._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var GP,HP,VP,qP,WP,KP="bomb";Q._RF.pop(),Q._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var jP,YP,XP,ZP,JP,QP,$P,eR,tR,nR,iR,aR,oR,rR,lR,sR,uR,cR=GameCore,hR=cR.Dtos.Player,pR=cR.Utils.Function,dR=$.ccclass,yR=$.property,fR=globalThis.game,vR=fR.player,gR=fR.language,mR=Object.keys(h),bR=(GP=dR("DevToolsContainer"),HP=yR(ge),GP((WP=M((qP=function(e){F(r,e);var t,n,i,a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),B(e,"devToolsToggle",WP,U(e)),e.isActive=!0,e.game=null,e.bundleName="lowest",e.currentLocaleIndex=0,e.debouncedStarsNotification=pR.debounce((function(){var e=vR.getGameData();e&&b.showNotificationScreen("Stars added. Current stars: ".concat(e.stars))}),700),e}return N(r,[{key:"injectGameplay",value:function(e){this.game=e}},{key:"start",value:function(){this.initCurrentLocale()}},{key:"initCurrentLocale",value:function(){var e=gR.getCurrentLocale();this.currentLocaleIndex=mR.indexOf(e)}},{key:"hideAllButtons",value:function(){var e,t=this.getComponentsInChildren(fe),n=H(t);try{for(n.s();!(e=n.n()).done;){var i=e.value.node.parent;i&&(i.name!==this.devToolsToggle.name&&(i.active=!1))}}catch(e){n.e(e)}finally{n.f()}}},{key:"showAllButtons",value:function(){var e,t=this.getComponentsInChildren(fe),n=H(t);try{for(n.s();!(e=n.n()).done;){var i=e.value.node.parent;i&&(i.name!==this.devToolsToggle.name&&(i.active=!0))}}catch(e){n.e(e)}finally{n.f()}}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){vR.setPlayerData(hR.Data.getDefaultData()),b.openScreen(w.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(ta.START_OVER,0)}},{key:"handleNextLevel",value:(a=W((function*(){var e,t,n,i=(null!==(e=null===(t=this.game)||void 0===t||null===(t=t.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:1)+1;null===(n=this.game)||void 0===n||n.setGameData({level:i-1}),vR.setGameData({level:i}),this.node.scene.emit(ta.NEXT_LEVEL)})),function(){return a.apply(this,arguments)})},{key:"handlePrevLevel",value:(i=W((function*(){var e,t,n,i=Math.max((null!==(e=null===(t=this.game)||void 0===t||null===(t=t.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:2)-1,1);null===(n=this.game)||void 0===n||n.setGameData({level:i-1}),vR.setGameData({level:i}),this.node.scene.emit(ta.NEXT_LEVEL)})),function(){return i.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(n=W((function*(e){var t,n=Number(e.string);null===(t=this.game)||void 0===t||t.setGameData({level:n-1}),vR.setGameData({level:n}),this.node.scene.emit(ta.NEXT_LEVEL)})),function(e){return n.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var e=globalThis.game.getBuildVersion();b.showNotificationScreen("Build version: ".concat(e))}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(ta.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){var e;null===(e=this.game)||void 0===e||e.clockManager.setTime(.1)}},{key:"handleClickExplodeButton",value:function(){var e,t,n=this.game;if(n){var i=null===(e=n.getGameData())||void 0===e||null===(e=e.levelData)||void 0===e?void 0:e.specials.bomb;if(i&&!(i<=0)){var a=n.board.getBombTiles();if(0!==a.length){var o=a[0];if(!o||(null===(t=o.special)||void 0===t?void 0:t.type)!==KP)throw new Error("Invalid bomb tile");o.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(ta.ADD_ITEM,{item:d.HINT,quantity:2}),this.node.scene.emit(ta.ADD_ITEM,{item:d.STORM,quantity:2}),this.node.scene.emit(ta.ADD_ITEM,{item:d.THUNDER,quantity:2}),this.node.scene.emit(ta.ADD_ITEM,{item:d.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(ta.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var e=vR.getGameData();e&&(vR.setGameData({stars:e.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchQualityAssets",value:function(){switch(this.bundleName){case"lowest":this.bundleName="highest";break;case"highest":this.bundleName="lowest"}be.emit(l.CHANGE_QUALITY_ASSETS,{quality:this.bundleName})}},{key:"handleSwitchLocale",value:(t=W((function*(){this.currentLocaleIndex=(this.currentLocaleIndex+1)%mR.length;var e=mR[this.currentLocaleIndex];b.showLoadingNotificationScreen();try{if(!e)throw new Error("Locale is undefined");yield this.preloadLanguageAsync(e),be.emit(l.CHOOSE_LANGUAGE,{locale:e,saveToPlayerData:!0}),b.showNotificationScreen("Language changed to ".concat(e))}catch(e){console.error(e),b.showNotificationScreen("Failed to change language")}})),function(){return t.apply(this,arguments)})},{key:"preloadLanguageAsync",value:function(e){return new Promise((function(t,n){be.emit(l.PRELOAD_LANGUAGE,{locale:e,onLoad:t,onError:n})}))}}]),r}(ce)).prototype,"devToolsToggle",[HP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VP=qP))||VP);Q._RF.pop(),Q._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var wR,SR,kR,CR,ER,AR,TR,PR,RR,OR=$.ccclass,IR=$.property,LR=GameCore,_R=LR.Utils.Valid,DR=LR.Match.Modes,MR=s.Layout,NR=(jP=OR("UIManager"),YP=IR(zC),XP=IR(UP),ZP=IR(KT),JP=IR(bR),QP=IR(yE),$P=IR(UC),eR=IR(aP),jP((iR=M((nR=function(e){F(s,e);var t,n,i,a,o,r=x(s);function s(){var e;z(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),B(e,"interstitialAdIndicator",iR,U(e)),B(e,"portraitLayout",aR,U(e)),B(e,"landscapeLayout",oR,U(e)),B(e,"devTools",rR,U(e)),B(e,"comboProgressBar",lR,U(e)),B(e,"comboContainer",sR,U(e)),B(e,"uiMasks",uR,U(e)),e.uiShown=!1,e.config={},e.showDevTools=function(){e.devTools&&(e.devTools.node.active=!0)},e}return N(s,[{key:"onLoad",value:function(){this.node.scene.on(Es.Events.UNLOCK_DEV_TOOLS,this.showDevTools),this.node.scene.on(ta.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(ta.RESCUE_FINISHED,this.hideRescueAnimation,this),this.node.scene.on(ta.SCORE_UPDATED,this.handleScoreUpdated,this),be.on(l.ORIENTATION_CHANGED,this.onOrientationChanged,this),this.onOrientationChanged(Co.getCurrentLayout())}},{key:"onDestroy",value:function(){this.node.scene.off(Es.Events.UNLOCK_DEV_TOOLS,this.showDevTools),this.node.scene.off(ta.RESCUE_START,this.showRescueAnimation,this),this.node.scene.off(ta.RESCUE_FINISHED,this.hideRescueAnimation,this),this.node.scene.off(ta.SCORE_UPDATED,this.handleScoreUpdated,this),be.off(l.ORIENTATION_CHANGED,this.onOrientationChanged,this)}},{key:"init",value:function(e){this.game=e,this.initDevTools(e),this.comboContainer.init(e.board)}},{key:"initDevTools",value:function(e){var t=this;window.addEventListener("reset-game-data",(function(){var e;null===(e=t.devTools)||void 0===e||e.handleResetData()})),this.devTools&&(this.devTools.node.active=_R.isDebugger(),this.devTools.injectGameplay(e))}},{key:"setLevelText",value:function(e){this.config.level=e,this.currentLayout.setLevelText(e)}},{key:"startCountdown",value:function(){this.comboProgressBar.resume()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume()}},{key:"setComboUI",value:function(e){this.comboContainer.getComponent(mi).changeStateFade(e,.1)}},{key:"disableLayout",value:function(){this.currentLayout.disableLayout()}},{key:"enableLayout",value:function(){this.currentLayout.enableLayout()}},{key:"updateStatus",value:function(){var e;this.currentLayout.updateStatus({score:this.game.scoreManager.getCurrentScore(),leaderData:null===(e=this.game.tournamentManager)||void 0===e?void 0:e.leaderData,items:this.game.itemManager.itemConfigs}),this.comboContainer.updateStatus()}},{key:"showRescueAnimation",value:(o=W((function*(){yield this.uiMasks.show()})),function(){return o.apply(this,arguments)})},{key:"hideRescueAnimation",value:(a=W((function*(){yield this.uiMasks.hide()})),function(){return a.apply(this,arguments)})},{key:"playExitAnimUI",value:(i=W((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.uiShown=!1,yield this.currentLayout.playExitAnimUI(e)})),function(){return i.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(n=W((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.17;this.uiShown=!0,yield this.currentLayout.playEntranceAnimUI(e)})),function(){return n.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.currentLayout.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.currentLayout.unHighlightCoinContainer()}},{key:"handleClickedPauseGame",value:function(){b.openScreen(w.PAUSE_SCREEN),this.node.scene.emit(ta.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){b.openScreen(w.QUIT_LEVEL_SCREEN),this.node.scene.emit(ta.GAME_PAUSE)}},{key:"items",get:function(){return this.currentLayout.items}},{key:"setInteractableItems",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=H(this.items);try{for(n.s();!(e=n.n()).done;){var i=e.value;t?void 0!==i.itemType?i.button.interactable=this.game.itemManager.canUseItem(i.itemType):console.warn("Item type is not defined"):i.button.interactable=!1}}catch(e){n.e(e)}finally{n.f()}}},{key:"onOrientationChanged",value:(t=W((function*(e){var t;e===MR.Portrait?(this.landscapeLayout.node.active=!1,this.portraitLayout.node.active=!0,this.currentLayout=this.portraitLayout):e===MR.Landscape&&(this.portraitLayout.node.active=!1,this.landscapeLayout.node.active=!0,this.currentLayout=this.landscapeLayout),this.currentLayout&&(this.currentLayout.updateStatus({level:this.config.level,score:this.game.scoreManager.getCurrentScore(),time:this.game.clockManager.getRemainingTime(),leaderData:null===(t=this.game.tournamentManager)||void 0===t?void 0:t.leaderData,items:this.game.itemManager.itemConfigs}),yield this.currentLayout.waitForInitAsync(),this.uiShown?this.playEntranceAnimUI(0):this.playExitAnimUI(0))})),function(e){return t.apply(this,arguments)})},{key:"handleScoreUpdated",value:function(e){var t;this.config.score=e,this.currentLayout.handleScoreUpdated(e),Zs.getMatchMode()===DR.TOURNAMENT&&this.currentLayout.tournamentRail.handleScoreUpdated({score:e,leaderData:null===(t=this.game.tournamentManager)||void 0===t?void 0:t.leaderData})}}]),s}(ce)).prototype,"interstitialAdIndicator",[YP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aR=M(nR.prototype,"portraitLayout",[XP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oR=M(nR.prototype,"landscapeLayout",[ZP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rR=M(nR.prototype,"devTools",[JP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lR=M(nR.prototype,"comboProgressBar",[QP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sR=M(nR.prototype,"comboContainer",[$P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uR=M(nR.prototype,"uiMasks",[eR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tR=nR))||tR);Q._RF.pop(),Q._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var zR=globalThis.game,BR=zR.player,FR=zR.ads,xR=zR.event,UR=zR.match,GR=zR.storage,HR=zR.analytics,VR=zR.monitorError,qR=zR.leaderboard,WR=GameCore,KR=WR.Events,jR=WR.Utils,YR=jR.Time,XR=jR.Array,ZR=jR.Valid,JR=WR.Configs.Gameplay,QR=WR.Match.Modes,$R=$.ccclass,eO=$.property,tO=[],nO={level:1,isFromLoader:!1};wR=$R("Gameplay"),SR=eO(Dh),kR=eO(mi),CR=eO(Hp),wR((TR=M((AR=function(e){F(l,e);var i,a,r=x(l);function l(){var e;z(this,l);for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];return e=r.call.apply(r,[this].concat(i)),B(e,"board",TR,U(e)),B(e,"opacityToggler",PR,U(e)),B(e,"pathDraw",RR,U(e)),e.gameData=null,e.rescueTiles=[],e.isAutoPlayEnabled=!1,e.handleOpenScreen=function(t){t.screenName===k[w.GET_ITEM_SCREEN]&&e.uiManager.highlightCoinContainer()},e.handleShowUI=W((function*(){e.uiManager.updateStatus(),e.uiManager.disableLayout(),e.uiManager.setInteractableItems(!1),yield e.uiManager.playEntranceAnimUI(),e.uiManager.enableLayout(),e.uiManager.setInteractableItems(!0)})),e.handleHideUI=W((function*(){e.uiManager.disableLayout(),e.uiManager.setInteractableItems(!1),yield e.uiManager.playExitAnimUI()})),e.handleCloseScreen=function(t){t.screenName===k[w.GET_ITEM_SCREEN]&&e.uiManager.unHighlightCoinContainer()},e.handlePauseGame=function(){e.node.scene.emit(ta.PAUSE_TIME),e.node.pauseSystemEvents(!0),e.opacityToggler.changeStateFade(!1,.1),e.uiManager.setComboUI(!1),e.processCrazyGamesGameplayStop()},e.handleResumeGame=function(){var t;e.node.resumeSystemEvents(!0),e.stateManager.isPlaying()&&e.node.scene.emit(ta.RESUME_TIME),e.processCrazyGamesGameplayStart(),e.opacityToggler.changeStateFade(!0,.1),e.uiManager.setComboUI(!0),null===(t=e.guidelinesManager)||void 0===t||t.startAutoGuides()},e.handleReplayGame=W((function*(){e.handleHideHint();try{var t=Zs.getMatchMode();t===QR.SINGLE&&(yield Zs.finishMatchAsync()),t!==QR.CHALLENGE_FRIEND&&(yield Zs.startMatchAsync()),t===QR.TOURNAMENT&&(e.scoreManager.resetTournamentStartScore(),e.setGameData({level:1}))}catch(e){console.warn("handleReplayGame",e)}e.stateManager.initialize()})),e.handleFinishGame=function(){var t;e.attemptCallCreateShortcut(),null!==(t=e.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()?(e.guidelinesManager.guideUi.guideSkipButton.active=!1,e.handleNextLevel()):e.stateManager.finish()},e.handleNextLevel=W((function*(){var t;if(e.gameData){var n=Zs.getMatchMode();try{n===QR.SINGLE?yield Zs.finishMatchAsync():n===QR.TOURNAMENT&&e.scoreManager.updateTournamentStartScore()}catch(e){console.warn("handleNextLevel",e)}var i=(null!==(t=e.gameData.level)&&void 0!==t?t:1)+1;e.setGameData({level:i}),n===QR.TOURNAMENT?yield Zs.setMatchCustomDataAsync({level:i}):(yield Zs.setMatchCustomDataAsync({level:i,score:0}),yield Zs.startMatchAsync()),e.stateManager.initialize(),console.log("Next level",e.gameData.level)}})),e.handleStartOver=function(){var t=W((function*(t){var n;BR.setGameData({level:null!=t?t:1}),e.gameData=BR.getGameData(),e.stateManager.initialize(),console.info("Start over",null===(n=e.gameData)||void 0===n?void 0:n.level)}));return function(e){return t.apply(this,arguments)}}(),e.handleMaxLevel=function(){e.gameData&&(e.initData(),b.openScreen(w.CONGRATULATION_SCREEN,{level:e.gameData.level}),console.info("Max level",e.gameData.level))},e.handleExitGame=W((function*(){try{GR.setStorageData("dashboard","animateToCurrentLevel",!0),GR.setStorageData("collection","animateMapPackUnlock",!0)}catch(e){console.warn("handleExitGame",e)}})),e.handleTileClick=function(t){e.stateManager.playing(),e.board.handleTileClick(t),e.handleHideHint()},e.handleGridMatchSuccess=function(t,n){e.pathDraw.drawMatchPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)})),e.comboManager.addCombo(),e.handleAddScore(),e.effectManager.playClearEffectAt([n[0].node.worldPosition,n[1].node.worldPosition])},e.handleGridMatchFail=function(t){var n;null!==(n=e.guidelinesManager)&&void 0!==n&&n.isShowErrorPathLevel()&&e.pathDraw.drawErrorPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)}))},e.checkIfGameIsFinish=function(){0===e.board.getUncleared().length&&e.node.scene.emit(ta.GAME_FINISH)},e.handlePauseTime=function(){e.clockManager.pause(),e.uiManager.pauseTime()},e.handleResumeTime=function(){e.clockManager.resume(),e.uiManager.resumeTime()},e.handleClockTimeout=function(){e.stateManager.fail(Qs)},e.handleHalfTime=function(){void 0!==e.guidelinesManager&&(e.board.getUncleared().length>=e.board.getCleared().length&&e.guidelinesManager.startThunderGuide()||e.board.getBombTiles().length>0&&e.guidelinesManager.startPliersGuide())},e.handleStartRescue=function(){var t,i,a;for(o.turnDownMusic(),n.setBlockInput(!0),e.board.setIgnoreInput(!0);e.rescueTiles.length>0;){var r=e.rescueTiles.pop();null==r||r.restore()}var l=null!==(t=Zs.getMatchMode())&&void 0!==t?t:void 0;HR.levelRescue(null!==(i=null===(a=e.gameData)||void 0===a?void 0:a.level)&&void 0!==i?i:1,void 0,l)},e.handleFinishRescue=function(){n.setBlockInput(!1),e.board.setIgnoreInput(!1)},e.handleBombExplode=function(){var t=W((function*(t){e.rescueTiles.push(t),e.board.setIgnoreInput(!0),n.getBlockInput()||(o.playSound(vn.BOMB_EXPLODE_1),n.setBlockInput(!0));var i=t.node.worldPosition;yield e.effectManager.createBombExplosionAt(new Ie(i.x,i.y,0)),n.setBlockInput(!1),e.stateManager.isFail()||e.stateManager.fail($s)}));return function(e){return t.apply(this,arguments)}}(),e.handleShowHint=function(){if(!e.pathDraw.isDrawingHint){var t=e.board.getHintPath();t&&(o.playSound(vn.HINT_ITEM),e.pathDraw.drawHintPath(t,(function(t){return e.board.getAnyTileWorldPosition(t.x,t.y)})),e.board.showHint(),e.node.scene.emit(ta.REFRESH_ITEMS))}},e.handleHideHint=function(){e.pathDraw.isDrawingHint&&(e.pathDraw.clearHintPath(),e.board.hideHint(),e.node.scene.emit(ta.REFRESH_ITEMS))},e.handleAddScore=function(){var t=e.levelManager.getLevelData().level,n=e.comboManager.getCombo(),i=e.clockManager.getRemainingTime();e.scoreManager.addScore(t,n,i)},e.handleUseItem=function(){var t=W((function*(t){switch(e.stateManager.playing(),t!==d.HINT&&e.handleHideHint(),e.itemManager.setQuantity(t,e.itemManager.getQuantity(t)-1),t){case d.HINT:Bh(e.board,e.pathDraw),e.node.scene.emit(ta.REFRESH_ITEMS);break;case d.PLIERS:Fh(e.board,e.effectManager),e.node.scene.emit(ta.REFRESH_ITEMS);break;case d.STORM:e.node.scene.emit(ta.HIDE_UI),yield Jh(e.board,e.effectManager),e.node.scene.emit(ta.SHOW_UI);break;case d.THUNDER:e.node.scene.emit(ta.HIDE_UI),yield Vh(e.board,e.effectManager),e.board.getUncleared().length>0&&e.node.scene.emit(ta.SHOW_UI)}}));return function(e){return t.apply(this,arguments)}}(),e.handleAutoPlay=function(){e.isAutoPlayEnabled?e.disableAutoPlay():e.enableAutoPlay()},e.enableAutoPlay=function(){e.isAutoPlayEnabled=!0,e.schedule(e.autoPlay,.5)},e.disableAutoPlay=function(){e.isAutoPlayEnabled=!1,e.unschedule(e.autoPlay)},e.autoPlay=function(){if(e.stateManager.isReady()||e.stateManager.isPlaying()){var t=e.board.getHintPath();if(!t)throw new Error("No path found");var n=t[0],i=t.slice(-1)[0];if(void 0!==n&&void 0!==i){var a=n.a,o=i.b,r=e.board.getTileAt(a.x,a.y),l=e.board.getTileAt(o.x,o.y);if(!r||!l)throw new Error("Tile is null");r.onClick(),l.onClick()}else{var s=new Error("No path found");if(ZR.isDebugger())throw s;null==VR||VR.sendException(s)}}},e.handleAddStars=function(t){var n=BR.getGameData();if(!n)return Promise.resolve([]);BR.setGameData({stars:n.stars+1});var i=t.startAnimationAt;i&&e.effectManager.playStarEffectAt(i)},e.handleChallengeFriends=W((function*(){try{var t,n,i;b.showLoadingScreen();var a=e.board.generateFenFromCurrentLevel(),o=(null!==(t=BR.getGameData())&&void 0!==t?t:{}).level,r=void 0===o?1:o;r=Math.max(1,r);var l=null!==(n=null===(i=e.gameData)||void 0===i?void 0:i.levelData)&&void 0!==n?n:{},s=l.mode,u=void 0===s?"":s,c=l.rules,h=void 0===c?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:c,p=l.time,d=void 0===p?0:p;yield UR.context.choose.processAsync({playerId:BR.getPlayerId(),fallbackSingleMode:!1,extraData:{level:r,fen:a,gravity:u,rules:h,time:d}}),Zs.getMatchMode()===QR.TOURNAMENT&&(yield e.tryInitTournamentMode(!0)),b.closeLoadingScreen(),e.node.scene.emit(ta.UPDATE_MUSIC),e.node.scene.emit(ta.GAME_RESUME),e.node.scene.emit(ta.GAME_REPLAY,{level:r})}catch(t){if(console.warn("Unable to invite friends",t),b.closeLoadingScreen(),b.showNotificationScreenWithLocalizedKey("error.tryLater"),!(t instanceof Error))return;null==VR||VR.sendException(t),e.node.scene.emit(ta.GAME_RESUME),e.node.scene.emit(ta.SHOW_UI)}})),e.handleAdShow=function(t){var n=t.placementId;n&&-1!==tO.indexOf(n)&&(tO.splice(tO.indexOf(n),1),FR.hideBannerAdAsync(n).catch((function(){})),0===tO.length&&xR.off(KR.AD_SHOWING,e.handleAdShow))},e.handleAddItem=function(){var t=W((function*(t){var n=t.animate,i=t.item,a=t.quantity,o=XR.search(e.uiManager.items,(function(e){return e.itemType===i}));if(void 0!==o){var r=e.itemManager.getQuantity(i)+a;if(e.itemManager.saveQuantity(i,r),e.uiManager.setInteractableItems(!1),n){var l=n.startWorldPosition;yield e.effectManager.playItemAddAnimation(new Ie(l.x,l.y),o)}e.itemManager.setQuantity(i,r,!0),e.uiManager.setInteractableItems(!0)}else console.warn("Item ".concat(i," not found"))}));return function(e){return t.apply(this,arguments)}}(),e}return N(l,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function(){Ns.init()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initClockManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager(),this.initPathDraw()}},{key:"initUIManager",value:function(){var e;this.uiManager=null===(e=this.node.parent)||void 0===e?void 0:e.getComponentInChildren(NR),this.uiManager.init(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(Bk)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(gC)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(eu)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(Wb)}},{key:"initItemManager",value:function(){this.itemManager=this.getComponent(dk),this.itemManager.init(this)}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(rd),this.comboManager.init()}},{key:"initClockManager",value:function(){this.clockManager=this.getComponent(Kp),this.clockManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(Uk),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){JR.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(lk),this.guidelinesManager.init(this))}},{key:"initPathDraw",value:function(){this.pathDraw.init(this.board)}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){tO=[],xR.off(KR.AD_SHOWING,this.handleAdShow),xR.clear(KR.OPENING_SCREEN),xR.clear(KR.CLOSING_SCREEN),xR.on(KR.OPENING_SCREEN,this.handleOpenScreen),xR.on(KR.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(ta.SHOW_UI,this.handleShowUI),this.node.scene.on(ta.HIDE_UI,this.handleHideUI),this.node.scene.on(ta.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(ta.GAME_RESUME,this.handleResumeGame),this.node.scene.on(ta.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(ta.GAME_FINISH,this.handleFinishGame),this.node.scene.on(ta.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(ta.START_OVER,this.handleStartOver),this.node.scene.on(ta.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(ta.GAME_EXIT,this.handleExitGame),this.node.scene.on(ta.TILE_CLICK,this.handleTileClick),this.node.scene.on(ta.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(ta.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(ta.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(ta.RESUME_TIME,this.handleResumeTime),this.node.scene.on(ta.TIME_OUT,this.handleClockTimeout),this.node.scene.on(ta.HALF_TIME,this.handleHalfTime),this.node.scene.on(ta.RESCUE_START,this.handleStartRescue),this.node.scene.on(ta.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(ta.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(ta.SHOW_HINT,this.handleShowHint),this.node.scene.on(ta.ADD_SCORE,this.handleAddScore),this.node.scene.on(ta.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(ta.USE_ITEM,this.handleUseItem),this.node.scene.on(ta.ADD_ITEM,this.handleAddItem),this.node.scene.on(ta.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(ta.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(ta.CHALLENGE_FRIENDS,this.handleChallengeFriends)}},{key:"start",value:(a=W((function*(){this.initDataFirstTime(),yield this.tryInitTournamentMode(),this.initGame()})),function(){return a.apply(this,arguments)})},{key:"initDataFirstTime",value:function(){var e,t,n=this.getSceneData(),i=(null!=n?n:{}).isFromLoader,a=void 0!==i&&i,o=(null!=n?n:{}).level;void 0===o&&(o=Zs.getMatchMode()===QR.TOURNAMENT?1:null!==(e=null===(t=BR.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:0);this.initData(),this.setGameData({level:o,isFromLoader:a})}},{key:"initData",value:function(){var e,t=this.getSceneData(),n=(null!=t?t:{}).isFromLoader,i=void 0!==n&&n,a=null!==(e=BR.getGameData())&&void 0!==e?e:{},o=a.level,r=void 0===o?1:o,l=a.items;0===r&&i&&l?(l.hint=2,l.thunder=1,l.storm=1,l.pliers=0,BR.setGameData({items:l,coins:500,lastRewardedItems:Date.now()}),this.node.scene.emit(ta.ADD_COINS,{coins:500,playSound:!1})):l&&this.checkItemsRewardable()&&(l.hint<5&&(l.hint+=1),l.thunder<5&&(l.thunder+=1),l.storm<5&&(l.storm+=1),l.pliers<5&&(l.pliers+=1),BR.setGameData({items:l,lastRewardedItems:Date.now()})),this.setGameData(G(G({},nO),{},{level:r}))}},{key:"checkItemsRewardable",value:function(){var e,t=(null!==(e=BR.getGameData())&&void 0!==e?e:{}).lastRewardedItems,n=void 0===t?0:t;return!YR.isToday(n)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"tryInitTournamentMode",value:(i=W((function*(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=Zs.getMatchMode();if(i===QR.TOURNAMENT){var a=null!==(e=Zs.getMatchCustomData())&&void 0!==e?e:{},o=a.leaderboardId,r=a.tournamentId;if(o&&r){yield m.requestTournamentDataAsync();var l=m.getTournamentDataById(r);if(l){var s=l.payload.themeId;this.setGameData({themeId:s});var u=qR.getLeaderboardName(o);if(u){var c=null;if(null!==(t=this.gameData)&&void 0!==t&&t.isFromLoader||n?c=yield Os.getAllLeaderboardAsync(o):(yield Os.waitForLeaderboardFinishAsync(u),c=qR.getLeaderboard(u)),c){this.tournamentManager=this.getComponent(IC),this.tournamentManager.init(c);var h=BR.getPlayerId(),p=c.leaders[h];if(!p){var d=yield qR.getLeadersByPlayerIdsAsync(u,[h]);if(0===d.length)return;p=d[0]}if(p){var y=p,f=y.score;GR.setStorageData("tournament","previousScore",f)}}}}}}})),function(){return i.apply(this,arguments)})},{key:"setGameData",value:function(e){var t,n,i,a=null!==(t=null!==(n=e.level)&&void 0!==n?n:null===(i=this.gameData)||void 0===i?void 0:i.level)&&void 0!==t?t:1;this.gameData=G(G(G({},this.gameData),e),{},{level:a})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return C.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var e,t=null!==(e=this.getGameData())&&void 0!==e?e:{},n=t.level,i=void 0===n?0:n,a=t.nextLevelCount;i<2||(void 0===a?0:a)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("checkAndCreateShortcutAsync",e)}))}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),l}(ce)).prototype,"board",[SR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PR=M(AR.prototype,"opacityToggler",[kR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RR=M(AR.prototype,"pathDraw",[CR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ER=AR));Q._RF.pop(),Q._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var iO=function(e){return e[e.STAR_CHEST=0]="STAR_CHEST",e[e.BALLOON=1]="BALLOON",e}(iO||{});re(iO),Q._RF.pop(),Q._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var aO,oO=function(e){return e.WORLD_TAB_SELECTED="world-tab-selected",e.FRIENDS_TAB_SELECTED="friends-tab-selected",e}(oO||{}),rO="#AE4212",lO="#3D5172",sO="#92200C",uO="#8F5542",cO="#8A4733",hO="#3e7110",pO="#3e7110";Q._RF.pop(),Q._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),Q._RF.pop(),Q._RF.push({},"2737dY5lxxEY6mKDXeUQJUc","ThemeLocaleKeys",void 0);var dO,yO=(Y(aO={},E.SUMMER,"theme.summer"),Y(aO,E.AUTUMN,"theme.autumn"),Y(aO,E.WINTER,"theme.winter"),Y(aO,E.SPRING_FESTIVAL,"theme.springFestival"),Y(aO,E.TREE_PLANTING_FESTIVAL,"theme.treePlantingFestival"),Y(aO,E.BLUE_SEA_FESTIVAL,"theme.blueSeaFestival"),Y(aO,E.MUSIC_FESTIVAL,"theme.musicFestival"),Y(aO,E.HARVEST_FESTIVAL,"theme.harvestFestival"),Y(aO,E.FOOD_FESTIVAL,"theme.foodFestival"),Y(aO,E.SNOW_FESTIVAL,"theme.snowFestival"),Y(aO,E.LIGHT_FESTIVAL,"theme.lightFestival"),Y(aO,E.PEACE_FESTIVAL,"theme.peaceFestival"),Y(aO,E.FLOWER_FESTIVAL,"theme.flowerFestival"),Y(aO,E.STREET_FESTIVAL,"theme.streetFestival"),Y(aO,E.COLOR_GARDEN,"theme.colorGarden"),Y(aO,E.COLOR_FESTIVAL,"theme.colorFestival"),Y(aO,E.NATURE_SUMMER,"theme.natureSummer"),Y(aO,E.SNOW_MOUNTAIN,"theme.snowMountain"),Y(aO,E.ICE_FESTIVAL,"theme.iceFestival"),Y(aO,E.GREEN_GRASS_FESTIVAL,"theme.greenGrassFestival"),Y(aO,E.COMMUNITY_FESTIVAL,"theme.communityFestival"),Y(aO,E.WATER_FESTIVAL,"theme.waterFestival"),Y(aO,E.ANIMAL_FESTIVAL,"theme.animalFestival"),Y(aO,E.LOST_FESTIVAL,"theme.lostFestival"),Y(aO,E.HALLOWEEN_FESTIVAL,"theme.halloweenFestival"),Y(aO,E.SNOW_MUSIC_FESTIVAL,"theme.snowMusicFestival"),Y(aO,E.CHRISTMAS,"theme.christmas"),Y(aO,E.SPRING_FLOWER_FESTIVAL,"theme.springFlowerFestival"),Y(aO,E.TET_HOLIDAY,"theme.tetHoliday"),Y(aO,E.SEA_FESTIVAL,"theme.seaFestival"),Y(aO,E.FIREWORK_FESTIVAL,"theme.fireworkFestival"),Y(aO,E.HALLOWEEN_HORROR,"theme.halloweenHorror"),Y(aO,E.MID_AUTUMN,"theme.midAutumn"),Y(aO,E.CHRISTMAS_SWEET,"theme.christmasSweet"),Y(aO,E.NEW_YEAR_COUNTDOWN,"theme.newYearCountdown"),Y(aO,E.HAPPY_NEW_YEAR,"theme.happyNewYear"),aO);Q._RF.pop(),Q._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),Q._RF.pop(),Q._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),Q._RF.pop(),Q._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var fO;(0,$.ccclass)("HintItem")(dO=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"itemType",get:function(){return d.HINT}}]),n}(AE));Q._RF.pop(),Q._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var vO;(0,$.ccclass)("PliersItem")(fO=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"itemType",get:function(){return d.PLIERS}}]),n}(AE));Q._RF.pop(),Q._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var gO;(0,$.ccclass)("StormItem")(vO=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"itemType",get:function(){return d.STORM}}]),n}(AE));Q._RF.pop(),Q._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var mO,bO,wO,SO,kO,CO,EO,AO,TO,PO,RO,OO,IO,LO,_O,DO,MO,NO;(0,$.ccclass)("ThunderItem")(gO=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"itemType",get:function(){return d.THUNDER}}]),n}(AE));Q._RF.pop(),Q._RF.push({},"28c5eNXZLBE+50Dno043fmy","useTornadoThunderCombined",void 0),Q._RF.pop(),Q._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var zO,BO,FO,xO,UO,GO,HO,VO,qO,WO,KO,jO=$.ccclass,YO=$.property,XO=(mO=jO("Coin"),bO=YO(Ae),wO=YO(Fe),SO=YO(it),kO=YO(it),CO=t.onlyRunInLifeCycle,EO=t.onlyRunInLifeCycle,AO=t.onlyRunInLifeCycle,TO=t.onlyRunInLifeCycle,PO=t.onlyRunInLifeCycleAsync,RO=t.onlyRunInLifeCycleAsync,OO=t.onlyRunInLifeCycle,mO((_O=M((LO=function(n){F(o,n);var i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"emittingParticles",_O,U(e)),B(e,"animation",DO,U(e)),B(e,"spin",MO,U(e)),B(e,"rest",NO,U(e)),e}return N(o,[{key:"__preload",value:function(){t.lazyValidateProperties(this)}},{key:"resetDisabled",value:function(){this.stopParticles(),this.stopAnimation(),this.hide(),this.node.active=!1,this.node.setPosition(0,0,this.node.position.z)}},{key:"hide",value:function(){this.node.setScale(Ie.ZERO)}},{key:"stopParticles",value:function(){this.emittingParticles.stopSystem()}},{key:"playTrailParticles",value:function(){this.emittingParticles.resetSystem()}},{key:"playSpinAnimationAfterDelay",value:(i=W((function*(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;t>0&&(yield e.waitTweenAsync(t)),yield this.playSpinAnimation(n)})),function(){return i.apply(this,arguments)})},{key:"playSpinAnimation",value:function(t){return e.runAnimationAsync(this.animation,this.spin.name,t)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),o}(ce)).prototype,"emittingParticles",[bO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DO=M(LO.prototype,"animation",[wO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MO=M(LO.prototype,"spin",[SO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NO=M(LO.prototype,"rest",[kO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(LO.prototype,"resetDisabled",[CO],Object.getOwnPropertyDescriptor(LO.prototype,"resetDisabled"),LO.prototype),M(LO.prototype,"hide",[EO],Object.getOwnPropertyDescriptor(LO.prototype,"hide"),LO.prototype),M(LO.prototype,"stopParticles",[AO],Object.getOwnPropertyDescriptor(LO.prototype,"stopParticles"),LO.prototype),M(LO.prototype,"playTrailParticles",[TO],Object.getOwnPropertyDescriptor(LO.prototype,"playTrailParticles"),LO.prototype),M(LO.prototype,"playSpinAnimationAfterDelay",[PO],Object.getOwnPropertyDescriptor(LO.prototype,"playSpinAnimationAfterDelay"),LO.prototype),M(LO.prototype,"playSpinAnimation",[RO],Object.getOwnPropertyDescriptor(LO.prototype,"playSpinAnimation"),LO.prototype),M(LO.prototype,"stopAnimation",[OO],Object.getOwnPropertyDescriptor(LO.prototype,"stopAnimation"),LO.prototype),IO=LO))||IO);Q._RF.pop(),Q._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var ZO,JO,QO,$O,eI,tI,nI,iI,aI,oI,rI,lI,sI,uI,cI,hI,pI,dI,yI=$.ccclass,fI=$.property,vI=Ie.ZERO.clone().add3f(0,-100,0),gI=Ie.ZERO.clone().add3f(0,100,0),mI=GameCore.Utils.Number,bI=(zO=yI("CoinTextPopup"),BO=fI(Se),FO=fI(he),xO=t.onlyRunInLifeCycle,UO=t.onlyRunInLifeCycle,GO=t.onlyRunInLifeCycleAsync,HO=t.onlyRunInLifeCycleAsync,zO((WO=M((qO=function(n){F(l,n);var i,a,o,r=x(l);function l(){var e;z(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),B(e,"label",WO,U(e)),B(e,"uiOpacity",KO,U(e)),e}return N(l,[{key:"__preload",value:function(){t.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(o=W((function*(e,t){this.enableNode(),this.initializePopup(e),yield this.showTextPopupAnimation(t),yield this.hidePopup(),this.disableNode()})),function(e,t){return o.apply(this,arguments)})},{key:"enableNode",value:function(){this.node.active=!0}},{key:"disableNode",value:function(){this.node.active=!1}},{key:"initializePopup",value:function(e){var t=mI.getShortNumber(e,3);this.label.string=t,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(vI)}},{key:"hidePopup",value:(a=W((function*(){this.node.setScale(Ie.ONE),this.node.setPosition(gI),yield e.runTweenAsync(ae(this.uiOpacity).to(.5,{opacity:0}))})),function(){return a.apply(this,arguments)})},{key:"showTextPopupAnimation",value:(i=W((function*(t){yield Promise.all([e.runTweenAsync(ae(this.node).to(1.5,{position:gI},{easing:"sineOut"}),t),e.runTweenAsync(ae(this.node).to(.5,{scale:Ie.ONE},{easing:"backOut"}),t)])})),function(e){return i.apply(this,arguments)})}]),l}(ce)).prototype,"label",[BO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KO=M(qO.prototype,"uiOpacity",[FO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(qO.prototype,"disableNode",[xO],Object.getOwnPropertyDescriptor(qO.prototype,"disableNode"),qO.prototype),M(qO.prototype,"initializePopup",[UO],Object.getOwnPropertyDescriptor(qO.prototype,"initializePopup"),qO.prototype),M(qO.prototype,"hidePopup",[GO],Object.getOwnPropertyDescriptor(qO.prototype,"hidePopup"),qO.prototype),M(qO.prototype,"showTextPopupAnimation",[HO],Object.getOwnPropertyDescriptor(qO.prototype,"showTextPopupAnimation"),qO.prototype),VO=qO))||VO);Q._RF.pop(),Q._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var wI,SI=$.ccclass,kI=$.disallowMultiple,CI=$.property,EI=globalThis.game,AI=EI.player,TI=EI.monitorError,PI=999999999,RI=10,OI=1,II=1,LI=(ZO=SI("CoinManager"),JO=t.required(),QO=CI(qe),$O=t.required(),eI=CI(qe),tI=t.required(),nI=CI(ge),iI=t.onlyRunInLifeCycleAsync,aI=t.onlyRunInLifeCycleAsync,oI=t.onlyRunInLifeCycleAsync,rI=t.onlyRunInLifeCycleAsync,lI=t.onlyRunInLifeCycleAsync,sI=t.onlyRunInLifeCycleAsync,ZO(uI=kI((hI=M((cI=function(n){F(c,n);var a,r,l,s,u=x(c);function c(){var e;z(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=u.call.apply(u,[this].concat(n))).coins=0,B(e,"coinPrefab",hI,U(e)),B(e,"coinTextPopup",pI,U(e)),B(e,"coinAnimContainer",dI,U(e)),e.coinObjects=[],e}return N(c,[{key:"onLoad",value:function(){t.validateRequiredProperties(this),this.getCoinsFromPlayerData(),this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(){this.updateCoins({coins:this.coins})}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(ta.ADD_COINS,this.addCoins,this),this.node.scene.on(ta.REMOVE_COINS,this.removeCoins,this),this.node.scene.on(ta.ABORT_COIN_ANIMATION,this.abortCoinAnimation,this)}},{key:"prepareCoinCollection",value:function(){for(var e=0;e<RI;e++){var t=He(this.coinPrefab);t.setParent(this.coinAnimContainer),t.setPosition(0,0),t.active=!1,this.coinObjects.push(t.getComponent(XO))}}},{key:"prepareCoinTextPopup",value:function(){var e=He(this.coinTextPopup);e.setParent(this.node),e.active=!1,this.coinTextPopupNode=e.getComponent(bI)}},{key:"handleCollectionAnim",value:(s=W((function*(t,n,i,a,r){var l=this;if(n){var s=this.coinObjects.slice(0,this.getShortAmount(t));if(0===s.length)return console.warn("Requested coins amount is ".concat(t,". Shortened to ").concat(this.getShortAmount(t),". No coin objects was found to animate collection.")),void(null==TI||TI.sendException(new Error("Requested coins amount is ".concat(t,". Shortened to ").concat(this.getShortAmount(t),". No coin objects was found to animate collection.")),{coins:t,animatedCoins:s.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!n,coinCollectionCount:this.coinObjects.length}));o.playSound(vn.COLLECT_STOCK_COINS),yield Promise.all([this.playCoinFlyAndexplodeAnimation(n,s,i,a,r),e.waitTweenAsync(i+a/2,r).then((function(){return l.animateCoinTextPopup(t,r)}))]),r.abort()}else console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played")})),function(e,t,n,i,a){return s.apply(this,arguments)})},{key:"playCoinFlyAndexplodeAnimation",value:(l=W((function*(t,n,i,a,o){var r=this,l=i+a;yield Promise.all([].concat(j(n.flatMap((function(n){n.node.active=!0,n.stopParticles();var l=[0,.5*Math.min(i,a)],s=Ge.apply(void 0,l),u=i-s,c=a+s;return[r.animateCoinExplode(n.node,u,o),e.waitTweenAsync(u,o).then((function(){return r.animateCoinFlyBack(t,n,c,o)}))]}))),[e.waitTweenAsync(l,o).then((function(){return t.emitExplodeEffect(o)}))]))})),function(e,t,n,i,a){return l.apply(this,arguments)})},{key:"animateCoinTextPopup",value:function(e,t){return this.coinTextPopupNode.show(e,t)}},{key:"animateCoinFlyBack",value:(r=W((function*(t,n,i,a){var o=n.node.worldPosition.clone(),r=Ie.ZERO.clone(),l=t.getCoinIconWorldScale();yield e.runTweenAsync(ae(n.node).to(i,{scale:l},{onStart:function(){n.playSpinAnimationAfterDelay(0,a),n.playTrailParticles()},onUpdate:function(e,i){if(void 0!==i){var a=ue.cubicIn(i),l=t.getCoinIconWorldPosition();n.node.worldPosition=Ie.lerp(r,o,l,a)}},onComplete:function(){n.emittingParticles.stopSystem(),n.stopAnimation(),n.hide()}}),a),yield e.waitTweenAsync(1,a),n.resetDisabled()})),function(e,t,n,i){return r.apply(this,arguments)})},{key:"animateCoinExplode",value:(a=W((function*(t,n,i){var a=[-200,200],o=[-200,200],r=Ge(a[0],a[1]),l=Ge(o[0],o[1]);t.setPosition(0,0,t.position.z),t.setScale(Ie.ZERO);var s=new Ie(r,l,t.position.z);yield Promise.all([e.runTweenAsync(ae(t).delay(.1*n).to(.8*n,{scale:Ie.ONE},{easing:"elasticOut"}),i),e.runTweenAsync(ae(t).to(n,{position:s},{easing:"circOut"}),i)])})),function(e,t,n){return a.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var e=AI.getGameData();this.coins=e?e.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(e){var t,n;if(this.coins>PI&&(this.coins=PI),e.coins!==this.coins){var a=Math.max(0,e.coins-this.coins);this.coins=e.coins,AI.setGameData({coins:this.coins});var o=e.collectionAnimation;null===(t=this.collectionAnimSignal)||void 0===t||t.abort();var r=new i;if(this.collectionAnimSignal=r,null==o||null===(n=o.signal)||void 0===n||n.chain(r),void 0===o||o.animateTextOnly)this.node.scene.emit(ta.COIN_CHANGED,G(G({},e),{},{collectionAnimation:{animateTextOnly:!0,signal:null==o?void 0:o.signal}}));else{var l=o.floatDuration,s=void 0===l?OI:l,u=o.flyDuration,c=void 0===u?II:u,h=o.target,p=void 0===h?this.targetContainer:h;this.collectionAnimSignal=r,this.targetContainer=p;var d=G(G({},e),{},{collectionAnimation:{floatDuration:s,flyDuration:c,animateTextOnly:!1,signal:r,target:p}});this.node.scene.emit(ta.COIN_CHANGED,d),this.handleCollectionAnim(a,this.targetContainer,s,c,r)}}}},{key:"addCoins",value:function(e){this.updateCoins(G(G({},e),{},{coins:this.coins+e.coins}))}},{key:"removeCoins",value:function(e){this.coins<e.coins?this.node.scene.emit(ta.REMOVE_COINS_FAILED):(this.updateCoins(G(G({},e),{},{coins:this.coins-e.coins})),this.node.scene.emit(ta.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(ta.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(e){return Math.min(e,RI)}},{key:"abortCoinAnimation",value:function(){var e;null===(e=this.collectionAnimSignal)||void 0===e||e.abort()}},{key:"untilFinishesCollectAnim",value:function(){return void 0===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(e){this.targetContainer=e}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var e;null===(e=this.collectionAnimSignal)||void 0===e||e.abort()}}]),c}(ce)).prototype,"coinPrefab",[JO,QO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pI=M(cI.prototype,"coinTextPopup",[$O,eI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dI=M(cI.prototype,"coinAnimContainer",[tI,nI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(cI.prototype,"handleCollectionAnim",[iI],Object.getOwnPropertyDescriptor(cI.prototype,"handleCollectionAnim"),cI.prototype),M(cI.prototype,"playCoinFlyAndexplodeAnimation",[aI],Object.getOwnPropertyDescriptor(cI.prototype,"playCoinFlyAndexplodeAnimation"),cI.prototype),M(cI.prototype,"animateCoinTextPopup",[oI],Object.getOwnPropertyDescriptor(cI.prototype,"animateCoinTextPopup"),cI.prototype),M(cI.prototype,"animateCoinFlyBack",[rI],Object.getOwnPropertyDescriptor(cI.prototype,"animateCoinFlyBack"),cI.prototype),M(cI.prototype,"animateCoinExplode",[lI],Object.getOwnPropertyDescriptor(cI.prototype,"animateCoinExplode"),cI.prototype),M(cI.prototype,"untilFinishesCollectAnim",[sI],Object.getOwnPropertyDescriptor(cI.prototype,"untilFinishesCollectAnim"),cI.prototype),uI=cI))||uI)||uI);Q._RF.pop(),Q._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),Q._RF.pop(),Q._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),Q._RF.pop(),Q._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),Q._RF.pop(),Q._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),Q._RF.pop(),Q._RF.push({},"c20acgKcuRFP6+Am/XjOFeP","ParticleSystem2DExtra",void 0);var _I,DI=$.ccclass,MI=$.disallowMultiple,NI=$.executeInEditMode,zI=$.requireComponent,BI=DI("ParticleSystem2DExtra")(wI=NI(!0)(wI=MI(!0)(wI=zI(Ae)(wI=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).emitParticle=function(t){return function(n){t(n);var i=e.particleSystem._simulator.particles.length,a=e.particleSystem._simulator.particles[i-1];e.initParticle(a)}},e.step=function(t){return function(n){for(var i=e.particleSystem._simulator.particles,a=0;a<i.length;a++){var o=i[a];e.updateParticle(o,n)}t(n)}},e}return N(i,[{key:"__preload",value:function(){this.particleSystem=this.getComponent(Ae),this.validateRequiredComponents(),this.overrideFunctions()}},{key:"overrideFunctions",value:function(){var e=this.particleSystem._simulator.emitParticle.bind(this.particleSystem._simulator);this.particleSystem._simulator.emitParticle=this.emitParticle(e);var t=this.particleSystem._simulator.step.bind(this.particleSystem._simulator);this.particleSystem._simulator.step=this.step(t)}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}}]),i}(ce))||wI)||wI)||wI)||wI;Q._RF.pop(),Q._RF.push({},"664feJL84ZOTaM99dgWY4x0","ExampleParticleSystem2DExtra",void 0);var FI;(0,$.ccclass)("ExampleParticleSystem2DExtra")(_I=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"initParticle",value:function(e){e.maxSize=Te.randomRange(.25,1)*e.size,e.size=0,e.deltaSize=0,e.cycleDuration=Te.randomRange(.4,.6),e.life=e.timeToLive,this.setInitPosition(e.pos)}},{key:"updateParticle",value:function(e,t){this.updateScale(e)}},{key:"setInitPosition",value:function(e){var t=e.x,n=e.y;return e.x=t+Te.randomRange(-350,350),e.y=n+Te.randomRange(-350,350),e}},{key:"updateScale",value:function(e){var t=1-(e.life-e.timeToLive)%e.cycleDuration/e.cycleDuration;e.size=e.maxSize*Math.sin(t*Math.PI)}}]),n}(BI));Q._RF.pop(),Q._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var xI,UI,GI,HI,VI,qI,WI,KI,jI,YI,XI,ZI=$.ccclass,JI=$.disallowMultiple,QI=GameCore,$I=QI.Events,eL=QI.Configs,tL=QI.Utils.Valid,nL=globalThis.game,iL=nL.ads,aL=nL.player,oL=nL.event;ZI("BootScene")(FI=JI(FI=function(e){F(a,e);var t,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=i.call.apply(i,[this].concat(n))).processWhenGameSdkStarted=function(){e.setupGameData(),e.processPreloadAssets()},e.handlePauseAudio=function(){oL.on($I.VISIBILITY_HIDDEN,e.handleMuteAudio),oL.on($I.VISIBILITY_VISIBLE,e.handleUnMuteAudio)},e.handleMuteAudio=function(){o.muteAudio(!0)},e.handleUnMuteAudio=function(){iL.isAdFullSizeShowing()||o.muteAudio(!1)},e}return N(a,[{key:"__preload",value:function(){this.listenEvents(),this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart()}},{key:"onLoad",value:function(){this.handlePauseAudio(),eL.Core.StartSDKAfterLoadGame||b.showLoadingFullScreen(A.BOOT_SCENE)}},{key:"start",value:function(){this.processCrazyGamesLoadingStop()}},{key:"listenEvents",value:function(){oL.catchUp($I.GAME_SDK_STARTED,this.processWhenGameSdkStarted)}},{key:"setupGameData",value:function(){var e=aL.getGameData();if(e){var t=e.totalLevel,n=Math.max(t,g),i=G(G({},e),{},{totalLevel:n});aL.setGameData(i)}}},{key:"processPreloadAssets",value:(t=W((function*(){try{yield this.loadCurrentPlayerTheme()}catch(e){console.error("loadCurrentPlayerTheme",e)}})),function(){return t.apply(this,arguments)})},{key:"loadCurrentPlayerTheme",value:function(){var e=Is.mapOrder,t=e[0];if(tL.isObject(t)){var i=aL.getGameData(),a=null==i?void 0:i.level;if(!tL.isNumber(a))return n.loadThemeAsync(t.theme);var o,r=H(e);try{for(r.s();!(o=r.n()).done;){var l=o.value;if((a-=l.levelCount)<=0){t=l;break}}}catch(e){r.e(e)}finally{r.f()}return n.loadThemeAsync(t.theme)}}},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}}]),a}(ce))||FI);Q._RF.pop(),Q._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var rL,lL,sL,uL,cL,hL,pL,dL,yL,fL,vL,gL,mL=$.ccclass,bL=$.property;xI=mL("RigidBodyObject"),UI=bL(ne),GI=bL(Oe),HI=bL(ne),VI=bL(ye),xI((KI=M((WI=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"gravityScale",KI,U(e)),B(e,"linearVelocity",jI,U(e)),B(e,"bounce",YI,U(e)),B(e,"simulate",XI,U(e)),e}return N(n,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(at).getComponent(ee),this.uiTransform=this.node.getComponent(ee)}},{key:"update",value:function(e){if(this.simulate){this.applyGravity();var t=this.node.worldPosition.clone();t.add(new Ie(this.linearVelocity.x*e,this.linearVelocity.y*e,0)),t=this.applyBounce(t),this.node.setWorldPosition(t)}}},{key:"applyForce",value:function(e){this.linearVelocity.add(e)}},{key:"applyGravity",value:function(){var e=new Oe(0,-9.8*this.gravityScale);this.applyForce(e)}},{key:"applyBounce",value:function(e){var t=this.uiTransform.getBoundingBoxToWorld();t.yMin<0&&(e.y=t.height/2,this.linearVelocity.y*=-this.bounce),t.xMin<0&&(e.x=t.width/2,this.linearVelocity.x*=-1);var n=this.canvas.width;return t.xMax>n&&(e.x=n-t.width/2,this.linearVelocity.x*=-1),e}}]),n}(ce)).prototype,"gravityScale",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),jI=M(WI.prototype,"linearVelocity",[GI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Oe(0,0)}}),YI=M(WI.prototype,"bounce",[HI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XI=M(WI.prototype,"simulate",[VI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qI=WI));Q._RF.pop(),Q._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var wL,SL,kL,CL,EL,AL,TL,PL,RL,OL,IL,LL,_L,DL,ML,NL,zL=$.ccclass,BL=$.property,FL=$.disallowMultiple,xL=function(){},UL=(rL=zL("AnimSkipOverlay"),lL=BL(he),sL=BL(he),uL=BL(fe),cL=t.onlyRunInLifeCycleAsync,hL=t.onlyRunInLifeCycleAsync,pL=t.onlyRunInLifeCycleAsync,rL(dL=FL((fL=M((yL=function(n){F(r,n);var i,a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),B(e,"containerUIOpacity",fL,U(e)),B(e,"maskUIOpacity",vL,U(e)),B(e,"skipButton",gL,U(e)),e.isOpened=!1,e.currentCallback=xL,e}return N(r,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"open",value:(a=W((function*(e){this.containerUIOpacity.node.active=!0;var t=e.onSkip,n=e.opacity,i=void 0===n?255:n,a=e.transitionDuration,o=void 0===a?.2:a;this.maskUIOpacity.opacity=i,yield this.animateUIOpacity(0,255,o),this.currentCallback=t,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(l.OPENED_SKIP_OVERLAY,e)})),function(e){return a.apply(this,arguments)})},{key:"close",value:(i=W((function*(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.skipButton.interactable=!1,this.currentCallback=xL,yield this.animateUIOpacity(255,0,e),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(l.CLOSED_SKIP_OVERLAY)})),function(){return i.apply(this,arguments)})},{key:"animateUIOpacity",value:function(t,n,i){return this.containerUIOpacity.opacity=t,e.runTweenAsync(ae(this.containerUIOpacity).to(i,{opacity:n}))}},{key:"untilClosed",value:function(){var e=this;return!1===this.isOpened?Promise.resolve():new Promise((function(t){e.node.scene.once(l.CLOSED_SKIP_OVERLAY,t)}))}}]),r}(ce)).prototype,"containerUIOpacity",[lL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vL=M(yL.prototype,"maskUIOpacity",[sL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gL=M(yL.prototype,"skipButton",[uL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(yL.prototype,"open",[cL],Object.getOwnPropertyDescriptor(yL.prototype,"open"),yL.prototype),M(yL.prototype,"close",[hL],Object.getOwnPropertyDescriptor(yL.prototype,"close"),yL.prototype),M(yL.prototype,"untilClosed",[pL],Object.getOwnPropertyDescriptor(yL.prototype,"untilClosed"),yL.prototype),dL=yL))||dL)||dL);Q._RF.pop(),Q._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var GL,HL,VL,qL,WL,KL,jL,YL,XL,ZL=$.ccclass,JL=$.property,QL=GameCore.Utils.Number,$L=(wL=ZL("CoinContainer"),SL=JL(Se),kL=JL(le),CL=JL(he),EL=JL(Ae),AL=t.onlyRunInLifeCycle,TL=t.onlyRunInLifeCycleAsync,PL=t.onlyRunInLifeCycleAsync,RL=t.onlyRunInLifeCycle,OL=t.onlyRunInLifeCycle,wL((_L=M((LL=function(n){F(u,n);var a,r,l,s=x(u);function u(){var e;z(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),B(e,"coinLabel",_L,U(e)),B(e,"coinIcon",DL,U(e)),B(e,"explosionCircle",ML,U(e)),B(e,"explosionParticles",NL,U(e)),e.currentCoin=0,e}return N(u,[{key:"setCoinTextFromNumber",value:function(e){var t=QL.getShortNumber(e,3);this.coinLabel.string=t}},{key:"handleAddCoinButton",value:function(){b.openScreen(w.GET_COIN_SCREEN,{quantity:Ss})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(ta.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(l=W((function*(e){var t,n,a,o=e.coins,r=e.collectionAnimation,l=e.playSound;if(void 0!==r&&!1!==this.node.activeInHierarchy){var s=r.signal;if(null===(t=this.animAbortSignal)||void 0===t||t.abort(),this.animAbortSignal=null!=s?s:new i,r.animateTextOnly)return yield this.animateCoinText(o,0,l,s),void this.setCoins(o);var u=null!==(n=r.flyDuration)&&void 0!==n?n:0,c=(null!==(a=r.floatDuration)&&void 0!==a?a:0)+u;yield this.animateCoinText(o,c,l,s),this.setCoins(o)}else this.setCoins(o)})),function(e){return l.apply(this,arguments)})},{key:"setCoins",value:function(e){this.setCoinTextFromNumber(e),this.currentCoin=e}},{key:"animateCoinText",value:(r=W((function*(t,n){var i=this,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=arguments.length>3?arguments[3]:void 0,l=this.currentCoin;yield e.waitTweenAsync(n,r),a&&o.playSound(vn.COLLECT_COINS),yield e.runOnUpdateAsync(this.node,1,(function(e){var n=Math.round(l+(t-l)*e);i.setCoinTextFromNumber(n)}),r)})),function(e,t){return r.apply(this,arguments)})},{key:"emitExplodeEffect",value:(a=W((function*(t){this.initializeExplosionCircle(),this.explosionParticles.resetSystem(),yield Promise.all([e.runTweenAsync(ae(this.explosionCircle.node).to(.4,{scale:new Ie(3,3,3)},{easing:"quadOut"}),t),e.runTweenAsync(ae(this.explosionCircle).delay(.2).to(.2,{opacity:0}),t)]),this.resetExplosionCircle()})),function(e){return a.apply(this,arguments)})},{key:"resetExplosionCircle",value:function(){this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0}},{key:"initializeExplosionCircle",value:function(){this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0)}},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var e;null===(e=this.animAbortSignal)||void 0===e||e.abort()}}]),u}(ce)).prototype,"coinLabel",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DL=M(LL.prototype,"coinIcon",[kL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ML=M(LL.prototype,"explosionCircle",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NL=M(LL.prototype,"explosionParticles",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(LL.prototype,"setCoins",[AL],Object.getOwnPropertyDescriptor(LL.prototype,"setCoins"),LL.prototype),M(LL.prototype,"animateCoinText",[TL],Object.getOwnPropertyDescriptor(LL.prototype,"animateCoinText"),LL.prototype),M(LL.prototype,"emitExplodeEffect",[PL],Object.getOwnPropertyDescriptor(LL.prototype,"emitExplodeEffect"),LL.prototype),M(LL.prototype,"resetExplosionCircle",[RL],Object.getOwnPropertyDescriptor(LL.prototype,"resetExplosionCircle"),LL.prototype),M(LL.prototype,"initializeExplosionCircle",[OL],Object.getOwnPropertyDescriptor(LL.prototype,"initializeExplosionCircle"),LL.prototype),IL=LL))||IL);Q._RF.pop(),Q._RF.push({},"95ba56f1qVFfLLdPv++OfLw","SmoothScrollView",void 0);var e_,t_=$.ccclass,n_=$.property,i_=(GL=t_("SmoothScrollView"),HL=n_({type:ye,group:"Mouse Scroll"}),VL=n_({type:ne,group:"Mouse Scroll",visible:function(){return this.mouseScroll}}),qL=n_({type:ne,group:"Mouse Scroll",visible:function(){return this.mouseScroll}}),GL((jL=M((KL=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"mouseScroll",jL,U(e)),B(e,"mouseScrollSpeed",YL,U(e)),B(e,"mouseScrollDuration",XL,U(e)),e}return N(n,[{key:"_onMouseWheel",value:function(e,t){if(this.mouseScroll){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(e,t)){var i=new Ie,a=e.getScrollY()<0?1:-1;this.vertical?i.set(0,a*this.mouseScrollSpeed,0):this.horizontal&&i.set(a*this.mouseScrollSpeed,0,0),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._startAutoScroll(i,this.mouseScrollDuration,!0),this._stopPropagationIfTargetIsMe(e)}}else V(q(n.prototype),"_onMouseWheel",this).call(this,e,t)}}]),n}(ot)).prototype,"mouseScroll",[HL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YL=M(KL.prototype,"mouseScrollSpeed",[VL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),XL=M(KL.prototype,"mouseScrollDuration",[qL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),WL=KL))||WL);Q._RF.pop(),Q._RF.push({},"904917NfYBJy781QxKjEPIO","ViewNode",void 0);var a_,o_,r_,l_,s_,u_,c_,h_,p_,d_,y_,f_,v_,g_,m_,b_,w_,S_,k_,C_,E_=$.ccclass,A_=$.requireComponent,T_=E_("ViewNode")(e_=A_(he)(e_=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).order=0,e}return N(i,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"setVisible",value:function(e){this.uiOpacity.opacity=e?255:0}},{key:"isVisible",value:function(){return this.uiOpacity.opacity>0}}]),i}(ce))||e_)||e_;Q._RF.pop(),Q._RF.push({},"0b250nSw/RHRq8vKigzgfhs","ScrollViewLayout",void 0);var P_,R_,O_,I_,L_,__,D_,M_,N_,z_,B_,F_,x_,U_,G_,H_,V_,q_,W_,K_,j_,Y_,X_,Z_,J_,Q_,$_,eD,tD,nD,iD,aD,oD=$.ccclass,rD=$.property,lD=$.requireComponent,sD=GameCore.Utils.Array,uD=(a_=oD("ScrollViewLayout"),o_=lD(i_),r_=rD(ee),l_=rD(ne),s_=rD(qe),u_=rD(te),c_=rD(te),h_=t.onlyRunInLifeCycleAsync,p_=t.onlyRunInLifeCycleAsync,d_=t.onlyRunInLifeCycleAsync,y_=t.onlyRunInLifeCycle,f_=t.onlyRunInLifeCycle,v_=t.onlyRunInLifeCycle,a_(g_=o_((b_=M((m_=function(n){F(s,n);var a,o,r,l=x(s);function s(){var e;z(this,s);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=l.call.apply(l,[this].concat(n)),B(e,"viewport",b_,U(e)),B(e,"spacing",w_,U(e)),B(e,"nodePrefab",S_,U(e)),B(e,"maxNodeCount",k_,U(e)),B(e,"extendCount",C_,U(e)),e.nodePool=[],e.nodeHeight=0,e.scrollSignal=new i,e.onNodeVisible=function(){},e.onNodeInvisible=function(){},e}return N(s,[{key:"__preload",value:function(){this.scrollView=this.getComponent(i_),this.uiTransform=this.getComponent(ee)}},{key:"start",value:function(){var e=He(this.nodePrefab);this.nodeHeight=e.getComponent(ee).height,e.destroy(),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"init",value:function(e,t){this.createNodePool(),this.onNodeVisible=null!=e?e:this.onNodeVisible,this.onNodeInvisible=null!=t?t:this.onNodeInvisible;for(var n=0;n<this.nodePool.length;n++)this.nodePool[n].setVisible(!1);this.updateVisibility()}},{key:"updateNodeVisibility",value:function(){for(var e=0;e<this.nodePool.length;e++)this.nodePool[e].isVisible()?this.onNodeVisible(this.nodePool[e]):this.onNodeInvisible(this.nodePool[e])}},{key:"listenEvents",value:function(){this.scrollView.node.on(ot.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.on(rt.TOUCH_MOVE,this.abortScrollSignal,this),this.scrollView.node.on(rt.MOUSE_WHEEL,this.abortScrollSignal,this)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(ot.EventType.SCROLLING,this.updateVisibility,this),this.scrollView.node.off(rt.TOUCH_MOVE,this.abortScrollSignal,this),this.scrollView.node.off(rt.MOUSE_WHEEL,this.abortScrollSignal,this)}},{key:"scrollToOrder",value:(r=W((function*(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=this.getNodeScrollOffset(e),a=this.scrollView.getScrollOffset().y,o=(i=Math.max(i,0))-(a=Math.max(a,0));Math.abs(o)<5||(yield this.scrollToOffset(new Oe(0,i),n,t))})),function(e,t){return r.apply(this,arguments)})},{key:"scrollToTop",value:(o=W((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;yield this.scrollToOffset(new Oe(0,0),t,e)})),function(e){return o.apply(this,arguments)})},{key:"scrollToOffset",value:(a=W((function*(t,n,a){var o=new i;this.scrollSignal=o,this.scrollView.scrollToOffset(t,n),o.addAbortListener(this.handleScrollSignalAborted.bind(this)),a.addAbortListener(this.handleExternalSignalAborted.bind(this,t,o)),yield e.waitTweenAsync(n,a)})),function(e,t,n){return a.apply(this,arguments)})},{key:"updateVisibility",value:function(){for(var e=this.viewport.getBoundingBoxToWorld(),t=e.yMax,n=e.yMin,i=0;i<this.maxNodeCount;i++){var a=this.getNodeBoundingBoxWorld(i),o=a.top,r=a.bot;if(o<n||r>t){var l=this.getNodeByOrder(i);l&&(this.onNodeInvisible(l),l.setVisible(!1))}else{var s=this.getNodeByOrder(i);if(s)s.isVisible()||(s.order=i,this.onNodeVisible(s),s.setVisible(!0));else{var u=this.getInvisibleNode();u&&(u.node.setPosition(this.getNodePosition(i)),u.order=i,this.onNodeVisible(u),u.setVisible(!0))}}}}},{key:"updateLayout",value:function(){var e,t=this.getVisibleNodes(),n=H(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.node.setPosition(this.getNodePosition(i.order))}}catch(e){n.e(e)}finally{n.f()}}},{key:"setMaxNodeCount",value:function(e){this.maxNodeCount=e,this.scrollView.content.getComponent(ee).height=(this.nodeHeight+this.spacing)*this.maxNodeCount}},{key:"getAllNodes",value:function(){return this.nodePool}},{key:"getVisibleNodes",value:function(){return this.nodePool.filter((function(e){return e.isVisible()}))}},{key:"getNodePosition",value:function(e){return new Ie(0,-(this.nodeHeight+this.spacing)*e-this.nodeHeight/2,0)}},{key:"getNodeScrollOffset",value:function(e){return-this.getNodePosition(e).y-this.uiTransform.node.worldPosition.y-this.uiTransform.height/2+this.viewport.node.worldPosition.y}},{key:"getNodeByOrder",value:function(e){return sD.search(this.nodePool,(function(t){return t.order===e}))}},{key:"getInvisibleNode",value:function(){return sD.search(this.nodePool,(function(e){return!e.isVisible()}))}},{key:"createNodePool",value:function(){if(!(this.nodePool.length>0)){var e=Math.ceil(this.viewport.height/this.nodeHeight)+1+this.extendCount;this.setMaxNodeCount(this.maxNodeCount);for(var t=0;t<e;t++){var n,i=He(this.nodePrefab);null===(n=this.scrollView.content)||void 0===n||n.addChild(i),i.setPosition(this.getNodePosition(this.nodePool.length));var a=i.addComponent(T_);a.order=t,a.setVisible(!1),this.nodePool.push(a)}}}},{key:"getNodeBoundingBoxWorld",value:function(e){var t,n,i=this.getNodePosition(e).y+(null!==(t=null===(n=this.scrollView.content)||void 0===n?void 0:n.worldPosition.y)&&void 0!==t?t:0);return{top:i+this.nodeHeight/2,bot:i-this.nodeHeight/2}}},{key:"abortScrollSignal",value:function(){this.scrollSignal.abort()}},{key:"handleScrollSignalAborted",value:function(){this.scrollView.stopAutoScroll(),this.updateVisibility()}},{key:"handleExternalSignalAborted",value:function(e,t){t.aborted||(this.scrollView.stopAutoScroll(),this.scrollView.scrollToOffset(e,0),this.updateVisibility())}}]),s}(ce)).prototype,"viewport",[r_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w_=M(m_.prototype,"spacing",[l_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S_=M(m_.prototype,"nodePrefab",[s_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k_=M(m_.prototype,"maxNodeCount",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),C_=M(m_.prototype,"extendCount",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),M(m_.prototype,"scrollToOrder",[h_],Object.getOwnPropertyDescriptor(m_.prototype,"scrollToOrder"),m_.prototype),M(m_.prototype,"scrollToTop",[p_],Object.getOwnPropertyDescriptor(m_.prototype,"scrollToTop"),m_.prototype),M(m_.prototype,"scrollToOffset",[d_],Object.getOwnPropertyDescriptor(m_.prototype,"scrollToOffset"),m_.prototype),M(m_.prototype,"updateVisibility",[y_],Object.getOwnPropertyDescriptor(m_.prototype,"updateVisibility"),m_.prototype),M(m_.prototype,"handleScrollSignalAborted",[f_],Object.getOwnPropertyDescriptor(m_.prototype,"handleScrollSignalAborted"),m_.prototype),M(m_.prototype,"handleExternalSignalAborted",[v_],Object.getOwnPropertyDescriptor(m_.prototype,"handleExternalSignalAborted"),m_.prototype),g_=m_))||g_)||g_);Q._RF.pop(),Q._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var cD,hD,pD,dD,yD,fD,vD,gD,mD,bD,wD,SD=$.ccclass,kD=$.property,CD=$.disallowMultiple,ED=$.requireComponent,AD=(P_=SD("DashboardPage"),R_=ED(ie),O_=ED(he),I_=t.required(),L_=kD({type:ge,displayName:"Page's container"}),__=t.required(),D_=t.required(),M_=kD({type:ge,displayName:"Placeholder"}),N_=t.required(),z_=kD({displayName:"Don't create prefab",tooltip:"Tell the component to not create the prefab even if it hasn't create yet"}),B_=kD({displayName:"Darken background"}),F_=kD({type:te,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),x_=kD({displayName:"Use navbar shadow"}),U_=kD({type:te,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),G_=t.required(),H_=t.required(),V_=t.onlyRunInLifeCycleAsync,q_=t.onlyRunInLifeCycle,W_=t.onlyRunInLifeCycleAsync,P_(K_=CD(K_=R_(K_=O_((Y_=M((j_=function(n){F(l,n);var i,a,o=x(l);function l(){var e;z(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),B(e,"container",Y_,U(e)),B(e,"containerUIOpacity",X_,U(e)),B(e,"placeholder",Z_,U(e)),B(e,"placeholderUIOpacity",J_,U(e)),B(e,"hasCreated",Q_,U(e)),e.pagePrefab=null,B(e,"darkenBackground",$_,U(e)),B(e,"backgroundOpacity",eD,U(e)),B(e,"useNavbarShadow",tD,U(e)),B(e,"navbarShadowOpacity",nD,U(e)),B(e,"uiOpacity",iD,U(e)),B(e,"widgetComponent",aD,U(e)),e}return N(l,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(he),this.widgetComponent=this.getComponent(ie),this.containerUIOpacity=this.container.getComponent(he),this.placeholderUIOpacity=this.placeholder.getComponent(he),t.validateRequiredProperties(this)}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(a=W((function*(){this.hasCreated||(yield this.create()),this.mountInLifeCycle()})),function(){return a.apply(this,arguments)})},{key:"mountInLifeCycle",value:function(){this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,r.trackCurrentPage(this.node.name,!0)}},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return!0}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(i=W((function*(){if(this.pagePrefab&&!this.hasCreated){var t=He(this.pagePrefab);this.container.addChild(t),yield e.waitTweenAsync(0),this.hasCreated=!0}})),function(){return i.apply(this,arguments)})}]),l}(ce)).prototype,"container",[I_,L_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X_=M(j_.prototype,"containerUIOpacity",[__],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z_=M(j_.prototype,"placeholder",[D_,M_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J_=M(j_.prototype,"placeholderUIOpacity",[N_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q_=M(j_.prototype,"hasCreated",[z_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$_=M(j_.prototype,"darkenBackground",[B_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),eD=M(j_.prototype,"backgroundOpacity",[F_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),tD=M(j_.prototype,"useNavbarShadow",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nD=M(j_.prototype,"navbarShadowOpacity",[U_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),iD=M(j_.prototype,"uiOpacity",[G_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aD=M(j_.prototype,"widgetComponent",[H_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(j_.prototype,"mount",[V_],Object.getOwnPropertyDescriptor(j_.prototype,"mount"),j_.prototype),M(j_.prototype,"mountInLifeCycle",[q_],Object.getOwnPropertyDescriptor(j_.prototype,"mountInLifeCycle"),j_.prototype),M(j_.prototype,"create",[W_],Object.getOwnPropertyDescriptor(j_.prototype,"create"),j_.prototype),K_=j_))||K_)||K_)||K_)||K_);Q._RF.pop(),Q._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var TD,PD,RD,OD,ID,LD,_D,DD,MD,ND,zD,BD,FD,xD,UD,GD,HD,VD=$.ccclass,qD=$.property,WD=(cD=VD("ThemeProgressBar"),hD=qD(ge),pD=qD(ge),dD=qD(ge),yD=qD(ge),cD((gD=M((vD=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"progressBar",gD,U(e)),B(e,"progressText",mD,U(e)),B(e,"leftCap",bD,U(e)),B(e,"rightCap",wD,U(e)),e}return N(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(e,t){e<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var n=this.progressBar.getComponent(Re);if(!n)throw new Error("ThemeProgressBar: progressBarComponent not found");n.progress=e/t;var i=this.progressText.getComponent(Se);if(!i)throw new Error("ThemeProgressBar: progressTextComponent not found");i.string="".concat(e,"/").concat(t)}}]),n}(ce)).prototype,"progressBar",[hD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mD=M(vD.prototype,"progressText",[pD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bD=M(vD.prototype,"leftCap",[dD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wD=M(vD.prototype,"rightCap",[yD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fD=vD))||fD);Q._RF.pop(),Q._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var KD,jD,YD,XD,ZD,JD,QD,$D,eM,tM,nM,iM,aM,oM,rM,lM,sM,uM,cM,hM,pM,dM,yM,fM,vM,gM,mM,bM=$.ccclass,wM=$.disallowMultiple,SM=$.property,kM=[50,160],CM=(TD=bM("LockAnimator"),PD=SM(Ae),RD=SM(Fe),OD=SM(it),ID=SM(it),LD=SM(it),_D=SM(es),DD=SM({type:te,min:0}),TD(MD=wM((zD=M((ND=function(n){F(l,n);var i,a,o,r=x(l);function l(){var e;z(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),B(e,"floatingParticles",zD,U(e)),B(e,"iconAnimation",BD,U(e)),B(e,"lockClip",FD,U(e)),B(e,"unlockClip",xD,U(e)),B(e,"tryToUnlockClip",UD,U(e)),B(e,"trailTemplate",GD,U(e)),B(e,"trailCount",HD,U(e)),e.trails=[],e}return N(l,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(o=W((function*(e){this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem(),yield this.playAnimation(this.unlockClip.name,e),this.floatingParticles.stopSystem()})),function(e){return o.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var t=this;return Promise.all(this.trails.map((function(n){return e.runTweenAsync(t.getExplodeTrail(n))})))}},{key:"getExplodeTrail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ge(0,2*Math.PI),i=Ge(kM[0],kM[1])*Math.cos(n),a=Ge(kM[0],kM[1])*Math.sin(n),o=new Ie(i,a,e.node.position.z),r=e.node.scale.clone();return ae(e.node).delay(t).call((function(){e.node.setPosition(0,0),e.reset(),e.node.active=!0})).to(.5,{position:o.clone()},{easing:"expoOut"}).to(.5,{scale:new Ie(0,0,1)},{easing:"expoIn"}).call((function(){e.node.setPosition(0,0),e.node.scale=r,e.reset(),e.node.active=!1}))}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var e=0;e<this.trailCount;e++){var t=He(this.trailTemplate.node);t.setParent(this.node),t.active=!1,this.trails.push(t.getComponent(es))}}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"playAnimation",value:(a=W((function*(e,t){var n=this;return null!=t&&t.aborted?Promise.resolve():new Promise((function(i){n.iconAnimation.once(Fe.EventType.FINISHED,(function(){i()})),null==t||t.addAbortListener((function(){n.iconAnimation.off(Fe.EventType.FINISHED),n.iconAnimation.stop(),i()})),n.iconAnimation.play(e)}))})),function(e,t){return a.apply(this,arguments)})},{key:"playTryToUnlockAnimation",value:(i=W((function*(){return this.playAnimation(this.tryToUnlockClip.name)})),function(){return i.apply(this,arguments)})}]),l}(ce)).prototype,"floatingParticles",[PD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BD=M(ND.prototype,"iconAnimation",[RD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FD=M(ND.prototype,"lockClip",[OD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xD=M(ND.prototype,"unlockClip",[ID],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UD=M(ND.prototype,"tryToUnlockClip",[LD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GD=M(ND.prototype,"trailTemplate",[_D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HD=M(ND.prototype,"trailCount",[DD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),MD=ND))||MD)||MD);Q._RF.pop(),Q._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var EM,AM,TM,PM,RM,OM,IM,LM,_M,DM,MM,NM,zM,BM=$.ccclass,FM=$.property,xM={progress:0,max:10,isLocked:!0,theme:E.SUMMER,skins:[yk.FRUIT]},UM=GameCore.Utils.Array,GM=(KD=BM("ThemeBlock"),jD=FM(ge),YD=FM(ge),XD=FM(CM),ZD=FM({type:ge,group:"Container"}),JD=FM({type:he,group:"Container"}),QD=FM({type:ge,group:"Theme"}),$D=FM({type:le,group:"Theme"}),eM=FM({type:p,group:"Title"}),tM=FM({type:he,group:"Title"}),nM=FM({type:le,group:"Tile"}),iM=FM({type:he,group:"Tile"}),aM=FM(ye),oM=t.onlyRunInLifeCycleAsync,KD((sM=M((lM=function(a){F(c,a);var o,r,l,s,u=x(c);function c(){var e;z(this,c);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=u.call.apply(u,[this].concat(n)),B(e,"mask",sM,U(e)),B(e,"progressBar",uM,U(e)),B(e,"lockAnimator",cM,U(e)),B(e,"container",hM,U(e)),B(e,"containerOpacity",pM,U(e)),B(e,"themeLoadingRing",dM,U(e)),B(e,"themeSprite",yM,U(e)),B(e,"titleLocalizer",fM,U(e)),B(e,"titleOpacity",vM,U(e)),B(e,"tileBlockIconSprite",gM,U(e)),B(e,"newTilesOpacity",mM,U(e)),e.signal=new i,e.payload=xM,e}return N(c,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(e){this.payload.isLocked=e,this.updateInfo()}},{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"updateInfo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xM;this.payload=e;var t=e.progress,n=e.max,a=e.isLocked,o=e.theme,r=e.skins;this.signal.abort();var l=new i;this.signal=l,this.updateTitle(o),this.updateSkinAsync(r,l),this.updateThemeAsync(o,l);var s=this.progressBar.getComponent(WD);if(!s)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=a,this.progressBar.active=!a,this.lockAnimator.node.active=a,a||s.setProgress(t,n)}},{key:"playUnlockAnim",value:(s=W((function*(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:xM;this.payload=G(G({},t),{},{isLocked:!1});var n=t.progress,i=t.max,a=this.progressBar.getComponent(WD);if(!a)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,a.setProgress(n,i),yield this.animateUnlockedState(e)})),function(e){return s.apply(this,arguments)})},{key:"updateTitle",value:function(e){var t=yO[e];this.titleLocalizer.key=t}},{key:"updateSkinAsync",value:(l=W((function*(e,t){var i=this.tileBlockIconSprite.length,a=e.length,o=e.map(function(){var e=W((function*(e){return yield n.loadSkinPreviewAsync(e)}));return function(t){return e.apply(this,arguments)}}()),r=yield Promise.all(o);if(!t.aborted&&this.tileBlockIconSprite)if(a<=i){for(var l=Math.floor(i/a),s=i%a,u=j(UM.fillWith(a,(function(){return l}))),c=0;c<s;c++)u[c]++;for(var h=0,p=0;p<a;p++)for(var d=0;d<u[p]&&h<i;d++,h++)this.tileBlockIconSprite[h].spriteFrame=r[p][d]}else this.tileBlockIconSprite.forEach((function(e,t){e.spriteFrame=r[t%a][0]}))})),function(e,t){return l.apply(this,arguments)})},{key:"updateThemeAsync",value:(r=W((function*(e,t){this.themeSprite.spriteFrame=null;var i=n.getAsset("".concat(T[e],"/spriteFrame"),Be);i||(this.themeLoadingRing.active=!0,i=yield n.loadThemePreviewAsync(e)),i||(i=yield n.loadThemePreviewAsync(E.SUMMER)),this.themeSprite&&i&&!t.aborted&&(this.themeSprite.spriteFrame=i,this.themeLoadingRing.active=!1)})),function(e,t){return r.apply(this,arguments)})},{key:"animateUnlockedState",value:(o=W((function*(t){var n,i=this.mask.getComponent(he),a=this.progressBar.getComponent(he);if(!i)throw new Error("ThemeBlock: maskUIOpacity not found");if(!a)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,i.opacity=null!==(n=i.opacity)&&void 0!==n?n:255,this.progressBar.active=!0,a.opacity=0,yield this.lockAnimator.unlock(t),this.lockAnimator.node.active=!1,yield Promise.all([e.runTweenAsync(ae(i).to(.25,{opacity:0}),t),e.runTweenAsync(ae(a).to(.25,{opacity:255}),t)]),this.mask.active=!1,i.opacity=0,a.opacity=255})),function(e){return o.apply(this,arguments)})},{key:"setVisible",value:function(e){this.containerOpacity.opacity=e?255:0,this.titleOpacity.opacity=e?255:0,this.newTilesOpacity.opacity=e?255:0}}]),c}(ce)).prototype,"mask",[jD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uM=M(lM.prototype,"progressBar",[YD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cM=M(lM.prototype,"lockAnimator",[XD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hM=M(lM.prototype,"container",[ZD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pM=M(lM.prototype,"containerOpacity",[JD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dM=M(lM.prototype,"themeLoadingRing",[QD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yM=M(lM.prototype,"themeSprite",[$D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fM=M(lM.prototype,"titleLocalizer",[eM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vM=M(lM.prototype,"titleOpacity",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gM=M(lM.prototype,"tileBlockIconSprite",[nM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mM=M(lM.prototype,"newTilesOpacity",[iM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(lM.prototype,"isLocked",[aM],Object.getOwnPropertyDescriptor(lM.prototype,"isLocked"),lM.prototype),M(lM.prototype,"updateSkinAsync",[oM],Object.getOwnPropertyDescriptor(lM.prototype,"updateSkinAsync"),lM.prototype),rM=lM))||rM);Q._RF.pop(),Q._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var HM,VM,qM,WM,KM,jM,YM,XM,ZM,JM=$.ccclass,QM=$.property,$M=globalThis.game.storage,eN=(EM=JM("CollectionsContent"),AM=QM(Ta),TM=QM(uD),PM=QM(mi),RM=QM({type:ne,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),OM=t.onlyRunInLifeCycleAsync,IM=t.onlyRunInLifeCycleAsync,EM((DM=M((_M=function(e){F(o,e);var n,i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=a.call.apply(a,[this].concat(n))).animateThemeBlockUnlockIndex=null,B(e,"panelAnimator",DM,U(e)),B(e,"themeScrollView",MM,U(e)),B(e,"contentOpacity",NM,U(e)),e.themeScrollViewInited=!1,e.payloads=[],e.preservedScrollPosition=new Oe,B(e,"offsetFromTopOfScrollView",zM,U(e)),e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return N(o,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.node.scene.on(ta.HIDE_UI,this.hideContent),this.node.scene.on(ta.SHOW_UI,this.showContent),this.themeScrollView.listenEvents()}},{key:"unlistenEvents",value:function(){this.unlistenUIEvents(),this.themeScrollView.unlistenEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(ta.HIDE_UI,this.hideContent),this.node.scene.off(ta.SHOW_UI,this.showContent)}},{key:"init",value:function(e){var t=this;this.payloads=e,this.themeScrollViewInited||(this.themeScrollViewInited=!0,this.themeScrollView.init((function(e){var n=t.animateThemeBlockUnlockIndex===e.order,i=t.payloads[e.order],a=e.getComponent(GM);a.updateInfo(G(G({},i),{},{isLocked:!!n||i.isLocked})),a.setVisible(!0),a.container.scale=new Ie(.4,.4,.4),ae(a.container).to(.3,{scale:Ie.ONE},{easing:"quadOut"}).start()})))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.scrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.scrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(e){var t=this,n=$M.getStorageData("collection","animateMapPackUnlock"),i=$M.getStorageData("collection","lastMapPack");e.forEach((function(e,a){var o=e.progress,r=e.max,l=e.isLocked;if(o<r&&!l&&n&&i!==a+1)return t.animateThemeBlockUnlockIndex=a,$M.setStorageData("collection","animateMapPackUnlock",!1),void $M.setStorageData("collection","lastMapPack",a+1)}))}},{key:"shouldAnimateThemeBlockUnlock",value:function(){return null!==this.animateThemeBlockUnlockIndex}},{key:"playThemeTabUnlockAnim",value:(i=W((function*(e){if(this.animateThemeBlockUnlockIndex){var t=this.themeScrollView.getNodeByOrder(this.animateThemeBlockUnlockIndex);if(t&&t.isVisible()){var n=t.getComponent(GM);if(n){var i=Ns.getCollectionUnlockProgress()[this.animateThemeBlockUnlockIndex];yield n.playUnlockAnim(e,G(G({},i),{},{isLocked:!0})),this.animateThemeBlockUnlockIndex=null}}}})),function(e){return i.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(n=W((function*(e,t){yield this.themeScrollView.scrollToOrder(e,t)})),function(e,t){return n.apply(this,arguments)})},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}}]),o}(ce)).prototype,"panelAnimator",[AM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MM=M(_M.prototype,"themeScrollView",[TM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NM=M(_M.prototype,"contentOpacity",[PM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zM=M(_M.prototype,"offsetFromTopOfScrollView",[RM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),M(_M.prototype,"playThemeTabUnlockAnim",[OM],Object.getOwnPropertyDescriptor(_M.prototype,"playThemeTabUnlockAnim"),_M.prototype),M(_M.prototype,"scrollToCurrentUnlockingTheme",[IM],Object.getOwnPropertyDescriptor(_M.prototype,"scrollToCurrentUnlockingTheme"),_M.prototype),LM=_M))||LM);Q._RF.pop(),Q._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var tN,nN,iN,aN,oN,rN,lN,sN,uN,cN,hN,pN,dN,yN,fN,vN,gN,mN,bN,wN,SN,kN,CN,EN,AN,TN,PN,RN,ON,IN,LN,_N,DN,MN,NN,zN,BN,FN,xN,UN=(HM=(0,$.ccclass)("CollectionsPage"),VM=t.required(),qM=t.onlyRunInLifeCycleAsync,WM=t.onlyRunInLifeCycle,KM=t.onlyRunInLifeCycleAsync,jM=t.onlyRunInLifeCycleAsync,HM((ZM=M((XM=function(t){F(l,t);var n,i,a,o,r=x(l);function l(){var e;z(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=r.call.apply(r,[this].concat(n))).payload=null,B(e,"panelAnimationController",ZM,U(e)),e}return N(l,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(wa),V(q(l.prototype),"onLoad",this).call(this)}},{key:"start",value:(o=W((function*(){V(q(l.prototype),"start",this).call(this)})),function(){return o.apply(this,arguments)})},{key:"setPayload",value:function(e){this.payload=e}},{key:"mount",value:(a=W((function*(){yield V(q(l.prototype),"mount",this).call(this),this.onMount()})),function(){return a.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(eN),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload);var e=Ns.getCollectionUnlockProgress();this.themeContent.updateUnlockedProgress(e)}},{key:"transitionIn",value:(i=W((function*(){yield V(q(l.prototype),"transitionIn",this).call(this),this.themeContent.restoreScrollPosition(),this.themeContent.listenEvents();var t=e.runTweenAsync(ae(this.containerUIOpacity).to(.2,{opacity:255})),n=this.panelAnimationController.showUI();yield Promise.all([t,n])})),function(){return i.apply(this,arguments)})},{key:"transitionOut",value:(n=W((function*(){yield V(q(l.prototype),"transitionOut",this).call(this),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents(),yield this.panelAnimationController.hideUI(),this.themeContent.unlistenEvents()})),function(){return n.apply(this,arguments)})}]),l}(AD)).prototype,"panelAnimationController",[VM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(XM.prototype,"mount",[qM],Object.getOwnPropertyDescriptor(XM.prototype,"mount"),XM.prototype),M(XM.prototype,"onMount",[WM],Object.getOwnPropertyDescriptor(XM.prototype,"onMount"),XM.prototype),M(XM.prototype,"transitionIn",[KM],Object.getOwnPropertyDescriptor(XM.prototype,"transitionIn"),XM.prototype),M(XM.prototype,"transitionOut",[jM],Object.getOwnPropertyDescriptor(XM.prototype,"transitionOut"),XM.prototype),YM=XM))||YM);Q._RF.pop(),Q._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var GN,HN,VN,qN,WN,KN,jN,YN,XN,ZN,JN,QN,$N,ez=$.ccclass,tz=$.property,nz=$.disallowMultiple,iz=$.requireComponent,az=GameCore.Utils.Array,oz=(tN=ez("PageManagerItem"),nN=tz(AD),iN=tz({type:se(ln)}),tN((rN=M((oN=N((function e(){z(this,e),B(this,"page",rN,this),B(this,"pageType",lN,this)}))).prototype,"page",[nN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lN=M(oN.prototype,"pageType",[iN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aN=oN))||aN),rz=(sN=ez("PageManager"),uN=iz(ee),cN=t.required(),hN=tz({type:he,displayName:"Background Mask",group:"Background Mask"}),pN=tz({type:ne,displayName:"Transition duration",group:"Background Mask"}),dN=tz({type:ne,displayName:"Transition delay",group:"Background Mask"}),yN=t.required(),fN=tz({type:he,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),vN=tz({type:ne,displayName:"Transition duration",group:"Nav Bar Shadow"}),gN=tz({type:ne,displayName:"Transition delay",group:"Nav Bar Shadow"}),mN=tz({type:[oz]}),bN=tz({type:se(ln)}),wN=t.required(),SN=t.onlyRunInLifeCycleAsync,kN=t.onlyRunInLifeCycleAsync,CN=t.onlyRunInLifeCycle,EN=t.onlyRunInLifeCycle,AN=t.onlyRunInLifeCycle,TN=t.onlyRunInLifeCycleAsync,PN=t.onlyRunInLifeCycleAsync,RN=t.onlyRunInLifeCycleAsync,sN(ON=nz(ON=uN((LN=M((IN=function(n){F(y,n);var i,a,o,r,s,u,c,h,p,d=x(y);function y(){var e;z(this,y);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=d.call.apply(d,[this].concat(n)),B(e,"backgroundMask",LN,U(e)),B(e,"backgroundMaskTransitionDuration",_N,U(e)),B(e,"backgroundMaskTransitionDelay",DN,U(e)),B(e,"navBarShadow",MN,U(e)),B(e,"navBarShadowTransitionDuration",NN,U(e)),B(e,"navBarShadowTransitionDelay",zN,U(e)),B(e,"pageItems",BN,U(e)),B(e,"currentScreen",FN,U(e)),B(e,"uiTransform",xN,U(e)),e}return N(y,[{key:"unmountAndHideAll",value:function(){var e=this;this.pageItems.forEach((function(t){var n=t.page;t.pageType!==e.currentScreen&&(n.unmount(),n.hide())}))}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(ee),t.validateRequiredProperties(this),be.on(l.VIEW_RESIZED,this.init,this)}},{key:"onDestroy",value:function(){be.off(l.VIEW_RESIZED,this.init,this)}},{key:"init",value:function(){var e=this;this.pageItems.forEach((function(t,n){var i=t.page.getWidget(),a=e.getPageIndex(e.currentScreen);i.right=-(n-a)*e.uiTransform.width,i.left=(n-a)*e.uiTransform.width,i.updateAlignment()}))}},{key:"updateCollectionsContentPayload",value:function(e){var t=this.getPage(ln.collections);t&&t instanceof UN&&t.setPayload(e)}},{key:"navigate",value:(p=W((function*(e,t,n,i){var a=e.from,o=e.to;null!==a?yield this.navigateFromPage(a,o,t,n,i):yield this.navigateFromNull(o,n,i)})),function(e,t,n,i){return p.apply(this,arguments)})},{key:"navigateFromPage",value:(h=W((function*(e,t,n,i,a){var o=this,r=this.validateNavigationRequest(e,t),l=r.toPage,s=r.fromPage;this.currentScreen=t;var u=this.uiTransform.width,c=this.getPageIndex(e),h=this.getPageIndex(t),p=Math.min(c,h),d=Math.max(c,h),y=(d-p)*u,f=c<h?1:-1,v=this.pageItems.slice(p,d+1);v.forEach((function(e,t){var n=e.page;n.show(),n.getWidget().enabled=!1,n.node.position=new Ie((t+p-c)*u,n.node.position.y,n.node.position.z)}));var g=!l.hasLoadedPage();g&&this.showLoadingScreen(),yield this.mountPage(l,i),yield n.callAsync((function(){return o.performFullTransition({from:e,to:t,fromPage:s,toPage:l,distance:y,direction:f,items:v})})),n.call((function(){return o.cleanupPages(l,v.filter((function(e){return e.pageType!==t})))})),yield n.callAsync((function(){return o.transitionInPage(l,a)})),g&&this.hideLoadingScreen()})),function(e,t,n,i,a){return h.apply(this,arguments)})},{key:"hideLoadingScreen",value:function(){b.closeLoadingScreen()}},{key:"showLoadingScreen",value:function(){b.showLoadingScreen()}},{key:"cleanupPages",value:function(e,t){var n=e.getWidget();n.enabled=!0,n.left=0,n.right=0,Pe.instance.emit("canvas-resize"),t.forEach((function(e){e.page.unmount(),e.page.hide()}))}},{key:"performFullTransition",value:(c=W((function*(e){var t=e.from,n=e.to,i=e.fromPage,a=e.distance,o=e.direction,r=e.items,l=e.toPage;this.node.scene.emit(Nt,{from:t,to:n}),yield Promise.all([i.transitionOut(),this.transition(a,o,r),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,l.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,l.getNavbarShadow())])})),function(e){return c.apply(this,arguments)})},{key:"mountPage",value:(u=W((function*(e,t){yield e.mount(),yield null==t?void 0:t(e)})),function(e,t){return u.apply(this,arguments)})},{key:"validateNavigationRequest",value:function(e,t){if(e!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");var n=this.getPage(this.currentScreen),i=this.getPage(t);if(!i||!n)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");return{toPage:i,fromPage:n}}},{key:"navigateFromNull",value:(s=W((function*(e,t,n){var i=this.getPage(this.currentScreen);i.show(),this.currentScreen=e,yield this.mountPage(i,t),this.node.scene.emit(Nt,{from:null,to:e}),yield this.transitionInPage(i,n)})),function(e,t,n){return s.apply(this,arguments)})},{key:"transitionInPage",value:(r=W((function*(e,t){yield e.transitionIn(),yield null==t?void 0:t(e)})),function(e,t){return r.apply(this,arguments)})},{key:"getPage",value:function(e){var t=this.getPageIndex(e);return-1!==t?this.pageItems[t].page:null}},{key:"handleBackgroundMask",value:(o=W((function*(t,n){yield e.runTweenAsync(ae(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(t,{opacity:n}).start())})),function(e,t){return o.apply(this,arguments)})},{key:"handleNavBarShadow",value:(a=W((function*(t,n){yield e.runTweenAsync(ae(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(t,{opacity:n}).start())})),function(e,t){return a.apply(this,arguments)})},{key:"getPageIndex",value:function(e){return az.searchIndex(this.pageItems,(function(t){return t.pageType===e}))}},{key:"transition",value:(i=W((function*(t,n,i){yield Promise.all(i.map((function(i){var a=i.page;return e.runTweenAsync(ae(a.node).to(.5,{position:new Ie(a.node.position.x-t*n,a.node.position.y,a.node.position.z)},{easing:ue.quintInOut}))})))})),function(e,t,n){return i.apply(this,arguments)})}]),y}(ce)).prototype,"backgroundMask",[cN,hN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_N=M(IN.prototype,"backgroundMaskTransitionDuration",[pN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),DN=M(IN.prototype,"backgroundMaskTransitionDelay",[dN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),MN=M(IN.prototype,"navBarShadow",[yN,fN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NN=M(IN.prototype,"navBarShadowTransitionDuration",[vN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),zN=M(IN.prototype,"navBarShadowTransitionDelay",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),BN=M(IN.prototype,"pageItems",[mN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FN=M(IN.prototype,"currentScreen",[bN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ln.home}}),xN=M(IN.prototype,"uiTransform",[wN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(IN.prototype,"navigate",[SN],Object.getOwnPropertyDescriptor(IN.prototype,"navigate"),IN.prototype),M(IN.prototype,"navigateFromPage",[kN],Object.getOwnPropertyDescriptor(IN.prototype,"navigateFromPage"),IN.prototype),M(IN.prototype,"hideLoadingScreen",[CN],Object.getOwnPropertyDescriptor(IN.prototype,"hideLoadingScreen"),IN.prototype),M(IN.prototype,"showLoadingScreen",[EN],Object.getOwnPropertyDescriptor(IN.prototype,"showLoadingScreen"),IN.prototype),M(IN.prototype,"cleanupPages",[AN],Object.getOwnPropertyDescriptor(IN.prototype,"cleanupPages"),IN.prototype),M(IN.prototype,"performFullTransition",[TN],Object.getOwnPropertyDescriptor(IN.prototype,"performFullTransition"),IN.prototype),M(IN.prototype,"mountPage",[PN],Object.getOwnPropertyDescriptor(IN.prototype,"mountPage"),IN.prototype),M(IN.prototype,"navigateFromNull",[RN],Object.getOwnPropertyDescriptor(IN.prototype,"navigateFromNull"),IN.prototype),ON=IN))||ON)||ON)||ON);Q._RF.pop(),Q._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var lz,sz,uz,cz,hz,pz,dz=$.ccclass,yz=$.property,fz=(GN=dz("StarProgressBar"),HN=yz(Qo),VN=yz(Se),qN=yz(te),WN=yz(te),KN=yz(Le),GN((XN=M((YN=function(t){F(a,t);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"progressBar",XN,U(e)),B(e,"progressLabel",ZN,U(e)),B(e,"current",JN,U(e)),B(e,"total",QN,U(e)),B(e,"separator",$N,U(e)),e}return N(a,[{key:"setRange",value:function(e,t){this.total=t,this.current=e,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string="".concat(this.current).concat(this.separator).concat(this.total)}},{key:"animateTo",value:(n=W((function*(t,n,i){var a=this,o=Math.min(t,this.total)/this.total,r=this.current,l=1,s=ae(this.progressBar).to(3,{progress:o},{easing:"quadOut",onUpdate:function(e,n){n&&(a.current=r+Math.floor((t-r)*n),null==i||i(a.current),a.current===r-l&&(l++,ae(a.progressLabel.node).to(.05,{scale:new Ie(1.2,1.2,1.2)}).to(.05,{scale:Ie.ONE}).start()),a.updateProgressLabel())}});null==n||n.addAbortListener((function(){a.current=t,a.updateProgress()})),yield e.runTweenAsync(s,n)})),function(e,t,i){return n.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),a}(ce)).prototype,"progressBar",[HN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZN=M(YN.prototype,"progressLabel",[VN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JN=M(YN.prototype,"current",[qN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QN=M(YN.prototype,"total",[WN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$N=M(YN.prototype,"separator",[KN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jN=YN))||jN);Q._RF.pop(),Q._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var vz,gz,mz,bz,wz,Sz,kz,Cz,Ez,Az,Tz,Pz=$.ccclass,Rz=$.property,Oz=(lz=Pz("EventButton"),sz=Rz({type:se(iO)}),uz=Rz(ye),lz((pz=M((hz=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"eventType",pz,U(e)),e._isAvailable=!1,e}return N(n,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(e){this._isAvailable=e,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(zt,{type:this.eventType})}},{key:"setAnimationState",value:function(e){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),V(q(n.prototype),"setAnimationState",this).call(this,e)}}]),n}(hi)).prototype,"eventType",[sz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return iO.STAR_CHEST}}),M(hz.prototype,"isAvailable",[uz],Object.getOwnPropertyDescriptor(hz.prototype,"isAvailable"),hz.prototype),cz=hz))||cz);Q._RF.pop(),Q._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var Iz,Lz,_z,Dz,Mz,Nz,zz,Bz,Fz,xz,Uz,Gz,Hz,Vz,qz,Wz,Kz,jz,Yz=$.ccclass,Xz=$.property,Zz=globalThis.game.player,Jz=(vz=Yz("DashboardHeader"),gz=Xz({type:fz,displayName:"Progress bar",group:"Star Chest"}),mz=Xz({type:Oz,displayName:"Button Component",group:"Star Chest"}),bz=Xz({type:it,displayName:"Default Rest animation",group:"Star Chest"}),wz=Xz({type:it,displayName:"Special Rest animation",group:"Star Chest"}),vz((Cz=M((kz=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"starProgressBar",Cz,U(e)),B(e,"chestButton",Ez,U(e)),B(e,"defaultRestAnimation",Az,U(e)),B(e,"specialRestAnimation",Tz,U(e)),e.handleStarsUpdateEvent=function(t){var n,i=null!=t?t:null===(n=Zz.getGameData())||void 0===n?void 0:n.stars;void 0!==i&&(e.starProgressBar.setRange(i,20),e.updateStarChestButtonAnimation(i))},e}return N(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),be.on(_t,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function(){be.off(_t,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function(e){this.handleStarsUpdateEvent(e)}},{key:"updateStarChestButtonAnimation",value:function(e){this.chestButton.isAvailable=e>=20}},{key:"validateRequiredComponents",value:function(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}},{key:"handleClickedSettingsButton",value:function(){b.openScreen(w.SETTINGS_SCREEN)}}]),n}(ce)).prototype,"starProgressBar",[gz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ez=M(kz.prototype,"chestButton",[mz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Az=M(kz.prototype,"defaultRestAnimation",[bz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tz=M(kz.prototype,"specialRestAnimation",[wz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sz=kz))||Sz);Q._RF.pop(),Q._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var Qz,$z,eB,tB,nB,iB,aB,oB,rB,lB,sB,uB,cB=$.ccclass,hB=$.property,pB=$.executeInEditMode,dB=(Iz=cB("JourneyLevelAvatar"),Lz=hB({type:le,displayName:"Avatar node"}),_z=hB(ge),Dz=hB(Fe),Mz=hB(he),Nz=hB({type:it,group:"Animation"}),zz=hB({type:it,group:"Animation"}),Bz=hB({type:it,group:"Animation"}),Fz=hB({type:Be,displayName:"Avatar sprite"}),Iz(xz=pB((Gz=M((Uz=function(t){F(r,t);var n,i,a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),B(e,"sprite",Gz,U(e)),B(e,"lockIcon",Hz,U(e)),B(e,"animation",Vz,U(e)),B(e,"opacity",qz,U(e)),B(e,"flashAnimation",Wz,U(e)),B(e,"unlockAnimation",Kz,U(e)),B(e,"spawnAnimation",jz,U(e)),e}return N(r,[{key:"avatarSprite",get:function(){var e,t;return null!==(e=null===(t=this.sprite)||void 0===t?void 0:t.spriteFrame)&&void 0!==e?e:null},set:function(e){this.sprite&&(this.sprite.spriteFrame=e)}},{key:"playUnlockAnimation",value:(a=W((function*(){var t=this.playAnimation(this.unlockAnimation),n=this.lockIcon.position.x,i=this.lockIcon.position.y,a=[45,135],o=(Math.random()*(a[1]-a[0])+a[0])*(Math.PI/180),r=this.lockIcon.position.x+150*Math.cos(o),l=this.lockIcon.position.y+150*Math.sin(o),s=i-400,u=e.runTweenAsync(ae(this.lockIcon).delay(.3).to(.2,{position:new Ie(r,l,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new Ie(r,s,this.lockIcon.position.z)},{easing:"cubicIn"})),c=[0,360],h=e.runTweenAsync(ae(this.lockIcon).delay(.3).to(.6,{eulerAngles:new Ie(0,0,Math.random()*(c[1]-c[0])*(r>n?-1:1))},{easing:"sineOut"}));yield Promise.all([t,u,h]),this.lockIcon.position=new Ie(n,i,this.lockIcon.position.z),this.lockIcon.eulerAngles=new Ie(0,0,0)})),function(){return a.apply(this,arguments)})},{key:"playFlashAnimation",value:(i=W((function*(t){var n=this.node.position.y,i=this.playAnimation(this.flashAnimation),a=e.runTweenAsync(ae(this.node).to(.1,{position:new Ie(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new Ie(this.node.position.x,n,this.node.position.z)},{easing:"sineIn"}),t);yield Promise.all([i,a])})),function(e){return i.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(Ie.ZERO)}},{key:"playAnimation",value:(n=W((function*(t){yield e.runAnimationAsync(this.animation,t.name)})),function(e){return n.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var e=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some((function(t){return null!==t&&(t.name===e.flashAnimation.name||t.name===e.unlockAnimation.name||t.name===e.spawnAnimation.name)})))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),r}(ce)).prototype,"sprite",[Lz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hz=M(Uz.prototype,"lockIcon",[_z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vz=M(Uz.prototype,"animation",[Dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qz=M(Uz.prototype,"opacity",[Mz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wz=M(Uz.prototype,"flashAnimation",[Nz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kz=M(Uz.prototype,"unlockAnimation",[zz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jz=M(Uz.prototype,"spawnAnimation",[Bz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(Uz.prototype,"avatarSprite",[Fz],Object.getOwnPropertyDescriptor(Uz.prototype,"avatarSprite"),Uz.prototype),xz=Uz))||xz)||xz);Q._RF.pop(),Q._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var yB,fB,vB,gB,mB,bB,wB,SB,kB,CB,EB,AB,TB,PB,RB,OB,IB,LB,_B,DB,MB,NB,zB=$.ccclass,BB=$.property,FB=$.executeInEditMode,xB=(Qz=zB("JourneyProgressBar"),$z=BB(Qo),eB=BB(Se),tB=BB(he),nB=BB(te),iB=BB(te),aB=BB(Le),Qz(oB=FB((lB=M((rB=function(t){F(a,t);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"progressBar",lB,U(e)),B(e,"progressLabel",sB,U(e)),B(e,"labelUIOpacity",uB,U(e)),e.currentProgress=10,e.totalProgress=10,e.labelSeparator="/",e}return N(a,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(e){this.labelSeparator=e,this.updateProgress()}},{key:"setRange",value:function(e,t){this.totalProgress=t;var n=e;n>t&&(n=t),this.currentProgress=n,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(n=W((function*(t){var n=this,i=t.nextCurr,a=t.nextTotal,o=t.numberOfProgressBar,r=void 0===o?0:o,l=t.onProgressBarPassed,s=t.signal,u=i/a,c=ae(this.labelUIOpacity).to(.2,{opacity:0}),h=ae(this.labelUIOpacity).to(.2,{opacity:255}),p=r<1?1:Math.sqrt(r)+1,d=0===r?u:r+u,y=1,f=this.progressBar.progress,v=d,g=e.runOnUpdateAsync(this.node,p,(function(e){var t=ue.sineInOut(e),i=Ke(f,v,t);n.progressBar.progress=i%1,i>y&&(y=0===i?1:Math.ceil(i),null==l||l())}),s);return yield Promise.all([e.runTweenAsync(c,s),g]),this.currentProgress=i,this.totalProgress=a,this.updateProgress(),yield e.runTweenAsync(h,s),this.labelUIOpacity.opacity=255,u})),function(e){return n.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string="".concat(this.currentProgress).concat(this.separator).concat(this.totalProgress)}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),a}(ce)).prototype,"progressBar",[$z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sB=M(rB.prototype,"progressLabel",[eB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uB=M(rB.prototype,"labelUIOpacity",[tB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(rB.prototype,"total",[nB],Object.getOwnPropertyDescriptor(rB.prototype,"total"),rB.prototype),M(rB.prototype,"current",[iB],Object.getOwnPropertyDescriptor(rB.prototype,"current"),rB.prototype),M(rB.prototype,"separator",[aB],Object.getOwnPropertyDescriptor(rB.prototype,"separator"),rB.prototype),oB=rB))||oB)||oB);Q._RF.pop(),Q._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var UB,GB,HB,VB,qB,WB,KB,jB,YB,XB,ZB,JB,QB,$B,eF,tF,nF,iF,aF,oF,rF,lF,sF,uF,cF,hF,pF,dF,yF,fF,vF,gF,mF=$.ccclass,bF=$.property,wF=(yB=mF("ProgressConfiguration"),fB=bF(Be),vB=bF(Le),yB((bB=M((mB=N((function e(){z(this,e),B(this,"avatar",bB,this),B(this,"themeId",wB,this)}))).prototype,"avatar",[fB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wB=M(mB.prototype,"themeId",[vB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gB=mB)),SB=mF("JourneyProgressAnimator"),kB=bF(xB),CB=bF(ge),EB=bF(le),AB=bF(dB),TB=bF({type:ne,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),PB=t.onlyRunInLifeCycleAsync,RB=t.onlyRunInLifeCycle,SB((LB=M((IB=function(i){F(h,i);var a,o,r,l,s,u,c=x(h);function h(){var e;z(this,h);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=c.call.apply(c,[this].concat(n)),B(e,"progressBar",LB,U(e)),B(e,"currentLevelAvatarNode",_B,U(e)),B(e,"currentLevelAvatar",DB,U(e)),B(e,"nextLevelAvatar",MB,U(e)),B(e,"nextLevelYOffset",NB,U(e)),e.isAnimating=!1,e}return N(h,[{key:"setRange",value:function(e,t){this.progressBar.setRange(e,t)}},{key:"animateTo",value:(u=W((function*(e,t){if(this.isAnimating)return console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve();this.isAnimating=!0,e!==this.progressBar.current&&(yield this.progressBar.animateTo({nextCurr:e,nextTotal:this.progressBar.total,signal:t})),this.isAnimating=!1})),function(e,t){return u.apply(this,arguments)})},{key:"animateToNextLevel",value:(s=W((function*(e){var t=this,n=e.nextCurr,i=e.nextTotal,a=e.mapsPassed,o=e.signal;if(this.isAnimating)console.warn("JourneyProgressAnimator: animation already in progress");else{this.isAnimating=!0;var r=a.length-2;if(0===r)return yield this.progressBar.animateTo({nextCurr:n,nextTotal:i,signal:o}),void(this.isAnimating=!1);yield this.animateTargetAvaToCenter(o);var l=1;yield this.progressBar.animateTo({signal:o,nextCurr:n,nextTotal:i,numberOfProgressBar:r,onProgressBarPassed:function(){if(1===l)return t.nextLevelAvatar.playUnlockAnimation(),void(l+=1);if(l>=a.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");t.nextLevelAvatar.playFlashAnimation(o),t.setNextLevelAvatar(a[l].theme),l+=1}}),yield this.animateTargetAvaToPrev(o);var s=a[a.length-1].theme,u=a[a.length-2].theme;this.setCurrentLevelAvatar(u),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=yield this.getSpriteFrameByThemeId(s),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1}})),function(e){return s.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(l=W((function*(t){var n=new Ie(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);yield e.runTweenAsync(ae(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t),this.nextLevelAvatar.node.position=n})),function(e){return l.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(r=W((function*(t){var n=this.currentLevelAvatarNode.position.clone();yield e.runTweenAsync(ae(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t),this.nextLevelAvatar.node.position=n})),function(e){return r.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:(o=W((function*(e){return n.loadThemeThumbnailAsync(e)})),function(e){return o.apply(this,arguments)})},{key:"loadAndSetAvatar",value:(a=W((function*(e,t){var n=yield this.getSpriteFrameByThemeId(e);n?this.setAvatar(n,t):console.warn("JourneyProgressAnimator: ".concat(e," is null"))})),function(e,t){return a.apply(this,arguments)})},{key:"setAvatar",value:function(e,t){t instanceof dB?t.avatarSprite=e:t.spriteFrame=e}},{key:"setCurrentLevelAvatar",value:function(e){this.loadAndSetAvatar(e,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(e){this.loadAndSetAvatar(e,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}}]),h}(ce)).prototype,"progressBar",[kB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_B=M(IB.prototype,"currentLevelAvatarNode",[CB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DB=M(IB.prototype,"currentLevelAvatar",[EB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MB=M(IB.prototype,"nextLevelAvatar",[AB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NB=M(IB.prototype,"nextLevelYOffset",[TB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),M(IB.prototype,"loadAndSetAvatar",[PB],Object.getOwnPropertyDescriptor(IB.prototype,"loadAndSetAvatar"),IB.prototype),M(IB.prototype,"setAvatar",[RB],Object.getOwnPropertyDescriptor(IB.prototype,"setAvatar"),IB.prototype),OB=IB))||OB);Q._RF.pop(),Q._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var SF,kF,CF,EF,AF,TF,PF,RF,OF,IF,LF,_F,DF,MF,NF,zF,BF,FF=$.ccclass,xF=$.property,UF=globalThis.game,GF=UF.storage,HF=UF.monitorError,VF=GameCore.Utils,qF=VF.Array,WF=VF.Json,KF=(UB=FF("HomeContent"),GB=t.required(),HB=xF({type:p,group:"Play Button"}),VB=t.required(),qB=xF({type:fe,group:"Play Button"}),WB=t.required(),KB=xF({type:ge,group:"Play Button"}),jB=t.required(),YB=xF({type:ge,group:"Play Button"}),XB=t.required(),ZB=xF(wF),JB=t.required(),QB=xF(Jz),$B=t.required(),eF=xF(he),tF=t.required(),nF=xF($L),iF=t.onlyRunInLifeCycleAsync,aF=t.onlyRunInLifeCycleAsync,oF=t.onlyRunInLifeCycleAsync,rF=t.onlyRunInLifeCycleAsync,lF=t.onlyRunInLifeCycleAsync,UB((cF=M((uF=function(n){F(s,n);var i,a,o,r,l=x(s);function s(){var e;z(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=l.call.apply(l,[this].concat(n)),B(e,"playButtonLocalizer",cF,U(e)),B(e,"playButton",hF,U(e)),B(e,"playBackground",pF,U(e)),B(e,"hardLevelBackground",dF,U(e)),B(e,"journeyProgressAnimator",yF,U(e)),B(e,"dashboardHeader",fF,U(e)),B(e,"overlayDuringAnim",vF,U(e)),B(e,"coinContainer",gF,U(e)),e}return N(s,[{key:"onLoad",value:function(){t.validateRequiredProperties(this)}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(Dt)}},{key:"setPlayButton",value:function(e){this.playButtonLocalizer.setParams([e.toString()]);var t=e%5==0;this.playBackground.active=!t,this.hardLevelBackground.active=t}},{key:"updateStarProgress",value:function(e){this.dashboardHeader.updateStarProgress(e)}},{key:"setUnlockProgress",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.setProgress(e),this.updateCurrentMapInStorage(e,t)}},{key:"shouldPlayUnlockAnimation",value:function(){var e,t,n=GF.getStorage("dashboard");if(null==n)return null==HF||HF.sendException(new Error("DashboardScene: dashboardStorage not found")),!1;if(!(null!==(e=n.animateToCurrentLevel)&&void 0!==e&&e))return!1;var i=GF.getStorage("tournament");if(null==i)return null==HF||HF.sendException(new Error("DashboardScene: tournamentStorage not found")),!1;if(null!==(t=i.animateTournamentLeader)&&void 0!==t&&t)return!1;var a=n.lastMapPayload,o=Ns.getCurrentMapProgress();return WF.encode(a)!==WF.encode(o)&&!(qF.searchIndex(Is.mapOrder,(function(e){return e.id===a.id}))>qF.searchIndex(Is.mapOrder,(function(e){return e.id===o.id})))}},{key:"playUnlockProgressAnimation",value:function(e){var t=GF.getStorage("dashboard");if(null==t)throw new Error("DashboardScene: dashboardStorage not found");var n=t.lastMapPayload,i=Ns.getCurrentMapProgress(),a=qF.searchIndex(Is.mapOrder,(function(e){return e.id===n.id})),o=qF.searchIndex(Is.mapOrder,(function(e){return e.id===i.id})),r=Is.mapOrder.slice(a,o+2);return n.id===i.id?this.playUnlockProgressAnimationOnly(i,n,e):this.playUnlockProgressAndPackAnimation(n,i,r,e)}},{key:"playUnlockProgressAndPackAnimation",value:(r=W((function*(e,t,n,i){this.setProgress(G({},e)),this.updateCurrentMapInStorage(G({},t),!0),this.playButton.interactable=!1,yield this.showOwnOverlay(i),yield this.journeyProgressAnimator.animateToNextLevel({nextCurr:t.progress,nextTotal:t.max,mapsPassed:n,signal:i}),yield this.hideOwnOverlay(i),this.playButton.interactable=!0})),function(e,t,n,i){return r.apply(this,arguments)})},{key:"playUnlockProgressAnimationOnly",value:(o=W((function*(e,t,n){this.setProgress(G(G({},e),{},{progress:t.progress})),this.updateCurrentMapInStorage(G({},e),!0);var i=e.progress;yield this.showOwnOverlay(n),yield this.journeyProgressAnimator.animateTo(i,n),yield this.hideOwnOverlay(n)})),function(e,t,n){return o.apply(this,arguments)})},{key:"hideOwnOverlay",value:(a=W((function*(t){yield e.runTweenAsync(ae(this.overlayDuringAnim).to(.3,{opacity:0}),t),this.overlayDuringAnim.opacity=0})),function(e){return a.apply(this,arguments)})},{key:"showOwnOverlay",value:(i=W((function*(t){yield e.runTweenAsync(ae(this.overlayDuringAnim).to(.3,{opacity:150}),t)})),function(e){return i.apply(this,arguments)})},{key:"setProgress",value:function(e){var t=e.currentTheme,n=e.nextTheme,i=e.progress,a=e.max;this.journeyProgressAnimator.setCurrentLevelAvatar(t),this.journeyProgressAnimator.setNextLevelAvatar(null!=n?n:t),this.journeyProgressAnimator.setRange(i,a)}},{key:"updateCurrentMapInStorage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=GF.getStorage("dashboard");if(null!=n){var i=n.animateToCurrentLevel;GF.setStorageData("dashboard","animateToCurrentLevel",!t&&i),GF.setStorageData("dashboard","lastMapPayload",e)}else null==HF||HF.sendException(new Error("DashboardScene: dashboardStorage not found"))}}]),s}(ce)).prototype,"playButtonLocalizer",[GB,HB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hF=M(uF.prototype,"playButton",[VB,qB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pF=M(uF.prototype,"playBackground",[WB,KB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dF=M(uF.prototype,"hardLevelBackground",[jB,YB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yF=M(uF.prototype,"journeyProgressAnimator",[XB,ZB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fF=M(uF.prototype,"dashboardHeader",[JB,QB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vF=M(uF.prototype,"overlayDuringAnim",[$B,eF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gF=M(uF.prototype,"coinContainer",[tF,nF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(uF.prototype,"playUnlockProgressAnimation",[iF],Object.getOwnPropertyDescriptor(uF.prototype,"playUnlockProgressAnimation"),uF.prototype),M(uF.prototype,"playUnlockProgressAndPackAnimation",[aF],Object.getOwnPropertyDescriptor(uF.prototype,"playUnlockProgressAndPackAnimation"),uF.prototype),M(uF.prototype,"playUnlockProgressAnimationOnly",[oF],Object.getOwnPropertyDescriptor(uF.prototype,"playUnlockProgressAnimationOnly"),uF.prototype),M(uF.prototype,"hideOwnOverlay",[rF],Object.getOwnPropertyDescriptor(uF.prototype,"hideOwnOverlay"),uF.prototype),M(uF.prototype,"showOwnOverlay",[lF],Object.getOwnPropertyDescriptor(uF.prototype,"showOwnOverlay"),uF.prototype),sF=uF))||sF);Q._RF.pop(),Q._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var jF,YF,XF,ZF,JF,QF,$F,ex,tx,nx,ix,ax,ox,rx,lx,sx,ux,cx,hx,px,dx,yx,fx,vx,gx,mx,bx,wx,Sx,kx,Cx,Ex,Ax,Tx=$.ccclass,Px=$.property,Rx=GameCore.Utils.Array,Ox=s.Layout,Ix=(SF=Tx("NavManager"),kF=Px(ge),CF=Px(ge),EF=Px(Lt),AF=Px({type:ie,group:"Widgets"}),TF=Px({type:ie,group:"Widgets"}),PF=Px({type:ie,group:"Widgets"}),RF=Px(ee),SF((LF=M((IF=function(t){F(u,t);var n,i,a,o,r,s=x(u);function u(){var e;z(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),B(e,"selectorNode",LF,U(e)),B(e,"selectedButtonNode",_F,U(e)),B(e,"autoLayout",DF,U(e)),B(e,"navWidget",MF,U(e)),B(e,"backgroundWidget",NF,U(e)),B(e,"layoutWidget",zF,U(e)),B(e,"uiTransform",BF,U(e)),e.navButtons=[],e.isNavigating=!1,e}return N(u,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var e;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(e=this.selectedButtonNode)||void 0===e?void 0:e.getComponentInChildren("NavButton"),be.on(l.ORIENTATION_CHANGED,this.handleOrientationChanged,this),be.on(l.VIEW_RESIZED,this.handleViewResized,this),this.handleOrientationChanged(Co.getCurrentLayout())}},{key:"onDestroy",value:function(){be.off(l.ORIENTATION_CHANGED,this.handleOrientationChanged,this),be.off(l.VIEW_RESIZED,this.handleViewResized,this)}},{key:"select",value:(r=W((function*(e){var t=this;if(!this.isNavigating){if(!Rx.has(this.navButtons,e))throw new Error("NavManager: Button not found");if(e!==this.selectedButton){if(!e.isWIP)return this.isNavigating=!0,this.node.scene.emit(Mt,{from:this.selectedButton.buttonType,to:e.buttonType}),new Promise((function(n){t.node.scene.once(Nt,(function(){var i=t.selectedButton.deselect();t.autoLayout.selectedIndex=t.navButtons.indexOf(e),t.selectedButton=e;var a=t.autoLayout.getSelectedWorldX()-e.getSelectedWorldDistanceX(),o=t.playSelectorAnimation(a),r=e.select();Promise.all([i,r,o]).then((function(){t.isNavigating=!1,n()}))}))}));this.handleWIPButton()}}})),function(e){return r.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(o=W((function*(e){this.isNavigating||(Rx.has([ln.store],e.buttonType)?this.handleWIPButton():yield this.select(e))})),function(e){return o.apply(this,arguments)})},{key:"selectByType",value:(a=W((function*(e){var t=Rx.search(this.navButtons,(function(t){return t.buttonType===e}));if(!t)throw new Error("NavManager: Button not found");yield this.selectUsingSceneTransition(t)})),function(e){return a.apply(this,arguments)})},{key:"handleWIPButton",value:function(){b.openScreen(w.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(i=W((function*(){var e=this;if(!this.currentButton||!Rx.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");var t=this.currentButton.buttonType;return this.node.scene.emit(Mt,{from:null,to:t}),new Promise((function(t){e.node.scene.once(Nt,(function(){e.autoLayout.selectedIndex=e.navButtons.indexOf(e.currentButton);var n=e.navButtons.map((function(t){return t===e.currentButton?t.select(!1):t.deselect(!1,!0)})),i=e.autoLayout.getSelectedWorldX()-e.currentButton.getSelectedWorldDistanceX();e.selectorNode.worldPosition=new Ie(i,e.selectorNode.worldPosition.y,0),Promise.all(n).then((function(){t()}))}))}))})),function(){return i.apply(this,arguments)})},{key:"playSelectorAnimation",value:(n=W((function*(t){var n=this,i=new Ie(1,1,1),a=this.selectorNode.worldPosition.clone(),o=new Ie(1.2*i.x,.8*i.y,1);yield e.runTweenAsync(ae(this.selectorNode).to(.3,{worldPosition:new Ie(t,a.y,0)},{easing:"quintInOut",onUpdate:function(e,t){if(void 0!==t){var a=n.calculateCurrentSquashScale(i,o,t);n.selectorNode.scale=a}}}))})),function(e){return n.apply(this,arguments)})},{key:"setIgnoreInput",value:function(){var e,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=H(this.navButtons);try{for(n.s();!(e=n.n()).done;){var i=e.value,a=i.getComponentInChildren(fe);a&&(a.interactable=!t)}}catch(e){n.e(e)}finally{n.f()}}},{key:"calculateCurrentSquashScale",value:function(e,t,n){var i=this.splitIntoSquashRatio(n);return e.clone().lerp(t,i)}},{key:"splitIntoSquashRatio",value:function(e){return e<.5?2*e:1-2*(e-.5)}},{key:"handleOrientationChanged",value:function(e){e===Ox.Portrait?(this.navWidget.isAlignLeft=!0,this.navWidget.isAlignRight=!0,this.backgroundWidget.left=-50,this.backgroundWidget.right=-50,this.layoutWidget.left=0,this.layoutWidget.right=0):e===Ox.Landscape&&(this.navWidget.isAlignLeft=!1,this.navWidget.isAlignRight=!1,this.backgroundWidget.left=0,this.backgroundWidget.right=0,this.layoutWidget.left=25,this.layoutWidget.right=25,this.uiTransform.width=1e3)}},{key:"handleViewResized",value:function(){this.selectedButton&&this.selectorNode.setWorldPosition(this.selectedButton.node.worldPosition.x,this.selectorNode.worldPosition.y,0)}}]),u}(ce)).prototype,"selectorNode",[kF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_F=M(IF.prototype,"selectedButtonNode",[CF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DF=M(IF.prototype,"autoLayout",[EF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MF=M(IF.prototype,"navWidget",[AF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NF=M(IF.prototype,"backgroundWidget",[TF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zF=M(IF.prototype,"layoutWidget",[PF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BF=M(IF.prototype,"uiTransform",[RF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OF=IF))||OF);Q._RF.pop(),Q._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var Lx,_x=$.ccclass,Dx=$.disallowMultiple,Mx=$.property,Nx=globalThis.game,zx=Nx.event,Bx=Nx.storage,Fx=Nx.player,xx=Nx.leaderboard,Ux=GameCore,Gx=Ux.Events,Hx=Ux.Match.Modes,Vx=Ux.Configs.DailyRewards,qx=Ux.Utils,Wx=qx.Time,Kx=qx.Array;jF=_x("DashboardScene"),YF=t.required(),XF=Mx(LI),ZF=t.required(),JF=Mx(Ix),QF=t.required(),$F=Mx(pn),ex=t.required(),tx=Mx(rz),nx=t.required(),ix=Mx(UL),ax=t.onlyRunInLifeCycle,ox=t.onlyRunInLifeCycle,rx=t.onlyRunInLifeCycleAsync,lx=t.onlyRunInLifeCycleAsync,sx=t.onlyRunInLifeCycleAsync,ux=t.onlyRunInLifeCycleAsync,cx=t.onlyRunInLifeCycle,hx=t.onlyRunInLifeCycleAsync,px=t.onlyRunInLifeCycleAsync,dx=t.onlyRunInLifeCycleAsync,yx=t.onlyRunInLifeCycleAsync,fx=t.onlyRunInLifeCycleAsync,vx=t.onlyRunInLifeCycleAsync,gx=t.onlyRunInLifeCycleAsync,mx=t.onlyRunInLifeCycle,jF(bx=Dx((Sx=M((wx=function(n){F(E,n);var a,r,l,s,u,c,h,p,d,y,f,v,g,m,S=x(E);function E(){var t;z(this,E);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return t=S.call.apply(S,[this].concat(i)),B(t,"coinManager",Sx,U(t)),B(t,"navManager",kx,U(t)),B(t,"bgComp",Cx,U(t)),B(t,"pageManager",Ex,U(t)),B(t,"pageAnimSkipOverlay",Ax,U(t)),t.firstNavigation=!0,t.isFirstNavToCollections=!0,t.isFirstNavToTournament=!0,t.navigationSignal=null,t.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch((function(e){console.warn("subscribeBotAsync",e)}))},t.playBgAnim=W((function*(){var n,i=Bx.getStorage("dashboard");if(null==i)throw new Error("DashboardScene: dashboardStorage not found");var a=null!==(n=i.animateToCurrentLevel)&&void 0!==n&&n,o=G({},i.lastMapPayload),r=Ns.getCurrentMapProgress(),l=o.currentTheme===r.currentTheme&&o.nextTheme===r.nextTheme,s=r.currentTheme;if(a&&!l){yield e.waitTweenAsync(2);try{yield t.bgComp.animateToNextTheme(s)}catch(e){}}})),t}return N(E,[{key:"__preload",value:function(){}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(Mt,this.onNavigate,this)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(Dt,this.handlePlayButtonPress,this),this.node.scene.on(zt,this.handleEventButtonPress,this)}},{key:"onLoad",value:function(){t.validateRequiredProperties(this),this.listenNavigationEvents(),this.listenDashboardEvents(),this.coinManager.init(),Ns.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(Ns.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var e,t=(null!==(e=Fx.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;n=0===n?1:n,Fx.setGameData({level:n})}},{key:"start",value:function(){Fx.getPlayerSetting("music")&&this.updateMusic(),this.playBgAnim(),this.pageManager.init(),this.navManager.selectDefaultNavBtn(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadScenes",value:function(){C.preloadGameScene()}},{key:"initBgComp",value:function(){var e,t=Bx.getStorage("dashboard");if(null==t)throw new Error("DashboardScene: dashboardStorage not found");var n=null!==(e=t.animateToCurrentLevel)&&void 0!==e&&e,i=G({},t.lastMapPayload),a=Ns.getCurrentMapProgress(),o=i.currentTheme===a.currentTheme&&i.nextTheme===a.nextTheme,r=a.currentTheme;n&&!o?this.bgComp.setCurrentTheme(i.currentTheme):this.bgComp.setCurrentTheme(r)}},{key:"handlePlayButtonPress",value:(m=W((function*(){try{var e,t=Ns.getCurrentMapProgress(),n=(null!==(e=Fx.getGameData())&&void 0!==e?e:{}).level,i=void 0===n?1:n;yield Zs.setMatchCustomDataAsync({level:i}),yield Zs.startMatchAsync(Hx.SINGLE),this.updateCurrentMapInStorage(t),Bx.setStorageData("collection","lastMapPack",t.id),Bx.setStorageData("collection","animateMapPackUnlock",!1);var a=Bx.getStorage("leaderboard_content").lastTabOpened;this.getPlayerLeader(a).then((function(e){if(e){var t=e.score;Bx.setStorageData("leaderboard_content","previousScore",t)}})),C.switchScene(A.GAME_SCENE,{level:i})}catch(e){return void console.error(e)}})),function(){return m.apply(this,arguments)})},{key:"getPlayerLeader",value:(g=W((function*(e){var t="global"===e?P.GLOBAL:P.FRIENDS;if(!t)return null;var n=Fx.getPlayerId(),i=yield xx.getLeadersByPlayerIdsAsync(t,[n]);return 0===i.length?null:i[0]})),function(e){return g.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(e){Bx.setStorageData("dashboard","animateToCurrentLevel",!1),Bx.setStorageData("dashboard","lastMapPayload",e)}},{key:"updateMusic",value:(v=W((function*(){o.getCurrentMusic()!==vn.BG_MUSIC&&(yield o.setVolumeMusic(0,!0),yield e.waitTweenAsync(1)),o.playMusic(vn.BG_MUSIC),o.turnUpMusic()})),function(){return v.apply(this,arguments)})},{key:"checkDailyRewardsOpenable",value:function(){var e=Fx.getPlayerData().dailyRewarded,t=e.logDays,n=void 0===t?[]:t,i=e.lastRewarded,a=void 0===i?0:i;if(n.length>Vx.MaxDays)return!0;if(Vx.MockTime>0&&Date.now()-a>=1e3*Vx.MockTime)return!0;return!Wx.isToday(a)}},{key:"onNavigate",value:(f=W((function*(e){switch(this.firstNavigation&&(this.firstNavigation=!1,this.pageManager.unmountAndHideAll()),e.to){case ln.store:break;case ln.collections:yield this.triggerPageNavigation(e),yield this.handleLogicAfterNavigateToCollections(),this.cleanupAfterPageNavigation();break;case ln.tournaments:case ln.leaderboard:yield this.triggerPageNavigation(e),this.cleanupAfterPageNavigation();break;case ln.home:yield this.handleNavigateToHome(e);break;default:throw new Error("DashboardScene: Unhandled page name")}})),function(e){return f.apply(this,arguments)})},{key:"handleLogicAfterNavigateToCollections",value:(y=W((function*(){var e,t=null===(e=this.pageManager.getPage(ln.collections))||void 0===e?void 0:e.getContainer().getComponentInChildren(eN);if(null==t)throw new Error("CollectionsContent not found");var n=new i,a=t.shouldAnimateThemeBlockUnlock();a&&(yield this.openSkipOverlay(n)),yield this.tryPlayScrollToCollectionAnim(t,n),yield t.playThemeTabUnlockAnim(n),a&&(yield this.closeSkipOverlay()),n.abort()})),function(){return y.apply(this,arguments)})},{key:"closeSkipOverlay",value:(d=W((function*(){yield this.pageAnimSkipOverlay.close()})),function(){return d.apply(this,arguments)})},{key:"openSkipOverlay",value:(p=W((function*(e){yield this.pageAnimSkipOverlay.open({onSkip:function(){return e.abort()},opacity:200})})),function(e){return p.apply(this,arguments)})},{key:"tryPlayScrollToCollectionAnim",value:(h=W((function*(e,t){var n=Ns.getCurrentUnlockingThemeIndex();this.isFirstNavToCollections&&null!==n&&(yield e.scrollToCurrentUnlockingTheme(n,t),this.isFirstNavToCollections=!1)})),function(e,t){return h.apply(this,arguments)})},{key:"cleanupAfterPageNavigation",value:function(){this.navManager.setIgnoreInput(!1)}},{key:"triggerPageNavigation",value:(c=W((function*(e){var t;null===(t=this.navigationSignal)||void 0===t||t.abort(),this.navigationSignal=new i,yield this.pageManager.navigate(e,this.navigationSignal)})),function(e){return c.apply(this,arguments)})},{key:"handleNavigateToHome",value:(u=W((function*(e){var t,n=this;null===(t=this.navigationSignal)||void 0===t||t.abort(),this.navigationSignal=new i,yield this.pageManager.navigate(e,this.navigationSignal,W((function*(){n.initializeHomepageCoinManager()}))),yield this.handleLogicAfterNavigateToHome()})),function(e){return u.apply(this,arguments)})},{key:"handleLogicAfterNavigateToHome",value:(s=W((function*(){yield this.tryOpenDailyRewardsScreen(),this.attemptCallSubscribeBot(),yield this.waitUntilCoinManagerFinishesAnyAnimation(),yield this.waitUntilPageAnimSkipOverlayCloses(),yield this.tryNavigateToTournament(),yield this.tryPlayLevelUpAnimation()})),function(){return s.apply(this,arguments)})},{key:"waitUntilCoinManagerFinishesAnyAnimation",value:function(){return this.coinManager.untilFinishesCollectAnim()}},{key:"waitUntilPageAnimSkipOverlayCloses",value:function(){return this.pageAnimSkipOverlay.untilClosed()}},{key:"tryNavigateToTournament",value:(l=W((function*(){if(Bx.getStorage("tournament").animateTournamentLeader)return yield this.navManager.selectByType(ln.tournaments);if(this.isFirstNavToTournament){this.isFirstNavToTournament=!1;try{if(!("getTournamentAsync"in GameSDK))throw new Error("Unavailable feature: tournament");if((yield GameSDK.getTournamentAsync()).getEndTime()<Date.now()/1e3)return yield this.navManager.selectByType(ln.tournaments)}catch(e){}}})),function(){return l.apply(this,arguments)})},{key:"tryPlayLevelUpAnimation",value:(r=W((function*(){var e,t=this,n=null===(e=this.pageManager.getPage(ln.home))||void 0===e?void 0:e.getContainer().getComponentInChildren(KF);if(null==n)throw new Error("DashboardScene: Homepage not found");var a=new i;a.chain(this.navigationSignal);var o=n.shouldPlayUnlockAnimation(),r=this.shouldPlayPackUnlockAnimation();o&&(r&&(yield this.pageAnimSkipOverlay.open({onSkip:function(){return a.abort()},opacity:150})),yield n.playUnlockProgressAnimation(a),r&&(yield this.pageAnimSkipOverlay.close(),yield a.callAsync((function(){return t.navManager.selectByType(ln.collections)}))))})),function(){return r.apply(this,arguments)})},{key:"shouldPlayPackUnlockAnimation",value:function(){var e=Bx.getStorage("dashboard");if(null==e)throw new Error("DashboardScene: dashboardStorage not found");var t=e.lastMapPayload,n=Ns.getCurrentMapProgress();return!(Kx.searchIndex(Is.mapOrder,(function(e){return e.id===t.id}))===Kx.searchIndex(Is.mapOrder,(function(e){return e.id===n.id})))}},{key:"initializeHomepageCoinManager",value:function(){var e,t=null===(e=this.pageManager.getPage(ln.home))||void 0===e?void 0:e.getContainer().getComponentInChildren(KF);if(null==t)throw new Error("DashboardScene: Homepage not found");this.coinManager.setTargetContainer(t.getCoinContainer()),this.coinManager.emitCoinAmount()}},{key:"tryOpenDailyRewardsScreen",value:(a=W((function*(){if(this.checkDailyRewardsOpenable())return b.openScreen(w.DAILY_REWARDS_SCREEN),new Promise((function(e){zx.on(Gx.CLOSED_SCREEN,(function t(n){n.screenName===k[w.DAILY_REWARDS_SCREEN]&&(e(),zx.off(Gx.CLOSED_SCREEN,t))}))}))})),function(){return a.apply(this,arguments)})},{key:"handleEventButtonPress",value:function(e){switch(e.type){case iO.STAR_CHEST:b.openScreen(w.STAR_CHEST_SCREEN);break;case iO.BALLOON:b.showNotificationScreenWithLocalizedKey("error.soon");break;default:throw new Error("DashboardScene: Unhandled event button type")}}},{key:"handleTestLayoutButtonClicked",value:function(){}}]),E}(ce)).prototype,"coinManager",[YF,XF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kx=M(wx.prototype,"navManager",[ZF,JF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cx=M(wx.prototype,"bgComp",[QF,$F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ex=M(wx.prototype,"pageManager",[ex,tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ax=M(wx.prototype,"pageAnimSkipOverlay",[nx,ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(wx.prototype,"preloadScenes",[ax],Object.getOwnPropertyDescriptor(wx.prototype,"preloadScenes"),wx.prototype),M(wx.prototype,"initBgComp",[ox],Object.getOwnPropertyDescriptor(wx.prototype,"initBgComp"),wx.prototype),M(wx.prototype,"handlePlayButtonPress",[rx],Object.getOwnPropertyDescriptor(wx.prototype,"handlePlayButtonPress"),wx.prototype),M(wx.prototype,"onNavigate",[lx],Object.getOwnPropertyDescriptor(wx.prototype,"onNavigate"),wx.prototype),M(wx.prototype,"handleLogicAfterNavigateToCollections",[sx],Object.getOwnPropertyDescriptor(wx.prototype,"handleLogicAfterNavigateToCollections"),wx.prototype),M(wx.prototype,"tryPlayScrollToCollectionAnim",[ux],Object.getOwnPropertyDescriptor(wx.prototype,"tryPlayScrollToCollectionAnim"),wx.prototype),M(wx.prototype,"cleanupAfterPageNavigation",[cx],Object.getOwnPropertyDescriptor(wx.prototype,"cleanupAfterPageNavigation"),wx.prototype),M(wx.prototype,"triggerPageNavigation",[hx],Object.getOwnPropertyDescriptor(wx.prototype,"triggerPageNavigation"),wx.prototype),M(wx.prototype,"handleNavigateToHome",[px],Object.getOwnPropertyDescriptor(wx.prototype,"handleNavigateToHome"),wx.prototype),M(wx.prototype,"waitUntilCoinManagerFinishesAnyAnimation",[dx],Object.getOwnPropertyDescriptor(wx.prototype,"waitUntilCoinManagerFinishesAnyAnimation"),wx.prototype),M(wx.prototype,"waitUntilPageAnimSkipOverlayCloses",[yx],Object.getOwnPropertyDescriptor(wx.prototype,"waitUntilPageAnimSkipOverlayCloses"),wx.prototype),M(wx.prototype,"tryNavigateToTournament",[fx],Object.getOwnPropertyDescriptor(wx.prototype,"tryNavigateToTournament"),wx.prototype),M(wx.prototype,"tryPlayLevelUpAnimation",[vx],Object.getOwnPropertyDescriptor(wx.prototype,"tryPlayLevelUpAnimation"),wx.prototype),M(wx.prototype,"tryOpenDailyRewardsScreen",[gx],Object.getOwnPropertyDescriptor(wx.prototype,"tryOpenDailyRewardsScreen"),wx.prototype),M(wx.prototype,"handleEventButtonPress",[mx],Object.getOwnPropertyDescriptor(wx.prototype,"handleEventButtonPress"),wx.prototype),bx=wx))||bx);Q._RF.pop(),Q._RF.push({},"1be4fAboTNK3IFk6IiygYLZ","PageContent",void 0);var jx,Yx,Xx,Zx,Jx,Qx=$.ccclass,$x=s.Layout;Qx("PageContent")(Lx=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"__preload",value:function(){this.widget=this.getComponent(ie),this.uiTransform=this.getComponent(ee)}},{key:"onLoad",value:function(){be.on(l.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(Co.getCurrentLayout())}},{key:"onDestroy",value:function(){be.off(l.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"handleOrientationChanged",value:function(e){e===$x.Portrait?(this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0):e===$x.Landscape&&(this.widget.isAlignLeft=!1,this.widget.isAlignRight=!1,this.uiTransform.width=1e3)}}]),n}(ce));Q._RF.pop(),Q._RF.push({},"c68178FyxlCOqbCt/+wktvw","PageHeader",void 0);var eU,tU,nU,iU,aU,oU,rU,lU,sU,uU,cU,hU,pU=$.ccclass,dU=$.property,yU=s.Layout;jx=pU("PageHeader"),Yx=dU(ie),jx((Jx=M((Zx=function(e){F(o,e);var t,i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"widget",Jx,U(e)),e}return N(o,[{key:"__preload",value:function(){Co.isLandscape()&&this.loadLeaves()}},{key:"onLoad",value:function(){be.on(l.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(Co.getCurrentLayout())}},{key:"onDestroy",value:function(){be.off(l.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"handleOrientationChanged",value:(i=W((function*(e){e===yU.Portrait?(this.leaves&&(this.leaves.active=!1),this.widget.left=-80,this.widget.right=-80):e===yU.Landscape&&(this.widget.left=0,this.widget.right=0,yield this.loadLeaves(),this.leaves&&(this.leaves.active=!0))})),function(e){return i.apply(this,arguments)})},{key:"loadLeaves",value:(t=W((function*(){if(!this.leaves){var e=yield n.loadPrefabAsync(f.PAGE_LEAVES_PREFAB);!this.leaves&&e&&(this.leaves=He(e),this.node.addChild(this.leaves))}})),function(){return t.apply(this,arguments)})}]),o}(ce)).prototype,"widget",[Yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xx=Zx));Q._RF.pop(),Q._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var fU,vU=$.ccclass,gU=$.property,mU=globalThis.game,bU=mU.player,wU=mU.storage,SU=mU.monitorError,kU=GameCore.Utils.Number;eU=vU("HomePage"),tU=t.required(),nU=gU({type:Se,group:"Placeholders"}),iU=t.required(),aU=t.onlyRunInLifeCycleAsync,oU=t.onlyRunInLifeCycle,rU=t.onlyRunInLifeCycleAsync,lU=t.onlyRunInLifeCycleAsync,eU((cU=M((uU=function(e){F(r,e);var t,n,i,a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),B(e,"coinLabel",cU,U(e)),B(e,"panelAnimationController",hU,U(e)),e}return N(r,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(wa),V(q(r.prototype),"onLoad",this).call(this)}},{key:"onEnable",value:function(){this.node.scene.on(ta.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"onDisable",value:function(){this.node.scene.off(ta.COIN_CHANGED,this.updatePlaceholderCoins,this)}},{key:"updatePlaceholderCoins",value:(a=W((function*(e){this.coinLabel.string=kU.getShortNumber(e.coins,3)})),function(e){return a.apply(this,arguments)})},{key:"mount",value:(i=W((function*(){yield V(q(r.prototype),"mount",this).call(this),this.onMount()})),function(){return i.apply(this,arguments)})},{key:"onMount",value:function(){var e,t,n;if(!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(KF),!this.homeContent))throw new Error("HomePage: homeContent not found");var i=bU.getGameData(),a=null!==(e=null==i?void 0:i.coins)&&void 0!==e?e:0;this.updatePlaceholderCoins({coins:a});var o=null!==(t=null==i?void 0:i.level)&&void 0!==t?t:1;this.homeContent.setPlayButton(o);var r=null!==(n=null==i?void 0:i.stars)&&void 0!==n?n:0;this.homeContent.updateStarProgress(r),this.initUnlockProgressData()}},{key:"initUnlockProgressData",value:function(){var e=this.homeContent.shouldPlayUnlockAnimation(),t=G({},Ns.getCurrentMapProgress()),n=wU.getStorage("dashboard");if(null==n)return null==SU||SU.sendException(new Error("DashboardScene: dashboardStorage not found")),void(e||this.homeContent.setUnlockProgress(t));var i=G({},n.lastMapPayload);e?this.homeContent.setUnlockProgress(i):this.homeContent.setUnlockProgress(t)}},{key:"transitionIn",value:(n=W((function*(){yield V(q(r.prototype),"transitionIn",this).call(this),yield this.panelAnimationController.showUI()})),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=W((function*(){yield V(q(r.prototype),"transitionOut",this).call(this),yield this.panelAnimationController.hideUI()})),function(){return t.apply(this,arguments)})},{key:"hasLoadedPage",value:function(){return!0}}]),r}(AD)).prototype,"coinLabel",[tU,nU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hU=M(uU.prototype,"panelAnimationController",[iU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(uU.prototype,"mount",[aU],Object.getOwnPropertyDescriptor(uU.prototype,"mount"),uU.prototype),M(uU.prototype,"onMount",[oU],Object.getOwnPropertyDescriptor(uU.prototype,"onMount"),uU.prototype),M(uU.prototype,"transitionIn",[rU],Object.getOwnPropertyDescriptor(uU.prototype,"transitionIn"),uU.prototype),M(uU.prototype,"transitionOut",[lU],Object.getOwnPropertyDescriptor(uU.prototype,"transitionOut"),uU.prototype),sU=uU));Q._RF.pop(),Q._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var CU,EU,AU,TU,PU,RU,OU,IU,LU,_U,DU,MU,NU,zU,BU,FU,xU,UU,GU,HU,VU=(0,$.ccclass)("LeaderboardIsEmpty")(fU=function(n){F(o,n);var i,a=x(o);function o(){return z(this,o),a.apply(this,arguments)}return N(o,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"show",value:(i=W((function*(){this.uiOpacity.opacity=255;var t=this.node.position.clone(),n=ae(this.node);n.to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)});var i=ae(this.node).repeat(2,n);i.to(.05,{position:t}),yield e.runTweenAsync(i)})),function(){return i.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),o}(ce))||fU;Q._RF.pop(),Q._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var qU,WU,KU,jU,YU,XU,ZU,JU=$.ccclass,QU=$.property,$U=$.requireComponent,eG=globalThis.game.analytics,tG=GameCore,nG=tG.Utils.Array,iG=tG.Plugins.Analytics.Events,aG=(CU=JU("SwitchButton"),EU=$U([fe,Fe]),AU=QU(ye),TU=QU(ge),PU=QU(ge),RU=QU(ye),OU=QU({visible:function(){return this.useSound},type:mn}),IU=QU(ye),LU=QU({visible:function(){return this.useDesktopHover},type:it}),_U=QU({visible:function(){return this.useDesktopHover},type:it}),CU(DU=EU((NU=M((MU=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"enable",NU,U(e)),B(e,"nodeOn",zU,U(e)),B(e,"nodeOff",BU,U(e)),B(e,"useSound",FU,U(e)),B(e,"soundKey",xU,U(e)),B(e,"useDesktopHover",UU,U(e)),B(e,"mouseEnterClip",GU,U(e)),B(e,"mouseLeaveClip",HU,U(e)),e.isMouseLeaved=!1,e.onMouseEnter=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved=!1,e.animationComponent.play(e.mouseEnterClip.name))},e.onMouseLeave=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved||(e.isMouseLeaved=!0,e.animationComponent.play(e.mouseLeaveClip.name)))},e}return N(i,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(fe),this.animationComponent=this.getComponent(Fe),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var e=this.animationComponent.clips.map((function(e){return null==e?void 0:e.name})).filter((function(e){return null!=e&&"string"==typeof e}));this.useDesktopHover&&(nG.has(e,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),nG.has(e,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(ge.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(ge.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(eG.event(iG.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&o.playSound(ei[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(e){this.node.active&&this.updateStatus(e)}},{key:"updateStatus",value:function(e){return this.enable===e||(this.onMouseLeave(null),this.enable=e,this.nodeOn.active=e,this.nodeOff.active=!e),this.enable}}]),i}(ce)).prototype,"enable",[AU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),zU=M(MU.prototype,"nodeOn",[TU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BU=M(MU.prototype,"nodeOff",[PU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FU=M(MU.prototype,"useSound",[RU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xU=M(MU.prototype,"soundKey",[OU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mn[vn.BUTTON_CLICK]}}),UU=M(MU.prototype,"useDesktopHover",[IU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),GU=M(MU.prototype,"mouseEnterClip",[LU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HU=M(MU.prototype,"mouseLeaveClip",[_U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DU=MU))||DU)||DU);Q._RF.pop(),Q._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var oG,rG,lG,sG,uG,cG,hG,pG,dG,yG=$.ccclass,fG=$.property,vG=globalThis.game.analytics,gG=GameCore.Plugins.Analytics.Events,mG=(qU=yG("Tabs"),WU=fG(aG),KU=fG(aG),qU((XU=M((YU=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"tabWorld",XU,U(e)),B(e,"tabFriends",ZU,U(e)),e}return N(n,[{key:"onLoad",value:function(){"MsGames"===GameSDK.getSDKName()&&(this.tabWorld.node.active=!1,this.tabFriends.node.active=!1)}},{key:"setInteractableButtons",value:function(e){this.tabWorld.getComponent(fe).interactable=e,this.tabFriends.getComponent(fe).interactable=e}},{key:"updateStatus",value:function(e){this.tabWorld.setEnabled("global"===e),this.tabFriends.setEnabled("friends"===e)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),o.playSound(vn.BUTTON_CLICK),vG.event(gG.BUTTON_CLICK,{button_name:this.node.name,screen_name:r.getCurrentPage()}),this.node.scene.emit(oO.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),o.playSound(vn.BUTTON_CLICK),vG.event(gG.BUTTON_CLICK,{button_name:this.node.name,screen_name:r.getCurrentPage()}),this.node.scene.emit(oO.FRIENDS_TAB_SELECTED)}}]),n}(ce)).prototype,"tabWorld",[WU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZU=M(YU.prototype,"tabFriends",[KU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jU=YU))||jU);Q._RF.pop(),Q._RF.push({},"91613SO4bxPDq9dH9zxyIef","LeaderboardTimer",void 0);var bG,wG,SG,kG,CG,EG=$.ccclass,AG=$.property,TG=GameCore.Utils.Time,PG=globalThis.game.language,RG=(oG=EG("LeaderboardTimer"),rG=AG(ee),lG=AG(ge),sG=AG(p),oG((hG=M((cG=function(n){F(o,n);var i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"background",hG,U(e)),B(e,"calendar",pG,U(e)),B(e,"timerLocalizer",dG,U(e)),e.alreadyShown=!1,e}return N(o,[{key:"onLoad",value:function(){this.timerOpacity=this.timerLocalizer.node.getComponent(he),this.validateRequiredComponents(),this.backgroundDefaultWidth=this.background.width,this.calendarDefaultPosition=this.calendar.position.clone()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"show",value:(i=W((function*(t){if(!this.alreadyShown&&!t.aborted){this.alreadyShown=!0;var n=ae(this.calendar).to(.3,{scale:Ie.ONE},{easing:"backOut"}).to(.3,{position:this.calendarDefaultPosition.clone()},{easing:"quadOut"}),i=ae(this.background).delay(.3).to(.3,{width:this.backgroundDefaultWidth},{easing:"quadOut"}),a=ae(this.timerOpacity).to(.3,{opacity:255});yield Promise.all([e.runTweenAsync(n,t),e.runTweenAsync(i,t)]),this.calendar.scale=Ie.ONE,this.calendar.position=this.calendarDefaultPosition.clone(),this.background.width=this.backgroundDefaultWidth,yield e.runTweenAsync(a,t),this.timerOpacity.opacity=255}})),function(e){return i.apply(this,arguments)})},{key:"reset",value:function(){this.alreadyShown||(this.calendar.position=this.background.node.position.clone(),this.calendar.scale=Ie.ZERO,this.background.width=0,this.timerOpacity.opacity=0)}},{key:"setTimeLabel",value:function(e){if(e){var t=new Date,n=0;if("manually"===e)n=0;else if("daily"===e)n=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()+1);else if("weekly"===e){var i=t.getUTCDay(),a=0===i?1:8-i;n=Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()+a)}else n="monthly"===e?Date.UTC(t.getUTCFullYear(),t.getUTCMonth()+1):Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()+1);try{var o=TG.getRelativeTime(n/1e3,PG.getCurrentLocale());this.timerLocalizer.key="game.endsIn",this.timerLocalizer.setParams([o])}catch(e){this.timerLocalizer.key="game.endsSoon"}}else this.timerLocalizer.key="game.endsSoon"}}]),o}(ce)).prototype,"background",[rG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pG=M(cG.prototype,"calendar",[lG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dG=M(cG.prototype,"timerLocalizer",[sG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uG=cG))||uG);Q._RF.pop(),Q._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var OG,IG,LG,_G,DG,MG,NG,zG,BG,FG,xG,UG,GG,HG,VG,qG,WG,KG,jG,YG,XG,ZG,JG,QG,$G,eH,tH,nH,iH,aH,oH,rH,lH,sH,uH,cH,hH,pH,dH,yH,fH,vH,gH,mH,bH=$.ccclass,wH=$.disallowMultiple,SH=$.property,kH=(bG=bH("LeaderSkeleton"),wG=SH(ge),bG(SG=wH((CG=M((kG=function(t){F(o,t);var n,i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"container",CG,U(e)),e}return N(o,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"hide",value:(i=W((function*(t){var n=this;yield e.runTweenAsync(ae(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t)})),function(e){return i.apply(this,arguments)})},{key:"show",value:(n=W((function*(t,n){var i=this;this.node.active=!0,this.uiOpacity.opacity=0;var a=this.container.position.clone();this.container.position=new Ie(a.x,a.y-100,a.z);var o=ae(this.container).delay(t);o.to(.2,{position:a},{easing:"cubicOut"});var r=ae(this.uiOpacity).delay(t);r.to(.2,{opacity:255},{easing:"cubicOut"}),n.addAbortListener((function(){i.container.position=a,i.uiOpacity.opacity=255})),yield Promise.all([e.runTweenAsync(o,n),e.runTweenAsync(r,n)])})),function(e,t){return n.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),o}(ce)).prototype,"container",[wG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SG=kG))||SG)||SG);Q._RF.pop(),Q._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var CH,EH,AH,TH,PH,RH,OH,IH,LH,_H,DH,MH,NH,zH=$.ccclass,BH=$.property,FH=GameCore.Utils.Number,xH=(OG=zH("Leader"),IG=BH(Se),LG=BH(he),_G=BH({type:ge,group:"Container"}),DG=BH({type:le,group:"Background"}),MG=BH({type:Be,group:"Background"}),NG=BH({type:le,group:"Rank"}),zG=BH({type:Se,group:"Rank"}),BG=BH({type:Be,group:"Rank"}),FG=BH({type:Be,group:"Rank"}),xG=BH({type:Be,group:"Rank"}),UG=BH({type:Be,group:"Rank"}),GG=BH({type:le,group:"Avatar"}),HG=BH({type:he,group:"Avatar"}),VG=BH({type:le,group:"Score"}),qG=BH({type:Se,group:"Score"}),WG=BH({type:Be,group:"Score"}),KG=BH({type:he,group:"Score"}),jG=BH({type:he}),YG=BH({type:ee}),XG=t.onlyRunInLifeCycle,ZG=t.onlyRunInLifeCycleAsync,JG=t.onlyRunInLifeCycle,OG((eH=M(($G=function(n){F(c,n);var a,o,r,l,s,u=x(c);function c(){var e;z(this,c);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=u.call.apply(u,[this].concat(n)),B(e,"nameLabel",eH,U(e)),B(e,"nameOpacity",tH,U(e)),B(e,"container",nH,U(e)),B(e,"background",iH,U(e)),B(e,"highlightBackground",aH,U(e)),B(e,"rankSprite",oH,U(e)),B(e,"rankLabel",rH,U(e)),B(e,"goldRank",lH,U(e)),B(e,"silverRank",sH,U(e)),B(e,"bronzeRank",uH,U(e)),B(e,"highlightRank",cH,U(e)),B(e,"avatar",hH,U(e)),B(e,"avatarOpacity",pH,U(e)),B(e,"scoreBackground",dH,U(e)),B(e,"scoreLabel",yH,U(e)),B(e,"highlightScoreBackground",fH,U(e)),B(e,"scoreOpacity",vH,U(e)),B(e,"uiOpacity",gH,U(e)),B(e,"uiTransform",mH,U(e)),e.signal=new i,e}return N(c,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.defaultAvatar=this.avatar.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e,t){this.updateBackground(e),this.updateRank(e,t),this.updatePhoto(e),this.updateUsername(e),this.updateScore(e)}},{key:"updateBackground",value:function(e){this.background.spriteFrame=e.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(e,t){var n=e.rank;this.rankLabel.string=t&&n>t?"".concat(t,"+"):n.toString(),this.rankSprite.spriteFrame=this.defaultRank;var i=new we(cO);switch(e.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,i=new we(pO)),n){case 1:this.rankSprite.spriteFrame=this.goldRank,i=new we(rO);break;case 2:this.rankSprite.spriteFrame=this.silverRank,i=new we(lO);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,i=new we(sO)}this.rankLabel.shadowColor=i,this.rankLabel.outlineColor=i}},{key:"updatePhoto",value:(s=W((function*(t){this.signal.abort();var n=new i;if(this.signal=n,this.avatar){var a=t.playerId,o=t.photo;if(VE.isAvatarCached(t.playerId,70)){var r=yield VE.getPlayerAvatar(o,a,70,n);if(!r||n.aborted)return;this.setPhoto(r)}else if(this.avatar.spriteFrame=this.defaultAvatar,yield e.waitTweenAsync(.1,n),!n.aborted){var l=yield VE.getPlayerAvatar(o,a,70,n);l&&!n.aborted&&this.setPhoto(l)}}})),function(e){return s.apply(this,arguments)})},{key:"setPhoto",value:function(e){this.node.active&&(e.packable=!0,this.avatar.spriteFrame=e)}},{key:"updateUsername",value:function(e){this.nameLabel.string=e.name,this.nameLabel.color=new we(e.isHighlight?hO:uO)}},{key:"updateScore",value:function(e){var t=Math.floor(e.score);this.scoreLabel.string=FH.getShortNumber(t,7);var n=this.scoreLabel.getComponent(Se);n.outlineColor=new we(e.isHighlight?pO:cO),n.shadowColor=new we(e.isHighlight?pO:cO),this.scoreBackground.spriteFrame=e.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(l=W((function*(t,n){var i=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;this.setVisible(!1);var o=this.container.position.clone();this.container.position=new Ie(o.x,o.y-100,o.z);var r=ae(this.container).delay(n);r.to(a,{position:o},{easing:"backOut"});var l=ae(this.uiOpacity).delay(n);l.to(a,{opacity:255},{easing:"cubicOut",onUpdate:function(){i.nameOpacity.opacity=i.uiOpacity.opacity,i.scoreOpacity.opacity=i.uiOpacity.opacity,i.avatarOpacity.opacity=i.uiOpacity.opacity}}),t.addAbortListener((function(){i.container.position=o,i.uiOpacity.opacity=255,i.avatar.node.active=!0})),yield Promise.all([e.runTweenAsync(r,t),e.runTweenAsync(l,t)])})),function(e,t){return l.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(r=W((function*(t,n,i){var a=ae(this.node).to(n,{worldPosition:t},{easing:"quadOut"});yield e.runTweenAsync(a,i)})),function(e,t,n){return r.apply(this,arguments)})},{key:"runScaleAnimation",value:(o=W((function*(t,n,i){var a=ae(this.node).to(n,{scale:new Ie(t,t,t)},{easing:"backOut"});yield e.runTweenAsync(a,i)})),function(e,t,n){return o.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(a=W((function*(t,n,i,a,o,r){var l=this;yield e.runOnUpdateAsync(this.node,o,(function(e){var o=Math.floor(t+(n-t)*e),r=Math.floor(i+(a-i)*e);l.updateRank({rank:o,isHighlight:!0}),l.updateScore({score:r,isHighlight:!0})}),r)})),function(e,t,n,i,o,r){return a.apply(this,arguments)})},{key:"setVisible",value:function(e){var t=e?255:0;this.uiOpacity.opacity=t,this.nameOpacity.opacity=t,this.scoreOpacity.opacity=t,this.avatarOpacity.opacity=t}}]),c}(ce)).prototype,"nameLabel",[IG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tH=M($G.prototype,"nameOpacity",[LG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nH=M($G.prototype,"container",[_G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iH=M($G.prototype,"background",[DG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aH=M($G.prototype,"highlightBackground",[MG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oH=M($G.prototype,"rankSprite",[NG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rH=M($G.prototype,"rankLabel",[zG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lH=M($G.prototype,"goldRank",[BG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sH=M($G.prototype,"silverRank",[FG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uH=M($G.prototype,"bronzeRank",[xG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cH=M($G.prototype,"highlightRank",[UG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hH=M($G.prototype,"avatar",[GG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pH=M($G.prototype,"avatarOpacity",[HG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dH=M($G.prototype,"scoreBackground",[VG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yH=M($G.prototype,"scoreLabel",[qG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fH=M($G.prototype,"highlightScoreBackground",[WG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vH=M($G.prototype,"scoreOpacity",[KG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gH=M($G.prototype,"uiOpacity",[jG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mH=M($G.prototype,"uiTransform",[YG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M($G.prototype,"updateInfo",[XG],Object.getOwnPropertyDescriptor($G.prototype,"updateInfo"),$G.prototype),M($G.prototype,"updatePhoto",[ZG],Object.getOwnPropertyDescriptor($G.prototype,"updatePhoto"),$G.prototype),M($G.prototype,"setPhoto",[JG],Object.getOwnPropertyDescriptor($G.prototype,"setPhoto"),$G.prototype),QG=$G))||QG);Q._RF.pop(),Q._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var UH,GH,HH,VH,qH,WH,KH,jH,YH,XH,ZH,JH,QH,$H,eV,tV,nV,iV,aV,oV,rV,lV,sV,uV,cV,hV,pV=$.ccclass,dV=$.property,yV=globalThis.game.player,fV=GameCore.Utils.Array,vV=(CH=pV("Leaders"),EH=dV(uD),AH=dV(xH),TH=dV(te),PH=t.onlyRunInLifeCycleAsync,RH=t.onlyRunInLifeCycleAsync,OH=t.onlyRunInLifeCycleAsync,IH=t.onlyRunInLifeCycleAsync,CH((DH=M((_H=function(e){F(u,e);var n,i,a,o,r,l,s=x(u);function u(){var e;z(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),B(e,"scrollView",DH,U(e)),B(e,"tempLeader",MH,U(e)),B(e,"maxLeader",NH,U(e)),e.leaderData=[],e.displayLeaderData=[],e.displayPlayerLeader=null,e.isHidden=!0,e}return N(u,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(ee),this.batchNodes=this.getComponents(us),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=yV.getPlayerId()}},{key:"updateData",value:(l=W((function*(e){this.isHidden=!1,this.leaderData=e,this.leaderData.forEach((function(e,t){e.rank=t+1})),this.setupDisplayLeadersData()})),function(e){return l.apply(this,arguments)})},{key:"initScrollViews",value:function(){var e=this;this.scrollView.setMaxNodeCount(this.leaderData.length),this.scrollView.init((function(t){var n=t.getComponent(xH),i=e.displayLeaderData[t.order];if(i){var a=i.playerId,o=i.photo,r=i.name,l=i.score;n.setVisible(!0),n.updateInfo({playerId:a,isHighlight:e.currentPlayerId===a,name:r,photo:o,rank:t.order+1,score:l},e.maxLeader)}})),this.setBatchNodes(!0)}},{key:"playRankChangeAnimation",value:(r=W((function*(e,t,n,i){if(!(t>=n)){var a=this.displayLeaderData,o=fV.search(a,(function(e){return e.playerId===yV.getPlayerId()}));if(o){var r=o.rank;if(a[i-1]){var l=this.scrollView.getNodeByOrder(o.rank-1);if(l){var s=null==l?void 0:l.getComponent(xH);if(s){s.setVisible(!1),this.tempLeader.setVisible(!0),this.tempLeader.updatePhoto({playerId:yV.getPlayerId(),photo:o.photo}),this.tempLeader.node.worldPosition=l.node.worldPosition.clone(),yield this.tempLeader.runScaleAnimation(1.1,.5,e);var u=Math.min(.5*(r-i),2),c=[this.tempLeader.runUpdateDataAnimation(r,i,t,n,u,e),this.scrollToLeaderRank(i,u,e)],h=this.scrollView.scrollView.getMaxScrollOffset().y,p=this.scrollView.getNodeScrollOffset(i-1),d=Ie.ZERO;if(p<0)d=new Ie(this.tempLeader.node.worldPosition.x,this.node.worldPosition.y+this.scrollView.getNodePosition(i-1).y+this.uiTransform.height/2,this.tempLeader.node.worldPosition.z);else if(this.scrollView.scrollView.getScrollOffset().y>=h-5)if(p<h)d=new Ie(this.tempLeader.node.worldPosition.x,this.scrollView.viewport.node.worldPosition.y,this.tempLeader.node.worldPosition.z);else{var y,f=this.scrollView.getNodeByOrder(i-1);d=null!==(y=null==f?void 0:f.node.worldPosition.clone())&&void 0!==y?y:Ie.ZERO}d.equals(Ie.ZERO)||c.push(this.tempLeader.runWorldPositionAnimation(d,u,e)),yield Promise.all(c),yield Promise.all([this.tempLeader.runScaleAnimation(1,.25,e),this.playPostRankChangeAnimation(i,r,e)]),this.tempLeader.setVisible(!1),l.node.worldPosition=this.tempLeader.node.worldPosition.clone(),this.setupDisplayLeadersData(),this.scrollView.updateNodeVisibility(),this.scrollView.updateLayout()}}}}}})),function(e,t,n,i){return r.apply(this,arguments)})},{key:"playShowLeadersAnimation",value:(o=W((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;if(!this.isHidden){var i=[],a=this.scrollView.getAllNodes();if(a.sort((function(e,t){return e.order-t.order})).forEach((function(e,n){var a=e.getComponent(xH);a.setVisible(n<t.leaderData.length),e.isVisible()&&i.push(a)})),!(i.length<1)){i=i.slice(0,a.length-1);var o=.3;yield Promise.all(i.map(function(){var i=W((function*(i,a){t.isHidden||(yield i.runShowUpAnimation(e,a*n,o))}));return function(e,t){return i.apply(this,arguments)}}()))}}})),function(e){return o.apply(this,arguments)})},{key:"scrollToPlayerLeader",value:(a=W((function*(e,t){this.displayPlayerLeader&&(yield this.scrollToLeaderRank(this.displayPlayerLeader.rank,e,t))})),function(e,t){return a.apply(this,arguments)})},{key:"updateDisplayPlayerLeaderForRankChanging",value:function(e,t,n){if(!this.displayPlayerLeader)return!1;this.displayPlayerLeader.score=e,this.displayLeaderData.sort((function(e,t){return t.score-e.score}));var i=this.displayLeaderData.indexOf(this.displayPlayerLeader)+1;return n===i?(this.displayPlayerLeader.score=t,this.displayPlayerLeader.rank=n,!1):(this.displayPlayerLeader.rank=i,this.tempLeader.updateInfo({playerId:yV.getPlayerId(),isHighlight:!0,name:this.displayPlayerLeader.name,photo:this.displayPlayerLeader.photo,rank:this.displayPlayerLeader.rank,score:e}),!0)}},{key:"hideLeaders",value:function(){this.isHidden=!0;var e,t=this.scrollView.getAllNodes().map((function(e){return e.getComponent(xH)})),n=H(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;null==i||i.setVisible(!1)}}catch(e){n.e(e)}finally{n.f()}this.setBatchNodes(!1)}},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"setBatchNodes",value:function(e){this.batchNodes.every((function(t){t.enabled=e}))}},{key:"setupDisplayLeadersData",value:function(){var e=this,t=fV.search(this.leaderData,(function(t){return t.playerId===e.currentPlayerId}));t?(this.displayLeaderData=this.leaderData.filter((function(t){return t.playerId!==e.currentPlayerId})),this.displayPlayerLeader=G({},t),this.displayLeaderData.splice(t.rank-1,0,this.displayPlayerLeader)):(this.displayPlayerLeader=null,this.displayLeaderData=this.leaderData)}},{key:"playPostRankChangeAnimation",value:(i=W((function*(e,t,n){var i=null!=e?e:0,a=this.scrollView.getVisibleNodes().filter((function(e){return e.order>=i-1&&e.order<t})),o=a.map((function(e){return e.getComponent(xH)})),r=this.scrollView.nodeHeight+this.scrollView.spacing,l=[];o.forEach((function(e,t){var i=a[t];if(i){e.updateRank({rank:i.order+2,isHighlight:!1});var o=e.node.worldPosition.clone();l.push(e.runWorldPositionAnimation(o.add3f(0,-r,0),.25,n))}})),yield Promise.all(l)})),function(e,t,n){return i.apply(this,arguments)})},{key:"scrollToLeaderRank",value:(n=W((function*(e,t,n){yield this.scrollView.scrollToOrder(e-1,n,t)})),function(e,t,i){return n.apply(this,arguments)})}]),u}(ce)).prototype,"scrollView",[EH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MH=M(_H.prototype,"tempLeader",[AH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NH=M(_H.prototype,"maxLeader",[TH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(_H.prototype,"updateData",[PH],Object.getOwnPropertyDescriptor(_H.prototype,"updateData"),_H.prototype),M(_H.prototype,"playRankChangeAnimation",[RH],Object.getOwnPropertyDescriptor(_H.prototype,"playRankChangeAnimation"),_H.prototype),M(_H.prototype,"scrollToPlayerLeader",[OH],Object.getOwnPropertyDescriptor(_H.prototype,"scrollToPlayerLeader"),_H.prototype),M(_H.prototype,"scrollToLeaderRank",[IH],Object.getOwnPropertyDescriptor(_H.prototype,"scrollToLeaderRank"),_H.prototype),LH=_H))||LH);Q._RF.pop(),Q._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var gV,mV,bV,wV,SV,kV,CV,EV,AV=$.ccclass,TV=$.property,PV=globalThis.game,RV=PV.storage,OV=PV.leaderboard,IV=PV.player,LV=PV.monitorError,_V=GameCore,DV=_V.Utils.Object,MV=_V.Configs.Leaderboards,NV=function(e){F(n,e);var t=x(n);function n(e){var i;return z(this,n),(i=t.call(this,e)).name="EmptyLeaderboardError",i}return N(n)}(X(Error)),zV=(UH=AV("LeaderboardContent"),GH=t.required(),HH=TV(mG),VH=t.required(),qH=TV(RG),WH=t.required(),KH=TV(vV),jH=TV({type:[kH]}),YH=t.required(),XH=TV(VU),ZH=t.required(),JH=TV(mi),QH=t.onlyRunInLifeCycleAsync,$H=t.onlyRunInLifeCycleAsync,eV=t.onlyRunInLifeCycleAsync,tV=t.onlyRunInLifeCycleAsync,nV=t.onlyRunInLifeCycleAsync,iV=t.onlyRunInLifeCycleAsync,UH((rV=M((oV=function(e){F(c,e);var n,a,o,r,l,s,u=x(c);function c(){var e;z(this,c);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=u.call.apply(u,[this].concat(n)),B(e,"tabs",rV,U(e)),B(e,"timer",lV,U(e)),B(e,"leaders",sV,U(e)),B(e,"leaderSkeletons",uV,U(e)),B(e,"leaderboardIsEmpty",cV,U(e)),B(e,"contentOpacity",hV,U(e)),e.isHidden=!0,e.currentLb=null,e.animAbortSignal=new i,e.hasPlayedAppearAnim={friends:!1,global:!1,tournament:!1},e.handleFriendsTabSelected=W((function*(){RV.setStorageData("leaderboard_content","lastTabOpened","friends"),e.cleanupSideEffects();var t=e.animAbortSignal;try{yield e.updateStatus(t,"friends")}catch(e){t.call((function(){var t=e instanceof Error?e:new Error("Unknown error during loading friends leaderboard.");console.error("LeaderboardContent",t),null==LV||LV.sendException(t),b.showNotificationScreenWithLocalizedKey("error.noFriendsLb",2)}))}})),e.handleWorldTabSelected=W((function*(){RV.setStorageData("leaderboard_content","lastTabOpened","global"),e.cleanupSideEffects();var t=e.animAbortSignal;try{yield e.updateStatus(t,"global")}catch(e){t.call((function(){var t=e instanceof Error?e:new Error("Unknown error during loading global leaderboard.");console.error("LeaderboardContent",t),null==LV||LV.sendException(t),b.showNotificationScreenWithLocalizedKey("error.noWorldLb",2)}))}})),e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return N(c,[{key:"__preload",value:function(){this.leaders.maxLeader=MV.Limit}},{key:"onLoad",value:function(){t.validateRequiredProperties(this)}},{key:"listenEvents",value:function(){this.node.scene.on(oO.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(oO.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(ta.HIDE_UI,this.hideContent),this.node.scene.on(ta.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.node.scene.off(oO.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(oO.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(ta.HIDE_UI,this.hideContent),this.node.scene.off(ta.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(s=W((function*(e,t){var n=this,i=this.getLeaderboardName(e);null!==i&&(yield t.callAsync((function(){return OV.requestLeaderboardAsync(i,MV.Limit)})),t.call((function(){var e=OV.getLeaderboard(i);n.currentLb=null!=e?e:n.currentLb})),yield t.callAsync(W((function*(){return n.loadPlayerLeaderData(e)}))))})),function(e,t){return s.apply(this,arguments)})},{key:"getLeaderboardName",value:function(e){return"friends"===e?P.FRIENDS:P.GLOBAL}},{key:"showLoading",value:(l=W((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;yield Promise.all([this.leaders.scrollView.unlistenEvents(),this.leaders.scrollView.scrollToTop(e).then((function(){t.leaders&&(t.leaders.scrollView.scrollView.enabled=!1,t.leaders.scrollView.listenEvents())})),this.leaderSkeletons.map((function(t,i){return t.show(i*n,e)}))])})),function(e){return l.apply(this,arguments)})},{key:"hideLoading",value:(r=W((function*(e){yield Promise.all(this.leaderSkeletons.map((function(t){return t.hide(e)})))})),function(e){return r.apply(this,arguments)})},{key:"entering",value:function(){this.timer.reset(),this.isHidden=!1;var e=RV.getStorageData("leaderboard_content","lastTabOpened");"friends"===e?this.handleFriendsTabSelected():"global"===e&&this.handleWorldTabSelected()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){this.animAbortSignal.abort(),this.animAbortSignal=new i,this.leaders.hideLeaders(),this.leaderboardIsEmpty.hide()}},{key:"updateStatus",value:(o=W((function*(e,t){var n,i,a,o=this;if(void 0!==e&&!this.isHidden){this.tabs.updateStatus(t),yield this.showLoading(e);try{yield this.loadLeaderboard(t,e)}catch(t){if(!(t instanceof NV))throw t;return void e.call((function(){o.leaderboardIsEmpty.show(),o.hideLoading(e)}))}null===(n=this.timer)||void 0===n||n.setTimeLabel(null===(i=this.currentLb)||void 0===i?void 0:i.resettable),null===(a=this.timer)||void 0===a||a.show(e),this.hideLoading(e),yield e.callAsync((function(e){return o.playLeadersShowupAnimation(t,e)}))}})),function(e,t){return o.apply(this,arguments)})},{key:"playLeadersShowupAnimation",value:(a=W((function*(e,t){var n=this;if(this.currentLb){var i=IV.getPlayerId(),a=this.currentLb.leaders[i],o=RV.getStorage("leaderboard_content").previousScore,r=null!=a?a:{},l=r.score,s=r.rank,u=DV.vals(this.currentLb.leaders);u.sort((function(e,t){return t.score-e.score}));var c=-1!==o&&o<l&&s<=MV.Limit;this.leaders.updateData(u);var h=!1;a&&c&&(h=this.leaders.updateDisplayPlayerLeaderForRankChanging(o,l,s)),this.leaders.initScrollViews(),this.leaders.scrollView.scrollView.enabled=!0;var p=this.hasPlayedAppearAnim[e]?0:.1;yield t.callAsync((function(){return n.leaders.playShowLeadersAnimation(t,p)})),this.hasPlayedAppearAnim[e]=!0,a&&(yield t.callAsync((function(){return n.leaders.scrollToPlayerLeader(1,t)})),h&&-1!==o&&(yield t.callAsync((function(e){return n.leaders.playRankChangeAnimation(e,o,l,s)})),RV.setStorageData("leaderboard_content","previousScore",l)))}})),function(e,t){return a.apply(this,arguments)})},{key:"loadPlayerLeaderData",value:(n=W((function*(e){var t=IV.getPlayerId();if(null===this.currentLb)throw new Error("LeaderboardContent: Leaderboard is not found.");var n=this.currentLb.leaders;if(0===Object.keys(n).length)throw new NV("LeaderboardContent: Leaderboard is empty.");if(!n[t]){var i=this.getLeaderboardName(e);if(null===i)throw new Error("LeaderboardContent: Leaderboard name is not found.");var a=yield OV.getLeadersByPlayerIdsAsync(i,[t]);if(0!==a.length){var o=a[0];n[t]=o}}})),function(e){return n.apply(this,arguments)})}]),c}(ce)).prototype,"tabs",[GH,HH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lV=M(oV.prototype,"timer",[VH,qH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sV=M(oV.prototype,"leaders",[WH,KH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uV=M(oV.prototype,"leaderSkeletons",[jH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cV=M(oV.prototype,"leaderboardIsEmpty",[YH,XH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hV=M(oV.prototype,"contentOpacity",[ZH,JH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(oV.prototype,"loadLeaderboard",[QH],Object.getOwnPropertyDescriptor(oV.prototype,"loadLeaderboard"),oV.prototype),M(oV.prototype,"showLoading",[$H],Object.getOwnPropertyDescriptor(oV.prototype,"showLoading"),oV.prototype),M(oV.prototype,"hideLoading",[eV],Object.getOwnPropertyDescriptor(oV.prototype,"hideLoading"),oV.prototype),M(oV.prototype,"updateStatus",[tV],Object.getOwnPropertyDescriptor(oV.prototype,"updateStatus"),oV.prototype),M(oV.prototype,"playLeadersShowupAnimation",[nV],Object.getOwnPropertyDescriptor(oV.prototype,"playLeadersShowupAnimation"),oV.prototype),M(oV.prototype,"loadPlayerLeaderData",[iV],Object.getOwnPropertyDescriptor(oV.prototype,"loadPlayerLeaderData"),oV.prototype),aV=oV))||aV);Q._RF.pop(),Q._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var BV,FV,xV,UV,GV,HV,VV,qV,WV,KV,jV,YV,XV,ZV,JV,QV,$V,eq;gV=(0,$.ccclass)("LeaderboardPage"),mV=t.required(),bV=t.onlyRunInLifeCycleAsync,wV=t.onlyRunInLifeCycleAsync,SV=t.onlyRunInLifeCycleAsync,gV((EV=M((CV=function(t){F(l,t);var n,i,a,o,r=x(l);function l(){var e;z(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),B(e,"panelAnimationController",EV,U(e)),e}return N(l,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(wa),V(q(l.prototype),"onLoad",this).call(this)}},{key:"start",value:(o=W((function*(){V(q(l.prototype),"start",this).call(this)})),function(){return o.apply(this,arguments)})},{key:"mount",value:(a=W((function*(){if(yield V(q(l.prototype),"mount",this).call(this),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(zV),!this.content)throw new Error("LeaderboardPage: Leaders not found")})),function(){return a.apply(this,arguments)})},{key:"transitionIn",value:(i=W((function*(){this.content.entering(),yield V(q(l.prototype),"transitionIn",this).call(this);var t=e.runTweenAsync(ae(this.containerUIOpacity).to(.2,{opacity:255})),n=this.panelAnimationController.showUI();this.content.listenEvents(),yield Promise.all([t,n])})),function(){return i.apply(this,arguments)})},{key:"transitionOut",value:(n=W((function*(){yield V(q(l.prototype),"transitionOut",this).call(this),this.content.unlistenUIEvents(),this.content.leaders.setBatchNodes(!1),yield this.panelAnimationController.hideUI()})),function(){return n.apply(this,arguments)})},{key:"unmount",value:function(){var e,t;null===(e=this.content)||void 0===e||e.hide(),null===(t=this.content)||void 0===t||t.cleanup(),V(q(l.prototype),"unmount",this).call(this)}}]),l}(AD)).prototype,"panelAnimationController",[mV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(CV.prototype,"mount",[bV],Object.getOwnPropertyDescriptor(CV.prototype,"mount"),CV.prototype),M(CV.prototype,"transitionIn",[wV],Object.getOwnPropertyDescriptor(CV.prototype,"transitionIn"),CV.prototype),M(CV.prototype,"transitionOut",[SV],Object.getOwnPropertyDescriptor(CV.prototype,"transitionOut"),CV.prototype),kV=CV));Q._RF.pop(),Q._RF.push({},"0d1c02Npp9IXrjlFdl8co2L","TopLeader",void 0);var tq,nq,iq,aq,oq,rq,lq,sq,uq,cq,hq,pq,dq,yq,fq,vq,gq,mq,bq,wq,Sq,kq,Cq,Eq,Aq,Tq,Pq,Rq=$.ccclass,Oq=$.property,Iq=GameCore.Utils.Number,Lq=(BV=Rq("TopLeader"),FV=Oq(Se),xV=Oq(ge),UV=Oq({type:le}),GV=Oq({type:he}),HV=Oq({type:Se}),VV=Oq({type:he}),qV=t.onlyRunInLifeCycle,WV=t.onlyRunInLifeCycleAsync,KV=t.onlyRunInLifeCycleAsync,BV((XV=M((YV=function(n){F(s,n);var a,o,r,l=x(s);function s(){var e;z(this,s);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=l.call.apply(l,[this].concat(n)),B(e,"nameLabel",XV,U(e)),B(e,"defaultAvatar",ZV,U(e)),B(e,"avatar",JV,U(e)),B(e,"avatarOpacity",QV,U(e)),B(e,"scoreLabel",$V,U(e)),B(e,"uiOpacity",eq,U(e)),e.signal=new i,e}return N(s,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e){this.updateUsername(e),this.updatePhoto(e),this.updateScore(e)}},{key:"updateUsername",value:function(e){this.nameLabel&&(this.nameLabel.string=e.name)}},{key:"updatePhoto",value:(r=W((function*(e){this.signal.abort();var t=new i;this.signal=t,this.defaultAvatar.active=!VE.isAvatarCached(e.playerId,128),this.avatar.spriteFrame=null;var n=e.playerId,a=e.photo,o=yield VE.getPlayerAvatar(a,n,128,t);o&&!t.aborted&&this.setPhoto(o)})),function(e){return r.apply(this,arguments)})},{key:"setPhoto",value:(o=W((function*(t){if(this.node.active){t.packable=!0,this.avatar.spriteFrame=t;var n=ae(this.avatarOpacity).to(.2,{opacity:255});yield e.runTweenAsync(n,this.signal),this.defaultAvatar.active=!1}})),function(e){return o.apply(this,arguments)})},{key:"updateScore",value:function(e){if(this.scoreLabel){var t=Math.floor(e.score);this.scoreLabel.string=Iq.getShortNumber(t,7)}}},{key:"runShowUpAnimation",value:(a=W((function*(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.3,i=arguments.length>2?arguments[2]:void 0;this.node.scale=Ie.ZERO;var a=ae(this.node).delay(t).to(n,{scale:new Ie(1,1,1)},{easing:"backOut"}),o=ae(this.uiOpacity).delay(t).to(n,{opacity:255});yield Promise.all([e.runTweenAsync(a,i),e.runTweenAsync(o,i)])})),function(e){return a.apply(this,arguments)})},{key:"setVisible",value:function(e){var t=e?255:0;this.uiOpacity.opacity=t,this.avatarOpacity.opacity=t}}]),s}(ce)).prototype,"nameLabel",[FV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZV=M(YV.prototype,"defaultAvatar",[xV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JV=M(YV.prototype,"avatar",[UV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QV=M(YV.prototype,"avatarOpacity",[GV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$V=M(YV.prototype,"scoreLabel",[HV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eq=M(YV.prototype,"uiOpacity",[VV],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(YV.prototype,"updateInfo",[qV],Object.getOwnPropertyDescriptor(YV.prototype,"updateInfo"),YV.prototype),M(YV.prototype,"updatePhoto",[WV],Object.getOwnPropertyDescriptor(YV.prototype,"updatePhoto"),YV.prototype),M(YV.prototype,"setPhoto",[KV],Object.getOwnPropertyDescriptor(YV.prototype,"setPhoto"),YV.prototype),jV=YV))||jV);Q._RF.pop(),Q._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var _q,Dq,Mq,Nq,zq,Bq=$.ccclass,Fq=$.property,xq=globalThis.game,Uq=xq.leaderboard,Gq=xq.player,Hq=xq.language,Vq=GameCore.Utils,qq=Vq.Time,Wq=Vq.Object,Kq=Vq.Array,jq=Vq.Number,Yq=(tq=Bq("TournamentBlock"),nq=Fq(ge),iq=Fq(Se),aq=Fq(p),oq=Fq(p),rq=Fq(p),lq=Fq(p),sq=Fq(ee),uq=Fq({type:le}),cq=Fq(ge),hq=Fq(ge),pq=Fq(Lq),dq=t.onlyRunInLifeCycleAsync,yq=t.onlyRunInLifeCycle,tq((gq=M((vq=function(i){F(h,i);var a,o,r,l,s,u,c=x(h);function h(){var e;z(this,h);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=c.call.apply(c,[this].concat(n)),B(e,"container",gq,U(e)),B(e,"title",mq,U(e)),B(e,"titleLocalizer",bq,U(e)),B(e,"timeLocalizer",wq,U(e)),B(e,"playerCountLocalizer",Sq,U(e)),B(e,"playButtonLocalize",kq,U(e)),B(e,"uiTransform",Cq,U(e)),B(e,"banner",Eq,U(e)),B(e,"bannerMask",Aq,U(e)),B(e,"bannerLoadingRing",Tq,U(e)),B(e,"topLeader",Pq,U(e)),e.hasPlayedAnimation=!1,e}return N(h,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"updateInfo",value:(u=W((function*(e){this.payload=e;var t=e.endTime,n=e.title,i=e.payload.playerName,a=e.tournamentType,o=e.payload,r=o.leaderboardId,l=o.themeId;r&&(this.topLeader.setVisible(!1),this.topLeader.node.active=!1,this.setPlayerCountWaiting(),"PAGE_HOSTED"===a?this.updateTitleTournamentTitle(n):this.updateTitleWithPlayerName(null!=i?i:n),this.updateEndTime(t),this.updateTournamentBanner(l),yield this.fetchAndUpdateLeadersPayload(r,{leaders:[],amountPlayer:0},n))})),function(e){return u.apply(this,arguments)})},{key:"fetchAndUpdateLeadersPayload",value:(s=W((function*(e,t,n){var i=t;try{var a=yield this.getLeadersPayload(e);a&&(i=a)}catch(e){console.error("Fetch lb for tournament ".concat(n),e)}this.updateLeadersPayload(i)})),function(e,t,n){return s.apply(this,arguments)})},{key:"updateLeadersPayload",value:function(e){this.leadersPayload=e;var t=this.leadersPayload,n=t.player,i=t.amountPlayer,a=t.leaders;this.updatePlayerCount(i),this.updatePlayButtonLabel(void 0!==n),this.updateTopLeader(null!=a?a:[])}},{key:"updateTitleWithPlayerName",value:function(e){void 0!==e&&(this.titleLocalizer.enabled=!0,this.titleLocalizer.setParams([e]))}},{key:"updateTitleTournamentTitle",value:function(e){this.titleLocalizer.enabled=!1,this.title.string=e}},{key:"updateEndTime",value:function(e){try{var t=qq.getRelativeTime(e,Hq.getCurrentLocale());this.timeLocalizer.key="game.endsIn",this.timeLocalizer.setParams([t])}catch(e){this.timeLocalizer.key="game.endsSoon"}}},{key:"updatePlayerCount",value:function(e){var t=jq.getShortNumber(e,3);1===e?this.playerCountLocalizer.key="game.player":(this.playerCountLocalizer.key="game.nPlayers",this.playerCountLocalizer.setParams([t]))}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLocalizer.key="status.loading"}},{key:"updateTopLeader",value:(l=W((function*(e){if(0!==e.length){var t,n=e[0];GameCore.Configs.Mockup.Leaderboards.Enabled&&(n=null!==(t=Kq.search(e,(function(e){return 1===e.rank})))&&void 0!==t?t:n),this.topLeader.node.active=!0,this.topLeader.updateInfo(n),this.topLeader.runShowUpAnimation(0,.2)}})),function(e){return l.apply(this,arguments)})},{key:"updateTournamentBanner",value:(r=W((function*(e){var t=n.getAsset("".concat(T[e],"/spriteFrame"),Be);t||(this.bannerMask.active=!0,this.bannerLoadingRing.active=!0,t=yield n.loadThemePreviewAsync(e)),t||(t=yield n.loadThemePreviewAsync(E.SUMMER)),this.banner&&t&&(this.banner.spriteFrame=t,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1)})),function(e){return r.apply(this,arguments)})},{key:"updatePlayButtonLabel",value:function(e){this.playButtonLocalize.key=e?"game.continue":"game.join"}},{key:"getLeadersPayload",value:(o=W((function*(e){var t,n=Uq.getLeaderboardName(e);if(!n)return null;var i=yield Os.getAllLeaderboardAsync(e);if(!i)return null;var a=Wq.vals(i.leaders);a.sort((function(e,t){return e.rank-t.rank}));var o=Gq.getPlayerId(),r=yield Uq.getLeadersByPlayerIdsAsync(n,[o]),l={leaders:a,amountPlayer:null!==(t=i.amountPlayer)&&void 0!==t?t:0};return r.length>0&&(l.player=r[0]),l})),function(e){return o.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(a=W((function*(t,n,i){var a=this;this.node.scale=new Ie(.8,.8,.8),this.uiOpacity.opacity=0;var o=this.container.position.clone();this.container.position=new Ie(o.x,o.y-100,o.z);var r=ae(this.node).delay(t);r.to(n,{scale:Ie.ONE},{easing:"elasticOut"});var l=ae(this.container).delay(t);l.to(n,{position:o},{easing:"backOut"});var s=ae(this.uiOpacity).delay(t);s.to(n,{opacity:255},{easing:"cubicOut"}),i.addAbortListener((function(){a.node.scale=Ie.ONE,a.container.position=o,a.uiOpacity.opacity=255})),yield Promise.all([e.runTweenAsync(r,i),e.runTweenAsync(l,i),e.runTweenAsync(s,i)])})),function(e,t,n){return a.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var e=this.payload.id||"";if(m.validateTournamentExpired(e))return this.node.scene.emit(As.RELOAD_TOURNAMENT),void b.showNotificationScreenWithLocalizedKey("error.tourEnded",2);try{var t=JSON.stringify(this.payload);b.showTournamentDetailScreen(t,"tournament_start",this.hasPlayedAnimation),this.hasPlayedAnimation=!0}catch(e){console.warn("handleOnTournamentClicked",e)}}}]),h}(ce)).prototype,"container",[nq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mq=M(vq.prototype,"title",[iq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bq=M(vq.prototype,"titleLocalizer",[aq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wq=M(vq.prototype,"timeLocalizer",[oq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sq=M(vq.prototype,"playerCountLocalizer",[rq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kq=M(vq.prototype,"playButtonLocalize",[lq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cq=M(vq.prototype,"uiTransform",[sq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eq=M(vq.prototype,"banner",[uq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aq=M(vq.prototype,"bannerMask",[cq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tq=M(vq.prototype,"bannerLoadingRing",[hq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pq=M(vq.prototype,"topLeader",[pq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(vq.prototype,"fetchAndUpdateLeadersPayload",[dq],Object.getOwnPropertyDescriptor(vq.prototype,"fetchAndUpdateLeadersPayload"),vq.prototype),M(vq.prototype,"updateLeadersPayload",[yq],Object.getOwnPropertyDescriptor(vq.prototype,"updateLeadersPayload"),vq.prototype),fq=vq))||fq);Q._RF.pop(),Q._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var Xq,Zq,Jq,Qq,$q,eW,tW,nW,iW,aW,oW,rW,lW,sW=$.ccclass,uW=$.property,cW=(_q=sW("TournamentBlockSkeleton"),Dq=uW(ge),_q((zq=M((Nq=function(n){F(r,n);var i,a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),B(e,"container",zq,U(e)),e}return N(r,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"hide",value:(a=W((function*(t){var n=this;yield e.runTweenAsync(ae(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t)})),function(e){return a.apply(this,arguments)})},{key:"show",value:(i=W((function*(t,n){var i=this;this.node.active=!0,this.node.scale=new Ie(.8,.8,.8),this.uiOpacity.opacity=0;var a=this.container.position.clone();this.container.position=new Ie(a.x,a.y-100,a.z);var o=ae(this.node).delay(t);o.to(.2,{scale:Ie.ONE},{easing:"elasticOut"});var r=ae(this.container).delay(t);r.to(.2,{position:a},{easing:"backOut"});var l=ae(this.uiOpacity).delay(t);l.to(.2,{opacity:255},{easing:"cubicOut"}),n.addAbortListener((function(){i.node.scale=Ie.ONE,i.container.position=a,i.uiOpacity.opacity=255})),yield Promise.all([e.runTweenAsync(o,n),e.runTweenAsync(r,n),e.runTweenAsync(l,n)])})),function(e,t){return i.apply(this,arguments)})}]),r}(ce)).prototype,"container",[Dq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mq=Nq))||Mq);Q._RF.pop(),Q._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var hW,pW=$.ccclass,dW=$.property,yW=globalThis.game.player,fW=(Xq=pW("TournamentsBoard"),Zq=dW(qe),Jq=dW(ge),Qq=dW(oe),$q=dW(ge),eW=dW(ee),Xq((iW=M((nW=function(e){F(a,e);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"tournamentBlockPrefab",iW,U(e)),e.tournamentBlockArray=[],B(e,"inactiveNodeContainer",aW,U(e)),B(e,"layout",oW,U(e)),B(e,"createTournamentButton",rW,U(e)),B(e,"viewport",lW,U(e)),e}return N(a,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"start",value:function(){for(var e=0;e<20;e++)this.addTournamentBlock();var t=this.tournamentBlockArray[0];t&&(this.tournamentBlockContentHeight=t.uiTransform.contentSize.height+this.layout.spacingY)}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"updateData",value:function(e){var t=this,n=!1;e.forEach((function(e,i){var a=t.tournamentBlockArray[i];e.payload.playerId===yW.getPlayerId()&&(n=!0),a||(a=t.addTournamentBlock()),t.layout.node.addChild(a.node),a.updateInfo(e)})),n||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var e=He(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(e);var t=e.getComponent(Yq);return this.tournamentBlockArray.push(t),t}},{key:"removeTournamentBlocks",value:function(){var e,t=this.getActiveTournamentBlocks(),n=H(t);try{for(n.s();!(e=n.n()).done;){var i=e.value;this.inactiveNodeContainer.addChild(i.node)}}catch(e){n.e(e)}finally{n.f()}this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var e=this;return this.tournamentBlockArray.filter((function(t){return t.node.parent===e.layout.node}))}},{key:"setCreateTournamentButtonActive",value:function(e){e?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=e}},{key:"showTournamentBlocks",value:(n=W((function*(e,t){var n=this.getActiveTournamentBlocks();if(!(n.length<1)){var i=Math.ceil(e/this.tournamentBlockContentHeight),a=Math.min(n.length,i);yield Promise.all(n.map(function(){var e=W((function*(e,n){n<a?yield e.runShowPopUpAnimation(.1*n,.3,t):e.uiOpacity.opacity=255}));return function(t,n){return e.apply(this,arguments)}}()))}})),function(e,t){return n.apply(this,arguments)})},{key:"updateVisibility",value:function(){var e,t=this.viewport.getBoundingBoxToWorld(),n=t.yMax,i=t.yMin,a=this.getActiveTournamentBlocks(),o=H(a);try{for(o.s();!(e=o.n()).done;){var r=e.value,l=r.uiTransform;if(void 0!==l){var s=l.getBoundingBoxToWorld(),u=s.yMax,c=s.yMin,h=u<i||c>n;r.uiOpacity.opacity=h?0:255}}}catch(e){o.e(e)}finally{o.f()}}}]),a}(ce)).prototype,"tournamentBlockPrefab",[Zq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aW=M(nW.prototype,"inactiveNodeContainer",[Jq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oW=M(nW.prototype,"layout",[Qq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rW=M(nW.prototype,"createTournamentButton",[$q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lW=M(nW.prototype,"viewport",[eW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tW=nW))||tW);Q._RF.pop(),Q._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var vW,gW,mW,bW,wW,SW,kW,CW,EW,AW,TW,PW,RW,OW,IW,LW=(0,$.ccclass)("TournamentsNotAvailable")(hW=function(t){F(a,t);var n,i=x(a);function a(){return z(this,a),i.apply(this,arguments)}return N(a,[{key:"onLoad",value:function(){this.hide()}},{key:"show",value:(n=W((function*(){this.node.active=!0;var t=this.node.position.clone(),n=ae(this.node);n.to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)});var i=ae(this.node).repeat(2,n);i.to(.05,{position:t}),yield e.runTweenAsync(i)})),function(){return n.apply(this,arguments)})},{key:"hide",value:function(){this.node.active=!1}}]),a}(ce))||hW;Q._RF.pop(),Q._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var _W,DW,MW,NW,zW,BW,FW,xW,UW,GW=$.ccclass,HW=$.property,VW=globalThis.game,qW=VW.storage,WW=VW.match,KW=GameCore.Utils,jW=KW.Object,YW=KW.Array,XW=(vW=GW("TournamentContent"),gW=HW({type:Ta}),mW=HW(fW),bW=HW(LW),wW=HW(ot),SW=HW({type:[cW]}),kW=HW(mi),vW((AW=M((EW=function(e){F(s,e);var n,a,o,r,l=x(s);function s(){var e;z(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=l.call.apply(l,[this].concat(n)),B(e,"panelAnimator",AW,U(e)),B(e,"tournamentsBoard",TW,U(e)),B(e,"tournamentsNotAvailable",PW,U(e)),B(e,"scrollView",RW,U(e)),B(e,"skeletons",OW,U(e)),B(e,"contentOpacity",IW,U(e)),e.animAbortSignal=null,e.softAbortSignal=null,e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return N(s,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(ee),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(ot.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(As.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(ta.HIDE_UI,this.hideContent),this.node.scene.on(ta.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(ot.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(As.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(ta.HIDE_UI,this.hideContent),this.node.scene.off(ta.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(r=W((function*(){var e;if(null===this.animAbortSignal&&null===this.softAbortSignal&&(this.animAbortSignal=new i,this.softAbortSignal=new i,yield this.showLoading(this.animAbortSignal),!this.isAborted())){var t=yield m.requestTournamentDataAsync();this.isAborted()||(yield this.hideLoading(this.animAbortSignal),this.isAborted()||(0!==t.length||null!==(e=this.softAbortSignal)&&void 0!==e&&e.aborted?(this.tournamentsNotAvailable.hide(),this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(t),yield this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal),this.tournamentsBoard.updateVisibility()):this.tournamentsNotAvailable.show()))}})),function(){return r.apply(this,arguments)})},{key:"showLoading",value:(o=W((function*(e){this.scrollView.scrollToTop(0),this.scrollView.enabled=!1,yield Promise.all([this.skeletons.map((function(t){return t.show(0,e)}))])})),function(e){return o.apply(this,arguments)})},{key:"hideLoading",value:(a=W((function*(e){yield Promise.all([this.skeletons.map((function(t){return t.hide(e)}))])})),function(e){return a.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!qW.getStorage("tournament").animateTournamentLeader)return;var e=m.getAllTournamentData(),t=WW.getMatchState().customData.tournamentId;if(!t)throw new Error("Tournament ID not found");var n=YW.search(e,(function(e){return e.id===t}));if(!n)throw new Error("Tournament not found");var i=JSON.stringify(n);b.showTournamentDetailScreen(i,"tournament_end")}catch(e){qW.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",e)}}},{key:"processCreateTournament",value:(n=W((function*(){try{yield Zs.processCreateTournamentAsync()}catch(e){if(!jW.hasOwn(e,"code"))return void b.showNotificationScreenWithLocalizedKey("error.createTourFail",2);if("USER_INPUT"===e.code)return;if("PLAYER_HAS_TOURNAMENT"===e.code)return void b.showNotificationScreenWithLocalizedKey("error.tourExists",2);"INVALID_OPERATION"===e.code&&jW.hasOwn(e,"message")&&"string"==typeof e.message&&b.showNotificationScreen(e.message,2),b.showNotificationScreenWithLocalizedKey("error.createTourFail",2)}this.reload()})),function(){return n.apply(this,arguments)})},{key:"isAborted",value:function(){var e,t;return null===(e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===e||e}},{key:"cleanup",value:function(){var e;this.unlistenEvents(),null===(e=this.animAbortSignal)||void 0===e||e.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var e;null===(e=this.softAbortSignal)||void 0===e||e.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.listenEvents(),this.enter()}}]),s}(ce)).prototype,"panelAnimator",[gW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TW=M(EW.prototype,"tournamentsBoard",[mW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PW=M(EW.prototype,"tournamentsNotAvailable",[bW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RW=M(EW.prototype,"scrollView",[wW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OW=M(EW.prototype,"skeletons",[SW],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IW=M(EW.prototype,"contentOpacity",[kW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CW=EW))||CW);Q._RF.pop(),Q._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var ZW,JW,QW,$W,eK,tK;_W=(0,$.ccclass)("TournamentPage"),DW=t.required(),MW=t.onlyRunInLifeCycleAsync,NW=t.onlyRunInLifeCycle,zW=t.onlyRunInLifeCycleAsync,BW=t.onlyRunInLifeCycleAsync,_W((UW=M((xW=function(t){F(l,t);var n,i,a,o,r=x(l);function l(){var e;z(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),B(e,"panelAnimationController",UW,U(e)),e}return N(l,[{key:"onLoad",value:function(){this.panelAnimationController=this.getComponent(wa),V(q(l.prototype),"onLoad",this).call(this)}},{key:"start",value:(o=W((function*(){V(q(l.prototype),"start",this).call(this)})),function(){return o.apply(this,arguments)})},{key:"mount",value:(a=W((function*(){yield V(q(l.prototype),"mount",this).call(this),this.onMount()})),function(){return a.apply(this,arguments)})},{key:"onMount",value:function(){if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(XW),!this.content)throw new Error("LeaderboardPage: Leaders not found")}},{key:"transitionIn",value:(i=W((function*(){yield V(q(l.prototype),"transitionIn",this).call(this);var t=e.runTweenAsync(ae(this.containerUIOpacity).to(.2,{opacity:255})),n=this.panelAnimationController.showUI();this.content.listenEvents(),yield Promise.all([t,n]),this.content.enter()})),function(){return i.apply(this,arguments)})},{key:"transitionOut",value:(n=W((function*(){var e;null===(e=this.content)||void 0===e||e.softAbort(),this.content.unlistenUIEvents(),yield V(q(l.prototype),"transitionOut",this).call(this),yield this.panelAnimationController.hideUI()})),function(){return n.apply(this,arguments)})},{key:"unmount",value:function(){var e;null===(e=this.content)||void 0===e||e.cleanup(),V(q(l.prototype),"unmount",this).call(this)}}]),l}(AD)).prototype,"panelAnimationController",[DW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(xW.prototype,"mount",[MW],Object.getOwnPropertyDescriptor(xW.prototype,"mount"),xW.prototype),M(xW.prototype,"onMount",[NW],Object.getOwnPropertyDescriptor(xW.prototype,"onMount"),xW.prototype),M(xW.prototype,"transitionIn",[zW],Object.getOwnPropertyDescriptor(xW.prototype,"transitionIn"),xW.prototype),M(xW.prototype,"transitionOut",[BW],Object.getOwnPropertyDescriptor(xW.prototype,"transitionOut"),xW.prototype),FW=xW));Q._RF.pop(),Q._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var nK,iK,aK,oK,rK,lK,sK,uK,cK,hK=$.ccclass,pK=$.property;ZW=hK("EventBadge"),JW=pK(Se),QW=pK(Le),ZW((tK=M((eK=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"label",tK,U(e)),e}return N(n,[{key:"text",get:function(){return this.label.string},set:function(e){this.label.string=e}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(ce)).prototype,"label",[JW],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(eK.prototype,"text",[QW],Object.getOwnPropertyDescriptor(eK.prototype,"text"),eK.prototype),$W=eK));Q._RF.pop(),Q._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var dK,yK,fK,vK,gK,mK,bK,wK,SK,kK,CK,EK,AK,TK,PK,RK,OK,IK,LK,_K,DK,MK,NK,zK,BK,FK,xK,UK,GK,HK,VK,qK,WK,KK,jK,YK,XK,ZK,JK,QK,$K,ej,tj,nj,ij,aj,oj,rj=$.ccclass,lj=$.property;nK=rj("EventProgressBar"),iK=lj(Qo),aK=lj(Se),oK=lj(Le),rK=lj({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),nK((uK=M((sK=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"progressBar",uK,U(e)),B(e,"progressLabel",cK,U(e)),e}return N(n,[{key:"text",get:function(){return this.progressLabel.string},set:function(e){this.progressLabel.string=e}},{key:"progress",get:function(){return this.progressBar.progress},set:function(e){this.progressBar.progress=e}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(ce)).prototype,"progressBar",[iK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cK=M(sK.prototype,"progressLabel",[aK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(sK.prototype,"text",[oK],Object.getOwnPropertyDescriptor(sK.prototype,"text"),sK.prototype),M(sK.prototype,"progress",[rK],Object.getOwnPropertyDescriptor(sK.prototype,"progress"),sK.prototype),lK=sK));Q._RF.pop(),Q._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var sj,uj,cj,hj,pj,dj,yj=$.ccclass,fj=$.property,vj=$.executeInEditMode,gj=globalThis.game.analytics,mj=GameCore.Plugins.Analytics.Events;dK=yj("NavButton"),yK=fj(ye),fK=fj({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),vK=fj({type:ne,group:{name:"Animation"}}),gK=fj({type:ne,group:{name:"Animation"}}),mK=fj({type:ne,group:{name:"Animation"}}),bK=fj({type:ne,group:{name:"Animation"}}),wK=fj({type:ne,group:{name:"Animation"}}),SK=fj({group:{name:"Animation"}}),kK=fj({type:ne,group:{name:"Animation"}}),CK=fj({type:ne,group:{name:"Animation"}}),EK=fj({group:{name:"Animation"}}),AK=fj({type:ne,group:{name:"Animation"}}),TK=fj({type:ne,group:{name:"Animation"}}),PK=fj({type:ne,group:{name:"Animation"}}),RK=fj({type:ne,group:{name:"Animation"}}),OK=fj({type:ne,group:{name:"Animation"}}),IK=fj({type:ee}),LK=fj(ge),_K=fj(he),DK=fj({type:ee}),MK=fj({type:se(ln)}),NK=fj(Ix),dK(zK=vj((FK=M((BK=function(n){F(s,n);var i,a,l=x(s);function s(){var e;z(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=l.call.apply(l,[this].concat(n)),B(e,"wip",FK,U(e)),B(e,"isSelectedInEditor",xK,U(e)),B(e,"animationDuration",UK,U(e)),B(e,"selectedSpacing",GK,U(e)),B(e,"deselectedSpacing",HK,U(e)),B(e,"selectedIconY",VK,U(e)),B(e,"selectedIconX",qK,U(e)),B(e,"selectedIconScale",WK,U(e)),B(e,"deselectedIconY",KK,U(e)),B(e,"deselectedIconX",jK,U(e)),B(e,"deselectedIconScale",YK,U(e)),B(e,"initTextY",XK,U(e)),B(e,"selectedTextY",ZK,U(e)),B(e,"selectedTextX",JK,U(e)),B(e,"deselectedTextY",QK,U(e)),B(e,"deselectedTextX",$K,U(e)),B(e,"spacer",ej,U(e)),B(e,"icon",tj,U(e)),B(e,"text",nj,U(e)),B(e,"uiTransform",ij,U(e)),B(e,"screenType",aj,U(e)),B(e,"navManager",oj,U(e)),e.isSelected=!1,e.onMouseEnter=function(t){e.isSelected||e.playHoverOnAnimation()},e.onMouseLeave=function(t){e.isSelected||e.playHoverOffAnimation()},e}return N(s,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(ge.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(ge.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(ge.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.initTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var e,t;this.isSelected||(o.playSound(vn.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),gj.event(mj.BUTTON_CLICK,{button_name:null!==(e=null===(t=this.node.parent)||void 0===t?void 0:t.name)&&void 0!==e?e:this.node.name,screen_name:r.getCurrentPage()}))}},{key:"select",value:(a=W((function*(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0,t?yield e.runTweenAsync(this.playSelectAnimation()):(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255)})),function(){return a.apply(this,arguments)})},{key:"deselect",value:(i=W((function*(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isSelected&&!n)throw new Error("NavButton: Already deselected");this.isSelected=!1,t?yield e.runTweenAsync(this.deselectAnimation()):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0)})),function(){return i.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var e=new Ie(this.selectedIconX,this.selectedIconY,0),t=new Ie(this.deselectedIconX,this.deselectedIconY,0),n=this.node.scale.clone();this.node.scale=this.selectedIconScale;var i=this.uiTransform.convertToWorldSpaceAR(e),a=this.uiTransform.convertToWorldSpaceAR(t);return this.node.scale=n,a.x-i.x}},{key:"playHoverOnAnimation",value:function(){var t=ae(this.icon);return t.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),e.runTweenAsync(t)}},{key:"playHoverOffAnimation",value:function(){var t=ae(this.icon);return t.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),e.runTweenAsync(t)}},{key:"playSelectAnimation",value:function(){var e=this;return ae(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=ue.quintInOut(n),a=ue.backOut(n),o=ue.linear(n),r=n<.5?2*n:1,l=e.deselectedIconY+(e.selectedIconY-e.deselectedIconY)*a,s=e.deselectedIconX+(e.selectedIconX-e.deselectedIconX)*o;e.icon.setPosition(s,l,0);var u=e.deselectedIconScale.clone().lerp(e.selectedIconScale,i);e.icon.setScale(u.x,u.y,e.icon.scale.z);var c=255*r,h=e.deselectedTextY+(e.selectedTextY-e.deselectedTextY)*o,p=e.deselectedTextX+(e.selectedTextX-e.deselectedTextX)*o;e.text.opacity=c,e.text.node.setPosition(p,h,0)}}})}},{key:"deselectAnimation",value:function(){var e=this;return ae(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=Ke(e.selectedIconY,e.deselectedIconY,n),a=Ke(e.selectedIconX,e.deselectedIconX,n);e.icon.setPosition(a,i,0);var o=Ke(255,0,n<.5?2*n:1);e.text.opacity=o;var r=Ke(e.selectedTextY,e.deselectedTextY,n),l=Ke(e.selectedTextX,e.deselectedTextX,n);e.text.node.setPosition(l,r,0);var s=e.selectedIconScale.clone().lerp(e.deselectedIconScale,ue.quintInOut(n));e.icon.setScale(s.x,s.y,e.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(ee),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}}]),s}(ce)).prototype,"wip",[yK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xK=M(BK.prototype,"isSelectedInEditor",[fK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),UK=M(BK.prototype,"animationDuration",[vK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),GK=M(BK.prototype,"selectedSpacing",[gK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),HK=M(BK.prototype,"deselectedSpacing",[mK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),VK=M(BK.prototype,"selectedIconY",[bK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),qK=M(BK.prototype,"selectedIconX",[wK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WK=M(BK.prototype,"selectedIconScale",[SK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ie(1,1,1)}}),KK=M(BK.prototype,"deselectedIconY",[kK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jK=M(BK.prototype,"deselectedIconX",[CK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YK=M(BK.prototype,"deselectedIconScale",[EK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ie(.8,.8,1)}}),XK=M(BK.prototype,"initTextY",[AK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-100}}),ZK=M(BK.prototype,"selectedTextY",[TK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-10}}),JK=M(BK.prototype,"selectedTextX",[PK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),QK=M(BK.prototype,"deselectedTextY",[RK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$K=M(BK.prototype,"deselectedTextX",[OK],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ej=M(BK.prototype,"spacer",[IK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tj=M(BK.prototype,"icon",[LK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nj=M(BK.prototype,"text",[_K],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ij=M(BK.prototype,"uiTransform",[DK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aj=M(BK.prototype,"screenType",[MK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oj=M(BK.prototype,"navManager",[NK],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zK=BK))||zK);Q._RF.pop(),Q._RF.push({},"091aai5+ANDeZfFN8JFkbyi","TournamentButton",void 0);var bj,wj,Sj,kj,Cj,Ej,Aj=$.ccclass,Tj=$.property,Pj=globalThis.game.leaderboard;sj=Aj("TournamentButton"),uj=Tj(ge),cj=t.onlyRunInLifeCycleAsync,sj((dj=M((pj=function(t){F(o,t);var n,i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"hotIcon",dj,U(e)),e}return N(o,[{key:"onLoad",value:(i=W((function*(){try{var e,t=yield m.requestTournamentDataAsync(),n=H(t);try{for(n.s();!(e=n.n()).done;){var i=e.value.payload,a=i.leaderboardId,o=i.playerId;if(a&&"global"===o){var r=Pj.getLeaderboardName(a);if(r&&(yield Pj.requestLeaderboardAsync(r,0),this.checkAndShowHotIcon(r)))break}}}catch(e){n.e(e)}finally{n.f()}}catch(e){console.info("Error in TournamentButton",e)}})),function(){return i.apply(this,arguments)})},{key:"checkAndShowHotIcon",value:function(e){if(!this.node.activeInHierarchy)return!1;var t=Pj.getLeaderboard(e);return!!t&&(!(t.amountPlayer<30)&&(this.showHotIcon(),!0))}},{key:"showHotIcon",value:(n=W((function*(){this.hotIcon.active=!0,this.hotIcon.scale=Ie.ZERO;var t=ae(this.hotIcon).to(.5,{scale:Ie.ONE},{easing:"backOut"});yield e.runTweenAsync(t);var n=ae(this.hotIcon).delay(1).to(.3,{scale:new Ie(1.1,1.1)},{easing:"backIn"}).to(.3,{scale:Ie.ONE},{easing:"backOut"});ae(this.hotIcon).repeatForever(n).start()})),function(){return n.apply(this,arguments)})}]),o}(ce)).prototype,"hotIcon",[uj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(pj.prototype,"showHotIcon",[cj],Object.getOwnPropertyDescriptor(pj.prototype,"showHotIcon"),pj.prototype),hj=pj));Q._RF.pop(),Q._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var Rj,Oj,Ij,Lj,_j,Dj,Mj,Nj=$.ccclass,zj=$.property,Bj=$.disallowMultiple,Fj=globalThis.game.player,xj=s.Layout,Uj=GameCore.Match.Modes,Gj=[vn.COMBO_1,vn.COMBO_2,vn.COMBO_3,vn.COMBO_4,vn.COMBO_5,vn.COMBO_6,vn.COMBO_7,vn.COMBO_8,vn.COMBO_9,vn.COMBO_10,vn.COMBO_11,vn.COMBO_12,vn.COMBO_13,vn.TILE_MATCH,vn.BOMB_DEFUSE,vn.BOMB_EXPLODE_1,vn.BOMB_EXPLODE_2,vn.TILE_SELECT,vn.THUNDERBOLT,vn.SHUFFLE_ITEM,vn.LEVEL_START,vn.LEVEL_COMPLETE,vn.LEVEL_FAIL];bj=Nj("GameScene"),wj=t.required,Sj=zj(LI),bj(kj=Bj((Ej=M((Cj=function(i){F(r,i);var a=x(r);function r(){var t;z(this,r);for(var n=arguments.length,i=new Array(n),l=0;l<n;l++)i[l]=arguments[l];return t=a.call.apply(a,[this].concat(i)),B(t,"coinManager",Ej,U(t)),t.handleGameExit=function(){C.switchScene(A.DASHBOARD_SCENE)},t.handleShowResults=function(){C.switchScene(A.CHALLENGE_RESULT_SCENE)},t.handleGameMaskWhenLayoutChanged=function(e){var t=Ne("Canvas/Game/GameObjects");if(t){var n=t.getComponent(lt);n&&(n.enabled=e===xj.Landscape)}},t.updateMusic=W((function*(){var t=Zs.getMatchMode()===Uj.TOURNAMENT,n=t?vn.TOURNAMENT_MUSIC:vn.BG_MUSIC;o.getCurrentMusic()!==n&&(yield o.setVolumeMusic(0,!0),yield e.waitTweenAsync(1)),o.playMusic(n,t),o.setVolumeMusic(t?.4:.3,!0)})),t}return N(r,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onLoad",value:function(){this.coinManager.init()}},{key:"validateRequiredComponents",value:function(){t.validateRequiredProperties(this,r)}},{key:"listenGameEvents",value:function(){be.on(l.ORIENTATION_CHANGED,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(ta.GAME_EXIT,this.handleGameExit),this.node.scene.on(ta.SHOW_CHALLENGE_RESULTS,this.handleShowResults),this.node.scene.on(ta.UPDATE_MUSIC,this.updateMusic)}},{key:"start",value:function(){Fj.getPlayerSetting("music")&&this.updateMusic(),this.preloadSounds(),this.preloadTileAnimations(),this.scheduleOnce(this.preloadScenes,3)}},{key:"preloadTileAnimations",value:function(){return uc.preloadTileAnimations()}},{key:"preloadSounds",value:function(){for(var e=0,t=Gj;e<t.length;e++){var i=t[e];n.loadAudioClipAsync(i)}}},{key:"preloadScenes",value:function(){C.preloadDashboardScene()}}]),r}(ce)).prototype,"coinManager",[wj,Sj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kj=Cj))||kj);Q._RF.pop(),Q._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var Hj,Vj,qj,Wj,Kj,jj,Yj,Xj=$.ccclass,Zj=$.property;Rj=Xj("ComboEffect"),Oj=Zj(he),Ij=Zj(Ae),Rj((Dj=M((_j=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"circleOpacity",Dj,U(e)),B(e,"particle",Mj,U(e)),e}return N(i,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(ta.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){e>1&&(this.circleOpacity.node.scale=Ie.ZERO,this.circleOpacity.opacity=60,this.particle.resetSystem(),ae(this.circleOpacity.node).to(.2,{scale:new Ie(1.3,1.3,1.3)},{easing:"quadOut"}).start(),ae(this.circleOpacity).delay(.3).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),i}(ce)).prototype,"circleOpacity",[Oj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mj=M(_j.prototype,"particle",[Ij],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lj=_j));Q._RF.pop(),Q._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var Jj,Qj,$j,eY,tY,nY,iY,aY,oY,rY=$.ccclass,lY=$.property;Hj=rY("ComboLabel"),Vj=lY(Se),qj=lY(ge),Hj((jj=M((Kj=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"comboNumber",jj,U(e)),B(e,"comboContainer",Yj,U(e)),e}return N(i,[{key:"onLoad",value:function(){this.opacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(ta.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>1?(this.opacity.opacity=255,this.comboNumber.string="".concat(e),ae(this.comboContainer).to(.1,{scale:new Ie(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:Ie.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),i}(ce)).prototype,"comboNumber",[Vj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yj=M(Kj.prototype,"comboContainer",[qj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wj=Kj));Q._RF.pop(),Q._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var sY,uY,cY,hY,pY,dY,yY,fY,vY,gY,mY,bY,wY,SY=$.ccclass,kY=$.property,CY=s.Layout,EY=["good","great","excellent"];Jj=SY("ComboPopup"),Qj=t.required(),$j=kY(p),eY=t.required(),tY=kY(Fe),Jj((aY=M((iY=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"spriteLocalizer",aY,U(e)),B(e,"animation",oY,U(e)),e}return N(i,[{key:"__preload",value:function(){this.widget=this.getComponent(ie),t.validateRequiredProperties(this)}},{key:"onLoad",value:function(){be.on(l.ORIENTATION_CHANGED,this.handleOrientationChanged,this),this.handleOrientationChanged(Co.getCurrentLayout())}},{key:"onDestroy",value:function(){be.off(l.ORIENTATION_CHANGED,this.handleOrientationChanged,this)}},{key:"start",value:function(){this.node.scene.on(ta.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){if(!(e<2))for(var t=EY.length-1;t>=0;t--){var n=EY[t];if(e>=t+2){this.spriteLocalizer.key=n,this.animation.play();break}}}},{key:"handleOrientationChanged",value:function(e){e===CY.Portrait?(this.widget.left=20,this.widget.right=20):e===CY.Landscape&&(this.widget.left=700,this.widget.right=120)}}]),i}(ce)).prototype,"spriteLocalizer",[Qj,$j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oY=M(iY.prototype,"animation",[eY,tY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nY=iY));Q._RF.pop(),Q._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var AY,TY,PY,RY,OY,IY,LY,_Y,DY,MY,NY,zY,BY,FY,xY,UY,GY,HY,VY,qY,WY,KY,jY,YY,XY,ZY,JY=$.ccclass,QY=$.property,$Y=(sY=JY("PlayerScore"),uY=QY(ge),cY=QY(Se),hY=QY(he),pY=QY(he),dY=QY(le),sY((vY=M((fY=function(e){F(i,e);var t,n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"crown",vY,U(e)),B(e,"playerScore",gY,U(e)),B(e,"playerScoreUiOpacity",mY,U(e)),B(e,"waitingUiOpacity",bY,U(e)),B(e,"avatar",wY,U(e)),e}return N(i,[{key:"showCrown",value:function(e){this.crown.active=e}},{key:"setPlayerScore",value:function(e){this.playerScore.string=e.toString()}},{key:"playWaitingAnimation",value:function(){this.waitingUiOpacity.node.active=!0,this.playerScoreUiOpacity.node.active=!1,this.waitingUiOpacity.opacity=130,this.playerScoreUiOpacity.opacity=0;var e=ae(this.waitingUiOpacity).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=ae(this.waitingUiOpacity).repeatForever(e).start()}},{key:"stopWaitingAnimation",value:function(){this.waitingAnimation&&this.waitingAnimation.stop(),this.waitingUiOpacity.opacity=0,this.playerScoreUiOpacity.opacity=255,this.waitingUiOpacity.node.active=!1,this.playerScoreUiOpacity.node.active=!0}},{key:"loadPhoto",value:(t=W((function*(e,t){try{var n=yield VE.getPlayerAvatar(e,t,128);if(!n)throw new Error("Failed to create sprite frame");n.packable=!0,this.avatar.spriteFrame=n}catch(e){return void console.error(e)}})),function(e,n){return t.apply(this,arguments)})}]),i}(ce)).prototype,"crown",[uY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gY=M(fY.prototype,"playerScore",[cY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mY=M(fY.prototype,"playerScoreUiOpacity",[hY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bY=M(fY.prototype,"waitingUiOpacity",[pY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wY=M(fY.prototype,"avatar",[dY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yY=fY))||yY);Q._RF.pop(),Q._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var eX,tX,nX,iX,aX,oX,rX=$.ccclass,lX=$.disallowMultiple,sX=$.property,uX=globalThis.game,cX=uX.match,hX=uX.player,pX=uX.monitorError,dX=GameCore.Utils.Object;AY=rX("ChallengeResultScene"),TY=sX(p),PY=sX(p),RY=sX(p),OY=sX(p),IY=sX({type:$Y,group:"Score"}),LY=sX({type:$Y,group:"Score"}),_Y=sX(Fg),DY=sX(Bk),MY=sX(Fe),NY=t.onlyRunInLifeCycle,zY=t.onlyRunInLifeCycle,BY=t.onlyRunInLifeCycle,FY=t.onlyRunInLifeCycle,xY=t.onlyRunInLifeCycle,AY(UY=lX((HY=M((GY=function(e){F(a,e);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"drawLocalizer",HY,U(e)),B(e,"winLocalizer",VY,U(e)),B(e,"loseLocalizer",qY,U(e)),B(e,"waitingLocalizer",WY,U(e)),B(e,"playerScore",KY,U(e)),B(e,"opponentScore",jY,U(e)),B(e,"paperConfetti",YY,U(e)),B(e,"levelManager",XY,U(e)),B(e,"headerAnimation",ZY,U(e)),e.goToDashboardScene=function(){C.switchScene(A.DASHBOARD_SCENE)},e}return N(a,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.node.scene.on(l.RESULT_SCENE_HOME,this.goToDashboardScene),this.node.scene.on(l.RESULT_SCENE_REPLAY,this.handleTryAgainClicked,this)}},{key:"start",value:function(){this.scheduleOnce(this.preloadScenes,3);try{var e,t,n=cX.getMatchState(),i=n.customData,a=i.playerId,o=i.opponentId;if(null===a||null===o)throw new Error("ResultScene: playerId is ".concat(a," and opponentId is ").concat(o,". Expected to not be null."));var r=hX.getPlayer().photo,l=null!==(e=n.profiles[a])&&void 0!==e?e:{},s=l.score,u=void 0===s?0:s,c=l.finished,h=void 0!==c&&c,p=null!==(t=n.profiles[o])&&void 0!==t?t:{},d=p.photo,y=void 0===d?"":d,f=p.score,v=void 0===f?0:f,g=p.finished,m=void 0!==g&&g,b=h&&m,w=b&&u>v,S=b&&v>u;this.playerScore.loadPhoto(r,a),this.opponentScore.loadPhoto(y,o),this.playerScore.setPlayerScore(u),this.opponentScore.setPlayerScore(v),this.playerScore.showCrown(w),this.opponentScore.showCrown(S),h&&m?u===v?this.playStatusAnimation("Draw"):w?this.playStatusAnimation("Win"):S&&this.playStatusAnimation("Lose"):(h||this.playerScore.playWaitingAnimation(),m||this.opponentScore.playWaitingAnimation(),this.playStatusAnimation("Waiting"))}catch(e){console.warn("ResultScene: Error on load",e),this.goToDashboardScene()}}},{key:"preloadScenes",value:function(){C.preloadDashboardScene()}},{key:"handleTryAgainClicked",value:(n=W((function*(){var e,t=(null!==(e=hX.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;n=Math.max(1,n);var i=yield this.levelManager.loadLevelData(n);try{if(!i)throw new Error("Level data is not found");var a=cX.getMatchState().customData.opponentId;if(!a)throw new Error("Opponent id is not found");b.showLoadingScreen();var o=Dh.generateFen(i),r=i.mode,l=void 0===r?"":r,s=i.rules,u=void 0===s?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:s,c=i.time,h=void 0===c?0:c,p=i.level;yield cX.challenge.friend.processAsync({playerId:hX.getPlayerId(),opponentId:a,extraData:{level:p,fen:o,gravity:l,rules:u,time:h}}),b.closeLoadingScreen(),this.goToGameScene()}catch(e){if(dX.hasOwn(e,"code")&&"USER_INPUT"===e.code)return void b.closeLoadingScreen();console.warn("ReplayChallengeFriend",e),b.closeLoadingScreen(),b.showNotificationScreenWithLocalizedKey("error.challengeFail",2),null==pX||pX.sendException(e instanceof Error?e:new Error("ReplayChallengeFriend"+JSON.stringify(e))),this.scheduleOnce(this.goToDashboardScene,2)}})),function(){return n.apply(this,arguments)})},{key:"handleHomeClicked",value:function(){this.goToDashboardScene()}},{key:"goToGameScene",value:function(){C.switchScene(A.GAME_SCENE)}},{key:"playStatusAnimation",value:function(e){var t=this;"Win"!==e&&"Waiting"!==e||this.triggerConfettiAnimation();var n=this.getSpriteLocalizer(e);n.node.active=!0,n.waitLocalized().then((function(){switch(e){case"Draw":t.playDrawAnimation();break;case"Win":t.playWinAnimation();break;case"Lose":t.playLoseAnimation();break;case"Waiting":t.playWaitingAnimation()}}))}},{key:"getSpriteLocalizer",value:function(e){switch(e){case"Draw":return this.drawLocalizer;case"Win":return this.winLocalizer;case"Lose":return this.loseLocalizer;case"Waiting":return this.waitingLocalizer}}},{key:"playDrawAnimation",value:function(){this.headerAnimation.play("RibbonDraw"),o.playSound(vn.LEVEL_FAIL)}},{key:"playWinAnimation",value:function(){this.headerAnimation.play("RibbonWin"),o.playSound(vn.LEVEL_COMPLETE)}},{key:"playLoseAnimation",value:function(){this.headerAnimation.play("RibbonLose"),o.playSound(vn.LEVEL_FAIL)}},{key:"playWaitingAnimation",value:function(){this.headerAnimation.play("RibbonWaiting"),o.playSound(vn.LEVEL_COMPLETE)}},{key:"triggerConfettiAnimation",value:function(){var e=this;this.scheduleOnce((function(){var t,n=H(e.paperConfetti);try{for(n.s();!(t=n.n()).done;){t.value.play()}}catch(e){n.e(e)}finally{n.f()}}),.2)}}]),a}(ce)).prototype,"drawLocalizer",[TY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VY=M(GY.prototype,"winLocalizer",[PY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qY=M(GY.prototype,"loseLocalizer",[RY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WY=M(GY.prototype,"waitingLocalizer",[OY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KY=M(GY.prototype,"playerScore",[IY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jY=M(GY.prototype,"opponentScore",[LY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YY=M(GY.prototype,"paperConfetti",[_Y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),XY=M(GY.prototype,"levelManager",[DY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZY=M(GY.prototype,"headerAnimation",[MY],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(GY.prototype,"playDrawAnimation",[NY],Object.getOwnPropertyDescriptor(GY.prototype,"playDrawAnimation"),GY.prototype),M(GY.prototype,"playWinAnimation",[zY],Object.getOwnPropertyDescriptor(GY.prototype,"playWinAnimation"),GY.prototype),M(GY.prototype,"playLoseAnimation",[BY],Object.getOwnPropertyDescriptor(GY.prototype,"playLoseAnimation"),GY.prototype),M(GY.prototype,"playWaitingAnimation",[FY],Object.getOwnPropertyDescriptor(GY.prototype,"playWaitingAnimation"),GY.prototype),M(GY.prototype,"triggerConfettiAnimation",[xY],Object.getOwnPropertyDescriptor(GY.prototype,"triggerConfettiAnimation"),GY.prototype),UY=GY))||UY);Q._RF.pop(),Q._RF.push({},"c0a5fPghzxBxpXiudxt+Qd4","TestParticleSystemScene",void 0);var yX,fX=$.ccclass,vX=$.property;eX=fX("TestParticleSystemScene"),tX=vX(ge),nX=t.required(),eX((oX=M((aX=function(e){F(n,e);var t=x(n);function n(){var e;z(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),B(e,"stars",oX,U(e)),e}return N(n,[{key:"__preload",value:function(){C.markIsTestScene(A.TEST_PARTICLE_SYSTEM_SCENE)}},{key:"onLoad",value:function(){GameSDK.startGameAsync().catch((function(e){console.warn("GameSDK.startGameAsync",e)}))}},{key:"start",value:function(){var e=this.stars.getComponent(Fg);null==e||e.play()}}]),n}(ce)).prototype,"stars",[tX,nX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iX=aX));Q._RF.pop(),Q._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var gX,mX,bX,wX,SX,kX,CX,EX,AX,TX,PX,RX,OX,IX,LX=$.ccclass,_X=$.requireComponent;LX("BackgroundMask")(yX=_X([he])(yX=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"onLoad",value:function(){var e=this.getComponent(he);e?(this.opacity=e,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var e,t,n=this.opacity.opacity/255;e=n,(t=document.getElementById("app-mask"))&&(t.style.background="rgb(0 0 0 / ".concat(e,")"))}}]),n}(ce))||yX);Q._RF.pop(),Q._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var DX,MX,NX,zX,BX,FX,xX,UX,GX,HX,VX,qX,WX,KX,jX,YX,XX,ZX,JX,QX,$X,eZ,tZ,nZ=$.ccclass,iZ=$.property,aZ=$.disallowMultiple,oZ=$.requireComponent,rZ=GameCore.Events,lZ=globalThis.game.event;gX=nZ("CongratulationScreen"),mX=oZ(R),bX=iZ(ge),wX=iZ(ge),SX=iZ(fe),kX=iZ(fe),CX=iZ(fe),gX(EX=aZ(EX=mX((TX=M((AX=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"congratulation",TX,U(e)),B(e,"confirmation",PX,U(e)),B(e,"closeButtonComponent",RX,U(e)),B(e,"yesButtonComponent",OX,U(e)),B(e,"noButtonComponent",IX,U(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("CongratulationScreen: screen not found");e.validateEventPayload(t)&&(e.closeButtonComponent.interactable=!0,e.yesButtonComponent.interactable=!0,e.noButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return N(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.confirmationUIOpacity=this.confirmation.getComponent(he),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){lZ.on(rZ.OPENING_SCREEN,this.handleOpeningScreen),lZ.on(rZ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){lZ.off(rZ.OPENING_SCREEN,this.handleOpeningScreen),lZ.off(rZ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,b.closeScreen(w.CONGRATULATION_SCREEN)}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,ae(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),ae(this.confirmation).set({scale:new Ie(.8,.8,.8)}).to(.2,{scale:new Ie(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(ta.START_OVER,1)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(ta.GAME_REPLAY,{level:this.screen.data.level})}}]),i}(ce)).prototype,"congratulation",[bX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PX=M(AX.prototype,"confirmation",[wX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RX=M(AX.prototype,"closeButtonComponent",[SX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OX=M(AX.prototype,"yesButtonComponent",[kX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IX=M(AX.prototype,"noButtonComponent",[CX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EX=AX))||EX)||EX);Q._RF.pop(),Q._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var sZ,uZ,cZ,hZ,pZ,dZ,yZ,fZ,vZ,gZ,mZ,bZ,wZ,SZ,kZ,CZ,EZ,AZ,TZ,PZ,RZ,OZ=$.ccclass,IZ=$.property,LZ=(DX=OZ("DayBlock"),MX=IZ({type:le,group:"Background"}),NX=IZ({type:le,group:"Background"}),zX=IZ({type:Be,group:"Background"}),BX=IZ({type:Be,group:"Background"}),FX=IZ(Se),xX=IZ(p),UX=IZ(Se),GX=IZ(ge),HX=IZ(ge),VX=IZ(ge),DX((KX=M((WX=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"background",KX,U(e)),B(e,"topBackground",jX,U(e)),B(e,"blueBackground",YX,U(e)),B(e,"blueTopBackground",XX,U(e)),B(e,"dayLabel",ZX,U(e)),B(e,"dayLocalizer",JX,U(e)),B(e,"coinLabel",QX,U(e)),B(e,"rewardItemsNode",$X,U(e)),B(e,"checkNode",eZ,U(e)),B(e,"glowNodes",tZ,U(e)),e}return N(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(he),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new we(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new we("#3469bf")}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e){this.updateBackground(e),this.updateDayLabel(e),this.coinLabel.string=e.value.toString(),this.updateRewardItems(e)}},{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLocalizer.setParams([e.day.toString()]);var t=this.defaultDayLabelOutlineColor;"rewarded"!==e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=t,this.dayLabel.shadowColor=t}},{key:"updateRewardItems",value:function(e){switch(e.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(e){this.glowNodes&&this.glowNodes.forEach((function(t){t.active=e}))}}]),i}(ce)).prototype,"background",[MX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jX=M(WX.prototype,"topBackground",[NX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YX=M(WX.prototype,"blueBackground",[zX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XX=M(WX.prototype,"blueTopBackground",[BX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZX=M(WX.prototype,"dayLabel",[FX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JX=M(WX.prototype,"dayLocalizer",[xX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QX=M(WX.prototype,"coinLabel",[UX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$X=M(WX.prototype,"rewardItemsNode",[GX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eZ=M(WX.prototype,"checkNode",[HX],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tZ=M(WX.prototype,"glowNodes",[VX],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qX=WX))||qX);Q._RF.pop(),Q._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var _Z,DZ=$.ccclass,MZ=$.property,NZ=$.requireComponent,zZ=GameCore,BZ=zZ.Events,FZ=zZ.Utils,xZ=FZ.Object,UZ=FZ.Array,GZ=zZ.Configs.DailyRewards,HZ=globalThis.game,VZ=HZ.event,qZ=HZ.dailyRewards,WZ=HZ.player,KZ=HZ.monitorError;sZ=DZ("DailyRewardsScreen"),uZ=NZ(R),cZ=t.required(),hZ=t.required(),pZ=MZ(ge),dZ=t.required(),yZ=MZ(fe),fZ=t.required(),vZ=MZ(fe),gZ=MZ([LZ]),mZ=t.onlyRunInLifeCycleAsync,bZ=t.onlyRunInLifeCycle,wZ=t.onlyRunInLifeCycleAsync,SZ=t.onlyRunInLifeCycle,sZ(kZ=uZ((EZ=M((CZ=function(n){F(c,n);var a,o,r,l,s,u=x(c);function c(){var e;z(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=u.call.apply(u,[this].concat(n)),B(e,"screen",EZ,U(e)),e.rewardsData=[],e.debugScreenOpened=!1,e.debugUpdatedRewardsData=!1,B(e,"loadingRing",AZ,U(e)),B(e,"claimButton",TZ,U(e)),B(e,"claimX2Button",PZ,U(e)),B(e,"dailyBlocks",RZ,U(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!0)},e.handleOpenedScreen=function(){var t=W((function*(t){e.validateEventPayload(t)&&e.open()}));return function(e){return t.apply(this,arguments)}}(),e}return N(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),t.validateRequiredProperties(this),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"listenScreenEvents",value:function(){VZ.on(BZ.OPENING_SCREEN,this.handleOpeningScreen),VZ.on(BZ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){VZ.off(BZ.OPENING_SCREEN,this.handleOpeningScreen),VZ.off(BZ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.prepareScreen(),this.openAsync()}},{key:"openAsync",value:(s=W((function*(){yield this.updateRewardsData(),yield this.updateScreenToMatchData()})),function(){return s.apply(this,arguments)})},{key:"updateScreenToMatchData",value:function(){return this.loginDailyRewards(),this.updateDayBlocks(),this.loadingRing.active=!1,this.setInteractableButtons(!0),this.runPopUpAnimation()}},{key:"prepareScreen",value:function(){
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.debugScreenOpened=!0,this.loadingRing.active=!0,this.setInteractableButtons(!1),this.node.scene.emit(ta.HIDE_UI),this.resetState()}},{key:"close",value:function(){VZ.emit(BZ.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(ta.SHOW_UI)}},{key:"resetState",value:function(){var e,t=H(this.dailyBlocks);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.uiOpacity.opacity=0,n.node.scale=new Ie(1.2,1.2,1.2)}}catch(e){t.e(e)}finally{t.f()}}},{key:"runPopUpAnimation",value:(l=W((function*(){var e=this;this.screen.container||console.warn("DailyRewardScreen: screen not found"),yield Promise.all(this.dailyBlocks.map((function(t,n){return e.runAppearTween(t,.15*n)})))})),function(){return l.apply(this,arguments)})},{key:"runAppearTween",value:(r=W((function*(t,n){var i=ae(t.uiOpacity).delay(n).to(.3,{opacity:255},{easing:"quadOut"}),a=ae(t.node).delay(n).to(.3,{scale:Ie.ONE},{easing:"backOut"});yield Promise.all([e.runTweenAsync(i),e.runTweenAsync(a)])})),function(e,t){return r.apply(this,arguments)})},{key:"handleOnClaim",value:function(){this.setInteractableButtons(!1);var e=this.getCurrentRewardData();if(!e)
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return null==KZ||KZ.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),b.showNotificationScreenWithLocalizedKey("error.rewardFail",2),void this.setInteractableButtons(!0);this.claimReward(e)}},{key:"handleOnClaimX2",value:(o=W((function*(){this.setInteractableButtons(!1);var e=this.getCurrentRewardData();if(!e)
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return null==KZ||KZ.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),b.showNotificationScreenWithLocalizedKey("error.rewardFail",2),void this.setInteractableButtons(!0);(yield S.showRewardVideoAdAsync({}))?this.claimReward(e,!0):this.setInteractableButtons(!0)})),function(){return o.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return UZ.search(this.rewardsData,(function(e){return"ready"===e.status}))}},{key:"claimReward",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.value*(t?2:1),a=new i;if(this.node.scene.emit(ta.ADD_COINS,{coins:n,collectionAnimation:{animateTextOnly:!1,signal:a}}),e.items){var o=e.items.hint*(t?2:1),r=e.items.thunder*(t?2:1),l=e.items.storm*(t?2:1),s=WZ.getGameData();s?(WZ.setGameData({items:{hint:s.items.hint+o,thunder:s.items.thunder+r,storm:s.items.storm+l,pliers:s.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(a=W((function*(){yield qZ.requestDailyRewardsAsync();for(var e=G({},qZ.getDailyRewards()),t=0;t<GZ.MaxDays;t++)e[t]=G(G({},e[t]),{},{value:ks[t].value,items:ks[t].items});e&&(this.rewardsData=xZ.vals(e),
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData))})),function(){return a.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){qZ.logLoginReward()}},{key:"updateDayBlocks",value:function(){var e=this;
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),null==KZ||KZ.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach((function(t,n){
//! DEBUG bug Cannot read properties of undefined (reading 'find')
if(!(n>=e.rewardsData.length)){var i=e.rewardsData[n],a=i.id,o=i.type,r=i.value,l=i.status;t.updateInfo({day:a,type:o,value:r,status:l})}}))}},{key:"setInteractableButtons",value:function(e){this.claimButton.interactable=e,this.claimX2Button.interactable=e,this.screen.backgroundMaskButton.interactable=e}}]),c}(ce)).prototype,"screen",[cZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AZ=M(CZ.prototype,"loadingRing",[hZ,pZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TZ=M(CZ.prototype,"claimButton",[dZ,yZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PZ=M(CZ.prototype,"claimX2Button",[fZ,vZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RZ=M(CZ.prototype,"dailyBlocks",[gZ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),M(CZ.prototype,"updateScreenToMatchData",[mZ],Object.getOwnPropertyDescriptor(CZ.prototype,"updateScreenToMatchData"),CZ.prototype),M(CZ.prototype,"claimReward",[bZ],Object.getOwnPropertyDescriptor(CZ.prototype,"claimReward"),CZ.prototype),M(CZ.prototype,"updateRewardsData",[wZ],Object.getOwnPropertyDescriptor(CZ.prototype,"updateRewardsData"),CZ.prototype),M(CZ.prototype,"setInteractableButtons",[SZ],Object.getOwnPropertyDescriptor(CZ.prototype,"setInteractableButtons"),CZ.prototype),kZ=CZ))||kZ);Q._RF.pop(),Q._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var jZ,YZ,XZ,ZZ,JZ,QZ,$Z,eJ,tJ,nJ;(0,$.ccclass)("DayBlockRed")(_Z=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n,[{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLocalizer.setParams([e.day.toString()]);var t=this.defaultDayLabelOutlineColor;"ready"===e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=t,this.dayLabel.outlineColor=t}}]),n}(LZ));Q._RF.pop(),Q._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var iJ,aJ,oJ,rJ,lJ,sJ,uJ,cJ,hJ,pJ,dJ,yJ,fJ,vJ,gJ,mJ,bJ,wJ,SJ,kJ,CJ,EJ,AJ,TJ,PJ,RJ,OJ,IJ,LJ,_J,DJ,MJ=$.ccclass,NJ=$.property,zJ=$.requireComponent,BJ=globalThis.game.event,FJ=GameCore.Events;jZ=MJ("GetCoinScreen"),YZ=zJ(R),XZ=NJ(Se),ZZ=NJ(fe),JZ=NJ(fe),jZ(QZ=YZ((eJ=M(($Z=function(e){F(a,e);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"quantityLabel",eJ,U(e)),B(e,"closeButtonComponent",tJ,U(e)),B(e,"getNowButtonComponent",nJ,U(e)),e.handleOpeningScreen=function(t){console.log("GetCoinScreen.OPENING_SCREEN",t),e.validateEventPayload(t)&&(e.setInteractableButtons(!0),e.updateStatus())},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return N(a,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){BJ.on(FJ.OPENING_SCREEN,this.handleOpeningScreen),BJ.on(FJ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){BJ.off(FJ.OPENING_SCREEN,this.handleOpeningScreen),BJ.off(FJ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return"screenName"in e&&(e.screenName===this.node.name&&(this.payload=e,!0))}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(ta.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),BJ.emit(FJ.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(ta.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var e=this.getQuantity();e&&this.updateQuantityLabel(e)}},{key:"updateQuantityLabel",value:function(e){this.quantityLabel.string="x".concat(e.toString())}},{key:"getQuantity",value:function(){var e=this.payload.screenData;return e&&"quantity"in e&&e.quantity&&"number"==typeof e.quantity?e.quantity:0}},{key:"handleAddCoin",value:function(){var e=this.getQuantity();this.node.scene.emit(ta.ADD_COINS,{coins:e,collectionAnimation:{animateTextOnly:!1},skipAnimation:!0}),this.close()}},{key:"handleGetNowButtonClicked",value:(n=W((function*(){o.stopAllSounds(),(yield S.showRewardVideoAdAsync({}))&&this.handleAddCoin()})),function(){return n.apply(this,arguments)})},{key:"setInteractableButtons",value:function(e){this.closeButtonComponent.interactable=e,this.getNowButtonComponent.interactable=e,this.screen.backgroundMaskButton.interactable=e}}]),a}(ce)).prototype,"quantityLabel",[XZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tJ=M($Z.prototype,"closeButtonComponent",[ZZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nJ=M($Z.prototype,"getNowButtonComponent",[JZ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QZ=$Z))||QZ);Q._RF.pop(),Q._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var xJ,UJ,GJ,HJ,VJ,qJ,WJ,KJ,jJ=$.ccclass,YJ=$.property,XJ=globalThis.game,ZJ=XJ.event,JJ=XJ.player,QJ=XJ.analytics,$J=XJ.language,eQ=GameCore,tQ=eQ.Events,nQ=eQ.Utils.Array,iQ=eQ.Plugins.Analytics.Events,aQ=Object.values(d);iJ=jJ("GetItemScreen"),aJ=YJ({type:qe,group:"Item"}),oJ=YJ({type:le,group:"Item"}),rJ=YJ({type:Be,group:"Item"}),lJ=YJ({type:Be,group:"Item"}),sJ=YJ({type:Be,group:"Item"}),uJ=YJ({type:Be,group:"Item"}),cJ=YJ({type:Se,group:"Title"}),hJ=YJ({type:p,group:"Title"}),pJ=YJ({type:Se,group:"Description"}),dJ=YJ({type:p,group:"Description"}),yJ=YJ(Se),fJ=YJ({type:fe,group:"Buttons"}),vJ=YJ({type:fe,group:"Buttons"}),gJ=YJ({type:fe,group:"Buttons"}),iJ((wJ=M((bJ=function(e){F(r,e);var n,i,a,o=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=o.call.apply(o,[this].concat(n)),B(e,"itemFxPrefab",wJ,U(e)),B(e,"itemSprite",SJ,U(e)),B(e,"hintSpriteFrame",kJ,U(e)),B(e,"stormSpriteFrame",CJ,U(e)),B(e,"thunderSpriteFrame",EJ,U(e)),B(e,"pliersSpriteFrame",AJ,U(e)),B(e,"titleLabel",TJ,U(e)),B(e,"titleLocalizer",PJ,U(e)),B(e,"descriptionLabel",RJ,U(e)),B(e,"descriptionLocalizer",OJ,U(e)),B(e,"coinLabel",IJ,U(e)),B(e,"closeButtonComponent",LJ,U(e)),B(e,"buyItemButtonComponent",_J,U(e)),B(e,"getNowButtonComponent",DJ,U(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("GetItemScreen: screen not found");e.validateEventPayload(t)&&e.validateEventPayloadData(t.screenData)&&(e.setInteractableButtons(!0),e.data=t.screenData,e.updateStatus(t.screenData))},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return N(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){ZJ.on(tQ.OPENING_SCREEN,this.handleOpeningScreen),ZJ.on(tQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){ZJ.off(tQ.OPENING_SCREEN,this.handleOpeningScreen),ZJ.off(tQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"validateEventPayloadData",value:function(e){return!!e&&(!(!("item"in e)||!nQ.has(aQ,e.item))&&("quantity"in e&&"number"==typeof e.quantity&&!("localizedMessageKey"in e&&void 0!==e.localizedMessageKey&&!$J.hasTextKey(e.localizedMessageKey))))}},{key:"open",value:function(){this.node.scene.emit(ta.GAME_PAUSE)}},{key:"close",value:function(){this.setInteractableButtons(!1),ZJ.emit(tQ.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(ta.GAME_RESUME)}},{key:"updateStatus",value:function(e){this.updateItemIcon(e.item),this.updateTitle(e.item),e.localizedMessageKey&&this.updateDescription(e.localizedMessageKey),this.updateButtons(e.item)}},{key:"updateItemIcon",value:function(e){switch(e){case d.HINT:this.itemSprite.spriteFrame=this.hintSpriteFrame;break;case d.STORM:this.itemSprite.spriteFrame=this.stormSpriteFrame;break;case d.THUNDER:this.itemSprite.spriteFrame=this.thunderSpriteFrame;break;case d.PLIERS:this.itemSprite.spriteFrame=this.pliersSpriteFrame}}},{key:"getItemLocalizedTitleKey",value:function(e){switch(e){case d.HINT:return"item.hint";case d.STORM:return"item.storm";case d.THUNDER:return"item.thunder";case d.PLIERS:return"item.pliers"}}},{key:"updateTitle",value:function(e){this.titleLocalizer.key=this.getItemLocalizedTitleKey(e)}},{key:"updateDescription",value:function(e){this.descriptionLocalizer.key=e}},{key:"updateButtons",value:function(e){var t=this.canBuyItem(e);this.buyItemButtonComponent.node.active=t,this.getNowButtonComponent.node.active=!t,t&&(this.coinLabel.string="".concat(3*bs[e]))}},{key:"canBuyItem",value:function(e){var t=JJ.getGameData();return!!t&&t.coins>=3*bs[e]}},{key:"handleAddItem",value:(a=W((function*(){this.data.item&&(QJ.event(iQ.EARN_ITEM,{item_name:this.data.item,value:3}),this.node.scene.emit(ta.ADD_ITEM,{animate:{startWorldPosition:this.itemSprite.node.worldPosition.clone()},item:this.data.item,quantity:3}))})),function(){return a.apply(this,arguments)})},{key:"handleGetNowButtonClicked",value:(i=W((function*(){this.stopAllSounds(),(yield S.showRewardVideoAdAsync({}))&&(this.handleAddItem(),this.close())})),function(){return i.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(n=W((function*(){this.node.scene.emit(ta.REMOVE_COINS,{coins:3*bs[this.data.item],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close()})),function(){return n.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var e;null===(e=Ne("Sound"))||void 0===e||null===(e=e.getComponent(O))||void 0===e||e.stopAll()}},{key:"setInteractableButtons",value:function(e){this.closeButtonComponent.interactable=e,this.buyItemButtonComponent.interactable=e,this.getNowButtonComponent.interactable=e,this.screen.backgroundMaskButton.interactable=e}}]),r}(ce)).prototype,"itemFxPrefab",[aJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SJ=M(bJ.prototype,"itemSprite",[oJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kJ=M(bJ.prototype,"hintSpriteFrame",[rJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CJ=M(bJ.prototype,"stormSpriteFrame",[lJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EJ=M(bJ.prototype,"thunderSpriteFrame",[sJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AJ=M(bJ.prototype,"pliersSpriteFrame",[uJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TJ=M(bJ.prototype,"titleLabel",[cJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PJ=M(bJ.prototype,"titleLocalizer",[hJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RJ=M(bJ.prototype,"descriptionLabel",[pJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OJ=M(bJ.prototype,"descriptionLocalizer",[dJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IJ=M(bJ.prototype,"coinLabel",[yJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LJ=M(bJ.prototype,"closeButtonComponent",[fJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_J=M(bJ.prototype,"buyItemButtonComponent",[vJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DJ=M(bJ.prototype,"getNowButtonComponent",[gJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mJ=bJ));Q._RF.pop(),Q._RF.push({},"4d6710xA7hAk65cGA4Dgdrc","GetRewardsScreen",void 0);var oQ,rQ=$.ccclass,lQ=$.requireComponent,sQ=$.property,uQ=GameCore.Events,cQ=globalThis.game.event;xJ=rQ("GetRewardsScreen"),UJ=lQ(R),GJ=sQ(p),HJ=sQ(fe),xJ(VJ=UJ((WJ=M((qJ=function(e){F(a,e);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"adStartingLocalizer",WJ,U(e)),B(e,"skipButton",KJ,U(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.setInteractableButtons(!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return N(a,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){cQ.on(uQ.OPENING_SCREEN,this.handleOpeningScreen),cQ.on(uQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){cQ.off(uQ.OPENING_SCREEN,this.handleOpeningScreen),cQ.off(uQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.runAdStartingAnimation()}},{key:"close",value:function(e){this.setInteractableButtons(!1),cQ.emit(uQ.CLOSE_SCREEN,{screenName:this.node.name,screenData:{getRewardsSuccess:e}})}},{key:"runAdStartingAnimation",value:function(){var e=this,t=5;this.adStartingLocalizer.setParams([t.toString()]);this.schedule((function(){t<=0?e.stopAdStartingAnimation():(t--,e.adStartingLocalizer.setParams([t.toString()]))}),1,6)}},{key:"stopAdStartingAnimation",value:(n=W((function*(){this.unscheduleAllCallbacks();var e=yield S.showRewardedInterstitialAdAsync({});this.close(e)})),function(){return n.apply(this,arguments)})},{key:"handleClickedSkip",value:function(){this.unscheduleAllCallbacks(),this.close(!1)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(e){this.skipButton.interactable=e}}]),a}(ce)).prototype,"adStartingLocalizer",[GJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KJ=M(qJ.prototype,"skipButton",[HJ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VJ=qJ))||VJ);Q._RF.pop(),Q._RF.push({},"bfe1eXch0ZMKIz1ofLKc2Iv","HardLevelScreen",void 0);var hQ,pQ,dQ,yQ,fQ,vQ,gQ,mQ,bQ,wQ,SQ,kQ,CQ,EQ=$.ccclass,AQ=$.requireComponent,TQ=GameCore.Events,PQ=globalThis.game.event;EQ("HardLevelScreen")(oQ=AQ(R)(oQ=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).handleOpeningScreen=function(t){e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return N(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){PQ.on(TQ.OPENING_SCREEN,this.handleOpeningScreen),PQ.on(TQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){PQ.off(TQ.OPENING_SCREEN,this.handleOpeningScreen),PQ.off(TQ.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation()}},{key:"close",value:function(){b.closeScreen(I[this.node.name])}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}}]),i}(ce))||oQ);Q._RF.pop(),Q._RF.push({},"2db0dg4dI9GCKCdFOMrBFsQ","GetRewardsEffect",void 0);var RQ,OQ,IQ,LQ,_Q,DQ,MQ,NQ,zQ,BQ,FQ,xQ,UQ,GQ,HQ,VQ,qQ,WQ,KQ,jQ,YQ,XQ,ZQ,JQ,QQ,$Q,e$,t$,n$,i$,a$,o$,r$,l$,s$,u$=$.ccclass,c$=$.property,h$=(hQ=u$("GetRewardsEffect"),pQ=c$(Be),dQ=c$(Be),yQ=c$(Be),fQ=c$(Be),vQ=c$(Fg),hQ((bQ=M((mQ=function(n){F(r,n);var i,a=x(r);function r(){var e;z(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"hint",bQ,U(e)),B(e,"thunder",wQ,U(e)),B(e,"storm",SQ,U(e)),B(e,"pliers",kQ,U(e)),B(e,"particles",CQ,U(e)),e}return N(r,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"playAnimation",value:(i=W((function*(t,n){var i=this,a=-30*(t.length-1)/2+90;yield Promise.all(t.map((function(t,r){var l=i.createSprite(t),s=a+30*r,u=.15*r;l.node.position=new Ie(300*Math.cos(s*(Math.PI/180)),300*Math.sin(s*(Math.PI/180)),0);var c=ae(l.node);return c.delay(u),c.to(.6,{position:Ie.ZERO,scale:new Ie(.7,.7,.7)},{easing:"backIn"}),e.runTweenAsync(c).then((function(){n(),o.playSound(vn.COLLECT_STARS),i.playExplodeEffect(),l.node.destroy()}))})))})),function(e,t){return i.apply(this,arguments)})},{key:"playExplodeEffect",value:function(){var e,t=H(this.particles);try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.play()}}catch(e){t.e(e)}finally{t.f()}}},{key:"createSprite",value:function(e){var t=this.getSpriteFrame(e),n=(new ge).addComponent(le);return n.spriteFrame=t,n.node.parent=this.node,n.node.scale=new Ie(1.5,1.5,1.5),n}},{key:"getSpriteFrame",value:function(e){switch(e){case"hint":return this.hint;case"thunder":return this.thunder;case"storm":return this.storm;case"pliers":return this.pliers;default:return null}}}]),r}(ce)).prototype,"hint",[pQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wQ=M(mQ.prototype,"thunder",[dQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SQ=M(mQ.prototype,"storm",[yQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kQ=M(mQ.prototype,"pliers",[fQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CQ=M(mQ.prototype,"particles",[vQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gQ=mQ))||gQ);Q._RF.pop(),Q._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var p$,d$=$.ccclass,y$=$.property,f$=$.requireComponent,v$=GameCore,g$=v$.Events,m$=v$.Utils.Valid,b$=globalThis.game,w$=b$.event,S$=b$.player,k$="Coin Container";RQ=d$("LevelCompleteScreen"),OQ=f$(R),IQ=y$(Se),LQ=y$(Se),_Q=y$(he),DQ=y$(h$),MQ=y$({type:fe,group:"Play Button"}),NQ=y$({type:ge,group:"Play Button"}),zQ=y$({type:he,group:"Play Button"}),BQ=y$({type:ge,group:"Play Button"}),FQ=y$({type:ge,group:"Play Button"}),xQ=y$({type:Fe,group:k$}),UQ=y$({type:$L,group:k$}),GQ=y$({type:Fe,group:k$}),HQ=y$({type:it,group:k$}),VQ=y$({type:it,group:k$}),qQ=y$(Fg),WQ=t.onlyRunInLifeCycleAsync,RQ(KQ=OQ((YQ=M((jQ=function(n){F(d,n);var a,o,r,l,s,u,c,h,p=x(d);function d(){var t;z(this,d);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return(t=p.call.apply(p,[this].concat(a))).level=1,t.coins=40,t.currentCoins=0,t.score=0,t.playAnimation=!1,t.getRewardsSuccess=!1,t.lookingForRewards=!1,t.playButtonSignal=new i,B(t,"coinText",YQ,U(t)),B(t,"scoreText",XQ,U(t)),B(t,"lookingForRewardsText",ZQ,U(t)),B(t,"getRewardsEffect",JQ,U(t)),B(t,"playButton",QQ,U(t)),B(t,"playBackground",$Q,U(t)),B(t,"shineBackground",e$,U(t)),B(t,"hardLevelBackground",t$,U(t)),B(t,"playButtonContainer",n$,U(t)),B(t,"coinAnimation",i$,U(t)),B(t,"coinContainer",a$,U(t)),B(t,"coinContainerAnimation",o$,U(t)),B(t,"coinContainerEnterClip",r$,U(t)),B(t,"coinContainerExitClip",l$,U(t)),B(t,"particles",s$,U(t)),t.handleOpeningScreen=function(e){if(!t.screen)throw new Error("StarChestScreen: screen not found");t.validateEventPayload(e)&&(t.playButton.interactable=!0)},t.handleOpenedScreen=function(e){t.validateEventPayload(e)&&t.open()},t.handleParticleEnd=W((function*(){t.level&&(yield e.waitTweenAsync(.15)),yield Promise.all([t.animateCoin(),t.animateScore()]),t.lookingForRewards?yield t.handleLookingForRewards():yield t.animateVisiblePlayButton(!0)})),t}return N(d,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){w$.on(g$.OPENING_SCREEN,this.handleOpeningScreen),w$.on(g$.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){w$.off(g$.OPENING_SCREEN,this.handleOpeningScreen),w$.off(g$.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){var t=null!=e?e:{},n=t.screenName,i=t.screenData;return n===this.node.name&&(!!m$.isObject(i)&&(m$.isNumber(i.level)&&(this.level=i.level,this.coins=this.level<5?vs:gs),m$.isNumber(i.coins)&&(this.currentCoins=i.coins),m$.isNumber(i.score)&&(this.score=i.score),this.playAnimation=!1,m$.isObject(i.overrideAnimation)&&(this.playAnimation="LevelCompleteOpenScreen"===i.overrideAnimation.openScreen),this.lookingForRewards=!1,m$.isBoolean(i.lookingForRewards)&&(this.lookingForRewards=i.lookingForRewards),this.getRewardsSuccess=!1,m$.isBoolean(i.getRewardsSuccess)&&(this.getRewardsSuccess=i.getRewardsSuccess),!0))}},{key:"open",value:function(){this.updateStatus(),this.node.scene.emit(ta.HIDE_UI),this.tryPlayAnimation()}},{key:"close",value:(h=W((function*(){var t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=H(this.particles);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.stop()}}catch(e){i.e(e)}finally{i.f()}yield e.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name),w$.emit(g$.CLOSE_SCREEN,{screenName:this.node.name,screenData:{canShowRewardsAd:n}}),this.node.scene.emit(ta.ABORT_COIN_ANIMATION)})),function(){return h.apply(this,arguments)})},{key:"updateStatus",value:function(){this.updateCoinContainer(),this.updatePlayButton(),this.lookingForRewardsText.opacity=0}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoins})}},{key:"updatePlayButton",value:function(){var e=S$.getGameData();if(e){var t=(this.level+1>e.totalLevel?this.level:this.level+1)%5==0;this.playBackground.active=!t,this.hardLevelBackground.active=t}}},{key:"tryPlayAnimation",value:function(){if(this.playAnimation){this.screen.setScreenOpacity(255),this.coinText.string="x0",this.scoreText.string="0",this.animateVisiblePlayButton(!1,!1);var e,t=H(this.particles);try{for(t.s();!(e=t.n()).done;){e.value.play()}}catch(e){t.e(e)}finally{t.f()}var n=this.screen.getComponent(Fe);n?n.once(Fe.EventType.FINISHED,this.handleParticleEnd):this.handleParticleEnd()}else{if(this.animateVisiblePlayButton(!0,!1),!this.getRewardsSuccess)return;this.getRewardsEffect.playAnimation(["storm","thunder"],this.animateCollectItemPlayButton.bind(this))}}},{key:"handleLookingForRewards",value:(c=W((function*(){yield this.animateLookingForRewards(),S.canShowRewardedInterstitialAd()?this.close(!0):this.animateVisiblePlayButton(!0)})),function(){return c.apply(this,arguments)})},{key:"animateCoin",value:(u=W((function*(){var t=this;this.screen.container?(this.coinAnimation.play(),yield e.runOnUpdateAsync(this.node,.8,(function(e){var n=Ke(0,t.coins,e),i=Math.floor(n);t.coinText.string="x".concat(i)})),yield this.animateCoinCollection(),this.coinText.string="x".concat(this.coins)):console.warn("LevelCompleteScreen: screen not found")})),function(){return u.apply(this,arguments)})},{key:"animateScore",value:(s=W((function*(){var t=this;e.runOnUpdateAsync(this.scoreText.node,.8,(function(e){var n=Ke(0,t.score,e);t.scoreText.string="".concat(Math.floor(n))})),this.scoreText.node.setScale(1,1,1),this.scoreText.string="".concat(this.score)})),function(){return s.apply(this,arguments)})},{key:"animateCoinCollection",value:(l=W((function*(){yield e.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name),this.node.scene.emit(ta.ADD_COINS,{coins:this.coins,collectionAnimation:{floatDuration:.5,flyDuration:.5,animateTextOnly:!1,target:this.coinContainer}})})),function(){return l.apply(this,arguments)})},{key:"animateLookingForRewards",value:(r=W((function*(){var t=ae(this.lookingForRewardsText);t.to(.25,{opacity:255},{easing:"linear"}).delay(.25),t.to(.25,{opacity:100},{easing:"linear"}).delay(.125),yield e.runTweenAsync(ae(this.lookingForRewardsText).repeat(2,t).to(.25,{opacity:0},{easing:"linear"})),this.lookingForRewardsText.opacity=0})),function(){return r.apply(this,arguments)})},{key:"animateVisiblePlayButton",value:(o=W((function*(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=t?1:0;if(n){this.playButtonSignal.abort();var o=new i;this.playButtonSignal=o;var r=t?0:1;this.playButtonContainer.setScale(r,r,this.playButtonContainer.scale.z);var l=ae(this.playButtonContainer).to(.5,{scale:new Ie(a,a,1)},{easing:"backOut"});t||(this.playButton.interactable=!1),yield e.runTweenAsync(l,o),t&&(this.playButton.interactable=!0)}else this.playButton.interactable=t,this.playButtonContainer.setScale(a,a,this.playButtonContainer.scale.z)})),function(e){return o.apply(this,arguments)})},{key:"animateCollectItemPlayButton",value:(a=W((function*(){this.playButtonSignal.abort();var t=new i;this.playButtonSignal=t;var n=ae(this.playButtonContainer).to(.08,{scale:new Ie(.95,1.05,1)}).to(.08,{scale:new Ie(1.05,.95,1)}).to(.08,{scale:new Ie(1,1,1)}),a=ae(this.shineBackground).to(.08,{opacity:50},{easing:"quadOut"}).to(.08,{opacity:0},{easing:"quadIn"});yield Promise.all([e.runTweenAsync(n,t),e.runTweenAsync(a,t)])})),function(){return a.apply(this,arguments)})},{key:"handleClickedPlay",value:function(){this.playButton.interactable=!1,this.close()}}]),d}(ce)).prototype,"coinText",[IQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XQ=M(jQ.prototype,"scoreText",[LQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZQ=M(jQ.prototype,"lookingForRewardsText",[_Q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JQ=M(jQ.prototype,"getRewardsEffect",[DQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QQ=M(jQ.prototype,"playButton",[MQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$Q=M(jQ.prototype,"playBackground",[NQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e$=M(jQ.prototype,"shineBackground",[zQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t$=M(jQ.prototype,"hardLevelBackground",[BQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n$=M(jQ.prototype,"playButtonContainer",[FQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i$=M(jQ.prototype,"coinAnimation",[xQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a$=M(jQ.prototype,"coinContainer",[UQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o$=M(jQ.prototype,"coinContainerAnimation",[GQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r$=M(jQ.prototype,"coinContainerEnterClip",[HQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l$=M(jQ.prototype,"coinContainerExitClip",[VQ],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s$=M(jQ.prototype,"particles",[qQ],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),M(jQ.prototype,"animateCoin",[WQ],Object.getOwnPropertyDescriptor(jQ.prototype,"animateCoin"),jQ.prototype),KQ=jQ))||KQ);Q._RF.pop(),Q._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var C$,E$,A$,T$,P$,R$,O$,I$,L$,_$,D$=$.ccclass,M$=$.disallowMultiple,N$=$.requireComponent,z$=GameCore.Events,B$=globalThis.game.event;D$("LoadingScreen")(p$=M$(p$=N$(R)(p$=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return(e=n.call.apply(n,[this].concat(a))).handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e.handleClosedScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!1)},e.handleOnCloseScreen=function(){b.closeScreen(w.LOADING_SCREEN)},e}return N(i,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){B$.on(z$.OPENING_SCREEN,this.handleOpeningScreen),B$.on(z$.OPENED_SCREEN,this.handleOpenedScreen),B$.on(z$.CLOSING_SCREEN,this.handleClosingScreen),B$.on(z$.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){B$.off(z$.OPENING_SCREEN,this.handleOpeningScreen),B$.off(z$.OPENED_SCREEN,this.handleOpenedScreen),B$.off(z$.CLOSING_SCREEN,this.handleClosingScreen),B$.off(z$.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var e=this.screen.data.duration;e&&e>0&&this.scheduleOnce(this.handleOnCloseScreen,e)}}}]),i}(ce))||p$)||p$);Q._RF.pop(),Q._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var F$,x$,U$,G$,H$,V$,q$,W$,K$,j$,Y$,X$,Z$,J$,Q$,$$,e0=$.ccclass,t0=$.disallowMultiple,n0=$.requireComponent,i0=$.property,a0=GameCore,o0=a0.Events,r0=a0.Utils.Valid,l0=globalThis.game.event;C$=e0("NotificationScreen"),E$=n0(R),A$=i0(Se),T$=i0(p),P$=i0(fe),C$(R$=t0(R$=E$((I$=M((O$=function(e){F(i,e);var n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"message",I$,U(e)),B(e,"messageLocalizer",L$,U(e)),B(e,"touchZone",_$,U(e)),e.enableCloseOnTouch=!0,e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.updateScreenData(t)},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e}return N(i,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){l0.on(o0.OPENING_SCREEN,this.handleOpeningScreen),l0.on(o0.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){l0.off(o0.OPENING_SCREEN,this.handleOpeningScreen),l0.off(o0.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"updateScreenData",value:function(e){var t=e.screenData;r0.isObject(t)?(void 0!==t.message?this.setMessageManually(t.message):void 0!==t.localizedMessageKey&&this.setMessageUsingLocalizeKey(t.localizedMessageKey),t.duration&&t.duration>0&&this.scheduleOnce((function(){b.closeScreen(w.NOTIFICATION_SCREEN)}),t.duration),!1===t.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"setMessageManually",value:function(e){this.messageLocalizer.enabled=!1,this.message.string=e}},{key:"setMessageUsingLocalizeKey",value:function(e){this.messageLocalizer.enabled=!0,this.messageLocalizer.key=e}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),b.closeScreen(w.NOTIFICATION_SCREEN)}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),i}(ce)).prototype,"message",[A$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L$=M(O$.prototype,"messageLocalizer",[T$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_$=M(O$.prototype,"touchZone",[P$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R$=O$))||R$)||R$);Q._RF.pop(),Q._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var s0,u0,c0,h0,p0,d0,y0,f0,v0,g0,m0,b0,w0,S0,k0,C0,E0,A0,T0,P0,R0,O0,I0=$.ccclass,L0=$.property,_0=$.requireComponent,D0=GameCore,M0=D0.Events,N0=D0.Match.Modes,z0=globalThis.game,B0=z0.event,F0=z0.storage;F$=I0("QuitLevelScreen"),x$=_0(R),U$=L0(Se),G$=L0(Se),H$=L0(fe),V$=L0(Se),q$=L0(Se),W$=L0(fe),F$(K$=x$((Y$=M((j$=function(e){F(a,e);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"singleDescription",Y$,U(e)),B(e,"tournamentDescription",X$,U(e)),B(e,"quitButton",Z$,U(e)),B(e,"quitLabel",J$,U(e)),B(e,"endLabel",Q$,U(e)),B(e,"continueButton",$$,U(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.setInteractableButtons(!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return N(a,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){B0.on(M0.OPENING_SCREEN,this.handleOpeningScreen),B0.on(M0.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){B0.off(M0.OPENING_SCREEN,this.handleOpeningScreen),B0.off(M0.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(ta.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),b.closeScreen(I[this.node.name]),this.node.scene.emit(ta.SHOW_UI),this.node.scene.emit(ta.GAME_RESUME)}},{key:"updateStatus",value:function(){var e=Zs.getMatchMode()===N0.TOURNAMENT;this.singleDescription.node.active=!e,this.tournamentDescription.node.active=e,this.quitLabel.node.active=!e,this.endLabel.node.active=e}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(e){this.quitButton.interactable=e,this.continueButton.interactable=e,this.screen.backgroundMaskButton.interactable=e}},{key:"handleClickedContinue",value:function(){this.close()}},{key:"handleClickedQuit",value:(n=W((function*(){if(this.setInteractableButtons(!1),Zs.getMatchMode()===N0.TOURNAMENT){var e,t=(null!==(e=Zs.getMatchCustomData())&&void 0!==e?e:{}).score,n=(void 0===t?0:t)>F0.getStorageData("tournament","previousScore");F0.setStorageData("tournament","animateTournamentLeader",n),yield Zs.finishMatchAsync()}this.node.scene.emit(ta.GAME_EXIT)})),function(){return n.apply(this,arguments)})}]),a}(ce)).prototype,"singleDescription",[U$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),X$=M(j$.prototype,"tournamentDescription",[G$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z$=M(j$.prototype,"quitButton",[H$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J$=M(j$.prototype,"quitLabel",[V$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q$=M(j$.prototype,"endLabel",[q$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$$=M(j$.prototype,"continueButton",[W$],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K$=j$))||K$);Q._RF.pop(),Q._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var x0,U0,G0,H0,V0,q0,W0,K0,j0,Y0,X0,Z0,J0,Q0,$0,e1,t1,n1,i1,a1,o1,r1,l1,s1,u1,c1,h1=$.ccclass,p1=$.property,d1=$.disallowMultiple,y1=$.requireComponent,f1=GameCore.Events,v1=globalThis.game,g1=v1.event,m1=v1.player;s0=h1("RescuesScreen"),u0=y1(R),c0=p1(he),h0=p1([ge]),p0=p1(p),d0=p1(p),y0=p1(ge),f0=p1(ge),v0=p1(Fe),g0=p1(ge),m0=p1(ge),s0(b0=d1(b0=u0((S0=M((w0=function(n){F(c,n);var i,a,r,l,s,u=x(c);function c(){var e;z(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=u.call.apply(u,[this].concat(n)),B(e,"adOpacity",S0,U(e)),B(e,"animNodes",k0,U(e)),B(e,"titleLocalizer",C0,U(e)),B(e,"descriptionLocalizer",E0,U(e)),B(e,"timer",A0,U(e)),B(e,"bomb",T0,U(e)),B(e,"bombAnim",P0,U(e)),B(e,"replayButton",R0,U(e)),B(e,"buyTimeButton",O0,U(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("RescuesScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return N(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){g1.on(f1.OPENING_SCREEN,this.handleOpeningScreen),g1.on(f1.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){g1.off(f1.OPENING_SCREEN,this.handleOpeningScreen),g1.off(f1.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:(s=W((function*(){o.turnOffMusic(),yield this.resetState(),this.runOpenAnimation(),this.node.scene.emit(ta.HIDE_UI)})),function(){return s.apply(this,arguments)})},{key:"close",value:function(){o.turnUpMusic(),g1.emit(f1.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(l=W((function*(){var e,t=(null===(e=this.payload.screenData)||void 0===e?void 0:e.failKey)===$s;this.titleLocalizer.key=t?"game.boom":"game.timesUp",this.descriptionLocalizer.key=t?"game.bombDesc":"game.timesUpDesc",this.timer.active=!t,this.bomb.active=t,t&&this.bombAnim.play();var n=m1.getGameData();if(n){var i=n.coins>=ws;this.replayButton.active=!i,this.buyTimeButton.active=i,this.adOpacity.opacity=0}})),function(){return l.apply(this,arguments)})},{key:"runOpenAnimation",value:(r=W((function*(){var e=this;this.screen.container?(yield Promise.all(this.animNodes.map((function(t,n){e.runAppearTween(t,.1*n)}))),yield this.runShowAdContainer()):console.warn("TimeUpScreen: screen not found")})),function(){return r.apply(this,arguments)})},{key:"runAppearTween",value:(a=W((function*(t,n){yield e.runTweenAsync(ae(t).set({scale:new Ie(0,0,0)}).delay(n).to(1,{scale:new Ie(1,1,1)},{easing:function(t){return e.elasticOut(t,.1,.45)}}))})),function(e,t){return a.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var t=ae(this.adOpacity);return t.delay(1),t.to(.5,{opacity:255}),e.runTweenAsync(t)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit(ta.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit(ta.REMOVE_COINS,{coins:ws,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(i=W((function*(){(yield S.showRewardVideoAdAsync({}))&&this.startRescue()})),function(){return i.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit(ta.SHOW_UI),this.node.scene.emit(ta.RESCUE_START),this.close()}}]),c}(ce)).prototype,"adOpacity",[c0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k0=M(w0.prototype,"animNodes",[h0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),C0=M(w0.prototype,"titleLocalizer",[p0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E0=M(w0.prototype,"descriptionLocalizer",[d0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A0=M(w0.prototype,"timer",[y0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T0=M(w0.prototype,"bomb",[f0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P0=M(w0.prototype,"bombAnim",[v0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R0=M(w0.prototype,"replayButton",[g0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O0=M(w0.prototype,"buyTimeButton",[m0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b0=w0))||b0)||b0);Q._RF.pop(),Q._RF.push({},"726c9oCUUBDpboDnHRz7SGZ","PauseScreen",void 0);var b1,w1,S1,k1,C1,E1,A1,T1,P1,R1,O1,I1,L1,_1,D1,M1,N1,z1,B1,F1,x1,U1,G1,H1,V1,q1,W1=$.ccclass,K1=$.property,j1=$.requireComponent,Y1=GameCore,X1=Y1.Events,Z1=Y1.Utils.Device,J1=Y1.Match.Modes,Q1=globalThis.game,$1=Q1.player,e2=Q1.event;x0=W1("PauseScreen"),U0=j1(R),G0=K1(ge),H0=K1(ge),V0=K1(ge),q0=K1(aG),W0=K1(aG),K0=K1(aG),j0=K1(fe),Y0=K1(fe),X0=K1(fe),Z0=K1(fe),J0=K1(ge),x0(Q0=U0((e1=M(($0=function(n){F(l,n);var i,a,r=x(l);function l(){var e;z(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),B(e,"musicSetting",e1,U(e)),B(e,"soundSetting",t1,U(e)),B(e,"vibrateSetting",n1,U(e)),B(e,"musicSwitch",i1,U(e)),B(e,"soundSwitch",a1,U(e)),B(e,"vibrateSwitch",o1,U(e)),B(e,"closeButtonComponent",r1,U(e)),B(e,"continueButtonComponent",l1,U(e)),B(e,"restartButtonComponent",s1,U(e)),B(e,"challengeFriendsButtonComponent",u1,U(e)),B(e,"animNodes",c1,U(e)),e.triggerSequence="",e.handleOpeningScreen=function(t){e.validateSwitchScreenPayload(t)&&(e.setInteractableButtons(!0),e.updateStatus())},e.handleOpenedScreen=function(t){e.validateSwitchScreenPayload(t)&&e.open()},e.handleResetSequence=function(){e.triggerSequence=""},e.handleTriggerUnlockKey=function(t){if("code"in t){var n=t.code,i=Es.UNLOCK_SEQUENCE;"number"==typeof n&&-1!==i.indexOf(n.toString())&&(e.triggerSequence+=n.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",n,e.triggerSequence,e.triggerSequence===i),e.triggerSequence===i&&(e.node.scene.emit(Es.Events.UNLOCK_DEV_TOOLS),e.node.off(Es.Events.TRIGGER_UNLOCK_KEY)))}},e.updateVibrateButton=function(){var t=e.vibrateSetting.getComponentInChildren(fe),n=e.vibrateSetting.getComponentInChildren(aG),i=e.vibrateSetting.getComponentInChildren(mi);if(t&&n&&i)if(Z1.isMobile()){var a,o=null!==(a=$1.getPlayerSetting("vibrate"))&&void 0!==a&&a;n.setEnabled(o)}else t.interactable=!1,n.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")},e}return N(l,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){e2.on(X1.OPENING_SCREEN,this.handleOpeningScreen),e2.on(X1.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){e2.off(X1.OPENING_SCREEN,this.handleOpeningScreen),e2.off(X1.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(e){return e.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(Es.Events.TRIGGER_UNLOCK_KEY),this.node.on(Es.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(Es.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(Es.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(Es.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(Es.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(ta.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(Es.Events.TRIGGER_RESET_SEQUENCE),b.closeScreen(I[this.node.name])}},{key:"updateStatus",value:function(){var e,t,n,i={music:null!==(e=$1.getPlayerSetting("music"))&&void 0!==e&&e,sound:null!==(t=$1.getPlayerSetting("sound"))&&void 0!==t&&t,vibrate:null!==(n=$1.getPlayerSetting("vibrate"))&&void 0!==n&&n};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(i.music),this.soundSwitch.setEnabled(i.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach((function(t,n){e.runAppearTween(t,.1*n)}))}},{key:"runAppearTween",value:function(t,n){var i=ae(t);i.set({scale:new Ie(0,0,0)}),i.delay(n),i.to(1,{scale:new Ie(1,1,1)},{easing:function(t){return e.elasticOut(t,.1,.45)}}),i.start()}},{key:"setInteractableButtons",value:function(e){this.closeButtonComponent.interactable=e,this.continueButtonComponent.interactable=e,this.restartButtonComponent.interactable=e,this.challengeFriendsButtonComponent.interactable=e,this.screen.backgroundMaskButton.interactable=e}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var e=this.musicSwitch.switch();if($1.setSetting("music",e),this.node.emit(Es.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e){var t=Zs.getMatchMode();o.playMusic(t===J1.TOURNAMENT?vn.TOURNAMENT_MUSIC:vn.BG_MUSIC)}else o.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var e=this.soundSwitch.switch();$1.setSetting("sound",e),this.node.emit(Es.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var e=this.vibrateSwitch.switch();$1.setSetting("vibrate",e)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:(a=W((function*(){var e;this.close();var t=(null!==(e=$1.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;S.canShowInterstitialAd()&&(yield S.showInterstitialAdAsync({forLevel:n})),Zs.getMatchMode()!==J1.TOURNAMENT?(this.node.scene.emit(ta.GAME_RESUME),this.node.scene.emit(ta.GAME_REPLAY,{level:n})):b.openScreen(w.START_OVER_SCREEN)})),function(){return a.apply(this,arguments)})},{key:"handleClickedChallengeFriends",value:(i=W((function*(){if("MsGames"===GameSDK.getSDKName())return b.showLoadingScreen(),yield GameSDK.extra.shareAsync(),void b.closeLoadingScreen();this.close(),this.node.scene.emit(ta.CHALLENGE_FRIENDS)})),function(){return i.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(ta.GAME_RESUME),this.node.scene.emit(ta.SHOW_UI)}}]),l}(ce)).prototype,"musicSetting",[G0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t1=M($0.prototype,"soundSetting",[H0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n1=M($0.prototype,"vibrateSetting",[V0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i1=M($0.prototype,"musicSwitch",[q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a1=M($0.prototype,"soundSwitch",[W0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o1=M($0.prototype,"vibrateSwitch",[K0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r1=M($0.prototype,"closeButtonComponent",[j0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l1=M($0.prototype,"continueButtonComponent",[Y0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s1=M($0.prototype,"restartButtonComponent",[X0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u1=M($0.prototype,"challengeFriendsButtonComponent",[Z0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c1=M($0.prototype,"animNodes",[J0],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Q0=$0))||Q0);Q._RF.pop(),Q._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var t2,n2,i2,a2,o2,r2,l2,s2,u2,c2,h2,p2,d2,y2,f2,v2,g2,m2,b2,w2,S2,k2,C2,E2=$.ccclass,A2=$.property,T2=$.requireComponent,P2=GameCore,R2=P2.Events,O2=P2.Utils.Device,I2=P2.Match.Modes,L2=P2.Configs.Debugger.MonitorError,_2=globalThis.game,D2=_2.player,M2=_2.event,N2=_2.monitorError,z2=_2.frameCapture;b1=E2("SettingsScreen"),w1=T2(R),S1=A2(ge),k1=A2(ge),C1=A2(ge),E1=A2(aG),A1=A2(aG),T1=A2(aG),P1=A2(fe),R1=A2(fe),O1=A2(fe),I1=A2(fe),L1=A2(ge),b1(_1=w1((M1=M((D1=function(n){F(l,n);var i,a,r=x(l);function l(){var e;z(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),B(e,"musicSetting",M1,U(e)),B(e,"soundSetting",N1,U(e)),B(e,"vibrateSetting",z1,U(e)),B(e,"musicSwitch",B1,U(e)),B(e,"soundSwitch",F1,U(e)),B(e,"vibrateSwitch",x1,U(e)),B(e,"closeButtonComponent",U1,U(e)),B(e,"reportButtonComponent",G1,U(e)),B(e,"shareButtonComponent",H1,U(e)),B(e,"inviteFriendsButtonComponent",V1,U(e)),B(e,"animNodes",q1,U(e)),e.triggerSequence="",e.handleOpeningScreen=function(t){e.validateSwitchScreenPayload(t)&&(e.setInteractableButtons(!0),e.updateStatus())},e.handleOpenedScreen=function(t){e.validateSwitchScreenPayload(t)&&e.open()},e.handleResetSequence=function(){e.triggerSequence=""},e.handleTriggerUnlockKey=function(t){if("code"in t){var n=t.code,i=Es.UNLOCK_SEQUENCE;"number"==typeof n&&-1!==i.indexOf(n.toString())&&(e.triggerSequence+=n.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",n,e.triggerSequence,e.triggerSequence===i),e.triggerSequence===i&&(e.node.scene.emit(Es.Events.UNLOCK_DEV_TOOLS),e.node.off(Es.Events.TRIGGER_UNLOCK_KEY)))}},e.updateVibrateButton=function(){var t=e.vibrateSetting.getComponentInChildren(fe),n=e.vibrateSetting.getComponentInChildren(aG),i=e.vibrateSetting.getComponentInChildren(mi);if(t&&n&&i)if(O2.isMobile()){var a,o=null!==(a=D2.getPlayerSetting("vibrate"))&&void 0!==a&&a;n.setEnabled(o)}else t.interactable=!1,n.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")},e}return N(l,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools(),this.reportButtonComponent.node.parent.active=L2.Feedback}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){M2.on(R2.OPENING_SCREEN,this.handleOpeningScreen),M2.on(R2.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){M2.off(R2.OPENING_SCREEN,this.handleOpeningScreen),M2.off(R2.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(e){return e.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(Es.Events.TRIGGER_UNLOCK_KEY),this.node.on(Es.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(Es.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(Es.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(Es.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(Es.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(ta.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),this.node.emit(Es.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(ta.SHOW_UI),b.closeScreen(w.SETTINGS_SCREEN)}},{key:"updateStatus",value:function(){var e,t,n,i={music:null!==(e=D2.getPlayerSetting("music"))&&void 0!==e&&e,sound:null!==(t=D2.getPlayerSetting("sound"))&&void 0!==t&&t,vibrate:null!==(n=D2.getPlayerSetting("vibrate"))&&void 0!==n&&n};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(i.music),this.soundSwitch.setEnabled(i.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach((function(t,n){("ReportButton"!==t.name||L2.Feedback)&&e.runAppearTween(t,.1*n)}))}},{key:"runAppearTween",value:function(t,n){var i=ae(t);i.set({scale:new Ie(0,0,0)}),i.delay(n),i.to(1,{scale:new Ie(1,1,1)},{easing:function(t){return e.elasticOut(t,.1,.45)}}),i.start()}},{key:"setInteractableButtons",value:function(e){this.closeButtonComponent.interactable=e,this.reportButtonComponent.interactable=e,this.shareButtonComponent.interactable=e,this.inviteFriendsButtonComponent.interactable=e,this.screen.backgroundMaskButton.interactable=e}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var e=this.musicSwitch.switch();if(D2.setSetting("music",e),this.node.emit(Es.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e){var t=Zs.getMatchMode();o.playMusic(t===I2.TOURNAMENT?vn.TOURNAMENT_MUSIC:vn.BG_MUSIC)}else o.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var e=this.soundSwitch.switch();D2.setSetting("sound",e),this.node.emit(Es.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var e=this.vibrateSwitch.switch();D2.setSetting("vibrate",e)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedClose",value:function(){this.close()}},{key:"handleClickedReport",value:function(){null==N2||N2.feedbackAsync()}},{key:"handleClickedShare",value:(a=W((function*(){if("FacebookInstant"===GameSDK.getSDKName())return z2.addWideframeRender("renderShareScore",L),b.showLoadingScreen(),yield GameSDK.extra.shareBestScoreAsync(),void b.closeLoadingScreen();this.close()})),function(){return a.apply(this,arguments)})},{key:"handleClickedInviteFriends",value:(i=W((function*(){switch(GameSDK.getSDKName()){case"MsGames":b.showLoadingScreen(),yield GameSDK.extra.shareAsync(),b.closeLoadingScreen();break;case"FacebookInstant":z2.addWideframeRender("renderShareScore",_),b.showLoadingScreen(),yield GameSDK.extra.inviteWithBestScoreAsync(),b.closeLoadingScreen()}})),function(){return i.apply(this,arguments)})}]),l}(ce)).prototype,"musicSetting",[S1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N1=M(D1.prototype,"soundSetting",[k1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z1=M(D1.prototype,"vibrateSetting",[C1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B1=M(D1.prototype,"musicSwitch",[E1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F1=M(D1.prototype,"soundSwitch",[A1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x1=M(D1.prototype,"vibrateSwitch",[T1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U1=M(D1.prototype,"closeButtonComponent",[P1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G1=M(D1.prototype,"reportButtonComponent",[R1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H1=M(D1.prototype,"shareButtonComponent",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V1=M(D1.prototype,"inviteFriendsButtonComponent",[I1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q1=M(D1.prototype,"animNodes",[L1],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_1=D1))||_1);Q._RF.pop(),Q._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var B2,F2,x2,U2,G2,H2,V2,q2,W2,K2,j2,Y2,X2,Z2,J2,Q2,$2,e5,t5,n5,i5=$.ccclass,a5=$.property,o5=(t2=i5("StarChest"),n2=a5(le),i2=a5(he),a2=a5(Ae),o2=a5(he),r2=a5(he),l2=a5({type:ne,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),s2=a5({type:ne,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),u2=a5({type:ne,displayName:"Centered Offset X",group:"Reward Animations"}),c2=a5({type:ne,displayName:"Centered Offset Y",group:"Reward Animations"}),h2=a5({type:ne,min:0,displayName:"Starting Scale",group:"Reward Animations"}),p2=a5({type:ne,min:0,displayName:"Ending Scale",group:"Reward Animations"}),t2((f2=M((y2=function(n){F(u,n);var i,a,o,r,l,s=x(u);function u(){var e;z(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=s.call.apply(s,[this].concat(n)),B(e,"sprite",f2,U(e)),B(e,"glowOpacity",v2,U(e)),B(e,"explosionParticles",g2,U(e)),B(e,"circle",m2,U(e)),B(e,"uiOpacity",b2,U(e)),e.ogCenterX=0,e.ogCenterY=0,B(e,"endingOffsetX",w2,U(e)),B(e,"endingOffsetY",S2,U(e)),B(e,"startingScale",k2,U(e)),B(e,"endingScale",C2,U(e)),e}return N(u,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"moveToCenter",value:(l=W((function*(t){var n=new Ie(this.endingOffsetX,this.endingOffsetY,this.node.position.z);yield e.runTweenAsync(ae(this.node).to(.7,{position:n},{easing:"quintInOut"}),t),this.node.position=n})),function(e){return l.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new Ie(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(r=W((function*(t,n){var i=this.startingScale+(this.endingScale-this.startingScale)*t,a=new Ie(i,i,i);yield Promise.all([e.runTweenAsync(ae(this.sprite.node).to(.2,{scale:a},{easing:"backOut"}),n),e.runTweenAsync(ae(this.glowOpacity.node).to(.2,{scale:a},{easing:"backOut"}),n)]),this.sprite.node.setScale(a),this.glowOpacity.node.setScale(a)})),function(e,t){return r.apply(this,arguments)})},{key:"startShaking",value:function(){var e=this,t=this.node.position.clone();this.shakingTween={ogPos:t,tw:ae(this.node).to(.1,{},{onUpdate:function(n,i){if(i){var a=t.x+10*(i-.5);e.node.position=new Ie(a,t.y,t.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(o=W((function*(t){var n=this.sprite.node.scale.clone().multiplyScalar(1.1);yield Promise.all([e.runTweenAsync(ae(this.sprite.node).to(.2,{scale:n},{easing:"cubicInOut"}),t),e.runTweenAsync(ae(this.glowOpacity.node).to(.2,{scale:n}),t),e.runTweenAsync(ae(this.glowOpacity).to(.5,{opacity:255}),t)])})),function(e){return o.apply(this,arguments)})},{key:"explode",value:(a=W((function*(t){var n=this,i=new Ie(8,8,8),a=function(){var a=W((function*(){n.circle.opacity=255,n.circle.node.setScale(Ie.ZERO),yield Promise.all([e.runTweenAsync(ae(n.circle).to(.3,{opacity:0}),t),e.runTweenAsync(ae(n.circle.node).to(.3,{scale:i},{easing:"cubicOut"}),t)]),n.circle.opacity=0,n.circle.node.scale=i}));return function(){return a.apply(this,arguments)}}(),o=function(){var i=W((function*(){yield Promise.all([e.runTweenAsync(ae(n.glowOpacity.node).to(.3,{scale:Ie.ZERO},{easing:"cubicOut"}),t),e.runTweenAsync(ae(n.sprite.node).to(.3,{scale:Ie.ZERO},{easing:"cubicOut"}),t)]),n.sprite.node.setScale(Ie.ZERO),n.glowOpacity.node.setScale(Ie.ZERO)}));return function(){return i.apply(this,arguments)}}();yield Promise.all([this.explodeParticles(t),a(),o()])})),function(e){return a.apply(this,arguments)})},{key:"explodeParticles",value:(i=W((function*(t){t.aborted||(this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem(),yield e.waitTweenAsync(1),this.explosionParticles.node.active=!1)})),function(e){return i.apply(this,arguments)})}]),u}(ce)).prototype,"sprite",[n2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v2=M(y2.prototype,"glowOpacity",[i2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g2=M(y2.prototype,"explosionParticles",[a2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m2=M(y2.prototype,"circle",[o2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b2=M(y2.prototype,"uiOpacity",[r2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(y2.prototype,"startingOffsetX",[l2],Object.getOwnPropertyDescriptor(y2.prototype,"startingOffsetX"),y2.prototype),M(y2.prototype,"startingOffsetY",[s2],Object.getOwnPropertyDescriptor(y2.prototype,"startingOffsetY"),y2.prototype),w2=M(y2.prototype,"endingOffsetX",[u2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),S2=M(y2.prototype,"endingOffsetY",[c2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),k2=M(y2.prototype,"startingScale",[h2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),C2=M(y2.prototype,"endingScale",[p2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),d2=y2))||d2);Q._RF.pop(),Q._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var r5,l5,s5,u5,c5,h5,p5,d5,y5=$.ccclass,f5=$.property,v5=$.requireComponent,g5=GameCore.Events,m5=globalThis.game,b5=m5.event,w5=m5.player;B2=y5("StarChestScreen"),F2=v5(R),x2=f5(fz),U2=f5(fe),G2=f5(fe),H2=f5(Fe),V2=f5(o5),q2=f5(he),W2=f5(UL),K2=f5(p),B2(j2=F2((X2=M((Y2=function(n){F(c,n);var a,r,l,s,u=x(c);function c(){var e;z(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=u.call.apply(u,[this].concat(n)),B(e,"starProgressBar",X2,U(e)),B(e,"openButton",Z2,U(e)),B(e,"continueButton",J2,U(e)),B(e,"chestAnimation",Q2,U(e)),B(e,"starChest",$2,U(e)),B(e,"chestUnlockFXMask",e5,U(e)),B(e,"skipOverlay",t5,U(e)),B(e,"messageLabelLocalizer",n5,U(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return N(c,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){b5.on(g5.OPENING_SCREEN,this.handleOpeningScreen),b5.on(g5.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){b5.off(g5.OPENING_SCREEN,this.handleOpeningScreen),b5.off(g5.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(ta.HIDE_UI);var e=w5.getGameData();if(e){var t=e.stars;this.numChestAvailable=Math.floor(t/20),this.starProgressBar.setRange(t,20);var n=this.numChestAvailable>0;this.setInteractableButtons(!0),this.openButton.node.active=n,this.openButton.interactable=n,this.continueButton.node.active=!n,this.continueButton.interactable=!n,this.messageLabelLocalizer.key=this.numChestAvailable?"reward.starChestAvailable":"reward.starChestUnavailable",this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){this.setInteractableButtons(!1),b5.emit(g5.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(ta.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(s=W((function*(){if(0!==this.numChestAvailable){o.turnDownMusic();var e=w5.getGameData();if(e){this.setInteractableButtons(!1);var t=e.stars;w5.setGameData({stars:e.stars-20*this.numChestAvailable});var n=new i;yield this.skipOverlay.open({opacity:200,onSkip:function(){return n.abort()}}),yield this.handleUnlockAnimation(t,e.stars,n),yield this.skipOverlay.close(),o.turnUpMusic(),be.emit(_t),this.close()}}else this.close()})),function(){return s.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(l=W((function*(t,n,i){var a=this;yield Promise.all([this.starChest.moveToCenter(i),this.fadeInChestUnlockFX(i)]),this.chestAnimation.stop(),this.starChest.startShaking(),yield o.playSound(vn.STAR_CHEST_DRUM_ROLL,{loop:!0}),yield e.waitTweenAsync(0);var r=t,l=this.numChestAvailable;yield Promise.all([this.starProgressBar.animateTo(n,i,(function(e){var t;r-e>=20&&(r=e,l--,a.starChest.scale((t=l,a.numChestAvailable>2?1-t/a.numChestAvailable:.35*(1-t/a.numChestAvailable)),i),o.playSound(vn.STAR_CHEST_OPEN))}))]),yield e.waitTweenAsync(1,i),this.starChest.stopShaking(),yield this.starChest.glow(i),o.stopSound(vn.STAR_CHEST_DRUM_ROLL);var s=ms*this.numChestAvailable;this.node.scene.emit(ta.ADD_COINS,{coins:s,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:i},skipAnimation:!0}),yield this.starChest.explode(i),yield e.waitTweenAsync(1,i),yield Promise.all([this.fadeOutChestUnlockFX(i)])})),function(e,t,n){return l.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(r=W((function*(t){this.chestUnlockFXMask.node.active=!0,yield e.runTweenAsync(ae(this.chestUnlockFXMask).to(.5,{opacity:150}),t)})),function(e){return r.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(a=W((function*(t){yield e.runTweenAsync(ae(this.chestUnlockFXMask).to(.3,{opacity:0}),t),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1})),function(e){return a.apply(this,arguments)})},{key:"setInteractableButtons",value:function(e){this.openButton.interactable=e,this.continueButton.interactable=e,this.screen.backgroundMaskButton.interactable=e}}]),c}(ce)).prototype,"starProgressBar",[x2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z2=M(Y2.prototype,"openButton",[U2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J2=M(Y2.prototype,"continueButton",[G2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Q2=M(Y2.prototype,"chestAnimation",[H2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$2=M(Y2.prototype,"starChest",[V2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),e5=M(Y2.prototype,"chestUnlockFXMask",[q2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t5=M(Y2.prototype,"skipOverlay",[W2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n5=M(Y2.prototype,"messageLabelLocalizer",[K2],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j2=Y2))||j2);Q._RF.pop(),Q._RF.push({},"2f7694kcVZNWq3iTCp1piqI","StartOverScreen",void 0);var S5,k5,C5,E5,A5,T5=$.ccclass,P5=$.property,R5=$.requireComponent,O5=GameCore.Events,I5=globalThis.game,L5=I5.event,_5=I5.player;r5=T5("StartOverScreen"),l5=R5(R),s5=P5(fe),u5=P5(fe),r5(c5=l5((p5=M((h5=function(e){F(a,e);var n,i=x(a);function a(){var e;z(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=i.call.apply(i,[this].concat(n)),B(e,"restartButton",p5,U(e)),B(e,"cancelButton",d5,U(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.setInteractableButtons(!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return N(a,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){L5.on(O5.OPENING_SCREEN,this.handleOpeningScreen),L5.on(O5.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){L5.off(O5.OPENING_SCREEN,this.handleOpeningScreen),L5.off(O5.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(ta.HIDE_UI)}},{key:"close",value:function(){this.setInteractableButtons(!1),b.closeScreen(w.START_OVER_SCREEN)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"setInteractableButtons",value:function(e){this.restartButton.interactable=e,this.cancelButton.interactable=e}},{key:"handleClickedCancel",value:function(){this.close(),this.node.scene.emit(ta.GAME_RESUME),this.node.scene.emit(ta.SHOW_UI)}},{key:"handleClickedRestart",value:(n=W((function*(){var e;this.close();var t=(null!==(e=_5.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;this.node.scene.emit(ta.GAME_RESUME),this.node.scene.emit(ta.GAME_REPLAY,{level:n})})),function(){return n.apply(this,arguments)})}]),a}(ce)).prototype,"restartButton",[s5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d5=M(h5.prototype,"cancelButton",[u5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c5=h5))||c5);Q._RF.pop(),Q._RF.push({},"d6d78U+W5xDwqln9pXXQOaF","TopLeaders",void 0);var D5,M5,N5,z5,B5,F5=$.ccclass,x5=$.property,U5=(S5=F5("TopLeaders"),k5=x5(Lq),S5((A5=M((E5=function(e){F(i,e);var t,n=x(i);function i(){var e;z(this,i);for(var t=arguments.length,a=new Array(t),o=0;o<t;o++)a[o]=arguments[o];return e=n.call.apply(n,[this].concat(a)),B(e,"topLeaders",A5,U(e)),e.leaderData=[],e}return N(i,[{key:"updateData",value:function(e){var t=this;this.leaderData=e.slice(0,3),this.leaderData.slice(0,3).forEach((function(e,n){t.topLeaders[n].updateInfo({playerId:e.playerId,name:e.name,photo:e.photo,score:e.score})}))}},{key:"playShowLeadersAnimation",value:(t=W((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,i=.3;yield Promise.all(this.leaderData.map(function(){var a=W((function*(a,o){var r=t.topLeaders[o];yield r.runShowUpAnimation(o*n,i,e)}));return function(e,t){return a.apply(this,arguments)}}()))})),function(e){return t.apply(this,arguments)})},{key:"hideLeaders",value:function(){var e,t=H(this.topLeaders);try{for(t.s();!(e=t.n()).done;){e.value.setVisible(!1)}}catch(e){t.e(e)}finally{t.f()}}}]),i}(ce)).prototype,"topLeaders",[k5],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),C5=E5))||C5);Q._RF.pop(),Q._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var G5,H5,V5,q5,W5,K5,j5,Y5,X5,Z5,J5,Q5,$5,e3,t3,n3,i3,a3,o3,r3,l3,s3,u3,c3,h3,p3,d3,y3,f3,v3,g3,m3,b3,w3,S3,k3,C3,E3,A3,T3,P3,R3,O3,I3=$.ccclass,L3=$.property,_3=(D5=I3("TournamentLeaderSkeleton"),M5=L3(ge),D5((B5=M((z5=function(t){F(o,t);var n,i,a=x(o);function o(){var e;z(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=a.call.apply(a,[this].concat(n)),B(e,"container",B5,U(e)),e}return N(o,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(he),this.validateRequiredComponents()}},{key:"hide",value:(i=W((function*(t){var n=this;yield e.runTweenAsync(ae(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t)})),function(e){return i.apply(this,arguments)})},{key:"show",value:(n=W((function*(t,n){this.node.active=!0,this.node.scale=new Ie(.8,.8,.8),this.uiOpacity.opacity=0;var i=this.container.position.clone();this.container.position=new Ie(i.x,i.y-100,i.z);var a=ae(this.node).delay(t);a.to(.2,{scale:Ie.ONE},{easing:"elasticOut"});var o=ae(this.container).delay(t);o.to(.2,{position:i},{easing:"backOut"});var r=ae(this.uiOpacity).delay(t);r.to(.2,{opacity:255},{easing:"cubicOut"}),yield Promise.all([e.runTweenAsync(a,n),e.runTweenAsync(o,n),e.runTweenAsync(r,n)]),this.node.scale=Ie.ONE,this.container.position=i,this.uiOpacity.opacity=255})),function(e,t){return n.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),o}(ce)).prototype,"container",[M5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N5=z5))||N5);Q._RF.pop(),Q._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var D3,M3=$.ccclass,N3=$.property,z3=$.requireComponent,B3=GameCore,F3=B3.Events,x3=B3.Utils,U3=x3.Object,G3=x3.Time,H3=x3.Number,V3=globalThis.game,q3=V3.event,W3=V3.storage,K3=V3.player,j3=V3.leaderboard,Y3=V3.language,X3=1166;G5=M3("TournamentDetailScreen"),H5=z3(R),V5=N3(Se),q5=N3(p),W5=N3(p),K5=N3(p),j5=N3(vV),Y5=N3(U5),X5=N3({type:ge,group:"Buttons"}),Z5=N3({type:ge,group:"Buttons"}),J5=N3({type:ge,group:"Buttons"}),Q5=N3({type:le}),$5=N3({type:ge}),e3=N3({type:ge}),t3=N3({type:[_3]}),n3=N3(Fg),i3=N3({type:ee,group:"Container"}),a3=N3({type:ee,group:"Container"}),o3=t.onlyRunInLifeCycleAsync,r3=t.onlyRunInLifeCycleAsync,l3=t.onlyRunInLifeCycleAsync,s3=t.onlyRunInLifeCycleAsync,u3=t.onlyRunInLifeCycleAsync,c3=t.onlyRunInLifeCycle,h3=t.onlyRunInLifeCycle,G5(p3=H5((y3=M((d3=function(e){F(S,e);var a,r,l,s,u,c,h,p,d,y,f,v,g,w=x(S);function S(){var e;z(this,S);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return e=w.call.apply(w,[this].concat(n)),B(e,"title",y3,U(e)),B(e,"titleLocalizer",f3,U(e)),B(e,"timeLocalizer",v3,U(e)),B(e,"playerCountLocalizer",g3,U(e)),B(e,"tournamentLeaders",m3,U(e)),B(e,"topLeaders",b3,U(e)),B(e,"playButton",w3,U(e)),B(e,"continueButton",S3,U(e)),B(e,"replayButton",k3,U(e)),B(e,"banner",C3,U(e)),B(e,"bannerLoadingRing",E3,U(e)),B(e,"bannerMask",A3,U(e)),B(e,"leaderSkeletons",T3,U(e)),B(e,"paperConfetti",P3,U(e)),B(e,"container",R3,U(e)),B(e,"tempContainer",O3,U(e)),e.signal=new i,e.leadersPayload=null,e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("TournamentDetailScreen: screen not found");e.validateEventPayload(t)&&(e.enabled=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return N(S,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(R),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){t.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){q3.on(F3.OPENING_SCREEN,this.handleOpeningScreen),q3.on(F3.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){q3.off(F3.OPENING_SCREEN,this.handleOpeningScreen),q3.off(F3.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function(){this.updateContainer(),this.setInteractableButtons(!0),this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders(),this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(ta.HIDE_UI),this.updateInfo()}},{key:"close",value:function(){b.closeTournamentDetailScreen(),this.setInteractableButtons(!1),this.node.scene.emit(ta.SHOW_UI),this.cleanup()}},{key:"cleanup",value:function(){var e;null===(e=this.signal)||void 0===e||e.abort(),this.signal=new i,this.tournamentLeaders.hideLeaders(),this.topLeaders.hideLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(g=W((function*(){var e,t,n,i,a,o,r=this,l=this.signal,s=null===(e=this.payload)||void 0===e||null===(e=e.screenData)||void 0===e?void 0:e.tournament;if(s){var u=null===(t=null===(n=this.payload.screenData)||void 0===n?void 0:n.playAnimation)||void 0===t||t,c=JSON.parse(s);c.id=c.id.toString(),this.tournamentPayload=c;var h=this.tournamentPayload,p=h.endTime,d=h.payload,y=h.title,f=h.tournamentType,v=d.leaderboardId,g=void 0===v?"":v,m=d.themeId,b=d.playerName;"PAGE_HOSTED"===f?this.updateTitleTournamentTitle(y):this.updateTitleWithPlayerName(null!=b?b:y),this.updateEndTime(p),this.updateTournamentBanner(m,l);var w=W3.getStorage("tournament"),S=w.previousScore,k=w.animateTournamentLeader;if(W3.setStorageData("tournament","animateTournamentLeader",!1),this.updateButtonsVisibility(k),yield this.showLoading(l),yield this.loadLeaders(g),!this.leadersPayload||0===this.leadersPayload.leaders.length||l.aborted)return this.updatePlayerCount(0),void(yield this.hideLoading(l));var C=this.leadersPayload,E=C.player,A=C.amountPlayer,T=null!==(i=this.leadersPayload.leaders)&&void 0!==i?i:[];if(T.sort((function(e,t){return e.rank-t.rank})),yield this.hideLoading(l),this.topLeaders&&this.tournamentLeaders&&!l.aborted){this.updatePlayerCount(A),this.topLeaders.updateData(T),this.topLeaders.playShowLeadersAnimation(l);var P=null!==(a=null==E?void 0:E.score)&&void 0!==a?a:0,R=null!==(o=null==E?void 0:E.rank)&&void 0!==o?o:0,O=k&&-1!==S&&S<P;this.tournamentLeaders.updateData(T);var I=!1;E&&O&&(I=this.tournamentLeaders.updateDisplayPlayerLeaderForRankChanging(S,P,R)),this.tournamentLeaders.initScrollViews(),this.tournamentLeaders.scrollView.scrollView.enabled=!0,yield l.callAsync((function(e){return r.runShowUpAnimation(e,u)})),k&&I&&-1!==S&&this.tournamentLeaders&&(yield l.callAsync((function(e){return r.tournamentLeaders.playRankChangeAnimation(e,S,P,R)})),this.tryPlayConfettiEffect(R))}}})),function(){return g.apply(this,arguments)})},{key:"updateContainer",value:(v=W((function*(){var e=this.tempContainer.height;this.container.node.position=this.tempContainer.node.position.clone(),e<X3&&this.container.height!==e?(this.container.height=e,Pe.instance.emit("canvas-resize")):e>X3&&this.container.height<X3&&(this.container.height=X3,Pe.instance.emit("canvas-resize"))})),function(){return v.apply(this,arguments)})},{key:"loadLeaders",value:(f=W((function*(e){this.leadersPayload=yield this.getLeadersPayload(e)})),function(e){return f.apply(this,arguments)})},{key:"showLoading",value:(y=W((function*(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;yield Promise.all([this.tournamentLeaders.scrollView.unlistenEvents(),this.tournamentLeaders.scrollView.scrollToTop(e,.1).then((function(){t.tournamentLeaders.scrollView.scrollView.enabled=!1,t.tournamentLeaders.scrollView.listenEvents()})),this.leaderSkeletons.map((function(t,i){return t.show(i*n,e)}))])})),function(e){return y.apply(this,arguments)})},{key:"hideLoading",value:(d=W((function*(e){yield Promise.all(this.leaderSkeletons.map((function(t){return t.hide(e)})))})),function(e){return d.apply(this,arguments)})},{key:"runShowUpAnimation",value:(p=W((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=t?0:.1;yield this.tournamentLeaders.playShowLeadersAnimation(e,n),yield this.tournamentLeaders.scrollToPlayerLeader(1.5,e)})),function(e){return p.apply(this,arguments)})},{key:"tryPlayConfettiEffect",value:function(e){if(!(e>10)){var t,n=H(this.paperConfetti);try{for(n.s();!(t=n.n()).done;){t.value.play()}}catch(e){n.e(e)}finally{n.f()}o.playSound(vn.LEADERBOARD_TRIUMPH)}}},{key:"updateTitleWithPlayerName",value:function(e){void 0!==e&&(this.titleLocalizer.enabled=!0,this.titleLocalizer.setParams([e]))}},{key:"updateTitleTournamentTitle",value:function(e){this.titleLocalizer.enabled=!1,this.title.string=e}},{key:"updateEndTime",value:function(e){try{var t=G3.getRelativeTime(e,Y3.getCurrentLocale(),{style:"short"});this.timeLocalizer.key="game.endsIn",this.timeLocalizer.setParams([t])}catch(e){this.timeLocalizer.key="game.endsSoon"}}},{key:"updateTournamentBanner",value:(h=W((function*(e,t){this.banner.spriteFrame=null;var i=n.getAsset("".concat(D[e],"/spriteFrame"),Be);i||(this.bannerMask.active=!0,this.bannerLoadingRing.active=!0,i=yield n.loadThemeTournamentAsync(e)),i||(i=yield n.loadThemeTournamentAsync(E.SUMMER)),this.banner&&i&&!t.aborted&&(this.banner.spriteFrame=i,this.bannerMask.active=!1,this.bannerLoadingRing.active=!1)})),function(e,t){return h.apply(this,arguments)})},{key:"updatePlayerCount",value:function(e){var t=H3.getShortNumber(e,3);1===e?this.playerCountLocalizer.key="game.player":(this.playerCountLocalizer.key="game.nPlayers",this.playerCountLocalizer.setParams([t]))}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLocalizer.key="status.loading"}},{key:"getLeadersPayload",value:(c=W((function*(e){var t=j3.getLeaderboardName(e);if(!t)return null;var n=yield Os.getAllLeaderboardAsync(e);if(!n)return null;var i,a=U3.vals(n.leaders),o=K3.getPlayerId(),r={leaders:[],amountPlayer:n.amountPlayer},l=H(a);try{for(l.s();!(i=l.n()).done;){var s=i.value;s.playerId===o?(r.player=s,r.leaders.push(s)):r.leaders.push(s)}}catch(e){l.e(e)}finally{l.f()}if(!r.player){var u=(yield j3.getLeadersByPlayerIdsAsync(t,[o]))[0];u&&(r.player=u,r.leaders.push(u))}return r})),function(e){return c.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(e){this.playButton.active=!e,this.continueButton.active=e,this.replayButton.active=e}},{key:"handleOnPlay",value:(u=W((function*(){var e=this.tournamentPayload.id||"";if(m.validateTournamentExpired(e))return this.close(),this.node.scene.emit(As.RELOAD_TOURNAMENT),void b.showNotificationScreenWithLocalizedKey("error.tourEnded",2);try{b.showLoadingScreen(),yield Zs.setMatchCustomDataAsync({level:1,score:0}),yield this.processJoinTournament()}catch(e){if(U3.hasOwn(e,"code")&&"USER_INPUT"===e.code)return;try{yield this.processContinueTournament()}catch(e){if(U3.hasOwn(e,"code")&&"USER_INPUT"===e.code)return;console.error("processPlayButtonPressed",e),b.showNotificationScreenWithLocalizedKey("error.tourJoinFail",2)}}finally{b.closeLoadingScreen()}})),function(){return u.apply(this,arguments)})},{key:"processJoinTournament",value:(s=W((function*(){try{yield this.joinTournamentAsync(),C.switchScene(A.GAME_SCENE,{level:1})}catch(e){throw console.warn("processJoinTournament",e),e}})),function(){return s.apply(this,arguments)})},{key:"processContinueTournament",value:(l=W((function*(){try{yield this.continueTournamentAsync(),C.switchScene(A.GAME_SCENE,{level:1})}catch(e){throw console.warn("processContinueTournament",e),e}})),function(){return l.apply(this,arguments)})},{key:"joinTournamentAsync",value:(r=W((function*(){var e=this.tournamentPayload.id||"";yield Zs.joinTournamentAsync(e)})),function(){return r.apply(this,arguments)})},{key:"continueTournamentAsync",value:(a=W((function*(){var e,t=null!==(e=GameSDK.context.getID())&&void 0!==e?e:"";yield Zs.continueTournamentAsync(t)})),function(){return a.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var e,t,n=(null!==(e=null===(t=this.payload)||void 0===t?void 0:t.screenData)&&void 0!==e?e:{}).tournamentContextType;switch(void 0===n?"tournament_start":n){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}},{key:"setInteractableButtons",value:function(e){this.screen.backgroundMaskButton.interactable=e}}]),S}(ce)).prototype,"title",[V5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f3=M(d3.prototype,"titleLocalizer",[q5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v3=M(d3.prototype,"timeLocalizer",[W5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g3=M(d3.prototype,"playerCountLocalizer",[K5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m3=M(d3.prototype,"tournamentLeaders",[j5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b3=M(d3.prototype,"topLeaders",[Y5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w3=M(d3.prototype,"playButton",[X5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S3=M(d3.prototype,"continueButton",[Z5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k3=M(d3.prototype,"replayButton",[J5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C3=M(d3.prototype,"banner",[Q5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E3=M(d3.prototype,"bannerLoadingRing",[$5],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A3=M(d3.prototype,"bannerMask",[e3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T3=M(d3.prototype,"leaderSkeletons",[t3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),P3=M(d3.prototype,"paperConfetti",[n3],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),R3=M(d3.prototype,"container",[i3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O3=M(d3.prototype,"tempContainer",[a3],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M(d3.prototype,"updateInfo",[o3],Object.getOwnPropertyDescriptor(d3.prototype,"updateInfo"),d3.prototype),M(d3.prototype,"loadLeaders",[r3],Object.getOwnPropertyDescriptor(d3.prototype,"loadLeaders"),d3.prototype),M(d3.prototype,"showLoading",[l3],Object.getOwnPropertyDescriptor(d3.prototype,"showLoading"),d3.prototype),M(d3.prototype,"hideLoading",[s3],Object.getOwnPropertyDescriptor(d3.prototype,"hideLoading"),d3.prototype),M(d3.prototype,"runShowUpAnimation",[u3],Object.getOwnPropertyDescriptor(d3.prototype,"runShowUpAnimation"),d3.prototype),M(d3.prototype,"tryPlayConfettiEffect",[c3],Object.getOwnPropertyDescriptor(d3.prototype,"tryPlayConfettiEffect"),d3.prototype),M(d3.prototype,"updatePlayerCount",[h3],Object.getOwnPropertyDescriptor(d3.prototype,"updatePlayerCount"),d3.prototype),p3=d3))||p3);Q._RF.pop(),Q._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,$.ccclass)("TournamentLeader")(D3=function(e){F(n,e);var t=x(n);function n(){return z(this,n),t.apply(this,arguments)}return N(n)}(xH));Q._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});