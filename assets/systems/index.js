System.register("chunks:///systems.js",["./rollupPluginModLoBabelHelpers-487c63b6.js","cc","./renderCustomShareScore-f8229879.js"],(function(e,t){var n,a,i,r,o,s,c,u,l,d,h,f,p,v,y,m,g,E,S,w,A,_,b,C,k,D,R,T,F,L,M,N,x,I,P,O,B,U,G,V,z,H,q,W,j,K,Q,Y,Z,X,J,$,ee,te,ne,ae,ie,re,oe;return{setters:[function(e){n=e.f,a=e.c,i=e.k,r=e.p,o=e.m,s=e.h,c=e.n,u=e.g},function(e){l=e.cclegacy,d=e.game,h=e.settings,f=e.Settings,p=e.AssetManager,v=e.director,y=e.input,m=e.Input,g=e.sys,E=e.macro,S=e.DynamicAtlasManager,w=e.screen,A=e.math,_=e.Director,b=e.View,C=e.ResolutionPolicy,k=e.profiler,D=e.ImageAsset,R=e.Texture2D,T=e.UIRenderer,F=e.assetManager,L=e.CCObject,M=e.Node,N=e.instantiate,x=e.Vec3,I=e.Game},function(e){P=e.G,O=e.a,B=e.m,U=e.q,G=e.e,V=e.C,z=e.M,H=e.D,q=e.T,W=e.P,j=e.y,K=e.I,Q=e.E,Y=e.v,e.B,Z=e.L,X=e.c,J=e.s,$=e.k,ee=e.z,te=e.S,ne=e.f,ae=e.F,ie=e.n,re=e.A,oe=e.o}],execute:function(){l._RF.push({},"0b4bc6YT6ZGg4lnXfh/zL6J","AdsManager",void 0);var e=GameCore,t=e.Events,se=e.Configs,ce=e.Utils.Time,ue=globalThis.game,le=ue.ads,de=ue.player,he=ue.event,fe=function(){function e(){var n=this;a(this,e),this.currentLayout="",this.handleShowBannerAds=function(e){e.sceneName!==U.BOOT_SCENE&&(de.isFirstLogin()||(n.showBannerAdsByLayout(),he.off(t.SCENE_LAUNCHED,n.handleShowBannerAds)))},this.handleWhenGameReady=i((function*(){yield n.handleShowInterstitialAdWhenGameReady(),yield ce.sleepAsync(1e4),B.preloadAds()})),this.handleShowInterstitialAdWhenGameReady=i((function*(){var e=se.Ads,t=e.Enabled,a=e.ShowAdOnLoad;if(t){var i=a.Enabled,r=a.DelaySeconds,o=a.PlacementId;if(i)try{r>0&&(yield ce.sleepAsync(1e3*r));var s=le.getAdByPlacementId(o);if(!s)return;yield n.showAdByConfig(s)}catch(e){console.warn("handleShowAdWhenLoadGame failed",e)}}})),this.handleLayoutChanged=function(e){n.currentLayout=e,n.showBannerAdsByLayout()}}var r;return n(e,[{key:"init",value:function(){this.listenEvents(),console.info("Ads Manager: Initialized")}},{key:"listenEvents",value:function(){d.on(P.ORIENTATION_CHANGED,this.handleLayoutChanged),he.on(t.SCENE_LAUNCHED,this.handleShowBannerAds),he.catchUp(t.GAME_READY,this.handleWhenGameReady)}},{key:"showAdByConfig",value:(r=i((function*(e){try{var t=e.type,n=e.placementId;yield le.loadAdAsync(t,n),G.muteAudio(!0),yield le.showAdAsync(t,n)}catch(e){console.warn("showAdByConfig failed",e)}finally{d.resume(),G.muteAudio(!1)}})),function(e){return r.apply(this,arguments)})},{key:"showBannerAdsByLayout",value:function(){var e=se.Ads.BannerDisplayAdOptions;this.currentLayout!==O.Layout.Landscape?e.forEach((function(e){var t=e.PlacementId,n=e.Position;"bottom"===n||"top"===n?B.showBannerAd(t):B.hideBannerAd(t)})):B.showBannerAds()}}]),e}();l._RF.pop(),l._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var pe=GameCore.Events,ve=globalThis.game.event,ye=function(){function e(){a(this,e)}return n(e,[{key:"init",value:function(){console.info("Core Manager: Initialized")}},{key:"requestStart",value:function(){ve.emit(pe.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(e){ve.catchUp(pe.CORE_BOOTING,e)}},{key:"onCoreStart",value:function(e){ve.catchUp(pe.CORE_STARTING,e)}},{key:"onCoreReady",value:function(e){ve.catchUp(pe.CORE_READY,e)}}]),e}();l._RF.pop(),l._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var me=GameCore,ge=me.Events,Ee=me.Configs.GameEngine.DynamicAtlas,Se=me.Utils,we=Se.Valid,Ae=Se.Device,_e=Se.Function,be=globalThis.game.event,Ce=function(){function e(){var t=this;a(this,e),this.handlePauseEngine=i((function*(){console.info("Engine: Paused",d.isPaused()),d.isPaused()})),this.handleResumeEngine=i((function*(){console.info("Engine: Resumed",d.isPaused()),d.isPaused()})),this.handleResizeView=function(e){b.instance.resizeWithBrowserSize(!1);var n=e.width,a=e.height;t.resizeView(n,a)},this.handleViewResized=_e.throttle((function(e){var t=e.width,n=e.height;b.instance.resizeWithBrowserSize(!0),console.info("âœ¨ New View Size",{width:t,height:n})}),600)}var t;return n(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.setupAssetDownloader(),this.setupOptimalPipelines(),this.setupEngineRunningState(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){d.on(P.VIEW_RESIZE,this.handleResizeView),d.on(P.VIEW_RESIZED,this.handleViewResized)}},{key:"overrideSettings",value:function(){h.overrideSettings(f.Category.ENGINE,"debug",we.isDebugger()),d.frameRate=Ae.isDesktop()?60:48}},{key:"setupAutoAtlas",value:function(){p.instance.cacheAsset=!0}},{key:"setupAssetDownloader",value:function(){var e=p.instance.downloader;e.maxConcurrency=15,e.maxRequestsPerFrame=15}},{key:"getPipelineFlows",value:function(){var e,t;return null!==(e=null===(t=v.root)||void 0===t||null===(t=t.pipeline)||void 0===t?void 0:t.flows)&&void 0!==e?e:[]}},{key:"getRenderQueues",value:function(e){var t=this.getPipelineFlows()[0];return null!=t&&t.stages?t.stages[e].renderQueues:[]}},{key:"setupOptimalPipelines",value:(t=i((function*(){p.instance.transformPipeline.remove(1),yield we.isValueChangeAsync((function(){return!!v.root}),!0,{timeout:1e4});var e=this.getPipelineFlows();e.shift(),e.shift();var t=this.getRenderQueues(0);t.shift(),t.shift()})),function(){return t.apply(this,arguments)})},{key:"setupEngineRunningState",value:function(){var e=this;y.on(m.EventType.TOUCH_START,this.handleResumeEngine),be.catchUp(ge.GAME_READY,(function(){be.on(ge.VISIBILITY_HIDDEN,e.handlePauseEngine),be.on(ge.VISIBILITY_VISIBLE,e.handleResumeEngine)}))}},{key:"setupDynamicAtlas",value:function(){switch(g.os){case g.OS.IOS:this.setupDynamicAtlasForIOS();break;case g.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(e){var t=e.Enabled,n=e.AutoAtlasSize,a=e.MaxAtlasCount,i=e.MaxAtlasSize,r=e.MaxFrameSize;if(E.CLEANUP_IMAGE_CACHE=!1,S.instance.enabled=t,S.instance.textureSize=i,S.instance.maxFrameSize=r,S.instance.maxAtlasCount=a,S.instance.textureBleeding=Ee.TextureBleeding,n){var o=this.getMaxTextureSize();if(!o)return;S.instance.maxAtlasCount=1,S.instance.textureSize=o}}},{key:"getMaxTextureSize",value:function(){if(!v.root)return-1;var e=v.root.device.capabilities.maxTextureSize,t=1024;return e-t<=S.instance.maxFrameSize?-1:e>8192?7168:e-t}},{key:"setupDynamicAtlasForIOS",value:function(){var e=Ee.IOS;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForAndroid",value:function(){var e=Ee.Android;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForDesktop",value:function(){var e=Ee.Desktop;this.setDynamicAtlas(e)}},{key:"setupBatcherLimit",value:function(){E.BATCHER2D_MEM_INCREMENT=288,E.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(e,t){var n,a=window.devicePixelRatio,i=a>=2?2/a:1,r=Math.round(e*a*i),o=Math.round(t*a*i);null===(n=v.root)||void 0===n||n.resize(r,o),w.windowSize=new A.Size(r,o),v.once(_.EVENT_AFTER_UPDATE,(function(){d.emit(P.VIEW_RESIZED,{width:r,height:o})}))}}]),e}();l._RF.pop();var ke,De=new(function(){function e(){a(this,e),this._registry={},this._moduleCache={}}return n(e,[{key:"define",value:function(e,t,n){this._registry[e]={factory:t,resolveMap:n}}},{key:"require",value:function(e){return this._require(e)}},{key:"throwInvalidWrapper",value:function(e,t){throw new Error("Module '".concat(e,"' imported from '").concat(t,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(e,t){var n=this._moduleCache[e];if(n)return n.exports;var a={id:e,exports:{}};return this._moduleCache[e]=a,this._tryModuleLoad(a,e),a.exports}},{key:"_resolve",value:function(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}},{key:"_resolveFromInfos",value:function(e,t){var n,a;return e in cjsInfos?e:t&&null!==(n=null===(a=cjsInfos[t])||void 0===a?void 0:a.resolveCache[e])&&void 0!==n?n:void 0}},{key:"_tryModuleLoad",value:function(e,t){var n=!0;try{this._load(e,t),n=!1}finally{n&&delete this._moduleCache[t]}}},{key:"_load",value:function(e,t){var n=this._loadWrapper(t),a=n.factory,i=n.resolveMap,r=this._createRequire(e),o=i?this._createRequireWithResolveMap("function"==typeof i?i():i,r):r;a(e.exports,o,e)}},{key:"_loadWrapper",value:function(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}},{key:"_loadHostProvidedModules",value:function(e){return{factory:function(t,n,a){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(e,"'."));try{a.exports=require(e)}catch(t){throw new Error("Exception thrown when calling host defined require('".concat(e,"')."),{cause:t})}}}}},{key:"_createRequire",value:function(e){var t=this;return function(n){return t._require(n,e)}}},{key:"_createRequireWithResolveMap",value:function(e,t){return function(n){var a=e[n];if(a)return t(a);throw new Error("Unresolved specifier "+n)}}},{key:"_throwUnresolved",value:function(e,t){throw new Error("Unable to resolve ".concat(e," from ").concat(parent,"."))}}]),e}());function Re(e){return(Re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Te="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";De.define(Te,(function(e,t,n,a,i){!function(t,a){"object"===Re(e)&&void 0!==n?n.exports=a():"function"==typeof define&&define.amd?define(a):t.ResizeObserver=a()}(this,(function(){var e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,a){return e[0]===t&&(n=a,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),a=this.__entries__[n];return a&&a[1]},t.prototype.set=function(t,n){var a=e(this.__entries__,t);~a?this.__entries__[a][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,a=e(n,t);~a&&n.splice(a,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,a=this.__entries__;n<a.length;n++){var i=a[n];e.call(t,i[1],i[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,n="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),a="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var i=["top","right","bottom","left","width","height","size","weight"],r="undefined"!=typeof MutationObserver,o=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,i=!1,r=0;function o(){n&&(n=!1,e()),i&&c()}function s(){a(o)}function c(){var e=Date.now();if(n){if(e-r<2)return;i=!0}else n=!0,i=!1,setTimeout(s,t);r=e}return c}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),r?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;i.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(e,t){for(var n=0,a=Object.keys(t);n<a.length;n++){var i=a[n];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},c=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||n},u=v(0,0,0,0);function l(e){return parseFloat(e)||0}function d(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+l(e["border-"+n+"-width"])}),0)}function h(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return u;var a=c(e).getComputedStyle(e),i=function(e){for(var t={},n=0,a=["top","right","bottom","left"];n<a.length;n++){var i=a[n],r=e["padding-"+i];t[i]=l(r)}return t}(a),r=i.left+i.right,o=i.top+i.bottom,s=l(a.width),h=l(a.height);if("border-box"===a.boxSizing&&(Math.round(s+r)!==t&&(s-=d(a,"left","right")+r),Math.round(h+o)!==n&&(h-=d(a,"top","bottom")+o)),!function(e){return e===c(e).document.documentElement}(e)){var f=Math.round(s+r)-t,p=Math.round(h+o)-n;1!==Math.abs(f)&&(s-=f),1!==Math.abs(p)&&(h-=p)}return v(i.left,i.top,s,h)}var f="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof c(e).SVGGraphicsElement}:function(e){return e instanceof c(e).SVGElement&&"function"==typeof e.getBBox};function p(e){return t?f(e)?function(e){var t=e.getBBox();return v(0,0,t.width,t.height)}(e):h(e):u}function v(e,t,n,a){return{x:e,y:t,width:n,height:a}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=p(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),m=function(e,t){var n,a,i,r,o,c,u,l=(a=(n=t).x,i=n.y,r=n.width,o=n.height,c="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(c.prototype),s(u,{x:a,y:i,width:r,height:o,top:i,right:a+r,bottom:o+i,left:a}),u);s(this,{target:e,contentRect:l})},g=function(){function t(t,n,a){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=a}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof c(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof c(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new m(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),E="undefined"!=typeof WeakMap?new WeakMap:new e,S=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=o.getInstance(),a=new g(t,n,this);E.set(this,a)};return["observe","unobserve","disconnect"].forEach((function(e){S.prototype[e]=function(){var t;return(t=E.get(this))[e].apply(t,arguments)}})),void 0!==n.ResizeObserver?n.ResizeObserver:S})),ke=n.exports}),{}),De.require(Te),l._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var Fe=O.Layout,Le=O.DesignSize,Me=Le.Portrait,Ne=Le.Landscape,xe=GameCore,Ie=xe.Utils.Function,Pe=xe.Configs.GameEngine,Oe=Pe.AutoResizeCanvas,Be=Pe.AutoChangeOrientation,Ue=function(){function e(){var t=this;a(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(e){console.info("ðŸ“± View resize by system"),window.devicePixelRatio=e||window.devicePixelRatio,t.setupOrientationByScreenSize(),t.resizeGameView()},this.handleViewResize=Ie.debounce((function(){console.info("ðŸ“± View resize by window"),t.setupOrientationByScreenSize(),t.resizeGameView()}),300),this.handleBodyResize=Ie.debounce((function(){t.resizeGameDiv()&&(console.info("ðŸ“± View resize by body"),t.setupOrientationByScreenSize(),t.resizeGameView())}),300)}return n(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){Oe&&(w.on("window-resize",this.handleViewResize,this),w.on("orientation-change",this.handleViewResize,this)),d.on(P.REQUEST_VIEW_RESIZE,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){Oe&&new ke(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){Be&&(b.instance.resizeWithBrowserSize(!0),b.instance.setOrientation(E.ORIENTATION_AUTO),this.resolutionPolicy=b.instance.getResolutionPolicy(),this.resolutionPolicy.setContentStrategy(C.ContentStrategy.EXACT_FIT),this.resolutionPolicy.setContainerStrategy(C.ContainerStrategy.EQUAL_TO_FRAME))}},{key:"setupOrientationByScreenSize",value:function(){Be&&(this.getScreenRatio()<1?this.setPortraitView():this.setLandscapeView())}},{key:"resizeGameDiv",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.getElementById("GameDiv");if(!t)return!1;var n=V.getScreenWidthCss(),a=V.getScreenHeightCss(),i=t.getBoundingClientRect(),r=i.width,o=i.height;return!(n===r&&a===o&&!e)&&(t.style.width="".concat(n,"px"),t.style.height="".concat(a,"px"),!0)}},{key:"resizeGameView",value:function(){var e=V.getScreenWidthCss(),t=V.getScreenHeightCss();d.emit(P.VIEW_RESIZE,{width:e,height:t})}},{key:"setPortraitView",value:function(){var e=Me.WIDTH,t=Me.HEIGHT;this.currentLayout!==Fe.Portrait&&(this.currentLayout=Fe.Portrait,this.changeDesignResolutionSize(e,t))}},{key:"setLandscapeView",value:function(){var e=Ne.WIDTH,t=Ne.HEIGHT;this.currentLayout!==Fe.Landscape&&(this.currentLayout=Fe.Landscape,this.changeDesignResolutionSize(e,t))}},{key:"changeDesignResolutionSize",value:function(e,t){this.resolutionPolicy.setContentStrategy(C.ContentStrategy.FIXED_WIDTH);var n=this.currentLayout===Fe.Portrait,a=this.currentLayout===Fe.Landscape;n&&!O.FULL_PORTRAIT_SIZE?this.resolutionPolicy.setContentStrategy(C.ContentStrategy.SHOW_ALL):a&&!O.FULL_LANDSCAPE_SIZE&&this.resolutionPolicy.setContentStrategy(C.ContentStrategy.EXACT_FIT),b.instance.setDesignResolutionSize(e,t,this.resolutionPolicy),d.emit(P.LAYOUT_CHANGED,this.currentLayout),console.info("ðŸ“± Change layout to",this.currentLayout,this.resolutionPolicy)}},{key:"getScreenRatio",value:function(){return V.getScreenWidthCss()/V.getScreenHeightCss()}}]),e}();l._RF.pop(),l._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var Ge=GameCore,Ve=Ge.Utils,ze=Ve.Valid,He=Ve.Object,qe=Ve.Array,We=Ge.Dtos.Match,je=We.CustomData,Ke=We.Data,Qe=["code","cols","encoding","idSize","rows"],Ye=["addRandomTilesPerMove","maxSpaceOfPair"],Ze=function(){function e(){a(this,e)}return n(e,[{key:"init",value:function(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function(){je.addDefaultData(z),je.addValidateFunction("score",(function(e){if(!ze.isNumber(e)||e<0)throw new Error("score ".concat(e," is invalid"))}))}},{key:"setupMatchData",value:function(){var e=this;Ke.addDefaultData(H),Ke.addValidateFunction("extraData",(function(t){if(null!=t){if(!ze.isObject(t))throw new Error("extraData ".concat(t," must be a record of string keys"));var n=t,a=Object.keys(n);if(!qe.has(a,"level"))throw new Error("extraData.level is missing");if(!ze.isNumber(n.level))throw new Error("extraData.level ".concat(n.level," must be a number"));if(!qe.has(a,"fen"))throw new Error("extraData.fen is missing");if(e.validateFen(n.fen),!qe.has(a,"gravity"))throw new Error("extraData.gravity is missing");if(!ze.isString(n.gravity))throw new Error("extraData.gravity ".concat(n.gravity," must be a string"));if(!qe.has(a,"rules"))throw new Error("extraData.rules is missing");if(e.validateLevelRules(n.rules),!qe.has(a,"time"))throw new Error("extraData.time is missing");if(!ze.isNumber(n.time))throw new Error("extraData.time ".concat(n.time," must be a number"))}}))}},{key:"validateFen",value:function(e){if(!ze.isObject(e))throw new Error("extraData.fen ".concat(e," must be a record of string keys"));var t=this.validateKeys(e,Qe);if(!ze.isNumber(t.idSize))throw new Error("fen.idSize must be a number");if(!ze.isString(t.code))throw new Error("fen.code must be a string");if(!ze.isNumber(t.rows))throw new Error("fen.rows must be a number");if(!ze.isNumber(t.cols))throw new Error("fen.cols must be a number");if(!ze.isObject(t.encoding))throw new Error("fen.encoding must be a record of string keys");var n=this.validateKeys(t.encoding,He.vals(q));Object.entries(n).forEach((function(e){var t=r(e,2),n=t[0],a=t[1];if(!ze.isString(a))throw new Error("fen.encoding.".concat(n," ").concat(a," must be a string"))}))}},{key:"validateLevelRules",value:function(e){if(!ze.isObject(e))throw new Error("extraData.rules ".concat(e," must be a record of string keys"));var t=this.validateKeys(e,Ye);if(!ze.isNumber(t.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!ze.isNumber(t.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function(e,t){return Object.keys(e).forEach((function(e){if(!qe.has(t,e))throw new Error("Key ".concat(e," is missing"))})),e}}]),e}();l._RF.pop(),l._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var Xe=GameCore,Je=Xe.Utils,$e=Je.Valid,et=Je.Array,tt=Je.Object,nt=Xe.Dtos,at=globalThis.game.player,it=function(){function e(){a(this,e)}return n(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var e=nt.Player;e.Data.addDefaultData(W),e.GameData.addDefaultData(j),e.GameData.addValidateFunction("stars",(function(e){if(!$e.isNumber(e)||e<0)throw new Error("stars ".concat(e," is invalid"))})),e.GameData.addValidateFunction("totalLevel",(function(e){if(!$e.isNumber(e)||e<1)throw new Error("totalLevel ".concat(e," is invalid"))})),e.GameData.addValidateFunction("levelVersion",(function(e){if(!$e.isNumber(e)||e<0)throw new Error("levelVersion ".concat(e," is invalid"))})),e.GameData.addValidateFunction("lastRewardedItems",(function(e){if(!$e.isNumber(e)||e<0)throw new Error("lastRewardedItems ".concat(e," is invalid"))})),e.GameData.addValidateFunction("lastCreateTournamentShown",(function(e){if(!$e.isNumber(e)||e<0)throw new Error("lastCreateTournamentShown ".concat(e," is invalid"))})),e.GameData.addValidateFunction("guideItemShowed",(function(e){if(!Array.isArray(e))throw new Error("guideItemShowed ".concat(e," is invalid"))})),e.GameData.addValidateFunction("items",(function(e){if(!$e.isObject(e))throw new Error("items ".concat(e," is invalid"));var t=Object.keys(e),n=tt.vals(e);if(!et.has(t,K.HINT))throw new Error("item ".concat(K.HINT," not found"));if(!et.has(t,K.THUNDER))throw new Error("item ".concat(K.THUNDER," not found"));if(!et.has(t,K.STORM))throw new Error("item ".concat(K.STORM," not found"));if(!et.has(t,K.PLIERS))throw new Error("item ".concat(K.PLIERS," not found"));n.forEach((function(e){if(!$e.isNumber(e)||e<0)throw new Error("item ".concat(e," is invalid"))}))})),e.GameData.addValidateFunction("skins",(function(e){if(!$e.isObject(e))throw new Error("skins ".concat(e," is invalid"))}))}},{key:"requestConnectedPlayers",value:function(){at.requestConnectedPlayers().catch((function(e){console.warn("player.requestConnectedPlayers",e)}))}}]),e}();l._RF.pop(),l._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var rt=GameCore,ot=rt.Events,st=rt.Utils.Valid,ct=globalThis.game,ut=ct.event,lt=ct.adaptivePerformance,dt=function(){function e(){var t=this;a(this,e),this.handleBeginFrame=function(){v.on(_.EVENT_AFTER_UPDATE,t.lateUpdate),v.on(_.EVENT_BEFORE_UPDATE,t.updateActualFPS)},this.handleAfterSceneLaunch=function(e){lt&&lt.trackingScene(e.name)},this.handleRequestResizeGame=function(e){var t=e.forcePixelRatio;st.isNumber(t)&&d.emit(P.REQUEST_VIEW_RESIZE,t)},this.lateUpdate=function(){var e=1e3*d.deltaTime;null==lt||lt.updatePostStepDeltaTime(e)},this.updateActualFPS=function(){var e,t=null===(e=v.root)||void 0===e?void 0:e.fps;st.isNumber(t)&&(null==lt||lt.updateActualFPS(t))}}return n(e,[{key:"init",value:function(){lt&&this.listenEvents()}},{key:"listenEvents",value:function(){ut.on(ot.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),v.once(_.EVENT_BEGIN_FRAME,this.handleBeginFrame),v.on(_.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();l._RF.pop(),l._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var ht=globalThis.game.canvasRecorder,ft=function(){function e(){a(this,e)}return n(e,[{key:"init",value:function(){if(d.canvas&&ht){ht.setCanvas(d.canvas);var e=ht.getOptions(),t=ht.waitNextFrame;ht.waitNextFrame=i((function*(){return e.syncFps?new Promise((function(e){v.once(_.EVENT_AFTER_RENDER,e),d.pause(),d.step()})):(d.resume(),yield t.call(ht),Promise.resolve())}))}}}]),e}();l._RF.pop(),l._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var pt=function(){function e(){var t=this;a(this,e),this.hideCocosStats=function(){clearInterval(t.waiter),t.waiter=setInterval(t.checkProfilerReady,100)},this.checkProfilerReady=function(){if(k){k._showFPS=!1;var e=k._rootNode;e&&(e.active=!1,e.isValid&&(e.destroyAllChildren(),e.removeAllChildren(),e.destroy(),clearInterval(t.waiter)))}}}return n(e,[{key:"init",value:function(){k&&v.on(_.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();l._RF.pop(),l._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var vt=GameCore,yt=vt.Configs.GameEngine.DynamicAssets,mt=vt.Events,gt=vt.Utils.Array,Et=globalThis.game,St=Et.event,wt=Et.storage,At=Et.getBuildVersion,_t=[".png",".jpg",".jpeg",".webp"],bt=function(){function e(){var t=this;a(this,e),this.isProcessing=!1,this.useHighQuality=!1,this.upgradableAssets=new Map,this.handleSceneLaunched=function(e){var t=e.sceneName,n=[U.BOOT_SCENE];gt.has(n,t)||d.emit(P.CHANGE_QUALITY_ASSETS,{quality:"highest"})},this.requestUpdateDynamicAssets=function(){d.emit(P.UPGRADE_DYNAMIC_ATLAS,{force:!0})},this.collectUpgradableAssets=function(e){var n,a=e.output=e.input,i=yt.Resolution,r=i.Adjust,o=i.Original,c=s(a);try{for(c.s();!(n=c.n()).done;){var u=n.value;if(gt.has(_t,u.ext)&&!t.upgradableAssets.has(u.uuid)){t.useHighQuality?(u.url=t.replaceAssetUrl(u.url),u.resolution=o,u.upgradeOnNextRequest=!0):r<o&&(u.resolution=r);var l={ext:u.ext,url:u.url,uuid:u.uuid,options:u.options,upgraded:u.upgraded,resolution:u.resolution,upgradeOnNextRequest:u.upgradeOnNextRequest};t.upgradableAssets.set(u.uuid,l)}}}catch(e){c.e(e)}finally{c.f()}},this.replaceAssetUrl=function(e){return t.useHighQuality?e.replace("native/","native32/"):e},this.handleChangeQuality=i((function*(){t.isProcessing=!0;var e,n=[],a=s(t.upgradableAssets.values());try{for(a.s();!(e=a.n()).done;){var i=e.value,r=t.processUpgradeQualityAsync(i);n.push(r)}}catch(e){a.e(e)}finally{a.f()}var o=yield Promise.all(n);t.isProcessing=!1;var c=o.filter((function(e){return e})).length;t.requestUpdateDynamicAssets(),console.warn("DynamicAssets: Upgradable Assets Info",{total:c,results:o})}))}var t,r,c;return n(e,[{key:"init",value:(c=i((function*(){var e=yt.Enabled,t=yt.Resolution;console.info("DynamicAssets: init",{EDITOR:Q,Enabled:e}),e&&(p.instance.transformPipeline.insert(this.collectUpgradableAssets,2),yield this.initStorage(),this.checkCacheVersion(),this.listenEvents(),window.requestIdleCallback=window.requestIdleCallback||function(e){e()},t.Adjust,t.Original)})),function(){return c.apply(this,arguments)})},{key:"initStorage",value:(r=i((function*(){yield wt.addStorage("DynamicAssets",{useHighQuality:!1,buildVersion:"0"},!0)})),function(){return r.apply(this,arguments)})},{key:"checkCacheVersion",value:function(){var e=At().toString(),t=wt.getStorage("DynamicAssets"),n=null!=t?t:{},a=n.buildVersion,i=n.useHighQuality;"boolean"==typeof i&&(this.useHighQuality=i&&a===e),wt.setStorageData("DynamicAssets","buildVersion",e),wt.updateToWebStorage("DynamicAssets")}},{key:"listenEvents",value:function(){var e=this;d.on(P.CHANGE_QUALITY_ASSETS,this.handleChangeQuality),setTimeout((function(){e.useHighQuality=!0,e.autoUpgradeQuality(),St.on(mt.SCENE_LAUNCHED,e.handleSceneLaunched)}),4e3)}},{key:"autoUpgradeQuality",value:function(){var e=this;requestIdleCallback(i((function*(){if(!e.isProcessing&&!d.isPaused()){var t=o(e.upgradableAssets.values()).find((function(e){return!e.upgraded&&!e.upgradeOnNextRequest}));if(!t)return wt.setStorageData("DynamicAssets","useHighQuality",!0),wt.updateToWebStorage("DynamicAssets"),void e.requestUpdateDynamicAssets();console.info("DynamicAssets: Auto upgrade quality",t),e.isProcessing=!0,yield e.processUpgradeQualityAsync(t),e.isProcessing=!1,e.autoUpgradeQuality()}})),{timeout:1e3})}},{key:"processUpgradeQualityAsync",value:(t=i((function*(e){var t=this;if(e.upgraded||e.upgradeOnNextRequest)return!0;var n=p.instance,a=n.assets,i=n.loadAny,r=a.get(e.uuid);return r instanceof D?(e.url=this.replaceAssetUrl(e.url),new Promise((function(n){i(e,e.options,(function(a,i){if(a)return console.warn("DynamicAssets: Upgrade error",a),void n(!1);r.reset(i),e.upgraded=!0,t.upgradableAssets.set(e.uuid,e),d.emit(P.ASSET_QUALITY_CHANGE,{asset:r,item:e}),n(!0)}))}))):(console.warn("DynamicAssets: Asset not found",e.uuid),!1)})),function(e){return t.apply(this,arguments)})}]),e}();l._RF.pop(),l._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var Ct=GameCore,kt=Ct.Events,Dt=Ct.Configs.GameEngine.DynamicAtlas,Rt=Dt.UsePowerOfTwo,Tt=Dt.TextureAtlasOptimize,Ft=Ct.Utils,Lt=Ft.Array,Mt=Ft.Json,Nt=Ft.Object,xt=Ft.Function,It=globalThis.game.event,Pt=function(){function e(){var t=this;a(this,e),this.atlasTexId=null,this.drawInfo=[],this.atlasInfo=null,this.lastAtlasInfo=null,this.renderTimes=[],this.lastRenderTime=0,this.renderTimeInterval=5e3,this.isEffective=!0,this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1,this.collectInfo={},this.pendingSprites={},this.setupRenderListeners=function(){v.on(_.EVENT_BEFORE_RENDER,t.updateBeforeRenderTime),v.on(_.EVENT_AFTER_RENDER,t.updateAfterRenderTime),It.catchUp(kt.SCENE_LAUNCHED,(function(){v.once(_.EVENT_AFTER_RENDER,t.checkRenderTimeHighers)}))},this.checkRenderTimeHighers=function(){var e=t.getMeanRenderTime();e>8&&t.handleLaggyFrame(e),v.once(_.EVENT_AFTER_RENDER,(function(){setTimeout(t.checkRenderTimeHighers,t.renderTimeInterval)}))},this.resetPendingSprites=function(){console.info("DynamicAtlas: Reset pending sprites"),t.pendingSprites={}},this.updateBeforeRenderTime=function(){t.lastRenderTime=performance.now()},this.updateAfterRenderTime=function(){t.renderTimes.push(performance.now()-t.lastRenderTime)},this.requestUpdateDynamicAtlas=function(e){t.isProcessing||(t.forceUpdateDynamicAtlas||(t.forceUpdateDynamicAtlas=(null==e?void 0:e.force)||!1),t.updateDynamicAtlas())},this.updateDynamicAtlas=xt.debounce((function(){try{var e=v.getScene();if(!e)return;var n=t.collectPackageInfo();if(Object.keys(n).length<1)return;if(t.drawInfo=[],t.atlasInfo=null,t.isProcessing=!0,t.generateDrawInfo(Nt.vals(n)),!t.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found");if(!t.updateAtlasData()&&!t.forceUpdateDynamicAtlas)return;var a=e.getComponentsInChildren(T);t.refreshComponents(a)}catch(e){console.error("DynamicAtlas: Error updating dynamic atlas",e)}finally{t.isProcessing=!1,t.forceUpdateDynamicAtlas=!1}}),1e3),this.generateDrawInfo=function(e){if(!(e.length<1)){var n=e.sort((function(e,t){return t.usageCount-e.usageCount})),a=S.instance.textureSize;if(t.calculateOptimizedAtlas(n,a),t.atlasInfo){var i,r=t.atlasInfo.textures,o=s(r);try{for(o.s();!(i=o.n()).done;){var c=i.value;t.drawInfo.push(c)}}catch(e){o.e(e)}finally{o.f()}var u=n.filter((function(e){return!r.some((function(t){return t.id===e.id}))}));u.length>0&&(console.warn("DynamicAtlas: Missing textures",u),t.generateDrawInfo(u))}else console.warn("DynamicAtlas: Atlas info not found",{textures:n})}},this.calculateOptimizedAtlas=function(e,n){var a=function(e){var t,n=0,a=0,i=s(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n+=r.w*r.h,a=Math.max(a,r.w)}}catch(e){i.e(e)}finally{i.f()}e.sort((function(e,t){return t.h-e.h}));var o,c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}],u=0,l=0,d=s(e);try{for(d.s();!(o=d.n()).done;)for(var h=o.value,f=c.length-1;f>=0;f--){var p=c[f];if(!(h.w>p.w||h.h>p.h)){if(h.x=p.x,h.y=p.y,l=Math.max(l,h.y+h.h),u=Math.max(u,h.x+h.w),h.w===p.w&&h.h===p.h){var v=c.pop();f<c.length&&(c[f]=v)}else h.h===p.h?(p.x+=h.w,p.w-=h.w):h.w===p.w?(p.y+=h.h,p.h-=h.h):(c.push({x:p.x+h.w,y:p.y,w:p.w-h.w,h:h.h}),p.y+=h.h,p.h-=h.h);break}}}catch(e){d.e(e)}finally{d.f()}return{w:u,h:l,fill:n/(u*l)||0}}(e),i=a.w,r=a.h,c=a.fill;if(c<.6)console.warn("DynamicAtlas: Fill rate is too low",c,o(e));else{if(i>n||r>n)return console.warn("DynamicAtlas: Packed size is bigger than atlas size",i,r,n),void(e.pop()?t.calculateOptimizedAtlas(e,n):console.warn("DynamicAtlas: Texture size is too big",i,r,n));t.atlasInfo={textures:e,atlasSize:n,packedInfo:{width:Math.round(i),height:Math.round(r),fillRate:c}}}},this.drawTexture=function(e,n,a){var i=n.texture,r=(i||{}).image;if(!r||r.width<1||r.height<1)console.warn("DynamicAtlas: Texture image not found",i);else if(!r.data||r.data.width<1||r.data.height<1)console.warn("DynamicAtlas: Texture image data not found",r);else{var o=i.getId(),s=Lt.search(t.drawInfo,(function(e){return e.id===o}))||{x:-1,y:-1},c=s.x,u=s.y;if(!(c<0||u<0)){var l=e._innerTextureInfos[o];l||(a&&((r.width<=8||r.height<=8)&&(e._texture.drawTextureAt(r,c-1,u-1),e._texture.drawTextureAt(r,c-1,u+1),e._texture.drawTextureAt(r,c+1,u-1),e._texture.drawTextureAt(r,c+1,u+1)),e._texture.drawTextureAt(r,c-1,u),e._texture.drawTextureAt(r,c+1,u),e._texture.drawTextureAt(r,c,u-1),e._texture.drawTextureAt(r,c,u+1)),e._texture.drawTextureAt(r,c,u),e._count++,e._innerTextureInfos[o]={texture:i,x:c,y:u});var d=n.rect,h=d.x,f=d.y;h+=(null==l?void 0:l.x)||c,f+=(null==l?void 0:l.y)||u;var p={texture:e._texture,x:h,y:f};return e._innerSpriteFrames.push(n),p}t.pendingSprites[n.uuid]=n}},this.refreshComponents=function(e){var t,n=s(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.node.active&&(a.node.active=!1,a.node.active=!0)}}catch(e){n.e(e)}finally{n.f()}},this.isSameAtlas=function(e,t){if(!e||!t)return!1;var n=e.textures,a=t.textures;if(n.length!==a.length)return!1;var i=n.slice().sort((function(e,t){return e.id.localeCompare(t.id)})),r=a.slice().sort((function(e,t){return e.id.localeCompare(t.id)}));return i.every((function(e,t){var n=r[t],a=e.id,i=e.name,o=e.w,s=e.h,c=n||{},u=c.id,l=c.name,d=c.w,h=c.h;return!i||a===u&&(i===l&&o===d&&s===h)}))}}return n(e,[{key:"init",value:function(){Tt&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:Tt}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){d.on(P.UPGRADE_DYNAMIC_ATLAS,this.requestUpdateDynamicAtlas),It.on(kt.SWITCH_SCENE,this.resetPendingSprites),It.on(kt.SCENE_LAUNCHED,this.requestUpdateDynamicAtlas),It.catchUp(kt.GAME_READY,this.setupRenderListeners)}},{key:"handleLaggyFrame",value:function(e){console.warn("DynamicAtlas: Laggy frame detected, render time: ".concat(e.toFixed(2),"ms")),this.isEffective||(this.renderTimeInterval=Math.min(this.renderTimeInterval+1e3,1e4),console.warn("DynamicAtlas: Atlas update not effective. Increased interval: ".concat(this.renderTimeInterval,"ms"))),this.requestUpdateDynamicAtlas()}},{key:"getMeanRenderTime",value:function(){var e,t=0,n=s(this.renderTimes);try{for(n.s();!(e=n.n()).done;){t+=e.value}}catch(e){n.e(e)}finally{n.f()}return t/=this.renderTimes.length,this.renderTimes=[],t}},{key:"overrideDynamicAtlas",value:function(){var e=this,t=S.instance;S.instance.insertSpriteFrame=function(n){if(t._atlasIndex>=t._maxAtlasCount)return null;if(!n||n.original)return console.warn("DynamicAtlas: Skip original texture",n),null;if(!n.packable)return console.warn("DynamicAtlas: Skip non-packable texture",n),null;var a=e.getAtlas(),i=a?a.insertSpriteFrame(n):null;return!i&&t._atlasIndex<t._maxAtlasCount&&(i=(a=e.getAtlas())?a.insertSpriteFrame(n):null),i}}},{key:"createAtlas",value:function(){return S.instance.newAtlas()}},{key:"getAtlas",value:function(){var e=this,t=S.instance,n=t._atlases,a=void 0===n?[]:n,i=t._atlasIndex,r=t.textureBleeding,o=a[i];return o||(o=this.createAtlas()),o?(o.originalInsertSpriteFrame||(o.originalInsertSpriteFrame=o.insertSpriteFrame,o.insertSpriteFrame=function(t){return e.drawTexture(o,t,r)}),this.atlasTexId=o._texture.getId(),o):null}},{key:"collectPackageInfo",value:function(){var e,t=Nt.vals(this.pendingSprites),n={},a=s(t);try{for(a.s();!(e=a.n()).done;){var i=e.value;if(this.isValidSpriteFrame(i)){var r=i.texture,o=i.original,c=r.getId(),u=null==o?void 0:o._texture.getId();if(c!==u){u&&(c=u),this.collectInfo[c]||this.initializeCollectInfo(c,i);var l=this.collectInfo[c];l&&(l.usageCount++,n[c]=l)}else console.warn("DynamicAtlas: Skip original texture",{texId:c,oriTexId:u})}}}catch(e){a.e(e)}finally{a.f()}return n}},{key:"isValidSpriteFrame",value:function(e){var t=e.packable,n=e.texture,a=e.original,i=e.name,r=e.uuid;if(!t)return console.warn("DynamicAtlas: Skip non-packable texture",i,r),!1;if(!(n instanceof R))return console.warn("DynamicAtlas: Skip non-texture2d texture",i,r),!1;var o=null==a?void 0:a._texture.getId();return this.atlasTexId!==o||(console.warn("DynamicAtlas: Skip texture in atlas",i,r),!1)}},{key:"initializeCollectInfo",value:function(e,t){var n=t.texture,a=t.original,i=t.uuid,r=n.width,o=n.height,s=(null==a?void 0:a._texture)||{width:0,height:0},c=s.width,u=s.height,l=Math.max(r,c)+2,d=Math.max(o,u)+2;l<=1||d<=1?console.warn("DynamicAtlas: Skip invalid texture size",i,{w:l,h:d}):this.collectInfo[e]={id:e,w:l,h:d,x:-1,y:-1,usageCount:0,name:i}}},{key:"updateAtlasData",value:function(){if(!this.atlasInfo)return!1;if(this.lastAtlasInfo&&!this.forceUpdateDynamicAtlas){var e=this.isSameAtlas(this.lastAtlasInfo,this.atlasInfo);if(this.isEffective=!e,e)return console.warn("DynamicAtlas: Last update dynamic atlas is not effective"),!1}console.info("DynamicAtlas: atlas info",this.atlasInfo);var t=this.getAtlas();if(!t||!t._texture)return!1;var n=this.atlasInfo.packedInfo,a=t._texture,i={width:a.width,height:a.height},r=n.width+20,o=n.height+20,s=Math.max(r,o),c=Rt?s:r,u=i.width!==c||i.height!==c;return console.info("DynamicAtlas: Update atlas data",{currentSize:i,newSize:c,needsResize:u}),!!u&&(S.instance.reset(),!(!(t=this.getAtlas())||!t._texture)&&(Rt?(t._texture.initWithSize(c,c),console.info("DynamicAtlas: Resize atlas (PO2)",c,t)):(t._texture.initWithSize(r,o),console.info("DynamicAtlas: Resize atlas",r,o,t)),this.lastAtlasInfo=Mt.clone(this.atlasInfo),!0))}}]),e}();l._RF.pop(),l._RF.push({},"81e1aXDH2JE1q8DSm4X60UW","renderCustomResultChallenge",void 0);var Ot=GameCore,Bt=Ot.Configs,Ut=Ot.Utils.Object,Gt=Bt.FrameCapture,Vt=Gt.Enabled,zt=Gt.WideframeConfigs,Ht="./public/wideframes",qt=function(){var e=i((function*(e){if(!Vt)return console.warn("FrameCapture is not enabled"),null;var t=Wt(e);if(!t)return null;jt(t,e,zt.CustomResultChallenge);var n=window.game.frameCapture,a=zt.CustomResultChallenge,i=a.Width,r=a.Height;return n.captureAsync({name:"ResultChallenge",width:i,height:r,renderOptions:t})}));return function(t){return e.apply(this,arguments)}}(),Wt=function(e){try{var t=e.playerId,n=void 0===t?"10":t,a=e.playerPhoto,i=void 0===a?"":a,r=e.playerScore,o=void 0===r?0:r,s=e.opponentId,c=void 0===s?"20":s,u=e.opponentPhoto,l=void 0===u?"":u,d=e.opponentScore,h=void 0===d?0:d,f=e.isPlayerFinished,p=e.isOpponentFinished,v=zt.CustomResultChallenge.RenderOptions,y=Ut.clone(v);if(!y)return null;var m=Ut.clear(y),g=Ut.camelCaseKeys(m),E=g.playerPhoto,S=g.opponentPhoto,w=o===h,A=o>h,_=f&&p;"image"===E.type&&(E.name="".concat(n),E.image=i),"image"===S.type&&(S.name="".concat(c),S.image=l);var b=Kt(_,A,w);return Qt(g,e),Yt(g,b),Zt(g,b),g}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},jt=function(e,t,n){var a=n.Width,i=n.Height,r=t.isPlayerFinished,o=t.isOpponentFinished,s=r||o?"result-challenge":"custom-result-challenge";e.wideframe={name:s,type:"image",depth:0,image:"".concat(Ht,"/").concat(s,".png"),size:[a,i],position:[0,0]}},Kt=function(e,t,n){return e?n?"draw":t?"win":"lose":"none"},Qt=function(e,t){var n=e.leftScore,a=e.rightScore,i=t.playerScore,r=void 0===i?0:i,o=t.opponentScore,s=void 0===o?0:o,c=t.isPlayerFinished,u=t.isOpponentFinished;(c||u)&&("text"===(null==n?void 0:n.type)&&(n.text=c?"".concat(r):""),"text"===(null==a?void 0:a.type)&&(a.text=u?"".concat(s):""))},Yt=function(e,t){if("none"!==t){e.MiddleImage={name:"middle-image",type:"image",depth:2,size:[92,63],position:[80,65],image:"".concat(Ht,"/").concat(t,".png")};var n={win:{size:[277,144],position:[337.5,174]},lose:{size:[326,145],position:[313,173.5]},draw:{size:[390,144],position:[281,174]}};e.MiddleImage={name:"middle-image",type:"image",depth:2,size:n[t].size,position:n[t].position,image:"".concat(Ht,"/images/").concat(t,".png")}}},Zt=function(e,t){if("none"!==t&&"draw"!==t){e.Crown={name:"crown-icon",type:"image",depth:2,size:[92,63],position:{win:[80,80],lose:[775,80]}[t],image:"".concat(Ht,"/images/crown-icon.png")}}};l._RF.pop(),l._RF.push({},"5cf47s8lohMlZGIaMKBpDK0","FrameCapture",void 0);var Xt=globalThis.game.frameCapture,Jt=function(){function e(){a(this,e)}var t;return n(e,[{key:"init",value:(t=i((function*(){Xt.addWideframeRender("renderResultChallenge",qt),Xt.addWideframeRender("renderShareScore",Y)})),function(){return t.apply(this,arguments)})}]),e}();l._RF.pop(),l._RF.push({},"2f36c+IsKJAU5s61TqQdaJ6","HybridFileCache",void 0);var $t=GameCore,en=$t.Events,tn=$t.Configs.GameEngine.HybridFileCache,nn=tn.Enabled,an=tn.PreviewMode,rn=tn.BuildMode,on=$t.Utils,sn=on.Object,cn=on.Function,un=on.Json,ln=globalThis.game,dn=ln.event,hn=ln.storage,fn=ln.getBuildVersion,pn=l.internal.CCON,vn=(l.resources,l.Material),yn=l.builtinResMgr,mn=p.instance,gn=mn.downloader,En=mn.fetchPipeline,Sn=function(){function e(){var t=this;a(this,e),this.supportTypes=[],this.bundledFiles={},this.originDownloaders={},this.checkCacheVersion=function(){var e=fn().toString(),n=hn.getStorageData("HybridFileCache","buildVersion");hn.setStorageData("HybridFileCache","buildVersion",e),n!==e?t.clearCache():hn.updateToWebStorage("HybridFileCache")},this.downloadFile=function(e){return function(n,a,i){var r=t.getCache(e,n);if(r)return i(null,r);var o=t.getDownloader(e);if(!o)return i(new Error("Downloader not found"),null);o(n,a,(function(a,r){return!a&&t.setCache(e,n,r),i(a,r)}))}},this.clearCache=function(){hn.setStorageData("HybridFileCache","cachedFiles",{}),hn.setStorageData("HybridFileCache","cachedBundles",{}),hn.setStorageData("HybridFileCache","cachedExtensions",{}),hn.updateToWebStorage("HybridFileCache")}}var t,o,u,l,h;return n(e,[{key:"init",value:(h=i((function*(){nn&&!Q?(yield this.initStorage(),this.checkCacheVersion(),this.initSupportedTypes(),this.setupOptimalPipelines(),this.saveOriginDownloaders(),this.registerCustomDownloader(),this.setupBundledFiles(),this.listenEvents(),console.info("Hybrid File Cache: Initialized",{supportTypes:this.supportTypes})):dn.emit(en.BUNDLE_READY)})),function(){return h.apply(this,arguments)})},{key:"initStorage",value:(l=i((function*(){yield hn.addStorage("HybridFileCache",{buildVersion:"0",cachedFiles:{},cachedBundles:{},cachedExtensions:{}},!0)})),function(){return l.apply(this,arguments)})},{key:"initSupportedTypes",value:function(){this.supportTypes=rn.SupportedExtensions}},{key:"setupBundledFiles",value:(u=i((function*(){try{var e,t=[],n=s(this.supportTypes);try{for(n.s();!(e=n.n()).done;){var a=e.value;this.getCachedBundles(a)||t.push(this.downloadBundledFile(a))}}catch(e){n.e(e)}finally{n.f()}t.length>0&&(yield cn.allSettled(t))}finally{dn.emit(en.BUNDLE_READY)}})),function(){return u.apply(this,arguments)})},{key:"downloadBundledFile",value:(o=i((function*(e){try{var t=e.replace(".",""),n="./cache/bundle".concat(t.toUpperCase(),".").concat(t);"bundle"===e&&(n="./cache/bundleBUNDLE.json");var a=yield fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}}),i=yield a.json();this.setBundledCache(e,i)}catch(t){console.error("Hybrid File Cache: Downloaded bundled file",{type:e,error:t})}})),function(e){return o.apply(this,arguments)})},{key:"loadBundles",value:(t=i((function*(){var e=this;try{if(!this.supportTypes.includes("bundle"))return;for(var t=[],n=function*(){var n=i[a],r=new Promise((function(t,a){try{var i=e.getBundledCache("bundle","config:".concat(n));if(!i)return a(new Error("Bundle cache not found"));console.log("Hybrid File Cache: Load bundle",{bundleCache:i}),i.base="assets/".concat(n,"/");var r=F.getBundle(n);r||(r=new p.Bundle),r.init(i),F.bundles.add(n,r),console.log("Hybrid File Cache: bundle added",{name:n,bundle:r}),e.loadBundleAssets(n,r).then(t).catch(a)}catch(e){console.error("Hybrid File Cache: Load bundle assets",{name:n,error:e}),a(e)}}));t.push(r)},a=0,i=["internal","main","resources"];a<i.length;a++)yield*n();yield cn.allSettled(t)}catch(e){console.error("Hybrid File Cache: loadBundleAssets",{error:e})}})),function(){return t.apply(this,arguments)})},{key:"loadBundleAssets",value:function(e,t){return new Promise((function(n,a){if(F.loadAny({url:e},{preset:"bundle",ext:"bundle",__isNative__:!0},(function(t,i){t?(console.warn("Hybrid File Cache: Load bundle assets",{name:e,err:t}),a(t)):console.log("Hybrid File Cache: Load bundle assets",{name:e,assets:i}),"internal"!==e&&n(i)})),"internal"!==e)return n([]);var i=Object.values(t.config.paths.map);console.log("Hybrid File Cache: Load internal assets",{bundle:t,paths:i});var r=i.map((function(e){return e[0].uuid}));if(r.length<1)return n([]);yn._materialsToBeCompiled=[],F.loadAny(r,{},(function(e,t){if(e)console.warn("Hybrid File Cache: Load internal assets",{err:e}),a(e);else{console.log("Hybrid File Cache: Load internal assets",{assets:t});var i,r=s(t);try{for(r.s();!(i=r.n()).done;){var o=i.value;yn.addAsset(o.name,o),(o instanceof vn||Array.isArray(o.passes))&&yn._materialsToBeCompiled.push(o)}}catch(e){r.e(e)}finally{r.f()}yn.compileBuiltinMaterial()}n(t)}))}))}},{key:"setupOptimalPipelines",value:function(){var e=this;if(an.Enabled&&an.CacheUuidExtension){En.insert((function(t,n){t.output=t.input;for(var a=0;a<t.input.length;a++){var i=t.input[a];if(i.uuid&&!i.isNative){var r=e.getCacheExtension(i.uuid);r&&(i.ext===r&&(i.overrideUuid="cached"),i.isNative=!0,i.isCached=!0,i.url=i.url.replace(i.ext,r),i.ext=r,console.log("Hybrid File Cache: check cache extension",{item:i,cachedExt:r}))}}n()}),1),En.insert((function(t,n){t.output=t.input;for(var a=0;a<t.input.length;a++){var i=t.input[a];i.uuid&&(i.isCached?(i.isNative=!1,i.overrideUuid=""):i.isNative||(console.log("Hybrid File Cache: set cache extension",{item:i}),e.setCacheExtension(i.uuid,i.ext)))}n()}),3)}}},{key:"saveOriginDownloaders",value:function(){var e,t=s(this.supportTypes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.originDownloaders[n]=gn._downloaders[n]}}catch(e){t.e(e)}finally{t.f()}}},{key:"registerCustomDownloader",value:function(){var e,t=s(this.supportTypes);try{for(t.s();!(e=t.n()).done;){var n=e.value;"bundle"!==n&&gn.register(n,this.downloadFile(n))}}catch(e){t.e(e)}finally{t.f()}}},{key:"listenEvents",value:function(){dn.on(en.SCENE_LOADED,(function(){hn.updateToWebStorage("HybridFileCache")})),d.on(P.CLEAR_HYBRID_FILE_CACHE,this.clearCache)}},{key:"getDownloader",value:function(e){var t;return null!==(t=this.originDownloaders[e])&&void 0!==t?t:null}},{key:"getCacheKey",value:function(e,t){var n=t.match(/.*\/([-a-z0-9@]+)\.([^\.]+)$/);if(!n)return null;var a=r(n,3),i=(a[0],a[1]),o=a[2];return!o||e.indexOf(o)<0?null:"".concat(i,":").concat(e)}},{key:"validateDataType",value:function(e,t){Array.isArray(t)&&sn.hasOwn(t[0],"__type__");return!(".cconb"===e&&sn.hasOwn(t,"chunks")&&!(Array.isArray(t.chunks)&&t instanceof pn))||(console.warn("Hybrid File Cache: Invalid cconb",{type:e,data:t}),!1)}},{key:"encodeData",value:function(e,t){return".cconb"===e?sn.hasOwn(t,"_document")&&sn.hasOwn(t,"_chunks")?new pn(t._document,t._chunks):null:un.clone(t)}},{key:"decodeData",value:function(e,t){if(".cconb"===e){if(!sn.hasOwn(t,"_document")||!sn.hasOwn(t,"_chunks"))return null;if(!Array.isArray(t._chunks))return null;for(var n=[],a=0,i=t._chunks;a<i.length;a++){var r=i[a];r instanceof Uint8Array?n.push(r):n.push(new Uint8Array(Object.values(r)))}return new pn(t._document,n)}return un.clone(t)}},{key:"setCache",value:function(e,t,n){var a=this.getCacheKey(e,t);if(a&&this.validateDataType(e,n)){var i=this.encodeData(e,n);hn.setStorageData("HybridFileCache","cachedFiles",c({},a,i))}}},{key:"getCache",value:function(e,t){var n=this.getCacheKey(e,t);if(!n)return null;var a=this.getFileCaches()[n];return a||(a=this.getBundledCache(e,n)),a?this.decodeData(e,a):(console.warn("Hybrid File Cache: Cache not found",{cacheKey:n,type:e,url:t}),null)}},{key:"getFileCaches",value:function(){var e;return null!==(e=hn.getStorageData("HybridFileCache","cachedFiles"))&&void 0!==e?e:{}}},{key:"getCachedBundles",value:function(e){var t=hn.getStorageData("HybridFileCache","cachedBundles");if(!t)return null;var n=t[e];return n?(this.bundledFiles[e]=n,n):null}},{key:"getBundledCache",value:function(e,t){var n,a=this.bundledFiles[e];return a&&null!==(n=a[t.replace(":".concat(e),"")])&&void 0!==n?n:null}},{key:"setBundledCache",value:function(e,t){this.bundledFiles[e]=t,hn.setStorageData("HybridFileCache","cachedBundles",c({},e,t))}},{key:"getCacheExtension",value:function(e){return this.getCachedExtensions()[e]}},{key:"setCacheExtension",value:function(e,t){hn.setStorageData("HybridFileCache","cachedExtensions",c({},e,t))}},{key:"getCachedExtensions",value:function(){var e;return null!==(e=hn.getStorageData("HybridFileCache","cachedExtensions"))&&void 0!==e?e:{}}}]),e}();l._RF.pop(),l._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var wn=GameCore,An=wn.Events,_n=wn.Utils,bn=_n.Array,Cn=_n.Browser,kn=wn.Configs.Languages.DetectPlayerLocale,Dn=globalThis.game,Rn=Dn.player,Tn=Dn.event,Fn=Dn.language,Ln=Dn.monitorError,Mn=Object.keys(Z),Nn=function(){function e(){var t=this;a(this,e),this.handlePreloadLanguage=function(){var e=i((function*(e){var n=e.locale,a=e.onLoad,i=e.onError;if(t.isSupportedLocale(n))try{yield t.addLanguage(n),null==a||a(n)}catch(e){var r=t.toError(e,"handleLanguageRequested");console.error(r),null==Ln||Ln.sendException(r),null==i||i(e)}else console.warn("Preload language ".concat(n," not found"))}));return function(t){return e.apply(this,arguments)}}(),this.handleChooseLanguage=function(e){var n=e.locale,a=e.saveToPlayerData,i=void 0!==a&&a;if(t.isSupportedLocale(n))try{t.setLanguage(n,i)}catch(e){var r=t.toError(e,"handleLanguageRequested");console.error(r),null==Ln||Ln.sendException(r)}else console.warn("Choose language ".concat(n," not found"))},this.handleLanguageRequested=function(){var e=i((function*(e){var n=e.locale,a=e.saveToPlayerData,i=void 0!==a&&a,r=e.onLoad,o=e.onError;if(!t.isSupportedLocale(n))return console.warn("Request language ".concat(n," not found")),void(null==o||o(new Error("Language ".concat(n," not found"))));try{yield t.addLanguage(n),null==r||r(n),t.setLanguage(n,i)}catch(e){var s=t.toError(e,"handleLanguageRequested");console.error(s),null==Ln||Ln.sendException(s),null==o||o(s)}}));return function(t){return e.apply(this,arguments)}}()}var t,r,o,s,c;return n(e,[{key:"init",value:(c=i((function*(){try{yield this.initFallbackLanguage(),this.listenEvent(),yield this.initPlayerLanguage()}catch(t){var e=this.toError(t,"handleLanguageRequested");console.error(e),null==Ln||Ln.sendException(e)}})),function(){return c.apply(this,arguments)})},{key:"initFallbackLanguage",value:(s=i((function*(){yield this.addLanguage("en",!0),this.setLanguage("en")})),function(){return s.apply(this,arguments)})},{key:"initPlayerLanguage",value:(o=i((function*(){var e,t=this.getPlayerLanguage();if(!t||!this.isSupportedLocale(t))return console.warn("Language ".concat(t," not supported. Overriding with default language")),void this.setLanguage("en",!0);yield this.addLanguage(t);var n=null!==(e=Rn.getPlayerDataByKey("isFirstLogin"))&&void 0!==e&&e;this.setLanguage(t,n)})),function(){return o.apply(this,arguments)})},{key:"getPlayerLanguage",value:function(){var e,t=this.getBrowserLanguage();return Rn.getPlayerDataByKey("isFirstLogin")?t:null!==(e=Rn.getPlayerSetting("language"))&&void 0!==e?e:t}},{key:"getBrowserLanguage",value:function(){if(!1===kn)return"en";var e=Cn.getLocale(),t=null==e?void 0:e.trim();return null==t?void 0:t.split(/[-_]/)[0]}},{key:"isSupportedLocale",value:function(e){return bn.has(Mn,e)}},{key:"listenEvent",value:function(){Tn.on(An.REQUEST_LANGUAGE,this.handleLanguageRequested),d.on(An.REQUEST_LANGUAGE,this.handleLanguageRequested),d.on(P.PRELOAD_LANGUAGE,this.handlePreloadLanguage),d.on(P.CHOOSE_LANGUAGE,this.handleChooseLanguage)}},{key:"addLanguage",value:(r=i((function*(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=yield this.getLangData(e);Fn.add(e,n,t)})),function(e){return r.apply(this,arguments)})},{key:"setLanguage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Fn.choose(e),t){var n=Rn.getPlayerSettings(),a=u(u({},n),{},{language:e});Rn.setPlayerDataByName("settings",a)}}},{key:"getLangData",value:(t=i((function*(e){var t=yield X.loadJsonAsync(Z[e]);if(null===t)throw new Error("Language ".concat(e," not found"));return t})),function(e){return t.apply(this,arguments)})},{key:"toError",value:function(e,t){return e instanceof Error?e:"string"==typeof e?new Error("LanguagePlugin: ".concat(e)):new Error("LanguagePlugin: Unknown error in module: <".concat(t,">"))}}]),e}();l._RF.pop(),l._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var xn=GameCore,In=xn.Configs,Pn=In.Mockup,On=Pn.Leaderboards,Bn=Pn.GameSDK.Player,Un=In.Leaderboards,Gn=xn.Utils.Number,Vn=globalThis.game.leaderboard,zn=function(){function e(){var t=this;a(this,e),this.handleWhenGameSDKStarted=function(){On.Enabled?t.setupLeaderboardsMockup():t.setupLeaderboards()}}var t,r,o,s,c;return n(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(c=i((function*(){this.setupLeaderboardByConfigs()})),function(){return c.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var e=Un.LeaderboardId;e?(Vn.addLeaderboard({name:J.GLOBAL,type:"global",autoSortRank:!0,leaderboardId:e}),Vn.addLeaderboard({name:J.FRIENDS,type:"friends",autoSortRank:!0,leaderboardId:e})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(s=i((function*(){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard()})),function(){return s.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(o=i((function*(){var e=J.GLOBAL,t=ee.GLOBAL,n=On.NumOfLeaders,a=yield Vn.createLeaderboardAsync({_id:t,name:e,numberOfLeaders:Gn.random(n.Max-n.Min)+n.Min});Vn.addLeaderboard({name:e,type:"global",autoSortRank:!0,leaderboardId:a}),yield Vn.requestLeaderboardAsync(e,10);var i=Vn.getLeaderboard(e);console.info("setupGlobalLeaderboard fetch new",i,i&&Object.keys(i.leaders).length),i=Vn.getLeaderboard(e),console.info("setupGlobalLeaderboard load more",i,i&&Object.keys(i.leaders).length)})),function(){return o.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(r=i((function*(){var e=J.FRIENDS,t=ee.FRIENDS,n=0,a=Bn.ConnectedPlayers;a.Enabled&&(n=Gn.random(a.NumOfPlayers-1)+1);var i=yield Vn.createLeaderboardAsync({_id:t,name:e,numberOfLeaders:n});Vn.addLeaderboard({name:e,type:"friends",autoSortRank:!0,leaderboardId:i}),yield Vn.requestLeaderboardAsync(e,10);var r=Vn.getLeaderboard(e);console.info("setupFriendsLeaderboard done",r)})),function(){return r.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(t=i((function*(){var e=yield $.requestTournamentDataAsync();e.forEach((function(e){var t=e.payload.leaderboardId;t&&(Vn.isExistLeaderboardId(t)||Vn.addLeaderboard({type:"tournament",name:t,autoSortRank:!0,leaderboardId:t}))})),console.info("setupGlobalTournamentLeaderboard done",e)})),function(){return t.apply(this,arguments)})}]),e}();l._RF.pop(),l._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var Hn=GameCore,qn=Hn.Utils,Wn=Hn.Events,jn=Hn.Configs.PerformanceMonitor.FpsTracking,Kn=globalThis.game.event,Qn=function(){function e(){var t=this;a(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){t.startTraceFps(),v.on(_.EVENT_AFTER_UPDATE,t.handleLateUpdate)},this.handleLateUpdate=function(){if(t.mark){if(t.fpsTraceDuration-=d.deltaTime,t.fpsTraceDuration<=0&&!t.traceStopped)return t.traceStopped=!0,t.unListenEvents(),t.updateFPS(),void t.mark.stop(t.markName);t.fpsTraceIntervalTimer-=d.deltaTime,t.fpsTraceIntervalTimer>0||(t.fpsTraceIntervalTimer=t.fpsTraceInterval,t.updateFPS(),t.mark.stop(t.markName),t.startTraceFps())}}}return n(e,[{key:"mark",get:function(){return jn.Enabled?qn.Mark:null}},{key:"init",value:function(){var e=jn.TrackingDuration,t=jn.TrackingInterval;this.fpsTraceDuration=null!=e?e:60,this.fpsTraceInterval=null!=t?t:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){Kn.catchUp(Wn.GAME_READY,this.handleStartTraceFps)}},{key:"unListenEvents",value:function(){v.off(_.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var e,t;if(this.mark){var n=this.getFPS(),a=this.getDrawCalls(),i=this.getDeviceRender(),r=this.getTextureMemory();this.minFps=Math.min(null!==(e=this.minFps)&&void 0!==e?e:n,n),this.maxFps=Math.max(null!==(t=this.maxFps)&&void 0!==t?t:0,n),this.mark.putMetric(this.markName,"FPS Metric",n),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",i),this.mark.putAttr(this.markName,"Draw Calls",a.toString()),this.mark.putAttr(this.markName,"Texture Memory",r.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info("FPS: ".concat(n," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(a,", texture memory: ").concat(r.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!v.root)return 0;var e=v.root.fps;return Math.floor(e)||0}},{key:"getDrawCalls",value:function(){return v.root&&v.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return v.root&&v.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return v.root&&v.root.device.memoryStatus.textureSize/1048576||0}}]),e}();l._RF.pop(),l._RF.push({},"d5789HUcoJBYr7E3NOGuQyN","Profiler",void 0);var Yn=GameCore,Zn=Yn.Utils.Valid,Xn=Yn.Configs.Debugger.Profiler,Jn=globalThis.game.event,$n=function(){function e(){var t=this;a(this,e),this.isUpdated=!1,this.isPost=!1,this.isDrawn=!1,this.isCommitted=!1,this.isRendered=!1,this.isFramed=!1,this.waitOptions={timeout:0,checkInterval:1},this.initState=function(){t.isFramed=!1,t.isUpdated=!1,t.isDrawn=!1,t.isCommitted=!1,t.isRendered=!1,t.isPost=!1},this.startTraceLoop=function(){t.clearLoopEvents(),t.initState(),t.useTickAsync(),t.listenLoopEvents()},this.handleBeginFrame=function(){t.measure("Frame",t.processBeginFrame)},this.processBeginFrame=i((function*(){t.isFramed=!1,console.time("Frame"),yield Zn.isValueChangeAsync((function(){return t.isFramed}),!0,t.waitOptions),console.timeEnd("Frame")})),this.handleBeforeUpdate=function(){t.measure("Update",t.processBeforeUpdate)},this.processBeforeUpdate=i((function*(){t.isUpdated=!1,console.time("Update"),yield Zn.isValueChangeAsync((function(){return t.isUpdated}),!0,t.waitOptions),console.timeEnd("Update")})),this.handleAfterUpdate=function(){t.isUpdated=!0},this.handleBeforeDraw=function(){t.measure("Draw",t.processBeforeDraw)},this.processBeforeDraw=i((function*(){t.isDrawn=!1,console.time("Draw"),yield Zn.isValueChangeAsync((function(){return t.isDrawn}),!0,t.waitOptions),console.timeEnd("Draw")})),this.handleBeforeCommit=function(){t.measure("Commit",t.processBeforeCommit)},this.processBeforeCommit=i((function*(){t.isCommitted=!1,console.time("Commit"),yield Zn.isValueChangeAsync((function(){return t.isCommitted}),!0,t.waitOptions),console.timeEnd("Commit")})),this.handleBeforeRender=function(){t.isCommitted=!0,t.measure("Render",t.processBeforeRender)},this.processBeforeRender=i((function*(){t.isRendered=!1,console.time("Render"),yield Zn.isValueChangeAsync((function(){return t.isRendered}),!0,t.waitOptions),console.timeEnd("Render")})),this.handleAfterRender=function(){t.isRendered=!0},this.handleAfterDraw=function(){t.isDrawn=!0,t.measure("Post",t.processPost)},this.processPost=i((function*(){t.isPost=!1,console.time("Post"),yield Zn.isValueChangeAsync((function(){return t.isPost}),!0,t.waitOptions),console.timeEnd("Post")})),this.handleEndFrame=function(){t.isPost=!0,t.isFramed=!0,t.restoreTick()}}var t,r;return n(e,[{key:"profiler",get:function(){return globalThis.game.profiler}},{key:"init",value:function(){Xn.Enabled&&(this.initState(),this.addTickAsync(),this.listenEvents())}},{key:"addTickAsync",value:function(){var e=this;v.originalTick=v.tick,v.tickAsync=function(){var t=i((function*(t){var n;if(!this._invalid){if(yield e.emitAsync(_.EVENT_BEGIN_FRAME),!this._paused){yield e.emitAsync(_.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(t);for(var a=0;a<this._systems.length;++a)this._systems[a].update(t);this._compScheduler.lateUpdatePhase(t),yield e.emitAsync(_.EVENT_AFTER_UPDATE),L._deferredDestroy();for(var i=0;i<this._systems.length;++i)this._systems[i].postUpdate(t)}yield e.emitAsync(_.EVENT_BEFORE_DRAW);var r=null===(n=v.getScene())||void 0===n?void 0:n.getComponentsInChildren("UIRenderer");if(r){var o,c=s(r);try{for(c.s();!(o=c.n()).done;){o.value.updateRenderer()}}catch(e){c.e(e)}finally{c.f()}this._root.frameMove(t),yield e.emitAsync(_.EVENT_AFTER_DRAW),M.resetHasChangedFlags(),M.clearNodeArray(),yield e.emitAsync(_.EVENT_END_FRAME),this._totalFrames++}}}));return function(e){return t.apply(this,arguments)}}()}},{key:"emitAsync",value:(r=i((function*(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];yield this.waitEvent.apply(this,[e].concat(n)),v.emit.apply(v,[e].concat(n));var i,r=this.getListeners(e),o=s(r);try{for(o.s();!(i=o.n()).done;){var c=i.value;c.check=c.originalCheck}}catch(e){o.e(e)}finally{o.f()}})),function(e){return r.apply(this,arguments)})},{key:"useTickAsync",value:function(){v.tick=v.tickAsync}},{key:"restoreTick",value:function(){v.tick=v.originalTick}},{key:"getListeners",value:function(e){return v._callbackTable[e].callbackInfos||[]}},{key:"waitEvent",value:(t=i((function*(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var i=this.getListeners(e);if(0!==i.length){var r=i.map((function(t){var a=t.target,i=t.callback;return t.originalCheck||(t.originalCheck=t.check),t.check=function(){return!1},new Promise((function(t){var r="Wait ".concat(e," (").concat(a,":").concat(i.name,")");console.time(r),a?i.call.apply(i,[a].concat(n)):i.apply(void 0,n),t(!0),console.timeEnd(r)}))}));return Promise.all(r)}})),function(e){return t.apply(this,arguments)})},{key:"listenEvents",value:function(){Jn.on("render",this.startTraceLoop)}},{key:"listenLoopEvents",value:function(){v.once(_.EVENT_BEGIN_FRAME,this.handleBeginFrame),v.once(_.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),v.once(_.EVENT_AFTER_UPDATE,this.handleAfterUpdate),v.once(_.EVENT_BEFORE_DRAW,this.handleBeforeDraw),v.once(_.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),v.once(_.EVENT_BEFORE_RENDER,this.handleBeforeRender),v.once(_.EVENT_AFTER_RENDER,this.handleAfterRender),v.once(_.EVENT_AFTER_DRAW,this.handleAfterDraw),v.once(_.EVENT_END_FRAME,this.handleEndFrame)}},{key:"clearLoopEvents",value:function(){v.off(_.EVENT_BEGIN_FRAME,this.handleBeginFrame),v.off(_.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),v.off(_.EVENT_AFTER_UPDATE,this.handleAfterUpdate),v.off(_.EVENT_BEFORE_DRAW,this.handleBeforeDraw),v.off(_.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),v.off(_.EVENT_BEFORE_RENDER,this.handleBeforeRender),v.off(_.EVENT_AFTER_RENDER,this.handleAfterRender),v.off(_.EVENT_AFTER_DRAW,this.handleAfterDraw),v.off(_.EVENT_END_FRAME,this.handleEndFrame)}},{key:"measure",value:function(e,t){var n,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];null===(n=this.profiler)||void 0===n||n.measureCode({name:e,isAsync:a,profile:e,callback:t})}}]),e}();l._RF.pop(),l._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var ea=GameCore.Events,ta=globalThis.game.event,na=function(){function e(){a(this,e),this.handleHotReload=function(){d.restart()},this.handleUpdateConfig=function(e){if("Gameplay"===e.type){d.emit(P.GAMEPLAY_UPDATE_CONFIG,e.config);var t=e.id,n=e.type;ta.emit(ea.REMOTE_CONFIG_UPDATED,{id:t,type:n})}}}return n(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){ta.on(ea.REQUEST_HOT_RELOAD,this.handleHotReload),ta.on(ea.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();l._RF.pop(),l._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var aa=function(){function e(){a(this,e)}return n(e,[{key:"init",value:function(){this.initHybridFileCache(),console.info("Plugins Manager: Initialized")}},{key:"initProfiler",value:function(){(new $n).init()}},{key:"initLanguages",value:function(){(new Nn).init()}},{key:"initCocosStats",value:function(){(new pt).init()}},{key:"initLeaderboards",value:function(){(new zn).init()}},{key:"initRemoteConfig",value:function(){(new na).init()}},{key:"initDynamicAtlas",value:function(){(new Pt).init()}},{key:"initDynamicAssets",value:function(){(new bt).init()}},{key:"initHybridFileCache",value:function(){(new Sn).init()}},{key:"initCanvasRecorder",value:function(){(new ft).init()}},{key:"initPerformanceMonitor",value:function(){(new Qn).init()}},{key:"initAdaptivePerformance",value:function(){(new dt).init()}},{key:"initFrameCapture",value:function(){(new Jt).init()}}]),e}();l._RF.pop(),l._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var ia=globalThis.game,ra=ia.event,oa=ia.monitorError,sa=GameCore,ca=sa.Events,ua=sa.Configs.PerformanceMonitor,la=sa.Utils.Mark,da=function(){function e(){var t=this;a(this,e),this.markName="Load Scene",this.testScene={},this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var e=i((function*(e){var n=e.sceneName,a=e.sceneData,i=t.correctSceneName(n);console.info("Switching",i,null!=a?a:{}),i&&(te.showLoadingFullScreen(i),t.startScene({sceneName:i,sceneData:a}))}));return function(t){return e.apply(this,arguments)}}(),this.preloadScene=function(e,n){var a=e.sceneName;t.startMeasure(e),v.preloadScene(a,t.onSceneProgress,t.onScenePreloaded(a,n))},this.startMeasure=function(e){if(t.mark){var n=e.sceneName,a=e.startScene;t.queueLoadScene[n]&&(t.mark.putAttr(t.markName,"Canceled","true"),t.stopMeasure(n)),console.groupCollapsed("ðŸ“¦ ".concat(n,": ").concat(a?"start":"preload"," progress")),t.mark.measure(t.markName),t.mark.putAttr(t.markName,"Cancel","false"),t.mark.putAttr(t.markName,"Success","false"),t.mark.putMetric(t.markName,n),t.mark.start(t.markName),t.queueLoadScene[n]=!0}},this.stopMeasure=function(e){t.mark&&t.queueLoadScene[e]&&(t.mark.rmAttr(t.markName,"File"),t.mark.putAttr(t.markName,"Success","true"),t.mark.stop(t.markName),t.queueLoadScene[e]=!1,console.groupEnd())},this.onSceneProgress=function(e,n,a){var i=e/n;t.mark&&t.mark.putAttr(t.markName,"Last File","".concat(a.id," (").concat(a.ext,")"));var r=Math.floor(70*i+30);GameSDK.setLoadingProgress(r)},this.onScenePreloaded=function(e,t){return function(n){n?console.warn("SceneManager.onScenePreloaded",{sceneName:e,error:n}):(t&&t(e,n),ra.emit(ca.SCENE_LOADED,{sceneName:e,isPreload:!0}))}},this.onDirectorLoadScene=function(e){return function(n,a){if(n)console.warn("SceneManager.onSceneLoaded",n);else if(null!=a&&a.scene){var i=a.name;t.handleBeforeSceneLaunch(a,e)(),v.once(_.EVENT_AFTER_SCENE_LAUNCH,t.handleSceneLaunched(i,e))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(e,n){return function(){t.setSceneData(e,null!=n?n:{}),d.emit(P.REQUEST_VIEW_RESIZE),ra.emit(ca.SCENE_LOADED,{sceneName:e.name}),ra.clear(ca.MARK_IS_TEST_SCENE)}},this.handleSceneLaunched=function(e,n){return function(){var a;te.hideLoadingFullScreen(e),ne.switchSceneTracking(),null==oa||oa.addMetadata({currentScene:e}),null===(a=t.callbackSwitchScene)||void 0===a||a.call(t,{sceneName:e,sceneData:n}),ra.emit(ca.SCENE_LAUNCHED,{sceneName:e})}},this.handleSceneLoaded=function(e){var n=e.sceneName;t.stopMeasure(n)},this.setTestScene=function(e){var n=e.sceneName;t.testScene[n]=!0}}return n(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){ra.catchUp(ca.MARK_IS_TEST_SCENE,this.setTestScene),ra.on(ca.SWITCH_SCENE,this.switchScene),ra.on(ca.PRELOAD_SCENE,this.preloadScene),ra.on(ca.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(e){var t=this.getCurrentScene(),n=this.getTestScene();return n&&(null==t?void 0:t.name)!==n?n:t&&e===t.name?null:e}},{key:"startScene",value:function(e){var t=this,n=e.sceneName,a=e.sceneData;this.preloadScene({sceneName:n,startScene:!0},(function(e,i){e===n&&(i?console.warn("SceneManager.startScene",{sceneName:n,error:i}):v.loadScene(n,t.onDirectorLoadScene(a)))}))}},{key:"mark",get:function(){return ua.LoadResources?la:null}},{key:"getCurrentScene",value:function(){return v.getScene()}},{key:"getTestScene",value:function(){var e;return null!==(e=Object.keys(this.testScene)[0])&&void 0!==e?e:null}},{key:"onSwitchScene",value:function(e){this.callbackSwitchScene=e}},{key:"setSceneData",value:function(e,t){if(t&&("data"in e||e.scene.attr({data:{}}),"data"in e)){var n=e.data||{};e.scene.attr({data:u(u({},n),t)}),console.info("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:n})}}}]),e}();l._RF.pop(),l._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var ha=globalThis.game,fa=ha.event,pa=ha.monitorError,va=GameCore,ya=va.Events,ma=va.Utils,ga=ma.Object,Ea=ma.Valid,Sa=ma.Time,wa=function(){function e(){var t=this;a(this,e),this.screens={},this.queueInstantiatingScreens={},this.handleOpenScreen=function(e){var n=e.screenName,a=e.screenData;t.openScreen(n,a)},this.handleOpenedScreen=i((function*(){yield Sa.sleepAsync(1500),d.emit(P.UPGRADE_DYNAMIC_ATLAS)})),this.handleCloseScreen=function(e){var n=e.screenName;t.closeScreen(n)},this.handleClosedScreen=i((function*(){yield Sa.sleepAsync(800),d.emit(P.UPGRADE_DYNAMIC_ATLAS)})),this.handlePreloadScreens=function(){var e=v.getScene();e&&(t.initScreens(e),t.preloadScreens())}}var t,r,o,s;return n(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){fa.on(ya.OPEN_SCREEN,this.handleOpenScreen),fa.on(ya.OPENED_SCREEN,this.handleOpenedScreen),fa.on(ya.CLOSE_SCREEN,this.handleCloseScreen),fa.on(ya.CLOSED_SCREEN,this.handleClosedScreen),fa.on(ya.PRELOAD_SCREENS,this.handlePreloadScreens)}},{key:"initScreens",value:function(e){var t=e.getComponentsInChildren("BaseScreen");if(!Ea.isEmpty(t)){var n=t.map((function(e){return null==e?void 0:e.node.name})).join(", ");console.info("ðŸ“º Loaded Screens in ".concat(e.name,": ").concat(n)),this.addScreens(t)}var a=null==e?void 0:e.getComponentInChildren(ae);if(a){var i=a.screenKeys.filter((function(e){return!t.some((function(t){return t.node.name===ie[e]}))}));if(!Ea.isEmpty(i)){var r=i.map((function(e){return ie[e]})).join(", ");console.info("ðŸ“º Lazy-loading Screens in ".concat(e.name,": ").concat(r)),this.addScreenKeys(i,a.node)}}}},{key:"reorderScreens",value:function(){var e=ga.vals(this.screens).filter((function(e){return"ready"===e.state}));e.sort((function(e,t){return e.order-t.order}));for(var t=0;t<e.length;t++){var n=e[t];n&&(n.order=t,n.comp.node.setSiblingIndex(n.order))}}},{key:"addScreenKeys",value:function(e,t){var n=this;e.forEach((function(e,a){var i=ie[e];n.screens[i]&&(n.screens[i].order=a),n.screens[ie[e]]={state:"key",parent:t,key:e,order:a}}))}},{key:"addScreens",value:function(e){var t=this;e.forEach((function(e,n){t.screens[e.node.name]={state:"ready",comp:e,order:n}}))}},{key:"preloadScreens",value:(s=i((function*(){var e=ga.vals(this.screens).reduce((function(e,t){if("key"===t.state){var n=X.loadPrefabAsync("screens/".concat(ie[t.key]));e.push(n)}return e}),[]);return yield Promise.all(e)})),function(){return s.apply(this,arguments)})},{key:"getScreen",value:(o=i((function*(e){var t=this.screens[e];if(null==t)return null==pa||pa.sendException(new Error("ScreenManager.openScreen Screen ".concat(e," not found")),{screenName:e,screens:this.getScreensAsMetadata()}),null;if("ready"===t.state)return t.comp;console.info("ScreenManager.getScreen","Screen ".concat(e," not found in cache, instantiating it...")),this.queueInstantiatingScreens[e]=!0;var n=t.parent,a=t.key,i=t.order,r=yield X.loadPrefabAsync("screens/".concat(ie[a]));if(delete this.queueInstantiatingScreens[e],!r)return null==pa||pa.sendException(new Error("ScreenManager.getScreen: Failed to load Screen ".concat(e," prefab...")),{screenName:e,screens:this.getScreensAsMetadata()}),null;var o=N(r);o.name=e,n.addChild(o),o.active=!1;var s=o.getComponent("BaseScreen");return s?(this.screens[e]={state:"ready",comp:s,order:i},this.reorderScreens(),s):(null==pa||pa.sendException(new Error("ScreenManager.getScreen: Screen ".concat(e," prefab doesn't have BaseScreen component...")),{screenName:e,screens:this.getScreensAsMetadata()}),null)})),function(e){return o.apply(this,arguments)})},{key:"getScreensAsMetadata",value:function(){var e=this;return Object.keys(this.screens).map((function(t){var n=e.screens[t];return n?"ready"===n.state?"".concat(n.comp.node.name,"(loaded)"):"".concat(ie[n.key],"(not-loaded)"):null})).join(", ")}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:(r=i((function*(e,t){try{if(this.queueInstantiatingScreens[e])return;X.setBlockInput(!0);var n=yield this.getScreen(e);if(X.setBlockInput(!1),null==n||!n.node)return void console.warn("ScreenManager.openScreen","Screen ".concat(e," not found"));n.node.active=!0,n.node.setPosition(new x(0,0,0));var a={screenName:e,screenData:t};fa.emit(ya.OPENING_SCREEN,a),ne.trackCurrentPage(e,!0),null==pa||pa.addMetadata({currentScreen:e}),yield re.waitTweenAsync(0),n.open(t),fa.emit(ya.OPENED_SCREEN,a)}catch(e){console.error("ScreenManager.openScreen",e)}})),function(e,t){return r.apply(this,arguments)})},{key:"closeScreen",value:(t=i((function*(e){try{var t;if(this.queueInstantiatingScreens[e])return;var n=yield this.getScreen(e);if(!n)return void console.warn("ScreenManager.closeScreen","Screen ".concat(e," not found"));if(null===(t=n.node)||void 0===t||!t.active)return;var a={screenName:e};fa.emit(ya.CLOSING_SCREEN,a),n.close(),ne.trackCurrentPage(e,!1),null==pa||pa.removeMetadata("currentScreen")}catch(e){console.error("ScreenManager.closeScreen",e)}})),function(e){return t.apply(this,arguments)})},{key:"closeAllScreens",value:function(){for(var e in this.screens){var t=this.screens[e];t&&("ready"===t.state&&this.closeScreen(e))}}}]),e}();l._RF.pop(),l._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var Aa=GameCore,_a=Aa.Configs.Core,ba=Aa.Events,Ca=Aa.Plugins.Analytics.Events,ka=globalThis.game,Da=ka.context,Ra=ka.storage,Ta=ka.event,Fa=ka.analytics,La=ka.monitorError;new(function(){function e(){var t=this;a(this,e),this.coreManager=new ye,this.adsManager=new fe,this.matchManager=new Ze,this.sceneManager=new da,this.screenManager=new wa,this.engineManager=new Ce,this.layoutManager=new Ue,this.playerManager=new it,this.pluginsManager=new aa,this.handleWhenCoreBoot=function(){console.warn("Corecos System: Core boot",{inited:d.inited,game:d}),d.inited?t.handleCocosInit():d.once(I.EVENT_GAME_INITED,t.handleCocosInit)},this.handleCocosInit=function(){t.coreManager.requestStart()},this.handleWhenCoreStart=function(){t.playerManager.setupDefaultGameData(),t.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){t.initPlugins(),console.groupEnd(),Fa.event(Ca.LOAD_START),Ta.catchUp(ba.BUNDLE_READY,t.processPreStartGame)},this.processPreStartGame=function(){Ta.once(ba.SCENE_LOADED,t.preloadScenes),Ta.once(ba.SCENE_LAUNCHED,t.handleBootSceneLaunched),t.runBootScene()},this.handleBootSceneLaunched=function(){_a.StartSDKAfterLoadGame?Ta.once(ba.SCENE_LOADED,t.handleStartGameWhenMainSceneReady):t.processStartGame()},this.preloadScenes=function(){"solo"===Ra.getStorageData("context","sessionContextType")?oe.preloadDashboardScene():oe.preloadGameScene()},this.handleStartGameWhenMainSceneReady=function(){t.processStartGame()},this.handleSwitchScene=function(e){var n=e.sceneName,a=t.sceneManager.getCurrentScene();(null==a?void 0:a.name)===n&&a&&(t.screenManager.closeAllScreens(),t.screenManager.clearScreens(),t.screenManager.initScreens(a),t.screenManager.preloadScreens(),console.groupEnd())},this.startProcessContextData=i((function*(){Fa.event(Ca.APP_READY);try{t.playerManager.requestConnectedPlayers(),yield Da.processContextData()}catch(e){console.error("startProcessContextData",e),e instanceof Error&&(null==La||La.sendException(e))}finally{Ta.emit(ba.GAME_READY)}})),console.groupCollapsed("ðŸ“¦ Corecos System"),console.info("Corecos Initializing..."),this.initManagers(),this.listenEvents(),console.groupEnd()}var t,r;return n(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.adsManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"runBootScene",value:function(){oe.switchScene(U.BOOT_SCENE)}},{key:"processStartGame",value:(r=i((function*(){console.groupEnd(),Fa.event(Ca.LOAD_COMPLETE),yield this.startGameAsync(),Ta.catchUp(ba.PLAYER_INFO_LOADED,this.startProcessContextData)})),function(){return r.apply(this,arguments)})},{key:"startGameAsync",value:(t=i((function*(){try{yield GameSDK.startGameAsync()}catch(e){console.warn("GameSDK.startGameAsync",e),e instanceof Error&&(null==La||La.sendException(e))}})),function(){return t.apply(this,arguments)})},{key:"initPlugins",value:function(){this.pluginsManager.initProfiler(),this.pluginsManager.initLanguages(),this.pluginsManager.initCocosStats(),this.pluginsManager.initLeaderboards(),this.pluginsManager.initFrameCapture(),this.pluginsManager.initDynamicAtlas(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),l._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/systems', 'chunks:///systems.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});