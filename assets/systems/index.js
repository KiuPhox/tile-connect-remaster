function _instanceof(n,r){if(null!=r&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance])return!!r[Symbol.hasInstance](n);return n instanceof r}function _type_of(n){return n&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n}function _ts_generator(n,r){var a,i,u,f,g={label:0,sent:function(){if(1&u[0])throw u[1];return u[1]},trys:[],ops:[]};return f={next:verb(0),throw:verb(1),return:verb(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function verb(n){return function(r){return step([n,r])}}function step(f){if(a)throw new TypeError("Generator is already executing.");while(g)try{if(a=1,i&&(u=2&f[0]?i.return:f[0]?i.throw||((u=i.return)&&u.call(i),0):i.next)&&!(u=u.call(i,f[1])).done)return u;if(i=0,u)f=[2&f[0],u.value];switch(f[0]){case 0:case 1:u=f;break;case 4:g.label++;return{value:f[1],done:false};case 5:g.label++;i=f[1];f=[0];continue;case 7:f=g.ops.pop();g.trys.pop();continue;default:if(u=g.trys,!(u=u.length>0&&u[u.length-1])&&(6===f[0]||2===f[0])){g=0;continue}if(3===f[0]&&(!u||f[1]>u[0]&&f[1]<u[3])){g.label=f[1];break}if(6===f[0]&&g.label<u[1]){g.label=u[1];u=f;break}if(u&&g.label<u[2]){g.label=u[2];g.ops.push(f);break}if(u[2])g.ops.pop();g.trys.pop();continue}f=r.call(n,g)}catch(n){f=[6,n];i=0}finally{a=u=0}if(5&f[0])throw f[1];return{value:f[0]?f[1]:void 0,done:true}}}function _ts_values(n){var r="function"==typeof Symbol&&Symbol.iterator,a=r&&n[r],i=0;if(a)return a.call(n);if(n&&"number"==typeof n.length)return{next:function(){if(n&&i>=n.length)n=void 0;return{value:n&&n[i++],done:!n}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}System.register("chunks:///systems.js",["./renderCustomShareScore-02a4eb22.js","cc"],function(n,r){var a,i,u,f,g,y,E,_,w,b,A,D,k,C,R,T,F,L,M,N,I,P,x,O,B,U,G,V,z,H,q,W,j,K,Q,Y,Z,X,J,$,ee,et,en,er,ea,ei,es,eo,ec,eu,el,ed,eh,ef,ep,ev,em,eg,ey,eE;return{setters:[function(n){a=n.f,i=n.q,u=n.r,f=n.z,g=n.c,y=n.J,E=n.k,_=n.o,w=n.m,b=n.X,A=n.Y,D=n.T,k=n.w,C=n.Z,R=n.$,T=n.I,F=n.E,L=n.t,M=n.h,N=n.U,I=n.u,n.a0,P=n.g,x=n.L,O=n.G,B=n.N,U=n.x,G=n.a1,V=n.S,z=n.p,H=n.O,q=n.a2,W=n.D,j=n.A,K=n.F},function(n){Q=n.cclegacy,Y=n.game,Z=n.settings,X=n.Settings,J=n.AssetManager,$=n.director,ee=n.input,et=n.Input,en=n.sys,er=n.macro,ea=n.DynamicAtlasManager,ei=n.screen,es=n.math,eo=n.Director,ec=n.View,eu=n.ResolutionPolicy,el=n.profiler,ed=n.ImageAsset,eh=n.Texture2D,ef=n.UIRenderer,ep=n.assetManager,ev=n.CCObject,em=n.Node,eg=n.instantiate,ey=n.Vec3,eE=n.Game}],execute:function(){Q._RF.push({},"0b4bc6YT6ZGg4lnXfh/zL6J","AdsManager",void 0);var n=GameCore,r=n.Events,e_=n.Configs,eS=n.Utils.Time,ew=globalThis.game,eb=ew.ads,eA=ew.player,eD=ew.event,ek=function(){function e(){var n=this;g(this,e),this.currentLayout="",this.handleShowBannerAds=function(a){a.sceneName!==y.BOOT_SCENE&&(eA.isFirstLogin()||(n.showBannerAdsByLayout(),eD.off(r.SCENE_LAUNCHED,n.handleShowBannerAds)))},this.handleWhenGameReady=E(function(){return _ts_generator(this,function(r){switch(r.label){case 0:return[4,n.handleShowInterstitialAdWhenGameReady()];case 1:r.sent();return[4,eS.sleepAsync(1e4)];case 2:r.sent(),f.preloadAds();return[2]}})}),this.handleShowInterstitialAdWhenGameReady=E(function(){var r,a,i,u,f,g,y,E,_;return _ts_generator(this,function(w){switch(w.label){case 0:r=e_.Ads,a=r.Enabled,i=r.ShowAdOnLoad;if(!a)return[3,6];u=i.Enabled,f=i.DelaySeconds,g=i.PlacementId;if(!u)return[3,6];w.label=1;case 1:w.trys.push([1,5,,6]);y=f>0;if(!y)return[3,3];return[4,eS.sleepAsync(1e3*f)];case 2:y=w.sent();w.label=3;case 3:E=eb.getAdByPlacementId(g);if(!E)return[2];return[4,n.showAdByConfig(E)];case 4:w.sent();return[3,6];case 5:_=w.sent();console.warn("handleShowAdWhenLoadGame failed",_);return[3,6];case 6:return[2]}})}),this.handleLayoutChanged=function(r){n.currentLayout=r,n.showBannerAdsByLayout()}}var n;return a(e,[{key:"init",value:function(){this.listenEvents(),console.info("Ads Manager: Initialized")}},{key:"listenEvents",value:function(){Y.on(i.ORIENTATION_CHANGED,this.handleLayoutChanged),eD.on(r.SCENE_LAUNCHED,this.handleShowBannerAds),eD.catchUp(r.GAME_READY,this.handleWhenGameReady)}},{key:"showAdByConfig",value:(n=E(function(n){var r,a,i;return _ts_generator(this,function(u){switch(u.label){case 0:u.trys.push([0,3,4,5]);r=n.type,a=n.placementId;return[4,eb.loadAdAsync(r,a)];case 1:u.sent(),_.muteAudio(!0);return[4,eb.showAdAsync(r,a)];case 2:u.sent();return[3,5];case 3:i=u.sent();console.warn("showAdByConfig failed",i);return[3,5];case 4:Y.resume(),_.muteAudio(!1);return[7];case 5:return[2]}})}),function(r){return n.apply(this,arguments)})},{key:"showBannerAdsByLayout",value:function(){var n=e_.Ads.BannerDisplayAdOptions;this.currentLayout!==u.Layout.Landscape?n.forEach(function(n){var r=n.PlacementId,a=n.Position;"bottom"===a||"top"===a?f.showBannerAd(r):f.hideBannerAd(r)}):f.showBannerAds()}}]),e}();Q._RF.pop(),Q._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var eC=GameCore.Events,eR=globalThis.game.event,eT=function(){function e(){g(this,e)}return a(e,[{key:"init",value:function(){console.info("Core Manager: Initialized")}},{key:"requestStart",value:function(){eR.emit(eC.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(n){eR.catchUp(eC.CORE_BOOTING,n)}},{key:"onCoreStart",value:function(n){eR.catchUp(eC.CORE_STARTING,n)}},{key:"onCoreReady",value:function(n){eR.catchUp(eC.CORE_READY,n)}}]),e}();Q._RF.pop(),Q._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var eF=GameCore,eL=eF.Events,eM=eF.Configs.GameEngine.DynamicAtlas,eN=eF.Utils,eI=eN.Valid,eP=eN.Device,ex=eN.Function,eO=globalThis.game.event,eB=function(){function e(){var n=this;g(this,e),this.handlePauseEngine=E(function(){return _ts_generator(this,function(n){console.info("Engine: Paused",Y.isPaused()),Y.isPaused();return[2]})}),this.handleResumeEngine=E(function(){return _ts_generator(this,function(n){console.info("Engine: Resumed",Y.isPaused()),Y.isPaused();return[2]})}),this.handleResizeView=function(r){ec.instance.resizeWithBrowserSize(!1);var a=r.width,i=r.height;n.resizeView(a,i)},this.handleViewResized=ex.throttle(function(n){var r=n.width,a=n.height;ec.instance.resizeWithBrowserSize(!0),console.info("âœ¨ New View Size",{width:r,height:a})},600)}var n;return a(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.setupAssetDownloader(),this.setupOptimalPipelines(),this.setupEngineRunningState(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){Y.on(i.VIEW_RESIZE,this.handleResizeView),Y.on(i.VIEW_RESIZED,this.handleViewResized)}},{key:"overrideSettings",value:function(){Z.overrideSettings(X.Category.ENGINE,"debug",eI.isDebugger()),Y.frameRate=eP.isDesktop()?60:48}},{key:"setupAutoAtlas",value:function(){J.instance.cacheAsset=!0}},{key:"setupAssetDownloader",value:function(){var n=J.instance.downloader;n.maxConcurrency=15,n.maxRequestsPerFrame=15}},{key:"getPipelineFlows",value:function(){var n,r;return null!==(n=null===(r=$.root)||void 0===r||null===(r=r.pipeline)||void 0===r?void 0:r.flows)&&void 0!==n?n:[]}},{key:"getRenderQueues",value:function(n){var r=this.getPipelineFlows()[0];return null!=r&&r.stages?r.stages[n].renderQueues:[]}},{key:"setupOptimalPipelines",value:(n=E(function(){var n,r;return _ts_generator(this,function(a){switch(a.label){case 0:J.instance.transformPipeline.remove(1);return[4,eI.isValueChangeAsync(function(){return!!$.root},!0,{timeout:1e4})];case 1:a.sent();n=this.getPipelineFlows();n.shift(),n.shift();r=this.getRenderQueues(0);r.shift(),r.shift();return[2]}})}),function(){return n.apply(this,arguments)})},{key:"setupEngineRunningState",value:function(){var n=this;ee.on(et.EventType.TOUCH_START,this.handleResumeEngine),eO.catchUp(eL.GAME_READY,function(){eO.on(eL.VISIBILITY_HIDDEN,n.handlePauseEngine),eO.on(eL.VISIBILITY_VISIBLE,n.handleResumeEngine)})}},{key:"setupDynamicAtlas",value:function(){switch(en.os){case en.OS.IOS:this.setupDynamicAtlasForIOS();break;case en.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(n){var r=n.Enabled,a=n.AutoAtlasSize,i=n.MaxAtlasCount,u=n.MaxAtlasSize,f=n.MaxFrameSize;if(er.CLEANUP_IMAGE_CACHE=!1,ea.instance.enabled=r,ea.instance.textureSize=u,ea.instance.maxFrameSize=f,ea.instance.maxAtlasCount=i,ea.instance.textureBleeding=!0,a){var g=this.getMaxTextureSize();if(!g)return;ea.instance.maxAtlasCount=1,ea.instance.textureSize=g}}},{key:"getMaxTextureSize",value:function(){if(!$.root)return -1;var n=$.root.device.capabilities.maxTextureSize,r=1024;return n-r<=ea.instance.maxFrameSize?-1:n>8192?7168:n-r}},{key:"setupDynamicAtlasForIOS",value:function(){var n=eM.IOS;this.setDynamicAtlas(n)}},{key:"setupDynamicAtlasForAndroid",value:function(){var n=eM.Android;this.setDynamicAtlas(n)}},{key:"setupDynamicAtlasForDesktop",value:function(){var n=eM.Desktop;this.setDynamicAtlas(n)}},{key:"setupBatcherLimit",value:function(){er.BATCHER2D_MEM_INCREMENT=288,er.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(n,r){var a,u=window.devicePixelRatio,f=u>=2?2/u:1,g=Math.round(n*u*f),y=Math.round(r*u*f);null===(a=$.root)||void 0===a||a.resize(g,y),ei.windowSize=new es.Size(g,y),$.once(eo.EVENT_AFTER_UPDATE,function(){Y.emit(i.VIEW_RESIZED,{width:g,height:y})})}}]),e}();Q._RF.pop();var eU,eG=new(function(){function e(){g(this,e),this._registry={},this._moduleCache={}}return a(e,[{key:"define",value:function(n,r,a){this._registry[n]={factory:r,resolveMap:a}}},{key:"require",value:function(n){return this._require(n)}},{key:"throwInvalidWrapper",value:function(n,r){throw new Error("Module '".concat(n,"' imported from '").concat(r,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(n,r){var a=this._moduleCache[n];if(a)return a.exports;var i={id:n,exports:{}};return this._moduleCache[n]=i,this._tryModuleLoad(i,n),i.exports}},{key:"_resolve",value:function(n,r){return this._resolveFromInfos(n,r)||this._throwUnresolved(n,r)}},{key:"_resolveFromInfos",value:function(n,r){var a,i;return n in cjsInfos?n:r&&null!==(a=null===(i=cjsInfos[r])||void 0===i?void 0:i.resolveCache[n])&&void 0!==a?a:void 0}},{key:"_tryModuleLoad",value:function(n,r){var a=!0;try{this._load(n,r),a=!1}finally{a&&delete this._moduleCache[r]}}},{key:"_load",value:function(n,r){var a=this._loadWrapper(r),i=a.factory,u=a.resolveMap,f=this._createRequire(n),g=u?this._createRequireWithResolveMap("function"==typeof u?u():u,f):f;i(n.exports,g,n)}},{key:"_loadWrapper",value:function(n){return n in this._registry?this._registry[n]:this._loadHostProvidedModules(n)}},{key:"_loadHostProvidedModules",value:function(n){return{factory:function(r,a,i){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(n,"'."));try{i.exports=require(n)}catch(r){throw new Error("Exception thrown when calling host defined require('".concat(n,"')."),{cause:r})}}}}},{key:"_createRequire",value:function(n){var r=this;return function(a){return r._require(a,n)}}},{key:"_createRequireWithResolveMap",value:function(n,r){return function(a){var i=n[a];if(i)return r(i);throw new Error("Unresolved specifier "+a)}}},{key:"_throwUnresolved",value:function(n,r){throw new Error("Unable to resolve ".concat(n," from ").concat(parent,"."))}}]),e}());function Te(n){return(Te="function"==typeof Symbol&&"symbol"==_type_of(Symbol.iterator)?function(n){return void 0===n?"undefined":_type_of(n)}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":void 0===n?"undefined":_type_of(n)})(n)}var eV="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";eG.define(eV,function(n,r,a,i,u){(function(r,i){"object"===Te(n)&&void 0!==a?a.exports=i():"function"==typeof define&&define.amd?define(i):r.ResizeObserver=i()})(this,function(){var n=function(){if("undefined"!=typeof Map)return Map;function e(n,r){var a=-1;return n.some(function(n,i){return n[0]===r&&(a=i,!0)}),a}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(n){var r=e(this.__entries__,n),a=this.__entries__[r];return a&&a[1]},t.prototype.set=function(n,r){var a=e(this.__entries__,n);~a?this.__entries__[a][1]=r:this.__entries__.push([n,r])},t.prototype.delete=function(n){var r=this.__entries__,a=e(r,n);~a&&r.splice(a,1)},t.prototype.has=function(n){return!!~e(this.__entries__,n)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(n,r){void 0===r&&(r=null);for(var a=0,i=this.__entries__;a<i.length;a++){var u=i[a];n.call(r,u[1],u[0])}},t}()}(),r="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,a="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),i="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(a):function(n){return setTimeout(function(){return n(Date.now())},1e3/60)};var u=["top","right","bottom","left","width","height","size","weight"],f="undefined"!=typeof MutationObserver,g=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(n,r){var a=!1,u=!1,f=0;function o(){a&&(a=!1,n()),u&&c()}function s(){i(o)}function c(){var n=Date.now();if(a){if(n-f<2)return;u=!0}else a=!0,u=!1,setTimeout(s,r);f=n}return c}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(n){~this.observers_.indexOf(n)||this.observers_.push(n),this.connected_||this.connect_()},e.prototype.removeObserver=function(n){var r=this.observers_,a=r.indexOf(n);~a&&r.splice(a,1),!r.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var n=this.observers_.filter(function(n){return n.gatherActive(),n.hasActive()});return n.forEach(function(n){return n.broadcastActive()}),n.length>0},e.prototype.connect_=function(){r&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),f?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){r&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(n){var r=n.propertyName,a=void 0===r?"":r;u.some(function(n){return!!~a.indexOf(n)})&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(n,r){for(var a=0,i=Object.keys(r);a<i.length;a++){var u=i[a];Object.defineProperty(n,u,{value:r[u],enumerable:!1,writable:!1,configurable:!0})}return n},c=function(n){return n&&n.ownerDocument&&n.ownerDocument.defaultView||a},y=p(0,0,0,0);function l(n){return parseFloat(n)||0}function d(n){for(var r=[],a=1;a<arguments.length;a++)r[a-1]=arguments[a];return r.reduce(function(r,a){return r+l(n["border-"+a+"-width"])},0)}function h(n){var r=n.clientWidth,a=n.clientHeight;if(!r&&!a)return y;var i=c(n).getComputedStyle(n),u=function(n){for(var r={},a=0,i=["top","right","bottom","left"];a<i.length;a++){var u=i[a],f=n["padding-"+u];r[u]=l(f)}return r}(i),f=u.left+u.right,g=u.top+u.bottom,E=l(i.width),_=l(i.height);if("border-box"===i.boxSizing&&(Math.round(E+f)!==r&&(E-=d(i,"left","right")+f),Math.round(_+g)!==a&&(_-=d(i,"top","bottom")+g)),!function(n){return n===c(n).document.documentElement}(n)){var w=Math.round(E+f)-r,b=Math.round(_+g)-a;1!==Math.abs(w)&&(E-=w),1!==Math.abs(b)&&(_-=b)}return p(u.left,u.top,E,_)}var E="undefined"!=typeof SVGGraphicsElement?function(n){return _instanceof(n,c(n).SVGGraphicsElement)}:function(n){return _instanceof(n,c(n).SVGElement)&&"function"==typeof n.getBBox};function v(n){return r?E(n)?function(n){var r=n.getBBox();return p(0,0,r.width,r.height)}(n):h(n):y}function p(n,r,a,i){return{x:n,y:r,width:a,height:i}}var _=function(){function e(n){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=p(0,0,0,0),this.target=n}return e.prototype.isActive=function(){var n=v(this.target);return this.contentRect_=n,n.width!==this.broadcastWidth||n.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var n=this.contentRect_;return this.broadcastWidth=n.width,this.broadcastHeight=n.height,n},e}(),m=function(n,r){var a,i,u,f,g,y,E,_=(i=(a=r).x,u=a.y,f=a.width,g=a.height,y="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,E=Object.create(y.prototype),s(E,{x:i,y:u,width:f,height:g,top:u,right:i+f,bottom:g+u,left:i}),E);s(this,{target:n,contentRect:_})},w=function(){function t(r,a,i){if(this.activeObservations_=[],this.observations_=new n,"function"!=typeof r)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=r,this.controller_=a,this.callbackCtx_=i}return t.prototype.observe=function(n){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(n,c(n).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(n)||(r.set(n,new _(n)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(n){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&_instanceof(Element,Object)){if(!_instanceof(n,c(n).Element))throw new TypeError('parameter 1 is not of type "Element".');var r=this.observations_;r.has(n)&&(r.delete(n),r.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var n=this;this.clearActive(),this.observations_.forEach(function(r){r.isActive()&&n.activeObservations_.push(r)})},t.prototype.broadcastActive=function(){if(this.hasActive()){var n=this.callbackCtx_,r=this.activeObservations_.map(function(n){return new m(n.target,n.broadcastRect())});this.callback_.call(n,r,n),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),b="undefined"!=typeof WeakMap?new WeakMap:new n,S=function e(n){if(!_instanceof(this,e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var r=g.getInstance(),a=new w(n,r,this);b.set(this,a)};return["observe","unobserve","disconnect"].forEach(function(n){S.prototype[n]=function(){var r;return(r=b.get(this))[n].apply(r,arguments)}}),void 0!==a.ResizeObserver?a.ResizeObserver:S}),eU=a.exports},{}),eG.require(eV),Q._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var ez=u.Layout,eH=u.DesignSize,eq=eH.Portrait,eW=eH.Landscape,ej=GameCore,eK=ej.Utils.Function,eQ=ej.Configs.GameEngine,eY=eQ.AutoResizeCanvas,eZ=eQ.AutoChangeOrientation,eX=function(){function e(){var n=this;g(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(r){console.info("\uD83D\uDCF1 View resize by system"),window.devicePixelRatio=r||window.devicePixelRatio,n.setupOrientationByScreenSize(),n.resizeGameView()},this.handleViewResize=eK.debounce(function(){console.info("\uD83D\uDCF1 View resize by window"),n.setupOrientationByScreenSize(),n.resizeGameView()},300),this.handleBodyResize=eK.debounce(function(){n.resizeGameDiv()&&(console.info("\uD83D\uDCF1 View resize by body"),n.setupOrientationByScreenSize(),n.resizeGameView())},300)}return a(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){eY&&(ei.on("window-resize",this.handleViewResize,this),ei.on("orientation-change",this.handleViewResize,this)),Y.on(i.REQUEST_VIEW_RESIZE,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){eY&&new eU(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){eZ&&(ec.instance.resizeWithBrowserSize(!0),ec.instance.setOrientation(er.ORIENTATION_AUTO),ec.instance.setResolutionPolicy(eu.ContentStrategy.FIXED_WIDTH),ec.instance.setResolutionPolicy(eu.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=ec.instance.getResolutionPolicy())}},{key:"setupOrientationByScreenSize",value:function(){eZ&&(this.getScreenRatio()<1?this.setPortraitView():this.setLandscapeView())}},{key:"resizeGameDiv",value:function(n){var r=arguments.length>0&&void 0!==n&&n,a=document.getElementById("GameDiv");if(!a)return!1;var i=w.getScreenWidthCss(),u=w.getScreenHeightCss(),f=a.getBoundingClientRect(),g=f.width,y=f.height;return!(i===g&&u===y&&!r)&&(a.style.width="".concat(i,"px"),a.style.height="".concat(u,"px"),!0)}},{key:"resizeGameView",value:function(){var n=w.getScreenWidthCss(),r=w.getScreenHeightCss();Y.emit(i.VIEW_RESIZE,{width:n,height:r})}},{key:"setPortraitView",value:function(){var n=eq.WIDTH,r=eq.HEIGHT;this.currentLayout!==ez.Portrait&&(this.currentLayout=ez.Portrait,this.changeDesignResolutionSize(n,r))}},{key:"setLandscapeView",value:function(){var n=eW.WIDTH,r=eW.HEIGHT;this.currentLayout!==ez.Landscape&&(this.currentLayout=ez.Landscape,this.changeDesignResolutionSize(n,r))}},{key:"changeDesignResolutionSize",value:function(n,r){var a=this.currentLayout===ez.Portrait,f=this.currentLayout===ez.Landscape;this.resolutionPolicy.setContentStrategy(eu.ContentStrategy.FIXED_WIDTH),a&&!u.FULL_PORTRAIT_SIZE?this.resolutionPolicy.setContentStrategy(eu.ContentStrategy.SHOW_ALL):f&&!u.FULL_LANDSCAPE_SIZE&&this.resolutionPolicy.setContentStrategy(eu.ContentStrategy.EXACT_FIT),ec.instance.setDesignResolutionSize(n,r,this.resolutionPolicy),Y.emit(i.LAYOUT_CHANGED,this.currentLayout),console.info("\uD83D\uDCF1 Change layout to",this.currentLayout,this.resolutionPolicy)}},{key:"getScreenRatio",value:function(){return w.getScreenWidthCss()/w.getScreenHeightCss()}}]),e}();Q._RF.pop(),Q._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var eJ=GameCore,e$=eJ.Utils,e0=e$.Valid,e1=e$.Object,e2=e$.Array,e3=eJ.Dtos.Match,e4=e3.CustomData,e5=e3.Data,e6=["code","cols","encoding","idSize","rows"],e8=["addRandomTilesPerMove","maxSpaceOfPair"],e7=function(){function e(){g(this,e)}return a(e,[{key:"init",value:function(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function(){e4.addDefaultData(b),e4.addValidateFunction("score",function(n){if(!e0.isNumber(n)||n<0)throw new Error("score ".concat(n," is invalid"))})}},{key:"setupMatchData",value:function(){var n=this;e5.addDefaultData(A),e5.addValidateFunction("extraData",function(r){if(null!=r){if(!e0.isObject(r))throw new Error("extraData ".concat(r," must be a record of string keys"));var a=r,i=Object.keys(a);if(!e2.has(i,"level"))throw new Error("extraData.level is missing");if(!e0.isNumber(a.level))throw new Error("extraData.level ".concat(a.level," must be a number"));if(!e2.has(i,"fen"))throw new Error("extraData.fen is missing");if(n.validateFen(a.fen),!e2.has(i,"gravity"))throw new Error("extraData.gravity is missing");if(!e0.isString(a.gravity))throw new Error("extraData.gravity ".concat(a.gravity," must be a string"));if(!e2.has(i,"rules"))throw new Error("extraData.rules is missing");if(n.validateLevelRules(a.rules),!e2.has(i,"time"))throw new Error("extraData.time is missing");if(!e0.isNumber(a.time))throw new Error("extraData.time ".concat(a.time," must be a number"))}})}},{key:"validateFen",value:function(n){if(!e0.isObject(n))throw new Error("extraData.fen ".concat(n," must be a record of string keys"));var r=this.validateKeys(n,e6);if(!e0.isNumber(r.idSize))throw new Error("fen.idSize must be a number");if(!e0.isString(r.code))throw new Error("fen.code must be a string");if(!e0.isNumber(r.rows))throw new Error("fen.rows must be a number");if(!e0.isNumber(r.cols))throw new Error("fen.cols must be a number");if(!e0.isObject(r.encoding))throw new Error("fen.encoding must be a record of string keys");var a=this.validateKeys(r.encoding,e1.vals(D));Object.entries(a).forEach(function(n){var r=k(n,2),a=r[0],i=r[1];if(!e0.isString(i))throw new Error("fen.encoding.".concat(a," ").concat(i," must be a string"))})}},{key:"validateLevelRules",value:function(n){if(!e0.isObject(n))throw new Error("extraData.rules ".concat(n," must be a record of string keys"));var r=this.validateKeys(n,e8);if(!e0.isNumber(r.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!e0.isNumber(r.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function(n,r){return Object.keys(n).forEach(function(n){if(!e2.has(r,n))throw new Error("Key ".concat(n," is missing"))}),n}}]),e}();Q._RF.pop(),Q._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var e9=GameCore,te=e9.Utils,tt=te.Valid,tn=te.Array,tr=te.Object,ta=e9.Dtos,ti=globalThis.game.player,ts=function(){function e(){g(this,e)}return a(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var n=ta.Player;n.Data.addDefaultData(C),n.GameData.addDefaultData(R),n.GameData.addValidateFunction("stars",function(n){if(!tt.isNumber(n)||n<0)throw new Error("stars ".concat(n," is invalid"))}),n.GameData.addValidateFunction("totalLevel",function(n){if(!tt.isNumber(n)||n<1)throw new Error("totalLevel ".concat(n," is invalid"))}),n.GameData.addValidateFunction("levelVersion",function(n){if(!tt.isNumber(n)||n<0)throw new Error("levelVersion ".concat(n," is invalid"))}),n.GameData.addValidateFunction("lastRewardedItems",function(n){if(!tt.isNumber(n)||n<0)throw new Error("lastRewardedItems ".concat(n," is invalid"))}),n.GameData.addValidateFunction("lastCreateTournamentShown",function(n){if(!tt.isNumber(n)||n<0)throw new Error("lastCreateTournamentShown ".concat(n," is invalid"))}),n.GameData.addValidateFunction("guideItemShowed",function(n){if(!Array.isArray(n))throw new Error("guideItemShowed ".concat(n," is invalid"))}),n.GameData.addValidateFunction("items",function(n){if(!tt.isObject(n))throw new Error("items ".concat(n," is invalid"));var r=Object.keys(n),a=tr.vals(n);if(!tn.has(r,T.HINT))throw new Error("item ".concat(T.HINT," not found"));if(!tn.has(r,T.THUNDER))throw new Error("item ".concat(T.THUNDER," not found"));if(!tn.has(r,T.STORM))throw new Error("item ".concat(T.STORM," not found"));if(!tn.has(r,T.PLIERS))throw new Error("item ".concat(T.PLIERS," not found"));a.forEach(function(n){if(!tt.isNumber(n)||n<0)throw new Error("item ".concat(n," is invalid"))})}),n.GameData.addValidateFunction("skins",function(n){if(!tt.isObject(n))throw new Error("skins ".concat(n," is invalid"))})}},{key:"requestConnectedPlayers",value:function(){ti.requestConnectedPlayers().catch(function(n){console.warn("player.requestConnectedPlayers",n)})}}]),e}();Q._RF.pop(),Q._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var to=GameCore,tc=to.Events,tu=to.Utils.Valid,tl=globalThis.game,td=tl.event,th=tl.adaptivePerformance,tf=function(){function e(){var n=this;g(this,e),this.handleBeginFrame=function(){$.on(eo.EVENT_AFTER_UPDATE,n.lateUpdate),$.on(eo.EVENT_BEFORE_UPDATE,n.updateActualFPS)},this.handleAfterSceneLaunch=function(n){th&&th.trackingScene(n.name)},this.handleRequestResizeGame=function(n){var r=n.forcePixelRatio;tu.isNumber(r)&&Y.emit(i.REQUEST_VIEW_RESIZE,r)},this.lateUpdate=function(){var n=1e3*Y.deltaTime;null==th||th.updatePostStepDeltaTime(n)},this.updateActualFPS=function(){var n,r=null===(n=$.root)||void 0===n?void 0:n.fps;tu.isNumber(r)&&(null==th||th.updateActualFPS(r))}}return a(e,[{key:"init",value:function(){th&&this.listenEvents()}},{key:"listenEvents",value:function(){td.on(tc.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),$.once(eo.EVENT_BEGIN_FRAME,this.handleBeginFrame),$.on(eo.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();Q._RF.pop(),Q._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var tp=globalThis.game.canvasRecorder,tv=function(){function e(){g(this,e)}return a(e,[{key:"init",value:function(){if(Y.canvas&&tp){tp.setCanvas(Y.canvas);var n=tp.getOptions(),r=tp.waitNextFrame;tp.waitNextFrame=E(function(){var a;return _ts_generator(this,function(i){switch(i.label){case 0:if(!n.syncFps)return[3,1];a=new Promise(function(n){$.once(eo.EVENT_AFTER_RENDER,n),Y.pause(),Y.step()});return[3,3];case 1:Y.resume();return[4,r.call(tp)];case 2:a=(i.sent(),Promise.resolve());i.label=3;case 3:return[2,a]}})})}}}]),e}();Q._RF.pop(),Q._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var tm=function(){function e(){var n=this;g(this,e),this.hideCocosStats=function(){clearInterval(n.waiter),n.waiter=setInterval(n.checkProfilerReady,100)},this.checkProfilerReady=function(){if(el){el._showFPS=!1;var r=el._rootNode;r&&(r.active=!1,r.isValid&&(r.destroyAllChildren(),r.removeAllChildren(),r.destroy(),clearInterval(n.waiter)))}}}return a(e,[{key:"init",value:function(){el&&$.on(eo.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();Q._RF.pop(),Q._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var tg=GameCore,ty=tg.Configs.GameEngine.DynamicAssets,tE=tg.Events,t_=tg.Utils.Array,tS=globalThis.game,tw=tS.event,tb=tS.storage,tA=tS.getBuildVersion,tD=[".png",".jpg",".jpeg",".webp"],tk=function(){function e(){var n=this;g(this,e),this.isProcessing=!1,this.useHighQuality=!1,this.upgradableAssets=new Map,this.handleSceneLaunched=function(n){var r=n.sceneName,a=[y.BOOT_SCENE];t_.has(a,r)||Y.emit(i.CHANGE_QUALITY_ASSETS,{quality:"highest"})},this.requestUpdateDynamicAssets=function(){Y.emit(i.UPGRADE_DYNAMIC_ATLAS,{force:!0})},this.collectUpgradableAssets=function(r){var a,i=r.output=r.input,u=ty.Resolution,f=u.Adjust,g=u.Original,y=M(i);try{for(y.s();!(a=y.n()).done;){var E=a.value;if(t_.has(tD,E.ext)&&!n.upgradableAssets.has(E.uuid)){n.useHighQuality?(E.url=n.replaceAssetUrl(E.url),E.resolution=g,E.upgradeOnNextRequest=!0):f<g&&(E.resolution=f);var _={ext:E.ext,url:E.url,uuid:E.uuid,options:E.options,upgraded:E.upgraded,resolution:E.resolution,upgradeOnNextRequest:E.upgradeOnNextRequest};n.upgradableAssets.set(E.uuid,_)}}}catch(n){y.e(n)}finally{y.f()}},this.replaceAssetUrl=function(r){return n.useHighQuality?r.replace("native/","native32/"):r},this.handleChangeQuality=E(function(){var r,a,i,u,f,g,y;return _ts_generator(this,function(E){switch(E.label){case 0:n.isProcessing=!0;a=[],i=M(n.upgradableAssets.values());try{for(i.s();!(r=i.n()).done;){u=r.value,f=n.processUpgradeQualityAsync(u);a.push(f)}}catch(n){i.e(n)}finally{i.f()}return[4,Promise.all(a)];case 1:g=E.sent();n.isProcessing=!1;y=g.filter(function(n){return n}).length;n.requestUpdateDynamicAssets(),console.warn("DynamicAssets: Upgradable Assets Info",{total:y,results:g});return[2]}})})}var n;return a(e,[{key:"init",value:function(){var n=ty.Enabled,r=ty.Resolution;console.info("DynamicAssets: init",{EDITOR:F,Enabled:n}),n&&(J.instance.transformPipeline.insert(this.collectUpgradableAssets,2),this.initState(),this.listenEvents(),window.requestIdleCallback=window.requestIdleCallback||function(n){n()},r.Adjust,r.Original)}},{key:"initState",value:function(){var n=tA().toString();tb.addStorage("DynamicAssets",{useHighQuality:!1,buildVersion:"0"},!0);var r=tb.getStorage("DynamicAssets"),a=null!=r?r:{},i=a.buildVersion,u=a.useHighQuality;"boolean"==typeof u&&(this.useHighQuality=u&&i===n),tb.setStorageData("DynamicAssets","buildVersion",n),tb.updateToWebStorage("DynamicAssets")}},{key:"listenEvents",value:function(){var n=this;Y.on(i.CHANGE_QUALITY_ASSETS,this.handleChangeQuality),setTimeout(function(){n.useHighQuality=!0,n.autoUpgradeQuality(),tw.on(tE.SCENE_LAUNCHED,n.handleSceneLaunched)},4e3)}},{key:"autoUpgradeQuality",value:function(){var n=this;requestIdleCallback(E(function(){var r;return _ts_generator(this,function(a){switch(a.label){case 0:if(!(!n.isProcessing&&!Y.isPaused()))return[3,2];r=L(n.upgradableAssets.values()).find(function(n){return!n.upgraded&&!n.upgradeOnNextRequest});if(!r)return[2,(tb.setStorageData("DynamicAssets","useHighQuality",!0),tb.updateToWebStorage("DynamicAssets"),void n.requestUpdateDynamicAssets())];console.info("DynamicAssets: Auto upgrade quality",r),n.isProcessing=!0;return[4,n.processUpgradeQualityAsync(r)];case 1:a.sent(),n.isProcessing=!1,n.autoUpgradeQuality();a.label=2;case 2:return[2]}})}),{timeout:1e3})}},{key:"processUpgradeQualityAsync",value:(n=E(function(n){var r,a,u,f,g;return _ts_generator(this,function(y){r=this;if(n.upgraded||n.upgradeOnNextRequest)return[2,!0];a=J.instance,u=a.assets,f=a.loadAny,g=u.get(n.uuid);return[2,_instanceof(g,ed)?(n.url=this.replaceAssetUrl(n.url),new Promise(function(a){f(n,n.options,function(u,f){if(u)return console.warn("DynamicAssets: Upgrade error",u),void a(!1);g.reset(f),n.upgraded=!0,r.upgradableAssets.set(n.uuid,n),Y.emit(i.ASSET_QUALITY_CHANGE,{asset:g,item:n}),a(!0)})})):(console.warn("DynamicAssets: Asset not found",n.uuid),!1)]})}),function(r){return n.apply(this,arguments)})}]),e}();Q._RF.pop(),Q._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var tC=GameCore,tR=tC.Events,tT=tC.Configs.GameEngine.DynamicAtlas,tF=tT.UsePowerOfTwo,tL=tT.TextureAtlasOptimize,tM=tC.Utils,tN=tM.Array,tI=tM.Json,tP=tM.Object,tx=tM.Function,tO=globalThis.game.event,tB=function(){function e(){var n=this;g(this,e),this.atlasTexId=null,this.drawInfo=[],this.atlasInfo=null,this.lastAtlasInfo=null,this.renderTimes=[],this.lastRenderTime=0,this.renderTimeInterval=5e3,this.isEffective=!0,this.isProcessing=!1,this.forceUpdateDynamicAtlas=!1,this.collectInfo={},this.pendingSprites={},this.setupRenderListeners=function(){$.on(eo.EVENT_BEFORE_RENDER,n.updateBeforeRenderTime),$.on(eo.EVENT_AFTER_RENDER,n.updateAfterRenderTime),tO.once(tR.SCENE_LAUNCHED,function(){$.once(eo.EVENT_AFTER_RENDER,n.checkRenderTimeHighers)})},this.checkRenderTimeHighers=function(){var r=n.getMeanRenderTime();r>8&&n.handleLaggyFrame(r),$.once(eo.EVENT_AFTER_RENDER,function(){setTimeout(n.checkRenderTimeHighers,n.renderTimeInterval)})},this.resetPendingSprites=function(){n.pendingSprites={}},this.updateBeforeRenderTime=function(){n.lastRenderTime=performance.now()},this.updateAfterRenderTime=function(){n.renderTimes.push(performance.now()-n.lastRenderTime)},this.requestUpdateDynamicAtlas=tx.throttle(function(r){n.isProcessing||(n.isProcessing=!0,n.forceUpdateDynamicAtlas=(null==r?void 0:r.force)||!1,$.once(eo.EVENT_AFTER_RENDER,n.updateDynamicAtlas))},5e3),this.updateDynamicAtlas=function(){try{var r=$.getScene();if(!r)return;var a=n.collectPackageInfo();if(Object.keys(a).length<1)return;if(n.drawInfo=[],n.atlasInfo=null,n.generateDrawInfo(tP.vals(a)),!n.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found");if(!n.updateAtlasData()&&!n.forceUpdateDynamicAtlas)return;var i=r.getComponentsInChildren(ef);n.refreshComponents(i)}catch(n){console.error("DynamicAtlas: Error updating dynamic atlas",n)}finally{n.isProcessing=!1,n.forceUpdateDynamicAtlas=!1}},this.generateDrawInfo=function(r){if(!(r.length<1)){console.info("DynamicAtlas: generate draw info",r);var a=r.sort(function(n,r){return r.usageCount-n.usageCount}),i=ea.instance.textureSize;if(n.calculateOptimizedAtlas(a,i),n.atlasInfo){var u,f=n.atlasInfo.textures,g=M(f);try{for(g.s();!(u=g.n()).done;){var y=u.value;n.drawInfo.push(y)}}catch(n){g.e(n)}finally{g.f()}var E=a.filter(function(n){return!f.some(function(r){return r.id===n.id})});E.length>0&&(console.warn("DynamicAtlas: Missing textures",E),n.generateDrawInfo(E))}else console.warn("DynamicAtlas: Atlas info not found",{textures:a})}},this.calculateOptimizedAtlas=function(r,a){var i=function(n){var r,a=0,i=0,u=M(n);try{for(u.s();!(r=u.n()).done;){var f=r.value;a+=f.w*f.h,i=Math.max(i,f.w)}}catch(n){u.e(n)}finally{u.f()}n.sort(function(n,r){return r.h-n.h});var g,y=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),i),h:1/0}],E=0,_=0,w=M(n);try{for(w.s();!(g=w.n()).done;)for(var b=g.value,A=y.length-1;A>=0;A--){var D=y[A];if(!(b.w>D.w||b.h>D.h)){if(b.x=D.x,b.y=D.y,_=Math.max(_,b.y+b.h),E=Math.max(E,b.x+b.w),b.w===D.w&&b.h===D.h){var k=y.pop();A<y.length&&(y[A]=k)}else b.h===D.h?(D.x+=b.w,D.w-=b.w):b.w===D.w?(D.y+=b.h,D.h-=b.h):(y.push({x:D.x+b.w,y:D.y,w:D.w-b.w,h:b.h}),D.y+=b.h,D.h-=b.h);break}}}catch(n){w.e(n)}finally{w.f()}return{w:E,h:_,fill:a/(E*_)||0}}(r),u=i.w,f=i.h,g=i.fill;if(g<.6)console.warn("DynamicAtlas: Fill rate is too low",g,L(r));else{if(u>a||f>a)return console.warn("DynamicAtlas: Packed size is bigger than atlas size",u,f,a),void(r.pop()?n.calculateOptimizedAtlas(r,a):console.warn("DynamicAtlas: Texture size is too big",u,f,a));n.atlasInfo={textures:r,atlasSize:a,packedInfo:{width:Math.round(u),height:Math.round(f),fillRate:g}}}},this.drawTexture=function(r,a,i){var u=a.texture,f=u.image;if(!f||f.width<1||f.height<1)console.warn("DynamicAtlas: Texture image not found",u);else if(!f.data||f.data.width<1||f.data.height<1)console.warn("DynamicAtlas: Texture image data not found",f);else{var g=u.getId(),y=tN.search(L(n.drawInfo),function(n){return n.id===g})||{x:-1,y:-1},E=y.x,_=y.y;if(!(E<0||_<0)){var w=r._innerTextureInfos[g];w||(i&&(r._texture.drawTextureAt(f,E-1,_),r._texture.drawTextureAt(f,E+1,_),r._texture.drawTextureAt(f,E,_-1),r._texture.drawTextureAt(f,E,_+1)),r._texture.drawTextureAt(f,E,_),r._count++,r._innerTextureInfos[g]={texture:u,x:E,y:_});var b=a.rect,A=b.x,D=b.y;A+=(null==w?void 0:w.x)||E,D+=(null==w?void 0:w.y)||_;var k={texture:r._texture,x:A,y:D};return r._innerSpriteFrames.push(a),k}n.pendingSprites[a.uuid]=a}},this.refreshComponents=function(n){var r,a=M(n);try{for(a.s();!(r=a.n()).done;){var i=r.value;i.node.active&&(i.node.active=!1,i.node.active=!0)}}catch(n){a.e(n)}finally{a.f()}},this.isSameAtlas=function(n,r){if(!n||!r)return!1;var a=n.packedInfo,i=n.textures,u=r.packedInfo,f=r.textures;return a.width===u.width&&a.height===u.height&&i.length===f.length&&i.every(function(n,r){var a=n.id,i=n.w,u=n.h,g=f[r]||{},y=g.id,E=g.w,_=g.h;return a===y&&i===E&&u===_})}}return a(e,[{key:"init",value:function(){tL&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:tL}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){Y.on(i.UPGRADE_DYNAMIC_ATLAS,this.requestUpdateDynamicAtlas),$.on(eo.EVENT_BEFORE_SCENE_LAUNCH,this.resetPendingSprites),tO.catchUp(tR.GAME_READY,this.setupRenderListeners)}},{key:"handleLaggyFrame",value:function(n){console.warn("DynamicAtlas: Laggy frame detected, render time: ".concat(n.toFixed(2),"ms")),this.isEffective||(this.renderTimeInterval=Math.min(this.renderTimeInterval+1e3,1e4),console.warn("DynamicAtlas: Atlas update not effective. Increased interval: ".concat(this.renderTimeInterval,"ms"))),this.requestUpdateDynamicAtlas()}},{key:"getMeanRenderTime",value:function(){var n,r=0,a=M(this.renderTimes);try{for(a.s();!(n=a.n()).done;)r+=n.value}catch(n){a.e(n)}finally{a.f()}return r/=this.renderTimes.length,this.renderTimes=[],r}},{key:"overrideDynamicAtlas",value:function(){var n=this,r=ea.instance;ea.instance.insertSpriteFrame=function(a){if(r._atlasIndex>=r._maxAtlasCount)return null;if(!a||a.original)return console.warn("DynamicAtlas: Skip original texture",a),null;if(!a.packable)return console.warn("DynamicAtlas: Skip non-packable texture",a),null;var i=n.getAtlas(),u=i?i.insertSpriteFrame(a):null;return!u&&r._atlasIndex<r._maxAtlasCount&&(u=(i=n.getAtlas())?i.insertSpriteFrame(a):null),u}}},{key:"createAtlas",value:function(){return ea.instance.newAtlas()}},{key:"getAtlas",value:function(){var n=this,r=ea.instance,a=r._atlases,i=void 0===a?[]:a,u=r._atlasIndex,f=r.textureBleeding,g=i[u];return g||(g=this.createAtlas()),g?(g.originalInsertSpriteFrame||(g.originalInsertSpriteFrame=g.insertSpriteFrame,g.insertSpriteFrame=function(r){return n.drawTexture(g,r,f)}),this.atlasTexId=g._texture.getId(),g):null}},{key:"collectPackageInfo",value:function(){var n,r=tP.vals(this.pendingSprites),a={},i=M(r);try{for(i.s();!(n=i.n()).done;){var u=n.value;if(this.isValidSpriteFrame(u)){var f=u.texture,g=u.original,y=f.getId(),E=null==g?void 0:g._texture.getId();if(y!==E){E&&(y=E),this.collectInfo[y]||this.initializeCollectInfo(y,u);var _=this.collectInfo[y];_&&(_.usageCount++,a[y]=_)}else console.warn("DynamicAtlas: Skip original texture",{texId:y,oriTexId:E})}}}catch(n){i.e(n)}finally{i.f()}return a}},{key:"isValidSpriteFrame",value:function(n){var r=n.packable,a=n.texture,i=n.original,u=n.name,f=n.uuid;if(!r)return console.warn("DynamicAtlas: Skip non-packable texture",u,f),!1;if(!_instanceof(a,eh))return console.warn("DynamicAtlas: Skip non-texture2d texture",u,f),!1;var g=null==i?void 0:i._texture.getId();return this.atlasTexId!==g||(console.warn("DynamicAtlas: Skip texture in atlas",u,f),!1)}},{key:"initializeCollectInfo",value:function(n,r){var a=r.texture,i=r.original,u=r.uuid,f=a.width,g=a.height,y=(null==i?void 0:i._texture)||{width:0,height:0},E=y.width,_=y.height,w=Math.max(f,E)+2,b=Math.max(g,_)+2;w<=1||b<=1?console.warn("DynamicAtlas: Skip invalid texture size",u,{w:w,h:b}):this.collectInfo[n]={id:n,w:w,h:b,x:-1,y:-1,usageCount:0,name:u}}},{key:"updateAtlasData",value:function(){if(!this.atlasInfo)return!1;if(this.lastAtlasInfo&&!this.forceUpdateDynamicAtlas){var n=this.isSameAtlas(this.lastAtlasInfo,this.atlasInfo);if(this.isEffective=!n,n)return console.warn("DynamicAtlas: Last update dynamic atlas is not effective"),!1}console.info("DynamicAtlas: atlas info",this.atlasInfo);var r=this.getAtlas();if(!r||!r._texture)return!1;var a=this.atlasInfo.packedInfo,i=r._texture,u=i.width,f=i.height,g=a.width+20,y=a.height+20,E=Math.max(g,y),_=tF?E:g;return(u!==_||f!==_)&&(ea.instance.reset(),!(!(r=this.getAtlas())||!r._texture)&&(tF?(r._texture.initWithSize(_,_),console.info("DynamicAtlas: Resize atlas (PO2)",_,r)):(r._texture.initWithSize(g,y),console.info("DynamicAtlas: Resize atlas",g,y,r)),this.lastAtlasInfo=tI.clone(this.atlasInfo),!0))}}]),e}();Q._RF.pop(),Q._RF.push({},"81e1aXDH2JE1q8DSm4X60UW","renderCustomResultChallenge",void 0);var tU=GameCore,tG=tU.Configs,tV=tU.Utils.Object,tz=tG.FrameCapture,tH=tz.Enabled,tq=tz.WideframeConfigs,tW="./public/wideframes",tj=function(){var n=E(function(n){var r,a,i,u,f;return _ts_generator(this,function(g){if(!tH)return[2,(console.warn("FrameCapture is not enabled"),null)];r=jt(n);if(!r)return[2,null];Kt(r,n,tq.CustomResultChallenge);a=window.game.frameCapture,i=tq.CustomResultChallenge,u=i.Width,f=i.Height;return[2,a.captureAsync({name:"ResultChallenge",width:u,height:f,renderOptions:r})]})});return function(r){return n.apply(this,arguments)}}(),jt=function(n){try{var r=n.playerId,a=void 0===r?"10":r,i=n.playerPhoto,u=void 0===i?"":i,f=n.playerScore,g=void 0===f?0:f,y=n.opponentId,E=void 0===y?"20":y,_=n.opponentPhoto,w=void 0===_?"":_,b=n.opponentScore,A=void 0===b?0:b,D=n.isPlayerFinished,k=n.isOpponentFinished,C=tq.CustomResultChallenge.RenderOptions,R=tV.clone(C);if(!R)return null;var T=tV.clear(R),F=tV.camelCaseKeys(T),L=F.playerPhoto,M=F.opponentPhoto,N=g===A,I=g>A,P=D&&k;"image"===L.type&&(L.name="".concat(a),L.image=u),"image"===M.type&&(M.name="".concat(E),M.image=w);var x=Qt(P,I,N);return Yt(F,n),Zt(F,x),Xt(F,x),F}catch(n){return console.warn("getRenderOptionsShareScore",n),null}},Kt=function(n,r,a){var i=a.Width,u=a.Height,f=r.isPlayerFinished,g=r.isOpponentFinished,y=f||g?"result-challenge":"custom-result-challenge";n.wideframe={name:y,type:"image",depth:0,image:"".concat(tW,"/").concat(y,".png"),size:[i,u],position:[0,0]}},Qt=function(n,r,a){return n?a?"draw":r?"win":"lose":"none"},Yt=function(n,r){var a=n.leftScore,i=n.rightScore,u=r.playerScore,f=void 0===u?0:u,g=r.opponentScore,y=void 0===g?0:g,E=r.isPlayerFinished,_=r.isOpponentFinished;(E||_)&&("text"===(null==a?void 0:a.type)&&(a.text=E?"".concat(f):""),"text"===(null==i?void 0:i.type)&&(i.text=_?"".concat(y):""))},Zt=function(n,r){if("none"!==r){n.MiddleImage={name:"middle-image",type:"image",depth:2,size:[92,63],position:[80,65],image:"".concat(tW,"/").concat(r,".png")};var a={win:{size:[277,144],position:[337.5,174]},lose:{size:[326,145],position:[313,173.5]},draw:{size:[390,144],position:[281,174]}};n.MiddleImage={name:"middle-image",type:"image",depth:2,size:a[r].size,position:a[r].position,image:"".concat(tW,"/images/").concat(r,".png")}}},Xt=function(n,r){if("none"!==r&&"draw"!==r)n.Crown={name:"crown-icon",type:"image",depth:2,size:[92,63],position:({win:[80,80],lose:[775,80]})[r],image:"".concat(tW,"/images/crown-icon.png")}};Q._RF.pop(),Q._RF.push({},"5cf47s8lohMlZGIaMKBpDK0","FrameCapture",void 0);var tK=globalThis.game.frameCapture,tQ=function(){function e(){g(this,e)}var n;return a(e,[{key:"init",value:(n=E(function(){return _ts_generator(this,function(n){tK.addWideframeRender("renderResultChallenge",tj),tK.addWideframeRender("renderShareScore",N);return[2]})}),function(){return n.apply(this,arguments)})}]),e}();Q._RF.pop(),Q._RF.push({},"2f36c+IsKJAU5s61TqQdaJ6","HybridFileCache",void 0);var tY=GameCore,tZ=tY.Events,tX=tY.Configs.GameEngine.HybridFileCache,tJ=tX.Enabled,t$=tX.PreviewMode,t0=tX.BuildMode,t1=tY.Utils,t2=t1.Object,t3=t1.Function,t4=t1.Json,t5=t1.Valid,t6=globalThis.game,t8=t6.event,t7=t6.storage,t9=t6.getBuildVersion,ne=Q.internal.CCON,nt=Q.resources,nn=Q.Material,nr=Q.builtinResMgr,na=J.instance,ni=na.downloader,ns=na.fetchPipeline,no=function(){function e(){var n=this;g(this,e),this.supportTypes=[],this.bundledFiles={},this.originDownloaders={},this.downloadFile=function(r){return function(a,i,u){var f=n.getCache(r,a);if(f)return u(null,f);var g=n.getDownloader(r);if(!g)return u(new Error("Downloader not found"),null);g(a,i,function(i,f){return i||n.setCache(r,a,f),u(i,f)})}},this.clearCache=function(){t7.setStorageData("HybridFileCache","cachedFiles",{}),t7.setStorageData("HybridFileCache","cachedBundles",{}),t7.setStorageData("HybridFileCache","cachedExtensions",{}),t7.updateToWebStorage("HybridFileCache")}}var n,r,u,f,y;return a(e,[{key:"init",value:(y=E(function(){return _ts_generator(this,function(n){switch(n.label){case 0:if(!(tJ&&!F))return[3,2];return[4,this.initStorage()];case 1:n.sent(),this.checkCacheVersion(),this.initSupportedTypes(),this.setupOptimalPipelines(),this.saveOriginDownloaders(),this.registerCustomDownloader(),this.setupBundledFiles(),this.listenEvents(),console.info("Hybrid File Cache: Initialized",{supportTypes:this.supportTypes});return[3,3];case 2:t8.emit(tZ.BUNDLE_READY);n.label=3;case 3:return[2]}})}),function(){return y.apply(this,arguments)})},{key:"initStorage",value:(f=E(function(){var n;return _ts_generator(this,function(r){switch(r.label){case 0:n=t9().toString();return[4,t7.addStorage("HybridFileCache",{buildVersion:n,cachedFiles:{},cachedBundles:{},cachedExtensions:{}},!0)];case 1:r.sent();return[2]}})}),function(){return f.apply(this,arguments)})},{key:"checkCacheVersion",value:function(){var n=t9().toString(),r=t7.getStorageData("HybridFileCache","buildVersion");t7.setStorageData("HybridFileCache","buildVersion",n),r!==n?this.clearCache():t7.updateToWebStorage("HybridFileCache")}},{key:"initSupportedTypes",value:function(){this.supportTypes=t0.SupportedExtensions}},{key:"setupBundledFiles",value:(u=E(function(){var n,r,a,i,u;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,,4,5]);r=[],a=M(this.supportTypes);try{for(a.s();!(n=a.n()).done;){i=n.value;this.getCachedBundles(i)||r.push(this.downloadBundledFile(i))}}catch(n){a.e(n)}finally{a.f()}u=r.length>0;if(!u)return[3,2];return[4,t3.allSettled(r)];case 1:u=f.sent();f.label=2;case 2:return[4,this.loadBundles()];case 3:f.sent();return[3,5];case 4:t8.emit(tZ.BUNDLE_READY);return[7];case 5:return[2]}})}),function(){return u.apply(this,arguments)})},{key:"downloadBundledFile",value:(r=E(function(n){var r,a,i,u,f;return _ts_generator(this,function(g){switch(g.label){case 0:g.trys.push([0,3,,4]);r=n.replace(".",""),a="./cache/bundle".concat(r.toUpperCase(),".").concat(r);"bundle"===n&&(a="./cache/bundleBUNDLE.json");return[4,fetch(a,{method:"GET",headers:{"Content-Type":"application/json"}})];case 1:i=g.sent();return[4,i.json()];case 2:u=g.sent();this.setBundledCache(n,u);return[3,4];case 3:f=g.sent();console.error("Hybrid File Cache: Downloaded bundled file",{type:n,error:f});return[3,4];case 4:return[2]}})}),function(n){return r.apply(this,arguments)})},{key:"loadBundles",value:(n=E(function(){var n,r,a,i,u,f;return _ts_generator(this,function(g){switch(g.label){case 0:n=this;g.label=1;case 1:g.trys.push([1,7,,8]);if(!this.supportTypes.includes("bundle"))return[2];r=[],a=function(){var a,f;return _ts_generator(this,function(g){a=u[i],f=new Promise(function(r,i){try{var u=n.getBundledCache("bundle","config:".concat(a));if(!u)return i(new Error("Bundle cache not found"));u.base="assets/".concat(a,"/");var f=ep.getBundle(a);f||(f="resources"===a?nt:new J.Bundle),f.init(u),ep.bundles.add(a,f),n.loadBundleAssets(a,f).then(r).catch(i)}catch(n){console.error("Hybrid File Cache: Load bundle assets",{name:a,error:n}),i(n)}});r.push(f);return[2]})},i=0,u=["internal","main","resources","animation"];g.label=2;case 2:if(!(i<u.length))return[3,5];return[5,_ts_values(a())];case 3:g.sent();g.label=4;case 4:i++;return[3,2];case 5:return[4,t3.allSettled(r)];case 6:g.sent();return[3,8];case 7:f=g.sent();console.error("Hybrid File Cache: loadBundleAssets",{error:f});return[3,8];case 8:return[2]}})}),function(){return n.apply(this,arguments)})},{key:"loadBundleAssets",value:function(n,r){return new Promise(function(a,i){if("internal"!==n)return a([]);var u=Object.values(r.config.paths.map).map(function(n){return n[0].uuid});if(u.length<1)return a([]);ep.loadAny(u,{},function(n,r){if(n)console.warn("Hybrid File Cache: Load internal assets",{err:n}),i(n);else{var u,f=M(r);try{for(f.s();!(u=f.n()).done;){var g=u.value;nr.addAsset(g.name,g),_instanceof(g,nn)&&nr._materialsToBeCompiled.push(g)}}catch(n){f.e(n)}finally{f.f()}nr.compileBuiltinMaterial()}a(r)})})}},{key:"setupOptimalPipelines",value:function(){var n=this;if(t$.Enabled)ns.insert(function(r,a){r.output=r.input;for(var i=0;i<r.input.length;i++){var u=r.input[i];if(u.uuid&&!u.isNative){var f=n.getCacheExtension(u.uuid);f&&(u.isNative=!0,u.isCached=!0,u.url=u.url.replace(u.ext,f),u.ext=f)}}a()},1),ns.insert(function(r,a){r.output=r.input;for(var i=0;i<r.input.length;i++){var u=r.input[i];u.uuid&&(u.isCached?u.isNative=!1:u.isNative||n.setCacheExtension(u.uuid,u.ext))}a()},3)}},{key:"saveOriginDownloaders",value:function(){var n,r=M(this.supportTypes);try{for(r.s();!(n=r.n()).done;){var a=n.value;this.originDownloaders[a]=ni._downloaders[a]}}catch(n){r.e(n)}finally{r.f()}}},{key:"registerCustomDownloader",value:function(){var n,r=M(this.supportTypes);try{for(r.s();!(n=r.n()).done;){var a=n.value;ni.register(a,this.downloadFile(a))}}catch(n){r.e(n)}finally{r.f()}}},{key:"listenEvents",value:function(){t8.on(tZ.SCENE_LOADED,function(){t7.updateToWebStorage("HybridFileCache")}),Y.on(i.CLEAR_HYBRID_FILE_CACHE,this.clearCache)}},{key:"getDownloader",value:function(n){var r;return null!==(r=this.originDownloaders[n])&&void 0!==r?r:null}},{key:"getCacheKey",value:function(n,r){var a=r.match(/.*\/([-a-z0-9@]+)\.([^\.]+)$/);if(!a)return null;var i=k(a,3),u=(i[0],i[1]),f=i[2];return!f||n.indexOf(f)<0?null:"".concat(u,":").concat(n)}},{key:"validateDataType",value:function(n,r){Array.isArray(r)&&t2.hasOwn(r[0],"__type__");return!(".cconb"===n&&t2.hasOwn(r,"chunks")&&!(Array.isArray(r.chunks)&&_instanceof(r,ne)))}},{key:"encodeData",value:function(n,r){return".cconb"===n?t2.hasOwn(r,"_document")&&t2.hasOwn(r,"_chunks")?new ne(r._document,r._chunks):null:r}},{key:"decodeData",value:function(n,r){if(".cconb"===n){if(!t2.hasOwn(r,"_document")||!t2.hasOwn(r,"_chunks"))return null;if(t5.isEmpty(r._chunks)||!Array.isArray(r._chunks))return null;var a,i=[],u=M(r._chunks);try{for(u.s();!(a=u.n()).done;){var f=a.value;_instanceof(f,Uint8Array)?i.push(f):i.push(new Uint8Array(Object.values(f)))}}catch(n){u.e(n)}finally{u.f()}return new ne(r._document,i)}return r}},{key:"setCache",value:function(n,r,a){var i=this.getCacheKey(n,r);if(i&&this.validateDataType(n,a)){var u=this.encodeData(n,a);t7.setStorageData("HybridFileCache","cachedFiles",I({},i,u))}}},{key:"getCache",value:function(n,r){var a=this.getCacheKey(n,r);if(!a)return null;var i=this.getFileCaches()[a];return i||(i=this.getBundledCache(n,a)),i?this.decodeData(n,i):null}},{key:"getFileCaches",value:function(){return t7.getStorageData("HybridFileCache","cachedFiles")}},{key:"getCachedBundles",value:function(n){var r=t7.getStorageData("HybridFileCache","cachedBundles");if(!r)return null;var a=t4.clone(r[n]);return a?(this.bundledFiles[n]=a,a):null}},{key:"getBundledCache",value:function(n,r){var a,i=this.bundledFiles[n];return i&&null!==(a=i[r.replace(":".concat(n),"")])&&void 0!==a?a:null}},{key:"setBundledCache",value:function(n,r){this.bundledFiles[n]=r,t7.setStorageData("HybridFileCache","cachedBundles",I({},n,r))}},{key:"getCacheExtension",value:function(n){return this.getCachedExtensions()[n]}},{key:"setCacheExtension",value:function(n,r){t7.setStorageData("HybridFileCache","cachedExtensions",I({},n,r))}},{key:"getCachedExtensions",value:function(){return t7.getStorageData("HybridFileCache","cachedExtensions")}}]),e}();Q._RF.pop(),Q._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var nc=GameCore,nu=nc.Events,nl=nc.Utils,nd=nl.Array,nh=nl.Browser,nf=nc.Configs.Languages.DetectPlayerLocale,np=globalThis.game,nv=np.player,nm=np.event,ng=np.language,ny=np.monitorError,nE=Object.keys(x),n_=function(){function e(){var n=this;g(this,e),this.handlePreloadLanguage=function(){var r=E(function(r){var a,i,u,f,g;return _ts_generator(this,function(y){switch(y.label){case 0:a=r.locale,i=r.onLoad,u=r.onError;if(!n.isSupportedLocale(a))return[3,5];y.label=1;case 1:y.trys.push([1,3,,4]);return[4,n.addLanguage(a)];case 2:y.sent(),null==i||i(a);return[3,4];case 3:f=y.sent();g=n.toError(f,"handleLanguageRequested");console.error(g),null==ny||ny.sendException(g),null==u||u(f);return[3,4];case 4:return[3,6];case 5:console.warn("Language ".concat(a," not found"));y.label=6;case 6:return[2]}})});return function(n){return r.apply(this,arguments)}}(),this.handleChooseLanguage=function(r){var a=r.locale,i=r.saveToPlayerData,u=void 0!==i&&i;if(n.isSupportedLocale(a))try{n.setLanguage(a,u)}catch(r){var f=n.toError(r,"handleLanguageRequested");console.error(f),null==ny||ny.sendException(f)}else console.warn("Language ".concat(a," not found"))},this.handleLanguageRequested=function(){var r=E(function(r){var a,i,u,f,g,y,E;return _ts_generator(this,function(_){switch(_.label){case 0:a=r.locale,i=r.saveToPlayerData,u=void 0!==i&&i,f=r.onLoad,g=r.onError;if(!n.isSupportedLocale(a))return[2,(console.warn("Language ".concat(a," not found")),void(null==g||g(new Error("Language ".concat(a," not found")))))];_.label=1;case 1:_.trys.push([1,3,,4]);return[4,n.addLanguage(a)];case 2:_.sent(),null==f||f(a),n.setLanguage(a,u);return[3,4];case 3:y=_.sent();E=n.toError(y,"handleLanguageRequested");console.error(E),null==ny||ny.sendException(E),null==g||g(E);return[3,4];case 4:return[2]}})});return function(n){return r.apply(this,arguments)}}()}var n,r,u,f,y;return a(e,[{key:"init",value:(y=E(function(){var n,r;return _ts_generator(this,function(a){switch(a.label){case 0:a.trys.push([0,3,,4]);return[4,this.initFallbackLanguage()];case 1:a.sent(),this.listenEvent();return[4,this.initPlayerLanguage()];case 2:a.sent();return[3,4];case 3:n=a.sent();r=this.toError(n,"handleLanguageRequested");console.error(r),null==ny||ny.sendException(r);return[3,4];case 4:return[2]}})}),function(){return y.apply(this,arguments)})},{key:"initFallbackLanguage",value:(f=E(function(){return _ts_generator(this,function(n){switch(n.label){case 0:return[4,this.addLanguage("en",!0)];case 1:n.sent(),this.setLanguage("en");return[2]}})}),function(){return f.apply(this,arguments)})},{key:"initPlayerLanguage",value:(u=E(function(){var n,r,a;return _ts_generator(this,function(i){switch(i.label){case 0:r=this.getPlayerLanguage();if(!this.isSupportedLocale(r))return[2,(console.warn("Language ".concat(r," not supported. Overriding with default language")),void this.setLanguage("en",!0))];return[4,this.addLanguage(r)];case 1:i.sent();a=null!==(n=nv.getPlayerDataByKey("isFirstLogin"))&&void 0!==n&&n;this.setLanguage(r,a);return[2]}})}),function(){return u.apply(this,arguments)})},{key:"getPlayerLanguage",value:function(){var n,r=this.getBrowserLanguage();return nv.getPlayerDataByKey("isFirstLogin")?r:null!==(n=nv.getPlayerSetting("language"))&&void 0!==n?n:r}},{key:"getBrowserLanguage",value:function(){if(!1===nf)return"en";var n=nh.getLocale(),r=null==n?void 0:n.trim();return null==r?void 0:r.split(/[-_]/)[0]}},{key:"isSupportedLocale",value:function(n){return nd.has(nE,n)}},{key:"listenEvent",value:function(){nm.on(nu.REQUEST_LANGUAGE,this.handleLanguageRequested),Y.on(nu.REQUEST_LANGUAGE,this.handleLanguageRequested),Y.on(i.PRELOAD_LANGUAGE,this.handlePreloadLanguage),Y.on(i.CHOOSE_LANGUAGE,this.handleChooseLanguage)}},{key:"addLanguage",value:(r=E(function(n){var r,a;var i=arguments;return _ts_generator(this,function(u){switch(u.label){case 0:r=i.length>1&&void 0!==i[1]&&i[1];return[4,this.getLangData(n)];case 1:a=u.sent();ng.add(n,a,r);return[2]}})}),function(n){return r.apply(this,arguments)})},{key:"setLanguage",value:function(n,r){var a=arguments.length>1&&void 0!==r&&r;if(ng.choose(n),a){var i=nv.getPlayerSettings(),u=P(P({},i),{},{language:n});nv.setPlayerDataByName("settings",u)}}},{key:"getLangData",value:(n=E(function(n){var r;return _ts_generator(this,function(a){switch(a.label){case 0:return[4,O.loadJsonAsync(x[n])];case 1:r=a.sent();if(null===r)throw new Error("Language ".concat(n," not found"));return[2,r]}})}),function(r){return n.apply(this,arguments)})},{key:"toError",value:function(n,r){return _instanceof(n,Error)?n:"string"==typeof n?new Error("LanguagePlugin: ".concat(n)):new Error("LanguagePlugin: Unknown error in module: <".concat(r,">"))}}]),e}();Q._RF.pop(),Q._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var nS=GameCore,nw=nS.Configs,nb=nw.Mockup,nA=nb.Leaderboards,nD=nb.GameSDK.Player,nk=nw.Leaderboards,nC=nS.Utils.Number,nR=globalThis.game.leaderboard,nT=function(){function e(){var n=this;g(this,e),this.handleWhenGameSDKStarted=function(){nA.Enabled?n.setupLeaderboardsMockup():n.setupLeaderboards()}}var n,r,i,u,f;return a(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(f=E(function(){return _ts_generator(this,function(n){this.setupLeaderboardByConfigs();return[2]})}),function(){return f.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var n=nk.LeaderboardId;n?(nR.addLeaderboard({name:B.GLOBAL,type:"global",autoSortRank:!0,leaderboardId:n}),nR.addLeaderboard({name:B.FRIENDS,type:"friends",autoSortRank:!0,leaderboardId:n})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(u=E(function(){return _ts_generator(this,function(n){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard();return[2]})}),function(){return u.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(i=E(function(){var n,r,a,i,u;return _ts_generator(this,function(f){switch(f.label){case 0:n=B.GLOBAL,r=G.GLOBAL,a=nA.NumOfLeaders;return[4,nR.createLeaderboardAsync({_id:r,name:n,numberOfLeaders:nC.random(a.Max-a.Min)+a.Min})];case 1:i=f.sent();nR.addLeaderboard({name:n,type:"global",autoSortRank:!0,leaderboardId:i});return[4,nR.requestLeaderboardAsync(n,10)];case 2:f.sent();u=nR.getLeaderboard(n);console.info("setupGlobalLeaderboard fetch new",u,u&&Object.keys(u.leaders).length),u=nR.getLeaderboard(n),console.info("setupGlobalLeaderboard load more",u,u&&Object.keys(u.leaders).length);return[2]}})}),function(){return i.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(r=E(function(){var n,r,a,i,u,f;return _ts_generator(this,function(g){switch(g.label){case 0:n=B.FRIENDS,r=G.FRIENDS,a=0,i=nD.ConnectedPlayers;i.Enabled&&(a=nC.random(i.NumOfPlayers-1)+1);return[4,nR.createLeaderboardAsync({_id:r,name:n,numberOfLeaders:a})];case 1:u=g.sent();nR.addLeaderboard({name:n,type:"friends",autoSortRank:!0,leaderboardId:u});return[4,nR.requestLeaderboardAsync(n,10)];case 2:g.sent();f=nR.getLeaderboard(n);console.info("setupFriendsLeaderboard done",f);return[2]}})}),function(){return r.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(n=E(function(){var n;return _ts_generator(this,function(r){switch(r.label){case 0:return[4,U.requestTournamentDataAsync()];case 1:n=r.sent();n.forEach(function(n){var r=n.payload.leaderboardId;r&&(nR.isExistLeaderboardId(r)||nR.addLeaderboard({type:"tournament",name:r,autoSortRank:!0,leaderboardId:r}))}),console.info("setupGlobalTournamentLeaderboard done",n);return[2]}})}),function(){return n.apply(this,arguments)})}]),e}();Q._RF.pop(),Q._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var nF=GameCore,nL=nF.Utils,nM=nF.Events,nN=nF.Configs.PerformanceMonitor.FpsTracking,nI=globalThis.game.event,nP=function(){function e(){var n=this;g(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){n.startTraceFps(),$.on(eo.EVENT_AFTER_UPDATE,n.handleLateUpdate)},this.handleLateUpdate=function(){if(n.mark){if(n.fpsTraceDuration-=Y.deltaTime,n.fpsTraceDuration<=0&&!n.traceStopped)return n.traceStopped=!0,n.unListenEvents(),n.updateFPS(),void n.mark.stop(n.markName);n.fpsTraceIntervalTimer-=Y.deltaTime,n.fpsTraceIntervalTimer>0||(n.fpsTraceIntervalTimer=n.fpsTraceInterval,n.updateFPS(),n.mark.stop(n.markName),n.startTraceFps())}}}return a(e,[{key:"mark",get:function(){return nN.Enabled?nL.Mark:null}},{key:"init",value:function(){var n=nN.TrackingDuration,r=nN.TrackingInterval;this.fpsTraceDuration=null!=n?n:60,this.fpsTraceInterval=null!=r?r:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){nI.catchUp(nM.GAME_READY,this.handleStartTraceFps)}},{key:"unListenEvents",value:function(){$.off(eo.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var n,r;if(this.mark){var a=this.getFPS(),i=this.getDrawCalls(),u=this.getDeviceRender(),f=this.getTextureMemory();this.minFps=Math.min(null!==(n=this.minFps)&&void 0!==n?n:a,a),this.maxFps=Math.max(null!==(r=this.maxFps)&&void 0!==r?r:0,a),this.mark.putMetric(this.markName,"FPS Metric",a),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",u),this.mark.putAttr(this.markName,"Draw Calls",i.toString()),this.mark.putAttr(this.markName,"Texture Memory",f.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info("FPS: ".concat(a," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(i,", texture memory: ").concat(f.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!$.root)return 0;var n=$.root.fps;return Math.floor(n)||0}},{key:"getDrawCalls",value:function(){return $.root&&$.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return $.root&&$.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return $.root&&$.root.device.memoryStatus.textureSize/1048576||0}}]),e}();Q._RF.pop(),Q._RF.push({},"d5789HUcoJBYr7E3NOGuQyN","Profiler",void 0);var nx=GameCore,nO=nx.Utils.Valid,nB=nx.Configs.Debugger.Profiler,nU=globalThis.game.event,nG=function(){function e(){var n=this;g(this,e),this.isUpdated=!1,this.isPost=!1,this.isDrawn=!1,this.isCommitted=!1,this.isRendered=!1,this.isFramed=!1,this.waitOptions={timeout:0,checkInterval:1},this.initState=function(){n.isFramed=!1,n.isUpdated=!1,n.isDrawn=!1,n.isCommitted=!1,n.isRendered=!1,n.isPost=!1},this.startTraceLoop=function(){n.clearLoopEvents(),n.initState(),n.useTickAsync(),n.listenLoopEvents()},this.handleBeginFrame=function(){n.measure("Frame",n.processBeginFrame)},this.processBeginFrame=E(function(){return _ts_generator(this,function(r){switch(r.label){case 0:n.isFramed=!1,console.time("Frame");return[4,nO.isValueChangeAsync(function(){return n.isFramed},!0,n.waitOptions)];case 1:r.sent(),console.timeEnd("Frame");return[2]}})}),this.handleBeforeUpdate=function(){n.measure("Update",n.processBeforeUpdate)},this.processBeforeUpdate=E(function(){return _ts_generator(this,function(r){switch(r.label){case 0:n.isUpdated=!1,console.time("Update");return[4,nO.isValueChangeAsync(function(){return n.isUpdated},!0,n.waitOptions)];case 1:r.sent(),console.timeEnd("Update");return[2]}})}),this.handleAfterUpdate=function(){n.isUpdated=!0},this.handleBeforeDraw=function(){n.measure("Draw",n.processBeforeDraw)},this.processBeforeDraw=E(function(){return _ts_generator(this,function(r){switch(r.label){case 0:n.isDrawn=!1,console.time("Draw");return[4,nO.isValueChangeAsync(function(){return n.isDrawn},!0,n.waitOptions)];case 1:r.sent(),console.timeEnd("Draw");return[2]}})}),this.handleBeforeCommit=function(){n.measure("Commit",n.processBeforeCommit)},this.processBeforeCommit=E(function(){return _ts_generator(this,function(r){switch(r.label){case 0:n.isCommitted=!1,console.time("Commit");return[4,nO.isValueChangeAsync(function(){return n.isCommitted},!0,n.waitOptions)];case 1:r.sent(),console.timeEnd("Commit");return[2]}})}),this.handleBeforeRender=function(){n.isCommitted=!0,n.measure("Render",n.processBeforeRender)},this.processBeforeRender=E(function(){return _ts_generator(this,function(r){switch(r.label){case 0:n.isRendered=!1,console.time("Render");return[4,nO.isValueChangeAsync(function(){return n.isRendered},!0,n.waitOptions)];case 1:r.sent(),console.timeEnd("Render");return[2]}})}),this.handleAfterRender=function(){n.isRendered=!0},this.handleAfterDraw=function(){n.isDrawn=!0,n.measure("Post",n.processPost)},this.processPost=E(function(){return _ts_generator(this,function(r){switch(r.label){case 0:n.isPost=!1,console.time("Post");return[4,nO.isValueChangeAsync(function(){return n.isPost},!0,n.waitOptions)];case 1:r.sent(),console.timeEnd("Post");return[2]}})}),this.handleEndFrame=function(){n.isPost=!0,n.isFramed=!0,n.restoreTick()}}var n,r;return a(e,[{key:"profiler",get:function(){return globalThis.game.profiler}},{key:"init",value:function(){nB.Enabled&&(this.initState(),this.addTickAsync(),this.listenEvents())}},{key:"addTickAsync",value:function(){var n=this;$.originalTick=$.tick,$.tickAsync=function(){var r=E(function(r){var a,i,u,f,g,y;return _ts_generator(this,function(E){switch(E.label){case 0:if(!!this._invalid)return[3,8];return[4,n.emitAsync(eo.EVENT_BEGIN_FRAME)];case 1:if(E.sent(),!!this._paused)return[3,4];return[4,n.emitAsync(eo.EVENT_BEFORE_UPDATE)];case 2:E.sent(),this._compScheduler.startPhase(),this._compScheduler.updatePhase(r);for(i=0;i<this._systems.length;++i)this._systems[i].update(r);this._compScheduler.lateUpdatePhase(r);return[4,n.emitAsync(eo.EVENT_AFTER_UPDATE)];case 3:E.sent(),ev._deferredDestroy();for(u=0;u<this._systems.length;++u)this._systems[u].postUpdate(r);E.label=4;case 4:return[4,n.emitAsync(eo.EVENT_BEFORE_DRAW)];case 5:E.sent();f=null===(a=$.getScene())||void 0===a?void 0:a.getComponentsInChildren("UIRenderer");if(!f)return[3,8];y=M(f);try{for(y.s();!(g=y.n()).done;)g.value.updateRenderer()}catch(n){y.e(n)}finally{y.f()}this._root.frameMove(r);return[4,n.emitAsync(eo.EVENT_AFTER_DRAW)];case 6:E.sent(),em.resetHasChangedFlags(),em.clearNodeArray();return[4,n.emitAsync(eo.EVENT_END_FRAME)];case 7:E.sent(),this._totalFrames++;E.label=8;case 8:return[2]}})});return function(n){return r.apply(this,arguments)}}()}},{key:"emitAsync",value:(r=E(function(n){var r,a,i,u,f,g,y;var E=arguments;return _ts_generator(this,function(_){switch(_.label){case 0:for(r=E.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=E[i];return[4,this.waitEvent.apply(this,[n].concat(a))];case 1:_.sent(),$.emit.apply($,[n].concat(a));f=this.getListeners(n),g=M(f);try{for(g.s();!(u=g.n()).done;){y=u.value;y.check=y.originalCheck}}catch(n){g.e(n)}finally{g.f()}return[2]}})}),function(n){return r.apply(this,arguments)})},{key:"useTickAsync",value:function(){$.tick=$.tickAsync}},{key:"restoreTick",value:function(){$.tick=$.originalTick}},{key:"getListeners",value:function(n){return $._callbackTable[n].callbackInfos||[]}},{key:"waitEvent",value:(n=E(function(n){var r,a,i,u,f;var g=arguments;return _ts_generator(this,function(y){for(r=g.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=g[i];u=this.getListeners(n);if(0!==u.length){f=u.map(function(r){var i=r.target,u=r.callback;return r.originalCheck||(r.originalCheck=r.check),r.check=function(){return!1},new Promise(function(r){var f="Wait ".concat(n," (").concat(i,":").concat(u.name,")");console.time(f),i?u.call.apply(u,[i].concat(a)):u.apply(void 0,a),r(!0),console.timeEnd(f)})});return[2,Promise.all(f)]}return[2]})}),function(r){return n.apply(this,arguments)})},{key:"listenEvents",value:function(){nU.on("render",this.startTraceLoop)}},{key:"listenLoopEvents",value:function(){$.once(eo.EVENT_BEGIN_FRAME,this.handleBeginFrame),$.once(eo.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),$.once(eo.EVENT_AFTER_UPDATE,this.handleAfterUpdate),$.once(eo.EVENT_BEFORE_DRAW,this.handleBeforeDraw),$.once(eo.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),$.once(eo.EVENT_BEFORE_RENDER,this.handleBeforeRender),$.once(eo.EVENT_AFTER_RENDER,this.handleAfterRender),$.once(eo.EVENT_AFTER_DRAW,this.handleAfterDraw),$.once(eo.EVENT_END_FRAME,this.handleEndFrame)}},{key:"clearLoopEvents",value:function(){$.off(eo.EVENT_BEGIN_FRAME,this.handleBeginFrame),$.off(eo.EVENT_BEFORE_UPDATE,this.handleBeforeUpdate),$.off(eo.EVENT_AFTER_UPDATE,this.handleAfterUpdate),$.off(eo.EVENT_BEFORE_DRAW,this.handleBeforeDraw),$.off(eo.EVENT_BEFORE_COMMIT,this.handleBeforeCommit),$.off(eo.EVENT_BEFORE_RENDER,this.handleBeforeRender),$.off(eo.EVENT_AFTER_RENDER,this.handleAfterRender),$.off(eo.EVENT_AFTER_DRAW,this.handleAfterDraw),$.off(eo.EVENT_END_FRAME,this.handleEndFrame)}},{key:"measure",value:function(n,r,a){var i,u=!(arguments.length>2&&void 0!==a)||a;null===(i=this.profiler)||void 0===i||i.measureCode({name:n,isAsync:u,profile:n,callback:r})}}]),e}();Q._RF.pop(),Q._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var nV=GameCore.Events,nz=globalThis.game.event,nH=function(){function e(){g(this,e),this.handleHotReload=function(){Y.restart()},this.handleUpdateConfig=function(n){if("Gameplay"===n.type){Y.emit(i.GAMEPLAY_UPDATE_CONFIG,n.config);var r=n.id,a=n.type;nz.emit(nV.REMOTE_CONFIG_UPDATED,{id:r,type:a})}}}return a(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){nz.on(nV.REQUEST_HOT_RELOAD,this.handleHotReload),nz.on(nV.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();Q._RF.pop(),Q._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var nq=function(){function e(){g(this,e)}return a(e,[{key:"init",value:function(){this.initCocosStats(),this.initDynamicAtlas(),this.initHybridFileCache(),console.info("Plugins Manager: Initialized")}},{key:"initProfiler",value:function(){(new nG).init()}},{key:"initLanguages",value:function(){(new n_).init()}},{key:"initCocosStats",value:function(){(new tm).init()}},{key:"initLeaderboards",value:function(){(new nT).init()}},{key:"initRemoteConfig",value:function(){(new nH).init()}},{key:"initDynamicAtlas",value:function(){(new tB).init()}},{key:"initDynamicAssets",value:function(){(new tk).init()}},{key:"initHybridFileCache",value:function(){(new no).init()}},{key:"initCanvasRecorder",value:function(){(new tv).init()}},{key:"initPerformanceMonitor",value:function(){(new nP).init()}},{key:"initAdaptivePerformance",value:function(){(new tf).init()}},{key:"initFrameCapture",value:function(){(new tQ).init()}}]),e}();Q._RF.pop(),Q._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var nW=globalThis.game,nj=nW.event,nK=nW.monitorError,nQ=GameCore,nY=nQ.Events,nZ=nQ.Configs.PerformanceMonitor,nX=nQ.Utils.Mark,nJ=function(){function e(){var n=this;g(this,e),this.markName="Load Scene",this.testScene={},this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var r=E(function(r){var a,i,u;return _ts_generator(this,function(f){a=r.sceneName,i=r.sceneData,u=n.correctSceneName(a);console.info("Switching",u,null!=i?i:{}),u&&(V.showLoadingFullScreen(u),n.startScene({sceneName:u,sceneData:i}));return[2]})});return function(n){return r.apply(this,arguments)}}(),this.preloadScene=function(r,a){var i=r.sceneName;n.startMeasure(r),$.preloadScene(i,n.onSceneProgress,n.onScenePreloaded(i,a))},this.startMeasure=function(r){if(n.mark){var a=r.sceneName,i=r.startScene;n.queueLoadScene[a]&&(n.mark.putAttr(n.markName,"Canceled","true"),n.stopMeasure(a)),console.groupCollapsed("\uD83D\uDCE6 ".concat(a,": ").concat(i?"start":"preload"," progress")),n.mark.measure(n.markName),n.mark.putAttr(n.markName,"Cancel","false"),n.mark.putAttr(n.markName,"Success","false"),n.mark.putMetric(n.markName,a),n.mark.start(n.markName),n.queueLoadScene[a]=!0}},this.stopMeasure=function(r){n.mark&&n.queueLoadScene[r]&&(n.mark.rmAttr(n.markName,"File"),n.mark.putAttr(n.markName,"Success","true"),n.mark.stop(n.markName),n.queueLoadScene[r]=!1,console.groupEnd())},this.onSceneProgress=function(r,a,i){var u=r/a;n.mark&&n.mark.putAttr(n.markName,"Last File","".concat(i.id," (").concat(i.ext,")"));var f=Math.floor(70*u+30);GameSDK.setLoadingProgress(f)},this.onScenePreloaded=function(n,r){return function(a){a?console.warn("SceneManager.onScenePreloaded",{sceneName:n,error:a}):(r&&r(n,a),nj.emit(nY.SCENE_LOADED,{sceneName:n,isPreload:!0}))}},this.onDirectorLoadScene=function(r){return function(a,i){if(a)console.warn("SceneManager.onSceneLoaded",a);else if(null!=i&&i.scene){var u=i.name;n.handleBeforeSceneLaunch(i,r)(),$.once(eo.EVENT_AFTER_SCENE_LAUNCH,n.handleSceneLaunched(u,r))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(r,a){return function(){n.setSceneData(r,null!=a?a:{}),Y.emit(i.REQUEST_VIEW_RESIZE),nj.emit(nY.SCENE_LOADED,{sceneName:r.name})}},this.handleSceneLaunched=function(r,a){return function(){var i;V.hideLoadingFullScreen(r),z.switchSceneTracking(),null==nK||nK.addMetadata({currentScene:r}),null===(i=n.callbackSwitchScene)||void 0===i||i.call(n,{sceneName:r,sceneData:a}),nj.emit(nY.SCENE_LAUNCHED,{sceneName:r})}},this.handleSceneLoaded=function(r){var a=r.sceneName;n.stopMeasure(a)},this.setTestScene=function(r){var a=r.sceneName;n.testScene[a]=!0}}return a(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){nj.catchUp(nY.MARK_IS_TEST_SCENE,this.setTestScene),nj.on(nY.SWITCH_SCENE,this.switchScene),nj.on(nY.PRELOAD_SCENE,this.preloadScene),nj.on(nY.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(n){var r=this.getCurrentScene(),a=this.getTestScene();return a&&(null==r?void 0:r.name)!==a?a:r&&n===r.name?null:n}},{key:"startScene",value:function(n){var r=this,a=n.sceneName,i=n.sceneData;this.preloadScene({sceneName:a,startScene:!0},function(n,u){n===a&&(u?console.warn("SceneManager.startScene",{sceneName:a,error:u}):$.loadScene(a,r.onDirectorLoadScene(i)))})}},{key:"mark",get:function(){return nZ.LoadResources?nX:null}},{key:"getCurrentScene",value:function(){return $.getScene()}},{key:"getTestScene",value:function(){var n;return null!==(n=Object.keys(this.testScene)[0])&&void 0!==n?n:null}},{key:"onSwitchScene",value:function(n){this.callbackSwitchScene=n}},{key:"setSceneData",value:function(n,r){if(r&&("data"in n||n.scene.attr({data:{}}),"data"in n)){var a=n.data||{};n.scene.attr({data:P(P({},a),r)}),console.info("SceneManager.setSceneData",{sceneName:n.name,sceneData:r,currentData:a})}}}]),e}();Q._RF.pop(),Q._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var n$=globalThis.game,n0=n$.event,n1=n$.monitorError,n2=GameCore,n3=n2.Events,n4=n2.Utils,n5=n4.Object,n6=n4.Valid,n8=function(){function e(){var n=this;g(this,e),this.screens={},this.queueInstantiatingScreens={},this.handleOpenScreen=function(r){var a=r.screenName,i=r.screenData;n.openScreen(a,i)},this.handleCloseScreen=function(r){var a=r.screenName;n.closeScreen(a)},this.handlePreloadScreens=function(){var r=$.getScene();r&&(n.initScreens(r),n.preloadScreens())}}var n,r,i,u;return a(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){n0.on(n3.OPEN_SCREEN,this.handleOpenScreen),n0.on(n3.CLOSE_SCREEN,this.handleCloseScreen),n0.on(n3.PRELOAD_SCREENS,this.handlePreloadScreens)}},{key:"initScreens",value:function(n){var r=n.getComponentsInChildren(H);if(!n6.isEmpty(r)){var a=r.map(function(n){return null==n?void 0:n.node.name}).join(", ");console.info("\uD83D\uDCFA Loaded Screens in ".concat(n.name,": ").concat(a)),this.addScreens(r)}var i=null==n?void 0:n.getComponentInChildren(q);if(i){var u=i.screenKeys.filter(function(n){return!r.some(function(r){return r.node.name===W[n]})});if(!n6.isEmpty(u)){var f=u.map(function(n){return W[n]}).join(", ");console.info("\uD83D\uDCFA Lazy-loading Screens in ".concat(n.name,": ").concat(f)),this.addScreenKeys(u,i.node)}}}},{key:"reorderScreens",value:function(){var n=n5.vals(this.screens).filter(function(n){return"ready"===n.state});n.sort(function(n,r){return n.order-r.order});for(var r=0;r<n.length;r++){var a=n[r];a&&(a.order=r,a.comp.node.setSiblingIndex(a.order))}}},{key:"addScreenKeys",value:function(n,r){var a=this;n.forEach(function(n,i){var u=W[n];a.screens[u]&&(a.screens[u].order=i),a.screens[W[n]]={state:"key",parent:r,key:n,order:i}})}},{key:"addScreens",value:function(n){var r=this;n.forEach(function(n,a){r.screens[n.node.name]={state:"ready",comp:n,order:a}})}},{key:"preloadScreens",value:(u=E(function(){var n;return _ts_generator(this,function(r){switch(r.label){case 0:n=n5.vals(this.screens).reduce(function(n,r){if("key"===r.state){var a=O.loadPrefabAsync("screens/".concat(W[r.key]));n.push(a)}return n},[]);return[4,Promise.all(n)];case 1:return[2,r.sent()]}})}),function(){return u.apply(this,arguments)})},{key:"getScreen",value:(i=E(function(n){var r,a,i,u,f,g,y;return _ts_generator(this,function(E){switch(E.label){case 0:r=this.screens[n];if(null==r)return[2,(null==n1||n1.sendException(new Error("ScreenManager.openScreen Screen ".concat(n," not found")),{screenName:n,screens:this.getScreensAsMetadata()}),null)];if("ready"===r.state)return[2,r.comp];console.info("ScreenManager.getScreen","Screen ".concat(n," not found in cache, instantiating it...")),this.queueInstantiatingScreens[n]=!0;a=r.parent,i=r.key,u=r.order;return[4,O.loadPrefabAsync("screens/".concat(W[i]))];case 1:f=E.sent();if(delete this.queueInstantiatingScreens[n],!f)return[2,(null==n1||n1.sendException(new Error("ScreenManager.getScreen: Failed to load Screen ".concat(n," prefab...")),{screenName:n,screens:this.getScreensAsMetadata()}),null)];g=eg(f);g.name=n,a.addChild(g),g.active=!1;y=g.getComponent(H);return[2,y?(this.screens[n]={state:"ready",comp:y,order:u},this.reorderScreens(),y):(null==n1||n1.sendException(new Error("ScreenManager.getScreen: Screen ".concat(n," prefab doesn't have BaseScreen component...")),{screenName:n,screens:this.getScreensAsMetadata()}),null)]}})}),function(n){return i.apply(this,arguments)})},{key:"getScreensAsMetadata",value:function(){var n=this;return Object.keys(this.screens).map(function(r){var a=n.screens[r];return a?"ready"===a.state?"".concat(a.comp.node.name,"(loaded)"):"".concat(W[a.key],"(not-loaded)"):null}).join(", ")}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:(r=E(function(n,r){var a,i,u;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,3,,4]);if(this.queueInstantiatingScreens[n])return[2];O.setBlockInput(!0);return[4,this.getScreen(n)];case 1:a=f.sent();if(O.setBlockInput(!1),null==a||!a.node)return[2,void console.warn("ScreenManager.openScreen","Screen ".concat(n," not found"))];a.node.active=!0,a.node.setPosition(new ey(0,0,0));i={screenName:n,screenData:r};n0.emit(n3.OPENING_SCREEN,i),z.trackCurrentPage(n,!0),null==n1||n1.addMetadata({currentScreen:n});return[4,j.waitTweenAsync(0)];case 2:f.sent(),a.open(r),n0.emit(n3.OPENED_SCREEN,i);return[3,4];case 3:u=f.sent();console.error("ScreenManager.openScreen",u);return[3,4];case 4:return[2]}})}),function(n,a){return r.apply(this,arguments)})},{key:"closeScreen",value:(n=E(function(n){var r,a,i,u;return _ts_generator(this,function(f){switch(f.label){case 0:f.trys.push([0,2,,3]);if(this.queueInstantiatingScreens[n])return[2];return[4,this.getScreen(n)];case 1:a=f.sent();if(!a)return[2,void console.warn("ScreenManager.closeScreen","Screen ".concat(n," not found"))];if(null===(r=a.node)||void 0===r||!r.active)return[2];i={screenName:n};n0.emit(n3.CLOSING_SCREEN,i),a.close(),z.trackCurrentPage(n,!1),null==n1||n1.removeMetadata("currentScreen");return[3,3];case 2:u=f.sent();console.error("ScreenManager.closeScreen",u);return[3,3];case 3:return[2]}})}),function(r){return n.apply(this,arguments)})},{key:"closeAllScreens",value:function(){for(var n in this.screens){var r=this.screens[n];r&&"ready"===r.state&&this.closeScreen(n)}}}]),e}();Q._RF.pop(),Q._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var n7=GameCore,n9=n7.Configs.Core,re=n7.Events,rt=n7.Plugins.Analytics.Events,rn=globalThis.game,rr=rn.context,ra=rn.storage,ri=rn.event,rs=rn.analytics,ro=rn.monitorError;new(function(){function e(){var n=this;g(this,e),this.coreManager=new eT,this.adsManager=new ek,this.matchManager=new e7,this.sceneManager=new nJ,this.screenManager=new n8,this.engineManager=new eB,this.layoutManager=new eX,this.playerManager=new ts,this.pluginsManager=new nq,this.handleWhenCoreBoot=function(){console.warn("Corecos System: Core boot",{inited:Y.inited,game:Y}),Y.inited?n.handleCocosInit():Y.once(eE.EVENT_GAME_INITED,n.handleCocosInit)},this.handleCocosInit=function(){n.coreManager.requestStart()},this.handleWhenCoreStart=function(){n.playerManager.setupDefaultGameData(),n.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){n.initPlugins(),console.groupEnd(),rs.event(rt.LOAD_START),ri.catchUp(re.BUNDLE_READY,n.processPreStartGame)},this.processPreStartGame=function(){ri.once(re.SCENE_LAUNCHED,n.handleBootSceneLaunched),n.runBootScene()},this.handleBootSceneLaunched=function(){n9.StartSDKAfterLoadGame?ri.once(re.SCENE_LOADED,n.handleStartGameWhenMainSceneReady):n.processStartGame()},this.preloadScenes=function(){"solo"===ra.getStorageData("context","sessionContextType")?K.preloadDashboardScene():K.preloadGameScene()},this.handleStartGameWhenMainSceneReady=function(){n.processStartGame()},this.handleSwitchScene=function(r){var a=r.sceneName,i=n.sceneManager.getCurrentScene();(null==i?void 0:i.name)===a&&i&&(n.screenManager.closeAllScreens(),n.screenManager.clearScreens(),n.screenManager.initScreens(i),n.screenManager.preloadScreens(),console.groupEnd())},this.startProcessContextData=E(function(){var r;return _ts_generator(this,function(a){switch(a.label){case 0:rs.event(rt.APP_READY);a.label=1;case 1:a.trys.push([1,3,4,5]);n.playerManager.requestConnectedPlayers();return[4,rr.processContextData()];case 2:a.sent();return[3,5];case 3:r=a.sent();console.error("startProcessContextData",r),_instanceof(r,Error)&&(null==ro||ro.sendException(r));return[3,5];case 4:ri.emit(re.GAME_READY);return[7];case 5:return[2]}})}),console.groupCollapsed("\uD83D\uDCE6 Corecos System"),console.info("Corecos Initializing..."),this.initManagers(),this.listenEvents(),console.groupEnd()}var n,r;return a(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.adsManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"runBootScene",value:function(){ri.once(re.SCENE_LOADED,this.preloadScenes),K.switchScene(y.BOOT_SCENE)}},{key:"processStartGame",value:(r=E(function(){return _ts_generator(this,function(n){switch(n.label){case 0:console.groupEnd(),rs.event(rt.LOAD_COMPLETE);return[4,this.startGameAsync()];case 1:n.sent(),ri.catchUp(re.PLAYER_INFO_LOADED,this.startProcessContextData);return[2]}})}),function(){return r.apply(this,arguments)})},{key:"startGameAsync",value:(n=E(function(){var n;return _ts_generator(this,function(r){switch(r.label){case 0:r.trys.push([0,2,,3]);return[4,GameSDK.startGameAsync()];case 1:r.sent();return[3,3];case 2:n=r.sent();console.warn("GameSDK.startGameAsync",n),_instanceof(n,Error)&&(null==ro||ro.sendException(n));return[3,3];case 3:return[2]}})}),function(){return n.apply(this,arguments)})},{key:"initPlugins",value:function(){this.pluginsManager.initProfiler(),this.pluginsManager.initLanguages(),this.pluginsManager.initLeaderboards(),this.pluginsManager.initFrameCapture(),this.pluginsManager.initDynamicAtlas(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),Q._RF.pop()}}});(function(n){n("virtual:///prerequisite-imports/systems","chunks:///systems.js")})(function(n,r){System.register(n,[r],function(n,r){return{setters:[function(r){var a={};for(var i in r)if("default"!==i&&"__esModule"!==i)a[i]=r[i];n(a)}],execute:function(){}}})});