System.register("chunks:///start-scene.js",["cc"],(function(e,t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b,w,k,S,E,C,T,A,x,R,I,P,_,L,O,D,N,M,F,B,G,U,z,H,q,V,W,K,j,Y,X,$,Q,J,Z,ee,te,ne,ie,ae,re,oe,se,le,ue,ce,he,pe,de,fe,ve,ye,me,ge,be,we;return{setters:[function(e){n=e.cclegacy,i=e._decorator,a=e.Node,r=e.Color,o=e.Canvas,s=e.UITransform,l=e.instantiate,u=e.Label,c=e.RichText,h=e.Toggle,p=e.Button,d=e.director,f=e.Component,v=e.isCCObject,y=e.Animation,m=e.CCString,g=e.CCInteger,b=e.AudioSource,w=e.resources,k=e.AudioClip,S=e.tween,E=e.CCFloat,C=e.Widget,T=e.Layout,A=e.Sprite,x=e.find,R=e.Prefab,I=e.JsonAsset,P=e.AnimationClip,_=e.ImageAsset,L=e.SpriteFrame,O=e.easing,D=e.UIOpacity,N=e.ccenum,M=e.view,F=e.screen,B=e.math,G=e.EventHandler,U=e.animation,z=e.CCBoolean,H=e.Input,q=e.Graphics,V=e.game,W=e.profiler,K=e.sys,j=e.Vec3,Y=e.ProgressBar,X=e.Font,$=e.Vec2,Q=e.Director,J=e.Layers,Z=e.randomRangeInt,ee=e.pseudoRandomRangeInt,te=e.pseudoRandom,ne=e.randomRange,ie=e.Pool,ae=e.ParticleSystem2D,re=e.HorizontalTextAlignment,oe=e.Tween,se=e.View,le=e.ScrollView,ue=e.Enum,ce=e.lerp,he=e.Mask,pe=e.AssetManager,de=e.DynamicAtlasManager,fe=e.macro,ve=e.settings,ye=e.Settings,me=e.ResolutionPolicy,ge=e.UIRenderer,be=e.Texture2D,we=e.Game}],execute:function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ke(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){Ie(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Se(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
Se=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var r=t&&t.prototype instanceof y?t:y,o=Object.create(r.prototype),s=new I(i||[]);return a(o,"_invoke",{value:T(e,n,s)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var p="suspendedStart",d="executing",f="completed",v={};function y(){}function m(){}function g(){}var b={};u(b,o,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(P([])));k&&k!==n&&i.call(k,o)&&(b=k);var S=g.prototype=y.prototype=Object.create(b);function E(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function C(e,t){function n(a,r,o,s){var l=h(e[a],e,r);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(c).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var r;a(this,"_invoke",{value:function(e,i){function a(){return new t((function(t,a){n(e,i,t,a)}))}return r=r?r.then(a,a):a()}})}function T(t,n,i){var a=p;return function(r,o){if(a===d)throw new Error("Generator is already running");if(a===f){if("throw"===r)throw o;return{value:e,done:!0}}for(i.method=r,i.arg=o;;){var s=i.delegate;if(s){var l=A(s,i);if(l){if(l===v)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===p)throw a=f,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=d;var u=h(t,n,i);if("normal"===u.type){if(a=i.done?f:"suspendedYield",u.arg===v)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(a=f,i.method="throw",i.arg=u.arg)}}}function A(t,n){var i=n.method,a=t.iterator[i];if(a===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,A(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),v;var r=h(a,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;var o=r.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function P(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,r=function n(){for(;++a<t.length;)if(i.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}throw new TypeError(typeof t+" is not iterable")}return m.prototype=g,a(S,"constructor",{value:g,configurable:!0}),a(g,"constructor",{value:m,configurable:!0}),m.displayName=u(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,u(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},E(C.prototype),u(C.prototype,s,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,i,a,r){void 0===r&&(r=Promise);var o=new C(c(e,n,i,a),r);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},E(S),u(S,l,"Generator"),u(S,o,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=P,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(i,a){return s.type="throw",s.arg=t,n.next=i,a&&(n.method="next",n.arg=e),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;R(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:P(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),v}},t}function Ee(){Ee=function(e,t){return new n(e,void 0,t)};var e=RegExp.prototype,t=new WeakMap;function n(e,i,a){var r=new RegExp(e,i);return t.set(r,a||t.get(e)),Le(r,n.prototype)}function i(e,n){var i=t.get(n);return Object.keys(i).reduce((function(t,n){var a=i[n];if("number"==typeof a)t[n]=e[a];else{for(var r=0;void 0===e[a[r]]&&r+1<a.length;)r++;t[n]=e[a[r]]}return t}),Object.create(null))}return Pe(n,RegExp),n.prototype.exec=function(t){var n=e.exec.call(this,t);if(n){n.groups=i(n,this);var a=n.indices;a&&(a.groups=i(a,this))}return n},n.prototype[Symbol.replace]=function(n,a){if("string"==typeof a){var r=t.get(this);return e[Symbol.replace].call(this,n,a.replace(/\$<([^>]+)>/g,(function(e,t){var n=r[t];return"$"+(Array.isArray(n)?n.join("$"):n)})))}if("function"==typeof a){var o=this;return e[Symbol.replace].call(this,n,(function(){var e=arguments;return"object"!=typeof e[e.length-1]&&(e=[].slice.call(e)).push(i(e,o)),a.apply(this,e)}))}return e[Symbol.replace].call(this,n,a)},Ee.apply(this,arguments)}function Ce(e,t,n,i,a,r,o){try{var s=e[r](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}function Te(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function o(e){Ce(r,i,a,o,s,"next",e)}function s(e){Ce(r,i,a,o,s,"throw",e)}o(void 0)}))}}function Ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Ye(i.key),i)}}function Re(e,t,n){return t&&xe(e.prototype,t),n&&xe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ie(e,t,n){return(t=Ye(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Le(e,t)}function _e(e){return(_e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Le(e,t){return(Le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Oe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function De(e,t,n){return(De=Oe()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&Le(a,n.prototype),a}).apply(null,arguments)}function Ne(e){var t="function"==typeof Map?new Map:void 0;return(Ne=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return De(e,arguments,_e(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Le(i,e)})(e)}function Me(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fe(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Me(e)}function Be(e){var t=Oe();return function(){var n,i=_e(e);if(t){var a=_e(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Fe(this,n)}}function Ge(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_e(e)););return e}function Ue(){return(Ue="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Ge(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}}).apply(this,arguments)}function ze(e,t,n,i){return(ze="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,i){var a,r=Ge(e,t);if(r){if((a=Object.getOwnPropertyDescriptor(r,t)).set)return a.set.call(i,n),!0;if(!a.writable)return!1}if(a=Object.getOwnPropertyDescriptor(i,t)){if(!a.writable)return!1;a.value=n,Object.defineProperty(i,t,a)}else Ie(i,t,n);return!0})(e,t,n,i)}function He(e,t,n,i,a){if(!ze(e,t,n,i||e)&&a)throw new TypeError("failed to set property");return n}function qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r,o,s=[],l=!0,u=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}(e,t)||We(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e){return function(e){if(Array.isArray(e))return Ke(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||We(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function We(e,t){if(e){if("string"==typeof e)return Ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ke(e,t):void 0}}function Ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function je(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=We(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}function Ye(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function Xe(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function $e(e,t,n,i,a){var r={};return Object.keys(i).forEach((function(e){r[e]=i[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),r),a&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(a):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var Qe,Je,Ze,et,tt,nt,it,at,rt;n._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var ot=i.ccclass,st=i.property;Qe=ot("internal.DebugViewRuntimeControl"),Je=st(a),Ze=st(a),et=st(a),Qe((it=$e((nt=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return Xe(e=t.call.apply(t,[this].concat(a)),"compositeModeToggle",it,Me(e)),Xe(e,"singleModeToggle",at,Me(e)),Xe(e,"EnableAllCompositeModeButton",rt,Me(e)),e._single=0,e.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],e.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],e.strMisc=["CSM Layer Coloration","Lighting With Albedo"],e.compositeModeToggleList=[],e.singleModeToggleList=[],e.miscModeToggleList=[],e.textComponentList=[],e.labelComponentList=[],e.textContentList=[],e._currentColorIndex=0,e.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],e.color=[r.WHITE,r.BLACK,r.RED,r.GREEN,r.BLUE],e}return Re(n,[{key:"start",value:function(){if(this.node.parent.getComponent(o)){var e=this.node.parent.getComponent(s),t=.5*e.width,n=.5*e.height,i=.1*t-t,a=n-.1*n,d=this.node.getChildByName("MiscMode"),f=l(d);f.parent=this.node,f.name="Buttons";var v=l(d);v.parent=this.node,v.name="Titles";for(var y=0;y<2;y++){var m=l(this.EnableAllCompositeModeButton.getChildByName("Label"));m.setPosition(i+(y>0?450:150),a,0),m.setScale(.75,.75,.75),m.parent=v;var g=m.getComponent(u);g.string=y?"----------Composite Mode----------":"----------Single Mode----------",g.color=r.WHITE,g.overflow=0,this.labelComponentList[this.labelComponentList.length]=g}a-=20;for(var b=0,w=0;w<this.strSingle.length;w++,b++){w===this.strSingle.length>>1&&(i+=200,b=0);var k=w?l(this.singleModeToggle):this.singleModeToggle;k.setPosition(i,a-20*b,0),k.setScale(.5,.5,.5),k.parent=this.singleModeToggle.parent;var S=k.getComponentInChildren(c);S.string=this.strSingle[w],this.textComponentList[this.textComponentList.length]=S,this.textContentList[this.textContentList.length]=S.string,k.on(h.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[w]=k}i+=200,this.EnableAllCompositeModeButton.setPosition(i+15,a,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(p.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=f;var E=this.EnableAllCompositeModeButton.getComponentInChildren(u);this.labelComponentList[this.labelComponentList.length]=E;var C=l(this.EnableAllCompositeModeButton);C.setPosition(i+90,a,0),C.setScale(.5,.5,.5),C.on(p.EventType.CLICK,this.changeTextColor,this),C.parent=f,(E=C.getComponentInChildren(u)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=E;var T=l(this.EnableAllCompositeModeButton);T.setPosition(i+200,a,0),T.setScale(.5,.5,.5),T.on(p.EventType.CLICK,this.hideUI,this),T.parent=this.node.parent,(E=T.getComponentInChildren(u)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=E,this.hideButtonLabel=E,a-=40;for(var A=0;A<this.strMisc.length;A++){var x=l(this.compositeModeToggle);x.setPosition(i,a-20*A,0),x.setScale(.5,.5,.5),x.parent=d;var R=x.getComponentInChildren(c);R.string=this.strMisc[A],this.textComponentList[this.textComponentList.length]=R,this.textContentList[this.textContentList.length]=R.string,x.getComponent(h).isChecked=!!A,x.on(h.EventType.TOGGLE,A?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[A]=x}a-=150;for(var I=0;I<this.strComposite.length;I++){var P=I?l(this.compositeModeToggle):this.compositeModeToggle;P.setPosition(i,a-20*I,0),P.setScale(.5,.5,.5),P.parent=this.compositeModeToggle.parent;var _=P.getComponentInChildren(c);_.string=this.strComposite[I],this.textComponentList[this.textComponentList.length]=_,this.textContentList[this.textContentList.length]=_.string,P.on(h.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[I]=P}}else console.error("debug-view-runtime-control should be child of Canvas")}},{key:"isTextMatched",value:function(e,t){var n=new String(e),i=n.search(">");return-1===i?e===t:(n=(n=n.substr(i+1)).substr(0,n.search("<")))===t}},{key:"toggleSingleMode",value:function(e){for(var t=d.root.debugView,n=e.getComponentInChildren(c),i=0;i<this.strSingle.length;i++)this.isTextMatched(n.string,this.strSingle[i])&&(t.singleMode=i)}},{key:"toggleCompositeMode",value:function(e){for(var t=d.root.debugView,n=e.getComponentInChildren(c),i=0;i<this.strComposite.length;i++)this.isTextMatched(n.string,this.strComposite[i])&&t.enableCompositeMode(i,e.isChecked)}},{key:"toggleLightingWithAlbedo",value:function(e){d.root.debugView.lightingWithAlbedo=e.isChecked}},{key:"toggleCSMColoration",value:function(e){d.root.debugView.csmLayerColoration=e.isChecked}},{key:"enableAllCompositeMode",value:function(e){var t=d.root.debugView;t.enableAllCompositeMode(!0);for(var n=0;n<this.compositeModeToggleList.length;n++){this.compositeModeToggleList[n].getComponent(h).isChecked=!0}var i=this.miscModeToggleList[0].getComponent(h);i.isChecked=!1,t.csmLayerColoration=!1,(i=this.miscModeToggleList[1].getComponent(h)).isChecked=!0,t.lightingWithAlbedo=!0}},{key:"hideUI",value:function(e){var t=this.node.getChildByName("Titles"),n=!t.active;this.singleModeToggleList[0].parent.active=n,this.miscModeToggleList[0].parent.active=n,this.compositeModeToggleList[0].parent.active=n,this.EnableAllCompositeModeButton.parent.active=n,t.active=n,this.hideButtonLabel.string=n?"Hide UI":"Show UI"}},{key:"changeTextColor",value:function(e){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var t=0;t<this.textComponentList.length;t++)this.textComponentList[t].string=this.strColor[this._currentColorIndex]+this.textContentList[t]+"</color>";for(var n=0;n<this.labelComponentList.length;n++)this.labelComponentList[n].color=this.color[this._currentColorIndex]}},{key:"onLoad",value:function(){}},{key:"update",value:function(e){}}]),n}(f)).prototype,"compositeModeToggle",[Je],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=$e(nt.prototype,"singleModeToggle",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=$e(nt.prototype,"EnableAllCompositeModeButton",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=nt));n._RF.pop(),n._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);var lt,ut,ct,ht,pt,dt,ft,vt,yt,mt=GameCore.Utils,gt=mt.Array,bt=mt.Object,wt=mt.Valid,kt=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"],St=function(){function e(){Ae(this,e),this.validComponentCalled={}}return Re(e,[{key:"validateRequiredComponents",value:function(e){var t,n=e.name,i=e.constructor,a=je(this.getRequiredComponentNames(i));try{for(a.s();!(t=a.n()).done;){var r=t.value;if(!e.getComponent(r))throw new Error(`${n}: Missing required ${r} component`)}}catch(e){a.e(e)}finally{a.f()}}},{key:"validateRequiredProperties",value:function(e){var t,n=e.name,i=e.constructor,a=je(this.getRequiredPropNames(i));try{for(a.s();!(t=a.n()).done;){var r=t.value;if(!bt.hasOwn(e,r))throw new Error(`${n}: Missing required ${r} property`);var o=this.getProperty(r,e);if(!v(o))throw new Error(`${n}: ${r} property is not a cc object`)}}catch(e){a.e(e)}finally{a.f()}}},{key:"validateCustomProperties",value:function(e){var t,n=e.name,i=je(this.getCustomPropNames(e));try{for(i.s();!(t=i.n()).done;){var a=t.value;if(!bt.hasOwn(e,a))throw new Error(`${n}: Missing required ${a} property`);var r=this.getProperty(a,e);if(!v(r))throw new Error(`${n}: ${a} property is not a cc object`)}}catch(e){i.e(e)}finally{i.f()}}},{key:"getProperty",value:function(e,t){var n;if(bt.hasOwn(t,e))return(null!==(n=Object.getOwnPropertyDescriptor(t,e))&&void 0!==n?n:{}).value}},{key:"getProps",value:function(e){if(!bt.hasOwn(e,"__props__"))return[];var t=e.__props__;return Array.isArray(t)?t:[]}},{key:"getRequiredPropNames",value:function(e){return this.getProps(e).filter((function(t){return"node"!==t&&(!!bt.hasOwn(e,t)&&(!!v(e[t])&&!t.startsWith("_")))}))}},{key:"getBaseComponentName",value:function(e){for(var t=0,n=kt;t<n.length;t++){var i=n[t];if(i.indexOf(e)>=0)return i}return e}},{key:"getRequiredComponentNames",value:function(e){var t=this;if(!bt.hasOwn(e,"_requireComponent"))return[];var n=e._requireComponent;return Array.isArray(n)?n.map((function(e){return t.getBaseComponentName(e)})):[]}},{key:"getCustomPropNames",value:function(e){var t=this,n=Object.keys(e),i=this.getProps(e.constructor);return gt.difference(n,i).filter((function(e){return!e.startsWith("_")})).filter((function(n){if(!bt.hasOwn(e,n))return!1;var i=t.getProperty(n,e);return!(!wt.isObject(i)||!v(i))}))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"lazyValidateProperties",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t){var n=e.constructor,i=n.name;if(!this.inst.validComponentCalled[i])try{this.inst.validateRequiredComponents(e),this.inst.validateRequiredProperties(e),this.inst.validateCustomProperties(e)}catch(t){e.enabled=!1,console.error(t)}finally{this.inst.validComponentCalled[i]=!0}}}}]),e}();try{new St}catch(e){console.error("ComponentUtils",e)}n._RF.pop(),n._RF.push({},"60ac3vor0dMT5bXi8D3VSJN","BubbleAnimation",void 0);var Et=i.ccclass,Ct=i.property;lt=Et("BubbleAnimation"),ut=Ct(y),ct=Ct(m),ht=Ct(g),lt((ft=$e((dt=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"animation",ft,Me(e)),Xe(e,"clipName",vt,Me(e)),Xe(e,"repeat",yt,Me(e)),e.currentRepeat=-1,e}return Re(n,[{key:"__preload",value:function(){this.animation=this.getComponent(y),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"play",value:function(){var e=this;this.animation&&(this.animation.clips.find((function(t){return(null==t?void 0:t.name)===e.clipName}))?(this.currentRepeat=-1,this.animation.play(this.clipName)):console.warn(`BubbleAnimation: Animation component must have ${this.clipName} clip`))}},{key:"onBubbleAnimationLoop",value:function(){this.animation&&-1!==this.repeat&&(this.currentRepeat++,this.currentRepeat>this.repeat&&this.animation.stop())}}]),n}(f)).prototype,"animation",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vt=$e(dt.prototype,"clipName",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Bubble"}}),yt=$e(dt.prototype,"repeat",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),pt=dt));n._RF.pop(),n._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var Tt=function(e){Pe(n,GameCore.Plugins.Audio.BaseAudioPlayer);var t=Be(n);function n(e,i){var a;return Ae(this,n),(a=t.call(this,e)).audioSource=i,a}return Re(n,[{key:"play",value:function(e){if(e){var t=e.volume,n=void 0===t?1:t,i=e.loop,a=void 0!==i&&i;this.audioSource.volume=n,this.audioSource.loop=a}this.audioSource.play()}},{key:"pause",value:function(){this.audioSource.pause()}},{key:"resume",value:function(){this.audioSource.state===b.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function(){this.audioSource.stop()}},{key:"setVolume",value:function(e){this.audioSource.volume=e}},{key:"getAudioSource",value:function(){return this.audioSource}}]),n}();n._RF.pop(),n._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var At=function(e){Pe(i,e);var t,n=Be(i);function i(e,t){var a;return Ae(this,i),(a=n.call(this,t)).allowMultipleTracking={},a.handleLoadedAudio=function(e,t){var n=a.node.addComponent(b);return n.clip=t,n.playOnAwake=!1,new Tt(e,n)},a.node=e,a}return Re(i,[{key:"playing",value:function(e){var t,n=null===(t=this.getAudioClip(e))||void 0===t?void 0:t.audioPlayer;return!!n&&n.getAudioSource().state===b.AudioState.PLAYING}},{key:"onLoadAudio",value:(t=Te(Se().mark((function e(t,n){var i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){w.load(t,k,(function(a,r){try{if(a)throw new Error(a.message);if(!i.node.isValid)return;var o=i.handleLoadedAudio(t,r);e(o)}catch(a){a instanceof Error?n(a):n(new Error("Audio load: Unknown error"))}}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"playWithRealConfig",value:function(e,t){if(this.isCanPlay(t)){if(t){var n=t.volume,i=void 0===n?1:n,a=t.allowMultiple,r=void 0!==a&&a;if(t.volume=this.getVolume()*i,r)return void this.requestDuplicateAudioPlayer(e.getKey(),e.getAudioSource().clip,t).play(t)}e.play(t)}}},{key:"isCanPlay",value:function(e){var t=this;if(e){var n=e.checkList;if((void 0===n?[]:n).some((function(e){var n=t.getAudioClip(e);return!!n&&n.audioPlayer.getAudioSource().state===b.AudioState.PLAYING})))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function(e,t,n){var i=this.getDuplicateAudioFromPool(e);if(i){if(n){var a=i.key,r=n.volume,o=void 0===r?1:r;this.setAudioClip(a,{volume:o})}return i.audioPlayer}var s=`${e}_${this.allowMultipleTracking[e].currentPostFix}`,l=this.handleLoadedAudio(s,t);return this.allowMultipleTracking[e].list.push({audioPlayer:l,key:s}),this.allowMultipleTracking[e].currentPostFix+=1,this.setAudioClip(s,{audioPlayer:l,volume:1}),l}},{key:"getDuplicateAudioFromPool",value:function(e){if(this.allowMultipleTracking[e]){var t=this.allowMultipleTracking[e].list.find((function(e){return e.audioPlayer.getAudioSource().state!==b.AudioState.PLAYING}));if(t)return t}else this.allowMultipleTracking[e]={currentPostFix:1,list:[]};return null}}]),i}(GameCore.Plugins.Audio.BaseChannelManager);n._RF.pop();var xt,Rt,It,Pt,_t;n._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var Lt,Ot,Dt,Nt,Mt,Ft=i.ccclass,Bt=i.property,Gt=globalThis.game,Ut=Gt.audio,zt=Gt.player,Ht=(xt=Ft("Music"),Rt=Bt(m),xt((_t=$e((Pt=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"channelId",_t,Me(e)),e.channel=null,e}return Re(n,[{key:"__preload",value:function(){this.makePersistent(),this.channel=new At(this.node,this.channelId),Ut.addChannel(this.channel)}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"playing",value:function(e){var t,n;return null!==(t=null===(n=this.channel)||void 0===n?void 0:n.playing(e))&&void 0!==t&&t}},{key:"play",value:function(e,t){var n;this.isMusicEnable()&&(null!==(n=t)&&void 0!==n&&n.loop||(t=ke(ke({},t),{},{loop:!0})),Ut.play(e,t,this.channelId))}},{key:"isMusicEnable",value:function(){return!!zt.getPlayerSetting("music")}},{key:"setVolume",value:function(e){Ut.setVolume(e,this.channelId)}},{key:"pause",value:function(e){Ut.pause(e,this.channelId)}},{key:"resume",value:function(e){this.isMusicEnable()&&Ut.resume(e,this.channelId)}},{key:"stop",value:function(e){Ut.stop(e,this.channelId)}},{key:"mute",value:function(e){e?Ut.mute(this.channelId):Ut.unmute(this.channelId)}}]),n}(f)).prototype,"channelId",[Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),It=Pt))||It);n._RF.pop(),n._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var qt=i.ccclass,Vt=i.property,Wt=globalThis.game,Kt=Wt.audio,jt=Wt.player,Yt=(Lt=qt("Sound"),Ot=Vt(m),Lt((Mt=$e((Nt=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"channelId",Mt,Me(e)),e.channel=null,e}return Re(n,[{key:"__preload",value:function(){this.channel=new At(this.node,this.channelId),Kt.addChannel(this.channel)}},{key:"onLoad",value:function(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"removePersistent",value:function(){d.removePersistRootNode(this.node)}},{key:"play",value:function(e,t){this.isSoundEnable()&&Kt.play(e,t,this.channelId)}},{key:"isSoundEnable",value:function(){return!!jt.getPlayerSetting("sound")}},{key:"setVolume",value:function(e){Kt.setVolume(e,this.channelId)}},{key:"pause",value:function(e){Kt.pause(e,this.channelId)}},{key:"resume",value:function(e){this.isSoundEnable()&&Kt.resume(e,this.channelId)}},{key:"stop",value:function(e){Kt.stop(e,this.channelId)}},{key:"stopAll",value:function(){Kt.stopAll(this.channelId)}},{key:"mute",value:function(e){e?Kt.mute(this.channelId):Kt.unmute(this.channelId)}}]),n}(f)).prototype,"channelId",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Dt=Nt))||Dt);n._RF.pop(),n._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);var Xt,$t,Qt,Jt,Zt,en,tn,nn,an,rn,on,sn,ln,un,cn,hn,pn,dn,fn,vn,yn=function(){function e(){Ae(this,e)}return Re(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"elasticOut",value:function(e,t,n){if(void 0===t&&(t=.1),void 0===n&&(n=.1),0===e)return 0;if(1===e)return 1;var i=n/4;return t<1?t=1:i=n*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*e)*Math.sin((e-i)*(2*Math.PI)/n)+1}},{key:"easeOutExpo",value:function(e){return 1===e?1:1-Math.pow(2,-10*e)}},{key:"easeInExpo",value:function(e){return 0===e?0:Math.pow(2,10*e-10)}},{key:"runTweenAsync",value:function(e,t){return new Promise((function(n){var i=e.call((function(){n({tween:e})})).start();t&&(t.aborted?(i.stop(),n({tween:e})):t.addAbortListener((function(){i.stop(),n({tween:e})})))}))}},{key:"waitTweenAsync",value:function(e,t){return new Promise((function(n){var i=S({});i.delay(e),i.call((function(){n()})),i.start(),t&&(t.aborted?(i.stop(),n()):t.addAbortListener((function(){i.stop(),n()})))}))}},{key:"runAnimationAsync",value:function(e,t){return new Promise((function(n){e.play(t),e.once(y.EventType.FINISHED,(function(){n()}))}))}}]),e}();try{new yn}catch(e){console.error("AnimUtils",e)}n._RF.pop(),n._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var mn,gn,bn,wn,kn,Sn=i.ccclass,En=i.property,Cn=(Xt=Sn("AutoLayoutWrappee"),$t=En({type:s}),Qt=En({type:s}),Xt((en=$e((Zt=Re((function e(){Ae(this,e),Xe(this,"wrapeeContainer",en,this),Xe(this,"wrapee",tn,this)}))).prototype,"wrapeeContainer",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tn=$e(Zt.prototype,"wrapee",[Qt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jt=Zt))||Jt),Tn=(nn=Sn("AutoLayout"),an=En({displayName:"Use Auto Layout"}),rn=En({type:[Cn],displayName:"Children",visible(){return this.useAutoLayout}}),on=En({visible:!1,serializable:!0}),sn=En({type:g,displayName:"Selected Index",visible(){return this.useAutoLayout}}),ln=En({type:E,displayName:"Deselected Icon Width",group:"Edge Icons",visible(){return this.useAutoLayout}}),un=En({visible:!1,serializable:!0}),nn((pn=$e((hn=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"useAutoLayout",pn,Me(e)),Xe(e,"children",dn,Me(e)),e.mappedChildren=[],Xe(e,"selected",fn,Me(e)),Xe(e,"deselectedIconW",vn,Me(e)),e.tweens=[],e}return Re(i,[{key:"selectedIndex",get:function(){return this.selected},set:function(e){this.selected=e,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(e){this.deselectedIconW=e,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map((function(e){var t=e.wrapeeContainer.getComponent(C);if(!t)throw new Error("AutoLayout: Widget component not found");return ke(ke({},e),{},{wrapeeContainerWidget:t})}))}},{key:"updateLayout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._layoutDirty||e)&&(this.updateChildrenAnchors(),this.mappedChildren.forEach((function(e){return e.wrapeeContainerWidget.updateAlignment()}))),Ue(_e(i.prototype),"updateLayout",this).call(this,e)}},{key:"getSelectedWorldX",value:function(){var e=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?e.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*e.width:e.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(e){if(e<this.selectedIndex)return 0;if(e>this.selectedIndex)return 1;if(0===e){var t=this.mappedChildren[e].wrapeeContainer.width,n=this.deselectedIconWidth/2,i=this.paddingLeft;return((i+t+(t-n+this.spacingX))/2-i)/t}if(e===this.children.length-1){var a=this.mappedChildren[e].wrapeeContainer.width,r=a-this.deselectedIconWidth/2+this.spacingX;return((r+a+this.paddingRight)/2-r)/a}return.5}},{key:"updateChildrenAnchors",value:(t=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tweens.forEach((function(e){return e.stop()})),this.tweens=[],e.next=4,Promise.all([this.children.flatMap((function(e,n){return t.getChildrenAnchorsTweens(e,t.getAnchorX(n))})).map((function(e){return yn.runTweenAsync(e)}))]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var e=this;this.children.forEach((function(t,n){var i=e.getAnchorX(n);t.wrapee.setAnchorPoint(i,t.wrapee.anchorY),t.wrapeeContainer.setAnchorPoint(i,t.wrapeeContainer.anchorY)}))}},{key:"getChildrenAnchorsTweens",value:function(e,t){return[S(e.wrapee).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapee.setAnchorPoint(t,e.wrapee.anchorY)})),S(e.wrapeeContainer).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapeeContainer.setAnchorPoint(t,e.wrapeeContainer.anchorY)}))]}}]),i}(T)).prototype,"useAutoLayout",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),dn=$e(hn.prototype,"children",[rn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fn=$e(hn.prototype,"selected",[on],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$e(hn.prototype,"selectedIndex",[sn],Object.getOwnPropertyDescriptor(hn.prototype,"selectedIndex"),hn.prototype),$e(hn.prototype,"deselectedIconWidth",[ln],Object.getOwnPropertyDescriptor(hn.prototype,"deselectedIconWidth"),hn.prototype),vn=$e(hn.prototype,"deselectedIconW",[un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cn=hn))||cn);n._RF.pop(),n._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);var An=i.ccclass,xn=i.property;mn=An("Background"),gn=xn({type:A}),mn((kn=$e((wn=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"sprite",kn,Me(e)),e}return Re(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){}}]),n}(f)).prototype,"sprite",[gn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bn=wn));n._RF.pop(),n._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var Rn=function(e){return e.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",e.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",e.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",e.COLLECTIONS_CONTENT_PREFAB="game-objects/dashboard-scene/CollectionsContent",e.CLOUD_IDLE_ANIM="animations/CloudIdle",e.TORNADO_IDLE_ANIM="animations/TornadoIdle",e.TILE_BREAK_ANIM="animations/TileBreak",e.TILE_CLEAR_ANIM="animations/TileClear",e.TILE_SHAKE_ANIM="animations/TileShake",e.TILE_SKIN_FOLDER="loadable/tiles",e.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",e.ITEM_POPUP_FOLDER="loadable/item-popup",e.SUMMER_BG="images/bg/summer",e.AUTUMN_BG="images/bg/autumn",e.WINTER_BG="images/bg/winter",e.SUMMER_BG_PREVIEW="images/preview/summer",e.AUTUMN_BG_PREVIEW="images/preview/autumn",e.WINTER_BG_PREVIEW="images/preview/winter",e.COLLECTIONS_PAGE="pages/CollectionsContent",e.LEADERBOARD_PAGE="pages/LeaderboardContent",e.TOURNAMENTS_PAGE="pages/TournamentsContent",e.LEVEL_DATA_FOLDER="levels-json",e}(Rn||{});n._RF.pop(),n._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);var In={summer:Rn.SUMMER_BG,autumn:Rn.AUTUMN_BG,winter:Rn.WINTER_BG},Pn={summer:Rn.SUMMER_BG_PREVIEW,autumn:Rn.AUTUMN_BG_PREVIEW,winter:Rn.WINTER_BG_PREVIEW};n._RF.pop(),n._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);var _n,Ln,On,Dn,Nn,Mn,Fn,Bn=function(){function e(){Ae(this,e)}var t,n,i,a,r,o,s,l,u,c;return Re(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"setBlockInput",value:function(e){var t=x("Canvas/InputBlocker");t?t.active=e:console.warn("InputBlocker not found")}},{key:"getBlockInput",value:function(){var e=x("Canvas/InputBlocker");return e?e.active:(console.warn("InputBlocker not found"),!1)}},{key:"loadPrefabAsync",value:function(e){var t=w.getInfoWithPath(e,R);if(t&&null!==w.get(t.path,R)){var n=w.get(t.path,R);if(null!==n)return Promise.resolve(n)}return new Promise((function(t){w.load(e,R,(function(e,n){e&&t(null),t(n)}))}))}},{key:"loadJsonAsync",value:(c=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=w.getInfoWithPath(t,I);if(n&&null!==w.get(n.path,I)){var i=w.get(n.path,I);null!==i&&e(i.json)}w.load(t,I,(function(t,n){t&&e(null),n&&n.json||e(null),e(n.json)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"loadAnimClipAsync",value:(u=Te(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=w.getInfoWithPath(t,P))||null===w.get(n.path,P)){e.next=5;break}if(null===(i=w.get(n.path,P))){e.next=5;break}return e.abrupt("return",Promise.resolve(i));case 5:return e.abrupt("return",new Promise((function(e){w.load(t,P,(function(t,n){t&&e(null),e(n)}))})));case 6:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"loadImageSpriteFrameAsync",value:(l=Te(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=w.getInfoWithPath(t,_))||null===w.get(n.path,_)){e.next=5;break}if(null===(i=w.get(n.path,_))){e.next=5;break}return e.abrupt("return",Promise.resolve(L.createWithImage(i)));case 5:return e.abrupt("return",new Promise((function(e){w.load(t,_,(function(t,n){t&&e(null),e(L.createWithImage(n))}))})));case 6:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"loadSpriteFrameAsync",value:(s=Te(Se().mark((function e(t){var n,i,a,r=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(r.length>1&&void 0!==r[1])||r[1],!(i=w.getInfoWithPath(t,L))||null===w.get(i.path,L)){e.next=7;break}if(null===(a=w.get(i.path,L))){e.next=7;break}return a.packable=n,e.abrupt("return",Promise.resolve(a));case 7:return e.abrupt("return",new Promise((function(e){w.load(t,L,(function(t,i){!t&&i?(i.packable=n,e(i)):e(null)}))})));case 8:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"loadSpriteFramesDirAsync",value:(o=Te(Se().mark((function e(t){var n,i,a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=w.getDirWithPath(t,L)).length>0)){e.next=23;break}i=[],a=je(n),e.prev=4,a.s();case 6:if((r=a.n()).done){e.next=14;break}if(o=r.value,s=w.get(o.path,L)){e.next=11;break}return e.abrupt("return",this.loadSpriteFramesFromDirAsync(t));case 11:i.push(s);case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),a.e(e.t0);case 19:return e.prev=19,a.f(),e.finish(19);case 22:return e.abrupt("return",i);case 23:return e.abrupt("return",this.loadSpriteFramesFromDirAsync(t));case 24:case"end":return e.stop()}}),e,this,[[4,16,19,22]])}))),function(e){return o.apply(this,arguments)})},{key:"loadSpriteFramesFromDirAsync",value:(r=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){w.loadDir(t,L,(function(t,n){t&&e([]),e(n)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"lazyLoadDashboardSceneResourcesAsync",value:(a=Te(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.loadPrefabAsync(Rn.COLLECTIONS_CONTENT_PREFAB));case 1:case"end":return t.stop()}}),t)}))),function(){return a.apply(this,arguments)})},{key:"loadThemeAsync",value:(i=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.loadSpriteFrameAsync(`${In[t]}/spriteFrame`));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"loadThemePreviewAsync",value:(n=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.loadSpriteFrameAsync(`${Pn[t]}/spriteFrame`));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"loadSkinPreviewAsync",value:(t=Te(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],i=1;i<=4;i++)a=`${Rn.TILE_SKIN_PREVIEW_FOLDER}/${t.replace(/-/g,"_")}_${i}/spriteFrame`,n.push(this.loadSpriteFrameAsync(a));return e.abrupt("return",Promise.all(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();try{new Bn}catch(e){console.error("GeneralUtils",e)}n._RF.pop(),n._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var Gn=i.ccclass,Un=i.property,zn=(_n=Gn("MultiBackground"),Ln=Un({type:A}),On=Un({type:A}),_n((Mn=$e((Nn=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"background1",Mn,Me(e)),Xe(e,"background2",Fn,Me(e)),e.currentThemeId="",e}return Re(a,[{key:"__preload",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"setCurrentTheme",value:(n=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bn.loadThemeAsync(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:n.packable=!1,this.background1.spriteFrame=n,this.background2.spriteFrame=n,this.currentThemeId=t;case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onDestroy",value:function(){var e;null===(e=this.tween)||void 0===e||e.stop()}},{key:"animateToNextTheme",value:(t=Te(Se().mark((function e(t){var n,i,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentThemeId!==t){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Bn.loadThemeAsync(t);case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(n.packable=!1,this.currentThemeId=t,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=n,this.nextBackground.node.setSiblingIndex(1),i=this.nextBackground.getComponent(D)){e.next=15;break}throw new Error(`${this.nextBackground.node.name} UIOpacity is required`);case 15:return i.opacity=0,this.tween=S({progress:0}),this.tween.to(3,{progress:255},{progress:function(e,t,n,a){var r=Math.floor(e+(t-e)*O.sineOut(a));return i.opacity=r,r}}),this.tween.call((function(){a.currentBackground.node.active=!1;var e=a.currentBackground;a.currentBackground=a.nextBackground,a.nextBackground=e})),e.abrupt("return",yn.runTweenAsync(this.tween));case 20:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(f)).prototype,"background1",[Ln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fn=$e(Nn.prototype,"background2",[On],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn=Nn))||Dn);n._RF.pop(),n._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var Hn={BUTTON_CLICK:"sounds/use_item_click",BOMB_DEFUSE:"sounds/bomb_defuse",BOMB_EXPLODE_1:"sounds/bomb_explode_1",BOMB_EXPLODE_2:"sounds/bomb_explode_2",CLICKS:"sounds/clicks",CLOSE_POPUP_CLICK:"sounds/close_popup_click",COLLECT_STARS:"sounds/collect_stars",COMBO_1:"sounds/combo_1",COMBO_2:"sounds/combo_2",COMBO_3:"sounds/combo_3",COMBO_4:"sounds/combo_4",COMBO_5:"sounds/combo_5",DAILY_REWARD:"sounds/daily_reward",EXTRA_TIME_SPAWN:"sounds/extra_time_spawn",GIFT_CHARGE:"sounds/gift_charge",GIFT_EXPLODE:"sounds/gift_explode",GIFT_REVEAL:"sounds/gift_reveal",HINT_ITEM:"sounds/hint_item",INVALID_MATCH:"sounds/invalid_match",LEVEL_COMPLETE:"sounds/level_complete",LEVEL_FAIL:"sounds/level_fail",LEVEL_START:"sounds/level_start",PROGRESS_STAR:"sounds/progress_star",RESCUE_TIMER:"sounds/rescue_timer",ROCKET_FLY:"sounds/rocket_fly",SHUFFLE_ITEM:"sounds/shuffle_item",THREE_STARS:"sounds/three_stars",TICKING_BOMB_BEFORE_EXPLODE:"sounds/ticking_bomb_before_explode",TILE_SELECT:"sounds/tile_select",USE_ITEM_CLICK:"sounds/use_item_click",BG_MUSIC:"musics/bg_music",PATCH_SHIFT:"sounds/patch_shift",THUNDERBOLT:"sounds/thunderbolt",WIND:"sounds/wind",COLLECT_COINS:"sounds/collect_coins",COLLECT_STOCK_COINS:"sounds/collect_stock_coins",LEVEL_FAIL_TIMEOUT:"sounds/level_fail_timeout",STAR_CHEST_DRUM_ROLL:"sounds/star_chest_drum_roll",STAR_CHEST_OPEN:"sounds/star_chest_open",LEADERBOARD_TRIUMPH:"sounds/leaderboard_triumph",ITEM_REWARD:"sounds/item_reward"},qn=Object.values(Hn),Vn=qn.reduce((function(e,t,n){return ke(ke({},e),{},{[t]:n})}),{});N(Vn);var Wn=qn;n._RF.pop(),n._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var Kn=function(e){return e[e.RESCUES_SCREEN=0]="RESCUES_SCREEN",e[e.LOADING_SCREEN=1]="LOADING_SCREEN",e[e.GET_ITEM_SCREEN=2]="GET_ITEM_SCREEN",e[e.GET_COIN_SCREEN=3]="GET_COIN_SCREEN",e[e.SETTINGS_SCREEN=4]="SETTINGS_SCREEN",e[e.START_LEVEL_SCREEN=5]="START_LEVEL_SCREEN",e[e.NOTIFICATION_SCREEN=6]="NOTIFICATION_SCREEN",e[e.LEVEL_COMPLETE_SCREEN=7]="LEVEL_COMPLETE_SCREEN",e[e.CONGRATULATION_SCREEN=8]="CONGRATULATION_SCREEN",e[e.QUIT_LEVEL_SCREEN=9]="QUIT_LEVEL_SCREEN",e[e.TOURNAMENT_DETAIL_SCREEN=10]="TOURNAMENT_DETAIL_SCREEN",e[e.DAILY_REWARDS_SCREEN=11]="DAILY_REWARDS_SCREEN",e[e.STAR_CHEST_SCREEN=12]="STAR_CHEST_SCREEN",e}(Kn||{}),jn={[Kn.RESCUES_SCREEN]:"RescuesScreen",[Kn.LOADING_SCREEN]:"LoadingScreen",[Kn.GET_ITEM_SCREEN]:"GetItemScreen",[Kn.GET_COIN_SCREEN]:"GetCoinScreen",[Kn.SETTINGS_SCREEN]:"SettingsScreen",[Kn.START_LEVEL_SCREEN]:"StartLevelScreen",[Kn.NOTIFICATION_SCREEN]:"NotificationScreen",[Kn.LEVEL_COMPLETE_SCREEN]:"LevelCompleteScreen",[Kn.CONGRATULATION_SCREEN]:"CongratulationScreen",[Kn.QUIT_LEVEL_SCREEN]:"QuitLevelScreen",[Kn.TOURNAMENT_DETAIL_SCREEN]:"TournamentDetailScreen",[Kn.DAILY_REWARDS_SCREEN]:"DailyRewardsScreen",[Kn.STAR_CHEST_SCREEN]:"StarChestScreen"},Yn={[jn[Kn.RESCUES_SCREEN]]:Kn.RESCUES_SCREEN,[jn[Kn.LOADING_SCREEN]]:Kn.LOADING_SCREEN,[jn[Kn.GET_ITEM_SCREEN]]:Kn.GET_ITEM_SCREEN,[jn[Kn.GET_COIN_SCREEN]]:Kn.GET_COIN_SCREEN,[jn[Kn.SETTINGS_SCREEN]]:Kn.SETTINGS_SCREEN,[jn[Kn.START_LEVEL_SCREEN]]:Kn.START_LEVEL_SCREEN,[jn[Kn.NOTIFICATION_SCREEN]]:Kn.NOTIFICATION_SCREEN,[jn[Kn.LEVEL_COMPLETE_SCREEN]]:Kn.LEVEL_COMPLETE_SCREEN,[jn[Kn.CONGRATULATION_SCREEN]]:Kn.CONGRATULATION_SCREEN,[jn[Kn.QUIT_LEVEL_SCREEN]]:Kn.QUIT_LEVEL_SCREEN,[jn[Kn.TOURNAMENT_DETAIL_SCREEN]]:Kn.TOURNAMENT_DETAIL_SCREEN,[jn[Kn.DAILY_REWARDS_SCREEN]]:Kn.DAILY_REWARDS_SCREEN,[jn[Kn.STAR_CHEST_SCREEN]]:Kn.STAR_CHEST_SCREEN},Xn=[Kn[Kn.NOTIFICATION_SCREEN],Kn[Kn.LOADING_SCREEN]];n._RF.pop(),n._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);var $n=globalThis.game.analytics,Qn=function(){function e(){Ae(this,e)}return Re(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"trackCurrentPage",value:function(e,t){if(!Xn.includes(e)&&(t||this.trackingPages.includes(e))){this.trackingPages=this.trackingPages.filter((function(t){return t!==e})),t&&this.trackingPages.push(e);var n=this.getCurrentPage();$n.pageview(n)}}},{key:"switchSceneTracking",value:function(){this.trackingPages=[];var e=this.getCurrentPage();$n.pageview(e)}},{key:"getCurrentPage",value:function(){var e,t;return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:null!==(e=null===(t=d.getScene())||void 0===t?void 0:t.name)&&void 0!==e?e:"Unknown Scene"}}]),e}();Qn.trackingPages=[];try{new Qn}catch(e){console.error("AnalyticsUtils",e)}n._RF.pop(),n._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);var Jn=function(){function e(){Ae(this,e)}return Re(e,[{key:"sound",get:function(){var e,t;return null!==(e=null===(t=x("Sound"))||void 0===t?void 0:t.getComponent(Yt))&&void 0!==e?e:null}},{key:"music",get:function(){var e,t;return null!==(e=null===(t=x("Music"))||void 0===t?void 0:t.getComponent(Ht))&&void 0!==e?e:null}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"muteAudio",value:function(e){this.muteMusic(e),this.muteSound(e)}},{key:"playSound",value:function(e,t){var n;null===(n=this.inst.sound)||void 0===n||n.play(e,t)}},{key:"pauseSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.pause(e)}},{key:"resumeSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.resume(e)}},{key:"stopSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.stop(e)}},{key:"stopAllSounds",value:function(){var e;null===(e=this.inst.sound)||void 0===e||e.stopAll()}},{key:"muteSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.mute(e)}},{key:"playMusic",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!n&&null!==(e=this.inst.music)&&void 0!==e&&e.playing(Hn.BG_MUSIC)||null===(t=this.inst.music)||void 0===t||t.play(Hn.BG_MUSIC)}},{key:"pauseMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.pause(Hn.BG_MUSIC)}},{key:"muteMusic",value:function(e){var t;null===(t=this.inst.music)||void 0===t||t.mute(e)}},{key:"turnUpMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(.8)}},{key:"turnDownMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(.4)}},{key:"turnOffMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(0)}}]),e}();try{new Jn}catch(e){console.error("AudioUtils",e)}n._RF.pop(),n._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);var Zn,ei,ti,ni,ii,ai,ri,oi,si,li,ui,ci,hi,pi,di,fi,vi,yi,mi,gi,bi,wi,ki,Si,Ei,Ci,Ti,Ai,xi,Ri,Ii,Pi,_i,Li=function(){function e(){Ae(this,e)}return Re(e,[{key:"getWindowSizeVsWorldGameRatio",value:function(){var e=M.getVisibleSize();return F.windowSize.width/window.devicePixelRatio/e.width}},{key:"getBoundingBoxTo",value:function(e,t){var n=B.mat4();B.Mat4.fromSRT(n,t.getRotation(),t.getPosition(),t.getScale());var i=t.getComponent(s);if(!i)throw new Error("Node must have UITransform component");var a=i.anchorPoint,r=i.contentSize,o=r.width,l=r.height,u=new B.Rect(-a.x*o,-a.y*l,o,l),c=B.mat4();if(B.Mat4.multiply(c,e,n),u.transformMat4(c),!t.children||0===t.children.length)return u;var h,p=t.children,d=t.getWorldMatrix(),f=je(p);try{for(f.s();!(h=f.n()).done;){var v=h.value;if(null!=v&&v.active)if(v.getComponent(s)){var y=this.getBoundingBoxTo(d,v);y&&B.Rect.union(u,u,y)}}}catch(e){f.e(e)}finally{f.f()}return u}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getBoundingBoxToWorld",value:function(e){if(e.parent){var t=e.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(t,e)}var n=e.getComponent(s);if(!n)throw new Error("Node must have UITransform component");return n.getBoundingBox()}},{key:"worldSizeToCssSize",value:function(e){return e*this.inst.getWindowSizeVsWorldGameRatio()}},{key:"cssSizeToWorldSize",value:function(e){return e/this.inst.getWindowSizeVsWorldGameRatio()}},{key:"getScreenWidthCss",value:function(){var e=document,t=e.body,n=e.documentElement,i=t.clientWidth,a=n.clientWidth;return Math.max(a,i)||0}},{key:"getScreenHeightCss",value:function(){var e=document,t=e.body,n=e.documentElement,i=t.clientHeight,a=n.clientHeight;return Math.max(a,i)||0}}]),e}();try{new Li}catch(e){console.error("CocosUtils",e)}n._RF.pop(),n._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var Oi=i.ccclass,Di=i.property,Ni=i.disallowMultiple,Mi=i.executionOrder,Fi=globalThis.game.analytics,Bi=(Zn=Oi("ExtendedButton"),ei=Mi(111),ti=Di(G),ni=Di(G),ii=Di(U.AnimationController),ai=Di({override:!0,visible:!1}),ri=Di({override:!0,visible:!1}),oi=Di({override:!0,visible:!1}),si=Di({override:!0,visible:!1}),li=Di({override:!0,visible:!1}),ui=Di({override:!0,visible:!1}),ci=Di({override:!0,visible:!1}),hi=Di({override:!0,visible:!1}),pi=Di({override:!0,visible:!1}),di=Di({override:!0,visible:!1}),fi=Di({override:!0,visible:!1}),vi=Di(z),yi=Di(z),mi=Di(z),gi=Di({visible(){return this.makeSound},type:Vn}),bi=Di({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),wi=Di({visible(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),Zn(ki=Ni(ki=ei((Ei=$e((Si=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"clickStartEvents",Ei,Me(e)),Xe(e,"clickEndEvents",Ci,Me(e)),Xe(e,"animationController",Ti,Me(e)),Xe(e,"useDesktopHover",Ai,Me(e)),Xe(e,"emitAnalyticsEvents",xi,Me(e)),Xe(e,"makeSound",Ri,Me(e)),Xe(e,"soundKey",Ii,Me(e)),Xe(e,"disableSpamClick",Pi,Me(e)),Xe(e,"disableSpamDelay",_i,Me(e)),e.currentClickBoundingBox=null,e.hasDown=!1,e.hasUp=!1,e.hasFinishClickCycle=!1,e.onTouchStart=function(t){e.interactable&&(e.hasDown||(e.currentClickBoundingBox=Li.getBoundingBoxToWorld(e.node),e.handleDown(t)))},e.onTouchEnd=function(t){e.interactable&&e.hasDown&&(e.hasUp||e.handleUp(t))},e.onTouchCancel=function(t){var n,i;if(e.interactable&&e.hasDown&&!e.hasUp){var a=t.getUILocation();null!==(n=null===(i=e.currentClickBoundingBox)||void 0===i?void 0:i.contains(a))&&void 0!==n&&n?e.handleUp(t):(e.hasUp=!0,e.hasFinishClickCycle=!0,e.handleResetButtonState(),e.emitClickEndEvents(t))}},e.onMouseEnter=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||(e.hasFinishClickCycle=!1,e.setAnimationState("HOVER")))},e.onMouseLeave=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||e.hasUp||e.hasFinishClickCycle||e.handleResetButtonState())},e.handleResetButtonState=function(){e.hasDown=!1,e.hasUp=!1,e.setAnimationState("RESET")},e}return Re(n,[{key:"transition",get:function(){return p.Transition.NONE},set:function(e){He(_e(n.prototype),"transition",p.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return Ue(_e(n.prototype),"normalColor",this)},set:function(e){He(_e(n.prototype),"normalColor",e,this,!0)}},{key:"pressedColor",get:function(){return Ue(_e(n.prototype),"pressedColor",this)},set:function(e){He(_e(n.prototype),"pressedColor",e,this,!0)}},{key:"hoverColor",get:function(){return Ue(_e(n.prototype),"hoverColor",this)},set:function(e){He(_e(n.prototype),"hoverColor",e,this,!0)}},{key:"disabledColor",get:function(){return Ue(_e(n.prototype),"disabledColor",this)},set:function(e){He(_e(n.prototype),"disabledColor",e,this,!0)}},{key:"normalSprite",get:function(){return Ue(_e(n.prototype),"normalSprite",this)},set:function(e){He(_e(n.prototype),"normalSprite",e,this,!0)}},{key:"pressedSprite",get:function(){return Ue(_e(n.prototype),"pressedSprite",this)},set:function(e){He(_e(n.prototype),"pressedSprite",e,this,!0)}},{key:"hoverSprite",get:function(){return Ue(_e(n.prototype),"hoverSprite",this)},set:function(e){He(_e(n.prototype),"hoverSprite",e,this,!0)}},{key:"disabledSprite",get:function(){return Ue(_e(n.prototype),"disabledSprite",this)},set:function(e){He(_e(n.prototype),"disabledSprite",e,this,!0)}},{key:"duration",get:function(){return Ue(_e(n.prototype),"duration",this)},set:function(e){He(_e(n.prototype),"duration",e,this,!0)}},{key:"zoomScale",get:function(){return Ue(_e(n.prototype),"zoomScale",this)},set:function(e){He(_e(n.prototype),"zoomScale",e,this,!0)}},{key:"__preload",value:function(){Ue(_e(n.prototype),"__preload",this).call(this),St.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var e;null===(e=Ue(_e(n.prototype),"onDestroy",this))||void 0===e||e.call(this)}},{key:"onEnable",value:function(){var e;null===(e=Ue(_e(n.prototype),"onEnable",this))||void 0===e||e.call(this),this.node.off(H.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(a.EventType.TOUCH_START,this.onTouchStart),this.node.on(a.EventType.TOUCH_END,this.onTouchEnd),this.node.on(a.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var e;null===(e=Ue(_e(n.prototype),"onDisable",this))||void 0===e||e.call(this),this.node.off(a.EventType.TOUCH_START,this.onTouchStart),this.node.off(a.EventType.TOUCH_END,this.onTouchEnd),this.node.off(a.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(e){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&Jn.playSound(Wn[this.soundKey]),this.emitClickStartEvents(e)}},{key:"emitClickStartEvents",value:function(e){this.clickStartEvents.forEach((function(t){t.emit([e,t.customEventData])}))}},{key:"emitClickEndEvents",value:function(e){this.clickEndEvents.forEach((function(t){t.emit([e,t.customEventData])}))}},{key:"handleUp",value:function(e){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}},{key:"emitButtonEvents",value:function(e){this.interactable&&(this.emitAnalyticsEvents&&Fi.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:Qn.getCurrentPage()}),this.clickEvents.forEach((function(t){t.emit([e,t.customEventData])})))}},{key:"setAnimationState",value:function(e){this.animationController.setValue("DOWN","DOWN"===e),this.animationController.setValue("HOVER","HOVER"===e),this.animationController.setValue("RESET","RESET"===e)}},{key:"fakeClick",value:function(){var e=this;this.setAnimationState("DOWN"),this.scheduleOnce((function(){e.setAnimationState("RESET")}),0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),n}(p)).prototype,"clickStartEvents",[ti],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ci=$e(Si.prototype,"clickEndEvents",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ti=$e(Si.prototype,"animationController",[ii],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(Si.prototype,"transition",[ai],Object.getOwnPropertyDescriptor(Si.prototype,"transition"),Si.prototype),$e(Si.prototype,"normalColor",[ri],Object.getOwnPropertyDescriptor(Si.prototype,"normalColor"),Si.prototype),$e(Si.prototype,"pressedColor",[oi],Object.getOwnPropertyDescriptor(Si.prototype,"pressedColor"),Si.prototype),$e(Si.prototype,"hoverColor",[si],Object.getOwnPropertyDescriptor(Si.prototype,"hoverColor"),Si.prototype),$e(Si.prototype,"disabledColor",[li],Object.getOwnPropertyDescriptor(Si.prototype,"disabledColor"),Si.prototype),$e(Si.prototype,"normalSprite",[ui],Object.getOwnPropertyDescriptor(Si.prototype,"normalSprite"),Si.prototype),$e(Si.prototype,"pressedSprite",[ci],Object.getOwnPropertyDescriptor(Si.prototype,"pressedSprite"),Si.prototype),$e(Si.prototype,"hoverSprite",[hi],Object.getOwnPropertyDescriptor(Si.prototype,"hoverSprite"),Si.prototype),$e(Si.prototype,"disabledSprite",[pi],Object.getOwnPropertyDescriptor(Si.prototype,"disabledSprite"),Si.prototype),$e(Si.prototype,"duration",[di],Object.getOwnPropertyDescriptor(Si.prototype,"duration"),Si.prototype),$e(Si.prototype,"zoomScale",[fi],Object.getOwnPropertyDescriptor(Si.prototype,"zoomScale"),Si.prototype),Ai=$e(Si.prototype,"useDesktopHover",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xi=$e(Si.prototype,"emitAnalyticsEvents",[yi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ri=$e(Si.prototype,"makeSound",[mi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ii=$e(Si.prototype,"soundKey",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vn[Hn.BUTTON_CLICK]}}),Pi=$e(Si.prototype,"disableSpamClick",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_i=$e(Si.prototype,"disableSpamDelay",[wi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ki=Si))||ki)||ki)||ki);n._RF.pop(),n._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);var Gi,Ui,zi,Hi,qi=function(){function e(){Ae(this,e),this.isAborted=!1,this.abortReason="",this.eventTarget=new EventTarget}var t;return Re(e,[{key:"aborted",get:function(){return this.isAborted}},{key:"reason",get:function(){return this.abortReason}},{key:"addAbortListener",value:function(e){this.eventTarget.addEventListener("abort",e)}},{key:"removeAbortListener",value:function(e){this.eventTarget.removeEventListener("abort",e)}},{key:"abort",value:function(e){this.isAborted||(this.isAborted=!0,this.abortReason=e,this.eventTarget.dispatchEvent(new Event("abort")))}},{key:"untilAborted",value:(t=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAborted){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){t.addAbortListener((function(){return e()}))})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"hasBeenAborted",value:function(e){return null==e||e.aborted}}]),e}();n._RF.pop(),n._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var Vi=i.ccclass,Wi=i.requireComponent,Ki=i.property,ji=Vi("OpacityToggler")(Gi=Wi([D])((zi=$e((Ui=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"activeValue",zi,Me(e)),Xe(e,"inActiveValue",Hi,Me(e)),e.signal=new qi,e}return Re(i,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(D),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"changeState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.signal.abort(),this.opacityComponent.opacity=e?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(t=Te(Se().mark((function e(){var t,n,i,a=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]&&a[0],n=a.length>1&&void 0!==a[1]?a[1]:.2,this.signal.abort(),this.signal=new qi,i=t?this.activeValue:this.inActiveValue,e.next=7,yn.runTweenAsync(S(this.opacityComponent).to(n,{opacity:i}),this.signal);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"activeValue",[Ki],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),Hi=$e(Ui.prototype,"inActiveValue",[Ki],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),Gi=Ui))||Gi)||Gi;n._RF.pop(),n._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);var Yi="view-resize",Xi="view-resized",$i="request-view-resize",Qi="layout-changed",Ji="gameplay-update-config",Zi="opened-skip-overlay",ea="closed-skip-overlay",ta="result-scene-replay",na="result-scene-home",ia="upgrade-quality",aa="upgrade-dynamic-atlas";n._RF.pop(),n._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);var ra,oa,sa,la={Portrait:"portrait",Landscape:"landscape"},ua={Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}};n._RF.pop(),n._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var ca,ha,pa,da,fa,va,ya,ma,ga,ba,wa,ka,Sa,Ea,Ca,Ta,Aa,xa,Ra,Ia,Pa=i.ccclass,_a=i.property,La=i.requireComponent,Oa=i.disallowMultiple,Da=i.executeInEditMode,Na=ua,Ma=Na.Portrait,Fa=Na.Landscape;Pa("DebugResolution")(ra=Oa(ra=La([q])(ra=Da(!0)(((sa=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).handleLayoutChange=function(){var t;null===(t=e.graphics)||void 0===t||t.clear(),e.start()},e}return Re(n,[{key:"drawPortrait",get:function(){return n._drawPortrait},set:function(e){e!==n._drawPortrait&&(e?this.drawPortraitResolution():this.graphics.clear(),n._drawPortrait=e,n._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return n._drawLandscape},set:function(e){e!==n._drawLandscape&&(e?this.drawLandscapeResolution():this.graphics.clear(),n._drawLandscape=e,n._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(q),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){V.on(Qi,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var e=this.graphics,t=Ma.WIDTH,n=Ma.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=r.GREEN,e.rect(i,a,t,n),e.stroke()}},{key:"drawLandscapeResolution",value:function(){var e=this.graphics,t=Fa.WIDTH,n=Fa.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=r.CYAN,e.rect(i,a,t,n),e.stroke()}}]),n}(f))._drawPortrait=!0,sa._drawLandscape=!0,$e((oa=sa).prototype,"drawPortrait",[_a],Object.getOwnPropertyDescriptor(oa.prototype,"drawPortrait"),oa.prototype),$e(oa.prototype,"drawLandscape",[_a],Object.getOwnPropertyDescriptor(oa.prototype,"drawLandscape"),oa.prototype),ra=oa))||ra)||ra)||ra);n._RF.pop(),n._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var Ba=i.ccclass,Ga=i.executionOrder,Ua=i.property,za=GameCore.Utils,Ha=r.RED,qa=r.BLACK,Va=r.MAGENTA;ca=Ba("GameStats"),ha=Ga(-1e3),pa=Ua(u),da=Ua(u),fa=Ua(u),va=Ua(u),ya=Ua(u),ma=Ua(u),ga=Ua(u),ba=Ua(u),ca(wa=ha((Sa=$e((ka=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"fpsLabel",Sa,Me(e)),Xe(e,"drawCountLabel",Ea,Me(e)),Xe(e,"logicTimeLabel",Ca,Me(e)),Xe(e,"physicTimeLabel",Ta,Me(e)),Xe(e,"renderTimeLabel",Aa,Me(e)),Xe(e,"objectMemoryUsageLabel",xa,Me(e)),Xe(e,"textureMemoryUsageLabel",Ra,Me(e)),Xe(e,"devicePixelRatioLabel",Ia,Me(e)),e.refreshInterval=.5,e.handleMouseDown=function(){e.bg.enabled=!e.bg.enabled},e.waitForStats=function(){W.stats&&(e.unschedule(e.waitForStats),e.node.active=!0,e.stats=W.stats,e.startUpdateStats())},e.updateStats=function(){e.updateFps(),e.updateDrawCalls(),e.updateLogicTime(),e.updatePhysicTime(),e.updateRenderTime(),e.updateObjectMemoryUsage(),e.updateTextureMemoryUsage(),e.updateDevicePixelRatio()},e}return Re(n,[{key:"__preload",value:function(){this.bg=this.getComponent(A),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(H.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,W&&za.Valid.isDebugger()&&(W.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var e=this.getFps();this.updateFpsColor(e),this.fpsLabel.string=`FPS: ${e}`}},{key:"updateFpsColor",value:function(e){this.fpsLabel.color=e<30?Ha:e<48?Va:qa}},{key:"updateDrawCalls",value:function(){var e=this.getDrawCalls();this.updateDrawCallsColor(e),this.drawCountLabel.string=`Draw Calls: ${e}`}},{key:"updateDrawCallsColor",value:function(e){var t=K.os===K.OS.IOS,n=t?80:25,i=t?60:15;this.drawCountLabel.color=e>n?Ha:e>i?Va:qa}},{key:"updateLogicTime",value:function(){var e=this.getLogicTime();this.updateLogicTimeColor(e),this.logicTimeLabel.string=`Logic Time: ${e.toFixed(2)}ms`}},{key:"updateLogicTimeColor",value:function(e){this.logicTimeLabel.color=e>10?Ha:e>5?Va:qa}},{key:"updatePhysicTime",value:function(){var e=this.getPhysicTime();this.updatePhysicTimeColor(e),this.physicTimeLabel.string=`Physic Time: ${e.toFixed(2)}ms`}},{key:"updatePhysicTimeColor",value:function(e){this.physicTimeLabel.color=e>10?Ha:e>5?Va:qa}},{key:"updateRenderTime",value:function(){var e=this.getRenderTime();this.updateRenderTimeColor(e),this.renderTimeLabel.string=`Render Time: ${e.toFixed(2)}ms`}},{key:"updateRenderTimeColor",value:function(e){this.renderTimeLabel.color=e>10?Ha:e>5?Va:qa}},{key:"updateObjectMemoryUsage",value:function(){var e=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(e),this.objectMemoryUsageLabel.string=`Object Mem: ${e.toFixed(2)}MB`}},{key:"updateObjectMemoryUsageColor",value:function(e){this.objectMemoryUsageLabel.color=e>40?Ha:e>25?Va:qa}},{key:"updateTextureMemoryUsage",value:function(){var e=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(e),this.textureMemoryUsageLabel.string=`Texture Mem: ${e.toFixed(2)}MB`}},{key:"updateTextureMemoryUsageColor",value:function(e){this.textureMemoryUsageLabel.color=e>50?Ha:e>35?Va:qa}},{key:"updateDevicePixelRatio",value:function(){var e=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(e),this.devicePixelRatioLabel.string=`Device Pixel Ratio: ${e}`}},{key:"updateDevicePixelRatioColor",value:function(e){this.devicePixelRatioLabel.color=e>2?Ha:e<=1?Va:qa}},{key:"getFps",value:function(){var e=this.stats.fps.counter;return Math.floor(e.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var e=this.stats.logic.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getPhysicTime",value:function(){var e=this.stats.physics.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getRenderTime",value:function(){var e=this.stats.render.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var e=this.stats.bufferMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var e=this.stats.textureMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),n}(f)).prototype,"fpsLabel",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ea=$e(ka.prototype,"drawCountLabel",[da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ca=$e(ka.prototype,"logicTimeLabel",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta=$e(ka.prototype,"physicTimeLabel",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa=$e(ka.prototype,"renderTimeLabel",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xa=$e(ka.prototype,"objectMemoryUsageLabel",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ra=$e(ka.prototype,"textureMemoryUsageLabel",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ia=$e(ka.prototype,"devicePixelRatioLabel",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wa=ka))||wa);n._RF.pop(),n._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var Wa,Ka=function(e){return e.INVITE_FRIENDS="invite-friends",e.REPLAY_FRIENDS="replay-friends",e.SHOW_CHALLENGE_RESULTS="show-challenge-results",e.NEXT_LEVEL="next-level",e.MAX_LEVEL="max-level",e.START_OVER="start-over",e.SELECT_LEVEL="select-level",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_REPLAY="game-replay",e.GAME_FINISH="game-finish",e.GAME_EXIT="game-exit",e.USE_ITEM="use-item",e.SKIP_LEVEL="skip-level",e.ADD_ITEM="add-item",e.ADD_ITEMS="add-items",e.ADD_COINS="add-coins",e.REMOVE_COINS="remove-coins",e.REMOVE_COINS_SUCCESS="remove-coins-success",e.REMOVE_COINS_FAILED="remove-coins-failed",e.COIN_CHANGED="coin-changed",e.ADD_STARS="add-stars",e.PAUSE_TIME="pause-time",e.RESUME_TIME="resume-time",e.TIME_OUT="time-out",e.HALF_TIME="half-time",e.RESCUE_START="rescue-time",e.RESCUE_FINISHED="clock-animation-finished",e.APPLY_GRAVITY="apply-gravity",e.IDLE_ENTER="idle-enter",e.IDLE_EXIT="idle-exit",e.GRID_MATCH="grid-match",e.GRID_MATCH_SUCCESS="grid-match-success",e.GRID_MATCH_FAIL="grid-match-fail",e.GRID_CLEAR="grid-clear",e.GRID_CREATE="grid-create",e.TILE_CLICK="tile-click",e.BOMB_EXPLODE="bomb-explode",e.SHOW_HINT="show-hint",e.ADD_COMBO="add-combo",e.COMBO_UPDATED="combo-updated",e.COMBO_ENDED="combo-ended",e.ADD_SCORE="add-score",e.SCORE_UPDATED="score-updated",e.REGISTER_ANIMATOR="register-animator",e.UNREGISTER_ANIMATOR="unregister-animator",e.SHOW_UI="show-ui",e.HIDE_UI="hide-ui",e.AUTO_PLAY="auto-play",e.GUIDE_MASK_CLICKED="guide-mask-clicked",e}(Ka||{});n._RF.pop(),n._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var ja,Ya,Xa,$a,Qa,Ja,Za,er,tr,nr,ir,ar,rr,or,sr,lr,ur,cr,hr=(0,i.ccclass)("PanelAnimationController")(Wa=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).animators=new Set,e.handleRegistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)&&console.warn("Animator already registered."),e.animators.add(t)},e.handleUnregistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)||console.warn("Animator not registered."),e.animators.delete(t)},e.handleShowUIs=function(t){var n=!1,i=Array.from(e.animators.values()).map((function(e){var i;e.isReadyForAnimation()||n||(n=!0,null==t||null===(i=t.fallback)||void 0===i||i.call(t));return e.handleShowUI()}));Promise.all(i).then((function(){var e;null==t||null===(e=t.onComplete)||void 0===e||e.call(t)}))},e.handleHideUIs=function(t){var n=!1,i=Array.from(e.animators.values()).map((function(e){var i;e.isReadyForAnimation()||n||(n=!0,null==t||null===(i=t.fallback)||void 0===i||i.call(t));return e.handleHideUI()}));Promise.all(i).then((function(){var e;null==t||null===(e=t.onComplete)||void 0===e||e.call(t)}))},e}return Re(n,[{key:"init",value:function(){this.node.scene.off(Ka.REGISTER_ANIMATOR),this.node.scene.off(Ka.UNREGISTER_ANIMATOR),this.node.scene.off(Ka.SHOW_UI),this.node.scene.off(Ka.HIDE_UI),this.node.scene.on(Ka.REGISTER_ANIMATOR,this.handleRegistration),this.node.scene.on(Ka.UNREGISTER_ANIMATOR,this.handleUnregistration),this.node.scene.on(Ka.SHOW_UI,this.handleShowUIs),this.node.scene.on(Ka.HIDE_UI,this.handleHideUIs)}}]),n}(f))||Wa;n._RF.pop(),n._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var pr,dr,fr,vr,yr=i.ccclass,mr=i.property,gr=(ja=yr("AnimationConfig"),Ya=mr({type:[C]}),ja((Qa=$e(($a=function(){function e(){Ae(this,e),Xe(this,"startHidden",Qa,this),Xe(this,"nodes",Ja,this),Xe(this,"posOffset",Za,this),Xe(this,"showEase",er,this),Xe(this,"hideEase",tr,this),Xe(this,"showDuration",nr,this),Xe(this,"hideDuration",ir,this)}return Re(e,[{key:"setConfig",value:function(e){e&&Object.assign(this,e)}}]),e}()).prototype,"startHidden",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ja=$e($a.prototype,"nodes",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Za=$e($a.prototype,"posOffset",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),er=$e($a.prototype,"showEase",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),tr=$e($a.prototype,"hideEase",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),nr=$e($a.prototype,"showDuration",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ir=$e($a.prototype,"hideDuration",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xa=$a))||Xa),br=(ar=yr("PanelAnimator"),rr=mr({type:gr,displayName:"Top animation nodes"}),or=mr({type:gr,displayName:"Bottom animation nodes"}),ar((ur=$e((lr=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"topConfig",ur,Me(e)),Xe(e,"botConfig",cr,Me(e)),e.isReady=!1,e}return Re(a,[{key:"onEnable",value:function(){this.node.scene.emit(Ka.REGISTER_ANIMATOR,this)}},{key:"onDisable",value:function(){this.node.scene.emit(Ka.UNREGISTER_ANIMATOR,this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady){e.next=3;break}return console.warn(`${this.node.name}'s ${this.name}: not ready`),e.abrupt("return");case 3:return e.abrupt("return",Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")]));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleHideUI",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady){e.next=3;break}return console.warn(`${this.node.name}'s ${this.name}: not ready`),e.abrupt("return");case 3:return e.abrupt("return",Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")]));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"createAnimator",value:function(e,t){var n=e.nodes,i=e.posOffset,r=e.showEase,o=e.hideEase,s=e.showDuration,l=e.hideDuration,u=n.map((function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom}:{mode:"position",value:e.node.position.y}})),c=n.map((function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top+i}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom-i}:{mode:"position",value:e.node.position.y+i}})),h="shown";return{switchState:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h===e)return Promise.resolve(null);h=e;var i="hidden"===e?u:c,p="hidden"===e?c:u,d="hidden"===e?l:s,f="hidden"===e?o:r;return t?(n.forEach((function(e,t){var n=i[t],a=p[t].value;"top"===n.mode&&(e.top=a),"bottom"===n.mode&&(e.bottom=a),"position"===n.mode&&(e.node.position=new j(e.node.position.x,a,e.node.position.z))})),Promise.resolve(null)):Promise.all(n.map((function(e,t){var n=i[t],r=p[t].value;return yn.runTweenAsync(a.getTween({widget:e,config:n,target:r,easing:f,duration:d}))})))}}}},{key:"setAnimator",value:function(e){var t=e.topConfig,n=e.botConfig,i=new gr,a=new gr;i.setConfig(t),a.setConfig(n),this.topConfig=i,this.botConfig=a,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(e){var t=e.widget,n=e.config,i=e.target,a=e.easing,r=e.duration;return"top"===n.mode?S(t).call((function(){t.top=n.value})).to(r,{top:i},{easing:a}):"bottom"===n.mode?S(t).call((function(){t.bottom=n.value})).to(r,{bottom:i},{easing:a}):S(t.node.position).call((function(){t.node.position=new j(t.node.position.x,n.value,t.node.position.z)})).to(r,{y:i},{easing:a})}}]),a}(f)).prototype,"topConfig",[rr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gr}}),cr=$e(lr.prototype,"botConfig",[or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new gr}}),sr=lr))||sr);n._RF.pop(),n._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var wr,kr,Sr,Er,Cr,Tr,Ar,xr,Rr,Ir,Pr,_r=i.ccclass,Lr=i.requireComponent,Or=i.property,Dr=globalThis.game,Nr=Dr.ads,Mr=Dr.event;_r("ResizeWithBannerAd")(pr=Lr(C)((fr=$e((dr=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"willShowBanner",fr,Me(e)),Xe(e,"includeSAB",vr,Me(e)),e.handleAdShow=function(t){var n,i=t.placementId;null!==i&&((null===(n=Nr.getAdByPlacementId(i))||void 0===n?void 0:n.type)===GameCore.Plugins.Ads.Types.BANNER&&e.resizeToFitBannerAd())},e.handleAdClose=function(t){var n,i=t.placementId;null!==i&&((null===(n=Nr.getAdByPlacementId(i))||void 0===n?void 0:n.type)===GameCore.Plugins.Ads.Types.BANNER&&e.updateWidgets(Nr.getSafeAreaBottom(Li.cssSizeToWorldSize(1))))},e}return Re(n,[{key:"__preload",value:function(){this.widget=this.getComponent(C),St.lazyValidateProperties(this),Mr.on(GameCore.Events.AD_SHOWING,this.handleAdShow),Mr.on(GameCore.Events.AD_CLOSED,this.handleAdClose)}},{key:"onDestroy",value:function(){Mr.off(GameCore.Events.AD_SHOWING,this.handleAdShow),Mr.off(GameCore.Events.AD_CLOSED,this.handleAdClose)}},{key:"start",value:function(){var e=Nr.getSafeAreaBottom(Li.cssSizeToWorldSize(1));this.willShowBanner||n.isBannerAdShowing()?this.resizeToFitBannerAd():e>0&&this.includeSAB&&this.updateWidgets(e)}},{key:"resizeToFitBannerAd",value:function(){var e=this,t=GameCore.Configs.Ads,n=t.Enabled,i=t.BannerDisplayAdOptions;if(n)if(this.widget.isAlignBottom){var a=null,r=null,o=null,s=null,l=Li.cssSizeToWorldSize(1);i.forEach((function(t){var n=t.PlacementId,i=t.Position;if(Nr.canbeShowBannerAd(n))switch(i){case"top":a=Nr.getBannerHeight(n,l);break;case"bottom":r=Nr.getBannerHeight(n,l,e.includeSAB);break;case"left":o=Nr.getBannerWidth(n,l);break;case"right":s=Nr.getBannerWidth(n,l)}})),this.updateWidgets(a,r,o,s)}else console.warn("Widget does not align to bottom, ResizeWithBannerAds will have no effect!")}},{key:"updateWidgets",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.widget.top=null!=e?e:this.widget.top,this.widget.bottom=null!=t?t:this.widget.bottom,this.widget.left=null!=n?n:this.widget.left,this.widget.right=null!=i?i:this.widget.right,this.widget.updateAlignment();var a=this.getComponentsInChildren(C);a.forEach((function(e){e.updateAlignment()}))}}],[{key:"isBannerAdShowing",value:function(){return Nr.enabled&&Nr.getAdStatus(GameCore.Plugins.Ads.Types.BANNER)===GameCore.Plugins.Ads.Status.SHOWING}}]),n}(f)).prototype,"willShowBanner",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),vr=$e(dr.prototype,"includeSAB",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),pr=dr))||pr);n._RF.pop(),n._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var Fr,Br,Gr,Ur,zr,Hr,qr,Vr,Wr,Kr,jr=i.ccclass,Yr=i.property,Xr=i.executeInEditMode,$r=i.requireComponent,Qr=(wr=jr("TapperedProgressBar"),kr=$r(D),Sr=Yr({type:D,displayName:"Fill opacity"}),Er=Yr({type:A,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),Cr=Yr({type:A,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),Tr=Yr({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),wr(Ar=Xr(Ar=kr((Rr=$e((xr=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"uiOpacity",Rr,Me(e)),Xe(e,"leftCap",Ir,Me(e)),Xe(e,"rightCap",Pr,Me(e)),e}return Re(n,[{key:"progress",get:function(){return Ue(_e(n.prototype),"progress",this)},set:function(e){He(_e(n.prototype),"progress",e,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity)if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var e=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=e}}},{key:"start",value:function(){this.updateAppearance()}}]),n}(Y)).prototype,"uiOpacity",[Sr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ir=$e(xr.prototype,"leftCap",[Er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pr=$e(xr.prototype,"rightCap",[Cr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$e(xr.prototype,"progress",[Tr],Object.getOwnPropertyDescriptor(xr.prototype,"progress"),xr.prototype),Ar=xr))||Ar)||Ar)||Ar);n._RF.pop(),n._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var Jr,Zr,eo,to,no,io,ao,ro,oo,so=i.ccclass,lo=i.property,uo=i.requireComponent,co=i.executeInEditMode,ho=i.disallowMultiple,po=globalThis.game.language;Fr=so("Localize"),Br=uo(u),Gr=co(!0),Ur=lo({visible:!0}),zr=lo({group:{name:"Fonts",id:"fonts",displayOrder:1},type:X}),Hr=lo({group:{name:"Fonts",id:"fonts",displayOrder:2},type:X}),Fr(qr=ho(qr=Br(qr=Gr(($e((Vr=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"enFont",Wr,Me(e)),Xe(e,"ruFont",Kr,Me(e)),e.handleLanguageChanged=function(){e.updateTransToNode()},e}return Re(n,[{key:"key",get:function(){return this._key},set:function(e){e&&(this._key=e,this.updateTransToNode())}},{key:"__preload",value:function(){this.label=this.getComponent(u),this.validateRequiredComponents(),this.updateTransToNode()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"start",value:function(){this.listenEvent()}},{key:"listenEvent",value:function(){V.on("update-language",this.handleLanguageChanged)}},{key:"updateTransToNode",value:function(){if(this.node.active&&this._key)try{var e=po.getText(this._key),t=this.getFontByLang();this.label.font=t,this.label.string=e,this.node.emit("update-trans",e)}catch(e){console.warn(e)}}},{key:"getFontByLang",value:function(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(po.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}]),n}(f)).prototype,"key",[Ur],Object.getOwnPropertyDescriptor(Vr.prototype,"key"),Vr.prototype),Wr=$e(Vr.prototype,"enFont",[zr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Kr=$e(Vr.prototype,"ruFont",[Hr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qr=Vr))||qr)||qr)||qr);n._RF.pop(),n._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var fo,vo,yo,mo,go,bo,wo,ko,So,Eo=i.ccclass,Co=i.property,To=function(){function e(t,n){var i;Ae(this,e),n=null!==(i=n)&&void 0!==i?i:{response:1,dampen:1,eager:1},this.k1=e.calcK1(n),this.k2=e.calcK2(n),this.k3=e.calcK3(n),this.xp=t.clone(),this.y=t.clone(),this.yd=new $(0,0)}return Re(e,[{key:"update",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=new $((t.x-this.xp.x)/e,(t.y-this.xp.y)/e),this.xp.x=t.x,this.xp.y=t.y);var i=Math.max(this.k2,e*e/2+e*this.k1/2,e*this.k1);return this.y.x=this.y.x+e*this.yd.x,this.y.y=this.y.y+e*this.yd.y,this.yd.x=this.yd.x+e*(t.x+this.k3*n.x-this.y.x-this.k1*this.yd.x)/i,this.yd.y=this.yd.y+e*(t.y+this.k3*n.y-this.y.y-this.k1*this.yd.y)/i,this.y}},{key:"setDynamics",value:function(t){this.k1=e.calcK1(t),this.k2=e.calcK2(t),this.k3=e.calcK3(t)}},{key:"reset",value:function(e){this.xp.set(e.x,e.y),this.y.set(e.x,e.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(e){return e.dampen/(Math.PI*e.response)}},{key:"calcK2",value:function(e){return 1/(2*Math.PI*e.response*(2*Math.PI*e.response))}},{key:"calcK3",value:function(e){return e.eager*e.dampen/(2*Math.PI*e.response)}}]),e}(),Ao=(Jr=Eo("SODConfig"),Zr=Co({type:E,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),eo=Co({type:E,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),to=Co({type:E,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),Jr((ao=$e((io=Re((function e(){Ae(this,e),Xe(this,"response",ao,this),Xe(this,"dampen",ro,this),Xe(this,"eager",oo,this)}))).prototype,"response",[Zr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),ro=$e(io.prototype,"dampen",[eo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),oo=$e(io.prototype,"eager",[to],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),no=io))||no);n._RF.pop(),n._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var xo,Ro,Io,Po,_o,Lo,Oo,Do,No,Mo,Fo,Bo,Go,Uo,zo,Ho,qo,Vo,Wo,Ko,jo,Yo,Xo,$o,Qo,Jo,Zo=i.ccclass,es=i.property,ts=(fo=Zo("Trail"),vo=es({type:a,displayName:"Target"}),yo=es({type:q,displayName:"Graphics"}),mo=es({type:[Ao],displayName:"Trail Nodes"}),fo((wo=$e((bo=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"target",wo,Me(e)),Xe(e,"graphics",ko,Me(e)),Xe(e,"trailNodes",So,Me(e)),e.trailNodeInstances=[],e}return Re(n,[{key:"reset",value:function(){var e,t=je(this.trailNodeInstances);try{for(t.s();!(e=t.n()).done;){e.value.reset(new $(this.node.worldPosition.x,this.node.worldPosition.y))}}catch(e){t.e(e)}finally{t.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(e){this.graphics.clear();var t=this.trailNodeInstances[0];this.drawTrail(e,t,this.target.worldPosition.x,this.target.worldPosition.y);for(var n=1;n<this.trailNodeInstances.length;n++){var i=this.trailNodeInstances[n-1],a=this.trailNodeInstances[n];this.drawTrail(e,a,i.currentState.x,i.currentState.y)}}},{key:"drawTrail",value:function(e,t,n,i){var a=this.graphics,r=new $(n,i),o=t.update(e,r),s=new j(r.x,r.y,0),l=new j(o.x,o.y,0);a.node.inverseTransformPoint(s,s),a.node.inverseTransformPoint(l,l),a.moveTo(s.x,s.y),a.lineTo(l.x,l.y),a.stroke()}},{key:"spawnTrailNodes",value:function(){var e,t=je(this.trailNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=new $(this.node.worldPosition.x,this.node.worldPosition.y),a=new To(i,n);this.trailNodeInstances.push(a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(f)).prototype,"target",[vo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ko=$e(bo.prototype,"graphics",[yo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),So=$e(bo.prototype,"trailNodes",[mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),go=bo))||go);n._RF.pop(),n._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var ns,is=i.ccclass,as=i.executionOrder,rs=i.property,os="Batch By Name",ss="Batch Label",ls="Batch Sprite",us=(xo=is("BatchNodes"),Ro=as(99999),Io=rs({group:{name:os}}),Po=rs({type:[g],group:{name:os}}),_o=rs({type:[m],group:{name:os}}),Lo=rs({group:{name:ss}}),Oo=rs({group:{name:ss}}),Do=rs({group:{name:ss}}),No=rs({group:{name:ls}}),Mo=rs({group:{name:ls}}),Fo=rs({readonly:!0}),Bo=rs({readonly:!0}),Go=rs({readonly:!0}),xo(Uo=Ro((Ho=$e((zo=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"batchByName",Ho,Me(e)),Xe(e,"depthNames",qo,Me(e)),Xe(e,"listName",Vo,Me(e)),Xe(e,"batchLabel",Wo,Me(e)),Xe(e,"depthLabel",Ko,Me(e)),Xe(e,"typeLabel",jo,Me(e)),Xe(e,"batchSprite",Yo,Me(e)),Xe(e,"depthSprite",Xo,Me(e)),Xe(e,"batchAllNodes",$o,Me(e)),Xe(e,"batchDepth",Qo,Me(e)),Xe(e,"checkOverlap",Jo,Me(e)),e.batchNode={},e.labelChildren=[],e.spriteChildren=[],e.allChildren=[],e.nameChildren=[],e.originalParents={},e.isInited=!1,e.onAfterUpdate=function(){e.isInited&&e.hierarchyChildren()},e.onAfterRender=function(){e.isInited&&e.restoreOriginalChildren()},e}return Re(n,[{key:"__preload",value:function(){this.enabled&&(d.on(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.on(Q.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){d.off(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.off(Q.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){d.on(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.on(Q.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),d.off(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.off(Q.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(e){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(e),this.createGlobalNodes(e),this.createGlobalNameNodes(e),this.createGlobalLabelNode(e),this.createGlobalSpriteNode(e),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var e,t,n,i=this;null===(e=this.batchNode.node)||void 0===e||e.setSiblingIndex(0),null===(t=this.batchNode.label)||void 0===t||t.setSiblingIndex(this.depthLabel),null===(n=this.batchNode.sprite)||void 0===n||n.setSiblingIndex(this.depthSprite),this.listName.forEach((function(e,t){var n;null===(n=i.batchNode[e])||void 0===n||n.setSiblingIndex(i.depthNames[t])}))}},{key:"createGlobalNodes",value:function(e){if(this.batchAllNodes){var t=new a("GlobalBatchNode");t.active=!0,this.batchNode.node=t,e.addChild(t)}}},{key:"createGlobalNameNodes",value:function(e){var t=this;this.batchByName&&this.listName.forEach((function(n){if(!t.batchNode[n]){var i=new a(n);i.active=!0,t.batchNode[n]=i,e.addChild(i)}}))}},{key:"createGlobalLabelNode",value:function(e){if(this.batchLabel){var t=new a("GlobalLabelNode");t.active=!0,this.batchNode.label=t,e.addChild(t)}}},{key:"createGlobalSpriteNode",value:function(e){if(this.batchSprite){var t=new a("GlobalSpriteNode");t.active=!0,this.batchNode.sprite=t,e.addChild(t)}}},{key:"saveOriginalParents",value:function(){var e=this;[].concat(Ve(this.labelChildren),Ve(this.spriteChildren)).forEach((function(t){t.node.parent&&(e.originalParents[t.uuid]=t.node.parent)})),this.nameChildren.forEach((function(t){t.parent&&(e.originalParents[t.uuid]=t.parent)}))}},{key:"saveOriginalChildren",value:function(e){var t=this;e.children.forEach((function(e){t.saveLabelChildren(e),t.saveSpriteChildren(e),t.saveNodeChildrenByName(e),t.saveNodeChildrenByType(e)})),this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(e){var t;if(this.batchLabel){var n=e.getComponentsInChildren(u);"char"===this.typeLabel&&n.filter((function(e){return e.cacheMode===u.CacheMode.CHAR})),0!==n.length&&(t=this.labelChildren).push.apply(t,Ve(n))}}},{key:"saveSpriteChildren",value:function(e){var t;if(this.batchSprite){var n=e.getComponentsInChildren(A);0!==n.length&&(t=this.spriteChildren).push.apply(t,Ve(n))}}},{key:"saveNodeChildrenByName",value:function(e){var t=this;this.batchByName&&e.children.forEach((function(e){t.listName.includes(e.name)?t.nameChildren.push(e):t.saveNodeChildrenByName(e)}))}},{key:"saveNodeChildrenByType",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.batchAllNodes){var a=e.getComponentsInChildren(f);(t=this.allChildren).push.apply(t,Ve(a)),this.batchDepth>0&&i<this.batchDepth&&this.allChildren.forEach((function(e){n.saveNodeChildrenByType(e.node,n.batchDepth)}))}}},{key:"hierarchyChildren",value:function(){var e,t=this;this.labelChildren.forEach((function(n){n.node.isValid&&n.node.activeInHierarchy&&(e=t.batchNode.label,n.node.isChildOf(e)||(n.node.setParent(e,!0),n.node.layer=J.Enum.UI_2D))})),this.spriteChildren.forEach((function(n){n.node.isValid&&n.node.activeInHierarchy&&(e=t.batchNode.sprite,n.node.isChildOf(e)||(n.node.setParent(e,!0),n.node.layer=J.Enum.UI_2D))})),this.allChildren.forEach((function(n){n.node.isValid&&n.node.activeInHierarchy&&(e=t.batchNode.node,n.node.isChildOf(e)||(n.node.setParent(e,!0),n.node.layer=J.Enum.UI_2D))})),this.allChildren.sort((function(e,t){var n=e.constructor.name,i=t.constructor.name;return n<i?-1:n>i?1:0})),this.nameChildren.forEach((function(n){if(n.isValid&&n.activeInHierarchy&&n.isTransformDirty()){var i=n.getComponent(D);i&&i.opacity<1||(e=t.batchNode[n.name],n.isChildOf(e)||(n.setParent(e,!0),n.layer=J.Enum.UI_2D))}}))}},{key:"restoreOriginalChildren",value:function(){var e=this,t=[].concat(Ve(this.labelChildren),Ve(this.spriteChildren));t.length>0&&t.forEach((function(t){var n=e.originalParents[t.uuid];n&&(t.node.isChildOf(n)||t.node.setParent(n,!0))})),this.nameChildren.forEach((function(t){var n=e.originalParents[t.uuid];n&&(t.isChildOf(n)||t.setParent(n,!0))}))}}]),n}(f)).prototype,"batchByName",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qo=$e(zo.prototype,"depthNames",[Po],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vo=$e(zo.prototype,"listName",[_o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wo=$e(zo.prototype,"batchLabel",[Lo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ko=$e(zo.prototype,"depthLabel",[Oo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),jo=$e(zo.prototype,"typeLabel",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),Yo=$e(zo.prototype,"batchSprite",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Xo=$e(zo.prototype,"depthSprite",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$o=$e(zo.prototype,"batchAllNodes",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Qo=$e(zo.prototype,"batchDepth",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Jo=$e(zo.prototype,"checkOverlap",[Go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Uo=zo))||Uo)||Uo);n._RF.pop(),n._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var cs=i.ccclass,hs=GameCore.Utils,ps=globalThis.game.player,ds=cs("Vibrate")(ns=function(e){Pe(n,e);var t=Be(n);function n(){return Ae(this,n),t.apply(this,arguments)}return Re(n,[{key:"vibrate",value:function(e){if(this.isVibrateEnable()&&!hs.Browser.vibrate(e)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!ps.getPlayerSetting("vibrate")}}]),n}(f))||ns;n._RF.pop(),n._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);var fs=1/6;n._RF.pop(),n._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);var vs={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};n._RF.pop(),n._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var ys=10,ms=50,gs=100,bs={[vs.HINT]:80,[vs.THUNDER]:200,[vs.STORM]:150,[vs.PLIERS]:150},ws=200,ks=40;n._RF.pop(),n._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var Ss={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};n._RF.pop(),n._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var Es="STARS_UPDATED",Cs="PLAY_BUTTON_PRESS",Ts="REQUEST_NAVIGATION",As="REQUEST_NAVIGATION_ANIMATION",xs="DASHBOARD_EVENTS_BUTTON_PRESS";n._RF.pop(),n._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var Rs=function(e){return e[e.store=0]="store",e[e.collections=1]="collections",e[e.home=2]="home",e[e.leaderboard=3]="leaderboard",e[e.tournaments=4]="tournaments",e}(Rs||{});N(Rs),n._RF.pop(),n._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);var Is=ke(ke({},GameCore.Dtos.Match.Data.getDefaultData()),{},{extraData:null});n._RF.pop(),n._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var Ps=function(e){return e.UNLOCK_DEV_TOOLS="unlock-dev-tools",e.TRIGGER_UNLOCK_KEY="trigger-unlock-key",e.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",e}(Ps||{}),_s={Events:Ps,UNLOCK_SEQUENCE:"101013012031"};n._RF.pop(),n._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);n._RF.pop(),n._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);var Ls={level:0,coins:0,stars:0,totalLevel:80,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:{[vs.HINT]:0,[vs.THUNDER]:0,[vs.STORM]:0,[vs.PLIERS]:0},skins:{}};n._RF.pop(),n._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);var Os="global-leaderboard-key",Ds="friends-leaderboard-key",Ns="global-leaderboard-id",Ms="friends-leaderboard-id";n._RF.pop(),n._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);var Fs=ke(ke({},GameCore.Dtos.Match.CustomData.getDefaultData()),{},{score:0});n._RF.pop(),n._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);var Bs={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:Ls,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};n._RF.pop(),n._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);var Gs="BootScene",Us="GameScene",zs="DashboardScene",Hs="ChallengeResultScene";n._RF.pop(),n._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var qs=function(e){return e.RELOAD_TOURNAMENT="reload-tournament",e}(qs||{});n._RF.pop(),n._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);var Vs=GameCore,Ws=Vs.Configs,Ks=Vs.Utils.Object,js=Ws.FrameCapture,Ys=js.Enabled,Xs=js.WideframeConfigs,$s=function(){var e=Te(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ys){e.next=3;break}return console.warn("FrameCapture is not enabled"),e.abrupt("return",null);case 3:if(n=Js(t)){e.next=6;break}return e.abrupt("return",null);case 6:return Qs(n,Xs.CustomResultChallenge),i=window.game.frameCapture,a=Xs.CustomResultChallenge,r=a.Width,o=a.Height,e.abrupt("return",i.captureAsync({name:"CustomResultChallenge",width:r,height:o,renderOptions:n}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Qs=function(e,t){var n=t.Width,i=t.Height,a=t.Wideframe;e.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:a,size:[n,i],position:[0,0]}},Js=function(e){try{var t=e.playerId,n=void 0===t?"10":t,i=e.playerPhoto,a=void 0===i?"":i,r=e.playerScore,o=void 0===r?0:r,s=e.opponentId,l=void 0===s?"20":s,u=e.opponentPhoto,c=void 0===u?"":u,h=e.opponentScore,p=void 0===h?0:h,d=e.isPlayerFinished,f=e.isOpponentFinished,v=Xs.CustomResultChallenge.RenderOptions,y=Ks.camelCaseKeys(Ks.clone(v)),m=y.playerPhoto,g=y.opponentPhoto,b=o===p,w=o>p,k=null!=d?d:f,S=d&&f;return"image"===m.type&&(m.name=`${n}`,m.image=a),"image"===g.type&&(g.name=`${l}`,g.image=c),k&&Zs(y,{playerScore:o,opponentScore:p,isPlayerFinished:d,isOpponentFinished:f}),!S||b?(delete y.leftCrown,delete y.rightCrown,y):(w?delete y.rightCrown:delete y.leftCrown,y)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},Zs=function(e,t){var n=e.leftScore,i=e.rightScore,a=t.playerScore,r=void 0===a?0:a,o=t.opponentScore,s=void 0===o?0:o,l=t.isPlayerFinished,u=t.isOpponentFinished;"text"===n.type&&(n.text=l?`${r}`:"???"),"text"===i.type&&(i.text=u?`${s}`:"???")};n._RF.pop(),n._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var el=function(e){Pe(n,e);var t=Be(n);function n(e,i){var a;return Ae(this,n),(a=t.call(this,i)).code=e,a}return Re(n)}(Ne(Error));n._RF.pop(),n._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var tl=function(e){Pe(n,e);var t=Be(n);function n(e,i){var a;return Ae(this,n),(a=t.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=e,a.tournamentId=i,a}return Re(n)}(el);n._RF.pop(),n._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var nl={themeNames:["summer","autumn","winter"],skinNames:["cakes","car","cosmetics","flower","fruit","ice-cream","sport","tool"],mapOrder:[{id:1,theme:"summer",skin:"fruit",levelCount:10},{id:2,theme:"autumn",skin:"flower",levelCount:10},{id:3,theme:"winter",skin:"tool",levelCount:10},{id:4,theme:"summer",skin:"sport",levelCount:10},{id:5,theme:"autumn",skin:"cosmetics",levelCount:10},{id:6,theme:"winter",skin:"ice-cream",levelCount:10},{id:7,theme:"summer",skin:"cakes",levelCount:10},{id:8,theme:"autumn",skin:"car",levelCount:10}]};n._RF.pop(),n._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);var il="cakes",al="flower",rl="fruit";n._RF.pop(),n._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);var ol={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter"};N(ol),n._RF.pop(),n._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var sl=globalThis.game,ll=sl.player,ul=sl.storage,cl={currentProgress:0,maxProgress:10,isLocked:!0,themeId:"summer"},hl={id:0,currentSkin:il,currentTheme:ol.SUMMER,nextSkin:null,nextTheme:null,progress:0,max:10},pl={skin:"cakes",themeId:"summer",progress:0,max:10,isLocked:!0},dl=function(){function e(){Ae(this,e),this.mapData=nl,this.playerSkinProgress=null}return Re(e,[{key:"initDashboardSceneStorage",value:function(){var e=ul.getStorage("dashboard");if(null==e){var t=this.getCurrentMapProgressInstance();ul.addStorage("dashboard",{lastMapPayload:t,numOfMapsPassed:0,animateToCurrentLevel:!1});var n=ul.getStorage("collection");if(null==n){ul.addStorage("collection",{lastMapPack:t.id,animateMapPackUnlock:!1});var i=ul.getStorage("leaderboard_content");if(null==i){ul.addStorage("leaderboard_content",{lastTabOpened:"global"});var a=ul.getStorage("tournament");null==a&&ul.addStorage("tournament",{animateTournamentLeader:!1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),hl;for(var e=this.mapData.mapOrder,t=void 0,n=void 0,i=void 0,a=void 0,r=0,o=0,s=0,l=0;l<e.length;l++){var u=this.playerSkinProgress[e[l].skin];if(u.currentProgress<u.maxProgress){var c,h,p,d;s=e[l].id,t=e[l].skin,n=e[l].theme,i=null!==(c=null===(h=e[l+1])||void 0===h?void 0:h.skin)&&void 0!==c?c:t,a=null!==(p=null===(d=e[l+1])||void 0===d?void 0:d.theme)&&void 0!==p?p:n,r=u.currentProgress,o=u.maxProgress;break}}if(void 0===t||void 0===i||void 0===n||void 0===a){var f=e[e.length-1];return s=f.id,t=f.skin,n=f.theme,i=f.skin,a=f.theme,r=f.levelCount,o=f.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:s,currentSkin:t,currentTheme:n,nextSkin:i,nextTheme:a,progress:r,max:o}}return console.log("getMapCurrentProgress",t,i,r,o),{id:s,currentSkin:t,currentTheme:n,nextSkin:i,nextTheme:a,progress:r,max:o}}},{key:"getUnlockedSkinsInstance",value:function(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];for(var e=[],t=0,n=Object.keys(this.playerSkinProgress);t<n.length;t++){var i=n[t];this.playerSkinProgress[i].isLocked||e.push(i)}return console.log("getUnlockedSkins",e),e}},{key:"getLevelSkinInstance",value:function(e){var t,n=null!=e?e:1,i=this.mapData.mapOrder,a=0,r=je(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(a+o.levelCount>=n)return console.log("getMapSkin",o.skin),o.skin;a+=o.levelCount}}catch(e){r.e(e)}finally{r.f()}var s=i[i.length-1];return console.log("getMapSkin",s.skin),s.skin}},{key:"getLevelThemeInstance",value:function(e){var t,n=null!=e?e:1,i=this.mapData.mapOrder,a=0,r=je(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(a+o.levelCount>=n)return console.log("getMapTheme",o.theme),o.theme;a+=o.levelCount}}catch(e){r.e(e)}finally{r.f()}var s=i[i.length-1];return console.log("getMapTheme",s.theme),s.theme}},{key:"getCollectionUnlockProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[pl];for(var e=[],t=0,n=Object.entries(this.playerSkinProgress);t<n.length;t++){var i=n[t],a=i[1],r=a.currentProgress,o=a.maxProgress,s=a.isLocked,l=a.themeId;e.push({progress:r,max:o,isLocked:s,skin:i[0],themeId:l})}return e}},{key:"updatePlayerSkinProgress",value:function(){var e=ll.getGameData();if(null!=e&&e.skins&&Object.keys(e.skins).length>0){this.playerSkinProgress={};for(var t=0,n=Object.keys(e.skins);t<n.length;t++){var i=n[t];this.playerSkinProgress[i]=ke(ke({},cl),e.skins[i])}}else{console.log("getPlayerSkinProgress: playerData not found, use data from level");var a=this.mapData.mapOrder;this.playerSkinProgress={};var r,o=je(a);try{for(o.s();!(r=o.n()).done;){var s=r.value;this.playerSkinProgress[s.skin]={themeId:s.theme,currentProgress:0,maxProgress:s.levelCount,isLocked:!0}}}catch(e){o.e(e)}finally{o.f()}this.updatePlayerSkinProgressByLevel(),console.log(this.playerSkinProgress)}}},{key:"updatePlayerSkinProgressByLevel",value:function(){var e,t=ll.getGameData(),n=(null!==(e=null==t?void 0:t.level)&&void 0!==e?e:1)-1,i=this.mapData.mapOrder;this.playerSkinProgress[i[0].skin].isLocked=!1;var a,r=je(i);try{for(r.s();!(a=r.n()).done;){var o=a.value,s=o.levelCount,l=o.skin;if(!(n<=0)){var u=n-s>=0?s:n;n-=u,console.log("getPlayerSkinProgressByLevel",l,u),this.increaseProgressInstance(l,u,!1)}}}catch(e){r.e(e)}finally{r.f()}}},{key:"increaseProgressInstance",value:function(e,t,n){if(null!==this.playerSkinProgress)if(this.playerSkinProgress[e]){var i=this.playerSkinProgress[e],a=i.currentProgress,r=i.maxProgress,o=a+t>r?r:a+t;if(o>0&&(this.playerSkinProgress[e].isLocked=!1),o===r){var s,l=this.mapData.mapOrder,u=l.findIndex((function(t){return t.skin===e})),c=null===(s=l[u+1])||void 0===s?void 0:s.skin;c&&this.unlockSkinInstance(c,!1)}this.playerSkinProgress[e].currentProgress=o,this.playerSkinProgress[e].maxProgress=r,n&&this.syncPlayerSkinProgress()}else console.warn("increaseProgress: skin not found",e);else console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?")}},{key:"unlockSkinInstance",value:function(e,t){null!==this.playerSkinProgress?this.playerSkinProgress[e]?(this.playerSkinProgress[e].isLocked=!1,t&&this.syncPlayerSkinProgress()):console.warn("unlockSkin: skin not found",e):console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}},{key:"syncPlayerSkinProgress",value:function(){ll.setGameData({skins:this.playerSkinProgress})}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var e=this.getInstance();e.updatePlayerSkinProgress(),e.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkin",value:function(e){return this.getInstance().getLevelSkinInstance(e)}},{key:"getLevelTheme",value:function(e){return this.getInstance().getLevelThemeInstance(e)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"increaseProgress",value:function(e,t,n){this.getInstance().increaseProgressInstance(e,t,n)}},{key:"unlockSkin",value:function(e,t){this.getInstance().unlockSkinInstance(e,t)}}]),e}();n._RF.pop(),n._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var fl=globalThis.game,vl=fl.match,yl=fl.player,ml=fl.leaderboard,gl=fl.frameCapture,bl=GameCore.Utils,wl=bl.Object,kl=bl.Valid,Sl=GameCore.Match.Modes,El=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],Cl=function(){function e(){Ae(this,e)}var t,n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b;return Re(e,[{key:"processStartSingleModeAsync",value:(b=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=yl.getPlayerId(),e.next=3,vl.single.start.processAsync({playerId:t});case 3:case"end":return e.stop()}}),e)}))),function(){return b.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(g=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vl.single.finish.processAsync();case 2:case"end":return e.stop()}}),e)}))),function(){return g.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(m=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=yl.getPlayerId(),n=GameSDK.context.getID(),e.next=4,vl.tournament.continue.processAsync({playerId:t,contextId:n});case 4:case"end":return e.stop()}}),e)}))),function(){return m.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(y=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=yl.getPlayerId(),n=yl.getBestScore(),e.next=4,vl.tournament.finish.processAsync({playerId:t,bestScore:n});case 4:case"end":return e.stop()}}),e)}))),function(){return y.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(v=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.processContinueChallengeAsync();case 3:e.next=15;break;case 5:if(e.prev=5,e.t0=e.catch(0),wl.hasOwn(e.t0,"name")&&!kl.isString(e.t0.name)){e.next=9;break}throw e.t0;case 9:if("PlayerHasFinishedMatch"!==e.t0.name){e.next=12;break}return e.next=12,this.processChallengeNewOpponentAsync();case 12:if("PlayerNotJoinInMatch"!==e.t0.name){e.next=15;break}return e.next=15,this.processJoinChallengeAsync();case 15:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return v.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(f=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return gl.addWideframeRender("renderResultChallenge",gl.wideframe.renderResultChallenge),e.next=3,vl.challenge.finish.processAsync(t);case 3:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(d=Te(Se().mark((function e(){var t,n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getMatchState(),n=t.id,i=t.customData,a=i.playerId,r=i.opponentId,kl.isString(n)){e.next=4;break}throw new Error("Invalid match id");case 4:if(kl.isString(a)){e.next=6;break}throw new Error("Invalid player id");case 6:if(kl.isString(r)){e.next=8;break}throw new Error("Invalid opponent id");case 8:if(o=GameSDK.context.getID()){e.next=11;break}throw new Error("Cannot get contextId");case 11:return e.next=13,vl.challenge.continue.processAsync({matchId:n,contextId:o,playerId:a,opponentId:r});case 13:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(p=Te(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=yl.getConnectedPlayerIds(100,0),n=Math.floor(Math.random()*t.length),i=yl.getPlayerId(),a=t[n],e.next=6,vl.challenge.friend.processAsync({playerId:i,opponentId:a});case 6:case"end":return e.stop()}}),e)}))),function(){return p.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(h=Te(Se().mark((function e(){var t,n,i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getMatchState(),n=t.id,i=t.customData,a=i.playerId,r=i.opponentId,kl.isString(n)){e.next=4;break}throw new Error("Invalid match id");case 4:if(kl.isString(a)){e.next=6;break}throw new Error("Invalid player id");case 6:if(kl.isString(r)){e.next=8;break}throw new Error("Invalid opponent id");case 8:return e.next=10,vl.challenge.join.processAsync({matchId:n,playerId:a,opponentId:r});case 10:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"getMatchState",value:function(){var e=vl.getMatchState();if(!e)throw new Error("Match state not found");return e}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(c=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=null!=t?t:this.getMatchMode(),e.t0=n,e.next=e.t0===Sl.SINGLE?5:e.t0===Sl.TOURNAMENT?8:e.t0===Sl.CHALLENGE_FRIEND?11:14;break;case 5:return e.next=7,this.inst.processStartSingleModeAsync();case 7:return e.abrupt("break",16);case 8:return e.next=10,this.inst.processStartTournamentModeAsync();case 10:return e.abrupt("break",16);case 11:return e.next=13,this.inst.processStartChallengeModeAsync();case 13:return e.abrupt("break",16);case 14:return e.next=16,this.inst.processStartSingleModeAsync();case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.warn("startMatchAsync",e.t1);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e){return c.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(u=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,vl.handler.setProfileData(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setProfileMatchDataAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return u.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(l=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,vl.handler.setMatchCustomData(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setMatchCustomDataAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return l.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(s=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,vl.handler.setLeaderboardScore(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setLeaderboardScoreAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return s.apply(this,arguments)})},{key:"finishMatchAsync",value:(o=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=this.getMatchMode(),e.t0=n,e.next=e.t0===Sl.SINGLE?5:e.t0===Sl.TOURNAMENT?8:e.t0===Sl.CHALLENGE_FRIEND?11:14;break;case 5:return e.next=7,this.inst.processFinishSingleModeAsync();case 7:return e.abrupt("break",16);case 8:return e.next=10,this.inst.processFinishTournamentModeAsync();case 10:return e.abrupt("break",16);case 11:return e.next=13,this.inst.processFinishChallengeModeAsync(t);case 13:return e.abrupt("break",16);case 14:return e.next=16,this.inst.processFinishSingleModeAsync();case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.warn("finishMatchAsync",e.t1);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e){return o.apply(this,arguments)})},{key:"joinTournamentAsync",value:(r=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=yl.getPlayerId(),e.next=3,vl.tournament.join.processAsync({tournamentId:t,playerId:n});case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"continueTournamentAsync",value:(a=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=yl.getPlayerId(),e.next=3,vl.tournament.continue.processAsync({playerId:n,contextId:t});case 3:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"createTournamentName",value:function(){var e=`${El[B.randomRangeInt(0,El.length-1)]} Tournament`;return`${GameCore.Utils.String.removeDiacritics(e)}`}},{key:"getShortName",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,i=e.split(" "),a=0,r="",o=je(i);try{for(o.s();!(t=o.n()).done;){var s=t.value;if(a+s.length+1>n)break;r+=`${s} `,a+=s.length+1}}catch(e){o.e(e)}finally{o.f()}return r.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var e,t,n,i=GameCore.Utils.String.generateObjectId(),a=yl.getPlayerId(),r=yl.getPlayer().name,o=yl.getGameData(),s=null!==(e=null==o?void 0:o.level)&&void 0!==e?e:1,l=dl.getLevelTheme(s),u=this.inst.getMatchState().profiles;return{score:null!==(t=null===(n=(void 0===u?{}:u)[a])||void 0===n?void 0:n.score)&&void 0!==t?t:0,playerId:a,mode:Sl.TOURNAMENT,name:this.createTournamentName(),leaderboardId:i,payload:{playerId:a,playerName:r,leaderboardId:i,themeId:l}}}},{key:"getTournamentsAsync",value:(i=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameSDK.tournament.getTournamentsAsync();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e,null,[[0,6]])}))),function(){return i.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(n=Te(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTournamentsAsync();case 2:if(t=e.sent,!(n=t.find((function(e){var t,n=JSON.parse(null!==(t=e.getPayload())&&void 0!==t?t:"{}");return"DEFAULT"===e.getTournamentType()&&n.playerId===yl.getPlayerId()})))){e.next=6;break}throw new tl(yl.getPlayerId(),n.getID());case 6:return i=this.createTournamentPayload(),yl.setGameData({lastCreateTournamentShown:Date.now()}),e.next=10,vl.tournament.create.processAsync(i);case 10:a=i.leaderboardId,ml.addLeaderboard({name:a,type:"tournament",autoSortRank:!0,leaderboardId:a});case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getMatchMode",value:function(){var e=this.inst.getMatchState();return kl.isString(e.mode)?e.mode:null}},{key:"getMatchCustomData",value:function(){var e=this.inst.getMatchState();return kl.isObject(e.customData)?e.customData:null}},{key:"getMatchExtraDataAsync",value:(t=Te(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vl.api.getMatchAPI().getMatchDetailByIdAsync(t);case 2:return n=e.sent,i=new GameCore.Dtos.Match.Data(n).toObject(),a=i.extraData,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(e,t){this.setMatchCustomDataAsync({level:e,score:t});var n=yl.getPlayerId();this.setProfileMatchDataAsync({id:n,score:t})}}]),e}();try{new Cl}catch(e){console.error("MatchUtils",e)}n._RF.pop(),n._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);var Tl,Al,xl,Rl,Il,Pl,_l,Ll=globalThis.game.event,Ol=GameCore.Events,Dl=function(){function e(){Ae(this,e)}return Re(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"switchScene",value:function(e,t){Ll.emit(Ol.SWITCH_SCENE,{sceneName:e,sceneData:t})}},{key:"preloadScene",value:function(e){Ll.emit(Ol.PRELOAD_SCENE,{sceneName:e})}},{key:"preloadDashboardScene",value:function(){this.preloadScene(zs)}},{key:"switchToDashboardScene",value:function(e){this.switchScene(zs,e)}},{key:"preloadGameScene",value:function(){this.preloadScene(Us)}},{key:"switchToGameScene",value:function(e){this.switchScene(Us,e)}},{key:"getSceneData",value:function(e){return"data"in e.scene&&e.scene.data||{}}}]),e}();try{new Dl}catch(e){console.error("SceneUtils",e)}n._RF.pop(),n._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);var Nl,Ml,Fl,Bl,Gl,Ul=i.ccclass,zl=i.property,Hl=(Tl=Ul("LoadingFullScreen"),Al=zl(Y),xl=zl(u),Tl((Pl=$e((Il=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"progressBar",Pl,Me(e)),Xe(e,"loadingText",_l,Me(e)),e}return Re(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(D),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"runLoadingTextAnimation",value:function(){var e=this,t=0;this.schedule((function(){t=t>2?0:t+1,e.loadingText.string="Loading"+".".repeat(t)}),.5)}},{key:"stopLoadingTextAnimation",value:function(){this.unscheduleAllCallbacks()}},{key:"show",value:(n=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=0,this.progressBar.progress=0,t=S(this.uiOpacity).to(.2,{opacity:255},{easing:"cubicOut"}),n=S(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"}),this.runLoadingTextAnimation(),yn.runTweenAsync(t),e.next=8,yn.runTweenAsync(n);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.uiOpacity&&this.progressBar){e.next=2;break}return e.abrupt("return");case 2:return this.uiOpacity.opacity=255,this.progressBar.progress=.9,t=S(this.uiOpacity).to(.15,{opacity:0},{easing:"cubicIn"}),n=S(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"}),this.runLoadingTextAnimation(),e.next=9,yn.runTweenAsync(n);case 9:return this.stopLoadingTextAnimation(),e.next=12,yn.runTweenAsync(t);case 12:this.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"progressBar",[Al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_l=$e(Il.prototype,"loadingText",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rl=Il))||Rl);n._RF.pop(),n._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);var ql=i.ccclass,Vl=i.property,Wl=(Nl=ql("Loading"),Ml=Vl(R),Nl((Gl=$e((Bl=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"loadingPrefab",Gl,Me(e)),e.loadingNode=null,e}return Re(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"createLoadingFullScreen",value:function(){var e,t=x("Canvas");if(t&&!t.getChildByName("Loading")){this.loadingNode||(this.loadingNode=l(this.loadingPrefab));var n=l._clone(this.loadingNode);this.loadingFullScreen=n.getComponent(Hl),this.node.active=!1,null===(e=x("Canvas"))||void 0===e||e.addChild(n)}}},{key:"show",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.createLoadingFullScreen(),!this.node.active){e.next=3;break}return e.abrupt("return");case 3:return this.node.active=!0,e.next=6,this.loadingFullScreen.show();case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=this.node)&&void 0!==t&&t.active){e.next=2;break}return e.abrupt("return");case 2:if(this.loadingFullScreen){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.loadingFullScreen.hide();case 6:this.node.active=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"loadingPrefab",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fl=Bl))||Fl);n._RF.pop(),n._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);var Kl=globalThis.game.event,jl=GameCore.Events,Yl=function(){function e(){Ae(this,e),this.showedScreens=[]}var t,n;return Re(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"openScreen",value:function(e,t){var n=jn[e];Kl.emit(jl.OPEN_SCREEN,{screenName:n,screenData:t})}},{key:"closeScreen",value:function(e){var t=jn[e];Kl.emit(jl.CLOSE_SCREEN,{screenName:t})}},{key:"showLoadingScreen",value:function(e){this.openScreen(Kn.LOADING_SCREEN,{duration:e})}},{key:"closeLoadingScreen",value:function(){this.closeScreen(Kn.LOADING_SCREEN)}},{key:"showNotificationScreen",value:function(e,t){this.openScreen(Kn.NOTIFICATION_SCREEN,{message:e,duration:t})}},{key:"closeNotificationScreen",value:function(){this.closeScreen(Kn.NOTIFICATION_SCREEN)}},{key:"addShowedScene",value:function(e){this.inst.showedScreens.includes(e)||this.inst.showedScreens.push(e)}},{key:"showLoadingFullScreen",value:(n=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.inst.showedScreens.includes(t)){e.next=2;break}return e.abrupt("return");case 2:if(this.addShowedScene(t),n=x("Loading")){e.next=6;break}return e.abrupt("return");case 6:return n.active=!0,e.next=9,n.getComponent(Wl).show();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"hideLoadingFullScreen",value:(t=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.inst.showedScreens.includes(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,null===(n=x("Loading"))||void 0===n?void 0:n.getComponent(Wl).hide();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"showLoadingNotificationScreen",value:function(){this.openScreen(Kn.NOTIFICATION_SCREEN,{message:"Loading",enableCloseOnTouch:!1})}},{key:"showTournamentDetailScreen",value:function(e,t){this.openScreen(Kn.TOURNAMENT_DETAIL_SCREEN,{tournament:e,tournamentContextType:t})}},{key:"closeTournamentDetailScreen",value:function(){this.closeScreen(Kn.TOURNAMENT_DETAIL_SCREEN)}}]),e}();try{new Yl}catch(e){console.error("ScreenUtils",e)}n._RF.pop(),n._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);var Xl=GameCore,$l=Xl.Utils,Ql=Xl.Configs,Jl=globalThis.game,Zl=Jl.leaderboard,eu=Jl.player,tu=function(){function e(){var t=this;Ae(this,e),this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(Date.now()-t.lastFetchGlobalTournament>t.maxTimeRefetch)){e.next=7;break}return e.next=5,Zl.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"});case 5:t.globalTournamentLBData=e.sent,t.globalTournamentLBData.sort((function(e,t){return e.expireTime-t.expireTime}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("fetchGlobalTournamentLeaderboardAsync",e.t0);case 12:return e.abrupt("return",t.globalTournamentLBData);case 13:case"end":return e.stop()}}),e,null,[[0,9]])}))),this.fetchTournamentsAsync=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(Date.now()-t.lastFetchTournamentsData>t.maxTimeRefetch)){e.next=7;break}return e.next=5,GameSDK.tournament.getTournamentsAsync();case 5:t.playerTournaments=e.sent,t.playerTournaments.sort((function(e,t){return e.getEndTime()-t.getEndTime()}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("fetchTournamentsAsync",e.t0);case 12:return e.abrupt("return",t.playerTournaments);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))}var t;return Re(e,[{key:"processPlayerTournamentData",value:function(){var e,t=[],n=je(this.playerTournaments);try{for(n.s();!(e=n.n()).done;){var i,a,r=e.value,o=`${r.getID()}`,s=r.getContextID(),l=r.getEndTime(),u=this.parseTournamentPayload(r.getPayload());if(this.validateGameSDKTournamentPayload(u))if(!(l<Date.now()/1e3)&&"PAGE_HOSTED"!==r.getTournamentType()){var c=null!==(i=u.playerName)&&void 0!==i?i:"Player",h={id:o,title:null!==(a=r.getTitle())&&void 0!==a?a:this.createDefaultTournamentName(c),endTime:l,contextId:s,payload:u};t.push(h)}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"processGlobalTournamentLeaderboardData",value:function(){var e=[];if(Ql.Mockup.Leaderboards.Enabled){for(var t=0;t<this.playerTournaments.length;t++){var n,i=this.playerTournaments[t],a=i.getTournamentType();if("PAGE_HOSTED"===a){var r=`${i.getID()}`,o=i.getContextID(),s=i.getEndTime(),l=this.parseTournamentPayload(i.getPayload()),u={id:r,title:null!==(n=i.getTitle())&&void 0!==n?n:"Global Tournament",endTime:s,contextId:o,payload:l,tournamentType:a};e.push(u)}}return e}for(var c=0;c<this.globalTournamentLBData.length;c++){var h,p={tournamentId:"",contextId:""},d=this.globalTournamentLBData[c];try{p=JSON.parse(d.description)}catch(e){continue}if(this.validateExpireTime(d)&&this.validateGlobalTournamentPayload(p)){var f={id:p.tournamentId,title:d.name,endTime:this.getTournamentEndTime(d),contextId:p.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:d._id,themeId:null!==(h=p.themeId)&&void 0!==h?h:ol.SUMMER}};e.push(f)}}return e}},{key:"validateGlobalTournamentPayload",value:function(e){var t=e.tournamentId,n=e.contextId;return!(!$l.Valid.isString(t)||""===t)&&!(!$l.Valid.isString(n)||""===n)}},{key:"getTournamentEndTime",value:function(e){var t=new Date(e.createdAt).getTime();return Math.round((1e3*e.expireTime+t)/1e3)}},{key:"validateExpireTime",value:function(e){return 1e3*this.getTournamentEndTime(e)-Date.now()>0}},{key:"validateGameSDKTournamentPayload",value:function(e){return!(!$l.Valid.isString(e.playerId)||""===e.playerId)&&(!(!$l.Valid.isString(e.playerName)||""===e.playerName)&&!(!$l.Valid.isString(e.leaderboardId)||""===e.leaderboardId))}},{key:"createDefaultTournamentName",value:function(e){var t=e.substring(0,7),n=`${t.split(" ")[0]||t}'s Tournament`;return`${GameCore.Utils.String.removeDiacritics(n)}`}},{key:"parseTournamentPayload",value:function(e){if("string"!=typeof e)return{};try{return JSON.parse(e)}catch(e){return{}}}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"requestTournamentDataAsync",value:(t=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getInstance(),e.next=3,Promise.all([t.fetchTournamentsAsync(),t.fetchGlobalTournamentLeaderboardAsync()]);case 3:return n=t.processPlayerTournamentData(),i=t.processGlobalTournamentLeaderboardData(),t.tournamentData=[].concat(Ve(n),Ve(i)),t.tournamentData.sort((function(e,t){return e.endTime-t.endTime})),t.tournamentData.forEach((function(e){var t=e.payload.leaderboardId;t&&(Zl.isExistLeaderboardId(t)||Zl.addLeaderboard({type:"tournament",name:t,autoSortRank:!0,leaderboardId:t}))})),e.abrupt("return",t.tournamentData);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getAllTournamentData",value:function(){return this.getInstance().tournamentData}},{key:"getTournamentDataById",value:function(e){return this.getInstance().tournamentData.find((function(t){return t.id===e}))}},{key:"getPlayerTournamentData",value:function(){var e=this.getInstance(),t=eu.getPlayerId();return e.tournamentData.filter((function(e){return e.payload.playerId===t}))}},{key:"getFriendsTournamentData",value:function(){var e=this.getInstance(),t=eu.getPlayerId();return e.tournamentData.filter((function(e){var n=e.payload;return n.playerId!==t&&"global"!==n.playerId}))}},{key:"getGlobalTournamentData",value:function(){return this.getInstance().tournamentData.filter((function(e){return"global"===e.payload.playerId}))}},{key:"validateTournamentExpired",value:function(e){var t=this.getTournamentDataById(e);return!!t&&t.endTime<Date.now()/1e3}}]),e}();n._RF.pop(),n._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var nu,iu="time",au="bomb";n._RF.pop(),n._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var ru=(0,i.ccclass)("InputController")(nu=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).handleElementPointerDown=function(){},e.handleElementPointerUp=function(e){},e}return Re(n,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){K.os!==K.OS.WINDOWS&&K.os!==K.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){K.os!==K.OS.WINDOWS&&K.os!==K.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(f))||nu;n._RF.pop(),n._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var ou={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};n._RF.pop(),n._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var su="fall-down",lu="fly-up",uu="push-left",cu="push-right",hu="put-column-middle",pu="put-row-middle";function du(e){for(var t=e.array,n=e.isLighter,i=e.out,a=void 0===i?new Set:i,r=0;r<t.length;r++)if(n(t.get(r)))for(var o=r+1;o<t.length;o++)if(!n(t.get(o))){t.swap(r,o),a.add(t.get(r));break}return a}n._RF.pop(),n._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var fu=function(){function e(t){var n;Ae(this,e),this.array=[];var i=null!=t?t:{},a=i.width,r=void 0===a?1:a,o=i.height,s=void 0===o?1:o,l=t instanceof e?t.array:null!==(n=null==t?void 0:t.content)&&void 0!==n?n:[];if(l.length!==r*s)throw new Error("Invalid content length");this.width=r,this.height=s,this.array=Array.from(l)}return Re(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(e,t){return this.array[t*this.width+e]}},{key:"set",value:function(e,t,n){this.array[t*this.width+e]=n}},{key:"isInBounds",value:function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}},{key:"forEach",value:function(e){for(var t=0;t<this.height;t++)for(var n=0;n<this.width;n++)e(this.get(n,t),n,t)}},{key:"map",value:function(e){for(var t=[],n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.push(e(this.get(i,n),i,n));return t}},{key:"reduce",value:function(e,t){for(var n=t,i=0;i<this.height;i++)for(var a=0;a<this.width;a++)n=e(n,this.get(a,i),a,i);return n}},{key:"swap",value:function(e,t){var n=qe(e,2),i=n[0],a=n[1],r=qe(t,2),o=r[0],s=r[1],l=this.get(i,a);this.set(i,a,this.get(o,s)),this.set(o,s,l)}},{key:"shuffle",value:function(e){for(var t,n=Ve(e=null!==(t=e)&&void 0!==t?t:this.map((function(e,t,n){return[t,n]}))),i=new Set,a=n.length-1;a>0;a--){var r=Z(0,a+1),o=[n[r],n[a]];n[a]=o[0],n[r]=o[1],i.add(this.get(n[a][0],n[a][1])),i.add(this.get(n[r][0],n[r][1]))}for(var s=0;s<n.length;s++){var l=qe(e[s],2),u=l[0],c=l[1],h=qe(n[s],2),p=h[0],d=h[1];this.swap([u,c],[p,d])}return i}},{key:"toShuffled",value:function(t){var n=new e({width:this.width,height:this.height,content:this.array}),i=n.shuffle(t);return[n,i]}},{key:"gravitate",value:function(e){var t=this,n=qe(e.rowRange,2),i=n[0],a=n[1],r=qe(e.colRange,2),o=r[0],s=r[1],l=e.direction,u=e.isLighter,c=e.onSwap,h=e.out,p=void 0===h?new Set:h,d=s-o+1,f=a-i+1;switch(l){case ou.Up:for(var v=function(e){du({array:{length:f,get:function(n){return t.get(e,a-n)},swap:function(n,i){var r=t.get(e,a-n),o=t.get(e,a-i);t.swap([e,a-n],[e,a-i]),null==c||c(r,o)}},isLighter:u,out:p})},y=o;y<=s;y++)v(y);return p;case ou.Down:for(var m=function(e){du({array:{length:f,get:function(n){return t.get(e,i+n)},swap:function(n,a){var r=t.get(e,i+n),o=t.get(e,i+a);t.swap([e,i+n],[e,i+a]),null==c||c(r,o)}},isLighter:u,out:p})},g=o;g<=s;g++)m(g);return p;case ou.Left:for(var b=function(e){du({array:{length:d,get:function(n){return t.get(o+n,e)},swap:function(n,i){var a=t.get(o+n,e),r=t.get(o+i,e);t.swap([o+n,e],[o+i,e]),null==c||c(a,r)}},isLighter:u,out:p})},w=i;w<=a;w++)b(w);return p;case ou.Right:for(var k=function(e){du({array:{length:d,get:function(n){return t.get(s-n,e)},swap:function(n,i){var a=t.get(s-n,e),r=t.get(s-i,e);t.swap([s-n,e],[s-i,e]),null==c||c(a,r)}},isLighter:u,out:p})},S=i;S<=a;S++)k(S);return p;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var t=new e({width:this.width,height:this.height,content:this.array}),n=t.gravitate.apply(t,arguments);return[t,n]}},{key:"toRotated",value:function(){for(var t=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.set(this.height-1-n,i,this.get(i,n));return t}}]),e}();n._RF.pop(),n._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),n._RF.pop(),n._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);var vu,yu,mu,gu,bu,wu,ku,Su,Eu,Cu,Tu,Au,xu,Ru,Iu,Pu,_u,Lu,Ou,Du,Nu,Mu,Fu,Bu,Gu,Uu={bomb:"bomb",star:"star",none:"none"};n._RF.pop(),n._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var zu=i.ccclass,Hu=i.property,qu=i.requireComponent,Vu=(vu=zu("Tile"),yu=qu([s]),mu=qu([D]),gu=Hu(A),bu=Hu(A),wu=Hu(A),ku=Hu(a),Su=Hu({type:s,displayName:"Background's UI Transform"}),Eu=Hu({type:D,displayName:"This UI Opacity"}),Cu=Hu(D),Tu=Hu(D),Au=Hu(Bi),xu=Hu(y),vu(Ru=yu(Ru=mu((Pu=$e((Iu=function(e){Pe(h,e);var t,n,i,a,r,o,s,l,u,c=Be(h);function h(){var e;Ae(this,h);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=c.call.apply(c,[this].concat(n)),"icon",Pu,Me(e)),Xe(e,"bombComponent",_u,Me(e)),Xe(e,"starComponent",Lu,Me(e)),Xe(e,"background",Ou,Me(e)),Xe(e,"bgUITransform",Du,Me(e)),Xe(e,"uiOpacity",Nu,Me(e)),Xe(e,"shineOpacity",Mu,Me(e)),Xe(e,"glowOpacity",Fu,Me(e)),Xe(e,"button",Bu,Me(e)),Xe(e,"animationComponent",Gu,Me(e)),e.id=null,e.isEmpty=!1,e.coord=new $,e.restoreSignal=new qi,e}return Re(h,[{key:"onLoad",value:function(){St.lazyValidateProperties(this),this.special=this.createSpecialHandler(Uu.none)}},{key:"update",value:function(e){var t;(null===(t=this.special)||void 0===t?void 0:t.type)===Uu.bomb&&this.special.update(e)}},{key:"onDestroy",value:function(){var e,t;(null===(e=this.special)||void 0===e?void 0:e.type)===Uu.bomb&&(null===(t=this.special)||void 0===t||t.onDestroy())}},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.button.interactable=!e}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(e,t){this.coord.set(e,t)}},{key:"isSimilarTo",value:function(e){return this.id===e.id}},{key:"inSamePositionAs",value:function(e,t){return e instanceof h?this.coord.equals(e.getCoord()):this.coord.x===e&&this.coord.y===t}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(Ka.TILE_CLICK,this)}},{key:"setIdentity",value:function(e){this.id=e,this.icon.spriteFrame=e;var t=qe(this.getSize(),2),n=t[0],i=t[1],a=e.originalSize,r=a.width,o=a.height,s=Math.max(r/(.7*n),o/(.7*i));s>1&&this.icon.node.setScale(new j(1/s,1/s,1))}},{key:"setSpecialType",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Uu.none,n=arguments.length>1?arguments[1]:void 0;null===(e=this.special)||void 0===e||e.switch(t,n)}},{key:"setFocused",value:(u=Te(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=S(this.shineOpacity).to(.2,{opacity:t?255:0},{easing:"quadIn"}),this.shineOpacity.node.scale=t?j.ZERO:j.ONE,i=S(this.shineOpacity.node).to(.2,{scale:t?j.ONE:j.ZERO},{easing:"quadOut"}),t?((a=S(this.glowOpacity).to(2,{opacity:150})).to(2,{opacity:20}),this.glowOpacityTween=S(this.glowOpacity).repeatForever(a).start()):(this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0),e.next=6,Promise.all([yn.runTweenAsync(n),yn.runTweenAsync(i)]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"setEmpty",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty){var i;if(this.restoreSignal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),n)return this.uiOpacity.opacity=0,void(null===(i=this.special)||void 0===i||i.switch(Uu.none));(null===(e=this.special)||void 0===e?void 0:e.type)===Uu.star&&this.special.clear(),null===(t=this.special)||void 0===t||t.switch(Uu.none),this.uiOpacity.opacity=0}}},{key:"setHint",value:(l=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,this.loadShakeClip();case 3:this.shakeClip&&this.runAnimation(this.shakeClip.name),e.next=10;break;case 6:return this.animationComponent.stop(),n=S(this.background).to(.1,{scale:j.ONE,eulerAngles:j.ZERO}),e.next=10,yn.runTweenAsync(n);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"playClearFX",value:(s=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,"clear"!==t){e.next=7;break}return e.next=4,this.loadClearClip();case 4:n=this.clearClip,e.next=10;break;case 7:return e.next=9,this.loadBreakClip();case 9:n=this.breakClip;case 10:if(null===n){e.next=13;break}return e.next=13,this.runAnimation(n.name);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"restore",value:(o=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.restoreSignal.abort(),this.restoreSignal=new qi,this.isEmpty=!1,this.setIgnoreInput(!0),t&&this.setIdentity(t),this.uiOpacity.opacity=255,this.node.setScale(j.ZERO),this.button.fakeClick(),e.next=10,yn.runTweenAsync(S(this.node).to(.3,{scale:j.ONE},{easing:"backOut"}),this.restoreSignal);case 10:this.node.setScale(j.ONE),this.setIgnoreInput(!1);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"sync",value:(r=Te(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.duration,i=void 0===n?.3:n,a=t.delay,r=void 0===a?0:a,o=t.easing,s=void 0===o?"cubicOut":o,l=t.getTargetPosition,u=l(this.coord),c=new j(u.x,u.y,this.node.position.z),e.next=5,yn.runTweenAsync(S(this.node).delay(r).to(i,{position:c},{easing:s}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fly",value:(a=Te(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=300,i=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),a=Math.max(n-.7*i,0),r=i/1e3,o=this.node.position.clone(),s=t.getTilePosition(this.coord),l=new j(s.x,s.y,this.node.position.z),u=this.background,c=2,h=1,p=360,d=.0025*a,f=0,v=new j(0,0,0),y=.75-d,(g=S(m={value:0,prevElapsed:0})).delay(r),g.to(.5,{value:0},{progress:function(e,t,n,i){var a=(c*=-1)*i,r=o.clone();return r.x+=a,b.node.setPosition(r),n}}),g.to(d,{value:1},{progress:function(e,t,i,r){var o=yn.easeOutExpo(r),s=d*r-m.prevElapsed,l=d*r,c=a*o;b.setHeight(c,n);var f=b.node.position.clone();h+=.1,j.rotateZ(f,f,new j(0,0,0),h*Math.PI*s),b.node.setPosition(new j(f.x,f.y,f.z));var v=(p+=10)*s;return u.angle+=v,m.prevElapsed=l,i}}),g.call((function(){v.set((b.node.position.x+l.x)/2,(b.node.position.y+l.y)/2,0),m.prevElapsed=0,u.angle%=360,u.angle-=360,f=u.angle})),g.to(y,{value:0},{progress:function(e,t,i,r){var o=y*r-m.prevElapsed,s=y*r,l=a*(1-r);b.setHeight(l,n);var c=b.node.position.clone();return j.rotateZ(c,c,v,Math.PI/y*o),b.node.setPosition(new j(c.x,c.y,c.z)),u.angle+=-f/y*o,m.prevElapsed=s,i}}),g.call((function(){b.node.setPosition(l),b.setHeight(0,n),u.angle=0})),e.abrupt("return",yn.runTweenAsync(g));case 25:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"loadBreakClip",value:(i=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.breakClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Bn.loadAnimClipAsync(Rn.TILE_BREAK_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.breakClip=t,this.animationComponent.addClip(this.breakClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"loadClearClip",value:(n=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.clearClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Bn.loadAnimClipAsync(Rn.TILE_CLEAR_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.clearClip=t,this.animationComponent.addClip(this.clearClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadShakeClip",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shakeClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Bn.loadAnimClipAsync(Rn.TILE_SHAKE_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.shakeClip=t,this.animationComponent.addClip(this.shakeClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"runAnimation",value:function(e){var t=this;return this.animationComponent.play(e),new Promise((function(e){t.animationComponent.once(y.EventType.FINISHED,(function(){e()}))}))}},{key:"setHeight",value:function(e,t){var n=this.background;n.setPosition(new j(n.position.x,e,0)),n.setScale(new j(1+e/t*.3,1+e/t*.3,1))}},{key:"createSpecialHandler",value:function(e,t){var n=this;switch(e){case Uu.bomb:return this.createBombHandler(null!=t?t:90);case Uu.star:return this.createStarHandler();default:return{type:Uu.none,switch:function(e,t){n.special=n.createSpecialHandler(e,t)}}}}},{key:"createBombHandler",value:function(e){var t=this,n=!1,i=e,a=function(){n=!0},r=function(){n=!1};this.node.scene.on(Ka.TILE_CLICK,a),this.node.scene.on(Ka.USE_ITEM,a),this.node.scene.on(Ka.RESUME_TIME,a),this.node.scene.on(Ka.PAUSE_TIME,r),this.node.scene.on(Ka.TIME_OUT,r),this.bombComponent.node.active=!0;var o=function(){n=!1,t.bombComponent.node.active=!1,i=e,t.node.scene.off(Ka.TILE_CLICK,a),t.node.scene.off(Ka.USE_ITEM,a),t.node.scene.off(Ka.GAME_RESUME,a),t.node.scene.off(Ka.GAME_PAUSE,r),t.node.scene.off(Ka.TIME_OUT,r)};return{type:Uu.bomb,update:function(a){n&&(i-=a,t.bombComponent.fillRange=-i/e,i<=0&&(n=!1,t.bombComponent.node.active=!1,t.node.scene.emit(Ka.BOMB_EXPLODE,t),t.setEmpty()))},cleanup:o,onDestroy:function(){t.node.scene.off(Ka.TILE_CLICK,a),t.node.scene.off(Ka.USE_ITEM,a),t.node.scene.off(Ka.GAME_RESUME,a),t.node.scene.off(Ka.GAME_PAUSE,r),t.node.scene.off(Ka.TIME_OUT,r)},switch:function(e,n){o(),t.special=t.createSpecialHandler(e,n)},detonateImmediately:function(){i=0}}}},{key:"createStarHandler",value:function(){var e=this;this.starComponent.node.active=!0;var t=function(){e.starComponent.node.active=!1};return{type:Uu.star,clear:function(){e.starComponent.node.active=!1;var t=e.node.worldPosition,n=t.x,i=t.y;e.node.scene.emit(Ka.ADD_STARS,{startAnimationAt:[n,i]})},cleanup:t,switch:function(n){t(),e.special=e.createSpecialHandler(n)}}}}]),h}(f)).prototype,"icon",[gu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_u=$e(Iu.prototype,"bombComponent",[bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lu=$e(Iu.prototype,"starComponent",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ou=$e(Iu.prototype,"background",[ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Du=$e(Iu.prototype,"bgUITransform",[Su],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nu=$e(Iu.prototype,"uiOpacity",[Eu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mu=$e(Iu.prototype,"shineOpacity",[Cu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fu=$e(Iu.prototype,"glowOpacity",[Tu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bu=$e(Iu.prototype,"button",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gu=$e(Iu.prototype,"animationComponent",[xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ru=Iu))||Ru)||Ru)||Ru);function Wu(e,t,n){var i=qe(e,2),a=i[0],r=i[1],o=qe(t,2),s=o[0],l=o[1],u=qe(n,2),c=u[0]/(a*s),h=u[1]/(r*l);return Math.min(c,h)}function Ku(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=n.x,r=n.y,o=qe(t,2),s=o[0],l=o[1],u=s*(a-(e.width-1)/2)+i*(a-e.width/2),c=l*(r-(e.height-1)/2)+i*(r-e.height/2);return-1===a&&(u+=t[0]/4),a===e.width&&(u-=t[0]/4),-1===r&&(c+=t[1]/4),r===e.height&&(c-=t[1]/4),{x:u,y:c}}function ju(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],n=qe(e,2),i=n[0],a=n[1],r=qe(t,2),o=r[0],s=r[1],l=1-o,u=1-s,c=i*l,h=a*u;return[c,h]}function Yu(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.split("-"),i=[],a=0;a<n.length;){var r=null,o=n[a];switch(o){case"normal":a+=1;break;case"fall":r=su,a+=2;break;case"fly":r=lu,a+=2;break;case"push":"left"===n[a+1]?(r=uu,a+=2):(r=cu,a+=2);break;case"put":"columns"===n[a+1]?(r=hu,a+=3):(r=pu,a+=3)}r&&(t&&(r=Xu(r)),i.push(r))}return i}function Xu(e){switch(e){case su:return cu;case lu:return uu;case uu:return su;case cu:return lu;case hu:return pu;case pu:return hu}}function $u(e){return(e instanceof fu?e.asArray():e).filter((function(e){return!e.isHidden()}))}function Qu(e){return(e instanceof fu?e.asArray():e).filter((function(e){return e.isHidden()}))}function Ju(e,t){var n=t.getCoord(),i=n.x,a=n.y;return Object.values(ou).reduce((function(t,n){var r=n.x,o=n.y,s=i+r,l=a+o;return e.isInBounds(s,l)&&t.push(e.get(s,l)),t}),[])}function Zu(e){return Array.isArray(e)}function ec(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=Zu(e)?e:e.asArray();return n[ee(t,0,n.length)]}function tc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e instanceof fu?e.asArray():e,i=ec(n,t),a=n.find((function(e){return e.isSimilarTo(i)&&!e.inSamePositionAs(i)}));if(void 0===a)throw new Error("Could not find a matching tile");return[i,a]}n._RF.pop(),n._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),n._RF.pop(),n._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),n._RF.pop(),n._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),n._RF.pop(),n._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),n._RF.pop(),n._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),n._RF.pop(),n._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),n._RF.pop(),n._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),n._RF.pop(),n._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),n._RF.pop(),n._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0),n._RF.pop(),n._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),n._RF.pop(),n._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0),n._RF.pop(),n._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var nc=function(e){return e};function ic(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:nc;return Se().mark((function i(){var a,r;return Se().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:a=t,e<=0&&(e=1/0),r=0;case 3:if(!(r<e)){i.next=10;break}return i.next=6,n(a);case 6:a=1e9*te(a);case 7:r++,i.next=3;break;case 10:case"end":return i.stop()}}),i)}))()}function ac(e){return Array.isArray(e)}function rc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=ac(e)?e:e.asArray();if(i.length<t)return new Set(i);for(var a=new Set,r=ic(-1,n),o=r.next();a.size<t;){if(o.done)throw new Error("RNG exhausted");a.add(ec(i,o.value)),o=r.next()}return a}n._RF.pop(),n._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),n._RF.pop(),n._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),n._RF.pop(),n._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var oc=[1,4];function sc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=t.specials,a=i.bomb,r=ee.apply(void 0,[n].concat(oc)),o=rc(e,a,n),s=e.asArray().filter((function(e){return!o.has(e)})),l=rc(s,r,n);o.forEach((function(e){var n=2*t.time/3;e.setSpecialType(Uu.bomb,n)})),l.forEach((function(e){return e.setSpecialType(Uu.star)}))}function lc(e){var t=e.levelData,n=t.columns,i=t.rows,a=e.identities,r=e.createTile,o=e.seed,s=function(e,t,n){var i,a=[],r=je(ic(t/2,e,(function(e){return ee(e,0,n.length)})));try{for(r.s();!(i=r.n()).done;){var o=i.value;a.push(n[o]),a.push(n[o])}}catch(e){r.e(e)}finally{r.f()}return GameCore.Utils.Array.shuffle(a),a}(void 0===o?Date.now():o,n*i,a).map((function(e){var t=r(e);return t.setIdentity(e),t}));return new fu({width:n,height:i,content:s})}function uc(e){var t=e.customFen,n=e.identities,i=e.createTile,a=t.idSize,r=t.cols,o=t.rows,s=t.code;if(n.length<t.idSize)throw new Error(`Invalid grid code. There are not enough identities/frames ${n.length} to fill it according to fen code ${a}`);var l=s.split(":");if(l.length!==o)throw new Error("Invalid grid code");var u=l.reduceRight((function(e,a){var r=Array.from(a.matchAll(Ee(/([a-zA-Z]+)(\d+)|./g,{ttype:1,itype:2})),(function(e){var a,r=null!==(a=e.groups)&&void 0!==a?a:{ttype:void 0,itype:void 0},o=r.ttype,s=r.itype;if(void 0!==o&&void 0!==s){var l=n[parseInt(s,10)],u=i(l),c=function(e,t){var n=Object.entries(t).find((function(t){var n=qe(t,2);n[0];return n[1]===e}));if(void 0===n)throw new Error(`Invalid special type ${e}`);return n[0]}(o,t.encoding);return u.setSpecialType(c),u}var h=i(n[0]);return h.setEmpty(),h}));return e.concat(r)}),[]);return new fu({width:r,height:o,content:u})}function cc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e.asArray(),i=ec(e,t),a=Ju(e,i);if(!a.some((function(e){return e.isSimilarTo(i)}))){var r=ec(a,t),o=n.find((function(e){return!e.inSamePositionAs(i)&&!e.inSamePositionAs(r)&&e.isSimilarTo(r)}));o.setIdentity(i.id),r.setIdentity(i.id)}}n._RF.pop(),n._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),n._RF.pop(),n._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0),n._RF.pop(),n._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0),n._RF.pop(),n._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),n._RF.pop(),n._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0),n._RF.pop(),n._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),n._RF.pop(),n._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var hc=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];function pc(e,t){return e[0]===t[0]&&e[1]===t[1]}function dc(e){return new $(e[0],e[1])}function fc(e,t){return e.x>=-1&&e.x<t.width+1&&e.y>=-1&&e.y<t.height+1}function vc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yc;return t.map((function(t){return[e.tile[0]+t.x,e.tile[1]+t.y]}))}n._RF.pop(),n._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var yc=[ou.Up,ou.Down,ou.Left,ou.Right],mc=function(){function e(t,n){var i;if(Ae(this,e),this.f=0,this.g=0,this.h=0,n&&pc(t,n.tile))throw new Error("Tile cannot be its own parent");this.tile=t,this.parent=n;var a=e.calcDirection(this),r=n&&a&&n.cache.direction&&!a.equals(n.cache.direction)?1:0;this.cache={direction:a,turns:r+(null!==(i=null==n?void 0:n.cache.turns)&&void 0!==i?i:0)}}return Re(e,[{key:"getKey",value:function(){var e;return`x:${this.tile[0]},y:${this.tile[1]},d:${null===(e=this.cache.direction)||void 0===e?void 0:e.toString()}`}},{key:"equals",value:function(e){return this.getKey()===e.getKey()}}],[{key:"calcDirection",value:function(e){if(e.parent){var t=e.parent.tile,n=e.tile;return new $(n[0]-t[0],n[1]-t[1])}return null}}]),e}();function gc(e,t){var n=e.tile,i=t.tile;return Math.abs(n[0]-i[0])+Math.abs(n[1]-i[1])}function bc(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=[],r=je(yc);try{var o=function(){var r=n.value,o={x:t[0]+r.x,y:t[1]+r.y};if(e.isInBounds(o.x,o.y))return(e.get(o.x,o.y).isHidden()||i.find((function(e){return pc(e,[o.x,o.y])})))&&a.push(r),1;fc(o,e)&&a.push(r)};for(r.s();!(n=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}return a}function wc(e,t,n,i){if(i){var a=hc[4].startTile,r=hc[4].endTile;if(t[0]===a.x&&t[1]===a.y&&n[0]===r.x&&n[1]===r.y)return[{a:a,b:r}];if(t[0]===r.x&&t[1]===r.y&&n[0]===a.x&&n[1]===a.y)return[{a:a,b:r}]}return function(e,t,n){var i=[],a=[],r=new mc(t,null),o=new mc(n,null),s=[o.tile];for(i.push(r);i.length>0;){var l=i.shift();if(a.push(l),pc(l.tile,o.tile)){for(var u=[],c=l,h=l,p=l.parent;p;)p.cache.turns!==h.cache.turns&&(u.unshift({a:dc(p.tile),b:dc(c.tile)}),c=p),h=p,p=p.parent;return u.unshift({a:dc(h.tile),b:dc(c.tile)}),u}var d,f=je(vc(l,bc(e,l.tile,s)));try{var v=function(){var e=d.value,t=new mc(e,l);if(t.cache.turns>8)return 0;var n=pc(t.tile,o.tile),r=a.some((function(e){return e.equals(t)}));if(i.some((function(e){return e.equals(t)}))||r&&!n)return 0;t.g=l.g+1+t.cache.turns,t.h=gc(t,o),t.f=t.g+t.h,i.push(t)};for(f.s();!(d=f.n()).done;)v()}catch(e){f.e(e)}finally{f.f()}i.sort((function(e,t){return e.f-t.f}))}var y=r.tile,m=o.tile;return y[0]===m[0]||y[1]===m[1]?[{a:dc(y),b:dc(m)}]:[{a:dc(y),b:{x:y[0],y:m[1]}},{a:{x:y[0],y:m[1]},b:dc(m)}]}(e,t,n)}n._RF.pop(),n._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),n._RF.pop(),n._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var kc={[Uu.bomb]:"b",[Uu.star]:"s",[Uu.none]:"t"};function Sc(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kc,n=e.width,i=e.height,a=[],r=new Map,o=i-1;o>=0;o--){for(var s=[],l=0;l<n;l++){var u,c,h=e.get(l,o),p=h.isHidden()?null:h.id;if(null!==p){var d=null!==(u=null===(c=h.special)||void 0===c?void 0:c.type)&&void 0!==u?u:Uu.none,f=t[d];if(!r.has(p)){var v=r.size.toString();r.set(p,v)}var y=`${f}${r.get(p)}`;s.push(y)}else s.push(".")}a.push(s.join(""))}return{code:a.join(":"),idSize:r.size,encoding:t,rows:i,cols:n}}function Ec(e){return e.reduce((function(e,t,n,i){return t.inSamePositionAs(n,i)||e.push([t,[n,i]]),e}),[])}n._RF.pop(),n._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),n._RF.pop();var Cc=Se().mark(Tc);function Tc(e,t){var n,i,a,r,o,s,l,u;return Se().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=0,i=e-1,a=0,r=t-1;case 4:if(!(n<=i&&a<=r)){c.next=39;break}o=n;case 6:if(!(o<=i)){c.next=12;break}return c.next=9,{x:o,y:a};case 9:o++,c.next=6;break;case 12:a++,s=a;case 14:if(!(s<=r)){c.next=20;break}return c.next=17,{x:i,y:s};case 17:s++,c.next=14;break;case 20:i--,l=i;case 22:if(!(l>=n)){c.next=28;break}return c.next=25,{x:l,y:r};case 25:l--,c.next=22;break;case 28:r--,u=r;case 30:if(!(u>=a)){c.next=36;break}return c.next=33,{x:n,y:u};case 33:u--,c.next=30;break;case 36:n++,c.next=4;break;case 39:case"end":return c.stop()}}),Cc)}n._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),n._RF.pop(),n._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var Ac,xc,Rc,Ic,Pc,_c,Lc,Oc,Dc,Nc,Mc=function(){function e(t,n){Ae(this,e),this.coord=new $(t,n)}return Re(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function Fc(e){return new $(e[0],e[1])}function Bc(e,t,n){if(void 0===t||void 0===n)return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Tc,i=Array.from(n(e.width,e.height)).map((function(t){var n=t.x,i=t.y;return[e.get(n,i),[n,i]]})).filter((function(e){return!qe(e,1)[0].isHidden()})),a=[],r=function(){var t=qe(i.shift(),2),n=t[0],r=t[1];if(a.find((function(e){return zc(e,r)})))return 0;a.push(r);var o,s=je(i);try{var l,u=function(){var t=qe(o.value,2),i=t[0],s=t[1];if(!i.isSimilarTo(n)||a.find((function(e){return zc(e,s)})))return 0;var l=Bc(e,r,s);return null!==l?{v:{v:l}}:void 0};for(s.s();!(o=s.n()).done;)if(0!==(l=u())&&l)return l.v}catch(e){s.e(e)}finally{s.f()}};for(;i.length>0;)if(0!==(t=r())&&t)return t.v;return null}(e);var i,a=[t[0]+1,t[1]+1],r=[n[0]+1,n[1]+1],o=function(e){var t=new Array(e.width+2).fill(null).map((function(e,t){return new Mc(t-1,-1)})),n=new Array(e.width+2).fill(null).map((function(t,n){return new Mc(n-1,e.height)})),i=new Array(e.height).fill(null).map((function(e,t){return new Mc(-1,t)})),a=new Array(e.height).fill(null).map((function(t,n){return new Mc(e.width,n)})),r=function(r,o){var s=r-1,l=o-1;return-1===s?i[l]:s===e.width?a[l]:-1===l?t[s]:l===e.height?n[s]:e.get(s,l)};return{get:(e,t)=>r(e,t),width:e.width+2,height:e.height+2}}(e),s=[a,r];if(a[0]===r[0]&&qc(o,s,a[1],r[1],a[0])||a[1]===r[1]&&Vc(o,s,a[0],r[0],a[1]))return jc([{a:Fc(a),b:Fc(r)}],{x:-1,y:-1});var l=a[1]<=r[1]?a:r,u=a[1]<=r[1]?r:a,c=a[0]<=r[0]?a:r,h=a[0]<=r[0]?r:a,p=[],d=[];return-1===(i=Wc(o,s,1,Fc(l),Fc(u)))&&-1===(i=Wc(o,s,-1,Fc(l),Fc(u)))||(p=[{a:Fc(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:r[0],y:i}},{a:{x:r[0],y:i},b:Fc(r)}]),-1===(i=Kc(o,s,1,Fc(c),Fc(h)))&&-1===(i=Kc(o,s,-1,Fc(c),Fc(h)))||(p=[{a:Fc(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:r[1]}},{a:{x:i,y:r[1]},b:Fc(r)}]),-1!==(i=function(e,t,n,i){for(var a=n.y+1;a<i.y;a++)if(qc(e,t,n.y,a,n.x)&&Vc(e,t,n.x,i.x,a)&&qc(e,t,a,i.y,i.x))return a;return-1}(o,s,Fc(l),Fc(u)))?d=[{a:Fc(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:r[0],y:i}},{a:{x:r[0],y:i},b:Fc(r)}]:-1!==(i=function(e,t,n,i){for(var a=n.x+1;a<i.x;a++)if(Vc(e,t,n.x,a,n.y)&&qc(e,t,n.y,i.y,a)&&Vc(e,t,a,i.x,i.y))return a;return-1}(o,s,Fc(c),Fc(h)))&&(d=[{a:Fc(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:r[1]}},{a:{x:i,y:r[1]},b:Fc(r)}]),p.length>0&&d.length>0?jc(Gc(p)<=Gc(d)?p:d,{x:-1,y:-1}):p.length>0?jc(p,{x:-1,y:-1}):d.length>0?jc(d,{x:-1,y:-1}):null}function Gc(e){var t,n=0,i=je(e);try{for(i.s();!(t=i.n()).done;){n+=Uc(t.value)}}catch(e){i.e(e)}finally{i.f()}return n}function Uc(e){return e.a.x===e.b.x?Math.abs(e.a.y-e.b.y):e.a.y===e.b.y?Math.abs(e.a.x-e.b.x):0}function zc(e,t){return e[0]===t[0]&&e[1]===t[1]}function Hc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=e.get.apply(e,Ve(t));return i.isHidden()||n.some((function(e){return zc(e,t)}))}function qc(e,t,n,i,a){for(var r=Math.min(n,i),o=Math.max(n,i),s=r;s<=o;s++)if(!Hc(e,[a,s],t))return!1;return!0}function Vc(e,t,n,i,a){for(var r=Math.min(n,i),o=Math.max(n,i),s=r;s<=o;s++)if(!Hc(e,[s,a],t))return!1;return!0}function Wc(e,t,n,i,a){var r=1===n?a.y:i.y,o=1===n?i.x:a.x;if(qc(e,t,i.y,a.y,o))for(;r>=0&&r<e.height&&Hc(e,[i.x,r],t)&&Hc(e,[a.x,r],t);){if(Vc(e,t,i.x,a.x,r))return r;r+=n}return-1}function Kc(e,t,n,i,a){var r=1===n?a.x:i.x,o=1===n?i.y:a.y;if(Vc(e,t,i.x,a.x,o))for(;r>=0&&r<e.width&&Hc(e,[r,i.y],t)&&Hc(e,[r,a.y],t);){if(qc(e,t,i.y,a.y,r))return r;r+=n}return-1}function jc(e,t){return e.map((function(e){return{a:{x:e.a.x+t.x,y:e.a.y+t.y},b:{x:e.b.x+t.x,y:e.b.y+t.y}}}))}n._RF.pop(),n._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var Yc,Xc=i.ccclass,$c=i.property,Qc=i.requireComponent,Jc=globalThis.game.monitorError,Zc=(Ac=Xc("Board"),xc=Qc(s),Rc=$c(Vu),Ic=$c(a),Pc=$c({displayName:"Tile Spacing",group:"Create config"}),Ac(_c=xc((Oc=$e((Lc=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"tilePrefab",Oc,Me(e)),Xe(e,"tilesHolder",Dc,Me(e)),Xe(e,"tileTrim",Nc,Me(e)),e.tileSize=[0,0],e.selectedTile=null,e.layoutType="portrait",e.parsedGravityRules=[],e.normalMatches=0,e.normalMatchesSinceLastSpawn=0,e.spawnAttempts=0,e.hintPath=null,e.hintTiles=null,e.animationQueue=[],e.isConsumingAnimation=!1,e.onLayoutChanged=function(t){e.layoutType=t},e}return Re(a,[{key:"onLoad",value:function(){this.widget=this.getComponent(C),this.uiTransform=this.getComponent(s),St.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenLayoutevents()}},{key:"onDestroy",value:function(){this.unlistenLayoutevents()}},{key:"create",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),a=Ve(e);GameCore.Utils.Array.shuffle(a),e=a.slice(0,t.colors),this.levelData=t,this.parsedGravityRules=Yu(t.mode,this.layoutType===la.Landscape);var r=function(e){var t=l(n.tilePrefab.node),i=t.getComponent(Vu);return i.setIdentity(e),n.tilesHolder.addChild(t),t.active=!0,i},o=!1;if(void 0!==t.customFen)try{o=!0,this.grid=uc({customFen:t.customFen,identities:e,createTile:r}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)}))}catch(e){console.error("Error creating grid from custom fen",e,"falling back to random grid"),o=!1}o||(this.grid=lc({levelData:t,seed:i,identities:e,createTile:r}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)})),cc(this.grid,i),sc(this.grid,t,i)),this.handleBoardLayout();var s=[this.tileTrim.x,this.tileTrim.y];this.tileSize=ju(this.tilePrefab.getSize(),s);var u=[this.grid.width,this.grid.height],c=[this.uiTransform.width,this.uiTransform.height],h=Wu(u,this.tilePrefab.getSize(),c);this.tilesHolder.setScale(h,h),this.node.scene.emit(Ka.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}},{key:"handleBoardLayout",value:function(){var e,t;this.layoutType===la.Landscape&&0!==this.levelData.level?(this.widget.left=50,this.widget.right=50,this.grid=(e=this.grid,(t=e.toRotated()).forEach((function(e,t,n){e.setCoord(t,n)})),t)):(this.widget.left=50,this.widget.right=50),this.widget.updateAlignment()}},{key:"destroyTiles",value:function(){var e;null===(e=this.grid)||void 0===e||e.forEach((function(e){return e.node.destroy()}))}},{key:"animateTilesAppear",value:function(){var e=this,t=function(t,n){var i=$.ZERO.clone();return e.parsedGravityRules.forEach((function(a){var r=e.getPrimitiveDirection(t,n,a);i.subtract2f(r.x,r.y)})),i.normalize()};return new Promise((function(n){var i=function(){var i=Te(Se().mark((function i(){return Se().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all(e.grid.map((function(n,i,a){var r=ne(0,.5),o=n.node.scale.clone(),s=t(i,a),l=Ku(e.grid,e.tileSize,{x:i,y:a}),u=s.multiplyScalar(100).add2f(l.x,l.y);return n.node.setPosition(u.x,u.y),n.node.setScale(0,0),Promise.all([yn.runTweenAsync(S(n.node).delay(r).to(.5,{scale:o},{easing:"elasticOut"})),n.sync({getTargetPosition:function(t){return Ku(e.grid,e.tileSize,t)},easing:"backOut",duration:.5,delay:r})])})));case 2:n();case 3:case"end":return i.stop()}}),i)})));return function(){return i.apply(this,arguments)}}();e.animationQueue.push(i),e.consumeAnimationQueue()}))}},{key:"handleTileClick",value:function(e){if(!e.isHidden()){if(this.selectedTile===e)return this.selectedTile=null,void e.setFocused(!1);if(!this.selectedTile)return this.selectedTile=e,void e.setFocused(!0);if(!this.selectedTile.isSimilarTo(e))return this.selectedTile.setFocused(!1),this.selectedTile=e,void e.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,e),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(e,t){var n=[e.getCoord().x,e.getCoord().y],i=[t.getCoord().x,t.getCoord().y],a=Bc(this.grid,n,i);if(null===a){Jn.playSound(Hn.INVALID_MATCH),this.shakeGrid();var r=0===this.levelData.level,o=wc(this.grid,n,i,r);return this.node.scene.emit(Ka.GRID_MATCH,[e,t]),void this.node.scene.emit(Ka.GRID_MATCH_FAIL,o)}this.node.scene.emit(Ka.GRID_MATCH,[e,t]),this.node.scene.emit(Ka.GRID_MATCH_SUCCESS,a,[e,t]),this.clear([[e,t]],"clear")}},{key:"clear",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"clear";this.normalMatches+=e.length,e.forEach((function(e){var i=qe(e,2),a=i[0],r=i[1];a.setEmpty(),r.setEmpty(),a.playClearFX(n),r.playClearFX(n),t.node.scene.emit(Ka.GRID_CLEAR,[a,r])})),this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var e=this.hintPath[0].a,t=this.hintPath[this.hintPath.length-1].b,n=this.getTileAt(e.x,e.y),i=this.getTileAt(t.x,t.y);n.setHint(!0),i.setHint(!0),this.hintTiles=[n,i]}}},{key:"hideHint",value:function(){if(this.hintTiles){var e=qe(this.hintTiles,2),t=e[0],n=e[1];t.setHint(!1),n.setHint(!1),this.hintTiles=null}}},{key:"getScale",value:function(){return this.tilesHolder.getScale()}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(e,t){return this.grid.isInBounds(e,t)?this.grid.get(e,t):null}},{key:"getAnyTileWorldPosition",value:function(e,t){var n=Ku(this.grid,this.tileSize,{x:e,y:t});this.tilePrefab.node.setPosition(n.x,n.y);var i=this.tilePrefab.node.getWorldPosition();return{x:i.x,y:i.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getUncleared",value:function(){return $u(this.grid)}},{key:"getCleared",value:function(){return Qu(this.grid)}},{key:"getBombTiles",value:function(){return $u((e=this.grid)instanceof fu?e.asArray():e).filter((function(e){var t;return(null===(t=e.special)||void 0===t?void 0:t.type)===Uu.bomb}));var e}},{key:"getPairs",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],i=t?$u(this.grid):Qu(this.grid),a=function(){var e=qe(tc(i),2),t=e[0],a=e[1];n.push([t,a]),i=i.filter((function(e){return e!==t&&e!==a}))};n.length<e;)a();return n}},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.grid.forEach((function(t){return t.setIgnoreInput(e)}))}},{key:"processShuffleRequest",value:function(e){var t=this.processShuffleStep(this.grid,!0,e);this.grid=t[0],this.hintPath=t[1],this.consumeAnimationQueue()}},{key:"getCurrentFen",value:function(){return Sc(this.grid)}},{key:"generateFenFromCurrentLevel",value:function(e){return a.generateFen(null!=e?e:this.levelData)}},{key:"listenLayoutevents",value:function(){V.on(Qi,this.onLayoutChanged)}},{key:"unlistenLayoutevents",value:function(){V.off(Qi,this.onLayoutChanged)}},{key:"shakeGrid",value:(n=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.tilesHolder.position.clone(),n=S(this.tilesHolder).to(.05,{position:t.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:t.clone().subtract3f(ne(5,10),ne(5,10),0)}),i=S(this.tilesHolder).repeat(2,n).to(.05,{position:t}),e.next=5,yn.runTweenAsync(i);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"processGameplayCycle",value:function(){var e=$u(this.grid);if(0!==e.length){var t=this.grid,n=e.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,i=this.normalMatchesSinceLastSpawn>=2;n&&(i?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),e.length>14&&(t=this.processGravitationStep(t));var a=this.processShuffleStep(t);this.consumeAnimationQueue(),this.grid=a[0],this.hintPath=a[1]}}},{key:"processSpawnStep",value:function(){var e=qe(rc(Qu(this.grid),2),2),t=e[0],n=e[1];t.restore(),n.restore(t.id)}},{key:"processGravitationStep",value:function(e){var t,n=this,i=e,a=[],r=je(this.parsedGravityRules);try{var o=function(){var e=t.value,r=Ec(i=n.toGravitated(i,e));if(0===r.length)return 1;r.forEach((function(e){var t=qe(e,2),n=t[0],i=t[1],a=i[0],r=i[1];n.setCoord(a,r)})),i.forEach((function(e){e.node.setSiblingIndex(0)}));var o=function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(r.map((function(e){var t=qe(e,2),a=t[0],r=qe(t[1],2),o=r[0],s=r[1];return a.sync({delay:.25,duration:.25,getTargetPosition:function(){return Ku(i,n.tileSize,{x:o,y:s})}})})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();a.push(o)};for(r.s();!(t=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}var s=function(){var e=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=a;case 1:if(!(t<n.length)){e.next=8;break}return i=n[t],e.next=5,i();case 5:t++,e.next=1;break;case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return this.animationQueue.push(s),i}},{key:"toGravitated",value:function(e,t){var n=new fu(e),i=e.height-1,a=e.width-1,r=[0,i],o=[0,a],s=Math.floor(e.height/2),l=Math.floor(e.width/2),u=function(e){return e.isHidden()};switch(t){case su:n.gravitate({rowRange:r,colRange:o,direction:ou.Down,isLighter:u});break;case lu:n.gravitate({rowRange:r,colRange:o,direction:ou.Up,isLighter:u});break;case uu:n.gravitate({rowRange:r,colRange:o,direction:ou.Left,isLighter:u});break;case cu:n.gravitate({rowRange:r,colRange:o,direction:ou.Right,isLighter:u});break;case hu:n.gravitate({rowRange:r,colRange:[l,a],direction:ou.Left,isLighter:u,out:n.gravitate({rowRange:r,colRange:[0,l-1],direction:ou.Right,isLighter:u})});break;case pu:n.gravitate({rowRange:[s,i],colRange:o,direction:ou.Down,isLighter:u,out:n.gravitate({rowRange:[0,s-1],colRange:o,direction:ou.Up,isLighter:u})})}return n}},{key:"getPrimitiveDirection",value:function(e,t,n){var i=Math.floor(this.grid.height/2),a=Math.floor(this.grid.width/2);switch(n){case su:return ou.Down;case lu:return ou.Up;case uu:return ou.Left;case cu:return ou.Right;case hu:return e>=a?ou.Left:ou.Right;case pu:return t>=i?ou.Down:ou.Up}}},{key:"processShuffleStep",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,a=Bc(e),r=$u(e).map((function(e){var t=e.getCoord();return[t.x,t.y]}));if(null!==a&&!n)return[e,a];var o=100;do{var s=e.toShuffled(r),l=qe(s,1);a=Bc(t=l[0]),o--}while(null===a&&o>0);if(o<=0)return null==Jc||Jc.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",levelData:this.levelData,gridAsArray:t.asArray()}),this.node.scene.emit(Ka.GAME_EXIT),[e,a];var u=Ec(t);if(0===u.length)return[t,a];u.forEach((function(e){var t=qe(e,2),n=t[0],i=qe(t[1],2),a=i[0],r=i[1];n.setCoord(a,r)}));var c=void 0!==i?function(){return i(e,t)}:this.createShuffleAnimationHandler(e,t);return this.animationQueue.push(c),[t,a]}},{key:"createShuffleAnimationHandler",value:function(e,t){var n=this,i=function(){var i=Te(Se().mark((function i(){return Se().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all(e.map((function(e,i,a){return e.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return Ku(t,n.tileSize,{x:i,y:a},10)}})})));case 2:case"end":return i.stop()}}),i)})));return function(){return i.apply(this,arguments)}}(),a=function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){e.node.setSiblingIndex(0)})),e.next=3,Promise.all(t.map((function(e){return e.sync({duration:.6,easing:"smooth",delay:ne(0,.4),getTargetPosition:function(e){return Ku(t,n.tileSize,e)}})})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i();case 2:return e.next=4,a();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isConsumingAnimation){e.next=2;break}return e.abrupt("return");case 2:this.isConsumingAnimation=!0;case 3:if(!(this.animationQueue.length>0)){e.next=12;break}if(0!==this.getUncleared().length){e.next=7;break}return this.animationQueue=[],e.abrupt("break",12);case 7:return t=this.animationQueue.shift(),e.next=10,t();case 10:e.next=3;break;case 12:this.isConsumingAnimation=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"generateFen",value:function(e){var t=e,n=Array.from({length:e.colors},(function(e,t){return t+1})),i=Date.now(),a=lc({levelData:t,seed:i,identities:n,createTile:function(e){var t=e,n=void 0,i=new $(0,0);return{get id(){return t},get special(){return n},get coord(){return i},setIdentity:function(e){t=e},isHidden:function(){return!1},setSpecialType:function(e){n={type:e}},setCoord:function(e,t){return i.set(e,t)},getCoord:function(){return i},isSimilarTo:function(e){return e.id===t},inSamePositionAs:function(e){return e.getCoord().equals(i)}}}});return a.forEach((function(e,t,n){e.setCoord(t,n)})),cc(a,i),sc(a,t,i),Sc(a)}}]),a}(f)).prototype,"tilePrefab",[Rc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dc=$e(Lc.prototype,"tilesHolder",[Ic],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nc=$e(Lc.prototype,"tileTrim",[Pc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $(.025,.1)}}),_c=Lc))||_c)||_c);n._RF.pop(),n._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var eh=(0,i.ccclass)("Line")(Yc=function(e){Pe(n,e);var t=Be(n);function n(){return Ae(this,n),t.apply(this,arguments)}return Re(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s)}},{key:"setPoints",value:function(e,t){this.node.setWorldPosition((e.x+t.x)/2,(e.y+t.y)/2,0),this.uiTransform.width=$.distance(e,t)+10,this.uiTransform.width/=this.node.worldScale.x;var n=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI;this.node.eulerAngles=new j(0,0,n)}}]),n}(f))||Yc;n._RF.pop(),n._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var th,nh,ih,ah,rh,oh,sh,lh,uh,ch,hh,ph=function(e){Pe(n,e);var t=Be(n);function n(e,i,a,r,o){var s;return Ae(this,n),(s=t.call(this,e,i,o)).ator=a,s.ftor=r,s}return Re(n,[{key:"alloc",value:function(){var e=Ue(_e(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(e),e}},{key:"free",value:function(e){this.ftor&&this.ftor(e),Ue(_e(n.prototype),"free",this).call(this,e)}}]),n}(ie);n._RF.pop(),n._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var dh,fh,vh,yh,mh,gh,bh,wh,kh,Sh=i.ccclass,Eh=i.property,Ch=(th=Sh("PathDrawer"),nh=Eh({group:"Line",displayName:"Prefab",type:R}),ih=Eh({group:"Line",displayName:"Holder",type:a,tooltip:"Line Prefab"}),ah=Eh({group:"Point",displayName:"Prefab",type:R}),rh=Eh({group:"Point",displayName:"Holder",type:a}),th((lh=$e((sh=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"linePrefab",lh,Me(e)),Xe(e,"lineHolder",uh,Me(e)),e.lineNodes=[],Xe(e,"pointPrefab",ch,Me(e)),Xe(e,"pointHolder",hh,Me(e)),e.pointNodes=[],e}return Re(n,[{key:"start",value:function(){var e=this;this.linePool=new ph((function(){var t=l(e.linePrefab);return e.lineHolder.addChild(t),t.parent=e.lineHolder,t.active=!1,t}),0,(function(t){e.lineNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()})),this.pointPool=new ph((function(){var t=l(e.pointPrefab);return e.pointHolder.addChild(t),t.active=!1,t}),0,(function(t){e.pointNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()}))}},{key:"drawPath",value:function(e){this.clearPath();var t,n=je(e);try{for(n.s();!(t=n.n()).done;){var i,a=t.value;null===(i=this.linePool.alloc().getComponent(eh))||void 0===i||i.setPoints(a.a,a.b)}}catch(e){n.e(e)}finally{n.f()}}},{key:"clearPath",value:function(){var e,t=je(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.linePool.free(n)}}catch(e){t.e(e)}finally{t.f()}this.lineNodes=[];var i,a=je(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var r=i.value;this.pointPool.free(r)}}catch(e){a.e(e)}finally{a.f()}this.pointNodes=[]}}]),n}(f)).prototype,"linePrefab",[nh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uh=$e(sh.prototype,"lineHolder",[ih],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=$e(sh.prototype,"pointPrefab",[ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hh=$e(sh.prototype,"pointHolder",[rh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oh=sh))||oh);n._RF.pop(),n._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var Th,Ah=i.ccclass,xh=i.property,Rh=(dh=Ah("ErrorDrawer"),fh=xh(L),vh=xh(L),yh=xh(L),dh((bh=$e((gh=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"one",bh,Me(e)),Xe(e,"two",wh,Me(e)),Xe(e,"error",kh,Me(e)),e}return Re(n,[{key:"start",value:function(){Ue(_e(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(e){var t=this;if(this.clearPath(),e.forEach((function(n,i){var a;if(null===(a=t.linePool.alloc().getComponent(eh))||void 0===a||a.setPoints(n.a,n.b),0!==i){var r=t.pointPool.alloc();r.setWorldPosition(new j(n.a.x,n.a.y,0));var o=r.getComponent(A);1===i&&e.length>3?o.spriteFrame=t.one:2===i&&e.length>3?o.spriteFrame=t.two:o.spriteFrame=t.error}})),1===e.length){var n=this.pointPool.alloc();n.setWorldPosition(new j(e[0].a.x+e[0].b.x,e[0].a.y+e[0].b.y,0).multiplyScalar(.5)),n.getComponent(A).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(e){this.pathAppearDuration>0&&(this.pathAppearDuration-=e,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(Ch)).prototype,"one",[fh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wh=$e(gh.prototype,"two",[vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kh=$e(gh.prototype,"error",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mh=gh))||mh);n._RF.pop(),n._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var Ih,Ph=(0,i.ccclass)("HintDrawer")(Th=function(e){Pe(n,e);var t=Be(n);function n(){return Ae(this,n),t.apply(this,arguments)}return Re(n,[{key:"drawPath",value:function(e){this.clearPath(),this.createPath(e),this.showPath()}},{key:"createPath",value:function(e){var t=this;e.forEach((function(e){var n;null===(n=t.linePool.alloc().getComponent(eh))||void 0===n||n.setPoints(e.a,e.b),t.pointPool.alloc().setWorldPosition(e.a.x,e.a.y,0)})),this.pointPool.alloc().setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0)}},{key:"showPath",value:function(){var e,t=je(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value.getComponent(D);n.opacity=0,S(n).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){t.e(e)}finally{t.f()}var i,a=je(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var r=i.value.getComponent(D);r.opacity=0,S(r).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){a.e(e)}finally{a.f()}}},{key:"clearPath",value:function(){var e,t=this,n=je(this.lineNodes);try{var i=function(){var n=e.value,i=n.getComponent(D);S(i).to(.15,{opacity:0},{onComplete:function(){i.opacity=255,t.linePool.free(n)}}).start()};for(n.s();!(e=n.n()).done;)i()}catch(e){n.e(e)}finally{n.f()}var a,r=je(this.pointNodes);try{var o=function(){var e=a.value,n=e.getComponent(D);S(n).to(.15,{opacity:0},{onComplete:function(){n.opacity=255,t.pointPool.free(e)}}).start()};for(r.s();!(a=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(Ch))||Th;n._RF.pop(),n._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var _h,Lh,Oh,Dh,Nh,Mh,Fh,Bh,Gh,Uh=(0,i.ccclass)("MatchDrawer")(Ih=function(e){Pe(a,e);var t,n,i=Be(a);function a(){return Ae(this,a),i.apply(this,arguments)}return Re(a,[{key:"drawPath",value:function(e){var t=this;e.forEach((function(e,n){var i,a=t.linePool.alloc();null===(i=a.getComponent(eh))||void 0===i||i.setPoints(e.a,e.b),t.animateLine(a);var r=t.pointPool.alloc();r.setWorldPosition(e.a.x,e.a.y,0),t.animatePoint(r,n)}));var n=this.pointPool.alloc();n.setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0),this.animatePoint(n,e.length)}},{key:"animateLine",value:(n=Te(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.getComponent(D)).opacity=0,i=S(n).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0}),e.next=5,yn.runTweenAsync(i);case 5:n.opacity=255,this.linePool.free(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"animatePoint",value:(t=Te(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.scale=j.ZERO,i=S(t).delay(.03*n).to(.2,{scale:j.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:j.ZERO},{easing:"backIn"}),e.next=4,yn.runTweenAsync(i);case 4:this.pointPool.free(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),a}(Ch))||Ih;n._RF.pop(),n._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var zh,Hh=i.ccclass,qh=i.property,Vh=(_h=Hh("PathDraw"),Lh=qh({group:{name:"Path Drawer"},type:Uh}),Oh=qh({group:{name:"Path Drawer"},type:Ph}),Dh=qh({group:{name:"Path Drawer"},type:Rh}),_h((Fh=$e((Mh=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"matchPath",Fh,Me(e)),Xe(e,"hintPath",Bh,Me(e)),Xe(e,"errorPath",Gh,Me(e)),e.isDrawingHint=!1,e}return Re(n,[{key:"drawMatchPath",value:function(e,t){var n,i=je(e=e.map((function(e){return ke({},e)})));try{for(i.s();!(n=i.n()).done;){var a=n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.matchPath.drawPath(e)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(e,t){if(!this.isDrawingHint){this.isDrawingHint=!0;var n,i=je(e=e.map((function(e){return ke({},e)})));try{for(i.s();!(n=i.n()).done;){var a=n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.hintPath.drawPath(e)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(e,t){var n,i=je(e=e.map((function(e){return ke({},e)})));try{for(i.s();!(n=i.n()).done;){var a=n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.errorPath.drawPath(e)}}]),n}(f)).prototype,"matchPath",[Lh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bh=$e(Mh.prototype,"hintPath",[Oh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gh=$e(Mh.prototype,"errorPath",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh=Mh))||Nh);n._RF.pop(),n._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var Wh,Kh,jh,Yh,Xh,$h,Qh,Jh,Zh,ep,tp,np,ip,ap,rp,op,sp,lp=(0,i.ccclass)("ComboManager")(zh=function(e){Pe(n,e);var t=Be(n);function n(){return Ae(this,n),t.apply(this,arguments)}return Re(n,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(Ka.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(Ka.GAME_FINISH,this.resetCombo,this),this.node.scene.on(Ka.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(Ka.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(Ka.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(e){if(this.currentCombo=e,e>0&&e<5){var t=[Hn.COMBO_1,Hn.COMBO_2,Hn.COMBO_3,Hn.COMBO_4,Hn.COMBO_5];Jn.playSound(t[e])}else e>=5&&Jn.playSound(Hn.COMBO_5);e>0&&this.vibrate(e),this.emitEvent&&this.node.scene.emit(Ka.COMBO_UPDATED,e)}},{key:"vibrate",value:function(e){var t;null===(t=x("Vibrate"))||void 0===t||null===(t=t.getComponent(ds))||void 0===t||t.vibrate(Math.min(20+20*e,220))}},{key:"setEmitEvent",value:function(e){this.emitEvent=e}}]),n}(f))||zh;n._RF.pop(),n._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var up,cp,hp,pp,dp,fp=i.ccclass,vp=i.property,yp=i.disallowMultiple,mp=(Wh=fp("ShiningStar"),Kh=vp(A),jh=vp({serializable:!0,visible:!1}),Yh=vp({type:E,displayName:"Scale up duration",min:.001}),Xh=vp({serializable:!0,visible:!1}),$h=vp({type:E,displayName:"Bounce and Fall duration",min:.001}),Qh=vp({serializable:!0,visible:!1}),Jh=vp({type:E,displayName:"Start scale"}),Zh=vp({serializable:!0,visible:!1}),ep=vp({type:E,displayName:"End scale"}),Wh(tp=yp((ip=$e((np=function(e){Pe(u,e);var t,n,i,a,r,o,s,l=Be(u);function u(){var e;Ae(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=l.call.apply(l,[this].concat(n)),"shine",ip,Me(e)),Xe(e,"twScaleUpDuration",ap,Me(e)),Xe(e,"twBounceAndFallDuration",rp,Me(e)),Xe(e,"twStartScale",op,Me(e)),Xe(e,"twEndScale",sp,Me(e)),e.isBeingAnimated=!1,e}return Re(u,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(e){this.twScaleUpDuration=e}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(e){this.twBounceAndFallDuration=e}},{key:"startScale",get:function(){return this.twStartScale},set:function(e){this.twStartScale=e}},{key:"endScale",get:function(){return this.twEndScale},set:function(e){this.twEndScale=e}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(D),this.uiOpacity=this.node.getComponent(D),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(s=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isAvailable){e.next=2;break}throw new Error("ShiningStar: This star is being animated.");case 2:return this.isBeingAnimated=!0,e.next=5,this.animateAppear();case 5:return e.next=7,this.animateDisappear();case 7:this.isBeingAnimated=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"animateAppear",value:(o=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.shineOpacity.opacity=255,e.next=3,Promise.all([this.animateFadeIn(),this.animateScaleUp()]);case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"animateDisappear",value:(r=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.animateBounceAndFall(),this.animateScaleDown()]);case 2:this.node.setScale(0,0),this.uiOpacity.opacity=0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"animateBounceAndFall",value:(a=Te(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.x,n=this.node.position.y,i=[60,120],a=(Math.random()*(i[1]-i[0])+i[0])*(Math.PI/180),r=t+200*Math.cos(a),o=n+200*Math.sin(a),s=n-500,l=yn.runTweenAsync(S(this.node).to(.2*this.twBounceAndFallDuration,{position:new j(r,o,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new j(r,s,this.node.position.z)},{easing:"cubicIn"})),u=[0,360],c=yn.runTweenAsync(S(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new j(0,0,Math.random()*(u[1]-u[0])*(r>t?-1:1))},{easing:"sineOut"})),e.next=13,Promise.all([l,c]);case 13:this.node.eulerAngles=new j(0,0,0);case 14:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"animateFadeIn",value:(i=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Math.max(this.scaleUpDuration/4,.01),e.next=3,yn.runTweenAsync(S(this.uiOpacity).to(t,{opacity:255}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"animateScaleUp",value:(n=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.setScale(this.startScale,this.startScale),t=new j(this.endScale,this.endScale,1),e.next=4,yn.runTweenAsync(S(this.node).to(this.scaleUpDuration,{scale:t},{easing:"cubicOut"}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"animateScaleDown",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new j(0,0,1),e.next=3,yn.runTweenAsync(S(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:t},{easing:"cubicIn"}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),u}(f)).prototype,"shine",[Kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ap=$e(np.prototype,"twScaleUpDuration",[jh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),$e(np.prototype,"scaleUpDuration",[Yh],Object.getOwnPropertyDescriptor(np.prototype,"scaleUpDuration"),np.prototype),rp=$e(np.prototype,"twBounceAndFallDuration",[Xh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),$e(np.prototype,"bounceAndFallDuration",[$h],Object.getOwnPropertyDescriptor(np.prototype,"bounceAndFallDuration"),np.prototype),op=$e(np.prototype,"twStartScale",[Qh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),$e(np.prototype,"startScale",[Jh],Object.getOwnPropertyDescriptor(np.prototype,"startScale"),np.prototype),sp=$e(np.prototype,"twEndScale",[Zh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$e(np.prototype,"endScale",[ep],Object.getOwnPropertyDescriptor(np.prototype,"endScale"),np.prototype),tp=np))||tp)||tp);n._RF.pop(),n._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var gp,bp,wp,kp,Sp,Ep,Cp,Tp,Ap,xp,Rp,Ip,Pp,_p,Lp,Op,Dp,Np,Mp,Fp,Bp,Gp=i.ccclass,Up=i.property,zp=i.disallowMultiple,Hp=(up=Gp("StarParticles"),cp=Up({type:[mp],displayName:"Prebuilt Shining stars"}),up(hp=zp((dp=$e((pp=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"shiningStars",dp,Me(e)),e}return Re(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(t=Te(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(n=this.getFirstAvailableShiningStar())){e.next=3;break}throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");case 3:return i=qe(t,2),a=i[0],r=i[1],o=new j(a,r,this.node.worldPosition.z),n.node.worldPosition=o,e.next=8,n.playAnimation();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return this.shiningStars.find((function(e){return e.isAvailable}))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),i}(f)).prototype,"shiningStars",[cp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hp=pp))||hp)||hp);n._RF.pop(),n._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var qp=i.ccclass,Vp=i.property,Wp=(gp=qp("EffectManager"),bp=Vp({group:"Thunder Effect",type:a}),wp=Vp({group:"Thunder Effect",type:a}),kp=Vp({group:"Mask Effect",type:ji}),Sp=Vp({group:"Mask Effect",type:a}),Ep=Vp({group:"Tornado Effect",type:a}),Cp=Vp({group:"Clear Particle Effect",type:a,displayName:"Particle holder node"}),Tp=Vp({group:"Clear Particle Effect",type:ae,displayName:"Emitter 1"}),Ap=Vp({group:"Clear Particle Effect",type:ae,displayName:"Emitter 2"}),xp=Vp({group:"Star Particles Effect",type:Hp}),gp((Pp=$e((Ip=function(e){Pe(f,e);var t,n,i,a,r,o,l,u,c,h,p,d=Be(f);function f(){var e;Ae(this,f);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=d.call.apply(d,[this].concat(n)),"cloud",Pp,Me(e)),Xe(e,"lightnings",_p,Me(e)),Xe(e,"backgroundMask",Lp,Me(e)),Xe(e,"masks",Op,Me(e)),Xe(e,"tornado",Dp,Me(e)),e.bombExplosion=null,e.bombExplosionPool=null,e.defuseExplosion=null,e.defuseExplosionPool=null,Xe(e,"clearParticleHolder",Np,Me(e)),Xe(e,"clearParticle1",Mp,Me(e)),Xe(e,"clearParticle2",Fp,Me(e)),Xe(e,"starParticle",Bp,Me(e)),e.maskTargets=[],e.handleBoardCreate=function(t){e.clearParticleHolder.scale=t.getScale()},e}return Re(f,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"update",value:function(){var e=this;this.maskTargets.length>0&&this.maskTargets.forEach((function(t,n){t.isHidden()||(e.masks[n].worldPosition=t.node.worldPosition.clone())}))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(Ka.GRID_CREATE,this.handleBoardCreate,this)}},{key:"playClearFXAt",value:function(e){this.clearParticle1.node.setWorldPosition(new j(e[0].x,e[0].y,1)),this.clearParticle2.node.setWorldPosition(new j(e[1].x,e[1].y,1)),this.clearParticle1.resetSystem(),this.clearParticle2.resetSystem()}},{key:"playStarFXAt",value:function(e){this.starParticle.fireShiningStarAt(e)}},{key:"playTornadoAnimation",value:(p=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.tornado.getChildByName("Sprite").getComponent(y).defaultClip){e.next=4;break}return console.warn("EffectManager: Tornado animation is not loaded when animation play request was made."),e.abrupt("return");case 4:return this.tornado.active=!0,(t=S(this.tornado)).set({scale:new j(0,0,0)}),t.delay(.5),t.to(.5,{scale:new j(1,1,1)},{easing:"quadOut"}),t.to(.5,{scale:new j(0,0,0)},{easing:"quadIn"}),t.set({active:!1}),Bn.setBlockInput(!0),e.next=14,yn.runTweenAsync(t);case 14:Bn.setBlockInput(!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"shakeGame",value:(h=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.clone(),n=S(this.node).to(.05,{position:t.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:t.clone().subtract3f(ne(5,10),ne(5,10),0)}).to(.05,{position:t}),e.next=4,yn.runTweenAsync(n);case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"playThunderAnimation",value:(c=Te(Se().mark((function e(t,n){var i,a,r,o,l,u,c,h,p,d,f,v,y;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.cloud.active=!0,r=x("Canvas").getComponent(s),o=r.width,l=r.height,u=Math.floor(4*Math.random()),c=0,h=0,e.t0=u,e.next=0===e.t0?9:1===e.t0?12:2===e.t0?15:3===e.t0?18:21;break;case 9:return c=Math.random()*o-o/2,h=l/2+300,e.abrupt("break",21);case 12:return c=Math.random()*o-o/2,h=-l/2-300,e.abrupt("break",21);case 15:return c=-o/2-300,h=Math.random()*l-l/2,e.abrupt("break",21);case 18:return c=o/2+300,h=Math.random()*l-l/2,e.abrupt("break",21);case 21:return this.cloud.position=new j(c,h),this.resetMasks(),this.setMaskProperties(0,t[0][0].node.worldPosition,t[0][0].node.worldScale),this.setMaskProperties(1,t[0][1].node.worldPosition,t[0][1].node.worldScale),this.setMaskProperties(2,t[1][0].node.worldPosition,t[1][0].node.worldScale),this.setMaskProperties(3,t[1][1].node.worldPosition,t[1][1].node.worldScale),this.maskTargets=[t[0][0],t[0][1],t[1][0],t[1][1]],e.next=30,this.setBackgroundMaskActive(!0);case 30:return p=S(this.cloud).to(.8,{position:new j(0,300)},{easing:"quadOut"}),e.next=33,yn.runTweenAsync(p);case 33:return d=t[0][0].node.worldPosition.clone(),f=t[0][1].node.worldPosition.clone(),this.shakeGame(),null===(i=x("Vibrate"))||void 0===i||null===(i=i.getComponent(ds))||void 0===i||i.vibrate(500),Jn.playSound(Hn.THUNDERBOLT),n.clear([t[0]],"break"),e.next=41,Promise.all([this.playLightningAnimation(d,0),this.playLightningAnimation(f,1)]);case 41:return this.node.scene.emit(Ka.ADD_COMBO),this.node.scene.emit(Ka.ADD_SCORE),v=t[1][1].node.worldPosition.clone(),y=t[1][0].node.worldPosition.clone(),this.shakeGame(),null===(a=x("Vibrate"))||void 0===a||null===(a=a.getComponent(ds))||void 0===a||a.vibrate(500),Jn.playSound(Hn.THUNDERBOLT),n.clear([t[1]],"break"),e.next=51,Promise.all([this.playLightningAnimation(y,0),this.playLightningAnimation(v,1)]);case 51:return this.node.scene.emit(Ka.ADD_COMBO),this.node.scene.emit(Ka.ADD_SCORE),this.cloud.active=!1,e.next=56,this.setBackgroundMaskActive(!1);case 56:this.maskTargets=[];case 57:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"playLightningAnimation",value:(u=Te(Se().mark((function e(t,n){var i,a,r,o,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.lightnings[n],a=t.subtract(i.worldPosition),r=Math.atan2(a.y,a.x)*(180/Math.PI)+180,o=a.length(),i.getComponent(s).width=o,i.angle=r,e.abrupt("return",new Promise((function(e){i.active=!0,l.scheduleOnce((function(){i.active=!1,e()}),.2)})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(l=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&(this.backgroundMask.node.active=!0),e.next=3,this.backgroundMask.changeStateFade(t,.25);case 3:t||(this.backgroundMask.node.active=!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"resetMasks",value:function(){this.masks.forEach((function(e){e.worldPosition=new j(-9999,-9999,0)}))}},{key:"setMaskProperties",value:function(e,t,n){n&&(this.masks[e].worldScale=n),this.masks[e].worldPosition=t}},{key:"createDefuseExplosionAt",value:(o=Te(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadDefuseExplosionPrefab();case 2:return this.defuseExplosionPool||(this.defuseExplosionPool=new ph(this.createDefuseExplosion.bind(this),1,Kp.getBombDefuseExplosion,Kp.returnBombDefuseExplosion,Kp.destroyBombDefuseExplosion)),(n=this.defuseExplosionPool.alloc()).setWorldPosition(t),i=n.getComponent(y),e.next=8,yn.runAnimationAsync(i);case 8:if(this.defuseExplosionPool){e.next=10;break}throw new Error("EffectManager: defuseExplosionPool is null");case 10:this.defuseExplosionPool.free(n);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"createBombExplosionAt",value:(r=Te(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadBombExplosionPrefab();case 2:return this.bombExplosionPool||(this.bombExplosionPool=new ph(this.createBombExplosion.bind(this),1,jp.getBombExplosion,jp.returnBombExplosion,jp.destroyBombExplosion)),(n=this.bombExplosionPool.alloc()).setWorldPosition(t),i=n.getComponent(y),e.next=8,yn.runAnimationAsync(i);case 8:if(this.bombExplosionPool){e.next=10;break}throw new Error("EffectManager: bombExplosionPool is null");case 10:this.bombExplosionPool.free(n);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"createDefuseExplosion",value:function(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return Kp.createDefuseExplosion(this.defuseExplosion,this.node)}},{key:"createBombExplosion",value:function(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return jp.createBombExplosion(this.bombExplosion,this.node)}},{key:"loadBombExplosionPrefab",value:(a=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.bombExplosion){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Bn.loadPrefabAsync(Rn.BOMB_EXPLODE_PREFAB);case 4:return(t=e.sent)&&(this.bombExplosion=t),e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"loadDefuseExplosionPrefab",value:(i=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.defuseExplosion){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Bn.loadPrefabAsync(Rn.BOMB_DEFUSE_PREFAB);case 4:return(t=e.sent)&&(this.defuseExplosion=t),e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"loadThunderAnimation",value:(n=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this.cloud.getChildByName("Top").getComponent(y)).defaultClip){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return e.next=5,Bn.loadAnimClipAsync(Rn.CLOUD_IDLE_ANIM);case 5:return(n=e.sent)&&(t.defaultClip=n),e.abrupt("return",Promise.resolve());case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadTornadoAnimation",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this.tornado.getChildByName("Sprite").getComponent(y)).defaultClip){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return e.next=5,Bn.loadAnimClipAsync(Rn.TORNADO_IDLE_ANIM);case 5:return(n=e.sent)&&(t.defaultClip=n),e.abrupt("return",Promise.resolve());case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),f}(f)).prototype,"cloud",[bp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_p=$e(Ip.prototype,"lightnings",[wp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Lp=$e(Ip.prototype,"backgroundMask",[kp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Op=$e(Ip.prototype,"masks",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Dp=$e(Ip.prototype,"tornado",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Np=$e(Ip.prototype,"clearParticleHolder",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mp=$e(Ip.prototype,"clearParticle1",[Tp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fp=$e(Ip.prototype,"clearParticle2",[Ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bp=$e(Ip.prototype,"starParticle",[xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rp=Ip))||Rp),Kp=function(){function e(){Ae(this,e)}return Re(e,null,[{key:"createDefuseExplosion",value:function(e,t){var n=l(e);return t.addChild(n),n.active=!1,n}},{key:"destroyBombDefuseExplosion",value:function(e){e.destroy()}},{key:"getBombDefuseExplosion",value:function(e){e.active=!0}},{key:"returnBombDefuseExplosion",value:function(e){e.active=!1}}]),e}(),jp=function(){function e(){Ae(this,e)}return Re(e,null,[{key:"createBombExplosion",value:function(e,t){var n=l(e);return t.addChild(n),n.active=!1,n}},{key:"destroyBombExplosion",value:function(e){e.destroy()}},{key:"getBombExplosion",value:function(e){e.active=!0}},{key:"returnBombExplosion",value:function(e){e.active=!1}}]),e}();n._RF.pop(),n._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var Yp="newbie",Xp="timer",$p="combo",Qp="hint-item",Jp="thunder-item",Zp="storm-item",ed="pliers-item";n._RF.pop(),n._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var td=function(){function e(t){Ae(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Re(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(Ka.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(Ka.GRID_MATCH_FAIL,this.showNextStep,this),this.showStep(this.currentStep),this.manager.node.scene.emit(Ka.HIDE_UI),this.manager.guideSkipButton.active=!0}},{key:"showNextStep",value:function(){this.currentStep+1<hc.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(n=Te(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.gameplay,i=n.board,a=n.effectManager,r=hc[t].startTile,o=hc[t].endTile,s=i.getTileAt(r.x,r.y),l=i.getTileAt(o.x,o.y),s&&l){e.next=7;break}return e.abrupt("return");case 7:return u=s.node.worldPosition,c=l.node.worldPosition,a.resetMasks(),a.setMaskProperties(0,u,s.node.worldScale),a.setMaskProperties(1,c,l.node.worldScale),a.setBackgroundMaskActive(!0),h=this.manager,p=h.guideHand,d=h.guideTextBox,p.node.active=!0,p.playHandAnimation(u,c),e.next=18,d.hide();case 18:return d.setText(hc[t].description),e.next=21,d.show();case 21:i.setIgnoreInput(!0),s.setIgnoreInput(!1),l.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.gameplay,n=t.board,i=t.effectManager,this.manager.node.scene.off(Ka.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(Ka.GRID_MATCH_FAIL,this.showNextStep,this),n.setIgnoreInput(!1),e.t0=Promise,e.next=7,this.manager.guideTextBox.hide();case 7:return e.t1=e.sent,e.next=10,i.setBackgroundMaskActive(!1);case 10:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=14,e.t0.all.call(e.t0,e.t3);case 14:this.manager.guideHand.node.active=!1,this.manager.completeGuide(Yp);case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var nd=function(){function e(t){Ae(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Re(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.uiManager.clock,r=a.getComponent(s).contentSize,o=r.width,l=r.height,u=a.node.worldPosition,o*=1.5,l*=1.5,e.next=9,this.gameplay.handleShowUI();case 9:return n.node.active=!0,n.setOtherMaskTransform(u.x,u.y,o,l),i.node.active=!0,i.string="Remove all tiles before\nthe time end",i.node.setWorldPosition(u.x,u.y-l/2-50,0),i.horizontalAlign=re.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=18,n.show();case 18:this.manager.node.scene.once(Ka.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ka.PAUSE_TIME);case 20:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideInfoText,i=t.guideMasks,this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(Ka.RESUME_TIME),e.next=5,i.hide();case 5:n.node.active=!1,this.manager.completeGuide(Xp);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var id=function(){function e(t){Ae(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Re(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.uiManager.comboContainer,r=a.getComponent(s).contentSize,o=r.width,l=r.height,u=a.worldPosition,o*=1.5,l*=1.5,n.node.active=!0,n.setOtherMaskTransform(u.x,u.y,o,l),i.node.active=!0,i.string="Remove tiles continuously\nto increase combo!",i.node.setWorldPosition(u.x-o/2-10,u.y,0),i.horizontalAlign=re.RIGHT,i.getComponent(s).setAnchorPoint(1,.5),e.next=16,n.show();case 16:this.manager.node.scene.once(Ka.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ka.PAUSE_TIME);case 18:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideInfoText,i=t.guideMasks,this.manager.node.scene.emit(Ka.RESUME_TIME),i.node.off(a.EventType.TOUCH_START,this.close,this),e.next=5,i.hide();case 5:n.node.active=!1,this.manager.completeGuide($p);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var ad=function(){function e(t){Ae(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Re(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===vs.HINT}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to reveal a connectable pair",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=re.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(Ka.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ka.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(Ka.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(Qp);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var rd=function(){function e(t){Ae(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Re(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===vs.THUNDER}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to remove 2 pairs",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=re.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(Ka.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ka.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(Ka.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(Jp);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var od=function(){function e(t){Ae(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Re(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===vs.STORM}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to rearrange the tiles",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=re.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(Ka.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ka.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(Ka.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(Zp);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var sd,ld,ud,cd,hd,pd,dd,fd,vd,yd=function(){function e(t){Ae(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Re(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===vs.PLIERS}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to remove bomb",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=re.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(Ka.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ka.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(Ka.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(ed);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var md,gd,bd,wd,kd,Sd,Ed,Cd=i.ccclass,Td=i.property,Ad=(sd=Cd("GuideHand"),ld=Td(a),ud=Td(a),cd=Td(D),sd((dd=$e((pd=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"hand",dd,Me(e)),Xe(e,"circleHighlight",fd,Me(e)),Xe(e,"circleHighlightOpacity",vd,Me(e)),e}return Re(n,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(e,t){var n=this;this.handTween&&this.handTween.stop();var i=S(this.hand).to(.8,{worldPosition:t},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0}).to(.8,{worldPosition:e},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0});this.handTween=S(this.hand).repeatForever(i).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),S(this.circleHighlight).to(.6,{scale:new j(1.5,1.5)},{easing:"quadOut"}).start(),S(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(f)).prototype,"hand",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fd=$e(pd.prototype,"circleHighlight",[ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vd=$e(pd.prototype,"circleHighlightOpacity",[cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hd=pd))||hd);n._RF.pop(),n._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var xd,Rd,Id,Pd,_d,Ld,Od=i.ccclass,Dd=i.property,Nd=(md=Od("GameMask"),gd=Dd(s),bd=Dd(A),md((Sd=$e((kd=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"uiTransform",Sd,Me(e)),Xe(e,"sprite",Ed,Me(e)),e}return Re(n,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),n}(f)).prototype,"uiTransform",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ed=$e(kd.prototype,"sprite",[bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd=kd))||wd);n._RF.pop(),n._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var Md,Fd,Bd,Gd,Ud,zd,Hd,qd=i.ccclass,Vd=i.property,Wd=i.executeInEditMode,Kd=(xd=qd("AlphaMasks"),Rd=Wd(!0),Id=Vd(Nd),xd(Pd=Rd((Ld=$e((_d=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"masks",Ld,Me(e)),e}return Re(n,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent(s)}},{key:"start",value:function(){this.material=this.getComponent(A).getMaterialInstance(0)}},{key:"update",value:function(){var e=this,t=this.UITransform,n=t.width,i=t.height;this.masks.forEach((function(t,a){var r=t.uiTransform,o=r.width,s=r.height,l=r.anchorX,u=r.anchorY,c=o*t.node.scale.x,h=s*t.node.scale.y,p=new $(c/n,h/i),d=new $(.5+(.5-l)*p.x,.5-(.5-u)*p.y),f=new $(d.x+(t.node.worldPosition.x-e.node.worldPosition.x)/n,d.y-(t.node.worldPosition.y-e.node.worldPosition.y)/i);e.material.setProperty(`mask${a}Texture`,t.texture),e.material.setProperty(`ratio${a}`,p),e.material.setProperty(`center${a}`,f)}))}},{key:"setMaskActive",value:function(e,t){e>=this.masks.length||this.material.setProperty(`useMask${e}`,t?1:0)}}]),n}(f)).prototype,"masks",[Id],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Pd=_d))||Pd)||Pd);n._RF.pop(),n._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var jd,Yd,Xd,$d,Qd,Jd=i.ccclass,Zd=i.property,ef=(Md=Jd("GuideMasks"),Fd=Zd(ji),Bd=Zd(Kd),Md((zd=$e((Ud=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"background",zd,Me(e)),Xe(e,"alphaMasks",Hd,Me(e)),e}return Re(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"show",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.background.node.active=!0,e.next=3,this.background.changeStateFade(!0,.25);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.background.changeStateFade(!1,.25);case 2:this.background.node.active=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(Ka.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[1].node.worldPosition=new j(-9999,-9999,0);var a=this.alphaMasks.masks[0];this.setMaskTransform(a,e,t,n,i)}},{key:"setItemMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[0].node.worldPosition=new j(-9999,-9999,0);var a=this.alphaMasks.masks[1];this.setMaskTransform(a,e,t,n,i)}},{key:"setMaskTransform",value:function(e,t,n,i,a){e.uiTransform.setContentSize(i,a),e.node.setWorldPosition(t,n,0)}}]),a}(f)).prototype,"background",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd=$e(Ud.prototype,"alphaMasks",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=Ud))||Gd);n._RF.pop(),n._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var tf,nf,af,rf,of,sf,lf,uf,cf,hf,pf,df,ff,vf=i.ccclass,yf=i.property,mf=(jd=vf("GuideTextBox"),Yd=yf(u),jd((Qd=$e(($d=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"guideText",Qd,Me(e)),e}return Re(a,[{key:"__preload",value:function(){this.opacityToggler=this.getComponent(ji),St.lazyValidateProperties(this)}},{key:"setText",value:function(e){this.guideText.string=e}},{key:"show",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.opacityToggler.changeStateFade(!0);case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.opacityToggler.changeStateFade(!1);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"guideText",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xd=$d))||Xd);n._RF.pop(),n._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var gf,bf,wf,kf,Sf,Ef,Cf,Tf,Af,xf,Rf,If,Pf,_f,Lf,Of,Df,Nf,Mf,Ff=game,Bf=Ff.player,Gf=Ff.analytics,Uf=i.ccclass,zf=i.property,Hf=GameCore.Plugins.Analytics.Events,qf=new $(0,10),Vf=new $(0,10),Wf="READY",Kf="RUNNING",jf=(tf=Uf("GuidelinesManager"),nf=zf(Ad),af=zf(mf),rf=zf(u),of=zf(ef),sf=zf(a),tf((cf=$e((uf=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"guideHand",cf,Me(e)),Xe(e,"guideTextBox",hf,Me(e)),Xe(e,"guideInfoText",pf,Me(e)),Xe(e,"guideMasks",df,Me(e)),Xe(e,"guideSkipButton",ff,Me(e)),e.guideHintDelay=null,e.guideStormDelay=null,e}return Re(i,[{key:"init",value:function(e){this.gameplay=e,this.status=Wf,this.node.scene.on(Ka.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(Ka.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(Ka.USE_ITEM,this.handleUseItem,this),this.node.scene.on(Ka.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(Ka.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(Ka.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(Yp)&&this.resetGuideItemShowed(),this.startGuide(Yp)):this.startGuide(Xp)}},{key:"startGuide",value:function(e){if(this.status===Kf)return!1;if(this.hasGuideItemShowed(e))return!1;switch(this.addGuideItemShowed(e),this.status=Kf,e){case Yp:Gf.event(Hf.TUTORIAL_BEGIN),this.guide1=new td(this),this.guide1.setup();break;case Xp:this.guide2=new nd(this),this.guide2.setup();break;case $p:this.guide3=new id(this),this.guide3.setup();break;case Qp:this.guide4=new ad(this),this.guide4.setup();break;case Jp:this.guide5=new rd(this),this.guide5.setup();break;case Zp:this.guide6=new od(this),this.guide6.setup();break;case ed:this.guide7=new yd(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(e){Gf.event(Hf.TUTORIAL_STEP,{step:e}),this.status=Wf,this.addGuideItemShowed(e),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){return this.getCurrentLevel()>=qf.x&&this.getCurrentLevel()<=qf.y}},{key:"isShowErrorPathLevel",value:function(){return this.getCurrentLevel()>=Vf.x&&this.getCurrentLevel()<=Vf.y}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(e){return this.getGuideItemShowed().includes(e)}},{key:"addGuideItemShowed",value:function(e){if(!this.hasGuideItemShowed(e)){var t=this.getGuideItemShowed();t.push(e),Bf.setGameData({guideItemShowed:t})}}},{key:"resetGuideItemShowed",value:function(){Bf.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var e,t;return null!==(e=null===(t=Bf.getGameData())||void 0===t?void 0:t.guideItemShowed)&&void 0!==e?e:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(e){this.isNewbieGuideLevel()||e<2||(this.startGuide($p),this.node.scene.off(Ka.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var e=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=new oe(this.node).delay(5).call((function(){e.isNewbieGuideLevel()||(e.hasGuideItemShowed(Qp)&&e.status===Wf?e.node.scene.emit(Ka.SHOW_HINT):e.startGuide(Qp),e.startHintGuide())}))),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var e=this;null===this.guideStormDelay&&(this.guideStormDelay=new oe(this.node).delay(10).call((function(){if(!e.isNewbieGuideLevel()&&!e.hasGuideItemShowed(Zp)){var t=e.gameplay.itemManager.items.find((function(e){return e.itemType===vs.STORM}));t&&t.canActivate()&&(e.startGuide(Zp)||e.startStormGuide())}}))),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(Jp)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(ed)}},{key:"handleUseItem",value:function(e){switch(this.startAutoGuides(),e){case vs.HINT:this.addGuideItemShowed(Qp);break;case vs.THUNDER:this.addGuideItemShowed(Jp);break;case vs.STORM:this.addGuideItemShowed(Zp);break;case vs.PLIERS:this.addGuideItemShowed(ed)}}},{key:"skipNewbieGuide",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.guideSkipButton.active=!1,e.next=3,this.guide1.close();case 3:t=this.getCurrentLevel()+1,Bf.setGameData({level:t}),this.node.scene.emit(Ka.NEXT_LEVEL);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"guideHand",[nf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hf=$e(uf.prototype,"guideTextBox",[af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pf=$e(uf.prototype,"guideInfoText",[rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),df=$e(uf.prototype,"guideMasks",[of],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ff=$e(uf.prototype,"guideSkipButton",[sf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lf=uf))||lf);n._RF.pop(),n._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var Yf,Xf=i.ccclass,$f=i.property,Qf=(gf=Xf("SpecialItem"),bf=$f({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),wf=$f({type:p,tooltip:"The button that activates the item"}),kf=$f({type:g,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),Sf=$f({type:u,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),Ef=$f({type:a,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),Cf=$f({type:a,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),Tf=$f({type:D,group:"Animation"}),Af=$f({type:D,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),gf((If=$e((Rf=function(e){Pe(r,e);var t,n,i,a=Be(r);function r(){var e;Ae(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"isDevButton",If,Me(e)),Xe(e,"button",Pf,Me(e)),Xe(e,"quantity",_f,Me(e)),Xe(e,"quantityLabel",Lf,Me(e)),Xe(e,"quantityNode",Of,Me(e)),Xe(e,"plusNode",Df,Me(e)),Xe(e,"glowUIOpacity",Nf,Me(e)),Xe(e,"uiOpacity",Mf,Me(e)),e.requestItem=null,e.loadQuantity=null,e}return Re(r,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"init",value:function(e){var t=this;this.node.scene.on(Ka.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(Ka.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(Ka.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(Ka.IDLE_EXIT,(function(){t.button.interactable=!1,t.applyActivationStatus()})),this.node.scene.on(Ka.IDLE_ENTER,(function(){t.button.interactable=!0,t.applyActivationStatus()}))}},{key:"start",value:function(){var e=this.loadQuantity();this.setQuantity(e)}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"applyActivationStatus",value:(i=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.canActivate(),this.button.interactable=t,e.next=4,yn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:t?255:128}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"activate",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.quantity<=0)){e.next=3;break}return this.requestItem(),e.abrupt("return");case 3:this.vibrate(),this.setQuantity(this.quantity-1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"canActivate",value:function(){return!1}},{key:"setQuantity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();e<0&&(e=0),this.quantity=e,this.quantityLabel.string=`${this.quantity}`,e<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),t&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}},{key:"getQuantity",value:function(){return this.quantity}},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;this.isDevButton||t&&this.setQuantity(e,t.animate)}},{key:"vibrate",value:function(){var e;null===(e=x("Vibrate"))||void 0===e||null===(e=e.getComponent(ds))||void 0===e||e.vibrate(50)}},{key:"animateAddItem",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.glowUIOpacity.opacity=0,e.abrupt("return",Promise.all([yn.runTweenAsync(S(this.node).to(.1,{scale:new j(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:j.ONE},{easing:"elasticOut"})),yn.runTweenAsync(S(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))]));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(f)).prototype,"isDevButton",[bf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Pf=$e(Rf.prototype,"button",[wf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_f=$e(Rf.prototype,"quantity",[kf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lf=$e(Rf.prototype,"quantityLabel",[Sf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Of=$e(Rf.prototype,"quantityNode",[Ef],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Df=$e(Rf.prototype,"plusNode",[Cf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nf=$e(Rf.prototype,"glowUIOpacity",[Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mf=$e(Rf.prototype,"uiOpacity",[Af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xf=Rf))||xf);n._RF.pop(),n._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var Jf,Zf=(0,i.ccclass)("ItemManager")(Yf=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).sceneItems=new Set,e}return Re(n,[{key:"items",get:function(){return Ve(this.sceneItems)}},{key:"onLoad",value:function(){this.syncItems()}},{key:"syncItems",value:function(){var e=this,t=x("Canvas/UI");t&&t.getComponentsInChildren(Qf).forEach((function(t){t.node.activeInHierarchy&&e.sceneItems.add(t)}))}}]),n}(f))||Yf;n._RF.pop(),n._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var ev,tv=i.ccclass,nv=GameCore.Utils,iv={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},av=tv("LevelManager")(Jf=function(e){Pe(a,e);var t,n,i=Be(a);function a(){return Ae(this,a),i.apply(this,arguments)}return Re(a,[{key:"loadLevel",value:(n=Te(Se().mark((function e(){var t,n,i,a,r,o,s,l,u=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:1,n=u.length>1&&void 0!==u[1]?u[1]:al,e.next=4,this.loadLevelData(t);case 4:return i=e.sent,this.levelData=i||this.levelData||iv,a=this.levelData,r=a.rows,o=a.columns,nv.Device.isMobile()&&o>=6&&r>=10&&(this.levelData.columns=5,this.levelData.rows=10),s=`${Rn.TILE_SKIN_FOLDER}/${n}`,e.next=11,Bn.loadSpriteFramesDirAsync(s);case 11:return l=e.sent,e.abrupt("return",l);case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadLevelData",value:(t=Te(Se().mark((function e(){var t,n,i,a,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:1,n=10,i=this.paddingZero(`${Math.floor(t/n)+1}`,3),a=t%n,e.next=6,Bn.loadJsonAsync(`${Rn.LEVEL_DATA_FOLDER}/${i}`);case 6:if(r=e.sent){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",r[a]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"paddingZero",value:function(e,t){return Array(t-e.length).fill("0").join("")+e}}]),a}(f))||Jf;n._RF.pop(),n._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var rv=(0,i.ccclass)("ScoreManager")(ev=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).currentScore=0,e.tournamentStartScore=0,e}return Re(n,[{key:"addScore",value:function(e,t,n){var i=this.getLevelMultiplier(t),a=this.getComboMultiplier(n),r=Math.floor(this.currentScore+e*i*a),o=10*Math.ceil(r/10);this.setScore(o)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var e=Cl.getMatchMode();this.currentScore=e===GameCore.Match.Modes.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(e){this.currentScore=e,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"updateScore",value:function(){this.node.scene.emit(Ka.SCORE_UPDATED,this.currentScore)}},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(e){return 1+.1*(e-1)}},{key:"getComboMultiplier",value:function(e){return 1+.1*(e-1)}}]),n}(f))||ev;n._RF.pop(),n._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);var ov=GameCore,sv=ov.Configs,lv=ov.Plugins,uv=globalThis.game.ads,cv=function(){function e(){Ae(this,e)}var t,n,i;return Re(e,[{key:"canbeShowInSDK",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=GameSDK.getSDKName();return(null==t||!t.length||!t.includes(n))&&!(null!=e&&e.length&&!e.includes(n))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"preloadAds",value:(i=Te(Se().mark((function e(){var t,n,i,a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=sv.Ads,n=t.Enabled,i=t.InterstitialAdOptions,a=t.RewardedVideoAdOptions,n){e.next=3;break}return e.abrupt("return");case 3:r=GameCore.Plugins.Ads.Types,o=r.INTERSTITIAL,s=r.REWARDED_VIDEO,i.forEach((function(e){var t=e.PlacementId;uv.loadAdAsync(o,t).catch((function(){}))})),a.forEach((function(e){var t=e.PlacementId;uv.loadAdAsync(s,t).catch((function(){}))}));case 6:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"showBannerAds",value:function(){var e=sv.Ads,t=e.Enabled,n=e.BannerDisplayAdOptions;if(t){var i=se.instance.getVisibleSize(),a=Li.worldSizeToCssSize(i.height*fs);n.forEach((function(e){var t=e.PlacementId,n=e.Position,i=e.BannerHeight;"bottom"===n&&i>a||uv.showBannerAdAsync(t).catch((function(e){}))}))}}},{key:"hideBannerAds",value:function(){var e=sv.Ads,t=e.Enabled,n=e.BannerDisplayAdOptions;t&&n.forEach((function(e){var t=e.PlacementId;uv.hideBannerAdAsync(t).catch((function(e){}))}))}},{key:"showInterstitialAdAsync",value:(n=Te(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.forLevel,i=void 0===n?1:n,a=t.includeSDK,r=t.excludeSDK,this.inst.canbeShowInSDK(a,r)){e.next=3;break}return e.abrupt("return",!1);case 3:if(!(sv.Gameplay.StartAdAtLevel>=i)){e.next=5;break}return e.abrupt("return",!1);case 5:if(o=lv.Ads,s=o.Types,l=o.Status,uv.canbeShowInterstitialAd()){e.next=8;break}return e.abrupt("return",!1);case 8:if(u=Date.now(),e.prev=9,Jn.muteAudio(!0),Yl.showLoadingNotificationScreen(),uv.getAdStatus(s.INTERSTITIAL)===l.FILLED){e.next=16;break}return e.next=16,uv.loadAdAsync(s.INTERSTITIAL);case 16:return e.next=18,uv.showAdAsync(s.INTERSTITIAL);case 18:return e.abrupt("return",!0);case 21:return e.prev=21,e.t0=e.catch(9),console.warn("showInterstitialAdAsync failed",e.t0),e.abrupt("return",!1);case 25:return e.prev=25,Jn.muteAudio(!1),c=(Date.now()-u)/1e3,setTimeout((function(){Yl.closeNotificationScreen()}),c>.5?0:.5),uv.loadAdAsync(s.INTERSTITIAL).catch((function(){})),e.finish(25);case 31:case"end":return e.stop()}}),e,this,[[9,21,25,31]])}))),function(e){return n.apply(this,arguments)})},{key:"showRewardVideoAdAsync",value:(t=Te(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.includeSDK,i=t.excludeSDK,this.inst.canbeShowInSDK(n,i)){e.next=3;break}return e.abrupt("return",!1);case 3:if(a=lv.Ads,r=a.Types,o=a.Status,e.prev=4,Jn.muteAudio(!0),Yl.showLoadingNotificationScreen(),uv.getAdStatus(r.REWARDED_VIDEO)===o.FILLED){e.next=11;break}return e.next=11,uv.loadAdAsync(r.REWARDED_VIDEO);case 11:return e.next=13,uv.showAdAsync(r.REWARDED_VIDEO);case 13:return Yl.closeNotificationScreen(),e.abrupt("return",!0);case 17:return e.prev=17,e.t0=e.catch(4),console.warn("showRewardVideoAdAsync failed",e.t0),e.t0 instanceof Object&&"code"in e.t0&&"USER_INPUT"===e.t0.code?Yl.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2):Yl.showNotificationScreen("No ads to display.",2),e.abrupt("return",!1);case 22:return e.prev=22,Jn.muteAudio(!1),uv.loadAdAsync(r.REWARDED_VIDEO).catch((function(){})),e.finish(22);case 26:case"end":return e.stop()}}),e,this,[[4,17,22,26]])}))),function(e){return t.apply(this,arguments)})}]),e}();try{new cv}catch(e){console.error("AdsUtils",e)}n._RF.pop(),n._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var hv=function(){function e(t){Ae(this,e),this.game=null,this.data={},this.game=t.getGameplay(),this.manager=t,this.updateStateData(),this.logDebug()}return Re(e,[{key:"logDebug",value:function(){var e=this.constructor.name;console.info(`[STATE] ${e}`,this.data)}},{key:"updateStateData",value:function(){if(this.game){var e=this.game.getGameData();e&&(this.data=e)}}},{key:"updateGameData",value:function(e){var t;null===(t=this.game)||void 0===t||t.setGameData(e)}}]),e}();n._RF.pop(),n._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var pv=globalThis.game,dv=pv.analytics,fv=pv.monitorError,vv=pv.match,yv=pv.player,mv=pv.storage,gv=GameCore.Match.Modes,bv=function(e){Pe(s,e);var t,n,i,a,r,o=Be(s);function s(e,t){var n;return Ae(this,s),n=o.call(this,e),Jn.stopAllSounds(),n.vibrateDevice(),n.pauseCountdown(),n.updateMatchCustomData(),n.handleGameOver(t),n.logLevelFailAnalytics(),n}return Re(s,[{key:"pauseCountdown",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var e;null===(e=x("Vibrate"))||void 0===e||null===(e=e.getComponent(ds))||void 0===e||e.vibrate(500)}},{key:"handleGameOver",value:(r=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=Cl.getMatchMode())!==gv.SINGLE){e.next=6;break}return e.next=4,this.handleTournamentCreateFlow();case 4:e.next=14;break;case 6:if(n!==gv.TOURNAMENT){e.next=11;break}return this.handleTournamentGameOver(),e.abrupt("return");case 11:if(n!==gv.CHALLENGE_FRIEND){e.next=14;break}return this.handleChallengeGameOver(),e.abrupt("return");case 14:this.showFailScreen(t);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"handleTournamentCreateFlow",value:(a=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Cl.processCreateTournamentAsync();case 3:e.next=12;break;case 5:if(e.prev=5,e.t0=e.catch(0),!(e.t0 instanceof tl)){e.next=9;break}return e.abrupt("return");case 9:return e.t0 instanceof el&&(null==fv||fv.sendException(e.t0)),console.error(e.t0),e.abrupt("return");case 12:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(){return a.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(i=Te(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null===(t=Cl.getMatchCustomData())||void 0===t?void 0:t.tournamentId){e.next=3;break}return e.abrupt("return");case 3:if(!tu.validateTournamentExpired(i)){e.next=10;break}return mv.setStorageData("tournament","animateTournamentLeader",!1),Yl.showNotificationScreen("Tournament has ended",2),null===(a=this.game)||void 0===a||a.scheduleOnce((function(){var e;null===(e=c.game)||void 0===e||e.node.scene.emit(Ka.GAME_EXIT)}),2),e.abrupt("return");case 10:return e.prev=10,e.next=13,Cl.finishMatchAsync();case 13:s=vv.getMatchState(),l=s.profiles,u=null!==(r=mv.getStorageData("tournament","previousScore"))&&void 0!==r?r:0,(null!==(o=l[yv.getPlayerId()].score)&&void 0!==o?o:0)>u&&mv.setStorageData("tournament","animateTournamentLeader",!0),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(10),console.warn(e.t0);case 22:null===(n=this.game)||void 0===n||n.node.scene.emit(Ka.GAME_EXIT);case 23:case"end":return e.stop()}}),e,this,[[10,19]])}))),function(){return i.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(n=Te(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=vv.getMatchState(),n=t.id,e.next=4,vv.api.getMatchAPI().getMatchDetailByIdAsync(n);case 4:return i=e.sent,a=new GameCore.Dtos.Match.Data(i).toObject().extraData,e.next=8,Cl.finishMatchAsync({extraData:null!=a?a:void 0});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.warn(e.t0);case 13:this.game.node.scene.emit(Ka.SHOW_CHALLENGE_RESULTS);case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return n.apply(this,arguments)})},{key:"showFailScreen",value:(t=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.data.level,!this.game){e.next=4;break}return e.next=4,cv.showInterstitialAdAsync({forLevel:n});case 4:Jn.turnOffMusic(),t===iu&&Jn.playSound(Hn.LEVEL_FAIL_TIMEOUT),Jn.playSound(Hn.LEVEL_FAIL),Yl.openScreen(Kn.RESCUES_SCREEN,{level:n,failKey:t});case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var e,t,n=this.data.level,i=void 0===n?1:n,a=null!==(e=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore())&&void 0!==e?e:0;Cl.updateMatchStateAfterLevelFinish(i,a)}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore();dv.levelFail(t,n)}}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){}}]),s}(hv);n._RF.pop(),n._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var wv=globalThis.game,kv=wv.analytics,Sv=wv.player,Ev=wv.leaderboard,Cv=wv.match,Tv=wv.monitorError,Av=GameCore.Match.Modes,xv=function(e){Pe(s,e);var t,n,i,a,r,o=Be(s);function s(e){var t;return Ae(this,s),(t=o.call(this,e)).handleFinishStateFlow(),t}return Re(s,[{key:"handleFinishStateFlow",value:(r=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),Jn.turnUpMusic(),null===(t=this.game)||void 0===t||t.uiManager.pauseTime(),(n=Cl.getMatchMode())!==Av.CHALLENGE_FRIEND&&this.updatePlayerProgress(),this.updateMatchCustomData(),this.handlePostScoreToLeaderboard(),n!==Av.CHALLENGE_FRIEND){e.next=12;break}this.handleChallengeOver(),e.next=15;break;case 12:return e.next=14,this.handleTournamentCreateFlow();case 14:this.showLevelCompleteScreen();case 15:this.logLevelCompleteAnalytics();case 16:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"handleChallengeOver",value:(a=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Cv.getMatchState(),n=t.id,e.next=4,Cl.getMatchExtraDataAsync(n);case 4:return i=e.sent,e.next=7,Cl.finishMatchAsync({extraData:null!=i?i:void 0});case 7:e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(0),console.warn(e.t0),e.next=14,Cl.finishMatchAsync();case 14:this.game.node.scene.emit(Ka.SHOW_CHALLENGE_RESULTS);case 15:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(){return a.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"updateMatchCustomData",value:function(){var e,t,n=this.data.level,i=void 0===n?1:n,a=null!==(e=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore())&&void 0!==e?e:0;Cl.updateMatchStateAfterLevelFinish(i,a)}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore();kv.levelComplete(t,n)}}},{key:"showLevelCompleteScreen",value:(i=Te(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.data.level,Jn.turnOffMusic(),Jn.playSound(Hn.LEVEL_COMPLETE),a=null!==(t=null===(n=Sv.getGameData())||void 0===n?void 0:n.coins)&&void 0!==t?t:0,Yl.openScreen(Kn.LEVEL_COMPLETE_SCREEN,{level:i,currentCoin:a});case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updatePlayerProgress",value:function(){if(this.game){var e=this.data.level;if(e){var t=e+1,n=Sv.getGameData();if(n){var i=n.totalLevel,a=n.level,r=Math.max(a,t),o=ke({},n);r<i&&(o.level=r),Sv.setGameData(o)}}}}},{key:"attemptCallCreateShortcut",value:function(){var e=this.data.level;(void 0===e?0:e)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("createShortcutAsync",e)}))}},{key:"handleTournamentCreateFlow",value:(n=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Cl.getMatchMode()===Av.SINGLE){e.next=3;break}return e.abrupt("return");case 3:if(t=Sv.getGameData()){e.next=6;break}return e.abrupt("return");case 6:if(n=t.lastCreateTournamentShown,i=void 0===n?0:n,Date.now()-i>3e5){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,e.next=13,Cl.processCreateTournamentAsync();case 13:e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(10),!(e.t0 instanceof tl)){e.next=19;break}return e.abrupt("return");case 19:return e.t0 instanceof el&&(null==Tv||Tv.sendException(e.t0)),console.error(e.t0),e.abrupt("return");case 22:case"end":return e.stop()}}),e,null,[[10,15]])}))),function(){return n.apply(this,arguments)})},{key:"handlePostScoreToLeaderboard",value:(t=Te(Se().mark((function e(){var t,n,i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Cl.getMatchMode()===Av.TOURNAMENT){e.next=3;break}return e.abrupt("return");case 3:if(n=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore()){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,e.next=9,GameSDK.tournament.postScoreAsync(n);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),console.warn("GameSDK post score async",e.t0);case 14:if(i=Cl.getMatchCustomData()){e.next=17;break}return e.abrupt("return");case 17:if(a=i.leaderboardId,r=i.playerId,a&&r){e.next=20;break}return e.abrupt("return");case 20:return e.next=22,Ev.setLeaderboardScoreAsync(a,r,n);case 22:case"end":return e.stop()}}),e,this,[[6,11]])}))),function(){return t.apply(this,arguments)})},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),s}(hv);n._RF.pop(),n._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var Rv=globalThis.game,Iv=Rv.player,Pv=Rv.match,_v=GameCore.Match.Modes,Lv=function(e){Pe(a,e);var t,n,i=Be(a);function a(e){var t;return Ae(this,a),(t=i.call(this,e)).handleSingleGameStart=function(){var e=Te(Se().mark((function e(n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.game.levelManager.getLevelData(),r=t.data.level,o=Iv.getPlayerId(),e.next=5,Promise.all([Cl.setMatchCustomDataAsync({level:r,score:0}),Cl.setProfileMatchDataAsync({id:o,score:0})]);case 5:return t.game.board.create(n,a),t.game.board.setIgnoreInput(!0),e.next=9,t.game.board.animateTilesAppear();case 9:null!==(i=t.game.guidelinesManager)&&void 0!==i&&i.isNewbieGuideLevel()||t.game.board.setIgnoreInput(!1),t.ready();case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.enableUI(),t.clearBoard(),t.loadLevel(),t.initCountdown(),t.initScore(),t}return Re(a,[{key:"enableUI",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.enableHeader()}},{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(n=Te(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.game){e.next=2;break}return e.abrupt("return");case 2:if(t=Cl.getMatchMode(),e.prev=3,t!==_v.CHALLENGE_FRIEND){e.next=20;break}return n=Pv.getMatchState(),i=n.id,e.next=8,Cl.getMatchExtraDataAsync(i);case 8:if(null!=(a=e.sent)){e.next=11;break}throw new Error(`Match mode ${_v.CHALLENGE_FRIEND} but no extraData (for opponent initialization) was found in match data.`);case 11:return r=this.getLevelSkin(a.level),e.next=14,this.game.levelManager.loadLevel(a.level,r);case 14:o=e.sent,this.updateGameData({level:a.level,levelData:this.game.levelManager.getLevelData()}),Jn.playSound(Hn.LEVEL_START),this.handleChallengeFriendGameStart(o,a),e.next=27;break;case 20:return s=this.getLevelSkin(this.data.level),e.next=23,this.game.levelManager.loadLevel(this.data.level,s);case 23:l=e.sent,this.updateGameData({levelData:this.game.levelManager.getLevelData()}),Jn.playSound(Hn.LEVEL_START),this.handleSingleGameStart(l);case 27:e.next=39;break;case 29:return e.prev=29,e.t0=e.catch(3),console.error("Error loading level:",e.t0),u=this.getLevelSkin(this.data.level),e.next=35,this.game.levelManager.loadLevel(this.data.level,u);case 35:c=e.sent,this.updateGameData({levelData:this.game.levelManager.getLevelData()}),Jn.playSound(Hn.LEVEL_START),this.handleSingleGameStart(c);case 39:this.updateGameData({levelData:this.game.levelManager.getLevelData()});case 40:case"end":return e.stop()}}),e,this,[[3,29]])}))),function(){return n.apply(this,arguments)})},{key:"getLevelSkin",value:function(e){var t=dl.getLevelSkin(e),n=dl.getUnlockedSkins();if(n.length<=1)return t;if(B.random()<=.5)return t;var i=n.indexOf(t);return n.splice(i,1),n[B.randomRangeInt(0,n.length)]}},{key:"handleChallengeFriendGameStart",value:(t=Te(Se().mark((function e(t,n){var i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.game.levelManager.getLevelData(),a=n.level,r=n.fen,o=n.gravity,s=n.rules,l=n.time,u=Iv.getPlayerId(),e.next=5,Promise.all([Cl.setMatchCustomDataAsync({level:a,score:0}),Cl.setProfileMatchDataAsync({id:u,score:0})]);case 5:return this.game.board.create(t,ke(ke({},i),{},{level:a,customFen:r,mode:o,rules:s,time:l})),this.game.board.setIgnoreInput(!0),e.next=9,this.game.board.animateTilesAppear();case 9:this.game.board.setIgnoreInput(!1),this.ready();case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.initCurrentScore()}},{key:"initCountdown",value:function(){this.game&&this.game.uiManager.initCountdown()}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"pause",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),a}(hv);n._RF.pop(),n._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var Ov=function(e){Pe(n,e);var t=Be(n);function n(e){var i;return Ae(this,n),(i=t.call(this,e)).startCountdown(),i}return Re(n,[{key:"startCountdown",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.startCountdown()}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"playing",value:function(){}},{key:"fail",value:function(e){var t=this.manager.createFailState(this.manager,e);this.manager.change(t)}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){this.updateStateData()}}]),n}(hv);n._RF.pop(),n._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var Dv,Nv=globalThis.game,Mv=Nv.analytics,Fv=Nv.match,Bv=function(e){Pe(n,e);var t=Be(n);function n(e){var i;return Ae(this,n),i=t.call(this,e),Jn.stopAllSounds(),Jn.turnDownMusic(),i.handleGuideFlow(),i.setLevelText(),i.setLevelTime(),i.setGridPlayable(),i.logLevelStartAnalytics(),i}return Re(n,[{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(e){if(GameCore.Utils.Valid.isDebugger()){var t=this.manager.createFailState(this.manager);this.manager.change(t)}}},{key:"finish",value:function(){if(GameCore.Utils.Valid.isDebugger()){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var e;null!==(e=this.manager.getGameplay().guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var e,t;null!==(e=this.game.guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.game.handleShowUI(),null===(t=this.game.guidelinesManager)||void 0===t||t.show()}},{key:"setLevelTime",value:function(){if(this.game){var e=this.data.levelData;e&&this.game.uiManager.setCountdownTime(e.time)}}},{key:"setLevelText",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e;this.game.uiManager.setLevelText(t)}}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=Fv.getMatchState().customData.score,i=void 0===n?0:n;Mv.levelStart(t,i)}}}]),n}(hv);n._RF.pop(),n._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var Gv,Uv,zv,Hv,qv,Vv=(0,i.ccclass)("StateManager")(Dv=function(e){Pe(n,e);var t=Be(n);function n(){return Ae(this,n),t.apply(this,arguments)}return Re(n,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(e){this.gameplay=e,this.state=new Lv(this)}},{key:"change",value:function(e){this.state=e}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return this.state instanceof Lv}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return this.state instanceof Bv}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return this.state instanceof Ov}},{key:"fail",value:function(e){this.state.fail(e)}},{key:"isFail",value:function(){return this.state instanceof bv}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return this.state instanceof xv}},{key:"update",value:function(e){this.state&&this.state.update(e)}},{key:"createInitializeState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return De(Lv,t)}},{key:"createReadyState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return De(Bv,t)}},{key:"createPlayingState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return De(Ov,t)}},{key:"createFailState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return De(bv,t)}},{key:"createFinishState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return De(xv,t)}}]),n}(f))||Dv;n._RF.pop(),n._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);var Wv,Kv,jv,Yv,Xv,$v,Qv,Jv=i.ccclass,Zv=i.property,ey=(Gv=Jv("Digit"),Uv=Zv(u),Gv((qv=$e((Hv=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"numberLabels",qv,Me(e)),e.labelUITransforms=[],e.labelUIOpacitys=[],e.previousNumber=0,e}return Re(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.labelUITransforms=this.numberLabels.map((function(e){return e.getComponent(s)})),this.labelUIOpacitys=this.numberLabels.map((function(e){return e.getComponent(D)})),St.lazyValidateProperties(this)}},{key:"setNumber",value:function(e){this.previousNumber!==e&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[e].node.active||(this.numberLabels[e].node.active=!0),this.labelUIOpacitys[e].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[e].contentSize),this.previousNumber=e)}}]),n}(f)).prototype,"numberLabels",[Uv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zv=Hv))||zv);n._RF.pop(),n._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var ty,ny=i.ccclass,iy=i.disallowMultiple,ay=i.property,ry=(Wv=ny("Clock"),Kv=ay(a),jv=ay(ey),Wv(Yv=iy(($v=$e((Xv=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"clockIcon",$v,Me(e)),Xe(e,"digits",Qv,Me(e)),e.time=0,e.remaining=0,e.running=!1,e.halfTime=!1,e.handleUpdateConfig=function(t){e.enabled&&console.log("Clock: handleUpdateConfig",t)},e.refillTime=function(){var t=Date.now(),n=S(e.node).to(.5,{scale:new j(1.1,1.1,1)}),i=S(e.node).to(.5,{scale:new j(1,1,1)}),a=S(e.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),r=S(e.clockIcon).repeat(5,a),o=S(e.node).to(3,{position:new j(0,0,0)},{onUpdate:function(){var n=Date.now(),i=(n-t)/3e3>1?1:(n-t)/3e3,a=B.lerp(0,120,i);e.setTime(a)}}).call((function(){e.setTime(120),i.start(),e.node.scene.emit(Ka.RESCUE_FINISHED)}));S(e.node).parallel(n,o).start(),r.start()},e}return Re(n,[{key:"__preload",value:function(){this.listenEvents()}},{key:"start",value:function(){this.init()}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"listenEvents",value:function(){this.node.scene.on(Ji,this.handleUpdateConfig),this.node.scene.on(Ka.RESCUE_START,this.refillTime)}},{key:"setTime",value:function(e){this.time=e,this.updateTimeLabel(e),this.remaining=e}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(Ka.TIME_OUT)}},{key:"update",value:function(e){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=e,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(Ka.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}},{key:"updateTimeLabel",value:function(e){for(var t=this.convertSecondsToMmSs(e),n=0;n<t.length;n++)this.digits[n].setNumber(parseInt(t[n]))}},{key:"convertSecondsToMmSs",value:function(e){var t=Math.floor(e/60),n=Math.floor(e%60);return`${this.padZero(t)}${this.padZero(n)}`}},{key:"padZero",value:function(e){return e<10?`0${e}`:`${e}`}}]),n}(f)).prototype,"clockIcon",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qv=$e(Xv.prototype,"digits",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yv=Xv))||Yv)||Yv);n._RF.pop(),n._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var oy,sy,ly,uy,cy,hy,py,dy,fy,vy=i.ccclass,yy=vy("ComboProgressBar")(ty=function(e){Pe(n,e);var t=Be(n);function n(){return Ae(this,n),t.apply(this,arguments)}return Re(n,[{key:"start",value:function(){this.progressBar=this.getComponent(Qr),this.opacity=this.getComponent(D),this.comboTimer=0,this.isActive=!1,this.node.scene.on(Ka.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(e){this.isActive&&(this.comboTimer>0?(this.comboTimer-=e,this.progressBar.progress=this.comboTimer/3):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(Ka.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>0&&(this.isActive=!0,this.comboTimer=3),e>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),n}(f))||ty;n._RF.pop(),n._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var my,gy,by,wy,ky,Sy,Ey,Cy,Ty,Ay,xy,Ry,Iy,Py,_y,Ly,Oy,Dy=i.ccclass,Ny=i.property,My=(oy=Dy("ScoreBlock"),sy=Ny(A),ly=Ny(L),uy=Ny(u),oy((py=$e((hy=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"avatar",py,Me(e)),Xe(e,"defaultAvatar",dy,Me(e)),Xe(e,"scoreText",fy,Me(e)),e}return Re(a,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){this.node.scene.on(Ka.SCORE_UPDATED,this.updateScore,this)}},{key:"unListenGameEvents",value:function(){this.node.scene.off(Ka.SCORE_UPDATED,this.updateScore,this)}},{key:"updateInfo",value:(n=Te(Se().mark((function e(t,n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n?(this.score=n,this.scoreText.string=n.toString()):(this.score=0,this.scoreText.string="0"),e.prev=1,e.next=4,GameCore.Utils.Image.loadImage(t);case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return");case 7:(a=L.createWithImage(i)).packable=!0,this.avatar.spriteFrame=a,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.avatar.spriteFrame=this.defaultAvatar;case 15:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e,t){return n.apply(this,arguments)})},{key:"updateScore",value:(t=Te(Se().mark((function e(t){var n,i,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t-this.score,i=S(this.node).to(.1,{},{onUpdate:function(e,t){if(t){var i=Math.floor(n*t)+a.score;a.scoreText.string=i.toString()}}}),e.next=4,yn.runTweenAsync(i);case 4:this.scoreText.string=t.toString(),this.score=t;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(f)).prototype,"avatar",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dy=$e(hy.prototype,"defaultAvatar",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fy=$e(hy.prototype,"scoreText",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cy=hy))||cy);n._RF.pop(),n._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var Fy,By,Gy,Uy,zy,Hy=i.ccclass,qy=i.property,Vy=globalThis.game.match,Wy=(my=Hy("Header"),gy=qy(u),by=qy(a),wy=qy(a),ky=qy(a),Sy=qy(a),Ey=qy(My),Cy=qy(My),my((xy=$e((Ay=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"levelText",xy,Me(e)),Xe(e,"settingNode",Ry,Me(e)),Xe(e,"homeNode",Iy,Me(e)),Xe(e,"leftNode",Py,Me(e)),Xe(e,"coinNode",_y,Me(e)),Xe(e,"playerScoreBlock",Ly,Me(e)),Xe(e,"opponentScoreBlock",Oy,Me(e)),e}return Re(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"handleClickedPauseGame",value:function(){this.showSettingScreen(),this.node.scene.emit(Ka.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){Yl.openScreen(Kn.QUIT_LEVEL_SCREEN),this.node.scene.emit(Ka.GAME_PAUSE)}},{key:"highlightCoinContainer",value:function(){var e=x("Canvas/Screens");if(e){var t=this.coinNode.worldPosition.clone();this.coinNode.parent=e,this.coinNode.worldPosition=t}}},{key:"removeCoinContainerHighlight",value:function(){var e=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=e}},{key:"showSettingScreen",value:function(){Yl.openScreen(Kn.SETTINGS_SCREEN,{})}},{key:"setLevelText",value:function(e){this.levelText.string=`Level ${e}`}},{key:"setButtonsSelectable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enableBtnNode(this.settingNode,e,!0),this.enableBtnNode(this.homeNode,e,!0)}},{key:"showChallengeScoreBlock",value:function(){var e=Vy.getMatchState(),t=e.id,n=e.customData,i=n.playerId,a=n.opponentId;if(t&&i&&a){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0,this.playerScoreBlock.listenGameEvents();var r=e.profiles[i],o=e.profiles[a];this.playerScoreBlock.updateInfo(r.photo,r.score),this.opponentScoreBlock.updateInfo(o.photo,o.score)}}},{key:"hideChallengeScoreBlock",value:function(){this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1}},{key:"enableBtnNode",value:function(e,t,n){var i=e.getComponent(p);if(i&&(i.interactable=t),e.active=n,n)e.getComponent(ji)}}]),n}(f)).prototype,"levelText",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry=$e(Ay.prototype,"settingNode",[by],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iy=$e(Ay.prototype,"homeNode",[wy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Py=$e(Ay.prototype,"leftNode",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_y=$e(Ay.prototype,"coinNode",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ly=$e(Ay.prototype,"playerScoreBlock",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oy=$e(Ay.prototype,"opponentScoreBlock",[Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ty=Ay))||Ty);n._RF.pop(),n._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var Ky=i.ccclass,jy=i.property,Yy=(Fy=Ky("UIMasks"),By=jy(ji),Fy((zy=$e((Uy=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"background",zy,Me(e)),e}return Re(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"show",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.background.node.active=!0,e.next=3,this.background.changeStateFade(!0,.25);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.background.changeStateFade(!1,.25);case 2:this.background.node.active=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"background",[By],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gy=Uy))||Gy);n._RF.pop(),n._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var Xy,$y,Qy,Jy,Zy,em="bomb";n._RF.pop(),n._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var tm,nm,im,am,rm,om,sm,lm,um,cm,hm,pm,dm,fm,vm,ym,mm,gm,bm,wm=GameCore.Dtos.Player,km=GameCore.Utils.Function,Sm=i.ccclass,Em=i.property,Cm=globalThis.game.player,Tm=(Xy=Sm("DevToolsContainer"),$y=Em(a),Xy((Zy=$e((Jy=function(e){Pe(r,e);var t,n,i,a=Be(r);function r(){var e;Ae(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"devToolsToggle",Zy,Me(e)),e.isActive=!0,e.game=null,e.debouncedStarsNotification=km.debounce((function(){var e=Cm.getGameData();e&&Yl.showNotificationScreen(`Stars added. Current stars: ${e.stars}`)}),700),e}return Re(r,[{key:"injectGameplay",value:function(e){this.game=e}},{key:"hideAllButtons",value:function(){var e=this;this.getComponentsInChildren(p).forEach((function(t){var n=t.node.parent;n&&n.name!==e.devToolsToggle.name&&(n.active=!1)}))}},{key:"showAllButtons",value:function(){var e=this;this.getComponentsInChildren(p).forEach((function(t){var n=t.node.parent;n&&n.name!==e.devToolsToggle.name&&(n.active=!0)}))}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){Cm.setPlayerData(wm.Data.getDefaultData()),Yl.openScreen(Kn.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(Ka.START_OVER)}},{key:"handleNextLevel",value:(i=Te(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(null!==(t=null===(n=this.game)||void 0===n||null===(n=n.getGameData())||void 0===n?void 0:n.level)&&void 0!==t?t:1)+1,null===(i=this.game)||void 0===i||i.setGameData({level:a-1}),Cm.setGameData({level:a}),this.node.scene.emit(Ka.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"handlePrevLevel",value:(n=Te(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Math.max((null!==(t=null===(n=this.game)||void 0===n||null===(n=n.getGameData())||void 0===n?void 0:n.level)&&void 0!==t?t:2)-1,1),null===(i=this.game)||void 0===i||i.setGameData({level:a-1}),Cm.setGameData({level:a}),this.node.scene.emit(Ka.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(t=Te(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Number(t.string),null===(n=this.game)||void 0===n||n.setGameData({level:i-1}),Cm.setGameData({level:i}),this.node.scene.emit(Ka.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var e=globalThis.game.getBuildVersion();Yl.showNotificationScreen(`Build version: ${e}`)}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(Ka.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){this.node.scene.emit(Ka.TIME_OUT)}},{key:"handleClickExplodeButton",value:function(){var e,t,n=this.game;if(n){var i=null===(e=n.getGameData())||void 0===e||null===(e=e.levelData)||void 0===e?void 0:e.specials.bomb;if(i&&!(i<=0)){var a=n.board.getBombTiles();if(0!==a.length){var r=a[0];if((null===(t=r.special)||void 0===t?void 0:t.type)!==em)throw new Error("Invalid bomb tile");r.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(Ka.ADD_ITEM,{animate:function(){return Promise.resolve()},item:vs.HINT,quantity:2}),this.node.scene.emit(Ka.ADD_ITEM,{animate:function(){return Promise.resolve()},item:vs.STORM,quantity:2}),this.node.scene.emit(Ka.ADD_ITEM,{animate:function(){return Promise.resolve()},item:vs.THUNDER,quantity:2}),this.node.scene.emit(Ka.ADD_ITEM,{animate:function(){return Promise.resolve()},item:vs.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(Ka.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var e=Cm.getGameData();e&&(Cm.setGameData({stars:e.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchBundle",value:function(){V.emit(ia)}}]),r}(f)).prototype,"devToolsToggle",[$y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qy=Jy))||Qy);n._RF.pop(),n._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var Am,xm,Rm,Im,Pm,_m,Lm,Om,Dm,Nm=i.ccclass,Mm=i.property,Fm=GameCore,Bm=Fm.Utils,Gm=Fm.Match,Um=globalThis.game.match,zm=(tm=Nm("UIManager"),nm=Mm(ry),im=Mm(Wy),am=Mm(Tm),rm=Mm(yy),om=Mm(a),sm=Mm(Yy),lm=Mm([a]),um=Mm([a]),tm((pm=$e((hm=function(e){Pe(o,e);var t,n,i,a,r=Be(o);function o(){var e;Ae(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"clock",pm,Me(e)),Xe(e,"header",dm,Me(e)),Xe(e,"devTools",fm,Me(e)),Xe(e,"comboProgressBar",vm,Me(e)),Xe(e,"comboContainer",ym,Me(e)),Xe(e,"uiMasks",mm,Me(e)),Xe(e,"topAnimNodes",gm,Me(e)),e.originTopNodesPos=[],Xe(e,"botAnimNodes",bm,Me(e)),e.originBotNodesPos=[],e.hideBotWorldY=-80,e.entranceSignal=new qi,e.exitSignal=new qi,e.showDevTools=function(){e.devTools&&(e.devTools.node.active=!0)},e}return Re(o,[{key:"onLoad",value:function(){var e=this;this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),d.once(Q.EVENT_AFTER_UPDATE,(function(){e.saveOriginPos(),e.initUIPos()}))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var e=this;this.topAnimNodes.forEach((function(t){e.originTopNodesPos.push(t.position.clone())})),this.botAnimNodes.forEach((function(t){e.originBotNodesPos.push(t.position.clone())}))}},{key:"initUIPos",value:function(){var e=this;this.topAnimNodes.forEach((function(t,n){var i=e.originTopNodesPos[n].clone();i.y+=200,t.setPosition(i)}));var t=new j(0,this.hideBotWorldY,0);this.botAnimNodes.forEach((function(n,i){var a,r,o=e.originBotNodesPos[i].clone();t.y=e.hideBotWorldY;var s=null!==(a=null===(r=n.parent)||void 0===r?void 0:r.inverseTransformPoint(t,t).y)&&void 0!==a?a:200;o.y=s,n.setPosition(o)}))}},{key:"listensDevToolsEvents",value:function(){this.node.scene.on(_s.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}},{key:"listenRescueEvents",value:function(){this.node.scene.on(Ka.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(Ka.RESCUE_FINISHED,this.hideRescueAnimation,this)}},{key:"initDevTools",value:function(e){var t=this;window.addEventListener("reset-game-data",(function(){var e;null===(e=t.devTools)||void 0===e||e.handleResetData()})),this.devTools&&(this.devTools.node.active=Bm.Valid.isDebugger(),this.devTools.injectGameplay(e))}},{key:"setLevelText",value:function(e){this.header.setLevelText(e)}},{key:"initCountdown",value:function(){this.clock.init()}},{key:"setCountdownTime",value:function(e){this.clock.setTime(e)}},{key:"startCountdown",value:function(){this.clock.startCountdown()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause(),this.clock.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume(),this.clock.resume()}},{key:"setComboUI",value:function(e){this.comboContainer.getComponent(ji).changeStateFade(e,.1)}},{key:"disableHeader",value:function(){this.header.setButtonsSelectable(!1)}},{key:"enableHeader",value:function(){this.header.setButtonsSelectable()}},{key:"updateStatus",value:function(){Um.getMatchState().mode===Gm.Modes.CHALLENGE_FRIEND?this.header.showChallengeScoreBlock():this.header.hideChallengeScoreBlock()}},{key:"showRescueAnimation",value:(a=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uiMasks.show();case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"hideRescueAnimation",value:(i=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uiMasks.hide();case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"playExitAnimUI",value:(n=Te(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new qi,t=[],this.topAnimNodes.forEach((function(e,n){var a=new j(e.position.x,i.originTopNodesPos[n].y+200,0),r=S(e);r.to(.17,{position:a},{easing:"backIn"}),t.push(yn.runTweenAsync(r,i.exitSignal))})),n=new j(0,this.hideBotWorldY,0),this.botAnimNodes.forEach((function(e){var a,r;n.y=i.hideBotWorldY;var o=null!==(a=null===(r=e.parent)||void 0===r?void 0:r.inverseTransformPoint(n,n).y)&&void 0!==a?a:200,s=new j(e.position.x,o,0),l=S(e);l.to(.17,{position:s},{easing:"backIn"}),t.push(yn.runTweenAsync(l,i.exitSignal))})),e.next=9,Promise.all(t);case 9:if(!this.exitSignal.aborted){e.next=11;break}return e.abrupt("return");case 11:this.header.node.active=!1;case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(t=Te(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new qi,this.header.node.active=!0,t=[],this.topAnimNodes.forEach((function(e,i){var a=new j(e.position.x,n.originTopNodesPos[i].y,0),r=S(e);r.to(.2,{position:a},{easing:"backOut"}),t.push(yn.runTweenAsync(r,n.entranceSignal))})),this.botAnimNodes.forEach((function(e,i){var a=new j(e.position.x,n.originBotNodesPos[i].y,0),r=S(e);r.to(.2,{position:a},{easing:"backOut"}),t.push(yn.runTweenAsync(r,n.entranceSignal))})),e.next=9,Promise.all(t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"setInteractableItemButtons",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.botAnimNodes.forEach((function(t){var n=t.getComponent(Qf);if(n){if(!e)return void(n.button.interactable=!1);n.canActivate()&&(n.button.interactable=!0)}}))}}]),o}(f)).prototype,"clock",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm=$e(hm.prototype,"header",[im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm=$e(hm.prototype,"devTools",[am],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vm=$e(hm.prototype,"comboProgressBar",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ym=$e(hm.prototype,"comboContainer",[om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mm=$e(hm.prototype,"uiMasks",[sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gm=$e(hm.prototype,"topAnimNodes",[lm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bm=$e(hm.prototype,"botAnimNodes",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cm=hm))||cm);n._RF.pop(),n._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var Hm=globalThis.game,qm=Hm.player,Vm=Hm.ads,Wm=Hm.event,Km=Hm.match,jm=Hm.storage,Ym=Hm.analytics,Xm=Hm.monitorError,$m=Hm.frameCapture,Qm=Hm.leaderboard,Jm=GameCore.Events,Zm=GameCore.Match.Modes,eg=GameCore.Utils.Time,tg=GameCore.Configs.Gameplay,ng=i.ccclass,ig=i.property,ag=[];Am=ng("Gameplay"),xm=ig(Zc),Rm=ig(ji),Im=ig(Vh),Am((Lm=$e((_m=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"board",Lm,Me(e)),Xe(e,"opacityToggler",Om,Me(e)),Xe(e,"pathDraw",Dm,Me(e)),e.gameData=null,e.defaultData={level:1,isMatchStartFromLoader:!1},e.rescueTiles=[],e.isAutoPlayEnabled=!1,e.handleOpenScreen=function(t){t.screenName===jn[Kn.GET_ITEM_SCREEN]&&e.uiManager.highlightCoinContainer()},e.handleShowUI=Te(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.uiManager.updateStatus(),e.uiManager.disableHeader(),e.uiManager.setInteractableItemButtons(!1),t.next=5,e.uiManager.playEntranceAnimUI();case 5:e.uiManager.enableHeader(),e.uiManager.setInteractableItemButtons(!0);case 7:case"end":return t.stop()}}),t)}))),e.handleHideUI=Te(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.uiManager.disableHeader(),e.uiManager.setInteractableItemButtons(!1),t.next=4,e.uiManager.playExitAnimUI();case 4:case"end":return t.stop()}}),t)}))),e.handleCloseScreen=function(t){t.screenName===jn[Kn.GET_ITEM_SCREEN]&&e.uiManager.unHighlightCoinContainer()},e.handlePauseGame=function(){e.node.scene.emit(Ka.PAUSE_TIME),e.node.pauseSystemEvents(!0),e.opacityToggler.changeStateFade(!1,.1),e.uiManager.setComboUI(!1),e.processCrazyGamesGameplayStop()},e.handleResumeGame=function(){var t;e.node.resumeSystemEvents(!0),e.stateManager.isPlaying()&&e.node.scene.emit(Ka.RESUME_TIME),e.processCrazyGamesGameplayStart(),e.opacityToggler.changeStateFade(!0,.1),e.uiManager.setComboUI(!0),null===(t=e.guidelinesManager)||void 0===t||t.startAutoGuides()},e.handleReplayGame=function(){var t=Te(Se().mark((function t(n){var i;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.handleHideHint(),i=ke(ke({},e.defaultData),n),t.prev=2,Km.getMatchState().mode!==Zm.SINGLE){t.next=6;break}return t.next=6,Cl.finishMatchAsync();case 6:if(Km.getMatchState().mode===Zm.CHALLENGE_FRIEND){t.next=9;break}return t.next=9,Cl.startMatchAsync();case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),console.warn("handleReplayGame",t.t0);case 14:e.setGameData(i),e.stateManager.initialize();case 16:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e){return t.apply(this,arguments)}}(),e.handleFinishGame=function(){var t;e.attemptCallCreateShortcut(),null!==(t=e.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()?(e.guidelinesManager.guideSkipButton.active=!1,e.handleNextLevel()):e.stateManager.finish()},e.handleNextLevel=Te(Se().mark((function t(){var n,i,a;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.gameData){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,Km.getMatchState().mode!==Zm.SINGLE){t.next=6;break}return t.next=6,Cl.finishMatchAsync();case 6:return Km.getMatchState().mode===Zm.TOURNAMENT&&e.scoreManager.updateTournamentStartScore(),t.next=9,Cl.startMatchAsync();case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),console.warn("handleReplayGame",t.t0);case 14:i=null!==(n=e.gameData.level)&&void 0!==n?n:1,a=i+1,e.setGameData({level:a}),e.stateManager.initialize(),console.log("Next level",e.gameData.level);case 19:case"end":return t.stop()}}),t,null,[[2,11]])}))),e.handleStartOver=Te(Se().mark((function t(){var n;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:qm.setGameData({level:tg.Tutorial.Enabled?0:1}),e.gameData=qm.getGameData(),e.stateManager.initialize(),console.info("Start over",null===(n=e.gameData)||void 0===n?void 0:n.level);case 4:case"end":return t.stop()}}),t)}))),e.handleMaxLevel=function(){e.gameData&&(e.initData(),Yl.openScreen(Kn.CONGRATULATION_SCREEN,{level:e.gameData.level}),console.info("Max level",e.gameData.level))},e.handleExitGame=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{jm.setStorageData("dashboard","animateToCurrentLevel",!0),jm.setStorageData("collection","animateMapPackUnlock",!0)}catch(e){console.warn("handleExitGame",e)}case 1:case"end":return e.stop()}}),e)}))),e.handleTileClick=function(t){e.stateManager.playing(),e.board.handleTileClick(t),e.handleHideHint()},e.handleGridMatchSuccess=function(t,n){e.pathDraw.drawMatchPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)})),e.comboManager.addCombo(),e.handleAddScore(),e.effectManager.playClearFXAt([n[0].node.worldPosition,n[1].node.worldPosition])},e.handleGridMatchFail=function(t){var n;null!==(n=e.guidelinesManager)&&void 0!==n&&n.isShowErrorPathLevel()&&e.pathDraw.drawErrorPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)}))},e.checkIfGameIsFinish=function(){0===e.board.getUncleared().length&&e.node.scene.emit(Ka.GAME_FINISH)},e.handlePauseTime=function(){e.uiManager.pauseTime()},e.handleResumeTime=function(){e.uiManager.resumeTime()},e.handleClockTimeout=function(){e.stateManager.fail(iu)},e.handleHalfTime=function(){void 0!==e.guidelinesManager&&(e.board.getUncleared().length>=e.board.getCleared().length&&e.guidelinesManager.startThunderGuide()||e.board.getBombTiles().length>0&&e.guidelinesManager.startPliersGuide())},e.handleStartRescue=function(){var t,n;for(Bn.setBlockInput(!0),e.board.setIgnoreInput(!0);e.rescueTiles.length>0;){var i=e.rescueTiles.pop();null==i||i.restore()}Ym.levelRescue(null!==(t=null===(n=e.gameData)||void 0===n?void 0:n.level)&&void 0!==t?t:1)},e.handleFinishRescue=function(){Bn.setBlockInput(!1),e.board.setIgnoreInput(!1)},e.handleBombExplode=function(){var t=Te(Se().mark((function t(n){var i;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.rescueTiles.push(n),e.board.setIgnoreInput(!0),Bn.getBlockInput()||(Jn.playSound(Hn.BOMB_EXPLODE_1),Bn.setBlockInput(!0)),i=n.node.worldPosition,t.next=6,e.effectManager.createBombExplosionAt(new j(i.x,i.y,0));case 6:if(Bn.setBlockInput(!1),!e.stateManager.isFail()){t.next=9;break}return t.abrupt("return");case 9:e.stateManager.fail(au);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleShowHint=function(){if(!e.pathDraw.isDrawingHint){var t=e.board.getHintPath();t&&(Jn.playSound(Hn.HINT_ITEM),e.pathDraw.drawHintPath(t,(function(t){return e.board.getAnyTileWorldPosition(t.x,t.y)})),e.board.showHint())}},e.handleHideHint=function(){e.pathDraw.isDrawingHint&&(e.pathDraw.clearHintPath(),e.board.hideHint())},e.handleAddScore=function(){var t=e.levelManager.getLevelData().level,n=e.comboManager.getCombo();e.scoreManager.addScore(10,t,n)},e.handleUseItem=function(t){e.stateManager.playing(),t!==vs.HINT&&e.handleHideHint()},e.handleAutoPlay=function(){e.isAutoPlayEnabled?e.disableAutoPlay():e.enableAutoPlay()},e.enableAutoPlay=function(){e.isAutoPlayEnabled=!0;e.node.scene.once(Ka.GAME_FINISH,(function(){e.disableAutoPlay()})),e.schedule(e.autoPlay,.5)},e.disableAutoPlay=function(){e.isAutoPlayEnabled=!1,e.unschedule(e.autoPlay)},e.autoPlay=function(){var t=e.board.getHintPath();if(!t)throw new Error("No path found");var n=t[0].a,i=t.slice(-1)[0].b,a=e.board.getTileAt(n.x,n.y),r=e.board.getTileAt(i.x,i.y);if(!a||!r)throw new Error("Tile is null");a.onClick(),r.onClick()},e.handleAddStars=function(t){var n=qm.getGameData();if(!n)return Promise.resolve([]);qm.setGameData({stars:n.stars+1});var i=t.startAnimationAt;i&&e.effectManager.playStarFXAt(i)},e.handleInviteFriends=Te(Se().mark((function t(){var n,i,a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,Yl.showLoadingScreen(),r=e.board.generateFenFromCurrentLevel(),o=null!==(n=qm.getGameData())&&void 0!==n?n:{},s=o.level,l=void 0===s?1:s,l=Math.max(1,l),u=null!==(i=null===(a=e.gameData)||void 0===a?void 0:a.levelData)&&void 0!==i?i:{},c=u.mode,h=void 0===c?"":c,p=u.rules,d=void 0===p?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:p,f=u.time,v=void 0===f?0:f,$m.addWideframeRender("renderResultChallenge",$s),t.next=9,Km.context.choose.processAsync({playerId:qm.getPlayerId(),fallbackSingleMode:!1,extraData:{level:l,fen:r,gravity:h,rules:d,time:v}});case 9:Yl.closeLoadingScreen(),e.node.scene.emit(Ka.GAME_RESUME),e.node.scene.emit(Ka.GAME_REPLAY,{level:l}),t.next=24;break;case 14:if(t.prev=14,t.t0=t.catch(0),console.warn("Unable to invite friends",t.t0),Yl.closeLoadingScreen(),Yl.showNotificationScreen("Sorry, please try again later"),t.t0 instanceof Error){t.next=21;break}return t.abrupt("return");case 21:null==Xm||Xm.sendException(t.t0),e.node.scene.emit(Ka.GAME_RESUME),e.node.scene.emit(Ka.SHOW_UI);case 24:case"end":return t.stop()}}),t,null,[[0,14]])}))),e.handleReplayFriends=Te(Se().mark((function t(){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=null!==(n=qm.getGameData())&&void 0!==n?n:{},a=i.level,r=void 0===a?1:a,t.prev=1,l=Km.getMatchState().customData.opponentId){t.next=5;break}throw new Error("Opponent id is not found");case 5:return Yl.showLoadingScreen(),u=e.board.generateFenFromCurrentLevel(),c=null!==(o=null===(s=e.gameData)||void 0===s?void 0:s.levelData)&&void 0!==o?o:{},h=c.mode,p=void 0===h?"":h,d=c.rules,f=void 0===d?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:d,v=c.time,y=void 0===v?0:v,t.next=10,Km.challenge.friend.processAsync({playerId:qm.getPlayerId(),opponentId:l,extraData:{level:r,fen:u,gravity:p,rules:f,time:y}});case 10:Yl.closeLoadingScreen(),e.node.scene.emit(Ka.GAME_RESUME),e.node.scene.emit(Ka.GAME_REPLAY,{level:r}),t.next=25;break;case 15:if(t.prev=15,t.t0=t.catch(1),console.warn("ReplayChallengeFriend",t.t0),Yl.closeLoadingScreen(),Yl.showNotificationScreen("Sorry, you cannot replay\nat this time.",3),t.t0 instanceof Error){t.next=22;break}return t.abrupt("return");case 22:null==Xm||Xm.sendException(t.t0),e.node.scene.emit(Ka.GAME_RESUME),e.node.scene.emit(Ka.GAME_REPLAY,{level:r});case 25:case"end":return t.stop()}}),t,null,[[1,15]])}))),e.handleAdShow=function(t){var n=t.placementId;n&&ag.includes(n)&&(ag.splice(ag.indexOf(n),1),Vm.hideBannerAdAsync(n).catch((function(){})),0===ag.length&&Wm.off(GameCore.Events.AD_SHOWING,e.handleAdShow))},e.handleAddItem=function(){var t=Te(Se().mark((function t(n){var i,a,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.animate,a=n.item,r=n.quantity,void 0!==(o=e.itemManager.items.find((function(e){return e.itemType===a})))){t.next=5;break}return console.warn(`Item ${a} not found`),t.abrupt("return");case 5:return s=o.getQuantity(),l=s+r,o.saveQuantity(l),e.uiManager.setInteractableItemButtons(!1),e.handlePauseGame(),t.next=12,i();case 12:o.setQuantity(l,!0),e.uiManager.setInteractableItemButtons(!0),e.handleResumeGame();case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Re(i,[{key:"__preload",value:function(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"onLoad",value:function(){dl.init()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}},{key:"initUIManager",value:function(){var e;this.uiManager=null===(e=this.node.parent)||void 0===e?void 0:e.getComponentInChildren(zm),this.uiManager.initDevTools(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(av)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(Vv)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(ru)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(Wp)}},{key:"initItemManager",value:function(){var e=this;this.itemManager=this.getComponent(Zf),this.itemManager.syncItems(),this.itemManager.items.forEach((function(t){t.init(e)}))}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(lp),this.comboManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(rv),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){tg.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(jf),this.guidelinesManager.init(this))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){ag=[],Wm.off(GameCore.Events.AD_SHOWING,this.handleAdShow),Wm.clear(Jm.OPENING_SCREEN),Wm.clear(Jm.CLOSING_SCREEN),Wm.on(Jm.OPENING_SCREEN,this.handleOpenScreen),Wm.on(Jm.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(Ka.SHOW_UI,this.handleShowUI),this.node.scene.on(Ka.HIDE_UI,this.handleHideUI),this.node.scene.on(Ka.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(Ka.GAME_RESUME,this.handleResumeGame),this.node.scene.on(Ka.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(Ka.GAME_FINISH,this.handleFinishGame),this.node.scene.on(Ka.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(Ka.START_OVER,this.handleStartOver),this.node.scene.on(Ka.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(Ka.GAME_EXIT,this.handleExitGame),this.node.scene.on(Ka.TILE_CLICK,this.handleTileClick),this.node.scene.on(Ka.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(Ka.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(Ka.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(Ka.RESUME_TIME,this.handleResumeTime),this.node.scene.on(Ka.TIME_OUT,this.handleClockTimeout),this.node.scene.on(Ka.HALF_TIME,this.handleHalfTime),this.node.scene.on(Ka.RESCUE_START,this.handleStartRescue),this.node.scene.on(Ka.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(Ka.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(Ka.SHOW_HINT,this.handleShowHint),this.node.scene.on(Ka.ADD_SCORE,this.handleAddScore),this.node.scene.on(Ka.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(Ka.USE_ITEM,this.handleUseItem),this.node.scene.on(Ka.ADD_ITEM,this.handleAddItem),this.node.scene.on(Ka.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(Ka.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(Ka.INVITE_FRIENDS,this.handleInviteFriends),this.node.scene.on(Ka.REPLAY_FRIENDS,this.handleReplayFriends)}},{key:"start",value:function(){this.initDataFirstTime(),this.initGame(),this.trySetTournamentStorage()}},{key:"initDataFirstTime",value:function(){var e=this.getSceneData(),t=(null!=e?e:{}).level;void 0===t&&(t=Cl.getMatchMode()===Zm.TOURNAMENT?1:0),this.initData(),this.setGameData({level:t})}},{key:"initData",value:function(){var e,t=null!==(e=qm.getGameData())&&void 0!==e?e:{},n=t.level,i=void 0===n?1:n,a=t.items;a&&this.checkItemsRewardable()&&(a.hint<5&&(a.hint+=1),a.thunder<5&&(a.thunder+=1),a.storm<5&&(a.storm+=1),a.pliers<5&&(a.pliers+=1),qm.setGameData({items:a,lastRewardedItems:Date.now()})),this.setGameData(ke(ke({},this.defaultData),{},{level:i}))}},{key:"checkItemsRewardable",value:function(){var e,t=(null!==(e=qm.getGameData())&&void 0!==e?e:{}).lastRewardedItems,n=void 0===t?0:t;return!eg.isToday(n)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"trySetTournamentStorage",value:(t=Te(Se().mark((function e(){var t,n,i,a,r,o,s,l;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Cl.getMatchMode()===Zm.TOURNAMENT){e.next=3;break}return e.abrupt("return");case 3:if(n=null!==(t=Cl.getMatchCustomData())&&void 0!==t?t:{},i=n.leaderboardId){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,tu.requestTournamentDataAsync();case 8:if(a=Qm.getLeaderboardName(i)){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,Qm.getLeadersByPlayerIdsAsync(a,[qm.getPlayerId()]);case 13:if(0!==(r=e.sent).length){e.next=16;break}return e.abrupt("return");case 16:o=r[0],s=o.score,l=o.rank,jm.setStorageData("tournament","previousScore",s),jm.setStorageData("tournament","previousRank",l);case 19:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"setGameData",value:function(e){var t,n,i,a=null!==(t=null!==(n=e.level)&&void 0!==n?n:null===(i=this.gameData)||void 0===i?void 0:i.level)&&void 0!==t?t:1;this.gameData=ke(ke(ke({},this.gameData),e),{},{level:a})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return Dl.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var e,t=null!==(e=this.getGameData())&&void 0!==e?e:{},n=t.level,i=void 0===n?0:n,a=t.nextLevelCount;i<2||(void 0===a?0:a)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("checkAndCreateShortcutAsync",e)}))}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),i}(f)).prototype,"board",[xm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Om=$e(_m.prototype,"opacityToggler",[Rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dm=$e(_m.prototype,"pathDraw",[Im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm=_m));n._RF.pop(),n._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var rg=function(e){return e[e.STAR_CHEST=0]="STAR_CHEST",e[e.BALLOON=1]="BALLOON",e}(rg||{});N(rg),n._RF.pop(),n._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var og,sg=function(e){return e.WORLD_TAB_SELECTED="world-tab-selected",e.FRIENDS_TAB_SELECTED="friends-tab-selected",e}(sg||{}),lg="#AE4212",ug="#3D5172",cg="#92200C",hg="#8F5542",pg="#8A4733",dg="#3e7110",fg="#3e7110";n._RF.pop(),n._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),n._RF.pop(),n._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),n._RF.pop(),n._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),n._RF.pop(),n._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var vg,yg=i.ccclass,mg=globalThis.game,gg=mg.player,bg=mg.analytics;yg("HintItem")(og=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){Yl.openScreen(Kn.GET_ITEM_SCREEN,{item:vs.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},e.loadQuantity=function(){var e=gg.getGameData();return null!=e&&e.items&&e?e.items[vs.HINT]:0},e}return Re(i,[{key:"itemType",get:function(){return vs.HINT}},{key:"init",value:function(e){this.boardInstance=e.board,this.pathDrawer=e.pathDraw,this.setQuantity(this.loadQuantity()),Ue(_e(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ue(_e(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ue(_e(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ue(_e(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>0}catch(e){return!1}}},{key:"activate",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pathDrawer.isDrawingHint){e.next=2;break}return e.abrupt("return");case 2:if(!(this.getQuantity()<=0)){e.next=6;break}return e.next=5,Ue(_e(i.prototype),"activate",this).call(this);case 5:return e.abrupt("return");case 6:return e.next=8,Ue(_e(i.prototype),"activate",this).call(this);case 8:bg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:vs.HINT}),this.node.scene.emit(Ka.USE_ITEM,vs.HINT),this.node.scene.emit(Ka.SHOW_HINT);case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ue(_e(i.prototype),"saveQuantity",this).call(this,e,t);var n=gg.getGameData();n&&gg.setGameData({items:ke(ke({},n.items),{},{[vs.HINT]:e})})}}]),i}(Qf));n._RF.pop(),n._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var wg,kg=i.ccclass,Sg=globalThis.game,Eg=Sg.player,Cg=Sg.analytics;kg("PliersItem")(vg=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){Yl.openScreen(Kn.GET_ITEM_SCREEN,{item:vs.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},e.loadQuantity=function(){var e=Eg.getGameData();return null!=e&&e.items&&e?e.items[vs.PLIERS]:0},e}return Re(i,[{key:"itemType",get:function(){return vs.PLIERS}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Ue(_e(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ue(_e(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ue(_e(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ue(_e(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getBombTiles().length>0}catch(e){return!1}}},{key:"activate",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,Ue(_e(i.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,Ue(_e(i.prototype),"activate",this).call(this);case 6:Cg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:vs.PLIERS}),this.node.scene.emit(Ka.USE_ITEM,vs.PLIERS),t=ec(this.boardInstance.getBombTiles()),n=t.node.worldPosition,this.effectManager.createDefuseExplosionAt(new j(n.x,n.y,0)),Jn.playSound(Hn.BOMB_DEFUSE),t.special.switch(Uu.none),this.applyActivationStatus();case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ue(_e(i.prototype),"saveQuantity",this).call(this,e,t);var n=Eg.getGameData();n&&Eg.setGameData({items:ke(ke({},n.items),{},{[vs.PLIERS]:e})})}}]),i}(Qf));n._RF.pop(),n._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var Tg,Ag=i.ccclass,xg=globalThis.game,Rg=xg.player,Ig=xg.analytics;Ag("StormItem")(wg=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){Yl.openScreen(Kn.GET_ITEM_SCREEN,{item:vs.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},e.loadQuantity=function(){var e=Rg.getGameData();return null!=e&&e.items&&e?e.items[vs.STORM]:0},e}return Re(i,[{key:"itemType",get:function(){return vs.STORM}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Ue(_e(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ue(_e(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ue(_e(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ue(_e(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>2}catch(e){return!1}}},{key:"activate",value:(t=Te(Se().mark((function e(){var t,n,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,Ue(_e(i.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,Ue(_e(i.prototype),"activate",this).call(this);case 6:return Ig.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:vs.STORM}),this.node.scene.emit(Ka.USE_ITEM,vs.STORM),this.node.scene.emit(Ka.HIDE_UI),t=new Promise((function(e){return a.scheduleOnce(e,.5)})),e.next=12,Promise.race([this.effectManager.loadTornadoAnimation(),t]);case 12:n=function(){var e=Te(Se().mark((function e(t,n){var i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Jn.muteMusic(!0),Jn.playSound(Hn.SHUFFLE_ITEM),Jn.playSound(Hn.WIND),i=function(){return Promise.all(t.map((function(e,n,i){return e.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return Ku(t,a.boardInstance.getTileSize(),{x:n,y:i},10)}})})))},r=function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.forEach((function(e,t,i){e.node.setSiblingIndex(n.asArray().length-1-(t+i*n.width))})),e.next=3,Promise.all(n.map((function(e){return e.fly({getTilePosition:function(e){return Ku(n,a.boardInstance.getTileSize(),e)}})})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=7,i();case 7:return a.effectManager.playTornadoAnimation(),e.next=10,r();case 10:a.node.scene.emit(Ka.SHOW_UI),Jn.muteMusic(!1);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.boardInstance.processShuffleRequest(n);case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ue(_e(i.prototype),"saveQuantity",this).call(this,e,t);var n=Rg.getGameData();n&&Rg.setGameData({items:ke(ke({},n.items),{},{[vs.STORM]:e})})}}]),i}(Qf));n._RF.pop(),n._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var Pg,_g=i.ccclass,Lg=globalThis.game,Og=Lg.player,Dg=Lg.analytics;_g("ThunderItem")(Tg=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){Yl.openScreen(Kn.GET_ITEM_SCREEN,{item:vs.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},e.loadQuantity=function(){var e=Og.getGameData();return null!=e&&e.items&&e?e.items[vs.THUNDER]:0},e}return Re(i,[{key:"itemType",get:function(){return vs.THUNDER}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Ue(_e(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ue(_e(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ue(_e(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ue(_e(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>=4}catch(e){return!1}}},{key:"activate",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,Ue(_e(i.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,Ue(_e(i.prototype),"activate",this).call(this);case 6:return Dg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:vs.THUNDER}),this.node.scene.emit(Ka.USE_ITEM,vs.THUNDER),this.node.scene.emit(Ka.HIDE_UI),e.next=11,this.effectManager.loadThunderAnimation();case 11:if(Jn.muteMusic(!0),!((t=this.boardInstance.getUncleared()).length<4)){e.next=15;break}throw new Error("Not enough uncleared tiles");case 15:return n=this.boardInstance.getPairs(2),Bn.setBlockInput(!0),this.boardInstance.clearSelectedTile(),e.next=20,this.effectManager.playThunderAnimation(n,this.boardInstance);case 20:t.length>4&&this.node.scene.emit(Ka.SHOW_UI),Jn.muteMusic(!1),Bn.setBlockInput(!1);case 23:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ue(_e(i.prototype),"saveQuantity",this).call(this,e,t);var n=Og.getGameData();n&&Og.setGameData({items:ke(ke({},n.items),{},{[vs.THUNDER]:e})})}}]),i}(Qf));n._RF.pop(),n._RF.push({},"0a97aK0agJOHb07cLs0JICj","PathHolder",void 0);var Ng,Mg,Fg,Bg,Gg,Ug,zg,Hg,qg,Vg,Wg,Kg,jg,Yg=i.ccclass,Xg=i.requireComponent;Yg("PathHolder")(Pg=Xg(D)(Pg=function(e){Pe(n,e);var t=Be(n);function n(){return Ae(this,n),t.apply(this,arguments)}return Re(n,[{key:"onLoad",value:function(){var e=this;this.node.scene.on(Ka.GRID_CREATE,(function(t){e.node.scale=t.getScale()}))}}]),n}(f))||Pg);n._RF.pop(),n._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var $g,Qg,Jg,Zg,eb,tb,nb,ib=i.ccclass,ab=i.property,rb=(Ng=ib("Coin"),Mg=ab(ae),Fg=ab(ae),Bg=ab(y),Gg=ab(P),Ug=ab(P),Ng((qg=$e((Hg=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"explodeParticles",qg,Me(e)),Xe(e,"emittingParticles",Vg,Me(e)),Xe(e,"animation",Wg,Me(e)),Xe(e,"spin",Kg,Me(e)),Xe(e,"rest",jg,Me(e)),e}return Re(n,[{key:"__preload",value:function(){St.lazyValidateProperties(this)}},{key:"playAnimation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;t>0&&this.scheduleOnce((function(){null!=n&&n.aborted||e.animation.play(e.spin.name)}),t),this.animation.play(this.spin.name)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),n}(f)).prototype,"explodeParticles",[Mg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vg=$e(Hg.prototype,"emittingParticles",[Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wg=$e(Hg.prototype,"animation",[Bg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kg=$e(Hg.prototype,"spin",[Gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jg=$e(Hg.prototype,"rest",[Ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zg=Hg))||zg);n._RF.pop(),n._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var ob,sb,lb,ub,cb,hb,pb,db,fb,vb=i.ccclass,yb=i.property,mb=j.ZERO.clone().add3f(0,-100,0),gb=j.ZERO.clone().add3f(0,100,0),bb=($g=vb("CoinTextPopup"),Qg=yb(u),Jg=yb(D),$g((tb=$e((eb=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"label",tb,Me(e)),Xe(e,"uiOpacity",nb,Me(e)),e}return Re(i,[{key:"__preload",value:function(){St.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(t=Te(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=GameCore.Utils.Number.getShortNumber(t,3),this.label.string=i,this.node.active=!0,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(mb),e.next=8,Promise.all([yn.runTweenAsync(S(this.node).to(1.5,{position:gb},{easing:"sineOut"}),n),yn.runTweenAsync(S(this.node).to(.5,{scale:j.ONE},{easing:"backOut"}),n)]);case 8:return this.node.setScale(j.ONE),this.node.setPosition(gb),
//! not subscribed to signal because in the case the user skipped the animation we'd still want them to see this node disappear
e.next=12,yn.runTweenAsync(S(this.uiOpacity).to(.5,{opacity:0}));case 12:this.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),i}(f)).prototype,"label",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nb=$e(eb.prototype,"uiOpacity",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zg=eb))||Zg);n._RF.pop(),n._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var wb=i.ccclass,kb=i.disallowMultiple,Sb=i.property,Eb=globalThis.game,Cb=Eb.player,Tb=Eb.monitorError,Ab=999999999,xb=10,Rb=1,Ib=1,Pb=(ob=wb("CoinManager"),sb=Sb(R),lb=Sb(R),ub=Sb(a),ob(cb=kb((pb=$e((hb=function(e){Pe(s,e);var t,n,i,a,r,o=Be(s);function s(){var e;Ae(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=o.call.apply(o,[this].concat(n))).coins=0,Xe(e,"coinPrefab",pb,Me(e)),Xe(e,"coinTextPopup",db,Me(e)),Xe(e,"coinAnimContainer",fb,Me(e)),e.collectionAnimSignal=null,e.coinObjects=[],e}return Re(s,[{key:"__preload",value:function(){this.lifeCycleSignal=new qi,this.validateRequiredComponents(),this.getCoinsFromPlayerData()}},{key:"onLoad",value:function(){this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(e){this.updateCoins({coins:this.coins,collectionAnimation:void 0}),this.animSkipOverlay=e}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(Ka.ADD_COINS,this.addCoins,this),this.node.scene.on(Ka.REMOVE_COINS,this.removeCoins,this)}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"prepareCoinCollection",value:function(){for(var e=0;e<xb;e++){var t=l(this.coinPrefab);t.setParent(this.coinAnimContainer),t.setPosition(0,0),t.active=!1,this.coinObjects.push(t.getComponent(rb))}}},{key:"prepareCoinTextPopup",value:function(){var e=l(this.coinTextPopup);e.setParent(this.node),e.active=!1,this.coinTextPopupNode=e.getComponent(bb)}},{key:"handleCollectionAnim",value:(r=Te(Se().mark((function e(t,n,i){var a,r,o,s,l,u=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.targetContainer){e.next=3;break}return console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played"),e.abrupt("return");case 3:if(0!==(o=this.coinObjects.slice(0,this.getShortAmount(t))).length){e.next=8;break}return console.warn(`Requested coins amount is ${t}. Shortened to ${this.getShortAmount(t)}. No coin objects was found to animate collection.`),null==Tb||Tb.sendException(new Error(`Requested coins amount is ${t}. Shortened to ${this.getShortAmount(t)}. No coin objects was found to animate collection.`),{coins:t,animatedCoins:o.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!this.targetContainer,coinCollectionCount:this.coinObjects.length}),e.abrupt("return");case 8:return e.next=10,null===(a=this.animSkipOverlay)||void 0===a?void 0:a.open({onSkip:function(){return u.collectionAnimSignal.abort()},opacity:150});case 10:return Jn.playSound(Hn.COLLECT_STOCK_COINS),s=o.map(function(){var e=Te(Se().mark((function e(t){var a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.explodeParticles.stopSystem(),t.emittingParticles.stopSystem(),t.node.active=!0,a=[0,.5*Math.min(n,i)],r=ne.apply(void 0,a),o=n-r,s=i+r,e.next=9,u.animateCoinExplode(t.node,o);case 9:return t.playAnimation(2*r,u.collectionAnimSignal),t.emittingParticles.resetSystem(),e.next=13,u.animateCoinFlyBack(u.collectionAnimSignal,t,s);case 13:t.emittingParticles.stopSystem(),t.stopAnimation();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l=function(){var e=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(s);case 2:return e.next=4,null===(t=u.targetContainer)||void 0===t?void 0:t.emitExplodeEffect(u.collectionAnimSignal);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=15,Promise.all([l(),this.animateCoinTextPopup(t,this.collectionAnimSignal,n+i/2)]);case 15:return e.next=17,null===(r=this.animSkipOverlay)||void 0===r?void 0:r.close();case 17:this.collectionAnimSignal.abort();case 18:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"animateCoinTextPopup",value:(a=Te(Se().mark((function e(t,n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.waitTweenAsync(i,n);case 2:return e.next=4,this.coinTextPopupNode.show(t,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"animateCoinFlyBack",value:(i=Te(Se().mark((function e(t,n,i){var a,r,o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.node.worldPosition.clone(),r=j.ZERO.clone(),o=this.targetContainer.getCoinIconWorldScale(),e.next=5,yn.runTweenAsync(S(n.node).to(i,{scale:o},{onUpdate:function(e,t){if(void 0!==t){var i=O.cubicIn(t),o=s.targetContainer.getCoinIconWorldPosition();n.node.worldPosition=j.lerp(r,a,o,i)}}}),t);case 5:n.node.scale=j.ZERO,this.explodeParticlesAndDisableAfter(1,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"explodeParticlesAndDisableAfter",value:(n=Te(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=n.explodeParticles).resetSystem(),e.next=4,yn.waitTweenAsync(t/10,this.lifeCycleSignal);case 4:if(!qi.hasBeenAborted(this.lifeCycleSignal)){e.next=6;break}return e.abrupt("return");case 6:return i.stopSystem(),e.next=9,yn.waitTweenAsync(t/10*9,this.lifeCycleSignal);case 9:if(!qi.hasBeenAborted(this.lifeCycleSignal)){e.next=11;break}return e.abrupt("return");case 11:n.node.setPosition(0,0,n.node.position.z),n.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"animateCoinExplode",value:(t=Te(Se().mark((function e(t,n){var i,a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[-200,200],r=ne((i=[-200,200])[0],i[1]),o=ne(a[0],a[1]),t.setPosition(0,0,t.position.z),t.setScale(j.ZERO),s=new j(r,o,t.position.z),e.next=9,Promise.all([yn.runTweenAsync(S(t).delay(.1*n).to(.8*n,{scale:j.ONE},{easing:"elasticOut"}),this.collectionAnimSignal),yn.runTweenAsync(S(t).to(n,{position:s},{easing:"circOut"}),this.collectionAnimSignal)]);case 9:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var e=Cb.getGameData();this.coins=e?e.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(e){var t,n;if(console.info("updateCoins",e.coins,null===(t=e.collectionAnimation)||void 0===t?void 0:t.animateTextOnly),this.coins>Ab&&(this.coins=Ab),e.coins!==this.coins){var i=Math.max(0,e.coins-this.coins);this.coins=e.coins,Cb.setGameData({coins:this.coins});var a=e.collectionAnimation;if(void 0===a||a.animateTextOnly)this.node.scene.emit(Ka.COIN_CHANGED,ke(ke({},e),{},{collectionAnimation:{animateTextOnly:!0,signal:this.collectionAnimSignal}}));else{null===(n=this.collectionAnimSignal)||void 0===n||n.abort();var r=a.floatDuration,o=void 0===r?Rb:r,s=a.flyDuration,l=void 0===s?Ib:s,u=a.signal,c=void 0===u?new qi:u,h=a.target,p=void 0===h?this.targetContainer:h;this.collectionAnimSignal=c,this.targetContainer=p;var d=ke(ke({},e),{},{collectionAnimation:{floatDuration:o,flyDuration:l,animateTextOnly:!1,signal:c,target:p}});this.node.scene.emit(Ka.COIN_CHANGED,d),this.handleCollectionAnim(i,o,l)}}}},{key:"addCoins",value:function(e){this.updateCoins(ke(ke({},e),{},{coins:this.coins+e.coins}))}},{key:"removeCoins",value:function(e){this.coins<e.coins?this.node.scene.emit(Ka.REMOVE_COINS_FAILED):(this.updateCoins(ke(ke({},e),{},{coins:this.coins-e.coins})),this.node.scene.emit(Ka.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(Ka.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(e){return Math.min(e,xb)}},{key:"untilFinishesCollectAnim",value:function(){return null===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(e){this.targetContainer=e}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var e,t;null===(e=this.collectionAnimSignal)||void 0===e||e.abort(),null===(t=this.lifeCycleSignal)||void 0===t||t.abort()}}]),s}(f)).prototype,"coinPrefab",[sb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),db=$e(hb.prototype,"coinTextPopup",[lb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fb=$e(hb.prototype,"coinAnimContainer",[ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cb=hb))||cb)||cb);n._RF.pop(),n._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),n._RF.pop(),n._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),n._RF.pop(),n._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),n._RF.pop(),n._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),n._RF.pop(),n._RF.push({},"f3b1eQ+t3FJYa35I0oznLiF","ParticleProperties",void 0);var _b,Lb,Ob,Db,Nb,Mb=Re((function e(){Ae(this,e),this.lifeCurrent=0,this.life=0,this.velocityX=0,this.velocityY=0,this.alpha=255,this.totalRotation=0,this.lastChange=0,this.currentFrame=0}));n._RF.pop(),n._RF.push({},"32b8eGxcghFHZOi1WYXHCjF","BaseParticle",void 0);var Fb,Bb,Gb,Ub,zb,Hb,qb,Vb=i.ccclass,Wb=i.property,Kb=(_b=Vb("BaseParticle"),Lb=Wb(A),_b((Nb=$e((Db=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"sprite",Nb,Me(e)),e.properties=new Mb,e}return Re(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.sprite)throw new Error("BaseParticle: Sprite not found")}},{key:"manualInit",value:function(e,t){this.manager=e;var n=t.tint,i=t.velocityX,a=t.velocityY,o=t.totalRotation,s=t.lifespan,l=t.startAngle,u=t.scale;this.properties.lastChange=0;var c=new r;r.fromHEX(c,n),this.sprite.color=c,this.properties.velocityX=i,this.properties.velocityY=a,this.properties.life=s,this.properties.lifeCurrent=s,this.properties.totalRotation=o,this.node.angle=l,this.node.setScale(u,u,1)}},{key:"manualUpdate",value:function(e){return this.computeVelocity(e),this.node.setPosition(this.node.position.x+this.properties.velocityX*e,this.node.position.y+this.properties.velocityY*e,0),this.node.angle+=this.properties.totalRotation*e/this.properties.life,this.properties.lifeCurrent-=e,this.properties.lifeCurrent<=0}},{key:"computeVelocity",value:function(e){var t=this.properties,n=t.velocityX,i=t.velocityY;i+=this.manager.getGravityY()*e,this.properties.velocityX=n,this.properties.velocityY=i}}]),n}(f)).prototype,"sprite",[Lb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ob=Db))||Ob);n._RF.pop(),n._RF.push({},"b6123+a2K1LoY60oZO9SYKX","StarConfetti",void 0);var jb=i.ccclass,Yb=i.property,Xb=(Fb=jb("StarConfetti"),Bb=Yb([L]),Gb=Yb([L]),Fb((Hb=$e((zb=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"starXFrames",Hb,Me(e)),Xe(e,"starYFrames",qb,Me(e)),e.msPerFrame=.15,e.isYoyo=!1,e.isGravityChanged=!1,e}return Re(n,[{key:"manualInit",value:function(e,t){Ue(_e(n.prototype),"manualInit",this).call(this,e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}},{key:"manualUpdate",value:function(e){var t=Ue(_e(n.prototype),"manualUpdate",this).call(this,e);return this.updateGravity(),this.updateVelocity(),this.updateFrameRate(),this.updateFrames(e),t}},{key:"updateGravity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0;this.properties.velocityX/=3,this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2)){this.properties.velocityX>0?this.properties.velocityX+=B.randomRangeInt(-12,6):this.properties.velocityX+=B.randomRangeInt(-6,12)}}},{key:"updateFrames",value:function(e){if(this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame){this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=4&&(this.isYoyo=!0,this.properties.currentFrame-=1);var t=Math.random()>.5?this.starXFrames:this.starYFrames;this.sprite.spriteFrame=t[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame}}},{key:"updateFrameRate",value:function(){this.properties.lifeCurrent<this.properties.life-2?this.msPerFrame=.15:this.msPerFrame=B.randomRangeInt(300,600)/1e3}}]),n}(Kb)).prototype,"starXFrames",[Bb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qb=$e(zb.prototype,"starYFrames",[Gb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ub=zb))||Ub);n._RF.pop(),n._RF.push({},"9caadUsaKtPEoOe+T2+pqtd","Properties",void 0);var $b,Qb=Re((function e(){Ae(this,e),this.delay=200,this.timeScale=2,this.tints=["#F1D171","#97E1FD","#7765D1","#ED4440","#F9E02A"],this.speedX={min:1583/75,max:1583*.24},this.speedY={min:1139.76,max:1219.76},this.gravityY=-664.86,this.lifespan={min:5,max:8},this.rotate={totalRotation:1080,random:!0},this.scale={min:.6,max:1},this.originGravityY=-664.86}));n._RF.pop(),n._RF.push({},"d1648PsavVBn7B059PS5fj6","BaseEmitter",void 0);var Jb,Zb=(0,i.ccclass)("BaseEmitter")($b=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).properties=new Qb,e}return Re(n,[{key:"getGravityY",value:function(){return this.properties.gravityY}},{key:"setGravityY",value:function(e){this.properties.gravityY=e}}]),n}(f))||$b;n._RF.pop(),n._RF.push({},"654983p4rREVKci1CE8cSJ2","ConfettiEmitter",void 0);var ew,tw,nw,iw,aw,rw,ow,sw,lw,uw,cw,hw=(0,i.ccclass)("ConfettiEmitter")(Jb=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=i.call.apply(i,[this].concat(n))).activeStarConfetti=[],e}return Re(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(n=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bn.loadPrefabAsync("particles/StarConfetti");case 2:this.starConfettiPrefab=e.sent,this.starConfettiPool=new ph((function(){var e=l(t.starConfettiPrefab);return t.node.addChild(e),e.active=!1,e}),0,(function(e){var n=e.getComponent(Xb);n?(t.activeStarConfetti.push(n),e.active=!0):console.error("StarConfetti not found")}),(function(e){e.getComponent(Xb)?e.active=!1:console.error("StarConfetti not found")}),(function(e){e.isValid&&e.destroy()})),this.properties.timeScale=1.5,this.properties.gravityY=688.605,this.properties.lifespan.min=4,this.properties.lifespan.max=6,this.properties.rotate.totalRotation=1800;case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"runEffect",value:(t=Te(Se().mark((function e(t,n,i){var a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.starConfettiPool){e.next=3;break}return e.next=3,this.createConfettiPool();case 3:this.properties.gravityY=this.properties.originGravityY,a=0;case 5:if(!(a<t)){e.next=31;break}if(r=this.starConfettiPool.alloc(),o=r.getComponent(Xb)){e.next=11;break}return console.error("StarConfetti not found"),e.abrupt("return");case 11:if(r.setPosition(n.clone()),s=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],l=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),u=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,c=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,h=this.properties.rotate.random?180*Math.random():0,p=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,d={tint:s,velocityX:l,velocityY:u,lifespan:c,totalRotation:this.properties.rotate.totalRotation,startAngle:h,scale:p},o.manualInit(this,d),f=this.starConfettiPool.alloc(),v=f.getComponent(Xb)){e.next=25;break}return console.error("StarConfetti not found"),e.abrupt("return");case 25:f.setPosition(i.clone()),d.velocityX=-l,v.manualInit(this,d);case 28:a++,e.next=5;break;case 31:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"clearEffect",value:function(){var e,t=je(this.activeStarConfetti);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.starConfettiPool.free(n.node)}}catch(e){t.e(e)}finally{t.f()}this.activeStarConfetti=[]}},{key:"update",value:function(e){var t=this,n=e*this.properties.timeScale,i=[];this.activeStarConfetti.forEach((function(e){e.manualUpdate(n)&&i.push(e)})),i.forEach((function(e){t.starConfettiPool.free(e.node),t.activeStarConfetti.splice(t.activeStarConfetti.indexOf(e),1)}))}}]),a}(Zb))||Jb;n._RF.pop(),n._RF.push({},"78c97IkjeJFQohPZudvcfeS","Ribbon",void 0);var pw,dw,fw,vw,yw,mw=i.ccclass,gw=i.property,bw=(ew=mw("Ribbon"),tw=gw([L]),nw=gw([L]),iw=gw([L]),aw=gw([L]),ew((sw=$e((ow=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"ribbonA",sw,Me(e)),Xe(e,"ribbonB",lw,Me(e)),Xe(e,"ribbonC",uw,Me(e)),Xe(e,"ribbonD",cw,Me(e)),e.useFrames=[],e.msPerFrame=.15,e.isYoyo=!1,e.isGravityChanged=!1,e.points=[],e}return Re(n,[{key:"manualInit",value:function(e,t){Ue(_e(n.prototype),"manualInit",this).call(this,e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=new Array(10).fill(null).map((function(){return{x:0,y:0}}));var i=Math.random();this.useFrames=i<.25?this.ribbonA:i<.5?this.ribbonB:i<.75?this.ribbonC:this.ribbonD,this.sprite.enabled=!1}},{key:"manualUpdate",value:function(e){var t=Ue(_e(n.prototype),"manualUpdate",this).call(this,e);return this.updateFrames(e),this.updatePoints(),this.updateGravity(),this.updateVelocity(),t}},{key:"updateFrames",value:function(e){this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame&&(this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=this.useFrames.length&&(this.isYoyo=!0,this.properties.currentFrame-=1),this.sprite.spriteFrame=this.useFrames[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame)}},{key:"updatePoints",value:function(){if(!this.isGravityChanged){this.points.shift();var e=this.node.worldPosition,t=e.x,n=e.y;this.points.push({x:t,y:n})}}},{key:"updateGravity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0,this.points=[],this.sprite.enabled=!0,this.properties.velocityX/=3;this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function(){if(!this.isGravityChanged){this.properties.lifeCurrent>this.properties.life-1.8?this.properties.velocityX+=B.randomRangeInt(-24,24):this.properties.velocityX>0?this.properties.velocityX+=B.randomRangeInt(-20,12):this.properties.velocityX+=B.randomRangeInt(-12,20)}}},{key:"getGlobalPoints",value:function(){return this.points}},{key:"getColor",value:function(){return this.sprite.color}}]),n}(Kb)).prototype,"ribbonA",[tw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lw=$e(ow.prototype,"ribbonB",[nw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),uw=$e(ow.prototype,"ribbonC",[iw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cw=$e(ow.prototype,"ribbonD",[aw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rw=ow))||rw);n._RF.pop(),n._RF.push({},"f2427J2HhBKdpkcqDn2Vv5H","RibbonEmitter",void 0);var ww,kw,Sw,Ew,Cw,Tw,Aw,xw=i.ccclass,Rw=i.property,Iw=(pw=xw("RibbonEmitter"),dw=Rw(q),pw((yw=$e((vw=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"graphics",yw,Me(e)),e.activeRibbonConfetti=[],e}return Re(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(n=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bn.loadPrefabAsync("particles/Ribbon");case 2:this.ribbonPrefab=e.sent,this.ribbonConfettiPool=new ph((function(){var e=l(t.ribbonPrefab);return t.node.addChild(e),e.active=!1,e}),0,(function(e){var n=e.getComponent(bw);n?(t.activeRibbonConfetti.push(n),e.active=!0):console.error("StarConfetti not found")}),(function(e){e.getComponent(bw)?e.active=!1:console.error("StarConfetti not found")}),(function(e){e.destroy()}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"runEffect",value:(t=Te(Se().mark((function e(t,n,i){var a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ribbonConfettiPool){e.next=3;break}return e.next=3,this.createConfettiPool();case 3:this.properties.gravityY=this.properties.originGravityY,a=0;case 5:if(!(a<t)){e.next=31;break}if(r=this.ribbonConfettiPool.alloc(),o=r.getComponent(bw)){e.next=11;break}return console.error("StarConfetti not found"),e.abrupt("return");case 11:if(r.setPosition(n.clone()),s=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],l=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),u=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,c=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,h=this.properties.rotate.random?180*Math.random():0,p=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,d={tint:s,velocityX:l,velocityY:u,lifespan:c,totalRotation:this.properties.rotate.totalRotation,startAngle:h,scale:p},o.manualInit(this,d),f=this.ribbonConfettiPool.alloc(),v=f.getComponent(bw)){e.next=25;break}return console.error("StarConfetti not found"),e.abrupt("return");case 25:f.setPosition(i.clone()),d.velocityX=-l,v.manualInit(this,d);case 28:a++,e.next=5;break;case 31:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"clearEffect",value:function(){var e,t=je(this.activeRibbonConfetti);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.ribbonConfettiPool.free(n.node)}}catch(e){t.e(e)}finally{t.f()}this.activeRibbonConfetti=[]}},{key:"update",value:function(e){var t=this,n=e*this.properties.timeScale;this.graphics.clear();var i=[];this.activeRibbonConfetti.forEach((function(e){e.manualUpdate(n)&&i.push(e),t.drawGraphics(e.getGlobalPoints(),e.getColor())})),i.forEach((function(e){t.ribbonConfettiPool.free(e.node),t.activeRibbonConfetti.splice(t.activeRibbonConfetti.indexOf(e),1)}))}},{key:"drawGraphics",value:function(e,t){if(this.graphics.node.active){var n,i=je(e);try{for(i.s();!(n=i.n()).done;){if(0===n.value.y)return}}catch(e){i.e(e)}finally{i.f()}if(!(e.length<2)){this.graphics.strokeColor=t;var a=new j(e[0].x,e[0].y,0);a=this.node.inverseTransformPoint(a,a),this.graphics.moveTo(a.x,a.y);for(var r=1;r<e.length;r++)a.x=e[r].x,a.y=e[r].y,a=this.node.inverseTransformPoint(a,a),this.graphics.lineTo(a.x,a.y);this.graphics.stroke()}}}}]),a}(Zb)).prototype,"graphics",[dw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fw=vw))||fw);n._RF.pop(),n._RF.push({},"f7cfcFAL8tBE70g2A0+qMTR","PaperConfetti",void 0);var Pw,_w=i.ccclass,Lw=i.property,Ow=(ww=_w("PaperConfetti"),kw=Lw(hw),Sw=Lw(Iw),ww((Tw=$e((Cw=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).spawnLeftPos=new j(-375,-791.5,0),e.spawnRightPos=new j(375,-791.5,0),Xe(e,"confettiEmitter",Tw,Me(e)),Xe(e,"ribbonEmitter",Aw,Me(e)),e}return Re(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.confettiEmitter)throw new Error("PaperConfetti: ConfettiEmitter not found");if(!this.ribbonEmitter)throw new Error("PaperConfetti: RibbonEmitter not found")}},{key:"runEffect",value:function(){var e=this;this.scheduleOnce((function(){e.confettiEmitter.runEffect(25,e.spawnLeftPos,e.spawnRightPos)}),.2),this.ribbonEmitter.runEffect(20,this.spawnLeftPos,this.spawnRightPos)}},{key:"clearEffect",value:function(){this.unscheduleAllCallbacks(),this.confettiEmitter.clearEffect(),this.ribbonEmitter.clearEffect()}}]),n}(f)).prototype,"confettiEmitter",[kw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aw=$e(Cw.prototype,"ribbonEmitter",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ew=Cw))||Ew);n._RF.pop(),n._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var Dw,Nw,Mw,Fw,Bw,Gw,Uw,zw,Hw,qw,Vw,Ww=i.ccclass,Kw=i.disallowMultiple,jw=GameCore,Yw=jw.Events,Xw=jw.Configs,$w=jw.Utils,Qw=$w.Time,Jw=$w.Valid,Zw=globalThis.game,ek=Zw.ads,tk=Zw.player,nk=Zw.event;Ww("BootScene")(Pw=Kw(Pw=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).processWhenGameSdkStarted=function(){e.setupGameData()},e.processPreloadAssets=function(){e.loadCurrentPlayerTheme().catch((function(e){return console.error("loadCurrentPlayerTheme",e)}))},e.handleShowAdWhenLoadGame=Te(Se().mark((function t(){var n,i,a,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Xw.Ads,i=n.Enabled,a=n.ShowAdOnLoad,i){t.next=3;break}return t.abrupt("return");case 3:if(r=a.Enabled,o=a.DelaySeconds,s=a.PlacementId,r){t.next=6;break}return t.abrupt("return");case 6:if(t.prev=6,!(o>0)){t.next=10;break}return t.next=10,Qw.sleepAsync(1e3*o);case 10:if(l=ek.getAdByPlacementId(s)){t.next=13;break}return t.abrupt("return");case 13:return t.next=15,e.showAdWhenLoadGame(l);case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(6),console.warn("handleShowAdWhenLoadGame failed",t.t0);case 20:return t.prev=20,cv.preloadAds(),t.finish(20);case 23:case"end":return t.stop()}}),t,null,[[6,17,20,23]])}))),e.handlePauseAudio=function(){nk.on(Yw.VISIBILITY_HIDDEN,e.handleMuteAudio),nk.on(Yw.VISIBILITY_VISIBLE,e.handleUnMuteAudio),nk.on(Yw.VISIBILITY_VISIBLE,e.handleForceEngineRunning)},e.handleMuteAudio=function(){Jn.muteAudio(!0)},e.handleUnMuteAudio=function(){ek.isAdFullSizeShowing()||Jn.muteAudio(!1)},e.handleForceEngineRunning=function(){d.resume()},e}return Re(i,[{key:"__preload",value:function(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.handlePauseAudio(),this.processPreloadAssets(),Xw.Core.StartSDKAfterLoadGame||Yl.showLoadingFullScreen(Gs)}},{key:"start",value:function(){this.processCrazyGamesLoadingStop()}},{key:"listenEvents",value:function(){nk.once(Yw.GAME_SDK_STARTED,this.processWhenGameSdkStarted),nk.once(Yw.GAME_READY,this.handleShowAdWhenLoadGame)}},{key:"setupGameData",value:function(){var e=tk.getGameData();if(e){var t=e.totalLevel,n=ke(ke({},e),{},{totalLevel:0===t?80:t});tk.setGameData(n)}}},{key:"loadCurrentPlayerTheme",value:function(){var e=nl.mapOrder,t=e[0],n=tk.getGameData();console.log("loadCurrentPlayerTheme",n);var i=null==n?void 0:n.level;if(!Jw.isNumber(i))return Bn.loadThemeAsync(t.theme);var a,r=je(e);try{for(r.s();!(a=r.n()).done;){var o=a.value;if((i-=o.levelCount)<=0){t=o;break}}}catch(e){r.e(e)}finally{r.f()}return Bn.loadThemeAsync(t.theme)}},{key:"showAdWhenLoadGame",value:(t=Te(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.type,i=t.placementId,e.next=4,ek.loadAdAsync(n,i);case 4:return Jn.muteAudio(!0),e.next=7,ek.showAdAsync(n,i);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("showAdWhenLoadGame failed",e.t0);case 12:return e.prev=12,Jn.muteAudio(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])}))),function(e){return t.apply(this,arguments)})},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}}]),i}(f))||Pw);n._RF.pop(),n._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var ik,ak,rk,ok,sk,lk,uk,ck,hk,pk=i.ccclass,dk=i.property,fk=(Dw=pk("RigidBodyObject"),Nw=dk(E),Mw=dk($),Fw=dk(E),Bw=dk(z),Dw((zw=$e((Uw=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"gravityScale",zw,Me(e)),Xe(e,"linearVelocity",Hw,Me(e)),Xe(e,"bounce",qw,Me(e)),Xe(e,"simulate",Vw,Me(e)),e}return Re(n,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(o).getComponent(s),this.uiTransform=this.node.getComponent(s)}},{key:"update",value:function(e){if(this.simulate){this.applyGravity();var t=this.node.worldPosition.clone();t.add(new j(this.linearVelocity.x*e,this.linearVelocity.y*e,0)),t=this.applyBounce(t),this.node.setWorldPosition(t)}}},{key:"applyForce",value:function(e){this.linearVelocity.add(e)}},{key:"applyGravity",value:function(){var e=new $(0,-9.8*this.gravityScale);this.applyForce(e)}},{key:"applyBounce",value:function(e){var t=this.uiTransform.getBoundingBoxToWorld();t.yMin<0&&(e.y=t.height/2,this.linearVelocity.y*=-this.bounce),t.xMin<0&&(e.x=t.width/2,this.linearVelocity.x*=-1);var n=this.canvas.width;return t.xMax>n&&(e.x=n-t.width/2,this.linearVelocity.x*=-1),e}}]),n}(f)).prototype,"gravityScale",[Nw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Hw=$e(Uw.prototype,"linearVelocity",[Mw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $(0,0)}}),qw=$e(Uw.prototype,"bounce",[Fw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vw=$e(Uw.prototype,"simulate",[Bw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gw=Uw))||Gw);n._RF.pop(),n._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var vk,yk,mk,gk,bk,wk,kk,Sk,Ek,Ck=i.ccclass,Tk=i.property,Ak=i.disallowMultiple,xk=function(){},Rk=(ik=Ck("AnimSkipOverlay"),ak=Tk(D),rk=Tk(D),ok=Tk(p),ik(sk=Ak((uk=$e((lk=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"containerUIOpacity",uk,Me(e)),Xe(e,"maskUIOpacity",ck,Me(e)),Xe(e,"skipButton",hk,Me(e)),e.isOpened=!1,e.currentCallback=xk,e}return Re(a,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"open",value:(n=Te(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.containerUIOpacity.node.active=!0,n=t.onSkip,i=t.opacity,a=void 0===i?255:i,r=t.transitionDuration,o=void 0===r?.2:r,this.maskUIOpacity.opacity=a,e.next=5,this.animateUIOpacity(0,255,o);case 5:this.currentCallback=n,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(Zi,t);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:.2,this.skipButton.interactable=!1,this.currentCallback=xk,e.next=5,this.animateUIOpacity(255,0,t);case 5:this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(ea);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateUIOpacity",value:function(e,t,n){return this.containerUIOpacity.opacity=e,yn.runTweenAsync(S(this.containerUIOpacity).to(n,{opacity:t}))}},{key:"untilClosed",value:function(){var e=this;return!1===this.isOpened?Promise.resolve():new Promise((function(t){e.node.scene.once(ea,t)}))}}]),a}(f)).prototype,"containerUIOpacity",[ak],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ck=$e(lk.prototype,"maskUIOpacity",[rk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hk=$e(lk.prototype,"skipButton",[ok],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sk=lk))||sk)||sk);n._RF.pop(),n._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var Ik,Pk,_k,Lk,Ok,Dk,Nk,Mk,Fk,Bk,Gk,Uk,zk,Hk,qk,Vk,Wk,Kk=i.ccclass,jk=i.property,Yk=GameCore.Utils.Number.getShortNumber,Xk=(vk=Kk("CoinContainer"),yk=jk(u),mk=jk(A),gk=jk(D),vk((kk=$e((wk=function(e){Pe(r,e);var t,n,i,a=Be(r);function r(){var e;Ae(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"coinLabel",kk,Me(e)),Xe(e,"coinIcon",Sk,Me(e)),Xe(e,"explosionCircle",Ek,Me(e)),e.currentCoin=0,e}return Re(r,[{key:"setCoinText",value:function(e){this.coinLabel.string=e}},{key:"handleAddCoinButton",value:function(){Yl.openScreen(Kn.GET_COIN_SCREEN,{quantity:ks})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(Ka.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(i=Te(Se().mark((function e(t){var n,i,a,r,o,s,l;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.coins,void 0!==(a=t.collectionAnimation)&&!1!==this.node.activeInHierarchy){e.next=4;break}return this.setCoins(i),e.abrupt("return");case 4:if(r=a.signal,null===(n=this.animAbortSignal)||void 0===n||n.abort(),this.animAbortSignal=null!=r?r:new qi,!a.animateTextOnly){e.next=12;break}return e.next=10,this.animateCoinText(i,0,r);case 10:return this.setCoins(i),e.abrupt("return");case 12:return o=a.flyDuration,s=a.floatDuration,l=s+o,e.next=17,this.animateCoinText(i,l,r);case 17:this.setCoins(i);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setCoins",value:function(e){this.setCoinText(Yk(e,3)),this.currentCoin=e}},{key:"animateCoinText",value:(n=Te(Se().mark((function e(t,n,i){var a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.currentCoin,e.next=3,yn.waitTweenAsync(n,i);case 3:return Jn.playSound(Hn.COLLECT_COINS),e.next=6,yn.runTweenAsync(S({}).to(1,{},{easing:"quadOut",onUpdate:function(e,n){if(n){var i=Math.round(a+(t-a)*n);r.setCoinText(Yk(i,3))}}}),i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return n.apply(this,arguments)})},{key:"emitExplodeEffect",value:(t=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0),e.next=4,Promise.all([yn.runTweenAsync(S(this.explosionCircle.node).to(.4,{scale:new j(3,3,3)},{easing:"quadOut"}),t),yn.runTweenAsync(S(this.explosionCircle).delay(.2).to(.2,{opacity:0}),t)]);case 4:this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var e;null===(e=this.animAbortSignal)||void 0===e||e.abort()}}]),r}(f)).prototype,"coinLabel",[yk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sk=$e(wk.prototype,"coinIcon",[mk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ek=$e(wk.prototype,"explosionCircle",[gk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bk=wk))||bk);n._RF.pop(),n._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);var $k,Qk,Jk,Zk,eS,tS,nS,iS,aS,rS,oS,sS,lS,uS,cS,hS,pS,dS,fS,vS,yS,mS=i.ccclass,gS=i.property,bS=globalThis.game.player,wS=[1e3,1500];Ik=mS("ItemContainer"),Pk=gS({type:a,group:"Hint"}),_k=gS({type:u,group:"Hint"}),Lk=gS({type:a,group:"Thunder"}),Ok=gS({type:u,group:"Thunder"}),Dk=gS({type:a,group:"Storm"}),Nk=gS({type:u,group:"Storm"}),Mk=gS(R),Ik((Gk=$e((Bk=function(e){Pe(u,e);var t,n,i,a,r,s=Be(u);function u(){var e;Ae(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=s.call.apply(s,[this].concat(n)),"hintNode",Gk,Me(e)),Xe(e,"hintLabel",Uk,Me(e)),e.hintCollection=[],Xe(e,"thunderNode",zk,Me(e)),Xe(e,"thunderLabel",Hk,Me(e)),e.thunderCollection=[],Xe(e,"stormNode",qk,Me(e)),Xe(e,"stormLabel",Vk,Me(e)),e.stormCollection=[],Xe(e,"itemPrefab",Wk,Me(e)),e}return Re(u,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(o).node,this.widget=this.getComponent(C),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(D),this.validateRequiredComponents(),this.listenToEvents()}},{key:"start",value:function(){this.prepareItemCollection()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(Ka.ADD_ITEMS,this.handleAddItems,this)}},{key:"prepareItemCollection",value:function(){for(var e=0;e<9;e++){var t=l(this.itemPrefab),n=l(this.itemPrefab),i=l(this.itemPrefab);t.parent=this.canvas,n.parent=this.canvas,i.parent=this.canvas,t.active=!1,n.active=!1,i.active=!1,this.hintCollection.push(t.getComponent(fk)),this.thunderCollection.push(n.getComponent(fk)),this.stormCollection.push(i.getComponent(fk))}}},{key:"updateStatus",value:function(e){var t=e.items;this.hintLabel.string=`${t.hint}`,this.thunderLabel.string=`${t.thunder}`,this.stormLabel.string=`${t.storm}`}},{key:"show",value:(r=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=255,t=S(this.widget).to(1.5,{right:0},{easing:"quadOut"}),e.next=4,yn.runTweenAsync(t,this.animAbortSignal);case 4:this.widget.right=0;case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"hide",value:(a=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"}),e.next=3,yn.runTweenAsync(t);case 3:this.uiOpacity.opacity=0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"handleAddItems",value:(i=Te(Se().mark((function e(t){var n,i,a,r,o=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.animAbortSignal=null!==(n=t.signal)&&void 0!==n?n:new qi,i=bS.getGameData()){e.next=4;break}return e.abrupt("return");case 4:return this.updateStatus(i),a=this.show(),r=t.items.map((function(e){return o.animateItemCollection(e.item,e.quantity,1.5)})),e.next=9,Promise.all([a].concat(Ve(r)));case 9:return i.items=ke(ke({},i.items),{},{hint:i.items.hint+t.items[0].quantity,thunder:i.items.thunder+t.items[1].quantity,storm:i.items.storm+t.items[2].quantity}),bS.setGameData(i),this.updateStatus(i),e.next=14,this.hide();case 14:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"animateItemCollection",value:(n=Te(Se().mark((function e(t,n,i){var a,r,o=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=this.getItemCollection(t).slice(0,n)).length){e.next=3;break}return e.abrupt("return");case 3:return r=a.map((function(e,n){e.node.active=!0,e.node.position=new j(0,0,e.node.position.z),e.linearVelocity=new $(0,0),e.simulate=!0;var a=ne(Math.PI/3,2*Math.PI/3),r=ne(wS[0],wS[1])*Math.cos(a),s=ne(wS[0],wS[1])*Math.sin(a);e.applyForce(new $(r,s));var l=o.getTargetNode(t);if(l)return e.getComponent(A).spriteFrame=l.getComponent(A).spriteFrame,o.getItemAnimation(e,l,i+.03*n)})),e.next=6,Promise.all(r);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return n.apply(this,arguments)})},{key:"getItemCollection",value:function(e){switch(e){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}},{key:"getTargetNode",value:function(e){switch(e){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}},{key:"getItemAnimation",value:(t=Te(Se().mark((function e(t,n){var i,a,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.length>2&&void 0!==o[2]?o[2]:0,t.node.scale=new j(2,2,2),e.next=4,yn.waitTweenAsync(i,this.animAbortSignal);case 4:return a=t.node.worldPosition.clone(),r=S(t.node).to(1,{scale:n.scale},{onUpdate:function(e,i){if(e&&i){var r=O.cubicIn(i);n&&(t.node.worldPosition=a.lerp(n.worldPosition,r))}},onComplete:function(){t.node.setPosition(0,0),t.node.active=!1}}),e.next=8,yn.runTweenAsync(r,this.animAbortSignal);case 8:t.node.scale=n.scale.clone(),t.node.setPosition(0,0),t.node.active=!1;case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"onDestroy",value:function(){var e;null===(e=this.animAbortSignal)||void 0===e||e.abort()}}]),u}(f)).prototype,"hintNode",[Pk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uk=$e(Bk.prototype,"hintLabel",[_k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zk=$e(Bk.prototype,"thunderNode",[Lk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hk=$e(Bk.prototype,"thunderLabel",[Ok],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qk=$e(Bk.prototype,"stormNode",[Dk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vk=$e(Bk.prototype,"stormLabel",[Nk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wk=$e(Bk.prototype,"itemPrefab",[Mk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fk=Bk));n._RF.pop(),n._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var kS,SS,ES,CS,TS,AS,xS,RS,IS,PS,_S,LS=i.ccclass,OS=i.property,DS=i.disallowMultiple,NS=i.requireComponent,MS=($k=LS("DashboardPage"),Qk=NS(C),Jk=NS(D),Zk=OS({type:a,displayName:"Page's container"}),eS=OS({type:a,displayName:"Placeholder"}),tS=OS({displayName:"Don't load page",tooltip:"Tell the component to not preload the page even if it hasn't loaded yet"}),nS=OS({type:R,displayName:"Page prefab",visible:function(){return!this.hasLoaded}}),iS=OS({displayName:"Darken background"}),aS=OS({type:g,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),rS=OS({displayName:"Use navbar shadow"}),oS=OS({type:g,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),$k(sS=DS(sS=Qk(sS=Jk((uS=$e((lS=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"container",uS,Me(e)),Xe(e,"placeholder",cS,Me(e)),Xe(e,"hasLoaded",hS,Me(e)),Xe(e,"pagePrefab",pS,Me(e)),Xe(e,"darkenBackground",dS,Me(e)),Xe(e,"backgroundOpacity",fS,Me(e)),Xe(e,"useNavbarShadow",vS,Me(e)),Xe(e,"navbarShadowOpacity",yS,Me(e)),e}return Re(a,[{key:"onLoad",value:function(){this.containerUIOpacity=this.container.getComponent(D),this.placeholderUIOpacity=this.placeholder.getComponent(D),this.widgetComponent=this.node.getComponent(C),this.uiOpacity=this.node.getComponent(D),this.validateRequiredComponents();var e=this.container.getComponent(T);this.layoutComponents=e?[e]:[],this.widgetComponents=[this.widgetComponent].concat(Ve(this.container.getComponentsInChildren(C)))}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"updateWidgets",value:function(){this.widgetComponents.forEach((function(e){e.updateAlignment()}))}},{key:"updateLayouts",value:function(){this.layoutComponents.forEach((function(e){e.updateLayout()}))}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasLoaded){e.next=3;break}return e.next=3,this.create();case 3:this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,Qn.trackCurrentPage(this.node.name,!0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return this.hasLoaded}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(t=Te(Se().mark((function e(){var t,n,i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=2;break}return e.abrupt("return");case 2:if(!this.hasLoaded){e.next=4;break}return e.abrupt("return");case 4:return i=l(this.pagePrefab),a=i.getComponentsInChildren(C),(t=this.widgetComponents).push.apply(t,Ve(a)),r=i.getComponentsInChildren(T),(n=this.layoutComponents).push.apply(n,Ve(r)),this.container.addChild(i),e.next=12,yn.waitTweenAsync(0);case 12:this.hasLoaded=!0;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),a}(f)).prototype,"container",[Zk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cS=$e(lS.prototype,"placeholder",[eS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hS=$e(lS.prototype,"hasLoaded",[tS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pS=$e(lS.prototype,"pagePrefab",[nS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dS=$e(lS.prototype,"darkenBackground",[iS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fS=$e(lS.prototype,"backgroundOpacity",[aS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),vS=$e(lS.prototype,"useNavbarShadow",[rS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yS=$e(lS.prototype,"navbarShadowOpacity",[oS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),sS=lS))||sS)||sS)||sS)||sS);n._RF.pop(),n._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var FS,BS,GS,US,zS,HS,qS,VS,WS,KS,jS,YS,XS,$S,QS,JS=i.ccclass,ZS=i.property,eE=(kS=JS("ThemeProgressBar"),SS=ZS(a),ES=ZS(a),CS=ZS(a),TS=ZS(a),kS((RS=$e((xS=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"progressBar",RS,Me(e)),Xe(e,"progressText",IS,Me(e)),Xe(e,"leftCap",PS,Me(e)),Xe(e,"rightCap",_S,Me(e)),e}return Re(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(e,t){e<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var n=this.progressBar.getComponent(Y);if(!n)throw new Error("ThemeProgressBar: progressBarComponent not found");n.progress=e/t;var i=this.progressText.getComponent(u);if(!i)throw new Error("ThemeProgressBar: progressTextComponent not found");i.string=`${e}/${t}`}}]),n}(f)).prototype,"progressBar",[SS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IS=$e(xS.prototype,"progressText",[ES],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PS=$e(xS.prototype,"leftCap",[CS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_S=$e(xS.prototype,"rightCap",[TS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AS=xS))||AS);n._RF.pop(),n._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var tE,nE,iE,aE,rE,oE,sE,lE,uE,cE,hE,pE,dE,fE,vE,yE,mE,gE,bE,wE,kE,SE,EE=i.ccclass,CE=i.disallowMultiple,TE=i.property,AE=[50,160],xE=(FS=EE("LockAnimator"),BS=TE(ae),GS=TE(y),US=TE(P),zS=TE(P),HS=TE(ts),qS=TE({type:g,min:0}),FS(VS=CE((KS=$e((WS=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"floatingParticles",KS,Me(e)),Xe(e,"iconAnimation",jS,Me(e)),Xe(e,"lockClip",YS,Me(e)),Xe(e,"unlockClip",XS,Me(e)),Xe(e,"trailTemplate",$S,Me(e)),Xe(e,"trailCount",QS,Me(e)),e.trails=[],e}return Re(a,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(n=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem(),e.next=4,this.playAnimation(this.unlockClip.name,t);case 4:this.floatingParticles.stopSystem();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var e=this;return Promise.all(this.trails.map((function(t){return yn.runTweenAsync(e.getExplodeTrail(t))})))}},{key:"getExplodeTrail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=ne(0,2*Math.PI),i=ne(AE[0],AE[1])*Math.cos(n),a=ne(AE[0],AE[1])*Math.sin(n),r=new j(i,a,e.node.position.z),o=e.node.scale.clone();return S(e.node).delay(t).call((function(){e.node.setPosition(0,0),e.reset(),e.node.active=!0})).to(.5,{position:r.clone()},{easing:"expoOut"}).to(.5,{scale:new j(0,0,1)},{easing:"expoIn"}).call((function(){e.node.setPosition(0,0),e.node.scale=o,e.reset(),e.node.active=!1}))}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var e=0;e<this.trailCount;e++){var t=l(this.trailTemplate.node);t.setParent(this.node),t.active=!1,this.trails.push(t.getComponent(ts))}}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"playAnimation",value:(t=Te(Se().mark((function e(t,n){var i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||null==n||!n.aborted){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.abrupt("return",new Promise((function(e){i.iconAnimation.once(y.EventType.FINISHED,(function(){e()})),null==n||n.addAbortListener((function(){i.iconAnimation.off(y.EventType.FINISHED),i.iconAnimation.stop(),e()})),i.iconAnimation.play(t)})));case 3:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})}]),a}(f)).prototype,"floatingParticles",[BS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jS=$e(WS.prototype,"iconAnimation",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YS=$e(WS.prototype,"lockClip",[US],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XS=$e(WS.prototype,"unlockClip",[zS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$S=$e(WS.prototype,"trailTemplate",[HS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QS=$e(WS.prototype,"trailCount",[qS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),VS=WS))||VS)||VS);n._RF.pop(),n._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var RE,IE,PE,_E,LE,OE,DE,NE,ME,FE,BE,GE=i.ccclass,UE=i.property,zE={progress:0,max:10,isLocked:!0,themeId:ol.SUMMER,skin:rl},HE=(tE=GE("ThemeBlock"),nE=UE(a),iE=UE(D),aE=UE(a),rE=UE(D),oE=UE(xE),sE=UE(a),lE=UE(A),uE=UE([A]),cE=UE(u),hE=UE(z),tE((fE=$e((dE=function(e){Pe(o,e);var t,n,i,a,r=Be(o);function o(){var e;Ae(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"mask",fE,Me(e)),Xe(e,"nodeUIOpacity",vE,Me(e)),Xe(e,"progressBar",yE,Me(e)),Xe(e,"backgroundUI",mE,Me(e)),Xe(e,"lockAnimator",gE,Me(e)),Xe(e,"themeLoadingRing",bE,Me(e)),Xe(e,"themeSprite",wE,Me(e)),Xe(e,"tileBlockIconSprite",kE,Me(e)),Xe(e,"titleLabel",SE,Me(e)),e.visibilityTween=null,e.isVisible=!1,e.payload=zE,e}return Re(o,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(e){this.payload.isLocked=e,this.updateThemeBlockDisplay()}},{key:"getSkinName",value:function(){return this.payload.skin}},{key:"__preload",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"updateThemeBlockDisplay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zE;this.payload=e;var t=e.progress,n=e.max,i=e.isLocked,a=e.themeId,r=e.skin;this.updateTitle(a),this.updateSkinAsync(r),this.updateThemeAsync(a);var o=this.progressBar.getComponent(eE);if(!o)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=i,this.progressBar.active=!i,this.lockAnimator.node.active=i,i||o.setProgress(t,n)}},{key:"playUnlockAnim",value:(a=Te(Se().mark((function e(t){var n,i,a,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:zE,this.payload=ke(ke({},n),{},{isLocked:!1}),i=n.progress,a=n.max,r=this.progressBar.getComponent(eE)){e.next=6;break}throw new Error("ThemeBlock: progressBarComponent not found");case 6:return this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,r.setProgress(i,a),e.next=12,this.animateUnlockedState(t);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"updateTitle",value:function(e){switch(e){case ol.SUMMER:this.titleLabel.string="Summer";break;case ol.WINTER:this.titleLabel.string="Winter";break;case ol.AUTUMN:this.titleLabel.string="Autumn"}}},{key:"updateSkinAsync",value:(i=Te(Se().mark((function e(t){var n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bn.loadSkinPreviewAsync(t);case 2:if(n=e.sent,this.tileBlockIconSprite){e.next=5;break}return e.abrupt("return");case 5:n.forEach((function(e,t){e&&(i.tileBlockIconSprite[t].spriteFrame=e)}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"updateThemeAsync",value:(n=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Bn.loadThemePreviewAsync(t);case 2:if(n=e.sent,this.themeSprite&&n){e.next=5;break}return e.abrupt("return");case 5:this.themeSprite.spriteFrame=n,this.themeLoadingRing&&(this.themeLoadingRing.active=!1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"animateUnlockedState",value:(t=Te(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.mask.getComponent(D),a=this.progressBar.getComponent(D),i){e.next=4;break}throw new Error("ThemeBlock: maskUIOpacity not found");case 4:if(a){e.next=6;break}throw new Error("ThemeBlock: progressBarUIOpacity not found");case 6:return this.mask.active=!0,i.opacity=null!==(n=i.opacity)&&void 0!==n?n:255,this.progressBar.active=!0,a.opacity=0,e.next=12,this.lockAnimator.unlock(t);case 12:return this.lockAnimator.node.active=!1,e.next=15,Promise.all([yn.runTweenAsync(S(i).to(.25,{opacity:0}),t),yn.runTweenAsync(S(a).to(.25,{opacity:255}),t)]);case 15:this.mask.active=!1,i.opacity=0,a.opacity=255;case 18:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getUITransform",value:function(){return this.uiTransform}},{key:"setVisible",value:function(e){var t;this.isVisible!==e&&(this.isVisible=e,null===(t=this.visibilityTween)||void 0===t||t.stop(),this.visibilityTween=S(this.nodeUIOpacity).to(.05,{opacity:e?255:0}).start())}}]),o}(f)).prototype,"mask",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vE=$e(dE.prototype,"nodeUIOpacity",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yE=$e(dE.prototype,"progressBar",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mE=$e(dE.prototype,"backgroundUI",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gE=$e(dE.prototype,"lockAnimator",[oE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bE=$e(dE.prototype,"themeLoadingRing",[sE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wE=$e(dE.prototype,"themeSprite",[lE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kE=$e(dE.prototype,"tileBlockIconSprite",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SE=$e(dE.prototype,"titleLabel",[cE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(dE.prototype,"isLocked",[hE],Object.getOwnPropertyDescriptor(dE.prototype,"isLocked"),dE.prototype),pE=dE))||pE);n._RF.pop(),n._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var qE,VE=i.ccclass,WE=i.property,KE=globalThis.game.storage,jE=(RE=VE("CollectionsContent"),IE=WE(br),PE=WE(le),_E=WE(ji),LE=WE({type:E,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),RE((NE=$e((DE=function(e){Pe(r,e);var t,n,i,a=Be(r);function r(){var e;Ae(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=a.call.apply(a,[this].concat(n))).animateThemeTabUnlock=null,Xe(e,"panelAnimator",NE,Me(e)),Xe(e,"themeScrollView",ME,Me(e)),Xe(e,"contentOpacity",FE,Me(e)),e.themeBlocks=[],e.preservedScrollPosition=new $,Xe(e,"offsetFromTopOfScrollView",BE,Me(e)),e.updateBlocksVisibility=function(){var t=e.uiTransform.getBoundingBoxToWorld(),n=t.yMax,i=t.yMin;e.themeBlocks.forEach((function(e){var t=e.getUITransform().getBoundingBoxToWorld(),a=t.yMax,r=t.yMin,o=a<i||r>n;e.setVisible(!o)}))},e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return Re(r,[{key:"__preload",value:function(){var e,t;this.uiTransform=this.getComponent(s),this.themeBlocks=null!==(e=null===(t=this.themeScrollView.content)||void 0===t?void 0:t.getComponentsInChildren(HE))&&void 0!==e?e:[],this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.themeScrollView.node.on(le.EventType.SCROLLING,this.updateBlocksVisibility),this.node.scene.on(Ka.HIDE_UI,this.hideContent),this.node.scene.on(Ka.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.themeScrollView.node.off(le.EventType.SCROLLING,this.updateBlocksVisibility),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(Ka.HIDE_UI,this.hideContent),this.node.scene.off(Ka.SHOW_UI,this.showContent)}},{key:"init",value:function(e){0!==e.length&&this.getThemeTabs().forEach((function(t,n){return t.updateThemeBlockDisplay(e[n])}))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(e){var t=this,n=KE.getStorageData("collection","animateMapPackUnlock"),i=KE.getStorageData("collection","lastMapPack");e.forEach((function(e,a){var r=e.skin,o=e.progress,s=e.max,l=e.isLocked;if(o<s&&!l&&n&&i!==a+1)return t.animateThemeTabUnlock=e,KE.setStorageData("collection","animateMapPackUnlock",!1),KE.setStorageData("collection","lastMapPack",a+1),void t.setProgressToThemeTab(r,ke(ke({},e),{},{isLocked:!0}));t.setProgressToThemeTab(r,e)}))}},{key:"shouldAnimateThemeTabUnlock",value:function(){return null!==this.animateThemeTabUnlock}},{key:"playThemeTabUnlockAnim",value:(i=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.animateThemeTabUnlock){e.next=2;break}return e.abrupt("return");case 2:if(void 0!==(n=this.findThemeTab(this.animateThemeTabUnlock.skin))){e.next=5;break}throw new Error("CollectionsContent: ThemeTab not found");case 5:return e.next=7,n.playUnlockAnim(t,ke(ke({},this.animateThemeTabUnlock),{},{isLocked:!0}));case 7:this.animateThemeTabUnlock=null;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(n=Te(Se().mark((function e(t,n){var i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.findThemeTab(t)){e.next=3;break}return e.abrupt("return");case 3:return a=i.node.position.y,r=-a-this.offsetFromTopOfScrollView,e.next=7,this.scrollToOffset(new $(0,r),2,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"scrollToOffset",value:(t=Te(Se().mark((function e(t,n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.themeScrollView.scrollToOffset(t,n),e.next=3,yn.waitTweenAsync(n,i);case 3:i.aborted&&(this.themeScrollView.stopAutoScroll(),this.themeScrollView.scrollToOffset(t,0));case 4:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"setProgressToThemeTab",value:function(e,t){var n=this.findThemeTab(e);if(void 0===n)throw new Error("CollectionsContent: ThemeTab not found");n.updateThemeBlockDisplay(t)}},{key:"findThemeTab",value:function(e){return this.getThemeTabs().find((function(t){return t.getSkinName()===e}))}},{key:"getThemeTabs",value:function(){return this.themeScrollView.content.getComponentsInChildren(HE)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),r}(f)).prototype,"panelAnimator",[IE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=$e(DE.prototype,"themeScrollView",[PE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FE=$e(DE.prototype,"contentOpacity",[_E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BE=$e(DE.prototype,"offsetFromTopOfScrollView",[LE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),OE=DE))||OE);n._RF.pop(),n._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var YE,XE,$E,QE,JE,ZE,eC,tC,nC,iC,aC,rC,oC,sC,lC,uC,cC,hC,pC,dC,fC,vC,yC,mC,gC,bC,wC,kC=(0,i.ccclass)("CollectionsPage")(qE=function(e){Pe(r,e);var t,n,i,a=Be(r);function r(){var e;Ae(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=a.call.apply(a,[this].concat(n))).payload=null,e}return Re(r,[{key:"setPayload",value:function(e){this.payload=e}},{key:"mount",value:(i=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,Bn.loadPrefabAsync(Rn.COLLECTIONS_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,Ue(_e(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.themeContent){e.next=12;break}if(this.themeContent=this.container.getComponentInChildren(jE),this.themeContent){e.next=12;break}throw new Error("No theme content found");case 12:this.payload&&this.themeContent.init(this.payload);case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Te(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(_e(r.prototype),"transitionIn",this).call(this);case 2:return this.themeContent.restoreScrollPosition(),this.themeContent.updateBlocksVisibility(),this.themeContent.enableUIAnimator(),this.themeContent.listenEvents(),t=yn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){i.node.scene.emit(Ka.SHOW_UI,{onComplete:function(){e()}})})),e.next=10,Promise.all([t,n]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(_e(r.prototype),"transitionOut",this).call(this);case 2:return this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents(),e.next=6,new Promise((function(e){t.node.scene.emit(Ka.HIDE_UI,{onComplete:function(){e()}})}));case 6:this.themeContent.disableUIAnimator(),this.themeContent.unlistenEvents();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(MS))||qE;n._RF.pop(),n._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var SC,EC,CC,TC,AC,xC,RC,IC,PC,_C,LC,OC,DC,NC=i.ccclass,MC=i.property,FC=i.disallowMultiple,BC=i.requireComponent,GC=(YE=NC("PageManagerItem"),XE=MC(MS),$E=MC({type:ue(Rs)}),YE((ZE=$e((JE=Re((function e(){Ae(this,e),Xe(this,"page",ZE,this),Xe(this,"pageType",eC,this)}))).prototype,"page",[XE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eC=$e(JE.prototype,"pageType",[$E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QE=JE))||QE),UC=(tC=NC("PageManager"),nC=BC(s),iC=MC({type:D,displayName:"Background Mask",group:"Background Mask"}),aC=MC({type:E,displayName:"Transition duration",group:"Background Mask"}),rC=MC({type:E,displayName:"Transition delay",group:"Background Mask"}),oC=MC({type:D,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),sC=MC({type:E,displayName:"Transition duration",group:"Nav Bar Shadow"}),lC=MC({type:E,displayName:"Transition delay",group:"Nav Bar Shadow"}),uC=MC({type:[GC]}),cC=MC({type:ue(Rs)}),tC(hC=FC(hC=nC((dC=$e((pC=function(e){Pe(o,e);var t,n,i,a,r=Be(o);function o(){var e;Ae(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"backgroundMask",dC,Me(e)),Xe(e,"backgroundMaskTransitionDuration",fC,Me(e)),Xe(e,"backgroundMaskTransitionDelay",vC,Me(e)),Xe(e,"navBarShadow",yC,Me(e)),Xe(e,"navBarShadowTransitionDuration",mC,Me(e)),Xe(e,"navBarShadowTransitionDelay",gC,Me(e)),Xe(e,"pageItems",bC,Me(e)),Xe(e,"currentScreen",wC,Me(e)),e}return Re(o,[{key:"unmountAndHideAll",value:function(){var e=this;this.pageItems.forEach((function(t){var n=t.page;t.pageType!==e.currentScreen&&(n.unmount(),n.hide())}))}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"updateCollectionsContentPayload",value:function(e){var t=this.getPage(Rs.collections);t&&t instanceof kC&&t.setPayload(e)}},{key:"navigate",value:(a=Te(Se().mark((function e(t,n,i){var a,r,o,s,l,u,c,h,p,d,f,v,y,m,g;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.from,r=t.to,null!==a){e.next=15;break}return(o=this.getPage(this.currentScreen)).show(),e.next=6,o.mount();case 6:return e.next=8,null==n?void 0:n(o);case 8:return this.node.scene.emit(As),e.next=11,o.transitionIn();case 11:return e.next=13,null==i?void 0:i(o);case 13:return this.currentScreen=r,e.abrupt("return");case 15:if(a===this.currentScreen){e.next=17;break}throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");case 17:if(s=this.getPage(this.currentScreen),(l=this.getPage(r))&&s){e.next=21;break}throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");case 21:if(u=this.uiTransform.width,c=this.getPageIndex(a),h=this.getPageIndex(r),p=Math.min(c,h),d=Math.max(c,h),f=(d-p)*u,v=c<h?1:-1,(y=this.pageItems.slice(p,d+1)).forEach((function(e,t){var n=e.page;n.show(),n.getWidget().enabled=!1,n.node.position=new j((t+p-c)*u,n.node.position.y,n.node.position.z)})),m=!1,l.hasLoadedPage()){e.next=36;break}return m=!0,Yl.showLoadingScreen(),e.next=36,yn.waitTweenAsync(.5);case 36:return e.next=38,l.mount();case 38:return e.next=40,null==n?void 0:n(l);case 40:return this.node.scene.emit(As),e.next=43,Promise.all([s.transitionOut(),this.transition(f,v,y),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,l.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,l.getNavbarShadow())]);case 43:return(g=l.getWidget()).enabled=!0,g.left=0,g.right=0,l.updateWidgets(),l.updateLayouts(),y.forEach((function(e){e.pageType!==r&&(e.page.unmount(),e.page.hide())})),this.currentScreen=r,e.next=53,l.transitionIn();case 53:return e.next=55,null==i?void 0:i(l);case 55:m&&Yl.closeLoadingScreen();case 56:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"getPage",value:function(e){var t=this.getPageIndex(e);return-1!==t?this.pageItems[t].page:null}},{key:"handleBackgroundMask",value:(i=Te(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(t,{opacity:n}).start());case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"handleNavBarShadow",value:(n=Te(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(t,{opacity:n}).start());case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getPageIndex",value:function(e){return this.pageItems.findIndex((function(t){return t.pageType===e}))}},{key:"transition",value:(t=Te(Se().mark((function e(t,n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(i.map((function(e){var i=e.page;return yn.runTweenAsync(S(i.node).to(.5,{position:new j(i.node.position.x-t*n,i.node.position.y,i.node.position.z)},{easing:O.quintInOut}))})));case 2:case"end":return e.stop()}}),e)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiTransform)throw new Error("PageManager requires UITransform component");if(!this.backgroundMask)throw new Error("PageManager requires background mask")}}]),o}(f)).prototype,"backgroundMask",[iC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fC=$e(pC.prototype,"backgroundMaskTransitionDuration",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),vC=$e(pC.prototype,"backgroundMaskTransitionDelay",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),yC=$e(pC.prototype,"navBarShadow",[oC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mC=$e(pC.prototype,"navBarShadowTransitionDuration",[sC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),gC=$e(pC.prototype,"navBarShadowTransitionDelay",[lC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),bC=$e(pC.prototype,"pageItems",[uC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wC=$e(pC.prototype,"currentScreen",[cC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rs.home}}),hC=pC))||hC)||hC)||hC);n._RF.pop(),n._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var zC,HC,qC,VC,WC,KC,jC=i.ccclass,YC=i.property,XC=(SC=jC("StarProgressBar"),EC=YC(Qr),CC=YC(u),TC=YC(g),AC=YC(g),xC=YC(m),SC((PC=$e((IC=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"progressBar",PC,Me(e)),Xe(e,"progressLabel",_C,Me(e)),Xe(e,"current",LC,Me(e)),Xe(e,"total",OC,Me(e)),Xe(e,"separator",DC,Me(e)),e}return Re(i,[{key:"setRange",value:function(e,t){this.total=t,this.current=e,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string=`${this.current}${this.separator}${this.total}`}},{key:"animateTo",value:(t=Te(Se().mark((function e(t,n,i){var a,r,o,s,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Math.min(t,this.total)/this.total,r=this.current,o=1,s=S(this.progressBar).to(3,{progress:a},{easing:"quadOut",onUpdate:function(e,n){n&&(l.current=r+Math.floor((t-r)*n),null==i||i(l.current),l.current===r-o&&(o++,S(l.progressLabel.node).to(.05,{scale:new j(1.2,1.2,1.2)}).to(.05,{scale:j.ONE}).start()),l.updateProgressLabel())}}),null==n||n.addAbortListener((function(){l.current=t,l.updateProgress()})),e.next=7,yn.runTweenAsync(s,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(f)).prototype,"progressBar",[EC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_C=$e(IC.prototype,"progressLabel",[CC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LC=$e(IC.prototype,"current",[TC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OC=$e(IC.prototype,"total",[AC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DC=$e(IC.prototype,"separator",[xC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RC=IC))||RC);n._RF.pop(),n._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var $C,QC,JC,ZC,eT,tT,nT,iT,aT,rT,oT,sT=i.ccclass,lT=i.property,uT=(zC=sT("EventButton"),HC=lT({type:ue(rg)}),qC=lT(z),zC((KC=$e((WC=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"eventType",KC,Me(e)),e._isAvailable=!1,e}return Re(n,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(e){this._isAvailable=e,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(xs,{type:this.eventType})}},{key:"setAnimationState",value:function(e){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),Ue(_e(n.prototype),"setAnimationState",this).call(this,e)}}]),n}(Bi)).prototype,"eventType",[HC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rg.STAR_CHEST}}),$e(WC.prototype,"isAvailable",[qC],Object.getOwnPropertyDescriptor(WC.prototype,"isAvailable"),WC.prototype),VC=WC))||VC);n._RF.pop(),n._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var cT,hT,pT,dT,fT,vT,yT,mT,gT,bT,wT,kT,ST,ET,CT,TT,AT,xT,RT=i.ccclass,IT=i.property,PT=globalThis.game.player,_T=($C=RT("DashboardHeader"),QC=IT({type:XC,displayName:"Progress bar",group:"Star Chest"}),JC=IT({type:uT,displayName:"Button Component",group:"Star Chest"}),ZC=IT({type:P,displayName:"Default Rest animation",group:"Star Chest"}),eT=IT({type:P,displayName:"Special Rest animation",group:"Star Chest"}),$C((iT=$e((nT=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"starProgressBar",iT,Me(e)),Xe(e,"chestButton",aT,Me(e)),Xe(e,"defaultRestAnimation",rT,Me(e)),Xe(e,"specialRestAnimation",oT,Me(e)),e.handleStarsUpdateEvent=function(t){var n,i;void 0!==(t=null!==(n=t)&&void 0!==n?n:null===(i=PT.getGameData())||void 0===i?void 0:i.stars)&&(e.starProgressBar.setRange(t,20),e.updateStarChestButtonAnimation(t))},e}return Re(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),V.on(Es,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function(){V.off(Es,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function(e){this.handleStarsUpdateEvent(e)}},{key:"updateStarChestButtonAnimation",value:function(e){this.chestButton.isAvailable=e>=20}},{key:"validateRequiredComponents",value:function(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}}]),n}(f)).prototype,"starProgressBar",[QC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aT=$e(nT.prototype,"chestButton",[JC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rT=$e(nT.prototype,"defaultRestAnimation",[ZC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oT=$e(nT.prototype,"specialRestAnimation",[eT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tT=nT))||tT);n._RF.pop(),n._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var LT,OT,DT,NT,MT,FT,BT,GT,UT,zT,HT,qT,VT=i.ccclass,WT=i.property,KT=i.executeInEditMode,jT=(cT=VT("JourneyLevelAvatar"),hT=WT({type:A,displayName:"Avatar node"}),pT=WT(a),dT=WT(y),fT=WT(D),vT=WT({type:P,group:"Animation"}),yT=WT({type:P,group:"Animation"}),mT=WT({type:P,group:"Animation"}),gT=WT({type:L,displayName:"Avatar sprite"}),cT(bT=KT((kT=$e((wT=function(e){Pe(r,e);var t,n,i,a=Be(r);function r(){var e;Ae(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"sprite",kT,Me(e)),Xe(e,"lockIcon",ST,Me(e)),Xe(e,"animation",ET,Me(e)),Xe(e,"opacity",CT,Me(e)),Xe(e,"flashAnimation",TT,Me(e)),Xe(e,"unlockAnimation",AT,Me(e)),Xe(e,"spawnAnimation",xT,Me(e)),e}return Re(r,[{key:"avatarSprite",get:function(){var e,t;return null!==(e=null===(t=this.sprite)||void 0===t?void 0:t.spriteFrame)&&void 0!==e?e:null},set:function(e){this.sprite&&(this.sprite.spriteFrame=e)}},{key:"playUnlockAnimation",value:(i=Te(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c,h;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.playAnimation(this.unlockAnimation),n=this.lockIcon.position.x,i=this.lockIcon.position.y,a=[45,135],r=(Math.random()*(a[1]-a[0])+a[0])*(Math.PI/180),o=this.lockIcon.position.x+150*Math.cos(r),s=this.lockIcon.position.y+150*Math.sin(r),l=i-400,u=yn.runTweenAsync(S(this.lockIcon).delay(.3).to(.2,{position:new j(o,s,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new j(o,l,this.lockIcon.position.z)},{easing:"cubicIn"})),c=[0,360],h=yn.runTweenAsync(S(this.lockIcon).delay(.3).to(.6,{eulerAngles:new j(0,0,Math.random()*(c[1]-c[0])*(o>n?-1:1))},{easing:"sineOut"})),e.next=14,Promise.all([t,u,h]);case 14:this.lockIcon.position=new j(n,i,this.lockIcon.position.z),this.lockIcon.eulerAngles=new j(0,0,0);case 16:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"playFlashAnimation",value:(n=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.y,n=this.playAnimation(this.flashAnimation),i=yn.runTweenAsync(S(this.node).to(.1,{position:new j(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new j(this.node.position.x,t,this.node.position.z)},{easing:"sineIn"})),e.next=5,Promise.all([n,i]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(j.ZERO)}},{key:"playAnimation",value:(t=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runAnimationAsync(this.animation,t.name);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var e=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some((function(t){return null!==t&&(t.name===e.flashAnimation.name||t.name===e.unlockAnimation.name||t.name===e.spawnAnimation.name)})))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),r}(f)).prototype,"sprite",[hT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ST=$e(wT.prototype,"lockIcon",[pT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ET=$e(wT.prototype,"animation",[dT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CT=$e(wT.prototype,"opacity",[fT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TT=$e(wT.prototype,"flashAnimation",[vT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AT=$e(wT.prototype,"unlockAnimation",[yT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xT=$e(wT.prototype,"spawnAnimation",[mT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(wT.prototype,"avatarSprite",[gT],Object.getOwnPropertyDescriptor(wT.prototype,"avatarSprite"),wT.prototype),bT=wT))||bT)||bT);n._RF.pop(),n._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var YT,XT,$T,QT,JT,ZT,eA,tA,nA,iA,aA,rA,oA,sA,lA,uA,cA,hA,pA,dA,fA,vA,yA=i.ccclass,mA=i.property,gA=i.executeInEditMode,bA=(LT=yA("JourneyProgressBar"),OT=mA(Qr),DT=mA(u),NT=mA(D),MT=mA(g),FT=mA(g),BT=mA(m),LT(GT=gA((zT=$e((UT=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"progressBar",zT,Me(e)),Xe(e,"progressLabel",HT,Me(e)),Xe(e,"labelUIOpacity",qT,Me(e)),e.currentProgress=10,e.totalProgress=10,e.labelSeparator="/",e}return Re(i,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(e){this.labelSeparator=e,this.updateProgress()}},{key:"setRange",value:function(e,t){this.totalProgress=t,e>t&&(e=t),this.currentProgress=e,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(t=Te(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.nextCurr,i=t.nextTotal,a=t.numberOfProgressBar,r=void 0===a?0:a,o=t.onProgressBarPassed,s=t.signal,l=n/i,u=S(this.labelUIOpacity).to(.2,{opacity:0}),c=S(this.labelUIOpacity).to(.2,{opacity:255}),h=r<1?1:Math.sqrt(r)+1,p=0===r?l:r+l,d=1,f=S({curr:this.progressBar.progress}).to(h,{curr:p},{easing:"sineInOut",onUpdate:function(e){if(void 0!==e){var t=e.curr;v.progressBar.progress=t%1,t>d&&(d=0===t?1:Math.ceil(t),null==o||o())}}}),e.next=10,Promise.all([yn.runTweenAsync(u,s),yn.runTweenAsync(f,s)]);case 10:return this.currentProgress=n,this.totalProgress=i,this.updateProgress(),e.next=15,yn.runTweenAsync(c,s);case 15:return this.labelUIOpacity.opacity=255,e.abrupt("return",l);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string=`${this.currentProgress}${this.separator}${this.totalProgress}`}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(f)).prototype,"progressBar",[OT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HT=$e(UT.prototype,"progressLabel",[DT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qT=$e(UT.prototype,"labelUIOpacity",[NT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(UT.prototype,"total",[MT],Object.getOwnPropertyDescriptor(UT.prototype,"total"),UT.prototype),$e(UT.prototype,"current",[FT],Object.getOwnPropertyDescriptor(UT.prototype,"current"),UT.prototype),$e(UT.prototype,"separator",[BT],Object.getOwnPropertyDescriptor(UT.prototype,"separator"),UT.prototype),GT=UT))||GT)||GT);n._RF.pop(),n._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var wA,kA,SA,EA,CA,TA,AA,xA,RA,IA,PA,_A,LA,OA,DA,NA,MA,FA=i.ccclass,BA=i.property,GA=(YT=FA("ProgressConfiguration"),XT=BA(L),$T=BA(m),YT((ZT=$e((JT=Re((function e(){Ae(this,e),Xe(this,"avatar",ZT,this),Xe(this,"themeId",eA,this)}))).prototype,"avatar",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eA=$e(JT.prototype,"themeId",[$T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QT=JT))||QT),UA=(tA=FA("JourneyProgressAnimator"),nA=BA(bA),iA=BA(a),aA=BA(A),rA=BA(jT),oA=BA(GA),sA=BA({type:E,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),tA((cA=$e((uA=function(e){Pe(o,e);var t,n,i,a,r=Be(o);function o(){var e;Ae(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"progressBar",cA,Me(e)),Xe(e,"currentLevelAvatarNode",hA,Me(e)),Xe(e,"currentLevelAvatar",pA,Me(e)),Xe(e,"nextLevelAvatar",dA,Me(e)),Xe(e,"progressConfigs",fA,Me(e)),Xe(e,"nextLevelYOffset",vA,Me(e)),e.isAnimating=!1,e}return Re(o,[{key:"setRange",value:function(e,t){this.progressBar.setRange(e,t)}},{key:"animateTo",value:(a=Te(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAnimating){e.next=3;break}return console.warn("JourneyProgressAnimator: animation already in progress"),e.abrupt("return",Promise.resolve());case 3:if(this.isAnimating=!0,t===this.progressBar.current){e.next=7;break}return e.next=7,this.progressBar.animateTo({nextCurr:t,nextTotal:this.progressBar.total,signal:n});case 7:this.isAnimating=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"animateToNextLevel",value:(i=Te(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.nextCurr,i=t.nextTotal,a=t.mapsPassed,r=t.signal,!this.isAnimating){e.next=4;break}return console.warn("JourneyProgressAnimator: animation already in progress"),e.abrupt("return");case 4:if(this.isAnimating=!0,0!=(o=a.length-2)){e.next=11;break}return e.next=9,this.progressBar.animateTo({nextCurr:n,nextTotal:i,signal:r});case 9:return this.isAnimating=!1,e.abrupt("return");case 11:return e.next=13,this.animateTargetAvaToCenter(r);case 13:return s=function(){if(1===l)return h.nextLevelAvatar.playUnlockAnimation(),void(l+=1);if(l>=a.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");h.nextLevelAvatar.playFlashAnimation(),h.setNextLevelAvatar(a[l].theme),l+=1},l=1,e.next=17,this.progressBar.animateTo({signal:r,nextCurr:n,nextTotal:i,numberOfProgressBar:o,onProgressBarPassed:s});case 17:return e.next=19,this.animateTargetAvaToPrev(r);case 19:u=a[a.length-1].theme,c=a[a.length-2].theme,this.setCurrentLevelAvatar(c),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=this.getSpriteFrameByThemeId(u),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1;case 27:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(n=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z),e.next=3,yn.runTweenAsync(S(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t);case 3:this.nextLevelAvatar.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(t=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.currentLevelAvatarNode.position.clone(),e.next=3,yn.runTweenAsync(S(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t);case 3:this.nextLevelAvatar.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:function(e){var t=this.progressConfigs.find((function(t){return t.themeId===e}));if(!t)throw new Error(`JourneyProgressController: config not found for themeId ${e}`);return t.avatar}},{key:"setAvatar",value:function(e,t){var n=this.getSpriteFrameByThemeId(e);t instanceof jT?t.avatarSprite=n:t.spriteFrame=n}},{key:"setCurrentLevelAvatar",value:function(e){this.setAvatar(e,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(e){this.setAvatar(e,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),o}(f)).prototype,"progressBar",[nA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hA=$e(uA.prototype,"currentLevelAvatarNode",[iA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pA=$e(uA.prototype,"currentLevelAvatar",[aA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dA=$e(uA.prototype,"nextLevelAvatar",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fA=$e(uA.prototype,"progressConfigs",[oA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vA=$e(uA.prototype,"nextLevelYOffset",[sA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lA=uA))||lA);n._RF.pop(),n._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var zA,HA,qA,VA,WA,KA,jA,YA,XA,$A,QA,JA,ZA,ex,tx,nx=i.ccclass,ix=i.property,ax=globalThis.game.storage,rx=(wA=nx("HomeContent"),kA=ix(u),SA=ix(p),EA=ix(UA),CA=ix(br),TA=ix(_T),AA=ix(D),xA=ix(Xk),wA((PA=$e((IA=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"playButtonLabel",PA,Me(e)),Xe(e,"playButton",_A,Me(e)),Xe(e,"journeyProgressAnimator",LA,Me(e)),Xe(e,"panelAnimator",OA,Me(e)),Xe(e,"dashboardHeader",DA,Me(e)),Xe(e,"overlayDuringAnim",NA,Me(e)),Xe(e,"coinContainer",MA,Me(e)),e}return Re(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(Cs)}},{key:"setPlayButtonLabel",value:function(e){this.playButtonLabel.string=e}},{key:"updateStarProgress",value:function(e){this.dashboardHeader.updateStarProgress(e)}},{key:"setUnlockProgress",value:function(e){this.setProgress(e),this.updateCurrentMapInStorage(e)}},{key:"prepareUnlockProgressAnimation",value:function(e,t,n,i){var a=this;if(e.id===t.id){this.setProgress(ke(ke({},t),{},{progress:e.progress})),this.updateCurrentMapInStorage(t);var r=t.progress;return Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.playButton.interactable=!1,e.next=3,a.showOwnOverlay(i);case 3:return e.next=5,a.journeyProgressAnimator.animateTo(r,i);case 5:return e.next=7,a.hideOwnOverlay(i);case 7:a.playButton.interactable=!0;case 8:case"end":return e.stop()}}),e)})))}return this.setProgress(e),this.updateCurrentMapInStorage(t),Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.playButton.interactable=!1,e.next=3,a.showOwnOverlay(i);case 3:return e.next=5,a.journeyProgressAnimator.animateToNextLevel({nextCurr:t.progress,nextTotal:t.max,mapsPassed:n,signal:i});case 5:return e.next=7,a.hideOwnOverlay(i);case 7:a.playButton.interactable=!0;case 8:case"end":return e.stop()}}),e)})))}},{key:"hideOwnOverlay",value:(n=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.overlayDuringAnim).to(.3,{opacity:0}),t);case 2:this.overlayDuringAnim.opacity=0;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"showOwnOverlay",value:(t=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.overlayDuringAnim).to(.3,{opacity:150}),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setProgress",value:function(e){var t=e.currentTheme,n=e.nextTheme,i=e.progress,a=e.max;this.journeyProgressAnimator.setCurrentLevelAvatar(t),this.journeyProgressAnimator.setNextLevelAvatar(null!=n?n:t),this.journeyProgressAnimator.setRange(i,a)}},{key:"updateCurrentMapInStorage",value:function(e){ax.setStorageData("dashboard","animateToCurrentLevel",!1),ax.setStorageData("dashboard","lastMapPayload",e)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),a}(f)).prototype,"playButtonLabel",[kA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_A=$e(IA.prototype,"playButton",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LA=$e(IA.prototype,"journeyProgressAnimator",[EA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OA=$e(IA.prototype,"panelAnimator",[CA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DA=$e(IA.prototype,"dashboardHeader",[TA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NA=$e(IA.prototype,"overlayDuringAnim",[AA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MA=$e(IA.prototype,"coinContainer",[xA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RA=IA))||RA);n._RF.pop(),n._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var ox,sx,lx,ux,cx,hx,px,dx,fx,vx,yx,mx,gx,bx=i.ccclass,wx=i.property,kx=globalThis.game.ads,Sx=(zA=bx("NavManager"),HA=wx(a),qA=wx(a),VA=wx(Tn),WA=wx(z),KA=wx({type:C,visible:function(){return this.useOffsetWhenSAB}}),jA=wx({type:E,visible:function(){return this.useOffsetWhenSAB}}),zA(($A=$e((XA=function(e){Pe(s,e);var t,n,i,a,r,o=Be(s);function s(){var e;Ae(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=o.call.apply(o,[this].concat(n)),"selectorNode",$A,Me(e)),Xe(e,"selectedButtonNode",QA,Me(e)),Xe(e,"autoLayout",JA,Me(e)),Xe(e,"useOffsetWhenSAB",ZA,Me(e)),Xe(e,"offsetWidget",ex,Me(e)),Xe(e,"offsetWhenSAB",tx,Me(e)),e.navButtons=[],e.isNavigating=!1,e}return Re(s,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var e;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(e=this.selectedButtonNode)||void 0===e?void 0:e.getComponentInChildren("NavButton"),St.lazyValidateProperties(this)}},{key:"start",value:function(){this.useOffsetWhenSAB&&(kx.getSafeAreaBottom(Li.cssSizeToWorldSize(1))>0&&(this.offsetWidget.bottom=this.offsetWhenSAB))}},{key:"select",value:(r=Te(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNavigating){e.next=2;break}return e.abrupt("return");case 2:if(this.navButtons.includes(t)){e.next=4;break}throw new Error("NavManager: Button not found");case 4:if(t!==this.selectedButton){e.next=6;break}return e.abrupt("return");case 6:if(!t.isWIP){e.next=9;break}return this.handleWIPButton(),e.abrupt("return");case 9:return this.isNavigating=!0,this.node.scene.emit(Ts,{from:this.selectedButton.buttonType,to:t.buttonType}),e.abrupt("return",new Promise((function(e){n.node.scene.once(As,(function(){var i=n.selectedButton.deselect();n.autoLayout.selectedIndex=n.navButtons.indexOf(t),n.selectedButton=t;var a=n.autoLayout.getSelectedWorldX()-t.getSelectedWorldDistanceX(),r=n.playSelectorAnimation(a),o=t.select();Promise.all([i,o,r]).then((function(){n.isNavigating=!1,e()}))}))})));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(a=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNavigating){e.next=2;break}return e.abrupt("return");case 2:if(![Rs.store].includes(t.buttonType)){e.next=5;break}return this.handleWIPButton(),e.abrupt("return");case 5:return e.next=7,this.select(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"selectByType",value:(i=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.navButtons.find((function(e){return e.buttonType===t}))){e.next=3;break}throw new Error("NavManager: Button not found");case 3:return e.next=5,this.selectUsingSceneTransition(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"handleWIPButton",value:function(){Yl.openScreen(Kn.STAR_CHEST_SCREEN)}},{key:"selectDefaultNavBtn",value:(n=Te(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentButton&&this.navButtons.includes(this.currentButton)){e.next=2;break}throw new Error("NavManager: Button not found");case 2:return t=this.currentButton.buttonType,this.node.scene.emit(Ts,{from:null,to:t}),e.abrupt("return",new Promise((function(e){n.node.scene.once(As,(function(){n.autoLayout.selectedIndex=n.navButtons.indexOf(n.currentButton);var t=n.navButtons.map((function(e){return e===n.currentButton?e.select(!1):e.deselect(!1,!0)})),i=n.autoLayout.getSelectedWorldX()-n.currentButton.getSelectedWorldDistanceX();n.selectorNode.worldPosition=new j(i,n.selectorNode.worldPosition.y,0),Promise.all(t).then((function(){e()}))}))})));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playSelectorAnimation",value:(t=Te(Se().mark((function e(t){var n,i,a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(1,1,1),i=this.selectorNode.worldPosition.clone(),a=new j(1.2*n.x,.8*n.y,1),e.next=7,yn.runTweenAsync(S(this.selectorNode).to(.3,{worldPosition:new j(t,i.y,0)},{easing:"quintInOut",onUpdate:function(e,t){if(void 0!==t){var i=r.calculateCurrentSquashScale(n,a,t);r.selectorNode.scale=i}}}));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.navButtons.forEach((function(t){var n=t.getComponentInChildren(p);n&&(n.interactable=!e)}))}},{key:"calculateCurrentSquashScale",value:function(e,t,n){var i=this.splitIntoSquashRatio(n);return e.clone().lerp(t,i)}},{key:"splitIntoSquashRatio",value:function(e){return e<.5?2*e:1-2*(e-.5)}}]),s}(f)).prototype,"selectorNode",[HA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QA=$e(XA.prototype,"selectedButtonNode",[qA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JA=$e(XA.prototype,"autoLayout",[VA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZA=$e(XA.prototype,"useOffsetWhenSAB",[WA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ex=$e(XA.prototype,"offsetWidget",[KA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tx=$e(XA.prototype,"offsetWhenSAB",[jA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YA=XA))||YA);n._RF.pop(),n._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var Ex,Cx,Tx,Ax,xx,Rx=i.ccclass,Ix=i.disallowMultiple,Px=i.property,_x=globalThis.game,Lx=_x.event,Ox=_x.storage,Dx=_x.player,Nx=_x.leaderboard,Mx=GameCore.Events,Fx=GameCore.Match.Modes,Bx=GameCore.Configs.DailyRewards,Gx=GameCore.Utils,Ux=Gx.Time,zx=Gx.Json;ox=Rx("DashboardScene"),sx=Px(Pb),lx=Px(Sx),ux=Px(zn),cx=Px(UC),hx=Px(Rk),ox(px=Ix((fx=$e((dx=function(e){Pe(l,e);var t,n,i,a,r,o,s=Be(l);function l(){var e;Ae(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=s.call.apply(s,[this].concat(n)),"coinManager",fx,Me(e)),Xe(e,"navManager",vx,Me(e)),Xe(e,"bgComp",yx,Me(e)),Xe(e,"pageManager",mx,Me(e)),Xe(e,"pageAnimSkipOverlay",gx,Me(e)),e.firstNavigation=!0,e.isFirstNavToCollections=!0,e.playBgAnim=Te(Se().mark((function t(){var n,i,a,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(i=Ox.getStorage("dashboard"))){t.next=3;break}throw new Error("DashboardScene: dashboardStorage not found");case 3:if(a=null!==(n=i.animateToCurrentLevel)&&void 0!==n&&n,r=ke({},i.lastMapPayload),o=dl.getCurrentMapProgress(),s=r.currentTheme===o.currentTheme&&r.nextTheme===o.nextTheme,l=o.currentTheme,a&&!s){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,yn.waitTweenAsync(2);case 12:return t.prev=12,t.next=15,e.bgComp.animateToNextTheme(l);case 15:t.next=19;break;case 17:t.prev=17,t.t0=t.catch(12);case 19:case"end":return t.stop()}}),t,null,[[12,17]])}))),e.handlePlayButtonPress=Te(Se().mark((function t(){var n,i,a,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Cl.startMatchAsync(Fx.SINGLE);case 3:i=dl.getCurrentMapProgress(),a=null!==(n=Dx.getGameData())&&void 0!==n?n:{},r=a.level,o=void 0===r?1:r,e.updateCurrentMapInStorage(i),Ox.setStorageData("collection","lastMapPack",i.id),Ox.setStorageData("collection","animateMapPackUnlock",!1),s=Ox.getStorage("leaderboard_content"),l=s.lastTabOpened,e.getPlayerLeader(l).then((function(e){if(e){var t=e.score,n=e.rank;Ox.setStorageData("leaderboard_content","previousScore",t),Ox.setStorageData("leaderboard_content","previousRank",n)}})),Dl.switchScene(Us,{level:o}),t.next=17;break;case 13:return t.prev=13,t.t0=t.catch(0),console.error(t.t0),t.abrupt("return");case 17:case"end":return t.stop()}}),t,null,[[0,13]])}))),e.onNavigate=function(){var t=Te(Se().mark((function t(n){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.firstNavigation&&(e.firstNavigation=!1,e.pageManager.unmountAndHideAll()),t.t0=n.to,t.next=t.t0===Rs.store?4:t.t0===Rs.collections?10:t.t0===Rs.tournaments?13:t.t0===Rs.leaderboard?16:t.t0===Rs.home?19:22;break;case 4:return e.navManager.setIgnoreInput(),t.next=7,e.pageManager.navigate(n);case 7:return e.handleNavigateToStore(),e.navManager.setIgnoreInput(!1),t.abrupt("break",23);case 10:return t.next=12,e.onNavigateToCollections(ke(ke({},n),{},{to:Rs.collections}));case 12:return t.abrupt("break",23);case 13:return t.next=15,e.onNavigateToTournaments(n);case 15:return t.abrupt("break",23);case 16:return t.next=18,e.onNavigateToLeaderboard(ke(ke({},n),{},{to:Rs.leaderboard}));case 18:return t.abrupt("break",23);case 19:return t.next=21,e.handleNavigateToHome(n);case 21:return t.abrupt("break",23);case 22:throw new Error("DashboardScene: Unhandled page name");case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleEventButtonPress=function(e){switch(e.type){case rg.STAR_CHEST:Yl.openScreen(Kn.STAR_CHEST_SCREEN);break;case rg.BALLOON:Yl.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}},e}return Re(l,[{key:"__preload",value:function(){this.panelAnimationController=this.getComponent(hr),this.validateRequiredComponents(),this.listenNavigationEvents(),this.listenDashboardEvents(),this.panelAnimationController.init()}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(Ts,this.onNavigate)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(Cs,this.handlePlayButtonPress),this.node.scene.on(xs,this.handleEventButtonPress)}},{key:"onLoad",value:function(){this.coinManager.init(this.pageAnimSkipOverlay),dl.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(dl.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var e,t=(null!==(e=Dx.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;n=0===n?1:n,Dx.setGameData({level:n})}},{key:"start",value:function(){Dx.getPlayerSetting("music")&&Jn.playMusic(),this.playBgAnim(),this.navManager.selectDefaultNavBtn(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function(){Dl.preloadGameScene()}},{key:"initBgComp",value:function(){var e,t=Ox.getStorage("dashboard");if(null==t)throw new Error("DashboardScene: dashboardStorage not found");var n=null!==(e=t.animateToCurrentLevel)&&void 0!==e&&e,i=ke({},t.lastMapPayload),a=dl.getCurrentMapProgress(),r=i.currentTheme===a.currentTheme&&i.nextTheme===a.nextTheme,o=a.currentTheme;n&&!r?this.bgComp.setCurrentTheme(i.currentTheme):this.bgComp.setCurrentTheme(o)}},{key:"getPlayerLeader",value:(o=Te(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="global"==t?Os:Ds){e.next=3;break}return e.abrupt("return",null);case 3:return i=Dx.getPlayerId(),e.next=6,Nx.getLeadersByPlayerIdsAsync(n,[i]);case 6:if(0!==(a=e.sent).length){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",a[0]);case 10:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(e){Ox.setStorageData("dashboard","animateToCurrentLevel",!1),Ox.setStorageData("dashboard","lastMapPayload",e)}},{key:"updateVolumeBackgroundMusic",value:function(){Jn.turnUpMusic()}},{key:"checkDailyRewardsOpenable",value:function(){var e=Dx.getPlayerData().dailyRewarded,t=e.logDays,n=void 0===t?[]:t,i=e.lastRewarded,a=void 0===i?0:i;if(n.length>Bx.MaxDays)return!0;if(Bx.MockTime>0&&Date.now()-a>=1e3*Bx.MockTime)return!0;return!Ux.isToday(a)}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"handleNavigateToStore",value:function(){}},{key:"onNavigateToCollections",value:(r=Te(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),n=dl.getCollectionUnlockProgress(),i=this.getCurrentUnlockingTheme(),e.next=5,this.pageManager.navigate(t,(function(e){return(a=e.getContainer().getComponentInChildren(jE)).updateUnlockedProgress(n),Promise.resolve()}));case 5:if(void 0!==a){e.next=7;break}throw new Error("CollectionsContent not found");case 7:if(r=new qi,!(o=a.shouldAnimateThemeTabUnlock())){e.next=12;break}return e.next=12,this.pageAnimSkipOverlay.open({onSkip:function(){return r.abort()},opacity:200});case 12:if(!this.isFirstNavToCollections||null===i){e.next=16;break}return e.next=15,a.scrollToCurrentUnlockingTheme(i.skin,r);case 15:this.isFirstNavToCollections=!1;case 16:return e.next=18,a.playThemeTabUnlockAnim(r);case 18:if(!o){e.next=21;break}return e.next=21,this.pageAnimSkipOverlay.close();case 21:r.abort(),this.navManager.setIgnoreInput(!1);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onNavigateToTournaments",value:(a=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t);case 3:this.navManager.setIgnoreInput(!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"onNavigateToLeaderboard",value:(i=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t);case 3:this.navManager.setIgnoreInput(!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setHomeDataAndGetNavAnim",value:function(){var e,t,n,i,a,r=this,o=this.pageManager.getPage(Rs.home).getContainer().getComponentInChildren(rx);this.coinManager.setTargetContainer(o.getCoinContainer());var s=`Level ${null!==(e=null===(t=Dx.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:1}`;o.setPlayButtonLabel(s),this.coinManager.emitCoinAmount();var l=null!==(n=null===(i=Dx.getGameData())||void 0===i?void 0:i.stars)&&void 0!==n?n:0;o.updateStarProgress(l);var u=Ox.getStorage("dashboard");if(null==u)throw new Error("DashboardScene: dashboardStorage not found");var c=null!==(a=u.animateToCurrentLevel)&&void 0!==a&&a,h=ke({},u.lastMapPayload),p=ke({},dl.getCurrentMapProgress());if(Ox.getStorage("tournament").animateTournamentLeader)return o.setUnlockProgress(p),Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.navManager.selectByType(Rs.tournaments);case 2:case"end":return e.stop()}}),e)})));if(zx.encode(h)===zx.encode(p))o.setUnlockProgress(p);else if(c){var d=nl.mapOrder.findIndex((function(e){return e.id===h.id})),f=nl.mapOrder.findIndex((function(e){return e.id===p.id})),v=d===f;if(-1===d||-1===f)throw new Error("DashboardScene: map not found");
//! safe guard against dev tools time travel
if(!(d>f)){var y=nl.mapOrder.slice(d,f+2),m=new qi,g=o.prepareUnlockProgressAnimation(h,p,y,m);return Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.pageAnimSkipOverlay.open({onSkip:function(){return m.abort()},opacity:150});case 2:return e.next=4,g();case 4:if(m.aborted||v){e.next=7;break}return e.next=7,r.navManager.selectByType(Rs.collections);case 7:return e.next=9,r.pageAnimSkipOverlay.close();case 9:case"end":return e.stop()}}),e)})))}o.setUnlockProgress(p)}else o.setUnlockProgress(p)}},{key:"handleNavigateToHome",value:(n=Te(Se().mark((function e(t){var n,i,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t,Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=a.setHomeDataAndGetNavAnim();case 1:case"end":return e.stop()}}),e)}))));case 3:return this.navManager.setIgnoreInput(!1),e.next=6,this.tryOpenDailyRewardsScreen();case 6:return e.next=8,this.coinManager.untilFinishesCollectAnim();case 8:return e.next=10,this.pageAnimSkipOverlay.untilClosed();case 10:return e.next=12,null===(n=i)||void 0===n?void 0:n();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"tryOpenDailyRewardsScreen",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkDailyRewardsOpenable()){e.next=2;break}return e.abrupt("return");case 2:return Yl.openScreen(Kn.DAILY_REWARDS_SCREEN),e.abrupt("return",new Promise((function(e){Lx.on(Mx.CLOSED_SCREEN,(function t(n){n.screenName===jn[Kn.DAILY_REWARDS_SCREEN]&&(e(),Lx.off(Mx.CLOSED_SCREEN,t))}))})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getCurrentUnlockingTheme",value:function(){var e=dl.getCollectionUnlockProgress();if(0===e.length)return null;var t,n=e[0],i=je(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.isLocked||(n=a)}}catch(e){i.e(e)}finally{i.f()}return n}}]),l}(f)).prototype,"coinManager",[sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vx=$e(dx.prototype,"navManager",[lx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yx=$e(dx.prototype,"bgComp",[ux],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mx=$e(dx.prototype,"pageManager",[cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gx=$e(dx.prototype,"pageAnimSkipOverlay",[hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),px=dx))||px);n._RF.pop(),n._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var Hx,qx=i.ccclass,Vx=i.property,Wx=globalThis.game.player,Kx=GameCore.Utils.Number.getShortNumber;Ex=qx("HomePage"),Cx=Vx({type:u,group:"Placeholders"}),Ex((xx=$e((Ax=function(e){Pe(o,e);var t,n,i,a,r=Be(o);function o(){var e;Ae(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"coinLabel",xx,Me(e)),e}return Re(o,[{key:"__preload",value:function(){var e;null===(e=Ue(_e(o.prototype),"__preload",this))||void 0===e||e.call(this),this.validateOwnRequiredComponents(),this.listenToCoinUpdateEvent()}},{key:"listenToCoinUpdateEvent",value:function(){this.node.scene.on(Ka.COIN_CHANGED,this.updateplaceholderCoins,this)}},{key:"updateplaceholderCoins",value:(a=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.coinLabel.string=Kx(t.coins,3);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"mount",value:(i=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(_e(o.prototype),"mount",this).call(this);case 2:if(this.homeContent){e.next=6;break}if(this.homeContent=this.container.getComponentInChildren(rx),this.homeContent){e.next=6;break}throw new Error("HomePage: homeContent not found");case 6:i=null!==(t=null===(n=Wx.getGameData())||void 0===n?void 0:n.coins)&&void 0!==t?t:0,this.updateplaceholderCoins({coins:i});case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(_e(o.prototype),"transitionIn",this).call(this);case 2:this.homeContent.enableUIAnimator();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.homeContent.disableUIAnimator(),e.next=3,Ue(_e(o.prototype),"transitionOut",this).call(this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateOwnRequiredComponents",value:function(){if(!this.coinLabel)throw new Error("HomePage: coinLabel not found")}}]),o}(MS)).prototype,"coinLabel",[Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tx=Ax));n._RF.pop(),n._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var jx,Yx,Xx,$x,Qx,Jx,Zx,eR,tR,nR,iR,aR,rR,oR,sR,lR,uR,cR,hR,pR,dR=(0,i.ccclass)("LeaderboardIsEmpty")(Hx=function(e){Pe(i,e);var t,n=Be(i);function i(){return Ae(this,i),n.apply(this,arguments)}return Re(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(D),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"show",value:(t=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=255,t=this.node.position.clone(),(n=S(this.node)).to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)}),(i=S(this.node).repeat(2,n)).to(.05,{position:t}),e.next=9,yn.runTweenAsync(i);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),i}(f))||Hx;n._RF.pop(),n._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var fR,vR,yR,mR,gR,bR,wR,kR=i.ccclass,SR=i.property,ER=i.requireComponent,CR=globalThis.game.analytics,TR=(jx=kR("SwitchButton"),Yx=ER([p,y]),Xx=SR(z),$x=SR(a),Qx=SR(a),Jx=SR(z),Zx=SR({visible(){return this.useSound},type:Vn}),eR=SR(z),tR=SR({visible(){return this.useDesktopHover},type:P}),nR=SR({visible(){return this.useDesktopHover},type:P}),jx(iR=Yx((rR=$e((aR=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"enable",rR,Me(e)),Xe(e,"nodeOn",oR,Me(e)),Xe(e,"nodeOff",sR,Me(e)),Xe(e,"useSound",lR,Me(e)),Xe(e,"soundKey",uR,Me(e)),Xe(e,"useDesktopHover",cR,Me(e)),Xe(e,"mouseEnterClip",hR,Me(e)),Xe(e,"mouseLeaveClip",pR,Me(e)),e.isMouseLeaved=!1,e.onMouseEnter=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved=!1,e.animationComponent.play(e.mouseEnterClip.name))},e.onMouseLeave=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved||(e.isMouseLeaved=!0,e.animationComponent.play(e.mouseLeaveClip.name)))},e}return Re(n,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(p),this.animationComponent=this.getComponent(y),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var e=this.animationComponent.clips.map((function(e){return null==e?void 0:e.name})).filter((function(e){return null!=e&&"string"==typeof e}));this.useDesktopHover&&(e.includes(this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),e.includes(this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(CR.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&Jn.playSound(Wn[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(e){this.node.active&&this.updateStatus(e)}},{key:"updateStatus",value:function(e){return this.enable===e||(this.onMouseLeave(null),this.enable=e,this.nodeOn.active=e,this.nodeOff.active=!e),this.enable}}]),n}(f)).prototype,"enable",[Xx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),oR=$e(aR.prototype,"nodeOn",[$x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sR=$e(aR.prototype,"nodeOff",[Qx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lR=$e(aR.prototype,"useSound",[Jx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),uR=$e(aR.prototype,"soundKey",[Zx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vn[Hn.BUTTON_CLICK]}}),cR=$e(aR.prototype,"useDesktopHover",[eR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),hR=$e(aR.prototype,"mouseEnterClip",[tR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pR=$e(aR.prototype,"mouseLeaveClip",[nR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iR=aR))||iR)||iR);n._RF.pop(),n._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var AR,xR,RR,IR,PR,_R=i.ccclass,LR=i.property,OR=globalThis.game.analytics,DR=(fR=_R("Tabs"),vR=LR(TR),yR=LR(TR),fR((bR=$e((gR=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"tabWorld",bR,Me(e)),Xe(e,"tabFriends",wR,Me(e)),e}return Re(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}},{key:"setInteractableButtons",value:function(e){this.tabWorld.getComponent(p).interactable=e,this.tabFriends.getComponent(p).interactable=e}},{key:"updateStatus",value:function(e){this.tabWorld.setEnabled("global"===e),this.tabFriends.setEnabled("friends"===e)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),OR.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:Qn.getCurrentPage()}),this.node.scene.emit(sg.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),OR.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:Qn.getCurrentPage()}),this.node.scene.emit(sg.FRIENDS_TAB_SELECTED)}}]),n}(f)).prototype,"tabWorld",[vR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wR=$e(gR.prototype,"tabFriends",[yR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mR=gR))||mR);n._RF.pop(),n._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var NR,MR,FR,BR,GR,UR,zR,HR,qR,VR,WR,KR,jR,YR,XR,$R,QR,JR,ZR,eI,tI,nI,iI,aI,rI,oI,sI,lI,uI,cI,hI,pI,dI,fI,vI,yI,mI,gI,bI,wI,kI,SI=i.ccclass,EI=i.disallowMultiple,CI=i.property,TI=(AR=SI("LeaderSkeleton"),xR=CI(a),AR(RR=EI((PR=$e((IR=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"container",PR,Me(e)),e}return Re(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(D),this.validateRequiredComponents()}},{key:"hide",value:(n=Te(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Te(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,i=this.container.position.clone(),this.container.position=new j(i.x,i.y-100,i.z),(a=S(this.node).delay(t)).to(.2,{scale:j.ONE},{easing:"cubicOut"}),(r=S(this.container).delay(t)).to(.2,{position:i},{easing:"cubicOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),e.next=13,Promise.all([yn.runTweenAsync(a,n),yn.runTweenAsync(r,n),yn.runTweenAsync(o,n)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(f)).prototype,"container",[xR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RR=IR))||RR)||RR);n._RF.pop(),n._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var AI,xI,RI,II,PI,_I,LI,OI,DI,NI,MI,FI,BI,GI=i.ccclass,UI=i.property,zI=(NR=GI("Leader"),MR=UI(u),FR=UI(D),BR=UI({type:a,group:"Container"}),GR=UI({type:A,group:"Background"}),UR=UI({type:L,group:"Background"}),zR=UI({type:A,group:"Rank"}),HR=UI({type:u,group:"Rank"}),qR=UI({type:L,group:"Rank"}),VR=UI({type:L,group:"Rank"}),WR=UI({type:L,group:"Rank"}),KR=UI({type:L,group:"Rank"}),jR=UI({type:A,group:"Avatar"}),YR=UI({type:D,group:"Avatar"}),XR=UI({type:A,group:"Score"}),$R=UI({type:u,group:"Score"}),QR=UI({type:L,group:"Score"}),JR=UI({type:D,group:"Score"}),ZR=UI({type:D}),eI=UI({type:s}),NR((iI=$e((nI=function(e){Pe(l,e);var t,n,i,a,o,s=Be(l);function l(){var e;Ae(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=s.call.apply(s,[this].concat(n)),"nameLabel",iI,Me(e)),Xe(e,"nameOpacity",aI,Me(e)),Xe(e,"container",rI,Me(e)),Xe(e,"background",oI,Me(e)),Xe(e,"highlightBackground",sI,Me(e)),Xe(e,"rankSprite",lI,Me(e)),Xe(e,"rankLabel",uI,Me(e)),Xe(e,"goldRank",cI,Me(e)),Xe(e,"silverRank",hI,Me(e)),Xe(e,"bronzeRank",pI,Me(e)),Xe(e,"highlightRank",dI,Me(e)),Xe(e,"avatar",fI,Me(e)),Xe(e,"avatarOpacity",vI,Me(e)),Xe(e,"scoreBackground",yI,Me(e)),Xe(e,"scoreLabel",mI,Me(e)),Xe(e,"highlightScoreBackground",gI,Me(e)),Xe(e,"scoreOpacity",bI,Me(e)),Xe(e,"uiOpacity",wI,Me(e)),Xe(e,"uiTransform",kI,Me(e)),e}return Re(l,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e,t){this.updateBackground(e),this.updateRank(e,t),this.resetPhoto(),this.updateUsername(e),this.updateScore(e)}},{key:"updateBackground",value:function(e){this.background.spriteFrame=e.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(e,t){var n=e.rank;if(this.rankLabel.string!==n.toString()){this.rankLabel.string=t&&n>t?`${t}+`:n.toString(),this.rankSprite.spriteFrame=this.defaultRank;var i=new r(pg);switch(e.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,i=new r(fg)),n){case 1:this.rankSprite.spriteFrame=this.goldRank,i=new r(lg);break;case 2:this.rankSprite.spriteFrame=this.silverRank,i=new r(ug);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,i=new r(cg)}this.rankLabel.shadowColor=i,this.rankLabel.outlineColor=i}}},{key:"setPhoto",value:function(e){e&&this.node.active&&(e.packable=!0,this.avatar.spriteFrame=e)}},{key:"resetPhoto",value:(o=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.defaultAvatar){e.next=7;break}return e.next=3,Bn.loadSpriteFrameAsync("images/avatar-bg/spriteFrame");case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return");case 6:this.defaultAvatar=t;case 7:this.avatar.spriteFrame=this.defaultAvatar;case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"updateUsername",value:function(e){this.nameLabel.string=e.name,this.nameLabel.color=new r(e.isHighlight?dg:hg)}},{key:"updateScore",value:function(e){var t=Math.floor(e.score);this.scoreLabel.string=GameCore.Utils.Number.getShortNumber(t,7);var n=this.scoreLabel.getComponent(u);n.outlineColor=new r(e.isHighlight?fg:pg),n.shadowColor=new r(e.isHighlight?fg:pg),this.scoreBackground.spriteFrame=e.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(a=Te(Se().mark((function e(t,n){var i,a,r,o,s,l=this,u=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u.length>2&&void 0!==u[2]?u[2]:.3,this.node.scale=new j(.8,.8,.8),this.setOpacity(0),a=this.container.position.clone(),this.container.position=new j(a.x,a.y-100,a.z),(r=S(this.node).delay(n)).to(i,{scale:j.ONE},{easing:"elasticOut"}),(o=S(this.container).delay(n)).to(i,{position:a},{easing:"backOut"}),(s=S(this.uiOpacity).delay(n)).to(i,{opacity:255},{easing:"cubicOut",onUpdate:function(){l.nameOpacity.opacity=l.uiOpacity.opacity,l.scoreOpacity.opacity=l.uiOpacity.opacity,l.avatarOpacity.opacity=l.uiOpacity.opacity}}),t.addAbortListener((function(){l.node.scale=j.ONE,l.container.position=a,l.uiOpacity.opacity=255,l.avatar.node.active=!0})),e.next=14,Promise.all([yn.runTweenAsync(r,t),yn.runTweenAsync(o,t),yn.runTweenAsync(s,t)]);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(i=Te(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=S(this.node).to(n,{worldPosition:t},{easing:"quadOut"}),e.next=3,yn.runTweenAsync(i);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"runScaleAnimation",value:(n=Te(Se().mark((function e(t,n,i){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=S(this.node).to(i,{scale:new j(n,n,n)},{easing:"backOut"}),e.next=3,yn.runTweenAsync(a,t);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return n.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(t=Te(Se().mark((function e(t,n,i,a,r){var o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=S({}).to(r,{},{easing:"quartOut",onUpdate:function(e,r){if(r){var o=Math.floor(t+(n-t)*r),l=Math.floor(i+(a-i)*r);s.updateRank({rank:o,isHighlight:!0}),s.updateScore({score:l,isHighlight:!0})}}}),e.next=3,yn.runTweenAsync(o);case 3:case"end":return e.stop()}}),e)}))),function(e,n,i,a,r){return t.apply(this,arguments)})},{key:"setOpacity",value:function(e){this.uiOpacity.opacity=e,this.nameOpacity.opacity=e,this.scoreOpacity.opacity=e,this.avatarOpacity.opacity=e}}]),l}(f)).prototype,"nameLabel",[MR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aI=$e(nI.prototype,"nameOpacity",[FR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rI=$e(nI.prototype,"container",[BR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oI=$e(nI.prototype,"background",[GR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sI=$e(nI.prototype,"highlightBackground",[UR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lI=$e(nI.prototype,"rankSprite",[zR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uI=$e(nI.prototype,"rankLabel",[HR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cI=$e(nI.prototype,"goldRank",[qR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hI=$e(nI.prototype,"silverRank",[VR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pI=$e(nI.prototype,"bronzeRank",[WR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dI=$e(nI.prototype,"highlightRank",[KR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fI=$e(nI.prototype,"avatar",[jR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vI=$e(nI.prototype,"avatarOpacity",[YR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yI=$e(nI.prototype,"scoreBackground",[XR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mI=$e(nI.prototype,"scoreLabel",[$R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gI=$e(nI.prototype,"highlightScoreBackground",[QR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bI=$e(nI.prototype,"scoreOpacity",[JR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wI=$e(nI.prototype,"uiOpacity",[ZR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kI=$e(nI.prototype,"uiTransform",[eI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tI=nI))||tI);n._RF.pop(),n._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var HI,qI,VI,WI,KI,jI,YI,XI,$I,QI,JI,ZI,eP,tP,nP,iP,aP,rP=i.ccclass,oP=i.property,sP=globalThis.game,lP=sP.player,uP=sP.frameCapture,cP=(AI=rP("Leaders"),xI=oP(R),RI=oP(a),II=oP(T),PI=oP(s),_I=oP(g),AI((DI=$e((OI=function(e){Pe(u,e);var t,n,i,a,r,o=Be(u);function u(){var e;Ae(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=o.call.apply(o,[this].concat(n)),"leaderPrefab",DI,Me(e)),Xe(e,"inactiveNodeContainer",NI,Me(e)),Xe(e,"layout",MI,Me(e)),Xe(e,"viewport",FI,Me(e)),Xe(e,"maxLeader",BI,Me(e)),e.cachedPhotos=new Map,e.leaderData=[],e.leaderPoolArray=[],e.playerLeader=null,e.isHidden=!0,e}return Re(u,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.batchNodes=this.getComponents(us),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=lP.getPlayerId();for(var e=0;e<this.maxLeader;e++){var t=this.createLeader();this.leaderPoolArray.push(t)}var n=this.leaderPoolArray[0].uiTransform.contentSize;this.leaderContentHeight=n.height+this.layout.spacingY}},{key:"createLeader",value:function(){var e=l(this.leaderPrefab);return this.addLeaderToInactiveNode(e),e.getComponent(zI)}},{key:"updateData",value:(r=Te(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.playerLeader=null,this.isHidden=!1,this.leaderData=t,this.leaderData.sort((function(e,t){return t.score-e.score})),null!=lP){e.next=6;break}throw new Error("Player is not defined");case 6:return this.batchNodes.every((function(e){return e.enabled=!0})),e.next=9,Promise.all(this.leaderData.map((function(e,t){var i=e.playerId,a=e.photo,r=e.score,o=e.name,s=n.currentPlayerId===i;n.leaderData[t].rank=t+1;var l=n.maxLeader-1;if(!(t>=l)||s){var u=s&&t>l-1?n.leaderPoolArray[l]:n.leaderPoolArray[t];return n.layout.node.addChild(u.node),u.setOpacity(0),s&&(n.playerLeader=u),u.updateInfo({isHighlight:s,name:o,photo:a,rank:t+1,score:r},l),n.getAndSetLeaderPhoto({playerId:i,url:a,leader:u})}})));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getAndSetLeaderPhoto",value:(a=Te(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.playerId,i=t.url,a=t.leader,"default"!==i){e.next=3;break}return e.abrupt("return");case 3:if(!this.cachedPhotos.has(n)){e.next=6;break}return a.setPhoto(this.cachedPhotos.get(n)),e.abrupt("return");case 6:return e.prev=6,e.next=9,this.loadAvatarImage(i,85,85,n);case 9:if(r=e.sent){e.next=12;break}return e.abrupt("return");case 12:o=L.createWithImage(r),this.cachedPhotos.set(n,o),a.setPhoto(o),e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(6),!(e.t0 instanceof DOMException&&"AbortError"===e.t0.name)){e.next=22;break}return console.info("Leaders: getAndSetLeaderPhoto was aborted"),e.abrupt("return");case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[6,17]])}))),function(e){return a.apply(this,arguments)})},{key:"removeLeaders",value:function(){var e=this;this.isHidden=!0,this.getActiveLeaders().forEach((function(t){t.resetPhoto(),e.addLeaderToInactiveNode(t.node)})),this.batchNodes.every((function(e){return e.enabled=!1}))}},{key:"getActiveLeaders",value:function(){var e=this;return this.leaderPoolArray.filter((function(t){return t.node.parent===e.layout.node}))}},{key:"getActiveLeaderChildren",value:function(){return this.layout.getComponentsInChildren(zI)}},{key:"showLeaders",value:(i=Te(Se().mark((function e(t){var n,i,a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isHidden){e.next=2;break}return e.abrupt("return");case 2:if(!((n=this.getActiveLeaders()).length<1)){e.next=5;break}return e.abrupt("return");case 5:return i=Math.ceil(this.viewport.contentSize.height/this.leaderContentHeight),a=Math.min(n.length,i),e.next=10,Promise.all(n.map(function(){var e=Te(Se().mark((function e(n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.isHidden){e.next=2;break}return e.abrupt("return");case 2:if(!(i<a)){e.next=5;break}return e.next=5,n.runShowUpAnimation(t,.1*i,.3);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"runUpdateLeadersRankAnimation",value:(n=Te(Se().mark((function e(t,n){var i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=null!=t?t:0,a=null!=n?n:this.leaderData.length,a=Math.min(a,100),r=this.getActiveLeaderChildren(),o=this.leaderContentHeight,s=[],l=i;l<a;l++)r[l].updateRank({rank:l+1,isHighlight:!1}),u=r[l].node.worldPosition.clone(),s.push(r[l].runWorldPositionAnimation(u.add3f(0,-o,0),.25));return e.next=9,Promise.all(s);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"getPlayerLeader",value:function(){return this.playerLeader}},{key:"getLeaderByRank",value:function(e){return this.getActiveLeaders()[e-1]||null}},{key:"getLeaderDataByRank",value:function(e){return this.leaderData[e-1]||null}},{key:"updateVisibility",value:function(){var e=this.viewport.getBoundingBoxToWorld(),t=e.yMax,n=e.yMin;this.getActiveLeaders().forEach((function(e){var i=e.uiTransform;if(void 0!==i){var a=i.getBoundingBoxToWorld(),r=a.yMax,o=a.yMin,s=r<n||o>t;e.setOpacity(s?0:255)}}))}},{key:"loadAvatarImage",value:(t=Te(Se().mark((function e(t,n,i,a){var r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,uP.captureAsync({width:n,height:i,name:"LeaderAvatar",renderOptions:{[a]:{name:a,type:"image",depth:0,position:[0,0],size:[n,i],image:t}}});case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,GameCore.Utils.Image.loadImage(r);case 8:return e.abrupt("return",e.sent);case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),function(e,n,i,a){return t.apply(this,arguments)})},{key:"addLeaderToInactiveNode",value:function(e){this.inactiveNodeContainer.addChild(e),e.getComponent(zI).setOpacity(0)}}]),u}(f)).prototype,"leaderPrefab",[xI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NI=$e(OI.prototype,"inactiveNodeContainer",[RI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MI=$e(OI.prototype,"layout",[II],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FI=$e(OI.prototype,"viewport",[PI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=$e(OI.prototype,"maxLeader",[_I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LI=OI))||LI);n._RF.pop(),n._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var hP,pP=i.ccclass,dP=i.property,fP=globalThis.game,vP=fP.storage,yP=fP.leaderboard,mP=fP.player,gP=(HI=pP("LeaderboardContent"),qI=dP(br),VI=dP(DR),WI=dP(cP),KI=dP(le),jI=dP({type:[TI]}),YI=dP(dR),XI=dP(ji),HI((JI=$e((QI=function(e){Pe(c,e);var t,n,i,a,r,o,l,u=Be(c);function c(){var e;Ae(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=u.call.apply(u,[this].concat(n)),"panelAnimator",JI,Me(e)),Xe(e,"tabs",ZI,Me(e)),Xe(e,"leaders",eP,Me(e)),Xe(e,"scrollview",tP,Me(e)),Xe(e,"leaderSkeletons",nP,Me(e)),Xe(e,"leaderboardIsEmpty",iP,Me(e)),Xe(e,"contentOpacity",aP,Me(e)),e.isHidden=!0,e.currentLb=null,e.animAbortSignal=null,e.fetchAbortController=null,e.handleUpdateVisibility=function(){e.leaders.updateVisibility()},e.handleFriendsTabSelected=Te(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return vP.setStorageData("leaderboard_content","lastTabOpened","friends"),e.cleanupSideEffects(),t.next=4,e.updateStatus("friends");case 4:case"end":return t.stop()}}),t)}))),e.handleWorldTabSelected=Te(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return vP.setStorageData("leaderboard_content","lastTabOpened","global"),e.cleanupSideEffects(),t.next=4,e.updateStatus("global");case 4:case"end":return t.stop()}}),t)}))),e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return Re(c,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"listenEvents",value:function(){this.node.scene.on(sg.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(sg.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(Ka.HIDE_UI,this.hideContent),this.node.scene.on(Ka.SHOW_UI,this.showContent),this.scrollview.node.on(le.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenEvents",value:function(){this.node.scene.off(sg.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(sg.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents(),this.scrollview.node.off(le.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(Ka.HIDE_UI,this.hideContent),this.node.scene.off(Ka.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(l=Te(Se().mark((function e(t,n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.aborted){e.next=2;break}return e.abrupt("return",null);case 2:if(i=this.getLeaderboardName(t)){e.next=5;break}return e.abrupt("return",null);case 5:return a=GameCore.Configs.Leaderboards.Limit,e.next=8,yP.requestLeaderboardAsync(i,a);case 8:if(!n.aborted){e.next=10;break}return e.abrupt("return",null);case 10:return e.abrupt("return",yP.getLeaderboard(i));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"getLeaderboardName",value:function(e){return"friends"===e?Ds:Os}},{key:"loadMoreLeaderboard",value:(o=Te(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.aborted){e.next=2;break}return e.abrupt("return",null);case 2:if(i=this.getLeaderboardName(t)){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,yP.loadMoreLeaderboardAsync(i,1e3);case 7:if(!n.aborted){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",yP.getLeaderboard(i));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"showLoading",value:(r=Te(Se().mark((function e(t){var n,i=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:0,this.scrollview.scrollToTop(0),this.scrollview.enabled=!1,e.next=5,Promise.all([this.leaderSkeletons.map((function(e,i){return e.show(i*n,t)}))]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"hideLoading",value:(a=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.leaderSkeletons.map((function(e){return e.hide(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"enter",value:function(){this.listenEvents(),this.isHidden=!1;var e=vP.getStorageData("leaderboard_content","lastTabOpened");"friends"===e&&this.handleFriendsTabSelected(),"global"===e&&this.handleWorldTabSelected()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){var e,t;null===(e=this.animAbortSignal)||void 0===e||e.abort(),this.animAbortSignal=null,null===(t=this.fetchAbortController)||void 0===t||t.abort(),this.fetchAbortController=null,this.leaders.removeLeaders(),this.leaderboardIsEmpty.hide()}},{key:"isAborted",value:function(){var e,t,n,i,a=null===(e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===e||e,r=null===(n=null===(i=this.fetchAbortController)||void 0===i?void 0:i.signal.aborted)||void 0===n||n;return a||r}},{key:"updateStatus",value:(i=Te(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this.animAbortSignal&&null===this.fetchAbortController){e.next=2;break}throw new Error("LeaderboardContent: LeaderboardContent is already loading. Please handle cancelling gracefully.");case 2:if(!this.isHidden){e.next=4;break}return e.abrupt("return");case 4:return this.tabs.updateStatus(t),this.animAbortSignal=new qi,this.fetchAbortController=new AbortController,e.next=9,this.showLoading(this.animAbortSignal);case 9:return e.next=11,this.loadLeaderboard(t,this.animAbortSignal);case 11:if(this.currentLb=e.sent,this.currentLb){e.next=14;break}return e.abrupt("return");case 14:if(0!==Object.values(this.currentLb.leaders).length){e.next=19;break}return this.leaderboardIsEmpty.show(),this.tabs.setInteractableButtons(!0),this.hideLoading(this.animAbortSignal),e.abrupt("return");case 19:if(i=mP.getPlayerId(),a=this.currentLb.leaders[i]){e.next=28;break}if(!(r=this.getLeaderboardName(t))){e.next=28;break}return e.next=26,yP.getLeadersByPlayerIdsAsync(r,[i]);case 26:(o=e.sent).length>0&&(a=o[0],this.currentLb.leaders[i]=a);case 28:return s=vP.getStorage("leaderboard_content"),l=s.previousScore,u=s.previousRank,c=null!==(n=a)&&void 0!==n?n:{},h=c.score,p=c.rank,l&&l<h&&u&&u!==p&&(this.currentLb.leaders[i].score=l),d=Object.values(this.currentLb.leaders),Bn.setBlockInput(!0),this.tabs.setInteractableButtons(!1),e.next=36,this.hideLoading(this.animAbortSignal);case 36:if(!this.isAborted()){e.next=40;break}return Bn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 40:return this.leaders.updateData(d),this.scrollview.enabled=!0,e.next=44,this.leaders.showLeaders(this.animAbortSignal);case 44:if(!this.isAborted()){e.next=48;break}return Bn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 48:if(f=this.leaders.getPlayerLeader()){e.next=53;break}return Bn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 53:return e.next=55,this.scrollToLeader(f,1);case 55:if(!this.isAborted()){e.next=59;break}return Bn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 59:return e.next=61,this.runPlayerRankChangeAnimation(this.animAbortSignal,h);case 61:if(!this.isAborted()){e.next=65;break}return Bn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 65:vP.setStorageData("leaderboard_content","previousScore",h),vP.setStorageData("leaderboard_content","previousRank",p),Bn.setBlockInput(!1),this.tabs.setInteractableButtons(!0);case 69:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(n=Te(Se().mark((function e(t,n){var i,a,r,o,s,l,u,c,h,p,d,f,v,y,m;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=vP.getStorage("leaderboard_content"),(a=i.previousScore)&&!(a>=n)){e.next=3;break}return e.abrupt("return");case 3:if(r=this.leaders.getLeaderData(),-1!==(o=r.findIndex((function(e){return e.playerId===mP.getPlayerId()})))){e.next=7;break}return e.abrupt("return");case 7:if(s=r[o],l=s.score,u=s.rank,s.score=n,r.sort((function(e,t){return t.score-e.score})),r.forEach((function(e,t){e.rank=t+1})),c=this.leaders.getPlayerLeader()){e.next=15;break}return e.abrupt("return");case 15:if(u!==s.rank){e.next=18;break}return c.updateScore({score:s.score,isHighlight:!0}),e.abrupt("return");case 18:if(h=this.leaders.getLeaderByRank(s.rank)){e.next=21;break}return e.abrupt("return");case 21:return this.leaders.layout.enabled=!1,e.next=24,c.runScaleAnimation(t,1.1,.5);case 24:return p=Math.min(.5*(u-s.rank),2),d=[c.runUpdateDataAnimation(u,s.rank,l,s.score,p),this.scrollToLeader(h,p)],f=this.uiTransform.contentSize.height,v=this.scrollview.getMaxScrollOffset().y,y=-h.node.position.y-f/2,m=j.ZERO,y<0?m=new j(c.node.worldPosition.x,f+h.node.position.y,c.node.worldPosition.z):this.scrollview.getScrollOffset().y>=v-5&&(m=y<v?new j(c.node.worldPosition.x,f/2,c.node.worldPosition.z):h.node.worldPosition),m.equals(j.ZERO)||d.push(c.runWorldPositionAnimation(m,p)),e.next=34,Promise.all(d);case 34:return e.next=36,Promise.all([c.runScaleAnimation(t,1,.25),c.node.setSiblingIndex(s.rank-1),this.leaders.runUpdateLeadersRankAnimation(s.rank,u)]);case 36:this.leaders.layout.enabled=!0,this.leaders.layout.updateLayout();case 38:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"scrollToLeader",value:(t=Te(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.uiTransform.contentSize,a=new $(0,-t.node.position.y-i.height/2),r=this.scrollview.getScrollOffset().clone(),a.y=Math.max(a.y,0),r.y=Math.max(r.y,0),o=a.y-r.y,!(Math.abs(o)<5)){e.next=8;break}return e.abrupt("return");case 8:return this.scrollview.scrollToOffset(a,n),e.abrupt("return",yn.waitTweenAsync(n));case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),c}(f)).prototype,"panelAnimator",[qI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZI=$e(QI.prototype,"tabs",[VI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eP=$e(QI.prototype,"leaders",[WI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tP=$e(QI.prototype,"scrollview",[KI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nP=$e(QI.prototype,"leaderSkeletons",[jI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iP=$e(QI.prototype,"leaderboardIsEmpty",[YI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aP=$e(QI.prototype,"contentOpacity",[XI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$I=QI))||$I);n._RF.pop(),n._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var bP,wP,kP,SP,EP,CP,TP,AP,xP,RP,IP,PP,_P,LP,OP,DP,NP;(0,i.ccclass)("LeaderboardPage")(hP=function(e){Pe(r,e);var t,n,i,a=Be(r);function r(){return Ae(this,r),a.apply(this,arguments)}return Re(r,[{key:"mount",value:(i=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,Bn.loadPrefabAsync(Rn.LEADERBOARD_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,Ue(_e(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(gP),this.content){e.next=11;break}throw new Error("LeaderboardPage: Leaders not found");case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Te(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(_e(r.prototype),"transitionIn",this).call(this);case 2:return this.content.enableUIAnimator(),t=yn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){i.node.scene.emit(Ka.SHOW_UI,{onComplete:function(){e()}})})),e.next=7,Promise.all([t,n]);case 7:this.content.enter();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(_e(r.prototype),"transitionOut",this).call(this);case 2:return this.content.unlistenUIEvents(),e.next=5,new Promise((function(e){t.node.scene.emit(Ka.HIDE_UI,{onComplete:function(){e()}})}));case 5:this.content.disableUIAnimator();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"unmount",value:function(){var e,t;null===(e=this.content)||void 0===e||e.hide(),null===(t=this.content)||void 0===t||t.cleanup(),Ue(_e(r.prototype),"unmount",this).call(this)}}]),r}(MS));n._RF.pop(),n._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var MP,FP,BP,GP,UP,zP=i.ccclass,HP=i.property,qP=globalThis.game,VP=qP.leaderboard,WP=qP.player,KP=(bP=zP("TournamentBlock"),wP=HP(a),kP=HP(u),SP=HP(u),EP=HP(u),CP=HP(u),TP=HP(s),AP=HP({type:[A]}),bP((IP=$e((RP=function(e){Pe(r,e);var t,n,i,a=Be(r);function r(){var e;Ae(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"container",IP,Me(e)),Xe(e,"titleLabel",PP,Me(e)),Xe(e,"timeLabel",_P,Me(e)),Xe(e,"playerCountLabel",LP,Me(e)),Xe(e,"playButtonLabel",OP,Me(e)),Xe(e,"uiTransform",DP,Me(e)),Xe(e,"banners",NP,Me(e)),e}return Re(r,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(D),this.validateRequiredComponents()}},{key:"activateThemeBanner",value:function(e){var t=!1;this.banners.forEach((function(n){n.node.active=n.node.name.toLowerCase()===e,n.node.active&&(t=!0)})),t||this.banners.forEach((function(e){e.node.active=e.node.name.toLowerCase()===ol.SUMMER}))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"updateInfo",value:(i=Te(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.payload=t,n=t.endTime,i=t.title,a=t.payload,r=a.leaderboardId,o=a.themeId,r){e.next=5;break}return e.abrupt("return");case 5:return this.setPlayerCountWaiting(),this.updateTitle(i),this.updateEndTime(n),this.updateTournamentBanner(o),s={leaders:[],isPlayerInTournament:!1},e.prev=10,e.next=13,this.getLeadersPayload(r);case 13:(l=e.sent)&&(s=l),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),console.error(`Fetch lb for tournament ${i}`,e.t0);case 20:this.leadersPayload=s,u=this.leadersPayload,c=u.leaders,h=u.isPlayerInTournament,p=c.length,this.updatePlayerCount(p),this.updatePlayButtonLabel(h);case 25:case"end":return e.stop()}}),e,this,[[10,17]])}))),function(e){return i.apply(this,arguments)})},{key:"updateTitle",value:function(e){e&&(this.titleLabel.string=e)}},{key:"updateEndTime",value:function(e){var t=GameCore.Utils.Time.getRelativeTime(e);this.timeLabel.string=`Ends ${t}`}},{key:"updatePlayerCount",value:function(e){this.playerCountLabel.string=`${e} `+(e>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"updateTournamentBanner",value:function(e){e?this.activateThemeBanner(e):this.activateThemeBanner(ol.SUMMER)}},{key:"updatePlayButtonLabel",value:function(e){this.playButtonLabel.string=e?"Continue":"Join"}},{key:"getLeadersPayload",value:(n=Te(Se().mark((function e(t){var n,i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=VP.getLeaderboardName(t)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,VP.requestLeaderboardAsync(n,0);case 5:if(i=VP.getLeaderboard(n)){e.next=8;break}return e.abrupt("return",null);case 8:for(a=Object.values(i.leaders),r=WP.getPlayerId(),o={leaders:[],player:void 0,isPlayerInTournament:!1},s=0,l=a;s<l.length;s++)(u=l[s]).playerId===r?(o.player=u,o.isPlayerInTournament=!0,o.leaders.push(u)):o.leaders.push(u);return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(t=Te(Se().mark((function e(t,n,i){var a,r,o,s,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,a=this.container.position.clone(),this.container.position=new j(a.x,a.y-100,a.z),(r=S(this.node).delay(t)).to(n,{scale:j.ONE},{easing:"elasticOut"}),(o=S(this.container).delay(t)).to(n,{position:a},{easing:"backOut"}),(s=S(this.uiOpacity).delay(t)).to(n,{opacity:255},{easing:"cubicOut"}),i.addAbortListener((function(){l.node.scale=j.ONE,l.container.position=a,l.uiOpacity.opacity=255})),e.next=13,Promise.all([yn.runTweenAsync(r,i),yn.runTweenAsync(o,i),yn.runTweenAsync(s,i)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var e=this.payload.id||"";if(tu.validateTournamentExpired(e))return this.node.scene.emit(qs.RELOAD_TOURNAMENT),void Yl.showNotificationScreen("Tournament has ended",2);try{var t=JSON.stringify(this.payload);Yl.showTournamentDetailScreen(t,"tournament_start")}catch(e){console.warn("handleOnTournamentClicked",e)}}}]),r}(f)).prototype,"container",[wP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PP=$e(RP.prototype,"titleLabel",[kP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_P=$e(RP.prototype,"timeLabel",[SP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LP=$e(RP.prototype,"playerCountLabel",[EP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OP=$e(RP.prototype,"playButtonLabel",[CP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DP=$e(RP.prototype,"uiTransform",[TP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NP=$e(RP.prototype,"banners",[AP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xP=RP))||xP);n._RF.pop(),n._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var jP,YP,XP,$P,QP,JP,ZP,e_,t_,n_,i_,a_=i.ccclass,r_=i.property,o_=(MP=a_("TournamentBlockSkeleton"),FP=r_(a),MP((UP=$e((GP=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"container",UP,Me(e)),e}return Re(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(D),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"hide",value:(n=Te(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Te(Se().mark((function e(t,n){var i,a,r,o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,i=this.container.position.clone(),this.container.position=new j(i.x,i.y-100,i.z),(a=S(this.node).delay(t)).to(.2,{scale:j.ONE},{easing:"elasticOut"}),(r=S(this.container).delay(t)).to(.2,{position:i},{easing:"backOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),n.addAbortListener((function(){s.node.scale=j.ONE,s.container.position=i,s.uiOpacity.opacity=255})),e.next=14,Promise.all([yn.runTweenAsync(a,n),yn.runTweenAsync(r,n),yn.runTweenAsync(o,n)]);case 14:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),a}(f)).prototype,"container",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BP=GP))||BP);n._RF.pop(),n._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var s_,l_,u_,c_,h_,p_=i.ccclass,d_=i.property,f_=globalThis.game.player,v_=(jP=p_("TournamentsBoard"),YP=d_(R),XP=d_(a),$P=d_(T),QP=d_(a),jP((e_=$e((ZP=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"tournamentBlockPrefab",e_,Me(e)),e.tournamentBlockArray=[],Xe(e,"inactiveNodeContainer",t_,Me(e)),Xe(e,"layout",n_,Me(e)),Xe(e,"createTournamentButton",i_,Me(e)),e}return Re(i,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.uiOpacity=this.getComponent(D),this.validateRequiredComponents()}},{key:"start",value:function(){for(var e=0;e<20;e++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"updateData",value:function(e){var t=this,n=!1;e.forEach((function(e,i){var a=t.tournamentBlockArray[i];e.payload.playerId===f_.getPlayerId()&&(n=!0),a||(a=t.addTournamentBlock()),a.updateInfo(e),t.layout.node.addChild(a.node)})),n||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var e=l(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(e);var t=e.getComponent(KP);return this.tournamentBlockArray.push(t),t}},{key:"removeTournamentBlocks",value:function(){var e=this;this.getActiveTournamentBlocks().forEach((function(t){e.inactiveNodeContainer.addChild(t.node)})),this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var e=this;return this.tournamentBlockArray.filter((function(t){return t.node.parent===e.layout.node}))}},{key:"setCreateTournamentButtonActive",value:function(e){e?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=e}},{key:"showTournamentBlocks",value:(t=Te(Se().mark((function e(t,n){var i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((i=this.getActiveTournamentBlocks()).length<1)){e.next=3;break}return e.abrupt("return");case 3:return a=Math.ceil(t/this.tournamentBlockContentHeight),r=Math.min(i.length,a),e.next=8,Promise.all(i.map(function(){var e=Te(Se().mark((function e(t,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i>=r)){e.next=4;break}return e.next=3,t.runShowPopUpAnimation(.1*i,.3,n);case 3:return e.abrupt("return");case 4:t.uiOpacity.opacity=255;case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 8:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"updateVisibility",value:function(){var e=this.uiTransform.getBoundingBoxToWorld(),t=e.yMax,n=e.yMin;this.getActiveTournamentBlocks().forEach((function(e){var i=e.uiTransform;if(void 0!==i){var a=i.getBoundingBoxToWorld(),r=a.yMax,o=a.yMin,s=r<n||o>t;e.uiOpacity.opacity=s?0:255}}))}}]),i}(f)).prototype,"tournamentBlockPrefab",[YP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t_=$e(ZP.prototype,"inactiveNodeContainer",[XP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),n_=$e(ZP.prototype,"layout",[$P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i_=$e(ZP.prototype,"createTournamentButton",[QP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JP=ZP))||JP);n._RF.pop(),n._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var y_,m_,g_,b_,w_,k_,S_,E_,C_,T_,A_,x_,R_,I_,P_,__=i.ccclass,L_=i.property,O_=(s_=__("TournamentsNotAvailable"),l_=L_(p),s_((h_=$e((c_=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"createButton",h_,Me(e)),e}return Re(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(D),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"show",value:(t=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.createButton.interactable=!0,this.uiOpacity.opacity=255,t=this.node.position.clone(),(n=S(this.node)).to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)}),(i=S(this.node).repeat(2,n)).to(.05,{position:t}),e.next=10,yn.runTweenAsync(i);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hide",value:function(){this.createButton.interactable=!1,this.uiOpacity.opacity=0}}]),i}(f)).prototype,"createButton",[l_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u_=c_))||u_);n._RF.pop(),n._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var D_,N_=i.ccclass,M_=i.property,F_=globalThis.game,B_=F_.storage,G_=F_.match,U_=GameCore.Utils.Object,z_=(y_=N_("TournamentContent"),m_=M_({type:br}),g_=M_(v_),b_=M_(O_),w_=M_(le),k_=M_({type:[o_]}),S_=M_(ji),y_((T_=$e((C_=function(e){Pe(o,e);var t,n,i,a,r=Be(o);function o(){var e;Ae(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"panelAnimator",T_,Me(e)),Xe(e,"tournamentsBoard",A_,Me(e)),Xe(e,"tournamentsNotAvailable",x_,Me(e)),Xe(e,"scrollView",R_,Me(e)),Xe(e,"skeletons",I_,Me(e)),Xe(e,"contentOpacity",P_,Me(e)),e.animAbortSignal=null,e.softAbortSignal=null,e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return Re(o,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(le.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(qs.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(Ka.HIDE_UI,this.hideContent),this.node.scene.on(Ka.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(le.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(qs.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(Ka.HIDE_UI,this.hideContent),this.node.scene.off(Ka.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(a=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.listenEvents(),null===this.animAbortSignal&&null===this.softAbortSignal){e.next=3;break}throw new Error("TournamentContent: TournamentContent is already running");case 3:return this.animAbortSignal=new qi,this.softAbortSignal=new qi,e.next=7,this.showLoading(this.animAbortSignal);case 7:if(!this.isAborted()){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,tu.requestTournamentDataAsync();case 11:if(n=e.sent,!this.isAborted()){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,this.hideLoading(this.animAbortSignal);case 16:if(!this.isAborted()){e.next=18;break}return e.abrupt("return");case 18:if(0!==n.length||null!==(t=this.softAbortSignal)&&void 0!==t&&t.aborted){e.next=21;break}return this.tournamentsNotAvailable.show(),e.abrupt("return");case 21:return this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(n),e.next=26,this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal);case 26:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"showLoading",value:(i=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.scrollView.scrollToTop(0),this.scrollView.enabled=!1,e.next=4,Promise.all([this.skeletons.map((function(e){return e.show(0,t)}))]);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"hideLoading",value:(n=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.skeletons.map((function(e){return e.hide(t)}))]);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!B_.getStorage("tournament").animateTournamentLeader)return;var e=tu.getAllTournamentData(),t=G_.getMatchState().customData.tournamentId;if(!t)throw new Error("Tournament ID not found");var n=e.find((function(e){return e.id===t}));if(!n)throw new Error("Tournament not found");var i=JSON.stringify(n);Yl.showTournamentDetailScreen(i,"tournament_end")}catch(e){B_.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",e)}}},{key:"processCreateTournament",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Cl.processCreateTournamentAsync();case 3:e.next=13;break;case 5:if(e.prev=5,e.t0=e.catch(0),U_.hasOwn(e.t0,"code")){e.next=10;break}return Yl.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament"),e.abrupt("return");case 10:if("USER_INPUT"!==e.t0.code){e.next=12;break}return e.abrupt("return");case 12:"INVALID_OPERATION"===e.t0.code?Yl.showNotificationScreen(e.t0.message):Yl.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament");case 13:this.reload();case 14:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return t.apply(this,arguments)})},{key:"isAborted",value:function(){var e,t;return null===(e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===e||e}},{key:"cleanup",value:function(){var e;this.unlistenEvents(),null===(e=this.animAbortSignal)||void 0===e||e.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var e;null===(e=this.softAbortSignal)||void 0===e||e.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.enter()}}]),o}(f)).prototype,"panelAnimator",[m_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A_=$e(C_.prototype,"tournamentsBoard",[g_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x_=$e(C_.prototype,"tournamentsNotAvailable",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R_=$e(C_.prototype,"scrollView",[w_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I_=$e(C_.prototype,"skeletons",[k_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),P_=$e(C_.prototype,"contentOpacity",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E_=C_))||E_);n._RF.pop(),n._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var H_,q_,V_,W_,K_,j_;(0,i.ccclass)("TournamentPage")(D_=function(e){Pe(r,e);var t,n,i,a=Be(r);function r(){return Ae(this,r),a.apply(this,arguments)}return Re(r,[{key:"mount",value:(i=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,Bn.loadPrefabAsync(Rn.TOURNAMENTS_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,Ue(_e(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(z_),this.content){e.next=11;break}throw new Error("LeaderboardPage: Leaders not found");case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Te(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(_e(r.prototype),"transitionIn",this).call(this);case 2:return this.content.enableUIAnimator(),t=yn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){i.node.scene.emit(Ka.SHOW_UI,{onComplete:function(){e()}})})),e.next=7,Promise.all([t,n]);case 7:this.content.enter();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Te(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(t=this.content)||void 0===t||t.softAbort(),this.content.unlistenUIEvents(),e.next=4,Ue(_e(r.prototype),"transitionOut",this).call(this);case 4:return e.next=6,new Promise((function(e){n.node.scene.emit(Ka.HIDE_UI,{onComplete:function(){e()}})}));case 6:this.content.disableUIAnimator();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"unmount",value:function(){var e;null===(e=this.content)||void 0===e||e.cleanup(),Ue(_e(r.prototype),"unmount",this).call(this)}}]),r}(MS));n._RF.pop(),n._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var Y_,X_,$_,Q_,J_,Z_,eL,tL,nL,iL=i.ccclass,aL=i.property;H_=iL("EventBadge"),q_=aL(u),V_=aL(m),H_((j_=$e((K_=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"label",j_,Me(e)),e}return Re(n,[{key:"text",get:function(){return this.label.string},set:function(e){this.label.string=e}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(f)).prototype,"label",[q_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(K_.prototype,"text",[V_],Object.getOwnPropertyDescriptor(K_.prototype,"text"),K_.prototype),W_=K_));n._RF.pop(),n._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var rL,oL,sL,lL,uL,cL,hL,pL,dL,fL,vL,yL,mL,gL,bL,wL,kL,SL,EL,CL,TL,AL,xL,RL,IL,PL,_L,LL,OL,DL,NL,ML,FL,BL,GL,UL,zL,HL,qL,VL,WL,KL,jL,YL,XL,$L=i.ccclass,QL=i.property;Y_=$L("EventProgressBar"),X_=QL(Qr),$_=QL(u),Q_=QL(m),J_=QL({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),Y_((tL=$e((eL=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"progressBar",tL,Me(e)),Xe(e,"progressLabel",nL,Me(e)),e}return Re(n,[{key:"text",get:function(){return this.progressLabel.string},set:function(e){this.progressLabel.string=e}},{key:"progress",get:function(){return this.progressBar.progress},set:function(e){this.progressBar.progress=e}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(f)).prototype,"progressBar",[X_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nL=$e(eL.prototype,"progressLabel",[$_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(eL.prototype,"text",[Q_],Object.getOwnPropertyDescriptor(eL.prototype,"text"),eL.prototype),$e(eL.prototype,"progress",[J_],Object.getOwnPropertyDescriptor(eL.prototype,"progress"),eL.prototype),Z_=eL));n._RF.pop(),n._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var JL,ZL,eO,tO,nO,iO,aO,rO=i.ccclass,oO=i.property,sO=i.executeInEditMode,lO=globalThis.game.analytics;rL=rO("NavButton"),oL=oO(z),sL=oO({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),lL=oO({type:E,group:{name:"Animation"}}),uL=oO({type:E,group:{name:"Animation"}}),cL=oO({type:E,group:{name:"Animation"}}),hL=oO({type:E,group:{name:"Animation"}}),pL=oO({type:E,group:{name:"Animation"}}),dL=oO({group:{name:"Animation"}}),fL=oO({type:E,group:{name:"Animation"}}),vL=oO({type:E,group:{name:"Animation"}}),yL=oO({group:{name:"Animation"}}),mL=oO({type:E,group:{name:"Animation"}}),gL=oO({type:E,group:{name:"Animation"}}),bL=oO({type:E,group:{name:"Animation"}}),wL=oO({type:E,group:{name:"Animation"}}),kL=oO({type:s}),SL=oO(a),EL=oO(D),CL=oO({type:s}),TL=oO({type:ue(Rs)}),AL=oO(Sx),rL(xL=sO((IL=$e((RL=function(e){Pe(r,e);var t,n,i=Be(r);function r(){var e;Ae(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Xe(e=i.call.apply(i,[this].concat(n)),"wip",IL,Me(e)),Xe(e,"isSelectedInEditor",PL,Me(e)),Xe(e,"animationDuration",_L,Me(e)),Xe(e,"selectedSpacing",LL,Me(e)),Xe(e,"deselectedSpacing",OL,Me(e)),Xe(e,"selectedIconY",DL,Me(e)),Xe(e,"selectedIconX",NL,Me(e)),Xe(e,"selectedIconScale",ML,Me(e)),Xe(e,"deselectedIconY",FL,Me(e)),Xe(e,"deselectedIconX",BL,Me(e)),Xe(e,"deselectedIconScale",GL,Me(e)),Xe(e,"selectedTextY",UL,Me(e)),Xe(e,"selectedTextX",zL,Me(e)),Xe(e,"deselectedTextY",HL,Me(e)),Xe(e,"deselectedTextX",qL,Me(e)),Xe(e,"spacer",VL,Me(e)),Xe(e,"icon",WL,Me(e)),Xe(e,"text",KL,Me(e)),Xe(e,"uiTransform",jL,Me(e)),Xe(e,"screenType",YL,Me(e)),Xe(e,"navManager",XL,Me(e)),e.isSelected=!1,e.onMouseEnter=function(t){e.isSelected||e.playHoverOnAnimation()},e.onMouseLeave=function(t){e.isSelected||e.playHoverOffAnimation()},e}return Re(r,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var e,t;this.isSelected||(Jn.playSound(Hn.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),lO.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:null!==(e=null===(t=this.node.parent)||void 0===t?void 0:t.name)&&void 0!==e?e:this.node.name,screen_name:Qn.getCurrentPage()}))}},{key:"select",value:(n=Te(Se().mark((function e(){var t,n=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(n.length>0&&void 0!==n[0])||n[0],!this.isSelected){e.next=3;break}throw new Error("NavButton: Already selected");case 3:if(this.isSelected=!0,!t){e.next=9;break}return e.next=7,yn.runTweenAsync(this.playSelectAnimation());case 7:e.next=14;break;case 9:this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255;case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"deselect",value:(t=Te(Se().mark((function e(){var t,n,i=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(i.length>0&&void 0!==i[0])||i[0],n=i.length>1&&void 0!==i[1]&&i[1],this.isSelected||n){e.next=4;break}throw new Error("NavButton: Already deselected");case 4:if(this.isSelected=!1,!t){e.next=10;break}return e.next=8,yn.runTweenAsync(this.deselectAnimation());case 8:e.next=15;break;case 10:this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0;case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var e=new j(this.selectedIconX,this.selectedIconY,0),t=new j(this.deselectedIconX,this.deselectedIconY,0),n=this.node.scale.clone();this.node.scale=this.selectedIconScale;var i=this.uiTransform.convertToWorldSpaceAR(e),a=this.uiTransform.convertToWorldSpaceAR(t);return this.node.scale=n,a.x-i.x}},{key:"playHoverOnAnimation",value:function(){var e=S(this.icon);return e.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),yn.runTweenAsync(e)}},{key:"playHoverOffAnimation",value:function(){var e=S(this.icon);return e.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),yn.runTweenAsync(e)}},{key:"playSelectAnimation",value:function(){var e=this;return S(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=O.quintInOut(n),a=O.backOut(n),r=O.linear(n),o=n<.5?2*n:1,s=e.deselectedIconY+(e.selectedIconY-e.deselectedIconY)*a,l=e.deselectedIconX+(e.selectedIconX-e.deselectedIconX)*r;e.icon.setPosition(l,s,0);var u=e.deselectedIconScale.clone().lerp(e.selectedIconScale,i);e.icon.setScale(u.x,u.y,e.icon.scale.z);var c=255*o,h=e.deselectedTextY+(e.selectedTextY-e.deselectedTextY)*r,p=e.deselectedTextX+(e.selectedTextX-e.deselectedTextX)*r;e.text.opacity=c,e.text.node.setPosition(p,h,0)}}})}},{key:"deselectAnimation",value:function(){var e=this;return S(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=ce(e.selectedIconY,e.deselectedIconY,n),a=ce(e.selectedIconX,e.deselectedIconX,n);e.icon.setPosition(a,i,0);var r=ce(255,0,n<.5?2*n:1);e.text.opacity=r;var o=ce(e.selectedTextY,e.deselectedTextY,n),s=ce(e.selectedTextX,e.deselectedTextX,n);e.text.node.setPosition(s,o,0);var l=e.selectedIconScale.clone().lerp(e.deselectedIconScale,O.quintInOut(n));e.icon.setScale(l.x,l.y,e.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),r}(f)).prototype,"wip",[oL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),PL=$e(RL.prototype,"isSelectedInEditor",[sL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_L=$e(RL.prototype,"animationDuration",[lL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),LL=$e(RL.prototype,"selectedSpacing",[uL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),OL=$e(RL.prototype,"deselectedSpacing",[cL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),DL=$e(RL.prototype,"selectedIconY",[hL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),NL=$e(RL.prototype,"selectedIconX",[pL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ML=$e(RL.prototype,"selectedIconScale",[dL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(1,1,1)}}),FL=$e(RL.prototype,"deselectedIconY",[fL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),BL=$e(RL.prototype,"deselectedIconX",[vL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),GL=$e(RL.prototype,"deselectedIconScale",[yL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(.8,.8,1)}}),UL=$e(RL.prototype,"selectedTextY",[mL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-10}}),zL=$e(RL.prototype,"selectedTextX",[gL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),HL=$e(RL.prototype,"deselectedTextY",[bL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qL=$e(RL.prototype,"deselectedTextX",[wL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),VL=$e(RL.prototype,"spacer",[kL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WL=$e(RL.prototype,"icon",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KL=$e(RL.prototype,"text",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jL=$e(RL.prototype,"uiTransform",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YL=$e(RL.prototype,"screenType",[TL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XL=$e(RL.prototype,"navManager",[AL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xL=RL))||xL);n._RF.pop(),n._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var uO,cO,hO,pO,dO,fO,vO,yO,mO,gO,bO,wO,kO,SO,EO,CO=i.ccclass,TO=i.property,AO=i.disallowMultiple,xO=globalThis.game,RO=xO.audio,IO=xO.player,PO=la;JL=CO("GameScene"),ZL=TO(Rk),eO=TO(Pb),JL(tO=AO((iO=$e((nO=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"animSkipOverlay",iO,Me(e)),Xe(e,"coinManager",aO,Me(e)),e.handleGameExit=function(){cv.hideBannerAds(),Dl.switchScene(zs)},e.handleShowResults=function(){Dl.switchScene(Hs)},e.handleGameMaskWhenLayoutChanged=function(e){var t=x("Canvas/Game/GameObjects");if(t){var n=t.getComponent(he);n&&(n.enabled=e===PO.Landscape)}},e.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch((function(e){console.warn("subscribeBotAsync",e)}))},e}return Re(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents(),cv.showBannerAds()}},{key:"onLoad",value:function(){this.coinManager.init(this.animSkipOverlay)}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){V.on(Qi,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(Ka.GAME_EXIT,this.handleGameExit),this.node.scene.on(Ka.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}},{key:"start",value:function(){this.scheduleOnce(this.attemptCallSubscribeBot,.5),IO.getPlayerSetting("music")&&Jn.playMusic(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function(){Dl.preloadDashboardScene()}},{key:"updateVolumeBackgroundMusic",value:function(){RO.setVolume(1,"global_music")}}]),n}(f)).prototype,"animSkipOverlay",[ZL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aO=$e(nO.prototype,"coinManager",[eO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tO=nO))||tO);n._RF.pop(),n._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);var _O,LO,OO,DO,NO,MO,FO,BO=i.ccclass,GO=i.property;uO=BO("ItemButton"),cO=GO(z),hO=GO(p),pO=GO({type:g}),dO=GO(u),fO=GO(a),vO=GO(a),uO((gO=$e((mO=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"isDebug",gO,Me(e)),Xe(e,"button",bO,Me(e)),Xe(e,"quantity",wO,Me(e)),Xe(e,"quantityLabel",kO,Me(e)),Xe(e,"plusNode",SO,Me(e)),Xe(e,"quantityNode",EO,Me(e)),e}return Re(n,[{key:"__preload",value:function(){this.item=this.getComponent(Qf),this.validateRequiredComponents()}},{key:"start",value:function(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string=`${this.quantity}`,this.validateButton(),this.node.scene.on(Ka.GRID_CREATE,this.validateButton,this),this.node.scene.on(Ka.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(Ka.GRID_CLEAR,this.validateButton,this)}},{key:"validateRequiredComponents",value:function(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}},{key:"validateButton",value:function(){var e=this;console.log("VALIDATE BUTTON"),this.canActivate().then((function(t){e.button.interactable=!0,e.plusNode.active=0==e.quantity,e.quantityNode.active=e.quantity>0}))}},{key:"activate",value:function(){var e=this;return new Promise((function(t){if(e.quantity<=0)return e.handleShowAddItemScreen(),void t();e.item.activate().then((function(){e.isDebug||(e.quantity--,e.quantityLabel.string=`${e.quantity}`,e.item.saveQuantity()),e.validateButton(),t()}))}))}},{key:"canActivate",value:function(){return Promise.resolve(!0)}},{key:"addQuantity",value:function(e){this.quantity+=e,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}},{key:"clearQuantity",value:function(){this.quantity=0,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}},{key:"handleShowAddItemScreen",value:function(){Yl.openScreen(Kn.GET_ITEM_SCREEN,{item:vs.HINT,quantity:1})}}]),n}(f)).prototype,"isDebug",[cO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bO=$e(mO.prototype,"button",[hO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wO=$e(mO.prototype,"quantity",[pO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kO=$e(mO.prototype,"quantityLabel",[dO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SO=$e(mO.prototype,"plusNode",[fO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EO=$e(mO.prototype,"quantityNode",[vO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yO=mO));n._RF.pop(),n._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var UO,zO,HO,qO,VO,WO,KO,jO=i.ccclass,YO=i.property;_O=jO("ComboEffect"),LO=YO(D),OO=YO(ae),_O((MO=$e((NO=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"circleOpacity",MO,Me(e)),Xe(e,"particle",FO,Me(e)),e}return Re(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.circleOpacity)throw new Error("ComboEffect requires a circleOpacity component");if(!this.particle)throw new Error("ComboEffect requires a particle component")}},{key:"start",value:function(){this.node.scene.on(Ka.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){e>1&&(this.circleOpacity.node.scale=j.ZERO,this.circleOpacity.opacity=127.5,this.particle.resetSystem(),S(this.circleOpacity.node).to(.2,{scale:new j(1.3,1.3,1.3)},{easing:"quadOut"}).start(),S(this.circleOpacity).delay(.2).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),n}(f)).prototype,"circleOpacity",[LO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FO=$e(NO.prototype,"particle",[OO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DO=NO));n._RF.pop(),n._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var XO,$O,QO,JO,ZO,eD,tD,nD,iD,aD=i.ccclass,rD=i.property;UO=aD("ComboLabel"),zO=rD(u),HO=rD(a),UO((WO=$e((VO=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"comboNumber",WO,Me(e)),Xe(e,"comboContainer",KO,Me(e)),e}return Re(n,[{key:"onLoad",value:function(){this.opacity=this.getComponent(D),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(Ka.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>1?(this.opacity.opacity=255,this.comboNumber.string=`${e}`,S(this.comboContainer).to(.1,{scale:new j(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:j.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),n}(f)).prototype,"comboNumber",[zO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KO=$e(VO.prototype,"comboContainer",[HO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qO=VO));n._RF.pop(),n._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var oD,sD,lD,uD,cD,hD,pD,dD,fD,vD=i.ccclass,yD=i.property;XO=vD("ComboPopup"),$O=yD(A),QO=yD(L),JO=yD(y),XO((tD=$e((eD=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"textSprite",tD,Me(e)),Xe(e,"comboSprites",nD,Me(e)),Xe(e,"animation",iD,Me(e)),e}return Re(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"start",value:function(){this.node.scene.on(Ka.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"validateRequiredComponents",value:function(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}},{key:"handleOnComboUpdated",value:function(e){if(!(e<2))for(var t=this.comboSprites.length-1;t>=0;t--)if(e>=t+2){this.textSprite.spriteFrame=this.comboSprites[t],this.animation.play();break}}}]),n}(f)).prototype,"textSprite",[$O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nD=$e(eD.prototype,"comboSprites",[QO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iD=$e(eD.prototype,"animation",[JO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZO=eD));n._RF.pop(),n._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var mD,gD,bD,wD,kD,SD,ED,CD,TD,AD,xD,RD,ID,PD,_D,LD=i.ccclass,OD=i.property,DD=(oD=LD("PlayerScore"),sD=OD(a),lD=OD(u),uD=OD(A),oD((pD=$e((hD=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"crown",pD,Me(e)),Xe(e,"playerScore",dD,Me(e)),Xe(e,"avatar",fD,Me(e)),e}return Re(i,[{key:"showCrown",value:function(e){this.crown.active=e}},{key:"setPlayerScore",value:function(e){this.playerScore.string=e.toString()}},{key:"playWaitingAnimation",value:function(){var e=this,t=0;this.playerScore.schedule((function(){t=(t+1)%4;var n=Array(t+1).join(".");e.playerScore.string="Waiting"+n}),.5);var n=this.playerScore.getComponent(D),i=S(n).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=S(n).repeatForever(i).start()}},{key:"stopWaitingAnimation",value:function(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(D).opacity=255}},{key:"loadPhoto",value:(t=Te(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameCore.Utils.Image.loadImage(t);case 3:if(n=e.sent){e.next=6;break}throw new Error("Failed to load image");case 6:if(i=L.createWithImage(n)){e.next=9;break}throw new Error("Failed to create sprite frame");case 9:i.packable=!0,this.avatar.spriteFrame=i,e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return");case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e){return t.apply(this,arguments)})}]),i}(f)).prototype,"crown",[sD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dD=$e(hD.prototype,"playerScore",[lD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fD=$e(hD.prototype,"avatar",[uD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cD=hD))||cD);n._RF.pop(),n._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var ND,MD,FD,BD,GD,UD,zD,HD,qD,VD=i.ccclass,WD=i.disallowMultiple,KD=i.property,jD=globalThis.game,YD=jD.match,XD=jD.player,$D=jD.monitorError,QD="Waiting";mD=VD("ChallengeResultScene"),gD=KD(g),bD=KD({type:DD,group:"Score"}),wD=KD({type:DD,group:"Score"}),kD=KD(Ow),SD=KD(u),ED=KD(av),mD(CD=WD((AD=$e((TD=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"pollingInterval",AD,Me(e)),Xe(e,"playerScore",xD,Me(e)),Xe(e,"opponentScore",RD,Me(e)),Xe(e,"paperConfetti",ID,Me(e)),Xe(e,"titleText",PD,Me(e)),Xe(e,"levelManager",_D,Me(e)),e.goToDashboardScene=function(){cv.hideBannerAds(),Dl.switchScene(zs)},e.pollMatchState=Te(Se().mark((function t(){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=YD.getMatchState(),null!==(i=n.id)){t.next=4;break}throw new Error("Match id is not found");case 4:return a=XD.getPlayerId(),r=Date.now(),t.next=8,YD.api.getMatchAPI().getMatchDetailByIdAsync(i);case 8:if(o=t.sent,s=Date.now(),l=Math.max(0,s-r,e.pollingInterval),u=new GameCore.Dtos.Match.Data(o).toObject(),c=u.blackPlayerId,h=u.blackPlayerScore,p=u.whitePlayerScore,d=u.blackPlayerFinish,f=u.whitePlayerFinish,v=a===c?h:p,y=a===c?p:h,m=a===c?d:f,g=a===c?f:d,b=d&&f,e.playerScore.setPlayerScore(v),e.opponentScore.setPlayerScore(y),e.playerScore.showCrown(b&&v>y),e.opponentScore.showCrown(b&&y>v),e.stopWaitingAnimation(),e.playerScore.stopWaitingAnimation(),e.opponentScore.stopWaitingAnimation(),b){t.next=32;break}e.titleText.string=QD,e.playWaitingAnimation(),m||e.playerScore.playWaitingAnimation(),g||e.opponentScore.playWaitingAnimation(),t.next=45;break;case 32:if(v!==y){t.next=36;break}e.titleText.string="Draw",t.next=45;break;case 36:if(!(v>y)){t.next=40;break}e.titleText.string="You Win",t.next=45;break;case 40:if(!(v<y)){t.next=44;break}e.titleText.string="You Lose",t.next=45;break;case 44:return t.abrupt("return");case 45:e.scheduleOnce(e.pollMatchState,l),t.next=52;break;case 48:t.prev=48,t.t0=t.catch(0),console.warn("ResultScene: Error on pollMatchState",t.t0),e.scheduleOnce(e.pollMatchState,e.pollingInterval);case 52:case"end":return t.stop()}}),t,null,[[0,48]])}))),e}return Re(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents(),cv.showBannerAds()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"onLoad",value:function(){try{var e=YD.getMatchState(),t=e.customData,n=t.playerId,i=t.opponentId;if(null===n||null===i)throw new Error(`ResultScene: playerId is ${n} and opponentId is ${i}. Expected to not be null.`);var a=XD.getPlayer().photo,r=e.profiles[n],o=r.score,s=void 0===o?0:o,l=r.finished,u=void 0!==l&&l,c=e.profiles[i],h=c.photo,p=c.score,d=void 0===p?0:p,f=c.finished,v=void 0!==f&&f,y=u&&v,m=y&&s>d,g=y&&d>s;this.playerScore.loadPhoto(a),this.opponentScore.loadPhoto(h),this.playerScore.setPlayerScore(s),this.opponentScore.setPlayerScore(d),this.playerScore.showCrown(m),this.opponentScore.showCrown(g),u&&v?s===d?this.titleText.string="Draw":m?this.titleText.string="You Win":g&&(this.titleText.string="You Lose"):(this.titleText.string=QD,this.playWaitingAnimation(),u||this.playerScore.playWaitingAnimation(),v||this.opponentScore.playWaitingAnimation())}catch(e){console.warn("ResultScene: Error on load",e),this.goToDashboardScene()}}},{key:"listenEvents",value:function(){this.node.scene.on(na,this.goToDashboardScene),this.node.scene.on(ta,this.onReplayButtonPressed,this)}},{key:"start",value:function(){var e=this;this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce((function(){e.paperConfetti.runEffect()}),.2)}},{key:"onDestroy",value:function(){this.unschedule(this.pollMatchState)}},{key:"onReplayButtonPressed",value:(t=Te(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c,h,p,d,f;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null!==(t=XD.getGameData())&&void 0!==t?t:{},i=n.level,a=void 0===i?1:i,a=Math.max(1,a),e.next=4,this.levelManager.loadLevelData(a);case 4:if(r=e.sent,e.prev=5,r){e.next=8;break}throw new Error("Level data is not found");case 8:if(o=YD.getMatchState().customData.opponentId){e.next=11;break}throw new Error("Opponent id is not found");case 11:return Yl.showLoadingScreen(),s=Zc.generateFen(r),l=r.mode,u=void 0===l?"":l,c=r.rules,h=void 0===c?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:c,p=r.time,d=void 0===p?0:p,f=r.level,e.next=16,YD.challenge.friend.processAsync({playerId:XD.getPlayerId(),opponentId:o,extraData:{level:f,fen:s,gravity:u,rules:h,time:d}});case 16:Yl.closeLoadingScreen(),this.goToGameScene(),e.next=28;break;case 20:e.prev=20,e.t0=e.catch(5),console.warn("ReplayChallengeFriend",e.t0),Yl.closeLoadingScreen(),Yl.showNotificationScreen("Sorry, you cannot replay\nat this time.",2),null==$D||$D.sendException(e.t0 instanceof Error?e.t0:new Error("ReplayChallengeFriend"+JSON.stringify(e.t0))),this.scheduleOnce(this.goToDashboardScene,2);case 28:case"end":return e.stop()}}),e,this,[[5,20]])}))),function(){return t.apply(this,arguments)})},{key:"onHomeButtonPressed",value:function(){this.goToDashboardScene()}},{key:"goToGameScene",value:function(){Dl.switchScene(Us)}},{key:"playWaitingAnimation",value:function(){var e=this,t=0;this.titleText.schedule((function(){t=(t+1)%4;var n=Array(t+1).join(".");e.titleText.string=QD+n}),.5);var n=this.titleText.getComponent(D),i=S(n).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=S(n).repeatForever(i).start()}},{key:"stopWaitingAnimation",value:function(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(D).opacity=255}}]),i}(f)).prototype,"pollingInterval",[gD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),xD=$e(TD.prototype,"playerScore",[bD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RD=$e(TD.prototype,"opponentScore",[wD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ID=$e(TD.prototype,"paperConfetti",[kD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PD=$e(TD.prototype,"titleText",[SD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_D=$e(TD.prototype,"levelManager",[ED],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CD=TD))||CD);n._RF.pop(),n._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var JD,ZD=i.ccclass,eN=i.property,tN=i.disallowMultiple,nN=GameCore.Events,iN=globalThis.game.event,aN=(ND=ZD("BaseScreen"),MD=eN(a),FD=eN(a),BD=eN(D),ND(GD=tN((zD=$e((UD=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"container",zD,Me(e)),Xe(e,"backgroundMask",HD,Me(e)),Xe(e,"screenOpacity",qD,Me(e)),e.data={},e}return Re(n,[{key:"__preload",value:function(){this.animation=this.getComponent(y),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function(){var e=this.getMaskOpacity(),t=this.getContainerOpacity();e&&t&&(e.opacity=0,t.opacity=0)}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function(e){this.screenOpacity.opacity=e}},{key:"open",value:function(e){e&&(this.data=e),this.show(),this.runAnimation("OpenScreen")}},{key:"close",value:function(){var e=this;this.node.active&&(this.animation.once(y.EventType.FINISHED,(function(){iN.emit(nN.CLOSED_SCREEN,{screenName:e.node.name}),e.hide()})),this.runAnimation("CloseScreen"))}},{key:"runAnimation",value:function(e){if(!this.isAnimationExist(e))throw new Error(`${this.node.name}: Animation component must have ${e} clip`);this.animation.play(e)}},{key:"isAnimationExist",value:function(e){return this.animation.clips.some((function(t){return!(!t||t.name!==e)}))}},{key:"getMaskOpacity",value:function(){var e=this.backgroundMask.getComponent(D);return e||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function(){var e=this.container.getComponent(D);return e||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function(){this.setScreenOpacity(255);var e=this.node.getComponent(C);e&&(e.enabled=!0,e.updateAlignment(),this.node.getComponentsInChildren(C).forEach((function(e){e.updateAlignment()})))}},{key:"hide",value:function(){this.setScreenOpacity(0),this.node.setWorldPosition(new j(-1e3,-1e3,0));var e=this.node.getComponent(C);e&&(e.enabled=!1)}}]),n}(f)).prototype,"container",[MD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HD=$e(UD.prototype,"backgroundMask",[FD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qD=$e(UD.prototype,"screenOpacity",[BD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GD=UD))||GD)||GD);n._RF.pop(),n._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var rN,oN,sN,lN,uN,cN=i.ccclass,hN=i.requireComponent;cN("BackgroundMask")(JD=hN([D])(JD=function(e){Pe(n,e);var t=Be(n);function n(){return Ae(this,n),t.apply(this,arguments)}return Re(n,[{key:"onLoad",value:function(){var e=this.getComponent(D);e?(this.opacity=e,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var e,t,n=this.opacity.opacity/255;e=n,(t=document.getElementById("app-mask"))&&(t.style.background=`rgb(0 0 0 / ${e})`)}}]),n}(f))||JD);n._RF.pop(),n._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);var pN,dN,fN,vN,yN,mN,gN,bN,wN,kN,SN,EN,CN,TN,AN=i.ccclass,xN=i.property,RN=(rN=AN("Screens"),oN=xN({type:ue(Kn)}),rN((uN=$e((lN=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"screenKeys",uN,Me(e)),e}return Re(n)}(f)).prototype,"screenKeys",[oN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sN=lN))||sN);n._RF.pop(),n._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var IN,PN,_N,LN,ON,DN,NN,MN,FN,BN,GN,UN,zN,HN,qN,VN,WN,KN,jN,YN,XN,$N=i.ccclass,QN=i.property,JN=i.disallowMultiple,ZN=i.requireComponent,eM=GameCore.Events,tM=globalThis.game.event;pN=$N("CongratulationScreen"),dN=ZN(aN),fN=QN(a),vN=QN(a),yN=QN(p),mN=QN(p),gN=QN(p),pN(bN=JN(bN=dN((kN=$e((wN=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"congratulation",kN,Me(e)),Xe(e,"confirmation",SN,Me(e)),Xe(e,"closeButtonComponent",EN,Me(e)),Xe(e,"yesButtonComponent",CN,Me(e)),Xe(e,"noButtonComponent",TN,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("CongratulationScreen: screen not found");e.validateEventPayload(t)&&(e.closeButtonComponent.interactable=!0,e.yesButtonComponent.interactable=!0,e.noButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Re(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.confirmationUIOpacity=this.confirmation.getComponent(D),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){tM.on(eM.OPENING_SCREEN,this.handleOpeningScreen),tM.on(eM.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){tM.off(eM.OPENING_SCREEN,this.handleOpeningScreen),tM.off(eM.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,Yl.closeScreen(Yn[this.node.name])}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,S(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),S(this.confirmation).set({scale:new j(.8,.8,.8)}).to(.2,{scale:new j(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(Ka.START_OVER)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(Ka.GAME_REPLAY,{level:this.screen.data.level})}}]),n}(f)).prototype,"congratulation",[fN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SN=$e(wN.prototype,"confirmation",[vN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EN=$e(wN.prototype,"closeButtonComponent",[yN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CN=$e(wN.prototype,"yesButtonComponent",[mN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TN=$e(wN.prototype,"noButtonComponent",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bN=wN))||bN)||bN);n._RF.pop(),n._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var nM,iM,aM,rM,oM,sM,lM=i.ccclass,uM=i.property,cM=(IN=lM("DayBlock"),PN=uM({type:A,group:"Background"}),_N=uM({type:A,group:"Background"}),LN=uM({type:L,group:"Background"}),ON=uM({type:L,group:"Background"}),DN=uM(u),NN=uM(u),MN=uM(a),FN=uM(a),BN=uM(a),IN((zN=$e((UN=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"background",zN,Me(e)),Xe(e,"topBackground",HN,Me(e)),Xe(e,"blueBackground",qN,Me(e)),Xe(e,"blueTopBackground",VN,Me(e)),Xe(e,"dayLabel",WN,Me(e)),Xe(e,"coinLabel",KN,Me(e)),Xe(e,"rewardItemsNode",jN,Me(e)),Xe(e,"checkNode",YN,Me(e)),Xe(e,"glowNodes",XN,Me(e)),e}return Re(n,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(D),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new r(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new r("#3469bf")}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e){this.updateBackground(e),this.updateDayLabel(e),this.coinLabel.string=e.value.toString(),this.updateRewardItems(e)}},{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLabel.string=`Day ${e.day.toString()}`;var t=this.defaultDayLabelOutlineColor;"rewarded"!==e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=t,this.dayLabel.shadowColor=t}},{key:"updateRewardItems",value:function(e){switch(e.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(e){this.glowNodes&&this.glowNodes.forEach((function(t){t.active=e}))}}]),n}(f)).prototype,"background",[PN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HN=$e(UN.prototype,"topBackground",[_N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qN=$e(UN.prototype,"blueBackground",[LN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VN=$e(UN.prototype,"blueTopBackground",[ON],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WN=$e(UN.prototype,"dayLabel",[DN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KN=$e(UN.prototype,"coinLabel",[NN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jN=$e(UN.prototype,"rewardItemsNode",[MN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YN=$e(UN.prototype,"checkNode",[FN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XN=$e(UN.prototype,"glowNodes",[BN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GN=UN))||GN);n._RF.pop(),n._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var hM,pM=i.ccclass,dM=i.property,fM=i.requireComponent,vM=GameCore.Events,yM=globalThis.game,mM=yM.event,gM=yM.dailyRewards,bM=yM.player;nM=pM("DailyRewardsScreen"),iM=fM(aN),aM=dM([cM]),nM(rM=iM((sM=$e((oM=function(e){Pe(r,e);var t,n,i,a=Be(r);function r(){var e;Ae(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"dailyBlocks",sM,Me(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Re(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){mM.on(vM.OPENING_SCREEN,this.handleOpeningScreen),mM.on(vM.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){mM.off(vM.OPENING_SCREEN,this.handleOpeningScreen),mM.off(vM.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:(i=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.scene.emit(Ka.HIDE_UI),this.resetState(),e.next=4,this.updateRewardsData();case 4:this.loginDailyRewards(),this.updateDayBlocks(),this.runPopUpAnimation();case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"close",value:function(){mM.emit(vM.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ka.SHOW_UI)}},{key:"resetState",value:function(){this.dailyBlocks.forEach((function(e){e.uiOpacity.opacity=0,e.node.scale=new j(1.2,1.2,1.2)}))}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("DailyRewardScreen: screen not found"),this.dailyBlocks.forEach((function(t,n){e.runAppearTween(t,.15*n)}))}},{key:"runAppearTween",value:function(e,t){S(e.uiOpacity).delay(t).to(.3,{opacity:255},{easing:"quadOut"}).start(),S(e.node).delay(t).to(.3,{scale:j.ONE},{easing:"backOut"}).start()}},{key:"handleOnClaim",value:function(){var e=this.getCurrentRewardData();e&&this.claimReward(e)}},{key:"handleOnClaimX2",value:(n=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getCurrentRewardData()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,cv.showRewardVideoAdAsync({});case 5:if(e.sent){e.next=8;break}return e.abrupt("return");case 8:this.claimReward(t,!0);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return this.rewardsData.find((function(e){return"ready"===e.status}))}},{key:"claimReward",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.value*(t?2:1),i=new qi;if(this.node.scene.emit(Ka.ADD_COINS,{coins:n,collectionAnimation:{animateTextOnly:!1,signal:i}}),e.items){var a=e.items.hint*(t?2:1),r=e.items.thunder*(t?2:1),o=e.items.storm*(t?2:1),s=bM.getGameData();s?(bM.setGameData({items:{hint:s.items.hint+a,thunder:s.items.thunder+r,storm:s.items.storm+o,pliers:s.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gM.requestDailyRewardsAsync();case 2:for(t=ke({},gM.getDailyRewards()),n=0;n<GameCore.Configs.DailyRewards.MaxDays;n++)t[n]=ke(ke({},t[n]),{},{value:Ss[n].value,items:Ss[n].items});if(t){e.next=6;break}return e.abrupt("return");case 6:this.rewardsData=Object.values(t),console.log("DailyRewardsScreen: rewardsData",this.rewardsData);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){gM.logLoginReward()}},{key:"updateDayBlocks",value:function(){var e=this;this.dailyBlocks.forEach((function(t,n){var i=e.rewardsData[n],a=i.id,r=i.type,o=i.value,s=i.status;t.updateInfo({day:a,type:r,value:o,status:s})}))}}]),r}(f)).prototype,"dailyBlocks",[aM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rM=oM))||rM);n._RF.pop(),n._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var wM,kM,SM,EM,CM,TM,AM,xM,RM,IM;(0,i.ccclass)("DayBlockRed")(hM=function(e){Pe(n,e);var t=Be(n);function n(){return Ae(this,n),t.apply(this,arguments)}return Re(n,[{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLabel.string=`Day ${e.day.toString()}`;var t=this.defaultDayLabelOutlineColor;"ready"===e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=t,this.dayLabel.outlineColor=t}}]),n}(cM));n._RF.pop(),n._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var PM,_M,LM,OM,DM,NM,MM,FM,BM,GM=i.ccclass,UM=i.property,zM=i.requireComponent,HM=globalThis.game.event,qM=GameCore.Events;wM=GM("GetCoinScreen"),kM=zM(aN),SM=UM(u),EM=UM(p),CM=UM(p),wM(TM=kM((xM=$e((AM=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"quantityLabel",xM,Me(e)),Xe(e,"closeButtonComponent",RM,Me(e)),Xe(e,"getNowButtonComponent",IM,Me(e)),e.handleOpeningScreen=function(t){console.log("GetCoinScreen.OPENING_SCREEN",t),e.validateEventPayload(t)&&(e.closeButtonComponent.interactable=!0,e.getNowButtonComponent.interactable=!0,e.updateStatus())},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Re(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){HM.on(qM.OPENING_SCREEN,this.handleOpeningScreen),HM.on(qM.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){HM.off(qM.OPENING_SCREEN,this.handleOpeningScreen),HM.off(qM.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return"screenName"in e&&(e.screenName===this.node.name&&(this.payload=e,!0))}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(Ka.HIDE_UI)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,HM.emit(qM.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ka.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var e=this.getQuantity();e&&this.updateQuantityLabel(e)}},{key:"updateQuantityLabel",value:function(e){this.quantityLabel.string=`x${e.toString()}`}},{key:"getQuantity",value:function(){if(!this.payload||!("screenData"in this.payload))return 0;var e=this.payload.screenData;return e&&"quantity"in e&&e.quantity&&"number"==typeof e.quantity?e.quantity:0}},{key:"handleAddCoin",value:function(){var e=this.getQuantity();this.node.scene.emit(Ka.ADD_COINS,{coins:e,collectionAnimation:{animateTextOnly:!1}}),this.close()}},{key:"handleGetNowButtonClicked",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Jn.stopAllSounds(),e.next=3,cv.showRewardVideoAdAsync({});case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:this.handleAddCoin();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"quantityLabel",[SM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RM=$e(AM.prototype,"closeButtonComponent",[EM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IM=$e(AM.prototype,"getNowButtonComponent",[CM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TM=AM))||TM);n._RF.pop(),n._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var VM,WM,KM,jM,YM,XM,$M,QM,JM,ZM,eF,tF,nF,iF,aF,rF,oF,sF,lF,uF,cF,hF,pF,dF,fF,vF=i.ccclass,yF=i.property,mF=(PM=vF("ItemCollectionFX"),_M=yF(A),LM=yF(D),OM=yF(ae),PM((MM=$e((NM=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"sprite",MM,Me(e)),Xe(e,"glowUIOpacity",FM,Me(e)),Xe(e,"particles",BM,Me(e)),e}return Re(n,[{key:"__preload",value:function(){St.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){this.particles.resetSystem()}}]),n}(f)).prototype,"sprite",[_M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FM=$e(NM.prototype,"glowUIOpacity",[LM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=$e(NM.prototype,"particles",[OM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DM=NM))||DM);n._RF.pop(),n._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var gF,bF,wF,kF,SF,EF,CF,TF,AF,xF,RF,IF,PF,_F,LF,OF,DF,NF,MF,FF,BF,GF,UF,zF,HF,qF,VF,WF,KF,jF,YF=i.ccclass,XF=i.property,$F=globalThis.game,QF=$F.event,JF=$F.player,ZF=$F.analytics,eB=GameCore.Events;VM=YF("GetItemScreen"),WM=XF(R),KM=XF(A),jM=XF(A),YM=XF(A),XM=XF(A),$M=XF(u),QM=XF(u),JM=XF(u),ZM=XF(p),eF=XF(p),tF=XF(p),VM((aF=$e((iF=function(e){Pe(s,e);var t,n,i,a,r,o=Be(s);function s(){var e;Ae(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=o.call.apply(o,[this].concat(n)),"itemFxPrefab",aF,Me(e)),Xe(e,"hintSprite",rF,Me(e)),Xe(e,"stormSprite",oF,Me(e)),Xe(e,"pliersSprite",sF,Me(e)),Xe(e,"thunderSprite",lF,Me(e)),Xe(e,"titleLabel",uF,Me(e)),Xe(e,"descriptionLabel",cF,Me(e)),Xe(e,"coinLabel",hF,Me(e)),Xe(e,"closeButtonComponent",pF,Me(e)),Xe(e,"buyItemButtonComponent",dF,Me(e)),Xe(e,"getNowButtonComponent",fF,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("GetItemScreen: screen not found");if(e.validateEventPayload(t)){e.closeButtonComponent.interactable=!0,e.getNowButtonComponent.interactable=!0,e.buyItemButtonComponent.interactable=!0;var n=e.getItemType();n&&e.updateStatus(n)}},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Re(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){QF.on(eB.OPENING_SCREEN,this.handleOpeningScreen),QF.on(eB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){QF.off(eB.OPENING_SCREEN,this.handleOpeningScreen),QF.off(eB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function(){this.node.scene.emit(Ka.GAME_PAUSE)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.buyItemButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,QF.emit(eB.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ka.GAME_RESUME)}},{key:"updateStatus",value:function(e){this.updateItemIcon(e),this.updateTitle(e),this.updateDescription(),this.updateButtons(e)}},{key:"updateItemIcon",value:function(e){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach((function(e){e.node.active=!1})),e){case vs.HINT:this.activeIcon=this.hintSprite;break;case vs.STORM:this.activeIcon=this.stormSprite;break;case vs.THUNDER:this.activeIcon=this.thunderSprite;break;case vs.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}},{key:"updateTitle",value:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1);this.titleLabel.string=t}},{key:"updateDescription",value:function(){var e,t=null===(e=this.payload.screenData)||void 0===e?void 0:e.message;t&&(this.descriptionLabel.string=t)}},{key:"updateButtons",value:function(e){var t=this.canBuyItem(e);this.buyItemButtonComponent.node.active=t,this.getNowButtonComponent.node.active=!t,t&&(this.coinLabel.string=""+3*bs[e])}},{key:"canBuyItem",value:function(e){var t=JF.getGameData();return!!t&&t.coins>=3*bs[e]}},{key:"getItemType",value:function(){var e=this.payload.screenData;return e&&e.item&&Object.values(vs).includes(e.item)?e.item:null}},{key:"handleAddItem",value:(r=Te(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getItemType()){e.next=3;break}return e.abrupt("return");case 3:ZF.event(GameCore.Plugins.Analytics.Events.EARN_ITEM,{item_name:t,value:3}),this.node.scene.emit(Ka.ADD_ITEM,{animate:function(){return n.animateAddItem(t)},item:t,quantity:3});case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"animateAddItem",value:(a=Te(Se().mark((function e(t){var n,i,a,r,o,s,l;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.activeIcon.spriteFrame,i=this.createItemCollectionNode(n),a=qe(i,2),r=a[0],o=a[1],s=this.getItemButtonWorldPosition(t),l=new j(.5,.5,.5),o.glowUIOpacity.opacity=150,e.next=7,this.playScaleUpItemAnim(r,o);case 7:return e.next=9,yn.runTweenAsync(S(o.glowUIOpacity).to(.8,{opacity:0},{easing:"cubicIn"}));case 9:return e.next=11,this.playMoveCloseToItemButtonAnim(r,s,l);case 11:return e.next=13,this.playJumpAnim(r,l,s);case 13:Jn.playSound("sounds/clicks"),r.destroy();case 15:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"playJumpAnim",value:(i=Te(Se().mark((function e(t,n,i){var a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.clone().add3f(0,70,0),r=n.clone().multiplyScalar(1.3),e.next=4,Promise.all([yn.runTweenAsync(S(t).to(.3,{worldPosition:a},{easing:"cubicOut"})),yn.runTweenAsync(S(t).to(.3,{scale:r},{easing:"cubicOut"}))]);case 4:return e.next=6,yn.runTweenAsync(S(t).to(.5,{worldPosition:i},{easing:"cubicIn"}));case 6:case"end":return e.stop()}}),e)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"playMoveCloseToItemButtonAnim",value:function(e,t,n){var i=t.clone().add3f(0,30,0);return yn.runTweenAsync(S(e).to(1,{worldPosition:i,scale:n},{easing:"cubicInOut"}))}},{key:"createItemCollectionNode",value:function(e){var t=l(this.itemFxPrefab),n=t.getComponent(mF);return t.setParent(this.node.parent),n.sprite.spriteFrame=e,t.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[t,n]}},{key:"playScaleUpItemAnim",value:function(e,t){return e.setScale(j.ZERO),yn.runTweenAsync(S(e).delay(.2).call((function(){t.playExplosionParticles(),Jn.playSound("sounds/item_reward")})).to(.1,{scale:new j(.8,1.2,1)}).to(.1,{scale:new j(1.2,.8,1)}).to(.1,{scale:new j(1,1,1)}))}},{key:"getItemButtonWorldPosition",value:function(e){return this.getItemButton(e).worldPosition.clone()}},{key:"handleGetNowButtonClicked",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAllSounds(),e.next=3,cv.showRewardVideoAdAsync({});case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:this.handleAddItem(),this.close();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.node.scene.emit(Ka.REMOVE_COINS,{coins:3*bs[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var e;null===(e=x("Sound"))||void 0===e||null===(e=e.getComponent(Yt))||void 0===e||e.stopAll()}},{key:"getItemButton",value:function(e){switch(e){case vs.HINT:return x("Canvas/UI/Footer/HintItemButton");case vs.STORM:return x("Canvas/UI/Footer/StormItemButton");case vs.THUNDER:return x("Canvas/UI/Footer/ThunderItemButton");case vs.PLIERS:return x("Canvas/UI/Footer/PliersItemButton")}}}]),s}(f)).prototype,"itemFxPrefab",[WM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rF=$e(iF.prototype,"hintSprite",[KM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oF=$e(iF.prototype,"stormSprite",[jM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sF=$e(iF.prototype,"pliersSprite",[YM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lF=$e(iF.prototype,"thunderSprite",[XM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uF=$e(iF.prototype,"titleLabel",[$M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cF=$e(iF.prototype,"descriptionLabel",[QM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hF=$e(iF.prototype,"coinLabel",[JM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pF=$e(iF.prototype,"closeButtonComponent",[ZM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dF=$e(iF.prototype,"buyItemButtonComponent",[eF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fF=$e(iF.prototype,"getNowButtonComponent",[tF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nF=iF));n._RF.pop(),n._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var tB,nB=i.ccclass,iB=i.property,aB=i.requireComponent,rB=GameCore,oB=rB.Events,sB=rB.Utils,lB=globalThis.game,uB=lB.event,cB=lB.player,hB="Coin Container";gF=nB("LevelCompleteScreen"),bF=aB(aN),wF=iB(Xk),kF=iB(a),SF=iB(u),EF=iB(a),CF=iB(a),TF=iB(p),AF=iB(a),xF=iB(y),RF=iB(a),IF=iB({type:y,group:hB}),PF=iB({type:P,group:hB}),_F=iB({type:P,group:hB}),LF=iB(Ow),gF(OF=bF((NF=$e((DF=function(e){Pe(o,e);var t,n,i,a,r=Be(o);function o(){var e;Ae(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=r.call.apply(r,[this].concat(n))).levelId=1,e.coins=40,e.currentCoin=0,Xe(e,"coinContainer",NF,Me(e)),Xe(e,"playButton",MF,Me(e)),Xe(e,"coinText",FF,Me(e)),Xe(e,"levelText",BF,Me(e)),Xe(e,"nextLevelText",GF,Me(e)),Xe(e,"playButtonComponent",UF,Me(e)),Xe(e,"wellDoneText",zF,Me(e)),Xe(e,"coinAnimation",HF,Me(e)),Xe(e,"playButtonContainer",qF,Me(e)),Xe(e,"coinContainerAnimation",VF,Me(e)),Xe(e,"coinContainerEnterClip",WF,Me(e)),Xe(e,"coinContainerExitClip",KF,Me(e)),Xe(e,"paperConfetti",jF,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)&&(e.playButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Re(o,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onLoad",value:function(){var e=this,t=this.screen.open;this.screen.open=function(n){e.overrideOpenHandler(t,n)}}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){uB.on(oB.OPENING_SCREEN,this.handleOpeningScreen),uB.on(oB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){uB.off(oB.OPENING_SCREEN,this.handleOpeningScreen),uB.off(oB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){var t=null!=e?e:{},n=t.screenName,i=t.screenData;return n===this.node.name&&(!!sB.Valid.isObject(i)&&(sB.Valid.isNumber(i.level)&&(this.levelId=i.level,this.coins=this.levelId<5?ys:ms),sB.Valid.isNumber(i.currentCoin)&&(this.currentCoin=i.currentCoin),!0))}},{key:"open",value:function(){this.updateComponents(),this.node.scene.emit(Ka.HIDE_UI)}},{key:"close",value:(a=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name);case 2:return uB.emit(oB.CLOSE_SCREEN,{screenName:this.node.name}),e.next=5,cv.showInterstitialAdAsync({forLevel:this.screen.data.level});case 5:this.handleNextLevel();case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"overrideOpenHandler",value:(i=Te(Se().mark((function e(t,n){var i,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.screen.setScreenOpacity(255),this.coinText.string="x0",this.playButtonComponent.interactable=!1,this.paperConfetti.runEffect(),e.next=6,this.animateWellDoneText();case 6:this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z),t.call(this.screen,n),null===(i=this.screen.getComponent(y))||void 0===i||i.once(y.EventType.FINISHED,(function(){a.animateCoin()}));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"handleNextLevel",value:function(){var e=this.screen.data.level;if(e){var t=cB.getGameData();if(t)e>=t.totalLevel?this.node.scene.emit(Ka.MAX_LEVEL):this.node.scene.emit(Ka.NEXT_LEVEL);else console.warn("LevelCompleteScreen: gameData not found")}else console.warn("LevelCompleteScreen: level not found")}},{key:"updateComponents",value:function(){this.updateLevelText(),this.updateCoinContainer()}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoin})}},{key:"updateLevelText",value:function(){var e=cB.getGameData();if(e){this.levelText.getComponent(u).string=`Level ${this.levelId}`,console.log("LevelCompleteScreen: updateLevelText",this.levelId);var t=this.levelId+1>e.totalLevel?"Complete":`Level ${this.levelId+1}`;this.nextLevelText.getComponent(u).string=t}else console.warn("LevelCompleteScreen: gameData not found")}},{key:"updateCoinString",value:function(){this.coinText.string=`x${this.coins}`,console.log("LevelCompleteScreen: updateCoinString",this.coins)}},{key:"animateCoin",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.screen.container){e.next=3;break}return console.warn("LevelCompleteScreen: screen not found"),e.abrupt("return");case 3:return this.coinAnimation.play(),e.next=6,this.animateCoinText({contentFn:function(e){return`x${e}`},currentQuantity:0,targetQuantity:this.coins});case 6:return e.next=8,this.animateCoinCollection();case 8:return e.next=10,yn.runTweenAsync(this.showPlayButton());case 10:this.updateCoinString();case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"animateCoinCollection",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name);case 2:this.node.scene.emit(Ka.ADD_COINS,{coins:this.coins,collectionAnimation:{animateTextOnly:!1,target:this.coinContainer}});case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"showPlayButton",value:function(){var e=this;return S(this.playButtonContainer).call((function(){e.playButtonContainer.setScale(0,0,e.playButtonContainer.scale.z)})).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).call((function(){e.playButtonComponent.interactable=!0}))}},{key:"handleClickedPlay",value:function(){this.playButtonComponent.interactable=!1,this.close()}},{key:"animateWellDoneText",value:function(){var e=this,t=this.wellDoneText.position.clone(),n=S(this.wellDoneText).call((function(){e.wellDoneText.setPosition(0,0,e.wellDoneText.position.z),e.wellDoneText.setScale(0,0,e.wellDoneText.scale.z)})).to(.5,{scale:new j(1.5,1.5,1)},{easing:"cubicOut"}).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).to(.5,{position:t},{easing:"backOut"});return yn.runTweenAsync(n)}},{key:"animateCoinText",value:function(e){var t=this,n=e.contentFn,i=e.currentQuantity,a=e.targetQuantity,r=e.duration,o=void 0===r?.8:r,s=S({currentQuantity:i}).to(o,{currentQuantity:a},{easing:"linear",onUpdate:function(e){if(e){var i=e.currentQuantity,a=Math.floor(i);t.coinText.string=n(a)}}});return yn.runTweenAsync(s)}}]),o}(f)).prototype,"coinContainer",[wF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MF=$e(DF.prototype,"playButton",[kF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FF=$e(DF.prototype,"coinText",[SF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BF=$e(DF.prototype,"levelText",[EF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GF=$e(DF.prototype,"nextLevelText",[CF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UF=$e(DF.prototype,"playButtonComponent",[TF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zF=$e(DF.prototype,"wellDoneText",[AF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HF=$e(DF.prototype,"coinAnimation",[xF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qF=$e(DF.prototype,"playButtonContainer",[RF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VF=$e(DF.prototype,"coinContainerAnimation",[IF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WF=$e(DF.prototype,"coinContainerEnterClip",[PF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KF=$e(DF.prototype,"coinContainerExitClip",[_F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jF=$e(DF.prototype,"paperConfetti",[LF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OF=DF))||OF);n._RF.pop(),n._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var pB,dB,fB,vB,yB,mB,gB,bB,wB=i.ccclass,kB=i.disallowMultiple,SB=i.requireComponent,EB=GameCore.Events,CB=globalThis.game.event;wB("LoadingScreen")(tB=kB(tB=SB(aN)(tB=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e.handleClosedScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!1)},e.handleOnCloseScreen=function(){Yl.closeScreen(Yn[e.node.name])},e}return Re(n,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){CB.on(EB.OPENING_SCREEN,this.handleOpeningScreen),CB.on(EB.OPENED_SCREEN,this.handleOpenedScreen),CB.on(EB.CLOSING_SCREEN,this.handleClosingScreen),CB.on(EB.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){CB.off(EB.OPENING_SCREEN,this.handleOpeningScreen),CB.off(EB.OPENED_SCREEN,this.handleOpenedScreen),CB.off(EB.CLOSING_SCREEN,this.handleClosingScreen),CB.off(EB.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var e=this.screen.data.duration;e&&e>0&&this.scheduleOnce(this.handleOnCloseScreen,e)}}}]),n}(f))||tB)||tB);n._RF.pop(),n._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var TB,AB,xB,RB,IB,PB,_B,LB,OB=i.ccclass,DB=i.disallowMultiple,NB=i.requireComponent,MB=i.property,FB=GameCore,BB=FB.Events,GB=FB.Utils,UB=globalThis.game.event;pB=OB("NotificationScreen"),dB=NB(aN),fB=MB(u),vB=MB(p),pB(yB=DB(yB=dB((gB=$e((mB=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"message",gB,Me(e)),Xe(e,"touchZone",bB,Me(e)),e.enableCloseOnTouch=!0,e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.updateScreenData(t)},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e}return Re(n,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){UB.on(BB.OPENING_SCREEN,this.handleOpeningScreen),UB.on(BB.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){UB.off(BB.OPENING_SCREEN,this.handleOpeningScreen),UB.off(BB.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"updateScreenData",value:function(e){var t=this,n=e.screenData;GB.Valid.isObject(n)?(n.message&&(this.message.string=n.message),n.duration&&n.duration>0&&this.scheduleOnce((function(){Yl.closeScreen(Yn[t.node.name])}),n.duration),!1===n.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),Yl.closeScreen(Yn[this.node.name])}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),n}(f)).prototype,"message",[fB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bB=$e(mB.prototype,"touchZone",[vB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yB=mB))||yB)||yB);n._RF.pop(),n._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var zB,HB,qB,VB,WB,KB,jB,YB,XB,$B,QB,JB,ZB,eG,tG,nG,iG,aG,rG,oG,sG,lG,uG=i.ccclass,cG=i.property,hG=i.requireComponent,pG=GameCore.Events,dG=globalThis.game.event;TB=uG("QuitLevelScreen"),AB=hG(aN),xB=cG(p),RB=cG(p),TB(IB=AB((_B=$e((PB=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"noButton",_B,Me(e)),Xe(e,"yesButton",LB,Me(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.noButton.interactable=!0,e.yesButton.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Re(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){dG.on(pG.OPENING_SCREEN,this.handleOpeningScreen),dG.on(pG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){dG.off(pG.OPENING_SCREEN,this.handleOpeningScreen),dG.off(pG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(Ka.HIDE_UI)}},{key:"close",value:function(){this.noButton.interactable=!1,this.yesButton.interactable=!1,Yl.closeScreen(Yn[this.node.name]),this.node.scene.emit(Ka.SHOW_UI),this.node.scene.emit(Ka.GAME_RESUME)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedNo",value:function(){this.close()}},{key:"handleClickedYes",value:function(){this.node.scene.emit(Ka.GAME_EXIT)}}]),n}(f)).prototype,"noButton",[xB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LB=$e(PB.prototype,"yesButton",[RB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IB=PB))||IB);n._RF.pop(),n._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var fG,vG,yG,mG,gG,bG,wG,kG,SG,EG,CG,TG,AG,xG,RG,IG,PG,_G,LG,OG,DG,NG,MG,FG,BG,GG,UG=i.ccclass,zG=i.property,HG=i.disallowMultiple,qG=i.requireComponent,VG=GameCore.Events,WG=globalThis.game,KG=WG.event,jG=WG.player;zB=UG("RescuesScreen"),HB=qG(aN),qB=zG(D),VB=zG([a]),WB=zG(u),KB=zG(u),jB=zG(a),YB=zG(a),XB=zG(y),$B=zG(a),QB=zG(a),zB(JB=HG(JB=HB((eG=$e((ZB=function(e){Pe(s,e);var t,n,i,a,r,o=Be(s);function s(){var e;Ae(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=o.call.apply(o,[this].concat(n)),"adOpacity",eG,Me(e)),Xe(e,"animNodes",tG,Me(e)),Xe(e,"titleLabel",nG,Me(e)),Xe(e,"descriptionLabel",iG,Me(e)),Xe(e,"timer",aG,Me(e)),Xe(e,"bomb",rG,Me(e)),Xe(e,"bombAnim",oG,Me(e)),Xe(e,"replayButton",sG,Me(e)),Xe(e,"buyTimeButton",lG,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("RescuesScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Re(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){KG.on(VG.OPENING_SCREEN,this.handleOpeningScreen),KG.on(VG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){KG.off(VG.OPENING_SCREEN,this.handleOpeningScreen),KG.off(VG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:(r=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resetState();case 2:this.runOpenAnimation(),this.node.scene.emit(Ka.HIDE_UI);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"close",value:function(){KG.emit(VG.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(a=Te(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(null===(t=this.payload.screenData)||void 0===t?void 0:t.failKey)===au,this.titleLabel.string=n?"Boom!":"Time's Up!",this.descriptionLabel.string=n?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!n,this.bomb.active=n,n&&this.bombAnim.play(),i=jG.getGameData()){e.next=9;break}return e.abrupt("return");case 9:a=i.coins>=ws,this.replayButton.active=!a,this.buyTimeButton.active=a,this.adOpacity.opacity=0;case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"runOpenAnimation",value:(i=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.screen.container){e.next=3;break}return console.warn("TimeUpScreen: screen not found"),e.abrupt("return");case 3:return e.next=5,Promise.all(this.animNodes.map((function(e,n){t.runAppearTween(e,.1*n)})));case 5:return e.next=7,this.runShowAdContainer();case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"runAppearTween",value:(n=Te(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(t).set({scale:new j(0,0,0)}).delay(n).to(1,{scale:new j(1,1,1)},{progress:function(e,t,n,i){return e+(t-e)*yn.elasticOut(i,.1,.45)}}));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var e=S(this.adOpacity);return e.delay(1),e.to(.5,{opacity:255}),yn.runTweenAsync(e)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit(Ka.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit(Ka.REMOVE_COINS,{coins:ws,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,cv.showRewardVideoAdAsync({});case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:this.startRescue();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit(Ka.SHOW_UI),this.node.scene.emit(Ka.RESCUE_START),this.close()}}]),s}(f)).prototype,"adOpacity",[qB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tG=$e(ZB.prototype,"animNodes",[VB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nG=$e(ZB.prototype,"titleLabel",[WB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iG=$e(ZB.prototype,"descriptionLabel",[KB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aG=$e(ZB.prototype,"timer",[jB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rG=$e(ZB.prototype,"bomb",[YB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oG=$e(ZB.prototype,"bombAnim",[XB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sG=$e(ZB.prototype,"replayButton",[$B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lG=$e(ZB.prototype,"buyTimeButton",[QB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JB=ZB))||JB)||JB);n._RF.pop(),n._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var YG,XG,$G,QG,JG,ZG,eU,tU,nU,iU,aU,rU,oU,sU,lU,uU,cU,hU,pU,dU,fU,vU,yU,mU=i.ccclass,gU=i.property,bU=i.requireComponent,wU=GameCore,kU=wU.Events,SU=wU.Utils,EU=globalThis.game,CU=EU.player,TU=EU.event;fG=mU("SettingsScreen"),vG=bU(aN),yG=gU(a),mG=gU(a),gG=gU(a),bG=gU(TR),wG=gU(TR),kG=gU(TR),SG=gU(p),EG=gU(p),CG=gU(p),TG=gU(p),AG=gU(a),fG(xG=vG((IG=$e((RG=function(e){Pe(i,e);var t,n=Be(i);function i(){var e;Ae(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"musicSetting",IG,Me(e)),Xe(e,"soundSetting",PG,Me(e)),Xe(e,"vibrateSetting",_G,Me(e)),Xe(e,"musicSwitch",LG,Me(e)),Xe(e,"soundSwitch",OG,Me(e)),Xe(e,"vibrateSwitch",DG,Me(e)),Xe(e,"closeButtonComponent",NG,Me(e)),Xe(e,"continueButtonComponent",MG,Me(e)),Xe(e,"restartButtonComponent",FG,Me(e)),Xe(e,"inviteFriendsButtonComponent",BG,Me(e)),Xe(e,"animNodes",GG,Me(e)),e.triggerSequence="",e.handleOpeningScreen=function(t){e.validateSwitchScreenPayload(t)&&(e.closeButtonComponent.interactable=!0,e.continueButtonComponent.interactable=!0,e.restartButtonComponent.interactable=!0,e.inviteFriendsButtonComponent.interactable=!0,e.updateStatus())},e.handleOpenedScreen=function(t){e.validateSwitchScreenPayload(t)&&e.open()},e.handleResetSequence=function(){e.triggerSequence=""},e.handleTriggerUnlockKey=function(t){if("code"in t){var n=t.code,i=_s.UNLOCK_SEQUENCE;"number"==typeof n&&-1!==i.indexOf(n.toString())&&(e.triggerSequence+=n.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",n,e.triggerSequence,e.triggerSequence===i),e.triggerSequence===i&&(e.node.scene.emit(_s.Events.UNLOCK_DEV_TOOLS),e.node.off(_s.Events.TRIGGER_UNLOCK_KEY)))}},e.updateVibrateButton=function(){var t=e.vibrateSetting.getComponentInChildren(p),n=e.vibrateSetting.getComponentInChildren(TR),i=e.vibrateSetting.getComponentInChildren(ji);if(t&&n&&i)if(SU.Device.isMobile()){var a,r=null!==(a=CU.getPlayerSetting("vibrate"))&&void 0!==a&&a;n.setEnabled(r)}else t.interactable=!1,n.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")},e}return Re(i,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){TU.on(kU.OPENING_SCREEN,this.handleOpeningScreen),TU.on(kU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){TU.off(kU.OPENING_SCREEN,this.handleOpeningScreen),TU.off(kU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(e){return e.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(_s.Events.TRIGGER_UNLOCK_KEY),this.node.on(_s.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(_s.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(_s.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(_s.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(_s.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(Ka.HIDE_UI)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.continueButtonComponent.interactable=!1,this.restartButtonComponent.interactable=!1,this.inviteFriendsButtonComponent.interactable=!1,this.node.emit(_s.Events.TRIGGER_RESET_SEQUENCE),Yl.closeScreen(Yn[this.node.name])}},{key:"updateStatus",value:function(){var e,t,n,i={music:null!==(e=CU.getPlayerSetting("music"))&&void 0!==e&&e,sound:null!==(t=CU.getPlayerSetting("sound"))&&void 0!==t&&t,vibrate:null!==(n=CU.getPlayerSetting("vibrate"))&&void 0!==n&&n};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(i.music),this.soundSwitch.setEnabled(i.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach((function(t,n){e.runAppearTween(t,.1*n)}))}},{key:"runAppearTween",value:function(e,t){var n=S(e);n.set({scale:new j(0,0,0)}),n.delay(t),n.to(1,{scale:new j(1,1,1)},{progress:function(e,t,n,i){return e+(t-e)*yn.elasticOut(i,.1,.45)}}),n.start()}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var e=this.musicSwitch.switch();CU.setSetting("music",e),this.node.emit(_s.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e?Jn.playMusic():Jn.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var e=this.soundSwitch.switch();CU.setSetting("sound",e),this.node.emit(_s.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var e=this.vibrateSwitch.switch();CU.setSetting("vibrate",e)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:function(){this.restartGame()}},{key:"handleClickedInviteFriends",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.close(),this.node.scene.emit(Ka.INVITE_FRIENDS);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(Ka.GAME_RESUME),this.node.scene.emit(Ka.SHOW_UI)}},{key:"restartGame",value:function(){var e;this.close(),this.node.scene.emit(Ka.GAME_RESUME);var t=(null!==(e=CU.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;this.node.scene.emit(Ka.GAME_REPLAY,{level:n})}}]),i}(f)).prototype,"musicSetting",[yG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PG=$e(RG.prototype,"soundSetting",[mG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_G=$e(RG.prototype,"vibrateSetting",[gG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LG=$e(RG.prototype,"musicSwitch",[bG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OG=$e(RG.prototype,"soundSwitch",[wG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DG=$e(RG.prototype,"vibrateSwitch",[kG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NG=$e(RG.prototype,"closeButtonComponent",[SG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MG=$e(RG.prototype,"continueButtonComponent",[EG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FG=$e(RG.prototype,"restartButtonComponent",[CG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BG=$e(RG.prototype,"inviteFriendsButtonComponent",[TG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GG=$e(RG.prototype,"animNodes",[AG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xG=RG))||xG);n._RF.pop(),n._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var AU,xU,RU,IU,PU,_U,LU,OU,DU,NU,MU,FU,BU,GU,UU,zU,HU,qU,VU,WU,KU=i.ccclass,jU=i.property,YU=(YG=KU("StarChest"),XG=jU(A),$G=jU(D),QG=jU(ae),JG=jU(D),ZG=jU(D),eU=jU({type:E,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),tU=jU({type:E,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),nU=jU({type:E,displayName:"Centered Offset X",group:"Reward Animations"}),iU=jU({type:E,displayName:"Centered Offset Y",group:"Reward Animations"}),aU=jU({type:E,min:0,displayName:"Starting Scale",group:"Reward Animations"}),rU=jU({type:E,min:0,displayName:"Ending Scale",group:"Reward Animations"}),YG((lU=$e((sU=function(e){Pe(s,e);var t,n,i,a,r,o=Be(s);function s(){var e;Ae(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=o.call.apply(o,[this].concat(n)),"sprite",lU,Me(e)),Xe(e,"glowOpacity",uU,Me(e)),Xe(e,"explosionParticles",cU,Me(e)),Xe(e,"circle",hU,Me(e)),Xe(e,"uiOpacity",pU,Me(e)),e.ogCenterX=0,e.ogCenterY=0,Xe(e,"endingOffsetX",dU,Me(e)),Xe(e,"endingOffsetY",fU,Me(e)),Xe(e,"startingScale",vU,Me(e)),Xe(e,"endingScale",yU,Me(e)),e}return Re(s,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"moveToCenter",value:(r=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(this.endingOffsetX,this.endingOffsetY,this.node.position.z),e.next=3,yn.runTweenAsync(S(this.node).to(.7,{position:n},{easing:"quintInOut"}),t);case 3:this.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new j(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(a=Te(Se().mark((function e(t,n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.startingScale+(this.endingScale-this.startingScale)*t,a=new j(i,i,i),e.next=4,Promise.all([yn.runTweenAsync(S(this.sprite.node).to(.2,{scale:a},{easing:"backOut"}),n),yn.runTweenAsync(S(this.glowOpacity.node).to(.2,{scale:a},{easing:"backOut"}),n)]);case 4:this.sprite.node.setScale(a),this.glowOpacity.node.setScale(a);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"startShaking",value:function(){var e=this,t=this.node.position.clone();this.shakingTween={ogPos:t,tw:S({}).to(.1,{},{onUpdate:function(n,i){if(i){var a=t.x+10*(i-.5);e.node.position=new j(a,t.y,t.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(i=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.sprite.node.scale.clone().multiplyScalar(1.1),e.next=3,Promise.all([yn.runTweenAsync(S(this.sprite.node).to(.2,{scale:n},{easing:"cubicInOut"}),t),yn.runTweenAsync(S(this.glowOpacity.node).to(.2,{scale:n}),t),yn.runTweenAsync(S(this.glowOpacity).to(.5,{opacity:255}),t)]);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"explode",value:(n=Te(Se().mark((function e(t){var n,i,a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(8,8,8),i=function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.circle.opacity=255,r.circle.node.setScale(j.ZERO),e.next=4,Promise.all([yn.runTweenAsync(S(r.circle).to(.3,{opacity:0}),t),yn.runTweenAsync(S(r.circle.node).to(.3,{scale:n},{easing:"cubicOut"}),t)]);case 4:r.circle.opacity=0,r.circle.node.scale=n;case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a=function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([yn.runTweenAsync(S(r.glowOpacity.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),t),yn.runTweenAsync(S(r.sprite.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),t)]);case 2:r.sprite.node.setScale(j.ZERO),r.glowOpacity.node.setScale(j.ZERO);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=5,Promise.all([this.explodeParticles(t),i(),a()]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"explodeParticles",value:(t=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.aborted){e.next=2;break}return e.abrupt("return");case 2:return this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem(),e.next=6,yn.waitTweenAsync(1);case 6:this.explosionParticles.node.active=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),s}(f)).prototype,"sprite",[XG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uU=$e(sU.prototype,"glowOpacity",[$G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cU=$e(sU.prototype,"explosionParticles",[QG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hU=$e(sU.prototype,"circle",[JG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pU=$e(sU.prototype,"uiOpacity",[ZG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(sU.prototype,"startingOffsetX",[eU],Object.getOwnPropertyDescriptor(sU.prototype,"startingOffsetX"),sU.prototype),$e(sU.prototype,"startingOffsetY",[tU],Object.getOwnPropertyDescriptor(sU.prototype,"startingOffsetY"),sU.prototype),dU=$e(sU.prototype,"endingOffsetX",[nU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fU=$e(sU.prototype,"endingOffsetY",[iU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vU=$e(sU.prototype,"startingScale",[aU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),yU=$e(sU.prototype,"endingScale",[rU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),oU=sU))||oU);n._RF.pop(),n._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var XU,$U,QU,JU,ZU,ez,tz,nz,iz,az,rz,oz,sz,lz,uz=i.ccclass,cz=i.property,hz=i.requireComponent,pz=GameCore.Events,dz=globalThis.game,fz=dz.event,vz=dz.player;AU=uz("StarChestScreen"),xU=hz(aN),RU=cz(XC),IU=cz(u),PU=cz(p),_U=cz(y),LU=cz(YU),OU=cz(D),DU=cz(Rk),NU=cz(u),AU(MU=xU((BU=$e((FU=function(e){Pe(o,e);var t,n,i,a,r=Be(o);function o(){var e;Ae(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"starProgressBar",BU,Me(e)),Xe(e,"buttonLabel",GU,Me(e)),Xe(e,"button",UU,Me(e)),Xe(e,"chestAnimation",zU,Me(e)),Xe(e,"starChest",HU,Me(e)),Xe(e,"chestUnlockFXMask",qU,Me(e)),Xe(e,"skipOverlay",VU,Me(e)),Xe(e,"messageLabel",WU,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Re(o,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){fz.on(pz.OPENING_SCREEN,this.handleOpeningScreen),fz.on(pz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){fz.off(pz.OPENING_SCREEN,this.handleOpeningScreen),fz.off(pz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(Ka.HIDE_UI);var e=vz.getGameData();if(e){var t=e.stars;this.numChestAvailable=Math.floor(t/20),this.starProgressBar.setRange(t,20),this.buttonLabel.string=this.numChestAvailable?"Open":"Continue",this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.button.interactable=!0,this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){fz.emit(pz.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ka.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(a=Te(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.numChestAvailable){e.next=3;break}return this.close(),e.abrupt("return");case 3:if(Jn.turnDownMusic(),t=vz.getGameData()){e.next=7;break}return e.abrupt("return");case 7:return this.button.interactable=!1,n=t.stars,vz.setGameData({stars:t.stars-20*this.numChestAvailable}),i=new qi,e.next=13,this.skipOverlay.open({opacity:200,onSkip:function(){return i.abort()}});case 13:return e.next=15,this.handleUnlockAnimation(n,t.stars,i);case 15:return e.next=17,this.skipOverlay.close();case 17:Jn.turnUpMusic(),V.emit(Es),this.close();case 20:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(i=Te(Se().mark((function e(t,n,i){var a,r,o,s,l,u=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.starChest.moveToCenter(i),this.fadeInChestUnlockFX(i)]);case 2:return this.chestAnimation.stop(),this.starChest.startShaking(),Jn.playSound(Hn.STAR_CHEST_DRUM_ROLL,{loop:!0}),e.next=7,yn.waitTweenAsync(0);case 7:return a=t,r=this.numChestAvailable,o=function(e){return u.numChestAvailable>2?1-e/u.numChestAvailable:.35*(1-e/u.numChestAvailable)},s=function(e){a-e>=20&&(a=e,r--,u.starChest.scale(o(r),i),Jn.playSound(Hn.STAR_CHEST_OPEN))},e.next=13,Promise.all([this.starProgressBar.animateTo(n,i,s)]);case 13:return e.next=15,yn.waitTweenAsync(1,i);case 15:return this.starChest.stopShaking(),e.next=18,this.starChest.glow(i);case 18:return Jn.stopSound(Hn.STAR_CHEST_DRUM_ROLL),l=gs*this.numChestAvailable,this.node.scene.emit(Ka.ADD_COINS,{coins:l,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:i}}),e.next=23,this.starChest.explode(i);case 23:return e.next=25,yn.waitTweenAsync(1,i);case 25:return e.next=27,Promise.all([this.fadeOutChestUnlockFX(i)]);case 27:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(n=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.chestUnlockFXMask.node.active=!0,e.next=3,yn.runTweenAsync(S(this.chestUnlockFXMask).to(.5,{opacity:150}),t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(t=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.chestUnlockFXMask).to(.3,{opacity:0}),t);case 2:this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),o}(f)).prototype,"starProgressBar",[RU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GU=$e(FU.prototype,"buttonLabel",[IU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UU=$e(FU.prototype,"button",[PU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zU=$e(FU.prototype,"chestAnimation",[_U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HU=$e(FU.prototype,"starChest",[LU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qU=$e(FU.prototype,"chestUnlockFXMask",[OU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VU=$e(FU.prototype,"skipOverlay",[DU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WU=$e(FU.prototype,"messageLabel",[NU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MU=FU))||MU);n._RF.pop(),n._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);var yz,mz,gz,bz,wz,kz=i.ccclass,Sz=i.property,Ez=i.requireComponent,Cz=GameCore.Events,Tz=globalThis.game.event;XU=kz("StartLevelScreen"),$U=Ez(aN),QU=Sz(a),JU=Sz(a),ZU=Sz(a),ez=Sz(a),tz=Sz(p),XU(nz=$U((az=$e((iz=function(e){Pe(n,e);var t=Be(n);function n(){var e;Ae(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"playButton",az,Me(e)),Xe(e,"goalText",rz,Me(e)),Xe(e,"levelText",oz,Me(e)),Xe(e,"missionText",sz,Me(e)),Xe(e,"playButtonComponent",lz,Me(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StartLevelScreen: screen not found");e.validateEventPayload(t)&&(e.playButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Re(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Tz.on(Cz.OPENING_SCREEN,this.handleOpeningScreen),Tz.on(Cz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Tz.off(Cz.OPENING_SCREEN,this.handleOpeningScreen),Tz.off(Cz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){var t=null!=e?e:{},n=t.screenName,i=t.screenData;return n===this.node.name&&(null!=i&&i.level&&(this.levelId=i.level),null!=i&&i.mission&&(this.mission=i.mission),!0)}},{key:"open",value:function(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(Ka.HIDE_UI)}},{key:"close",value:function(){this.playButtonComponent.interactable=!1,Tz.emit(Cz.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ka.SHOW_UI)}},{key:"updateComponents",value:function(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}},{key:"updateGoalText",value:function(){var e=this.mission.mission;this.goalText.getComponent(u).string=e>1?"Goals":"Goal"}},{key:"updateLevelText",value:function(){this.levelText.getComponent(u).string=`Level ${this.levelId}`}},{key:"updateDescriptionText",value:function(){this.missionText.getComponent(u).string=this.mission.description}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedPlay",value:function(){this.node.scene.emit(Ka.GAME_START),this.close()}}]),n}(f)).prototype,"playButton",[QU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rz=$e(iz.prototype,"goalText",[JU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oz=$e(iz.prototype,"levelText",[ZU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sz=$e(iz.prototype,"missionText",[ez],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lz=$e(iz.prototype,"playButtonComponent",[tz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nz=iz))||nz);n._RF.pop(),n._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var Az,xz,Rz,Iz,Pz,_z,Lz,Oz,Dz,Nz,Mz,Fz,Bz,Gz,Uz,zz,Hz,qz,Vz,Wz,Kz,jz,Yz,Xz,$z,Qz,Jz=i.ccclass,Zz=i.property,eH=(yz=Jz("TournamentLeaderSkeleton"),mz=Zz(a),yz((wz=$e((bz=function(e){Pe(a,e);var t,n,i=Be(a);function a(){var e;Ae(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"container",wz,Me(e)),e}return Re(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(D),this.validateRequiredComponents()}},{key:"hide",value:(n=Te(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Te(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,i=this.container.position.clone(),this.container.position=new j(i.x,i.y-100,i.z),(a=S(this.node).delay(t)).to(.2,{scale:j.ONE},{easing:"elasticOut"}),(r=S(this.container).delay(t)).to(.2,{position:i},{easing:"backOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),e.next=13,Promise.all([yn.runTweenAsync(a,n),yn.runTweenAsync(r,n),yn.runTweenAsync(o,n)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(f)).prototype,"container",[mz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gz=bz))||gz);n._RF.pop(),n._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var tH,nH=i.ccclass,iH=i.property,aH=i.requireComponent,rH=GameCore.Events,oH=GameCore.Utils.Object,sH=globalThis.game,lH=sH.event,uH=sH.storage,cH=sH.player,hH=sH.leaderboard;Az=nH("TournamentDetailScreen"),xz=aH(aN),Rz=iH(u),Iz=iH(u),Pz=iH(u),_z=iH(cP),Lz=iH(s),Oz=iH({type:a,group:"Buttons"}),Dz=iH({type:a,group:"Buttons"}),Nz=iH({type:a,group:"Buttons"}),Mz=iH({type:[eH]}),Fz=iH({type:[A]}),Bz=iH(Ow),Az(Gz=xz((zz=$e((Uz=function(e){Pe(f,e);var t,n,i,a,r,o,s,l,u,c,h,p,d=Be(f);function f(){var e;Ae(this,f);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=d.call.apply(d,[this].concat(n)),"titleLabel",zz,Me(e)),Xe(e,"timeLabel",Hz,Me(e)),Xe(e,"playerCountLabel",qz,Me(e)),Xe(e,"tournamentLeaders",Vz,Me(e)),Xe(e,"viewport",Wz,Me(e)),Xe(e,"playButton",Kz,Me(e)),Xe(e,"continueButton",jz,Me(e)),Xe(e,"replayButton",Yz,Me(e)),Xe(e,"leaderSkeletons",Xz,Me(e)),Xe(e,"banners",$z,Me(e)),Xe(e,"paperConfetti",Qz,Me(e)),e.animAbortSignal=null,e.fetchAbortController=null,e.leadersPayload=null,e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("TournamentDetailScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Re(f,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(aN),this.tournamentScrollView=this.tournamentLeaders.node.getComponent(le),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){lH.on(rH.OPENING_SCREEN,this.handleOpeningScreen),lH.on(rH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){lH.off(rH.OPENING_SCREEN,this.handleOpeningScreen),lH.off(rH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"updateVisibility",value:function(){this.tournamentLeaders.updateVisibility()}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function(){if(this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(Ka.HIDE_UI),this.tournamentScrollView.node.on(le.EventType.SCROLLING,this.updateVisibility,this),null!==this.animAbortSignal)throw new Error("TournamentContent: TournamentContent is already loading. Please handle cancelling gracefully.");this.animAbortSignal=new qi,this.updateInfo(this.animAbortSignal)}},{key:"close",value:function(){Yl.closeTournamentDetailScreen(),this.node.scene.emit(Ka.SHOW_UI),this.tournamentScrollView.node.off(le.EventType.SCROLLING,this.updateVisibility,this),this.cleanup()}},{key:"cleanup",value:function(){var e,t;null===(e=this.fetchAbortController)||void 0===e||e.abort(),null===(t=this.animAbortSignal)||void 0===t||t.abort(),this.animAbortSignal=null,this.fetchAbortController=null,this.tournamentLeaders.removeLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(p=Te(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b,w,k,S;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=this.payload)||void 0===n||null===(n=n.screenData)||void 0===n?void 0:n.tournament){e.next=3;break}return e.abrupt("return");case 3:return(o=JSON.parse(r)).id=o.id.toString(),this.tournamentPayload=o,s=this.tournamentPayload,l=s.endTime,u=s.payload,c=s.title,h=u.leaderboardId,p=void 0===h?"":h,d=u.themeId,this.updateTitle(c),this.updateEndTime(l),this.updateTournamentBanner(d),f=uH.getStorage("tournament"),v=f.previousScore,y=f.previousRank,m=f.animateTournamentLeader,this.updateButtonsVisibility(m),e.next=15,this.showLoading(t);case 15:return e.next=17,this.getLeadersPayload(p);case 17:if(this.leadersPayload=e.sent,this.leadersPayload){e.next=22;break}return this.updatePlayerCount(0),this.hideLoading(t),e.abrupt("return");case 22:return g=this.leadersPayload,b=g.player,w=g.leaders,this.updatePlayerCount(w.length),k=null!==(i=null==b?void 0:b.score)&&void 0!==i?i:0,S=null!==(a=null==b?void 0:b.rank)&&void 0!==a?a:0,b&&m&&v&&v<k&&y&&y!==S&&(w.find((function(e){return e.playerId===b.playerId})).score=v),e.next=29,this.hideLoading(t);case 29:return this.tournamentLeaders.updateData(w),e.next=32,this.runShowUpAnimation(t);case 32:if(m){e.next=34;break}return e.abrupt("return");case 34:return uH.setStorageData("tournament","animateTournamentLeader",!1),e.next=37,this.runPlayerRankChangeAnimation(t,k);case 37:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"updateTournamentBanner",value:function(e){e?this.activateThemeBanner(e):this.activateThemeBanner(ol.SUMMER)}},{key:"activateThemeBanner",value:function(e){var t=!1;this.banners.forEach((function(n){n.node.active=n.node.name.toLowerCase()===e,n.node.active&&(t=!0)})),t||this.banners.forEach((function(e){e.node.active=e.node.name.toLowerCase()===ol.SUMMER}))}},{key:"showLoading",value:(h=Te(Se().mark((function e(t){var n,i=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:0,e.next=3,Promise.all([this.leaderSkeletons.map((function(e,i){return e.show(i*n,t)}))]);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"hideLoading",value:(c=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.leaderSkeletons.map((function(e){return e.hide(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"runShowUpAnimation",value:(u=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tournamentLeaders.showLeaders(t);case 2:if(n=this.tournamentLeaders.getPlayerLeader()){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this.scrollToLeader(n,1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(l=Te(Se().mark((function e(t,n){var i,a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.tournamentLeaders.getLeaderData(),a=i.find((function(e){return e.playerId===cH.getPlayerId()}))){e.next=4;break}return e.abrupt("return");case 4:if(r=a.score,o=a.rank,r!==n){e.next=7;break}return e.abrupt("return");case 7:if(a.score=n,i.sort((function(e,t){return t.score-e.score})),i.forEach((function(e,t){e.rank=t+1})),s=this.tournamentLeaders.getPlayerLeader()){e.next=13;break}return e.abrupt("return");case 13:if(l=this.tournamentLeaders.getLeaderByRank(a.rank)){e.next=16;break}return e.abrupt("return");case 16:return this.tournamentLeaders.layout.enabled=!1,s.node.setParent(this.node,!0),e.next=20,s.runScaleAnimation(t,1.1,.5);case 20:return a.rank<=10&&Jn.playSound(Hn.STAR_CHEST_DRUM_ROLL),u=Math.min(.5*(o-a.rank),2),c=[s.runUpdateDataAnimation(o,a.rank,r,a.score,u),this.scrollToLeader(l,u)],h=this.viewport.contentSize.height,p=this.viewport.getBoundingBoxToWorld(),d=this.tournamentScrollView.getMaxScrollOffset().y,f=-l.node.position.y-h/2,v=j.ZERO,f<0?v=new j(s.node.worldPosition.x,p.yMax+l.node.position.y,s.node.worldPosition.z):this.tournamentScrollView.getScrollOffset().y>=d-5&&(v=f<d?new j(s.node.worldPosition.x,p.center.y,s.node.worldPosition.z):l.node.worldPosition),v.equals(j.ZERO)||c.push(s.runWorldPositionAnimation(v,u)),e.next=32,Promise.all(c);case 32:return Jn.stopSound(Hn.STAR_CHEST_DRUM_ROLL),e.next=35,Promise.all([s.runScaleAnimation(t,1,.25),s.node.setParent(this.tournamentLeaders.layout.node,!0),s.node.setSiblingIndex(a.rank-1),this.tournamentLeaders.runUpdateLeadersRankAnimation(a.rank,o),this.runPaperConfettiEffect(a.rank)]);case 35:this.tournamentLeaders.layout.enabled=!0,this.tournamentLeaders.layout.updateLayout();case 37:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"runPaperConfettiEffect",value:function(e){e>10||(this.paperConfetti.runEffect(),Jn.playSound(Hn.LEADERBOARD_TRIUMPH))}},{key:"scrollToLeader",value:(s=Te(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.tournamentLeaders.uiTransform.contentSize,a=new $(0,-t.node.position.y-i.height/2),r=this.tournamentScrollView.getScrollOffset().clone(),a.y=Math.max(a.y,0),r.y=Math.max(r.y,0),o=a.y-r.y,!(Math.abs(o)<5)){e.next=8;break}return e.abrupt("return");case 8:return this.tournamentScrollView.scrollToOffset(a,n),e.abrupt("return",yn.waitTweenAsync(n));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"updateTitle",value:function(e){e&&(this.titleLabel.string=e)}},{key:"updateEndTime",value:function(e){var t=GameCore.Utils.Time.getRelativeTime(e);t=(t=t.replace("seconds","secs").replace("second","sec")).replace("minutes","mins").replace("minute","min"),this.timeLabel.string=`Ends ${t}`}},{key:"updatePlayerCount",value:function(e){var t=GameCore.Utils.Number.getShortNumber(e,3);this.playerCountLabel.string=`${t} `+(e>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"getLeadersPayload",value:(o=Te(Se().mark((function e(t){var n,i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=hH.getLeaderboardName(t)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,hH.requestLeaderboardAsync(n,0);case 5:if(i=hH.getLeaderboard(n)){e.next=8;break}return e.abrupt("return",null);case 8:for(a=Object.values(i.leaders),r=cH.getPlayerId(),o={leaders:[],player:void 0,isPlayerInTournament:!1},s=0,l=a;s<l.length;s++)(u=l[s]).playerId===r?(o.player=u,o.isPlayerInTournament=!0,o.leaders.push(u)):o.leaders.push(u);return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(e){this.playButton.active=!e,this.continueButton.active=e,this.replayButton.active=e}},{key:"handleOnPlay",value:(r=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.tournamentPayload.id||"",!tu.validateTournamentExpired(t)){e.next=7;break}return this.close(),this.node.scene.emit(qs.RELOAD_TOURNAMENT),Yl.showNotificationScreen("Tournament has ended",2),e.abrupt("return");case 7:return e.prev=7,Yl.showLoadingNotificationScreen(),e.next=11,this.processJoinTournament();case 11:e.next=30;break;case 13:if(e.prev=13,e.t0=e.catch(7),!oH.hasOwn(e.t0,"code")||"USER_INPUT"!==e.t0.code){e.next=18;break}return Yl.closeNotificationScreen(),e.abrupt("return");case 18:return e.prev=18,e.next=21,this.processContinueTournament();case 21:e.next=30;break;case 23:if(e.prev=23,e.t1=e.catch(18),!oH.hasOwn(e.t1,"code")||"USER_INPUT"!==e.t1.code){e.next=28;break}return Yl.closeNotificationScreen(),e.abrupt("return");case 28:console.error("processPlayButtonPressed",e.t1),Yl.showNotificationScreen("Sorry, you cannot join\nat this time.",2);case 30:case"end":return e.stop()}}),e,this,[[7,13],[18,23]])}))),function(){return r.apply(this,arguments)})},{key:"processJoinTournament",value:(a=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.joinTournamentAsync();case 3:Dl.switchScene(Us,{level:1}),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.warn("processJoinTournament",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return a.apply(this,arguments)})},{key:"processContinueTournament",value:(i=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.continueTournamentAsync();case 3:Dl.switchScene(Us,{level:1}),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.warn("processContinueTournament",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return i.apply(this,arguments)})},{key:"joinTournamentAsync",value:(n=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.tournamentPayload.id||"",e.next=3,Cl.joinTournamentAsync(t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"continueTournamentAsync",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null!==(t=GameSDK.context.getID())&&void 0!==t?t:"",e.next=3,Cl.continueTournamentAsync(n);case 3:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var e,t,n=(null!==(e=null===(t=this.payload)||void 0===t?void 0:t.screenData)&&void 0!==e?e:{}).tournamentContextType;switch(void 0===n?"tournament_start":n){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}}]),f}(f)).prototype,"titleLabel",[Rz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hz=$e(Uz.prototype,"timeLabel",[Iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qz=$e(Uz.prototype,"playerCountLabel",[Pz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vz=$e(Uz.prototype,"tournamentLeaders",[_z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wz=$e(Uz.prototype,"viewport",[Lz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kz=$e(Uz.prototype,"playButton",[Oz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jz=$e(Uz.prototype,"continueButton",[Dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yz=$e(Uz.prototype,"replayButton",[Nz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xz=$e(Uz.prototype,"leaderSkeletons",[Mz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$z=$e(Uz.prototype,"banners",[Fz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qz=$e(Uz.prototype,"paperConfetti",[Bz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gz=Uz))||Gz);n._RF.pop(),n._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,i.ccclass)("TournamentLeader")(tH=function(e){Pe(n,e);var t=Be(n);function n(){return Ae(this,n),t.apply(this,arguments)}return Re(n)}(zI));n._RF.pop(),n._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var pH=GameCore.Events,dH=globalThis.game,fH=dH.event,vH=dH.monitorError,yH=function(){function e(){var t=this;Ae(this,e),this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=function(){if(!t.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void(null==vH||vH.sendException(new Error("Core: Booting callback is not set")));console.info("🚀 Core: Boot"),t.callbackCoreBooting(),t.callbackCoreBooting=null},this.handleWhenCoreStarting=function(){if(!t.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void(null==vH||vH.sendException(new Error("Core: Starting callback is not set")));console.info("🚀 Core: Starting"),t.callbackCoreStarting(),t.callbackCoreStarting=null},this.handleWhenCoreReady=function(){if(!t.callbackCoreReady)return console.error("Core: Ready callback is not set"),void(null==vH||vH.sendException(new Error("Core: Ready callback is not set")));console.info("🚀 Core: Ready"),t.callbackCoreReady(),t.callbackCoreReady=null}}return Re(e,[{key:"init",value:function(){this.listenEvents(),console.info("Core Manager: Initialized")}},{key:"listenEvents",value:function(){fH.once(pH.CORE_BOOTING,this.handleWhenCoreBooting),fH.once(pH.CORE_STARTING,this.handleWhenCoreStarting),fH.once(pH.CORE_READY,this.handleWhenCoreReady)}},{key:"requestStart",value:function(){fH.emit(pH.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(e){this.callbackCoreBooting=e,fH.getEventEmitCount(pH.CORE_BOOTING)>0&&(fH.off(pH.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}},{key:"onCoreStart",value:function(e){this.callbackCoreStarting=e,fH.getEventEmitCount(pH.CORE_STARTING)>0&&(fH.off(pH.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}},{key:"onCoreReady",value:function(e){this.callbackCoreReady=e,fH.getEventEmitCount(pH.CORE_READY)>0&&(fH.off(pH.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}]),e}();n._RF.pop(),n._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var mH=GameCore,gH=mH.Configs,bH=mH.Utils,wH=gH.GameEngine,kH=bH.Valid,SH=function(){function e(){var t=this;Ae(this,e),this.overrideSettings=function(){ve.overrideSettings(ye.Category.ENGINE,"debug",kH.isDebugger())},this.handleResizeView=function(e){se.instance.resizeWithBrowserSize(!1);var n=e.width,i=e.height;t.resizeView(n,i)},this.handleViewResized=function(e){var t=e.width,n=e.height;se.instance.resizeWithBrowserSize(!0),console.info("✨ New View Size",{width:t,height:n})}}return Re(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){V.on(Yi,this.handleResizeView),V.on(Xi,this.handleViewResized)}},{key:"setupAutoAtlas",value:function(){pe.instance.cacheAsset=!0}},{key:"setupDynamicAtlas",value:function(){switch(K.os){case K.OS.IOS:this.setupDynamicAtlasForIOS();break;case K.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(e){var t=e.Enabled,n=e.AutoAtlasSize,i=e.MaxAtlasCount,a=e.MaxAtlasSize,r=e.MaxFrameSize;if(de.instance.enabled=t,de.instance.textureSize=a,de.instance.maxFrameSize=r,de.instance.maxAtlasCount=i,de.instance.textureBleeding=!0,n){var o=this.getMaxTextureSize();if(!o)return;de.instance.maxAtlasCount=1,de.instance.textureSize=o}}},{key:"getMaxTextureSize",value:function(){if(!d.root)return-1;var e=d.root.device.capabilities.maxTextureSize;return e>8192?7168:e-1024}},{key:"setupDynamicAtlasForIOS",value:function(){var e=wH.DynamicAtlas.IOS;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForAndroid",value:function(){var e=wH.DynamicAtlas.Android;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForDesktop",value:function(){var e=wH.DynamicAtlas.Desktop;this.setDynamicAtlas(e)}},{key:"setupBatcherLimit",value:function(){fe.BATCHER2D_MEM_INCREMENT=288,fe.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(e,t){var n,i=window.devicePixelRatio,a=i>=2?2/i:1,r=e*i*a,o=t*i*a;null===(n=d.root)||void 0===n||n.resize(r,o),F.windowSize=new B.Size(r,o),V.emit(Xi,{width:r,height:o})}}]),e}();n._RF.pop();var EH,CH=new(function(){function e(){Ae(this,e),this._registry={},this._moduleCache={}}return Re(e,[{key:"define",value:function(e,t,n){this._registry[e]={factory:t,resolveMap:n}}},{key:"require",value:function(e){return this._require(e)}},{key:"throwInvalidWrapper",value:function(e,t){throw new Error(`Module '${e}' imported from '${t}' is expected be an ESM-wrapped CommonJS module but it doesn't.`)}},{key:"_require",value:function(e,t){var n=this._moduleCache[e];if(n)return n.exports;var i={id:e,exports:{}};return this._moduleCache[e]=i,this._tryModuleLoad(i,e),i.exports}},{key:"_resolve",value:function(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}},{key:"_resolveFromInfos",value:function(e,t){var n,i;return e in cjsInfos?e:t&&null!==(n=null===(i=cjsInfos[t])||void 0===i?void 0:i.resolveCache[e])&&void 0!==n?n:void 0}},{key:"_tryModuleLoad",value:function(e,t){var n=!0;try{this._load(e,t),n=!1}finally{n&&delete this._moduleCache[t]}}},{key:"_load",value:function(e,t){var n=this._loadWrapper(t),i=n.factory,a=n.resolveMap,r=this._createRequire(e),o=a?this._createRequireWithResolveMap("function"==typeof a?a():a,r):r;i(e.exports,o,e)}},{key:"_loadWrapper",value:function(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}},{key:"_loadHostProvidedModules",value:function(e){return{factory:function(t,n,i){if("undefined"==typeof require)throw new Error(`Current environment does not provide a require() for requiring '${e}'.`);try{i.exports=require(e)}catch(t){throw new Error(`Exception thrown when calling host defined require('${e}').`,{cause:t})}}}}},{key:"_createRequire",value:function(e){var t=this;return function(n){return t._require(n,e)}}},{key:"_createRequireWithResolveMap",value:function(e,t){return function(n){var i=e[n];if(i)return t(i);throw new Error("Unresolved specifier "+n)}}},{key:"_throwUnresolved",value:function(e,t){throw new Error(`Unable to resolve ${e} from ${parent}.`)}}]),e}()),TH="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";CH.define(TH,(function(e,t,n,i,a){!function(t,i){"object"==typeof e&&void 0!==n?n.exports=i():"function"==typeof define&&define.amd?define(i):t.ResizeObserver=i()}(this,(function(){var e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,i){return e[0]===t&&(n=i,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(t,n){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,i=e(n,t);~i&&n.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,i=this.__entries__;n<i.length;n++){var a=i[n];e.call(t,a[1],a[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,n="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),i="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],r="undefined"!=typeof MutationObserver,o=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,a=!1,r=0;function o(){n&&(n=!1,e()),a&&l()}function s(){i(o)}function l(){var e=Date.now();if(n){if(e-r<2)return;a=!0}else n=!0,a=!1,setTimeout(s,t);r=e}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),r?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;a.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var a=i[n];Object.defineProperty(e,a,{value:t[a],enumerable:!1,writable:!1,configurable:!0})}return e},l=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||n},u=v(0,0,0,0);function c(e){return parseFloat(e)||0}function h(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+c(e["border-"+n+"-width"])}),0)}function p(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return u;var i=l(e).getComputedStyle(e),a=function(e){for(var t={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var a=i[n],r=e["padding-"+a];t[a]=c(r)}return t}(i),r=a.left+a.right,o=a.top+a.bottom,s=c(i.width),p=c(i.height);if("border-box"===i.boxSizing&&(Math.round(s+r)!==t&&(s-=h(i,"left","right")+r),Math.round(p+o)!==n&&(p-=h(i,"top","bottom")+o)),!function(e){return e===l(e).document.documentElement}(e)){var d=Math.round(s+r)-t,f=Math.round(p+o)-n;1!==Math.abs(d)&&(s-=d),1!==Math.abs(f)&&(p-=f)}return v(a.left,a.top,s,p)}var d="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof l(e).SVGGraphicsElement}:function(e){return e instanceof l(e).SVGElement&&"function"==typeof e.getBBox};function f(e){return t?d(e)?function(e){var t=e.getBBox();return v(0,0,t.width,t.height)}(e):p(e):u}function v(e,t,n,i){return{x:e,y:t,width:n,height:i}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=f(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),m=function(e,t){var n,i,a,r,o,l,u,c=(i=(n=t).x,a=n.y,r=n.width,o=n.height,l="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(l.prototype),s(u,{x:i,y:a,width:r,height:o,top:a,right:i+r,bottom:o+a,left:i}),u);s(this,{target:e,contentRect:c})},g=function(){function t(t,n,i){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=i}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new m(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),b="undefined"!=typeof WeakMap?new WeakMap:new e,w=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=o.getInstance(),i=new g(t,n,this);b.set(this,i)};return["observe","unobserve","disconnect"].forEach((function(e){w.prototype[e]=function(){var t;return(t=b.get(this))[e].apply(t,arguments)}})),void 0!==n.ResizeObserver?n.ResizeObserver:w})),EH=n.exports}),{}),CH.require(TH),n._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var AH=la,xH=ua,RH=xH.Portrait,IH=xH.Landscape,PH=GameCore.Utils.Function,_H=function(){function e(){var t=this;Ae(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(e){console.info("📱 View resize by system"),window.devicePixelRatio=e||window.devicePixelRatio,t.setupOrientationByScreenSize(),t.resizeGameView()},this.handleViewResize=PH.debounce((function(){console.info("📱 View resize by window"),t.setupOrientationByScreenSize(),t.resizeGameView()}),200),this.handleBodyResize=PH.debounce((function(){t.resizeGameDiv()&&(console.info("📱 View resize by body"),t.setupOrientationByScreenSize(),t.resizeGameView())}),200)}return Re(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),V.emit($i),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){K.isBrowser?(F.on("window-resize",this.handleViewResize,this),F.on("orientation-change",this.handleViewResize,this)):K.isMobile?window.addEventListener("resize",this.handleViewResize,{capture:!1,passive:!0}):console.warn("LayoutManager: Not support this platform"),V.on($i,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){new EH(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){se.instance.resizeWithBrowserSize(!0),se.instance.setOrientation(fe.ORIENTATION_AUTO),se.instance.setResolutionPolicy(me.ContentStrategy.FIXED_WIDTH),se.instance.setResolutionPolicy(me.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=se.instance.getResolutionPolicy()}},{key:"setupOrientationByScreenSize",value:function(){var e=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(me.ContentStrategy.FIXED_WIDTH),e<1?this.setPortraitView():this.setLandscapeView()}},{key:"resizeGameDiv",value:function(){var e=document.getElementById("GameDiv");if(!e)return!1;var t=Li.getScreenWidthCss(),n=Li.getScreenHeightCss(),i=e.getBoundingClientRect(),a=i.width,r=i.height;return(t!==a||n!==r)&&(e.style.width=`${t}px`,e.style.height=`${n}px`,!0)}},{key:"resizeGameView",value:function(){var e=Li.getScreenWidthCss(),t=Li.getScreenHeightCss();V.emit(Yi,{width:e,height:t})}},{key:"setPortraitView",value:function(){var e=RH.WIDTH,t=RH.HEIGHT;this.currentLayout=AH.Portrait,this.changeDesignResolutionSize(e,t)}},{key:"setLandscapeView",value:function(){var e=IH.WIDTH,t=IH.HEIGHT;this.currentLayout=AH.Landscape,this.changeDesignResolutionSize(e,t)}},{key:"changeDesignResolutionSize",value:function(e,t){se.instance.setDesignResolutionSize(e,t,this.resolutionPolicy),V.emit(Qi,this.currentLayout),console.info("📱 Change layout to",this.currentLayout)}},{key:"getScreenRatio",value:function(){return Li.getScreenWidthCss()/Li.getScreenHeightCss()}}]),e}();n._RF.pop(),n._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var LH=GameCore,OH=LH.Utils,DH=LH.Dtos,NH=OH.Valid,MH=["code","cols","encoding","idSize","rows"],FH=["addRandomTilesPerMove","maxSpaceOfPair"],BH=function(){function e(){Ae(this,e)}return Re(e,[{key:"init",value:function(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function(){var e=DH.Match;e.CustomData.addDefaultData(Fs),e.CustomData.addValidateFunction("score",(function(e){if(!NH.isNumber(e)||e<0)throw new Error(`score ${e} is invalid`)}))}},{key:"setupMatchData",value:function(){var e=this,t=DH.Match;t.Data.addDefaultData(Is),t.Data.addValidateFunction("extraData",(function(t){if(null!=t){if(!NH.isObject(t))throw new Error(`extraData ${t} must be a record of string keys`);var n=t,i=Object.keys(n);if(!i.includes("level"))throw new Error("extraData.level is missing");if(!NH.isNumber(n.level))throw new Error(`extraData.level ${n.level} must be a number`);if(!i.includes("fen"))throw new Error("extraData.fen is missing");if(e.validateFen(n.fen),!i.includes("gravity"))throw new Error("extraData.gravity is missing");if(!NH.isString(n.gravity))throw new Error(`extraData.gravity ${n.gravity} must be a string`);if(!i.includes("rules"))throw new Error("extraData.rules is missing");if(e.validateLevelRules(n.rules),!i.includes("time"))throw new Error("extraData.time is missing");if(!NH.isNumber(n.time))throw new Error(`extraData.time ${n.time} must be a number`)}}))}},{key:"validateFen",value:function(e){if(!NH.isObject(e))throw new Error(`extraData.fen ${e} must be a record of string keys`);var t=this.validateKeys(e,MH);if(!NH.isNumber(t.idSize))throw new Error("fen.idSize must be a number");if(!NH.isString(t.code))throw new Error("fen.code must be a string");if(!NH.isNumber(t.rows))throw new Error("fen.rows must be a number");if(!NH.isNumber(t.cols))throw new Error("fen.cols must be a number");if(!NH.isObject(t.encoding))throw new Error("fen.encoding must be a record of string keys");var n=this.validateKeys(t.encoding,Object.values(Uu));Object.entries(n).forEach((function(e){var t=qe(e,2),n=t[0],i=t[1];if(!NH.isString(i))throw new Error(`fen.encoding.${n} ${i} must be a string`)}))}},{key:"validateLevelRules",value:function(e){if(!NH.isObject(e))throw new Error(`extraData.rules ${e} must be a record of string keys`);var t=this.validateKeys(e,FH);if(!NH.isNumber(t.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!NH.isNumber(t.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function(e,t){return Object.keys(e).forEach((function(e){if(!t.includes(e))throw new Error(`Key ${e} is missing`)})),e}}]),e}();n._RF.pop(),n._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var GH=GameCore,UH=GH.Utils,zH=GH.Dtos,HH=UH.Valid,qH=globalThis.game.player,VH=function(){function e(){Ae(this,e)}return Re(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var e=zH.Player;e.Data.addDefaultData(Bs),e.GameData.addDefaultData(Ls),e.GameData.addValidateFunction("stars",(function(e){if(!HH.isNumber(e)||e<0)throw new Error(`stars ${e} is invalid`)})),e.GameData.addValidateFunction("totalLevel",(function(e){if(!HH.isNumber(e)||e<1)throw new Error(`totalLevel ${e} is invalid`)})),e.GameData.addValidateFunction("levelVersion",(function(e){if(!HH.isNumber(e)||e<0)throw new Error(`levelVersion ${e} is invalid`)})),e.GameData.addValidateFunction("lastRewardedItems",(function(e){if(!HH.isNumber(e)||e<0)throw new Error(`lastRewardedItems ${e} is invalid`)})),e.GameData.addValidateFunction("lastCreateTournamentShown",(function(e){if(!HH.isNumber(e)||e<0)throw new Error(`lastCreateTournamentShown ${e} is invalid`)})),e.GameData.addValidateFunction("guideItemShowed",(function(e){if(!Array.isArray(e))throw new Error(`guideItemShowed ${e} is invalid`)})),e.GameData.addValidateFunction("items",(function(e){if(!HH.isObject(e))throw new Error(`items ${e} is invalid`);var t=Object.keys(e),n=Object.values(e);if(!t.includes(vs.HINT))throw new Error(`item ${vs.HINT} not found`);if(!t.includes(vs.THUNDER))throw new Error(`item ${vs.THUNDER} not found`);if(!t.includes(vs.STORM))throw new Error(`item ${vs.STORM} not found`);if(!t.includes(vs.PLIERS))throw new Error(`item ${vs.PLIERS} not found`);n.forEach((function(e){if(!HH.isNumber(e)||e<0)throw new Error(`item ${e} is invalid`)}))})),e.GameData.addValidateFunction("skins",(function(e){if(!HH.isObject(e))throw new Error(`skins ${e} is invalid`)}))}},{key:"requestConnectedPlayers",value:function(){qH.requestConnectedPlayers().catch((function(e){console.warn("player.requestConnectedPlayers",e)}))}}]),e}();n._RF.pop(),n._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var WH=GameCore,KH=WH.Events,jH=WH.Utils.Valid,YH=globalThis.game,XH=YH.event,$H=YH.adaptivePerformance,QH=function(){function e(){var t=this;Ae(this,e),this.handleBeginFrame=function(){d.on(Q.EVENT_AFTER_UPDATE,t.lateUpdate),d.on(Q.EVENT_BEFORE_UPDATE,t.updateActualFPS)},this.handleAfterSceneLaunch=function(e){$H&&$H.trackingScene(e.name)},this.handleRequestResizeGame=function(e){var t=e.forcePixelRatio;jH.isNumber(t)&&V.emit($i,t)},this.lateUpdate=function(){var e=1e3*V.deltaTime;null==$H||$H.updatePostStepDeltaTime(e)},this.updateActualFPS=function(){var e,t=null===(e=d.root)||void 0===e?void 0:e.fps;jH.isNumber(t)&&(null==$H||$H.updateActualFPS(t))}}return Re(e,[{key:"init",value:function(){$H&&this.listenEvents()}},{key:"listenEvents",value:function(){XH.on(KH.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),d.once(Q.EVENT_BEGIN_FRAME,this.handleBeginFrame),d.on(Q.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();n._RF.pop(),n._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var JH=globalThis.game.canvasRecorder,ZH=function(){function e(){Ae(this,e)}return Re(e,[{key:"init",value:function(){if(V.canvas&&JH){JH.setCanvas(V.canvas);var e=JH.getOptions(),t=JH.waitNextFrame;JH.waitNextFrame=Te(Se().mark((function n(){return Se().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.syncFps){n.next=4;break}return n.abrupt("return",new Promise((function(e){d.once(Q.EVENT_AFTER_RENDER,e),V.pause(),V.step()})));case 4:return V.resume(),n.next=7,t.call(JH);case 7:return n.abrupt("return",Promise.resolve());case 8:case"end":return n.stop()}}),n)})))}}}]),e}();n._RF.pop(),n._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var eq=function(){function e(){var t=this;Ae(this,e),this.hideCocosStats=function(){clearInterval(t.waiter),t.waiter=setInterval(t.checkProfilerReady,100)},this.checkProfilerReady=function(){if(W){W._showFPS=!1;var e=W._rootNode;e&&(e.active=!1,e.isValid&&(e.destroyAllChildren(),e.removeAllChildren(),e.destroy(),clearInterval(t.waiter)))}}}return Re(e,[{key:"init",value:function(){W&&d.on(Q.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();n._RF.pop(),n._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var tq=GameCore,nq=tq.Configs,iq=tq.Events,aq=nq.GameEngine,rq=globalThis.game.event,oq=[".png",".jpg",".jpeg",".webp"],sq=function(){function e(){var t=this;Ae(this,e),this.useHighQuality=!1,this.upgradableAssets=new Map,this.requestUpdateDynamicAssets=function(){V.emit(aa)},this.collectUpgradableAssets=function(e){var n,i=je(e.output=e.input);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(oq.includes(a.ext)&&!t.upgradableAssets.has(a.uuid)){t.useHighQuality&&(a.url=t.replaceAssetUrl(a.url),a.requestUpgrade=!0);var r={uuid:a.uuid,url:a.url,options:a.options,upgraded:a.upgraded,requestUpgrade:a.requestUpgrade,ext:a.ext};t.upgradableAssets.set(a.uuid,r)}}}catch(e){i.e(e)}finally{i.f()}},this.replaceAssetUrl=function(e){return t.useHighQuality?e.replace("native/","native32/"):e},this.handleUpgradeQuality=function(){t.useHighQuality=!0;var e=0,n=0,i=pe.instance,a=i.assets,r=i.loadAny,o=0;t.upgradableAssets.forEach((function(i){if(i.upgraded||i.requestUpgrade)e++;else{n++;var s=a.get(i.uuid);s instanceof _?(i.url=t.replaceAssetUrl(i.url),console.info("DynamicAssets: Process upgrade quality",i.uuid,i,s),r(i,i.options,(function(e,a){o++,e?console.warn("DynamicAssets: Upgrade error",e):(s.reset(a),i.upgraded=!0,t.upgradableAssets.set(i.uuid,i),console.info("DynamicAssets: Upgrade done",i.uuid,a,s),o>=n&&t.requestUpdateDynamicAssets())}))):console.warn("DynamicAssets: Asset not found",i.uuid)}})),console.warn("DynamicAssets: Upgradable Assets Info",{needUpgrade:n,upgraded:e,total:t.upgradableAssets.size})}}return Re(e,[{key:"init",value:function(){var e=aq.DynamicAssets.Enabled;console.info("DynamicAssets: init",{EDITOR:false,Enabled:e}),e&&(pe.instance.transformPipeline.insert(this.collectUpgradableAssets,3),this.listenEvents())}},{key:"listenEvents",value:function(){var e=this;V.on(ia,this.handleUpgradeQuality),rq.on(iq.SCENE_LAUNCHED,(function(t){var n=t.sceneName;[Gs].includes(n)||e.handleUpgradeQuality()}))}}]),e}();n._RF.pop(),n._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var lq=GameCore,uq=lq.Configs,cq=lq.Events,hq=uq.GameEngine,pq=globalThis.game.event,dq=function(){function e(){var t=this;Ae(this,e),this.result=[],this.requestUpdateDynamicAtlas=function(){requestAnimationFrame(t.updateDynamicAtlas)},this.createAtlas=function(){return de.instance.newAtlas()},this.updateDynamicAtlas=function(){var e=d.getScene();if(e){var n=e.getComponentsInChildren(ge),i=[];if(n.forEach((function(e){if(e.enabled&&e.node.activeInHierarchy)if("spriteFrame"in e){if(e.spriteFrame instanceof L){var t=e.spriteFrame,n=t.uuid,a=t.packable,r=t.texture,o=t.original;if(a)if(r instanceof be){var s=r.getId(),l=r.width,u=r.height,c=(null==o?void 0:o._texture)||{width:0,height:0},h=c.width,p=c.height;if(o){var d=o._texture.getId();if(s===d)return void console.warn("DynamicAtlas: Skip original texture",e.name,{ori:o._texture,tex:r});s=d}var f=(o?h:l)+2,v=(o?p:u)+2;i.push({id:s,name:n,w:f,h:v,x:-1,y:-1,comp:e})}else console.warn("DynamicAtlas: Skip non-texture2d texture",e.name);else console.warn("DynamicAtlas: Skip non-packable texture",e.name)}}else console.warn("DynamicAtlas: Skip non-sprite component",e.name,e)})),0!==i.length){console.info("DynamicAtlas: collect info",i);var a=[];i.forEach((function(e){a.find((function(t){return t.id===e.id}))||a.push(e)})),0!==a.length&&(t.result=[],t.resetDynamicAtlas(),t.fillTextures(a),t.refreshComponents(n))}}},this.calculateOptimizedAtlas=function(e,n){var i=Ve(e),a=function(e){var t,n=0,i=0,a=je(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;n+=r.w*r.h,i=Math.max(i,r.w)}}catch(e){a.e(e)}finally{a.f()}e.sort((function(e,t){return t.h-e.h}));var o,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),i),h:1/0}],l=0,u=0,c=je(e);try{for(c.s();!(o=c.n()).done;)for(var h=o.value,p=s.length-1;p>=0;p--){var d=s[p];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,u=Math.max(u,h.y+h.h),l=Math.max(l,h.x+h.w),h.w===d.w&&h.h===d.h){var f=s.pop();p<s.length&&(s[p]=f)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(s.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}}catch(e){c.e(e)}finally{c.f()}return{w:l,h:u,fill:n/(l*u)||0}}(i=e.reduce((function(e,t){return e.some((function(e){return e.id===t.id}))||e.push(t),e}),[])),r=a.w,o=a.h,s=a.fill;if(r>n||o>n){var l=i.slice(0,i.length-1);return t.calculateOptimizedAtlas(l,n)}return console.info("DynamicAtlas: packed map info",r,o,s,i),i},this.fillTextures=function(e){if(0!==e.length){var n=de.instance.textureSize;t.result=t.calculateOptimizedAtlas(e,n)}},this.drawTexture=function(e,n,i){var a=n.texture,r=a.getId(),o=t.result.find((function(e){return e.id===r}))||{x:-1,y:-1},s=o.x,l=o.y;if(s<0||l<0)return e.originalInsertSpriteFrame(n);var u=e._innerTextureInfos[r];u||(i&&(e._texture.drawTextureAt(a.image,s-1,l),e._texture.drawTextureAt(a.image,s+1,l),e._texture.drawTextureAt(a.image,s,l-1),e._texture.drawTextureAt(a.image,s,l+1)),e._texture.drawTextureAt(a.image,s,l),e._count++,e._innerTextureInfos[r]={texture:a,x:s,y:l});var c=n.rect,h=c.x,p=c.y;h+=(null==u?void 0:u.x)||s,p+=(null==u?void 0:u.y)||l;var d={texture:e._texture,x:h,y:p};return e._innerSpriteFrames.push(n),d},this.refreshComponents=function(e){e.forEach((function(e){e.node.active&&(e.node.active=!1,e.node.active=!0)}))}}return Re(e,[{key:"init",value:function(){var e=hq.DynamicAtlas.TextureAtlasOptimize;e&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:e}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){V.on(aa,this.requestUpdateDynamicAtlas),pq.on(cq.SCENE_LAUNCHED,this.requestUpdateDynamicAtlas)}},{key:"overrideDynamicAtlas",value:function(){var e=this,t=de.instance;de.instance.insertSpriteFrame=function(n){if(t._atlasIndex>=t._maxAtlasCount)return null;if(!n||n.original)return null;if(!n.packable)return null;var i=e.getAtlas(),a=i?i.insertSpriteFrame(n):null;return!a&&t._atlasIndex<t._maxAtlasCount?(i=e.getAtlas())?i.insertSpriteFrame(n):null:a}}},{key:"resetDynamicAtlas",value:function(){de.instance.reset()}},{key:"getAtlas",value:function(){var e=this,t=de.instance,n=t._atlases,i=void 0===n?[]:n,a=t._atlasIndex,r=t.textureBleeding,o=i[a];return o||(o=this.createAtlas()),o.originalInsertSpriteFrame||(o.originalInsertSpriteFrame=o.insertSpriteFrame,o.insertSpriteFrame=function(t){return e.drawTexture(o,t,r)}),o}}]),e}();n._RF.pop();var fq={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};n._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var vq=GameCore.Events,yq=globalThis.game,mq=yq.event,gq=yq.language,bq=function(){function e(){var t=this;Ae(this,e),this.handleLanguageChanged=function(){var e=Te(Se().mark((function e(n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n.locale,V.emit("update-language",i),t.updateComponentInEditor();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}var n,i,a;return Re(e,[{key:"init",value:function(){var e=this;this.addLanguage("en").then((function(){e.setLanguage("en"),e.listenEvent()}))}},{key:"listenEvent",value:function(){mq.on(vq.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(a=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLangData(t);case 2:n=e.sent,gq.add(t,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"setLanguage",value:function(e){gq.choose(e)}},{key:"getLangData",value:(i=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="en"===e.t0?3:"ru"===e.t0?4:5;break;case 3:return e.abrupt("return",fq);case 4:return e.abrupt("return",this.loadLanguageAsync(t));case 5:throw new Error(`Language ${t} not supported`);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"loadLanguageAsync",value:(n=Te(Se().mark((function e(n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.import(`db://assets/resources/locales/${n}.json`);case 2:i=e.sent.default,gq.add(n,i);case 4:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"updateComponentInEditor",value:function(){}}]),e}();n._RF.pop(),n._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var wq=GameCore,kq=wq.Configs,Sq=wq.Utils,Eq=kq.Mockup,Cq=Sq.Number,Tq=globalThis.game.leaderboard,Aq=function(){function e(){var t=this;Ae(this,e),this.handleWhenGameSDKStarted=function(){kq.Mockup.Leaderboards.Enabled?t.setupLeaderboardsMockup():t.setupLeaderboards()}}var t,n,i,a,r;return Re(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(r=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setupLeaderboardByConfigs();case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var e=kq.Leaderboards.LeaderboardId;e?(Tq.addLeaderboard({name:Os,type:"global",autoSortRank:!0,leaderboardId:e}),Tq.addLeaderboard({name:Ds,type:"friends",autoSortRank:!0,leaderboardId:e})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(a=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard();case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(i=Te(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Os,n=Ns,e.next=4,Tq.createLeaderboardAsync({_id:n,name:t,numberOfLeaders:100});case 4:return i=e.sent,Tq.addLeaderboard({name:t,type:"global",autoSortRank:!0,leaderboardId:i}),e.next=8,Tq.requestLeaderboardAsync(t,10);case 8:a=Tq.getLeaderboard(t),console.info("setupGlobalLeaderboard fetch new",a,a&&Object.keys(a.leaders).length),a=Tq.getLeaderboard(t),console.info("setupGlobalLeaderboard load more",a,a&&Object.keys(a.leaders).length);case 12:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(n=Te(Se().mark((function e(){var t,n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Ds,n=Ms,i=0,(a=Eq.GameSDK.Player.ConnectedPlayers).Enabled&&(i=Cq.random(a.NumOfPlayers)),e.next=7,Tq.createLeaderboardAsync({_id:n,name:t,numberOfLeaders:i});case 7:return r=e.sent,Tq.addLeaderboard({name:t,type:"friends",autoSortRank:!0,leaderboardId:r}),e.next=11,Tq.requestLeaderboardAsync(t,10);case 11:o=Tq.getLeaderboard(t),console.info("setupFriendsLeaderboard done",o);case 13:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,tu.requestTournamentDataAsync();case 2:(t=e.sent).forEach((function(e){var t=e.payload.leaderboardId;t&&(Tq.isExistLeaderboardId(t)||Tq.addLeaderboard({type:"tournament",name:t,autoSortRank:!0,leaderboardId:t}))})),console.info("setupGlobalTournamentLeaderboard done",t);case 5:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var xq=GameCore,Rq=xq.Configs,Iq=xq.Utils,Pq=xq.Events,_q=Rq.PerformanceMonitor,Lq=globalThis.game.event,Oq=function(){function e(){var t=this;Ae(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){t.startTraceFps()},this.handleLateUpdate=function(){if(t.mark){if(t.fpsTraceDuration-=V.deltaTime,t.fpsTraceDuration<=0&&!t.traceStopped)return t.traceStopped=!0,t.unListenEvents(),t.updateFPS(),void t.mark.stop(t.markName);t.fpsTraceIntervalTimer-=V.deltaTime,t.fpsTraceIntervalTimer>0||(t.fpsTraceIntervalTimer=t.fpsTraceInterval,t.updateFPS(),t.mark.stop(t.markName),t.startTraceFps())}}}return Re(e,[{key:"mark",get:function(){return _q.FpsTracking?Iq.Mark:null}},{key:"init",value:function(){var e=_q.FpsTracking,t=e.TrackingDuration,n=e.TrackingInterval;this.fpsTraceDuration=null!=t?t:60,this.fpsTraceInterval=null!=n?n:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){Lq.once(Pq.GAME_READY,this.handleStartTraceFps),d.on(Q.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"unListenEvents",value:function(){d.off(Q.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var e,t;if(this.mark){var n=this.getFPS(),i=this.getDrawCalls(),a=this.getDeviceRender(),r=this.getTextureMemory();this.minFps=Math.min(null!==(e=this.minFps)&&void 0!==e?e:n,n),this.maxFps=Math.max(null!==(t=this.maxFps)&&void 0!==t?t:0,n),this.mark.putMetric(this.markName,"FPS Metric",n),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",a),this.mark.putAttr(this.markName,"Draw Calls",i.toString()),this.mark.putAttr(this.markName,"Texture Memory",r.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info(`FPS: ${n} Min: ${this.minFps} Max: ${this.maxFps}, draw calls: ${i}, texture memory: ${r.toFixed(2)}MB`)}}},{key:"getFPS",value:function(){if(!d.root)return 0;var e=d.root.fps;return Math.floor(e)||0}},{key:"getDrawCalls",value:function(){return d.root&&d.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return d.root&&d.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return d.root&&d.root.device.memoryStatus.textureSize/1048576||0}}]),e}();n._RF.pop(),n._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var Dq=GameCore.Events,Nq=globalThis.game.event,Mq=function(){function e(){Ae(this,e),this.handleHotReload=function(){V.restart()},this.handleUpdateConfig=function(e){if("Gameplay"===e.type){V.emit(Ji,e.config);var t=e.id,n=e.type;Nq.emit(Dq.REMOTE_CONFIG_UPDATED,{id:t,type:n})}}}return Re(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){Nq.on(Dq.REQUEST_HOT_RELOAD,this.handleHotReload),Nq.on(Dq.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();n._RF.pop(),n._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var Fq=function(){function e(){Ae(this,e)}return Re(e,[{key:"init",value:function(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}},{key:"initLanguages",value:function(){(new bq).init()}},{key:"initCocosStats",value:function(){(new eq).init()}},{key:"initLeaderboards",value:function(){(new Aq).init()}},{key:"initRemoteConfig",value:function(){(new Mq).init()}},{key:"initDynamicAtlas",value:function(){(new dq).init()}},{key:"initDynamicAssets",value:function(){(new sq).init()}},{key:"initCanvasRecorder",value:function(){(new ZH).init()}},{key:"initPerformanceMonitor",value:function(){(new Oq).init()}},{key:"initAdaptivePerformance",value:function(){(new QH).init()}}]),e}();n._RF.pop(),n._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var Bq=globalThis.game.event,Gq=GameCore,Uq=Gq.Events,zq=Gq.Configs,Hq=Gq.Utils,qq=function(){function e(){var t=this;Ae(this,e),this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var e=Te(Se().mark((function e(n){var i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.sceneName,a=n.sceneData,r=t.correctSceneName(i),console.info("Switching",r,null!=a?a:{}),r){e.next=5;break}return e.abrupt("return");case 5:Yl.showLoadingFullScreen(r),t.startScene({sceneName:r,sceneData:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.preloadScene=function(e,n){var i=e.sceneName;t.startMeasure(i),d.preloadScene(i,t.onSceneProgress,t.onScenePreloaded(i,n))},this.startMeasure=function(e){t.mark&&(t.queueLoadScene[e]&&(t.mark.putAttr(t.markName,"Canceled","true"),t.stopMeasure(e)),console.groupCollapsed("📦 Load scene progress"),t.mark.measure(t.markName),t.mark.putAttr(t.markName,"Cancel","false"),t.mark.putAttr(t.markName,"Success","false"),t.mark.putMetric(t.markName,e),t.mark.start(t.markName),t.queueLoadScene[e]=!0)},this.stopMeasure=function(e){t.mark&&t.queueLoadScene[e]&&(t.mark.rmAttr(t.markName,"File"),t.mark.putAttr(t.markName,"Success","true"),t.mark.stop(t.markName),t.queueLoadScene[e]=!1,console.groupEnd())},this.onSceneProgress=function(e,n,i){var a=e/n;t.mark&&t.mark.putAttr(t.markName,"Last File",`${i.id} (${i.ext})`);var r=Math.floor(70*a+30);GameSDK.setLoadingProgress(r)},this.onScenePreloaded=function(e,t){return function(n){n?console.warn("SceneManager.onScenePreloaded",{sceneName:e,error:n}):(t&&t(e,n),Bq.emit(Uq.SCENE_LOADED,{sceneName:e,isPreload:!0}))}},this.onDirectorLoadScene=function(e){return function(n,i){if(n)console.warn("SceneManager.onSceneLoaded",n);else if(null!=i&&i.scene){var a=i.name;t.handleBeforeSceneLaunch(i,e)(),d.once(Q.EVENT_AFTER_SCENE_LAUNCH,t.handleSceneLaunched(a,e))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(e,n){return function(){t.setSceneData(e,null!=n?n:{}),V.emit($i),Bq.emit(Uq.SCENE_LOADED,{sceneName:e.name})}},this.handleSceneLaunched=function(e,n){return function(){var i;Yl.hideLoadingFullScreen(e),Qn.switchSceneTracking(),null===(i=t.callbackSwitchScene)||void 0===i||i.call(t,{sceneName:e,sceneData:n}),Bq.emit(Uq.SCENE_LAUNCHED,{sceneName:e})}},this.handleSceneLoaded=function(e){var n=e.sceneName;t.stopMeasure(n)}}return Re(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){Bq.on(Uq.SWITCH_SCENE,this.switchScene),Bq.on(Uq.PRELOAD_SCENE,this.preloadScene),Bq.on(Uq.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(e){var t=this.getCurrentScene();return t&&e===t.name?null:e}},{key:"startScene",value:function(e){var t=this,n=e.sceneName,i=e.sceneData;this.preloadScene({sceneName:n},(function(e,a){e===n&&(a?console.warn("SceneManager.startScene",{sceneName:n,error:a}):d.loadScene(n,t.onDirectorLoadScene(i)))}))}},{key:"mark",get:function(){return zq.PerformanceMonitor.LoadResources?Hq.Mark:null}},{key:"getCurrentScene",value:function(){return d.getScene()}},{key:"getLoadedScenes",value:function(){var e=this,t=[];return Object.keys(this.queueLoadScene).map((function(n){e.queueLoadScene[n]||t.push(n)})),t}},{key:"onSwitchScene",value:function(e){this.callbackSwitchScene=e}},{key:"setSceneData",value:function(e,t){if(t&&("data"in e||e.scene.attr({data:{}}),"data"in e)){var n=e.data||{};e.scene.attr({data:ke(ke({},n),t)}),console.info("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:n})}}}]),e}();n._RF.pop(),n._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var Vq=globalThis.game.event,Wq=GameCore.Events,Kq=function(){function e(){var t=this;Ae(this,e),this.screens={},this.handleOpenScreen=function(e){var n=e.screenName,i=e.screenData;t.openScreen(n,i)},this.handleCloseScreen=function(e){var n=e.screenName;t.closeScreen(n)}}var t,n,i;return Re(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){Vq.on(Wq.OPEN_SCREEN,this.handleOpenScreen),Vq.on(Wq.CLOSE_SCREEN,this.handleCloseScreen)}},{key:"addScreenKey",value:function(e,t){this.screens[jn[e]]=[t,e]}},{key:"addScreen",value:function(e){this.screens[e.node.name]=e}},{key:"getScreen",value:(i=Te(Se().mark((function e(t){var n,i,a,r,o,s,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=this.screens[t])){e.next=3;break}throw new Error(`ScreenManager.openScreen Screen ${t} not found`);case 3:if(!(n instanceof aN)){e.next=5;break}return e.abrupt("return",n);case 5:return console.info("ScreenManager.getScreen",`Screen ${t} not found in cache, instantiating it...`),i=qe(n,2),a=i[0],r=i[1],e.next=9,Bn.loadPrefabAsync(`screens/${jn[r]}`);case 9:if(o=e.sent){e.next=12;break}throw new Error(`ScreenManager.getScreen: Failed to load Screen ${t} prefab...`);case 12:if((s=l(o)).name=t,a.addChild(s),s.active=!1,u=s.getComponent(aN)){e.next=19;break}throw new Error(`ScreenManager.getScreen: Screen ${t} prefab doesn't have BaseScreen component...`);case 19:return this.screens[t]=u,e.abrupt("return",u);case 21:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"clearScreens",value:function(){this.screens={}}},{key:"screenIsLoaded",value:function(e){var t=this.screens[e];if(null==t)throw new Error(`ScreenManager.screenIsLoaded Screen ${e} not found`);return t instanceof aN}},{key:"openScreen",value:(n=Te(Se().mark((function e(t,n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getScreen(t);case 3:if(null!=(i=e.sent)&&i.node){e.next=7;break}return console.warn("ScreenManager.openScreen",`Screen ${t} not found`),e.abrupt("return");case 7:return i.node.active=!0,i.node.setPosition(new j(0,0,0)),a={screenName:t,screenData:n},Vq.emit(Wq.OPENING_SCREEN,a),Qn.trackCurrentPage(t,!0),e.next=14,yn.waitTweenAsync(0);case 14:i.open(n),Vq.emit(Wq.OPENED_SCREEN,a),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),console.error("ScreenManager.openScreen",e.t0);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e,t){return n.apply(this,arguments)})},{key:"closeScreen",value:(t=Te(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.getScreen(t);case 3:if(i=e.sent){e.next=7;break}return console.warn("ScreenManager.closeScreen",`Screen ${t} not found`),e.abrupt("return");case 7:if(null!==(n=i.node)&&void 0!==n&&n.active){e.next=9;break}return e.abrupt("return");case 9:a={screenName:t},Vq.emit(Wq.CLOSING_SCREEN,a),i.close(),Qn.trackCurrentPage(t,!1),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error("ScreenManager.closeScreen",e.t0);case 18:case"end":return e.stop()}}),e,this,[[0,15]])}))),function(e){return t.apply(this,arguments)})},{key:"closeAllScreens",value:function(){var e=this;Object.keys(this.screens).forEach((function(t){e.screenIsLoaded(t)&&e.closeScreen(t)}))}}]),e}();n._RF.pop(),n._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var jq=GameCore,Yq=jq.Configs,Xq=jq.Events,$q=jq.Plugins,Qq=globalThis.game,Jq=Qq.context,Zq=Qq.storage,eV=Qq.event,tV=Qq.analytics,nV=Qq.monitorError;new(function(){function e(){var t=this;Ae(this,e),this.coreManager=new yH,this.matchManager=new BH,this.sceneManager=new qq,this.screenManager=new Kq,this.engineManager=new SH,this.layoutManager=new _H,this.playerManager=new VH,this.pluginsManager=new Fq,this.handleWhenCoreBoot=function(){V.inited?t.handleCocosInit():V.once(we.EVENT_POST_PROJECT_INIT,t.handleCocosInit)},this.handleCocosInit=function(){t.coreManager.requestStart()},this.handleWhenCoreStart=function(){t.playerManager.setupDefaultGameData(),t.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){t.initPlugins(),console.groupEnd(),Yq.Core.StartSDKAfterLoadGame?eV.once(Xq.SCENE_LOADED,t.handleStartGameWhenMainSceneReady):t.processStartGame(),t.preloadScenes()},this.handleStartGameWhenMainSceneReady=function(){t.processStartGame()},this.handleSwitchScene=function(e){var n=e.sceneName,i=t.sceneManager.getCurrentScene();if((null==i?void 0:i.name)===n){t.screenManager.closeAllScreens(),t.screenManager.clearScreens();var a=null==i?void 0:i.getComponentsInChildren(aN);a.length>0&&(console.groupCollapsed(`📺 Loaded Screens in ${n}`),a.forEach((function(e){console.info(e.node.name),t.screenManager.addScreen(e)})),console.groupEnd());var r=null==i?void 0:i.getComponentInChildren(RN);if(r){var o=r.screenKeys.filter((function(e){return!a.some((function(t){return t.node.name===jn[e]}))}));0!==o.length&&(console.groupCollapsed(`📺 Lazy-loading Screens in ${n}`),o.forEach((function(e){console.info(jn[e]),t.screenManager.addScreenKey(e,r.node)})),console.groupEnd())}}},console.groupCollapsed("📦 Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}var t,n;return Re(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"preloadScenes",value:function(){"solo"===Zq.getStorageData("context","sessionContextType")?Dl.preloadDashboardScene():Dl.preloadGameScene()}},{key:"processStartGame",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.groupEnd(),tV.event($q.Analytics.Events.LOAD_COMPLETE),e.next=4,this.startGameAsync();case 4:this.startProcessContextData(),this.playerManager.requestConnectedPlayers(),tV.event($q.Analytics.Events.APP_READY,{success:!0}),eV.emit(Xq.GAME_READY);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"startGameAsync",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameSDK.startGameAsync();case 3:tV.event($q.Analytics.Events.GAME_SDK_READY,{success:!0}),e.next=11;break;case 6:e.prev=6,e.t0=e.catch(0),console.warn("GameSDK.startGameAsync",e.t0),tV.event($q.Analytics.Events.GAME_SDK_READY,{success:!1}),e.t0 instanceof Error&&(null==nV||nV.sendException(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,6]])}))),function(){return t.apply(this,arguments)})},{key:"startProcessContextData",value:function(){eV.getEventEmitCount(Xq.PLAYER_INFO_LOADED)?Jq.processContextData().catch((function(e){console.error("startProcessContextData",e)})):eV.once(Xq.PLAYER_INFO_LOADED,this.startProcessContextData)}},{key:"initPlugins",value:function(){this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/start-scene', 'chunks:///start-scene.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});