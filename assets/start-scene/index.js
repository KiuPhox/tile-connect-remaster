System.register("chunks:///start-scene.js",["cc"],(function(e,t){var i,n,a,s,o,r,l,c,h,d,u,p,m,g,y,b,f,w,S,v,C,E,T,A,R,I,P,_,L,D,O,N,M,k,x,F,B,G,z,U,H,V,q,W,K,Y,j,X,$,Q,J,Z,ee,te,ie,ne,ae,se,oe,re,le,ce,he,de,ue,pe,me,ge,ye,be,fe,we,Se;return{setters:[function(e){i=e.cclegacy,n=e.Node,a=e._decorator,s=e.Component,o=e.Color,r=e.Canvas,l=e.UITransform,c=e.instantiate,h=e.Label,d=e.RichText,u=e.Toggle,p=e.Button,m=e.director,g=e.isCCObject,y=e.Animation,b=e.CCString,f=e.CCInteger,w=e.AudioSource,S=e.resources,v=e.AudioClip,C=e.tween,E=e.CCFloat,T=e.Layout,A=e.Widget,R=e.Sprite,I=e.ccenum,P=e.find,_=e.Prefab,L=e.JsonAsset,D=e.AnimationClip,O=e.ImageAsset,N=e.SpriteFrame,M=e.Enum,k=e.easing,x=e.UIOpacity,F=e.view,B=e.screen,G=e.math,z=e.EventHandler,U=e.animation,H=e.CCBoolean,V=e.Input,q=e.Graphics,W=e.game,K=e.profiler,Y=e.sys,j=e.Vec3,X=e.ProgressBar,$=e.Font,Q=e.Vec2,J=e.Director,Z=e.Layers,ee=e.randomRangeInt,te=e.pseudoRandomRangeInt,ie=e.pseudoRandom,ne=e.randomRange,ae=e.Pool,se=e.ParticleSystem2D,oe=e.HorizontalTextAlignment,re=e.Tween,le=e.View,ce=e.ScrollView,he=e.lerp,de=e.Mask,ue=e.settings,pe=e.Settings,me=e.AssetManager,ge=e.DynamicAtlasManager,ye=e.macro,be=e.ResolutionPolicy,fe=e.UIRenderer,we=e.Texture2D,Se=e.Game}],execute:function(){function e(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function ve(e,t,i,n,a){var s={};return Object.keys(n).forEach((function(e){s[e]=n[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,n){return n(e,t,i)||i}),s),a&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}var Ce,Ee,Te,Ae,Re,Ie,Pe,_e,Le;i._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);const{ccclass:De,property:Oe}=a;Ce=De("internal.DebugViewRuntimeControl"),Ee=Oe(n),Te=Oe(n),Ae=Oe(n),Ce((Pe=ve((Ie=class extends s{constructor(){super(...arguments),e(this,"compositeModeToggle",Pe,this),e(this,"singleModeToggle",_e,this),e(this,"EnableAllCompositeModeButton",Le,this),this._single=0,this.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],this.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],this.strMisc=["CSM Layer Coloration","Lighting With Albedo"],this.compositeModeToggleList=[],this.singleModeToggleList=[],this.miscModeToggleList=[],this.textComponentList=[],this.labelComponentList=[],this.textContentList=[],this._currentColorIndex=0,this.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],this.color=[o.WHITE,o.BLACK,o.RED,o.GREEN,o.BLUE]}start(){if(!this.node.parent.getComponent(r))return void console.error("debug-view-runtime-control should be child of Canvas");const e=this.node.parent.getComponent(l),t=.5*e.width,i=.5*e.height;let n=.1*t-t,a=i-.1*i;const s=this.node.getChildByName("MiscMode"),m=c(s);m.parent=this.node,m.name="Buttons";const g=c(s);g.parent=this.node,g.name="Titles";for(let e=0;e<2;e++){const t=c(this.EnableAllCompositeModeButton.getChildByName("Label"));t.setPosition(n+(e>0?450:150),a,0),t.setScale(.75,.75,.75),t.parent=g;const i=t.getComponent(h);i.string=e?"----------Composite Mode----------":"----------Single Mode----------",i.color=o.WHITE,i.overflow=0,this.labelComponentList[this.labelComponentList.length]=i}a-=20;let y=0;for(let e=0;e<this.strSingle.length;e++,y++){e===this.strSingle.length>>1&&(n+=200,y=0);const t=e?c(this.singleModeToggle):this.singleModeToggle;t.setPosition(n,a-20*y,0),t.setScale(.5,.5,.5),t.parent=this.singleModeToggle.parent;const i=t.getComponentInChildren(d);i.string=this.strSingle[e],this.textComponentList[this.textComponentList.length]=i,this.textContentList[this.textContentList.length]=i.string,t.on(u.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[e]=t}n+=200,this.EnableAllCompositeModeButton.setPosition(n+15,a,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(p.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=m;let b=this.EnableAllCompositeModeButton.getComponentInChildren(h);this.labelComponentList[this.labelComponentList.length]=b;const f=c(this.EnableAllCompositeModeButton);f.setPosition(n+90,a,0),f.setScale(.5,.5,.5),f.on(p.EventType.CLICK,this.changeTextColor,this),f.parent=m,b=f.getComponentInChildren(h),b.string="TextColor",this.labelComponentList[this.labelComponentList.length]=b;const w=c(this.EnableAllCompositeModeButton);w.setPosition(n+200,a,0),w.setScale(.5,.5,.5),w.on(p.EventType.CLICK,this.hideUI,this),w.parent=this.node.parent,b=w.getComponentInChildren(h),b.string="Hide UI",this.labelComponentList[this.labelComponentList.length]=b,this.hideButtonLabel=b,a-=40;for(let e=0;e<this.strMisc.length;e++){const t=c(this.compositeModeToggle);t.setPosition(n,a-20*e,0),t.setScale(.5,.5,.5),t.parent=s;const i=t.getComponentInChildren(d);i.string=this.strMisc[e],this.textComponentList[this.textComponentList.length]=i,this.textContentList[this.textContentList.length]=i.string;t.getComponent(u).isChecked=!!e,t.on(u.EventType.TOGGLE,e?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[e]=t}a-=150;for(let e=0;e<this.strComposite.length;e++){const t=e?c(this.compositeModeToggle):this.compositeModeToggle;t.setPosition(n,a-20*e,0),t.setScale(.5,.5,.5),t.parent=this.compositeModeToggle.parent;const i=t.getComponentInChildren(d);i.string=this.strComposite[e],this.textComponentList[this.textComponentList.length]=i,this.textContentList[this.textContentList.length]=i.string,t.on(u.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[e]=t}}isTextMatched(e,t){let i=new String(e);const n=i.search(">");return-1===n?e===t:(i=i.substr(n+1),i=i.substr(0,i.search("<")),i===t)}toggleSingleMode(e){const t=m.root.debugView,i=e.getComponentInChildren(d);for(let e=0;e<this.strSingle.length;e++)this.isTextMatched(i.string,this.strSingle[e])&&(t.singleMode=e)}toggleCompositeMode(e){const t=m.root.debugView,i=e.getComponentInChildren(d);for(let n=0;n<this.strComposite.length;n++)this.isTextMatched(i.string,this.strComposite[n])&&t.enableCompositeMode(n,e.isChecked)}toggleLightingWithAlbedo(e){m.root.debugView.lightingWithAlbedo=e.isChecked}toggleCSMColoration(e){m.root.debugView.csmLayerColoration=e.isChecked}enableAllCompositeMode(e){const t=m.root.debugView;t.enableAllCompositeMode(!0);for(let e=0;e<this.compositeModeToggleList.length;e++){this.compositeModeToggleList[e].getComponent(u).isChecked=!0}let i=this.miscModeToggleList[0].getComponent(u);i.isChecked=!1,t.csmLayerColoration=!1,i=this.miscModeToggleList[1].getComponent(u),i.isChecked=!0,t.lightingWithAlbedo=!0}hideUI(e){const t=this.node.getChildByName("Titles"),i=!t.active;this.singleModeToggleList[0].parent.active=i,this.miscModeToggleList[0].parent.active=i,this.compositeModeToggleList[0].parent.active=i,this.EnableAllCompositeModeButton.parent.active=i,t.active=i,this.hideButtonLabel.string=i?"Hide UI":"Show UI"}changeTextColor(e){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(let e=0;e<this.textComponentList.length;e++)this.textComponentList[e].string=this.strColor[this._currentColorIndex]+this.textContentList[e]+"</color>";for(let e=0;e<this.labelComponentList.length;e++)this.labelComponentList[e].color=this.color[this._currentColorIndex]}onLoad(){}update(e){}}).prototype,"compositeModeToggle",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_e=ve(Ie.prototype,"singleModeToggle",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Le=ve(Ie.prototype,"EnableAllCompositeModeButton",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Re=Ie));i._RF.pop(),i._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);const{Array:Ne,Object:Me,Valid:ke}=GameCore.Utils,xe=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"];class Fe{constructor(){this.validComponentCalled={}}static get inst(){return this._instance||(this._instance=new Fe),this._instance}static lazyValidateProperties(e){if(!(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]))return;const{constructor:t}=e,{name:i}=t;if(!this.inst.validComponentCalled[i])try{this.inst.validateRequiredComponents(e),this.inst.validateRequiredProperties(e),this.inst.validateCustomProperties(e)}catch(t){e.enabled=!1,console.error(t)}finally{this.inst.validComponentCalled[i]=!0}}validateRequiredComponents(e){const{name:t,constructor:i}=e,n=this.getRequiredComponentNames(i);for(const i of n)if(!e.getComponent(i))throw new Error(`${t}: Missing required ${i} component`)}validateRequiredProperties(e){const{name:t,constructor:i}=e,n=this.getRequiredPropNames(i);for(const i of n){if(!Me.hasOwn(e,i))throw new Error(`${t}: Missing required ${i} property`);const n=this.getProperty(i,e);if(!g(n))throw new Error(`${t}: ${i} property is not a cc object`)}}validateCustomProperties(e){const{name:t}=e,i=this.getCustomPropNames(e);for(const n of i){if(!Me.hasOwn(e,n))throw new Error(`${t}: Missing required ${n} property`);const i=this.getProperty(n,e);if(!g(i))throw new Error(`${t}: ${n} property is not a cc object`)}}getProperty(e,t){if(!Me.hasOwn(t,e))return;const{value:i}=Object.getOwnPropertyDescriptor(t,e)??{};return i}getProps(e){if(!Me.hasOwn(e,"__props__"))return[];const{__props__:t}=e;return Array.isArray(t)?t:[]}getRequiredPropNames(e){return this.getProps(e).filter((t=>"node"!==t&&(!!Me.hasOwn(e,t)&&(!!g(e[t])&&t.indexOf("_")<0))))}getBaseComponentName(e){for(const t of xe){if(t.indexOf(e)>=0)return t}return e}getRequiredComponentNames(e){if(!Me.hasOwn(e,"_requireComponent"))return[];const{_requireComponent:t}=e;return Array.isArray(t)?t.map((e=>this.getBaseComponentName(e))):[]}getCustomPropNames(e){const t=Object.keys(e),i=this.getProps(e.constructor);return Ne.difference(t,i).filter((e=>e.indexOf("_")<0)).filter((t=>{if(!Me.hasOwn(e,t))return!1;const i=this.getProperty(t,e);return!(!ke.isObject(i)||!g(i))}))}}try{new Fe}catch(e){console.error("ComponentUtils",e)}var Be,Ge,ze,Ue,He,Ve,qe,We,Ke;i._RF.pop(),i._RF.push({},"60ac3vor0dMT5bXi8D3VSJN","BubbleAnimation",void 0);const{ccclass:Ye,property:je}=a,{Array:Xe}=GameCore.Utils;Be=Ye("BubbleAnimation"),Ge=je(y),ze=je(b),Ue=je(f),Be((qe=ve((Ve=class extends s{constructor(){super(...arguments),e(this,"animation",qe,this),e(this,"clipName",We,this),e(this,"repeat",Ke,this),this.currentRepeat=-1}__preload(){this.animation=this.getComponent(y),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}play(){if(!this.animation)return;Xe.search(this.animation.clips,(e=>e?.name===this.clipName))?(this.currentRepeat=-1,this.animation.play(this.clipName)):console.warn(`BubbleAnimation: Animation component must have ${this.clipName} clip`)}onBubbleAnimationLoop(){this.animation&&-1!==this.repeat&&(this.currentRepeat++,this.currentRepeat>this.repeat&&this.animation.stop())}}).prototype,"animation",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),We=ve(Ve.prototype,"clipName",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Bubble"}}),Ke=ve(Ve.prototype,"repeat",[Ue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),He=Ve));i._RF.pop(),i._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);class $e extends GameCore.Plugins.Audio.BaseAudioPlayer{constructor(e,t){super(e),this.audioSource=t}play(e){if(e){const{volume:t=1,loop:i=!1}=e;this.audioSource.volume=t,this.audioSource.loop=i}this.audioSource.play()}pause(){this.audioSource.pause()}resume(){this.audioSource.state===w.AudioState.PAUSED&&this.audioSource.play()}stop(){this.audioSource.stop()}setVolume(e){this.audioSource.volume=e}getAudioSource(){return this.audioSource}}i._RF.pop(),i._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);const{BaseChannelManager:Qe}=GameCore.Plugins.Audio,{Array:Je}=GameCore.Utils;class Ze extends Qe{constructor(e,t){super(t),this.allowMultipleTracking={},this.handleLoadedAudio=(e,t)=>{const i=this.node.addComponent(w);return i.clip=t,i.playOnAwake=!1,new $e(e,i)},this.node=e}playing(e){const t=this.getAudioClip(e)?.audioPlayer;return!!t&&t.getAudioSource().state===w.AudioState.PLAYING}async onLoadAudio(e,t){return new Promise(((t,i)=>{S.load(e,v,((n,a)=>{try{if(n)throw new Error(n.message);if(!this.node.isValid)return;const i=this.handleLoadedAudio(e,a);t(i)}catch(n){n instanceof Error?i(n):i(new Error("Audio load: Unknown error"))}}))}))}playWithRealConfig(e,t){if(this.isCanPlay(t)){if(t){const{volume:i=1,allowMultiple:n=!1}=t;if(t.volume=this.getVolume()*i,n){return void this.requestDuplicateAudioPlayer(e.getKey(),e.getAudioSource().clip,t).play(t)}}e.play(t)}}isCanPlay(e){if(e){const{checkList:t=[]}=e;if(t.some((e=>{const t=this.getAudioClip(e);if(t){return t.audioPlayer.getAudioSource().state===w.AudioState.PLAYING}return!1})))return!1}return!0}requestDuplicateAudioPlayer(e,t,i){const n=this.getDuplicateAudioFromPool(e);if(n){if(i){const{key:e}=n,{volume:t=1}=i;this.setAudioClip(e,{volume:t})}return n.audioPlayer}const a=`${e}_${this.allowMultipleTracking[e].currentPostFix}`,s=this.handleLoadedAudio(a,t);return this.allowMultipleTracking[e].list.push({audioPlayer:s,key:a}),this.allowMultipleTracking[e].currentPostFix+=1,this.setAudioClip(a,{audioPlayer:s,volume:1}),s}getDuplicateAudioFromPool(e){if(this.allowMultipleTracking[e]){const{list:t}=this.allowMultipleTracking[e],i=Je.search(t,(e=>e.audioPlayer.getAudioSource().state!==w.AudioState.PLAYING));if(i)return i}else this.allowMultipleTracking[e]={currentPostFix:1,list:[]};return null}}i._RF.pop();var et,tt,it,nt,at;i._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);const{ccclass:st,property:ot}=a,{audio:rt,player:lt}=globalThis.game;let ct=(et=st("Music"),tt=ot(b),et((at=ve((nt=class extends s{constructor(){super(...arguments),e(this,"channelId",at,this),this.channel=null}__preload(){this.makePersistent(),this.channel=new Ze(this.node,this.channelId),rt.addChannel(this.channel)}makePersistent(){m.addPersistRootNode(this.node)}playing(e){return this.channel?.playing(e)??!1}play(e,t){this.isMusicEnable()&&(t?.loop||(t={...t,loop:!0}),rt.play(e,t,this.channelId))}isMusicEnable(){return!!lt.getPlayerSetting("music")}setVolume(e){rt.setVolume(e,this.channelId)}pause(e){rt.pause(e,this.channelId)}resume(e){this.isMusicEnable()&&rt.resume(e,this.channelId)}stop(e){rt.stop(e,this.channelId)}mute(e){e?rt.mute(this.channelId):rt.unmute(this.channelId)}}).prototype,"channelId",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),it=nt))||it);var ht,dt,ut,pt,mt;i._RF.pop(),i._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);const{ccclass:gt,property:yt}=a,{audio:bt,player:ft}=globalThis.game;let wt=(ht=gt("Sound"),dt=yt(b),ht((mt=ve((pt=class extends s{constructor(){super(...arguments),e(this,"channelId",mt,this),this.channel=null}__preload(){this.channel=new Ze(this.node,this.channelId),bt.addChannel(this.channel)}onLoad(){""===this.channelId&&(this.channelId=this.node.uuid)}makePersistent(){m.addPersistRootNode(this.node)}removePersistent(){m.removePersistRootNode(this.node)}play(e,t){this.isSoundEnable()&&bt.play(e,t,this.channelId)}isSoundEnable(){return!!ft.getPlayerSetting("sound")}setVolume(e){bt.setVolume(e,this.channelId)}pause(e){bt.pause(e,this.channelId)}resume(e){this.isSoundEnable()&&bt.resume(e,this.channelId)}stop(e){bt.stop(e,this.channelId)}stopAll(){bt.stopAll(this.channelId)}mute(e){e?bt.mute(this.channelId):bt.unmute(this.channelId)}}).prototype,"channelId",[dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ut=pt))||ut);i._RF.pop(),i._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);class St{static get inst(){return this._instance||(this._instance=new St),this._instance}static elasticOut(e,t,i){if(void 0===t&&(t=.1),void 0===i&&(i=.1),0===e)return 0;if(1===e)return 1;{let n=i/4;return t<1?t=1:n=i*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*e)*Math.sin((e-n)*(2*Math.PI)/i)+1}}static easeOutExpo(e){return 1===e?1:1-Math.pow(2,-10*e)}static easeInExpo(e){return 0===e?0:Math.pow(2,10*e-10)}static runTweenAsync(e,t){return new Promise((i=>{const n=e.call((()=>{i({tween:e})})).start();t&&(t.aborted?(n.stop(),i({tween:e})):t.addAbortListener((()=>{n.stop(),i({tween:e})})))}))}static waitTweenAsync(e,t){return new Promise((i=>{const n=C({});n.delay(e),n.call((()=>{i()})),n.start(),t&&(t.aborted?(n.stop(),i()):t.addAbortListener((()=>{n.stop(),i()})))}))}static runAnimationAsync(e,t){return new Promise((i=>{e.play(t),e.once(y.EventType.FINISHED,(()=>{i()}))}))}}try{new St}catch(e){console.error("AnimUtils",e)}var vt,Ct,Et,Tt,At,Rt,It,Pt,_t,Lt,Dt,Ot,Nt,Mt,kt,xt,Ft,Bt,Gt,zt;i._RF.pop(),i._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);const{ccclass:Ut,property:Ht}=a;let Vt=(vt=Ut("AutoLayoutWrappee"),Ct=Ht({type:l}),Et=Ht({type:l}),vt((Rt=ve((At=class{constructor(){e(this,"wrapeeContainer",Rt,this),e(this,"wrapee",It,this)}}).prototype,"wrapeeContainer",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),It=ve(At.prototype,"wrapee",[Et],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tt=At))||Tt),qt=(Pt=Ut("AutoLayout"),_t=Ht({displayName:"Use Auto Layout"}),Lt=Ht({type:[Vt],displayName:"Children",visible(){return this.useAutoLayout}}),Dt=Ht({visible:!1,serializable:!0}),Ot=Ht({type:f,displayName:"Selected Index",visible(){return this.useAutoLayout}}),Nt=Ht({type:E,displayName:"Deselected Icon Width",group:"Edge Icons",visible(){return this.useAutoLayout}}),Mt=Ht({visible:!1,serializable:!0}),Pt((Ft=ve((xt=class extends T{constructor(){super(...arguments),e(this,"useAutoLayout",Ft,this),e(this,"children",Bt,this),this.mappedChildren=[],e(this,"selected",Gt,this),e(this,"deselectedIconW",zt,this),this.tweens=[]}get selectedIndex(){return this.selected}set selectedIndex(e){this.selected=e,this.updateLayout(!0)}get deselectedIconWidth(){return this.deselectedIconW}set deselectedIconWidth(e){this.deselectedIconW=e,this.updateLayout(!0)}__preload(){this.mappedChildren=this.children.map((e=>{const t=e.wrapeeContainer.getComponent(A);if(!t)throw new Error("AutoLayout: Widget component not found");return{...e,wrapeeContainerWidget:t}}))}updateLayout(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._layoutDirty||e)&&(this.updateChildrenAnchors(),this.mappedChildren.forEach((e=>e.wrapeeContainerWidget.updateAlignment()))),super.updateLayout(e)}getSelectedWorldX(){const e=this.mappedChildren[this.selectedIndex].wrapeeContainer;if(0===this.selectedIndex||this.selectedIndex===this.children.length-1){const{xMin:t}=e.getBoundingBoxToWorld();return t+this.getAnchorX(this.selectedIndex)*e.width}return e.getBoundingBoxToWorld().center.x}getAnchorX(e){if(e<this.selectedIndex)return 0;if(e>this.selectedIndex)return 1;if(0===e){const t=this.mappedChildren[e].wrapeeContainer.width,i=this.deselectedIconWidth/2,n=this.paddingLeft;return((n+t+(t-i+this.spacingX))/2-n)/t}if(e===this.children.length-1){const t=this.mappedChildren[e].wrapeeContainer.width,i=t-this.deselectedIconWidth/2+this.spacingX;return((i+t+this.paddingRight)/2-i)/t}return.5}async updateChildrenAnchors(){this.tweens.forEach((e=>e.stop())),this.tweens=[],await Promise.all([this.children.flatMap(((e,t)=>this.getChildrenAnchorsTweens(e,this.getAnchorX(t)))).map((e=>St.runTweenAsync(e)))])}updateChildrenAnchorsEditor(){this.children.forEach(((e,t)=>{const i=this.getAnchorX(t);e.wrapee.setAnchorPoint(i,e.wrapee.anchorY),e.wrapeeContainer.setAnchorPoint(i,e.wrapeeContainer.anchorY)}))}getChildrenAnchorsTweens(e,t){return[C(e.wrapee).to(.3,{anchorX:t},{easing:"sineInOut"}).call((()=>{e.wrapee.setAnchorPoint(t,e.wrapee.anchorY)})),C(e.wrapeeContainer).to(.3,{anchorX:t},{easing:"sineInOut"}).call((()=>{e.wrapeeContainer.setAnchorPoint(t,e.wrapeeContainer.anchorY)}))]}}).prototype,"useAutoLayout",[_t],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Bt=ve(xt.prototype,"children",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Gt=ve(xt.prototype,"selected",[Dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ve(xt.prototype,"selectedIndex",[Ot],Object.getOwnPropertyDescriptor(xt.prototype,"selectedIndex"),xt.prototype),ve(xt.prototype,"deselectedIconWidth",[Nt],Object.getOwnPropertyDescriptor(xt.prototype,"deselectedIconWidth"),xt.prototype),zt=ve(xt.prototype,"deselectedIconW",[Mt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kt=xt))||kt);var Wt,Kt,Yt,jt,Xt;i._RF.pop(),i._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);const{ccclass:$t,property:Qt}=a;Wt=$t("Background"),Kt=Qt({type:R}),Wt((Xt=ve((jt=class extends s{constructor(){super(...arguments),e(this,"sprite",Xt,this)}__preload(){this.validateRequiredComponents(),this.listenGameEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenGameEvents(){}}).prototype,"sprite",[Kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yt=jt));i._RF.pop(),i._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);const Jt="STARS_UPDATED",Zt="PLAY_BUTTON_PRESS",ei="REQUEST_NAVIGATION",ti="REQUEST_NAVIGATION_ANIMATION",ii="DASHBOARD_EVENTS_BUTTON_PRESS";i._RF.pop(),i._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var ni=function(e){return e[e.store=0]="store",e[e.collections=1]="collections",e[e.home=2]="home",e[e.leaderboard=3]="leaderboard",e[e.tournaments=4]="tournaments",e}(ni||{});I(ni),i._RF.pop(),i._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);class ai{constructor(){this.isAborted=!1,this.abortReason="",this.eventTarget=new EventTarget}get aborted(){return this.isAborted}get reason(){return this.abortReason}addAbortListener(e){this.eventTarget.addEventListener("abort",e)}removeAbortListener(e){this.eventTarget.removeEventListener("abort",e)}abort(e){this.isAborted||(this.isAborted=!0,this.abortReason=e,this.eventTarget.dispatchEvent(new Event("abort")))}async untilAborted(){if(!this.isAborted)return new Promise((e=>{this.addAbortListener((()=>e()))}))}static hasBeenAborted(e){return null==e||e.aborted}}i._RF.pop(),i._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var si=function(e){return e.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",e.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",e.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",e.COLLECTIONS_CONTENT_PREFAB="game-objects/dashboard-scene/CollectionsContent",e.CLOUD_IDLE_ANIM="animations/CloudIdle",e.TORNADO_IDLE_ANIM="animations/TornadoIdle",e.TILE_BREAK_ANIM="animations/TileBreak",e.TILE_CLEAR_ANIM="animations/TileClear",e.TILE_SHAKE_ANIM="animations/TileShake",e.TILE_SKIN_FOLDER="loadable/tiles",e.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",e.ITEM_POPUP_FOLDER="loadable/item-popup",e.SUMMER_BG="images/bg/summer",e.AUTUMN_BG="images/bg/autumn",e.WINTER_BG="images/bg/winter",e.SUMMER_BG_PREVIEW="images/preview/summer",e.AUTUMN_BG_PREVIEW="images/preview/autumn",e.WINTER_BG_PREVIEW="images/preview/winter",e.COLLECTIONS_PAGE="pages/CollectionsContent",e.LEADERBOARD_PAGE="pages/LeaderboardContent",e.TOURNAMENTS_PAGE="pages/TournamentsContent",e.LEVEL_DATA_FOLDER="levels-json",e}(si||{});i._RF.pop(),i._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);const oi={summer:si.SUMMER_BG,autumn:si.AUTUMN_BG,winter:si.WINTER_BG},ri={summer:si.SUMMER_BG_PREVIEW,autumn:si.AUTUMN_BG_PREVIEW,winter:si.WINTER_BG_PREVIEW};i._RF.pop(),i._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);class li{static get inst(){return this._instance||(this._instance=new li),this._instance}static setBlockInput(e){const t=P("Canvas/InputBlocker");t?t.active=e:console.warn("InputBlocker not found")}static getBlockInput(){const e=P("Canvas/InputBlocker");return e?e.active:(console.warn("InputBlocker not found"),!1)}static loadPrefabAsync(e){const t=S.getInfoWithPath(e,_);if(t&&null!==S.get(t.path,_)){const e=S.get(t.path,_);if(null!==e)return Promise.resolve(e)}return new Promise((t=>{S.load(e,_,((e,i)=>{e&&t(null),t(i)}))}))}static async loadJsonAsync(e){return new Promise((t=>{const i=S.getInfoWithPath(e,L);if(i&&null!==S.get(i.path,L)){const e=S.get(i.path,L);null!==e&&t(e.json)}S.load(e,L,((e,i)=>{e&&t(null),i&&i.json||t(null),t(i.json)}))}))}static async loadAnimClipAsync(e){const t=S.getInfoWithPath(e,D);if(t&&null!==S.get(t.path,D)){const e=S.get(t.path,D);if(null!==e)return Promise.resolve(e)}return new Promise((t=>{S.load(e,D,((e,i)=>{e&&t(null),t(i)}))}))}static async loadImageSpriteFrameAsync(e){const t=S.getInfoWithPath(e,O);if(t&&null!==S.get(t.path,O)){const e=S.get(t.path,O);if(null!==e)return Promise.resolve(N.createWithImage(e))}return new Promise((t=>{S.load(e,O,((e,i)=>{e&&t(null),t(N.createWithImage(i))}))}))}static async loadSpriteFrameAsync(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=S.getInfoWithPath(e,N);if(i&&null!==S.get(i.path,N)){const e=S.get(i.path,N);if(null!==e)return e.packable=t,Promise.resolve(e)}return new Promise((i=>{S.load(e,N,((e,n)=>{!e&&n?(n.packable=t,i(n)):i(null)}))}))}static async loadSpriteFramesDirAsync(e){const t=S.getDirWithPath(e,N);if(t.length>0){const i=[];for(const n of t){const t=S.get(n.path,N);if(!t)return this.loadSpriteFramesFromDirAsync(e);i.push(t)}return i}return this.loadSpriteFramesFromDirAsync(e)}static async loadSpriteFramesFromDirAsync(e){return new Promise((t=>{S.loadDir(e,N,((e,i)=>{e&&t([]),t(i)}))}))}static async lazyLoadDashboardSceneResourcesAsync(){return li.loadPrefabAsync(si.COLLECTIONS_CONTENT_PREFAB)}static async loadThemeAsync(e){return this.loadSpriteFrameAsync(`${oi[e]}/spriteFrame`)}static async loadThemePreviewAsync(e){return this.loadSpriteFrameAsync(`${ri[e]}/spriteFrame`)}static async loadSkinPreviewAsync(e){const t=[];for(let i=1;i<=4;i++){const n=`${si.TILE_SKIN_PREVIEW_FOLDER}/${e.replace(/-/g,"_")}_${i}/spriteFrame`;t.push(this.loadSpriteFrameAsync(n))}return Promise.all(t)}}try{new li}catch(e){console.error("GeneralUtils",e)}var ci,hi,di,ui,pi,mi,gi,yi,bi,fi,wi,Si,vi,Ci,Ei,Ti,Ai,Ri,Ii,Pi,_i;i._RF.pop(),i._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);const{ccclass:Li,property:Di}=a,{monitorError:Oi}=globalThis.game;let Ni=(ci=Li("MultiBackground"),hi=Di({type:R}),di=Di({type:R}),ui=Di({type:l}),pi=Di({type:l}),mi=Di({type:l}),gi=Di(f),yi=Di(A),bi=Di({type:M(ni)}),fi=Di({type:M(ni)}),ci((vi=ve((Si=class extends s{constructor(){super(...arguments),e(this,"background1",vi,this),e(this,"background2",Ci,this),e(this,"screenUiTransform",Ei,this),e(this,"background1Uitransform",Ti,this),e(this,"background2UiTransform",Ai,this),e(this,"backgroundNudgeAmount",Ri,this),e(this,"nudgeableWidget",Ii,this),e(this,"pageOrder",Pi,this),e(this,"homePage",_i,this),this.currentThemeId="",this.tryNudgeBackground=e=>{let{to:t}=e;const i=this.getDirection(this.homePage,t),n=Math.sign(i),a=Math.abs(i),s=this.backgroundNudgeAmount*a,o=Math.min(this.background1Uitransform.width,this.background2UiTransform.width),r=Math.max(0,(o-this.screenUiTransform.width)/2),l=Math.min(r,s)*n;C(this.nudgeableWidget).to(.5,{horizontalCenter:l},{easing:k.cubicInOut}).start()}}onLoad(){this.currentBackground=this.background1,this.nextBackground=this.background2,Fe.lazyValidateProperties(this),this.listenToNavigationEvents()}onDestroy(){this.tweenSignal?.abort(),this.unlistenToNavigationEvents()}listenToNavigationEvents(){this.node.scene.on(ti,this.tryNudgeBackground)}unlistenToNavigationEvents(){this.node.scene.off(ti,this.tryNudgeBackground)}getDirection(e,t){const i=this.pageOrder.indexOf(e),n=this.pageOrder.indexOf(t);return-1===i||-1===n?(Oi?.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):i-n}async setCurrentTheme(e){const t=await li.loadThemeAsync(e);t?(t.packable=!1,this.background1.spriteFrame=t,this.background2.spriteFrame=t,this.currentThemeId=e):Oi?.sendException(new Error(`MultiBackground.setCurrentTheme: Failed to load theme ${e}'s sprite.`))}async animateToNextTheme(e){if(this.currentThemeId===e)return Promise.resolve();const t=await li.loadThemeAsync(e);if(!t)return void Oi?.sendException(new Error(`MultiBackground.animateToNextTheme: Failed to load theme ${e}'s sprite.`));t.packable=!1,this.currentThemeId=e,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=t,this.nextBackground.node.setSiblingIndex(1);const i=this.nextBackground.getComponent(x);if(!i)throw new Error(`${this.nextBackground.node.name} UIOpacity is required`);if(i.opacity=0,this.tweenSignal?.abort(),this.tweenSignal=new ai,await St.runTweenAsync(C(i).to(1,{opacity:255}),this.tweenSignal),this.tweenSignal.aborted)return;this.currentBackground.node.active=!1;const n=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=n}}).prototype,"background1",[hi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ci=ve(Si.prototype,"background2",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ei=ve(Si.prototype,"screenUiTransform",[ui],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ti=ve(Si.prototype,"background1Uitransform",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ai=ve(Si.prototype,"background2UiTransform",[mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ri=ve(Si.prototype,"backgroundNudgeAmount",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Ii=ve(Si.prototype,"nudgeableWidget",[yi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pi=ve(Si.prototype,"pageOrder",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_i=ve(Si.prototype,"homePage",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ni.home}}),wi=Si))||wi);i._RF.pop(),i._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);const{Utils:Mi}=GameCore,{Object:ki}=Mi,xi={BUTTON_CLICK:"sounds/use_item_click",BOMB_DEFUSE:"sounds/bomb_defuse",BOMB_EXPLODE_1:"sounds/bomb_explode_1",BOMB_EXPLODE_2:"sounds/bomb_explode_2",CLICKS:"sounds/clicks",CLOSE_POPUP_CLICK:"sounds/close_popup_click",COLLECT_STARS:"sounds/collect_stars",COMBO_1:"sounds/combo_1",COMBO_2:"sounds/combo_2",COMBO_3:"sounds/combo_3",COMBO_4:"sounds/combo_4",COMBO_5:"sounds/combo_5",DAILY_REWARD:"sounds/daily_reward",EXTRA_TIME_SPAWN:"sounds/extra_time_spawn",GIFT_CHARGE:"sounds/gift_charge",GIFT_EXPLODE:"sounds/gift_explode",GIFT_REVEAL:"sounds/gift_reveal",HINT_ITEM:"sounds/hint_item",INVALID_MATCH:"sounds/invalid_match",LEVEL_COMPLETE:"sounds/level_complete",LEVEL_FAIL:"sounds/level_fail",LEVEL_START:"sounds/level_start",PROGRESS_STAR:"sounds/progress_star",RESCUE_TIMER:"sounds/rescue_timer",ROCKET_FLY:"sounds/rocket_fly",SHUFFLE_ITEM:"sounds/shuffle_item",THREE_STARS:"sounds/three_stars",TICKING_BOMB_BEFORE_EXPLODE:"sounds/ticking_bomb_before_explode",TILE_SELECT:"sounds/tile_select",USE_ITEM_CLICK:"sounds/use_item_click",BG_MUSIC:"musics/bg_music",PATCH_SHIFT:"sounds/patch_shift",THUNDERBOLT:"sounds/thunderbolt",WIND:"sounds/wind",COLLECT_COINS:"sounds/collect_coins",COLLECT_STOCK_COINS:"sounds/collect_stock_coins",LEVEL_FAIL_TIMEOUT:"sounds/level_fail_timeout",STAR_CHEST_DRUM_ROLL:"sounds/star_chest_drum_roll",STAR_CHEST_OPEN:"sounds/star_chest_open",LEADERBOARD_TRIUMPH:"sounds/leaderboard_triumph",ITEM_REWARD:"sounds/item_reward"},Fi=ki.vals(xi),Bi=Fi.reduce(((e,t,i)=>({...e,[t]:i})),{});I(Bi);const Gi=Fi;i._RF.pop(),i._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var zi=function(e){return e[e.RESCUES_SCREEN=0]="RESCUES_SCREEN",e[e.LOADING_SCREEN=1]="LOADING_SCREEN",e[e.GET_ITEM_SCREEN=2]="GET_ITEM_SCREEN",e[e.GET_COIN_SCREEN=3]="GET_COIN_SCREEN",e[e.SETTINGS_SCREEN=4]="SETTINGS_SCREEN",e[e.START_LEVEL_SCREEN=5]="START_LEVEL_SCREEN",e[e.NOTIFICATION_SCREEN=6]="NOTIFICATION_SCREEN",e[e.LEVEL_COMPLETE_SCREEN=7]="LEVEL_COMPLETE_SCREEN",e[e.CONGRATULATION_SCREEN=8]="CONGRATULATION_SCREEN",e[e.QUIT_LEVEL_SCREEN=9]="QUIT_LEVEL_SCREEN",e[e.TOURNAMENT_DETAIL_SCREEN=10]="TOURNAMENT_DETAIL_SCREEN",e[e.DAILY_REWARDS_SCREEN=11]="DAILY_REWARDS_SCREEN",e[e.STAR_CHEST_SCREEN=12]="STAR_CHEST_SCREEN",e}(zi||{});const Ui={[zi.RESCUES_SCREEN]:"RescuesScreen",[zi.LOADING_SCREEN]:"LoadingScreen",[zi.GET_ITEM_SCREEN]:"GetItemScreen",[zi.GET_COIN_SCREEN]:"GetCoinScreen",[zi.SETTINGS_SCREEN]:"SettingsScreen",[zi.START_LEVEL_SCREEN]:"StartLevelScreen",[zi.NOTIFICATION_SCREEN]:"NotificationScreen",[zi.LEVEL_COMPLETE_SCREEN]:"LevelCompleteScreen",[zi.CONGRATULATION_SCREEN]:"CongratulationScreen",[zi.QUIT_LEVEL_SCREEN]:"QuitLevelScreen",[zi.TOURNAMENT_DETAIL_SCREEN]:"TournamentDetailScreen",[zi.DAILY_REWARDS_SCREEN]:"DailyRewardsScreen",[zi.STAR_CHEST_SCREEN]:"StarChestScreen"},Hi={[Ui[zi.RESCUES_SCREEN]]:zi.RESCUES_SCREEN,[Ui[zi.LOADING_SCREEN]]:zi.LOADING_SCREEN,[Ui[zi.GET_ITEM_SCREEN]]:zi.GET_ITEM_SCREEN,[Ui[zi.GET_COIN_SCREEN]]:zi.GET_COIN_SCREEN,[Ui[zi.SETTINGS_SCREEN]]:zi.SETTINGS_SCREEN,[Ui[zi.START_LEVEL_SCREEN]]:zi.START_LEVEL_SCREEN,[Ui[zi.NOTIFICATION_SCREEN]]:zi.NOTIFICATION_SCREEN,[Ui[zi.LEVEL_COMPLETE_SCREEN]]:zi.LEVEL_COMPLETE_SCREEN,[Ui[zi.CONGRATULATION_SCREEN]]:zi.CONGRATULATION_SCREEN,[Ui[zi.QUIT_LEVEL_SCREEN]]:zi.QUIT_LEVEL_SCREEN,[Ui[zi.TOURNAMENT_DETAIL_SCREEN]]:zi.TOURNAMENT_DETAIL_SCREEN,[Ui[zi.DAILY_REWARDS_SCREEN]]:zi.DAILY_REWARDS_SCREEN,[Ui[zi.STAR_CHEST_SCREEN]]:zi.STAR_CHEST_SCREEN},Vi=[zi[zi.NOTIFICATION_SCREEN],zi[zi.LOADING_SCREEN]];i._RF.pop(),i._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);const{analytics:qi}=globalThis.game,{Array:Wi}=GameCore.Utils;class Ki{static get inst(){return this._instance||(this._instance=new Ki),this._instance}static trackCurrentPage(e,t){if(Wi.has(Vi,e))return;if(!t&&!Wi.has(this.trackingPages,e))return;this.trackingPages=this.trackingPages.filter((t=>t!==e)),t&&this.trackingPages.push(e);const i=this.getCurrentPage();qi.pageview(i)}static switchSceneTracking(){this.trackingPages=[];const e=this.getCurrentPage();qi.pageview(e)}static getCurrentPage(){return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:m.getScene()?.name??"Unknown Scene"}}Ki.trackingPages=[];try{new Ki}catch(e){console.error("AnalyticsUtils",e)}i._RF.pop(),i._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);class Yi{static get inst(){return this._instance||(this._instance=new Yi),this._instance}get sound(){return P("Sound")?.getComponent(wt)??null}get music(){return P("Music")?.getComponent(ct)??null}static muteAudio(e){this.muteMusic(e),this.muteSound(e)}static playSound(e,t){this.inst.sound?.play(e,t)}static pauseSound(e){this.inst.sound?.pause(e)}static resumeSound(e){this.inst.sound?.resume(e)}static stopSound(e){this.inst.sound?.stop(e)}static stopAllSounds(){this.inst.sound?.stopAll()}static muteSound(e){this.inst.sound?.mute(e)}static playMusic(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.inst.music?.playing(xi.BG_MUSIC)||this.inst.music?.play(xi.BG_MUSIC)}static pauseMusic(){this.inst.music?.pause(xi.BG_MUSIC)}static muteMusic(e){this.inst.music?.mute(e)}static turnUpMusic(){this.inst.music?.setVolume(.8)}static turnDownMusic(){this.inst.music?.setVolume(.4)}static turnOffMusic(){this.inst.music?.setVolume(0)}}try{new Yi}catch(e){console.error("AudioUtils",e)}i._RF.pop(),i._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);class ji{static get inst(){return this._instance||(this._instance=new ji),this._instance}static getBoundingBoxToWorld(e){if(e.parent){const t=e.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(t,e)}const t=e.getComponent(l);if(!t)throw new Error("Node must have UITransform component");return t.getBoundingBox()}static worldSizeToCssSize(e){return e*this.inst.getWindowSizeVsWorldGameRatio()}static cssSizeToWorldSize(e){return e/this.inst.getWindowSizeVsWorldGameRatio()}static getScreenWidthCss(){const{body:e,documentElement:t}=document,{clientWidth:i}=e,{clientWidth:n}=t;return Math.max(n,i)||0}static getScreenHeightCss(){const{body:e,documentElement:t}=document,{clientHeight:i}=e,{clientHeight:n}=t;return Math.max(n,i)||0}getWindowSizeVsWorldGameRatio(){const e=F.getVisibleSize(),{width:t}=B.windowSize;return t/window.devicePixelRatio/e.width}getBoundingBoxTo(e,t){const i=G.mat4();G.Mat4.fromSRT(i,t.getRotation(),t.getPosition(),t.getScale());const n=t.getComponent(l);if(!n)throw new Error("Node must have UITransform component");const{anchorPoint:a,contentSize:s}=n,{width:o,height:r}=s,c=new G.Rect(-a.x*o,-a.y*r,o,r),h=G.mat4();if(G.Mat4.multiply(h,e,i),c.transformMat4(h),!t.children||0===t.children.length)return c;const d=t.children,u=t.getWorldMatrix();for(const e of d){if(!e?.active)continue;if(e.getComponent(l)){const t=this.getBoundingBoxTo(u,e);t&&G.Rect.union(c,c,t)}}return c}}try{new ji}catch(e){console.error("CocosUtils",e)}var Xi,$i,Qi,Ji,Zi,en,tn,nn,an,sn,on,rn,ln,cn,hn,dn,un,pn,mn,gn,yn,bn,fn,wn,Sn,vn,Cn,En,Tn,An,Rn,In,Pn;i._RF.pop(),i._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);const{ccclass:_n,property:Ln,disallowMultiple:Dn,executionOrder:On}=a,{analytics:Nn}=globalThis.game;let Mn=(Xi=_n("ExtendedButton"),$i=On(111),Qi=Ln(z),Ji=Ln(z),Zi=Ln(U.AnimationController),en=Ln({override:!0,visible:!1}),tn=Ln({override:!0,visible:!1}),nn=Ln({override:!0,visible:!1}),an=Ln({override:!0,visible:!1}),sn=Ln({override:!0,visible:!1}),on=Ln({override:!0,visible:!1}),rn=Ln({override:!0,visible:!1}),ln=Ln({override:!0,visible:!1}),cn=Ln({override:!0,visible:!1}),hn=Ln({override:!0,visible:!1}),dn=Ln({override:!0,visible:!1}),un=Ln(H),pn=Ln(H),mn=Ln(H),gn=Ln({visible(){return this.makeSound},type:Bi}),yn=Ln({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),bn=Ln({visible(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),Xi(fn=Dn(fn=$i((Sn=ve((wn=class extends p{constructor(){super(...arguments),e(this,"clickStartEvents",Sn,this),e(this,"clickEndEvents",vn,this),e(this,"animationController",Cn,this),e(this,"useDesktopHover",En,this),e(this,"emitAnalyticsEvents",Tn,this),e(this,"makeSound",An,this),e(this,"soundKey",Rn,this),e(this,"disableSpamClick",In,this),e(this,"disableSpamDelay",Pn,this),this.currentClickBoundingBox=null,this.hasDown=!1,this.hasUp=!1,this.hasFinishClickCycle=!1,this.onTouchStart=e=>{this.interactable&&(this.hasDown||(this.currentClickBoundingBox=ji.getBoundingBoxToWorld(this.node),this.handleDown(e)))},this.onTouchEnd=e=>{this.interactable&&this.hasDown&&(this.hasUp||this.handleUp(e))},this.onTouchCancel=e=>{if(!this.interactable)return;if(!this.hasDown)return;if(this.hasUp)return;const t=e.getUILocation();this.currentClickBoundingBox?.contains(t)??1?(this.hasUp=!0,this.hasFinishClickCycle=!0,this.handleResetButtonState(),this.emitClickEndEvents(e)):this.handleUp(e)},this.onMouseEnter=e=>{this.useDesktopHover&&this.interactable&&(this.hasDown||(this.hasFinishClickCycle=!1,this.setAnimationState("HOVER")))},this.onMouseLeave=e=>{this.useDesktopHover&&this.interactable&&(this.hasDown||this.hasUp||this.hasFinishClickCycle||this.handleResetButtonState())},this.handleResetButtonState=()=>{this.hasDown=!1,this.hasUp=!1,this.setAnimationState("RESET")}}get transition(){return p.Transition.NONE}set transition(e){super.transition=p.Transition.NONE}get normalColor(){return super.normalColor}set normalColor(e){super.normalColor=e}get pressedColor(){return super.pressedColor}set pressedColor(e){super.pressedColor=e}get hoverColor(){return super.hoverColor}set hoverColor(e){super.hoverColor=e}get disabledColor(){return super.disabledColor}set disabledColor(e){super.disabledColor=e}get normalSprite(){return super.normalSprite}set normalSprite(e){super.normalSprite=e}get pressedSprite(){return super.pressedSprite}set pressedSprite(e){super.pressedSprite=e}get hoverSprite(){return super.hoverSprite}set hoverSprite(e){super.hoverSprite=e}get disabledSprite(){return super.disabledSprite}set disabledSprite(e){super.disabledSprite=e}get duration(){return super.duration}set duration(e){super.duration=e}get zoomScale(){return super.zoomScale}set zoomScale(e){super.zoomScale=e}__preload(){super.__preload(),Fe.lazyValidateProperties(this)}onDestroy(){super.onDestroy?.()}onEnable(){super.onEnable?.(),this.node.off(V.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(n.EventType.TOUCH_START,this.onTouchStart),this.node.on(n.EventType.TOUCH_END,this.onTouchEnd),this.node.on(n.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onDisable(){super.onDisable?.(),this.node.off(n.EventType.TOUCH_START,this.onTouchStart),this.node.off(n.EventType.TOUCH_END,this.onTouchEnd),this.node.off(n.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(n.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}handleDown(e){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&Yi.playSound(Gi[this.soundKey]),this.emitClickStartEvents(e)}emitClickStartEvents(e){this.clickStartEvents.forEach((t=>{t.emit([e,t.customEventData])}))}emitClickEndEvents(e){this.clickEndEvents.forEach((t=>{t.emit([e,t.customEventData])}))}handleUp(e){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}emitButtonEvents(e){this.interactable&&(this.emitAnalyticsEvents&&Nn.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:Ki.getCurrentPage()}),this.clickEvents.forEach((t=>{t.emit([e,t.customEventData])})))}setAnimationState(e){this.animationController.setValue("DOWN","DOWN"===e),this.animationController.setValue("HOVER","HOVER"===e),this.animationController.setValue("RESET","RESET"===e)}fakeClick(){this.setAnimationState("DOWN"),this.scheduleOnce((()=>{this.setAnimationState("RESET")}),0)}resetButtonState(){this.handleResetButtonState()}}).prototype,"clickStartEvents",[Qi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vn=ve(wn.prototype,"clickEndEvents",[Ji],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cn=ve(wn.prototype,"animationController",[Zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(wn.prototype,"transition",[en],Object.getOwnPropertyDescriptor(wn.prototype,"transition"),wn.prototype),ve(wn.prototype,"normalColor",[tn],Object.getOwnPropertyDescriptor(wn.prototype,"normalColor"),wn.prototype),ve(wn.prototype,"pressedColor",[nn],Object.getOwnPropertyDescriptor(wn.prototype,"pressedColor"),wn.prototype),ve(wn.prototype,"hoverColor",[an],Object.getOwnPropertyDescriptor(wn.prototype,"hoverColor"),wn.prototype),ve(wn.prototype,"disabledColor",[sn],Object.getOwnPropertyDescriptor(wn.prototype,"disabledColor"),wn.prototype),ve(wn.prototype,"normalSprite",[on],Object.getOwnPropertyDescriptor(wn.prototype,"normalSprite"),wn.prototype),ve(wn.prototype,"pressedSprite",[rn],Object.getOwnPropertyDescriptor(wn.prototype,"pressedSprite"),wn.prototype),ve(wn.prototype,"hoverSprite",[ln],Object.getOwnPropertyDescriptor(wn.prototype,"hoverSprite"),wn.prototype),ve(wn.prototype,"disabledSprite",[cn],Object.getOwnPropertyDescriptor(wn.prototype,"disabledSprite"),wn.prototype),ve(wn.prototype,"duration",[hn],Object.getOwnPropertyDescriptor(wn.prototype,"duration"),wn.prototype),ve(wn.prototype,"zoomScale",[dn],Object.getOwnPropertyDescriptor(wn.prototype,"zoomScale"),wn.prototype),En=ve(wn.prototype,"useDesktopHover",[un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Tn=ve(wn.prototype,"emitAnalyticsEvents",[pn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),An=ve(wn.prototype,"makeSound",[mn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Rn=ve(wn.prototype,"soundKey",[gn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Bi[xi.BUTTON_CLICK]}}),In=ve(wn.prototype,"disableSpamClick",[yn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Pn=ve(wn.prototype,"disableSpamDelay",[bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),fn=wn))||fn)||fn)||fn);var kn,xn,Fn,Bn;i._RF.pop(),i._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);const{ccclass:Gn,requireComponent:zn,property:Un}=a;let Hn=Gn("OpacityToggler")(kn=zn([x])((Fn=ve((xn=class extends s{constructor(){super(...arguments),e(this,"activeValue",Fn,this),e(this,"inActiveValue",Bn,this),this.signal=new ai}__preload(){this.opacityComponent=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}changeState(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.signal.abort(),this.opacityComponent.opacity=e?this.activeValue:this.inActiveValue}async changeStateFade(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;this.signal.abort(),this.signal=new ai;const i=e?this.activeValue:this.inActiveValue;await St.runTweenAsync(C(this.opacityComponent).to(t,{opacity:i}),this.signal)}}).prototype,"activeValue",[Un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),Bn=ve(xn.prototype,"inActiveValue",[Un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),kn=xn))||kn)||kn;i._RF.pop(),i._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);const Vn="view-resize",qn="view-resized",Wn="request-view-resize",Kn="layout-changed",Yn="gameplay-update-config",jn="opened-skip-overlay",Xn="closed-skip-overlay",$n="result-scene-replay",Qn="result-scene-home",Jn="upgrade-quality",Zn="upgrade-dynamic-atlas";i._RF.pop(),i._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);const ea={Layout:{Portrait:"portrait",Landscape:"landscape"},DesignSize:{Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}},FORCE_LAYOUT:"none",FIT_CANVAS_TO_VIEW:!1,FULL_PORTRAIT_SIZE:!0,FULL_LANDSCAPE_SIZE:!0};var ta,ia,na;i._RF.pop(),i._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);const{ccclass:aa,property:sa,requireComponent:oa,disallowMultiple:ra,executeInEditMode:la}=a,{Portrait:ca,Landscape:ha}=ea.DesignSize;aa("DebugResolution")(ta=ra(ta=oa([q])(ta=la(!0)(((na=class e extends s{constructor(){super(...arguments),this.handleLayoutChange=()=>{this.graphics?.clear(),this.start()}}set drawPortrait(t){t!==e._drawPortrait&&(t?this.drawPortraitResolution():this.graphics.clear(),e._drawPortrait=t,e._drawLandscape&&this.drawLandscapeResolution())}get drawPortrait(){return e._drawPortrait}set drawLandscape(t){t!==e._drawLandscape&&(t?this.drawLandscapeResolution():this.graphics.clear(),e._drawLandscape=t,e._drawPortrait&&this.drawPortraitResolution())}get drawLandscape(){return e._drawLandscape}__preload(){this.graphics=this.getComponent(q),this.validateRequiredComponents(),this.listenGameEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenGameEvents(){W.on(Kn,this.handleLayoutChange)}start(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}drawPortraitResolution(){const{graphics:e}=this,t=ca.WIDTH,i=ca.HEIGHT,n=-t/2,a=-i/2;e.strokeColor=o.GREEN,e.rect(n,a,t,i),e.stroke()}drawLandscapeResolution(){const{graphics:e}=this,t=ha.WIDTH,i=ha.HEIGHT,n=-t/2;let a=-i/2;e.strokeColor=o.CYAN,e.rect(n,a,t,i),e.stroke()}})._drawPortrait=!0,na._drawLandscape=!0,ve((ia=na).prototype,"drawPortrait",[sa],Object.getOwnPropertyDescriptor(ia.prototype,"drawPortrait"),ia.prototype),ve(ia.prototype,"drawLandscape",[sa],Object.getOwnPropertyDescriptor(ia.prototype,"drawLandscape"),ia.prototype),ta=ia))||ta)||ta)||ta);var da,ua,pa,ma,ga,ya,ba,fa,wa,Sa,va,Ca,Ea,Ta,Aa,Ra,Ia,Pa,_a,La;i._RF.pop(),i._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);const{ccclass:Da,executionOrder:Oa,property:Na}=a,{Utils:Ma}=GameCore,ka=o.RED,xa=o.BLACK,Fa=o.MAGENTA;da=Da("GameStats"),ua=Oa(-1e3),pa=Na(h),ma=Na(h),ga=Na(h),ya=Na(h),ba=Na(h),fa=Na(h),wa=Na(h),Sa=Na(h),da(va=ua((Ea=ve((Ca=class extends s{constructor(){super(...arguments),e(this,"fpsLabel",Ea,this),e(this,"drawCountLabel",Ta,this),e(this,"logicTimeLabel",Aa,this),e(this,"physicTimeLabel",Ra,this),e(this,"renderTimeLabel",Ia,this),e(this,"objectMemoryUsageLabel",Pa,this),e(this,"textureMemoryUsageLabel",_a,this),e(this,"devicePixelRatioLabel",La,this),this.refreshInterval=.5,this.handleMouseDown=()=>{this.bg.enabled=!this.bg.enabled},this.waitForStats=()=>{K.stats&&(this.unschedule(this.waitForStats),this.node.active=!0,this.stats=K.stats,this.startUpdateStats())},this.updateStats=()=>{this.updateFps(),this.updateDrawCalls(),this.updateLogicTime(),this.updatePhysicTime(),this.updateRenderTime(),this.updateObjectMemoryUsage(),this.updateTextureMemoryUsage(),this.updateDevicePixelRatio()}}__preload(){this.bg=this.getComponent(R),this.validateRequiredComponents(),this.listenInputEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenInputEvents(){this.node.on(V.EventType.TOUCH_START,this.handleMouseDown)}start(){this.bg.enabled=!1,this.node.active=!1,K&&Ma.Valid.isDebugger()&&(K.showStats(),this.schedule(this.waitForStats,.5,20))}startUpdateStats(){this.schedule(this.updateStats,this.refreshInterval)}updateFps(){const e=this.getFps();this.updateFpsColor(e),this.fpsLabel.string=`FPS: ${e}`}updateFpsColor(e){this.fpsLabel.color=e<30?ka:e<48?Fa:xa}updateDrawCalls(){const e=this.getDrawCalls();this.updateDrawCallsColor(e),this.drawCountLabel.string=`Draw Calls: ${e}`}updateDrawCallsColor(e){const t=Y.os===Y.OS.IOS,i=t?80:25,n=t?60:15;this.drawCountLabel.color=e>i?ka:e>n?Fa:xa}updateLogicTime(){const e=this.getLogicTime();this.updateLogicTimeColor(e),this.logicTimeLabel.string=`Logic Time: ${e.toFixed(2)}ms`}updateLogicTimeColor(e){this.logicTimeLabel.color=e>10?ka:e>5?Fa:xa}updatePhysicTime(){const e=this.getPhysicTime();this.updatePhysicTimeColor(e),this.physicTimeLabel.string=`Physic Time: ${e.toFixed(2)}ms`}updatePhysicTimeColor(e){this.physicTimeLabel.color=e>10?ka:e>5?Fa:xa}updateRenderTime(){const e=this.getRenderTime();this.updateRenderTimeColor(e),this.renderTimeLabel.string=`Render Time: ${e.toFixed(2)}ms`}updateRenderTimeColor(e){this.renderTimeLabel.color=e>10?ka:e>5?Fa:xa}updateObjectMemoryUsage(){const e=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(e),this.objectMemoryUsageLabel.string=`Object Mem: ${e.toFixed(2)}MB`}updateObjectMemoryUsageColor(e){this.objectMemoryUsageLabel.color=e>40?ka:e>25?Fa:xa}updateTextureMemoryUsage(){const e=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(e),this.textureMemoryUsageLabel.string=`Texture Mem: ${e.toFixed(2)}MB`}updateTextureMemoryUsageColor(e){this.textureMemoryUsageLabel.color=e>50?ka:e>35?Fa:xa}updateDevicePixelRatio(){const e=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(e),this.devicePixelRatioLabel.string=`Device Pixel Ratio: ${e}`}updateDevicePixelRatioColor(e){this.devicePixelRatioLabel.color=e>2?ka:e<=1?Fa:xa}getFps(){const{counter:e}=this.stats.fps;return Math.floor(e.value)||0}getDrawCalls(){const{counter:e}=this.stats.draws;return e.value||0}getLogicTime(){const{counter:e}=this.stats.logic;return Math.floor(1e3*e.value)/1e3||0}getPhysicTime(){const{counter:e}=this.stats.physics;return Math.floor(1e3*e.value)/1e3||0}getRenderTime(){const{counter:e}=this.stats.render;return Math.floor(1e3*e.value)/1e3||0}getObjectMemoryUsage(){const{counter:e}=this.stats.bufferMemory;return Math.floor(1e3*e.value)/1e3||0}getTextureMemoryUsage(){const{counter:e}=this.stats.textureMemory;return Math.floor(1e3*e.value)/1e3||0}getDevicePixelRatio(){return window.devicePixelRatio||0}}).prototype,"fpsLabel",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta=ve(Ca.prototype,"drawCountLabel",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Aa=ve(Ca.prototype,"logicTimeLabel",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ra=ve(Ca.prototype,"physicTimeLabel",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ia=ve(Ca.prototype,"renderTimeLabel",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pa=ve(Ca.prototype,"objectMemoryUsageLabel",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_a=ve(Ca.prototype,"textureMemoryUsageLabel",[wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La=ve(Ca.prototype,"devicePixelRatioLabel",[Sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),va=Ca))||va);i._RF.pop(),i._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var Ba,Ga=function(e){return e.INVITE_FRIENDS="invite-friends",e.REPLAY_FRIENDS="replay-friends",e.SHOW_CHALLENGE_RESULTS="show-challenge-results",e.NEXT_LEVEL="next-level",e.MAX_LEVEL="max-level",e.START_OVER="start-over",e.SELECT_LEVEL="select-level",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_REPLAY="game-replay",e.GAME_FINISH="game-finish",e.GAME_EXIT="game-exit",e.USE_ITEM="use-item",e.SKIP_LEVEL="skip-level",e.ADD_ITEM="add-item",e.ADD_ITEMS="add-items",e.ADD_COINS="add-coins",e.REMOVE_COINS="remove-coins",e.REMOVE_COINS_SUCCESS="remove-coins-success",e.REMOVE_COINS_FAILED="remove-coins-failed",e.COIN_CHANGED="coin-changed",e.ADD_STARS="add-stars",e.PAUSE_TIME="pause-time",e.RESUME_TIME="resume-time",e.TIME_OUT="time-out",e.HALF_TIME="half-time",e.RESCUE_START="rescue-time",e.RESCUE_FINISHED="clock-animation-finished",e.APPLY_GRAVITY="apply-gravity",e.IDLE_ENTER="idle-enter",e.IDLE_EXIT="idle-exit",e.GRID_MATCH="grid-match",e.GRID_MATCH_SUCCESS="grid-match-success",e.GRID_MATCH_FAIL="grid-match-fail",e.GRID_CLEAR="grid-clear",e.GRID_CREATE="grid-create",e.GRID_RESIZE="grid-resize",e.TILE_CLICK="tile-click",e.BOMB_EXPLODE="bomb-explode",e.SHOW_HINT="show-hint",e.ADD_COMBO="add-combo",e.COMBO_UPDATED="combo-updated",e.COMBO_ENDED="combo-ended",e.ADD_SCORE="add-score",e.SCORE_UPDATED="score-updated",e.REGISTER_ANIMATOR="register-animator",e.UNREGISTER_ANIMATOR="unregister-animator",e.SHOW_UI="show-ui",e.HIDE_UI="hide-ui",e.AUTO_PLAY="auto-play",e.GUIDE_MASK_CLICKED="guide-mask-clicked",e}(Ga||{});i._RF.pop(),i._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);const{ccclass:za}=a;let Ua=za("PanelAnimationController")(Ba=class extends s{constructor(){super(...arguments),this.animators=new Set,this.handleRegistration=e=>{if(!e)throw new Error("Invalid event payload.");this.animators.has(e)&&console.warn("Animator already registered."),this.animators.add(e)},this.handleUnregistration=e=>{if(!e)throw new Error("Invalid event payload.");this.animators.has(e)||console.warn("Animator not registered."),this.animators.delete(e)},this.handleShowUIs=e=>{let t=!1;const i=this.animators.values(),n=[];for(const a of i)a.isReadyForAnimation()||t||(t=!0,e?.fallback?.()),n.push(a.handleShowUI());void 0!==e?.onComplete&&n.length>0&&Promise.all(n).then(e.onComplete)},this.handleHideUIs=e=>{let t=!1;const i=this.animators.values(),n=[];for(const a of i)a.isReadyForAnimation()||t||(t=!0,e?.fallback?.()),n.push(a.handleHideUI());void 0!==e?.onComplete&&n.length>0&&Promise.all(n).then(e.onComplete)}}init(){this.node.scene.off(Ga.REGISTER_ANIMATOR),this.node.scene.off(Ga.UNREGISTER_ANIMATOR),this.node.scene.off(Ga.SHOW_UI),this.node.scene.off(Ga.HIDE_UI),this.node.scene.on(Ga.REGISTER_ANIMATOR,this.handleRegistration),this.node.scene.on(Ga.UNREGISTER_ANIMATOR,this.handleUnregistration),this.node.scene.on(Ga.SHOW_UI,this.handleShowUIs),this.node.scene.on(Ga.HIDE_UI,this.handleHideUIs)}})||Ba;var Ha,Va,qa,Wa,Ka,Ya,ja,Xa,$a,Qa,Ja,Za,es,ts,is,ns,as,ss;i._RF.pop(),i._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);const{ccclass:os,property:rs}=a,{Object:ls}=GameCore.Utils;let cs=(Ha=os("AnimationConfig"),Va=rs({type:[A]}),Ha((Ka=ve((Wa=class{constructor(){e(this,"startHidden",Ka,this),e(this,"nodes",Ya,this),e(this,"posOffset",ja,this),e(this,"showEase",Xa,this),e(this,"hideEase",$a,this),e(this,"showDuration",Qa,this),e(this,"hideDuration",Ja,this)}setConfig(e){e&&ls.assign(this,e)}}).prototype,"startHidden",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ya=ve(Wa.prototype,"nodes",[Va],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ja=ve(Wa.prototype,"posOffset",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xa=ve(Wa.prototype,"showEase",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),$a=ve(Wa.prototype,"hideEase",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),Qa=ve(Wa.prototype,"showDuration",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ja=ve(Wa.prototype,"hideDuration",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qa=Wa))||qa),hs=(Za=os("PanelAnimator"),es=rs({type:cs,displayName:"Top animation nodes"}),ts=rs({type:cs,displayName:"Bottom animation nodes"}),Za((as=ve((ns=class t extends s{constructor(){super(...arguments),e(this,"topConfig",as,this),e(this,"botConfig",ss,this),this.isReady=!1}onEnable(){this.node.scene.emit(Ga.REGISTER_ANIMATOR,this)}onDisable(){this.node.scene.emit(Ga.UNREGISTER_ANIMATOR,this)}onLoad(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}initUIPos(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}isReadyForAnimation(){return this.isReady}async handleShowUI(){if(this.isReady)return Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")]);console.warn(`${this.node.name}'s ${this.name}: not ready`)}async handleHideUI(){if(this.isReady)return Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")]);console.warn(`${this.node.name}'s ${this.name}: not ready`)}createAnimator(e,i){let{nodes:n,posOffset:a,showEase:s,hideEase:o,showDuration:r,hideDuration:l}=e;const c=n.map((e=>"top"===i&&e.isAlignTop?{mode:"top",value:e.top}:"bottom"===i&&e.isAlignBottom?{mode:"bottom",value:e.bottom}:{mode:"position",value:e.node.position.y})),h=n.map((e=>"top"===i&&e.isAlignTop?{mode:"top",value:e.top+a}:"bottom"===i&&e.isAlignBottom?{mode:"bottom",value:e.bottom-a}:{mode:"position",value:e.node.position.y+a}));let d="shown";return{switchState:function(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(d===e)return Promise.resolve(null);d=e;const a="hidden"===e?c:h,u="hidden"===e?h:c,p="hidden"===e?l:r,m="hidden"===e?o:s;return i?(n.forEach(((e,t)=>{const i=a[t],n=u[t].value;"top"===i.mode&&(e.top=n),"bottom"===i.mode&&(e.bottom=n),"position"===i.mode&&(e.node.position=new j(e.node.position.x,n,e.node.position.z))})),Promise.resolve(null)):Promise.all(n.map(((e,i)=>{const n=a[i],s=u[i].value;return St.runTweenAsync(t.getTween({widget:e,config:n,target:s,easing:m,duration:p}))})))}}}setAnimator(e){let{topConfig:t,botConfig:i}=e;const n=new cs,a=new cs;n.setConfig(t),a.setConfig(i),this.topConfig=n,this.botConfig=a,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}static getTween(e){let{widget:t,config:i,target:n,easing:a,duration:s}=e;return"top"===i.mode?C(t).call((()=>{t.top=i.value})).to(s,{top:n},{easing:a}):"bottom"===i.mode?C(t).call((()=>{t.bottom=i.value})).to(s,{bottom:n},{easing:a}):C(t.node.position).call((()=>{t.node.position=new j(t.node.position.x,i.value,t.node.position.z)})).to(s,{y:n},{easing:a})}}).prototype,"topConfig",[es],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new cs}}),ss=ve(ns.prototype,"botConfig",[ts],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new cs}}),is=ns))||is);var ds,us,ps,ms;i._RF.pop(),i._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);const{ccclass:gs,requireComponent:ys,property:bs}=a,{ads:fs,event:ws}=globalThis.game;gs("ResizeWithBannerAd")(ds=ys(A)((ps=ve((us=class t extends s{constructor(){super(...arguments),e(this,"willShowBanner",ps,this),e(this,"includeSAB",ms,this),this.handleAdShow=e=>{let{placementId:t}=e;if(null===t)return;fs.getAdByPlacementId(t)?.type===GameCore.Plugins.Ads.Types.BANNER&&this.resizeToFitBannerAd()},this.handleAdClose=e=>{let{placementId:t}=e;if(null===t)return;fs.getAdByPlacementId(t)?.type===GameCore.Plugins.Ads.Types.BANNER&&this.updateWidgets(fs.getSafeAreaBottom(ji.cssSizeToWorldSize(1)))}}__preload(){this.widget=this.getComponent(A),Fe.lazyValidateProperties(this),ws.on(GameCore.Events.AD_SHOWING,this.handleAdShow),ws.on(GameCore.Events.AD_CLOSED,this.handleAdClose)}onDestroy(){ws.off(GameCore.Events.AD_SHOWING,this.handleAdShow),ws.off(GameCore.Events.AD_CLOSED,this.handleAdClose)}start(){const e=fs.getSafeAreaBottom(ji.cssSizeToWorldSize(1));this.willShowBanner||t.isBannerAdShowing()?this.resizeToFitBannerAd():e>0&&this.includeSAB&&this.updateWidgets(e)}resizeToFitBannerAd(){const{Enabled:e,BannerDisplayAdOptions:t}=GameCore.Configs.Ads;if(!e)return;if(!this.widget.isAlignBottom)return void console.warn("Widget does not align to bottom, ResizeWithBannerAds will have no effect!");let i=null,n=null,a=null,s=null;const o=ji.cssSizeToWorldSize(1);t.forEach((e=>{let{PlacementId:t,Position:r,BannerWidth:l}=e;if(fs.canbeShowBannerAd(t))switch(r){case"top":i=fs.getBannerHeight(t,o);break;case"bottom":n=fs.getBannerHeight(t,o,this.includeSAB);break;case"left":{if(void 0===l)break;let e=l;"getBannerOffset"in GameSDK.extra&&(e+=GameSDK.extra.getBannerOffset()),a=e*o;break}case"right":{if(void 0===l)break;let e=l;"getBannerOffset"in GameSDK.extra&&(e+=GameSDK.extra.getBannerOffset()),s=e*o;break}}})),this.updateWidgets(i,n,a,s)}updateWidgets(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.widget.top=e??this.widget.top,this.widget.bottom=t??this.widget.bottom,this.widget.left=i??this.widget.left,this.widget.right=n??this.widget.right,this.widget.updateAlignment();this.getComponentsInChildren(A).forEach((e=>{e.updateAlignment()}))}static isBannerAdShowing(){return fs.enabled&&fs.getAdStatus(GameCore.Plugins.Ads.Types.BANNER)===GameCore.Plugins.Ads.Status.SHOWING}}).prototype,"willShowBanner",[bs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ms=ve(us.prototype,"includeSAB",[bs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ds=us))||ds);var Ss,vs,Cs,Es,Ts,As,Rs,Is,Ps,_s,Ls;i._RF.pop(),i._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);const{ccclass:Ds,property:Os,executeInEditMode:Ns,requireComponent:Ms}=a;let ks=(Ss=Ds("TapperedProgressBar"),vs=Ms(x),Cs=Os({type:x,displayName:"Fill opacity"}),Es=Os({type:R,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),Ts=Os({type:R,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),As=Os({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),Ss(Rs=Ns(Rs=vs((Ps=ve((Is=class extends X{constructor(){super(...arguments),e(this,"uiOpacity",Ps,this),e(this,"leftCap",_s,this),e(this,"rightCap",Ls,this)}get progress(){return super.progress}set progress(e){super.progress=e,this.updateAppearance()}updateAppearance(){if(null===this.uiOpacity)return;if(this.progress<=0)return void(this.uiOpacity.opacity=0);if(this.progress>.1)return void(this.uiOpacity.opacity=255);const e=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=e}start(){this.updateAppearance()}}).prototype,"uiOpacity",[Cs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_s=ve(Is.prototype,"leftCap",[Es],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ls=ve(Is.prototype,"rightCap",[Ts],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve(Is.prototype,"progress",[As],Object.getOwnPropertyDescriptor(Is.prototype,"progress"),Is.prototype),Rs=Is))||Rs)||Rs)||Rs);var xs,Fs,Bs,Gs,zs,Us,Hs,Vs,qs,Ws;i._RF.pop(),i._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);const{ccclass:Ks,property:Ys,requireComponent:js,executeInEditMode:Xs,disallowMultiple:$s}=a,{language:Qs}=globalThis.game;xs=Ks("Localize"),Fs=js(h),Bs=Xs(!0),Gs=Ys({visible:!0}),zs=Ys({group:{name:"Fonts",id:"fonts",displayOrder:1},type:$}),Us=Ys({group:{name:"Fonts",id:"fonts",displayOrder:2},type:$}),xs(Hs=$s(Hs=Fs(Hs=Bs((ve((Vs=class extends s{constructor(){super(...arguments),e(this,"enFont",qs,this),e(this,"ruFont",Ws,this),this.handleLanguageChanged=()=>{this.updateTransToNode()}}set key(e){e&&(this._key=e,this.updateTransToNode())}get key(){return this._key}__preload(){this.label=this.getComponent(h),this.validateRequiredComponents(),this.updateTransToNode()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}start(){this.listenEvent()}listenEvent(){W.on("update-language",this.handleLanguageChanged)}updateTransToNode(){if(this.node.active&&this._key)try{const e=Qs.getText(this._key),t=this.getFontByLang();this.label.font=t,this.label.string=e,this.node.emit("update-trans",e)}catch(e){console.warn(e)}}getFontByLang(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(Qs.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}).prototype,"key",[Gs],Object.getOwnPropertyDescriptor(Vs.prototype,"key"),Vs.prototype),qs=ve(Vs.prototype,"enFont",[zs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ws=ve(Vs.prototype,"ruFont",[Us],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hs=Vs))||Hs)||Hs)||Hs);var Js,Zs,eo,to,io,no,ao,so,oo;i._RF.pop(),i._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);const{ccclass:ro,property:lo}=a;class co{constructor(e,t){t=t??{response:1,dampen:1,eager:1},this.k1=co.calcK1(t),this.k2=co.calcK2(t),this.k3=co.calcK3(t),this.xp=e.clone(),this.y=e.clone(),this.yd=new Q(0,0)}update(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===i&&(i=new Q((t.x-this.xp.x)/e,(t.y-this.xp.y)/e),this.xp.x=t.x,this.xp.y=t.y);const n=Math.max(this.k2,e*e/2+e*this.k1/2,e*this.k1);return this.y.x=this.y.x+e*this.yd.x,this.y.y=this.y.y+e*this.yd.y,this.yd.x=this.yd.x+e*(t.x+this.k3*i.x-this.y.x-this.k1*this.yd.x)/n,this.yd.y=this.yd.y+e*(t.y+this.k3*i.y-this.y.y-this.k1*this.yd.y)/n,this.y}setDynamics(e){this.k1=co.calcK1(e),this.k2=co.calcK2(e),this.k3=co.calcK3(e)}reset(e){this.xp.set(e.x,e.y),this.y.set(e.x,e.y),this.yd.set(0,0)}get currentState(){return this.y}static calcK1(e){return e.dampen/(Math.PI*e.response)}static calcK2(e){return 1/(2*Math.PI*e.response*(2*Math.PI*e.response))}static calcK3(e){return e.eager*e.dampen/(2*Math.PI*e.response)}}let ho=(Js=ro("SODConfig"),Zs=lo({type:E,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),eo=lo({type:E,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),to=lo({type:E,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),Js((ao=ve((no=class{constructor(){e(this,"response",ao,this),e(this,"dampen",so,this),e(this,"eager",oo,this)}}).prototype,"response",[Zs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),so=ve(no.prototype,"dampen",[eo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),oo=ve(no.prototype,"eager",[to],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),io=no))||io);var uo,po,mo,go,yo,bo,fo,wo,So;i._RF.pop(),i._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);const{ccclass:vo,property:Co}=a;let Eo=(uo=vo("Trail"),po=Co({type:n,displayName:"Target"}),mo=Co({type:q,displayName:"Graphics"}),go=Co({type:[ho],displayName:"Trail Nodes"}),uo((fo=ve((bo=class extends s{constructor(){super(...arguments),e(this,"target",fo,this),e(this,"graphics",wo,this),e(this,"trailNodes",So,this),this.trailNodeInstances=[]}reset(){for(const e of this.trailNodeInstances)e.reset(new Q(this.node.worldPosition.x,this.node.worldPosition.y));this.graphics.clear()}onLoad(){this.validateRequiredComponents(),this.spawnTrailNodes()}update(e){this.graphics.clear();const t=this.trailNodeInstances[0];this.drawTrail(e,t,this.target.worldPosition.x,this.target.worldPosition.y);for(let t=1;t<this.trailNodeInstances.length;t++){const i=this.trailNodeInstances[t-1],n=this.trailNodeInstances[t];this.drawTrail(e,n,i.currentState.x,i.currentState.y)}}drawTrail(e,t,i,n){const{graphics:a}=this,s=new Q(i,n),o=t.update(e,s),r=new j(s.x,s.y,0),l=new j(o.x,o.y,0);a.node.inverseTransformPoint(r,r),a.node.inverseTransformPoint(l,l),a.moveTo(r.x,r.y),a.lineTo(l.x,l.y),a.stroke()}spawnTrailNodes(){for(const e of this.trailNodes){const t=new Q(this.node.worldPosition.x,this.node.worldPosition.y),i=new co(t,e);this.trailNodeInstances.push(i)}}validateRequiredComponents(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}).prototype,"target",[po],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wo=ve(bo.prototype,"graphics",[mo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),So=ve(bo.prototype,"trailNodes",[go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yo=bo))||yo);var To,Ao,Ro,Io,Po,_o,Lo,Do,Oo,No,Mo,ko,xo,Fo,Bo,Go,zo,Uo,Ho,Vo,qo,Wo,Ko,Yo,jo,Xo;i._RF.pop(),i._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);const{ccclass:$o,executionOrder:Qo,property:Jo}=a,{Utils:Zo}=GameCore,{Array:er}=Zo,tr="Batch By Name",ir="Batch Label",nr="Batch Sprite";let ar=(To=$o("BatchNodes"),Ao=Qo(99999),Ro=Jo({group:{name:tr}}),Io=Jo({type:[f],group:{name:tr}}),Po=Jo({type:[b],group:{name:tr}}),_o=Jo({group:{name:ir}}),Lo=Jo({group:{name:ir}}),Do=Jo({group:{name:ir}}),Oo=Jo({group:{name:nr}}),No=Jo({group:{name:nr}}),Mo=Jo({readonly:!0}),ko=Jo({readonly:!0}),xo=Jo({readonly:!0}),To(Fo=Ao((Go=ve((Bo=class extends s{constructor(){super(...arguments),e(this,"batchByName",Go,this),e(this,"depthNames",zo,this),e(this,"listName",Uo,this),e(this,"batchLabel",Ho,this),e(this,"depthLabel",Vo,this),e(this,"typeLabel",qo,this),e(this,"batchSprite",Wo,this),e(this,"depthSprite",Ko,this),e(this,"batchAllNodes",Yo,this),e(this,"batchDepth",jo,this),e(this,"checkOverlap",Xo,this),this.batchNode={},this.labelChildren=[],this.spriteChildren=[],this.allChildren=[],this.nameChildren=[],this.originalParents={},this.isInited=!1,this.onAfterUpdate=()=>{this.isInited&&this.hierarchyChildren()},this.onAfterRender=()=>{this.isInited&&this.restoreOriginalChildren()}}__preload(){this.enabled&&(m.on(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.on(J.EVENT_AFTER_RENDER,this.onAfterRender))}onDestroy(){m.off(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.off(J.EVENT_AFTER_RENDER,this.onAfterRender)}onLoad(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}onEnable(){m.on(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.on(J.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0}onDisable(){this.restoreOriginalChildren(),m.off(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.off(J.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}setupBatchNodes(e){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(e),this.createGlobalNodes(e),this.createGlobalNameNodes(e),this.createGlobalLabelNode(e),this.createGlobalSpriteNode(e),this.sortGlobalNodes()}sortGlobalNodes(){this.batchNode.node?.setSiblingIndex(0),this.batchNode.label?.setSiblingIndex(this.depthLabel),this.batchNode.sprite?.setSiblingIndex(this.depthSprite),this.listName.forEach(((e,t)=>{this.batchNode[e]?.setSiblingIndex(this.depthNames[t])}))}createGlobalNodes(e){if(!this.batchAllNodes)return;const t=new n("GlobalBatchNode");t.active=!0,this.batchNode.node=t,e.addChild(t)}createGlobalNameNodes(e){this.batchByName&&this.listName.forEach((t=>{if(this.batchNode[t])return;const i=new n(t);i.active=!0,this.batchNode[t]=i,e.addChild(i)}))}createGlobalLabelNode(e){if(!this.batchLabel)return;const t=new n("GlobalLabelNode");t.active=!0,this.batchNode.label=t,e.addChild(t)}createGlobalSpriteNode(e){if(!this.batchSprite)return;const t=new n("GlobalSpriteNode");t.active=!0,this.batchNode.sprite=t,e.addChild(t)}saveOriginalParents(){[...this.labelChildren,...this.spriteChildren].forEach((e=>{e.node.parent&&(this.originalParents[e.uuid]=e.node.parent)})),this.nameChildren.forEach((e=>{e.parent&&(this.originalParents[e.uuid]=e.parent)}))}saveOriginalChildren(e){e.children.forEach((e=>{this.saveLabelChildren(e),this.saveSpriteChildren(e),this.saveNodeChildrenByName(e),this.saveNodeChildrenByType(e)})),this.saveOriginalParents()}saveLabelChildren(e){if(!this.batchLabel)return;const t=e.getComponentsInChildren(h);"char"===this.typeLabel&&t.filter((e=>e.cacheMode===h.CacheMode.CHAR)),0!==t.length&&this.labelChildren.push(...t)}saveSpriteChildren(e){if(!this.batchSprite)return;const t=e.getComponentsInChildren(R);0!==t.length&&this.spriteChildren.push(...t)}saveNodeChildrenByName(e){this.batchByName&&e.children.forEach((e=>{er.has(this.listName,e.name)?this.nameChildren.push(e):this.saveNodeChildrenByName(e)}))}saveNodeChildrenByType(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.batchAllNodes)return;const i=e.getComponentsInChildren(s);this.allChildren.push(...i),this.batchDepth>0&&t<this.batchDepth&&this.allChildren.forEach((e=>{this.saveNodeChildrenByType(e.node,this.batchDepth)}))}hierarchyChildren(){let e;this.labelChildren.forEach((t=>{t.node.isValid&&t.node.activeInHierarchy&&(e=this.batchNode.label,t.node.isChildOf(e)||(t.node.setParent(e,!0),t.node.layer=Z.Enum.UI_2D))})),this.spriteChildren.forEach((t=>{t.node.isValid&&t.node.activeInHierarchy&&(e=this.batchNode.sprite,t.node.isChildOf(e)||(t.node.setParent(e,!0),t.node.layer=Z.Enum.UI_2D))})),this.allChildren.forEach((t=>{t.node.isValid&&t.node.activeInHierarchy&&(e=this.batchNode.node,t.node.isChildOf(e)||(t.node.setParent(e,!0),t.node.layer=Z.Enum.UI_2D))})),this.allChildren.sort(((e,t)=>{const i=e.constructor.name,n=t.constructor.name;return i<n?-1:i>n?1:0})),this.nameChildren.forEach((t=>{if(!t.isValid)return;if(!t.activeInHierarchy)return;if(!t.isTransformDirty())return;const i=t.getComponent(x);i&&i.opacity<1||(e=this.batchNode[t.name],t.isChildOf(e)||(t.setParent(e,!0),t.layer=Z.Enum.UI_2D))}))}restoreOriginalChildren(){const e=[...this.labelChildren,...this.spriteChildren];e.length>0&&e.forEach((e=>{const t=this.originalParents[e.uuid];t&&(e.node.isChildOf(t)||e.node.setParent(t,!0))})),this.nameChildren.forEach((e=>{const t=this.originalParents[e.uuid];t&&(e.isChildOf(t)||e.setParent(t,!0))}))}}).prototype,"batchByName",[Ro],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),zo=ve(Bo.prototype,"depthNames",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Uo=ve(Bo.prototype,"listName",[Po],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ho=ve(Bo.prototype,"batchLabel",[_o],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Vo=ve(Bo.prototype,"depthLabel",[Lo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),qo=ve(Bo.prototype,"typeLabel",[Do],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),Wo=ve(Bo.prototype,"batchSprite",[Oo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ko=ve(Bo.prototype,"depthSprite",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Yo=ve(Bo.prototype,"batchAllNodes",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jo=ve(Bo.prototype,"batchDepth",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xo=ve(Bo.prototype,"checkOverlap",[xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Fo=Bo))||Fo)||Fo);var sr;i._RF.pop(),i._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);const{ccclass:or}=a,{Utils:rr}=GameCore,{player:lr}=globalThis.game;let cr=or("Vibrate")(sr=class extends s{vibrate(e){if(!this.isVibrateEnable())return;if(!rr.Browser.vibrate(e)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}isVibrateEnable(){return!!lr.getPlayerSetting("vibrate")}})||sr;i._RF.pop(),i._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);const hr=1/6;i._RF.pop(),i._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);const dr={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};i._RF.pop(),i._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);const ur=10,pr=50,mr=100,gr={[dr.HINT]:80,[dr.THUNDER]:200,[dr.STORM]:150,[dr.PLIERS]:150},yr=200,br=40;i._RF.pop(),i._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);const fr={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};i._RF.pop(),i._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);const wr={...GameCore.Dtos.Match.Data.getDefaultData(),extraData:null};i._RF.pop(),i._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var Sr=function(e){return e.UNLOCK_DEV_TOOLS="unlock-dev-tools",e.TRIGGER_UNLOCK_KEY="trigger-unlock-key",e.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",e}(Sr||{});const vr={Events:Sr,UNLOCK_SEQUENCE:"101013012031"};i._RF.pop(),i._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);i._RF.pop(),i._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);const Cr={level:0,coins:0,stars:0,totalLevel:80,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:{[dr.HINT]:0,[dr.THUNDER]:0,[dr.STORM]:0,[dr.PLIERS]:0},skins:{}};i._RF.pop(),i._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);const Er="global-leaderboard-key",Tr="friends-leaderboard-key",Ar="global-leaderboard-id",Rr="friends-leaderboard-id";i._RF.pop(),i._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);const Ir={...GameCore.Dtos.Match.CustomData.getDefaultData(),score:0};i._RF.pop(),i._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);const Pr={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:Cr,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};i._RF.pop(),i._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);const _r="BootScene",Lr="GameScene",Dr="DashboardScene",Or="ChallengeResultScene";i._RF.pop(),i._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var Nr=function(e){return e.RELOAD_TOURNAMENT="reload-tournament",e}(Nr||{});i._RF.pop(),i._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);const{Configs:Mr,Utils:kr}=GameCore,{Object:xr}=kr,{Enabled:Fr,WideframeConfigs:Br}=Mr.FrameCapture,Gr=async e=>{if(!Fr)return console.warn("FrameCapture is not enabled"),null;const t=Ur(e);if(!t)return null;zr(t,Br.CustomResultChallenge);const{frameCapture:i}=window.game,{Width:n,Height:a}=Br.CustomResultChallenge;return i.captureAsync({name:"CustomResultChallenge",width:n,height:a,renderOptions:t})},zr=(e,t)=>{const{Width:i,Height:n,Wideframe:a}=t;e.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:a,size:[i,n],position:[0,0]}},Ur=e=>{try{const{playerId:t="10",playerPhoto:i="",playerScore:n=0,opponentId:a="20",opponentPhoto:s="",opponentScore:o=0,isPlayerFinished:r,isOpponentFinished:l}=e,{RenderOptions:c}=Br.CustomResultChallenge,h=xr.camelCaseKeys(xr.clone(c)),{playerPhoto:d,opponentPhoto:u}=h,p=n===o,m=n>o,g=r??l,y=r&&l;return"image"===d.type&&(d.name=`${t}`,d.image=i),"image"===u.type&&(u.name=`${a}`,u.image=s),g&&Hr(h,{playerScore:n,opponentScore:o,isPlayerFinished:r,isOpponentFinished:l}),!y||p?(delete h.leftCrown,delete h.rightCrown,h):(m?delete h.rightCrown:delete h.leftCrown,h)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},Hr=(e,t)=>{const{leftScore:i,rightScore:n}=e,{playerScore:a=0,opponentScore:s=0,isPlayerFinished:o,isOpponentFinished:r}=t;"text"===i.type&&(i.text=o?`${a}`:"???"),"text"===n.type&&(n.text=r?`${s}`:"???")};i._RF.pop(),i._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);class Vr extends Error{constructor(e,t){super(t),this.code=e}}i._RF.pop(),i._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);class qr extends Vr{constructor(e,t){super("PLAYER_HAS_TOURNAMENT","Player has a tournament"),this.playerId=e,this.tournamentId=t}}i._RF.pop(),i._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);const Wr={themeNames:["summer","autumn","winter"],skinNames:["cakes","car","cosmetics","flower","fruit","ice-cream","sport","tool"],mapOrder:[{id:1,theme:"summer",skin:"fruit",levelCount:10},{id:2,theme:"autumn",skin:"flower",levelCount:10},{id:3,theme:"winter",skin:"tool",levelCount:10},{id:4,theme:"summer",skin:"sport",levelCount:10},{id:5,theme:"autumn",skin:"cosmetics",levelCount:10},{id:6,theme:"winter",skin:"ice-cream",levelCount:10},{id:7,theme:"summer",skin:"cakes",levelCount:10},{id:8,theme:"autumn",skin:"car",levelCount:10}]};i._RF.pop(),i._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);const Kr="cakes",Yr="flower",jr="fruit";i._RF.pop(),i._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);const Xr={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter"};I(Xr),i._RF.pop(),i._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);const{player:$r,storage:Qr}=globalThis.game,{Array:Jr}=GameCore.Utils,Zr={currentProgress:0,maxProgress:10,isLocked:!0,themeId:"summer"},el={id:0,currentSkin:Kr,currentTheme:Xr.SUMMER,nextSkin:null,nextTheme:null,progress:0,max:10},tl={skin:"cakes",themeId:"summer",progress:0,max:10,isLocked:!0};class il{constructor(){this.mapData=Wr,this.playerSkinProgress=null}static getInstance(){return this._instance||(this._instance=new il),this._instance}static init(){const e=this.getInstance();e.updatePlayerSkinProgress(),e.initDashboardSceneStorage()}initDashboardSceneStorage(){const e=Qr.getStorage("dashboard");if(null!=e)return;const t=this.getCurrentMapProgressInstance();Qr.addStorage("dashboard",{lastMapPayload:t,numOfMapsPassed:0,animateToCurrentLevel:!1});const i=Qr.getStorage("collection");if(null!=i)return;Qr.addStorage("collection",{lastMapPack:t.id,animateMapPackUnlock:!1});const n=Qr.getStorage("leaderboard_content");if(null!=n)return;Qr.addStorage("leaderboard_content",{lastTabOpened:"global"});const a=Qr.getStorage("tournament");null==a&&Qr.addStorage("tournament",{animateTournamentLeader:!1})}static getCurrentMapProgress(){return this.getInstance().getCurrentMapProgressInstance()}getCurrentMapProgressInstance(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),el;const e=this.mapData.mapOrder;let t,i,n,a,s=0,o=0,r=0;for(let l=0;l<e.length;l++){const c=this.playerSkinProgress[e[l].skin];if(c.currentProgress<c.maxProgress){r=e[l].id,t=e[l].skin,i=e[l].theme,n=e[l+1]?.skin??t,a=e[l+1]?.theme??i,s=c.currentProgress,o=c.maxProgress;break}}if(void 0===t||void 0===n||void 0===i||void 0===a){const l=e[e.length-1];return r=l.id,t=l.skin,i=l.theme,n=l.skin,a=l.theme,s=l.levelCount,o=l.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:r,currentSkin:t,currentTheme:i,nextSkin:n,nextTheme:a,progress:s,max:o}}return console.log("getMapCurrentProgress",t,n,s,o),{id:r,currentSkin:t,currentTheme:i,nextSkin:n,nextTheme:a,progress:s,max:o}}static getUnlockedSkins(){return this.getInstance().getUnlockedSkinsInstance()}getUnlockedSkinsInstance(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];const e=Object.keys(this.playerSkinProgress),t=[];for(const i of e){const{isLocked:e}=this.playerSkinProgress[i];e||t.push(i)}return console.log("getUnlockedSkins",t),t}static getLevelSkin(e){return this.getInstance().getLevelSkinInstance(e)}getLevelSkinInstance(e){const t=e??1,{mapOrder:i}=this.mapData;let n=0;for(const e of i){if(n+e.levelCount>=t)return console.log("getMapSkin",e.skin),e.skin;n+=e.levelCount}const a=i[i.length-1];return console.log("getMapSkin",a.skin),a.skin}static getLevelTheme(e){return this.getInstance().getLevelThemeInstance(e)}getLevelThemeInstance(e){const t=e??1,{mapOrder:i}=this.mapData;let n=0;for(const e of i){if(n+e.levelCount>=t)return console.log("getMapTheme",e.theme),e.theme;n+=e.levelCount}const a=i[i.length-1];return console.log("getMapTheme",a.theme),a.theme}static getCollectionUnlockProgress(){return this.getInstance().getCollectionUnlockProgressInstance()}getCollectionUnlockProgressInstance(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[tl];const e=[];for(const t of Object.entries(this.playerSkinProgress)){const{currentProgress:i,maxProgress:n,isLocked:a,themeId:s}=t[1];e.push({progress:i,max:n,isLocked:a,skin:t[0],themeId:s})}return e}updatePlayerSkinProgress(){const e=$r.getGameData();if(e?.skins&&Object.keys(e.skins).length>0){this.playerSkinProgress={};for(const t of Object.keys(e.skins))this.playerSkinProgress[t]={...Zr,...e.skins[t]};return}console.log("getPlayerSkinProgress: playerData not found, use data from level");const t=this.mapData.mapOrder;this.playerSkinProgress={};for(const e of t)this.playerSkinProgress[e.skin]={themeId:e.theme,currentProgress:0,maxProgress:e.levelCount,isLocked:!0};this.updatePlayerSkinProgressByLevel(),console.log(this.playerSkinProgress)}updatePlayerSkinProgressByLevel(){let e=($r.getGameData()?.level??1)-1;const{mapOrder:t}=this.mapData;this.playerSkinProgress[t[0].skin].isLocked=!1;for(const i of t){const{levelCount:t,skin:n}=i;if(e<=0)continue;const a=e-t>=0?t:e;e-=a,console.log("getPlayerSkinProgressByLevel",n,a),this.increaseProgressInstance(n,a,!1)}}static increaseProgress(e,t,i){this.getInstance().increaseProgressInstance(e,t,i)}increaseProgressInstance(e,t,i){if(null===this.playerSkinProgress)return void console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?");if(!this.playerSkinProgress[e])return void console.warn("increaseProgress: skin not found",e);const{currentProgress:n,maxProgress:a}=this.playerSkinProgress[e],s=n+t>a?a:n+t;if(s>0&&(this.playerSkinProgress[e].isLocked=!1),s===a){const t=this.mapData.mapOrder,i=t[Jr.searchIndex(t,(t=>t.skin===e))+1]?.skin;i&&this.unlockSkinInstance(i,!1)}this.playerSkinProgress[e].currentProgress=s,this.playerSkinProgress[e].maxProgress=a,i&&this.syncPlayerSkinProgress()}static unlockSkin(e,t){this.getInstance().unlockSkinInstance(e,t)}unlockSkinInstance(e,t){null!==this.playerSkinProgress?this.playerSkinProgress[e]?(this.playerSkinProgress[e].isLocked=!1,t&&this.syncPlayerSkinProgress()):console.warn("unlockSkin: skin not found",e):console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}syncPlayerSkinProgress(){$r.setGameData({skins:this.playerSkinProgress})}}i._RF.pop(),i._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);const{match:nl,player:al,leaderboard:sl,frameCapture:ol}=globalThis.game,{Object:rl,Valid:ll,Array:cl}=GameCore.Utils,{Modes:hl}=GameCore.Match,dl=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"];class ul{static get inst(){return this._instance||(this._instance=new ul),this._instance}static async startMatchAsync(e){try{switch(e??this.getMatchMode()){case hl.SINGLE:await this.inst.processStartSingleModeAsync();break;case hl.TOURNAMENT:await this.inst.processStartTournamentModeAsync();break;case hl.CHALLENGE_FRIEND:await this.inst.processStartChallengeModeAsync();break;default:await this.inst.processStartSingleModeAsync()}}catch(e){console.warn("startMatchAsync",e)}}static async setProfileMatchDataAsync(e){try{await nl.handler.setProfileData(e)}catch(e){console.warn("setProfileMatchDataAsync",e)}}static async setMatchCustomDataAsync(e){try{await nl.handler.setMatchCustomData(e)}catch(e){console.warn("setMatchCustomDataAsync",e)}}static async setLeaderboardScoreAsync(e){try{await nl.handler.setLeaderboardScore(e)}catch(e){console.warn("setLeaderboardScoreAsync",e)}}static async finishMatchAsync(e){try{switch(this.getMatchMode()){case hl.SINGLE:await this.inst.processFinishSingleModeAsync();break;case hl.TOURNAMENT:await this.inst.processFinishTournamentModeAsync();break;case hl.CHALLENGE_FRIEND:await this.inst.processFinishChallengeModeAsync(e);break;default:await this.inst.processFinishSingleModeAsync()}}catch(e){console.warn("finishMatchAsync",e)}}static async joinTournamentAsync(e){const t=al.getPlayerId();await nl.tournament.join.processAsync({tournamentId:e,playerId:t})}static async continueTournamentAsync(e){const t=al.getPlayerId();await nl.tournament.continue.processAsync({playerId:t,contextId:e})}async processStartSingleModeAsync(){const e=al.getPlayerId();await nl.single.start.processAsync({playerId:e})}async processFinishSingleModeAsync(){await nl.single.finish.processAsync()}async processStartTournamentModeAsync(){const e=al.getPlayerId(),t=GameSDK.context.getID();await nl.tournament.continue.processAsync({playerId:e,contextId:t})}async processFinishTournamentModeAsync(){const e=al.getPlayerId(),t=al.getBestScore();await nl.tournament.finish.processAsync({playerId:e,bestScore:t})}async processStartChallengeModeAsync(){try{await this.processContinueChallengeAsync()}catch(e){if(!rl.hasOwn(e,"name")||ll.isString(e.name))throw e;"PlayerHasFinishedMatch"===e.name&&await this.processChallengeNewOpponentAsync(),"PlayerNotJoinInMatch"===e.name&&await this.processJoinChallengeAsync()}}async processFinishChallengeModeAsync(e){ol.addWideframeRender("renderResultChallenge",ol.wideframe.renderResultChallenge),await nl.challenge.finish.processAsync(e)}async processContinueChallengeAsync(){const{id:e,customData:t}=this.getMatchState(),{playerId:i,opponentId:n}=t;if(!ll.isString(e))throw new Error("Invalid match id");if(!ll.isString(i))throw new Error("Invalid player id");if(!ll.isString(n))throw new Error("Invalid opponent id");const a=GameSDK.context.getID();if(!a)throw new Error("Cannot get contextId");await nl.challenge.continue.processAsync({matchId:e,contextId:a,playerId:i,opponentId:n})}async processChallengeNewOpponentAsync(){const e=al.getConnectedPlayerIds(100,0),t=Math.floor(Math.random()*e.length),i=al.getPlayerId(),n=e[t];await nl.challenge.friend.processAsync({playerId:i,opponentId:n})}async processJoinChallengeAsync(){const{id:e,customData:t}=this.getMatchState(),{playerId:i,opponentId:n}=t;if(!ll.isString(e))throw new Error("Invalid match id");if(!ll.isString(i))throw new Error("Invalid player id");if(!ll.isString(n))throw new Error("Invalid opponent id");await nl.challenge.join.processAsync({matchId:e,playerId:i,opponentId:n})}getMatchState(){const e=nl.getMatchState();if(!e)throw new Error("Match state not found");return e}static createTournamentName(){const e=`${dl[G.randomRangeInt(0,dl.length-1)]} Tournament`;return`${GameCore.Utils.String.removeDiacritics(e)}`}static getShortName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;const i=e.split(" ");let n=0,a="";for(const e of i){if(n+e.length+1>t)break;a+=`${e} `,n+=e.length+1}return a.slice(0,-1)}static createTournamentPayload(){const e=GameCore.Utils.String.generateObjectId(),t=al.getPlayerId(),{name:i}=al.getPlayer(),n=al.getGameData()?.level??1,a=il.getLevelTheme(n),s=this.inst.getMatchState(),{profiles:o={}}=s;return{score:o[t]?.score??0,playerId:t,mode:hl.TOURNAMENT,name:this.createTournamentName(),leaderboardId:e,payload:{playerId:t,playerName:i,leaderboardId:e,themeId:a}}}static async getTournamentsAsync(){try{return await GameSDK.tournament.getTournamentsAsync()}catch(e){return console.error(e),[]}}static async processCreateTournamentAsync(){const e=await this.getTournamentsAsync(),t=cl.search(e,(e=>{const t=JSON.parse(e.getPayload()??"{}");return"DEFAULT"===e.getTournamentType()&&t.playerId===al.getPlayerId()}));if(t)throw new qr(al.getPlayerId(),t.getID());const i=this.createTournamentPayload();al.setGameData({lastCreateTournamentShown:Date.now()}),await nl.tournament.create.processAsync(i);const{leaderboardId:n}=i;sl.addLeaderboard({name:n,type:"tournament",autoSortRank:!0,leaderboardId:n})}static getMatchMode(){const e=this.inst.getMatchState();return ll.isString(e.mode)?e.mode:null}static getMatchCustomData(){const e=this.inst.getMatchState();return ll.isObject(e.customData)?e.customData:null}static async getMatchExtraDataAsync(e){const t=await nl.api.getMatchAPI().getMatchDetailByIdAsync(e);return new GameCore.Dtos.Match.Data(t).toObject().extraData}static updateMatchStateAfterLevelFinish(e,t){this.setMatchCustomDataAsync({level:e,score:t});const i=al.getPlayerId();this.setProfileMatchDataAsync({id:i,score:t})}}try{new ul}catch(e){console.error("MatchUtils",e)}i._RF.pop(),i._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);const{event:pl}=globalThis.game,{Events:ml}=GameCore;class gl{static get inst(){return this._instance||(this._instance=new gl),this._instance}static switchScene(e,t){pl.emit(ml.SWITCH_SCENE,{sceneName:e,sceneData:t})}static preloadScene(e){pl.emit(ml.PRELOAD_SCENE,{sceneName:e})}static preloadDashboardScene(){this.preloadScene(Dr)}static switchToDashboardScene(e){this.switchScene(Dr,e)}static preloadGameScene(){this.preloadScene(Lr)}static switchToGameScene(e){this.switchScene(Lr,e)}static getSceneData(e){return"data"in e.scene&&e.scene.data||{}}}try{new gl}catch(e){console.error("SceneUtils",e)}var yl,bl,fl,wl,Sl,vl,Cl;i._RF.pop(),i._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);const{ccclass:El,property:Tl}=a;let Al=(yl=El("LoadingFullScreen"),bl=Tl(X),fl=Tl(h),yl((vl=ve((Sl=class extends s{constructor(){super(...arguments),e(this,"progressBar",vl,this),e(this,"loadingText",Cl,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}runLoadingTextAnimation(){let e=0;this.schedule((()=>{e=e>2?0:e+1,this.loadingText.string="Loading"+".".repeat(e)}),.5)}stopLoadingTextAnimation(){this.unscheduleAllCallbacks()}async show(){this.uiOpacity.opacity=0,this.progressBar.progress=0;const e=C(this.uiOpacity).to(.2,{opacity:255},{easing:"cubicOut"}),t=C(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"});this.runLoadingTextAnimation(),St.runTweenAsync(e),await St.runTweenAsync(t)}async hide(){if(!this.uiOpacity||!this.progressBar)return;this.uiOpacity.opacity=255,this.progressBar.progress=.9;const e=C(this.uiOpacity).to(.15,{opacity:0},{easing:"cubicIn"}),t=C(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"});this.runLoadingTextAnimation(),await St.runTweenAsync(t),this.stopLoadingTextAnimation(),await St.runTweenAsync(e),this.node.active=!1}}).prototype,"progressBar",[bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cl=ve(Sl.prototype,"loadingText",[fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl=Sl))||wl);var Rl,Il,Pl,_l,Ll;i._RF.pop(),i._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);const{ccclass:Dl,property:Ol}=a;let Nl=(Rl=Dl("Loading"),Il=Ol(_),Rl((Ll=ve((_l=class extends s{constructor(){super(...arguments),e(this,"loadingPrefab",Ll,this),this.loadingNode=null}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onLoad(){this.makePersistent()}makePersistent(){m.addPersistRootNode(this.node)}createLoadingFullScreen(){const e=P("Canvas");if(!e)return;if(e.getChildByName("Loading"))return;this.loadingNode||(this.loadingNode=c(this.loadingPrefab));const t=c._clone(this.loadingNode);this.loadingFullScreen=t.getComponent(Al),this.node.active=!1,P("Canvas")?.addChild(t)}async show(){this.createLoadingFullScreen(),this.node.active||(this.node.active=!0,await this.loadingFullScreen.show())}async hide(){this.node?.active&&this.loadingFullScreen&&(await this.loadingFullScreen.hide(),this.node.active=!1)}}).prototype,"loadingPrefab",[Il],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pl=_l))||Pl);i._RF.pop(),i._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);const{event:Ml}=globalThis.game,{Events:kl,Utils:xl}=GameCore,{Array:Fl}=xl;class Bl{constructor(){this.showedScreens=[]}static get inst(){return this._instance||(this._instance=new Bl),this._instance}static openScreen(e,t){const i=Ui[e];Ml.emit(kl.OPEN_SCREEN,{screenName:i,screenData:t})}static closeScreen(e){const t=Ui[e];Ml.emit(kl.CLOSE_SCREEN,{screenName:t})}static showLoadingScreen(e){this.openScreen(zi.LOADING_SCREEN,{duration:e})}static closeLoadingScreen(){this.closeScreen(zi.LOADING_SCREEN)}static showNotificationScreen(e,t){this.openScreen(zi.NOTIFICATION_SCREEN,{message:e,duration:t})}static closeNotificationScreen(){this.closeScreen(zi.NOTIFICATION_SCREEN)}static addShowedScene(e){Fl.has(this.inst.showedScreens,e)||this.inst.showedScreens.push(e)}static async showLoadingFullScreen(e){if(Fl.has(this.inst.showedScreens,e))return;this.addShowedScene(e);const t=P("Loading");t&&(t.active=!0,await t.getComponent(Nl).show())}static async hideLoadingFullScreen(e){Fl.has(this.inst.showedScreens,e)||await(P("Loading")?.getComponent(Nl).hide())}static showLoadingNotificationScreen(){this.openScreen(zi.NOTIFICATION_SCREEN,{message:"Loading",enableCloseOnTouch:!1})}static showTournamentDetailScreen(e,t){this.openScreen(zi.TOURNAMENT_DETAIL_SCREEN,{tournament:e,tournamentContextType:t})}static closeTournamentDetailScreen(){this.closeScreen(zi.TOURNAMENT_DETAIL_SCREEN)}}try{new Bl}catch(e){console.error("ScreenUtils",e)}i._RF.pop(),i._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);const{Utils:Gl,Configs:zl}=GameCore,{String:Ul,Valid:Hl,Array:Vl}=Gl,{leaderboard:ql,player:Wl}=globalThis.game;class Kl{constructor(){this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=async()=>{try{Date.now()-this.lastFetchGlobalTournament>this.maxTimeRefetch&&(this.globalTournamentLBData=await ql.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"}),this.globalTournamentLBData.sort(((e,t)=>e.expireTime-t.expireTime)))}catch(e){console.warn("fetchGlobalTournamentLeaderboardAsync",e)}return this.globalTournamentLBData},this.fetchTournamentsAsync=async()=>{try{Date.now()-this.lastFetchTournamentsData>this.maxTimeRefetch&&(this.playerTournaments=await GameSDK.tournament.getTournamentsAsync(),this.playerTournaments.sort(((e,t)=>e.getEndTime()-t.getEndTime())))}catch(e){console.warn("fetchTournamentsAsync",e)}return this.playerTournaments}}static getInstance(){return this._instance||(this._instance=new Kl),this._instance}static async requestTournamentDataAsync(){const e=this.getInstance();await Promise.all([e.fetchTournamentsAsync(),e.fetchGlobalTournamentLeaderboardAsync()]);const t=e.processPlayerTournamentData(),i=e.processGlobalTournamentLeaderboardData();return e.tournamentData=[...t,...i],e.tournamentData.sort(((e,t)=>e.endTime-t.endTime)),e.tournamentData.forEach((e=>{const{payload:t}=e,{leaderboardId:i}=t;i&&(ql.isExistLeaderboardId(i)||ql.addLeaderboard({type:"tournament",name:i,autoSortRank:!0,leaderboardId:i}))})),e.tournamentData}static getAllTournamentData(){return this.getInstance().tournamentData}static getTournamentDataById(e){const t=this.getInstance();return Vl.search(t.tournamentData,(t=>t.id===e))}static getPlayerTournamentData(){const e=this.getInstance(),t=Wl.getPlayerId();return e.tournamentData.filter((e=>{const{payload:i}=e;return i.playerId===t}))}static getFriendsTournamentData(){const e=this.getInstance(),t=Wl.getPlayerId();return e.tournamentData.filter((e=>{const{payload:i}=e;return i.playerId!==t&&"global"!==i.playerId}))}static getGlobalTournamentData(){return this.getInstance().tournamentData.filter((e=>{const{payload:t}=e;return"global"===t.playerId}))}static validateTournamentExpired(e){const t=this.getTournamentDataById(e);if(!t)return!1;const{endTime:i}=t;return i<Date.now()/1e3}processPlayerTournamentData(){const e=[];for(const t of this.playerTournaments){const i=`${t.getID()}`,n=t.getContextID(),a=t.getEndTime(),s=this.parseTournamentPayload(t.getPayload());if(!this.validateGameSDKTournamentPayload(s))continue;if(a<Date.now()/1e3)continue;if("PAGE_HOSTED"===t.getTournamentType())continue;const o=s.playerName??"Player",r={id:i,title:t.getTitle()??this.createDefaultTournamentName(o),endTime:a,contextId:n,payload:s};e.push(r)}return e}processGlobalTournamentLeaderboardData(){const e=[],{Enabled:t}=zl.Mockup.Leaderboards;if(t){for(let t=0;t<this.playerTournaments.length;t++){const i=this.playerTournaments[t],n=i.getTournamentType();if("PAGE_HOSTED"!==n)continue;const a=`${i.getID()}`,s=i.getContextID(),o=i.getEndTime(),r=this.parseTournamentPayload(i.getPayload()),l={id:a,title:i.getTitle()??"Global Tournament",endTime:o,contextId:s,payload:r,tournamentType:n};e.push(l)}return e}for(let t=0;t<this.globalTournamentLBData.length;t++){let i={tournamentId:"",contextId:""};const n=this.globalTournamentLBData[t];try{i=JSON.parse(n.description)}catch(e){continue}if(!this.validateExpireTime(n))continue;if(!this.validateGlobalTournamentPayload(i))continue;const a={id:i.tournamentId,title:n.name,endTime:this.getTournamentEndTime(n),contextId:i.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:n._id,themeId:i.themeId??Xr.SUMMER}};e.push(a)}return e}validateGlobalTournamentPayload(e){const{tournamentId:t,contextId:i}=e;return!(!Hl.isString(t)||""===t)&&!(!Hl.isString(i)||""===i)}getTournamentEndTime(e){const t=new Date(e.createdAt).getTime();return Math.round((1e3*e.expireTime+t)/1e3)}validateExpireTime(e){return 1e3*this.getTournamentEndTime(e)-Date.now()>0}validateGameSDKTournamentPayload(e){return!(!Hl.isString(e.playerId)||""===e.playerId)&&(!(!Hl.isString(e.playerName)||""===e.playerName)&&!(!Hl.isString(e.leaderboardId)||""===e.leaderboardId))}createDefaultTournamentName(e){const t=e.substring(0,7),i=`${t.split(" ")[0]||t}'s Tournament`;return`${Ul.removeDiacritics(i)}`}parseTournamentPayload(e){if("string"!=typeof e)return{};try{return JSON.parse(e)}catch(e){return{}}}}i._RF.pop(),i._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);const Yl="time",jl="bomb";var Xl;i._RF.pop(),i._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);const{ccclass:$l}=a;let Ql=$l("InputController")(Xl=class extends s{constructor(){super(...arguments),this.handleElementPointerDown=()=>{},this.handleElementPointerUp=e=>{}}onLoad(){this.listenInputEvents()}listenInputEvents(){Y.os!==Y.OS.WINDOWS&&Y.os!==Y.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}onDestroy(){Y.os!==Y.OS.WINDOWS&&Y.os!==Y.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}})||Xl;i._RF.pop(),i._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);const Jl={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};i._RF.pop(),i._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);const Zl="fall-down",ec="fly-up",tc="push-left",ic="push-right",nc="put-column-middle",ac="put-row-middle";function sc(e){const{array:t,isLighter:i,out:n=new Set}=e;for(let e=0;e<t.length;e++)if(i(t.get(e)))for(let a=e+1;a<t.length;a++)if(!i(t.get(a))){t.swap(e,a),n.add(t.get(e));break}return n}i._RF.pop(),i._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);class oc{constructor(e){this.array=[];const{width:t=1,height:i=1}=e??{},n=e instanceof oc?e.array:e?.content??[];if(n.length!==t*i)throw new Error("Invalid content length");this.width=t,this.height=i,this.array=[...n]}asArray(){return this.array}get(e,t){return this.array[t*this.width+e]}set(e,t,i){this.array[t*this.width+e]=i}isInBounds(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}forEach(e){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)e(this.get(i,t),i,t)}map(e){const t=[];for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)t.push(e(this.get(n,i),n,i));return t}reduce(e,t){let i=t;for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)i=e(i,this.get(n,t),n,t);return i}swap(e,t){const[i,n]=e,[a,s]=t,o=this.get(i,n);this.set(i,n,this.get(a,s)),this.set(a,s,o)}shuffle(e){e=e??this.map(((e,t,i)=>[t,i]));const t=[...e],i=new Set;for(let e=t.length-1;e>0;e--){const n=ee(0,e+1);[t[e],t[n]]=[t[n],t[e]],i.add(this.get(t[e][0],t[e][1])),i.add(this.get(t[n][0],t[n][1]))}for(let i=0;i<t.length;i++){const[n,a]=e[i],[s,o]=t[i];this.swap([n,a],[s,o])}return i}toShuffled(e){const t=new oc({width:this.width,height:this.height,content:this.array}),i=t.shuffle(e);return[t,i]}gravitate(e){const{rowRange:[t,i],colRange:[n,a],direction:s,isLighter:o,onSwap:r,out:l=new Set}=e,c=a-n+1,h=i-t+1;switch(s){case Jl.Up:for(let e=n;e<=a;e++)sc({array:{length:h,get:t=>this.get(e,i-t),swap:(t,n)=>{const a=this.get(e,i-t),s=this.get(e,i-n);this.swap([e,i-t],[e,i-n]),r?.(a,s)}},isLighter:o,out:l});return l;case Jl.Down:for(let e=n;e<=a;e++)sc({array:{length:h,get:i=>this.get(e,t+i),swap:(i,n)=>{const a=this.get(e,t+i),s=this.get(e,t+n);this.swap([e,t+i],[e,t+n]),r?.(a,s)}},isLighter:o,out:l});return l;case Jl.Left:for(let e=t;e<=i;e++)sc({array:{length:c,get:t=>this.get(n+t,e),swap:(t,i)=>{const a=this.get(n+t,e),s=this.get(n+i,e);this.swap([n+t,e],[n+i,e]),r?.(a,s)}},isLighter:o,out:l});return l;case Jl.Right:for(let e=t;e<=i;e++)sc({array:{length:c,get:t=>this.get(a-t,e),swap:(t,i)=>{const n=this.get(a-t,e),s=this.get(a-i,e);this.swap([a-t,e],[a-i,e]),r?.(n,s)}},isLighter:o,out:l});return l;default:throw new Error("Invalid direction")}}toGravitated(){const e=new oc({width:this.width,height:this.height,content:this.array}),t=e.gravitate(...arguments);return[e,t]}toRotated(){const e=new oc({width:this.height,height:this.width,content:new Array(this.width*this.height)});for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)e.set(this.height-1-t,i,this.get(i,t));return e}}i._RF.pop(),i._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),i._RF.pop(),i._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);const rc={bomb:"bomb",star:"star",none:"none"};var lc,cc,hc,dc,uc,pc,mc,gc,yc,bc,fc,wc,Sc,vc,Cc,Ec,Tc,Ac,Rc,Ic,Pc,_c,Lc,Dc,Oc;i._RF.pop(),i._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);const{ccclass:Nc,property:Mc,requireComponent:kc}=a;let xc=(lc=Nc("Tile"),cc=kc([l]),hc=kc([x]),dc=Mc(R),uc=Mc(R),pc=Mc(R),mc=Mc(n),gc=Mc({type:l,displayName:"Background's UI Transform"}),yc=Mc({type:x,displayName:"This UI Opacity"}),bc=Mc(x),fc=Mc(x),wc=Mc(Mn),Sc=Mc(y),lc(vc=cc(vc=hc((Ec=ve((Cc=class t extends s{constructor(){super(...arguments),e(this,"icon",Ec,this),e(this,"bombComponent",Tc,this),e(this,"starComponent",Ac,this),e(this,"background",Rc,this),e(this,"bgUITransform",Ic,this),e(this,"uiOpacity",Pc,this),e(this,"shineOpacity",_c,this),e(this,"glowOpacity",Lc,this),e(this,"button",Dc,this),e(this,"animationComponent",Oc,this),this.id=null,this.isEmpty=!1,this.coord=new Q,this.restoreSignal=new ai}onLoad(){Fe.lazyValidateProperties(this),this.special=this.createSpecialHandler(rc.none)}update(e){this.special?.type===rc.bomb&&this.special.update(e)}onDestroy(){this.special?.type===rc.bomb&&this.special?.onDestroy()}setIgnoreInput(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.button.interactable=!e}getCoord(){return this.coord}setCoord(e,t){this.coord.set(e,t)}isSimilarTo(e){return this.id===e.id}inSamePositionAs(e,i){return e instanceof t?this.coord.equals(e.getCoord()):this.coord.x===e&&this.coord.y===i}isHidden(){return this.isEmpty}getSize(){return[this.bgUITransform.width,this.bgUITransform.height]}onClick(){this.isHidden()||this.node.scene.emit(Ga.TILE_CLICK,this)}setIdentity(e){this.id=e,this.icon.spriteFrame=e;const[t,i]=this.getSize(),{width:n,height:a}=e.originalSize,s=Math.max(n/(.7*t),a/(.7*i));s>1&&this.icon.node.setScale(new j(1/s,1/s,1))}setSpecialType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:rc.none,t=arguments.length>1?arguments[1]:void 0;this.special?.switch(e,t)}async setFocused(e){const t=C(this.shineOpacity).to(.2,{opacity:e?255:0},{easing:"quadIn"});this.shineOpacity.node.scale=e?j.ZERO:j.ONE;const i=C(this.shineOpacity.node).to(.2,{scale:e?j.ONE:j.ZERO},{easing:"quadOut"});if(e){const e=C(this.glowOpacity).to(2,{opacity:150});e.to(2,{opacity:20}),this.glowOpacityTween=C(this.glowOpacity).repeatForever(e).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;await Promise.all([St.runTweenAsync(t),St.runTweenAsync(i)])}setEmpty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty){if(this.restoreSignal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),e)return this.uiOpacity.opacity=0,void this.special?.switch(rc.none);this.special?.type===rc.star&&this.special.clear(),this.special?.switch(rc.none),this.uiOpacity.opacity=0}}async setHint(e){if(e)await this.loadShakeClip(),this.shakeClip&&this.runAnimation(this.shakeClip.name);else{this.animationComponent.stop();const e=C(this.background).to(.1,{scale:j.ONE,eulerAngles:j.ZERO});await St.runTweenAsync(e)}}async playClearFX(e){let t=null;"clear"===e?(await this.loadClearClip(),t=this.clearClip):(await this.loadBreakClip(),t=this.breakClip),null!==t&&await this.runAnimation(t.name)}async restore(e){this.restoreSignal.abort(),this.restoreSignal=new ai,this.isEmpty=!1,this.setIgnoreInput(!0),e&&this.setIdentity(e),this.uiOpacity.opacity=255,this.node.setScale(j.ZERO),this.button.fakeClick(),await St.runTweenAsync(C(this.node).to(.3,{scale:j.ONE},{easing:"backOut"}),this.restoreSignal),this.node.setScale(j.ONE),this.setIgnoreInput(!1)}async sync(e){const{duration:t=.3,delay:i=0,easing:n="cubicOut",getTargetPosition:a}=e,s=a(this.coord),o=new j(s.x,s.y,this.node.position.z);await St.runTweenAsync(C(this.node).delay(i).to(t,{position:o},{easing:n}))}async fly(e){const t=300,i=Math.sqrt(this.node.position.x**2+this.node.position.y**2),n=Math.max(t-.7*i,0),a=i/1e3,s=this.node.position.clone(),o=e.getTilePosition(this.coord),r=new j(o.x,o.y,this.node.position.z),l=this.background;let c=2;let h=1,d=360;const u=.0025*n;let p=0;const m=new j(0,0,0),g=.75-u,y={value:0,prevElapsed:0},b=C(y);return b.delay(a),b.to(.5,{value:0},{progress:(e,t,i,n)=>{c*=-1;const a=c*n,o=s.clone();return o.x+=a,this.node.setPosition(o),i}}),b.to(u,{value:1},{progress:(e,i,a,s)=>{const o=St.easeOutExpo(s),r=u*s-y.prevElapsed,c=u*s,p=n*o;this.setHeight(p,t);const m=this.node.position.clone();h+=.1,j.rotateZ(m,m,new j(0,0,0),h*Math.PI*r),this.node.setPosition(new j(m.x,m.y,m.z)),d+=10;const g=d*r;return l.angle+=g,y.prevElapsed=c,a}}),b.call((()=>{m.set((this.node.position.x+r.x)/2,(this.node.position.y+r.y)/2,0),y.prevElapsed=0,l.angle%=360,l.angle-=360,p=l.angle})),b.to(g,{value:0},{progress:(e,i,a,s)=>{const o=g*s-y.prevElapsed,r=g*s,c=n*(1-s);this.setHeight(c,t);const h=this.node.position.clone();return j.rotateZ(h,h,m,Math.PI/g*o),this.node.setPosition(new j(h.x,h.y,h.z)),l.angle+=-p/g*o,y.prevElapsed=r,a}}),b.call((()=>{this.node.setPosition(r),this.setHeight(0,t),l.angle=0})),St.runTweenAsync(b)}async loadBreakClip(){if(this.breakClip)return Promise.resolve();const e=await li.loadAnimClipAsync(si.TILE_BREAK_ANIM);if(!e)return Promise.resolve();this.breakClip=e,this.animationComponent.addClip(this.breakClip)}async loadClearClip(){if(this.clearClip)return Promise.resolve();const e=await li.loadAnimClipAsync(si.TILE_CLEAR_ANIM);if(!e)return Promise.resolve();this.clearClip=e,this.animationComponent.addClip(this.clearClip)}async loadShakeClip(){if(this.shakeClip)return Promise.resolve();const e=await li.loadAnimClipAsync(si.TILE_SHAKE_ANIM);if(!e)return Promise.resolve();this.shakeClip=e,this.animationComponent.addClip(this.shakeClip)}runAnimation(e){return this.animationComponent.play(e),new Promise((e=>{this.animationComponent.once(y.EventType.FINISHED,(()=>{e()}))}))}setHeight(e,t){const i=this.background;i.setPosition(new j(i.position.x,e,0)),i.setScale(new j(1+e/t*.3,1+e/t*.3,1))}createSpecialHandler(e,t){switch(e){case rc.bomb:return this.createBombHandler(t??90);case rc.star:return this.createStarHandler();default:return{type:rc.none,switch:(e,t)=>{this.special=this.createSpecialHandler(e,t)}}}}createBombHandler(e){let t=!1,i=e;const n=()=>{t=!0},a=()=>{t=!1};this.node.scene.on(Ga.TILE_CLICK,n),this.node.scene.on(Ga.USE_ITEM,n),this.node.scene.on(Ga.RESUME_TIME,n),this.node.scene.on(Ga.PAUSE_TIME,a),this.node.scene.on(Ga.TIME_OUT,a),this.bombComponent.node.active=!0;const s=()=>{t=!1,this.bombComponent.node.active=!1,this.node.scene.emit(Ga.BOMB_EXPLODE,this),this.setEmpty()},o=()=>{t=!1,this.bombComponent.node.active=!1,i=e,this.node.scene.off(Ga.TILE_CLICK,n),this.node.scene.off(Ga.USE_ITEM,n),this.node.scene.off(Ga.GAME_RESUME,n),this.node.scene.off(Ga.GAME_PAUSE,a),this.node.scene.off(Ga.TIME_OUT,a)};return{type:rc.bomb,update:n=>{t&&(i-=n,this.bombComponent.fillRange=-i/e,i<=0&&s())},cleanup:o,onDestroy:()=>{this.node.scene.off(Ga.TILE_CLICK,n),this.node.scene.off(Ga.USE_ITEM,n),this.node.scene.off(Ga.GAME_RESUME,n),this.node.scene.off(Ga.GAME_PAUSE,a),this.node.scene.off(Ga.TIME_OUT,a)},switch:(e,t)=>{o(),this.special=this.createSpecialHandler(e,t)},detonateImmediately:()=>{i=0}}}createStarHandler(){this.starComponent.node.active=!0;const e=()=>{this.starComponent.node.active=!1};return{type:rc.star,clear:()=>{this.starComponent.node.active=!1;const{x:e,y:t}=this.node.worldPosition;this.node.scene.emit(Ga.ADD_STARS,{startAnimationAt:[e,t]})},cleanup:e,switch:t=>{e(),this.special=this.createSpecialHandler(t)}}}}).prototype,"icon",[dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tc=ve(Cc.prototype,"bombComponent",[uc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ac=ve(Cc.prototype,"starComponent",[pc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rc=ve(Cc.prototype,"background",[mc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ic=ve(Cc.prototype,"bgUITransform",[gc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pc=ve(Cc.prototype,"uiOpacity",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_c=ve(Cc.prototype,"shineOpacity",[bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lc=ve(Cc.prototype,"glowOpacity",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dc=ve(Cc.prototype,"button",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oc=ve(Cc.prototype,"animationComponent",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vc=Cc))||vc)||vc)||vc);function Fc(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const{x:a,y:s}=i,[o,r]=t;let l=o*(a-(e.width-1)/2)+n*(a-e.width/2),c=r*(s-(e.height-1)/2)+n*(s-e.height/2);return-1===a&&(l+=t[0]/4),a===e.width&&(l-=t[0]/4),-1===s&&(c+=t[1]/4),s===e.height&&(c-=t[1]/4),{x:l,y:c}}function Bc(e){switch(e){case Zl:return ic;case ec:return tc;case tc:return Zl;case ic:return ec;case nc:return ac;case ac:return nc}}function Gc(e){return(e instanceof oc?e.asArray():e).filter((e=>!e.isHidden()))}function zc(e){return(e instanceof oc?e.asArray():e).filter((e=>e.isHidden()))}i._RF.pop(),i._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),i._RF.pop(),i._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),i._RF.pop(),i._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),i._RF.pop(),i._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),i._RF.pop(),i._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),i._RF.pop(),i._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),i._RF.pop(),i._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),i._RF.pop(),i._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),i._RF.pop(),i._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);const{Utils:Uc}=GameCore,{Object:Hc}=Uc;function Vc(e,t){const{x:i,y:n}=t.getCoord();return Hc.vals(Jl).reduce(((t,a)=>{let{x:s,y:o}=a;const[r,l]=[i+s,n+o];return e.isInBounds(r,l)&&t.push(e.get(r,l)),t}),[])}function qc(e){return Array.isArray(e)}function Wc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();const i=qc(e)?e:e.asArray();return i[te(t,0,i.length)]}i._RF.pop(),i._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),i._RF.pop(),i._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);const{Array:Kc}=GameCore.Utils;function Yc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();const i=e instanceof oc?e.asArray():e,n=Wc(i,t),a=Kc.search(i,(e=>e.isSimilarTo(n)&&!e.inSamePositionAs(n)));if(void 0===a)throw new Error("Could not find a matching tile");return[n,a]}i._RF.pop(),i._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);const jc=e=>e;function Xc(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jc;return function*(){let n=t;e<=0&&(e=1/0);for(let t=0;t<e;t++)yield i(n),n=1e9*ie(n)}()}function $c(e){return Array.isArray(e)}function Qc(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();const n=$c(e)?e:e.asArray();if(n.length<t)return new Set(n);const a=new Set,s=Xc(-1,i);let o=s.next();for(;a.size<t;){if(o.done)throw new Error("RNG exhausted");a.add(Wc(n,o.value)),o=s.next()}return a}i._RF.pop(),i._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),i._RF.pop(),i._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),i._RF.pop(),i._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);const Jc=[1,4];function Zc(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();const{specials:n}=t,a=n.bomb,s=te(i,...Jc),o=Qc(e,a,i),r=e.asArray().filter((e=>!o.has(e))),l=Qc(r,s,i);o.forEach((e=>{const i=2*t.time/3;e.setSpecialType(rc.bomb,i)})),l.forEach((e=>e.setSpecialType(rc.star)))}function eh(e){const{levelData:{columns:t,rows:i},identities:n,createTile:a,seed:s=Date.now()}=e,o=function(e,t,i){const n=[],a=t/2,s=e=>te(e,0,i.length);for(const t of Xc(a,e,s))n.push(i[t]),n.push(i[t]);return GameCore.Utils.Array.shuffle(n),n}(s,t*i,n).map((e=>{const t=a(e);return t.setIdentity(e),t}));return new oc({width:t,height:i,content:o})}i._RF.pop(),i._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),i._RF.pop(),i._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0),i._RF.pop(),i._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);const{Array:th}=GameCore.Utils;function ih(e,t){const i=th.search(Object.entries(t),(t=>{let[i,n]=t;return n===e}));if(void 0===i)throw new Error(`Invalid special type ${e}`);return i[0]}i._RF.pop(),i._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),i._RF.pop(),i._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);const{Array:nh}=GameCore.Utils;function ah(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();const i=e.asArray(),n=Wc(e,t),a=Vc(e,n);if(a.some((e=>e.isSimilarTo(n))))return;const s=Wc(a,t),o=nh.search(i,(e=>!e.inSamePositionAs(n)&&!e.inSamePositionAs(s)&&e.isSimilarTo(s)));o.setIdentity(n.id),s.setIdentity(n.id)}i._RF.pop(),i._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),i._RF.pop(),i._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var sh=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];i._RF.pop(),i._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);const{Array:oh}=GameCore.Utils;function rh(e,t){return e[0]===t[0]&&e[1]===t[1]}function lh(e){return new Q(e[0],e[1])}function ch(e,t){return e.x>=-1&&e.x<t.width+1&&e.y>=-1&&e.y<t.height+1}function hh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dh;return t.map((t=>[e.tile[0]+t.x,e.tile[1]+t.y]))}const dh=[Jl.Up,Jl.Down,Jl.Left,Jl.Right];class uh{constructor(e,t){if(this.f=0,this.g=0,this.h=0,t&&rh(e,t.tile))throw new Error("Tile cannot be its own parent");this.tile=e,this.parent=t;const i=uh.calcDirection(this),n=t&&i&&t.cache.direction&&!i.equals(t.cache.direction)?1:0;this.cache={direction:i,turns:n+(t?.cache.turns??0)}}static calcDirection(e){if(e.parent){const t=e.parent.tile,i=e.tile;return new Q(i[0]-t[0],i[1]-t[1])}return null}getKey(){return`x:${this.tile[0]},y:${this.tile[1]},d:${this.cache.direction?.toString()}`}equals(e){return this.getKey()===e.getKey()}}function ph(e,t){const i=e.tile,n=t.tile;return Math.abs(i[0]-n[0])+Math.abs(i[1]-n[1])}function mh(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const n=[];for(const a of dh){const s={x:t[0]+a.x,y:t[1]+a.y};if(e.isInBounds(s.x,s.y)){(e.get(s.x,s.y).isHidden()||oh.search(i,(e=>rh(e,[s.x,s.y]))))&&n.push(a)}else ch(s,e)&&n.push(a)}return n}function gh(e,t,i,n){if(n){const e=sh[4].startTile,n=sh[4].endTile;if(t[0]===e.x&&t[1]===e.y&&i[0]===n.x&&i[1]===n.y)return[{a:e,b:n}];if(t[0]===n.x&&t[1]===n.y&&i[0]===e.x&&i[1]===e.y)return[{a:e,b:n}]}return function(e,t,i){const n=[],a=[],s=new uh(t,null),o=new uh(i,null),r=[o.tile];for(n.push(s);n.length>0;){const t=n.shift();if(a.push(t),rh(t.tile,o.tile)){const e=[];let i=t,n=t,a=t.parent;for(;a;)a.cache.turns!==n.cache.turns&&(e.unshift({a:lh(a.tile),b:lh(i.tile)}),i=a),n=a,a=a.parent;return e.unshift({a:lh(n.tile),b:lh(i.tile)}),e}const i=hh(t,mh(e,t.tile,r));for(const e of i){const i=new uh(e,t);if(i.cache.turns>8)continue;const s=rh(i.tile,o.tile),r=a.some((e=>e.equals(i)));n.some((e=>e.equals(i)))||r&&!s||(i.g=t.g+1+i.cache.turns,i.h=ph(i,o),i.f=i.g+i.h,n.push(i))}n.sort(((e,t)=>e.f-t.f))}const l=s.tile,c=o.tile;return l[0]===c[0]||l[1]===c[1]?[{a:lh(l),b:lh(c)}]:[{a:lh(l),b:{x:l[0],y:c[1]}},{a:{x:l[0],y:c[1]},b:lh(c)}]}(e,t,i)}i._RF.pop(),i._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),i._RF.pop(),i._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);const yh={[rc.bomb]:"b",[rc.star]:"s",[rc.none]:"t"};function bh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yh;const{width:i,height:n}=e,a=[],s=new Map;for(let o=n-1;o>=0;o--){const n=[];for(let a=0;a<i;a++){const i=e.get(a,o),r=i.isHidden()?null:i.id;if(null===r){n.push(".");continue}const l=t[i.special?.type??rc.none];if(!s.has(r)){const e=s.size.toString();s.set(r,e)}const c=`${l}${s.get(r)}`;n.push(c)}a.push(n.join(""))}return{code:a.join(":"),idSize:s.size,encoding:t,rows:n,cols:i}}function fh(e){return e.reduce(((e,t,i,n)=>(t.inSamePositionAs(i,n)||e.push([t,[i,n]]),e)),[])}function*wh(e,t){let i=0,n=e-1,a=0,s=t-1;for(;i<=n&&a<=s;){for(let e=i;e<=n;e++)yield{x:e,y:a};a++;for(let e=a;e<=s;e++)yield{x:n,y:e};n--;for(let e=n;e>=i;e--)yield{x:e,y:s};s--;for(let e=s;e>=a;e--)yield{x:i,y:e};i++}}i._RF.pop(),i._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),i._RF.pop(),i._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),i._RF.pop(),i._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);const{Array:Sh}=GameCore.Utils;class vh{constructor(e,t){this.coord=new Q(e,t)}isHidden(){return!0}isSimilarTo(){return!1}}function Ch(e){return new Q(e[0],e[1])}function Eh(e,t,i){if(void 0===t||void 0===i)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wh;const i=[];for(const n of t(e.width,e.height)){const t=e.get(n.x,n.y);t.isHidden()||i.push([t,[n.x,n.y]])}const n=[];for(;i.length>0;){const[t,a]=i.shift();if(!Sh.search(n,(e=>Rh(e,a)))){n.push(a);for(const[s,o]of i){if(!s.isSimilarTo(t)||Sh.search(n,(e=>Rh(e,o))))continue;const i=Eh(e,a,o);if(null!==i)return i}}}return null}(e);const n=[t[0]+1,t[1]+1],a=[i[0]+1,i[1]+1],s=function(e){const t=new Array(e.width+2).fill(null).map(((e,t)=>new vh(t-1,-1))),i=new Array(e.width+2).fill(null).map(((t,i)=>new vh(i-1,e.height))),n=new Array(e.height).fill(null).map(((e,t)=>new vh(-1,t))),a=new Array(e.height).fill(null).map(((t,i)=>new vh(e.width,i))),s=(s,o)=>{const r=s-1,l=o-1;return-1===r?n[l]:r===e.width?a[l]:-1===l?t[r]:l===e.height?i[r]:e.get(r,l)};return{get:(e,t)=>s(e,t),width:e.width+2,height:e.height+2}}(e),o=[n,a];if(n[0]===a[0]&&Ph(s,o,n[1],a[1],n[0])||n[1]===a[1]&&_h(s,o,n[0],a[0],n[1]))return Oh([{a:Ch(n),b:Ch(a)}],{x:-1,y:-1});let r;const l=n[1]<=a[1]?n:a,c=n[1]<=a[1]?a:n,h=n[0]<=a[0]?n:a,d=n[0]<=a[0]?a:n;let u=[],p=[];return-1===(r=Lh(s,o,1,Ch(l),Ch(c)))&&-1===(r=Lh(s,o,-1,Ch(l),Ch(c)))||(u=[{a:Ch(n),b:{x:n[0],y:r}},{a:{x:n[0],y:r},b:{x:a[0],y:r}},{a:{x:a[0],y:r},b:Ch(a)}]),-1===(r=Dh(s,o,1,Ch(h),Ch(d)))&&-1===(r=Dh(s,o,-1,Ch(h),Ch(d)))||(u=[{a:Ch(n),b:{x:r,y:n[1]}},{a:{x:r,y:n[1]},b:{x:r,y:a[1]}},{a:{x:r,y:a[1]},b:Ch(a)}]),-1!==(r=function(e,t,i,n){for(let a=i.y+1;a<n.y;a++)if(Ph(e,t,i.y,a,i.x)&&_h(e,t,i.x,n.x,a)&&Ph(e,t,a,n.y,n.x))return a;return-1}(s,o,Ch(l),Ch(c)))?p=[{a:Ch(n),b:{x:n[0],y:r}},{a:{x:n[0],y:r},b:{x:a[0],y:r}},{a:{x:a[0],y:r},b:Ch(a)}]:-1!==(r=function(e,t,i,n){for(let a=i.x+1;a<n.x;a++)if(_h(e,t,i.x,a,i.y)&&Ph(e,t,i.y,n.y,a)&&_h(e,t,a,n.x,n.y))return a;return-1}(s,o,Ch(h),Ch(d)))&&(p=[{a:Ch(n),b:{x:r,y:n[1]}},{a:{x:r,y:n[1]},b:{x:r,y:a[1]}},{a:{x:r,y:a[1]},b:Ch(a)}]),u.length>0&&p.length>0?Oh(Th(u)<=Th(p)?u:p,{x:-1,y:-1}):u.length>0?Oh(u,{x:-1,y:-1}):p.length>0?Oh(p,{x:-1,y:-1}):null}function Th(e){let t=0;for(const i of e)t+=Ah(i);return t}function Ah(e){return e.a.x===e.b.x?Math.abs(e.a.y-e.b.y):e.a.y===e.b.y?Math.abs(e.a.x-e.b.x):0}function Rh(e,t){return e[0]===t[0]&&e[1]===t[1]}function Ih(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const n=e.get(...t);return n.isHidden()||i.some((e=>Rh(e,t)))}function Ph(e,t,i,n,a){const s=Math.min(i,n),o=Math.max(i,n);for(let i=s;i<=o;i++)if(!Ih(e,[a,i],t))return!1;return!0}function _h(e,t,i,n,a){const s=Math.min(i,n),o=Math.max(i,n);for(let i=s;i<=o;i++)if(!Ih(e,[i,a],t))return!1;return!0}function Lh(e,t,i,n,a){let s=1===i?a.y:n.y;const o=1===i?n.x:a.x;if(Ph(e,t,n.y,a.y,o))for(;s>=0&&s<e.height&&Ih(e,[n.x,s],t)&&Ih(e,[a.x,s],t);){if(_h(e,t,n.x,a.x,s))return s;s+=i}return-1}function Dh(e,t,i,n,a){let s=1===i?a.x:n.x;const o=1===i?n.y:a.y;if(_h(e,t,n.x,a.x,o))for(;s>=0&&s<e.width&&Ih(e,[s,n.y],t)&&Ih(e,[s,a.y],t);){if(Ph(e,t,n.y,a.y,s))return s;s+=i}return-1}function Oh(e,t){return e.map((e=>({a:{x:e.a.x+t.x,y:e.a.y+t.y},b:{x:e.b.x+t.x,y:e.b.y+t.y}})))}var Nh,Mh,kh,xh,Fh,Bh,Gh,zh,Uh,Hh;i._RF.pop(),i._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);const{ccclass:Vh,property:qh,requireComponent:Wh}=a,{monitorError:Kh}=globalThis.game;let Yh=(Nh=Vh("Board"),Mh=Wh(l),kh=qh(xc),xh=qh(n),Fh=qh({displayName:"Tile Spacing",group:"Create config"}),Nh(Bh=Mh((zh=ve((Gh=class t extends s{constructor(){super(...arguments),e(this,"tilePrefab",zh,this),e(this,"tilesHolder",Uh,this),e(this,"tileTrim",Hh,this),this.tileSize=[0,0],this.selectedTile=null,this.layoutType="portrait",this.parsedGravityRules=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.hintTiles=null,this.animationQueue=[],this.isConsumingAnimation=!1,this.handleViewResized=()=>{this.updateTilesHolderScale()},this.onLayoutChanged=e=>{this.layoutType=e}}onLoad(){this.uiTransform=this.getComponent(l),Fe.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenLayoutevents()}onDestroy(){this.unlistenLayoutevents()}create(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();const n=[...e];GameCore.Utils.Array.shuffle(n),e=n.slice(0,t.colors),this.levelData=t,this.parsedGravityRules=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.split("-"),n=[];let a=0;for(;a<i.length;){let e=null;switch(i[a]){case"normal":a+=1;break;case"fall":e=Zl,a+=2;break;case"fly":e=ec,a+=2;break;case"push":"left"===i[a+1]?(e=tc,a+=2):(e=ic,a+=2);break;case"put":"columns"===i[a+1]?(e=nc,a+=3):(e=ac,a+=3)}e&&(t&&(e=Bc(e)),n.push(e))}return n}(t.mode,this.layoutType===ea.Layout.Landscape);const a=e=>{const t=c(this.tilePrefab.node),i=t.getComponent(xc);return i.setIdentity(e),this.tilesHolder.addChild(t),t.active=!0,i};let s=!1;if(void 0!==t.customFen)try{s=!0,this.grid=function(e){let{customFen:t,identities:i,createTile:n}=e;const{idSize:a,cols:s,rows:o,code:r}=t;if(i.length<t.idSize)throw new Error(`Invalid grid code. There are not enough identities/frames ${i.length} to fill it according to fen code ${a}`);const l=r.split(":");if(l.length!==o)throw new Error("Invalid grid code");const c=/[a-zA-Z]+\d+|./g,h=/[a-zA-Z]+/,d=/\d+/,u=l.reduceRight(((e,a)=>{const s=[],o=a.matchAll(c);for(const e of o){const a=e[0],o=d.exec(a)?.[0],r=void 0!==o?parseInt(o,10):void 0,l=void 0!==r&&!isNaN(r)&&r<i.length?i[r]:void 0,c=n(void 0!==l?l:i[0]),u=h.exec(a)?.[0],p=void 0!==u?ih(u,t.encoding):void 0;p&&l?c.setSpecialType(p):c.setEmpty(),s.push(c)}return e.concat(s)}),[]);return new oc({width:s,height:o,content:u})}({customFen:t.customFen,identities:e,createTile:a}),this.grid.forEach(((e,t,i)=>{e.setCoord(t,i),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)}))}catch(e){console.error("Error creating grid from custom fen",e,"falling back to random grid"),s=!1}s||(this.grid=eh({levelData:t,seed:i,identities:e,createTile:a}),this.grid.forEach(((e,t,i)=>{e.setCoord(t,i),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)})),ah(this.grid,i),Zc(this.grid,t,i)),this.handleBoardLayout();const o=[this.tileTrim.x,this.tileTrim.y];this.tileSize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];const[i,n]=e,[a,s]=t,[o,r]=[1-a,1-s],[l,c]=[i*o,n*r];return[l,c]}(this.tilePrefab.getSize(),o),this.updateTilesHolderScale(),this.node.scene.emit(Ga.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}updateTilesHolderScale(){if(!this.grid)return;const e=[this.grid.width,this.grid.height],t=[this.uiTransform.width,this.uiTransform.height],i=function(e,t,i){const[n,a]=e,[s,o]=t,[r,l]=i,[c,h]=[r/(n*s),l/(a*o)];return Math.min(c,h)}(e,this.tilePrefab.getSize(),t);this.tilesHolder.setScale(i,i),this.node.scene.emit(Ga.GRID_RESIZE,i)}handleBoardLayout(){this.layoutType===ea.Layout.Landscape&&0!==this.levelData.level&&(this.grid=function(e){const t=e.toRotated();return t.forEach(((e,t,i)=>{e.setCoord(t,i)})),t}(this.grid))}destroyTiles(){this.grid?.forEach((e=>e.node.destroy()))}animateTilesAppear(){const e=(e,t)=>{const i=Q.ZERO.clone();return this.parsedGravityRules.forEach((n=>{const a=this.getPrimitiveDirection(e,t,n);i.subtract2f(a.x,a.y)})),i.normalize()};return new Promise((t=>{this.animationQueue.push((async()=>{await Promise.all(this.grid.map(((t,i,n)=>{const a=ne(0,.5),s=t.node.scale.clone(),o=e(i,n),r=Fc(this.grid,this.tileSize,{x:i,y:n}),l=o.multiplyScalar(100).add2f(r.x,r.y);return t.node.setPosition(l.x,l.y),t.node.setScale(0,0),Promise.all([St.runTweenAsync(C(t.node).delay(a).to(.5,{scale:s},{easing:"elasticOut"})),t.sync({getTargetPosition:e=>Fc(this.grid,this.tileSize,e),easing:"backOut",duration:.5,delay:a})])}))),t()})),this.consumeAnimationQueue()}))}handleTileClick(e){if(!e.isHidden()){if(this.selectedTile===e)return this.selectedTile=null,void e.setFocused(!1);if(!this.selectedTile)return this.selectedTile=e,void e.setFocused(!0);if(!this.selectedTile.isSimilarTo(e))return this.selectedTile.setFocused(!1),this.selectedTile=e,void e.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,e),this.selectedTile=null}}clearSelectedTile(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}match(e,t){const i=[e.getCoord().x,e.getCoord().y],n=[t.getCoord().x,t.getCoord().y],a=Eh(this.grid,i,n);if(null===a){Yi.playSound(xi.INVALID_MATCH),this.shakeGrid();const a=0===this.levelData.level,s=gh(this.grid,i,n,a);return this.node.scene.emit(Ga.GRID_MATCH,[e,t]),void this.node.scene.emit(Ga.GRID_MATCH_FAIL,s)}this.node.scene.emit(Ga.GRID_MATCH,[e,t]),this.node.scene.emit(Ga.GRID_MATCH_SUCCESS,a,[e,t]),this.clear([[e,t]],"clear")}clear(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"clear";this.normalMatches+=e.length,e.forEach((e=>{let[i,n]=e;i.setEmpty(),n.setEmpty(),i.playClearFX(t),n.playClearFX(t),this.node.scene.emit(Ga.GRID_CLEAR,[i,n])})),this.processGameplayCycle()}showHint(){if(!this.hintPath)return;const e=this.hintPath[0].a,t=this.hintPath[this.hintPath.length-1].b,i=this.getTileAt(e.x,e.y),n=this.getTileAt(t.x,t.y);i.setHint(!0),n.setHint(!0),this.hintTiles=[i,n]}hideHint(){if(this.hintTiles){const[e,t]=this.hintTiles;e.setHint(!1),t.setHint(!1),this.hintTiles=null}}getHintPath(){return this.hintPath}getTileAt(e,t){return this.grid.isInBounds(e,t)?this.grid.get(e,t):null}getAnyTileWorldPosition(e,t){const i=Fc(this.grid,this.tileSize,{x:e,y:t});this.tilePrefab.node.setPosition(i.x,i.y);const n=this.tilePrefab.node.getWorldPosition();return{x:n.x,y:n.y}}getTileSize(){return this.tileSize}getGridSize(){return[this.grid.width,this.grid.height]}getUncleared(){return Gc(this.grid)}getCleared(){return zc(this.grid)}getBombTiles(){return Gc((e=this.grid)instanceof oc?e.asArray():e).filter((e=>e.special?.type===rc.bomb));var e}getPairs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[];let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?Gc(this.grid):zc(this.grid);for(;t.length<e;){const[e,n]=Yc(i);t.push([e,n]),i=i.filter((t=>t!==e&&t!==n))}return t}setIgnoreInput(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.grid.forEach((t=>t.setIgnoreInput(e)))}processShuffleRequest(e){const t=this.processShuffleStep(this.grid,!0,e);this.grid=t[0],this.hintPath=t[1],this.consumeAnimationQueue()}getCurrentFen(){return bh(this.grid)}generateFenFromCurrentLevel(e){return t.generateFen(e??this.levelData)}static generateFen(e){const t=e,i=[];for(let e=0;e<t.colors;e++)i.push(e+1);const n=Date.now(),a=eh({levelData:t,seed:n,identities:i,createTile:e=>{let t,i=e;const n=new Q(0,0);return{get id(){return i},get special(){return t},get coord(){return n},setIdentity:e=>{i=e},isHidden:()=>!1,setSpecialType:e=>{t={type:e}},setCoord:(e,t)=>n.set(e,t),getCoord:()=>n,isSimilarTo:e=>e.id===i,inSamePositionAs:e=>e.getCoord().equals(n)}}});return a.forEach(((e,t,i)=>{e.setCoord(t,i)})),ah(a,n),Zc(a,t,n),bh(a)}listenLayoutevents(){W.on(qn,this.handleViewResized),W.on(Kn,this.onLayoutChanged)}unlistenLayoutevents(){W.off(qn,this.handleViewResized),W.off(Kn,this.onLayoutChanged)}async shakeGrid(){const e=this.tilesHolder.position.clone(),t=C(this.tilesHolder).to(.05,{position:e.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:e.clone().subtract3f(ne(5,10),ne(5,10),0)}),i=C(this.tilesHolder).repeat(2,t).to(.05,{position:e});await St.runTweenAsync(i)}processGameplayCycle(){const e=Gc(this.grid);if(0===e.length)return;let t=this.grid;const i=e.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,n=this.normalMatchesSinceLastSpawn>=2;i&&(n?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),e.length>14&&(t=this.processGravitationStep(t));const a=this.processShuffleStep(t);this.consumeAnimationQueue(),this.grid=a[0],this.hintPath=a[1]}processSpawnStep(){const[e,t]=Qc(zc(this.grid),2);e.restore(),t.restore(e.id)}processGravitationStep(e){let t=e;const i=[];for(const e of this.parsedGravityRules){t=this.toGravitated(t,e);const n=fh(t);if(0===n.length)continue;n.forEach((e=>{let[t,i]=e;const n=i[0],a=i[1];t.setCoord(n,a)})),t.forEach((e=>{e.node.setSiblingIndex(0)}));const a=async()=>{await Promise.all(n.map((e=>{let[i,[n,a]]=e;return i.sync({delay:.25,duration:.25,getTargetPosition:()=>Fc(t,this.tileSize,{x:n,y:a})})})))};i.push(a)}return this.animationQueue.push((async()=>{for(const e of i)await e()})),t}toGravitated(e,t){const i=new oc(e),n=e.height-1,a=e.width-1,s=[0,n],o=[0,a],r=Math.floor(e.height/2),l=Math.floor(e.width/2),c=e=>e.isHidden();switch(t){case Zl:i.gravitate({rowRange:s,colRange:o,direction:Jl.Down,isLighter:c});break;case ec:i.gravitate({rowRange:s,colRange:o,direction:Jl.Up,isLighter:c});break;case tc:i.gravitate({rowRange:s,colRange:o,direction:Jl.Left,isLighter:c});break;case ic:i.gravitate({rowRange:s,colRange:o,direction:Jl.Right,isLighter:c});break;case nc:i.gravitate({rowRange:s,colRange:[l,a],direction:Jl.Left,isLighter:c,out:i.gravitate({rowRange:s,colRange:[0,l-1],direction:Jl.Right,isLighter:c})});break;case ac:i.gravitate({rowRange:[r,n],colRange:o,direction:Jl.Down,isLighter:c,out:i.gravitate({rowRange:[0,r-1],colRange:o,direction:Jl.Up,isLighter:c})})}return i}getPrimitiveDirection(e,t,i){const n=Math.floor(this.grid.height/2),a=Math.floor(this.grid.width/2);switch(i){case Zl:return Jl.Down;case ec:return Jl.Up;case tc:return Jl.Left;case ic:return Jl.Right;case nc:return e>=a?Jl.Left:Jl.Right;case ac:return t>=n?Jl.Down:Jl.Up}}processShuffleStep(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,n=Eh(e);const a=Gc(e).map((e=>{const t=e.getCoord();return[t.x,t.y]}));if(null!==n&&!t)return[e,n];let s,o=100;do{[s]=e.toShuffled(a),n=Eh(s),o--}while(null===n&&o>0);if(o<=0)return Kh?.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",levelData:this.levelData,gridAsArray:s.asArray()}),this.node.scene.emit(Ga.GAME_EXIT),[e,n];const r=fh(s);if(0===r.length)return[s,n];r.forEach((e=>{let[t,[i,n]]=e;t.setCoord(i,n)}));const l=void 0!==i?()=>i(e,s):this.createShuffleAnimationHandler(e,s);return this.animationQueue.push(l),[s,n]}createShuffleAnimationHandler(e,t){const i=async()=>{await Promise.all(e.map(((e,i,n)=>e.sync({duration:.4,easing:"smooth",getTargetPosition:()=>Fc(t,this.tileSize,{x:i,y:n},10)}))))},n=async()=>{t.forEach((e=>{e.node.setSiblingIndex(0)})),await Promise.all(t.map((e=>e.sync({duration:.6,easing:"smooth",delay:ne(0,.4),getTargetPosition:e=>Fc(t,this.tileSize,e)}))))};return async()=>{await i(),await n()}}async consumeAnimationQueue(){if(!this.isConsumingAnimation){for(this.isConsumingAnimation=!0;this.animationQueue.length>0;){if(0===this.getUncleared().length){this.animationQueue=[];break}const e=this.animationQueue.shift();await e()}this.isConsumingAnimation=!1}}}).prototype,"tilePrefab",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uh=ve(Gh.prototype,"tilesHolder",[xh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hh=ve(Gh.prototype,"tileTrim",[Fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Q(.025,.1)}}),Bh=Gh))||Bh)||Bh);var jh;i._RF.pop(),i._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);const{ccclass:Xh}=a;let $h=Xh("Line")(jh=class extends s{onLoad(){this.uiTransform=this.getComponent(l)}setPoints(e,t){this.node.setWorldPosition((e.x+t.x)/2,(e.y+t.y)/2,0),this.uiTransform.width=Q.distance(e,t)+10,this.uiTransform.width/=this.node.worldScale.x;const i=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI;this.node.eulerAngles=new j(0,0,i)}})||jh;i._RF.pop(),i._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);class Qh extends ae{constructor(e,t,i,n,a){super(e,t,a),this.ator=i,this.ftor=n}alloc(){const e=super.alloc();return this.ator&&this.ator(e),e}free(e){this.ftor&&this.ftor(e),super.free(e)}}var Jh,Zh,ed,td,id,nd,ad,sd,od,rd,ld;i._RF.pop(),i._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);const{ccclass:cd,property:hd}=a;let dd=(Jh=cd("PathDrawer"),Zh=hd({group:"Line",displayName:"Prefab",type:_}),ed=hd({group:"Line",displayName:"Holder",type:n,tooltip:"Line Prefab"}),td=hd({group:"Point",displayName:"Prefab",type:_}),id=hd({group:"Point",displayName:"Holder",type:n}),Jh((sd=ve((ad=class extends s{constructor(){super(...arguments),e(this,"linePrefab",sd,this),e(this,"lineHolder",od,this),this.lineNodes=[],e(this,"pointPrefab",rd,this),e(this,"pointHolder",ld,this),this.pointNodes=[]}start(){this.linePool=new Qh((()=>{const e=c(this.linePrefab);return this.lineHolder.addChild(e),e.parent=this.lineHolder,e.active=!1,e}),0,(e=>{this.lineNodes.push(e),e.active=!0}),(e=>{e.active=!1}),(e=>{e.isValid&&e.destroy()})),this.pointPool=new Qh((()=>{const e=c(this.pointPrefab);return this.pointHolder.addChild(e),e.active=!1,e}),0,(e=>{this.pointNodes.push(e),e.active=!0}),(e=>{e.active=!1}),(e=>{e.isValid&&e.destroy()}))}drawPath(e){this.clearPath();for(const t of e){this.linePool.alloc().getComponent($h)?.setPoints(t.a,t.b)}}clearPath(){for(const e of this.lineNodes)this.linePool.free(e);this.lineNodes=[];for(const e of this.pointNodes)this.pointPool.free(e);this.pointNodes=[]}}).prototype,"linePrefab",[Zh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),od=ve(ad.prototype,"lineHolder",[ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rd=ve(ad.prototype,"pointPrefab",[td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ld=ve(ad.prototype,"pointHolder",[id],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nd=ad))||nd);var ud,pd,md,gd,yd,bd,fd,wd,Sd;i._RF.pop(),i._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);const{ccclass:vd,property:Cd}=a;let Ed=(ud=vd("ErrorDrawer"),pd=Cd(N),md=Cd(N),gd=Cd(N),ud((fd=ve((bd=class extends dd{constructor(){super(...arguments),e(this,"one",fd,this),e(this,"two",wd,this),e(this,"error",Sd,this)}start(){super.start(),this.pathAppearDuration=0}drawPath(e){if(this.clearPath(),e.forEach(((t,i)=>{if(this.linePool.alloc().getComponent($h)?.setPoints(t.a,t.b),0!==i){const n=this.pointPool.alloc();n.setWorldPosition(new j(t.a.x,t.a.y,0));const a=n.getComponent(R);1===i&&e.length>3?a.spriteFrame=this.one:2===i&&e.length>3?a.spriteFrame=this.two:a.spriteFrame=this.error}})),1===e.length){const t=this.pointPool.alloc();t.setWorldPosition(new j(e[0].a.x+e[0].b.x,e[0].a.y+e[0].b.y,0).multiplyScalar(.5)),t.getComponent(R).spriteFrame=this.error}this.pathAppearDuration=.8}update(e){this.pathAppearDuration>0&&(this.pathAppearDuration-=e,this.pathAppearDuration<=0&&this.clearPath())}}).prototype,"one",[pd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd=ve(bd.prototype,"two",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd=ve(bd.prototype,"error",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd=bd))||yd);var Td;i._RF.pop(),i._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);const{ccclass:Ad}=a;let Rd=Ad("HintDrawer")(Td=class extends dd{drawPath(e){this.clearPath(),this.createPath(e),this.showPath()}createPath(e){e.forEach((e=>{this.linePool.alloc().getComponent($h)?.setPoints(e.a,e.b);this.pointPool.alloc().setWorldPosition(e.a.x,e.a.y,0)}));this.pointPool.alloc().setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0)}showPath(){for(const e of this.lineNodes){const t=e.getComponent(x);t.opacity=0,C(t).to(.2,{opacity:255},{easing:"quadOut"}).start()}for(const e of this.pointNodes){const t=e.getComponent(x);t.opacity=0,C(t).to(.2,{opacity:255},{easing:"quadOut"}).start()}}clearPath(){for(const e of this.lineNodes){const t=e.getComponent(x);C(t).to(.15,{opacity:0},{onComplete:()=>{t.opacity=255,this.linePool.free(e)}}).start()}for(const e of this.pointNodes){const t=e.getComponent(x);C(t).to(.15,{opacity:0},{onComplete:()=>{t.opacity=255,this.pointPool.free(e)}}).start()}this.lineNodes=[],this.pointNodes=[]}})||Td;var Id;i._RF.pop(),i._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);const{ccclass:Pd}=a;let _d=Pd("MatchDrawer")(Id=class extends dd{drawPath(e){e.forEach(((e,t)=>{const i=this.linePool.alloc();i.getComponent($h)?.setPoints(e.a,e.b),this.animateLine(i);const n=this.pointPool.alloc();n.setWorldPosition(e.a.x,e.a.y,0),this.animatePoint(n,t)}));const t=this.pointPool.alloc();t.setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0),this.animatePoint(t,e.length)}async animateLine(e){const t=e.getComponent(x);t.opacity=0;const i=C(t).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});await St.runTweenAsync(i),t.opacity=255,this.linePool.free(e)}async animatePoint(e,t){e.scale=j.ZERO;const i=C(e).delay(.03*t).to(.2,{scale:j.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:j.ZERO},{easing:"backIn"});await St.runTweenAsync(i),this.pointPool.free(e)}clearPath(){this.lineNodes=[],this.pointNodes=[]}})||Id;var Ld,Dd,Od,Nd,Md,kd,xd,Fd,Bd;i._RF.pop(),i._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);const{ccclass:Gd,property:zd}=a;let Ud=(Ld=Gd("PathDraw"),Dd=zd({group:{name:"Path Drawer"},type:_d}),Od=zd({group:{name:"Path Drawer"},type:Rd}),Nd=zd({group:{name:"Path Drawer"},type:Ed}),Ld((xd=ve((kd=class extends s{constructor(){super(...arguments),e(this,"matchPath",xd,this),e(this,"hintPath",Fd,this),e(this,"errorPath",Bd,this),this.isDrawingHint=!1}drawMatchPath(e,t){e=e.map((e=>({...e})));for(const i of e)i.a=t(i.a),i.b=t(i.b);this.matchPath.drawPath(e)}clearMatchPath(){this.matchPath.clearPath()}drawHintPath(e,t){if(!this.isDrawingHint){this.isDrawingHint=!0,e=e.map((e=>({...e})));for(const i of e)i.a=t(i.a),i.b=t(i.b);this.hintPath.drawPath(e)}}clearHintPath(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}drawErrorPath(e,t){e=e.map((e=>({...e})));for(const i of e)i.a=t(i.a),i.b=t(i.b);this.errorPath.drawPath(e)}}).prototype,"matchPath",[Dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fd=ve(kd.prototype,"hintPath",[Od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd=ve(kd.prototype,"errorPath",[Nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Md=kd))||Md);var Hd;i._RF.pop(),i._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);const{ccclass:Vd}=a;let qd=Vd("ComboManager")(Hd=class extends s{init(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(Ga.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(Ga.GAME_FINISH,this.resetCombo,this),this.node.scene.on(Ga.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(Ga.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(Ga.ADD_COMBO,this.addCombo,this)}addCombo(){this.setCombo(this.currentCombo+1)}resetCombo(){this.setCombo(0)}getCombo(){return this.currentCombo}setCombo(e){if(this.currentCombo=e,e>0&&e<5){const t=[xi.COMBO_1,xi.COMBO_2,xi.COMBO_3,xi.COMBO_4,xi.COMBO_5];Yi.playSound(t[e])}else e>=5&&Yi.playSound(xi.COMBO_5);e>0&&this.vibrate(e),this.emitEvent&&this.node.scene.emit(Ga.COMBO_UPDATED,e)}vibrate(e){P("Vibrate")?.getComponent(cr)?.vibrate(Math.min(20+20*e,220))}setEmitEvent(e){this.emitEvent=e}})||Hd;var Wd,Kd,Yd,jd,Xd,$d,Qd,Jd,Zd,eu,tu,iu,nu,au,su,ou,ru;i._RF.pop(),i._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);const{ccclass:lu,property:cu,disallowMultiple:hu}=a;let du=(Wd=lu("ShiningStar"),Kd=cu(R),Yd=cu({serializable:!0,visible:!1}),jd=cu({type:E,displayName:"Scale up duration",min:.001}),Xd=cu({serializable:!0,visible:!1}),$d=cu({type:E,displayName:"Bounce and Fall duration",min:.001}),Qd=cu({serializable:!0,visible:!1}),Jd=cu({type:E,displayName:"Start scale"}),Zd=cu({serializable:!0,visible:!1}),eu=cu({type:E,displayName:"End scale"}),Wd(tu=hu((nu=ve((iu=class extends s{constructor(){super(...arguments),e(this,"shine",nu,this),e(this,"twScaleUpDuration",au,this),e(this,"twBounceAndFallDuration",su,this),e(this,"twStartScale",ou,this),e(this,"twEndScale",ru,this),this.isBeingAnimated=!1}get scaleUpDuration(){return this.twScaleUpDuration}set scaleUpDuration(e){this.twScaleUpDuration=e}get bounceAndFallDuration(){return this.twBounceAndFallDuration}set bounceAndFallDuration(e){this.twBounceAndFallDuration=e}get startScale(){return this.twStartScale}set startScale(e){this.twStartScale=e}get endScale(){return this.twEndScale}set endScale(e){this.twEndScale=e}get isAvailable(){return!this.isBeingAnimated}__preload(){this.shineOpacity=this.shine.node.getComponent(x),this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents()}onLoad(){this.uiOpacity.opacity=0}async playAnimation(){if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0,await this.animateAppear(),await this.animateDisappear(),this.isBeingAnimated=!1}async animateAppear(){this.shineOpacity.opacity=255,await Promise.all([this.animateFadeIn(),this.animateScaleUp()])}async animateDisappear(){await Promise.all([this.animateBounceAndFall(),this.animateScaleDown()]),this.node.setScale(0,0),this.uiOpacity.opacity=0}async animateBounceAndFall(){const e=this.node.position.x,t=this.node.position.y,i=[60,120],n=(Math.random()*(i[1]-i[0])+i[0])*(Math.PI/180),a=e+200*Math.cos(n),s=t+200*Math.sin(n),o=t-500,r=St.runTweenAsync(C(this.node).to(.2*this.twBounceAndFallDuration,{position:new j(a,s,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new j(a,o,this.node.position.z)},{easing:"cubicIn"})),l=[0,360],c=St.runTweenAsync(C(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new j(0,0,Math.random()*(l[1]-l[0])*(a>e?-1:1))},{easing:"sineOut"}));await Promise.all([r,c]),this.node.eulerAngles=new j(0,0,0)}async animateFadeIn(){const e=Math.max(this.scaleUpDuration/4,.01);await St.runTweenAsync(C(this.uiOpacity).to(e,{opacity:255}))}async animateScaleUp(){this.node.setScale(this.startScale,this.startScale);const e=new j(this.endScale,this.endScale,1);await St.runTweenAsync(C(this.node).to(this.scaleUpDuration,{scale:e},{easing:"cubicOut"}))}async animateScaleDown(){const e=new j(0,0,1);await St.runTweenAsync(C(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:e},{easing:"cubicIn"}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"shine",[Kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),au=ve(iu.prototype,"twScaleUpDuration",[Yd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ve(iu.prototype,"scaleUpDuration",[jd],Object.getOwnPropertyDescriptor(iu.prototype,"scaleUpDuration"),iu.prototype),su=ve(iu.prototype,"twBounceAndFallDuration",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ve(iu.prototype,"bounceAndFallDuration",[$d],Object.getOwnPropertyDescriptor(iu.prototype,"bounceAndFallDuration"),iu.prototype),ou=ve(iu.prototype,"twStartScale",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ve(iu.prototype,"startScale",[Jd],Object.getOwnPropertyDescriptor(iu.prototype,"startScale"),iu.prototype),ru=ve(iu.prototype,"twEndScale",[Zd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ve(iu.prototype,"endScale",[eu],Object.getOwnPropertyDescriptor(iu.prototype,"endScale"),iu.prototype),tu=iu))||tu)||tu);var uu,pu,mu,gu,yu;i._RF.pop(),i._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);const{ccclass:bu,property:fu,disallowMultiple:wu}=a,{Array:Su}=GameCore.Utils;let vu=(uu=bu("StarParticles"),pu=fu({type:[du],displayName:"Prebuilt Shining stars"}),uu(mu=wu((yu=ve((gu=class extends s{constructor(){super(...arguments),e(this,"shiningStars",yu,this)}__preload(){this.validateRequiredComponents()}async fireShiningStarAt(e){const t=this.getFirstAvailableShiningStar();if(void 0===t)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");const[i,n]=e,a=new j(i,n,this.node.worldPosition.z);t.node.worldPosition=a,await t.playAnimation()}getFirstAvailableShiningStar(){return Su.search(this.shiningStars,(e=>e.isAvailable))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"shiningStars",[pu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mu=gu))||mu)||mu);var Cu,Eu,Tu,Au,Ru,Iu,Pu,_u,Lu,Du,Ou,Nu,Mu,ku,xu,Fu,Bu,Gu,zu,Uu,Hu;i._RF.pop(),i._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);const{ccclass:Vu,property:qu}=a;let Wu=(Cu=Vu("EffectManager"),Eu=qu({group:"Thunder Effect",type:n}),Tu=qu({group:"Thunder Effect",type:n}),Au=qu({group:"Mask Effect",type:Hn}),Ru=qu({group:"Mask Effect",type:n}),Iu=qu({group:"Tornado Effect",type:n}),Pu=qu({group:"Clear Particle Effect",type:n,displayName:"Particle holder node"}),_u=qu({group:"Clear Particle Effect",type:se,displayName:"Emitter 1"}),Lu=qu({group:"Clear Particle Effect",type:se,displayName:"Emitter 2"}),Du=qu({group:"Star Particles Effect",type:vu}),Cu((Mu=ve((Nu=class extends s{constructor(){super(...arguments),e(this,"cloud",Mu,this),e(this,"lightnings",ku,this),e(this,"backgroundMask",xu,this),e(this,"masks",Fu,this),e(this,"tornado",Bu,this),this.bombExplosion=null,this.bombExplosionPool=null,this.defuseExplosion=null,this.defuseExplosionPool=null,e(this,"clearParticleHolder",Gu,this),e(this,"clearParticle1",zu,this),e(this,"clearParticle2",Uu,this),e(this,"starParticle",Hu,this),this.maskTargets=[]}__preload(){this.validateRequiredComponents()}update(){this.maskTargets.length>0&&this.maskTargets.forEach(((e,t)=>{if(e.isHidden())return;this.masks[t].worldPosition=e.node.worldPosition.clone()}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}start(){this.node.scene.on(Ga.GRID_RESIZE,this.handleBoardResize,this)}playClearFXAt(e){this.clearParticle1.node.setWorldPosition(new j(e[0].x,e[0].y,1)),this.clearParticle2.node.setWorldPosition(new j(e[1].x,e[1].y,1)),this.clearParticle1.resetSystem(),this.clearParticle2.resetSystem()}playStarFXAt(e){this.starParticle.fireShiningStarAt(e)}async playTornadoAnimation(){if(null===this.tornado.getChildByName("Sprite").getComponent(y).defaultClip)return void console.warn("EffectManager: Tornado animation is not loaded when animation play request was made.");this.tornado.active=!0;const e=C(this.tornado);e.set({scale:new j(0,0,0)}),e.delay(.5),e.to(.5,{scale:new j(1,1,1)},{easing:"quadOut"}),e.to(.5,{scale:new j(0,0,0)},{easing:"quadIn"}),e.set({active:!1}),li.setBlockInput(!0),await St.runTweenAsync(e),li.setBlockInput(!1)}async shakeGame(){const e=this.node.position.clone(),t=C(this.node).to(.05,{position:e.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:e.clone().subtract3f(ne(5,10),ne(5,10),0)}).to(.05,{position:e});await St.runTweenAsync(t)}handleBoardResize(e){this.clearParticleHolder.setScale(e,e)}async playThunderAnimation(e,t){this.cloud.active=!0;const i=P("Canvas").getComponent(l),{width:n,height:a}=i;let s=0,o=0;switch(Math.floor(4*Math.random())){case 0:s=Math.random()*n-n/2,o=a/2+300;break;case 1:s=Math.random()*n-n/2,o=-a/2-300;break;case 2:s=-n/2-300,o=Math.random()*a-a/2;break;case 3:s=n/2+300,o=Math.random()*a-a/2}this.cloud.position=new j(s,o),this.resetMasks(),this.setMaskProperties(0,e[0][0].node.worldPosition,e[0][0].node.worldScale),this.setMaskProperties(1,e[0][1].node.worldPosition,e[0][1].node.worldScale),this.setMaskProperties(2,e[1][0].node.worldPosition,e[1][0].node.worldScale),this.setMaskProperties(3,e[1][1].node.worldPosition,e[1][1].node.worldScale),this.maskTargets=[e[0][0],e[0][1],e[1][0],e[1][1]],await this.setBackgroundMaskActive(!0);const r=C(this.cloud).to(.8,{position:new j(0,300)},{easing:"quadOut"});await St.runTweenAsync(r);const c=e[0][0].node.worldPosition.clone(),h=e[0][1].node.worldPosition.clone();this.shakeGame(),P("Vibrate")?.getComponent(cr)?.vibrate(500),Yi.playSound(xi.THUNDERBOLT),t.clear([e[0]],"break"),await Promise.all([this.playLightningAnimation(c,0),this.playLightningAnimation(h,1)]),this.node.scene.emit(Ga.ADD_COMBO),this.node.scene.emit(Ga.ADD_SCORE);const d=e[1][1].node.worldPosition.clone(),u=e[1][0].node.worldPosition.clone();this.shakeGame(),P("Vibrate")?.getComponent(cr)?.vibrate(500),Yi.playSound(xi.THUNDERBOLT),t.clear([e[1]],"break"),await Promise.all([this.playLightningAnimation(u,0),this.playLightningAnimation(d,1)]),this.node.scene.emit(Ga.ADD_COMBO),this.node.scene.emit(Ga.ADD_SCORE),this.cloud.active=!1,await this.setBackgroundMaskActive(!1),this.maskTargets=[]}async playLightningAnimation(e,t){const i=this.lightnings[t],n=e.subtract(i.worldPosition),a=Math.atan2(n.y,n.x)*(180/Math.PI)+180,s=n.length();return i.getComponent(l).width=s,i.angle=a,new Promise((e=>{i.active=!0,this.scheduleOnce((()=>{i.active=!1,e()}),.2)}))}async setBackgroundMaskActive(e){e&&(this.backgroundMask.node.active=!0),await this.backgroundMask.changeStateFade(e,.25),e||(this.backgroundMask.node.active=!1)}resetMasks(){this.masks.forEach((e=>{e.worldPosition=new j(-9999,-9999,0)}))}setMaskProperties(e,t,i){i&&(this.masks[e].worldScale=i),this.masks[e].worldPosition=t}async createDefuseExplosionAt(e){await this.loadDefuseExplosionPrefab(),this.defuseExplosionPool||(this.defuseExplosionPool=new Qh(this.createDefuseExplosion.bind(this),1,Ku.getBombDefuseExplosion,Ku.returnBombDefuseExplosion,Ku.destroyBombDefuseExplosion));const t=this.defuseExplosionPool.alloc();t.setWorldPosition(e);const i=t.getComponent(y);if(await St.runAnimationAsync(i),!this.defuseExplosionPool)throw new Error("EffectManager: defuseExplosionPool is null");this.defuseExplosionPool.free(t)}async createBombExplosionAt(e){await this.loadBombExplosionPrefab(),this.bombExplosionPool||(this.bombExplosionPool=new Qh(this.createBombExplosion.bind(this),1,Yu.getBombExplosion,Yu.returnBombExplosion,Yu.destroyBombExplosion));const t=this.bombExplosionPool.alloc();t.setWorldPosition(e);const i=t.getComponent(y);if(await St.runAnimationAsync(i),!this.bombExplosionPool)throw new Error("EffectManager: bombExplosionPool is null");this.bombExplosionPool.free(t)}createDefuseExplosion(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return Ku.createDefuseExplosion(this.defuseExplosion,this.node)}createBombExplosion(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return Yu.createBombExplosion(this.bombExplosion,this.node)}async loadBombExplosionPrefab(){if(this.bombExplosion)return Promise.resolve();const e=await li.loadPrefabAsync(si.BOMB_EXPLODE_PREFAB);return e&&(this.bombExplosion=e),Promise.resolve()}async loadDefuseExplosionPrefab(){if(this.defuseExplosion)return Promise.resolve();const e=await li.loadPrefabAsync(si.BOMB_DEFUSE_PREFAB);return e&&(this.defuseExplosion=e),Promise.resolve()}async loadThunderAnimation(){const e=this.cloud.getChildByName("Top").getComponent(y);if(null!==e.defaultClip)return Promise.resolve();const t=await li.loadAnimClipAsync(si.CLOUD_IDLE_ANIM);return t&&(e.defaultClip=t),Promise.resolve()}async loadTornadoAnimation(){const e=this.tornado.getChildByName("Sprite").getComponent(y);if(null!==e.defaultClip)return Promise.resolve();const t=await li.loadAnimClipAsync(si.TORNADO_IDLE_ANIM);return t&&(e.defaultClip=t),Promise.resolve()}}).prototype,"cloud",[Eu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ku=ve(Nu.prototype,"lightnings",[Tu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xu=ve(Nu.prototype,"backgroundMask",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fu=ve(Nu.prototype,"masks",[Ru],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bu=ve(Nu.prototype,"tornado",[Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gu=ve(Nu.prototype,"clearParticleHolder",[Pu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zu=ve(Nu.prototype,"clearParticle1",[_u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uu=ve(Nu.prototype,"clearParticle2",[Lu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hu=ve(Nu.prototype,"starParticle",[Du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ou=Nu))||Ou);class Ku{static createDefuseExplosion(e,t){const i=c(e);return t.addChild(i),i.active=!1,i}static destroyBombDefuseExplosion(e){e.destroy()}static getBombDefuseExplosion(e){e.active=!0}static returnBombDefuseExplosion(e){e.active=!1}}class Yu{static createBombExplosion(e,t){const i=c(e);return t.addChild(i),i.active=!1,i}static destroyBombExplosion(e){e.destroy()}static getBombExplosion(e){e.active=!0}static returnBombExplosion(e){e.active=!1}}i._RF.pop(),i._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);const ju="newbie",Xu="timer",$u="combo",Qu="hint-item",Ju="thunder-item",Zu="storm-item",ep="pliers-item";i._RF.pop(),i._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);const tp=.7261538461538461;class ip{constructor(e){this.manager=e,this.gameplay=e.gameplay}setup(){this.currentStep=0,this.manager.node.scene.on(Ga.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(Ga.GRID_MATCH_FAIL,this.showNextStep,this),W.on(qn,this.handleViewResized,this),W.on(Kn,this.handleViewResized,this),this.showStep(this.currentStep),this.manager.node.scene.emit(Ga.HIDE_UI),this.manager.guideSkipButton.active=!0}showNextStep(){this.currentStep+1<sh.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}async showStep(e){const{board:t,effectManager:i}=this.gameplay,n=sh[e].startTile,a=sh[e].endTile,s=t.getTileAt(n.x,n.y),o=t.getTileAt(a.x,a.y);if(!s||!o)return;const r=s.node.worldPosition,l=o.node.worldPosition;i.resetMasks(),i.setMaskProperties(0,r,s.node.worldScale),i.setMaskProperties(1,l,o.node.worldScale),i.setBackgroundMaskActive(!0);const{guideHand:c,guideTextBox:h}=this.manager;c.node.active=!0,c.playHandAnimation(r,l),this.alignGuideTextBox(),this.alignSkipButton(),await h.hide(),h.setText(sh[e].description),await h.show(),t.setIgnoreInput(!0),s.setIgnoreInput(!1),o.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1)}handleViewResized(){const{board:e,effectManager:t}=this.gameplay,i=sh[this.currentStep].startTile,n=sh[this.currentStep].endTile,a=e.getTileAt(i.x,i.y),s=e.getTileAt(n.x,n.y);if(!a||!s)return;const o=a.node.worldPosition,r=s.node.worldPosition;t.setMaskProperties(0,o,a.node.worldScale),t.setMaskProperties(1,r,s.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}alignGuideTextBox(){const{board:e}=this.gameplay,{guideTextBox:t}=this.manager,i=e.getTileAt(0,0);if(!i)return;const n=i.node.worldPosition,a=e.tilesHolder.getWorldScale(),s=e.getTileSize()[1]*a.y,o=a.clone().multiplyScalar(tp);t.node.setWorldScale(o),t.node.setWorldPosition(new j(t.node.worldPosition.x,(n.y-s/2)/2))}alignSkipButton(){const{board:e}=this.gameplay,{guideSkipButton:t}=this.manager;if(!t)return;const i=e.getTileAt(0,e.getGridSize()[1]-1);if(!i)return;const n=i.node.worldPosition,a=e.tilesHolder.getWorldScale(),s=e.getTileSize()[1]*a.y,o=a.clone().multiplyScalar(tp),r=t.getComponent(l).contentSize.height*o.y;t.setWorldScale(o),t.setWorldPosition(new j(t.worldPosition.x,n.y+(s+r)/2+30))}async close(){const{board:e,effectManager:t}=this.gameplay;this.manager.node.scene.off(Ga.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(Ga.GRID_MATCH_FAIL,this.showNextStep,this),W.off(qn,this.handleViewResized,this),W.off(Kn,this.handleViewResized,this),e.setIgnoreInput(!1),await Promise.all([await this.manager.guideTextBox.hide(),await t.setBackgroundMaskActive(!1)]),this.manager.guideHand.node.active=!1,this.manager.completeGuide(ju)}}i._RF.pop(),i._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);class np{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,{clock:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.node.worldPosition;n*=1.5,a*=1.5,await this.gameplay.handleShowUI(),e.node.active=!0,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.active=!0,t.string="Remove all tiles before\nthe time end",t.node.setWorldPosition(s.x,s.y-a/2-50,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(qn,this.handleViewResized,this),W.on(Kn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,{clock:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.node.worldPosition;n*=1.5,a*=1.5,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.setWorldPosition(s.x,s.y-a/2-50,0)}async close(){const{guideInfoText:e,guideMasks:t}=this.manager;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(Ga.RESUME_TIME),await t.hide(),e.node.active=!1,this.manager.completeGuide(Xu),W.off(qn,this.handleViewResized,this),W.off(Kn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);class ap{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,{comboContainer:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.worldPosition;n*=1.5,a*=1.5,e.node.active=!0,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.active=!0,t.string="Remove tiles continuously\nto increase combo!",t.node.setWorldPosition(s.x-n/2-10,s.y,0),t.horizontalAlign=oe.RIGHT,t.getComponent(l).setAnchorPoint(1,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(qn,this.handleViewResized,this),W.on(Kn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,{comboContainer:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.worldPosition;n*=1.5,a*=1.5,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.setWorldPosition(s.x-n/2-10,s.y,0)}async close(){const{guideInfoText:e,guideMasks:t}=this.manager;this.manager.node.scene.emit(Ga.RESUME_TIME),t.node.off(n.EventType.TOUCH_START,this.close,this),await t.hide(),e.node.active=!1,this.manager.completeGuide($u),W.off(qn,this.handleViewResized,this),W.off(Kn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);const{Array:sp}=GameCore.Utils;class op{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=sp.search(this.gameplay.itemManager.items,(e=>e.itemType===dr.HINT));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to reveal a connectable pair",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(qn,this.handleViewResized,this),W.on(Kn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=sp.search(this.gameplay.itemManager.items,(e=>e.itemType===dr.HINT));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ga.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(Qu),W.off(qn,this.handleViewResized,this),W.off(Kn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);const{Array:rp}=GameCore.Utils;class lp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=rp.search(this.gameplay.itemManager.items,(e=>e.itemType===dr.THUNDER));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to remove 2 pairs",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(qn,this.handleViewResized,this),W.on(Kn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=rp.search(this.gameplay.itemManager.items,(e=>e.itemType===dr.THUNDER));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ga.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(Ju),W.off(qn,this.handleViewResized,this),W.off(Kn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);const{Array:cp}=GameCore.Utils;class hp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=cp.search(this.gameplay.itemManager.items,(e=>e.itemType===dr.STORM));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to rearrange the tiles",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(qn,this.handleViewResized,this),W.on(Kn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=cp.search(this.gameplay.itemManager.items,(e=>e.itemType===dr.STORM));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ga.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(Zu),W.off(qn,this.handleViewResized,this),W.off(Kn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);const{Array:dp}=GameCore.Utils;class up{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=dp.search(this.gameplay.itemManager.items,(e=>e.itemType===dr.PLIERS));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to remove bomb",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(qn,this.handleViewResized,this),W.on(Kn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=dp.search(this.gameplay.itemManager.items,(e=>e.itemType===dr.PLIERS));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ga.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(ep),W.off(qn,this.handleViewResized,this),W.off(Kn,this.handleViewResized,this)}}var pp,mp,gp,yp,bp,fp,wp,Sp,vp;i._RF.pop(),i._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);const{ccclass:Cp,property:Ep}=a;let Tp=(pp=Cp("GuideHand"),mp=Ep(n),gp=Ep(n),yp=Ep(x),pp((wp=ve((fp=class extends s{constructor(){super(...arguments),e(this,"hand",wp,this),e(this,"circleHighlight",Sp,this),e(this,"circleHighlightOpacity",vp,this)}start(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}playHandAnimation(e,t){this.handTween&&this.handTween.stop();const i=C(this.hand).to(.8,{worldPosition:t},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((()=>{this.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0}).to(.8,{worldPosition:e},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((()=>{this.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0});this.handTween=C(this.hand).repeatForever(i).start()}playHighlightAnimation(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),C(this.circleHighlight).to(.6,{scale:new j(1.5,1.5)},{easing:"quadOut"}).start(),C(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}).prototype,"hand",[mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sp=ve(fp.prototype,"circleHighlight",[gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vp=ve(fp.prototype,"circleHighlightOpacity",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bp=fp))||bp);var Ap,Rp,Ip,Pp,_p,Lp,Dp;i._RF.pop(),i._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);const{ccclass:Op,property:Np}=a;let Mp=(Ap=Op("GameMask"),Rp=Np(l),Ip=Np(R),Ap((Lp=ve((_p=class extends s{constructor(){super(...arguments),e(this,"uiTransform",Lp,this),e(this,"sprite",Dp,this)}get texture(){return this.sprite.spriteFrame.texture}}).prototype,"uiTransform",[Rp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp=ve(_p.prototype,"sprite",[Ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pp=_p))||Pp);var kp,xp,Fp,Bp,Gp,zp;i._RF.pop(),i._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);const{ccclass:Up,property:Hp,executeInEditMode:Vp}=a;let qp=(kp=Up("AlphaMasks"),xp=Vp(!0),Fp=Hp(Mp),kp(Bp=xp((zp=ve((Gp=class extends s{constructor(){super(...arguments),e(this,"masks",zp,this)}onLoad(){this.UITransform=this.node.getComponent(l)}start(){this.material=this.getComponent(R).getMaterialInstance(0)}update(){const{width:e,height:t}=this.UITransform;this.masks.forEach(((i,n)=>{const{width:a,height:s,anchorX:o,anchorY:r}=i.uiTransform,l=a*i.node.scale.x,c=s*i.node.scale.y,h=new Q(l/e,c/t),d=new Q(.5+(.5-o)*h.x,.5-(.5-r)*h.y),u=new Q(d.x+(i.node.worldPosition.x-this.node.worldPosition.x)/e,d.y-(i.node.worldPosition.y-this.node.worldPosition.y)/t);this.material.setProperty(`mask${n}Texture`,i.texture),this.material.setProperty(`ratio${n}`,h),this.material.setProperty(`center${n}`,u)}))}setMaskActive(e,t){e>=this.masks.length||this.material.setProperty(`useMask${e}`,t?1:0)}}).prototype,"masks",[Fp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bp=Gp))||Bp)||Bp);var Wp,Kp,Yp,jp,Xp,$p,Qp;i._RF.pop(),i._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);const{ccclass:Jp,property:Zp}=a;let em=(Wp=Jp("GuideMasks"),Kp=Zp(Hn),Yp=Zp(qp),Wp(($p=ve((Xp=class extends s{constructor(){super(...arguments),e(this,"background",$p,this),e(this,"alphaMasks",Qp,this)}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.background.node.active=!0,await this.background.changeStateFade(!0,.25)}async hide(){await this.background.changeStateFade(!1,.25),this.background.node.active=!1}onClick(){this.node.scene.emit(Ga.GUIDE_MASK_CLICKED)}setOtherMaskTransform(e,t,i,n){this.alphaMasks.masks[1].node.worldPosition=new j(-9999,-9999,0);const a=this.alphaMasks.masks[0];this.setMaskTransform(a,e,t,i,n)}setItemMaskTransform(e,t,i,n){this.alphaMasks.masks[0].node.worldPosition=new j(-9999,-9999,0);const a=this.alphaMasks.masks[1];this.setMaskTransform(a,e,t,i,n)}setMaskTransform(e,t,i,n,a){e.uiTransform.setContentSize(n,a),e.node.setWorldPosition(t,i,0)}}).prototype,"background",[Kp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qp=ve(Xp.prototype,"alphaMasks",[Yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jp=Xp))||jp);var tm,im,nm,am,sm;i._RF.pop(),i._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);const{ccclass:om,property:rm}=a;let lm=(tm=om("GuideTextBox"),im=rm(h),tm((sm=ve((am=class extends s{constructor(){super(...arguments),e(this,"guideText",sm,this)}__preload(){this.opacityToggler=this.getComponent(Hn),Fe.lazyValidateProperties(this)}setText(e){this.guideText.string=e}async show(){await this.opacityToggler.changeStateFade(!0)}async hide(){await this.opacityToggler.changeStateFade(!1)}}).prototype,"guideText",[im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm=am))||nm);var cm,hm,dm,um,pm,mm,gm,ym,bm,fm,wm,Sm,vm;i._RF.pop(),i._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);const{player:Cm,analytics:Em}=game,{ccclass:Tm,property:Am}=a,{Events:Rm}=GameCore.Plugins.Analytics,{Array:Im}=GameCore.Utils,Pm=new Q(0,10),_m=new Q(0,10),Lm="READY",Dm="RUNNING";let Om=(cm=Tm("GuidelinesManager"),hm=Am(Tp),dm=Am(lm),um=Am(h),pm=Am(em),mm=Am(n),cm((bm=ve((ym=class extends s{constructor(){super(...arguments),e(this,"guideHand",bm,this),e(this,"guideTextBox",fm,this),e(this,"guideInfoText",wm,this),e(this,"guideMasks",Sm,this),e(this,"guideSkipButton",vm,this),this.guideHintDelay=null,this.guideStormDelay=null}init(e){this.gameplay=e,this.status=Lm,this.node.scene.on(Ga.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(Ga.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(Ga.USE_ITEM,this.handleUseItem,this),this.node.scene.on(Ga.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(Ga.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(Ga.GAME_PAUSE,this.stopAutoGuides,this)}show(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(ju)&&this.resetGuideItemShowed(),this.startGuide(ju)):this.startGuide(Xu)}startGuide(e){if(this.status===Dm)return!1;if(this.hasGuideItemShowed(e))return!1;switch(this.addGuideItemShowed(e),this.status=Dm,e){case ju:Em.event(Rm.TUTORIAL_BEGIN),this.guide1=new ip(this),this.guide1.setup();break;case Xu:this.guide2=new np(this),this.guide2.setup();break;case $u:this.guide3=new ap(this),this.guide3.setup();break;case Qu:this.guide4=new op(this),this.guide4.setup();break;case Ju:this.guide5=new lp(this),this.guide5.setup();break;case Zu:this.guide6=new hp(this),this.guide6.setup();break;case ep:this.guide7=new up(this),this.guide7.setup()}return!0}completeGuide(e){Em.event(Rm.TUTORIAL_STEP,{step:e}),this.status=Lm,this.addGuideItemShowed(e),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}isHintGuideLevel(){return this.getCurrentLevel()>=Pm.x&&this.getCurrentLevel()<=Pm.y}isShowErrorPathLevel(){return this.getCurrentLevel()>=_m.x&&this.getCurrentLevel()<=_m.y}isNewbieGuideLevel(){return 0===this.getCurrentLevel()}hasGuideItemShowed(e){return Im.has(this.getGuideItemShowed(),e)}addGuideItemShowed(e){if(this.hasGuideItemShowed(e))return;const t=this.getGuideItemShowed();t.push(e),Cm.setGameData({guideItemShowed:t})}resetGuideItemShowed(){Cm.setGameData({guideItemShowed:[]})}getGuideItemShowed(){return Cm.getGameData()?.guideItemShowed??[]}getCurrentLevel(){return this.gameplay.levelManager.getLevelData().level}startComboGuide(e){this.isNewbieGuideLevel()||e<2||(this.startGuide($u),this.node.scene.off(Ga.COMBO_UPDATED,this.startComboGuide,this))}startAutoGuides(){this.startHintGuide(),this.startStormGuide()}stopAutoGuides(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}startHintGuide(){this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=new re(this.node).delay(5).call((()=>{this.isNewbieGuideLevel()||(this.hasGuideItemShowed(Qu)&&this.status===Lm?this.node.scene.emit(Ga.SHOW_HINT):this.startGuide(Qu),this.startHintGuide())}))),this.guideHintDelay.stop(),this.guideHintDelay.start())}startStormGuide(){null===this.guideStormDelay&&(this.guideStormDelay=new re(this.node).delay(10).call((()=>{if(this.isNewbieGuideLevel())return;if(this.hasGuideItemShowed(Zu))return;const e=Im.search(this.gameplay.itemManager.items,(e=>e.itemType===dr.STORM));e&&e.canActivate()&&(this.startGuide(Zu)||this.startStormGuide())}))),this.guideStormDelay.stop(),this.guideStormDelay.start()}startThunderGuide(){return!this.isNewbieGuideLevel()&&this.startGuide(Ju)}startPliersGuide(){return!this.isNewbieGuideLevel()&&this.startGuide(ep)}handleUseItem(e){switch(this.startAutoGuides(),e){case dr.HINT:this.addGuideItemShowed(Qu);break;case dr.THUNDER:this.addGuideItemShowed(Ju);break;case dr.STORM:this.addGuideItemShowed(Zu);break;case dr.PLIERS:this.addGuideItemShowed(ep)}}async skipNewbieGuide(){this.guideSkipButton.active=!1,await this.guide1.close();const e=this.getCurrentLevel()+1;Cm.setGameData({level:e}),this.node.scene.emit(Ga.NEXT_LEVEL)}}).prototype,"guideHand",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm=ve(ym.prototype,"guideTextBox",[dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wm=ve(ym.prototype,"guideInfoText",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sm=ve(ym.prototype,"guideMasks",[pm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm=ve(ym.prototype,"guideSkipButton",[mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gm=ym))||gm);var Nm,Mm,km,xm,Fm,Bm,Gm,zm,Um,Hm,Vm,qm,Wm,Km,Ym,jm,Xm,$m,Qm;i._RF.pop(),i._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);const{ccclass:Jm,property:Zm}=a;let eg=(Nm=Jm("SpecialItem"),Mm=Zm({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),km=Zm({type:p,tooltip:"The button that activates the item"}),xm=Zm({type:f,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),Fm=Zm({type:h,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),Bm=Zm({type:n,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),Gm=Zm({type:n,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),zm=Zm({type:x,group:"Animation"}),Um=Zm({type:x,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),Nm((qm=ve((Vm=class extends s{constructor(){super(...arguments),e(this,"isDevButton",qm,this),e(this,"button",Wm,this),e(this,"quantity",Km,this),e(this,"quantityLabel",Ym,this),e(this,"quantityNode",jm,this),e(this,"plusNode",Xm,this),e(this,"glowUIOpacity",$m,this),e(this,"uiOpacity",Qm,this),this.requestItem=null,this.loadQuantity=null}get itemType(){}onLoad(){this.validateRequiredComponents()}init(e){this.node.scene.on(Ga.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(Ga.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(Ga.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(Ga.IDLE_EXIT,(()=>{this.button.interactable=!1,this.applyActivationStatus()})),this.node.scene.on(Ga.IDLE_ENTER,(()=>{this.button.interactable=!0,this.applyActivationStatus()}))}start(){const e=this.loadQuantity();this.setQuantity(e)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async applyActivationStatus(){const e=this.canActivate();this.button.interactable=e,await St.runTweenAsync(C(this.uiOpacity).to(.2,{opacity:e?255:128}))}async activate(){this.quantity<=0?this.requestItem():(this.vibrate(),this.setQuantity(this.quantity-1))}canActivate(){return!1}setQuantity(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();e<0&&(e=0),this.quantity=e,this.quantityLabel.string=`${this.quantity}`,e<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),t&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}getQuantity(){return this.quantity}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;this.isDevButton||t&&this.setQuantity(e,t.animate)}vibrate(){P("Vibrate")?.getComponent(cr)?.vibrate(50)}async animateAddItem(){return this.glowUIOpacity.opacity=0,Promise.all([St.runTweenAsync(C(this.node).to(.1,{scale:new j(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:j.ONE},{easing:"elasticOut"})),St.runTweenAsync(C(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))])}}).prototype,"isDevButton",[Mm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Wm=ve(Vm.prototype,"button",[km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Km=ve(Vm.prototype,"quantity",[xm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ym=ve(Vm.prototype,"quantityLabel",[Fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jm=ve(Vm.prototype,"quantityNode",[Bm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xm=ve(Vm.prototype,"plusNode",[Gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$m=ve(Vm.prototype,"glowUIOpacity",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qm=ve(Vm.prototype,"uiOpacity",[Um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hm=Vm))||Hm);var tg;i._RF.pop(),i._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);const{ccclass:ig}=a;let ng=ig("ItemManager")(tg=class extends s{constructor(){super(...arguments),this.sceneItems=new Set}get items(){return[...this.sceneItems]}onLoad(){this.syncItems()}syncItems(){const e=P("Canvas/UI");if(!e)return;e.getComponentsInChildren(eg).forEach((e=>{e.node.activeInHierarchy&&this.sceneItems.add(e)}))}})||tg;var ag;i._RF.pop(),i._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);const{ccclass:sg}=a,{Utils:og}=GameCore,rg={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]};let lg=sg("LevelManager")(ag=class extends s{async loadLevel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yr;const i=await this.loadLevelData(e);this.levelData=i||this.levelData||rg;const{rows:n,columns:a}=this.levelData;og.Device.isMobile()&&a>=6&&n>=10&&(this.levelData.columns=5,this.levelData.rows=10);const s=`${si.TILE_SKIN_FOLDER}/${t}`;return await li.loadSpriteFramesDirAsync(s)}async loadLevelData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=this.paddingZero(`${Math.floor(e/10)+1}`,3),i=e%10,n=await li.loadJsonAsync(`${si.LEVEL_DATA_FOLDER}/${t}`);return n?n[i]:null}getLevelData(){return this.levelData}paddingZero(e,t){return Array(t-e.length).fill("0").join("")+e}})||ag;var cg;i._RF.pop(),i._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);const{ccclass:hg}=a;let dg=hg("ScoreManager")(cg=class extends s{constructor(){super(...arguments),this.currentScore=0,this.tournamentStartScore=0}addScore(e,t,i){const n=this.getLevelMultiplier(t),a=this.getComboMultiplier(i),s=Math.floor(this.currentScore+e*n*a),o=10*Math.ceil(s/10);this.setScore(o)}init(){this.initCurrentScore(),this.updateScore()}initCurrentScore(){const e=ul.getMatchMode();this.currentScore=e===GameCore.Match.Modes.TOURNAMENT?this.tournamentStartScore:0}setScore(e){this.currentScore=e,this.updateScore()}updateTournamentStartScore(){this.tournamentStartScore=this.currentScore}updateScore(){this.node.scene.emit(Ga.SCORE_UPDATED,this.currentScore)}getCurrentScore(){return this.currentScore}getLevelMultiplier(e){return 1+.1*(e-1)}getComboMultiplier(e){return 1+.1*(e-1)}})||cg;i._RF.pop(),i._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);const{Configs:ug,Plugins:pg,Utils:mg}=GameCore,{Array:gg}=mg,{ads:yg}=globalThis.game;class bg{static get inst(){return this._instance||(this._instance=new bg),this._instance}static async preloadAds(){const{Enabled:e,InterstitialAdOptions:t,RewardedVideoAdOptions:i}=ug.Ads;if(!e)return;const{INTERSTITIAL:n,REWARDED_VIDEO:a}=GameCore.Plugins.Ads.Types;t.forEach((e=>{const{PlacementId:t}=e;yg.loadAdAsync(n,t).catch((()=>{}))})),i.forEach((e=>{const{PlacementId:t}=e;yg.loadAdAsync(a,t).catch((()=>{}))}))}static showBannerAds(){const{Enabled:e,BannerDisplayAdOptions:t}=ug.Ads;if(!e)return;const i=le.instance.getVisibleSize(),n=ji.worldSizeToCssSize(i.height*hr);t.forEach((e=>{let{PlacementId:t,Position:i,BannerHeight:a}=e;"bottom"===i&&a>n||yg.showBannerAdAsync(t).catch((e=>{}))}))}static hideBannerAds(){const{Enabled:e,BannerDisplayAdOptions:t}=ug.Ads;e&&t.forEach((e=>{let{PlacementId:t}=e;yg.hideBannerAdAsync(t).catch((e=>{}))}))}static async showInterstitialAdAsync(e){const{forLevel:t=1,includeSDK:i,excludeSDK:n}=e;if(!this.inst.canbeShowInSDK(i,n))return!1;if(ug.Gameplay.StartAdAtLevel>=t)return!1;const{Types:a,Status:s}=pg.Ads;if(!yg.canbeShowInterstitialAd())return!1;const o=Date.now();try{Yi.muteAudio(!0),Bl.showLoadingNotificationScreen();return yg.getAdStatus(a.INTERSTITIAL)!==s.FILLED&&await yg.loadAdAsync(a.INTERSTITIAL),await yg.showAdAsync(a.INTERSTITIAL),!0}catch(e){return console.warn("showInterstitialAdAsync failed",e),!1}finally{Yi.muteAudio(!1);const e=(Date.now()-o)/1e3;setTimeout((()=>{Bl.closeNotificationScreen()}),e>.5?0:.5),yg.loadAdAsync(a.INTERSTITIAL).catch((()=>{}))}}static async showRewardVideoAdAsync(e){const{includeSDK:t,excludeSDK:i}=e;if(!this.inst.canbeShowInSDK(t,i))return!1;const{Types:n,Status:a}=pg.Ads;try{Yi.muteAudio(!0),Bl.showLoadingNotificationScreen();return yg.getAdStatus(n.REWARDED_VIDEO)!==a.FILLED&&await yg.loadAdAsync(n.REWARDED_VIDEO),await yg.showAdAsync(n.REWARDED_VIDEO),Bl.closeNotificationScreen(),!0}catch(e){if(console.warn("showRewardVideoAdAsync failed",e),e instanceof Object&&"code"in e&&"USER_INPUT"===e.code){const e="Sorry, no rewards!\n You have cancelled the ad.";Bl.showNotificationScreen(e,2)}else Bl.showNotificationScreen("No ads to display.",2);return!1}finally{Yi.muteAudio(!1),yg.loadAdAsync(n.REWARDED_VIDEO).catch((()=>{}))}}canbeShowInSDK(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const i=GameSDK.getSDKName();return(!t?.length||!gg.has(t,i))&&!(e?.length&&!gg.has(e,i))}}try{new bg}catch(e){console.error("AdsUtils",e)}i._RF.pop(),i._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);class fg{constructor(e){this.game=null,this.data={},this.game=e.getGameplay(),this.manager=e,this.updateStateData(),this.logDebug()}logDebug(){const e=this.constructor.name;console.info(`[STATE] ${e}`,this.data)}updateStateData(){if(!this.game)return;const e=this.game.getGameData();e&&(this.data=e)}updateGameData(e){this.game?.setGameData(e)}}i._RF.pop(),i._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);const{analytics:wg,monitorError:Sg,match:vg,player:Cg,storage:Eg}=globalThis.game,{Modes:Tg}=GameCore.Match;class Ag extends fg{constructor(e,t){super(e),Yi.stopAllSounds(),this.vibrateDevice(),this.pauseCountdown(),this.updateMatchCustomData(),this.handleGameOver(t),this.logLevelFailAnalytics()}pauseCountdown(){this.game?.uiManager.pauseTime()}vibrateDevice(){P("Vibrate")?.getComponent(cr)?.vibrate(500)}async handleGameOver(e){const t=ul.getMatchMode();if(li.setBlockInput(!0),t===Tg.SINGLE)return await this.handleTournamentCreateFlow(),void this.showFailScreen(e);if(t===Tg.TOURNAMENT)await this.handleTournamentGameOver();else{if(t!==Tg.CHALLENGE_FRIEND)return void this.showFailScreen(e);await this.handleChallengeGameOver()}li.setBlockInput(!1)}async handleTournamentCreateFlow(){try{await ul.processCreateTournamentAsync()}catch(e){if(e instanceof qr)return;return e instanceof Vr&&Sg?.sendException(e),void console.error(e)}}async handleTournamentGameOver(){const e=ul.getMatchCustomData()?.tournamentId;if(!e)return;if(Kl.validateTournamentExpired(e)){Eg.setStorageData("tournament","animateTournamentLeader",!1);const e=2;return Bl.showNotificationScreen("Tournament has ended",e),void this.game?.scheduleOnce((()=>{this.game?.node.scene.emit(Ga.GAME_EXIT)}),e)}try{await ul.finishMatchAsync();const{profiles:e}=vg.getMatchState(),t=Eg.getStorageData("tournament","previousScore")??0;(e[Cg.getPlayerId()].score??0)>t&&Eg.setStorageData("tournament","animateTournamentLeader",!0)}catch(e){console.warn(e)}this.game?.node.scene.emit(Ga.GAME_EXIT)}async handleChallengeGameOver(){try{const{id:e}=vg.getMatchState(),t=await vg.api.getMatchAPI().getMatchDetailByIdAsync(e),i=new GameCore.Dtos.Match.Data(t).toObject().extraData;await ul.finishMatchAsync({extraData:i??void 0})}catch(e){console.warn(e)}this.game.node.scene.emit(Ga.SHOW_CHALLENGE_RESULTS)}async showFailScreen(e){const{level:t}=this.data;this.game&&await bg.showInterstitialAdAsync({forLevel:t}),Yi.turnOffMusic(),e===Yl&&Yi.playSound(xi.LEVEL_FAIL_TIMEOUT),Yi.playSound(xi.LEVEL_FAIL),Bl.openScreen(zi.RESCUES_SCREEN,{level:t,failKey:e})}updateMatchCustomData(){const{level:e=1}=this.data,t=this.game?.scoreManager.getCurrentScore()??0;ul.updateMatchStateAfterLevelFinish(e,t)}logLevelFailAnalytics(){if(!this.game)return;const{level:e=0}=this.data,t=this.game.scoreManager.getCurrentScore();wg.levelFail(e,t)}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){}playing(){const e=this.manager.createPlayingState(this.manager);this.manager.change(e)}fail(){}finish(){const e=this.manager.createFinishState(this.manager);this.manager.change(e)}update(){}}i._RF.pop(),i._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);const{analytics:Rg,player:Ig,leaderboard:Pg,match:_g,monitorError:Lg}=globalThis.game,{Modes:Dg}=GameCore.Match;class Og extends fg{constructor(e){super(e),this.handleFinishStateFlow()}async handleFinishStateFlow(){this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),Yi.turnUpMusic(),this.game?.uiManager.pauseTime();const e=ul.getMatchMode();e!==Dg.CHALLENGE_FRIEND&&this.updatePlayerProgress(),this.updateMatchCustomData(),this.handlePostScoreToLeaderboard(),e===Dg.CHALLENGE_FRIEND?this.handleChallengeOver():(await this.handleTournamentCreateFlow(),this.showLevelCompleteScreen()),this.logLevelCompleteAnalytics()}async handleChallengeOver(){try{const{id:e}=_g.getMatchState(),t=await ul.getMatchExtraDataAsync(e);await ul.finishMatchAsync({extraData:t??void 0})}catch(e){console.warn(e),await ul.finishMatchAsync()}this.game.node.scene.emit(Ga.SHOW_CHALLENGE_RESULTS)}processCrazyGamesEvent(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}updateMatchCustomData(){const{level:e=1}=this.data,t=this.game?.scoreManager.getCurrentScore()??0;ul.updateMatchStateAfterLevelFinish(e,t)}logLevelCompleteAnalytics(){if(!this.game)return;const{level:e=0}=this.data,t=this.game.scoreManager.getCurrentScore();Rg.levelComplete(e,t)}async showLevelCompleteScreen(){const{level:e}=this.data;Yi.turnOffMusic(),Yi.playSound(xi.LEVEL_COMPLETE);const t=Ig.getGameData()?.coins??0;Bl.openScreen(zi.LEVEL_COMPLETE_SCREEN,{level:e,currentCoin:t})}updatePlayerProgress(){if(!this.game)return;const{level:e}=this.data;if(!e)return;const t=e+1,i=Ig.getGameData();if(!i)return;const n=i.totalLevel,a=i.level,s=Math.max(a,t),o={...i};s<n&&(o.level=s),Ig.setGameData(o)}attemptCallCreateShortcut(){const{level:e=0}=this.data;e<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((e=>{console.warn("createShortcutAsync",e)}))}async handleTournamentCreateFlow(){if(ul.getMatchMode()!==Dg.SINGLE)return;const e=Ig.getGameData();if(!e)return;const{lastCreateTournamentShown:t=0}=e;if(Date.now()-t>3e5)try{await ul.processCreateTournamentAsync()}catch(e){if(e instanceof qr)return;return e instanceof Vr&&Lg?.sendException(e),void console.error(e)}}async handlePostScoreToLeaderboard(){if(ul.getMatchMode()!==Dg.TOURNAMENT)return;const e=this.game?.scoreManager.getCurrentScore();if(!e)return;try{await GameSDK.tournament.postScoreAsync(e)}catch(e){console.warn("GameSDK post score async",e)}const t=ul.getMatchCustomData();if(!t)return;const{leaderboardId:i,playerId:n}=t;i&&n&&await Pg.setLeaderboardScoreAsync(i,n,e)}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){}playing(){}fail(){}finish(){}update(){}}i._RF.pop(),i._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);const{player:Ng,match:Mg}=globalThis.game,{Modes:kg}=GameCore.Match;class xg extends fg{constructor(e){super(e),this.handleSingleGameStart=async e=>{const t=this.game.levelManager.getLevelData(),i=this.data.level,n=Ng.getPlayerId();await Promise.all([ul.setMatchCustomDataAsync({level:i,score:0}),ul.setProfileMatchDataAsync({id:n,score:0})]),this.game.board.create(e,t),this.game.board.setIgnoreInput(!0),await this.game.board.animateTilesAppear(),this.game.guidelinesManager?.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),this.ready()},this.enableUI(),this.clearBoard(),this.loadLevel(),this.initCountdown(),this.initScore()}enableUI(){this.game?.uiManager.enableHeader()}clearBoard(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.pathDraw.clearMatchPath())}async loadLevel(){if(!this.game)return;const e=ul.getMatchMode();try{if(e===kg.CHALLENGE_FRIEND){const{id:e}=Mg.getMatchState(),t=await ul.getMatchExtraDataAsync(e);if(null==t)throw new Error(`Match mode ${kg.CHALLENGE_FRIEND} but no extraData (for opponent initialization) was found in match data.`);const i=this.getLevelSkin(t.level),n=await this.game.levelManager.loadLevel(t.level,i);this.updateGameData({level:t.level,levelData:this.game.levelManager.getLevelData()}),Yi.playSound(xi.LEVEL_START),this.handleChallengeFriendGameStart(n,t)}else{const e=this.getLevelSkin(this.data.level),t=await this.game.levelManager.loadLevel(this.data.level,e);this.updateGameData({levelData:this.game.levelManager.getLevelData()}),Yi.playSound(xi.LEVEL_START),this.handleSingleGameStart(t)}}catch(e){console.error("Error loading level:",e);const t=this.getLevelSkin(this.data.level),i=await this.game.levelManager.loadLevel(this.data.level,t);this.updateGameData({levelData:this.game.levelManager.getLevelData()}),Yi.playSound(xi.LEVEL_START),this.handleSingleGameStart(i)}this.updateGameData({levelData:this.game.levelManager.getLevelData()})}getLevelSkin(e){const t=il.getLevelSkin(e),i=il.getUnlockedSkins();if(i.length<=1)return t;if(G.random()<=.5)return t;const n=i.indexOf(t);return i.splice(n,1),i[G.randomRangeInt(0,i.length)]}async handleChallengeFriendGameStart(e,t){const i=this.game.levelManager.getLevelData(),{level:n,fen:a,gravity:s,rules:o,time:r}=t,l=Ng.getPlayerId();await Promise.all([ul.setMatchCustomDataAsync({level:n,score:0}),ul.setProfileMatchDataAsync({id:l,score:0})]),this.game.board.create(e,{...i,level:n,customFen:a,mode:s,rules:o,time:r}),this.game.board.setIgnoreInput(!0),await this.game.board.animateTilesAppear(),this.game.board.setIgnoreInput(!1),this.ready()}initScore(){this.game&&this.game.scoreManager.initCurrentScore()}initCountdown(){this.game&&this.game.uiManager.initCountdown()}initialize(){}ready(){const e=this.manager.createReadyState(this.manager);this.manager.change(e)}pause(){}playing(){}fail(){}finish(){}update(){}}i._RF.pop(),i._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);class Fg extends fg{constructor(e){super(e),this.startCountdown()}startCountdown(){this.game?.uiManager.startCountdown()}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){const e=this.manager.createReadyState(this.manager);this.manager.change(e)}playing(){}fail(e){const t=this.manager.createFailState(this.manager,e);this.manager.change(t)}finish(){const e=this.manager.createFinishState(this.manager);this.manager.change(e)}update(){this.updateStateData()}}i._RF.pop(),i._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);const{analytics:Bg,match:Gg}=globalThis.game;class zg extends fg{constructor(e){super(e),Yi.stopAllSounds(),Yi.turnDownMusic(),this.handleGuideFlow(),this.setLevelText(),this.setLevelTime(),this.setGridPlayable(),this.logLevelStartAnalytics()}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){}playing(){const e=this.manager.createPlayingState(this.manager);this.manager.change(e)}fail(e){if(!GameCore.Utils.Valid.isDebugger())return;const t=this.manager.createFailState(this.manager);this.manager.change(t)}finish(){if(!GameCore.Utils.Valid.isDebugger())return;const e=this.manager.createFinishState(this.manager);this.manager.change(e)}update(){}setGridPlayable(){this.manager.getGameplay().guidelinesManager?.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}handleGuideFlow(){this.game.guidelinesManager?.isNewbieGuideLevel()||this.game.handleShowUI(),this.game.guidelinesManager?.show()}setLevelTime(){if(!this.game)return;const{levelData:e}=this.data;e&&this.game.uiManager.setCountdownTime(e.time)}setLevelText(){if(!this.game)return;const{level:e=0}=this.data;this.game.uiManager.setLevelText(e)}logLevelStartAnalytics(){if(!this.game)return;const{level:e=0}=this.data,t=Gg.getMatchState(),{score:i=0}=t.customData;Bg.levelStart(e,i)}}var Ug;i._RF.pop(),i._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);const{ccclass:Hg}=a;let Vg=Hg("StateManager")(Ug=class extends s{getGameplay(){return this.gameplay}init(e){this.gameplay=e,this.state=new xg(this)}change(e){this.state=e}initialize(){this.state.initialize()}isInitialize(){return this.state instanceof xg}ready(){this.state.ready()}isReady(){return this.state instanceof zg}playing(){this.state.playing()}isPlaying(){return this.state instanceof Fg}fail(e){this.state.fail(e)}isFail(){return this.state instanceof Ag}finish(){this.state.finish()}isFinished(){return this.state instanceof Og}update(e){this.state&&this.state.update(e)}createInitializeState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new xg(...t)}createReadyState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new zg(...t)}createPlayingState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Fg(...t)}createFailState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Ag(...t)}createFinishState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Og(...t)}})||Ug;var qg,Wg,Kg,Yg,jg;i._RF.pop(),i._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);const{ccclass:Xg,property:$g}=a;let Qg=(qg=Xg("Digit"),Wg=$g(h),qg((jg=ve((Yg=class extends s{constructor(){super(...arguments),e(this,"numberLabels",jg,this),this.labelUITransforms=[],this.labelUIOpacitys=[],this.previousNumber=0}onLoad(){this.uiTransform=this.getComponent(l),this.labelUITransforms=this.numberLabels.map((e=>e.getComponent(l))),this.labelUIOpacitys=this.numberLabels.map((e=>e.getComponent(x))),Fe.lazyValidateProperties(this)}setNumber(e){this.previousNumber!==e&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[e].node.active||(this.numberLabels[e].node.active=!0),this.labelUIOpacitys[e].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[e].contentSize),this.previousNumber=e)}}).prototype,"numberLabels",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kg=Yg))||Kg);var Jg,Zg,ey,ty,iy,ny,ay;i._RF.pop(),i._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);const{ccclass:sy,disallowMultiple:oy,property:ry}=a;let ly=(Jg=sy("Clock"),Zg=ry(n),ey=ry(Qg),Jg(ty=oy((ny=ve((iy=class extends s{constructor(){super(...arguments),e(this,"clockIcon",ny,this),e(this,"digits",ay,this),this.time=0,this.remaining=0,this.running=!1,this.halfTime=!1,this.handleUpdateConfig=e=>{this.enabled&&console.log("Clock: handleUpdateConfig",e)},this.refillTime=()=>{const e=Date.now(),t=C(this.node).to(.5,{scale:new j(1.1,1.1,1)}),i=C(this.node).to(.5,{scale:new j(1,1,1)}),n=C(this.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),a=C(this.clockIcon).repeat(5,n),s=C(this.node).to(3,{position:new j(0,0,0)},{onUpdate:()=>{const t=Date.now(),i=(t-e)/3e3>1?1:(t-e)/3e3,n=G.lerp(0,120,i);this.setTime(n)}}).call((()=>{this.setTime(120),i.start(),this.node.scene.emit(Ga.RESCUE_FINISHED)}));C(this.node).parallel(t,s).start(),a.start()}}__preload(){this.listenEvents()}start(){this.init()}init(){this.running=!1,this.halfTime=!1}listenEvents(){this.node.scene.on(Yn,this.handleUpdateConfig),this.node.scene.on(Ga.RESCUE_START,this.refillTime)}setTime(e){this.time=e,this.updateTimeLabel(e),this.remaining=e}startCountdown(){this.running=!0,this.remaining=this.time}pause(){this.running=!1}resume(){this.running=!0}endCountDown(){this.running=!1,this.remaining=0,this.node.scene.emit(Ga.TIME_OUT)}update(e){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=e,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(Ga.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}updateTimeLabel(e){const t=this.convertSecondsToMmSs(e);for(let e=0;e<t.length;e++)this.digits[e].setNumber(parseInt(t[e]))}convertSecondsToMmSs(e){const t=Math.floor(e/60),i=Math.floor(e%60);return`${this.padZero(t)}${this.padZero(i)}`}padZero(e){return e<10?`0${e}`:`${e}`}}).prototype,"clockIcon",[Zg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ay=ve(iy.prototype,"digits",[ey],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ty=iy))||ty)||ty);var cy;i._RF.pop(),i._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);const{ccclass:hy}=a;let dy=hy("ComboProgressBar")(cy=class extends s{start(){this.progressBar=this.getComponent(ks),this.opacity=this.getComponent(x),this.comboTimer=0,this.isActive=!1,this.node.scene.on(Ga.COMBO_UPDATED,this.handleComboUpdated,this)}update(e){this.isActive&&(this.comboTimer>0?(this.comboTimer-=e,this.progressBar.progress=this.comboTimer/3):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(Ga.COMBO_ENDED)))}handleComboUpdated(e){0===e?this.opacity.opacity=0:e>0&&(this.isActive=!0,this.comboTimer=3),e>1&&(this.opacity.opacity=255)}pause(){this.isActive=!1}resume(){this.isActive=!0}})||cy;var uy,py,my,gy,yy,by,fy,wy,Sy;i._RF.pop(),i._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);const{ccclass:vy,property:Cy}=a;let Ey=(uy=vy("ScoreBlock"),py=Cy(R),my=Cy(N),gy=Cy(h),uy((fy=ve((by=class extends s{constructor(){super(...arguments),e(this,"avatar",fy,this),e(this,"defaultAvatar",wy,this),e(this,"scoreText",Sy,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenGameEvents(){this.node.scene.on(Ga.SCORE_UPDATED,this.updateScore,this)}unListenGameEvents(){this.node.scene.off(Ga.SCORE_UPDATED,this.updateScore,this)}async updateInfo(e,t){t?(this.score=t,this.scoreText.string=t.toString()):(this.score=0,this.scoreText.string="0");try{const t=await GameCore.Utils.Image.loadImage(e);if(!t)return;const i=N.createWithImage(t);i.packable=!0,this.avatar.spriteFrame=i}catch{this.avatar.spriteFrame=this.defaultAvatar}}async updateScore(e){const t=e-this.score,i=C(this.node).to(.1,{},{onUpdate:(e,i)=>{if(!i)return;const n=Math.floor(t*i)+this.score;this.scoreText.string=n.toString()}});await St.runTweenAsync(i),this.scoreText.string=e.toString(),this.score=e}}).prototype,"avatar",[py],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wy=ve(by.prototype,"defaultAvatar",[my],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sy=ve(by.prototype,"scoreText",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yy=by))||yy);var Ty,Ay,Ry,Iy,Py,_y,Ly,Dy,Oy,Ny,My,ky,xy,Fy,By,Gy,zy;i._RF.pop(),i._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);const{ccclass:Uy,property:Hy}=a,{match:Vy}=globalThis.game;let qy=(Ty=Uy("Header"),Ay=Hy(h),Ry=Hy(n),Iy=Hy(n),Py=Hy(n),_y=Hy(n),Ly=Hy(Ey),Dy=Hy(Ey),Ty((My=ve((Ny=class extends s{constructor(){super(...arguments),e(this,"levelText",My,this),e(this,"settingNode",ky,this),e(this,"homeNode",xy,this),e(this,"leftNode",Fy,this),e(this,"coinNode",By,this),e(this,"playerScoreBlock",Gy,this),e(this,"opponentScoreBlock",zy,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}handleClickedPauseGame(){this.showSettingScreen(),this.node.scene.emit(Ga.GAME_PAUSE)}handleReturnHome(){Bl.openScreen(zi.QUIT_LEVEL_SCREEN),this.node.scene.emit(Ga.GAME_PAUSE)}highlightCoinContainer(){const e=P("Canvas/Screens");if(!e)return;const t=this.coinNode.worldPosition.clone();this.coinNode.parent=e,this.coinNode.worldPosition=t}removeCoinContainerHighlight(){const e=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=e}showSettingScreen(){Bl.openScreen(zi.SETTINGS_SCREEN,{})}setLevelText(e){this.levelText.string=`Level ${e}`}setButtonsSelectable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enableBtnNode(this.settingNode,e,!0),this.enableBtnNode(this.homeNode,e,!0)}showChallengeScoreBlock(){const e=Vy.getMatchState(),t=e.id,{playerId:i,opponentId:n}=e.customData;if(!t||!i||!n)return;this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0,this.playerScoreBlock.listenGameEvents();const a=e.profiles[i],s=e.profiles[n];this.playerScoreBlock.updateInfo(a.photo,a.score),this.opponentScoreBlock.updateInfo(s.photo,s.score)}hideChallengeScoreBlock(){this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1}enableBtnNode(e,t,i){const n=e.getComponent(p);if(n&&(n.interactable=t),e.active=i,i){e.getComponent(Hn)}}}).prototype,"levelText",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ky=ve(Ny.prototype,"settingNode",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xy=ve(Ny.prototype,"homeNode",[Iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fy=ve(Ny.prototype,"leftNode",[Py],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),By=ve(Ny.prototype,"coinNode",[_y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gy=ve(Ny.prototype,"playerScoreBlock",[Ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zy=ve(Ny.prototype,"opponentScoreBlock",[Dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oy=Ny))||Oy);var Wy,Ky,Yy,jy,Xy;i._RF.pop(),i._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);const{ccclass:$y,property:Qy}=a;let Jy=(Wy=$y("UIMasks"),Ky=Qy(Hn),Wy((Xy=ve((jy=class extends s{constructor(){super(...arguments),e(this,"background",Xy,this)}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.background.node.active=!0,await this.background.changeStateFade(!0,.25)}async hide(){await this.background.changeStateFade(!1,.25),this.background.node.active=!1}}).prototype,"background",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yy=jy))||Yy);i._RF.pop(),i._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);const Zy="bomb";var eb,tb,ib,nb,ab;i._RF.pop(),i._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);const{Player:sb}=GameCore.Dtos,{Function:ob}=GameCore.Utils,{ccclass:rb,property:lb}=a,{player:cb}=globalThis.game;let hb=(eb=rb("DevToolsContainer"),tb=lb(n),eb((ab=ve((nb=class extends s{constructor(){super(...arguments),e(this,"devToolsToggle",ab,this),this.isActive=!0,this.game=null,this.debouncedStarsNotification=ob.debounce((()=>{const e=cb.getGameData();e&&Bl.showNotificationScreen(`Stars added. Current stars: ${e.stars}`)}),700)}injectGameplay(e){this.game=e}hideAllButtons(){this.getComponentsInChildren(p).forEach((e=>{const{parent:t}=e.node;t&&t.name!==this.devToolsToggle.name&&(t.active=!1)}))}showAllButtons(){this.getComponentsInChildren(p).forEach((e=>{const{parent:t}=e.node;t&&t.name!==this.devToolsToggle.name&&(t.active=!0)}))}handleClickDevToolsButton(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}handleResetData(){cb.setPlayerData(sb.Data.getDefaultData()),Bl.openScreen(zi.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(Ga.START_OVER)}async handleNextLevel(){const e=(this.game?.getGameData()?.level??1)+1;this.game?.setGameData({level:e-1}),cb.setGameData({level:e}),this.node.scene.emit(Ga.NEXT_LEVEL)}async handlePrevLevel(){const e=Math.max((this.game?.getGameData()?.level??2)-1,1);this.game?.setGameData({level:e-1}),cb.setGameData({level:e}),this.node.scene.emit(Ga.NEXT_LEVEL)}async handleEnterSelectLevel(e){const t=Number(e.string);this.game?.setGameData({level:t-1}),cb.setGameData({level:t}),this.node.scene.emit(Ga.NEXT_LEVEL)}handleClickBuildVersionButton(){const e=globalThis.game.getBuildVersion();Bl.showNotificationScreen(`Build version: ${e}`)}handleClickWinLevelButton(){this.node.scene.emit(Ga.GAME_FINISH)}handleClickTimeOutButton(){this.node.scene.emit(Ga.TIME_OUT)}handleClickExplodeButton(){const e=this.game;if(!e)return;const t=e.getGameData()?.levelData?.specials.bomb;if(!t||t<=0)return;const i=e.board.getBombTiles();if(0===i.length)return void console.info("No bomb tiles found");const n=i[0];if(n.special?.type!==Zy)throw new Error("Invalid bomb tile");n.special.detonateImmediately()}handleFillItem(){this.node.scene.emit(Ga.ADD_ITEM,{animate:()=>Promise.resolve(),item:dr.HINT,quantity:2}),this.node.scene.emit(Ga.ADD_ITEM,{animate:()=>Promise.resolve(),item:dr.STORM,quantity:2}),this.node.scene.emit(Ga.ADD_ITEM,{animate:()=>Promise.resolve(),item:dr.THUNDER,quantity:2}),this.node.scene.emit(Ga.ADD_ITEM,{animate:()=>Promise.resolve(),item:dr.PLIERS,quantity:2})}handleAutoPlay(){this.node.scene.emit(Ga.AUTO_PLAY)}handleAddStars(){const e=cb.getGameData();e&&(cb.setGameData({stars:e.stars+10}),this.debouncedStarsNotification())}handleSwitchBundle(){W.emit(Jn)}}).prototype,"devToolsToggle",[tb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ib=nb))||ib);var db,ub,pb,mb,gb,yb,bb,fb,wb,Sb,vb,Cb,Eb,Tb,Ab,Rb,Ib,Pb,_b;i._RF.pop(),i._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);const{ccclass:Lb,property:Db}=a,{Utils:Ob,Match:Nb}=GameCore,{match:Mb}=globalThis.game;let kb=(db=Lb("UIManager"),ub=Db(ly),pb=Db(qy),mb=Db(hb),gb=Db(dy),yb=Db(n),bb=Db(Jy),fb=Db([n]),wb=Db([n]),db((Cb=ve((vb=class extends s{constructor(){super(...arguments),e(this,"clock",Cb,this),e(this,"header",Eb,this),e(this,"devTools",Tb,this),e(this,"comboProgressBar",Ab,this),e(this,"comboContainer",Rb,this),e(this,"uiMasks",Ib,this),e(this,"topAnimNodes",Pb,this),this.originTopNodesPos=[],e(this,"botAnimNodes",_b,this),this.originBotNodesPos=[],this.hideBotWorldY=-80,this.entranceSignal=new ai,this.exitSignal=new ai,this.showDevTools=()=>{this.devTools&&(this.devTools.node.active=!0)}}onLoad(){this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),m.once(J.EVENT_AFTER_UPDATE,(()=>{this.saveOriginPos(),this.initUIPos()}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}saveOriginPos(){this.topAnimNodes.forEach((e=>{this.originTopNodesPos.push(e.position.clone())})),this.botAnimNodes.forEach((e=>{this.originBotNodesPos.push(e.position.clone())}))}initUIPos(){this.topAnimNodes.forEach(((e,t)=>{const i=this.originTopNodesPos[t].clone();i.y+=200,e.setPosition(i)}));const e=new j(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(((t,i)=>{const n=this.originBotNodesPos[i].clone();e.y=this.hideBotWorldY;const a=t.parent?.inverseTransformPoint(e,e).y??200;n.y=a,t.setPosition(n)}))}listensDevToolsEvents(){this.node.scene.on(vr.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}listenRescueEvents(){this.node.scene.on(Ga.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(Ga.RESCUE_FINISHED,this.hideRescueAnimation,this)}initDevTools(e){window.addEventListener("reset-game-data",(()=>{this.devTools?.handleResetData()})),this.devTools&&(this.devTools.node.active=Ob.Valid.isDebugger(),this.devTools.injectGameplay(e))}setLevelText(e){this.header.setLevelText(e)}initCountdown(){this.clock.init()}setCountdownTime(e){this.clock.setTime(e)}startCountdown(){this.clock.startCountdown()}pauseTime(){this.comboProgressBar.pause(),this.clock.pause()}resumeTime(){this.comboProgressBar.resume(),this.clock.resume()}setComboUI(e){this.comboContainer.getComponent(Hn).changeStateFade(e,.1)}disableHeader(){this.header.setButtonsSelectable(!1)}enableHeader(){this.header.setButtonsSelectable()}updateStatus(){const{mode:e}=Mb.getMatchState();e===Nb.Modes.CHALLENGE_FRIEND?this.header.showChallengeScoreBlock():this.header.hideChallengeScoreBlock()}async showRescueAnimation(){await this.uiMasks.show()}async hideRescueAnimation(){await this.uiMasks.hide()}async playExitAnimUI(){this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new ai;const e=[];this.topAnimNodes.forEach(((t,i)=>{const n=new j(t.position.x,this.originTopNodesPos[i].y+200,0),a=C(t);a.to(.17,{position:n},{easing:"backIn"}),e.push(St.runTweenAsync(a,this.exitSignal))}));const t=new j(0,this.hideBotWorldY,0);this.botAnimNodes.forEach((i=>{t.y=this.hideBotWorldY;const n=i.parent?.inverseTransformPoint(t,t).y??200,a=new j(i.position.x,n,0),s=C(i);s.to(.17,{position:a},{easing:"backIn"}),e.push(St.runTweenAsync(s,this.exitSignal))})),await Promise.all(e),this.exitSignal.aborted||(this.header.node.active=!1)}async playEntranceAnimUI(){this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new ai,this.header.node.active=!0;const e=[];this.topAnimNodes.forEach(((t,i)=>{const n=new j(t.position.x,this.originTopNodesPos[i].y,0),a=C(t);a.to(.2,{position:n},{easing:"backOut"}),e.push(St.runTweenAsync(a,this.entranceSignal))})),this.botAnimNodes.forEach(((t,i)=>{const n=new j(t.position.x,this.originBotNodesPos[i].y,0),a=C(t);a.to(.2,{position:n},{easing:"backOut"}),e.push(St.runTweenAsync(a,this.entranceSignal))})),await Promise.all(e)}highlightCoinContainer(){this.header.highlightCoinContainer()}unHighlightCoinContainer(){this.header.removeCoinContainerHighlight()}setInteractableItemButtons(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.botAnimNodes.forEach((t=>{const i=t.getComponent(eg);if(i){if(!e)return void(i.button.interactable=!1);i.canActivate()&&(i.button.interactable=!0)}}))}}).prototype,"clock",[ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eb=ve(vb.prototype,"header",[pb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tb=ve(vb.prototype,"devTools",[mb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ab=ve(vb.prototype,"comboProgressBar",[gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rb=ve(vb.prototype,"comboContainer",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ib=ve(vb.prototype,"uiMasks",[bb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pb=ve(vb.prototype,"topAnimNodes",[fb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_b=ve(vb.prototype,"botAnimNodes",[wb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Sb=vb))||Sb);var xb,Fb,Bb,Gb,zb,Ub,Hb,Vb,qb;i._RF.pop(),i._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);const{player:Wb,ads:Kb,event:Yb,match:jb,storage:Xb,analytics:$b,monitorError:Qb,frameCapture:Jb,leaderboard:Zb}=globalThis.game,{Events:ef,Match:tf,Utils:nf,Configs:af}=GameCore,{Modes:sf}=tf,{Time:of,Array:rf}=nf,{Gameplay:lf}=af,{ccclass:cf,property:hf}=a;let df=[];xb=cf("Gameplay"),Fb=hf(Yh),Bb=hf(Hn),Gb=hf(Ud),xb((Hb=ve((Ub=class extends s{constructor(){super(...arguments),e(this,"board",Hb,this),e(this,"opacityToggler",Vb,this),e(this,"pathDraw",qb,this),this.gameData=null,this.defaultData={level:1,isMatchStartFromLoader:!1},this.rescueTiles=[],this.isAutoPlayEnabled=!1,this.handleOpenScreen=e=>{const{screenName:t}=e;t===Ui[zi.GET_ITEM_SCREEN]&&this.uiManager.highlightCoinContainer()},this.handleShowUI=async()=>{this.uiManager.updateStatus(),this.uiManager.disableHeader(),this.uiManager.setInteractableItemButtons(!1),await this.uiManager.playEntranceAnimUI(),this.uiManager.enableHeader(),this.uiManager.setInteractableItemButtons(!0)},this.handleHideUI=async()=>{this.uiManager.disableHeader(),this.uiManager.setInteractableItemButtons(!1),await this.uiManager.playExitAnimUI()},this.handleCloseScreen=e=>{let{screenName:t}=e;t===Ui[zi.GET_ITEM_SCREEN]&&this.uiManager.unHighlightCoinContainer()},this.handlePauseGame=()=>{this.node.scene.emit(Ga.PAUSE_TIME),this.node.pauseSystemEvents(!0),this.opacityToggler.changeStateFade(!1,.1),this.uiManager.setComboUI(!1),this.processCrazyGamesGameplayStop()},this.handleResumeGame=()=>{this.node.resumeSystemEvents(!0),this.stateManager.isPlaying()&&this.node.scene.emit(Ga.RESUME_TIME),this.processCrazyGamesGameplayStart(),this.opacityToggler.changeStateFade(!0,.1),this.uiManager.setComboUI(!0),this.guidelinesManager?.startAutoGuides()},this.handleReplayGame=async e=>{this.handleHideHint();const t={...this.defaultData,...e};try{jb.getMatchState().mode===sf.SINGLE&&await ul.finishMatchAsync(),jb.getMatchState().mode!==sf.CHALLENGE_FRIEND&&await ul.startMatchAsync()}catch(e){console.warn("handleReplayGame",e)}this.setGameData(t),this.stateManager.initialize()},this.handleFinishGame=()=>{this.attemptCallCreateShortcut(),this.guidelinesManager?.isNewbieGuideLevel()?(this.guidelinesManager.guideSkipButton.active=!1,this.handleNextLevel()):this.stateManager.finish()},this.handleNextLevel=async()=>{if(!this.gameData)return;try{jb.getMatchState().mode===sf.SINGLE&&await ul.finishMatchAsync(),jb.getMatchState().mode===sf.TOURNAMENT&&this.scoreManager.updateTournamentStartScore(),await ul.startMatchAsync()}catch(e){console.warn("handleReplayGame",e)}const e=(this.gameData.level??1)+1;this.setGameData({level:e}),this.stateManager.initialize(),console.log("Next level",this.gameData.level)},this.handleStartOver=async()=>{Wb.setGameData({level:lf.Tutorial.Enabled?0:1}),this.gameData=Wb.getGameData(),this.stateManager.initialize(),console.info("Start over",this.gameData?.level)},this.handleMaxLevel=()=>{this.gameData&&(this.initData(),Bl.openScreen(zi.CONGRATULATION_SCREEN,{level:this.gameData.level}),console.info("Max level",this.gameData.level))},this.handleExitGame=async()=>{try{Xb.setStorageData("dashboard","animateToCurrentLevel",!0),Xb.setStorageData("collection","animateMapPackUnlock",!0)}catch(e){console.warn("handleExitGame",e)}},this.handleTileClick=e=>{this.stateManager.playing(),this.board.handleTileClick(e),this.handleHideHint()},this.handleGridMatchSuccess=(e,t)=>{this.pathDraw.drawMatchPath(e,(e=>{let{x:t,y:i}=e;return this.board.getAnyTileWorldPosition(t,i)})),this.comboManager.addCombo(),this.handleAddScore(),this.effectManager.playClearFXAt([t[0].node.worldPosition,t[1].node.worldPosition])},this.handleGridMatchFail=e=>{this.guidelinesManager?.isShowErrorPathLevel()&&this.pathDraw.drawErrorPath(e,(e=>{let{x:t,y:i}=e;return this.board.getAnyTileWorldPosition(t,i)}))},this.checkIfGameIsFinish=()=>{0===this.board.getUncleared().length&&this.node.scene.emit(Ga.GAME_FINISH)},this.handlePauseTime=()=>{this.uiManager.pauseTime()},this.handleResumeTime=()=>{this.uiManager.resumeTime()},this.handleClockTimeout=()=>{this.stateManager.fail(Yl)},this.handleHalfTime=()=>{void 0!==this.guidelinesManager&&(this.board.getUncleared().length>=this.board.getCleared().length&&this.guidelinesManager.startThunderGuide()||this.board.getBombTiles().length>0&&this.guidelinesManager.startPliersGuide())},this.handleStartRescue=()=>{for(li.setBlockInput(!0),this.board.setIgnoreInput(!0);this.rescueTiles.length>0;){this.rescueTiles.pop()?.restore()}$b.levelRescue(this.gameData?.level??1)},this.handleFinishRescue=()=>{li.setBlockInput(!1),this.board.setIgnoreInput(!1)},this.handleBombExplode=async e=>{this.rescueTiles.push(e),this.board.setIgnoreInput(!0),li.getBlockInput()||(Yi.playSound(xi.BOMB_EXPLODE_1),li.setBlockInput(!0));const t=e.node.worldPosition;await this.effectManager.createBombExplosionAt(new j(t.x,t.y,0)),li.setBlockInput(!1),this.stateManager.isFail()||this.stateManager.fail(jl)},this.handleShowHint=()=>{if(this.pathDraw.isDrawingHint)return;const e=this.board.getHintPath();e&&(Yi.playSound(xi.HINT_ITEM),this.pathDraw.drawHintPath(e,(e=>this.board.getAnyTileWorldPosition(e.x,e.y))),this.board.showHint())},this.handleHideHint=()=>{this.pathDraw.isDrawingHint&&(this.pathDraw.clearHintPath(),this.board.hideHint())},this.handleAddScore=()=>{const e=this.levelManager.getLevelData().level,t=this.comboManager.getCombo();this.scoreManager.addScore(10,e,t)},this.handleUseItem=e=>{this.stateManager.playing(),e!==dr.HINT&&this.handleHideHint()},this.handleAutoPlay=()=>{this.isAutoPlayEnabled?this.disableAutoPlay():this.enableAutoPlay()},this.enableAutoPlay=()=>{this.isAutoPlayEnabled=!0;this.node.scene.once(Ga.GAME_FINISH,(()=>{this.disableAutoPlay()})),this.schedule(this.autoPlay,.5)},this.disableAutoPlay=()=>{this.isAutoPlayEnabled=!1,this.unschedule(this.autoPlay)},this.autoPlay=()=>{const e=this.board.getHintPath();if(!e)throw new Error("No path found");{const t=e[0].a,i=e.slice(-1)[0].b,n=this.board.getTileAt(t.x,t.y),a=this.board.getTileAt(i.x,i.y);if(!n||!a)throw new Error("Tile is null");n.onClick(),a.onClick()}},this.handleAddStars=e=>{const t=Wb.getGameData();if(!t)return Promise.resolve([]);Wb.setGameData({stars:t.stars+1});const{startAnimationAt:i}=e;i&&this.effectManager.playStarFXAt(i)},this.handleInviteFriends=async()=>{try{Bl.showLoadingScreen();const e=this.board.generateFenFromCurrentLevel();let{level:t=1}=Wb.getGameData()??{};t=Math.max(1,t);const{mode:i="",rules:n={addRandomTilesPerMove:0,maxSpaceOfPair:0},time:a=0}=this.gameData?.levelData??{};Jb.addWideframeRender("renderResultChallenge",Gr),await jb.context.choose.processAsync({playerId:Wb.getPlayerId(),fallbackSingleMode:!1,extraData:{level:t,fen:e,gravity:i,rules:n,time:a}}),Bl.closeLoadingScreen(),this.node.scene.emit(Ga.GAME_RESUME),this.node.scene.emit(Ga.GAME_REPLAY,{level:t})}catch(e){if(console.warn("Unable to invite friends",e),Bl.closeLoadingScreen(),Bl.showNotificationScreen("Sorry, please try again later"),!(e instanceof Error))return;Qb?.sendException(e),this.node.scene.emit(Ga.GAME_RESUME),this.node.scene.emit(Ga.SHOW_UI)}},this.handleReplayFriends=async()=>{const{level:e=1}=Wb.getGameData()??{};try{const{opponentId:t}=jb.getMatchState().customData;if(!t)throw new Error("Opponent id is not found");Bl.showLoadingScreen();const i=this.board.generateFenFromCurrentLevel(),{mode:n="",rules:a={addRandomTilesPerMove:0,maxSpaceOfPair:0},time:s=0}=this.gameData?.levelData??{};await jb.challenge.friend.processAsync({playerId:Wb.getPlayerId(),opponentId:t,extraData:{level:e,fen:i,gravity:n,rules:a,time:s}}),Bl.closeLoadingScreen(),this.node.scene.emit(Ga.GAME_RESUME),this.node.scene.emit(Ga.GAME_REPLAY,{level:e})}catch(t){if(console.warn("ReplayChallengeFriend",t),Bl.closeLoadingScreen(),Bl.showNotificationScreen("Sorry, you cannot replay\nat this time.",3),!(t instanceof Error))return;Qb?.sendException(t),this.node.scene.emit(Ga.GAME_RESUME),this.node.scene.emit(Ga.GAME_REPLAY,{level:e})}},this.handleAdShow=e=>{let{placementId:t}=e;t&&-1!==df.indexOf(t)&&(df.splice(df.indexOf(t),1),Kb.hideBannerAdAsync(t).catch((()=>{})),0===df.length&&Yb.off(GameCore.Events.AD_SHOWING,this.handleAdShow))},this.handleAddItem=async e=>{const{animate:t,item:i,quantity:n}=e,a=rf.search(this.itemManager.items,(e=>e.itemType===i));if(void 0===a)return void console.warn(`Item ${i} not found`);const s=a.getQuantity()+n;a.saveQuantity(s),this.uiManager.setInteractableItemButtons(!1),this.handlePauseGame(),await t(),a.setQuantity(s,!0),this.uiManager.setInteractableItemButtons(!0),this.handleResumeGame()}}__preload(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}onLoad(){il.init()}initComponents(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}initUIManager(){this.uiManager=this.node.parent?.getComponentInChildren(kb),this.uiManager.initDevTools(this)}initLevelManager(){this.levelManager=this.getComponent(lg)}initStateManager(){this.stateManager=this.getComponent(Vg)}initInputController(){this.inputController=this.getComponent(Ql)}initEffectManager(){this.effectManager=this.getComponent(Wu)}initItemManager(){this.itemManager=this.getComponent(ng),this.itemManager.syncItems(),this.itemManager.items.forEach((e=>{e.init(this)}))}initComboManager(){this.comboManager=this.getComponent(qd),this.comboManager.init()}initScoreManager(){this.scoreManager=this.getComponent(dg),this.scoreManager.init()}initGuidelinesManager(){lf.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(Om),this.guidelinesManager.init(this))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenCoreEvents(){df=[],Yb.off(GameCore.Events.AD_SHOWING,this.handleAdShow),Yb.clear(ef.OPENING_SCREEN),Yb.clear(ef.CLOSING_SCREEN),Yb.on(ef.OPENING_SCREEN,this.handleOpenScreen),Yb.on(ef.CLOSING_SCREEN,this.handleCloseScreen)}listenInputEvents(){this.node.scene.on(Ga.SHOW_UI,this.handleShowUI),this.node.scene.on(Ga.HIDE_UI,this.handleHideUI),this.node.scene.on(Ga.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(Ga.GAME_RESUME,this.handleResumeGame),this.node.scene.on(Ga.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(Ga.GAME_FINISH,this.handleFinishGame),this.node.scene.on(Ga.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(Ga.START_OVER,this.handleStartOver),this.node.scene.on(Ga.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(Ga.GAME_EXIT,this.handleExitGame),this.node.scene.on(Ga.TILE_CLICK,this.handleTileClick),this.node.scene.on(Ga.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(Ga.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(Ga.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(Ga.RESUME_TIME,this.handleResumeTime),this.node.scene.on(Ga.TIME_OUT,this.handleClockTimeout),this.node.scene.on(Ga.HALF_TIME,this.handleHalfTime),this.node.scene.on(Ga.RESCUE_START,this.handleStartRescue),this.node.scene.on(Ga.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(Ga.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(Ga.SHOW_HINT,this.handleShowHint),this.node.scene.on(Ga.ADD_SCORE,this.handleAddScore),this.node.scene.on(Ga.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(Ga.USE_ITEM,this.handleUseItem),this.node.scene.on(Ga.ADD_ITEM,this.handleAddItem),this.node.scene.on(Ga.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(Ga.ADD_STARS,this.handleAddStars)}listenFlowEvents(){this.node.scene.on(Ga.INVITE_FRIENDS,this.handleInviteFriends),this.node.scene.on(Ga.REPLAY_FRIENDS,this.handleReplayFriends)}start(){this.initDataFirstTime(),this.initGame(),this.trySetTournamentStorage()}initDataFirstTime(){const e=this.getSceneData();let{level:t}=e??{};void 0===t&&(t=ul.getMatchMode()===sf.TOURNAMENT?1:0),this.initData(),this.setGameData({level:t})}initData(){const{level:e=1,items:t}=Wb.getGameData()??{};t&&this.checkItemsRewardable()&&(t.hint<5&&(t.hint+=1),t.thunder<5&&(t.thunder+=1),t.storm<5&&(t.storm+=1),t.pliers<5&&(t.pliers+=1),Wb.setGameData({items:t,lastRewardedItems:Date.now()})),this.setGameData({...this.defaultData,level:e})}checkItemsRewardable(){const{lastRewardedItems:e=0}=Wb.getGameData()??{};return!of.isToday(e)}initGame(){this.stateManager.init(this),this.stateManager.initialize()}async trySetTournamentStorage(){if(ul.getMatchMode()!==sf.TOURNAMENT)return;const{leaderboardId:e}=ul.getMatchCustomData()??{};if(!e)return;await Kl.requestTournamentDataAsync();const t=Zb.getLeaderboardName(e);if(!t)return;const i=await Zb.getLeadersByPlayerIdsAsync(t,[Wb.getPlayerId()]);if(0===i.length)return;const{score:n,rank:a}=i[0];Xb.setStorageData("tournament","previousScore",n),Xb.setStorageData("tournament","previousRank",a)}setGameData(e){const t=e.level??this.gameData?.level??1;this.gameData={...this.gameData,...e,level:t}}getGameData(){return this.gameData}getSceneData(){return gl.getSceneData(this.node.scene)}attemptCallCreateShortcut(){const{level:e=0,nextLevelCount:t=0}=this.getGameData()??{};e<2||t<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((e=>{console.warn("checkAndCreateShortcutAsync",e)}))}processCrazyGamesGameplayStart(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}processCrazyGamesGameplayStop(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}disableRewardAdsItemForCrazyGames(){GameSDK.getSDKName()}}).prototype,"board",[Fb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vb=ve(Ub.prototype,"opacityToggler",[Bb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qb=ve(Ub.prototype,"pathDraw",[Gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zb=Ub));i._RF.pop(),i._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var uf=function(e){return e[e.STAR_CHEST=0]="STAR_CHEST",e[e.BALLOON=1]="BALLOON",e}(uf||{});I(uf),i._RF.pop(),i._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var pf=function(e){return e.WORLD_TAB_SELECTED="world-tab-selected",e.FRIENDS_TAB_SELECTED="friends-tab-selected",e}(pf||{});const mf="#AE4212",gf="#3D5172",yf="#92200C",bf="#8F5542",ff="#8A4733",wf="#3e7110",Sf="#3e7110";var vf;i._RF.pop(),i._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),i._RF.pop(),i._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),i._RF.pop(),i._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),i._RF.pop(),i._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);const{ccclass:Cf}=a,{player:Ef,analytics:Tf}=globalThis.game;Cf("HintItem")(vf=class extends eg{constructor(){super(...arguments),this.requestItem=()=>{Bl.openScreen(zi.GET_ITEM_SCREEN,{item:dr.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},this.loadQuantity=()=>{const e=Ef.getGameData();return e?.items&&e?e.items[dr.HINT]:0}}get itemType(){return dr.HINT}init(e){this.boardInstance=e.board,this.pathDrawer=e.pathDraw,this.setQuantity(this.loadQuantity()),super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getUncleared().length>0}catch(e){return!1}}async activate(){this.pathDrawer.isDrawingHint||(this.getQuantity()<=0?await super.activate():(await super.activate(),Tf.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:dr.HINT}),this.node.scene.emit(Ga.USE_ITEM,dr.HINT),this.node.scene.emit(Ga.SHOW_HINT)))}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=Ef.getGameData();i&&Ef.setGameData({items:{...i.items,[dr.HINT]:e}})}});var Af;i._RF.pop(),i._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);const{ccclass:Rf}=a,{player:If,analytics:Pf}=globalThis.game;Rf("PliersItem")(Af=class extends eg{constructor(){super(...arguments),this.requestItem=()=>{Bl.openScreen(zi.GET_ITEM_SCREEN,{item:dr.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},this.loadQuantity=()=>{const e=If.getGameData();return e?.items&&e?e.items[dr.PLIERS]:0}}get itemType(){return dr.PLIERS}init(e){this.boardInstance=e.board,this.effectManager=e.effectManager,super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getBombTiles().length>0}catch(e){return!1}}async activate(){if(this.getQuantity()<=0)return void await super.activate();await super.activate(),Pf.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:dr.PLIERS}),this.node.scene.emit(Ga.USE_ITEM,dr.PLIERS);const e=Wc(this.boardInstance.getBombTiles()),t=e.node.worldPosition;this.effectManager.createDefuseExplosionAt(new j(t.x,t.y,0)),Yi.playSound(xi.BOMB_DEFUSE),e.special.switch(rc.none),this.applyActivationStatus()}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=If.getGameData();i&&If.setGameData({items:{...i.items,[dr.PLIERS]:e}})}});var _f;i._RF.pop(),i._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);const{ccclass:Lf}=a,{player:Df,analytics:Of}=globalThis.game;Lf("StormItem")(_f=class extends eg{constructor(){super(...arguments),this.requestItem=()=>{Bl.openScreen(zi.GET_ITEM_SCREEN,{item:dr.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},this.loadQuantity=()=>{const e=Df.getGameData();return e?.items&&e?e.items[dr.STORM]:0}}get itemType(){return dr.STORM}init(e){this.boardInstance=e.board,this.effectManager=e.effectManager,super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getUncleared().length>2}catch(e){return!1}}async activate(){if(this.getQuantity()<=0)return void await super.activate();await super.activate(),Of.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:dr.STORM}),this.node.scene.emit(Ga.USE_ITEM,dr.STORM),this.node.scene.emit(Ga.HIDE_UI);const e=new Promise((e=>this.scheduleOnce(e,.5)));await Promise.race([this.effectManager.loadTornadoAnimation(),e]);this.boardInstance.processShuffleRequest((async(e,t)=>{Yi.muteMusic(!0),Yi.playSound(xi.SHUFFLE_ITEM),Yi.playSound(xi.WIND);await(()=>Promise.all(e.map(((t,i,n)=>t.sync({duration:.4,easing:"smooth",getTargetPosition:()=>Fc(e,this.boardInstance.getTileSize(),{x:i,y:n},10)})))))(),this.effectManager.playTornadoAnimation(),await(async()=>{t.forEach(((e,i,n)=>{e.node.setSiblingIndex(t.asArray().length-1-(i+n*t.width))})),await Promise.all(t.map((e=>e.fly({getTilePosition:e=>Fc(t,this.boardInstance.getTileSize(),e)}))))})(),this.node.scene.emit(Ga.SHOW_UI),Yi.muteMusic(!1)}))}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=Df.getGameData();i&&Df.setGameData({items:{...i.items,[dr.STORM]:e}})}});var Nf;i._RF.pop(),i._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);const{ccclass:Mf}=a,{player:kf,analytics:xf}=globalThis.game;Mf("ThunderItem")(Nf=class extends eg{constructor(){super(...arguments),this.requestItem=()=>{Bl.openScreen(zi.GET_ITEM_SCREEN,{item:dr.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},this.loadQuantity=()=>{const e=kf.getGameData();return e?.items&&e?e.items[dr.THUNDER]:0}}get itemType(){return dr.THUNDER}init(e){this.boardInstance=e.board,this.effectManager=e.effectManager,super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getUncleared().length>=4}catch(e){return!1}}async activate(){if(this.getQuantity()<=0)return void await super.activate();await super.activate(),xf.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:dr.THUNDER}),this.node.scene.emit(Ga.USE_ITEM,dr.THUNDER),this.node.scene.emit(Ga.HIDE_UI),await this.effectManager.loadThunderAnimation(),Yi.muteMusic(!0);const e=this.boardInstance.getUncleared();if(e.length<4)throw new Error("Not enough uncleared tiles");const t=this.boardInstance.getPairs(2);li.setBlockInput(!0),this.boardInstance.clearSelectedTile(),await this.effectManager.playThunderAnimation(t,this.boardInstance),e.length>4&&this.node.scene.emit(Ga.SHOW_UI),Yi.muteMusic(!1),li.setBlockInput(!1)}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=kf.getGameData();i&&kf.setGameData({items:{...i.items,[dr.THUNDER]:e}})}});var Ff;i._RF.pop(),i._RF.push({},"0a97aK0agJOHb07cLs0JICj","PathHolder",void 0);const{ccclass:Bf,requireComponent:Gf}=a;Bf("PathHolder")(Ff=Gf(x)(Ff=class extends s{onLoad(){this.node.scene.on(Ga.GRID_RESIZE,(e=>{this.node.setScale(e,e)}))}})||Ff);var zf,Uf,Hf,Vf,qf,Wf,Kf,Yf,jf,Xf,$f,Qf,Jf;i._RF.pop(),i._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);const{ccclass:Zf,property:ew}=a;let tw=(zf=Zf("Coin"),Uf=ew(se),Hf=ew(se),Vf=ew(y),qf=ew(D),Wf=ew(D),zf((jf=ve((Yf=class extends s{constructor(){super(...arguments),e(this,"explodeParticles",jf,this),e(this,"emittingParticles",Xf,this),e(this,"animation",$f,this),e(this,"spin",Qf,this),e(this,"rest",Jf,this)}__preload(){Fe.lazyValidateProperties(this)}playAnimation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;e>0&&this.scheduleOnce((()=>{t?.aborted||this.animation.play(this.spin.name)}),e),this.animation.play(this.spin.name)}stopAnimation(){this.animation.play(this.rest.name)}}).prototype,"explodeParticles",[Uf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xf=ve(Yf.prototype,"emittingParticles",[Hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$f=ve(Yf.prototype,"animation",[Vf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qf=ve(Yf.prototype,"spin",[qf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jf=ve(Yf.prototype,"rest",[Wf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kf=Yf))||Kf);var iw,nw,aw,sw,ow,rw,lw;i._RF.pop(),i._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);const{ccclass:cw,property:hw}=a,dw=j.ZERO.clone().add3f(0,-100,0),uw=j.ZERO.clone().add3f(0,100,0);let pw=(iw=cw("CoinTextPopup"),nw=hw(h),aw=hw(x),iw((rw=ve((ow=class extends s{constructor(){super(...arguments),e(this,"label",rw,this),e(this,"uiOpacity",lw,this)}__preload(){Fe.lazyValidateProperties(this),this.node.active=!1}async show(e,t){const i=GameCore.Utils.Number.getShortNumber(e,3);this.label.string=i,this.node.active=!0,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(dw),await Promise.all([St.runTweenAsync(C(this.node).to(1.5,{position:uw},{easing:"sineOut"}),t),St.runTweenAsync(C(this.node).to(.5,{scale:j.ONE},{easing:"backOut"}),t)]),this.node.setScale(j.ONE),this.node.setPosition(uw),
//! not subscribed to signal because in the case the user skipped the animation we'd still want them to see this node disappear
await St.runTweenAsync(C(this.uiOpacity).to(.5,{opacity:0})),this.node.active=!1}}).prototype,"label",[nw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lw=ve(ow.prototype,"uiOpacity",[aw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sw=ow))||sw);var mw,gw,yw,bw,fw,ww,Sw,vw,Cw;i._RF.pop(),i._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);const{ccclass:Ew,disallowMultiple:Tw,property:Aw}=a,{player:Rw,monitorError:Iw}=globalThis.game,Pw=999999999,_w={MAX_COIN_COUNT:10,DISTANCE_RANGE:[1e3,1500],STAGGER:.03,FLOAT_DURATION:1,FLY_DURATION:1};let Lw=(mw=Ew("CoinManager"),gw=Aw(_),yw=Aw(_),bw=Aw(n),mw(fw=Tw((Sw=ve((ww=class extends s{constructor(){super(...arguments),this.coins=0,e(this,"coinPrefab",Sw,this),e(this,"coinTextPopup",vw,this),e(this,"coinAnimContainer",Cw,this),this.collectionAnimSignal=null,this.coinObjects=[]}__preload(){this.lifeCycleSignal=new ai,this.validateRequiredComponents(),this.getCoinsFromPlayerData()}onLoad(){this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}start(){this.emitCoinAmount()}init(e){this.updateCoins({coins:this.coins,collectionAnimation:void 0}),this.animSkipOverlay=e}listenToCoinEvents(){this.node.scene.on(Ga.ADD_COINS,this.addCoins,this),this.node.scene.on(Ga.REMOVE_COINS,this.removeCoins,this)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}prepareCoinCollection(){for(let e=0;e<_w.MAX_COIN_COUNT;e++){const e=c(this.coinPrefab);e.setParent(this.coinAnimContainer),e.setPosition(0,0),e.active=!1,this.coinObjects.push(e.getComponent(tw))}}prepareCoinTextPopup(){const e=c(this.coinTextPopup);e.setParent(this.node),e.active=!1,this.coinTextPopupNode=e.getComponent(pw)}async handleCollectionAnim(e,t,i){if(!this.targetContainer)return void console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played");const n=this.coinObjects.slice(0,this.getShortAmount(e));if(0===n.length)return console.warn(`Requested coins amount is ${e}. Shortened to ${this.getShortAmount(e)}. No coin objects was found to animate collection.`),void Iw?.sendException(new Error(`Requested coins amount is ${e}. Shortened to ${this.getShortAmount(e)}. No coin objects was found to animate collection.`),{coins:e,animatedCoins:n.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!this.targetContainer,coinCollectionCount:this.coinObjects.length});await(this.animSkipOverlay?.open({onSkip:()=>this.collectionAnimSignal.abort(),opacity:150})),Yi.playSound(xi.COLLECT_STOCK_COINS);const a=n.map((async e=>{e.explodeParticles.stopSystem(),e.emittingParticles.stopSystem(),e.node.active=!0;const n=[0,.5*Math.min(t,i)],a=ne(...n),s=t-a,o=i+a;await this.animateCoinExplode(e.node,s),e.playAnimation(2*a,this.collectionAnimSignal),e.emittingParticles.resetSystem(),await this.animateCoinFlyBack(this.collectionAnimSignal,e,o),e.emittingParticles.stopSystem(),e.stopAnimation()}));await Promise.all([(async()=>{await Promise.all(a),await(this.targetContainer?.emitExplodeEffect(this.collectionAnimSignal))})(),this.animateCoinTextPopup(e,this.collectionAnimSignal,t+i/2)]),await(this.animSkipOverlay?.close()),this.collectionAnimSignal.abort()}async animateCoinTextPopup(e,t,i){await St.waitTweenAsync(i,t),await this.coinTextPopupNode.show(e,t)}async animateCoinFlyBack(e,t,i){const n=t.node.worldPosition.clone(),a=j.ZERO.clone(),s=this.targetContainer.getCoinIconWorldScale();await St.runTweenAsync(C(t.node).to(i,{scale:s},{onUpdate:(e,i)=>{if(void 0===i)return;const s=k.cubicIn(i),o=this.targetContainer.getCoinIconWorldPosition();t.node.worldPosition=j.lerp(a,n,o,s)}}),e),t.node.scale=j.ZERO,this.explodeParticlesAndDisableAfter(1,t)}async explodeParticlesAndDisableAfter(e,t){const i=t.explodeParticles;i.resetSystem(),await St.waitTweenAsync(e/10,this.lifeCycleSignal),ai.hasBeenAborted(this.lifeCycleSignal)||(i.stopSystem(),await St.waitTweenAsync(e/10*9,this.lifeCycleSignal),ai.hasBeenAborted(this.lifeCycleSignal)||(t.node.setPosition(0,0,t.node.position.z),t.node.active=!1))}async animateCoinExplode(e,t){const i=[-200,200],n=[-200,200],a=ne(i[0],i[1]),s=ne(n[0],n[1]);e.setPosition(0,0,e.position.z),e.setScale(j.ZERO);const o=new j(a,s,e.position.z);await Promise.all([St.runTweenAsync(C(e).delay(.1*t).to(.8*t,{scale:j.ONE},{easing:"elasticOut"}),this.collectionAnimSignal),St.runTweenAsync(C(e).to(t,{position:o},{easing:"circOut"}),this.collectionAnimSignal)])}getCoinsFromPlayerData(){const e=Rw.getGameData();this.coins=e?e.coins:0}getCoins(){return this.coins}updateCoins(e){if(console.info("updateCoins",e.coins,e.collectionAnimation?.animateTextOnly),this.coins>Pw&&(this.coins=Pw),e.coins===this.coins)return;const t=Math.max(0,e.coins-this.coins);this.coins=e.coins,Rw.setGameData({coins:this.coins});const{collectionAnimation:i}=e;if(void 0===i||i.animateTextOnly)return void this.node.scene.emit(Ga.COIN_CHANGED,{...e,collectionAnimation:{animateTextOnly:!0,signal:this.collectionAnimSignal}});this.collectionAnimSignal?.abort();const{floatDuration:n=_w.FLOAT_DURATION,flyDuration:a=_w.FLY_DURATION,signal:s=new ai,target:o=this.targetContainer}=i;this.collectionAnimSignal=s,this.targetContainer=o;const r={...e,collectionAnimation:{floatDuration:n,flyDuration:a,animateTextOnly:!1,signal:s,target:o}};this.node.scene.emit(Ga.COIN_CHANGED,r),this.handleCollectionAnim(t,n,a)}addCoins(e){this.updateCoins({...e,coins:this.coins+e.coins})}removeCoins(e){this.coins<e.coins?this.node.scene.emit(Ga.REMOVE_COINS_FAILED):(this.updateCoins({...e,coins:this.coins-e.coins}),this.node.scene.emit(Ga.REMOVE_COINS_SUCCESS))}emitCoinAmount(){this.node.scene.emit(Ga.COIN_CHANGED,{coins:this.coins})}getShortAmount(e){return Math.min(e,_w.MAX_COIN_COUNT)}untilFinishesCollectAnim(){return null===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}setTargetContainer(e){this.targetContainer=e}getTargetContainer(){return this.targetContainer}onDestroy(){this.collectionAnimSignal?.abort(),this.lifeCycleSignal?.abort()}}).prototype,"coinPrefab",[gw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vw=ve(ww.prototype,"coinTextPopup",[yw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cw=ve(ww.prototype,"coinAnimContainer",[bw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fw=ww))||fw)||fw);i._RF.pop(),i._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),i._RF.pop(),i._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),i._RF.pop(),i._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),i._RF.pop(),i._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),i._RF.pop(),i._RF.push({},"f3b1eQ+t3FJYa35I0oznLiF","ParticleProperties",void 0);class Dw{constructor(){this.lifeCurrent=0,this.life=0,this.velocityX=0,this.velocityY=0,this.alpha=255,this.totalRotation=0,this.lastChange=0,this.currentFrame=0}}var Ow,Nw,Mw,kw,xw;i._RF.pop(),i._RF.push({},"32b8eGxcghFHZOi1WYXHCjF","BaseParticle",void 0);const{ccclass:Fw,property:Bw}=a;let Gw=(Ow=Fw("BaseParticle"),Nw=Bw(R),Ow((xw=ve((kw=class extends s{constructor(){super(...arguments),e(this,"sprite",xw,this),this.properties=new Dw}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.sprite)throw new Error("BaseParticle: Sprite not found")}manualInit(e,t){this.manager=e;const{tint:i,velocityX:n,velocityY:a,totalRotation:s,lifespan:r,startAngle:l,scale:c}=t;this.properties.lastChange=0;const h=new o;o.fromHEX(h,i),this.sprite.color=h,this.properties.velocityX=n,this.properties.velocityY=a,this.properties.life=r,this.properties.lifeCurrent=r,this.properties.totalRotation=s,this.node.angle=l,this.node.setScale(c,c,1)}manualUpdate(e){return this.computeVelocity(e),this.node.setPosition(this.node.position.x+this.properties.velocityX*e,this.node.position.y+this.properties.velocityY*e,0),this.node.angle+=this.properties.totalRotation*e/this.properties.life,this.properties.lifeCurrent-=e,this.properties.lifeCurrent<=0}computeVelocity(e){const{velocityX:t,velocityY:i}=this.properties,n=t;let a=i;a+=this.manager.getGravityY()*e,this.properties.velocityX=n,this.properties.velocityY=a}}).prototype,"sprite",[Nw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mw=kw))||Mw);var zw,Uw,Hw,Vw,qw,Ww,Kw;i._RF.pop(),i._RF.push({},"b6123+a2K1LoY60oZO9SYKX","StarConfetti",void 0);const{ccclass:Yw,property:jw}=a;let Xw=(zw=Yw("StarConfetti"),Uw=jw([N]),Hw=jw([N]),zw((Ww=ve((qw=class extends Gw{constructor(){super(...arguments),e(this,"starXFrames",Ww,this),e(this,"starYFrames",Kw,this),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}manualInit(e,t){super.manualInit(e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}manualUpdate(e){const t=super.manualUpdate(e);return this.updateGravity(),this.updateVelocity(),this.updateFrameRate(),this.updateFrames(e),t}updateGravity(){if(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)return;this.isGravityChanged=!0;this.properties.velocityX/=3,this.manager.setGravityY(-23745/667)}updateVelocity(){if(this.properties.lifeCurrent>this.properties.life-2)return;this.properties.velocityX>0?this.properties.velocityX+=G.randomRangeInt(-12,6):this.properties.velocityX+=G.randomRangeInt(-6,12)}updateFrames(e){if(this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame){this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=4&&(this.isYoyo=!0,this.properties.currentFrame-=1);const e=Math.random()>.5?this.starXFrames:this.starYFrames;this.sprite.spriteFrame=e[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame}}updateFrameRate(){this.properties.lifeCurrent<this.properties.life-2?this.msPerFrame=.15:this.msPerFrame=G.randomRangeInt(300,600)/1e3}}).prototype,"starXFrames",[Uw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Kw=ve(qw.prototype,"starYFrames",[Hw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vw=qw))||Vw);i._RF.pop(),i._RF.push({},"9caadUsaKtPEoOe+T2+pqtd","Properties",void 0);class $w{constructor(){this.delay=200,this.timeScale=2,this.tints=["#F1D171","#97E1FD","#7765D1","#ED4440","#F9E02A"],this.speedX={min:1583/75,max:1583*.24},this.speedY={min:1139.76,max:1219.76},this.gravityY=-664.86,this.lifespan={min:5,max:8},this.rotate={totalRotation:1080,random:!0},this.scale={min:.6,max:1},this.originGravityY=-664.86}}var Qw;i._RF.pop(),i._RF.push({},"d1648PsavVBn7B059PS5fj6","BaseEmitter",void 0);const{ccclass:Jw}=a;let Zw=Jw("BaseEmitter")(Qw=class extends s{constructor(){super(...arguments),this.properties=new $w}getGravityY(){return this.properties.gravityY}setGravityY(e){this.properties.gravityY=e}})||Qw;var eS;i._RF.pop(),i._RF.push({},"654983p4rREVKci1CE8cSJ2","ConfettiEmitter",void 0);const{ccclass:tS}=a;let iS=tS("ConfettiEmitter")(eS=class extends Zw{constructor(){super(...arguments),this.activeStarConfetti=[]}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async createConfettiPool(){this.starConfettiPrefab=await li.loadPrefabAsync("particles/StarConfetti"),this.starConfettiPool=new Qh((()=>{const e=c(this.starConfettiPrefab);return this.node.addChild(e),e.active=!1,e}),0,(e=>{const t=e.getComponent(Xw);t?(this.activeStarConfetti.push(t),e.active=!0):console.error("StarConfetti not found")}),(e=>{e.getComponent(Xw)?e.active=!1:console.error("StarConfetti not found")}),(e=>{e.isValid&&e.destroy()})),this.properties.timeScale=1.5,this.properties.gravityY=688.605,this.properties.lifespan.min=4,this.properties.lifespan.max=6,this.properties.rotate.totalRotation=1800}async runEffect(e,t,i){this.starConfettiPool||await this.createConfettiPool(),this.properties.gravityY=this.properties.originGravityY;for(let n=0;n<e;n++){const e=this.starConfettiPool.alloc(),n=e.getComponent(Xw);if(!n)return void console.error("StarConfetti not found");e.setPosition(t.clone());const a=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],s=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),o=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,r=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,l=this.properties.rotate.random?180*Math.random():0,c=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,h={tint:a,velocityX:s,velocityY:o,lifespan:r,totalRotation:this.properties.rotate.totalRotation,startAngle:l,scale:c};n.manualInit(this,h);const d=this.starConfettiPool.alloc(),u=d.getComponent(Xw);if(!u)return void console.error("StarConfetti not found");d.setPosition(i.clone()),h.velocityX=-s,u.manualInit(this,h)}}clearEffect(){for(const e of this.activeStarConfetti)this.starConfettiPool.free(e.node);this.activeStarConfetti=[]}update(e){const t=e*this.properties.timeScale,i=[];this.activeStarConfetti.forEach((e=>{e.manualUpdate(t)&&i.push(e)})),i.forEach((e=>{this.starConfettiPool.free(e.node),this.activeStarConfetti.splice(this.activeStarConfetti.indexOf(e),1)}))}})||eS;var nS,aS,sS,oS,rS,lS,cS,hS,dS,uS,pS;i._RF.pop(),i._RF.push({},"78c97IkjeJFQohPZudvcfeS","Ribbon",void 0);const{ccclass:mS,property:gS}=a;let yS=(nS=mS("Ribbon"),aS=gS([N]),sS=gS([N]),oS=gS([N]),rS=gS([N]),nS((hS=ve((cS=class extends Gw{constructor(){super(...arguments),e(this,"ribbonA",hS,this),e(this,"ribbonB",dS,this),e(this,"ribbonC",uS,this),e(this,"ribbonD",pS,this),this.useFrames=[],this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=[]}manualInit(e,t){super.manualInit(e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=new Array(10).fill(null).map((()=>({x:0,y:0})));const i=Math.random();this.useFrames=i<.25?this.ribbonA:i<.5?this.ribbonB:i<.75?this.ribbonC:this.ribbonD,this.sprite.enabled=!1}manualUpdate(e){const t=super.manualUpdate(e);return this.updateFrames(e),this.updatePoints(),this.updateGravity(),this.updateVelocity(),t}updateFrames(e){this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame&&(this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=this.useFrames.length&&(this.isYoyo=!0,this.properties.currentFrame-=1),this.sprite.spriteFrame=this.useFrames[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame)}updatePoints(){if(this.isGravityChanged)return;this.points.shift();const{x:e,y:t}=this.node.worldPosition;this.points.push({x:e,y:t})}updateGravity(){if(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)return;this.isGravityChanged=!0,this.points=[],this.sprite.enabled=!0,this.properties.velocityX/=3;this.manager.setGravityY(-23745/667)}updateVelocity(){if(this.isGravityChanged)return;this.properties.lifeCurrent>this.properties.life-1.8?this.properties.velocityX+=G.randomRangeInt(-24,24):this.properties.velocityX>0?this.properties.velocityX+=G.randomRangeInt(-20,12):this.properties.velocityX+=G.randomRangeInt(-12,20)}getGlobalPoints(){return this.points}getColor(){return this.sprite.color}}).prototype,"ribbonA",[aS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dS=ve(cS.prototype,"ribbonB",[sS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),uS=ve(cS.prototype,"ribbonC",[oS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pS=ve(cS.prototype,"ribbonD",[rS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lS=cS))||lS);var bS,fS,wS,SS,vS;i._RF.pop(),i._RF.push({},"f2427J2HhBKdpkcqDn2Vv5H","RibbonEmitter",void 0);const{ccclass:CS,property:ES}=a;let TS=(bS=CS("RibbonEmitter"),fS=ES(q),bS((vS=ve((SS=class extends Zw{constructor(){super(...arguments),e(this,"graphics",vS,this),this.activeRibbonConfetti=[]}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async createConfettiPool(){this.ribbonPrefab=await li.loadPrefabAsync("particles/Ribbon"),this.ribbonConfettiPool=new Qh((()=>{const e=c(this.ribbonPrefab);return this.node.addChild(e),e.active=!1,e}),0,(e=>{const t=e.getComponent(yS);t?(this.activeRibbonConfetti.push(t),e.active=!0):console.error("StarConfetti not found")}),(e=>{e.getComponent(yS)?e.active=!1:console.error("StarConfetti not found")}),(e=>{e.destroy()}))}async runEffect(e,t,i){this.ribbonConfettiPool||await this.createConfettiPool(),this.properties.gravityY=this.properties.originGravityY;for(let n=0;n<e;n++){const e=this.ribbonConfettiPool.alloc(),n=e.getComponent(yS);if(!n)return void console.error("StarConfetti not found");e.setPosition(t.clone());const a=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],s=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),o=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,r=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,l=this.properties.rotate.random?180*Math.random():0,c=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,h={tint:a,velocityX:s,velocityY:o,lifespan:r,totalRotation:this.properties.rotate.totalRotation,startAngle:l,scale:c};n.manualInit(this,h);const d=this.ribbonConfettiPool.alloc(),u=d.getComponent(yS);if(!u)return void console.error("StarConfetti not found");d.setPosition(i.clone()),h.velocityX=-s,u.manualInit(this,h)}}clearEffect(){for(const e of this.activeRibbonConfetti)this.ribbonConfettiPool.free(e.node);this.activeRibbonConfetti=[]}update(e){const t=e*this.properties.timeScale;this.graphics.clear();const i=[];this.activeRibbonConfetti.forEach((e=>{e.manualUpdate(t)&&i.push(e),this.drawGraphics(e.getGlobalPoints(),e.getColor())})),i.forEach((e=>{this.ribbonConfettiPool.free(e.node),this.activeRibbonConfetti.splice(this.activeRibbonConfetti.indexOf(e),1)}))}drawGraphics(e,t){if(!this.graphics.node.active)return;for(const t of e)if(0===t.y)return;if(e.length<2)return;this.graphics.strokeColor=t;let i=new j(e[0].x,e[0].y,0);i=this.node.inverseTransformPoint(i,i),this.graphics.moveTo(i.x,i.y);for(let t=1;t<e.length;t++)i.x=e[t].x,i.y=e[t].y,i=this.node.inverseTransformPoint(i,i),this.graphics.lineTo(i.x,i.y);this.graphics.stroke()}}).prototype,"graphics",[fS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wS=SS))||wS);var AS,RS,IS,PS,_S,LS,DS;i._RF.pop(),i._RF.push({},"f7cfcFAL8tBE70g2A0+qMTR","PaperConfetti",void 0);const{ccclass:OS,property:NS}=a;let MS=(AS=OS("PaperConfetti"),RS=NS(iS),IS=NS(TS),AS((LS=ve((_S=class extends s{constructor(){super(...arguments),this.spawnLeftPos=new j(-375,-791.5,0),this.spawnRightPos=new j(375,-791.5,0),e(this,"confettiEmitter",LS,this),e(this,"ribbonEmitter",DS,this)}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.confettiEmitter)throw new Error("PaperConfetti: ConfettiEmitter not found");if(!this.ribbonEmitter)throw new Error("PaperConfetti: RibbonEmitter not found")}runEffect(){this.scheduleOnce((()=>{this.confettiEmitter.runEffect(25,this.spawnLeftPos,this.spawnRightPos)}),.2),this.ribbonEmitter.runEffect(20,this.spawnLeftPos,this.spawnRightPos)}clearEffect(){this.unscheduleAllCallbacks(),this.confettiEmitter.clearEffect(),this.ribbonEmitter.clearEffect()}}).prototype,"confettiEmitter",[RS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DS=ve(_S.prototype,"ribbonEmitter",[IS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PS=_S))||PS);var kS;i._RF.pop(),i._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);const{ccclass:xS,disallowMultiple:FS}=a,{Events:BS,Configs:GS,Utils:zS}=GameCore,{Time:US,Valid:HS}=zS,{ads:VS,player:qS,event:WS}=globalThis.game;xS("BootScene")(kS=FS(kS=class extends s{constructor(){super(...arguments),this.processWhenGameSdkStarted=()=>{this.setupGameData()},this.processPreloadAssets=()=>{this.loadCurrentPlayerTheme().catch((e=>console.error("loadCurrentPlayerTheme",e)))},this.handleShowAdWhenLoadGame=async()=>{const{Enabled:e,ShowAdOnLoad:t}=GS.Ads;if(!e)return;const{Enabled:i,DelaySeconds:n,PlacementId:a}=t;if(i)try{n>0&&await US.sleepAsync(1e3*n);const e=VS.getAdByPlacementId(a);if(!e)return;await this.showAdWhenLoadGame(e)}catch(e){console.warn("handleShowAdWhenLoadGame failed",e)}finally{bg.preloadAds()}},this.handlePauseAudio=()=>{WS.on(BS.VISIBILITY_HIDDEN,this.handleMuteAudio),WS.on(BS.VISIBILITY_VISIBLE,this.handleUnMuteAudio),WS.on(BS.VISIBILITY_VISIBLE,this.handleForceEngineRunning)},this.handleMuteAudio=()=>{Yi.muteAudio(!0)},this.handleUnMuteAudio=()=>{VS.isAdFullSizeShowing()||Yi.muteAudio(!1)},this.handleForceEngineRunning=()=>{m.resume()}}__preload(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.validateRequiredComponents(),this.listenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onLoad(){this.handlePauseAudio(),this.processPreloadAssets(),GS.Core.StartSDKAfterLoadGame||Bl.showLoadingFullScreen(_r)}start(){this.processCrazyGamesLoadingStop()}listenEvents(){WS.once(BS.GAME_SDK_STARTED,this.processWhenGameSdkStarted),WS.once(BS.GAME_READY,this.handleShowAdWhenLoadGame)}setupGameData(){const e=qS.getGameData();if(!e)return;const{totalLevel:t}=e,i={...e,totalLevel:0===t?80:t};qS.setGameData(i)}loadCurrentPlayerTheme(){const e=Wr.mapOrder;let t=e[0];const i=qS.getGameData();console.log("loadCurrentPlayerTheme",i);let n=i?.level;if(!HS.isNumber(n))return li.loadThemeAsync(t.theme);for(const i of e)if(n-=i.levelCount,n<=0){t=i;break}return li.loadThemeAsync(t.theme)}async showAdWhenLoadGame(e){try{const{type:t,placementId:i}=e;await VS.loadAdAsync(t,i),Yi.muteAudio(!0),await VS.showAdAsync(t,i)}catch(e){console.warn("showAdWhenLoadGame failed",e)}finally{Yi.muteAudio(!1)}}processCrazyGamesLoadingStart(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}processCrazyGamesLoadingStop(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}setupAndroidPlatformAds(){}})||kS);var KS,YS,jS,XS,$S,QS,JS,ZS,ev,tv,iv;i._RF.pop(),i._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);const{ccclass:nv,property:av}=a;let sv=(KS=nv("RigidBodyObject"),YS=av(E),jS=av(Q),XS=av(E),$S=av(H),KS((ZS=ve((JS=class extends s{constructor(){super(...arguments),e(this,"gravityScale",ZS,this),e(this,"linearVelocity",ev,this),e(this,"bounce",tv,this),e(this,"simulate",iv,this)}onLoad(){this.canvas=this.node.scene.getComponentInChildren(r).getComponent(l),this.uiTransform=this.node.getComponent(l)}update(e){if(!this.simulate)return;this.applyGravity();let t=this.node.worldPosition.clone();t.add(new j(this.linearVelocity.x*e,this.linearVelocity.y*e,0)),t=this.applyBounce(t),this.node.setWorldPosition(t)}applyForce(e){this.linearVelocity.add(e)}applyGravity(){const e=new Q(0,-9.8*this.gravityScale);this.applyForce(e)}applyBounce(e){const t=this.uiTransform.getBoundingBoxToWorld();t.yMin<0&&(e.y=t.height/2,this.linearVelocity.y*=-this.bounce),t.xMin<0&&(e.x=t.width/2,this.linearVelocity.x*=-1);const i=this.canvas.width;return t.xMax>i&&(e.x=i-t.width/2,this.linearVelocity.x*=-1),e}}).prototype,"gravityScale",[YS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ev=ve(JS.prototype,"linearVelocity",[jS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Q(0,0)}}),tv=ve(JS.prototype,"bounce",[XS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv=ve(JS.prototype,"simulate",[$S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QS=JS))||QS);var ov,rv,lv,cv,hv,dv,uv,pv,mv;i._RF.pop(),i._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);const{ccclass:gv,property:yv,disallowMultiple:bv}=a,fv=()=>{};let wv=(ov=gv("AnimSkipOverlay"),rv=yv(x),lv=yv(x),cv=yv(p),ov(hv=bv((uv=ve((dv=class extends s{constructor(){super(...arguments),e(this,"containerUIOpacity",uv,this),e(this,"maskUIOpacity",pv,this),e(this,"skipButton",mv,this),this.isOpened=!1,this.currentCallback=fv}__preload(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}onSkipButtonPress(){this.currentCallback(),this.close()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async open(e){this.containerUIOpacity.node.active=!0;const{onSkip:t,opacity:i=255,transitionDuration:n=.2}=e;this.maskUIOpacity.opacity=i,await this.animateUIOpacity(0,255,n),this.currentCallback=t,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(jn,e)}async close(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.skipButton.interactable=!1,this.currentCallback=fv,await this.animateUIOpacity(255,0,e),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(Xn)}animateUIOpacity(e,t,i){return this.containerUIOpacity.opacity=e,St.runTweenAsync(C(this.containerUIOpacity).to(i,{opacity:t}))}untilClosed(){return!1===this.isOpened?Promise.resolve():new Promise((e=>{this.node.scene.once(Xn,e)}))}}).prototype,"containerUIOpacity",[rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pv=ve(dv.prototype,"maskUIOpacity",[lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mv=ve(dv.prototype,"skipButton",[cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hv=dv))||hv)||hv);var Sv,vv,Cv,Ev,Tv,Av,Rv,Iv,Pv;i._RF.pop(),i._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);const{ccclass:_v,property:Lv}=a,{getShortNumber:Dv}=GameCore.Utils.Number;let Ov=(Sv=_v("CoinContainer"),vv=Lv(h),Cv=Lv(R),Ev=Lv(x),Sv((Rv=ve((Av=class extends s{constructor(){super(...arguments),e(this,"coinLabel",Rv,this),e(this,"coinIcon",Iv,this),e(this,"explosionCircle",Pv,this),this.currentCoin=0}setCoinText(e){this.coinLabel.string=e}handleAddCoinButton(){Bl.openScreen(zi.GET_COIN_SCREEN,{quantity:br})}onLoad(){this.validateRequiredComponents(),this.listenToEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenToEvents(){this.node.scene.on(Ga.COIN_CHANGED,this.updateCoins,this)}async updateCoins(e){const{coins:t,collectionAnimation:i}=e;if(void 0===i||!1===this.node.activeInHierarchy)return void this.setCoins(t);const{signal:n}=i;if(this.animAbortSignal?.abort(),this.animAbortSignal=n??new ai,i.animateTextOnly)return await this.animateCoinText(t,0,n),void this.setCoins(t);const a=i.flyDuration,s=i.floatDuration+a;await this.animateCoinText(t,s,n),this.setCoins(t)}setCoins(e){this.setCoinText(Dv(e,3)),this.currentCoin=e}async animateCoinText(e,t,i){const n=this.currentCoin;await St.waitTweenAsync(t,i),Yi.playSound(xi.COLLECT_COINS),await St.runTweenAsync(C({}).to(1,{},{easing:"quadOut",onUpdate:(t,i)=>{if(!i)return;const a=Math.round(n+(e-n)*i);this.setCoinText(Dv(a,3))}}),i)}async emitExplodeEffect(e){this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0),await Promise.all([St.runTweenAsync(C(this.explosionCircle.node).to(.4,{scale:new j(3,3,3)},{easing:"quadOut"}),e),St.runTweenAsync(C(this.explosionCircle).delay(.2).to(.2,{opacity:0}),e)]),this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0}getCoinIconWorldPosition(){return this.coinIcon.node.worldPosition}getCoinIconWorldScale(){return this.coinIcon.node.worldScale}onDestroy(){this.animAbortSignal?.abort()}}).prototype,"coinLabel",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv=ve(Av.prototype,"coinIcon",[Cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv=ve(Av.prototype,"explosionCircle",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tv=Av))||Tv);var Nv,Mv,kv,xv,Fv,Bv,Gv,zv,Uv,Hv,Vv,qv,Wv,Kv,Yv,jv,Xv;i._RF.pop(),i._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);const{ccclass:$v,property:Qv}=a,{player:Jv}=globalThis.game,Zv=[1e3,1500];Nv=$v("ItemContainer"),Mv=Qv({type:n,group:"Hint"}),kv=Qv({type:h,group:"Hint"}),xv=Qv({type:n,group:"Thunder"}),Fv=Qv({type:h,group:"Thunder"}),Bv=Qv({type:n,group:"Storm"}),Gv=Qv({type:h,group:"Storm"}),zv=Qv(_),Nv((Vv=ve((Hv=class extends s{constructor(){super(...arguments),e(this,"hintNode",Vv,this),e(this,"hintLabel",qv,this),this.hintCollection=[],e(this,"thunderNode",Wv,this),e(this,"thunderLabel",Kv,this),this.thunderCollection=[],e(this,"stormNode",Yv,this),e(this,"stormLabel",jv,this),this.stormCollection=[],e(this,"itemPrefab",Xv,this)}onLoad(){this.canvas=this.node.scene.getComponentInChildren(r).node,this.widget=this.getComponent(A),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(x),this.validateRequiredComponents(),this.listenToEvents()}start(){this.prepareItemCollection()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenToEvents(){this.node.scene.on(Ga.ADD_ITEMS,this.handleAddItems,this)}prepareItemCollection(){for(let e=0;e<9;e++){const e=c(this.itemPrefab),t=c(this.itemPrefab),i=c(this.itemPrefab);e.parent=this.canvas,t.parent=this.canvas,i.parent=this.canvas,e.active=!1,t.active=!1,i.active=!1,this.hintCollection.push(e.getComponent(sv)),this.thunderCollection.push(t.getComponent(sv)),this.stormCollection.push(i.getComponent(sv))}}updateStatus(e){const{items:t}=e;this.hintLabel.string=`${t.hint}`,this.thunderLabel.string=`${t.thunder}`,this.stormLabel.string=`${t.storm}`}async show(){this.uiOpacity.opacity=255;const e=C(this.widget).to(1.5,{right:0},{easing:"quadOut"});await St.runTweenAsync(e,this.animAbortSignal),this.widget.right=0}async hide(){const e=C(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"});await St.runTweenAsync(e),this.uiOpacity.opacity=0}async handleAddItems(e){this.animAbortSignal=e.signal??new ai;const t=Jv.getGameData();if(!t)return;this.updateStatus(t);const i=this.show(),n=e.items.map((e=>this.animateItemCollection(e.item,e.quantity,1.5)));await Promise.all([i,...n]),t.items={...t.items,hint:t.items.hint+e.items[0].quantity,thunder:t.items.thunder+e.items[1].quantity,storm:t.items.storm+e.items[2].quantity},Jv.setGameData(t),this.updateStatus(t),await this.hide()}async animateItemCollection(e,t,i){const n=this.getItemCollection(e).slice(0,t);if(0===n.length)return;const a=n.map(((t,n)=>{t.node.active=!0,t.node.position=new j(0,0,t.node.position.z),t.linearVelocity=new Q(0,0),t.simulate=!0;const a=ne(Math.PI/3,2*Math.PI/3),s=ne(Zv[0],Zv[1])*Math.cos(a),o=ne(Zv[0],Zv[1])*Math.sin(a);t.applyForce(new Q(s,o));const r=this.getTargetNode(e);if(r)return t.getComponent(R).spriteFrame=r.getComponent(R).spriteFrame,this.getItemAnimation(t,r,i+.03*n)}));await Promise.all(a)}getItemCollection(e){switch(e){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}getTargetNode(e){switch(e){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}async getItemAnimation(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.node.scale=new j(2,2,2),await St.waitTweenAsync(i,this.animAbortSignal);const n=e.node.worldPosition.clone(),a=C(e.node).to(1,{scale:t.scale},{onUpdate:(i,a)=>{if(!i||!a)return;const s=k.cubicIn(a);t&&(e.node.worldPosition=n.lerp(t.worldPosition,s))},onComplete:()=>{e.node.setPosition(0,0),e.node.active=!1}});await St.runTweenAsync(a,this.animAbortSignal),e.node.scale=t.scale.clone(),e.node.setPosition(0,0),e.node.active=!1}onDestroy(){this.animAbortSignal?.abort()}}).prototype,"hintNode",[Mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qv=ve(Hv.prototype,"hintLabel",[kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wv=ve(Hv.prototype,"thunderNode",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kv=ve(Hv.prototype,"thunderLabel",[Fv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yv=ve(Hv.prototype,"stormNode",[Bv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jv=ve(Hv.prototype,"stormLabel",[Gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xv=ve(Hv.prototype,"itemPrefab",[zv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uv=Hv));var eC,tC,iC,nC,aC,sC,oC,rC,lC,cC,hC,dC,uC,pC,mC,gC,yC,bC,fC,wC,SC;i._RF.pop(),i._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);const{ccclass:vC,property:CC,disallowMultiple:EC,requireComponent:TC}=a;let AC=(eC=vC("DashboardPage"),tC=TC(A),iC=TC(x),nC=CC({type:n,displayName:"Page's container"}),aC=CC({type:n,displayName:"Placeholder"}),sC=CC({displayName:"Don't load page",tooltip:"Tell the component to not preload the page even if it hasn't loaded yet"}),oC=CC({type:_,displayName:"Page prefab",visible:function(){return!this.hasLoaded}}),rC=CC({displayName:"Darken background"}),lC=CC({type:f,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),cC=CC({displayName:"Use navbar shadow"}),hC=CC({type:f,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),eC(dC=EC(dC=tC(dC=iC((pC=ve((uC=class extends s{constructor(){super(...arguments),e(this,"container",pC,this),e(this,"placeholder",mC,this),e(this,"hasLoaded",gC,this),e(this,"pagePrefab",yC,this),e(this,"darkenBackground",bC,this),e(this,"backgroundOpacity",fC,this),e(this,"useNavbarShadow",wC,this),e(this,"navbarShadowOpacity",SC,this)}onLoad(){this.containerUIOpacity=this.container.getComponent(x),this.placeholderUIOpacity=this.placeholder.getComponent(x),this.widgetComponent=this.node.getComponent(A),this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents();const e=this.container.getComponent(T);this.layoutComponents=e?[e]:[],this.widgetComponents=[this.widgetComponent,...this.container.getComponentsInChildren(A)]}start(){this.container.active=!0,this.placeholder.active=!0}getWidget(){return this.widgetComponent}updateWidgets(){this.widgetComponents.forEach((e=>{e.updateAlignment()}))}updateLayouts(){this.layoutComponents.forEach((e=>{e.updateLayout()}))}show(){this.uiOpacity.opacity=255}hide(){this.uiOpacity.opacity=0}async mount(){this.hasLoaded||await this.create(),this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,Ki.trackCurrentPage(this.node.name,!0)}unmount(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}transitionIn(){return Promise.resolve()}transitionOut(){return Promise.resolve()}hasLoadedPage(){return this.hasLoaded}getContainer(){return this.container}getDarkenBackground(){return this.darkenBackground?this.backgroundOpacity:0}getNavbarShadow(){return this.useNavbarShadow?this.navbarShadowOpacity:0}async create(){if(!this.pagePrefab)return;if(this.hasLoaded)return;const e=c(this.pagePrefab),t=e.getComponentsInChildren(A);this.widgetComponents.push(...t);const i=e.getComponentsInChildren(T);this.layoutComponents.push(...i),this.container.addChild(e),await St.waitTweenAsync(0),this.hasLoaded=!0}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"container",[nC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mC=ve(uC.prototype,"placeholder",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gC=ve(uC.prototype,"hasLoaded",[sC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yC=ve(uC.prototype,"pagePrefab",[oC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bC=ve(uC.prototype,"darkenBackground",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),fC=ve(uC.prototype,"backgroundOpacity",[lC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),wC=ve(uC.prototype,"useNavbarShadow",[cC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),SC=ve(uC.prototype,"navbarShadowOpacity",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),dC=uC))||dC)||dC)||dC)||dC);var RC,IC,PC,_C,LC,DC,OC,NC,MC,kC,xC;i._RF.pop(),i._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);const{ccclass:FC,property:BC}=a;let GC=(RC=FC("ThemeProgressBar"),IC=BC(n),PC=BC(n),_C=BC(n),LC=BC(n),RC((NC=ve((OC=class extends s{constructor(){super(...arguments),e(this,"progressBar",NC,this),e(this,"progressText",MC,this),e(this,"leftCap",kC,this),e(this,"rightCap",xC,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}setProgress(e,t){e<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);const i=this.progressBar.getComponent(X);if(!i)throw new Error("ThemeProgressBar: progressBarComponent not found");i.progress=e/t;const n=this.progressText.getComponent(h);if(!n)throw new Error("ThemeProgressBar: progressTextComponent not found");n.string=`${e}/${t}`}}).prototype,"progressBar",[IC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MC=ve(OC.prototype,"progressText",[PC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kC=ve(OC.prototype,"leftCap",[_C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xC=ve(OC.prototype,"rightCap",[LC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DC=OC))||DC);var zC,UC,HC,VC,qC,WC,KC,YC,jC,XC,$C,QC,JC,ZC,eE;i._RF.pop(),i._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);const{ccclass:tE,disallowMultiple:iE,property:nE}=a,aE=[50,160];let sE=(zC=tE("LockAnimator"),UC=nE(se),HC=nE(y),VC=nE(D),qC=nE(D),WC=nE(Eo),KC=nE({type:f,min:0}),zC(YC=iE((XC=ve((jC=class extends s{constructor(){super(...arguments),e(this,"floatingParticles",XC,this),e(this,"iconAnimation",$C,this),e(this,"lockClip",QC,this),e(this,"unlockClip",JC,this),e(this,"trailTemplate",ZC,this),e(this,"trailCount",eE,this),this.trails=[]}onLoad(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}async unlock(e){this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem(),await this.playAnimation(this.unlockClip.name,e),this.floatingParticles.stopSystem()}fireExplosionParticles(){this.explodeTrails()}lock(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}explodeTrails(){return Promise.all(this.trails.map((e=>St.runTweenAsync(this.getExplodeTrail(e)))))}getExplodeTrail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=ne(0,2*Math.PI),n=ne(aE[0],aE[1])*Math.cos(i),a=ne(aE[0],aE[1])*Math.sin(i),s=new j(n,a,e.node.position.z),o=e.node.scale.clone();return C(e.node).delay(t).call((()=>{e.node.setPosition(0,0),e.reset(),e.node.active=!0})).to(.5,{position:s.clone()},{easing:"expoOut"}).to(.5,{scale:new j(0,0,1)},{easing:"expoIn"}).call((()=>{e.node.setPosition(0,0),e.node.scale=o,e.reset(),e.node.active=!1}))}prepareTrails(){this.trailTemplate.node.active=!1;for(let e=0;e<this.trailCount;e++){const e=c(this.trailTemplate.node);e.setParent(this.node),e.active=!1,this.trails.push(e.getComponent(Eo))}}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async playAnimation(e,t){return t&&t?.aborted?Promise.resolve():new Promise((i=>{this.iconAnimation.once(y.EventType.FINISHED,(()=>{i()})),t?.addAbortListener((()=>{this.iconAnimation.off(y.EventType.FINISHED),this.iconAnimation.stop(),i()})),this.iconAnimation.play(e)}))}}).prototype,"floatingParticles",[UC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$C=ve(jC.prototype,"iconAnimation",[HC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QC=ve(jC.prototype,"lockClip",[VC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JC=ve(jC.prototype,"unlockClip",[qC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZC=ve(jC.prototype,"trailTemplate",[WC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eE=ve(jC.prototype,"trailCount",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YC=jC))||YC)||YC);var oE,rE,lE,cE,hE,dE,uE,pE,mE,gE,yE,bE,fE,wE,SE,vE,CE,EE,TE,AE,RE,IE;i._RF.pop(),i._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);const{ccclass:PE,property:_E}=a,LE={progress:0,max:10,isLocked:!0,themeId:Xr.SUMMER,skin:jr};let DE=(oE=PE("ThemeBlock"),rE=_E(n),lE=_E(x),cE=_E(n),hE=_E(x),dE=_E(sE),uE=_E(n),pE=_E(R),mE=_E([R]),gE=_E(h),yE=_E(H),oE((wE=ve((fE=class extends s{constructor(){super(...arguments),e(this,"mask",wE,this),e(this,"nodeUIOpacity",SE,this),e(this,"progressBar",vE,this),e(this,"backgroundUI",CE,this),e(this,"lockAnimator",EE,this),e(this,"themeLoadingRing",TE,this),e(this,"themeSprite",AE,this),e(this,"tileBlockIconSprite",RE,this),e(this,"titleLabel",IE,this),this.visibilityTween=null,this.isVisible=!1,this.payload=LE}set isLocked(e){this.payload.isLocked=e,this.updateThemeBlockDisplay()}get isLocked(){return this.payload.isLocked}getSkinName(){return this.payload.skin}__preload(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateThemeBlockDisplay(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:LE;this.payload=e;const{progress:t,max:i,isLocked:n,themeId:a,skin:s}=e;this.updateTitle(a),this.updateSkinAsync(s),this.updateThemeAsync(a);const o=this.progressBar.getComponent(GC);if(!o)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=n,this.progressBar.active=!n,this.lockAnimator.node.active=n,n||o.setProgress(t,i)}async playUnlockAnim(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:LE;this.payload={...t,isLocked:!1};const{progress:i,max:n}=t,a=this.progressBar.getComponent(GC);if(!a)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,a.setProgress(i,n),await this.animateUnlockedState(e)}updateTitle(e){switch(e){case Xr.SUMMER:this.titleLabel.string="Summer";break;case Xr.WINTER:this.titleLabel.string="Winter";break;case Xr.AUTUMN:this.titleLabel.string="Autumn"}}async updateSkinAsync(e){const t=await li.loadSkinPreviewAsync(e);this.tileBlockIconSprite&&t.forEach(((e,t)=>{e&&(this.tileBlockIconSprite[t].spriteFrame=e)}))}async updateThemeAsync(e){const t=await li.loadThemePreviewAsync(e);this.themeSprite&&t&&(this.themeSprite.spriteFrame=t,this.themeLoadingRing&&(this.themeLoadingRing.active=!1))}async animateUnlockedState(e){const t=this.mask.getComponent(x),i=this.progressBar.getComponent(x);if(!t)throw new Error("ThemeBlock: maskUIOpacity not found");if(!i)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,t.opacity=t.opacity??255,this.progressBar.active=!0,i.opacity=0,await this.lockAnimator.unlock(e),this.lockAnimator.node.active=!1,await Promise.all([St.runTweenAsync(C(t).to(.25,{opacity:0}),e),St.runTweenAsync(C(i).to(.25,{opacity:255}),e)]),this.mask.active=!1,t.opacity=0,i.opacity=255}getUITransform(){return this.uiTransform}setVisible(e){this.isVisible!==e&&(this.isVisible=e,this.visibilityTween?.stop(),this.visibilityTween=C(this.nodeUIOpacity).to(.05,{opacity:e?255:0}).start())}}).prototype,"mask",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SE=ve(fE.prototype,"nodeUIOpacity",[lE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vE=ve(fE.prototype,"progressBar",[cE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CE=ve(fE.prototype,"backgroundUI",[hE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EE=ve(fE.prototype,"lockAnimator",[dE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TE=ve(fE.prototype,"themeLoadingRing",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AE=ve(fE.prototype,"themeSprite",[pE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RE=ve(fE.prototype,"tileBlockIconSprite",[mE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IE=ve(fE.prototype,"titleLabel",[gE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(fE.prototype,"isLocked",[yE],Object.getOwnPropertyDescriptor(fE.prototype,"isLocked"),fE.prototype),bE=fE))||bE);var OE,NE,ME,kE,xE,FE,BE,GE,zE,UE,HE;i._RF.pop(),i._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);const{ccclass:VE,property:qE}=a,{storage:WE}=globalThis.game,{Array:KE}=GameCore.Utils;let YE=(OE=VE("CollectionsContent"),NE=qE(hs),ME=qE(ce),kE=qE(Hn),xE=qE({type:E,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),OE((GE=ve((BE=class extends s{constructor(){super(...arguments),this.animateThemeTabUnlock=null,e(this,"panelAnimator",GE,this),e(this,"themeScrollView",zE,this),e(this,"contentOpacity",UE,this),this.themeBlocks=[],this.preservedScrollPosition=new Q,e(this,"offsetFromTopOfScrollView",HE,this),this.updateBlocksVisibility=()=>{const{yMax:e,yMin:t}=this.uiTransform.getBoundingBoxToWorld();this.themeBlocks.forEach((i=>{const n=i.getUITransform(),{yMax:a,yMin:s}=n.getBoundingBoxToWorld(),o=a<t||s>e;i.setVisible(!o)}))},this.hideContent=()=>{this.contentOpacity.changeStateFade(!1,.1)},this.showContent=()=>{this.contentOpacity.changeStateFade(!0,.1)}}__preload(){this.uiTransform=this.getComponent(l),this.themeBlocks=this.themeScrollView.content?.getComponentsInChildren(DE)??[],this.validateRequiredComponents()}listenEvents(){this.themeScrollView.node.on(ce.EventType.SCROLLING,this.updateBlocksVisibility),this.node.scene.on(Ga.HIDE_UI,this.hideContent),this.node.scene.on(Ga.SHOW_UI,this.showContent)}unlistenEvents(){this.themeScrollView.node.off(ce.EventType.SCROLLING,this.updateBlocksVisibility),this.unlistenUIEvents()}unlistenUIEvents(){this.node.scene.off(Ga.HIDE_UI,this.hideContent),this.node.scene.off(Ga.SHOW_UI,this.showContent)}init(e){if(0===e.length)return;this.getThemeTabs().forEach(((t,i)=>t.updateThemeBlockDisplay(e[i])))}preserveScrollPosition(){this.themeScrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.getScrollOffset())}restoreScrollPosition(){this.themeScrollView.scrollToOffset(this.preservedScrollPosition,0)}updateUnlockedProgress(e){const t=WE.getStorageData("collection","animateMapPackUnlock"),i=WE.getStorageData("collection","lastMapPack");e.forEach(((e,n)=>{const{skin:a,progress:s,max:o,isLocked:r}=e;if(s<o&&!r&&t&&i!==n+1)return this.animateThemeTabUnlock=e,WE.setStorageData("collection","animateMapPackUnlock",!1),WE.setStorageData("collection","lastMapPack",n+1),void this.setProgressToThemeTab(a,{...e,isLocked:!0});this.setProgressToThemeTab(a,e)}))}shouldAnimateThemeTabUnlock(){return null!==this.animateThemeTabUnlock}async playThemeTabUnlockAnim(e){if(!this.animateThemeTabUnlock)return;const t=this.findThemeTab(this.animateThemeTabUnlock.skin);if(void 0===t)throw new Error("CollectionsContent: ThemeTab not found");await t.playUnlockAnim(e,{...this.animateThemeTabUnlock,isLocked:!0}),this.animateThemeTabUnlock=null}async scrollToCurrentUnlockingTheme(e,t){const i=this.findThemeTab(e);if(!i)return;const{y:n}=i.node.position,a=-n-this.offsetFromTopOfScrollView;await this.scrollToOffset(new Q(0,a),2,t)}async scrollToOffset(e,t,i){this.themeScrollView.scrollToOffset(e,t),await St.waitTweenAsync(t,i),i.aborted&&(this.themeScrollView.stopAutoScroll(),this.themeScrollView.scrollToOffset(e,0))}setProgressToThemeTab(e,t){const i=this.findThemeTab(e);if(void 0===i)throw new Error("CollectionsContent: ThemeTab not found");i.updateThemeBlockDisplay(t)}findThemeTab(e){return KE.search(this.getThemeTabs(),(t=>t.getSkinName()===e))}getThemeTabs(){return this.themeScrollView.content.getComponentsInChildren(DE)}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"panelAnimator",[NE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zE=ve(BE.prototype,"themeScrollView",[ME],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UE=ve(BE.prototype,"contentOpacity",[kE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HE=ve(BE.prototype,"offsetFromTopOfScrollView",[xE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),FE=BE))||FE);var jE;i._RF.pop(),i._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);const{ccclass:XE}=a;let $E=XE("CollectionsPage")(jE=class extends AC{constructor(){super(...arguments),this.payload=null}setPayload(e){this.payload=e}async mount(){if(!this.pagePrefab){const e=await li.loadPrefabAsync(si.COLLECTIONS_PAGE);e&&this.node&&(this.pagePrefab=e)}if(await super.mount(),this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(YE),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload)}async transitionIn(){await super.transitionIn(),this.themeContent.restoreScrollPosition(),this.themeContent.updateBlocksVisibility(),this.themeContent.enableUIAnimator(),this.themeContent.listenEvents();const e=St.runTweenAsync(C(this.containerUIOpacity).to(.2,{opacity:255})),t=new Promise((e=>{this.node.scene.emit(Ga.SHOW_UI,{onComplete:()=>{e()}})}));await Promise.all([e,t])}async transitionOut(){await super.transitionOut(),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents(),await new Promise((e=>{this.node.scene.emit(Ga.HIDE_UI,{onComplete:()=>{e()}})})),this.themeContent.disableUIAnimator(),this.themeContent.unlistenEvents()}})||jE;var QE,JE,ZE,eT,tT,iT,nT,aT,sT,oT,rT,lT,cT,hT,dT,uT,pT,mT,gT,yT,bT,fT,wT,ST,vT,CT,ET;i._RF.pop(),i._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);const{ccclass:TT,property:AT,disallowMultiple:RT,requireComponent:IT}=a,{Array:PT}=GameCore.Utils;let _T=(QE=TT("PageManagerItem"),JE=AT(AC),ZE=AT({type:M(ni)}),QE((iT=ve((tT=class{constructor(){e(this,"page",iT,this),e(this,"pageType",nT,this)}}).prototype,"page",[JE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nT=ve(tT.prototype,"pageType",[ZE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eT=tT))||eT),LT=(aT=TT("PageManager"),sT=IT(l),oT=AT({type:x,displayName:"Background Mask",group:"Background Mask"}),rT=AT({type:E,displayName:"Transition duration",group:"Background Mask"}),lT=AT({type:E,displayName:"Transition delay",group:"Background Mask"}),cT=AT({type:x,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),hT=AT({type:E,displayName:"Transition duration",group:"Nav Bar Shadow"}),dT=AT({type:E,displayName:"Transition delay",group:"Nav Bar Shadow"}),uT=AT({type:[_T]}),pT=AT({type:M(ni)}),aT(mT=RT(mT=sT((yT=ve((gT=class extends s{constructor(){super(...arguments),e(this,"backgroundMask",yT,this),e(this,"backgroundMaskTransitionDuration",bT,this),e(this,"backgroundMaskTransitionDelay",fT,this),e(this,"navBarShadow",wT,this),e(this,"navBarShadowTransitionDuration",ST,this),e(this,"navBarShadowTransitionDelay",vT,this),e(this,"pageItems",CT,this),e(this,"currentScreen",ET,this)}unmountAndHideAll(){this.pageItems.forEach((e=>{const{page:t,pageType:i}=e;i!==this.currentScreen&&(t.unmount(),t.hide())}))}onLoad(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}updateCollectionsContentPayload(e){const t=this.getPage(ni.collections);t&&t instanceof $E&&t.setPayload(e)}async navigate(e,t,i){const{from:n,to:a}=e;if(null===n){const e=this.getPage(this.currentScreen);return e.show(),await e.mount(),await(t?.(e)),this.node.scene.emit(ti,{from:null,to:a}),await e.transitionIn(),await(i?.(e)),void(this.currentScreen=a)}if(n!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");const s=this.getPage(this.currentScreen),o=this.getPage(a);if(!o||!s)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");const r=this.uiTransform.width,l=this.getPageIndex(n),c=this.getPageIndex(a),h=Math.min(l,c),d=Math.max(l,c),u=(d-h)*r,p=l<c?1:-1,m=this.pageItems.slice(h,d+1);m.forEach(((e,t)=>{let{page:i}=e;i.show();i.getWidget().enabled=!1,i.node.position=new j((t+h-l)*r,i.node.position.y,i.node.position.z)}));let g=!1;o.hasLoadedPage()||(g=!0,Bl.showLoadingScreen(),await St.waitTweenAsync(.5)),await o.mount(),await(t?.(o)),this.node.scene.emit(ti,{from:n,to:a}),await Promise.all([s.transitionOut(),this.transition(u,p,m),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,o.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,o.getNavbarShadow())]);const y=o.getWidget();y.enabled=!0,y.left=0,y.right=0,o.updateWidgets(),o.updateLayouts(),m.forEach((e=>{e.pageType!==a&&(e.page.unmount(),e.page.hide())})),this.currentScreen=a,await o.transitionIn(),await(i?.(o)),g&&Bl.closeLoadingScreen()}getPage(e){const t=this.getPageIndex(e);return-1!==t?this.pageItems[t].page:null}async handleBackgroundMask(e,t){await St.runTweenAsync(C(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(e,{opacity:t}).start())}async handleNavBarShadow(e,t){await St.runTweenAsync(C(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(e,{opacity:t}).start())}getPageIndex(e){return PT.searchIndex(this.pageItems,(t=>t.pageType===e))}async transition(e,t,i){await Promise.all(i.map((i=>{let{page:n}=i;return St.runTweenAsync(C(n.node).to(.5,{position:new j(n.node.position.x-e*t,n.node.position.y,n.node.position.z)},{easing:k.quintInOut}))})))}validateRequiredComponents(){if(!this.uiTransform)throw new Error("PageManager requires UITransform component");if(!this.backgroundMask)throw new Error("PageManager requires background mask")}}).prototype,"backgroundMask",[oT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bT=ve(gT.prototype,"backgroundMaskTransitionDuration",[rT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),fT=ve(gT.prototype,"backgroundMaskTransitionDelay",[lT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),wT=ve(gT.prototype,"navBarShadow",[cT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ST=ve(gT.prototype,"navBarShadowTransitionDuration",[hT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),vT=ve(gT.prototype,"navBarShadowTransitionDelay",[dT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),CT=ve(gT.prototype,"pageItems",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ET=ve(gT.prototype,"currentScreen",[pT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ni.home}}),mT=gT))||mT)||mT)||mT);var DT,OT,NT,MT,kT,xT,FT,BT,GT,zT,UT,HT,VT;i._RF.pop(),i._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);const{ccclass:qT,property:WT}=a;let KT=(DT=qT("StarProgressBar"),OT=WT(ks),NT=WT(h),MT=WT(f),kT=WT(f),xT=WT(b),DT((GT=ve((BT=class extends s{constructor(){super(...arguments),e(this,"progressBar",GT,this),e(this,"progressLabel",zT,this),e(this,"current",UT,this),e(this,"total",HT,this),e(this,"separator",VT,this)}setRange(e,t){this.total=t,this.current=e,this.updateProgress()}onLoad(){this.validateRequiredComponents()}updateProgress(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}updateProgressLabel(){this.progressLabel.string=`${this.current}${this.separator}${this.total}`}async animateTo(e,t,i){const n=Math.min(e,this.total)/this.total,a=this.current;let s=1;const o=C(this.progressBar).to(3,{progress:n},{easing:"quadOut",onUpdate:(t,n)=>{n&&(this.current=a+Math.floor((e-a)*n),i?.(this.current),this.current===a-s&&(s++,C(this.progressLabel.node).to(.05,{scale:new j(1.2,1.2,1.2)}).to(.05,{scale:j.ONE}).start()),this.updateProgressLabel())}});t?.addAbortListener((()=>{this.current=e,this.updateProgress()})),await St.runTweenAsync(o,t)}validateRequiredComponents(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}).prototype,"progressBar",[OT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zT=ve(BT.prototype,"progressLabel",[NT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UT=ve(BT.prototype,"current",[MT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HT=ve(BT.prototype,"total",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VT=ve(BT.prototype,"separator",[xT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FT=BT))||FT);var YT,jT,XT,$T,QT,JT;i._RF.pop(),i._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);const{ccclass:ZT,property:eA}=a;let tA=(YT=ZT("EventButton"),jT=eA({type:M(uf)}),XT=eA(H),YT((JT=ve((QT=class extends Mn{constructor(){super(...arguments),e(this,"eventType",JT,this),this._isAvailable=!1}get isAvailable(){return this._isAvailable}set isAvailable(e){this._isAvailable=e,this.fakeClick()}handleClick(){this.node.scene.emit(ii,{type:this.eventType})}setAnimationState(e){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),super.setAnimationState(e)}}).prototype,"eventType",[jT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return uf.STAR_CHEST}}),ve(QT.prototype,"isAvailable",[XT],Object.getOwnPropertyDescriptor(QT.prototype,"isAvailable"),QT.prototype),$T=QT))||$T);var iA,nA,aA,sA,oA,rA,lA,cA,hA,dA,uA;i._RF.pop(),i._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);const{ccclass:pA,property:mA}=a,{player:gA}=globalThis.game;let yA=(iA=pA("DashboardHeader"),nA=mA({type:KT,displayName:"Progress bar",group:"Star Chest"}),aA=mA({type:tA,displayName:"Button Component",group:"Star Chest"}),sA=mA({type:D,displayName:"Default Rest animation",group:"Star Chest"}),oA=mA({type:D,displayName:"Special Rest animation",group:"Star Chest"}),iA((cA=ve((lA=class extends s{constructor(){super(...arguments),e(this,"starProgressBar",cA,this),e(this,"chestButton",hA,this),e(this,"defaultRestAnimation",dA,this),e(this,"specialRestAnimation",uA,this),this.handleStarsUpdateEvent=e=>{void 0!==(e=e??gA.getGameData()?.stars)&&(this.starProgressBar.setRange(e,20),this.updateStarChestButtonAnimation(e))}}__preload(){this.validateRequiredComponents(),W.on(Jt,this.handleStarsUpdateEvent)}onDestroy(){W.off(Jt,this.handleStarsUpdateEvent)}updateStarProgress(e){this.handleStarsUpdateEvent(e)}updateStarChestButtonAnimation(e){this.chestButton.isAvailable=e>=20}validateRequiredComponents(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}}).prototype,"starProgressBar",[nA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hA=ve(lA.prototype,"chestButton",[aA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dA=ve(lA.prototype,"defaultRestAnimation",[sA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uA=ve(lA.prototype,"specialRestAnimation",[oA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rA=lA))||rA);var bA,fA,wA,SA,vA,CA,EA,TA,AA,RA,IA,PA,_A,LA,DA,OA,NA,MA;i._RF.pop(),i._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);const{ccclass:kA,property:xA,executeInEditMode:FA}=a;let BA=(bA=kA("JourneyLevelAvatar"),fA=xA({type:R,displayName:"Avatar node"}),wA=xA(n),SA=xA(y),vA=xA(x),CA=xA({type:D,group:"Animation"}),EA=xA({type:D,group:"Animation"}),TA=xA({type:D,group:"Animation"}),AA=xA({type:N,displayName:"Avatar sprite"}),bA(RA=FA((PA=ve((IA=class extends s{constructor(){super(...arguments),e(this,"sprite",PA,this),e(this,"lockIcon",_A,this),e(this,"animation",LA,this),e(this,"opacity",DA,this),e(this,"flashAnimation",OA,this),e(this,"unlockAnimation",NA,this),e(this,"spawnAnimation",MA,this)}get avatarSprite(){return this.sprite?.spriteFrame??null}set avatarSprite(e){this.sprite&&(this.sprite.spriteFrame=e)}async playUnlockAnimation(){const e=this.playAnimation(this.unlockAnimation),t=this.lockIcon.position.x,i=this.lockIcon.position.y,n=[45,135],a=(Math.random()*(n[1]-n[0])+n[0])*(Math.PI/180),s=this.lockIcon.position.x+150*Math.cos(a),o=this.lockIcon.position.y+150*Math.sin(a),r=i-400,l=St.runTweenAsync(C(this.lockIcon).delay(.3).to(.2,{position:new j(s,o,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new j(s,r,this.lockIcon.position.z)},{easing:"cubicIn"})),c=[0,360],h=St.runTweenAsync(C(this.lockIcon).delay(.3).to(.6,{eulerAngles:new j(0,0,Math.random()*(c[1]-c[0])*(s>t?-1:1))},{easing:"sineOut"}));await Promise.all([e,l,h]),this.lockIcon.position=new j(t,i,this.lockIcon.position.z),this.lockIcon.eulerAngles=new j(0,0,0)}async playFlashAnimation(){const e=this.node.position.y,t=this.playAnimation(this.flashAnimation),i=St.runTweenAsync(C(this.node).to(.1,{position:new j(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new j(this.node.position.x,e,this.node.position.z)},{easing:"sineIn"}));await Promise.all([t,i])}playSpawnAnimation(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}hideImmediately(){this.opacity.opacity=0,this.node.setScale(j.ZERO)}async playAnimation(e){await St.runAnimationAsync(this.animation,e.name)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some((e=>null!==e&&(e.name===this.flashAnimation.name||e.name===this.unlockAnimation.name||e.name===this.spawnAnimation.name))))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}).prototype,"sprite",[fA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_A=ve(IA.prototype,"lockIcon",[wA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LA=ve(IA.prototype,"animation",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DA=ve(IA.prototype,"opacity",[vA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OA=ve(IA.prototype,"flashAnimation",[CA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NA=ve(IA.prototype,"unlockAnimation",[EA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MA=ve(IA.prototype,"spawnAnimation",[TA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(IA.prototype,"avatarSprite",[AA],Object.getOwnPropertyDescriptor(IA.prototype,"avatarSprite"),IA.prototype),RA=IA))||RA)||RA);var GA,zA,UA,HA,VA,qA,WA,KA,YA,jA,XA,$A;i._RF.pop(),i._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);const{ccclass:QA,property:JA,executeInEditMode:ZA}=a;let eR=(GA=QA("JourneyProgressBar"),zA=JA(ks),UA=JA(h),HA=JA(x),VA=JA(f),qA=JA(f),WA=JA(b),GA(KA=ZA((jA=ve((YA=class extends s{constructor(){super(...arguments),e(this,"progressBar",jA,this),e(this,"progressLabel",XA,this),e(this,"labelUIOpacity",$A,this),this.currentProgress=10,this.totalProgress=10,this.labelSeparator="/"}get total(){return this.totalProgress}get current(){return this.currentProgress}get separator(){return this.labelSeparator}set separator(e){this.labelSeparator=e,this.updateProgress()}setRange(e,t){this.totalProgress=t,e>t&&(e=t),this.currentProgress=e,this.updateProgress()}onLoad(){this.validateRequiredComponents()}async animateTo(e){const{nextCurr:t,nextTotal:i,numberOfProgressBar:n=0,onProgressBarPassed:a,signal:s}=e,o=t/i,r=C(this.labelUIOpacity).to(.2,{opacity:0}),l=C(this.labelUIOpacity).to(.2,{opacity:255}),c=n<1?1:Math.sqrt(n)+1,h=0===n?o:n+o;let d=1;const u=C({curr:this.progressBar.progress}).to(c,{curr:h},{easing:"sineInOut",onUpdate:e=>{if(void 0===e)return;const{curr:t}=e;this.progressBar.progress=t%1,t>d&&(d=0===t?1:Math.ceil(t),a?.())}});return await Promise.all([St.runTweenAsync(r,s),St.runTweenAsync(u,s)]),this.currentProgress=t,this.totalProgress=i,this.updateProgress(),await St.runTweenAsync(l,s),this.labelUIOpacity.opacity=255,o}updateProgress(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string=`${this.currentProgress}${this.separator}${this.totalProgress}`}validateRequiredComponents(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}).prototype,"progressBar",[zA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XA=ve(YA.prototype,"progressLabel",[UA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$A=ve(YA.prototype,"labelUIOpacity",[HA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(YA.prototype,"total",[VA],Object.getOwnPropertyDescriptor(YA.prototype,"total"),YA.prototype),ve(YA.prototype,"current",[qA],Object.getOwnPropertyDescriptor(YA.prototype,"current"),YA.prototype),ve(YA.prototype,"separator",[WA],Object.getOwnPropertyDescriptor(YA.prototype,"separator"),YA.prototype),KA=YA))||KA)||KA);var tR,iR,nR,aR,sR,oR,rR,lR,cR,hR,dR,uR,pR,mR,gR,yR,bR,fR,wR,SR,vR,CR;i._RF.pop(),i._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);const{ccclass:ER,property:TR}=a,{Array:AR}=GameCore.Utils;let RR=(tR=ER("ProgressConfiguration"),iR=TR(N),nR=TR(b),tR((oR=ve((sR=class{constructor(){e(this,"avatar",oR,this),e(this,"themeId",rR,this)}}).prototype,"avatar",[iR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rR=ve(sR.prototype,"themeId",[nR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aR=sR))||aR),IR=(lR=ER("JourneyProgressAnimator"),cR=TR(eR),hR=TR(n),dR=TR(R),uR=TR(BA),pR=TR(RR),mR=TR({type:E,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),lR((bR=ve((yR=class extends s{constructor(){super(...arguments),e(this,"progressBar",bR,this),e(this,"currentLevelAvatarNode",fR,this),e(this,"currentLevelAvatar",wR,this),e(this,"nextLevelAvatar",SR,this),e(this,"progressConfigs",vR,this),e(this,"nextLevelYOffset",CR,this),this.isAnimating=!1}setRange(e,t){this.progressBar.setRange(e,t)}async animateTo(e,t){if(this.isAnimating)return console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve();this.isAnimating=!0,e!==this.progressBar.current&&await this.progressBar.animateTo({nextCurr:e,nextTotal:this.progressBar.total,signal:t}),this.isAnimating=!1}async animateToNextLevel(e){let{nextCurr:t,nextTotal:i,mapsPassed:n,signal:a}=e;if(this.isAnimating)return void console.warn("JourneyProgressAnimator: animation already in progress");this.isAnimating=!0;const s=n.length-2;if(0===s)return await this.progressBar.animateTo({nextCurr:t,nextTotal:i,signal:a}),void(this.isAnimating=!1);await this.animateTargetAvaToCenter(a);let o=1;await this.progressBar.animateTo({signal:a,nextCurr:t,nextTotal:i,numberOfProgressBar:s,onProgressBarPassed:()=>{if(1===o)return this.nextLevelAvatar.playUnlockAnimation(),void(o+=1);if(o>=n.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");this.nextLevelAvatar.playFlashAnimation(),this.setNextLevelAvatar(n[o].theme),o+=1}}),await this.animateTargetAvaToPrev(a);const r=n[n.length-1].theme,l=n[n.length-2].theme;this.setCurrentLevelAvatar(l),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=this.getSpriteFrameByThemeId(r),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1}async animateTargetAvaToCenter(e){const t=new j(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);await St.runTweenAsync(C(this.nextLevelAvatar.node).to(1,{position:t},{easing:"cubicInOut"}),e),this.nextLevelAvatar.node.position=t}moveTargetAvaToOriginal(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}async animateTargetAvaToPrev(e){const t=this.currentLevelAvatarNode.position.clone();await St.runTweenAsync(C(this.nextLevelAvatar.node).to(1,{position:t},{easing:"cubicInOut"}),e),this.nextLevelAvatar.node.position=t}getSpriteFrameByThemeId(e){const t=AR.search(this.progressConfigs,(t=>t.themeId===e));if(!t)throw new Error(`JourneyProgressController: config not found for themeId ${e}`);return t.avatar}setAvatar(e,t){const i=this.getSpriteFrameByThemeId(e);t instanceof BA?t.avatarSprite=i:t.spriteFrame=i}setCurrentLevelAvatar(e){this.setAvatar(e,this.currentLevelAvatar)}setNextLevelAvatar(e){this.setAvatar(e,this.nextLevelAvatar)}onLoad(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"progressBar",[cR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fR=ve(yR.prototype,"currentLevelAvatarNode",[hR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wR=ve(yR.prototype,"currentLevelAvatar",[dR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SR=ve(yR.prototype,"nextLevelAvatar",[uR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vR=ve(yR.prototype,"progressConfigs",[pR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),CR=ve(yR.prototype,"nextLevelYOffset",[mR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gR=yR))||gR);var PR,_R,LR,DR,OR,NR,MR,kR,xR,FR,BR,GR,zR,UR,HR,VR,qR;i._RF.pop(),i._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);const{ccclass:WR,property:KR}=a,{storage:YR}=globalThis.game;let jR=(PR=WR("HomeContent"),_R=KR(h),LR=KR(p),DR=KR(IR),OR=KR(hs),NR=KR(yA),MR=KR(x),kR=KR(Ov),PR((BR=ve((FR=class extends s{constructor(){super(...arguments),e(this,"playButtonLabel",BR,this),e(this,"playButton",GR,this),e(this,"journeyProgressAnimator",zR,this),e(this,"panelAnimator",UR,this),e(this,"dashboardHeader",HR,this),e(this,"overlayDuringAnim",VR,this),e(this,"coinContainer",qR,this)}__preload(){this.validateRequiredComponents()}getCoinContainer(){return this.coinContainer}handlePlayButtonPress(){this.playButton.interactable=!1,this.node.scene.emit(Zt)}setPlayButtonLabel(e){this.playButtonLabel.string=e}updateStarProgress(e){this.dashboardHeader.updateStarProgress(e)}setUnlockProgress(e){this.setProgress(e),this.updateCurrentMapInStorage(e)}prepareUnlockProgressAnimation(e,t,i,n){if(e.id===t.id){this.setProgress({...t,progress:e.progress}),this.updateCurrentMapInStorage(t);const i=t.progress;return async()=>{this.playButton.interactable=!1,await this.showOwnOverlay(n),await this.journeyProgressAnimator.animateTo(i,n),await this.hideOwnOverlay(n),this.playButton.interactable=!0}}return this.setProgress(e),this.updateCurrentMapInStorage(t),async()=>{this.playButton.interactable=!1,await this.showOwnOverlay(n),await this.journeyProgressAnimator.animateToNextLevel({nextCurr:t.progress,nextTotal:t.max,mapsPassed:i,signal:n}),await this.hideOwnOverlay(n),this.playButton.interactable=!0}}async hideOwnOverlay(e){await St.runTweenAsync(C(this.overlayDuringAnim).to(.3,{opacity:0}),e),this.overlayDuringAnim.opacity=0}async showOwnOverlay(e){await St.runTweenAsync(C(this.overlayDuringAnim).to(.3,{opacity:150}),e)}setProgress(e){const{currentTheme:t,nextTheme:i,progress:n,max:a}=e;this.journeyProgressAnimator.setCurrentLevelAvatar(t),this.journeyProgressAnimator.setNextLevelAvatar(i??t),this.journeyProgressAnimator.setRange(n,a)}updateCurrentMapInStorage(e){YR.setStorageData("dashboard","animateToCurrentLevel",!1),YR.setStorageData("dashboard","lastMapPayload",e)}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"playButtonLabel",[_R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GR=ve(FR.prototype,"playButton",[LR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zR=ve(FR.prototype,"journeyProgressAnimator",[DR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UR=ve(FR.prototype,"panelAnimator",[OR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HR=ve(FR.prototype,"dashboardHeader",[NR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VR=ve(FR.prototype,"overlayDuringAnim",[MR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qR=ve(FR.prototype,"coinContainer",[kR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xR=FR))||xR);var XR,$R,QR,JR,ZR,eI,tI,iI,nI,aI,sI,oI,rI,lI,cI;i._RF.pop(),i._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);const{ccclass:hI,property:dI}=a,{ads:uI}=globalThis.game,{Array:pI}=GameCore.Utils;let mI=(XR=hI("NavManager"),$R=dI(n),QR=dI(n),JR=dI(qt),ZR=dI(H),eI=dI({type:A,visible:function(){return this.useOffsetWhenSAB}}),tI=dI({type:E,visible:function(){return this.useOffsetWhenSAB}}),XR((aI=ve((nI=class extends s{constructor(){super(...arguments),e(this,"selectorNode",aI,this),e(this,"selectedButtonNode",sI,this),e(this,"autoLayout",oI,this),e(this,"useOffsetWhenSAB",rI,this),e(this,"offsetWidget",lI,this),e(this,"offsetWhenSAB",cI,this),this.navButtons=[],this.isNavigating=!1}get currentButton(){return this.selectedButton}onLoad(){this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=this.selectedButtonNode?.getComponentInChildren("NavButton"),Fe.lazyValidateProperties(this)}start(){if(!this.useOffsetWhenSAB)return;uI.getSafeAreaBottom(ji.cssSizeToWorldSize(1))>0&&(this.offsetWidget.bottom=this.offsetWhenSAB)}async select(e){if(!this.isNavigating){if(!pI.has(this.navButtons,e))throw new Error("NavManager: Button not found");if(e!==this.selectedButton){if(!e.isWIP)return this.isNavigating=!0,this.node.scene.emit(ei,{from:this.selectedButton.buttonType,to:e.buttonType}),new Promise((t=>{this.node.scene.once(ti,(()=>{const i=this.selectedButton.deselect();this.autoLayout.selectedIndex=this.navButtons.indexOf(e),this.selectedButton=e;const n=this.autoLayout.getSelectedWorldX()-e.getSelectedWorldDistanceX(),a=this.playSelectorAnimation(n),s=e.select();Promise.all([i,s,a]).then((()=>{this.isNavigating=!1,t()}))}))}));this.handleWIPButton()}}}async selectUsingSceneTransition(e){this.isNavigating||(pI.has([ni.store],e.buttonType)?this.handleWIPButton():await this.select(e))}async selectByType(e){const t=pI.search(this.navButtons,(t=>t.buttonType===e));if(!t)throw new Error("NavManager: Button not found");await this.selectUsingSceneTransition(t)}handleWIPButton(){Bl.openScreen(zi.STAR_CHEST_SCREEN)}async selectDefaultNavBtn(){if(!this.currentButton||!pI.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");const e=this.currentButton.buttonType;return this.node.scene.emit(ei,{from:null,to:e}),new Promise((e=>{this.node.scene.once(ti,(()=>{this.autoLayout.selectedIndex=this.navButtons.indexOf(this.currentButton);const t=this.navButtons.map((e=>e===this.currentButton?e.select(!1):e.deselect(!1,!0))),i=this.autoLayout.getSelectedWorldX()-this.currentButton.getSelectedWorldDistanceX();this.selectorNode.worldPosition=new j(i,this.selectorNode.worldPosition.y,0),Promise.all(t).then((()=>{e()}))}))}))}async playSelectorAnimation(e){const t=new j(1,1,1),i=this.selectorNode.worldPosition.clone(),n=new j(1.2*t.x,.8*t.y,1);await St.runTweenAsync(C(this.selectorNode).to(.3,{worldPosition:new j(e,i.y,0)},{easing:"quintInOut",onUpdate:(e,i)=>{if(void 0===i)return;const a=this.calculateCurrentSquashScale(t,n,i);this.selectorNode.scale=a}}))}setIgnoreInput(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.navButtons.forEach((t=>{const i=t.getComponentInChildren(p);i&&(i.interactable=!e)}))}calculateCurrentSquashScale(e,t,i){const n=this.splitIntoSquashRatio(i);return e.clone().lerp(t,n)}splitIntoSquashRatio(e){return e<.5?2*e:1-2*(e-.5)}}).prototype,"selectorNode",[$R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sI=ve(nI.prototype,"selectedButtonNode",[QR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oI=ve(nI.prototype,"autoLayout",[JR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rI=ve(nI.prototype,"useOffsetWhenSAB",[ZR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lI=ve(nI.prototype,"offsetWidget",[eI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cI=ve(nI.prototype,"offsetWhenSAB",[tI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),iI=nI))||iI);var gI,yI,bI,fI,wI,SI,vI,CI,EI,TI,AI,RI,II;i._RF.pop(),i._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);const{ccclass:PI,disallowMultiple:_I,property:LI}=a,{event:DI,storage:OI,player:NI,leaderboard:MI}=globalThis.game,{Events:kI}=GameCore,{Modes:xI}=GameCore.Match,{DailyRewards:FI}=GameCore.Configs,{Time:BI,Json:GI,Array:zI}=GameCore.Utils;gI=PI("DashboardScene"),yI=LI(Lw),bI=LI(mI),fI=LI(Ni),wI=LI(LT),SI=LI(wv),gI(vI=_I((EI=ve((CI=class extends s{constructor(){super(...arguments),e(this,"coinManager",EI,this),e(this,"navManager",TI,this),e(this,"bgComp",AI,this),e(this,"pageManager",RI,this),e(this,"pageAnimSkipOverlay",II,this),this.firstNavigation=!0,this.isFirstNavToCollections=!0,this.playBgAnim=async()=>{const e=OI.getStorage("dashboard");if(null==e)throw new Error("DashboardScene: dashboardStorage not found");const t=e.animateToCurrentLevel??!1,i={...e.lastMapPayload},n=il.getCurrentMapProgress(),a=i.currentTheme===n.currentTheme&&i.nextTheme===n.nextTheme,s=n.currentTheme;if(t&&!a){await St.waitTweenAsync(2);try{await this.bgComp.animateToNextTheme(s)}catch(e){}}},this.handlePlayButtonPress=async()=>{try{await ul.startMatchAsync(xI.SINGLE);const e=il.getCurrentMapProgress(),{level:t=1}=NI.getGameData()??{};this.updateCurrentMapInStorage(e),OI.setStorageData("collection","lastMapPack",e.id),OI.setStorageData("collection","animateMapPackUnlock",!1);const{lastTabOpened:i}=OI.getStorage("leaderboard_content");this.getPlayerLeader(i).then((e=>{if(!e)return;const{score:t,rank:i}=e;OI.setStorageData("leaderboard_content","previousScore",t),OI.setStorageData("leaderboard_content","previousRank",i)})),gl.switchScene(Lr,{level:t})}catch(e){return void console.error(e)}},this.onNavigate=async e=>{switch(this.firstNavigation&&(this.firstNavigation=!1,this.pageManager.unmountAndHideAll()),e.to){case ni.store:this.navManager.setIgnoreInput(),await this.pageManager.navigate(e),this.handleNavigateToStore(),this.navManager.setIgnoreInput(!1);break;case ni.collections:await this.onNavigateToCollections({...e,to:ni.collections});break;case ni.tournaments:await this.onNavigateToTournaments(e);break;case ni.leaderboard:await this.onNavigateToLeaderboard({...e,to:ni.leaderboard});break;case ni.home:await this.handleNavigateToHome(e);break;default:throw new Error("DashboardScene: Unhandled page name")}},this.handleEventButtonPress=e=>{switch(e.type){case uf.STAR_CHEST:Bl.openScreen(zi.STAR_CHEST_SCREEN);break;case uf.BALLOON:Bl.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}}}__preload(){this.panelAnimationController=this.getComponent(Ua),this.validateRequiredComponents(),this.listenNavigationEvents(),this.listenDashboardEvents(),this.panelAnimationController.init()}listenNavigationEvents(){this.node.scene.on(ei,this.onNavigate)}listenDashboardEvents(){this.node.scene.on(Zt,this.handlePlayButtonPress),this.node.scene.on(ii,this.handleEventButtonPress)}onLoad(){this.coinManager.init(this.pageAnimSkipOverlay),il.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(il.getCollectionUnlockProgress())}setPlayerLevel(){let{level:e=1}=NI.getGameData()??{};e=0===e?1:e,NI.setGameData({level:e})}start(){NI.getPlayerSetting("music")&&Yi.playMusic(),this.playBgAnim(),this.navManager.selectDefaultNavBtn(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}preloadScenes(){gl.preloadGameScene()}initBgComp(){const e=OI.getStorage("dashboard");if(null==e)throw new Error("DashboardScene: dashboardStorage not found");const t=e.animateToCurrentLevel??!1,i={...e.lastMapPayload},n=il.getCurrentMapProgress(),a=i.currentTheme===n.currentTheme&&i.nextTheme===n.nextTheme,s=n.currentTheme;t&&!a?this.bgComp.setCurrentTheme(i.currentTheme):this.bgComp.setCurrentTheme(s)}async getPlayerLeader(e){const t="global"==e?Er:Tr;if(!t)return null;const i=NI.getPlayerId(),n=await MI.getLeadersByPlayerIdsAsync(t,[i]);return 0===n.length?null:n[0]}updateCurrentMapInStorage(e){OI.setStorageData("dashboard","animateToCurrentLevel",!1),OI.setStorageData("dashboard","lastMapPayload",e)}updateVolumeBackgroundMusic(){Yi.turnUpMusic()}checkDailyRewardsOpenable(){const{logDays:e=[],lastRewarded:t=0}=NI.getPlayerData().dailyRewarded;if(e.length>FI.MaxDays)return!0;if(FI.MockTime>0){if(Date.now()-t>=1e3*FI.MockTime)return!0}return!BI.isToday(t)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}handleNavigateToStore(){}async onNavigateToCollections(e){this.navManager.setIgnoreInput();const t=il.getCollectionUnlockProgress(),i=this.getCurrentUnlockingTheme();let n;if(await this.pageManager.navigate(e,(e=>(n=e.getContainer().getComponentInChildren(YE),n.updateUnlockedProgress(t),Promise.resolve()))),void 0===n)throw new Error("CollectionsContent not found");const a=new ai,s=n.shouldAnimateThemeTabUnlock();s&&await this.pageAnimSkipOverlay.open({onSkip:()=>a.abort(),opacity:200}),this.isFirstNavToCollections&&null!==i&&(await n.scrollToCurrentUnlockingTheme(i.skin,a),this.isFirstNavToCollections=!1),await n.playThemeTabUnlockAnim(a),s&&await this.pageAnimSkipOverlay.close(),a.abort(),this.navManager.setIgnoreInput(!1)}async onNavigateToTournaments(e){this.navManager.setIgnoreInput(),await this.pageManager.navigate(e),this.navManager.setIgnoreInput(!1)}async onNavigateToLeaderboard(e){this.navManager.setIgnoreInput(),await this.pageManager.navigate(e),this.navManager.setIgnoreInput(!1)}setHomeDataAndGetNavAnim(){const e=this.pageManager.getPage(ni.home).getContainer().getComponentInChildren(jR);this.coinManager.setTargetContainer(e.getCoinContainer());const t=`Level ${NI.getGameData()?.level??1}`;e.setPlayButtonLabel(t),this.coinManager.emitCoinAmount();const i=NI.getGameData()?.stars??0;e.updateStarProgress(i);const n=OI.getStorage("dashboard");if(null==n)throw new Error("DashboardScene: dashboardStorage not found");const a=n.animateToCurrentLevel??!1,s={...n.lastMapPayload},o={...il.getCurrentMapProgress()},{animateTournamentLeader:r}=OI.getStorage("tournament");if(r)return e.setUnlockProgress(o),async()=>{await this.navManager.selectByType(ni.tournaments)};if(GI.encode(s)===GI.encode(o))return void e.setUnlockProgress(o);if(!a)
//! this is bad for user experience
return void e.setUnlockProgress(o);const l=zI.searchIndex(Wr.mapOrder,(e=>e.id===s.id)),c=zI.searchIndex(Wr.mapOrder,(e=>e.id===o.id)),h=l===c;if(-1===l||-1===c)throw new Error("DashboardScene: map not found");
//! safe guard against dev tools time travel
if(l>c)return void e.setUnlockProgress(o);const d=Wr.mapOrder.slice(l,c+2),u=new ai,p=e.prepareUnlockProgressAnimation(s,o,d,u);return async()=>{await this.pageAnimSkipOverlay.open({onSkip:()=>u.abort(),opacity:150}),await p(),u.aborted||h||await this.navManager.selectByType(ni.collections),await this.pageAnimSkipOverlay.close()}}async handleNavigateToHome(e){let t;this.navManager.setIgnoreInput(),await this.pageManager.navigate(e,(async()=>{t=this.setHomeDataAndGetNavAnim()})),this.navManager.setIgnoreInput(!1),await this.tryOpenDailyRewardsScreen(),await this.coinManager.untilFinishesCollectAnim(),await this.pageAnimSkipOverlay.untilClosed(),await(t?.())}async tryOpenDailyRewardsScreen(){if(this.checkDailyRewardsOpenable())return Bl.openScreen(zi.DAILY_REWARDS_SCREEN),new Promise((e=>{const t=i=>{i.screenName===Ui[zi.DAILY_REWARDS_SCREEN]&&(e(),DI.off(kI.CLOSED_SCREEN,t))};DI.on(kI.CLOSED_SCREEN,t)}))}getCurrentUnlockingTheme(){const e=il.getCollectionUnlockProgress();if(0===e.length)return null;let t=e[0];for(const i of e){const{isLocked:e}=i;e||(t=i)}return t}}).prototype,"coinManager",[yI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TI=ve(CI.prototype,"navManager",[bI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AI=ve(CI.prototype,"bgComp",[fI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RI=ve(CI.prototype,"pageManager",[wI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),II=ve(CI.prototype,"pageAnimSkipOverlay",[SI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vI=CI))||vI);var UI,HI,VI,qI,WI;i._RF.pop(),i._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);const{ccclass:KI,property:YI}=a,{player:jI}=globalThis.game,{getShortNumber:XI}=GameCore.Utils.Number;UI=KI("HomePage"),HI=YI({type:h,group:"Placeholders"}),UI((WI=ve((qI=class extends AC{constructor(){super(...arguments),e(this,"coinLabel",WI,this)}__preload(){super.__preload?.(),this.validateOwnRequiredComponents(),this.listenToCoinUpdateEvent()}listenToCoinUpdateEvent(){this.node.scene.on(Ga.COIN_CHANGED,this.updateplaceholderCoins,this)}async updateplaceholderCoins(e){this.coinLabel.string=XI(e.coins,3)}async mount(){if(await super.mount(),!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(jR),!this.homeContent))throw new Error("HomePage: homeContent not found");const e=jI.getGameData()?.coins??0;this.updateplaceholderCoins({coins:e})}async transitionIn(){await super.transitionIn(),this.homeContent.enableUIAnimator()}async transitionOut(){this.homeContent.disableUIAnimator(),await super.transitionOut()}validateOwnRequiredComponents(){if(!this.coinLabel)throw new Error("HomePage: coinLabel not found")}}).prototype,"coinLabel",[HI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VI=qI));var $I;i._RF.pop(),i._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);const{ccclass:QI}=a;let JI=QI("LeaderboardIsEmpty")($I=class extends s{onLoad(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.uiOpacity.opacity=255;const e=this.node.position.clone(),t=C(this.node);t.to(.05,{position:e.clone().add3f(5,0,0)}),t.to(.05,{position:e.clone().add3f(-5,0,0)});const i=C(this.node).repeat(2,t);i.to(.05,{position:e}),await St.runTweenAsync(i)}hide(){this.uiOpacity.opacity=0}})||$I;var ZI,eP,tP,iP,nP,aP,sP,oP,rP,lP,cP,hP,dP,uP,pP,mP,gP,yP,bP,fP;i._RF.pop(),i._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);const{ccclass:wP,property:SP,requireComponent:vP}=a,{analytics:CP}=globalThis.game,{Array:EP}=GameCore.Utils;let TP=(ZI=wP("SwitchButton"),eP=vP([p,y]),tP=SP(H),iP=SP(n),nP=SP(n),aP=SP(H),sP=SP({visible(){return this.useSound},type:Bi}),oP=SP(H),rP=SP({visible(){return this.useDesktopHover},type:D}),lP=SP({visible(){return this.useDesktopHover},type:D}),ZI(cP=eP((dP=ve((hP=class extends s{constructor(){super(...arguments),e(this,"enable",dP,this),e(this,"nodeOn",uP,this),e(this,"nodeOff",pP,this),e(this,"useSound",mP,this),e(this,"soundKey",gP,this),e(this,"useDesktopHover",yP,this),e(this,"mouseEnterClip",bP,this),e(this,"mouseLeaveClip",fP,this),this.isMouseLeaved=!1,this.onMouseEnter=e=>{this.useDesktopHover&&this.buttonComponent.interactable&&(this.isMouseLeaved=!1,this.animationComponent.play(this.mouseEnterClip.name))},this.onMouseLeave=e=>{this.useDesktopHover&&this.buttonComponent.interactable&&(this.isMouseLeaved||(this.isMouseLeaved=!0,this.animationComponent.play(this.mouseLeaveClip.name)))}}__preload(){this.buttonComponent=this.getComponent(p),this.animationComponent=this.getComponent(y),this.validateRequiredComponents()}onLoad(){const e=this.animationComponent.clips.map((e=>e?.name)).filter((e=>null!=e&&"string"==typeof e));this.useDesktopHover&&(EP.has(e,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),EP.has(e,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onEnable(){this.node.on(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onDisable(){this.node.off(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}switch(){return!!this.node.active&&(CP.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&Yi.playSound(Gi[this.soundKey]),this.updateStatus(!this.enable))}setEnabled(e){this.node.active&&this.updateStatus(e)}updateStatus(e){return this.enable===e||(this.onMouseLeave(null),this.enable=e,this.nodeOn.active=e,this.nodeOff.active=!e),this.enable}}).prototype,"enable",[tP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),uP=ve(hP.prototype,"nodeOn",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pP=ve(hP.prototype,"nodeOff",[nP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mP=ve(hP.prototype,"useSound",[aP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),gP=ve(hP.prototype,"soundKey",[sP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Bi[xi.BUTTON_CLICK]}}),yP=ve(hP.prototype,"useDesktopHover",[oP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),bP=ve(hP.prototype,"mouseEnterClip",[rP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fP=ve(hP.prototype,"mouseLeaveClip",[lP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cP=hP))||cP)||cP);var AP,RP,IP,PP,_P,LP,DP;i._RF.pop(),i._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);const{ccclass:OP,property:NP}=a,{analytics:MP}=globalThis.game;let kP=(AP=OP("Tabs"),RP=NP(TP),IP=NP(TP),AP((LP=ve((_P=class extends s{constructor(){super(...arguments),e(this,"tabWorld",LP,this),e(this,"tabFriends",DP,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}setInteractableButtons(e){this.tabWorld.getComponent(p).interactable=e,this.tabFriends.getComponent(p).interactable=e}updateStatus(e){this.tabWorld.setEnabled("global"===e),this.tabFriends.setEnabled("friends"===e)}handleTabWorldSelect(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),MP.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:Ki.getCurrentPage()}),this.node.scene.emit(pf.WORLD_TAB_SELECTED)}handleTabFriendsSelect(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),MP.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:Ki.getCurrentPage()}),this.node.scene.emit(pf.FRIENDS_TAB_SELECTED)}}).prototype,"tabWorld",[RP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DP=ve(_P.prototype,"tabFriends",[IP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PP=_P))||PP);var xP,FP,BP,GP,zP;i._RF.pop(),i._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);const{ccclass:UP,disallowMultiple:HP,property:VP}=a;let qP=(xP=UP("LeaderSkeleton"),FP=VP(n),xP(BP=HP((zP=ve((GP=class extends s{constructor(){super(...arguments),e(this,"container",zP,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}async hide(e){await St.runTweenAsync(C(this.uiOpacity).to(.2,{opacity:0}).call((()=>{this.node.active=!1})),e)}async show(e,t){this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const i=this.container.position.clone();this.container.position=new j(i.x,i.y-100,i.z);const n=C(this.node).delay(e);n.to(.2,{scale:j.ONE},{easing:"cubicOut"});const a=C(this.container).delay(e);a.to(.2,{position:i},{easing:"cubicOut"});const s=C(this.uiOpacity).delay(e);s.to(.2,{opacity:255},{easing:"cubicOut"}),await Promise.all([St.runTweenAsync(n,t),St.runTweenAsync(a,t),St.runTweenAsync(s,t)])}validateRequiredComponents(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}).prototype,"container",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BP=GP))||BP)||BP);var WP,KP,YP,jP,XP,$P,QP,JP,ZP,e_,t_,i_,n_,a_,s_,o_,r_,l_,c_,h_,d_,u_,p_,m_,g_,y_,b_,f_,w_,S_,v_,C_,E_,T_,A_,R_,I_,P_,__,L_,D_;i._RF.pop(),i._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);const{ccclass:O_,property:N_}=a;let M_=(WP=O_("Leader"),KP=N_(h),YP=N_(x),jP=N_({type:n,group:"Container"}),XP=N_({type:R,group:"Background"}),$P=N_({type:N,group:"Background"}),QP=N_({type:R,group:"Rank"}),JP=N_({type:h,group:"Rank"}),ZP=N_({type:N,group:"Rank"}),e_=N_({type:N,group:"Rank"}),t_=N_({type:N,group:"Rank"}),i_=N_({type:N,group:"Rank"}),n_=N_({type:R,group:"Avatar"}),a_=N_({type:x,group:"Avatar"}),s_=N_({type:R,group:"Score"}),o_=N_({type:h,group:"Score"}),r_=N_({type:N,group:"Score"}),l_=N_({type:x,group:"Score"}),c_=N_({type:x}),h_=N_({type:l}),WP((p_=ve((u_=class extends s{constructor(){super(...arguments),e(this,"nameLabel",p_,this),e(this,"nameOpacity",m_,this),e(this,"container",g_,this),e(this,"background",y_,this),e(this,"highlightBackground",b_,this),e(this,"rankSprite",f_,this),e(this,"rankLabel",w_,this),e(this,"goldRank",S_,this),e(this,"silverRank",v_,this),e(this,"bronzeRank",C_,this),e(this,"highlightRank",E_,this),e(this,"avatar",T_,this),e(this,"avatarOpacity",A_,this),e(this,"scoreBackground",R_,this),e(this,"scoreLabel",I_,this),e(this,"highlightScoreBackground",P_,this),e(this,"scoreOpacity",__,this),e(this,"uiOpacity",L_,this),e(this,"uiTransform",D_,this)}onLoad(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateInfo(e,t){this.updateBackground(e),this.updateRank(e,t),this.resetPhoto(),this.updateUsername(e),this.updateScore(e)}updateBackground(e){this.background.spriteFrame=e.isHighlight?this.highlightBackground:this.defaultBackground}updateRank(e,t){const i=e.rank;if(this.rankLabel.string===i.toString())return;this.rankLabel.string=t&&i>t?`${t}+`:i.toString(),this.rankSprite.spriteFrame=this.defaultRank;let n=new o(ff);switch(e.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,n=new o(Sf)),i){case 1:this.rankSprite.spriteFrame=this.goldRank,n=new o(mf);break;case 2:this.rankSprite.spriteFrame=this.silverRank,n=new o(gf);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,n=new o(yf)}this.rankLabel.shadowColor=n,this.rankLabel.outlineColor=n}setPhoto(e){e&&this.node.active&&(e.packable=!0,this.avatar.spriteFrame=e)}async resetPhoto(){if(!this.defaultAvatar){const e=await li.loadSpriteFrameAsync("images/avatar-bg/spriteFrame");if(!e)return;this.defaultAvatar=e}this.avatar.spriteFrame=this.defaultAvatar}updateUsername(e){this.nameLabel.string=e.name,this.nameLabel.color=new o(e.isHighlight?wf:bf)}updateScore(e){const t=Math.floor(e.score);this.scoreLabel.string=GameCore.Utils.Number.getShortNumber(t,7);const i=this.scoreLabel.getComponent(h);i.outlineColor=new o(e.isHighlight?Sf:ff),i.shadowColor=new o(e.isHighlight?Sf:ff),this.scoreBackground.spriteFrame=e.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}async runShowUpAnimation(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;this.node.scale=new j(.8,.8,.8),this.setOpacity(0);const n=this.container.position.clone();this.container.position=new j(n.x,n.y-100,n.z);const a=C(this.node).delay(t);a.to(i,{scale:j.ONE},{easing:"elasticOut"});const s=C(this.container).delay(t);s.to(i,{position:n},{easing:"backOut"});const o=C(this.uiOpacity).delay(t);o.to(i,{opacity:255},{easing:"cubicOut",onUpdate:()=>{this.nameOpacity.opacity=this.uiOpacity.opacity,this.scoreOpacity.opacity=this.uiOpacity.opacity,this.avatarOpacity.opacity=this.uiOpacity.opacity}}),e.addAbortListener((()=>{this.node.scale=j.ONE,this.container.position=n,this.uiOpacity.opacity=255,this.avatar.node.active=!0})),await Promise.all([St.runTweenAsync(a,e),St.runTweenAsync(s,e),St.runTweenAsync(o,e)])}async runWorldPositionAnimation(e,t){const i=C(this.node).to(t,{worldPosition:e},{easing:"quadOut"});await St.runTweenAsync(i)}async runScaleAnimation(e,t,i){const n=C(this.node).to(i,{scale:new j(t,t,t)},{easing:"backOut"});await St.runTweenAsync(n,e)}async runUpdateDataAnimation(e,t,i,n,a){const s=C({}).to(a,{},{easing:"quartOut",onUpdate:(a,s)=>{if(!s)return;const o=Math.floor(e+(t-e)*s),r=Math.floor(i+(n-i)*s);this.updateRank({rank:o,isHighlight:!0}),this.updateScore({score:r,isHighlight:!0})}});await St.runTweenAsync(s)}setOpacity(e){this.uiOpacity.opacity=e,this.nameOpacity.opacity=e,this.scoreOpacity.opacity=e,this.avatarOpacity.opacity=e}}).prototype,"nameLabel",[KP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m_=ve(u_.prototype,"nameOpacity",[YP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g_=ve(u_.prototype,"container",[jP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y_=ve(u_.prototype,"background",[XP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b_=ve(u_.prototype,"highlightBackground",[$P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f_=ve(u_.prototype,"rankSprite",[QP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w_=ve(u_.prototype,"rankLabel",[JP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S_=ve(u_.prototype,"goldRank",[ZP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v_=ve(u_.prototype,"silverRank",[e_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C_=ve(u_.prototype,"bronzeRank",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E_=ve(u_.prototype,"highlightRank",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T_=ve(u_.prototype,"avatar",[n_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A_=ve(u_.prototype,"avatarOpacity",[a_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R_=ve(u_.prototype,"scoreBackground",[s_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I_=ve(u_.prototype,"scoreLabel",[o_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P_=ve(u_.prototype,"highlightScoreBackground",[r_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),__=ve(u_.prototype,"scoreOpacity",[l_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L_=ve(u_.prototype,"uiOpacity",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_=ve(u_.prototype,"uiTransform",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d_=u_))||d_);var k_,x_,F_,B_,G_,z_,U_,H_,V_,q_,W_,K_,Y_;i._RF.pop(),i._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);const{ccclass:j_,property:X_}=a,{player:$_,frameCapture:Q_}=globalThis.game;let J_=(k_=j_("Leaders"),x_=X_(_),F_=X_(n),B_=X_(T),G_=X_(l),z_=X_(f),k_((V_=ve((H_=class extends s{constructor(){super(...arguments),e(this,"leaderPrefab",V_,this),e(this,"inactiveNodeContainer",q_,this),e(this,"layout",W_,this),e(this,"viewport",K_,this),e(this,"maxLeader",Y_,this),this.cachedPhotos=new Map,this.leaderData=[],this.leaderPoolArray=[],this.playerLeader=null,this.isHidden=!0}onLoad(){this.uiTransform=this.getComponent(l),this.batchNodes=this.getComponents(ar),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}__preload(){this.currentPlayerId=$_.getPlayerId();for(let e=0;e<this.maxLeader;e++){const e=this.createLeader();this.leaderPoolArray.push(e)}const{contentSize:e}=this.leaderPoolArray[0].uiTransform;this.leaderContentHeight=e.height+this.layout.spacingY}createLeader(){const e=c(this.leaderPrefab);return this.addLeaderToInactiveNode(e),e.getComponent(M_)}async updateData(e){if(this.playerLeader=null,this.isHidden=!1,this.leaderData=e,this.leaderData.sort(((e,t)=>t.score-e.score)),null==$_)throw new Error("Player is not defined");this.batchNodes.every((e=>e.enabled=!0)),await Promise.all(this.leaderData.map(((e,t)=>{let{playerId:i,photo:n,score:a,name:s}=e;const o=this.currentPlayerId===i;this.leaderData[t].rank=t+1;const r=this.maxLeader-1;if(t>=r&&!o)return;const l=o&&t>r-1?this.leaderPoolArray[r]:this.leaderPoolArray[t];return this.layout.node.addChild(l.node),l.setOpacity(0),o&&(this.playerLeader=l),l.updateInfo({isHighlight:o,name:s,photo:n,rank:t+1,score:a},r),this.getAndSetLeaderPhoto({playerId:i,url:n,leader:l})})))}async getAndSetLeaderPhoto(e){const{playerId:t,url:i,leader:n}=e;if("default"!==i)if(this.cachedPhotos.has(t))n.setPhoto(this.cachedPhotos.get(t));else try{const e=await this.loadAvatarImage(i,85,85,t);if(!e)return;const a=N.createWithImage(e);this.cachedPhotos.set(t,a),n.setPhoto(a)}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return void console.info("Leaders: getAndSetLeaderPhoto was aborted");throw e}}removeLeaders(){this.isHidden=!0,this.getActiveLeaders().forEach((e=>{e.resetPhoto(),this.addLeaderToInactiveNode(e.node)})),this.batchNodes.every((e=>e.enabled=!1))}getActiveLeaders(){return this.leaderPoolArray.filter((e=>e.node.parent===this.layout.node))}getActiveLeaderChildren(){return this.layout.getComponentsInChildren(M_)}async showLeaders(e){if(this.isHidden)return;const t=this.getActiveLeaders();if(t.length<1)return;const i=Math.ceil(this.viewport.contentSize.height/this.leaderContentHeight),n=Math.min(t.length,i);await Promise.all(t.map((async(t,i)=>{this.isHidden||i<n&&await t.runShowUpAnimation(e,.1*i,.3)})))}async runUpdateLeadersRankAnimation(e,t){const i=e??0;let n=t??this.leaderData.length;n=Math.min(n,100);const a=this.getActiveLeaderChildren(),s=this.leaderContentHeight,o=[];for(let e=i;e<n;e++){a[e].updateRank({rank:e+1,isHighlight:!1});const t=a[e].node.worldPosition.clone();o.push(a[e].runWorldPositionAnimation(t.add3f(0,-s,0),.25))}await Promise.all(o)}getLeaderData(){return this.leaderData}getPlayerLeader(){return this.playerLeader}getLeaderByRank(e){return this.getActiveLeaders()[e-1]||null}getLeaderDataByRank(e){return this.leaderData[e-1]||null}updateVisibility(){const{yMax:e,yMin:t}=this.viewport.getBoundingBoxToWorld();this.getActiveLeaders().forEach((i=>{const n=i.uiTransform;if(void 0===n)return;const{yMax:a,yMin:s}=n.getBoundingBoxToWorld(),o=a<t||s>e;i.setOpacity(o?0:255)}))}async loadAvatarImage(e,t,i,n){try{const a=await Q_.captureAsync({width:t,height:i,name:"LeaderAvatar",renderOptions:{[n]:{name:n,type:"image",depth:0,position:[0,0],size:[t,i],image:e}}});return a?await GameCore.Utils.Image.loadImage(a):null}catch(e){return null}}addLeaderToInactiveNode(e){this.inactiveNodeContainer.addChild(e),e.getComponent(M_).setOpacity(0)}}).prototype,"leaderPrefab",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q_=ve(H_.prototype,"inactiveNodeContainer",[F_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W_=ve(H_.prototype,"layout",[B_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K_=ve(H_.prototype,"viewport",[G_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Y_=ve(H_.prototype,"maxLeader",[z_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U_=H_))||U_);var Z_,eL,tL,iL,nL,aL,sL,oL,rL,lL,cL,hL,dL,uL,pL,mL,gL;i._RF.pop(),i._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);const{ccclass:yL,property:bL}=a,{storage:fL,leaderboard:wL,player:SL}=globalThis.game,{Object:vL,Array:CL}=GameCore.Utils;let EL=(Z_=yL("LeaderboardContent"),eL=bL(hs),tL=bL(kP),iL=bL(J_),nL=bL(ce),aL=bL({type:[qP]}),sL=bL(JI),oL=bL(Hn),Z_((cL=ve((lL=class extends s{constructor(){super(...arguments),e(this,"panelAnimator",cL,this),e(this,"tabs",hL,this),e(this,"leaders",dL,this),e(this,"scrollview",uL,this),e(this,"leaderSkeletons",pL,this),e(this,"leaderboardIsEmpty",mL,this),e(this,"contentOpacity",gL,this),this.isHidden=!0,this.currentLb=null,this.animAbortSignal=null,this.fetchAbortController=null,this.handleUpdateVisibility=()=>{this.leaders.updateVisibility()},this.handleFriendsTabSelected=async()=>{fL.setStorageData("leaderboard_content","lastTabOpened","friends"),this.cleanupSideEffects(),await this.updateStatus("friends")},this.handleWorldTabSelected=async()=>{fL.setStorageData("leaderboard_content","lastTabOpened","global"),this.cleanupSideEffects(),await this.updateStatus("global")},this.hideContent=()=>{this.contentOpacity.changeStateFade(!1,.1)},this.showContent=()=>{this.contentOpacity.changeStateFade(!0,.1)}}onLoad(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}listenEvents(){this.node.scene.on(pf.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(pf.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(Ga.HIDE_UI,this.hideContent),this.node.scene.on(Ga.SHOW_UI,this.showContent),this.scrollview.node.on(ce.EventType.SCROLLING,this.handleUpdateVisibility)}unlistenEvents(){this.node.scene.off(pf.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(pf.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents(),this.scrollview.node.off(ce.EventType.SCROLLING,this.handleUpdateVisibility)}unlistenUIEvents(){this.node.scene.off(Ga.HIDE_UI,this.hideContent),this.node.scene.off(Ga.SHOW_UI,this.showContent)}async loadLeaderboard(e,t){if(t.aborted)return null;const i=this.getLeaderboardName(e);if(!i)return null;const{Limit:n}=GameCore.Configs.Leaderboards;return await wL.requestLeaderboardAsync(i,n),t.aborted?null:wL.getLeaderboard(i)}getLeaderboardName(e){return"friends"===e?Tr:Er}async loadMoreLeaderboard(e,t){if(t.aborted)return null;const i=this.getLeaderboardName(e);return i?(await wL.loadMoreLeaderboardAsync(i,1e3),t.aborted?null:wL.getLeaderboard(i)):null}async showLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.scrollview.scrollToTop(0),this.scrollview.enabled=!1,await Promise.all([this.leaderSkeletons.map(((i,n)=>i.show(n*t,e)))])}async hideLoading(e){await Promise.all(this.leaderSkeletons.map((t=>t.hide(e))))}enter(){this.listenEvents(),this.isHidden=!1;const e=fL.getStorageData("leaderboard_content","lastTabOpened");"friends"===e&&this.handleFriendsTabSelected(),"global"===e&&this.handleWorldTabSelected()}hide(){this.isHidden=!0}cleanup(){this.unlistenEvents(),this.cleanupSideEffects()}cleanupSideEffects(){this.animAbortSignal?.abort(),this.animAbortSignal=null,this.fetchAbortController?.abort(),this.fetchAbortController=null,this.leaders.removeLeaders(),this.leaderboardIsEmpty.hide()}isAborted(){const e=this.animAbortSignal?.aborted??!0,t=this.fetchAbortController?.signal.aborted??!0;return e||t}async updateStatus(e){if(null!==this.animAbortSignal||null!==this.fetchAbortController)throw new Error("LeaderboardContent: LeaderboardContent is already loading. Please handle cancelling gracefully.");if(this.isHidden)return;if(this.tabs.updateStatus(e),this.animAbortSignal=new ai,this.fetchAbortController=new AbortController,await this.showLoading(this.animAbortSignal),this.currentLb=await this.loadLeaderboard(e,this.animAbortSignal),!this.currentLb)return;if(0===vL.vals(this.currentLb.leaders).length)return this.leaderboardIsEmpty.show(),this.tabs.setInteractableButtons(!0),void this.hideLoading(this.animAbortSignal);const t=SL.getPlayerId();let i=this.currentLb.leaders[t];if(!i){const n=this.getLeaderboardName(e);if(n){const e=await wL.getLeadersByPlayerIdsAsync(n,[t]);e.length>0&&(i=e[0],this.currentLb.leaders[t]=i)}}const{previousScore:n,previousRank:a}=fL.getStorage("leaderboard_content"),{score:s,rank:o}=i??{};n&&n<s&&a&&a!==o&&(this.currentLb.leaders[t].score=n);const r=vL.vals(this.currentLb.leaders);if(li.setBlockInput(!0),this.tabs.setInteractableButtons(!1),await this.hideLoading(this.animAbortSignal),this.isAborted())return li.setBlockInput(!1),void this.tabs.setInteractableButtons(!0);if(this.leaders.updateData(r),this.scrollview.enabled=!0,await this.leaders.showLeaders(this.animAbortSignal),this.isAborted())return li.setBlockInput(!1),void this.tabs.setInteractableButtons(!0);const l=this.leaders.getPlayerLeader();return l?(await this.scrollToLeader(l,1),this.isAborted()?(li.setBlockInput(!1),void this.tabs.setInteractableButtons(!0)):(await this.runPlayerRankChangeAnimation(this.animAbortSignal,s),this.isAborted()?(li.setBlockInput(!1),void this.tabs.setInteractableButtons(!0)):(fL.setStorageData("leaderboard_content","previousScore",s),fL.setStorageData("leaderboard_content","previousRank",o),li.setBlockInput(!1),void this.tabs.setInteractableButtons(!0)))):(li.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))}async runPlayerRankChangeAnimation(e,t){const{previousScore:i}=fL.getStorage("leaderboard_content");if(!i||i>=t)return;const n=this.leaders.getLeaderData(),a=CL.searchIndex(n,(e=>e.playerId===SL.getPlayerId()));if(-1===a)return;const s=n[a],{score:o,rank:r}=s;s.score=t,n.sort(((e,t)=>t.score-e.score)),n.forEach(((e,t)=>{e.rank=t+1}));const l=this.leaders.getPlayerLeader();if(!l)return;if(r===s.rank)return void l.updateScore({score:s.score,isHighlight:!0});const c=this.leaders.getLeaderByRank(s.rank);if(!c)return;this.leaders.layout.enabled=!1,await l.runScaleAnimation(e,1.1,.5);const h=Math.min(.5*(r-s.rank),2),d=[l.runUpdateDataAnimation(r,s.rank,o,s.score,h),this.scrollToLeader(c,h)],u=this.uiTransform.contentSize.height,p=this.scrollview.getMaxScrollOffset().y,m=-c.node.position.y-u/2;let g=j.ZERO;m<0?g=new j(l.node.worldPosition.x,u+c.node.position.y,l.node.worldPosition.z):this.scrollview.getScrollOffset().y>=p-5&&(g=m<p?new j(l.node.worldPosition.x,u/2,l.node.worldPosition.z):c.node.worldPosition),g.equals(j.ZERO)||d.push(l.runWorldPositionAnimation(g,h)),await Promise.all(d),await Promise.all([l.runScaleAnimation(e,1,.25),l.node.setSiblingIndex(s.rank-1),this.leaders.runUpdateLeadersRankAnimation(s.rank,r)]),this.leaders.layout.enabled=!0,this.leaders.layout.updateLayout()}async scrollToLeader(e,t){const{contentSize:i}=this.uiTransform,n=new Q(0,-e.node.position.y-i.height/2),a=this.scrollview.getScrollOffset().clone();n.y=Math.max(n.y,0),a.y=Math.max(a.y,0);const s=n.y-a.y;if(!(Math.abs(s)<5))return this.scrollview.scrollToOffset(n,t),St.waitTweenAsync(t)}}).prototype,"panelAnimator",[eL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hL=ve(lL.prototype,"tabs",[tL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dL=ve(lL.prototype,"leaders",[iL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uL=ve(lL.prototype,"scrollview",[nL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pL=ve(lL.prototype,"leaderSkeletons",[aL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mL=ve(lL.prototype,"leaderboardIsEmpty",[sL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gL=ve(lL.prototype,"contentOpacity",[oL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rL=lL))||rL);var TL;i._RF.pop(),i._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);const{ccclass:AL}=a;AL("LeaderboardPage")(TL=class extends AC{async mount(){if(!this.pagePrefab){const e=await li.loadPrefabAsync(si.LEADERBOARD_PAGE);e&&this.node&&(this.pagePrefab=e)}if(await super.mount(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(EL),!this.content)throw new Error("LeaderboardPage: Leaders not found")}async transitionIn(){await super.transitionIn(),this.content.enableUIAnimator();const e=St.runTweenAsync(C(this.containerUIOpacity).to(.2,{opacity:255})),t=new Promise((e=>{this.node.scene.emit(Ga.SHOW_UI,{onComplete:()=>{e()}})}));await Promise.all([e,t]),this.content.enter()}async transitionOut(){await super.transitionOut(),this.content.unlistenUIEvents(),await new Promise((e=>{this.node.scene.emit(Ga.HIDE_UI,{onComplete:()=>{e()}})})),this.content.disableUIAnimator()}unmount(){this.content?.hide(),this.content?.cleanup(),super.unmount()}});var RL,IL,PL,_L,LL,DL,OL,NL,ML,kL,xL,FL,BL,GL,zL,UL,HL;i._RF.pop(),i._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);const{ccclass:VL,property:qL}=a,{leaderboard:WL,player:KL}=globalThis.game;let YL=(RL=VL("TournamentBlock"),IL=qL(n),PL=qL(h),_L=qL(h),LL=qL(h),DL=qL(h),OL=qL(l),NL=qL({type:[R]}),RL((xL=ve((kL=class extends s{constructor(){super(...arguments),e(this,"container",xL,this),e(this,"titleLabel",FL,this),e(this,"timeLabel",BL,this),e(this,"playerCountLabel",GL,this),e(this,"playButtonLabel",zL,this),e(this,"uiTransform",UL,this),e(this,"banners",HL,this)}onLoad(){this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents()}activateThemeBanner(e){let t=!1;this.banners.forEach((i=>{i.node.active=i.node.name.toLowerCase()===e,i.node.active&&(t=!0)})),t||this.banners.forEach((e=>{e.node.active=e.node.name.toLowerCase()===Xr.SUMMER}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async updateInfo(e){this.payload=e;const{endTime:t,title:i}=e,{leaderboardId:n,themeId:a}=e.payload;if(!n)return;this.setPlayerCountWaiting(),this.updateTitle(i),this.updateEndTime(t),this.updateTournamentBanner(a);let s={leaders:[],isPlayerInTournament:!1};try{const e=await this.getLeadersPayload(n);e&&(s=e)}catch(e){console.error(`Fetch lb for tournament ${i}`,e)}this.leadersPayload=s;const{leaders:o,isPlayerInTournament:r}=this.leadersPayload,l=o.length;this.updatePlayerCount(l),this.updatePlayButtonLabel(r)}updateTitle(e){e&&(this.titleLabel.string=e)}updateEndTime(e){const t=GameCore.Utils.Time.getRelativeTime(e);this.timeLabel.string=`Ends ${t}`}updatePlayerCount(e){this.playerCountLabel.string=`${e} `+(e>1?"players":"player")}setPlayerCountWaiting(){this.playerCountLabel.string="Loading..."}updateTournamentBanner(e){e?this.activateThemeBanner(e):this.activateThemeBanner(Xr.SUMMER)}updatePlayButtonLabel(e){this.playButtonLabel.string=e?"Continue":"Join"}async getLeadersPayload(e){const t=WL.getLeaderboardName(e);if(!t)return null;await WL.requestLeaderboardAsync(t,0);const i=WL.getLeaderboard(t);if(!i)return null;const n=GameCore.Utils.Object.vals(i.leaders),a=KL.getPlayerId(),s={leaders:[],player:void 0,isPlayerInTournament:!1};for(const e of n){const{playerId:t}=e;t===a?(s.player=e,s.isPlayerInTournament=!0,s.leaders.push(e)):s.leaders.push(e)}return s}async runShowPopUpAnimation(e,t,i){this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const n=this.container.position.clone();this.container.position=new j(n.x,n.y-100,n.z);const a=C(this.node).delay(e);a.to(t,{scale:j.ONE},{easing:"elasticOut"});const s=C(this.container).delay(e);s.to(t,{position:n},{easing:"backOut"});const o=C(this.uiOpacity).delay(e);o.to(t,{opacity:255},{easing:"cubicOut"}),i.addAbortListener((()=>{this.node.scale=j.ONE,this.container.position=n,this.uiOpacity.opacity=255})),await Promise.all([St.runTweenAsync(a,i),St.runTweenAsync(s,i),St.runTweenAsync(o,i)])}handleOnTournamentClicked(){const e=this.payload.id||"";if(Kl.validateTournamentExpired(e))return this.node.scene.emit(Nr.RELOAD_TOURNAMENT),void Bl.showNotificationScreen("Tournament has ended",2);try{const e=JSON.stringify(this.payload);Bl.showTournamentDetailScreen(e,"tournament_start")}catch(e){console.warn("handleOnTournamentClicked",e)}}}).prototype,"container",[IL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FL=ve(kL.prototype,"titleLabel",[PL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BL=ve(kL.prototype,"timeLabel",[_L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GL=ve(kL.prototype,"playerCountLabel",[LL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zL=ve(kL.prototype,"playButtonLabel",[DL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UL=ve(kL.prototype,"uiTransform",[OL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HL=ve(kL.prototype,"banners",[NL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ML=kL))||ML);var jL,XL,$L,QL,JL;i._RF.pop(),i._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);const{ccclass:ZL,property:eD}=a;let tD=(jL=ZL("TournamentBlockSkeleton"),XL=eD(n),jL((JL=ve((QL=class extends s{constructor(){super(...arguments),e(this,"container",JL,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async hide(e){await St.runTweenAsync(C(this.uiOpacity).to(.2,{opacity:0}).call((()=>{this.node.active=!1})),e)}async show(e,t){this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const i=this.container.position.clone();this.container.position=new j(i.x,i.y-100,i.z);const n=C(this.node).delay(e);n.to(.2,{scale:j.ONE},{easing:"elasticOut"});const a=C(this.container).delay(e);a.to(.2,{position:i},{easing:"backOut"});const s=C(this.uiOpacity).delay(e);s.to(.2,{opacity:255},{easing:"cubicOut"}),t.addAbortListener((()=>{this.node.scale=j.ONE,this.container.position=i,this.uiOpacity.opacity=255})),await Promise.all([St.runTweenAsync(n,t),St.runTweenAsync(a,t),St.runTweenAsync(s,t)])}}).prototype,"container",[XL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$L=QL))||$L);var iD,nD,aD,sD,oD,rD,lD,cD,hD,dD,uD;i._RF.pop(),i._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);const{ccclass:pD,property:mD}=a,{player:gD}=globalThis.game;let yD=(iD=pD("TournamentsBoard"),nD=mD(_),aD=mD(n),sD=mD(T),oD=mD(n),iD((cD=ve((lD=class extends s{constructor(){super(...arguments),e(this,"tournamentBlockPrefab",cD,this),this.tournamentBlockArray=[],e(this,"inactiveNodeContainer",hD,this),e(this,"layout",dD,this),e(this,"createTournamentButton",uD,this)}onLoad(){this.uiTransform=this.getComponent(l),this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}start(){for(let e=0;e<20;e++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateData(e){let t=!1;e.forEach(((e,i)=>{let n=this.tournamentBlockArray[i];e.payload.playerId===gD.getPlayerId()&&(t=!0),n||(n=this.addTournamentBlock()),n.updateInfo(e),this.layout.node.addChild(n.node)})),t||this.setCreateTournamentButtonActive(!0)}addTournamentBlock(){const e=c(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(e);const t=e.getComponent(YL);return this.tournamentBlockArray.push(t),t}removeTournamentBlocks(){this.getActiveTournamentBlocks().forEach((e=>{this.inactiveNodeContainer.addChild(e.node)})),this.setCreateTournamentButtonActive(!1)}getActiveTournamentBlocks(){return this.tournamentBlockArray.filter((e=>e.node.parent===this.layout.node))}setCreateTournamentButtonActive(e){e?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=e}async showTournamentBlocks(e,t){const i=this.getActiveTournamentBlocks();if(i.length<1)return;const n=Math.ceil(e/this.tournamentBlockContentHeight),a=Math.min(i.length,n);await Promise.all(i.map((async(e,i)=>{i>=a?await e.runShowPopUpAnimation(.1*i,.3,t):e.uiOpacity.opacity=255})))}updateVisibility(){const{yMax:e,yMin:t}=this.uiTransform.getBoundingBoxToWorld();this.getActiveTournamentBlocks().forEach((i=>{const n=i.uiTransform;if(void 0===n)return;const{yMax:a,yMin:s}=n.getBoundingBoxToWorld(),o=a<t||s>e;i.uiOpacity.opacity=o?0:255}))}}).prototype,"tournamentBlockPrefab",[nD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hD=ve(lD.prototype,"inactiveNodeContainer",[aD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dD=ve(lD.prototype,"layout",[sD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uD=ve(lD.prototype,"createTournamentButton",[oD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rD=lD))||rD);var bD,fD,wD,SD,vD;i._RF.pop(),i._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);const{ccclass:CD,property:ED}=a;let TD=(bD=CD("TournamentsNotAvailable"),fD=ED(p),bD((vD=ve((SD=class extends s{constructor(){super(...arguments),e(this,"createButton",vD,this)}onLoad(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.createButton.interactable=!0,this.uiOpacity.opacity=255;const e=this.node.position.clone(),t=C(this.node);t.to(.05,{position:e.clone().add3f(5,0,0)}),t.to(.05,{position:e.clone().add3f(-5,0,0)});const i=C(this.node).repeat(2,t);i.to(.05,{position:e}),await St.runTweenAsync(i)}hide(){this.createButton.interactable=!1,this.uiOpacity.opacity=0}}).prototype,"createButton",[fD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wD=SD))||wD);var AD,RD,ID,PD,_D,LD,DD,OD,ND,MD,kD,xD,FD,BD,GD;i._RF.pop(),i._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);const{ccclass:zD,property:UD}=a,{storage:HD,match:VD}=globalThis.game,{Object:qD,Array:WD}=GameCore.Utils;let KD=(AD=zD("TournamentContent"),RD=UD({type:hs}),ID=UD(yD),PD=UD(TD),_D=UD(ce),LD=UD({type:[tD]}),DD=UD(Hn),AD((MD=ve((ND=class extends s{constructor(){super(...arguments),e(this,"panelAnimator",MD,this),e(this,"tournamentsBoard",kD,this),e(this,"tournamentsNotAvailable",xD,this),e(this,"scrollView",FD,this),e(this,"skeletons",BD,this),e(this,"contentOpacity",GD,this),this.animAbortSignal=null,this.softAbortSignal=null,this.hideContent=()=>{this.contentOpacity.changeStateFade(!1,.1)},this.showContent=()=>{this.contentOpacity.changeStateFade(!0,.1)}}onLoad(){this.uiTransform=this.node.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenEvents(){this.scrollView.node.on(ce.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(Nr.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(Ga.HIDE_UI,this.hideContent),this.node.scene.on(Ga.SHOW_UI,this.showContent)}unlistenEvents(){this.scrollView.node.off(ce.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(Nr.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}unlistenUIEvents(){this.node.scene.off(Ga.HIDE_UI,this.hideContent),this.node.scene.off(Ga.SHOW_UI,this.showContent)}onScrolling(){this.tournamentsBoard.updateVisibility()}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}async enter(){if(this.listenEvents(),null!==this.animAbortSignal||null!==this.softAbortSignal)throw new Error("TournamentContent: TournamentContent is already running");if(this.animAbortSignal=new ai,this.softAbortSignal=new ai,await this.showLoading(this.animAbortSignal),this.isAborted())return;const e=await Kl.requestTournamentDataAsync();this.isAborted()||(await this.hideLoading(this.animAbortSignal),this.isAborted()||(0!==e.length||this.softAbortSignal?.aborted?(this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(e),await this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal)):this.tournamentsNotAvailable.show()))}async showLoading(e){this.scrollView.scrollToTop(0),this.scrollView.enabled=!1,await Promise.all([this.skeletons.map((t=>t.show(0,e)))])}async hideLoading(e){await Promise.all([this.skeletons.map((t=>t.hide(e)))])}tryShowTournamentResult(){try{const{animateTournamentLeader:e}=HD.getStorage("tournament");if(!e)return;const t=Kl.getAllTournamentData(),{tournamentId:i}=VD.getMatchState().customData;if(!i)throw new Error("Tournament ID not found");const n=WD.search(t,(e=>e.id===i));if(!n)throw new Error("Tournament not found");const a=JSON.stringify(n);Bl.showTournamentDetailScreen(a,"tournament_end")}catch(e){HD.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",e)}}async processCreateTournament(){try{await ul.processCreateTournamentAsync()}catch(e){if(!qD.hasOwn(e,"code"))return void Bl.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament");if("USER_INPUT"===e.code)return;"INVALID_OPERATION"===e.code?Bl.showNotificationScreen(e.message):Bl.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament")}this.reload()}isAborted(){return this.animAbortSignal?.aborted??!0}cleanup(){this.unlistenEvents(),this.animAbortSignal?.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}softAbort(){this.softAbortSignal?.abort(),this.softAbortSignal=null}reload(){this.softAbort(),this.cleanup(),this.enter()}}).prototype,"panelAnimator",[RD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kD=ve(ND.prototype,"tournamentsBoard",[ID],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xD=ve(ND.prototype,"tournamentsNotAvailable",[PD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FD=ve(ND.prototype,"scrollView",[_D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BD=ve(ND.prototype,"skeletons",[LD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GD=ve(ND.prototype,"contentOpacity",[DD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OD=ND))||OD);var YD;i._RF.pop(),i._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);const{ccclass:jD}=a;jD("TournamentPage")(YD=class extends AC{async mount(){if(!this.pagePrefab){const e=await li.loadPrefabAsync(si.TOURNAMENTS_PAGE);e&&this.node&&(this.pagePrefab=e)}if(await super.mount(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(KD),!this.content)throw new Error("LeaderboardPage: Leaders not found")}async transitionIn(){await super.transitionIn(),this.content.enableUIAnimator();const e=St.runTweenAsync(C(this.containerUIOpacity).to(.2,{opacity:255})),t=new Promise((e=>{this.node.scene.emit(Ga.SHOW_UI,{onComplete:()=>{e()}})}));await Promise.all([e,t]),this.content.enter()}async transitionOut(){this.content?.softAbort(),this.content.unlistenUIEvents(),await super.transitionOut(),await new Promise((e=>{this.node.scene.emit(Ga.HIDE_UI,{onComplete:()=>{e()}})})),this.content.disableUIAnimator()}unmount(){this.content?.cleanup(),super.unmount()}});var XD,$D,QD,JD,ZD,eO;i._RF.pop(),i._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);const{ccclass:tO,property:iO}=a;XD=tO("EventBadge"),$D=iO(h),QD=iO(b),XD((eO=ve((ZD=class extends s{constructor(){super(...arguments),e(this,"label",eO,this)}get text(){return this.label.string}set text(e){this.label.string=e}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}).prototype,"label",[$D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(ZD.prototype,"text",[QD],Object.getOwnPropertyDescriptor(ZD.prototype,"text"),ZD.prototype),JD=ZD));var nO,aO,sO,oO,rO,lO,cO,hO,dO;i._RF.pop(),i._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);const{ccclass:uO,property:pO}=a;nO=uO("EventProgressBar"),aO=pO(ks),sO=pO(h),oO=pO(b),rO=pO({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),nO((hO=ve((cO=class extends s{constructor(){super(...arguments),e(this,"progressBar",hO,this),e(this,"progressLabel",dO,this)}get text(){return this.progressLabel.string}get progress(){return this.progressBar.progress}set progress(e){this.progressBar.progress=e}set text(e){this.progressLabel.string=e}__preload(){}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}).prototype,"progressBar",[aO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dO=ve(cO.prototype,"progressLabel",[sO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(cO.prototype,"text",[oO],Object.getOwnPropertyDescriptor(cO.prototype,"text"),cO.prototype),ve(cO.prototype,"progress",[rO],Object.getOwnPropertyDescriptor(cO.prototype,"progress"),cO.prototype),lO=cO));var mO,gO,yO,bO,fO,wO,SO,vO,CO,EO,TO,AO,RO,IO,PO,_O,LO,DO,OO,NO,MO,kO,xO,FO,BO,GO,zO,UO,HO,VO,qO,WO,KO,YO,jO,XO,$O,QO,JO,ZO,eN,tN,iN,nN,aN;i._RF.pop(),i._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);const{ccclass:sN,property:oN,executeInEditMode:rN}=a,{analytics:lN}=globalThis.game;mO=sN("NavButton"),gO=oN(H),yO=oN({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),bO=oN({type:E,group:{name:"Animation"}}),fO=oN({type:E,group:{name:"Animation"}}),wO=oN({type:E,group:{name:"Animation"}}),SO=oN({type:E,group:{name:"Animation"}}),vO=oN({type:E,group:{name:"Animation"}}),CO=oN({group:{name:"Animation"}}),EO=oN({type:E,group:{name:"Animation"}}),TO=oN({type:E,group:{name:"Animation"}}),AO=oN({group:{name:"Animation"}}),RO=oN({type:E,group:{name:"Animation"}}),IO=oN({type:E,group:{name:"Animation"}}),PO=oN({type:E,group:{name:"Animation"}}),_O=oN({type:E,group:{name:"Animation"}}),LO=oN({type:l}),DO=oN(n),OO=oN(x),NO=oN({type:l}),MO=oN({type:M(ni)}),kO=oN(mI),mO(xO=rN((BO=ve((FO=class extends s{constructor(){super(...arguments),e(this,"wip",BO,this),e(this,"isSelectedInEditor",GO,this),e(this,"animationDuration",zO,this),e(this,"selectedSpacing",UO,this),e(this,"deselectedSpacing",HO,this),e(this,"selectedIconY",VO,this),e(this,"selectedIconX",qO,this),e(this,"selectedIconScale",WO,this),e(this,"deselectedIconY",KO,this),e(this,"deselectedIconX",YO,this),e(this,"deselectedIconScale",jO,this),e(this,"selectedTextY",XO,this),e(this,"selectedTextX",$O,this),e(this,"deselectedTextY",QO,this),e(this,"deselectedTextX",JO,this),e(this,"spacer",ZO,this),e(this,"icon",eN,this),e(this,"text",tN,this),e(this,"uiTransform",iN,this),e(this,"screenType",nN,this),e(this,"navManager",aN,this),this.isSelected=!1,this.onMouseEnter=e=>{this.isSelected||this.playHoverOnAnimation()},this.onMouseLeave=e=>{this.isSelected||this.playHoverOffAnimation()}}get isWIP(){return this.wip}get buttonType(){return this.screenType}update(){}onEnable(){this.node.on(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onDisable(){this.node.off(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onEditorUpdate(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}setSelected(){this.isSelected||(Yi.playSound(xi.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),lN.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.parent?.name??this.node.name,screen_name:Ki.getCurrentPage()}))}async select(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0,e?await St.runTweenAsync(this.playSelectAnimation()):(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255)}async deselect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isSelected&&!t)throw new Error("NavButton: Already deselected");this.isSelected=!1,e?await St.runTweenAsync(this.deselectAnimation()):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0)}getSelectedWorldDistanceX(){const e=new j(this.selectedIconX,this.selectedIconY,0),t=new j(this.deselectedIconX,this.deselectedIconY,0),i=this.node.scale.clone();this.node.scale=this.selectedIconScale;const n=this.uiTransform.convertToWorldSpaceAR(e),a=this.uiTransform.convertToWorldSpaceAR(t);return this.node.scale=i,a.x-n.x}playHoverOnAnimation(){const e=C(this.icon);return e.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),St.runTweenAsync(e)}playHoverOffAnimation(){const e=C(this.icon);return e.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),St.runTweenAsync(e)}playSelectAnimation(){return C(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:(e,t)=>{if(void 0===t)return;const i=k.quintInOut(t),n=k.backOut(t),a=k.linear(t),s=t<.5?2*t:1,o=this.deselectedIconY+(this.selectedIconY-this.deselectedIconY)*n,r=this.deselectedIconX+(this.selectedIconX-this.deselectedIconX)*a;this.icon.setPosition(r,o,0);const l=this.deselectedIconScale.clone().lerp(this.selectedIconScale,i);this.icon.setScale(l.x,l.y,this.icon.scale.z);const c=255*s,h=this.deselectedTextY+(this.selectedTextY-this.deselectedTextY)*a,d=this.deselectedTextX+(this.selectedTextX-this.deselectedTextX)*a;this.text.opacity=c,this.text.node.setPosition(d,h,0)}})}deselectAnimation(){return C(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:(e,t)=>{if(void 0===t)return;const i=he(this.selectedIconY,this.deselectedIconY,t),n=he(this.selectedIconX,this.deselectedIconX,t);this.icon.setPosition(n,i,0);const a=he(255,0,t<.5?2*t:1);this.text.opacity=a;const s=he(this.selectedTextY,this.deselectedTextY,t),o=he(this.selectedTextX,this.deselectedTextX,t);this.text.node.setPosition(o,s,0);const r=this.selectedIconScale.clone().lerp(this.deselectedIconScale,k.quintInOut(t));this.icon.setScale(r.x,r.y,this.icon.scale.z)}})}onLoad(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"wip",[gO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),GO=ve(FO.prototype,"isSelectedInEditor",[yO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),zO=ve(FO.prototype,"animationDuration",[bO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),UO=ve(FO.prototype,"selectedSpacing",[fO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),HO=ve(FO.prototype,"deselectedSpacing",[wO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),VO=ve(FO.prototype,"selectedIconY",[SO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),qO=ve(FO.prototype,"selectedIconX",[vO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WO=ve(FO.prototype,"selectedIconScale",[CO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(1,1,1)}}),KO=ve(FO.prototype,"deselectedIconY",[EO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YO=ve(FO.prototype,"deselectedIconX",[TO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jO=ve(FO.prototype,"deselectedIconScale",[AO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(.8,.8,1)}}),XO=ve(FO.prototype,"selectedTextY",[RO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-10}}),$O=ve(FO.prototype,"selectedTextX",[IO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),QO=ve(FO.prototype,"deselectedTextY",[PO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),JO=ve(FO.prototype,"deselectedTextX",[_O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ZO=ve(FO.prototype,"spacer",[LO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eN=ve(FO.prototype,"icon",[DO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tN=ve(FO.prototype,"text",[OO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iN=ve(FO.prototype,"uiTransform",[NO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nN=ve(FO.prototype,"screenType",[MO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aN=ve(FO.prototype,"navManager",[kO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xO=FO))||xO);var cN,hN,dN,uN,pN,mN,gN;i._RF.pop(),i._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);const{ccclass:yN,property:bN,disallowMultiple:fN}=a,{audio:wN,player:SN}=globalThis.game,{Layout:vN}=ea;cN=yN("GameScene"),hN=bN(wv),dN=bN(Lw),cN(uN=fN((mN=ve((pN=class extends s{constructor(){super(...arguments),e(this,"animSkipOverlay",mN,this),e(this,"coinManager",gN,this),this.handleGameExit=()=>{bg.hideBannerAds(),gl.switchScene(Dr)},this.handleShowResults=()=>{gl.switchScene(Or)},this.handleGameMaskWhenLayoutChanged=e=>{const t=P("Canvas/Game/GameObjects");if(!t)return;const i=t.getComponent(de);i&&(i.enabled=e===vN.Landscape)},this.attemptCallSubscribeBot=()=>{"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch((e=>{console.warn("subscribeBotAsync",e)}))}}__preload(){this.validateRequiredComponents(),this.listenGameEvents(),bg.showBannerAds()}onLoad(){this.coinManager.init(this.animSkipOverlay)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenGameEvents(){W.on(Kn,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(Ga.GAME_EXIT,this.handleGameExit),this.node.scene.on(Ga.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}start(){this.scheduleOnce(this.attemptCallSubscribeBot,.5),SN.getPlayerSetting("music")&&Yi.playMusic(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}preloadScenes(){gl.preloadDashboardScene()}updateVolumeBackgroundMusic(){wN.setVolume(1,"global_music")}}).prototype,"animSkipOverlay",[hN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gN=ve(pN.prototype,"coinManager",[dN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uN=pN))||uN);var CN,EN,TN,AN,RN,IN,PN,_N,LN,DN,ON,NN,MN,kN,xN;i._RF.pop(),i._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);const{ccclass:FN,property:BN}=a;CN=FN("ItemButton"),EN=BN(H),TN=BN(p),AN=BN({type:f}),RN=BN(h),IN=BN(n),PN=BN(n),CN((DN=ve((LN=class extends s{constructor(){super(...arguments),e(this,"isDebug",DN,this),e(this,"button",ON,this),e(this,"quantity",NN,this),e(this,"quantityLabel",MN,this),e(this,"plusNode",kN,this),e(this,"quantityNode",xN,this)}__preload(){this.item=this.getComponent(eg),this.validateRequiredComponents()}start(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string=`${this.quantity}`,this.validateButton(),this.node.scene.on(Ga.GRID_CREATE,this.validateButton,this),this.node.scene.on(Ga.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(Ga.GRID_CLEAR,this.validateButton,this)}validateRequiredComponents(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}validateButton(){console.log("VALIDATE BUTTON"),this.canActivate().then((e=>{this.button.interactable=!0,this.plusNode.active=0==this.quantity,this.quantityNode.active=this.quantity>0}))}activate(){return new Promise((e=>{if(this.quantity<=0)return this.handleShowAddItemScreen(),void e();this.item.activate().then((()=>{this.isDebug||(this.quantity--,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity()),this.validateButton(),e()}))}))}canActivate(){return Promise.resolve(!0)}addQuantity(e){this.quantity+=e,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}clearQuantity(){this.quantity=0,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}handleShowAddItemScreen(){Bl.openScreen(zi.GET_ITEM_SCREEN,{item:dr.HINT,quantity:1})}}).prototype,"isDebug",[EN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ON=ve(LN.prototype,"button",[TN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NN=ve(LN.prototype,"quantity",[AN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),MN=ve(LN.prototype,"quantityLabel",[RN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kN=ve(LN.prototype,"plusNode",[IN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xN=ve(LN.prototype,"quantityNode",[PN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_N=LN));var GN,zN,UN,HN,VN,qN,WN;i._RF.pop(),i._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);const{ccclass:KN,property:YN}=a;GN=KN("ComboEffect"),zN=YN(x),UN=YN(se),GN((qN=ve((VN=class extends s{constructor(){super(...arguments),e(this,"circleOpacity",qN,this),e(this,"particle",WN,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.circleOpacity)throw new Error("ComboEffect requires a circleOpacity component");if(!this.particle)throw new Error("ComboEffect requires a particle component")}start(){this.node.scene.on(Ga.COMBO_UPDATED,this.handleOnComboUpdated,this)}handleOnComboUpdated(e){e>1&&(this.circleOpacity.node.scale=j.ZERO,this.circleOpacity.opacity=127.5,this.particle.resetSystem(),C(this.circleOpacity.node).to(.2,{scale:new j(1.3,1.3,1.3)},{easing:"quadOut"}).start(),C(this.circleOpacity).delay(.2).to(.2,{opacity:0},{easing:"expoIn"}).start())}}).prototype,"circleOpacity",[zN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WN=ve(VN.prototype,"particle",[UN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HN=VN));var jN,XN,$N,QN,JN,ZN,eM;i._RF.pop(),i._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);const{ccclass:tM,property:iM}=a;jN=tM("ComboLabel"),XN=iM(h),$N=iM(n),jN((ZN=ve((JN=class extends s{constructor(){super(...arguments),e(this,"comboNumber",ZN,this),e(this,"comboContainer",eM,this)}onLoad(){this.opacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}start(){this.node.scene.on(Ga.COMBO_UPDATED,this.handleOnComboUpdated,this)}handleOnComboUpdated(e){0===e?this.opacity.opacity=0:e>1?(this.opacity.opacity=255,this.comboNumber.string=`${e}`,C(this.comboContainer).to(.1,{scale:new j(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:j.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}).prototype,"comboNumber",[XN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eM=ve(JN.prototype,"comboContainer",[$N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QN=JN));var nM,aM,sM,oM,rM,lM,cM,hM,dM;i._RF.pop(),i._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);const{ccclass:uM,property:pM}=a;nM=uM("ComboPopup"),aM=pM(R),sM=pM(N),oM=pM(y),nM((cM=ve((lM=class extends s{constructor(){super(...arguments),e(this,"textSprite",cM,this),e(this,"comboSprites",hM,this),e(this,"animation",dM,this)}onLoad(){this.validateRequiredComponents()}start(){this.node.scene.on(Ga.COMBO_UPDATED,this.handleOnComboUpdated,this)}validateRequiredComponents(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}handleOnComboUpdated(e){if(!(e<2))for(let t=this.comboSprites.length-1;t>=0;t--)if(e>=t+2){this.textSprite.spriteFrame=this.comboSprites[t],this.animation.play();break}}}).prototype,"textSprite",[aM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hM=ve(lM.prototype,"comboSprites",[sM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dM=ve(lM.prototype,"animation",[oM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rM=lM));var mM,gM,yM,bM,fM,wM,SM,vM,CM;i._RF.pop(),i._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);const{ccclass:EM,property:TM}=a;let AM=(mM=EM("PlayerScore"),gM=TM(n),yM=TM(h),bM=TM(R),mM((SM=ve((wM=class extends s{constructor(){super(...arguments),e(this,"crown",SM,this),e(this,"playerScore",vM,this),e(this,"avatar",CM,this)}showCrown(e){this.crown.active=e}setPlayerScore(e){this.playerScore.string=e.toString()}playWaitingAnimation(){let e=0;this.playerScore.schedule((()=>{e=(e+1)%4;const t=Array(e+1).join(".");this.playerScore.string="Waiting"+t}),.5);const t=this.playerScore.getComponent(x),i=C(t).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=C(t).repeatForever(i).start()}stopWaitingAnimation(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(x).opacity=255}async loadPhoto(e){try{const t=await GameCore.Utils.Image.loadImage(e);if(!t)throw new Error("Failed to load image");const i=N.createWithImage(t);if(!i)throw new Error("Failed to create sprite frame");i.packable=!0,this.avatar.spriteFrame=i}catch(e){return void console.error(e)}}}).prototype,"crown",[gM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vM=ve(wM.prototype,"playerScore",[yM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CM=ve(wM.prototype,"avatar",[bM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fM=wM))||fM);var RM,IM,PM,_M,LM,DM,OM,NM,MM,kM,xM,FM,BM,GM,zM;i._RF.pop(),i._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);const{ccclass:UM,disallowMultiple:HM,property:VM}=a,{match:qM,player:WM,monitorError:KM}=globalThis.game,YM="Waiting";RM=UM("ChallengeResultScene"),IM=VM(f),PM=VM({type:AM,group:"Score"}),_M=VM({type:AM,group:"Score"}),LM=VM(MS),DM=VM(h),OM=VM(lg),RM(NM=HM((kM=ve((MM=class extends s{constructor(){super(...arguments),e(this,"pollingInterval",kM,this),e(this,"playerScore",xM,this),e(this,"opponentScore",FM,this),e(this,"paperConfetti",BM,this),e(this,"titleText",GM,this),e(this,"levelManager",zM,this),this.goToDashboardScene=()=>{bg.hideBannerAds(),gl.switchScene(Dr)},this.pollMatchState=async()=>{try{const{id:e}=qM.getMatchState();if(null===e)throw new Error("Match id is not found");const t=WM.getPlayerId(),i=Date.now(),n=await qM.api.getMatchAPI().getMatchDetailByIdAsync(e),a=Date.now(),s=Math.max(0,a-i,this.pollingInterval),o=new GameCore.Dtos.Match.Data(n).toObject(),{blackPlayerId:r,blackPlayerScore:l,whitePlayerScore:c,blackPlayerFinish:h,whitePlayerFinish:d}=o,u=t===r?l:c,p=t===r?c:l,m=t===r?h:d,g=t===r?d:h,y=h&&d;if(this.playerScore.setPlayerScore(u),this.opponentScore.setPlayerScore(p),this.playerScore.showCrown(y&&u>p),this.opponentScore.showCrown(y&&p>u),this.stopWaitingAnimation(),this.playerScore.stopWaitingAnimation(),this.opponentScore.stopWaitingAnimation(),y)if(u===p)this.titleText.string="Draw";else if(u>p)this.titleText.string="You Win";else{if(!(u<p))return;this.titleText.string="You Lose"}else this.titleText.string=YM,this.playWaitingAnimation(),m||this.playerScore.playWaitingAnimation(),g||this.opponentScore.playWaitingAnimation();this.scheduleOnce(this.pollMatchState,s)}catch(e){console.warn("ResultScene: Error on pollMatchState",e),this.scheduleOnce(this.pollMatchState,this.pollingInterval)}}}__preload(){this.validateRequiredComponents(),this.listenEvents(),bg.showBannerAds()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onLoad(){try{const e=qM.getMatchState(),{playerId:t,opponentId:i}=e.customData;if(null===t||null===i)throw new Error(`ResultScene: playerId is ${t} and opponentId is ${i}. Expected to not be null.`);const{photo:n}=WM.getPlayer(),{score:a=0,finished:s=!1}=e.profiles[t],{photo:o,score:r=0,finished:l=!1}=e.profiles[i],c=s&&l,h=c&&a>r,d=c&&r>a;this.playerScore.loadPhoto(n),this.opponentScore.loadPhoto(o),this.playerScore.setPlayerScore(a),this.opponentScore.setPlayerScore(r),this.playerScore.showCrown(h),this.opponentScore.showCrown(d),s&&l?a===r?this.titleText.string="Draw":h?this.titleText.string="You Win":d&&(this.titleText.string="You Lose"):(this.titleText.string=YM,this.playWaitingAnimation(),s||this.playerScore.playWaitingAnimation(),l||this.opponentScore.playWaitingAnimation())}catch(e){console.warn("ResultScene: Error on load",e),this.goToDashboardScene()}}listenEvents(){this.node.scene.on(Qn,this.goToDashboardScene),this.node.scene.on($n,this.onReplayButtonPressed,this)}start(){this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce((()=>{this.paperConfetti.runEffect()}),.2)}onDestroy(){this.unschedule(this.pollMatchState)}async onReplayButtonPressed(){let{level:e=1}=WM.getGameData()??{};e=Math.max(1,e);const t=await this.levelManager.loadLevelData(e);try{if(!t)throw new Error("Level data is not found");const{opponentId:e}=qM.getMatchState().customData;if(!e)throw new Error("Opponent id is not found");Bl.showLoadingScreen();const i=Yh.generateFen(t),{mode:n="",rules:a={addRandomTilesPerMove:0,maxSpaceOfPair:0},time:s=0,level:o}=t;await qM.challenge.friend.processAsync({playerId:WM.getPlayerId(),opponentId:e,extraData:{level:o,fen:i,gravity:n,rules:a,time:s}}),Bl.closeLoadingScreen(),this.goToGameScene()}catch(e){console.warn("ReplayChallengeFriend",e),Bl.closeLoadingScreen();const t=2;Bl.showNotificationScreen("Sorry, you cannot replay\nat this time.",t),KM?.sendException(e instanceof Error?e:new Error("ReplayChallengeFriend"+JSON.stringify(e))),this.scheduleOnce(this.goToDashboardScene,t)}}onHomeButtonPressed(){this.goToDashboardScene()}goToGameScene(){gl.switchScene(Lr)}playWaitingAnimation(){let e=0;this.titleText.schedule((()=>{e=(e+1)%4;const t=Array(e+1).join(".");this.titleText.string=YM+t}),.5);const t=this.titleText.getComponent(x),i=C(t).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=C(t).repeatForever(i).start()}stopWaitingAnimation(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(x).opacity=255}}).prototype,"pollingInterval",[IM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),xM=ve(MM.prototype,"playerScore",[PM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FM=ve(MM.prototype,"opponentScore",[_M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=ve(MM.prototype,"paperConfetti",[LM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GM=ve(MM.prototype,"titleText",[DM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zM=ve(MM.prototype,"levelManager",[OM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NM=MM))||NM);var jM,XM,$M,QM,JM,ZM,ek,tk,ik;i._RF.pop(),i._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);const{ccclass:nk,property:ak,disallowMultiple:sk}=a,{Events:ok}=GameCore,{event:rk}=globalThis.game;let lk=(jM=nk("BaseScreen"),XM=ak(n),$M=ak(n),QM=ak(x),jM(JM=sk((ek=ve((ZM=class extends s{constructor(){super(...arguments),e(this,"container",ek,this),e(this,"backgroundMask",tk,this),e(this,"screenOpacity",ik,this),this.data={}}__preload(){this.animation=this.getComponent(y),this.validateRequiredComponents(),this.initializeNodes()}initializeNodes(){const e=this.getMaskOpacity(),t=this.getContainerOpacity();e&&t&&(e.opacity=0,t.opacity=0)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}setScreenOpacity(e){this.screenOpacity.opacity=e}open(e){e&&(this.data=e),this.show(),this.runAnimation("OpenScreen")}close(){this.node.active&&(this.animation.once(y.EventType.FINISHED,(()=>{rk.emit(ok.CLOSED_SCREEN,{screenName:this.node.name}),this.hide()})),this.runAnimation("CloseScreen"))}runAnimation(e){if(!this.isAnimationExist(e))throw new Error(`${this.node.name}: Animation component must have ${e} clip`);this.animation.play(e)}isAnimationExist(e){return this.animation.clips.some((t=>!(!t||t.name!==e)))}getMaskOpacity(){const e=this.backgroundMask.getComponent(x);return e||(console.warn("BaseScreen: maskOpacity not found"),null)}getContainerOpacity(){const e=this.container.getComponent(x);return e||(console.warn("BaseScreen: containerOpacity not found"),null)}show(){this.setScreenOpacity(255);const e=this.node.getComponent(A);e&&(e.enabled=!0,e.updateAlignment(),this.node.getComponentsInChildren(A).forEach((e=>{e.updateAlignment()})))}hide(){this.setScreenOpacity(0),this.node.setWorldPosition(new j(-1e3,-1e3,0));const e=this.node.getComponent(A);e&&(e.enabled=!1)}}).prototype,"container",[XM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tk=ve(ZM.prototype,"backgroundMask",[$M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ik=ve(ZM.prototype,"screenOpacity",[QM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JM=ZM))||JM)||JM);var ck;i._RF.pop(),i._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);const{ccclass:hk,requireComponent:dk}=a;hk("BackgroundMask")(ck=dk([x])(ck=class extends s{onLoad(){const e=this.getComponent(x);e?(this.opacity=e,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}updateMaskAlpha(){(e=>{const t=document.getElementById("app-mask");t&&(t.style.background=`rgb(0 0 0 / ${e})`)})(this.opacity.opacity/255)}})||ck);var uk,pk,mk,gk,yk;i._RF.pop(),i._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);const{ccclass:bk,property:fk}=a;let wk=(uk=bk("Screens"),pk=fk({type:M(zi)}),uk((yk=ve((gk=class extends s{constructor(){super(...arguments),e(this,"screenKeys",yk,this)}}).prototype,"screenKeys",[pk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mk=gk))||mk);var Sk,vk,Ck,Ek,Tk,Ak,Rk,Ik,Pk,_k,Lk,Dk,Ok,Nk;i._RF.pop(),i._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);const{ccclass:Mk,property:kk,disallowMultiple:xk,requireComponent:Fk}=a,{Events:Bk}=GameCore,{event:Gk}=globalThis.game;Sk=Mk("CongratulationScreen"),vk=Fk(lk),Ck=kk(n),Ek=kk(n),Tk=kk(p),Ak=kk(p),Rk=kk(p),Sk(Ik=xk(Ik=vk((_k=ve((Pk=class extends s{constructor(){super(...arguments),e(this,"congratulation",_k,this),e(this,"confirmation",Lk,this),e(this,"closeButtonComponent",Dk,this),e(this,"yesButtonComponent",Ok,this),e(this,"noButtonComponent",Nk,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("CongratulationScreen: screen not found");this.validateEventPayload(e)&&(this.closeButtonComponent.interactable=!0,this.yesButtonComponent.interactable=!0,this.noButtonComponent.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(lk),this.confirmationUIOpacity=this.confirmation.getComponent(x),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){Gk.on(Bk.OPENING_SCREEN,this.handleOpeningScreen),Gk.on(Bk.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){Gk.off(Bk.OPENING_SCREEN,this.handleOpeningScreen),Gk.off(Bk.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name}open(){this.confirmation.active=!1,this.congratulation.active=!0}close(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,Bl.closeScreen(Hi[this.node.name])}handleStartOver(){this.confirmation.active=!0,this.congratulation.active=!1,C(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),C(this.confirmation).set({scale:new j(.8,.8,.8)}).to(.2,{scale:new j(1,1,1)},{easing:"backOut"}).start()}handleYesStartOver(){this.close(),this.node.scene.emit(Ga.START_OVER)}handleNoStartOver(){this.requestGameReplay()}handleClickedClose(){this.requestGameReplay()}requestGameReplay(){this.close(),this.node.scene.emit(Ga.GAME_REPLAY,{level:this.screen.data.level})}}).prototype,"congratulation",[Ck],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lk=ve(Pk.prototype,"confirmation",[Ek],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dk=ve(Pk.prototype,"closeButtonComponent",[Tk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ok=ve(Pk.prototype,"yesButtonComponent",[Ak],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nk=ve(Pk.prototype,"noButtonComponent",[Rk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ik=Pk))||Ik)||Ik);var zk,Uk,Hk,Vk,qk,Wk,Kk,Yk,jk,Xk,$k,Qk,Jk,Zk,ex,tx,ix,nx,ax,sx,ox;i._RF.pop(),i._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);const{ccclass:rx,property:lx}=a;let cx=(zk=rx("DayBlock"),Uk=lx({type:R,group:"Background"}),Hk=lx({type:R,group:"Background"}),Vk=lx({type:N,group:"Background"}),qk=lx({type:N,group:"Background"}),Wk=lx(h),Kk=lx(h),Yk=lx(n),jk=lx(n),Xk=lx(n),zk((Jk=ve((Qk=class extends s{constructor(){super(...arguments),e(this,"background",Jk,this),e(this,"topBackground",Zk,this),e(this,"blueBackground",ex,this),e(this,"blueTopBackground",tx,this),e(this,"dayLabel",ix,this),e(this,"coinLabel",nx,this),e(this,"rewardItemsNode",ax,this),e(this,"checkNode",sx,this),e(this,"glowNodes",ox,this)}onLoad(){this.uiOpacity=this.getComponent(x),this.initDefaultProperties(),this.validateRequiredComponents()}initDefaultProperties(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new o(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new o("#3469bf")}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateInfo(e){this.updateBackground(e),this.updateDayLabel(e),this.coinLabel.string=e.value.toString(),this.updateRewardItems(e)}updateBackground(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}updateDayLabel(e){this.dayLabel.string=`Day ${e.day.toString()}`;let t=this.defaultDayLabelOutlineColor;"rewarded"!==e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=t,this.dayLabel.shadowColor=t}updateRewardItems(e){switch(e.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}setGlowNodesActive(e){this.glowNodes&&this.glowNodes.forEach((t=>{t.active=e}))}}).prototype,"background",[Uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zk=ve(Qk.prototype,"topBackground",[Hk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ex=ve(Qk.prototype,"blueBackground",[Vk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tx=ve(Qk.prototype,"blueTopBackground",[qk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ix=ve(Qk.prototype,"dayLabel",[Wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nx=ve(Qk.prototype,"coinLabel",[Kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ax=ve(Qk.prototype,"rewardItemsNode",[Yk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sx=ve(Qk.prototype,"checkNode",[jk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ox=ve(Qk.prototype,"glowNodes",[Xk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$k=Qk))||$k);var hx,dx,ux,px,mx,gx;i._RF.pop(),i._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);const{ccclass:yx,property:bx,requireComponent:fx}=a,{Events:wx,Utils:Sx}=GameCore,{Object:vx,Array:Cx}=Sx,{event:Ex,dailyRewards:Tx,player:Ax,monitorError:Rx}=globalThis.game;hx=yx("DailyRewardsScreen"),dx=fx(lk),ux=bx([cx]),hx(px=dx((gx=ve((mx=class extends s{constructor(){super(...arguments),this.rewardsData=[],this.debugScreenOpened=!1,this.debugUpdatedRewardsData=!1,e(this,"dailyBlocks",gx,this),this.handleOpeningScreen=e=>{this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){Ex.on(wx.OPENING_SCREEN,this.handleOpeningScreen),Ex.on(wx.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){Ex.off(wx.OPENING_SCREEN,this.handleOpeningScreen),Ex.off(wx.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name}async open(){
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.debugScreenOpened=!0,this.node.scene.emit(Ga.HIDE_UI),this.resetState(),await this.updateRewardsData(),this.loginDailyRewards(),this.updateDayBlocks(),this.runPopUpAnimation()}close(){Ex.emit(wx.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ga.SHOW_UI)}resetState(){this.dailyBlocks.forEach((e=>{e.uiOpacity.opacity=0,e.node.scale=new j(1.2,1.2,1.2)}))}runPopUpAnimation(){this.screen.container||console.warn("DailyRewardScreen: screen not found"),this.dailyBlocks.forEach(((e,t)=>{this.runAppearTween(e,.15*t)}))}runAppearTween(e,t){C(e.uiOpacity).delay(t).to(.3,{opacity:255},{easing:"quadOut"}).start(),C(e.node).delay(t).to(.3,{scale:j.ONE},{easing:"backOut"}).start()}handleOnClaim(){const e=this.getCurrentRewardData();if(!e)
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return Rx?.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),void Bl.showNotificationScreen("Unable to validate rewards. Please try again later...",2);this.claimReward(e)}async handleOnClaimX2(){const e=this.getCurrentRewardData();if(!e)
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return Rx?.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),void Bl.showNotificationScreen("Unable to validate rewards. Please try again later...",2);if(!await bg.showRewardVideoAdAsync({}))return;this.claimReward(e,!0)}getCurrentRewardData(){return Cx.search(this.rewardsData,(e=>"ready"===e.status))}claimReward(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.value*(t?2:1),n=new ai;if(this.node.scene.emit(Ga.ADD_COINS,{coins:i,collectionAnimation:{animateTextOnly:!1,signal:n}}),!e.items)return void this.close();const a=e.items.hint*(t?2:1),s=e.items.thunder*(t?2:1),o=e.items.storm*(t?2:1),r=Ax.getGameData();r?(Ax.setGameData({items:{hint:r.items.hint+a,thunder:r.items.thunder+s,storm:r.items.storm+o,pliers:r.items.pliers}}),this.close()):this.close()}async updateRewardsData(){await Tx.requestDailyRewardsAsync();const e={...Tx.getDailyRewards()};for(let t=0;t<GameCore.Configs.DailyRewards.MaxDays;t++)e[t]={...e[t],value:fr[t].value,items:fr[t].items};e&&(this.rewardsData=vx.vals(e),
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData))}loginDailyRewards(){Tx.logLoginReward()}updateDayBlocks(){
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),Rx?.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach(((e,t)=>{
//! DEBUG bug Cannot read properties of undefined (reading 'find')
if(t>=this.rewardsData.length)return;const{id:i,type:n,value:a,status:s}=this.rewardsData[t];e.updateInfo({day:i,type:n,value:a,status:s})}))}}).prototype,"dailyBlocks",[ux],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),px=mx))||px);var Ix;i._RF.pop(),i._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);const{ccclass:Px}=a;Px("DayBlockRed")(Ix=class extends cx{updateBackground(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}updateDayLabel(e){this.dayLabel.string=`Day ${e.day.toString()}`;let t=this.defaultDayLabelOutlineColor;"ready"===e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=t,this.dayLabel.outlineColor=t}});var _x,Lx,Dx,Ox,Nx,Mx,kx,xx,Fx,Bx;i._RF.pop(),i._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);const{ccclass:Gx,property:zx,requireComponent:Ux}=a,{event:Hx}=globalThis.game,{Events:Vx}=GameCore;_x=Gx("GetCoinScreen"),Lx=Ux(lk),Dx=zx(h),Ox=zx(p),Nx=zx(p),_x(Mx=Lx((xx=ve((kx=class extends s{constructor(){super(...arguments),e(this,"quantityLabel",xx,this),e(this,"closeButtonComponent",Fx,this),e(this,"getNowButtonComponent",Bx,this),this.handleOpeningScreen=e=>{console.log("GetCoinScreen.OPENING_SCREEN",e),this.validateEventPayload(e)&&(this.closeButtonComponent.interactable=!0,this.getNowButtonComponent.interactable=!0,this.updateStatus())},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){Hx.on(Vx.OPENING_SCREEN,this.handleOpeningScreen),Hx.on(Vx.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){Hx.off(Vx.OPENING_SCREEN,this.handleOpeningScreen),Hx.off(Vx.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){if(!("screenName"in e))return!1;const{screenName:t}=e;return t===this.node.name&&(this.payload=e,!0)}open(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(Ga.HIDE_UI)}close(){this.closeButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,Hx.emit(Vx.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ga.SHOW_UI)}updateStatus(){this.updateCoinQuantity()}runPopUpAnimation(){this.screen.container||console.warn("GetCoinScreen: screen not found")}updateCoinQuantity(){const e=this.getQuantity();e&&this.updateQuantityLabel(e)}updateQuantityLabel(e){this.quantityLabel.string=`x${e.toString()}`}getQuantity(){if(!this.payload||!("screenData"in this.payload))return 0;const{screenData:e}=this.payload;return e&&"quantity"in e&&e.quantity&&"number"==typeof e.quantity?e.quantity:0}handleAddCoin(){const e=this.getQuantity();this.node.scene.emit(Ga.ADD_COINS,{coins:e,collectionAnimation:{animateTextOnly:!1}}),this.close()}async handleGetNowButtonClicked(){Yi.stopAllSounds();await bg.showRewardVideoAdAsync({})&&this.handleAddCoin()}}).prototype,"quantityLabel",[Dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fx=ve(kx.prototype,"closeButtonComponent",[Ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bx=ve(kx.prototype,"getNowButtonComponent",[Nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mx=kx))||Mx);var qx,Wx,Kx,Yx,jx,Xx,$x,Qx,Jx;i._RF.pop(),i._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);const{ccclass:Zx,property:eF}=a;let tF=(qx=Zx("ItemCollectionFX"),Wx=eF(R),Kx=eF(x),Yx=eF(se),qx(($x=ve((Xx=class extends s{constructor(){super(...arguments),e(this,"sprite",$x,this),e(this,"glowUIOpacity",Qx,this),e(this,"particles",Jx,this)}__preload(){Fe.lazyValidateProperties(this)}playExplosionParticles(){this.particles.resetSystem()}}).prototype,"sprite",[Wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qx=ve(Xx.prototype,"glowUIOpacity",[Kx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jx=ve(Xx.prototype,"particles",[Yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jx=Xx))||jx);var iF,nF,aF,sF,oF,rF,lF,cF,hF,dF,uF,pF,mF,gF,yF,bF,fF,wF,SF,vF,CF,EF,TF,AF,RF;i._RF.pop(),i._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);const{ccclass:IF,property:PF}=a,{event:_F,player:LF,analytics:DF}=globalThis.game,{Events:OF,Utils:NF}=GameCore,{Object:MF,Array:kF}=NF;iF=IF("GetItemScreen"),nF=PF(_),aF=PF(R),sF=PF(R),oF=PF(R),rF=PF(R),lF=PF(h),cF=PF(h),hF=PF(h),dF=PF(p),uF=PF(p),pF=PF(p),iF((yF=ve((gF=class extends s{constructor(){super(...arguments),e(this,"itemFxPrefab",yF,this),e(this,"hintSprite",bF,this),e(this,"stormSprite",fF,this),e(this,"pliersSprite",wF,this),e(this,"thunderSprite",SF,this),e(this,"titleLabel",vF,this),e(this,"descriptionLabel",CF,this),e(this,"coinLabel",EF,this),e(this,"closeButtonComponent",TF,this),e(this,"buyItemButtonComponent",AF,this),e(this,"getNowButtonComponent",RF,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("GetItemScreen: screen not found");if(!this.validateEventPayload(e))return;this.closeButtonComponent.interactable=!0,this.getNowButtonComponent.interactable=!0,this.buyItemButtonComponent.interactable=!0;const t=this.getItemType();t&&this.updateStatus(t)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){_F.on(OF.OPENING_SCREEN,this.handleOpeningScreen),_F.on(OF.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){_F.off(OF.OPENING_SCREEN,this.handleOpeningScreen),_F.off(OF.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name&&(this.payload=e,!0)}open(){this.node.scene.emit(Ga.GAME_PAUSE)}close(){this.closeButtonComponent.interactable=!1,this.buyItemButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,_F.emit(OF.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ga.GAME_RESUME)}updateStatus(e){this.updateItemIcon(e),this.updateTitle(e),this.updateDescription(),this.updateButtons(e)}updateItemIcon(e){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach((e=>{e.node.active=!1})),e){case dr.HINT:this.activeIcon=this.hintSprite;break;case dr.STORM:this.activeIcon=this.stormSprite;break;case dr.THUNDER:this.activeIcon=this.thunderSprite;break;case dr.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}updateTitle(e){const t=e.charAt(0).toUpperCase()+e.slice(1);this.titleLabel.string=t}updateDescription(){const e=this.payload.screenData?.message;e&&(this.descriptionLabel.string=e)}updateButtons(e){const t=this.canBuyItem(e);this.buyItemButtonComponent.node.active=t,this.getNowButtonComponent.node.active=!t,t&&(this.coinLabel.string=""+3*gr[e])}canBuyItem(e){const t=LF.getGameData();if(!t)return!1;const{coins:i}=t;return i>=3*gr[e]}getItemType(){const{screenData:e}=this.payload;return e&&e.item&&kF.has(MF.vals(dr),e.item)?e.item:null}async handleAddItem(){const e=this.getItemType();if(!e)return;DF.event(GameCore.Plugins.Analytics.Events.EARN_ITEM,{item_name:e,value:3}),this.node.scene.emit(Ga.ADD_ITEM,{animate:()=>this.animateAddItem(e),item:e,quantity:3})}async animateAddItem(e){const{spriteFrame:t}=this.activeIcon,[i,n]=this.createItemCollectionNode(t),a=this.getItemButtonWorldPosition(e),s=new j(.5,.5,.5);n.glowUIOpacity.opacity=150,await this.playScaleUpItemAnim(i,n),await St.runTweenAsync(C(n.glowUIOpacity).to(.8,{opacity:0},{easing:"cubicIn"})),await this.playMoveCloseToItemButtonAnim(i,a,s),await this.playJumpAnim(i,s,a),Yi.playSound("sounds/clicks"),i.destroy()}async playJumpAnim(e,t,i){const n=i.clone().add3f(0,70,0),a=t.clone().multiplyScalar(1.3);await Promise.all([St.runTweenAsync(C(e).to(.3,{worldPosition:n},{easing:"cubicOut"})),St.runTweenAsync(C(e).to(.3,{scale:a},{easing:"cubicOut"}))]),await St.runTweenAsync(C(e).to(.5,{worldPosition:i},{easing:"cubicIn"}))}playMoveCloseToItemButtonAnim(e,t,i){const n=t.clone().add3f(0,30,0);return St.runTweenAsync(C(e).to(1,{worldPosition:n,scale:i},{easing:"cubicInOut"}))}createItemCollectionNode(e){const t=c(this.itemFxPrefab),i=t.getComponent(tF);return t.setParent(this.node.parent),i.sprite.spriteFrame=e,t.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[t,i]}playScaleUpItemAnim(e,t){return e.setScale(j.ZERO),St.runTweenAsync(C(e).delay(.2).call((()=>{t.playExplosionParticles(),Yi.playSound("sounds/item_reward")})).to(.1,{scale:new j(.8,1.2,1)}).to(.1,{scale:new j(1.2,.8,1)}).to(.1,{scale:new j(1,1,1)}))}getItemButtonWorldPosition(e){return this.getItemButton(e).worldPosition.clone()}async handleGetNowButtonClicked(){this.stopAllSounds();await bg.showRewardVideoAdAsync({})&&(this.handleAddItem(),this.close())}async handleBuyItemButtonClicked(){this.node.scene.emit(Ga.REMOVE_COINS,{coins:3*gr[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close()}stopAllSounds(){P("Sound")?.getComponent(wt)?.stopAll()}getItemButton(e){switch(e){case dr.HINT:return P("Canvas/UI/Footer/HintItemButton");case dr.STORM:return P("Canvas/UI/Footer/StormItemButton");case dr.THUNDER:return P("Canvas/UI/Footer/ThunderItemButton");case dr.PLIERS:return P("Canvas/UI/Footer/PliersItemButton")}}}).prototype,"itemFxPrefab",[nF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bF=ve(gF.prototype,"hintSprite",[aF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fF=ve(gF.prototype,"stormSprite",[sF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wF=ve(gF.prototype,"pliersSprite",[oF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SF=ve(gF.prototype,"thunderSprite",[rF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vF=ve(gF.prototype,"titleLabel",[lF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CF=ve(gF.prototype,"descriptionLabel",[cF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EF=ve(gF.prototype,"coinLabel",[hF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TF=ve(gF.prototype,"closeButtonComponent",[dF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AF=ve(gF.prototype,"buyItemButtonComponent",[uF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RF=ve(gF.prototype,"getNowButtonComponent",[pF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mF=gF));var xF,FF,BF,GF,zF,UF,HF,VF,qF,WF,KF,YF,jF,XF,$F,QF,JF,ZF,eB,tB,iB,nB,aB,sB,oB,rB,lB,cB,hB,dB;i._RF.pop(),i._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);const{ccclass:uB,property:pB,requireComponent:mB}=a,{Events:gB,Utils:yB}=GameCore,{event:bB,player:fB}=globalThis.game,wB="Coin Container";xF=uB("LevelCompleteScreen"),FF=mB(lk),BF=pB(Ov),GF=pB(n),zF=pB(h),UF=pB(n),HF=pB(n),VF=pB(p),qF=pB(n),WF=pB(y),KF=pB(n),YF=pB({type:y,group:wB}),jF=pB({type:D,group:wB}),XF=pB({type:D,group:wB}),$F=pB(MS),xF(QF=FF((ZF=ve((JF=class extends s{constructor(){super(...arguments),this.levelId=1,this.coins=40,this.currentCoin=0,e(this,"coinContainer",ZF,this),e(this,"playButton",eB,this),e(this,"coinText",tB,this),e(this,"levelText",iB,this),e(this,"nextLevelText",nB,this),e(this,"playButtonComponent",aB,this),e(this,"wellDoneText",sB,this),e(this,"coinAnimation",oB,this),e(this,"playButtonContainer",rB,this),e(this,"coinContainerAnimation",lB,this),e(this,"coinContainerEnterClip",cB,this),e(this,"coinContainerExitClip",hB,this),e(this,"paperConfetti",dB,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("StarChestScreen: screen not found");this.validateEventPayload(e)&&(this.playButtonComponent.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(lk),this.validateRequiredComponents(),this.listenScreenEvents()}onLoad(){const e=this.screen.open;this.screen.open=t=>{this.overrideOpenHandler(e,t)}}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){bB.on(gB.OPENING_SCREEN,this.handleOpeningScreen),bB.on(gB.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){bB.off(gB.OPENING_SCREEN,this.handleOpeningScreen),bB.off(gB.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t,screenData:i}=e??{};return t===this.node.name&&(!!yB.Valid.isObject(i)&&(yB.Valid.isNumber(i.level)&&(this.levelId=i.level,this.coins=this.levelId<5?ur:pr),yB.Valid.isNumber(i.currentCoin)&&(this.currentCoin=i.currentCoin),!0))}open(){this.updateComponents(),this.node.scene.emit(Ga.HIDE_UI)}async close(){await St.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name),bB.emit(gB.CLOSE_SCREEN,{screenName:this.node.name}),await bg.showInterstitialAdAsync({forLevel:this.screen.data.level}),this.handleNextLevel()}async overrideOpenHandler(e,t){this.screen.setScreenOpacity(255),this.coinText.string="x0",this.playButtonComponent.interactable=!1,this.paperConfetti.runEffect(),await this.animateWellDoneText(),this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z),e.call(this.screen,t),this.screen.getComponent(y)?.once(y.EventType.FINISHED,(()=>{this.animateCoin()}))}handleNextLevel(){const e=this.screen.data.level;if(!e)return void console.warn("LevelCompleteScreen: level not found");const t=fB.getGameData();if(!t)return void console.warn("LevelCompleteScreen: gameData not found");e>=t.totalLevel?this.node.scene.emit(Ga.MAX_LEVEL):this.node.scene.emit(Ga.NEXT_LEVEL)}updateComponents(){this.updateLevelText(),this.updateCoinContainer()}updateCoinContainer(){this.coinContainer.updateCoins({coins:this.currentCoin})}updateLevelText(){const e=fB.getGameData();if(!e)return void console.warn("LevelCompleteScreen: gameData not found");this.levelText.getComponent(h).string=`Level ${this.levelId}`,console.log("LevelCompleteScreen: updateLevelText",this.levelId);const t=this.levelId+1>e.totalLevel?"Complete":`Level ${this.levelId+1}`;this.nextLevelText.getComponent(h).string=t}updateCoinString(){this.coinText.string=`x${this.coins}`,console.log("LevelCompleteScreen: updateCoinString",this.coins)}async animateCoin(){this.screen.container?(this.coinAnimation.play(),await this.animateCoinText({contentFn:e=>`x${e}`,currentQuantity:0,targetQuantity:this.coins}),await this.animateCoinCollection(),await St.runTweenAsync(this.showPlayButton()),this.updateCoinString()):console.warn("LevelCompleteScreen: screen not found")}async animateCoinCollection(){await St.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name),this.node.scene.emit(Ga.ADD_COINS,{coins:this.coins,collectionAnimation:{animateTextOnly:!1,target:this.coinContainer}})}showPlayButton(){return C(this.playButtonContainer).call((()=>{this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z)})).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).call((()=>{this.playButtonComponent.interactable=!0}))}handleClickedPlay(){this.playButtonComponent.interactable=!1,this.close()}animateWellDoneText(){const e=this.wellDoneText.position.clone(),t=C(this.wellDoneText).call((()=>{this.wellDoneText.setPosition(0,0,this.wellDoneText.position.z),this.wellDoneText.setScale(0,0,this.wellDoneText.scale.z)})).to(.5,{scale:new j(1.5,1.5,1)},{easing:"cubicOut"}).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).to(.5,{position:e},{easing:"backOut"});return St.runTweenAsync(t)}animateCoinText(e){let{contentFn:t,currentQuantity:i,targetQuantity:n,duration:a=.8}=e;const s=C({currentQuantity:i}).to(a,{currentQuantity:n},{easing:"linear",onUpdate:e=>{if(!e)return;const i=e.currentQuantity,n=Math.floor(i);this.coinText.string=t(n)}});return St.runTweenAsync(s)}}).prototype,"coinContainer",[BF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eB=ve(JF.prototype,"playButton",[GF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tB=ve(JF.prototype,"coinText",[zF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iB=ve(JF.prototype,"levelText",[UF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nB=ve(JF.prototype,"nextLevelText",[HF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aB=ve(JF.prototype,"playButtonComponent",[VF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sB=ve(JF.prototype,"wellDoneText",[qF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oB=ve(JF.prototype,"coinAnimation",[WF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rB=ve(JF.prototype,"playButtonContainer",[KF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lB=ve(JF.prototype,"coinContainerAnimation",[YF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cB=ve(JF.prototype,"coinContainerEnterClip",[jF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hB=ve(JF.prototype,"coinContainerExitClip",[XF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dB=ve(JF.prototype,"paperConfetti",[$F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QF=JF))||QF);var SB;i._RF.pop(),i._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);const{ccclass:vB,disallowMultiple:CB,requireComponent:EB}=a,{Events:TB}=GameCore,{event:AB}=globalThis.game;vB("LoadingScreen")(SB=CB(SB=EB(lk)(SB=class extends s{constructor(){super(...arguments),this.handleOpeningScreen=e=>{this.validateEventPayload(e)&&(this.enabled=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()},this.handleClosingScreen=e=>{this.validateEventPayload(e)&&this.unscheduleAllCallbacks()},this.handleClosedScreen=e=>{this.validateEventPayload(e)&&(this.enabled=!1)},this.handleOnCloseScreen=()=>{Bl.closeScreen(Hi[this.node.name])}}onLoad(){this.enabled=!1,this.screen=this.getComponent(lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){AB.on(TB.OPENING_SCREEN,this.handleOpeningScreen),AB.on(TB.OPENED_SCREEN,this.handleOpenedScreen),AB.on(TB.CLOSING_SCREEN,this.handleClosingScreen),AB.on(TB.CLOSED_SCREEN,this.handleClosedScreen)}unListenScreenEvents(){AB.off(TB.OPENING_SCREEN,this.handleOpeningScreen),AB.off(TB.OPENED_SCREEN,this.handleOpenedScreen),AB.off(TB.CLOSING_SCREEN,this.handleClosingScreen),AB.off(TB.CLOSED_SCREEN,this.handleClosedScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name}open(){if(!this.enabled)return;const e=this.screen.data.duration;e&&e>0&&this.scheduleOnce(this.handleOnCloseScreen,e)}})||SB)||SB);var RB,IB,PB,_B,LB,DB,OB,NB;i._RF.pop(),i._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);const{ccclass:MB,disallowMultiple:kB,requireComponent:xB,property:FB}=a,{Events:BB,Utils:GB}=GameCore,{event:zB}=globalThis.game;RB=MB("NotificationScreen"),IB=xB(lk),PB=FB(h),_B=FB(p),RB(LB=kB(LB=IB((OB=ve((DB=class extends s{constructor(){super(...arguments),e(this,"message",OB,this),e(this,"touchZone",NB,this),this.enableCloseOnTouch=!0,this.handleOpeningScreen=e=>{this.validateEventPayload(e)&&this.updateScreenData(e)},this.handleClosingScreen=e=>{this.validateEventPayload(e)&&this.unscheduleAllCallbacks()}}__preload(){this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){zB.on(BB.OPENING_SCREEN,this.handleOpeningScreen),zB.on(BB.CLOSING_SCREEN,this.handleClosingScreen)}unListenScreenEvents(){zB.off(BB.OPENING_SCREEN,this.handleOpeningScreen),zB.off(BB.CLOSING_SCREEN,this.handleClosingScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name}updateScreenData(e){const{screenData:t}=e;GB.Valid.isObject(t)?(t.message&&(this.message.string=t.message),t.duration&&t.duration>0&&this.scheduleOnce((()=>{Bl.closeScreen(Hi[this.node.name])}),t.duration),!1===t.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}handleClickedClose(){this.unscheduleAllCallbacks(),Bl.closeScreen(Hi[this.node.name])}closeOnTouch(){this.enableCloseOnTouch&&this.handleClickedClose()}}).prototype,"message",[PB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NB=ve(DB.prototype,"touchZone",[_B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LB=DB))||LB)||LB);var UB,HB,VB,qB,WB,KB,YB,jB;i._RF.pop(),i._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);const{ccclass:XB,property:$B,requireComponent:QB}=a,{Events:JB}=GameCore,{event:ZB}=globalThis.game;UB=XB("QuitLevelScreen"),HB=QB(lk),VB=$B(p),qB=$B(p),UB(WB=HB((YB=ve((KB=class extends s{constructor(){super(...arguments),e(this,"noButton",YB,this),e(this,"yesButton",jB,this),this.handleOpeningScreen=e=>{this.validateEventPayload(e)&&(this.noButton.interactable=!0,this.yesButton.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){ZB.on(JB.OPENING_SCREEN,this.handleOpeningScreen),ZB.on(JB.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){ZB.off(JB.OPENING_SCREEN,this.handleOpeningScreen),ZB.off(JB.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name}open(){this.runPopUpAnimation(),this.node.scene.emit(Ga.HIDE_UI)}close(){this.noButton.interactable=!1,this.yesButton.interactable=!1,Bl.closeScreen(Hi[this.node.name]),this.node.scene.emit(Ga.SHOW_UI),this.node.scene.emit(Ga.GAME_RESUME)}runPopUpAnimation(){this.screen.container||console.warn("StartLevelScreen: screen not found")}handleClickedNo(){this.close()}handleClickedYes(){this.node.scene.emit(Ga.GAME_EXIT)}}).prototype,"noButton",[VB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jB=ve(KB.prototype,"yesButton",[qB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WB=KB))||WB);var eG,tG,iG,nG,aG,sG,oG,rG,lG,cG,hG,dG,uG,pG,mG,gG,yG,bG,fG,wG,SG,vG;i._RF.pop(),i._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);const{ccclass:CG,property:EG,disallowMultiple:TG,requireComponent:AG}=a,{Events:RG}=GameCore,{event:IG,player:PG}=globalThis.game;eG=CG("RescuesScreen"),tG=AG(lk),iG=EG(x),nG=EG([n]),aG=EG(h),sG=EG(h),oG=EG(n),rG=EG(n),lG=EG(y),cG=EG(n),hG=EG(n),eG(dG=TG(dG=tG((pG=ve((uG=class extends s{constructor(){super(...arguments),e(this,"adOpacity",pG,this),e(this,"animNodes",mG,this),e(this,"titleLabel",gG,this),e(this,"descriptionLabel",yG,this),e(this,"timer",bG,this),e(this,"bomb",fG,this),e(this,"bombAnim",wG,this),e(this,"replayButton",SG,this),e(this,"buyTimeButton",vG,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("RescuesScreen: screen not found");this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){IG.on(RG.OPENING_SCREEN,this.handleOpeningScreen),IG.on(RG.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){IG.off(RG.OPENING_SCREEN,this.handleOpeningScreen),IG.off(RG.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name&&(this.payload=e,!0)}async open(){await this.resetState(),this.runOpenAnimation(),this.node.scene.emit(Ga.HIDE_UI)}close(){IG.emit(RG.CLOSE_SCREEN,{screenName:this.node.name})}async resetState(){const e=this.payload.screenData?.failKey===jl;this.titleLabel.string=e?"Boom!":"Time's Up!",this.descriptionLabel.string=e?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!e,this.bomb.active=e,e&&this.bombAnim.play();const t=PG.getGameData();if(!t)return;const i=t.coins>=yr;this.replayButton.active=!i,this.buyTimeButton.active=i,this.adOpacity.opacity=0}async runOpenAnimation(){this.screen.container?(await Promise.all(this.animNodes.map(((e,t)=>{this.runAppearTween(e,.1*t)}))),await this.runShowAdContainer()):console.warn("TimeUpScreen: screen not found")}async runAppearTween(e,t){await St.runTweenAsync(C(e).set({scale:new j(0,0,0)}).delay(t).to(1,{scale:new j(1,1,1)},{progress:(e,t,i,n)=>e+(t-e)*St.elasticOut(n,.1,.45)}))}runShowAdContainer(){const e=C(this.adOpacity);return e.delay(1),e.to(.5,{opacity:255}),St.runTweenAsync(e)}handleClickReplayButton(){this.close(),this.node.scene.emit(Ga.GAME_REPLAY,{level:this.screen.data.level})}handleClickBuyTimeButton(){this.node.scene.emit(Ga.REMOVE_COINS,{coins:yr,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}async handleClickAdButton(){await bg.showRewardVideoAdAsync({})&&this.startRescue()}startRescue(){this.node.scene.emit(Ga.SHOW_UI),this.node.scene.emit(Ga.RESCUE_START),this.close()}}).prototype,"adOpacity",[iG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mG=ve(uG.prototype,"animNodes",[nG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gG=ve(uG.prototype,"titleLabel",[aG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yG=ve(uG.prototype,"descriptionLabel",[sG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bG=ve(uG.prototype,"timer",[oG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fG=ve(uG.prototype,"bomb",[rG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wG=ve(uG.prototype,"bombAnim",[lG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SG=ve(uG.prototype,"replayButton",[cG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vG=ve(uG.prototype,"buyTimeButton",[hG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dG=uG))||dG)||dG);var _G,LG,DG,OG,NG,MG,kG,xG,FG,BG,GG,zG,UG,HG,VG,qG,WG,KG,YG,jG,XG,$G,QG,JG,ZG,ez;i._RF.pop(),i._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);const{ccclass:tz,property:iz,requireComponent:nz}=a,{Events:az,Utils:sz}=GameCore,{player:oz,event:rz}=globalThis.game;_G=tz("SettingsScreen"),LG=nz(lk),DG=iz(n),OG=iz(n),NG=iz(n),MG=iz(TP),kG=iz(TP),xG=iz(TP),FG=iz(p),BG=iz(p),GG=iz(p),zG=iz(p),UG=iz(n),_G(HG=LG((qG=ve((VG=class extends s{constructor(){super(...arguments),e(this,"musicSetting",qG,this),e(this,"soundSetting",WG,this),e(this,"vibrateSetting",KG,this),e(this,"musicSwitch",YG,this),e(this,"soundSwitch",jG,this),e(this,"vibrateSwitch",XG,this),e(this,"closeButtonComponent",$G,this),e(this,"continueButtonComponent",QG,this),e(this,"restartButtonComponent",JG,this),e(this,"inviteFriendsButtonComponent",ZG,this),e(this,"animNodes",ez,this),this.triggerSequence="",this.handleOpeningScreen=e=>{this.validateSwitchScreenPayload(e)&&(this.closeButtonComponent.interactable=!0,this.continueButtonComponent.interactable=!0,this.restartButtonComponent.interactable=!0,this.inviteFriendsButtonComponent.interactable=!0,this.updateStatus())},this.handleOpenedScreen=e=>{this.validateSwitchScreenPayload(e)&&this.open()},this.handleResetSequence=()=>{this.triggerSequence=""},this.handleTriggerUnlockKey=e=>{if(!("code"in e))return;const{code:t}=e,{UNLOCK_SEQUENCE:i}=vr;"number"==typeof t&&-1!==i.indexOf(t.toString())&&(this.triggerSequence+=t.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",t,this.triggerSequence,this.triggerSequence===i),this.triggerSequence===i&&(this.node.scene.emit(vr.Events.UNLOCK_DEV_TOOLS),this.node.off(vr.Events.TRIGGER_UNLOCK_KEY)))},this.updateVibrateButton=()=>{const e=this.vibrateSetting.getComponentInChildren(p),t=this.vibrateSetting.getComponentInChildren(TP),i=this.vibrateSetting.getComponentInChildren(Hn);if(e&&t&&i)if(sz.Device.isMobile()){const e=oz.getPlayerSetting("vibrate")??!1;t.setEnabled(e)}else e.interactable=!1,t.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")}}onLoad(){this.enabled=!1,this.screen=this.getComponent(lk),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}onDestroy(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){rz.on(az.OPENING_SCREEN,this.handleOpeningScreen),rz.on(az.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){rz.off(az.OPENING_SCREEN,this.handleOpeningScreen),rz.off(az.OPENED_SCREEN,this.handleOpenedScreen)}validateSwitchScreenPayload(e){const{screenName:t}=e;return t===this.node.name}listenUnlockDevTools(){this.node.off(vr.Events.TRIGGER_UNLOCK_KEY),this.node.on(vr.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(vr.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}unListenUnlockDevTools(){this.node.off(vr.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(vr.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}open(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(vr.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(Ga.HIDE_UI)}close(){this.closeButtonComponent.interactable=!1,this.continueButtonComponent.interactable=!1,this.restartButtonComponent.interactable=!1,this.inviteFriendsButtonComponent.interactable=!1,this.node.emit(vr.Events.TRIGGER_RESET_SEQUENCE),Bl.closeScreen(Hi[this.node.name])}updateStatus(){const e={music:oz.getPlayerSetting("music")??!1,sound:oz.getPlayerSetting("sound")??!1,vibrate:oz.getPlayerSetting("vibrate")??!1};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(e.music),this.soundSwitch.setEnabled(e.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}runPopUpAnimation(){this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(((e,t)=>{this.runAppearTween(e,.1*t)}))}runAppearTween(e,t){const i=C(e);i.set({scale:new j(0,0,0)}),i.delay(t),i.to(1,{scale:new j(1,1,1)},{progress:(e,t,i,n)=>e+(t-e)*St.elasticOut(n,.1,.45)}),i.start()}switchMusicButton(){if(!this.musicSwitch)return void console.warn("SettingsScreen: musicSwitch not found");const e=this.musicSwitch.switch();oz.setSetting("music",e),this.node.emit(vr.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e?Yi.playMusic():Yi.pauseMusic()}switchSoundButton(){if(!this.soundSwitch)return void console.warn("SettingsScreen: soundSwitch not found");const e=this.soundSwitch.switch();oz.setSetting("sound",e),this.node.emit(vr.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}switchVibrateButton(){if(!this.vibrateSwitch)return void console.warn("SettingsScreen: vibrateSwitch not found");const e=this.vibrateSwitch.switch();oz.setSetting("vibrate",e)}handleClickedResume(){this.resumeGame()}handleClickedClose(){this.resumeGame()}handleClickedReplayGame(){this.restartGame()}async handleClickedInviteFriends(){this.close(),this.node.scene.emit(Ga.INVITE_FRIENDS)}resumeGame(){this.close(),this.node.scene.emit(Ga.GAME_RESUME),this.node.scene.emit(Ga.SHOW_UI)}restartGame(){this.close(),this.node.scene.emit(Ga.GAME_RESUME);const{level:e=1}=oz.getGameData()??{};this.node.scene.emit(Ga.GAME_REPLAY,{level:e})}}).prototype,"musicSetting",[DG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WG=ve(VG.prototype,"soundSetting",[OG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KG=ve(VG.prototype,"vibrateSetting",[NG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YG=ve(VG.prototype,"musicSwitch",[MG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jG=ve(VG.prototype,"soundSwitch",[kG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XG=ve(VG.prototype,"vibrateSwitch",[xG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$G=ve(VG.prototype,"closeButtonComponent",[FG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QG=ve(VG.prototype,"continueButtonComponent",[BG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JG=ve(VG.prototype,"restartButtonComponent",[GG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZG=ve(VG.prototype,"inviteFriendsButtonComponent",[zG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ez=ve(VG.prototype,"animNodes",[UG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HG=VG))||HG);var lz,cz,hz,dz,uz,pz,mz,gz,yz,bz,fz,wz,Sz,vz,Cz,Ez,Tz,Az,Rz,Iz,Pz,_z,Lz;i._RF.pop(),i._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);const{ccclass:Dz,property:Oz}=a;let Nz=(lz=Dz("StarChest"),cz=Oz(R),hz=Oz(x),dz=Oz(se),uz=Oz(x),pz=Oz(x),mz=Oz({type:E,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),gz=Oz({type:E,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),yz=Oz({type:E,displayName:"Centered Offset X",group:"Reward Animations"}),bz=Oz({type:E,displayName:"Centered Offset Y",group:"Reward Animations"}),fz=Oz({type:E,min:0,displayName:"Starting Scale",group:"Reward Animations"}),wz=Oz({type:E,min:0,displayName:"Ending Scale",group:"Reward Animations"}),lz((Cz=ve((vz=class extends s{constructor(){super(...arguments),e(this,"sprite",Cz,this),e(this,"glowOpacity",Ez,this),e(this,"explosionParticles",Tz,this),e(this,"circle",Az,this),e(this,"uiOpacity",Rz,this),this.ogCenterX=0,this.ogCenterY=0,e(this,"endingOffsetX",Iz,this),e(this,"endingOffsetY",Pz,this),e(this,"startingScale",_z,this),e(this,"endingScale",Lz,this)}get startingOffsetX(){return this.node.position.x}get startingOffsetY(){return this.node.position.y}__preload(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async moveToCenter(e){const t=new j(this.endingOffsetX,this.endingOffsetY,this.node.position.z);await St.runTweenAsync(C(this.node).to(.7,{position:t},{easing:"quintInOut"}),e),this.node.position=t}respawnAtStartingState(){this.node.position=new j(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}async scale(e,t){const i=this.startingScale+(this.endingScale-this.startingScale)*e,n=new j(i,i,i);await Promise.all([St.runTweenAsync(C(this.sprite.node).to(.2,{scale:n},{easing:"backOut"}),t),St.runTweenAsync(C(this.glowOpacity.node).to(.2,{scale:n},{easing:"backOut"}),t)]),this.sprite.node.setScale(n),this.glowOpacity.node.setScale(n)}startShaking(){const e=this.node.position.clone();this.shakingTween={ogPos:e,tw:C({}).to(.1,{},{onUpdate:(t,i)=>{if(i){const t=e.x+10*(i-.5);this.node.position=new j(t,e.y,e.z)}}}).repeatForever().start()}}stopShaking(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}async glow(e){const t=this.sprite.node.scale.clone().multiplyScalar(1.1);await Promise.all([St.runTweenAsync(C(this.sprite.node).to(.2,{scale:t},{easing:"cubicInOut"}),e),St.runTweenAsync(C(this.glowOpacity.node).to(.2,{scale:t}),e),St.runTweenAsync(C(this.glowOpacity).to(.5,{opacity:255}),e)])}async explode(e){const t=new j(8,8,8);await Promise.all([this.explodeParticles(e),(async()=>{this.circle.opacity=255,this.circle.node.setScale(j.ZERO),await Promise.all([St.runTweenAsync(C(this.circle).to(.3,{opacity:0}),e),St.runTweenAsync(C(this.circle.node).to(.3,{scale:t},{easing:"cubicOut"}),e)]),this.circle.opacity=0,this.circle.node.scale=t})(),(async()=>{await Promise.all([St.runTweenAsync(C(this.glowOpacity.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),e),St.runTweenAsync(C(this.sprite.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),e)]),this.sprite.node.setScale(j.ZERO),this.glowOpacity.node.setScale(j.ZERO)})()])}async explodeParticles(e){e.aborted||(this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem(),await St.waitTweenAsync(1),this.explosionParticles.node.active=!1)}}).prototype,"sprite",[cz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ez=ve(vz.prototype,"glowOpacity",[hz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tz=ve(vz.prototype,"explosionParticles",[dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Az=ve(vz.prototype,"circle",[uz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rz=ve(vz.prototype,"uiOpacity",[pz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(vz.prototype,"startingOffsetX",[mz],Object.getOwnPropertyDescriptor(vz.prototype,"startingOffsetX"),vz.prototype),ve(vz.prototype,"startingOffsetY",[gz],Object.getOwnPropertyDescriptor(vz.prototype,"startingOffsetY"),vz.prototype),Iz=ve(vz.prototype,"endingOffsetX",[yz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Pz=ve(vz.prototype,"endingOffsetY",[bz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_z=ve(vz.prototype,"startingScale",[fz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Lz=ve(vz.prototype,"endingScale",[wz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Sz=vz))||Sz);var Mz,kz,xz,Fz,Bz,Gz,zz,Uz,Hz,Vz,qz,Wz,Kz,Yz,jz,Xz,$z,Qz,Jz,Zz;i._RF.pop(),i._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);const{ccclass:eU,property:tU,requireComponent:iU}=a,{Events:nU}=GameCore,{event:aU,player:sU}=globalThis.game;Mz=eU("StarChestScreen"),kz=iU(lk),xz=tU(KT),Fz=tU(h),Bz=tU(p),Gz=tU(y),zz=tU(Nz),Uz=tU(x),Hz=tU(wv),Vz=tU(h),Mz(qz=kz((Kz=ve((Wz=class extends s{constructor(){super(...arguments),e(this,"starProgressBar",Kz,this),e(this,"buttonLabel",Yz,this),e(this,"button",jz,this),e(this,"chestAnimation",Xz,this),e(this,"starChest",$z,this),e(this,"chestUnlockFXMask",Qz,this),e(this,"skipOverlay",Jz,this),e(this,"messageLabel",Zz,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("StarChestScreen: screen not found");this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){aU.on(nU.OPENING_SCREEN,this.handleOpeningScreen),aU.on(nU.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){aU.off(nU.OPENING_SCREEN,this.handleOpeningScreen),aU.off(nU.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name}open(){this.runPopUpAnimation(),this.node.scene.emit(Ga.HIDE_UI);const e=sU.getGameData();if(!e)return;const{stars:t}=e;this.numChestAvailable=Math.floor(t/20),this.starProgressBar.setRange(t,20),this.buttonLabel.string=this.numChestAvailable?"Open":"Continue",this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.button.interactable=!0,this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}close(){aU.emit(nU.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ga.SHOW_UI)}runPopUpAnimation(){this.screen.container||console.warn("StarChestScreen: screen not found")}async handleClickButton(){if(0===this.numChestAvailable)return void this.close();Yi.turnDownMusic();const e=sU.getGameData();if(!e)return;this.button.interactable=!1;const{stars:t}=e;sU.setGameData({stars:e.stars-20*this.numChestAvailable});const i=new ai;await this.skipOverlay.open({opacity:200,onSkip:()=>i.abort()}),await this.handleUnlockAnimation(t,e.stars,i),await this.skipOverlay.close(),Yi.turnUpMusic(),W.emit(Jt),this.close()}async handleUnlockAnimation(e,t,i){await Promise.all([this.starChest.moveToCenter(i),this.fadeInChestUnlockFX(i)]),this.chestAnimation.stop(),this.starChest.startShaking(),Yi.playSound(xi.STAR_CHEST_DRUM_ROLL,{loop:!0}),await St.waitTweenAsync(0);let n=e,a=this.numChestAvailable;const s=e=>this.numChestAvailable>2?1-e/this.numChestAvailable:.35*(1-e/this.numChestAvailable);await Promise.all([this.starProgressBar.animateTo(t,i,(e=>{n-e>=20&&(n=e,a--,this.starChest.scale(s(a),i),Yi.playSound(xi.STAR_CHEST_OPEN))}))]),await St.waitTweenAsync(1,i),this.starChest.stopShaking(),await this.starChest.glow(i),Yi.stopSound(xi.STAR_CHEST_DRUM_ROLL);const o=mr*this.numChestAvailable;this.node.scene.emit(Ga.ADD_COINS,{coins:o,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:i}}),await this.starChest.explode(i),await St.waitTweenAsync(1,i),await Promise.all([this.fadeOutChestUnlockFX(i)])}async fadeInChestUnlockFX(e){this.chestUnlockFXMask.node.active=!0,await St.runTweenAsync(C(this.chestUnlockFXMask).to(.5,{opacity:150}),e)}async fadeOutChestUnlockFX(e){await St.runTweenAsync(C(this.chestUnlockFXMask).to(.3,{opacity:0}),e),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1}}).prototype,"starProgressBar",[xz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yz=ve(Wz.prototype,"buttonLabel",[Fz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jz=ve(Wz.prototype,"button",[Bz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xz=ve(Wz.prototype,"chestAnimation",[Gz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$z=ve(Wz.prototype,"starChest",[zz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qz=ve(Wz.prototype,"chestUnlockFXMask",[Uz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jz=ve(Wz.prototype,"skipOverlay",[Hz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zz=ve(Wz.prototype,"messageLabel",[Vz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qz=Wz))||qz);var oU,rU,lU,cU,hU,dU,uU,pU,mU,gU,yU,bU,fU,wU;i._RF.pop(),i._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);const{ccclass:SU,property:vU,requireComponent:CU}=a,{Events:EU}=GameCore,{event:TU}=globalThis.game;oU=SU("StartLevelScreen"),rU=CU(lk),lU=vU(n),cU=vU(n),hU=vU(n),dU=vU(n),uU=vU(p),oU(pU=rU((gU=ve((mU=class extends s{constructor(){super(...arguments),e(this,"playButton",gU,this),e(this,"goalText",yU,this),e(this,"levelText",bU,this),e(this,"missionText",fU,this),e(this,"playButtonComponent",wU,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("StartLevelScreen: screen not found");this.validateEventPayload(e)&&(this.playButtonComponent.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){TU.on(EU.OPENING_SCREEN,this.handleOpeningScreen),TU.on(EU.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){TU.off(EU.OPENING_SCREEN,this.handleOpeningScreen),TU.off(EU.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t,screenData:i}=e??{};return t===this.node.name&&(i?.level&&(this.levelId=i.level),i?.mission&&(this.mission=i.mission),!0)}open(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(Ga.HIDE_UI)}close(){this.playButtonComponent.interactable=!1,TU.emit(EU.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ga.SHOW_UI)}updateComponents(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}updateGoalText(){const{mission:e}=this.mission;this.goalText.getComponent(h).string=e>1?"Goals":"Goal"}updateLevelText(){this.levelText.getComponent(h).string=`Level ${this.levelId}`}updateDescriptionText(){this.missionText.getComponent(h).string=this.mission.description}runPopUpAnimation(){this.screen.container||console.warn("StartLevelScreen: screen not found")}handleClickedPlay(){this.node.scene.emit(Ga.GAME_START),this.close()}}).prototype,"playButton",[lU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yU=ve(mU.prototype,"goalText",[cU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bU=ve(mU.prototype,"levelText",[hU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fU=ve(mU.prototype,"missionText",[dU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wU=ve(mU.prototype,"playButtonComponent",[uU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pU=mU))||pU);var AU,RU,IU,PU,_U;i._RF.pop(),i._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);const{ccclass:LU,property:DU}=a;let OU=(AU=LU("TournamentLeaderSkeleton"),RU=DU(n),AU((_U=ve((PU=class extends s{constructor(){super(...arguments),e(this,"container",_U,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}async hide(e){await St.runTweenAsync(C(this.uiOpacity).to(.2,{opacity:0}).call((()=>{this.node.active=!1})),e)}async show(e,t){this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const i=this.container.position.clone();this.container.position=new j(i.x,i.y-100,i.z);const n=C(this.node).delay(e);n.to(.2,{scale:j.ONE},{easing:"elasticOut"});const a=C(this.container).delay(e);a.to(.2,{position:i},{easing:"backOut"});const s=C(this.uiOpacity).delay(e);s.to(.2,{opacity:255},{easing:"cubicOut"}),await Promise.all([St.runTweenAsync(n,t),St.runTweenAsync(a,t),St.runTweenAsync(s,t)])}validateRequiredComponents(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}).prototype,"container",[RU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IU=PU))||IU);var NU,MU,kU,xU,FU,BU,GU,zU,UU,HU,VU,qU,WU,KU,YU,jU,XU,$U,QU,JU,ZU,eH,tH,iH,nH,aH;i._RF.pop(),i._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);const{ccclass:sH,property:oH,requireComponent:rH}=a,{Events:lH}=GameCore,{Object:cH,Array:hH}=GameCore.Utils,{event:dH,storage:uH,player:pH,leaderboard:mH}=globalThis.game;NU=sH("TournamentDetailScreen"),MU=rH(lk),kU=oH(h),xU=oH(h),FU=oH(h),BU=oH(J_),GU=oH(l),zU=oH({type:n,group:"Buttons"}),UU=oH({type:n,group:"Buttons"}),HU=oH({type:n,group:"Buttons"}),VU=oH({type:[OU]}),qU=oH({type:[R]}),WU=oH(MS),NU(KU=MU((jU=ve((YU=class extends s{constructor(){super(...arguments),e(this,"titleLabel",jU,this),e(this,"timeLabel",XU,this),e(this,"playerCountLabel",$U,this),e(this,"tournamentLeaders",QU,this),e(this,"viewport",JU,this),e(this,"playButton",ZU,this),e(this,"continueButton",eH,this),e(this,"replayButton",tH,this),e(this,"leaderSkeletons",iH,this),e(this,"banners",nH,this),e(this,"paperConfetti",aH,this),this.animAbortSignal=null,this.fetchAbortController=null,this.leadersPayload=null,this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("TournamentDetailScreen: screen not found");this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(lk),this.tournamentScrollView=this.tournamentLeaders.node.getComponent(ce),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){dH.on(lH.OPENING_SCREEN,this.handleOpeningScreen),dH.on(lH.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){dH.off(lH.OPENING_SCREEN,this.handleOpeningScreen),dH.off(lH.OPENED_SCREEN,this.handleOpenedScreen)}updateVisibility(){this.tournamentLeaders.updateVisibility()}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name&&(this.payload=e,!0)}open(){if(this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(Ga.HIDE_UI),this.tournamentScrollView.node.on(ce.EventType.SCROLLING,this.updateVisibility,this),null!==this.animAbortSignal)throw new Error("TournamentContent: TournamentContent is already loading. Please handle cancelling gracefully.");this.animAbortSignal=new ai,this.updateInfo(this.animAbortSignal)}close(){Bl.closeTournamentDetailScreen(),this.node.scene.emit(Ga.SHOW_UI),this.tournamentScrollView.node.off(ce.EventType.SCROLLING,this.updateVisibility,this),this.cleanup()}cleanup(){this.fetchAbortController?.abort(),this.animAbortSignal?.abort(),this.animAbortSignal=null,this.fetchAbortController=null,this.tournamentLeaders.removeLeaders()}runPopUpAnimation(){this.screen.container||console.warn("StartLevelScreen: screen not found")}async updateInfo(e){const t=this.payload?.screenData?.tournament;if(!t)return;const i=JSON.parse(t);i.id=i.id.toString(),this.tournamentPayload=i;const{endTime:n,payload:a,title:s}=this.tournamentPayload,{leaderboardId:o="",themeId:r}=a;this.updateTitle(s),this.updateEndTime(n),this.updateTournamentBanner(r);const{previousScore:l,previousRank:c,animateTournamentLeader:h}=uH.getStorage("tournament");if(this.updateButtonsVisibility(h),await this.showLoading(e),this.leadersPayload=await this.getLeadersPayload(o),!this.leadersPayload)return this.updatePlayerCount(0),void this.hideLoading(e);const{player:d,leaders:u}=this.leadersPayload;this.updatePlayerCount(u.length);const p=d?.score??0;if(d&&h&&l&&l<p&&c&&c!==(d?.rank??0)){hH.search(u,(e=>e.playerId===d.playerId)).score=l}await this.hideLoading(e),this.tournamentLeaders.updateData(u),await this.runShowUpAnimation(e),h&&(uH.setStorageData("tournament","animateTournamentLeader",!1),await this.runPlayerRankChangeAnimation(e,p))}updateTournamentBanner(e){e?this.activateThemeBanner(e):this.activateThemeBanner(Xr.SUMMER)}activateThemeBanner(e){let t=!1;this.banners.forEach((i=>{i.node.active=i.node.name.toLowerCase()===e,i.node.active&&(t=!0)})),t||this.banners.forEach((e=>{e.node.active=e.node.name.toLowerCase()===Xr.SUMMER}))}async showLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;await Promise.all([this.leaderSkeletons.map(((i,n)=>i.show(n*t,e)))])}async hideLoading(e){await Promise.all(this.leaderSkeletons.map((t=>t.hide(e))))}async runShowUpAnimation(e){await this.tournamentLeaders.showLeaders(e);const t=this.tournamentLeaders.getPlayerLeader();t&&await this.scrollToLeader(t,1)}async runPlayerRankChangeAnimation(e,t){const i=this.tournamentLeaders.getLeaderData(),n=hH.search(i,(e=>e.playerId===pH.getPlayerId()));if(!n)return;const{score:a,rank:s}=n;if(a===t)return;n.score=t,i.sort(((e,t)=>t.score-e.score)),i.forEach(((e,t)=>{e.rank=t+1}));const o=this.tournamentLeaders.getPlayerLeader();if(!o)return;const r=this.tournamentLeaders.getLeaderByRank(n.rank);if(!r)return;this.tournamentLeaders.layout.enabled=!1,o.node.setParent(this.node,!0),await o.runScaleAnimation(e,1.1,.5),n.rank<=10&&Yi.playSound(xi.STAR_CHEST_DRUM_ROLL);const l=Math.min(.5*(s-n.rank),2),c=[o.runUpdateDataAnimation(s,n.rank,a,n.score,l),this.scrollToLeader(r,l)],h=this.viewport.contentSize.height,d=this.viewport.getBoundingBoxToWorld(),u=this.tournamentScrollView.getMaxScrollOffset().y,p=-r.node.position.y-h/2;let m=j.ZERO;p<0?m=new j(o.node.worldPosition.x,d.yMax+r.node.position.y,o.node.worldPosition.z):this.tournamentScrollView.getScrollOffset().y>=u-5&&(m=p<u?new j(o.node.worldPosition.x,d.center.y,o.node.worldPosition.z):r.node.worldPosition),m.equals(j.ZERO)||c.push(o.runWorldPositionAnimation(m,l)),await Promise.all(c),Yi.stopSound(xi.STAR_CHEST_DRUM_ROLL),await Promise.all([o.runScaleAnimation(e,1,.25),o.node.setParent(this.tournamentLeaders.layout.node,!0),o.node.setSiblingIndex(n.rank-1),this.tournamentLeaders.runUpdateLeadersRankAnimation(n.rank,s),this.runPaperConfettiEffect(n.rank)]),this.tournamentLeaders.layout.enabled=!0,this.tournamentLeaders.layout.updateLayout()}runPaperConfettiEffect(e){e>10||(this.paperConfetti.runEffect(),Yi.playSound(xi.LEADERBOARD_TRIUMPH))}async scrollToLeader(e,t){const{contentSize:i}=this.tournamentLeaders.uiTransform,n=new Q(0,-e.node.position.y-i.height/2),a=this.tournamentScrollView.getScrollOffset().clone();n.y=Math.max(n.y,0),a.y=Math.max(a.y,0);const s=n.y-a.y;if(!(Math.abs(s)<5))return this.tournamentScrollView.scrollToOffset(n,t),St.waitTweenAsync(t)}updateTitle(e){e&&(this.titleLabel.string=e)}updateEndTime(e){let t=GameCore.Utils.Time.getRelativeTime(e);t=t.replace("seconds","secs").replace("second","sec"),t=t.replace("minutes","mins").replace("minute","min"),this.timeLabel.string=`Ends ${t}`}updatePlayerCount(e){const t=GameCore.Utils.Number.getShortNumber(e,3);this.playerCountLabel.string=`${t} `+(e>1?"players":"player")}setPlayerCountWaiting(){this.playerCountLabel.string="Loading..."}async getLeadersPayload(e){const t=mH.getLeaderboardName(e);if(!t)return null;await mH.requestLeaderboardAsync(t,0);const i=mH.getLeaderboard(t);if(!i)return null;const n=cH.vals(i.leaders),a=pH.getPlayerId(),s={leaders:[],player:void 0,isPlayerInTournament:!1};for(const e of n){const{playerId:t}=e;t===a?(s.player=e,s.isPlayerInTournament=!0,s.leaders.push(e)):s.leaders.push(e)}return s}updateButtonsVisibility(e){this.playButton.active=!e,this.continueButton.active=e,this.replayButton.active=e}async handleOnPlay(){const e=this.tournamentPayload.id||"";if(Kl.validateTournamentExpired(e))return this.close(),this.node.scene.emit(Nr.RELOAD_TOURNAMENT),void Bl.showNotificationScreen("Tournament has ended",2);try{Bl.showLoadingNotificationScreen(),await this.processJoinTournament()}catch(e){if(cH.hasOwn(e,"code")&&"USER_INPUT"===e.code)return void Bl.closeNotificationScreen();try{await this.processContinueTournament()}catch(e){if(cH.hasOwn(e,"code")&&"USER_INPUT"===e.code)return void Bl.closeNotificationScreen();console.error("processPlayButtonPressed",e),Bl.showNotificationScreen("Sorry, you cannot join\nat this time.",2)}}}async processJoinTournament(){try{await this.joinTournamentAsync(),gl.switchScene(Lr,{level:1})}catch(e){throw console.warn("processJoinTournament",e),e}}async processContinueTournament(){try{await this.continueTournamentAsync(),gl.switchScene(Lr,{level:1})}catch(e){throw console.warn("processContinueTournament",e),e}}async joinTournamentAsync(){const e=this.tournamentPayload.id||"";await ul.joinTournamentAsync(e)}async continueTournamentAsync(){const e=GameSDK.context.getID()??"";await ul.continueTournamentAsync(e)}updateButtonVisibility(){const{tournamentContextType:e="tournament_start"}=this.payload?.screenData??{};switch(e){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}}).prototype,"titleLabel",[kU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XU=ve(YU.prototype,"timeLabel",[xU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$U=ve(YU.prototype,"playerCountLabel",[FU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QU=ve(YU.prototype,"tournamentLeaders",[BU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JU=ve(YU.prototype,"viewport",[GU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZU=ve(YU.prototype,"playButton",[zU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eH=ve(YU.prototype,"continueButton",[UU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tH=ve(YU.prototype,"replayButton",[HU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iH=ve(YU.prototype,"leaderSkeletons",[VU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nH=ve(YU.prototype,"banners",[qU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aH=ve(YU.prototype,"paperConfetti",[WU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KU=YU))||KU);var gH;i._RF.pop(),i._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);const{ccclass:yH}=a;yH("TournamentLeader")(gH=class extends M_{});i._RF.pop(),i._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);const{Events:bH}=GameCore,{event:fH,monitorError:wH}=globalThis.game;class SH{constructor(){this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=()=>{if(!this.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void wH?.sendException(new Error("Core: Booting callback is not set"));console.info(" Core: Boot"),this.callbackCoreBooting(),this.callbackCoreBooting=null},this.handleWhenCoreStarting=()=>{if(!this.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void wH?.sendException(new Error("Core: Starting callback is not set"));console.info(" Core: Starting"),this.callbackCoreStarting(),this.callbackCoreStarting=null},this.handleWhenCoreReady=()=>{if(!this.callbackCoreReady)return console.error("Core: Ready callback is not set"),void wH?.sendException(new Error("Core: Ready callback is not set"));console.info(" Core: Ready"),this.callbackCoreReady(),this.callbackCoreReady=null}}init(){this.listenEvents(),console.info("Core Manager: Initialized")}listenEvents(){fH.once(bH.CORE_BOOTING,this.handleWhenCoreBooting),fH.once(bH.CORE_STARTING,this.handleWhenCoreStarting),fH.once(bH.CORE_READY,this.handleWhenCoreReady)}requestStart(){fH.emit(bH.REQUEST_CORE_START)}onCoreBoot(e){this.callbackCoreBooting=e;fH.getEventEmitCount(bH.CORE_BOOTING)>0&&(fH.off(bH.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}onCoreStart(e){this.callbackCoreStarting=e;fH.getEventEmitCount(bH.CORE_STARTING)>0&&(fH.off(bH.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}onCoreReady(e){this.callbackCoreReady=e;fH.getEventEmitCount(bH.CORE_READY)>0&&(fH.off(bH.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}i._RF.pop(),i._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);const{Configs:vH,Utils:CH}=GameCore,{GameEngine:EH}=vH,{Valid:TH}=CH;class AH{constructor(){this.overrideSettings=()=>{ue.overrideSettings(pe.Category.ENGINE,"debug",TH.isDebugger())},this.handleResizeView=e=>{le.instance.resizeWithBrowserSize(!1);const{width:t,height:i}=e;this.resizeView(t,i)},this.handleViewResized=e=>{const{width:t,height:i}=e;le.instance.resizeWithBrowserSize(!0),console.info(" New View Size",{width:t,height:i})}}init(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.listenEvents(),console.info("Engine Manager: Initialized")}listenEvents(){W.on(Vn,this.handleResizeView),W.on(qn,this.handleViewResized)}setupAutoAtlas(){me.instance.cacheAsset=!0}setupDynamicAtlas(){switch(Y.os){case Y.OS.IOS:this.setupDynamicAtlasForIOS();break;case Y.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}setDynamicAtlas(e){const{Enabled:t,AutoAtlasSize:i,MaxAtlasCount:n,MaxAtlasSize:a,MaxFrameSize:s}=e;if(ge.instance.enabled=t,ge.instance.textureSize=a,ge.instance.maxFrameSize=s,ge.instance.maxAtlasCount=n,ge.instance.textureBleeding=!0,i){const e=this.getMaxTextureSize();if(!e)return;ge.instance.maxAtlasCount=1,ge.instance.textureSize=e}}getMaxTextureSize(){if(!m.root)return-1;const{capabilities:e}=m.root.device,{maxTextureSize:t}=e;return t>8192?7168:t-1024}setupDynamicAtlasForIOS(){const{IOS:e}=EH.DynamicAtlas;this.setDynamicAtlas(e)}setupDynamicAtlasForAndroid(){const{Android:e}=EH.DynamicAtlas;this.setDynamicAtlas(e)}setupDynamicAtlasForDesktop(){const{Desktop:e}=EH.DynamicAtlas;this.setDynamicAtlas(e)}setupBatcherLimit(){ye.BATCHER2D_MEM_INCREMENT=288,ye.MAX_LABEL_CANVAS_POOL_SIZE=125}resizeView(e,t){const i=window.devicePixelRatio,n=i>=2?2/i:1,a=e*i*n,s=t*i*n;m.root?.resize(a,s),B.windowSize=new G.Size(a,s),m.once(J.EVENT_AFTER_UPDATE,(()=>{W.emit(qn,{width:a,height:s})}))}}i._RF.pop();var RH=new class{constructor(){this._registry={},this._moduleCache={}}define(e,t,i){this._registry[e]={factory:t,resolveMap:i}}require(e){return this._require(e)}throwInvalidWrapper(e,t){throw new Error(`Module '${e}' imported from '${t}' is expected be an ESM-wrapped CommonJS module but it doesn't.`)}_require(e,t){const i=this._moduleCache[e];if(i)return i.exports;const n={id:e,exports:{}};return this._moduleCache[e]=n,this._tryModuleLoad(n,e),n.exports}_resolve(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}_resolveFromInfos(e,t){return e in cjsInfos?e:t?cjsInfos[t]?.resolveCache[e]??void 0:void 0}_tryModuleLoad(e,t){let i=!0;try{this._load(e,t),i=!1}finally{i&&delete this._moduleCache[t]}}_load(e,t){const{factory:i,resolveMap:n}=this._loadWrapper(t),a=this._createRequire(e),s=n?this._createRequireWithResolveMap("function"==typeof n?n():n,a):a;i(e.exports,s,e)}_loadWrapper(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}_loadHostProvidedModules(e){return{factory:(t,i,n)=>{if("undefined"==typeof require)throw new Error(`Current environment does not provide a require() for requiring '${e}'.`);try{n.exports=require(e)}catch(t){throw new Error(`Exception thrown when calling host defined require('${e}').`,{cause:t})}}}}_createRequire(e){return t=>this._require(t,e)}_createRequireWithResolveMap(e,t){return i=>{const n=e[i];if(n)return t(n);throw new Error("Unresolved specifier "+i)}}_throwUnresolved(e,t){throw new Error(`Unable to resolve ${e} from ${parent}.`)}};let IH;const PH="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";RH.define(PH,(function(e,t,i,n,a){!function(t,n){"object"==typeof e&&void 0!==i?i.exports=n():"function"==typeof define&&define.amd?define(n):t.ResizeObserver=n()}(this,(function(){var e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var i=-1;return e.some((function(e,n){return e[0]===t&&(i=n,!0)})),i}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var i=e(this.__entries__,t),n=this.__entries__[i];return n&&n[1]},t.prototype.set=function(t,i){var n=e(this.__entries__,t);~n?this.__entries__[n][1]=i:this.__entries__.push([t,i])},t.prototype.delete=function(t){var i=this.__entries__,n=e(i,t);~n&&i.splice(n,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var i=0,n=this.__entries__;i<n.length;i++){var a=n[i];e.call(t,a[1],a[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,i="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),n="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(i):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],s="undefined"!=typeof MutationObserver,o=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var i=!1,a=!1,s=0;function o(){i&&(i=!1,e()),a&&l()}function r(){n(o)}function l(){var e=Date.now();if(i){if(e-s<2)return;a=!0}else i=!0,a=!1,setTimeout(r,t);s=e}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,i=t.indexOf(e);~i&&t.splice(i,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),s?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,i=void 0===t?"":t;a.some((function(e){return!!~i.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),r=function(e,t){for(var i=0,n=Object.keys(t);i<n.length;i++){var a=n[i];Object.defineProperty(e,a,{value:t[a],enumerable:!1,writable:!1,configurable:!0})}return e},l=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||i},c=g(0,0,0,0);function h(e){return parseFloat(e)||0}function d(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduce((function(t,i){return t+h(e["border-"+i+"-width"])}),0)}function u(e){var t=e.clientWidth,i=e.clientHeight;if(!t&&!i)return c;var n=l(e).getComputedStyle(e),a=function(e){for(var t={},i=0,n=["top","right","bottom","left"];i<n.length;i++){var a=n[i],s=e["padding-"+a];t[a]=h(s)}return t}(n),s=a.left+a.right,o=a.top+a.bottom,r=h(n.width),u=h(n.height);if("border-box"===n.boxSizing&&(Math.round(r+s)!==t&&(r-=d(n,"left","right")+s),Math.round(u+o)!==i&&(u-=d(n,"top","bottom")+o)),!function(e){return e===l(e).document.documentElement}(e)){var p=Math.round(r+s)-t,m=Math.round(u+o)-i;1!==Math.abs(p)&&(r-=p),1!==Math.abs(m)&&(u-=m)}return g(a.left,a.top,r,u)}var p="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof l(e).SVGGraphicsElement}:function(e){return e instanceof l(e).SVGElement&&"function"==typeof e.getBBox};function m(e){return t?p(e)?function(e){var t=e.getBBox();return g(0,0,t.width,t.height)}(e):u(e):c}function g(e,t,i,n){return{x:e,y:t,width:i,height:n}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=g(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=m(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),b=function(e,t){var i,n,a,s,o,l,c,h=(n=(i=t).x,a=i.y,s=i.width,o=i.height,l="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,c=Object.create(l.prototype),r(c,{x:n,y:a,width:s,height:o,top:a,right:n+s,bottom:o+a,left:n}),c);r(this,{target:e,contentRect:h})},f=function(){function t(t,i,n){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=i,this.callbackCtx_=n}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new b(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),w="undefined"!=typeof WeakMap?new WeakMap:new e,S=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=o.getInstance(),n=new f(t,i,this);w.set(this,n)};return["observe","unobserve","disconnect"].forEach((function(e){S.prototype[e]=function(){var t;return(t=w.get(this))[e].apply(t,arguments)}})),void 0!==i.ResizeObserver?i.ResizeObserver:S})),IH=i.exports}),{}),RH.require(PH),i._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);const{Layout:_H,DesignSize:LH}=ea,{Portrait:DH,Landscape:OH}=LH,{Function:NH}=GameCore.Utils;class MH{constructor(){this.currentLayout="",this.handleViewResizeBySystem=e=>{console.info(" View resize by system"),window.devicePixelRatio=e||window.devicePixelRatio,this.setupOrientationByScreenSize(),this.resizeGameView()},this.handleViewResize=NH.debounce((()=>{console.info(" View resize by window"),this.setupOrientationByScreenSize(),this.resizeGameView()}),200),this.handleBodyResize=NH.debounce((()=>{this.resizeGameDiv()&&(console.info(" View resize by body"),this.setupOrientationByScreenSize(),this.resizeGameView())}),200)}init(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),W.emit(Wn),console.info("Layout Manager: Initialized")}listenResizeEvent(){Y.isBrowser?(B.on("window-resize",this.handleViewResize,this),B.on("orientation-change",this.handleViewResize,this)):Y.isMobile?window.addEventListener("resize",this.handleViewResize,{capture:!1,passive:!0}):console.warn("LayoutManager: Not support this platform"),W.on(Wn,this.handleViewResizeBySystem)}listenObserverEvent(){new IH(this.handleBodyResize).observe(document.body)}setupResolutionPolicy(){le.instance.resizeWithBrowserSize(!0),le.instance.setOrientation(ye.ORIENTATION_AUTO),le.instance.setResolutionPolicy(be.ContentStrategy.FIXED_WIDTH),le.instance.setResolutionPolicy(be.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=le.instance.getResolutionPolicy()}setupOrientationByScreenSize(){const e=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(be.ContentStrategy.FIXED_WIDTH),e<1?this.setPortraitView():this.setLandscapeView()}resizeGameDiv(){const e=document.getElementById("GameDiv");if(!e)return!1;const t=ji.getScreenWidthCss(),i=ji.getScreenHeightCss(),{width:n,height:a}=e.getBoundingClientRect();return(t!==n||i!==a)&&(e.style.width=`${t}px`,e.style.height=`${i}px`,!0)}resizeGameView(){let e=ji.getScreenWidthCss(),t=ji.getScreenHeightCss();W.emit(Vn,{width:e,height:t})}setPortraitView(){let{WIDTH:e,HEIGHT:t}=DH;ea.FORCE_LAYOUT===_H.Landscape&&(e=OH.WIDTH,t=OH.HEIGHT,this.resolutionPolicy.setContentStrategy(be.ContentStrategy.SHOW_ALL)),this.currentLayout=_H.Portrait,this.changeDesignResolutionSize(e,t)}setLandscapeView(){let{WIDTH:e,HEIGHT:t}=OH;ea.FORCE_LAYOUT===_H.Portrait&&(e=DH.WIDTH,t=DH.HEIGHT,this.resolutionPolicy.setContentStrategy(be.ContentStrategy.EXACT_FIT)),this.currentLayout=_H.Landscape,this.changeDesignResolutionSize(e,t)}changeDesignResolutionSize(e,t){le.instance.setDesignResolutionSize(e,t,this.resolutionPolicy),W.emit(Kn,this.currentLayout),console.info(" Change layout to",this.currentLayout)}getScreenRatio(){return ji.getScreenWidthCss()/ji.getScreenHeightCss()}}i._RF.pop(),i._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);const{Utils:kH,Dtos:xH}=GameCore,{Valid:FH,Object:BH,Array:GH}=kH,zH=["code","cols","encoding","idSize","rows"],UH=["addRandomTilesPerMove","maxSpaceOfPair"];class HH{init(){console.info("Match Manager: Initialized")}setupDefaultMatchData(){this.setupMatchData(),this.setupMatchCustomData()}setupMatchCustomData(){const{Match:e}=xH;e.CustomData.addDefaultData(Ir),e.CustomData.addValidateFunction("score",(e=>{if(!FH.isNumber(e)||e<0)throw new Error(`score ${e} is invalid`)}))}setupMatchData(){const{Match:e}=xH;e.Data.addDefaultData(wr),e.Data.addValidateFunction("extraData",(e=>{if(null==e)return;if(!FH.isObject(e))throw new Error(`extraData ${e} must be a record of string keys`);const t=e,i=Object.keys(t);if(!GH.has(i,"level"))throw new Error("extraData.level is missing");if(!FH.isNumber(t.level))throw new Error(`extraData.level ${t.level} must be a number`);if(!GH.has(i,"fen"))throw new Error("extraData.fen is missing");if(this.validateFen(t.fen),!GH.has(i,"gravity"))throw new Error("extraData.gravity is missing");if(!FH.isString(t.gravity))throw new Error(`extraData.gravity ${t.gravity} must be a string`);if(!GH.has(i,"rules"))throw new Error("extraData.rules is missing");if(this.validateLevelRules(t.rules),!GH.has(i,"time"))throw new Error("extraData.time is missing");if(!FH.isNumber(t.time))throw new Error(`extraData.time ${t.time} must be a number`)}))}validateFen(e){if(!FH.isObject(e))throw new Error(`extraData.fen ${e} must be a record of string keys`);const t=this.validateKeys(e,zH);if(!FH.isNumber(t.idSize))throw new Error("fen.idSize must be a number");if(!FH.isString(t.code))throw new Error("fen.code must be a string");if(!FH.isNumber(t.rows))throw new Error("fen.rows must be a number");if(!FH.isNumber(t.cols))throw new Error("fen.cols must be a number");if(!FH.isObject(t.encoding))throw new Error("fen.encoding must be a record of string keys");const i=this.validateKeys(t.encoding,BH.vals(rc));Object.entries(i).forEach((e=>{let[t,i]=e;if(!FH.isString(i))throw new Error(`fen.encoding.${t} ${i} must be a string`)}))}validateLevelRules(e){if(!FH.isObject(e))throw new Error(`extraData.rules ${e} must be a record of string keys`);const t=this.validateKeys(e,UH);if(!FH.isNumber(t.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!FH.isNumber(t.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}validateKeys(e,t){return Object.keys(e).forEach((e=>{if(!t.indexOf(e))throw new Error(`Key ${e} is missing`)})),e}}i._RF.pop(),i._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);const{Utils:VH,Dtos:qH}=GameCore,{Valid:WH,Array:KH,Object:YH}=VH,{player:jH}=globalThis.game;class XH{init(){console.info("Player Manager: Initialized")}setupDefaultGameData(){const{Player:e}=qH;e.Data.addDefaultData(Pr),e.GameData.addDefaultData(Cr),e.GameData.addValidateFunction("stars",(e=>{if(!WH.isNumber(e)||e<0)throw new Error(`stars ${e} is invalid`)})),e.GameData.addValidateFunction("totalLevel",(e=>{if(!WH.isNumber(e)||e<1)throw new Error(`totalLevel ${e} is invalid`)})),e.GameData.addValidateFunction("levelVersion",(e=>{if(!WH.isNumber(e)||e<0)throw new Error(`levelVersion ${e} is invalid`)})),e.GameData.addValidateFunction("lastRewardedItems",(e=>{if(!WH.isNumber(e)||e<0)throw new Error(`lastRewardedItems ${e} is invalid`)})),e.GameData.addValidateFunction("lastCreateTournamentShown",(e=>{if(!WH.isNumber(e)||e<0)throw new Error(`lastCreateTournamentShown ${e} is invalid`)})),e.GameData.addValidateFunction("guideItemShowed",(e=>{if(!Array.isArray(e))throw new Error(`guideItemShowed ${e} is invalid`)})),e.GameData.addValidateFunction("items",(e=>{if(!WH.isObject(e))throw new Error(`items ${e} is invalid`);const t=Object.keys(e),i=YH.vals(e);if(!KH.has(t,dr.HINT))throw new Error(`item ${dr.HINT} not found`);if(!KH.has(t,dr.THUNDER))throw new Error(`item ${dr.THUNDER} not found`);if(!KH.has(t,dr.STORM))throw new Error(`item ${dr.STORM} not found`);if(!KH.has(t,dr.PLIERS))throw new Error(`item ${dr.PLIERS} not found`);i.forEach((e=>{if(!WH.isNumber(e)||e<0)throw new Error(`item ${e} is invalid`)}))})),e.GameData.addValidateFunction("skins",(e=>{if(!WH.isObject(e))throw new Error(`skins ${e} is invalid`)}))}requestConnectedPlayers(){jH.requestConnectedPlayers().catch((e=>{console.warn("player.requestConnectedPlayers",e)}))}}i._RF.pop(),i._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);const{Events:$H,Utils:QH}=GameCore,{Valid:JH}=QH,{event:ZH,adaptivePerformance:eV}=globalThis.game;class tV{constructor(){this.handleBeginFrame=()=>{m.on(J.EVENT_AFTER_UPDATE,this.lateUpdate),m.on(J.EVENT_BEFORE_UPDATE,this.updateActualFPS)},this.handleAfterSceneLaunch=e=>{eV&&eV.trackingScene(e.name)},this.handleRequestResizeGame=e=>{const{forcePixelRatio:t}=e;JH.isNumber(t)&&W.emit(Wn,t)},this.lateUpdate=()=>{const e=1e3*W.deltaTime;eV?.updatePostStepDeltaTime(e)},this.updateActualFPS=()=>{const e=m.root?.fps;JH.isNumber(e)&&eV?.updateActualFPS(e)}}init(){eV&&this.listenEvents()}listenEvents(){ZH.on($H.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),m.once(J.EVENT_BEGIN_FRAME,this.handleBeginFrame),m.on(J.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}i._RF.pop(),i._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);const{canvasRecorder:iV}=globalThis.game;class nV{init(){if(!W.canvas||!iV)return;iV.setCanvas(W.canvas);const e=iV.getOptions(),t=iV.waitNextFrame;iV.waitNextFrame=async()=>e.syncFps?new Promise((e=>{m.once(J.EVENT_AFTER_RENDER,e),W.pause(),W.step()})):(W.resume(),await t.call(iV),Promise.resolve())}}i._RF.pop(),i._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);class aV{constructor(){this.hideCocosStats=()=>{clearInterval(this.waiter),this.waiter=setInterval(this.checkProfilerReady,100)},this.checkProfilerReady=()=>{if(!K)return;K._showFPS=!1;const{_rootNode:e}=K;e&&(e.active=!1,e.isValid&&(e.destroyAllChildren(),e.removeAllChildren(),e.destroy(),clearInterval(this.waiter)))}}init(){K&&m.on(J.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}i._RF.pop(),i._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);const{Configs:sV,Events:oV,Utils:rV}=GameCore,{Array:lV}=rV,{GameEngine:cV}=sV,{event:hV}=globalThis.game,dV=[".png",".jpg",".jpeg",".webp"];class uV{constructor(){this.useHighQuality=!1,this.upgradableAssets=new Map,this.requestUpdateDynamicAssets=()=>{W.emit(Zn)},this.collectUpgradableAssets=e=>{const t=e.output=e.input;for(const e of t)if(lV.has(dV,e.ext)&&!this.upgradableAssets.has(e.uuid)){this.useHighQuality&&(e.url=this.replaceAssetUrl(e.url),e.requestUpgrade=!0);const t={uuid:e.uuid,url:e.url,options:e.options,upgraded:e.upgraded,requestUpgrade:e.requestUpgrade,ext:e.ext};this.upgradableAssets.set(e.uuid,t)}},this.replaceAssetUrl=e=>this.useHighQuality?e.replace("native/","native32/"):e,this.handleUpgradeQuality=()=>{this.useHighQuality=!0;let e=0,t=0;const{assets:i,loadAny:n}=me.instance;let a=0;this.upgradableAssets.forEach((s=>{if(s.upgraded||s.requestUpgrade)return void e++;t++;const o=i.get(s.uuid);o instanceof O?(s.url=this.replaceAssetUrl(s.url),console.info("DynamicAssets: Process upgrade quality",s.uuid,s,o),n(s,s.options,((e,i)=>{a++,e?console.warn("DynamicAssets: Upgrade error",e):(o.reset(i),s.upgraded=!0,this.upgradableAssets.set(s.uuid,s),console.info("DynamicAssets: Upgrade done",s.uuid,i,o),a>=t&&this.requestUpdateDynamicAssets())}))):console.warn("DynamicAssets: Asset not found",s.uuid)})),console.warn("DynamicAssets: Upgradable Assets Info",{needUpgrade:t,upgraded:e,total:this.upgradableAssets.size})}}init(){const{Enabled:e}=cV.DynamicAssets;console.info("DynamicAssets: init",{EDITOR:false,Enabled:e}),e&&(me.instance.transformPipeline.insert(this.collectUpgradableAssets,3),this.listenEvents())}listenEvents(){W.on(Jn,this.handleUpgradeQuality),hV.on(oV.SCENE_LAUNCHED,(e=>{const t=e.sceneName,i=[_r];lV.has(i,t)||this.handleUpgradeQuality()}))}}i._RF.pop(),i._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);const{Configs:pV,Events:mV,Utils:gV}=GameCore,{Array:yV}=gV,{GameEngine:bV}=pV,{event:fV}=globalThis.game;class wV{constructor(){this.drawInfo=[],this.atlasInfo=null,this.lastRenderTime=0,this.updateRenderTime=()=>{this.lastRenderTime=performance.now()},this.checkRenderTimeHighers=()=>{const e=performance.now()-this.lastRenderTime;e>8&&(m.off(J.EVENT_AFTER_RENDER,this.checkRenderTimeHighers),console.warn(`DynamicAtlas: Laggy frame detected, render time is ${e.toFixed(2)}ms`),this.requestUpdateDynamicAtlas(),setTimeout((()=>{m.on(J.EVENT_AFTER_RENDER,this.checkRenderTimeHighers)}),2e3))},this.requestUpdateDynamicAtlas=()=>{m.once(J.EVENT_AFTER_RENDER,this.updateDynamicAtlas)},this.updateDynamicAtlas=()=>{const e=m.getScene();if(!e)return;const t=e.getComponentsInChildren(fe),i=[],n={};t.forEach((e=>{if(!e.enabled)return;if(!e.node.activeInHierarchy)return;if(!("spriteFrame"in e))return;if(!(e.spriteFrame instanceof N))return;const{uuid:t,packable:a,texture:s,original:o}=e.spriteFrame;if(!a)return void console.warn("DynamicAtlas: Skip non-packable texture",e.name);if(!(s instanceof we))return void console.warn("DynamicAtlas: Skip non-texture2d texture",e.name);let r=s.getId();const{width:l,height:c}=s,{width:h,height:d}=o?._texture||{width:0,height:0};if(o){const t=o._texture.getId();if(r===t)return void console.warn("DynamicAtlas: Skip original texture",e.name,{ori:o._texture,tex:s});r=t}let u=o?h:l,p=o?d:c;if(u<=1||p<=1)return void console.warn("DynamicAtlas: Skip invalid texture size",e.name,{w:u,h:p});u+=2,p+=2;const m={id:r,w:u,h:p,x:-1,y:-1};n[r]?n[r].components.push(e):(i.push(m),n[r]={...m,name:t,components:[e]})})),console.info("DynamicAtlas: collect info",n),i.length<1||(console.info("DynamicAtlas: process textures",i),this.drawInfo=[],this.atlasInfo=null,this.generateDrawInfo(i),this.atlasInfo?(this.updateAtlasData(),this.refreshComponents(t)):console.warn("DynamicAtlas: Atlas info not found",{textures:i}))},this.generateDrawInfo=e=>{if(e.length<1)return;console.info("DynamicAtlas: generate draw info",e);const{textureSize:t}=ge.instance;if(this.calculateOptimizedAtlas(e,t),!this.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found",{textures:e});const{textures:i}=this.atlasInfo;if(i.forEach((e=>{this.drawInfo.push(e)})),e.length>i.length){const t=e.filter((e=>!i.some((t=>t.id===e.id))));console.warn("DynamicAtlas: Missing textures",t),this.generateDrawInfo(t)}},this.calculateOptimizedAtlas=(e,t)=>{const{w:i,h:n,fill:a}=function(e){let t=0,i=0;for(const n of e)t+=n.w*n.h,i=Math.max(i,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let a=0,s=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const i=n[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,s=Math.max(s,t.y+t.h),a=Math.max(a,t.x+t.w),t.w===i.w&&t.h===i.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(n.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:a,h:s,fill:t/(a*s)||0}}(e);if(i>t||n>t){e.pop()?this.calculateOptimizedAtlas(e,t):console.warn("DynamicAtlas: Texture size is too big",i,n,t)}else this.atlasInfo={textures:e,atlasSize:t,packedInfo:{width:i,height:n,fillRate:a}}},this.drawTexture=(e,t,i)=>{const n=t.texture,a=n.getId(),s=yV.search([...this.drawInfo],(e=>e.id===a)),{x:o,y:r}=s||{x:-1,y:-1};if(o<0||r<0)return;const l=e._innerTextureInfos[a];l||(i&&(e._texture.drawTextureAt(n.image,o-1,r),e._texture.drawTextureAt(n.image,o+1,r),e._texture.drawTextureAt(n.image,o,r-1),e._texture.drawTextureAt(n.image,o,r+1)),e._texture.drawTextureAt(n.image,o,r),e._count++,e._innerTextureInfos[a]={texture:n,x:o,y:r});let{x:c,y:h}=t.rect;c+=l?.x||o,h+=l?.y||r;const d={texture:e._texture,x:c,y:h};return e._innerSpriteFrames.push(t),d},this.refreshComponents=e=>{e.forEach((e=>{e.node.active&&(e.node.active=!1,e.node.active=!0)}))}}init(){const{TextureAtlasOptimize:e}=bV.DynamicAtlas;e&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:e}),this.listenEvents(),this.overrideDynamicAtlas())}listenEvents(){fV.on(mV.SCENE_LAUNCHED,this.requestUpdateDynamicAtlas),W.on(Zn,this.requestUpdateDynamicAtlas),m.on(J.EVENT_BEFORE_RENDER,this.updateRenderTime),m.on(J.EVENT_AFTER_RENDER,this.checkRenderTimeHighers)}overrideDynamicAtlas(){const{instance:e}=ge;ge.instance.insertSpriteFrame=t=>{if(e._atlasIndex>=e._maxAtlasCount)return null;if(!t||t.original)return null;if(!t.packable)return null;let i=this.getAtlas();const n=i?i.insertSpriteFrame(t):null;return!n&&e._atlasIndex<e._maxAtlasCount?(i=this.getAtlas(),i?i.insertSpriteFrame(t):null):n}}createAtlas(){const{instance:e}=ge;return e.newAtlas()}getAtlas(){const{_atlases:e=[],_atlasIndex:t,textureBleeding:i}=ge.instance;let n=e[t];return n||(n=this.createAtlas()),n.originalInsertSpriteFrame||(n.originalInsertSpriteFrame=n.insertSpriteFrame,n.insertSpriteFrame=e=>this.drawTexture(n,e,i)),n}updateAtlasData(){if(!this.atlasInfo)return;console.info("DynamicAtlas: atlas info",this.atlasInfo);const{packedInfo:e}=this.atlasInfo;ge.instance.reset();const t=this.getAtlas();if(t){const{width:i,height:n}=e,a=Math.max(i,n);t._texture.initWithSize(a,a),console.info("DynamicAtlas: Resize texture",a,t._texture)}}}i._RF.pop();var SV={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};i._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);const{Events:vV}=GameCore,{event:CV,language:EV}=globalThis.game;class TV{constructor(){this.handleLanguageChanged=async e=>{const{locale:t}=e;W.emit("update-language",t),this.updateComponentInEditor()}}init(){this.addLanguage("en").then((()=>{this.setLanguage("en"),this.listenEvent()}))}listenEvent(){CV.on(vV.LANGUAGE_CHANGED,this.handleLanguageChanged)}async addLanguage(e){const t=await this.getLangData(e);EV.add(e,t)}setLanguage(e){EV.choose(e)}async getLangData(e){switch(e){case"en":return SV;case"ru":return this.loadLanguageAsync(e);default:throw new Error(`Language ${e} not supported`)}}async loadLanguageAsync(e){const i=(await t.import(`db://assets/resources/locales/${e}.json`)).default;EV.add(e,i)}updateComponentInEditor(){}}i._RF.pop(),i._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);const{Configs:AV,Utils:RV}=GameCore,{Mockup:IV}=AV,{Number:PV}=RV,{leaderboard:_V}=globalThis.game;class LV{constructor(){this.handleWhenGameSDKStarted=()=>{AV.Mockup.Leaderboards.Enabled?this.setupLeaderboardsMockup():this.setupLeaderboards()}}init(){this.handleWhenGameSDKStarted()}async setupLeaderboards(){this.setupLeaderboardByConfigs()}setupLeaderboardByConfigs(){const{LeaderboardId:e}=AV.Leaderboards;e?(_V.addLeaderboard({name:Er,type:"global",autoSortRank:!0,leaderboardId:e}),_V.addLeaderboard({name:Tr,type:"friends",autoSortRank:!0,leaderboardId:e})):console.warn("LeaderboardId in Configs is not set")}async setupLeaderboardsMockup(){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard()}async setupMockGlobalLeaderboard(){const e=Er,t=Ar,i=await _V.createLeaderboardAsync({_id:t,name:e,numberOfLeaders:100});_V.addLeaderboard({name:e,type:"global",autoSortRank:!0,leaderboardId:i}),await _V.requestLeaderboardAsync(e,10);let n=_V.getLeaderboard(e);console.info("setupGlobalLeaderboard fetch new",n,n&&Object.keys(n.leaders).length),n=_V.getLeaderboard(e),console.info("setupGlobalLeaderboard load more",n,n&&Object.keys(n.leaders).length)}async setupMockFriendsLeaderboard(){const e=Tr,t=Rr;let i=0;const{ConnectedPlayers:n}=IV.GameSDK.Player;n.Enabled&&(i=PV.random(n.NumOfPlayers));const a=await _V.createLeaderboardAsync({_id:t,name:e,numberOfLeaders:i});_V.addLeaderboard({name:e,type:"friends",autoSortRank:!0,leaderboardId:a}),await _V.requestLeaderboardAsync(e,10);const s=_V.getLeaderboard(e);console.info("setupFriendsLeaderboard done",s)}async setupMockGlobalTournamentLeaderboard(){const e=await Kl.requestTournamentDataAsync();e.forEach((e=>{const{payload:t}=e,{leaderboardId:i}=t;i&&(_V.isExistLeaderboardId(i)||_V.addLeaderboard({type:"tournament",name:i,autoSortRank:!0,leaderboardId:i}))})),console.info("setupGlobalTournamentLeaderboard done",e)}}i._RF.pop(),i._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);const{Configs:DV,Utils:OV,Events:NV}=GameCore,{PerformanceMonitor:MV}=DV,{event:kV}=globalThis.game;class xV{constructor(){this.markName="FPS Tracking",this.handleStartTraceFps=()=>{this.startTraceFps()},this.handleLateUpdate=()=>{if(this.mark){if(this.fpsTraceDuration-=W.deltaTime,this.fpsTraceDuration<=0&&!this.traceStopped)return this.traceStopped=!0,this.unListenEvents(),this.updateFPS(),void this.mark.stop(this.markName);this.fpsTraceIntervalTimer-=W.deltaTime,this.fpsTraceIntervalTimer>0||(this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.updateFPS(),this.mark.stop(this.markName),this.startTraceFps())}}}get mark(){return MV.FpsTracking?OV.Mark:null}init(){const{TrackingDuration:e,TrackingInterval:t}=MV.FpsTracking;this.fpsTraceDuration=e??60,this.fpsTraceInterval=t??10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}listenEvents(){kV.once(NV.GAME_READY,this.handleStartTraceFps),m.on(J.EVENT_AFTER_UPDATE,this.handleLateUpdate)}unListenEvents(){m.off(J.EVENT_AFTER_UPDATE,this.handleLateUpdate)}startTraceFps(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}updateFPS(){if(!this.mark)return;const e=this.getFPS(),t=this.getDrawCalls(),i=this.getDeviceRender(),n=this.getTextureMemory();this.minFps=Math.min(this.minFps??e,e),this.maxFps=Math.max(this.maxFps??0,e),this.mark.putMetric(this.markName,"FPS Metric",e),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",i),this.mark.putAttr(this.markName,"Draw Calls",t.toString()),this.mark.putAttr(this.markName,"Texture Memory",n.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info(`FPS: ${e} Min: ${this.minFps} Max: ${this.maxFps}, draw calls: ${t}, texture memory: ${n.toFixed(2)}MB`)}getFPS(){if(!m.root)return 0;const{fps:e}=m.root;return Math.floor(e)||0}getDrawCalls(){if(!m.root)return 0;const{numDrawCalls:e}=m.root.device;return e||0}getDeviceRender(){if(!m.root)return"Unknown";const{renderer:e}=m.root.device;return e||"Unknown"}getTextureMemory(){if(!m.root)return 0;const{memoryStatus:e}=m.root.device;return e.textureSize/1048576||0}}i._RF.pop(),i._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);const{Events:FV}=GameCore,{event:BV}=globalThis.game;class GV{constructor(){this.handleHotReload=()=>{W.restart()},this.handleUpdateConfig=e=>{if("Gameplay"!==e.type)return;W.emit(Yn,e.config);const{id:t,type:i}=e;BV.emit(FV.REMOTE_CONFIG_UPDATED,{id:t,type:i})}}init(){this.listenEvents()}listenEvents(){BV.on(FV.REQUEST_HOT_RELOAD,this.handleHotReload),BV.on(FV.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}i._RF.pop(),i._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);class zV{init(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}initLanguages(){(new TV).init()}initCocosStats(){(new aV).init()}initLeaderboards(){(new LV).init()}initRemoteConfig(){(new GV).init()}initDynamicAtlas(){(new wV).init()}initDynamicAssets(){(new uV).init()}initCanvasRecorder(){(new nV).init()}initPerformanceMonitor(){(new xV).init()}initAdaptivePerformance(){(new tV).init()}}i._RF.pop(),i._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);const{event:UV,monitorError:HV}=globalThis.game,{Events:VV,Configs:qV,Utils:WV}=GameCore;class KV{constructor(){this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=async e=>{const{sceneName:t,sceneData:i}=e,n=this.correctSceneName(t);console.info("Switching",n,i??{}),n&&(Bl.showLoadingFullScreen(n),this.startScene({sceneName:n,sceneData:i}))},this.preloadScene=(e,t)=>{const{sceneName:i}=e;this.startMeasure(i),m.preloadScene(i,this.onSceneProgress,this.onScenePreloaded(i,t))},this.startMeasure=e=>{this.mark&&(this.queueLoadScene[e]&&(this.mark.putAttr(this.markName,"Canceled","true"),this.stopMeasure(e)),console.groupCollapsed(" Load scene progress"),this.mark.measure(this.markName),this.mark.putAttr(this.markName,"Cancel","false"),this.mark.putAttr(this.markName,"Success","false"),this.mark.putMetric(this.markName,e),this.mark.start(this.markName),this.queueLoadScene[e]=!0)},this.stopMeasure=e=>{this.mark&&this.queueLoadScene[e]&&(this.mark.rmAttr(this.markName,"File"),this.mark.putAttr(this.markName,"Success","true"),this.mark.stop(this.markName),this.queueLoadScene[e]=!1,console.groupEnd())},this.onSceneProgress=(e,t,i)=>{const n=e/t;this.mark&&this.mark.putAttr(this.markName,"Last File",`${i.id} (${i.ext})`);const a=Math.floor(70*n+30);GameSDK.setLoadingProgress(a)},this.onScenePreloaded=(e,t)=>i=>{i?console.warn("SceneManager.onScenePreloaded",{sceneName:e,error:i}):(t&&t(e,i),UV.emit(VV.SCENE_LOADED,{sceneName:e,isPreload:!0}))},this.onDirectorLoadScene=e=>(t,i)=>{if(t)return void console.warn("SceneManager.onSceneLoaded",t);if(!i?.scene)return void console.warn("SceneManager.onSceneLoaded","Scene not found");const n=i.name;this.handleBeforeSceneLaunch(i,e)(),m.once(J.EVENT_AFTER_SCENE_LAUNCH,this.handleSceneLaunched(n,e))},this.handleBeforeSceneLaunch=(e,t)=>()=>{this.setSceneData(e,t??{}),W.emit(Wn),UV.emit(VV.SCENE_LOADED,{sceneName:e.name})},this.handleSceneLaunched=(e,t)=>()=>{Bl.hideLoadingFullScreen(e),Ki.switchSceneTracking(),HV?.addMetadata({currentScene:e}),this.callbackSwitchScene?.({sceneName:e,sceneData:t}),UV.emit(VV.SCENE_LAUNCHED,{sceneName:e})},this.handleSceneLoaded=e=>{const{sceneName:t}=e;this.stopMeasure(t)}}init(){this.listenEvents(),console.info("Scene Manager: Initialized")}listenEvents(){UV.on(VV.SWITCH_SCENE,this.switchScene),UV.on(VV.PRELOAD_SCENE,this.preloadScene),UV.on(VV.SCENE_LOADED,this.handleSceneLoaded)}correctSceneName(e){const t=this.getCurrentScene();return t&&e===t.name?null:e}startScene(e){const{sceneName:t,sceneData:i}=e;this.preloadScene({sceneName:t},((e,n)=>{e===t&&(n?console.warn("SceneManager.startScene",{sceneName:t,error:n}):m.loadScene(t,this.onDirectorLoadScene(i)))}))}get mark(){return qV.PerformanceMonitor.LoadResources?WV.Mark:null}getCurrentScene(){return m.getScene()}getLoadedScenes(){const e=[];return Object.keys(this.queueLoadScene).map((t=>{this.queueLoadScene[t]||e.push(t)})),e}onSwitchScene(e){this.callbackSwitchScene=e}setSceneData(e,t){if(!t)return;if("data"in e||e.scene.attr({data:{}}),!("data"in e))return;const i=e.data||{};e.scene.attr({data:{...i,...t}}),console.info("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:i})}}i._RF.pop(),i._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);const{event:YV,monitorError:jV}=globalThis.game,{Events:XV,Utils:$V}=GameCore,{Object:QV}=$V;class JV{constructor(){this.screens={},this.handleOpenScreen=e=>{const{screenName:t,screenData:i}=e;this.openScreen(t,i)},this.handleCloseScreen=e=>{const{screenName:t}=e;this.closeScreen(t)}}init(){this.listenEvents(),console.info("Screen Manager: Initialized")}listenEvents(){YV.on(XV.OPEN_SCREEN,this.handleOpenScreen),YV.on(XV.CLOSE_SCREEN,this.handleCloseScreen)}reorderScreens(){const e=QV.vals(this.screens).filter((e=>"ready"===e.state));e.sort(((e,t)=>e.order-t.order));for(let t=0;t<e.length;t++){const i=e[t];i.order=t,i.comp.node.setSiblingIndex(i.order)}}addScreenKeys(e,t){e.forEach(((e,i)=>{this.screens[Ui[e]]&&(this.screens[Ui[e]].order=i),this.screens[Ui[e]]={state:"key",parent:t,key:e,order:i}}))}addScreens(e){e.forEach(((e,t)=>{this.screens[e.node.name]={state:"ready",comp:e,order:t}}))}async preloadScreens(){const e=QV.vals(this.screens).reduce(((e,t)=>{if("key"===t.state){const i=li.loadPrefabAsync(`screens/${Ui[t.key]}`);e.push(i)}return e}),[]);return await Promise.all(e)}async getScreen(e){const t=this.screens[e];if(null==t)return jV?.sendException(new Error(`ScreenManager.openScreen Screen ${e} not found`),{screenName:e,screens:this.getScreensAsMetadata()}),null;if("ready"===t.state)return t.comp;console.info("ScreenManager.getScreen",`Screen ${e} not found in cache, instantiating it...`);const{parent:i,key:n,order:a}=t,s=await li.loadPrefabAsync(`screens/${Ui[n]}`);if(!s)return jV?.sendException(new Error(`ScreenManager.getScreen: Failed to load Screen ${e} prefab...`),{screenName:e,screens:this.getScreensAsMetadata()}),null;const o=c(s);o.name=e,i.addChild(o),o.active=!1;const r=o.getComponent(lk);return r?(this.screens[e]={state:"ready",comp:r,order:a},this.reorderScreens(),r):(jV?.sendException(new Error(`ScreenManager.getScreen: Screen ${e} prefab doesn't have BaseScreen component...`),{screenName:e,screens:this.getScreensAsMetadata()}),null)}getScreensAsMetadata(){return Object.keys(this.screens).map((e=>{const t=this.screens[e];return"ready"===t.state?`${t.comp.node.name}(loaded)`:`${Ui[t.key]}(notloaded)`})).join(", ")}clearScreens(){this.screens={}}async openScreen(e,t){try{li.setBlockInput(!0);const i=await this.getScreen(e);if(li.setBlockInput(!1),!i?.node)return void console.warn("ScreenManager.openScreen",`Screen ${e} not found`);i.node.active=!0,i.node.setPosition(new j(0,0,0));const n={screenName:e,screenData:t};YV.emit(XV.OPENING_SCREEN,n),Ki.trackCurrentPage(e,!0),jV?.addMetadata({currentScreen:e}),await St.waitTweenAsync(0),i.open(t),YV.emit(XV.OPENED_SCREEN,n)}catch(e){console.error("ScreenManager.openScreen",e)}}async closeScreen(e){try{const t=await this.getScreen(e);if(!t)return void console.warn("ScreenManager.closeScreen",`Screen ${e} not found`);if(!t.node?.active)return;const i={screenName:e};YV.emit(XV.CLOSING_SCREEN,i),t.close(),Ki.trackCurrentPage(e,!1),jV?.removeMetadata("currentScreen")}catch(e){console.error("ScreenManager.closeScreen",e)}}closeAllScreens(){Object.keys(this.screens).forEach((e=>{"ready"===this.screens[e].state&&this.closeScreen(e)}))}}i._RF.pop(),i._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);const{Configs:ZV,Events:eq,Plugins:tq}=GameCore,{context:iq,storage:nq,event:aq,analytics:sq,monitorError:oq}=globalThis.game;new class{constructor(){this.coreManager=new SH,this.matchManager=new HH,this.sceneManager=new KV,this.screenManager=new JV,this.engineManager=new AH,this.layoutManager=new MH,this.playerManager=new XH,this.pluginsManager=new zV,this.handleWhenCoreBoot=()=>{W.inited?this.handleCocosInit():W.once(Se.EVENT_POST_PROJECT_INIT,this.handleCocosInit)},this.handleCocosInit=()=>{this.coreManager.requestStart()},this.handleWhenCoreStart=()=>{this.playerManager.setupDefaultGameData(),this.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=()=>{this.initPlugins(),console.groupEnd(),ZV.Core.StartSDKAfterLoadGame?aq.once(eq.SCENE_LOADED,this.handleStartGameWhenMainSceneReady):this.processStartGame(),this.preloadScenes()},this.handleStartGameWhenMainSceneReady=()=>{this.processStartGame()},this.handleSwitchScene=e=>{const{sceneName:t}=e,i=this.sceneManager.getCurrentScene();if(i?.name!==t)return;this.screenManager.closeAllScreens(),this.screenManager.clearScreens();const n=i?.getComponentsInChildren(lk);if(n.length>0){const e=n.map((e=>e.node.name)).join(", ");console.info(` Loaded Screens in ${t}: ${e}`),this.screenManager.addScreens(n)}const a=i?.getComponentInChildren(wk);if(!a)return;const s=a.screenKeys.filter((e=>!n.some((t=>t.node.name===Ui[e]))));if(0===s.length)return;const o=s.map((e=>Ui[e])).join(", ");console.info(` Lazy-loading Screens in ${t}: ${o}`),this.screenManager.addScreenKeys(s,a.node),this.screenManager.preloadScreens()},console.groupCollapsed(" Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}initManagers(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}listenEvents(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}preloadScenes(){"solo"===nq.getStorageData("context","sessionContextType")?gl.preloadDashboardScene():gl.preloadGameScene()}async processStartGame(){console.groupEnd(),sq.event(tq.Analytics.Events.LOAD_COMPLETE),await this.startGameAsync(),this.startProcessContextData(),this.playerManager.requestConnectedPlayers(),sq.event(tq.Analytics.Events.APP_READY,{success:!0}),aq.emit(eq.GAME_READY)}async startGameAsync(){try{await GameSDK.startGameAsync(),sq.event(tq.Analytics.Events.GAME_SDK_READY,{success:!0})}catch(e){console.warn("GameSDK.startGameAsync",e),sq.event(tq.Analytics.Events.GAME_SDK_READY,{success:!1}),e instanceof Error&&oq?.sendException(e)}}startProcessContextData(){aq.getEventEmitCount(eq.PLAYER_INFO_LOADED)?iq.processContextData().catch((e=>{console.error("startProcessContextData",e)})):aq.once(eq.PLAYER_INFO_LOADED,this.startProcessContextData)}initPlugins(){this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}},i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/start-scene', 'chunks:///start-scene.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});