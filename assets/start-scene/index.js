System.register("chunks:///start-scene.js",["cc"],(function(e,t){var n,a,i,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b,w,k,S,C,E,A,T,x,R,P,I,_,L,O,D,M,N,F,B,G,z,U,H,q,V,W,K,j,Y,X,J,Q,Z,$,ee,te,ne,ae,ie,re,oe,se,le,ue,ce,he,pe,de,fe,ve,ye,me,ge,be,we;return{setters:[function(e){n=e.cclegacy,a=e._decorator,i=e.Node,r=e.Color,o=e.Canvas,s=e.UITransform,l=e.instantiate,u=e.Label,c=e.RichText,h=e.Toggle,p=e.Button,d=e.director,f=e.Component,v=e.isCCObject,y=e.Animation,m=e.CCString,g=e.CCInteger,b=e.AudioSource,w=e.resources,k=e.AudioClip,S=e.tween,C=e.CCFloat,E=e.Widget,A=e.Layout,T=e.Sprite,x=e.game,R=e.find,P=e.Prefab,I=e.JsonAsset,_=e.AnimationClip,L=e.ImageAsset,O=e.SpriteFrame,D=e.easing,M=e.UIOpacity,N=e.ccenum,F=e.view,B=e.screen,G=e.math,z=e.EventHandler,U=e.animation,H=e.CCBoolean,q=e.Input,V=e.Graphics,W=e.profiler,K=e.sys,j=e.Vec3,Y=e.ProgressBar,X=e.Font,J=e.Vec2,Q=e.Director,Z=e.Layers,$=e.randomRangeInt,ee=e.pseudoRandomRangeInt,te=e.pseudoRandom,ne=e.randomRange,ae=e.Pool,ie=e.ParticleSystem2D,re=e.HorizontalTextAlignment,oe=e.Tween,se=e.View,le=e.ScrollView,ue=e.Enum,ce=e.lerp,he=e.Mask,pe=e.AssetManager,de=e.DynamicAtlasManager,fe=e.macro,ve=e.settings,ye=e.Settings,me=e.ResolutionPolicy,ge=e.UIRenderer,be=e.Texture2D,we=e.Game}],execute:function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ke(t){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?e(Object(a),!0).forEach((function(e){Ie(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function Se(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
Se=function(){return t};var e,t={},n=Object.prototype,a=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,a){var r=t&&t.prototype instanceof y?t:y,o=Object.create(r.prototype),s=new P(a||[]);return i(o,"_invoke",{value:A(e,n,s)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var p="suspendedStart",d="executing",f="completed",v={};function y(){}function m(){}function g(){}var b={};u(b,o,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(I([])));k&&k!==n&&a.call(k,o)&&(b=k);var S=g.prototype=y.prototype=Object.create(b);function C(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(i,r,o,s){var l=h(e[i],e,r);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&a.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(c).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var r;i(this,"_invoke",{value:function(e,a){function i(){return new t((function(t,i){n(e,a,t,i)}))}return r=r?r.then(i,i):i()}})}function A(t,n,a){var i=p;return function(r,o){if(i===d)throw new Error("Generator is already running");if(i===f){if("throw"===r)throw o;return{value:e,done:!0}}for(a.method=r,a.arg=o;;){var s=a.delegate;if(s){var l=T(s,a);if(l){if(l===v)continue;return l}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(i===p)throw i=f,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);i=d;var u=h(t,n,a);if("normal"===u.type){if(i=a.done?f:"suspendedYield",u.arg===v)continue;return{value:u.arg,done:a.done}}"throw"===u.type&&(i=f,a.method="throw",a.arg=u.arg)}}}function T(t,n){var a=n.method,i=t.iterator[a];if(i===e)return n.delegate=null,"throw"===a&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+a+"' method")),v;var r=h(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;var o=r.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function P(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function I(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,r=function n(){for(;++i<t.length;)if(a.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}throw new TypeError(typeof t+" is not iterable")}return m.prototype=g,i(S,"constructor",{value:g,configurable:!0}),i(g,"constructor",{value:m,configurable:!0}),m.displayName=u(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,u(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},C(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,a,i,r){void 0===r&&(r=Promise);var o=new E(c(e,n,a,i),r);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(S),u(S,l,"Generator"),u(S,o,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},t.values=I,P.prototype={constructor:P,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(a,i){return s.type="throw",s.arg=t,n.next=a,i&&(n.method="next",n.arg=e),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=a.call(o,"catchLoc"),u=a.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&a.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var i=a.arg;R(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,a){return this.delegate={iterator:I(t),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=e),v}},t}function Ce(e){return(Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ee(){Ee=function(e,t){return new n(e,void 0,t)};var e=RegExp.prototype,t=new WeakMap;function n(e,a,i){var r=new RegExp(e,a);return t.set(r,i||t.get(e)),Oe(r,n.prototype)}function a(e,n){var a=t.get(n);return Object.keys(a).reduce((function(t,n){var i=a[n];if("number"==typeof i)t[n]=e[i];else{for(var r=0;void 0===e[i[r]]&&r+1<i.length;)r++;t[n]=e[i[r]]}return t}),Object.create(null))}return _e(n,RegExp),n.prototype.exec=function(t){var n=e.exec.call(this,t);if(n){n.groups=a(n,this);var i=n.indices;i&&(i.groups=a(i,this))}return n},n.prototype[Symbol.replace]=function(n,i){if("string"==typeof i){var r=t.get(this);return e[Symbol.replace].call(this,n,i.replace(/\$<([^>]+)>/g,(function(e,t){var n=r[t];return"$"+(Array.isArray(n)?n.join("$"):n)})))}if("function"==typeof i){var o=this;return e[Symbol.replace].call(this,n,(function(){var e=arguments;return"object"!=typeof e[e.length-1]&&(e=[].slice.call(e)).push(a(e,o)),i.apply(this,e)}))}return e[Symbol.replace].call(this,n,i)},Ee.apply(this,arguments)}function Ae(e,t,n,a,i,r,o){try{var s=e[r](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,i)}function Te(e){return function(){var t=this,n=arguments;return new Promise((function(a,i){var r=e.apply(t,n);function o(e){Ae(r,a,i,o,s,"next",e)}function s(e){Ae(r,a,i,o,s,"throw",e)}o(void 0)}))}}function xe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Re(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,Xe(a.key),a)}}function Pe(e,t,n){return t&&Re(e.prototype,t),n&&Re(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ie(e,t,n){return(t=Xe(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _e(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Oe(e,t)}function Le(e){return(Le=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Oe(e,t){return(Oe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function De(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Me(e,t,n){return(Me=De()?Reflect.construct.bind():function(e,t,n){var a=[null];a.push.apply(a,t);var i=new(Function.bind.apply(e,a));return n&&Oe(i,n.prototype),i}).apply(null,arguments)}function Ne(e){var t="function"==typeof Map?new Map:void 0;return(Ne=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,a)}function a(){return Me(e,arguments,Le(this).constructor)}return a.prototype=Object.create(e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),Oe(a,e)})(e)}function Fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Be(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Fe(e)}function Ge(e){var t=De();return function(){var n,a=Le(e);if(t){var i=Le(this).constructor;n=Reflect.construct(a,arguments,i)}else n=a.apply(this,arguments);return Be(this,n)}}function ze(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Le(e)););return e}function Ue(){return(Ue="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var a=ze(e,t);if(a){var i=Object.getOwnPropertyDescriptor(a,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(this,arguments)}function He(e,t,n,a){return(He="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,a){var i,r=ze(e,t);if(r){if((i=Object.getOwnPropertyDescriptor(r,t)).set)return i.set.call(a,n),!0;if(!i.writable)return!1}if(i=Object.getOwnPropertyDescriptor(a,t)){if(!i.writable)return!1;i.value=n,Object.defineProperty(a,t,i)}else Ie(a,t,n);return!0})(e,t,n,a)}function qe(e,t,n,a,i){if(!He(e,t,n,a||e)&&i)throw new TypeError("failed to set property");return n}function Ve(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,i,r,o,s=[],l=!0,u=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(a=r.call(n)).done)&&(s.push(a.value),s.length!==t);l=!0);}catch(e){u=!0,i=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return s}}(e,t)||Ke(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function We(e){return function(e){if(Array.isArray(e))return je(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ke(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ke(e,t){if(e){if("string"==typeof e)return je(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?je(e,t):void 0}}function je(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Ye(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Ke(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var a=0,i=function(){};return{s:i,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}function Xe(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function Je(e,t,n,a){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(a):void 0})}function Qe(e,t,n,a,i){var r={};return Object.keys(a).forEach((function(e){r[e]=a[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce((function(n,a){return a(e,t,n)||n}),r),i&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(i):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var Ze,$e,et,tt,nt,at,it,rt,ot;n._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var st=a.ccclass,lt=a.property;Ze=st("internal.DebugViewRuntimeControl"),$e=lt(i),et=lt(i),tt=lt(i),Ze((it=Qe((at=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return Je(e=t.call.apply(t,[this].concat(i)),"compositeModeToggle",it,Fe(e)),Je(e,"singleModeToggle",rt,Fe(e)),Je(e,"EnableAllCompositeModeButton",ot,Fe(e)),e._single=0,e.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],e.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],e.strMisc=["CSM Layer Coloration","Lighting With Albedo"],e.compositeModeToggleList=[],e.singleModeToggleList=[],e.miscModeToggleList=[],e.textComponentList=[],e.labelComponentList=[],e.textContentList=[],e._currentColorIndex=0,e.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],e.color=[r.WHITE,r.BLACK,r.RED,r.GREEN,r.BLUE],e}return Pe(n,[{key:"start",value:function(){if(this.node.parent.getComponent(o)){var e=this.node.parent.getComponent(s),t=.5*e.width,n=.5*e.height,a=.1*t-t,i=n-.1*n,d=this.node.getChildByName("MiscMode"),f=l(d);f.parent=this.node,f.name="Buttons";var v=l(d);v.parent=this.node,v.name="Titles";for(var y=0;y<2;y++){var m=l(this.EnableAllCompositeModeButton.getChildByName("Label"));m.setPosition(a+(y>0?450:150),i,0),m.setScale(.75,.75,.75),m.parent=v;var g=m.getComponent(u);g.string=y?"----------Composite Mode----------":"----------Single Mode----------",g.color=r.WHITE,g.overflow=0,this.labelComponentList[this.labelComponentList.length]=g}i-=20;for(var b=0,w=0;w<this.strSingle.length;w++,b++){w===this.strSingle.length>>1&&(a+=200,b=0);var k=w?l(this.singleModeToggle):this.singleModeToggle;k.setPosition(a,i-20*b,0),k.setScale(.5,.5,.5),k.parent=this.singleModeToggle.parent;var S=k.getComponentInChildren(c);S.string=this.strSingle[w],this.textComponentList[this.textComponentList.length]=S,this.textContentList[this.textContentList.length]=S.string,k.on(h.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[w]=k}a+=200,this.EnableAllCompositeModeButton.setPosition(a+15,i,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(p.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=f;var C=this.EnableAllCompositeModeButton.getComponentInChildren(u);this.labelComponentList[this.labelComponentList.length]=C;var E=l(this.EnableAllCompositeModeButton);E.setPosition(a+90,i,0),E.setScale(.5,.5,.5),E.on(p.EventType.CLICK,this.changeTextColor,this),E.parent=f,(C=E.getComponentInChildren(u)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=C;var A=l(this.EnableAllCompositeModeButton);A.setPosition(a+200,i,0),A.setScale(.5,.5,.5),A.on(p.EventType.CLICK,this.hideUI,this),A.parent=this.node.parent,(C=A.getComponentInChildren(u)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=C,this.hideButtonLabel=C,i-=40;for(var T=0;T<this.strMisc.length;T++){var x=l(this.compositeModeToggle);x.setPosition(a,i-20*T,0),x.setScale(.5,.5,.5),x.parent=d;var R=x.getComponentInChildren(c);R.string=this.strMisc[T],this.textComponentList[this.textComponentList.length]=R,this.textContentList[this.textContentList.length]=R.string,x.getComponent(h).isChecked=!!T,x.on(h.EventType.TOGGLE,T?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[T]=x}i-=150;for(var P=0;P<this.strComposite.length;P++){var I=P?l(this.compositeModeToggle):this.compositeModeToggle;I.setPosition(a,i-20*P,0),I.setScale(.5,.5,.5),I.parent=this.compositeModeToggle.parent;var _=I.getComponentInChildren(c);_.string=this.strComposite[P],this.textComponentList[this.textComponentList.length]=_,this.textContentList[this.textContentList.length]=_.string,I.on(h.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[P]=I}}else console.error("debug-view-runtime-control should be child of Canvas")}},{key:"isTextMatched",value:function(e,t){var n=new String(e),a=n.search(">");return-1===a?e===t:(n=(n=n.substr(a+1)).substr(0,n.search("<")))===t}},{key:"toggleSingleMode",value:function(e){for(var t=d.root.debugView,n=e.getComponentInChildren(c),a=0;a<this.strSingle.length;a++)this.isTextMatched(n.string,this.strSingle[a])&&(t.singleMode=a)}},{key:"toggleCompositeMode",value:function(e){for(var t=d.root.debugView,n=e.getComponentInChildren(c),a=0;a<this.strComposite.length;a++)this.isTextMatched(n.string,this.strComposite[a])&&t.enableCompositeMode(a,e.isChecked)}},{key:"toggleLightingWithAlbedo",value:function(e){d.root.debugView.lightingWithAlbedo=e.isChecked}},{key:"toggleCSMColoration",value:function(e){d.root.debugView.csmLayerColoration=e.isChecked}},{key:"enableAllCompositeMode",value:function(e){var t=d.root.debugView;t.enableAllCompositeMode(!0);for(var n=0;n<this.compositeModeToggleList.length;n++){this.compositeModeToggleList[n].getComponent(h).isChecked=!0}var a=this.miscModeToggleList[0].getComponent(h);a.isChecked=!1,t.csmLayerColoration=!1,(a=this.miscModeToggleList[1].getComponent(h)).isChecked=!0,t.lightingWithAlbedo=!0}},{key:"hideUI",value:function(e){var t=this.node.getChildByName("Titles"),n=!t.active;this.singleModeToggleList[0].parent.active=n,this.miscModeToggleList[0].parent.active=n,this.compositeModeToggleList[0].parent.active=n,this.EnableAllCompositeModeButton.parent.active=n,t.active=n,this.hideButtonLabel.string=n?"Hide UI":"Show UI"}},{key:"changeTextColor",value:function(e){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var t=0;t<this.textComponentList.length;t++)this.textComponentList[t].string=this.strColor[this._currentColorIndex]+this.textContentList[t]+"</color>";for(var n=0;n<this.labelComponentList.length;n++)this.labelComponentList[n].color=this.color[this._currentColorIndex]}},{key:"onLoad",value:function(){}},{key:"update",value:function(e){}}]),n}(f)).prototype,"compositeModeToggle",[$e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=Qe(at.prototype,"singleModeToggle",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ot=Qe(at.prototype,"EnableAllCompositeModeButton",[tt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nt=at));n._RF.pop(),n._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);var ut,ct,ht,pt,dt,ft,vt,yt,mt,gt=GameCore.Utils,bt=gt.Array,wt=gt.Object,kt=gt.Valid,St=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"],Ct=function(){function e(){xe(this,e),this.validComponentCalled={}}return Pe(e,[{key:"validateRequiredComponents",value:function(e){var t,n=e.name,a=e.constructor,i=Ye(this.getRequiredComponentNames(a));try{for(i.s();!(t=i.n()).done;){var r=t.value;if(!e.getComponent(r))throw new Error("".concat(n,": Missing required ").concat(r," component"))}}catch(e){i.e(e)}finally{i.f()}}},{key:"validateRequiredProperties",value:function(e){var t,n=e.name,a=e.constructor,i=Ye(this.getRequiredPropNames(a));try{for(i.s();!(t=i.n()).done;){var r=t.value;if(!wt.hasOwn(e,r))throw new Error("".concat(n,": Missing required ").concat(r," property"));var o=this.getProperty(r,e);if(!v(o))throw new Error("".concat(n,": ").concat(r," property is not a cc object"))}}catch(e){i.e(e)}finally{i.f()}}},{key:"validateCustomProperties",value:function(e){var t,n=e.name,a=Ye(this.getCustomPropNames(e));try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!wt.hasOwn(e,i))throw new Error("".concat(n,": Missing required ").concat(i," property"));var r=this.getProperty(i,e);if(!v(r))throw new Error("".concat(n,": ").concat(i," property is not a cc object"))}}catch(e){a.e(e)}finally{a.f()}}},{key:"getProperty",value:function(e,t){var n;if(wt.hasOwn(t,e))return(null!==(n=Object.getOwnPropertyDescriptor(t,e))&&void 0!==n?n:{}).value}},{key:"getProps",value:function(e){if(!wt.hasOwn(e,"__props__"))return[];var t=e.__props__;return Array.isArray(t)?t:[]}},{key:"getRequiredPropNames",value:function(e){return this.getProps(e).filter((function(t){return"node"!==t&&(!!wt.hasOwn(e,t)&&(!!v(e[t])&&!t.startsWith("_")))}))}},{key:"getBaseComponentName",value:function(e){for(var t=0,n=St;t<n.length;t++){var a=n[t];if(a.indexOf(e)>=0)return a}return e}},{key:"getRequiredComponentNames",value:function(e){var t=this;if(!wt.hasOwn(e,"_requireComponent"))return[];var n=e._requireComponent;return Array.isArray(n)?n.map((function(e){return t.getBaseComponentName(e)})):[]}},{key:"getCustomPropNames",value:function(e){var t=this,n=Object.keys(e),a=this.getProps(e.constructor);return bt.difference(n,a).filter((function(e){return!e.startsWith("_")})).filter((function(n){if(!wt.hasOwn(e,n))return!1;var a=t.getProperty(n,e);return!(!kt.isObject(a)||!v(a))}))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"lazyValidateProperties",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t){var n=e.constructor,a=n.name;if(!this.inst.validComponentCalled[a])try{this.inst.validateRequiredComponents(e),this.inst.validateRequiredProperties(e),this.inst.validateCustomProperties(e)}catch(t){e.enabled=!1,console.error(t)}finally{this.inst.validComponentCalled[a]=!0}}}}]),e}();try{new Ct}catch(e){console.error("ComponentUtils",e)}n._RF.pop(),n._RF.push({},"60ac3vor0dMT5bXi8D3VSJN","BubbleAnimation",void 0);var Et=a.ccclass,At=a.property;ut=Et("BubbleAnimation"),ct=At(y),ht=At(m),pt=At(g),ut((vt=Qe((ft=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"animation",vt,Fe(e)),Je(e,"clipName",yt,Fe(e)),Je(e,"repeat",mt,Fe(e)),e.currentRepeat=-1,e}return Pe(n,[{key:"__preload",value:function(){this.animation=this.getComponent(y),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"play",value:function(){var e=this;this.animation&&(this.animation.clips.find((function(t){return(null==t?void 0:t.name)===e.clipName}))?(this.currentRepeat=-1,this.animation.play(this.clipName)):console.warn("BubbleAnimation: Animation component must have ".concat(this.clipName," clip")))}},{key:"onBubbleAnimationLoop",value:function(){this.animation&&-1!==this.repeat&&(this.currentRepeat++,this.currentRepeat>this.repeat&&this.animation.stop())}}]),n}(f)).prototype,"animation",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yt=Qe(ft.prototype,"clipName",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Bubble"}}),mt=Qe(ft.prototype,"repeat",[pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),dt=ft));n._RF.pop(),n._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var Tt=function(e){_e(n,GameCore.Plugins.Audio.BaseAudioPlayer);var t=Ge(n);function n(e,a){var i;return xe(this,n),(i=t.call(this,e)).audioSource=a,i}return Pe(n,[{key:"play",value:function(e){if(e){var t=e.volume,n=void 0===t?1:t,a=e.loop,i=void 0!==a&&a;this.audioSource.volume=n,this.audioSource.loop=i}this.audioSource.play()}},{key:"pause",value:function(){this.audioSource.pause()}},{key:"resume",value:function(){this.audioSource.state===b.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function(){this.audioSource.stop()}},{key:"setVolume",value:function(e){this.audioSource.volume=e}},{key:"getAudioSource",value:function(){return this.audioSource}}]),n}();n._RF.pop(),n._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var xt=function(e){_e(a,e);var t,n=Ge(a);function a(e,t){var i;return xe(this,a),(i=n.call(this,t)).allowMultipleTracking={},i.handleLoadedAudio=function(e,t){var n=i.node.addComponent(b);return n.clip=t,n.playOnAwake=!1,new Tt(e,n)},i.node=e,i}return Pe(a,[{key:"playing",value:function(e){var t,n=null===(t=this.getAudioClip(e))||void 0===t?void 0:t.audioPlayer;return!!n&&n.getAudioSource().state===b.AudioState.PLAYING}},{key:"onLoadAudio",value:(t=Te(Se().mark((function e(t,n){var a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){w.load(t,k,(function(i,r){try{if(i)throw new Error(i.message);if(!a.node.isValid)return;var o=a.handleLoadedAudio(t,r);e(o)}catch(i){i instanceof Error?n(i):n(new Error("Audio load: Unknown error"))}}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"playWithRealConfig",value:function(e,t){if(this.isCanPlay(t)){if(t){var n=t.volume,a=void 0===n?1:n,i=t.allowMultiple,r=void 0!==i&&i;if(t.volume=this.getVolume()*a,r)return void this.requestDuplicateAudioPlayer(e.getKey(),e.getAudioSource().clip,t).play(t)}e.play(t)}}},{key:"isCanPlay",value:function(e){var t=this;if(e){var n=e.checkList;if((void 0===n?[]:n).some((function(e){var n=t.getAudioClip(e);return!!n&&n.audioPlayer.getAudioSource().state===b.AudioState.PLAYING})))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function(e,t,n){var a=this.getDuplicateAudioFromPool(e);if(a){if(n){var i=a.key,r=n.volume,o=void 0===r?1:r;this.setAudioClip(i,{volume:o})}return a.audioPlayer}var s="".concat(e,"_").concat(this.allowMultipleTracking[e].currentPostFix),l=this.handleLoadedAudio(s,t);return this.allowMultipleTracking[e].list.push({audioPlayer:l,key:s}),this.allowMultipleTracking[e].currentPostFix+=1,this.setAudioClip(s,{audioPlayer:l,volume:1}),l}},{key:"getDuplicateAudioFromPool",value:function(e){if(this.allowMultipleTracking[e]){var t=this.allowMultipleTracking[e].list.find((function(e){return e.audioPlayer.getAudioSource().state!==b.AudioState.PLAYING}));if(t)return t}else this.allowMultipleTracking[e]={currentPostFix:1,list:[]};return null}}]),a}(GameCore.Plugins.Audio.BaseChannelManager);n._RF.pop();var Rt,Pt,It,_t,Lt;n._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var Ot,Dt,Mt,Nt,Ft,Bt=a.ccclass,Gt=a.property,zt=globalThis.game,Ut=zt.audio,Ht=zt.player,qt=(Rt=Bt("Music"),Pt=Gt(m),Rt((Lt=Qe((_t=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"channelId",Lt,Fe(e)),e.channel=null,e}return Pe(n,[{key:"__preload",value:function(){this.makePersistent(),this.channel=new xt(this.node,this.channelId),Ut.addChannel(this.channel)}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"playing",value:function(e){var t,n;return null!==(t=null===(n=this.channel)||void 0===n?void 0:n.playing(e))&&void 0!==t&&t}},{key:"play",value:function(e,t){var n;this.isMusicEnable()&&(null!==(n=t)&&void 0!==n&&n.loop||(t=ke(ke({},t),{},{loop:!0})),Ut.play(e,t,this.channelId))}},{key:"isMusicEnable",value:function(){return!!Ht.getPlayerSetting("music")}},{key:"setVolume",value:function(e){Ut.setVolume(e,this.channelId)}},{key:"pause",value:function(e){Ut.pause(e,this.channelId)}},{key:"resume",value:function(e){this.isMusicEnable()&&Ut.resume(e,this.channelId)}},{key:"stop",value:function(e){Ut.stop(e,this.channelId)}},{key:"mute",value:function(e){e?Ut.mute(this.channelId):Ut.unmute(this.channelId)}}]),n}(f)).prototype,"channelId",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),It=_t))||It);n._RF.pop(),n._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var Vt=a.ccclass,Wt=a.property,Kt=globalThis.game,jt=Kt.audio,Yt=Kt.player,Xt=(Ot=Vt("Sound"),Dt=Wt(m),Ot((Ft=Qe((Nt=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"channelId",Ft,Fe(e)),e.channel=null,e}return Pe(n,[{key:"__preload",value:function(){this.channel=new xt(this.node,this.channelId),jt.addChannel(this.channel)}},{key:"onLoad",value:function(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"removePersistent",value:function(){d.removePersistRootNode(this.node)}},{key:"play",value:function(e,t){this.isSoundEnable()&&jt.play(e,t,this.channelId)}},{key:"isSoundEnable",value:function(){return!!Yt.getPlayerSetting("sound")}},{key:"setVolume",value:function(e){jt.setVolume(e,this.channelId)}},{key:"pause",value:function(e){jt.pause(e,this.channelId)}},{key:"resume",value:function(e){this.isSoundEnable()&&jt.resume(e,this.channelId)}},{key:"stop",value:function(e){jt.stop(e,this.channelId)}},{key:"stopAll",value:function(){jt.stopAll(this.channelId)}},{key:"mute",value:function(e){e?jt.mute(this.channelId):jt.unmute(this.channelId)}}]),n}(f)).prototype,"channelId",[Dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Mt=Nt))||Mt);n._RF.pop(),n._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);var Jt,Qt,Zt,$t,en,tn,nn,an,rn,on,sn,ln,un,cn,hn,pn,dn,fn,vn,yn,mn=function(){function e(){xe(this,e)}return Pe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"elasticOut",value:function(e,t,n){if(void 0===t&&(t=.1),void 0===n&&(n=.1),0===e)return 0;if(1===e)return 1;var a=n/4;return t<1?t=1:a=n*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*e)*Math.sin((e-a)*(2*Math.PI)/n)+1}},{key:"easeOutExpo",value:function(e){return 1===e?1:1-Math.pow(2,-10*e)}},{key:"easeInExpo",value:function(e){return 0===e?0:Math.pow(2,10*e-10)}},{key:"runTweenAsync",value:function(e,t){return new Promise((function(n){var a=e.call((function(){n({tween:e})})).start();t&&(t.aborted?(a.stop(),n({tween:e})):t.addAbortListener((function(){a.stop(),n({tween:e})})))}))}},{key:"waitTweenAsync",value:function(e,t){return new Promise((function(n){var a=S({});a.delay(e),a.call((function(){n()})),a.start(),t&&(t.aborted?(a.stop(),n()):t.addAbortListener((function(){a.stop(),n()})))}))}},{key:"runAnimationAsync",value:function(e,t){return new Promise((function(n){e.play(t),e.once(y.EventType.FINISHED,(function(){n()}))}))}}]),e}();try{new mn}catch(e){console.error("AnimUtils",e)}n._RF.pop(),n._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var gn=a.ccclass,bn=a.property,wn=(Jt=gn("AutoLayoutWrappee"),Qt=bn({type:s}),Zt=bn({type:s}),Jt((tn=Qe((en=Pe((function e(){xe(this,e),Je(this,"wrapeeContainer",tn,this),Je(this,"wrapee",nn,this)}))).prototype,"wrapeeContainer",[Qt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nn=Qe(en.prototype,"wrapee",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$t=en))||$t),kn=(an=gn("AutoLayout"),rn=bn({displayName:"Use Auto Layout"}),on=bn({type:[wn],displayName:"Children",visible:function(){return this.useAutoLayout}}),sn=bn({visible:!1,serializable:!0}),ln=bn({type:g,displayName:"Selected Index",visible:function(){return this.useAutoLayout}}),un=bn({type:C,displayName:"Deselected Icon Width",group:"Edge Icons",visible:function(){return this.useAutoLayout}}),cn=bn({visible:!1,serializable:!0}),an((dn=Qe((pn=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"useAutoLayout",dn,Fe(e)),Je(e,"children",fn,Fe(e)),e.mappedChildren=[],Je(e,"selected",vn,Fe(e)),Je(e,"deselectedIconW",yn,Fe(e)),e.tweens=[],e}return Pe(a,[{key:"selectedIndex",get:function(){return this.selected},set:function(e){this.selected=e,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(e){this.deselectedIconW=e,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map((function(e){var t=e.wrapeeContainer.getComponent(E);if(!t)throw new Error("AutoLayout: Widget component not found");return ke(ke({},e),{},{wrapeeContainerWidget:t})}))}},{key:"updateLayout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._layoutDirty||e)&&(this.updateChildrenAnchors(),this.mappedChildren.forEach((function(e){return e.wrapeeContainerWidget.updateAlignment()}))),Ue(Le(a.prototype),"updateLayout",this).call(this,e)}},{key:"getSelectedWorldX",value:function(){var e=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?e.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*e.width:e.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(e){if(e<this.selectedIndex)return 0;if(e>this.selectedIndex)return 1;if(0===e){var t=this.mappedChildren[e].wrapeeContainer.width,n=this.deselectedIconWidth/2,a=this.paddingLeft;return((a+t+(t-n+this.spacingX))/2-a)/t}if(e===this.children.length-1){var i=this.mappedChildren[e].wrapeeContainer.width,r=i-this.deselectedIconWidth/2+this.spacingX;return((r+i+this.paddingRight)/2-r)/i}return.5}},{key:"updateChildrenAnchors",value:(t=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tweens.forEach((function(e){return e.stop()})),this.tweens=[],e.next=4,Promise.all([this.children.flatMap((function(e,n){return t.getChildrenAnchorsTweens(e,t.getAnchorX(n))})).map((function(e){return mn.runTweenAsync(e)}))]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var e=this;this.children.forEach((function(t,n){var a=e.getAnchorX(n);t.wrapee.setAnchorPoint(a,t.wrapee.anchorY),t.wrapeeContainer.setAnchorPoint(a,t.wrapeeContainer.anchorY)}))}},{key:"getChildrenAnchorsTweens",value:function(e,t){return[S(e.wrapee).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapee.setAnchorPoint(t,e.wrapee.anchorY)})),S(e.wrapeeContainer).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapeeContainer.setAnchorPoint(t,e.wrapeeContainer.anchorY)}))]}}]),a}(A)).prototype,"useAutoLayout",[rn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),fn=Qe(pn.prototype,"children",[on],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vn=Qe(pn.prototype,"selected",[sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Qe(pn.prototype,"selectedIndex",[ln],Object.getOwnPropertyDescriptor(pn.prototype,"selectedIndex"),pn.prototype),Qe(pn.prototype,"deselectedIconWidth",[un],Object.getOwnPropertyDescriptor(pn.prototype,"deselectedIconWidth"),pn.prototype),yn=Qe(pn.prototype,"deselectedIconW",[cn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hn=pn))||hn);n._RF.pop(),n._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);var Sn="view-resize",Cn="view-resized",En="request-view-resize",An="layout-changed",Tn="gameplay-update-config",xn="opened-skip-overlay",Rn="closed-skip-overlay",Pn="result-scene-replay",In="result-scene-home",_n="upgrade-quality",Ln="upgrade-dynamic-atlas";n._RF.pop(),n._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);var On,Dn={Portrait:"portrait",Landscape:"landscape"},Mn={Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}},Nn="portrait";n._RF.pop(),n._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);(0,a.ccclass)("Background")(On=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).handleSpriteTypeWhenLayoutChanged=function(t){t===Dn.Landscape?(e.setBackgroundType(T.Type.TILED),e.setActiveBlockLines(!0)):(e.setBackgroundType(T.Type.SIMPLE),e.setActiveBlockLines(!1))},e}return Pe(n,[{key:"__preload",value:function(){this.sprite=this.getComponent(T),this.blockLines=this.getComponentsInChildren(T),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){x.on(An,this.handleSpriteTypeWhenLayoutChanged)}},{key:"setBackgroundType",value:function(e){this.sprite&&(this.sprite.type=e)}},{key:"setActiveBlockLines",value:function(e){var t=this;this.blockLines&&this.blockLines.forEach((function(n){n.node!==t.node&&(n.node.active=e)}))}}]),n}(f));n._RF.pop(),n._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var Fn=function(e){return e.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",e.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",e.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",e.COLLECTIONS_CONTENT_PREFAB="game-objects/dashboard-scene/CollectionsContent",e.CLOUD_IDLE_ANIM="animations/CloudIdle",e.TORNADO_IDLE_ANIM="animations/TornadoIdle",e.TILE_BREAK_ANIM="animations/TileBreak",e.TILE_CLEAR_ANIM="animations/TileClear",e.TILE_SHAKE_ANIM="animations/TileShake",e.TILE_SKIN_FOLDER="loadable/tiles",e.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",e.ITEM_POPUP_FOLDER="loadable/item-popup",e.SUMMER_BG="images/bg/summer",e.AUTUMN_BG="images/bg/autumn",e.WINTER_BG="images/bg/winter",e.SUMMER_BG_PREVIEW="images/preview/summer",e.AUTUMN_BG_PREVIEW="images/preview/autumn",e.WINTER_BG_PREVIEW="images/preview/winter",e.COLLECTIONS_PAGE="pages/CollectionsContent",e.LEADERBOARD_PAGE="pages/LeaderboardContent",e.TOURNAMENTS_PAGE="pages/TournamentsContent",e.LEVEL_DATA_FOLDER="levels-json",e}(Fn||{});n._RF.pop(),n._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);var Bn={summer:Fn.SUMMER_BG,autumn:Fn.AUTUMN_BG,winter:Fn.WINTER_BG},Gn={summer:Fn.SUMMER_BG_PREVIEW,autumn:Fn.AUTUMN_BG_PREVIEW,winter:Fn.WINTER_BG_PREVIEW};n._RF.pop(),n._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);var zn,Un,Hn,qn,Vn,Wn,Kn,jn=function(){function e(){xe(this,e)}var t,n,a,i,r,o,s,l,u,c;return Pe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"setBlockInput",value:function(e){var t=R("Canvas/InputBlocker");t?t.active=e:console.warn("InputBlocker not found")}},{key:"getBlockInput",value:function(){var e=R("Canvas/InputBlocker");return e?e.active:(console.warn("InputBlocker not found"),!1)}},{key:"loadPrefabAsync",value:function(e){var t=w.getInfoWithPath(e,P);if(t&&null!==w.get(t.path,P)){var n=w.get(t.path,P);if(null!==n)return Promise.resolve(n)}return new Promise((function(t){w.load(e,P,(function(e,n){e&&t(null),t(n)}))}))}},{key:"loadJsonAsync",value:(c=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=w.getInfoWithPath(t,I);if(n&&null!==w.get(n.path,I)){var a=w.get(n.path,I);null!==a&&e(a.json)}w.load(t,I,(function(t,n){t&&e(null),n&&n.json||e(null),e(n.json)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"loadAnimClipAsync",value:(u=Te(Se().mark((function e(t){var n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=w.getInfoWithPath(t,_))||null===w.get(n.path,_)){e.next=5;break}if(null===(a=w.get(n.path,_))){e.next=5;break}return e.abrupt("return",Promise.resolve(a));case 5:return e.abrupt("return",new Promise((function(e){w.load(t,_,(function(t,n){t&&e(null),e(n)}))})));case 6:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"loadImageSpriteFrameAsync",value:(l=Te(Se().mark((function e(t){var n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=w.getInfoWithPath(t,L))||null===w.get(n.path,L)){e.next=5;break}if(null===(a=w.get(n.path,L))){e.next=5;break}return e.abrupt("return",Promise.resolve(O.createWithImage(a)));case 5:return e.abrupt("return",new Promise((function(e){w.load(t,L,(function(t,n){t&&e(null),e(O.createWithImage(n))}))})));case 6:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"loadSpriteFrameAsync",value:(s=Te(Se().mark((function e(t){var n,a,i,r=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(r.length>1&&void 0!==r[1])||r[1],!(a=w.getInfoWithPath(t,O))||null===w.get(a.path,O)){e.next=7;break}if(null===(i=w.get(a.path,O))){e.next=7;break}return i.packable=n,e.abrupt("return",Promise.resolve(i));case 7:return e.abrupt("return",new Promise((function(e){w.load(t,O,(function(t,a){!t&&a||e(null),a.packable=n,e(a)}))})));case 8:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"loadSpriteFramesDirAsync",value:(o=Te(Se().mark((function e(t){var n,a,i,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=w.getDirWithPath(t,O)).length>0)){e.next=23;break}a=[],i=Ye(n),e.prev=4,i.s();case 6:if((r=i.n()).done){e.next=14;break}if(o=r.value,s=w.get(o.path,O)){e.next=11;break}return e.abrupt("return",this.loadSpriteFramesFromDirAsync(t));case 11:a.push(s);case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),i.e(e.t0);case 19:return e.prev=19,i.f(),e.finish(19);case 22:return e.abrupt("return",a);case 23:return e.abrupt("return",this.loadSpriteFramesFromDirAsync(t));case 24:case"end":return e.stop()}}),e,this,[[4,16,19,22]])}))),function(e){return o.apply(this,arguments)})},{key:"loadSpriteFramesFromDirAsync",value:(r=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){w.loadDir(t,O,(function(t,n){t&&e([]),e(n)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"lazyLoadDashboardSceneResourcesAsync",value:(i=Te(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.loadPrefabAsync(Fn.COLLECTIONS_CONTENT_PREFAB));case 1:case"end":return t.stop()}}),t)}))),function(){return i.apply(this,arguments)})},{key:"loadThemeAsync",value:(a=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.loadSpriteFrameAsync("".concat(Bn[t],"/spriteFrame")));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"loadThemePreviewAsync",value:(n=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.loadSpriteFrameAsync("".concat(Gn[t],"/spriteFrame")));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"loadSkinPreviewAsync",value:(t=Te(Se().mark((function e(t){var n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],a=1;a<=4;a++)i="".concat(Fn.TILE_SKIN_PREVIEW_FOLDER,"/").concat(t.replace(/-/g,"_"),"_").concat(a,"/spriteFrame"),n.push(this.loadSpriteFrameAsync(i));return e.abrupt("return",Promise.all(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();try{new jn}catch(e){console.error("GeneralUtils",e)}n._RF.pop(),n._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var Yn=a.ccclass,Xn=a.property,Jn=(zn=Yn("MultiBackground"),Un=Xn({type:T}),Hn=Xn({type:T}),zn((Wn=Qe((Vn=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"background1",Wn,Fe(e)),Je(e,"background2",Kn,Fe(e)),e.currentThemeId="",e}return Pe(i,[{key:"__preload",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"setCurrentTheme",value:(n=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jn.loadThemeAsync(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:n.packable=!1,this.background1.spriteFrame=n,this.background2.spriteFrame=n,this.currentThemeId=t;case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onDestroy",value:function(){var e;null===(e=this.tween)||void 0===e||e.stop()}},{key:"animateToNextTheme",value:(t=Te(Se().mark((function e(t){var n,a,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentThemeId!==t){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,jn.loadThemeAsync(t);case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(n.packable=!1,this.currentThemeId=t,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=n,this.nextBackground.node.setSiblingIndex(1),a=this.nextBackground.getComponent(M)){e.next=15;break}throw new Error("".concat(this.nextBackground.node.name," UIOpacity is required"));case 15:return a.opacity=0,this.tween=S({progress:0}),this.tween.to(3,{progress:255},{progress:function(e,t,n,i){var r=Math.floor(e+(t-e)*D.sineOut(i));return a.opacity=r,r}}),this.tween.call((function(){i.currentBackground.node.active=!1;var e=i.currentBackground;i.currentBackground=i.nextBackground,i.nextBackground=e})),e.abrupt("return",mn.runTweenAsync(this.tween));case 20:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),i}(f)).prototype,"background1",[Un],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kn=Qe(Vn.prototype,"background2",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qn=Vn))||qn);n._RF.pop(),n._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var Qn="sounds/",Zn={BUTTON_CLICK:"".concat(Qn,"use_item_click"),BOMB_DEFUSE:"".concat(Qn,"bomb_defuse"),BOMB_EXPLODE_1:"".concat(Qn,"bomb_explode_1"),BOMB_EXPLODE_2:"".concat(Qn,"bomb_explode_2"),CLICKS:"".concat(Qn,"clicks"),CLOSE_POPUP_CLICK:"".concat(Qn,"close_popup_click"),COLLECT_STARS:"".concat(Qn,"collect_stars"),COMBO_1:"".concat(Qn,"combo_1"),COMBO_2:"".concat(Qn,"combo_2"),COMBO_3:"".concat(Qn,"combo_3"),COMBO_4:"".concat(Qn,"combo_4"),COMBO_5:"".concat(Qn,"combo_5"),DAILY_REWARD:"".concat(Qn,"daily_reward"),EXTRA_TIME_SPAWN:"".concat(Qn,"extra_time_spawn"),GIFT_CHARGE:"".concat(Qn,"gift_charge"),GIFT_EXPLODE:"".concat(Qn,"gift_explode"),GIFT_REVEAL:"".concat(Qn,"gift_reveal"),HINT_ITEM:"".concat(Qn,"hint_item"),INVALID_MATCH:"".concat(Qn,"invalid_match"),LEVEL_COMPLETE:"".concat(Qn,"level_complete"),LEVEL_FAIL:"".concat(Qn,"level_fail"),LEVEL_START:"".concat(Qn,"level_start"),PROGRESS_STAR:"".concat(Qn,"progress_star"),RESCUE_TIMER:"".concat(Qn,"rescue_timer"),ROCKET_FLY:"".concat(Qn,"rocket_fly"),SHUFFLE_ITEM:"".concat(Qn,"shuffle_item"),THREE_STARS:"".concat(Qn,"three_stars"),TICKING_BOMB_BEFORE_EXPLODE:"".concat(Qn,"ticking_bomb_before_explode"),TILE_SELECT:"".concat(Qn,"tile_select"),USE_ITEM_CLICK:"".concat(Qn,"use_item_click"),BG_MUSIC:"".concat("musics/","bg_music"),PATCH_SHIFT:"".concat(Qn,"patch_shift"),THUNDERBOLT:"".concat(Qn,"thunderbolt"),WIND:"".concat(Qn,"wind"),COLLECT_COINS:"".concat(Qn,"collect_coins"),COLLECT_STOCK_COINS:"".concat(Qn,"collect_stock_coins"),LEVEL_FAIL_TIMEOUT:"".concat(Qn,"level_fail_timeout"),STAR_CHEST_DRUM_ROLL:"".concat(Qn,"star_chest_drum_roll"),STAR_CHEST_OPEN:"".concat(Qn,"star_chest_open"),LEADERBOARD_TRIUMPH:"".concat(Qn,"leaderboard_triumph"),ITEM_REWARD:"".concat(Qn,"item_reward")},$n=Object.values(Zn),ea=$n.reduce((function(e,t,n){return ke(ke({},e),{},Ie({},t,n))}),{});N(ea);var ta=$n;n._RF.pop(),n._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var na="RescuesScreen",aa="LoadingScreen",ia="GetItemScreen",ra="GetCoinScreen",oa="SettingsScreen",sa="StartLevelScreen",la="NotificationScreen",ua="LevelCompleteScreen",ca="CongratulationScreen",ha="QuitLevelScreen",pa="TournamentDetailScreen",da="DailyRewardsScreen",fa="StarChestScreen",va=[la,aa];n._RF.pop(),n._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);var ya=globalThis.game.analytics,ma=function(){function e(){xe(this,e)}return Pe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"trackCurrentPage",value:function(e,t){if(!va.includes(e)&&(t||this.trackingPages.includes(e))){this.trackingPages=this.trackingPages.filter((function(t){return t!==e})),t&&this.trackingPages.push(e);var n=this.getCurrentPage();ya.pageview(n)}}},{key:"switchSceneTracking",value:function(){this.trackingPages=[];var e=this.getCurrentPage();ya.pageview(e)}},{key:"getCurrentPage",value:function(){var e,t;return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:null!==(e=null===(t=d.getScene())||void 0===t?void 0:t.name)&&void 0!==e?e:"Unknown Scene"}}]),e}();ma.trackingPages=[];try{new ma}catch(e){console.error("AnalyticsUtils",e)}n._RF.pop(),n._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);var ga=function(){function e(){xe(this,e)}return Pe(e,[{key:"sound",get:function(){var e,t;return null!==(e=null===(t=R("Sound"))||void 0===t?void 0:t.getComponent(Xt))&&void 0!==e?e:null}},{key:"music",get:function(){var e,t;return null!==(e=null===(t=R("Music"))||void 0===t?void 0:t.getComponent(qt))&&void 0!==e?e:null}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"muteAudio",value:function(e){this.muteMusic(e),this.muteSound(e)}},{key:"playSound",value:function(e,t){var n;null===(n=this.inst.sound)||void 0===n||n.play(e,t)}},{key:"pauseSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.pause(e)}},{key:"resumeSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.resume(e)}},{key:"stopSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.stop(e)}},{key:"stopAllSounds",value:function(){var e;null===(e=this.inst.sound)||void 0===e||e.stopAll()}},{key:"muteSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.mute(e)}},{key:"playMusic",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!n&&null!==(e=this.inst.music)&&void 0!==e&&e.playing(Zn.BG_MUSIC)||null===(t=this.inst.music)||void 0===t||t.play(Zn.BG_MUSIC)}},{key:"pauseMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.pause(Zn.BG_MUSIC)}},{key:"muteMusic",value:function(e){var t;null===(t=this.inst.music)||void 0===t||t.mute(e)}},{key:"turnUpMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(.8)}},{key:"turnDownMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(.4)}},{key:"turnOffMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(0)}}]),e}();try{new ga}catch(e){console.error("AudioUtils",e)}n._RF.pop(),n._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);var ba,wa,ka,Sa,Ca,Ea,Aa,Ta,xa,Ra,Pa,Ia,_a,La,Oa,Da,Ma,Na,Fa,Ba,Ga,za,Ua,Ha,qa,Va,Wa,Ka,ja,Ya,Xa,Ja,Qa,Za=function(){function e(){xe(this,e)}return Pe(e,[{key:"getWindowSizeVsWorldGameRatio",value:function(){var e=F.getVisibleSize();return B.windowSize.width/window.devicePixelRatio/e.width}},{key:"getBoundingBoxTo",value:function(e,t){var n=G.mat4();G.Mat4.fromSRT(n,t.getRotation(),t.getPosition(),t.getScale());var a=t.getComponent(s);if(!a)throw new Error("Node must have UITransform component");var i=a.anchorPoint,r=a.contentSize,o=r.width,l=r.height,u=new G.Rect(-i.x*o,-i.y*l,o,l),c=G.mat4();if(G.Mat4.multiply(c,e,n),u.transformMat4(c),!t.children||0===t.children.length)return u;var h,p=t.children,d=t.getWorldMatrix(),f=Ye(p);try{for(f.s();!(h=f.n()).done;){var v=h.value;if(null!=v&&v.active)if(v.getComponent(s)){var y=this.getBoundingBoxTo(d,v);y&&G.Rect.union(u,u,y)}}}catch(e){f.e(e)}finally{f.f()}return u}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getBoundingBoxToWorld",value:function(e){if(e.parent){var t=e.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(t,e)}var n=e.getComponent(s);if(!n)throw new Error("Node must have UITransform component");return n.getBoundingBox()}},{key:"worldSizeToCssSize",value:function(e){return e*this.inst.getWindowSizeVsWorldGameRatio()}},{key:"cssSizeToWorldSize",value:function(e){return e/this.inst.getWindowSizeVsWorldGameRatio()}},{key:"getScreenWidthCss",value:function(){var e=document,t=e.body,n=e.documentElement,a=t.clientWidth,i=n.clientWidth;return Math.max(i,a)||0}},{key:"getScreenHeightCss",value:function(){var e=document,t=e.body,n=e.documentElement,a=t.clientHeight,i=n.clientHeight;return Math.max(i,a)||0}}]),e}();try{new Za}catch(e){console.error("CocosUtils",e)}n._RF.pop(),n._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var $a=a.ccclass,ei=a.property,ti=a.disallowMultiple,ni=a.executionOrder,ai=globalThis.game.analytics,ii=(ba=$a("ExtendedButton"),wa=ni(111),ka=ei(z),Sa=ei(z),Ca=ei(U.AnimationController),Ea=ei({override:!0,visible:!1}),Aa=ei({override:!0,visible:!1}),Ta=ei({override:!0,visible:!1}),xa=ei({override:!0,visible:!1}),Ra=ei({override:!0,visible:!1}),Pa=ei({override:!0,visible:!1}),Ia=ei({override:!0,visible:!1}),_a=ei({override:!0,visible:!1}),La=ei({override:!0,visible:!1}),Oa=ei({override:!0,visible:!1}),Da=ei({override:!0,visible:!1}),Ma=ei(H),Na=ei(H),Fa=ei(H),Ba=ei({visible:function(){return this.makeSound},type:ea}),Ga=ei({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),za=ei({visible:function(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),ba(Ua=ti(Ua=wa((qa=Qe((Ha=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"clickStartEvents",qa,Fe(e)),Je(e,"clickEndEvents",Va,Fe(e)),Je(e,"animationController",Wa,Fe(e)),Je(e,"useDesktopHover",Ka,Fe(e)),Je(e,"emitAnalyticsEvents",ja,Fe(e)),Je(e,"makeSound",Ya,Fe(e)),Je(e,"soundKey",Xa,Fe(e)),Je(e,"disableSpamClick",Ja,Fe(e)),Je(e,"disableSpamDelay",Qa,Fe(e)),e.currentClickBoundingBox=null,e.hasDown=!1,e.hasUp=!1,e.hasFinishClickCycle=!1,e.onTouchStart=function(t){e.interactable&&(e.hasDown||(e.currentClickBoundingBox=Za.getBoundingBoxToWorld(e.node),e.handleDown(t)))},e.onTouchEnd=function(t){e.interactable&&e.hasDown&&(e.hasUp||e.handleUp(t))},e.onTouchCancel=function(t){var n,a;if(e.interactable&&e.hasDown&&!e.hasUp){var i=t.getUILocation();null!==(n=null===(a=e.currentClickBoundingBox)||void 0===a?void 0:a.contains(i))&&void 0!==n&&n?e.handleUp(t):(e.hasUp=!0,e.hasFinishClickCycle=!0,e.handleResetButtonState(),e.emitClickEndEvents(t))}},e.onMouseEnter=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||(e.hasFinishClickCycle=!1,e.setAnimationState("HOVER")))},e.onMouseLeave=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||e.hasUp||e.hasFinishClickCycle||e.handleResetButtonState())},e.handleResetButtonState=function(){e.hasDown=!1,e.hasUp=!1,e.setAnimationState("RESET")},e}return Pe(n,[{key:"transition",get:function(){return p.Transition.NONE},set:function(e){qe(Le(n.prototype),"transition",p.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return Ue(Le(n.prototype),"normalColor",this)},set:function(e){qe(Le(n.prototype),"normalColor",e,this,!0)}},{key:"pressedColor",get:function(){return Ue(Le(n.prototype),"pressedColor",this)},set:function(e){qe(Le(n.prototype),"pressedColor",e,this,!0)}},{key:"hoverColor",get:function(){return Ue(Le(n.prototype),"hoverColor",this)},set:function(e){qe(Le(n.prototype),"hoverColor",e,this,!0)}},{key:"disabledColor",get:function(){return Ue(Le(n.prototype),"disabledColor",this)},set:function(e){qe(Le(n.prototype),"disabledColor",e,this,!0)}},{key:"normalSprite",get:function(){return Ue(Le(n.prototype),"normalSprite",this)},set:function(e){qe(Le(n.prototype),"normalSprite",e,this,!0)}},{key:"pressedSprite",get:function(){return Ue(Le(n.prototype),"pressedSprite",this)},set:function(e){qe(Le(n.prototype),"pressedSprite",e,this,!0)}},{key:"hoverSprite",get:function(){return Ue(Le(n.prototype),"hoverSprite",this)},set:function(e){qe(Le(n.prototype),"hoverSprite",e,this,!0)}},{key:"disabledSprite",get:function(){return Ue(Le(n.prototype),"disabledSprite",this)},set:function(e){qe(Le(n.prototype),"disabledSprite",e,this,!0)}},{key:"duration",get:function(){return Ue(Le(n.prototype),"duration",this)},set:function(e){qe(Le(n.prototype),"duration",e,this,!0)}},{key:"zoomScale",get:function(){return Ue(Le(n.prototype),"zoomScale",this)},set:function(e){qe(Le(n.prototype),"zoomScale",e,this,!0)}},{key:"__preload",value:function(){Ue(Le(n.prototype),"__preload",this).call(this),Ct.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var e;null===(e=Ue(Le(n.prototype),"onDestroy",this))||void 0===e||e.call(this)}},{key:"onEnable",value:function(){var e;null===(e=Ue(Le(n.prototype),"onEnable",this))||void 0===e||e.call(this),this.node.off(q.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(i.EventType.TOUCH_START,this.onTouchStart),this.node.on(i.EventType.TOUCH_END,this.onTouchEnd),this.node.on(i.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(i.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(i.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var e;null===(e=Ue(Le(n.prototype),"onDisable",this))||void 0===e||e.call(this),this.node.off(i.EventType.TOUCH_START,this.onTouchStart),this.node.off(i.EventType.TOUCH_END,this.onTouchEnd),this.node.off(i.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(i.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(i.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(e){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&ga.playSound(ta[this.soundKey]),this.emitClickStartEvents(e)}},{key:"emitClickStartEvents",value:function(e){this.clickStartEvents.forEach((function(t){t.emit([e,t.customEventData])}))}},{key:"emitClickEndEvents",value:function(e){this.clickEndEvents.forEach((function(t){t.emit([e,t.customEventData])}))}},{key:"handleUp",value:function(e){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}},{key:"emitButtonEvents",value:function(e){this.interactable&&(this.emitAnalyticsEvents&&ai.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:ma.getCurrentPage()}),this.clickEvents.forEach((function(t){t.emit([e,t.customEventData])})))}},{key:"setAnimationState",value:function(e){this.animationController.setValue("DOWN","DOWN"===e),this.animationController.setValue("HOVER","HOVER"===e),this.animationController.setValue("RESET","RESET"===e)}},{key:"fakeClick",value:function(){var e=this;this.setAnimationState("DOWN"),this.scheduleOnce((function(){e.setAnimationState("RESET")}),0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),n}(p)).prototype,"clickStartEvents",[ka],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Va=Qe(Ha.prototype,"clickEndEvents",[Sa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Wa=Qe(Ha.prototype,"animationController",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qe(Ha.prototype,"transition",[Ea],Object.getOwnPropertyDescriptor(Ha.prototype,"transition"),Ha.prototype),Qe(Ha.prototype,"normalColor",[Aa],Object.getOwnPropertyDescriptor(Ha.prototype,"normalColor"),Ha.prototype),Qe(Ha.prototype,"pressedColor",[Ta],Object.getOwnPropertyDescriptor(Ha.prototype,"pressedColor"),Ha.prototype),Qe(Ha.prototype,"hoverColor",[xa],Object.getOwnPropertyDescriptor(Ha.prototype,"hoverColor"),Ha.prototype),Qe(Ha.prototype,"disabledColor",[Ra],Object.getOwnPropertyDescriptor(Ha.prototype,"disabledColor"),Ha.prototype),Qe(Ha.prototype,"normalSprite",[Pa],Object.getOwnPropertyDescriptor(Ha.prototype,"normalSprite"),Ha.prototype),Qe(Ha.prototype,"pressedSprite",[Ia],Object.getOwnPropertyDescriptor(Ha.prototype,"pressedSprite"),Ha.prototype),Qe(Ha.prototype,"hoverSprite",[_a],Object.getOwnPropertyDescriptor(Ha.prototype,"hoverSprite"),Ha.prototype),Qe(Ha.prototype,"disabledSprite",[La],Object.getOwnPropertyDescriptor(Ha.prototype,"disabledSprite"),Ha.prototype),Qe(Ha.prototype,"duration",[Oa],Object.getOwnPropertyDescriptor(Ha.prototype,"duration"),Ha.prototype),Qe(Ha.prototype,"zoomScale",[Da],Object.getOwnPropertyDescriptor(Ha.prototype,"zoomScale"),Ha.prototype),Ka=Qe(Ha.prototype,"useDesktopHover",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ja=Qe(Ha.prototype,"emitAnalyticsEvents",[Na],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ya=Qe(Ha.prototype,"makeSound",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xa=Qe(Ha.prototype,"soundKey",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ea[Zn.BUTTON_CLICK]}}),Ja=Qe(Ha.prototype,"disableSpamClick",[Ga],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Qa=Qe(Ha.prototype,"disableSpamDelay",[za],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Ua=Ha))||Ua)||Ua)||Ua);n._RF.pop(),n._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);var ri,oi,si,li,ui=function(){function e(){xe(this,e),this.eventTarget=new EventTarget,this.isAborted=!1}var t;return Pe(e,[{key:"aborted",get:function(){return this.isAborted}},{key:"reason",get:function(){return this.abortReason}},{key:"addAbortListener",value:function(e){this.eventTarget.addEventListener("abort",e)}},{key:"removeAbortListener",value:function(e){this.eventTarget.removeEventListener("abort",e)}},{key:"abort",value:function(e){this.isAborted||(this.isAborted=!0,this.abortReason=e,this.eventTarget.dispatchEvent(new Event("abort")))}},{key:"untilAborted",value:(t=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAborted){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){t.addAbortListener((function(){return e()}))})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"hasBeenAborted",value:function(e){return null==e||e.aborted}}]),e}();n._RF.pop(),n._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var ci,hi,pi,di=a.ccclass,fi=a.requireComponent,vi=a.property,yi=di("OpacityToggler")(ri=fi([M])((si=Qe((oi=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"activeValue",si,Fe(e)),Je(e,"inActiveValue",li,Fe(e)),e.signal=new ui,e}return Pe(a,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"changeState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.signal.abort(),this.opacityComponent.opacity=e?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(t=Te(Se().mark((function e(){var t,n,a,i=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],n=i.length>1&&void 0!==i[1]?i[1]:.2,this.signal.abort(),this.signal=new ui,a=t?this.activeValue:this.inActiveValue,e.next=7,mn.runTweenAsync(S(this.opacityComponent).to(n,{opacity:a}),this.signal);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"activeValue",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),li=Qe(oi.prototype,"inActiveValue",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),ri=oi))||ri)||ri;n._RF.pop(),n._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var mi,gi,bi,wi,ki,Si,Ci,Ei,Ai,Ti,xi,Ri,Pi,Ii,_i,Li,Oi,Di,Mi,Ni,Fi=a.ccclass,Bi=a.property,Gi=a.requireComponent,zi=a.disallowMultiple,Ui=a.executeInEditMode,Hi=Mn,qi=Hi.Portrait,Vi=Hi.Landscape;Fi("DebugResolution")(ci=zi(ci=Gi([V])(ci=Ui(!0)(((pi=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).handleLayoutChange=function(){var t;null===(t=e.graphics)||void 0===t||t.clear(),e.start()},e}return Pe(n,[{key:"drawPortrait",get:function(){return n._drawPortrait},set:function(e){e!==n._drawPortrait&&(e?this.drawPortraitResolution():this.graphics.clear(),n._drawPortrait=e,n._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return n._drawLandscape},set:function(e){e!==n._drawLandscape&&(e?this.drawLandscapeResolution():this.graphics.clear(),n._drawLandscape=e,n._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(V),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){x.on(An,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var e=this.graphics,t=qi.WIDTH,n=qi.HEIGHT,a=-t/2,i=-n/2;e.strokeColor=r.GREEN,e.rect(a,i,t,n),e.stroke()}},{key:"drawLandscapeResolution",value:function(){var e=this.graphics,t=Vi.WIDTH,n=Vi.HEIGHT,a=-t/2,i=-n/2;e.strokeColor=r.CYAN,e.rect(a,i,t,n),e.stroke()}}]),n}(f))._drawPortrait=!0,pi._drawLandscape=!0,Qe((hi=pi).prototype,"drawPortrait",[Bi],Object.getOwnPropertyDescriptor(hi.prototype,"drawPortrait"),hi.prototype),Qe(hi.prototype,"drawLandscape",[Bi],Object.getOwnPropertyDescriptor(hi.prototype,"drawLandscape"),hi.prototype),ci=hi))||ci)||ci)||ci);n._RF.pop(),n._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var Wi=a.ccclass,Ki=a.executionOrder,ji=a.property,Yi=GameCore.Utils,Xi=r.RED,Ji=r.BLACK,Qi=r.MAGENTA;mi=Wi("GameStats"),gi=Ki(-1e3),bi=ji(u),wi=ji(u),ki=ji(u),Si=ji(u),Ci=ji(u),Ei=ji(u),Ai=ji(u),Ti=ji(u),mi(xi=gi((Pi=Qe((Ri=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"fpsLabel",Pi,Fe(e)),Je(e,"drawCountLabel",Ii,Fe(e)),Je(e,"logicTimeLabel",_i,Fe(e)),Je(e,"physicTimeLabel",Li,Fe(e)),Je(e,"renderTimeLabel",Oi,Fe(e)),Je(e,"objectMemoryUsageLabel",Di,Fe(e)),Je(e,"textureMemoryUsageLabel",Mi,Fe(e)),Je(e,"devicePixelRatioLabel",Ni,Fe(e)),e.refreshInterval=.5,e.handleMouseDown=function(){e.bg.enabled=!e.bg.enabled},e.waitForStats=function(){W.stats&&(e.unschedule(e.waitForStats),e.node.active=!0,e.stats=W.stats,e.startUpdateStats())},e.updateStats=function(){e.updateFps(),e.updateDrawCalls(),e.updateLogicTime(),e.updatePhysicTime(),e.updateRenderTime(),e.updateObjectMemoryUsage(),e.updateTextureMemoryUsage(),e.updateDevicePixelRatio()},e}return Pe(n,[{key:"__preload",value:function(){this.bg=this.getComponent(T),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(q.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,W&&Yi.Valid.isDebugger()&&(W.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var e=this.getFps();this.updateFpsColor(e),this.fpsLabel.string="FPS: ".concat(e)}},{key:"updateFpsColor",value:function(e){this.fpsLabel.color=e<30?Xi:e<48?Qi:Ji}},{key:"updateDrawCalls",value:function(){var e=this.getDrawCalls();this.updateDrawCallsColor(e),this.drawCountLabel.string="Draw Calls: ".concat(e)}},{key:"updateDrawCallsColor",value:function(e){var t=K.os===K.OS.IOS,n=t?80:25,a=t?60:15;this.drawCountLabel.color=e>n?Xi:e>a?Qi:Ji}},{key:"updateLogicTime",value:function(){var e=this.getLogicTime();this.updateLogicTimeColor(e),this.logicTimeLabel.string="Logic Time: ".concat(e.toFixed(2),"ms")}},{key:"updateLogicTimeColor",value:function(e){this.logicTimeLabel.color=e>10?Xi:e>5?Qi:Ji}},{key:"updatePhysicTime",value:function(){var e=this.getPhysicTime();this.updatePhysicTimeColor(e),this.physicTimeLabel.string="Physic Time: ".concat(e.toFixed(2),"ms")}},{key:"updatePhysicTimeColor",value:function(e){this.physicTimeLabel.color=e>10?Xi:e>5?Qi:Ji}},{key:"updateRenderTime",value:function(){var e=this.getRenderTime();this.updateRenderTimeColor(e),this.renderTimeLabel.string="Render Time: ".concat(e.toFixed(2),"ms")}},{key:"updateRenderTimeColor",value:function(e){this.renderTimeLabel.color=e>10?Xi:e>5?Qi:Ji}},{key:"updateObjectMemoryUsage",value:function(){var e=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(e),this.objectMemoryUsageLabel.string="Object Mem: ".concat(e.toFixed(2),"MB")}},{key:"updateObjectMemoryUsageColor",value:function(e){this.objectMemoryUsageLabel.color=e>40?Xi:e>25?Qi:Ji}},{key:"updateTextureMemoryUsage",value:function(){var e=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(e),this.textureMemoryUsageLabel.string="Texture Mem: ".concat(e.toFixed(2),"MB")}},{key:"updateTextureMemoryUsageColor",value:function(e){this.textureMemoryUsageLabel.color=e>50?Xi:e>35?Qi:Ji}},{key:"updateDevicePixelRatio",value:function(){var e=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(e),this.devicePixelRatioLabel.string="Device Pixel Ratio: ".concat(e)}},{key:"updateDevicePixelRatioColor",value:function(e){this.devicePixelRatioLabel.color=e>2?Xi:e<=1?Qi:Ji}},{key:"getFps",value:function(){var e=this.stats.fps.counter;return Math.floor(e.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var e=this.stats.logic.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getPhysicTime",value:function(){var e=this.stats.physics.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getRenderTime",value:function(){var e=this.stats.render.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var e=this.stats.bufferMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var e=this.stats.textureMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),n}(f)).prototype,"fpsLabel",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ii=Qe(Ri.prototype,"drawCountLabel",[wi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_i=Qe(Ri.prototype,"logicTimeLabel",[ki],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Li=Qe(Ri.prototype,"physicTimeLabel",[Si],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oi=Qe(Ri.prototype,"renderTimeLabel",[Ci],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Di=Qe(Ri.prototype,"objectMemoryUsageLabel",[Ei],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mi=Qe(Ri.prototype,"textureMemoryUsageLabel",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ni=Qe(Ri.prototype,"devicePixelRatioLabel",[Ti],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xi=Ri))||xi);n._RF.pop(),n._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var Zi,$i=function(e){return e.INVITE_FRIENDS="invite-friends",e.REPLAY_FRIENDS="replay-friends",e.SHOW_CHALLENGE_RESULTS="show-challenge-results",e.NEXT_LEVEL="next-level",e.MAX_LEVEL="max-level",e.START_OVER="start-over",e.SELECT_LEVEL="select-level",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_REPLAY="game-replay",e.GAME_FINISH="game-finish",e.GAME_EXIT="game-exit",e.USE_ITEM="use-item",e.SKIP_LEVEL="skip-level",e.ADD_ITEM="add-item",e.ADD_ITEMS="add-items",e.ADD_COINS="add-coins",e.REMOVE_COINS="remove-coins",e.REMOVE_COINS_SUCCESS="remove-coins-success",e.REMOVE_COINS_FAILED="remove-coins-failed",e.COIN_CHANGED="coin-changed",e.ADD_STARS="add-stars",e.PAUSE_TIME="pause-time",e.RESUME_TIME="resume-time",e.TIME_OUT="time-out",e.HALF_TIME="half-time",e.RESCUE_START="rescue-time",e.RESCUE_FINISHED="clock-animation-finished",e.APPLY_GRAVITY="apply-gravity",e.IDLE_ENTER="idle-enter",e.IDLE_EXIT="idle-exit",e.GRID_MATCH="grid-match",e.GRID_MATCH_SUCCESS="grid-match-success",e.GRID_MATCH_FAIL="grid-match-fail",e.GRID_CLEAR="grid-clear",e.GRID_CREATE="grid-create",e.TILE_CLICK="tile-click",e.BOMB_EXPLODE="bomb-explode",e.SHOW_HINT="show-hint",e.ADD_COMBO="add-combo",e.COMBO_UPDATED="combo-updated",e.COMBO_ENDED="combo-ended",e.ADD_SCORE="add-score",e.SCORE_UPDATED="score-updated",e.REGISTER_ANIMATOR="register-animator",e.UNREGISTER_ANIMATOR="unregister-animator",e.SHOW_UI="show-ui",e.HIDE_UI="hide-ui",e.AUTO_PLAY="auto-play",e.GUIDE_MASK_CLICKED="guide-mask-clicked",e}($i||{});n._RF.pop(),n._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var er,tr,nr,ar,ir,rr,or,sr,lr,ur,cr,hr,pr,dr,fr,vr,yr,mr,gr=(0,a.ccclass)("PanelAnimationController")(Zi=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).animators=new Set,e.handleRegistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)&&console.warn("Animator already registered."),e.animators.add(t)},e.handleUnregistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)||console.warn("Animator not registered."),e.animators.delete(t)},e.handleShowUIs=function(t){var n=!1,a=Array.from(e.animators.values()).map((function(e){var a;e.isReadyForAnimation()||n||(n=!0,null==t||null===(a=t.fallback)||void 0===a||a.call(t));return e.handleShowUI()}));Promise.all(a).then((function(){var e;null==t||null===(e=t.onComplete)||void 0===e||e.call(t)}))},e.handleHideUIs=function(t){var n=!1,a=Array.from(e.animators.values()).map((function(e){var a;e.isReadyForAnimation()||n||(n=!0,null==t||null===(a=t.fallback)||void 0===a||a.call(t));return e.handleHideUI()}));Promise.all(a).then((function(){var e;null==t||null===(e=t.onComplete)||void 0===e||e.call(t)}))},e}return Pe(n,[{key:"init",value:function(){this.node.scene.off($i.REGISTER_ANIMATOR),this.node.scene.off($i.UNREGISTER_ANIMATOR),this.node.scene.off($i.SHOW_UI),this.node.scene.off($i.HIDE_UI),this.node.scene.on($i.REGISTER_ANIMATOR,this.handleRegistration),this.node.scene.on($i.UNREGISTER_ANIMATOR,this.handleUnregistration),this.node.scene.on($i.SHOW_UI,this.handleShowUIs),this.node.scene.on($i.HIDE_UI,this.handleHideUIs)}}]),n}(f))||Zi;n._RF.pop(),n._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var br,wr,kr,Sr,Cr=a.ccclass,Er=a.property,Ar=(er=Cr("AnimationConfig"),tr=Er({type:[E]}),er((ir=Qe((ar=function(){function e(){xe(this,e),Je(this,"startHidden",ir,this),Je(this,"nodes",rr,this),Je(this,"posOffset",or,this),Je(this,"showEase",sr,this),Je(this,"hideEase",lr,this),Je(this,"showDuration",ur,this),Je(this,"hideDuration",cr,this)}return Pe(e,[{key:"setConfig",value:function(e){e&&Object.assign(this,e)}}]),e}()).prototype,"startHidden",[Er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),rr=Qe(ar.prototype,"nodes",[tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),or=Qe(ar.prototype,"posOffset",[Er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sr=Qe(ar.prototype,"showEase",[Er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),lr=Qe(ar.prototype,"hideEase",[Er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),ur=Qe(ar.prototype,"showDuration",[Er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cr=Qe(ar.prototype,"hideDuration",[Er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nr=ar))||nr),Tr=(hr=Cr("PanelAnimator"),pr=Er({type:Ar,displayName:"Top animation nodes"}),dr=Er({type:Ar,displayName:"Bottom animation nodes"}),hr((yr=Qe((vr=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"topConfig",yr,Fe(e)),Je(e,"botConfig",mr,Fe(e)),e.isReady=!1,e}return Pe(i,[{key:"onEnable",value:function(){this.node.scene.emit($i.REGISTER_ANIMATOR,this)}},{key:"onDisable",value:function(){this.node.scene.emit($i.UNREGISTER_ANIMATOR,this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady){e.next=3;break}return console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready")),e.abrupt("return");case 3:return e.abrupt("return",Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")]));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleHideUI",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady){e.next=3;break}return console.warn("".concat(this.node.name,"'s ").concat(this.name,": not ready")),e.abrupt("return");case 3:return e.abrupt("return",Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")]));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"createAnimator",value:function(e,t){var n=e.nodes,a=e.posOffset,r=e.showEase,o=e.hideEase,s=e.showDuration,l=e.hideDuration,u=n.map((function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom}:{mode:"position",value:e.node.position.y}})),c=n.map((function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top+a}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom-a}:{mode:"position",value:e.node.position.y+a}})),h="shown";return{switchState:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h===e)return Promise.resolve(null);h=e;var a="hidden"===e?u:c,p="hidden"===e?c:u,d="hidden"===e?l:s,f="hidden"===e?o:r;return t?(n.forEach((function(e,t){var n=a[t],i=p[t].value;"top"===n.mode&&(e.top=i),"bottom"===n.mode&&(e.bottom=i),"position"===n.mode&&(e.node.position=new j(e.node.position.x,i,e.node.position.z))})),Promise.resolve(null)):Promise.all(n.map((function(e,t){var n=a[t],r=p[t].value;return mn.runTweenAsync(i.getTween({widget:e,config:n,target:r,easing:f,duration:d}))})))}}}},{key:"setAnimator",value:function(e){var t=e.topConfig,n=e.botConfig,a=new Ar,i=new Ar;a.setConfig(t),i.setConfig(n),this.topConfig=a,this.botConfig=i,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(e){var t=e.widget,n=e.config,a=e.target,i=e.easing,r=e.duration;return"top"===n.mode?S(t).call((function(){t.top=n.value})).to(r,{top:a},{easing:i}):"bottom"===n.mode?S(t).call((function(){t.bottom=n.value})).to(r,{bottom:a},{easing:i}):S(t.node.position).call((function(){t.node.position=new j(t.node.position.x,n.value,t.node.position.z)})).to(r,{y:a},{easing:i})}}]),i}(f)).prototype,"topConfig",[pr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ar}}),mr=Qe(vr.prototype,"botConfig",[dr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Ar}}),fr=vr))||fr);n._RF.pop(),n._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var xr,Rr,Pr,Ir,_r,Lr,Or,Dr,Mr,Nr,Fr,Br=a.ccclass,Gr=a.requireComponent,zr=a.property,Ur=globalThis.game,Hr=Ur.ads,qr=Ur.event;Br("ResizeWithBannerAd")(br=Gr(E)((kr=Qe((wr=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"willShowBanner",kr,Fe(e)),Je(e,"includeSAB",Sr,Fe(e)),e.handleAdShow=function(t){var n,a=t.placementId;null!==a&&((null===(n=Hr.getAdByPlacementId(a))||void 0===n?void 0:n.type)===GameCore.Plugins.Ads.Types.BANNER&&e.resizeToFitBannerAd())},e.handleAdClose=function(t){var n,a=t.placementId;null!==a&&((null===(n=Hr.getAdByPlacementId(a))||void 0===n?void 0:n.type)===GameCore.Plugins.Ads.Types.BANNER&&e.updateWidgets(Hr.getSafeAreaBottom(Za.cssSizeToWorldSize(1))))},e}return Pe(n,[{key:"__preload",value:function(){this.widget=this.getComponent(E),Ct.lazyValidateProperties(this),qr.on(GameCore.Events.AD_SHOWING,this.handleAdShow),qr.on(GameCore.Events.AD_CLOSED,this.handleAdClose)}},{key:"onDestroy",value:function(){qr.off(GameCore.Events.AD_SHOWING,this.handleAdShow),qr.off(GameCore.Events.AD_CLOSED,this.handleAdClose)}},{key:"start",value:function(){var e=Hr.getSafeAreaBottom(Za.cssSizeToWorldSize(1));this.willShowBanner||n.isBannerAdShowing()?this.resizeToFitBannerAd():e>0&&this.includeSAB&&this.updateWidgets(e)}},{key:"resizeToFitBannerAd",value:function(){var e=this,t=GameCore.Configs.Ads,n=t.Enabled,a=t.BannerDisplayAdOptions;if(n)if(this.widget.isAlignBottom){var i=0;a.forEach((function(t){var n=t.PlacementId;"bottom"===t.Position&&Hr.canbeShowBannerAd(n)&&(i=Hr.getBannerHeight(n,Za.cssSizeToWorldSize(1),e.includeSAB))})),i>0&&this.updateWidgets(i)}else console.warn("Widget does not align to bottom, ResizeWithBannerAds will have no effect!")}},{key:"updateWidgets",value:function(e){this.widget.bottom=e,this.widget.updateAlignment(),this.getComponentsInChildren(E).forEach((function(e){e.updateAlignment()}))}}],[{key:"isBannerAdShowing",value:function(){return Hr.enabled&&Hr.getAdStatus(GameCore.Plugins.Ads.Types.BANNER)===GameCore.Plugins.Ads.Status.SHOWING}}]),n}(f)).prototype,"willShowBanner",[zr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Sr=Qe(wr.prototype,"includeSAB",[zr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),br=wr))||br);n._RF.pop(),n._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var Vr,Wr,Kr,jr,Yr,Xr,Jr,Qr,Zr,$r,eo=a.ccclass,to=a.property,no=a.executeInEditMode,ao=a.requireComponent,io=(xr=eo("TapperedProgressBar"),Rr=ao(M),Pr=to({type:M,displayName:"Fill opacity"}),Ir=to({type:T,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),_r=to({type:T,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),Lr=to({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),xr(Or=no(Or=Rr((Mr=Qe((Dr=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"uiOpacity",Mr,Fe(e)),Je(e,"leftCap",Nr,Fe(e)),Je(e,"rightCap",Fr,Fe(e)),e}return Pe(n,[{key:"progress",get:function(){return Ue(Le(n.prototype),"progress",this)},set:function(e){qe(Le(n.prototype),"progress",e,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity)if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var e=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=e}}},{key:"start",value:function(){this.updateAppearance()}}]),n}(Y)).prototype,"uiOpacity",[Pr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nr=Qe(Dr.prototype,"leftCap",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fr=Qe(Dr.prototype,"rightCap",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qe(Dr.prototype,"progress",[Lr],Object.getOwnPropertyDescriptor(Dr.prototype,"progress"),Dr.prototype),Or=Dr))||Or)||Or)||Or);n._RF.pop(),n._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var ro,oo,so,lo,uo,co,ho,po,fo,vo=a.ccclass,yo=a.property,mo=a.requireComponent,go=a.executeInEditMode,bo=a.disallowMultiple,wo=globalThis.game.language;Vr=vo("Localize"),Wr=mo(u),Kr=go(!0),jr=yo({visible:!0}),Yr=yo({group:{name:"Fonts",id:"fonts",displayOrder:1},type:X}),Xr=yo({group:{name:"Fonts",id:"fonts",displayOrder:2},type:X}),Vr(Jr=bo(Jr=Wr(Jr=Kr((Qe((Qr=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"enFont",Zr,Fe(e)),Je(e,"ruFont",$r,Fe(e)),e.handleLanguageChanged=function(){e.updateTransToNode()},e}return Pe(n,[{key:"key",get:function(){return this._key},set:function(e){e&&(this._key=e,this.updateTransToNode())}},{key:"__preload",value:function(){this.label=this.getComponent(u),this.validateRequiredComponents(),this.updateTransToNode()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"start",value:function(){this.listenEvent()}},{key:"listenEvent",value:function(){x.on("update-language",this.handleLanguageChanged)}},{key:"updateTransToNode",value:function(){if(this.node.active&&this._key)try{var e=wo.getText(this._key),t=this.getFontByLang();this.label.font=t,this.label.string=e,this.node.emit("update-trans",e)}catch(e){console.warn(e)}}},{key:"getFontByLang",value:function(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(wo.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}]),n}(f)).prototype,"key",[jr],Object.getOwnPropertyDescriptor(Qr.prototype,"key"),Qr.prototype),Zr=Qe(Qr.prototype,"enFont",[Yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$r=Qe(Qr.prototype,"ruFont",[Xr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jr=Qr))||Jr)||Jr)||Jr);n._RF.pop(),n._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var ko,So,Co,Eo,Ao,To,xo,Ro,Po,Io=a.ccclass,_o=a.property,Lo=function(){function e(t,n){var a;xe(this,e),n=null!==(a=n)&&void 0!==a?a:{response:1,dampen:1,eager:1},this.k1=e.calcK1(n),this.k2=e.calcK2(n),this.k3=e.calcK3(n),this.xp=t.clone(),this.y=t.clone(),this.yd=new J(0,0)}return Pe(e,[{key:"update",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=new J((t.x-this.xp.x)/e,(t.y-this.xp.y)/e),this.xp.x=t.x,this.xp.y=t.y);var a=Math.max(this.k2,e*e/2+e*this.k1/2,e*this.k1);return this.y.x=this.y.x+e*this.yd.x,this.y.y=this.y.y+e*this.yd.y,this.yd.x=this.yd.x+e*(t.x+this.k3*n.x-this.y.x-this.k1*this.yd.x)/a,this.yd.y=this.yd.y+e*(t.y+this.k3*n.y-this.y.y-this.k1*this.yd.y)/a,this.y}},{key:"setDynamics",value:function(t){this.k1=e.calcK1(t),this.k2=e.calcK2(t),this.k3=e.calcK3(t)}},{key:"reset",value:function(e){this.xp.set(e.x,e.y),this.y.set(e.x,e.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(e){return e.dampen/(Math.PI*e.response)}},{key:"calcK2",value:function(e){return 1/(2*Math.PI*e.response*(2*Math.PI*e.response))}},{key:"calcK3",value:function(e){return e.eager*e.dampen/(2*Math.PI*e.response)}}]),e}(),Oo=(ro=Io("SODConfig"),oo=_o({type:C,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),so=_o({type:C,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),lo=_o({type:C,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),ro((ho=Qe((co=Pe((function e(){xe(this,e),Je(this,"response",ho,this),Je(this,"dampen",po,this),Je(this,"eager",fo,this)}))).prototype,"response",[oo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),po=Qe(co.prototype,"dampen",[so],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),fo=Qe(co.prototype,"eager",[lo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uo=co))||uo);n._RF.pop(),n._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var Do,Mo,No,Fo,Bo,Go,zo,Uo,Ho,qo,Vo,Wo,Ko,jo,Yo,Xo,Jo,Qo,Zo,$o,es,ts,ns,as,is,rs,os=a.ccclass,ss=a.property,ls=(ko=os("Trail"),So=ss({type:i,displayName:"Target"}),Co=ss({type:V,displayName:"Graphics"}),Eo=ss({type:[Oo],displayName:"Trail Nodes"}),ko((xo=Qe((To=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"target",xo,Fe(e)),Je(e,"graphics",Ro,Fe(e)),Je(e,"trailNodes",Po,Fe(e)),e.trailNodeInstances=[],e}return Pe(n,[{key:"reset",value:function(){var e,t=Ye(this.trailNodeInstances);try{for(t.s();!(e=t.n()).done;){e.value.reset(new J(this.node.worldPosition.x,this.node.worldPosition.y))}}catch(e){t.e(e)}finally{t.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(e){this.graphics.clear();var t=this.trailNodeInstances[0];this.drawTrail(e,t,this.target.worldPosition.x,this.target.worldPosition.y);for(var n=1;n<this.trailNodeInstances.length;n++){var a=this.trailNodeInstances[n-1],i=this.trailNodeInstances[n];this.drawTrail(e,i,a.currentState.x,a.currentState.y)}}},{key:"drawTrail",value:function(e,t,n,a){var i=this.graphics,r=new J(n,a),o=t.update(e,r),s=new j(r.x,r.y,0),l=new j(o.x,o.y,0);i.node.inverseTransformPoint(s,s),i.node.inverseTransformPoint(l,l),i.moveTo(s.x,s.y),i.lineTo(l.x,l.y),i.stroke()}},{key:"spawnTrailNodes",value:function(){var e,t=Ye(this.trailNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value,a=new J(this.node.worldPosition.x,this.node.worldPosition.y),i=new Lo(a,n);this.trailNodeInstances.push(i)}}catch(e){t.e(e)}finally{t.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(f)).prototype,"target",[So],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ro=Qe(To.prototype,"graphics",[Co],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Po=Qe(To.prototype,"trailNodes",[Eo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ao=To))||Ao);n._RF.pop(),n._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var us,cs=a.ccclass,hs=a.executionOrder,ps=a.property,ds="Batch By Name",fs="Batch Label",vs="Batch Sprite",ys=(Do=cs("BatchNodes"),Mo=hs(99999),No=ps({group:{name:ds}}),Fo=ps({type:[g],group:{name:ds}}),Bo=ps({type:[m],group:{name:ds}}),Go=ps({group:{name:fs}}),zo=ps({group:{name:fs}}),Uo=ps({group:{name:fs}}),Ho=ps({group:{name:vs}}),qo=ps({group:{name:vs}}),Vo=ps({readonly:!0}),Wo=ps({readonly:!0}),Ko=ps({readonly:!0}),Do(jo=Mo((Xo=Qe((Yo=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"batchByName",Xo,Fe(e)),Je(e,"depthNames",Jo,Fe(e)),Je(e,"listName",Qo,Fe(e)),Je(e,"batchLabel",Zo,Fe(e)),Je(e,"depthLabel",$o,Fe(e)),Je(e,"typeLabel",es,Fe(e)),Je(e,"batchSprite",ts,Fe(e)),Je(e,"depthSprite",ns,Fe(e)),Je(e,"batchAllNodes",as,Fe(e)),Je(e,"batchDepth",is,Fe(e)),Je(e,"checkOverlap",rs,Fe(e)),e.batchNode={},e.labelChildren=[],e.spriteChildren=[],e.allChildren=[],e.nameChildren=[],e.originalParents={},e.isInited=!1,e.onAfterUpdate=function(){e.isInited&&e.hierarchyChildren()},e.onAfterRender=function(){e.isInited&&e.restoreOriginalChildren()},e}return Pe(n,[{key:"__preload",value:function(){this.enabled&&(d.on(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.on(Q.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){d.off(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.off(Q.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){d.on(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.on(Q.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),d.off(Q.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.off(Q.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(e){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(e),this.createGlobalNodes(e),this.createGlobalNameNodes(e),this.createGlobalLabelNode(e),this.createGlobalSpriteNode(e),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var e,t,n,a=this;null===(e=this.batchNode.node)||void 0===e||e.setSiblingIndex(0),null===(t=this.batchNode.label)||void 0===t||t.setSiblingIndex(this.depthLabel),null===(n=this.batchNode.sprite)||void 0===n||n.setSiblingIndex(this.depthSprite),this.listName.forEach((function(e,t){var n;null===(n=a.batchNode[e])||void 0===n||n.setSiblingIndex(a.depthNames[t])}))}},{key:"createGlobalNodes",value:function(e){if(this.batchAllNodes){var t=new i("GlobalBatchNode");t.active=!0,this.batchNode.node=t,e.addChild(t)}}},{key:"createGlobalNameNodes",value:function(e){var t=this;this.batchByName&&this.listName.forEach((function(n){if(!t.batchNode[n]){var a=new i(n);a.active=!0,t.batchNode[n]=a,e.addChild(a)}}))}},{key:"createGlobalLabelNode",value:function(e){if(this.batchLabel){var t=new i("GlobalLabelNode");t.active=!0,this.batchNode.label=t,e.addChild(t)}}},{key:"createGlobalSpriteNode",value:function(e){if(this.batchSprite){var t=new i("GlobalSpriteNode");t.active=!0,this.batchNode.sprite=t,e.addChild(t)}}},{key:"saveOriginalParents",value:function(){var e=this;[].concat(We(this.labelChildren),We(this.spriteChildren)).forEach((function(t){t.node.parent&&(e.originalParents[t.uuid]=t.node.parent)})),this.nameChildren.forEach((function(t){t.parent&&(e.originalParents[t.uuid]=t.parent)}))}},{key:"saveOriginalChildren",value:function(e){var t=this;e.children.forEach((function(e){t.saveLabelChildren(e),t.saveSpriteChildren(e),t.saveNodeChildrenByName(e),t.saveNodeChildrenByType(e)})),this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(e){var t;if(this.batchLabel){var n=e.getComponentsInChildren(u);"char"===this.typeLabel&&n.filter((function(e){return e.cacheMode===u.CacheMode.CHAR})),0!==n.length&&(t=this.labelChildren).push.apply(t,We(n))}}},{key:"saveSpriteChildren",value:function(e){var t;if(this.batchSprite){var n=e.getComponentsInChildren(T);0!==n.length&&(t=this.spriteChildren).push.apply(t,We(n))}}},{key:"saveNodeChildrenByName",value:function(e){var t=this;this.batchByName&&e.children.forEach((function(e){t.listName.includes(e.name)?t.nameChildren.push(e):t.saveNodeChildrenByName(e)}))}},{key:"saveNodeChildrenByType",value:function(e){var t,n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.batchAllNodes){var i=e.getComponentsInChildren(f);(t=this.allChildren).push.apply(t,We(i)),this.batchDepth>0&&a<this.batchDepth&&this.allChildren.forEach((function(e){n.saveNodeChildrenByType(e.node,n.batchDepth)}))}}},{key:"hierarchyChildren",value:function(){var e,t=this;this.labelChildren.forEach((function(n){var a;n.node.isValid&&null!==(a=n.node.parent)&&void 0!==a&&a.active&&(e=t.batchNode.label,n.node.setParent(e,!0),n.node.layer=Z.Enum.UI_2D)})),this.spriteChildren.forEach((function(n){var a;n.node.isValid&&null!==(a=n.node.parent)&&void 0!==a&&a.active&&(e=t.batchNode.sprite,n.node.setParent(e,!0),n.node.layer=Z.Enum.UI_2D)})),this.allChildren.forEach((function(n){var a;n.node.isValid&&null!==(a=n.node.parent)&&void 0!==a&&a.active&&(e=t.batchNode.node,n.node.setParent(e,!0),n.node.layer=Z.Enum.UI_2D)})),this.allChildren.sort((function(e,t){var n=e.constructor.name,a=t.constructor.name;return n<a?-1:n>a?1:0})),this.nameChildren.forEach((function(n){var a;n.isValid&&null!==(a=n.parent)&&void 0!==a&&a.active&&(e=t.batchNode[n.name],n.setParent(e,!0),n.layer=Z.Enum.UI_2D)}))}},{key:"restoreOriginalChildren",value:function(){var e=this,t=[].concat(We(this.labelChildren),We(this.spriteChildren));t.length>0&&t.forEach((function(t){var n=e.originalParents[t.uuid];n&&t.node.setParent(n,!0)})),this.nameChildren.forEach((function(t){var n=e.originalParents[t.uuid];n&&t.setParent(n,!0)}))}}]),n}(f)).prototype,"batchByName",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Jo=Qe(Yo.prototype,"depthNames",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qo=Qe(Yo.prototype,"listName",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Zo=Qe(Yo.prototype,"batchLabel",[Go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$o=Qe(Yo.prototype,"depthLabel",[zo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),es=Qe(Yo.prototype,"typeLabel",[Uo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),ts=Qe(Yo.prototype,"batchSprite",[Ho],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ns=Qe(Yo.prototype,"depthSprite",[qo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),as=Qe(Yo.prototype,"batchAllNodes",[Vo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),is=Qe(Yo.prototype,"batchDepth",[Wo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rs=Qe(Yo.prototype,"checkOverlap",[Ko],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jo=Yo))||jo)||jo);n._RF.pop(),n._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var ms=a.ccclass,gs=GameCore.Utils,bs=globalThis.game.player,ws=ms("Vibrate")(us=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"vibrate",value:function(e){if(this.isVibrateEnable()&&!gs.Browser.vibrate(e)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!bs.getPlayerSetting("vibrate")}}]),n}(f))||us;n._RF.pop(),n._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);var ks=1/6;n._RF.pop(),n._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);var Ss,Cs={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};n._RF.pop(),n._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var Es=10,As=50,Ts=100,xs=(Ie(Ss={},Cs.HINT,80),Ie(Ss,Cs.THUNDER,200),Ie(Ss,Cs.STORM,150),Ie(Ss,Cs.PLIERS,150),Ss),Rs=200,Ps=40;n._RF.pop(),n._RF.push({},"63645sZ1tlEZL2530kj5xkt","CollectionSceneEvents",void 0),n._RF.pop(),n._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var Is={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};n._RF.pop(),n._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var _s="STARS_UPDATED",Ls="PLAY_BUTTON_PRESS",Os="REQUEST_NAVIGATION",Ds="REQUEST_NAVIGATION_ANIMATION",Ms="GAME_SCENE_RESOURCES_LOADED",Ns="DASHBOARD_EVENTS_BUTTON_PRESS";n._RF.pop(),n._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var Fs=function(e){return e[e.store=0]="store",e[e.collections=1]="collections",e[e.home=2]="home",e[e.leaderboard=3]="leaderboard",e[e.tournaments=4]="tournaments",e}(Fs||{});N(Fs),n._RF.pop(),n._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);var Bs=ke(ke({},GameCore.Dtos.Match.Data.getDefaultData()),{},{extraData:null});n._RF.pop(),n._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var Gs=function(e){return e.UNLOCK_DEV_TOOLS="unlock-dev-tools",e.TRIGGER_UNLOCK_KEY="trigger-unlock-key",e.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",e}(Gs||{}),zs={Events:Gs,UNLOCK_SEQUENCE:"101013012031"};n._RF.pop(),n._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);var Us;n._RF.pop(),n._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);var Hs={level:0,coins:0,stars:0,totalLevel:80,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:(Us={},Ie(Us,Cs.HINT,0),Ie(Us,Cs.THUNDER,0),Ie(Us,Cs.STORM,0),Ie(Us,Cs.PLIERS,0),Us),skins:{}};n._RF.pop(),n._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);var qs="global-leaderboard-key",Vs="friends-leaderboard-key",Ws="global-leaderboard-id",Ks="friends-leaderboard-id";n._RF.pop(),n._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);var js=ke(ke({},GameCore.Dtos.Match.CustomData.getDefaultData()),{},{score:0});n._RF.pop(),n._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);var Ys={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:Hs,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};n._RF.pop(),n._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);var Xs="BootScene",Js="LoadScene",Qs="GameScene",Zs="DashboardScene",$s="ChallengeResultScene",el="TestScene";n._RF.pop(),n._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var tl=function(e){return e.RELOAD_TOURNAMENT="reload-tournament",e}(tl||{});n._RF.pop(),n._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);var nl=GameCore,al=nl.Configs,il=nl.Utils.Object,rl=al.FrameCapture,ol=rl.Enabled,sl=rl.WideframeConfigs,ll=function(){var e=Te(Se().mark((function e(t){var n,a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ol){e.next=3;break}return console.warn("FrameCapture is not enabled"),e.abrupt("return",null);case 3:if(n=cl(t)){e.next=6;break}return e.abrupt("return",null);case 6:return ul(n,sl.CustomResultChallenge),a=window.game.frameCapture,i=sl.CustomResultChallenge,r=i.Width,o=i.Height,e.abrupt("return",a.captureAsync({name:"CustomResultChallenge",width:r,height:o,renderOptions:n}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ul=function(e,t){var n=t.Width,a=t.Height,i=t.Wideframe;e.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:i,size:[n,a],position:[0,0]}},cl=function(e){try{var t=e.playerId,n=void 0===t?"10":t,a=e.playerPhoto,i=void 0===a?"":a,r=e.playerScore,o=void 0===r?0:r,s=e.opponentId,l=void 0===s?"20":s,u=e.opponentPhoto,c=void 0===u?"":u,h=e.opponentScore,p=void 0===h?0:h,d=e.isPlayerFinished,f=e.isOpponentFinished,v=sl.CustomResultChallenge.RenderOptions,y=il.camelCaseKeys(il.clone(v)),m=y.playerPhoto,g=y.opponentPhoto,b=o===p,w=o>p,k=null!=d?d:f,S=d&&f;return"image"===m.type&&(m.name="".concat(n),m.image=i),"image"===g.type&&(g.name="".concat(l),g.image=c),k&&hl(y,{playerScore:o,opponentScore:p,isPlayerFinished:d,isOpponentFinished:f}),!S||b?(delete y.leftCrown,delete y.rightCrown,y):(w?delete y.rightCrown:delete y.leftCrown,y)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},hl=function(e,t){var n=e.leftScore,a=e.rightScore,i=t.playerScore,r=void 0===i?0:i,o=t.opponentScore,s=void 0===o?0:o,l=t.isPlayerFinished,u=t.isOpponentFinished;"text"===n.type&&(n.text=l?"".concat(r):"???"),"text"===a.type&&(a.text=u?"".concat(s):"???")};n._RF.pop(),n._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var pl=function(e){_e(n,e);var t=Ge(n);function n(e,a){var i;return xe(this,n),(i=t.call(this,a)).code=e,i}return Pe(n)}(Ne(Error));n._RF.pop(),n._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var dl=function(e){_e(n,e);var t=Ge(n);function n(e,a){var i;return xe(this,n),(i=t.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=e,i.tournamentId=a,i}return Pe(n)}(pl);n._RF.pop(),n._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var fl={themeNames:["summer","autumn","winter"],skinNames:["cakes","car","cosmetics","flower","fruit","ice-cream","sport","tool"],mapOrder:[{id:1,theme:"summer",skin:"fruit",levelCount:10},{id:2,theme:"autumn",skin:"flower",levelCount:10},{id:3,theme:"winter",skin:"tool",levelCount:10},{id:4,theme:"summer",skin:"sport",levelCount:10},{id:5,theme:"autumn",skin:"cosmetics",levelCount:10},{id:6,theme:"winter",skin:"ice-cream",levelCount:10},{id:7,theme:"summer",skin:"cakes",levelCount:10},{id:8,theme:"autumn",skin:"car",levelCount:10}]};n._RF.pop(),n._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);var vl="cakes",yl="flower",ml="fruit";n._RF.pop(),n._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);var gl={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter"};N(gl),n._RF.pop(),n._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var bl={currentProgress:0,maxProgress:10,isLocked:!0,themeId:"summer"},wl={id:0,currentSkin:vl,currentTheme:gl.SUMMER,nextSkin:null,nextTheme:null,progress:0,max:10},kl={skin:"cakes",themeId:"summer",progress:0,max:10,isLocked:!0},Sl=globalThis.game.storage,Cl=function(){function e(){xe(this,e),this.mapData=fl,this.playerSkinProgress=null}return Pe(e,[{key:"initDashboardSceneStorage",value:function(){var e=Sl.getStorage("dashboard");if(null==e){var t=this.getCurrentMapProgressInstance();Sl.addStorage("dashboard",{lastMapPayload:t,numOfMapsPassed:0,animateToCurrentLevel:!1});var n=Sl.getStorage("collection");if(null==n){Sl.addStorage("collection",{lastMapPack:t.id,animateMapPackUnlock:!1});var a=Sl.getStorage("leaderboard_content");if(null==a){Sl.addStorage("leaderboard_content",{lastTabOpened:"global"});var i=Sl.getStorage("tournament");null==i&&Sl.addStorage("tournament",{animateTournamentLeader:!1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),wl;for(var e=this.mapData.mapOrder,t=void 0,n=void 0,a=void 0,i=void 0,r=0,o=0,s=0,l=0;l<e.length;l++){var u=this.playerSkinProgress[e[l].skin];if(u.currentProgress<u.maxProgress){var c,h,p,d;s=e[l].id,t=e[l].skin,n=e[l].theme,a=null!==(c=null===(h=e[l+1])||void 0===h?void 0:h.skin)&&void 0!==c?c:t,i=null!==(p=null===(d=e[l+1])||void 0===d?void 0:d.theme)&&void 0!==p?p:n,r=u.currentProgress,o=u.maxProgress;break}}if(void 0===t||void 0===a||void 0===n||void 0===i){var f=e[e.length-1];return s=f.id,t=f.skin,n=f.theme,a=f.skin,i=f.theme,r=f.levelCount,o=f.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:s,currentSkin:t,currentTheme:n,nextSkin:a,nextTheme:i,progress:r,max:o}}return console.log("getMapCurrentProgress",t,a,r,o),{id:s,currentSkin:t,currentTheme:n,nextSkin:a,nextTheme:i,progress:r,max:o}}},{key:"getUnlockedSkinsInstance",value:function(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];for(var e=[],t=0,n=Object.keys(this.playerSkinProgress);t<n.length;t++){var a=n[t];this.playerSkinProgress[a].isLocked||e.push(a)}return console.log("getUnlockedSkins",e),e}},{key:"getLevelSkinInstance",value:function(e){var t,n=null!=e?e:1,a=this.mapData.mapOrder,i=0,r=Ye(a);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(i+o.levelCount>=n)return console.log("getMapSkin",o.skin),o.skin;i+=o.levelCount}}catch(e){r.e(e)}finally{r.f()}var s=a[a.length-1];return console.log("getMapSkin",s.skin),s.skin}},{key:"getLevelThemeInstance",value:function(e){var t,n=null!=e?e:1,a=this.mapData.mapOrder,i=0,r=Ye(a);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(i+o.levelCount>=n)return console.log("getMapTheme",o.theme),o.theme;i+=o.levelCount}}catch(e){r.e(e)}finally{r.f()}var s=a[a.length-1];return console.log("getMapTheme",s.theme),s.theme}},{key:"getCollectionUnlockProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[kl];for(var e=[],t=0,n=Object.entries(this.playerSkinProgress);t<n.length;t++){var a=n[t],i=a[1],r=i.currentProgress,o=i.maxProgress,s=i.isLocked,l=i.themeId;e.push({progress:r,max:o,isLocked:s,skin:a[0],themeId:l})}return e}},{key:"updatePlayerSkinProgress",value:function(){var e=globalThis.game.player.getGameData();if(null!=e&&e.skins&&Object.keys(e.skins).length>0){this.playerSkinProgress={};for(var t=0,n=Object.keys(e.skins);t<n.length;t++){var a=n[t];this.playerSkinProgress[a]=ke(ke({},bl),e.skins[a])}}else{console.log("getPlayerSkinProgress: playerData not found, use data from level");var i=this.mapData.mapOrder;this.playerSkinProgress={};var r,o=Ye(i);try{for(o.s();!(r=o.n()).done;){var s=r.value;this.playerSkinProgress[s.skin]={themeId:s.theme,currentProgress:0,maxProgress:s.levelCount,isLocked:!0}}}catch(e){o.e(e)}finally{o.f()}this.updatePlayerSkinProgressByLevel(),console.log(this.playerSkinProgress)}}},{key:"updatePlayerSkinProgressByLevel",value:function(){var e,t=globalThis.game.player.getGameData(),n=(null!==(e=null==t?void 0:t.level)&&void 0!==e?e:1)-1,a=this.mapData.mapOrder;this.playerSkinProgress[a[0].skin].isLocked=!1;var i,r=Ye(a);try{for(r.s();!(i=r.n()).done;){var o=i.value,s=o.levelCount,l=o.skin;if(!(n<=0)){var u=n-s>=0?s:n;n-=u,console.log("getPlayerSkinProgressByLevel",l,u),this.increaseProgressInstance(l,u,!1)}}}catch(e){r.e(e)}finally{r.f()}}},{key:"increaseProgressInstance",value:function(e,t,n){if(null!==this.playerSkinProgress)if(this.playerSkinProgress[e]){var a=this.playerSkinProgress[e],i=a.currentProgress,r=a.maxProgress,o=i+t>r?r:i+t;if(o>0&&(this.playerSkinProgress[e].isLocked=!1),o===r){var s,l=this.mapData.mapOrder,u=l.findIndex((function(t){return t.skin===e})),c=null===(s=l[u+1])||void 0===s?void 0:s.skin;c&&this.unlockSkinInstance(c,!1)}this.playerSkinProgress[e].currentProgress=o,this.playerSkinProgress[e].maxProgress=r,n&&this.syncPlayerSkinProgress()}else console.warn("increaseProgress: skin not found",e);else console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?")}},{key:"unlockSkinInstance",value:function(e,t){null!==this.playerSkinProgress?this.playerSkinProgress[e]?(this.playerSkinProgress[e].isLocked=!1,t&&this.syncPlayerSkinProgress()):console.warn("unlockSkin: skin not found",e):console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}},{key:"syncPlayerSkinProgress",value:function(){var e=globalThis.game.player.getGameData();globalThis.game.player.setGameData(ke(ke({},e),{},{skins:this.playerSkinProgress}))}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var e=this.getInstance();e.updatePlayerSkinProgress(),e.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkin",value:function(e){return this.getInstance().getLevelSkinInstance(e)}},{key:"getLevelTheme",value:function(e){return this.getInstance().getLevelThemeInstance(e)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"increaseProgress",value:function(e,t,n){this.getInstance().increaseProgressInstance(e,t,n)}},{key:"unlockSkin",value:function(e,t){this.getInstance().unlockSkinInstance(e,t)}}]),e}();n._RF.pop(),n._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var El=globalThis.game,Al=El.match,Tl=El.player,xl=El.leaderboard,Rl=El.frameCapture,Pl=GameCore.Utils,Il=Pl.Object,_l=Pl.Valid,Ll=GameCore.Match.Modes,Ol=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],Dl=function(){function e(){xe(this,e)}var t,n,a,i,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b;return Pe(e,[{key:"processStartSingleModeAsync",value:(b=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Tl.getPlayerId(),e.next=3,Al.single.start.processAsync({playerId:t});case 3:case"end":return e.stop()}}),e)}))),function(){return b.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(g=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Al.single.finish.processAsync();case 2:case"end":return e.stop()}}),e)}))),function(){return g.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(m=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Tl.getPlayerId(),n=GameSDK.context.getID(),e.next=4,Al.tournament.continue.processAsync({playerId:t,contextId:n});case 4:case"end":return e.stop()}}),e)}))),function(){return m.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(y=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Tl.getPlayerId(),n=Tl.getBestScore(),e.next=4,Al.tournament.finish.processAsync({playerId:t,bestScore:n});case 4:case"end":return e.stop()}}),e)}))),function(){return y.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(v=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.processContinueChallengeAsync();case 3:e.next=15;break;case 5:if(e.prev=5,e.t0=e.catch(0),Il.hasOwn(e.t0,"name")&&!_l.isString(e.t0.name)){e.next=9;break}throw e.t0;case 9:if("PlayerHasFinishedMatch"!==e.t0.name){e.next=12;break}return e.next=12,this.processChallengeNewOpponentAsync();case 12:if("PlayerNotJoinInMatch"!==e.t0.name){e.next=15;break}return e.next=15,this.processJoinChallengeAsync();case 15:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return v.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(f=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Rl.addWideframeRender("renderResultChallenge",Rl.wideframe.renderResultChallenge),e.next=3,Al.challenge.finish.processAsync(t);case 3:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(d=Te(Se().mark((function e(){var t,n,a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getMatchState(),n=t.id,a=t.customData,i=a.playerId,r=a.opponentId,_l.isString(n)){e.next=4;break}throw new Error("Invalid match id");case 4:if(_l.isString(i)){e.next=6;break}throw new Error("Invalid player id");case 6:if(_l.isString(r)){e.next=8;break}throw new Error("Invalid opponent id");case 8:if(o=GameSDK.context.getID()){e.next=11;break}throw new Error("Cannot get contextId");case 11:return e.next=13,Al.challenge.continue.processAsync({matchId:n,contextId:o,playerId:i,opponentId:r});case 13:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(p=Te(Se().mark((function e(){var t,n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Tl.getConnectedPlayerIds(100,0),n=Math.floor(Math.random()*t.length),a=Tl.getPlayerId(),i=t[n],e.next=6,Al.challenge.friend.processAsync({playerId:a,opponentId:i});case 6:case"end":return e.stop()}}),e)}))),function(){return p.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(h=Te(Se().mark((function e(){var t,n,a,i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getMatchState(),n=t.id,a=t.customData,i=a.playerId,r=a.opponentId,_l.isString(n)){e.next=4;break}throw new Error("Invalid match id");case 4:if(_l.isString(i)){e.next=6;break}throw new Error("Invalid player id");case 6:if(_l.isString(r)){e.next=8;break}throw new Error("Invalid opponent id");case 8:return e.next=10,Al.challenge.join.processAsync({matchId:n,playerId:i,opponentId:r});case 10:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"getMatchState",value:function(){var e=Al.getMatchState();if(!e)throw new Error("Match state not found");return e}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(c=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=null!=t?t:this.getMatchMode(),e.t0=n,e.next=e.t0===Ll.SINGLE?5:e.t0===Ll.TOURNAMENT?8:e.t0===Ll.CHALLENGE_FRIEND?11:14;break;case 5:return e.next=7,this.inst.processStartSingleModeAsync();case 7:return e.abrupt("break",16);case 8:return e.next=10,this.inst.processStartTournamentModeAsync();case 10:return e.abrupt("break",16);case 11:return e.next=13,this.inst.processStartChallengeModeAsync();case 13:return e.abrupt("break",16);case 14:return e.next=16,this.inst.processStartSingleModeAsync();case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.warn("startMatchAsync",e.t1);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e){return c.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(u=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Al.handler.setProfileData(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setProfileMatchDataAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return u.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(l=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Al.handler.setMatchCustomData(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setMatchCustomDataAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return l.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(s=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Al.handler.setLeaderboardScore(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setLeaderboardScoreAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return s.apply(this,arguments)})},{key:"finishMatchAsync",value:(o=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=this.getMatchMode(),e.t0=n,e.next=e.t0===Ll.SINGLE?5:e.t0===Ll.TOURNAMENT?8:e.t0===Ll.CHALLENGE_FRIEND?11:14;break;case 5:return e.next=7,this.inst.processFinishSingleModeAsync();case 7:return e.abrupt("break",16);case 8:return e.next=10,this.inst.processFinishTournamentModeAsync();case 10:return e.abrupt("break",16);case 11:return e.next=13,this.inst.processFinishChallengeModeAsync(t);case 13:return e.abrupt("break",16);case 14:return e.next=16,this.inst.processFinishSingleModeAsync();case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.warn("finishMatchAsync",e.t1);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e){return o.apply(this,arguments)})},{key:"joinTournamentAsync",value:(r=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Tl.getPlayerId(),e.next=3,Al.tournament.join.processAsync({tournamentId:t,playerId:n});case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"continueTournamentAsync",value:(i=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Tl.getPlayerId(),e.next=3,Al.tournament.continue.processAsync({playerId:n,contextId:t});case 3:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"createTournamentName",value:function(){var e=Ol[G.randomRangeInt(0,Ol.length-1)],t="".concat(e," Tournament"),n=GameCore.Utils.String.removeDiacritics(t);return"".concat(n)}},{key:"getShortName",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,a=e.split(" "),i=0,r="",o=Ye(a);try{for(o.s();!(t=o.n()).done;){var s=t.value;if(i+s.length+1>n)break;r+="".concat(s," "),i+=s.length+1}}catch(e){o.e(e)}finally{o.f()}return r.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var e,t,n,a=GameCore.Utils.String.generateObjectId(),i=Tl.getPlayerId(),r=Tl.getPlayer().name,o=Tl.getGameData(),s=null!==(e=null==o?void 0:o.level)&&void 0!==e?e:1,l=Cl.getLevelTheme(s),u=this.inst.getMatchState().profiles;return{score:null!==(t=null===(n=(void 0===u?{}:u)[i])||void 0===n?void 0:n.score)&&void 0!==t?t:0,playerId:i,mode:Ll.TOURNAMENT,name:this.createTournamentName(),leaderboardId:a,payload:{playerId:i,playerName:r,leaderboardId:a,themeId:l}}}},{key:"getTournamentsAsync",value:(a=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameSDK.tournament.getTournamentsAsync();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e,null,[[0,6]])}))),function(){return a.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(n=Te(Se().mark((function e(){var t,n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTournamentsAsync();case 2:if(t=e.sent,!(n=t.find((function(e){var t,n=JSON.parse(null!==(t=e.getPayload())&&void 0!==t?t:"{}");return"DEFAULT"===e.getTournamentType()&&n.playerId===Tl.getPlayerId()})))){e.next=6;break}throw new dl(Tl.getPlayerId(),n.getID());case 6:return a=this.createTournamentPayload(),Tl.setGameData({lastCreateTournamentShown:Date.now()}),e.next=10,Al.tournament.create.processAsync(a);case 10:i=a.leaderboardId,xl.addLeaderboard({name:i,type:"tournament",autoSortRank:!0,leaderboardId:i});case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getMatchMode",value:function(){var e=this.inst.getMatchState();return _l.isString(e.mode)?e.mode:null}},{key:"getMatchCustomData",value:function(){var e=this.inst.getMatchState();return _l.isObject(e.customData)?e.customData:null}},{key:"getMatchExtraDataAsync",value:(t=Te(Se().mark((function e(t){var n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Al.api.getMatchAPI().getMatchDetailByIdAsync(t);case 2:return n=e.sent,a=new GameCore.Dtos.Match.Data(n).toObject(),i=a.extraData,e.abrupt("return",i);case 6:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(e,t){this.setMatchCustomDataAsync({level:e,score:t});var n=Tl.getPlayerId();this.setProfileMatchDataAsync({id:n,score:t})}}]),e}();try{new Dl}catch(e){console.error("MatchUtils",e)}n._RF.pop(),n._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);var Ml,Nl,Fl,Bl,Gl,zl,Ul,Hl=globalThis.game.event,ql=GameCore.Events,Vl=function(){function e(){xe(this,e)}return Pe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"switchScene",value:function(e,t){Hl.emit(ql.SWITCH_SCENE,{sceneName:e,sceneData:t})}},{key:"preloadScene",value:function(e){Hl.emit(ql.PRELOAD_SCENE,{sceneName:e})}},{key:"preloadDashboardScene",value:function(){this.preloadScene(Zs)}},{key:"switchToDashboardScene",value:function(e){this.switchScene(Zs,e)}},{key:"preloadGameScene",value:function(){this.preloadScene(Qs)}},{key:"switchToGameScene",value:function(e){this.switchScene(Qs,e)}},{key:"getSceneData",value:function(e){return"data"in e.scene&&e.scene.data||{}}}]),e}();try{new Vl}catch(e){console.error("SceneUtils",e)}n._RF.pop(),n._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);var Wl,Kl,jl,Yl,Xl,Jl=a.ccclass,Ql=a.property,Zl=(Ml=Jl("LoadingFullScreen"),Nl=Ql(Y),Fl=Ql(u),Ml((zl=Qe((Gl=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"progressBar",zl,Fe(e)),Je(e,"loadingText",Ul,Fe(e)),e}return Pe(i,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"runLoadingTextAnimation",value:function(){var e=this,t=0;this.schedule((function(){t=t>2?0:t+1,e.loadingText.string="Loading"+".".repeat(t)}),.5)}},{key:"stopLoadingTextAnimation",value:function(){this.unscheduleAllCallbacks()}},{key:"show",value:(n=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=0,this.progressBar.progress=0,t=S(this.uiOpacity).to(.2,{opacity:255},{easing:"cubicOut"}),n=S(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"}),this.runLoadingTextAnimation(),mn.runTweenAsync(t),e.next=8,mn.runTweenAsync(n);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.uiOpacity&&this.progressBar){e.next=2;break}return e.abrupt("return");case 2:return this.uiOpacity.opacity=255,this.progressBar.progress=.9,t=S(this.uiOpacity).to(.15,{opacity:0},{easing:"cubicIn"}),n=S(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"}),this.runLoadingTextAnimation(),e.next=9,mn.runTweenAsync(n);case 9:return this.stopLoadingTextAnimation(),e.next=12,mn.runTweenAsync(t);case 12:this.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"progressBar",[Nl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ul=Qe(Gl.prototype,"loadingText",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bl=Gl))||Bl);n._RF.pop(),n._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);var $l=a.ccclass,eu=a.property,tu=(Wl=$l("Loading"),Kl=eu(P),Wl((Xl=Qe((Yl=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"loadingPrefab",Xl,Fe(e)),e.loadingNode=null,e}return Pe(i,[{key:"onLoad",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"createLoadingFullScreen",value:function(){var e,t=R("Canvas");if(t&&!t.getChildByName("Loading")){this.loadingNode||(this.loadingNode=l(this.loadingPrefab));var n=l._clone(this.loadingNode);this.loadingFullScreen=n.getComponent(Zl),this.node.active=!1,null===(e=R("Canvas"))||void 0===e||e.addChild(n)}}},{key:"show",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.createLoadingFullScreen(),!this.node.active){e.next=3;break}return e.abrupt("return");case 3:return this.node.active=!0,e.next=6,this.loadingFullScreen.show();case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=this.node)&&void 0!==t&&t.active){e.next=2;break}return e.abrupt("return");case 2:if(this.loadingFullScreen){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.loadingFullScreen.hide();case 6:this.node.active=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"loadingPrefab",[Kl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jl=Yl))||jl);n._RF.pop(),n._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);var nu=globalThis.game.event,au=GameCore.Events,iu=function(){function e(){xe(this,e),this.showedScreens=[]}var t,n;return Pe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"openScreen",value:function(e,t){nu.emit(au.OPEN_SCREEN,{screenName:e,screenData:t})}},{key:"closeScreen",value:function(e){nu.emit(au.CLOSE_SCREEN,{screenName:e})}},{key:"showLoadingScreen",value:function(e){this.openScreen(aa,{duration:e})}},{key:"closeLoadingScreen",value:function(){this.closeScreen(aa)}},{key:"showNotificationScreen",value:function(e,t){this.openScreen(la,{message:e,duration:t})}},{key:"closeNotificationScreen",value:function(){this.closeScreen(la)}},{key:"showLoadingFullScreen",value:(n=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.inst.showedScreens.includes(t)){e.next=2;break}return e.abrupt("return");case 2:return this.inst.showedScreens.push(t),e.next=5,null===(n=R("Loading"))||void 0===n?void 0:n.getComponent(tu).show();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"hideLoadingFullScreen",value:(t=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.inst.showedScreens.includes(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,null===(n=R("Loading"))||void 0===n?void 0:n.getComponent(tu).hide();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"showLoadingNotificationScreen",value:function(){this.openScreen(la,{message:"Loading",enableCloseOnTouch:!1})}},{key:"showTournamentDetailScreen",value:function(e,t){this.openScreen(pa,{tournament:e,tournamentContextType:t})}},{key:"closeTournamentDetailScreen",value:function(){this.closeScreen(pa)}}]),e}();try{new iu}catch(e){console.error("ScreenUtils",e)}n._RF.pop(),n._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var ru,ou="time",su="bomb";n._RF.pop(),n._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var lu=(0,a.ccclass)("InputController")(ru=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).pointerDownOutSideCanvas=!1,e.handleElementPointerDown=function(){e.pointerDownOutSideCanvas=!0},e.handleElementPointerUp=function(t){e.pointerDownOutSideCanvas=!1},e}return Pe(n,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){K.os!==K.OS.WINDOWS&&K.os!==K.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){K.os!==K.OS.WINDOWS&&K.os!==K.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(f))||ru;n._RF.pop(),n._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var uu={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};n._RF.pop(),n._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var cu="fall-down",hu="fly-up",pu="push-left",du="push-right",fu="put-column-middle",vu="put-row-middle";function yu(e){for(var t=e.array,n=e.isLighter,a=e.out,i=void 0===a?new Set:a,r=0;r<t.length;r++)if(n(t.get(r)))for(var o=r+1;o<t.length;o++)if(!n(t.get(o))){t.swap(r,o),i.add(t.get(r));break}return i}n._RF.pop(),n._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var mu=function(){function e(t){var n;xe(this,e),this.array=[];var a=null!=t?t:{},i=a.width,r=void 0===i?1:i,o=a.height,s=void 0===o?1:o,l=t instanceof e?t.array:null!==(n=null==t?void 0:t.content)&&void 0!==n?n:[];if(l.length!==r*s)throw new Error("Invalid content length");this.width=r,this.height=s,this.array=Array.from(l)}return Pe(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(e,t){return this.array[t*this.width+e]}},{key:"set",value:function(e,t,n){this.array[t*this.width+e]=n}},{key:"isInBounds",value:function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}},{key:"forEach",value:function(e){for(var t=0;t<this.height;t++)for(var n=0;n<this.width;n++)e(this.get(n,t),n,t)}},{key:"map",value:function(e){for(var t=[],n=0;n<this.height;n++)for(var a=0;a<this.width;a++)t.push(e(this.get(a,n),a,n));return t}},{key:"reduce",value:function(e,t){for(var n=t,a=0;a<this.height;a++)for(var i=0;i<this.width;i++)n=e(n,this.get(i,a),i,a);return n}},{key:"swap",value:function(e,t){var n=Ve(e,2),a=n[0],i=n[1],r=Ve(t,2),o=r[0],s=r[1],l=this.get(a,i);this.set(a,i,this.get(o,s)),this.set(o,s,l)}},{key:"shuffle",value:function(e){for(var t,n=We(e=null!==(t=e)&&void 0!==t?t:this.map((function(e,t,n){return[t,n]}))),a=new Set,i=n.length-1;i>0;i--){var r=$(0,i+1),o=[n[r],n[i]];n[i]=o[0],n[r]=o[1],a.add(this.get(n[i][0],n[i][1])),a.add(this.get(n[r][0],n[r][1]))}for(var s=0;s<n.length;s++){var l=Ve(e[s],2),u=l[0],c=l[1],h=Ve(n[s],2),p=h[0],d=h[1];this.swap([u,c],[p,d])}return a}},{key:"toShuffled",value:function(t){var n=new e({width:this.width,height:this.height,content:this.array}),a=n.shuffle(t);return[n,a]}},{key:"gravitate",value:function(e){var t=this,n=Ve(e.rowRange,2),a=n[0],i=n[1],r=Ve(e.colRange,2),o=r[0],s=r[1],l=e.direction,u=e.isLighter,c=e.onSwap,h=e.out,p=void 0===h?new Set:h,d=s-o+1,f=i-a+1;switch(l){case uu.Up:for(var v=function(e){yu({array:{length:f,get:function(n){return t.get(e,i-n)},swap:function(n,a){var r=t.get(e,i-n),o=t.get(e,i-a);t.swap([e,i-n],[e,i-a]),null==c||c(r,o)}},isLighter:u,out:p})},y=o;y<=s;y++)v(y);return p;case uu.Down:for(var m=function(e){yu({array:{length:f,get:function(n){return t.get(e,a+n)},swap:function(n,i){var r=t.get(e,a+n),o=t.get(e,a+i);t.swap([e,a+n],[e,a+i]),null==c||c(r,o)}},isLighter:u,out:p})},g=o;g<=s;g++)m(g);return p;case uu.Left:for(var b=function(e){yu({array:{length:d,get:function(n){return t.get(o+n,e)},swap:function(n,a){var i=t.get(o+n,e),r=t.get(o+a,e);t.swap([o+n,e],[o+a,e]),null==c||c(i,r)}},isLighter:u,out:p})},w=a;w<=i;w++)b(w);return p;case uu.Right:for(var k=function(e){yu({array:{length:d,get:function(n){return t.get(s-n,e)},swap:function(n,a){var i=t.get(s-n,e),r=t.get(s-a,e);t.swap([s-n,e],[s-a,e]),null==c||c(i,r)}},isLighter:u,out:p})},S=a;S<=i;S++)k(S);return p;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var t=new e({width:this.width,height:this.height,content:this.array}),n=t.gravitate.apply(t,arguments);return[t,n]}}]),e}();n._RF.pop(),n._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),n._RF.pop(),n._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);var gu,bu,wu,ku,Su,Cu,Eu,Au,Tu,xu,Ru,Pu,Iu,_u,Lu,Ou,Du,Mu,Nu,Fu,Bu,Gu,zu,Uu,Hu,qu={bomb:"bomb",star:"star",none:"none"};n._RF.pop(),n._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var Vu=a.ccclass,Wu=a.property,Ku=a.requireComponent,ju=(gu=Vu("Tile"),bu=Ku([s]),wu=Ku([M]),ku=Wu(T),Su=Wu(T),Cu=Wu(T),Eu=Wu(i),Au=Wu({type:s,displayName:"Background's UI Transform"}),Tu=Wu({type:M,displayName:"This UI Opacity"}),xu=Wu(M),Ru=Wu(M),Pu=Wu(ii),Iu=Wu(y),gu(_u=bu(_u=wu((Ou=Qe((Lu=function(e){_e(h,e);var t,n,a,i,r,o,s,l,u,c=Ge(h);function h(){var e;xe(this,h);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=c.call.apply(c,[this].concat(n)),"icon",Ou,Fe(e)),Je(e,"bombComponent",Du,Fe(e)),Je(e,"starComponent",Mu,Fe(e)),Je(e,"background",Nu,Fe(e)),Je(e,"bgUITransform",Fu,Fe(e)),Je(e,"uiOpacity",Bu,Fe(e)),Je(e,"shineOpacity",Gu,Fe(e)),Je(e,"glowOpacity",zu,Fe(e)),Je(e,"button",Uu,Fe(e)),Je(e,"animationComponent",Hu,Fe(e)),e.id=null,e.isEmpty=!1,e.coord=new J,e.restoreSignal=new ui,e}return Pe(h,[{key:"onLoad",value:function(){Ct.lazyValidateProperties(this),this.special=this.createSpecialHandler(qu.none)}},{key:"update",value:function(e){var t;(null===(t=this.special)||void 0===t?void 0:t.type)===qu.bomb&&this.special.update(e)}},{key:"onDestroy",value:function(){var e,t;(null===(e=this.special)||void 0===e?void 0:e.type)===qu.bomb&&(null===(t=this.special)||void 0===t||t.onDestroy())}},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.button.interactable=!e}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(e,t){this.coord.set(e,t)}},{key:"isSimilarTo",value:function(e){return this.id===e.id}},{key:"inSamePositionAs",value:function(e,t){return e instanceof h?this.coord.equals(e.getCoord()):this.coord.x===e&&this.coord.y===t}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit($i.TILE_CLICK,this)}},{key:"setIdentity",value:function(e){this.id=e,this.icon.spriteFrame=e;var t=Ve(this.getSize(),2),n=t[0],a=t[1],i=e.originalSize,r=i.width,o=i.height,s=Math.max(r/(.7*n),o/(.7*a));s>1&&this.icon.node.setScale(new j(1/s,1/s,1))}},{key:"setSpecialType",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:qu.none,n=arguments.length>1?arguments[1]:void 0;null===(e=this.special)||void 0===e||e.switch(t,n)}},{key:"setFocused",value:(u=Te(Se().mark((function e(t){var n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=S(this.shineOpacity).to(.2,{opacity:t?255:0},{easing:"quadIn"}),this.shineOpacity.node.scale=t?j.ZERO:j.ONE,a=S(this.shineOpacity.node).to(.2,{scale:t?j.ONE:j.ZERO},{easing:"quadOut"}),t?((i=S(this.glowOpacity).to(2,{opacity:150})).to(2,{opacity:20}),this.glowOpacityTween=S(this.glowOpacity).repeatForever(i).start()):(this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0),e.next=6,Promise.all([mn.runTweenAsync(n),mn.runTweenAsync(a)]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"setEmpty",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty){var a;if(this.restoreSignal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),n)return this.uiOpacity.opacity=0,void(null===(a=this.special)||void 0===a||a.switch(qu.none));(null===(e=this.special)||void 0===e?void 0:e.type)===qu.star&&this.special.clear(),null===(t=this.special)||void 0===t||t.switch(qu.none),this.uiOpacity.opacity=0}}},{key:"setHint",value:(l=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,this.loadShakeClip();case 3:this.shakeClip&&this.runAnimation(this.shakeClip.name),e.next=10;break;case 6:return this.animationComponent.stop(),n=S(this.background).to(.1,{scale:j.ONE,eulerAngles:j.ZERO}),e.next=10,mn.runTweenAsync(n);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"playClearFX",value:(s=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,"clear"!==t){e.next=7;break}return e.next=4,this.loadClearClip();case 4:n=this.clearClip,e.next=10;break;case 7:return e.next=9,this.loadBreakClip();case 9:n=this.breakClip;case 10:if(null===n){e.next=13;break}return e.next=13,this.runAnimation(n.name);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"restore",value:(o=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.restoreSignal.abort(),this.restoreSignal=new ui,this.isEmpty=!1,this.setIgnoreInput(!0),t&&this.setIdentity(t),this.uiOpacity.opacity=255,this.node.setScale(j.ZERO),this.button.fakeClick(),e.next=10,mn.runTweenAsync(S(this.node).to(.3,{scale:j.ONE},{easing:"backOut"}),this.restoreSignal);case 10:this.node.setScale(j.ONE),this.setIgnoreInput(!1);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"sync",value:(r=Te(Se().mark((function e(t){var n,a,i,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.duration,a=void 0===n?.3:n,i=t.delay,r=void 0===i?0:i,o=t.easing,s=void 0===o?"cubicOut":o,l=t.getTargetPosition,u=l(this.coord),c=new j(u.x,u.y,this.node.position.z),e.next=5,mn.runTweenAsync(S(this.node).delay(r).to(a,{position:c},{easing:s}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fly",value:(i=Te(Se().mark((function e(t){var n,a,i,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=300,a=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),i=Math.max(n-.7*a,0),r=a/1e3,o=this.node.position.clone(),s=t.getTilePosition(this.coord),l=new j(s.x,s.y,this.node.position.z),u=this.background,c=2,h=1,p=360,d=.0025*i,f=0,v=new j(0,0,0),y=.75-d,(g=S(m={value:0,prevElapsed:0})).delay(r),g.to(.5,{value:0},{progress:function(e,t,n,a){var i=(c*=-1)*a,r=o.clone();return r.x+=i,b.node.setPosition(r),n}}),g.to(d,{value:1},{progress:function(e,t,a,r){var o=mn.easeOutExpo(r),s=d*r-m.prevElapsed,l=d*r,c=i*o;b.setHeight(c,n);var f=b.node.position.clone();h+=.1,j.rotateZ(f,f,new j(0,0,0),h*Math.PI*s),b.node.setPosition(new j(f.x,f.y,f.z));var v=(p+=10)*s;return u.angle+=v,m.prevElapsed=l,a}}),g.call((function(){v.set((b.node.position.x+l.x)/2,(b.node.position.y+l.y)/2,0),m.prevElapsed=0,u.angle%=360,u.angle-=360,f=u.angle})),g.to(y,{value:0},{progress:function(e,t,a,r){var o=y*r-m.prevElapsed,s=y*r,l=i*(1-r);b.setHeight(l,n);var c=b.node.position.clone();return j.rotateZ(c,c,v,Math.PI/y*o),b.node.setPosition(new j(c.x,c.y,c.z)),u.angle+=-f/y*o,m.prevElapsed=s,a}}),g.call((function(){b.node.setPosition(l),b.setHeight(0,n),u.angle=0})),e.abrupt("return",mn.runTweenAsync(g));case 25:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"loadBreakClip",value:(a=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.breakClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,jn.loadAnimClipAsync(Fn.TILE_BREAK_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.breakClip=t,this.animationComponent.addClip(this.breakClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"loadClearClip",value:(n=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.clearClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,jn.loadAnimClipAsync(Fn.TILE_CLEAR_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.clearClip=t,this.animationComponent.addClip(this.clearClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadShakeClip",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shakeClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,jn.loadAnimClipAsync(Fn.TILE_SHAKE_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.shakeClip=t,this.animationComponent.addClip(this.shakeClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"runAnimation",value:function(e){var t=this;return this.animationComponent.play(e),new Promise((function(e){t.animationComponent.once(y.EventType.FINISHED,(function(){e()}))}))}},{key:"setHeight",value:function(e,t){var n=this.background;n.setPosition(new j(n.position.x,e,0)),n.setScale(new j(1+e/t*.3,1+e/t*.3,1))}},{key:"createSpecialHandler",value:function(e,t){var n=this;switch(e){case qu.bomb:return this.createBombHandler(null!=t?t:90);case qu.star:return this.createStarHandler();default:return{type:qu.none,switch:function(e,t){n.special=n.createSpecialHandler(e,t)}}}}},{key:"createBombHandler",value:function(e){var t=this,n=!1,a=e,i=function(){n=!0},r=function(){n=!1};this.node.scene.on($i.TILE_CLICK,i),this.node.scene.on($i.USE_ITEM,i),this.node.scene.on($i.RESUME_TIME,i),this.node.scene.on($i.PAUSE_TIME,r),this.node.scene.on($i.TIME_OUT,r),this.bombComponent.node.active=!0;var o=function(){n=!1,t.bombComponent.node.active=!1,a=e,t.node.scene.off($i.TILE_CLICK,i),t.node.scene.off($i.USE_ITEM,i),t.node.scene.off($i.GAME_RESUME,i),t.node.scene.off($i.GAME_PAUSE,r),t.node.scene.off($i.TIME_OUT,r)};return{type:qu.bomb,update:function(i){n&&(a-=i,t.bombComponent.fillRange=-a/e,a<=0&&(n=!1,t.bombComponent.node.active=!1,t.node.scene.emit($i.BOMB_EXPLODE,t),t.setEmpty()))},cleanup:o,onDestroy:function(){t.node.scene.off($i.TILE_CLICK,i),t.node.scene.off($i.USE_ITEM,i),t.node.scene.off($i.GAME_RESUME,i),t.node.scene.off($i.GAME_PAUSE,r),t.node.scene.off($i.TIME_OUT,r)},switch:function(e,n){o(),t.special=t.createSpecialHandler(e,n)},detonateImmediately:function(){a=0}}}},{key:"createStarHandler",value:function(){var e=this;this.starComponent.node.active=!0;var t=function(){e.starComponent.node.active=!1};return{type:qu.star,clear:function(){e.starComponent.node.active=!1;var t=e.node.worldPosition,n=t.x,a=t.y;e.node.scene.emit($i.ADD_STARS,{startAnimationAt:[n,a]})},cleanup:t,switch:function(n){t(),e.special=e.createSpecialHandler(n)}}}}]),h}(f)).prototype,"icon",[ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Du=Qe(Lu.prototype,"bombComponent",[Su],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mu=Qe(Lu.prototype,"starComponent",[Cu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nu=Qe(Lu.prototype,"background",[Eu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fu=Qe(Lu.prototype,"bgUITransform",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bu=Qe(Lu.prototype,"uiOpacity",[Tu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gu=Qe(Lu.prototype,"shineOpacity",[xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zu=Qe(Lu.prototype,"glowOpacity",[Ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uu=Qe(Lu.prototype,"button",[Pu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hu=Qe(Lu.prototype,"animationComponent",[Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_u=Lu))||_u)||_u)||_u);function Yu(e,t,n){var a=Ve(e,2),i=a[0],r=a[1],o=Ve(t,2),s=o[0],l=o[1],u=Ve(n,2),c=u[0]/(i*s),h=u[1]/(r*l);return Math.min(c,h)}function Xu(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=n.x,r=n.y,o=Ve(t,2),s=o[0],l=o[1],u=s*(i-(e.width-1)/2)+a*(i-e.width/2),c=l*(r-(e.height-1)/2)+a*(r-e.height/2);return-1===i&&(u+=t[0]/4),i===e.width&&(u-=t[0]/4),-1===r&&(c+=t[1]/4),r===e.height&&(c-=t[1]/4),{x:u,y:c}}function Ju(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],n=Ve(e,2),a=n[0],i=n[1],r=Ve(t,2),o=r[0],s=r[1],l=1-o,u=1-s,c=a*l,h=i*u;return[c,h]}function Qu(e){for(var t=e.split("-"),n=[],a=0;a<t.length;){switch(t[a]){case"normal":a+=1;break;case"fall":n.push(cu),a+=2;break;case"fly":n.push(hu),a+=2;break;case"push":"left"===t[a+1]?(n.push(pu),a+=2):(n.push(du),a+=2);break;case"put":"columns"===t[a+1]?(n.push(fu),a+=3):(n.push(vu),a+=3)}}return n}function Zu(e){return(e instanceof mu?e.asArray():e).filter((function(e){return!e.isHidden()}))}function $u(e){return(e instanceof mu?e.asArray():e).filter((function(e){return e.isHidden()}))}function ec(e,t){var n=t.getCoord(),a=n.x,i=n.y;return Object.values(uu).reduce((function(t,n){var r=n.x,o=n.y,s=a+r,l=i+o;return e.isInBounds(s,l)&&t.push(e.get(s,l)),t}),[])}function tc(e){return Array.isArray(e)}function nc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=tc(e)?e:e.asArray();return n[ee(t,0,n.length)]}function ac(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e instanceof mu?e.asArray():e,a=nc(n,t),i=n.find((function(e){return e.isSimilarTo(a)&&!e.inSamePositionAs(a)}));if(void 0===i)throw new Error("Could not find a matching tile");return[a,i]}n._RF.pop(),n._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),n._RF.pop(),n._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),n._RF.pop(),n._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),n._RF.pop(),n._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),n._RF.pop(),n._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),n._RF.pop(),n._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),n._RF.pop(),n._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),n._RF.pop(),n._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),n._RF.pop(),n._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0),n._RF.pop(),n._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),n._RF.pop(),n._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0),n._RF.pop(),n._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var ic=function(e){return e};function rc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ic;return Se().mark((function a(){var i,r;return Se().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:i=t,e<=0&&(e=1/0),r=0;case 3:if(!(r<e)){a.next=10;break}return a.next=6,n(i);case 6:i=1e9*te(i);case 7:r++,a.next=3;break;case 10:case"end":return a.stop()}}),a)}))()}function oc(e){return Array.isArray(e)}function sc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),a=oc(e)?e:e.asArray();if(a.length<t)return new Set(a);for(var i=new Set,r=rc(-1,n),o=r.next();i.size<t;){if(o.done)throw new Error("RNG exhausted");i.add(nc(a,o.value)),o=r.next()}return i}n._RF.pop(),n._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),n._RF.pop(),n._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),n._RF.pop(),n._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var lc=[1,4];function uc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),a=t.specials,i=a.bomb,r=ee.apply(void 0,[n].concat(lc)),o=sc(e,i,n),s=e.asArray().filter((function(e){return!o.has(e)})),l=sc(s,r,n);o.forEach((function(e){var n=2*t.time/3;e.setSpecialType(qu.bomb,n)})),l.forEach((function(e){return e.setSpecialType(qu.star)}))}function cc(e){var t=e.levelData,n=t.columns,a=t.rows,i=e.identities,r=e.createTile,o=e.seed,s=function(e,t,n){var a,i=[],r=Ye(rc(t/2,e,(function(e){return ee(e,0,n.length)})));try{for(r.s();!(a=r.n()).done;){var o=a.value;i.push(n[o]),i.push(n[o])}}catch(e){r.e(e)}finally{r.f()}return GameCore.Utils.Array.shuffle(i),i}(void 0===o?Date.now():o,n*a,i).map((function(e){var t=r(e);return t.setIdentity(e),t}));return new mu({width:n,height:a,content:s})}function hc(e){var t=e.customFen,n=e.identities,a=e.createTile,i=t.idSize,r=t.cols,o=t.rows,s=t.code;if(n.length<t.idSize)throw new Error("Invalid grid code. There are not enough identities/frames ".concat(n.length," to fill it according to fen code ").concat(i));var l=s.split(":");if(l.length!==o)throw new Error("Invalid grid code");var u=l.reduceRight((function(e,i){var r=Array.from(i.matchAll(Ee(/([a-zA-Z]+)(\d+)|./g,{ttype:1,itype:2})),(function(e){var i,r=null!==(i=e.groups)&&void 0!==i?i:{ttype:void 0,itype:void 0},o=r.ttype,s=r.itype;if(void 0!==o&&void 0!==s){var l=n[parseInt(s,10)],u=a(l),c=function(e,t){var n=Object.entries(t).find((function(t){var n=Ve(t,2);n[0];return n[1]===e}));if(void 0===n)throw new Error("Invalid special type ".concat(e));return n[0]}(o,t.encoding);return u.setSpecialType(c),u}var h=a(n[0]);return h.setEmpty(),h}));return e.concat(r)}),[]);return new mu({width:r,height:o,content:u})}function pc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e.asArray(),a=nc(e,t),i=ec(e,a);if(!i.some((function(e){return e.isSimilarTo(a)}))){var r=nc(i,t),o=n.find((function(e){return!e.inSamePositionAs(a)&&!e.inSamePositionAs(r)&&e.isSimilarTo(r)}));o.setIdentity(a.id),r.setIdentity(a.id)}}n._RF.pop(),n._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),n._RF.pop(),n._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0),n._RF.pop(),n._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0),n._RF.pop(),n._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0),n._RF.pop(),n._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),n._RF.pop(),n._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var dc=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];function fc(e,t){return e[0]===t[0]&&e[1]===t[1]}function vc(e){return new J(e[0],e[1])}function yc(e,t){return e.x>=-1&&e.x<t.width+1&&e.y>=-1&&e.y<t.height+1}function mc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bc;return t.map((function(t){return[e.tile[0]+t.x,e.tile[1]+t.y]}))}n._RF.pop(),n._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var gc,bc=[uu.Up,uu.Down,uu.Left,uu.Right],wc=function(){function e(t,n){var a;if(xe(this,e),this.f=0,this.g=0,this.h=0,n&&fc(t,n.tile))throw new Error("Tile cannot be its own parent");this.tile=t,this.parent=n;var i=e.calcDirection(this),r=n&&i&&n.cache.direction&&!i.equals(n.cache.direction)?1:0;this.cache={direction:i,turns:r+(null!==(a=null==n?void 0:n.cache.turns)&&void 0!==a?a:0)}}return Pe(e,[{key:"getKey",value:function(){var e;return"x:".concat(this.tile[0],",y:").concat(this.tile[1],",d:").concat(null===(e=this.cache.direction)||void 0===e?void 0:e.toString())}},{key:"equals",value:function(e){return this.getKey()===e.getKey()}}],[{key:"calcDirection",value:function(e){if(e.parent){var t=e.parent.tile,n=e.tile;return new J(n[0]-t[0],n[1]-t[1])}return null}}]),e}();function kc(e,t){var n=e.tile,a=t.tile;return Math.abs(n[0]-a[0])+Math.abs(n[1]-a[1])}function Sc(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=[],r=Ye(bc);try{var o=function(){var r=n.value,o={x:t[0]+r.x,y:t[1]+r.y};if(e.isInBounds(o.x,o.y))return(e.get(o.x,o.y).isHidden()||a.find((function(e){return fc(e,[o.x,o.y])})))&&i.push(r),1;yc(o,e)&&i.push(r)};for(r.s();!(n=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}return i}function Cc(e,t,n,a){if(a){var i=dc[4].startTile,r=dc[4].endTile;if(t[0]===i.x&&t[1]===i.y&&n[0]===r.x&&n[1]===r.y)return[{a:i,b:r}];if(t[0]===r.x&&t[1]===r.y&&n[0]===i.x&&n[1]===i.y)return[{a:i,b:r}]}return function(e,t,n){var a=[],i=[],r=new wc(t,null),o=new wc(n,null),s=[o.tile];for(a.push(r);a.length>0;){var l=a.shift();if(i.push(l),fc(l.tile,o.tile)){for(var u=[],c=l,h=l,p=l.parent;p;)p.cache.turns!==h.cache.turns&&(u.unshift({a:vc(p.tile),b:vc(c.tile)}),c=p),h=p,p=p.parent;return u.unshift({a:vc(h.tile),b:vc(c.tile)}),u}var d,f=Ye(mc(l,Sc(e,l.tile,s)));try{var v=function(){var e=d.value,t=new wc(e,l);if(t.cache.turns>8)return 0;var n=fc(t.tile,o.tile),r=i.some((function(e){return e.equals(t)}));if(a.some((function(e){return e.equals(t)}))||r&&!n)return 0;t.g=l.g+1+t.cache.turns,t.h=kc(t,o),t.f=t.g+t.h,a.push(t)};for(f.s();!(d=f.n()).done;)v()}catch(e){f.e(e)}finally{f.f()}a.sort((function(e,t){return e.f-t.f}))}var y=r.tile,m=o.tile;return y[0]===m[0]||y[1]===m[1]?[{a:vc(y),b:vc(m)}]:[{a:vc(y),b:{x:y[0],y:m[1]}},{a:{x:y[0],y:m[1]},b:vc(m)}]}(e,t,n)}n._RF.pop(),n._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),n._RF.pop(),n._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var Ec=(Ie(gc={},qu.bomb,"b"),Ie(gc,qu.star,"s"),Ie(gc,qu.none,"t"),gc);function Ac(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ec,n=e.width,a=e.height,i=[],r=new Map,o=a-1;o>=0;o--){for(var s=[],l=0;l<n;l++){var u,c,h=e.get(l,o),p=h.isHidden()?null:h.id;if(null!==p){var d=null!==(u=null===(c=h.special)||void 0===c?void 0:c.type)&&void 0!==u?u:qu.none,f=t[d];if(!r.has(p)){var v=r.size.toString();r.set(p,v)}var y="".concat(f).concat(r.get(p));s.push(y)}else s.push(".")}i.push(s.join(""))}return{code:i.join(":"),idSize:r.size,encoding:t,rows:a,cols:n}}function Tc(e){return e.reduce((function(e,t,n,a){return t.inSamePositionAs(n,a)||e.push([t,[n,a]]),e}),[])}n._RF.pop(),n._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),n._RF.pop();var xc=Se().mark(Rc);function Rc(e,t){var n,a,i,r,o,s,l,u;return Se().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=0,a=e-1,i=0,r=t-1;case 4:if(!(n<=a&&i<=r)){c.next=39;break}o=n;case 6:if(!(o<=a)){c.next=12;break}return c.next=9,{x:o,y:i};case 9:o++,c.next=6;break;case 12:i++,s=i;case 14:if(!(s<=r)){c.next=20;break}return c.next=17,{x:a,y:s};case 17:s++,c.next=14;break;case 20:a--,l=a;case 22:if(!(l>=n)){c.next=28;break}return c.next=25,{x:l,y:r};case 25:l--,c.next=22;break;case 28:r--,u=r;case 30:if(!(u>=i)){c.next=36;break}return c.next=33,{x:n,y:u};case 33:u--,c.next=30;break;case 36:n++,c.next=4;break;case 39:case"end":return c.stop()}}),xc)}n._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),n._RF.pop(),n._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var Pc,Ic,_c,Lc,Oc,Dc,Mc,Nc,Fc=function(){function e(t,n){xe(this,e),this.coord=new J(t,n)}return Pe(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function Bc(e){return new J(e[0],e[1])}function Gc(e,t,n){if(void 0===t||void 0===n)return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rc,a=Array.from(n(e.width,e.height)).map((function(t){var n=t.x,a=t.y;return[e.get(n,a),[n,a]]})).filter((function(e){return!Ve(e,1)[0].isHidden()})),i=[],r=function(){var t=Ve(a.shift(),2),n=t[0],r=t[1];if(i.find((function(e){return Hc(e,r)})))return 0;i.push(r);var o,s=Ye(a);try{var l,u=function(){var t=Ve(o.value,2),a=t[0],s=t[1];if(!a.isSimilarTo(n)||i.find((function(e){return Hc(e,s)})))return 0;var l=Gc(e,r,s);return null!==l?{v:{v:l}}:void 0};for(s.s();!(o=s.n()).done;)if(0!==(l=u())&&l)return l.v}catch(e){s.e(e)}finally{s.f()}};for(;a.length>0;)if(0!==(t=r())&&t)return t.v;return null}(e);var a,i=[t[0]+1,t[1]+1],r=[n[0]+1,n[1]+1],o=function(e){var t=new Array(e.width+2).fill(null).map((function(e,t){return new Fc(t-1,-1)})),n=new Array(e.width+2).fill(null).map((function(t,n){return new Fc(n-1,e.height)})),a=new Array(e.height).fill(null).map((function(e,t){return new Fc(-1,t)})),i=new Array(e.height).fill(null).map((function(t,n){return new Fc(e.width,n)})),r=function(r,o){var s=r-1,l=o-1;return-1===s?a[l]:s===e.width?i[l]:-1===l?t[s]:l===e.height?n[s]:e.get(s,l)};return{get:function(e,t){return r(e,t)},width:e.width+2,height:e.height+2}}(e),s=[i,r];if(i[0]===r[0]&&Vc(o,s,i[1],r[1],i[0])||i[1]===r[1]&&Wc(o,s,i[0],r[0],i[1]))return Yc([{a:Bc(i),b:Bc(r)}],{x:-1,y:-1});var l=i[1]<=r[1]?i:r,u=i[1]<=r[1]?r:i,c=i[0]<=r[0]?i:r,h=i[0]<=r[0]?r:i,p=[],d=[];return-1===(a=Kc(o,s,1,Bc(l),Bc(u)))&&-1===(a=Kc(o,s,-1,Bc(l),Bc(u)))||(p=[{a:Bc(i),b:{x:i[0],y:a}},{a:{x:i[0],y:a},b:{x:r[0],y:a}},{a:{x:r[0],y:a},b:Bc(r)}]),-1===(a=jc(o,s,1,Bc(c),Bc(h)))&&-1===(a=jc(o,s,-1,Bc(c),Bc(h)))||(p=[{a:Bc(i),b:{x:a,y:i[1]}},{a:{x:a,y:i[1]},b:{x:a,y:r[1]}},{a:{x:a,y:r[1]},b:Bc(r)}]),-1!==(a=function(e,t,n,a){for(var i=n.y+1;i<a.y;i++)if(Vc(e,t,n.y,i,n.x)&&Wc(e,t,n.x,a.x,i)&&Vc(e,t,i,a.y,a.x))return i;return-1}(o,s,Bc(l),Bc(u)))?d=[{a:Bc(i),b:{x:i[0],y:a}},{a:{x:i[0],y:a},b:{x:r[0],y:a}},{a:{x:r[0],y:a},b:Bc(r)}]:-1!==(a=function(e,t,n,a){for(var i=n.x+1;i<a.x;i++)if(Wc(e,t,n.x,i,n.y)&&Vc(e,t,n.y,a.y,i)&&Wc(e,t,i,a.x,a.y))return i;return-1}(o,s,Bc(c),Bc(h)))&&(d=[{a:Bc(i),b:{x:a,y:i[1]}},{a:{x:a,y:i[1]},b:{x:a,y:r[1]}},{a:{x:a,y:r[1]},b:Bc(r)}]),p.length>0&&d.length>0?Yc(zc(p)<=zc(d)?p:d,{x:-1,y:-1}):p.length>0?Yc(p,{x:-1,y:-1}):d.length>0?Yc(d,{x:-1,y:-1}):null}function zc(e){var t,n=0,a=Ye(e);try{for(a.s();!(t=a.n()).done;){n+=Uc(t.value)}}catch(e){a.e(e)}finally{a.f()}return n}function Uc(e){return e.a.x===e.b.x?Math.abs(e.a.y-e.b.y):e.a.y===e.b.y?Math.abs(e.a.x-e.b.x):0}function Hc(e,t){return e[0]===t[0]&&e[1]===t[1]}function qc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=e.get.apply(e,We(t));return a.isHidden()||n.some((function(e){return Hc(e,t)}))}function Vc(e,t,n,a,i){for(var r=Math.min(n,a),o=Math.max(n,a),s=r;s<=o;s++)if(!qc(e,[i,s],t))return!1;return!0}function Wc(e,t,n,a,i){for(var r=Math.min(n,a),o=Math.max(n,a),s=r;s<=o;s++)if(!qc(e,[s,i],t))return!1;return!0}function Kc(e,t,n,a,i){var r=1===n?i.y:a.y,o=1===n?a.x:i.x;if(Vc(e,t,a.y,i.y,o))for(;r>=0&&r<e.height&&qc(e,[a.x,r],t)&&qc(e,[i.x,r],t);){if(Wc(e,t,a.x,i.x,r))return r;r+=n}return-1}function jc(e,t,n,a,i){var r=1===n?i.x:a.x,o=1===n?a.y:i.y;if(Wc(e,t,a.x,i.x,o))for(;r>=0&&r<e.width&&qc(e,[r,a.y],t)&&qc(e,[r,i.y],t);){if(Vc(e,t,a.y,i.y,r))return r;r+=n}return-1}function Yc(e,t){return e.map((function(e){return{a:{x:e.a.x+t.x,y:e.a.y+t.y},b:{x:e.b.x+t.x,y:e.b.y+t.y}}}))}n._RF.pop(),n._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var Xc,Jc=a.ccclass,Qc=a.property,Zc=a.requireComponent,$c=globalThis.game.monitorError,eh=(Pc=Jc("Board"),Ic=Zc(s),_c=Qc(ju),Lc=Qc({displayName:"Tile Spacing",group:"Create config"}),Pc(Oc=Ic((Mc=Qe((Dc=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"tilePrefab",Mc,Fe(e)),Je(e,"tileTrim",Nc,Fe(e)),e.tileSize=[0,0],e.selectedTile=null,e.parsedGravityRules=[],e.normalMatches=0,e.normalMatchesSinceLastSpawn=0,e.spawnAttempts=0,e.hintPath=null,e.hintTiles=null,e.animationQueue=[],e.isConsumingAnimation=!1,e}return Pe(i,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),Ct.lazyValidateProperties(this),this.tilePrefab.node.active=!1}},{key:"create",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=We(e);GameCore.Utils.Array.shuffle(i),e=i.slice(0,t.colors),this.levelData=t,this.parsedGravityRules=Qu(t.mode);var r=function(e){var t=l(n.tilePrefab.node),a=t.getComponent(ju);return a.setIdentity(e),n.node.addChild(t),t.active=!0,a},o=!1;if(void 0!==t.customFen)try{o=!0,this.grid=hc({customFen:t.customFen,identities:e,createTile:r}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)}))}catch(e){console.error("Error creating grid from custom fen",e,"falling back to random grid"),o=!1}o||(this.grid=cc({levelData:t,seed:a,identities:e,createTile:r}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)})),pc(this.grid,a),uc(this.grid,t,a));var s=[this.tileTrim.x,this.tileTrim.y];this.tileSize=Ju(this.tilePrefab.getSize(),s);var u=[this.grid.width,this.grid.height],c=[this.uiTransform.width,this.uiTransform.height],h=Yu(u,this.tilePrefab.getSize(),c);this.node.setScale(h,h),this.node.scene.emit($i.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}},{key:"destroyTiles",value:function(){var e;null===(e=this.grid)||void 0===e||e.forEach((function(e){return e.node.destroy()}))}},{key:"animateTilesAppear",value:function(){var e=this,t=function(t,n){var a=J.ZERO.clone();return e.parsedGravityRules.forEach((function(i){var r=e.getPrimitiveDirection(t,n,i);a.subtract2f(r.x,r.y)})),a.normalize()};return new Promise((function(n){var a=function(){var a=Te(Se().mark((function a(){return Se().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Promise.all(e.grid.map((function(n,a,i){var r=ne(0,.5),o=n.node.scale.clone(),s=t(a,i),l=Xu(e.grid,e.tileSize,{x:a,y:i}),u=s.multiplyScalar(100).add2f(l.x,l.y);return n.node.setPosition(u.x,u.y),n.node.setScale(0,0),Promise.all([mn.runTweenAsync(S(n.node).delay(r).to(.5,{scale:o},{easing:"elasticOut"})),n.sync({getTargetPosition:function(t){return Xu(e.grid,e.tileSize,t)},easing:"backOut",duration:.5,delay:r})])})));case 2:n();case 3:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}();e.animationQueue.push(a),e.consumeAnimationQueue()}))}},{key:"handleTileClick",value:function(e){if(!e.isHidden()){if(this.selectedTile===e)return this.selectedTile=null,void e.setFocused(!1);if(!this.selectedTile)return this.selectedTile=e,void e.setFocused(!0);if(!this.selectedTile.isSimilarTo(e))return this.selectedTile.setFocused(!1),this.selectedTile=e,void e.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,e),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(e,t){var n=[e.getCoord().x,e.getCoord().y],a=[t.getCoord().x,t.getCoord().y],i=Gc(this.grid,n,a);if(null===i){ga.playSound(Zn.INVALID_MATCH),this.shakeGrid();var r=0===this.levelData.level,o=Cc(this.grid,n,a,r);return this.node.scene.emit($i.GRID_MATCH,[e,t]),void this.node.scene.emit($i.GRID_MATCH_FAIL,o)}this.node.scene.emit($i.GRID_MATCH,[e,t]),this.node.scene.emit($i.GRID_MATCH_SUCCESS,i,[e,t]),this.clear([[e,t]],"clear")}},{key:"clear",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"clear";this.normalMatches+=e.length,e.forEach((function(e){var a=Ve(e,2),i=a[0],r=a[1];i.setEmpty(),r.setEmpty(),i.playClearFX(n),r.playClearFX(n),t.node.scene.emit($i.GRID_CLEAR,[i,r])})),this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var e=this.hintPath[0].a,t=this.hintPath[this.hintPath.length-1].b,n=this.getTileAt(e.x,e.y),a=this.getTileAt(t.x,t.y);n.setHint(!0),a.setHint(!0),this.hintTiles=[n,a]}}},{key:"hideHint",value:function(){if(this.hintTiles){var e=Ve(this.hintTiles,2),t=e[0],n=e[1];t.setHint(!1),n.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(e,t){return this.grid.isInBounds(e,t)?this.grid.get(e,t):null}},{key:"getAnyTileWorldPosition",value:function(e,t){var n=Xu(this.grid,this.tileSize,{x:e,y:t});this.tilePrefab.node.setPosition(n.x,n.y);var a=this.tilePrefab.node.getWorldPosition();return{x:a.x,y:a.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getUncleared",value:function(){return Zu(this.grid)}},{key:"getCleared",value:function(){return $u(this.grid)}},{key:"getBombTiles",value:function(){return Zu((e=this.grid)instanceof mu?e.asArray():e).filter((function(e){var t;return(null===(t=e.special)||void 0===t?void 0:t.type)===qu.bomb}));var e}},{key:"getPairs",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],a=t?Zu(this.grid):$u(this.grid),i=function(){var e=Ve(ac(a),2),t=e[0],i=e[1];n.push([t,i]),a=a.filter((function(e){return e!==t&&e!==i}))};n.length<e;)i();return n}},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.grid.forEach((function(t){return t.setIgnoreInput(e)}))}},{key:"processShuffleRequest",value:function(e){var t=this.processShuffleStep(this.grid,!0,e);this.grid=t[0],this.hintPath=t[1],this.consumeAnimationQueue()}},{key:"getCurrentFen",value:function(){return Ac(this.grid)}},{key:"generateFenFromCurrentLevel",value:function(e){return i.generateFen(null!=e?e:this.levelData)}},{key:"shakeGrid",value:(n=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.clone(),n=S(this.node).to(.05,{position:t.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:t.clone().subtract3f(ne(5,10),ne(5,10),0)}),a=S(this.node).repeat(2,n).to(.05,{position:t}),e.next=5,mn.runTweenAsync(a);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"processGameplayCycle",value:function(){var e=Zu(this.grid);if(0!==e.length){var t=this.grid,n=e.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,a=this.normalMatchesSinceLastSpawn>=2;n&&(a?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),e.length>14&&(t=this.processGravitationStep(t));var i=this.processShuffleStep(t);this.consumeAnimationQueue(),this.grid=i[0],this.hintPath=i[1]}}},{key:"processSpawnStep",value:function(){var e=Ve(sc($u(this.grid),2),2),t=e[0],n=e[1];t.restore(),n.restore(t.id)}},{key:"processGravitationStep",value:function(e){var t,n=this,a=e,i=[],r=Ye(this.parsedGravityRules);try{var o=function(){var e=t.value,r=Tc(a=n.toGravitated(a,e));if(0===r.length)return 1;r.forEach((function(e){var t=Ve(e,2),n=t[0],a=t[1],i=a[0],r=a[1];n.setCoord(i,r)})),a.forEach((function(e){e.node.setSiblingIndex(0)}));var o=function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(r.map((function(e){var t=Ve(e,2),i=t[0],r=Ve(t[1],2),o=r[0],s=r[1];return i.sync({delay:.25,duration:.25,getTargetPosition:function(){return Xu(a,n.tileSize,{x:o,y:s})}})})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();i.push(o)};for(r.s();!(t=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}var s=function(){var e=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=i;case 1:if(!(t<n.length)){e.next=8;break}return a=n[t],e.next=5,a();case 5:t++,e.next=1;break;case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return this.animationQueue.push(s),a}},{key:"toGravitated",value:function(e,t){var n=new mu(e),a=e.height-1,i=e.width-1,r=[0,a],o=[0,i],s=Math.floor(e.height/2),l=Math.floor(e.width/2),u=function(e){return e.isHidden()};switch(t){case cu:n.gravitate({rowRange:r,colRange:o,direction:uu.Down,isLighter:u});break;case hu:n.gravitate({rowRange:r,colRange:o,direction:uu.Up,isLighter:u});break;case pu:n.gravitate({rowRange:r,colRange:o,direction:uu.Left,isLighter:u});break;case du:n.gravitate({rowRange:r,colRange:o,direction:uu.Right,isLighter:u});break;case fu:n.gravitate({rowRange:r,colRange:[l,i],direction:uu.Left,isLighter:u,out:n.gravitate({rowRange:r,colRange:[0,l-1],direction:uu.Right,isLighter:u})});break;case vu:n.gravitate({rowRange:[s,a],colRange:o,direction:uu.Down,isLighter:u,out:n.gravitate({rowRange:[0,s-1],colRange:o,direction:uu.Up,isLighter:u})})}return n}},{key:"getPrimitiveDirection",value:function(e,t,n){var a=Math.floor(this.grid.height/2),i=Math.floor(this.grid.width/2);switch(n){case cu:return uu.Down;case hu:return uu.Up;case pu:return uu.Left;case du:return uu.Right;case fu:return e>=i?uu.Left:uu.Right;case vu:return t>=a?uu.Up:uu.Down}}},{key:"processShuffleStep",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=arguments.length>2?arguments[2]:void 0,i=Gc(e),r=Zu(e).map((function(e){var t=e.getCoord();return[t.x,t.y]}));if(null!==i&&!n)return[e,i];var o=100;do{var s=e.toShuffled(r),l=Ve(s,1);i=Gc(t=l[0]),o--}while(null===i&&o>0);if(o<=0)return null==$c||$c.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",levelData:this.levelData,gridAsArray:t.asArray()}),this.node.scene.emit($i.GAME_EXIT),[e,i];var u=Tc(t);if(0===u.length)return[t,i];u.forEach((function(e){var t=Ve(e,2),n=t[0],a=Ve(t[1],2),i=a[0],r=a[1];n.setCoord(i,r)}));var c=void 0!==a?function(){return a(e,t)}:this.createShuffleAnimationHandler(e,t);return this.animationQueue.push(c),[t,i]}},{key:"createShuffleAnimationHandler",value:function(e,t){var n=this,a=function(){var a=Te(Se().mark((function a(){return Se().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Promise.all(e.map((function(e,a,i){return e.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return Xu(t,n.tileSize,{x:a,y:i},10)}})})));case 2:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),i=function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){e.node.setSiblingIndex(0)})),e.next=3,Promise.all(t.map((function(e){return e.sync({duration:.6,easing:"smooth",delay:ne(0,.4),getTargetPosition:function(e){return Xu(t,n.tileSize,e)}})})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a();case 2:return e.next=4,i();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isConsumingAnimation){e.next=2;break}return e.abrupt("return");case 2:this.isConsumingAnimation=!0;case 3:if(!(this.animationQueue.length>0)){e.next=12;break}if(0!==this.getUncleared().length){e.next=7;break}return this.animationQueue=[],e.abrupt("break",12);case 7:return t=this.animationQueue.shift(),e.next=10,t();case 10:e.next=3;break;case 12:this.isConsumingAnimation=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"generateFen",value:function(e){var t=e,n=Array.from({length:e.colors},(function(e,t){return t+1})),a=Date.now(),i=cc({levelData:t,seed:a,identities:n,createTile:function(e){var t=e,n=void 0,a=new J(0,0);return{get id(){return t},get special(){return n},get coord(){return a},setIdentity:function(e){t=e},isHidden:function(){return!1},setSpecialType:function(e){n={type:e}},setCoord:function(e,t){return a.set(e,t)},getCoord:function(){return a},isSimilarTo:function(e){return e.id===t},inSamePositionAs:function(e){return e.getCoord().equals(a)}}}});return i.forEach((function(e,t,n){e.setCoord(t,n)})),pc(i,a),uc(i,t,a),Ac(i)}}]),i}(f)).prototype,"tilePrefab",[_c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nc=Qe(Dc.prototype,"tileTrim",[Lc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new J(.025,.1)}}),Oc=Dc))||Oc)||Oc);n._RF.pop(),n._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var th=(0,a.ccclass)("Line")(Xc=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s)}},{key:"setPoints",value:function(e,t){this.node.setWorldPosition((e.x+t.x)/2,(e.y+t.y)/2,0),this.uiTransform.width=J.distance(e,t)+10,this.uiTransform.width/=this.node.worldScale.x;var n=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI;this.node.eulerAngles=new j(0,0,n)}}]),n}(f))||Xc;n._RF.pop(),n._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var nh,ah,ih,rh,oh,sh,lh,uh,ch,hh,ph,dh=function(e){_e(n,e);var t=Ge(n);function n(e,a,i,r,o){var s;return xe(this,n),(s=t.call(this,e,a,o)).ator=i,s.ftor=r,s}return Pe(n,[{key:"alloc",value:function(){var e=Ue(Le(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(e),e}},{key:"free",value:function(e){this.ftor&&this.ftor(e),Ue(Le(n.prototype),"free",this).call(this,e)}}]),n}(ae);n._RF.pop(),n._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var fh,vh,yh,mh,gh,bh,wh,kh,Sh,Ch=a.ccclass,Eh=a.property,Ah=(nh=Ch("PathDrawer"),ah=Eh({group:"Line",displayName:"Prefab",type:P}),ih=Eh({group:"Line",displayName:"Holder",type:i,tooltip:"Line Prefab"}),rh=Eh({group:"Point",displayName:"Prefab",type:P}),oh=Eh({group:"Point",displayName:"Holder",type:i}),nh((uh=Qe((lh=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"linePrefab",uh,Fe(e)),Je(e,"lineHolder",ch,Fe(e)),e.lineNodes=[],Je(e,"pointPrefab",hh,Fe(e)),Je(e,"pointHolder",ph,Fe(e)),e.pointNodes=[],e}return Pe(n,[{key:"start",value:function(){var e=this;this.linePool=new dh((function(){var t=l(e.linePrefab);return e.lineHolder.addChild(t),t.parent=e.lineHolder,t.active=!1,t}),0,(function(t){e.lineNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()})),this.pointPool=new dh((function(){var t=l(e.pointPrefab);return e.pointHolder.addChild(t),t.active=!1,t}),0,(function(t){e.pointNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()}))}},{key:"drawPath",value:function(e){this.clearPath();var t,n=Ye(e);try{for(n.s();!(t=n.n()).done;){var a,i=t.value;null===(a=this.linePool.alloc().getComponent(th))||void 0===a||a.setPoints(i.a,i.b)}}catch(e){n.e(e)}finally{n.f()}}},{key:"clearPath",value:function(){var e,t=Ye(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.linePool.free(n)}}catch(e){t.e(e)}finally{t.f()}this.lineNodes=[];var a,i=Ye(this.pointNodes);try{for(i.s();!(a=i.n()).done;){var r=a.value;this.pointPool.free(r)}}catch(e){i.e(e)}finally{i.f()}this.pointNodes=[]}}]),n}(f)).prototype,"linePrefab",[ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=Qe(lh.prototype,"lineHolder",[ih],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hh=Qe(lh.prototype,"pointPrefab",[rh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ph=Qe(lh.prototype,"pointHolder",[oh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sh=lh))||sh);n._RF.pop(),n._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var Th,xh=a.ccclass,Rh=a.property,Ph=(fh=xh("ErrorDrawer"),vh=Rh(O),yh=Rh(O),mh=Rh(O),fh((wh=Qe((bh=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"one",wh,Fe(e)),Je(e,"two",kh,Fe(e)),Je(e,"error",Sh,Fe(e)),e}return Pe(n,[{key:"start",value:function(){Ue(Le(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(e){var t=this;if(this.clearPath(),e.forEach((function(n,a){var i;if(null===(i=t.linePool.alloc().getComponent(th))||void 0===i||i.setPoints(n.a,n.b),0!==a){var r=t.pointPool.alloc();r.setWorldPosition(new j(n.a.x,n.a.y,0));var o=r.getComponent(T);1===a&&e.length>3?o.spriteFrame=t.one:2===a&&e.length>3?o.spriteFrame=t.two:o.spriteFrame=t.error}})),1===e.length){var n=this.pointPool.alloc();n.setWorldPosition(new j(e[0].a.x+e[0].b.x,e[0].a.y+e[0].b.y,0).multiplyScalar(.5)),n.getComponent(T).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(e){this.pathAppearDuration>0&&(this.pathAppearDuration-=e,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(Ah)).prototype,"one",[vh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kh=Qe(bh.prototype,"two",[yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sh=Qe(bh.prototype,"error",[mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gh=bh))||gh);n._RF.pop(),n._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var Ih,_h=(0,a.ccclass)("HintDrawer")(Th=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"drawPath",value:function(e){this.clearPath(),this.createPath(e),this.showPath()}},{key:"createPath",value:function(e){var t=this;e.forEach((function(e){var n;null===(n=t.linePool.alloc().getComponent(th))||void 0===n||n.setPoints(e.a,e.b),t.pointPool.alloc().setWorldPosition(e.a.x,e.a.y,0)})),this.pointPool.alloc().setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0)}},{key:"showPath",value:function(){var e,t=Ye(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value.getComponent(M);n.opacity=0,S(n).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){t.e(e)}finally{t.f()}var a,i=Ye(this.pointNodes);try{for(i.s();!(a=i.n()).done;){var r=a.value.getComponent(M);r.opacity=0,S(r).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){i.e(e)}finally{i.f()}}},{key:"clearPath",value:function(){var e,t=this,n=Ye(this.lineNodes);try{var a=function(){var n=e.value,a=n.getComponent(M);S(a).to(.15,{opacity:0},{onComplete:function(){a.opacity=255,t.linePool.free(n)}}).start()};for(n.s();!(e=n.n()).done;)a()}catch(e){n.e(e)}finally{n.f()}var i,r=Ye(this.pointNodes);try{var o=function(){var e=i.value,n=e.getComponent(M);S(n).to(.15,{opacity:0},{onComplete:function(){n.opacity=255,t.pointPool.free(e)}}).start()};for(r.s();!(i=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(Ah))||Th;n._RF.pop(),n._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var Lh,Oh,Dh,Mh,Nh,Fh,Bh,Gh,zh,Uh=(0,a.ccclass)("MatchDrawer")(Ih=function(e){_e(i,e);var t,n,a=Ge(i);function i(){return xe(this,i),a.apply(this,arguments)}return Pe(i,[{key:"drawPath",value:function(e){var t=this;e.forEach((function(e,n){var a,i=t.linePool.alloc();null===(a=i.getComponent(th))||void 0===a||a.setPoints(e.a,e.b),t.animateLine(i);var r=t.pointPool.alloc();r.setWorldPosition(e.a.x,e.a.y,0),t.animatePoint(r,n)}));var n=this.pointPool.alloc();n.setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0),this.animatePoint(n,e.length)}},{key:"animateLine",value:(n=Te(Se().mark((function e(t){var n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.getComponent(M)).opacity=0,a=S(n).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0}),e.next=5,mn.runTweenAsync(a);case 5:n.opacity=255,this.linePool.free(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"animatePoint",value:(t=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.scale=j.ZERO,a=S(t).delay(.03*n).to(.2,{scale:j.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:j.ZERO},{easing:"backIn"}),e.next=4,mn.runTweenAsync(a);case 4:this.pointPool.free(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),i}(Ah))||Ih;n._RF.pop(),n._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var Hh,qh=a.ccclass,Vh=a.property,Wh=(Lh=qh("PathDraw"),Oh=Vh({group:{name:"Path Drawer"},type:Uh}),Dh=Vh({group:{name:"Path Drawer"},type:_h}),Mh=Vh({group:{name:"Path Drawer"},type:Ph}),Lh((Bh=Qe((Fh=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"matchPath",Bh,Fe(e)),Je(e,"hintPath",Gh,Fe(e)),Je(e,"errorPath",zh,Fe(e)),e.isDrawingHint=!1,e}return Pe(n,[{key:"drawMatchPath",value:function(e,t){var n,a=Ye(e=e.map((function(e){return ke({},e)})));try{for(a.s();!(n=a.n()).done;){var i=n.value;i.a=t(i.a),i.b=t(i.b)}}catch(e){a.e(e)}finally{a.f()}this.matchPath.drawPath(e)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(e,t){if(!this.isDrawingHint){this.isDrawingHint=!0;var n,a=Ye(e=e.map((function(e){return ke({},e)})));try{for(a.s();!(n=a.n()).done;){var i=n.value;i.a=t(i.a),i.b=t(i.b)}}catch(e){a.e(e)}finally{a.f()}this.hintPath.drawPath(e)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(e,t){var n,a=Ye(e=e.map((function(e){return ke({},e)})));try{for(a.s();!(n=a.n()).done;){var i=n.value;i.a=t(i.a),i.b=t(i.b)}}catch(e){a.e(e)}finally{a.f()}this.errorPath.drawPath(e)}}]),n}(f)).prototype,"matchPath",[Oh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gh=Qe(Fh.prototype,"hintPath",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zh=Qe(Fh.prototype,"errorPath",[Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh=Fh))||Nh);n._RF.pop(),n._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var Kh,jh,Yh,Xh,Jh,Qh,Zh,$h,ep,tp,np,ap,ip,rp,op,sp,lp,up=(0,a.ccclass)("ComboManager")(Hh=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on($i.COMBO_ENDED,this.resetCombo,this),this.node.scene.on($i.GAME_FINISH,this.resetCombo,this),this.node.scene.on($i.GAME_REPLAY,this.resetCombo,this),this.node.scene.on($i.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on($i.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(e){if(this.currentCombo=e,e>0&&e<5){var t=[Zn.COMBO_1,Zn.COMBO_2,Zn.COMBO_3,Zn.COMBO_4,Zn.COMBO_5];ga.playSound(t[e])}else e>=5&&ga.playSound(Zn.COMBO_5);e>0&&this.vibrate(e),this.emitEvent&&this.node.scene.emit($i.COMBO_UPDATED,e)}},{key:"vibrate",value:function(e){var t;null===(t=R("Vibrate"))||void 0===t||null===(t=t.getComponent(ws))||void 0===t||t.vibrate(Math.min(20+20*e,220))}},{key:"setEmitEvent",value:function(e){this.emitEvent=e}}]),n}(f))||Hh;n._RF.pop(),n._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var cp,hp,pp,dp,fp,vp=a.ccclass,yp=a.property,mp=a.disallowMultiple,gp=(Kh=vp("ShiningStar"),jh=yp(T),Yh=yp({serializable:!0,visible:!1}),Xh=yp({type:C,displayName:"Scale up duration",min:.001}),Jh=yp({serializable:!0,visible:!1}),Qh=yp({type:C,displayName:"Bounce and Fall duration",min:.001}),Zh=yp({serializable:!0,visible:!1}),$h=yp({type:C,displayName:"Start scale"}),ep=yp({serializable:!0,visible:!1}),tp=yp({type:C,displayName:"End scale"}),Kh(np=mp((ip=Qe((ap=function(e){_e(u,e);var t,n,a,i,r,o,s,l=Ge(u);function u(){var e;xe(this,u);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=l.call.apply(l,[this].concat(n)),"shine",ip,Fe(e)),Je(e,"twScaleUpDuration",rp,Fe(e)),Je(e,"twBounceAndFallDuration",op,Fe(e)),Je(e,"twStartScale",sp,Fe(e)),Je(e,"twEndScale",lp,Fe(e)),e.isBeingAnimated=!1,e}return Pe(u,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(e){this.twScaleUpDuration=e}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(e){this.twBounceAndFallDuration=e}},{key:"startScale",get:function(){return this.twStartScale},set:function(e){this.twStartScale=e}},{key:"endScale",get:function(){return this.twEndScale},set:function(e){this.twEndScale=e}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(M),this.uiOpacity=this.node.getComponent(M),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(s=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isAvailable){e.next=2;break}throw new Error("ShiningStar: This star is being animated.");case 2:return this.isBeingAnimated=!0,e.next=5,this.animateAppear();case 5:return e.next=7,this.animateDisappear();case 7:this.isBeingAnimated=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"animateAppear",value:(o=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.shineOpacity.opacity=255,e.next=3,Promise.all([this.animateFadeIn(),this.animateScaleUp()]);case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"animateDisappear",value:(r=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.animateBounceAndFall(),this.animateScaleDown()]);case 2:this.node.setScale(0,0),this.uiOpacity.opacity=0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"animateBounceAndFall",value:(i=Te(Se().mark((function e(){var t,n,a,i,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.x,n=this.node.position.y,a=[60,120],i=(Math.random()*(a[1]-a[0])+a[0])*(Math.PI/180),r=t+200*Math.cos(i),o=n+200*Math.sin(i),s=n-500,l=mn.runTweenAsync(S(this.node).to(.2*this.twBounceAndFallDuration,{position:new j(r,o,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new j(r,s,this.node.position.z)},{easing:"cubicIn"})),u=[0,360],c=mn.runTweenAsync(S(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new j(0,0,Math.random()*(u[1]-u[0])*(r>t?-1:1))},{easing:"sineOut"})),e.next=13,Promise.all([l,c]);case 13:this.node.eulerAngles=new j(0,0,0);case 14:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"animateFadeIn",value:(a=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Math.max(this.scaleUpDuration/4,.01),e.next=3,mn.runTweenAsync(S(this.uiOpacity).to(t,{opacity:255}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"animateScaleUp",value:(n=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.setScale(this.startScale,this.startScale),t=new j(this.endScale,this.endScale,1),e.next=4,mn.runTweenAsync(S(this.node).to(this.scaleUpDuration,{scale:t},{easing:"cubicOut"}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"animateScaleDown",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new j(0,0,1),e.next=3,mn.runTweenAsync(S(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:t},{easing:"cubicIn"}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}}]),u}(f)).prototype,"shine",[jh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rp=Qe(ap.prototype,"twScaleUpDuration",[Yh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Qe(ap.prototype,"scaleUpDuration",[Xh],Object.getOwnPropertyDescriptor(ap.prototype,"scaleUpDuration"),ap.prototype),op=Qe(ap.prototype,"twBounceAndFallDuration",[Jh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Qe(ap.prototype,"bounceAndFallDuration",[Qh],Object.getOwnPropertyDescriptor(ap.prototype,"bounceAndFallDuration"),ap.prototype),sp=Qe(ap.prototype,"twStartScale",[Zh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Qe(ap.prototype,"startScale",[$h],Object.getOwnPropertyDescriptor(ap.prototype,"startScale"),ap.prototype),lp=Qe(ap.prototype,"twEndScale",[ep],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Qe(ap.prototype,"endScale",[tp],Object.getOwnPropertyDescriptor(ap.prototype,"endScale"),ap.prototype),np=ap))||np)||np);n._RF.pop(),n._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var bp,wp,kp,Sp,Cp,Ep,Ap,Tp,xp,Rp,Pp,Ip,_p,Lp,Op,Dp,Mp,Np,Fp,Bp,Gp,zp=a.ccclass,Up=a.property,Hp=a.disallowMultiple,qp=(cp=zp("StarParticles"),hp=Up({type:[gp],displayName:"Prebuilt Shining stars"}),cp(pp=Hp((fp=Qe((dp=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"shiningStars",fp,Fe(e)),e}return Pe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(t=Te(Se().mark((function e(t){var n,a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(n=this.getFirstAvailableShiningStar())){e.next=3;break}throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");case 3:return a=Ve(t,2),i=a[0],r=a[1],o=new j(i,r,this.node.worldPosition.z),n.node.worldPosition=o,e.next=8,n.playAnimation();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return this.shiningStars.find((function(e){return e.isAvailable}))}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}}]),a}(f)).prototype,"shiningStars",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pp=dp))||pp)||pp);n._RF.pop(),n._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var Vp=a.ccclass,Wp=a.property,Kp=(bp=Vp("EffectManager"),wp=Wp({group:"Thunder Effect",type:i}),kp=Wp({group:"Thunder Effect",type:i}),Sp=Wp({group:"Mask Effect",type:yi}),Cp=Wp({group:"Mask Effect",type:i}),Ep=Wp({group:"Tornado Effect",type:i}),Ap=Wp({group:"Clear Particle Effect",type:i,displayName:"Particle holder node"}),Tp=Wp({group:"Clear Particle Effect",type:ie,displayName:"Emitter 1"}),xp=Wp({group:"Clear Particle Effect",type:ie,displayName:"Emitter 2"}),Rp=Wp({group:"Star Particles Effect",type:qp}),bp((_p=Qe((Ip=function(e){_e(f,e);var t,n,a,i,r,o,l,u,c,h,p,d=Ge(f);function f(){var e;xe(this,f);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=d.call.apply(d,[this].concat(n)),"cloud",_p,Fe(e)),Je(e,"lightnings",Lp,Fe(e)),Je(e,"backgroundMask",Op,Fe(e)),Je(e,"masks",Dp,Fe(e)),Je(e,"tornado",Mp,Fe(e)),e.bombExplosion=null,e.bombExplosionPool=null,e.defuseExplosion=null,e.defuseExplosionPool=null,Je(e,"clearParticleHolder",Np,Fe(e)),Je(e,"clearParticle1",Fp,Fe(e)),Je(e,"clearParticle2",Bp,Fe(e)),Je(e,"starParticle",Gp,Fe(e)),e.maskTargets=[],e.handleBoardCreate=function(t){e.clearParticleHolder.scale=t.node.scale},e}return Pe(f,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"update",value:function(){var e=this;this.maskTargets.length>0&&this.maskTargets.forEach((function(t,n){t.isHidden()||(e.masks[n].worldPosition=t.node.worldPosition.clone())}))}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on($i.GRID_CREATE,this.handleBoardCreate,this)}},{key:"playClearFXAt",value:function(e){this.clearParticle1.node.setWorldPosition(new j(e[0].x,e[0].y,1)),this.clearParticle2.node.setWorldPosition(new j(e[1].x,e[1].y,1)),this.clearParticle1.resetSystem(),this.clearParticle2.resetSystem()}},{key:"playStarFXAt",value:function(e){this.starParticle.fireShiningStarAt(e)}},{key:"playTornadoAnimation",value:(p=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.tornado.getChildByName("Sprite").getComponent(y).defaultClip){e.next=4;break}return console.warn("EffectManager: Tornado animation is not loaded when animation play request was made."),e.abrupt("return");case 4:return this.tornado.active=!0,(t=S(this.tornado)).set({scale:new j(0,0,0)}),t.delay(.5),t.to(.5,{scale:new j(1,1,1)},{easing:"quadOut"}),t.to(.5,{scale:new j(0,0,0)},{easing:"quadIn"}),t.set({active:!1}),jn.setBlockInput(!0),e.next=14,mn.runTweenAsync(t);case 14:jn.setBlockInput(!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"shakeGame",value:(h=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.clone(),n=S(this.node).to(.05,{position:t.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:t.clone().subtract3f(ne(5,10),ne(5,10),0)}).to(.05,{position:t}),e.next=4,mn.runTweenAsync(n);case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"playThunderAnimation",value:(c=Te(Se().mark((function e(t,n){var a,i,r,o,l,u,c,h,p,d,f,v,y;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.cloud.active=!0,r=R("Canvas").getComponent(s),o=r.width,l=r.height,u=Math.floor(4*Math.random()),c=0,h=0,e.t0=u,e.next=0===e.t0?9:1===e.t0?12:2===e.t0?15:3===e.t0?18:21;break;case 9:return c=Math.random()*o-o/2,h=l/2+300,e.abrupt("break",21);case 12:return c=Math.random()*o-o/2,h=-l/2-300,e.abrupt("break",21);case 15:return c=-o/2-300,h=Math.random()*l-l/2,e.abrupt("break",21);case 18:return c=o/2+300,h=Math.random()*l-l/2,e.abrupt("break",21);case 21:return this.cloud.position=new j(c,h),this.resetMasks(),this.setMaskProperties(0,t[0][0].node.worldPosition,t[0][0].node.worldScale),this.setMaskProperties(1,t[0][1].node.worldPosition,t[0][1].node.worldScale),this.setMaskProperties(2,t[1][0].node.worldPosition,t[1][0].node.worldScale),this.setMaskProperties(3,t[1][1].node.worldPosition,t[1][1].node.worldScale),this.maskTargets=[t[0][0],t[0][1],t[1][0],t[1][1]],e.next=30,this.setBackgroundMaskActive(!0);case 30:return p=S(this.cloud).to(.8,{position:new j(0,300)},{easing:"quadOut"}),e.next=33,mn.runTweenAsync(p);case 33:return d=t[0][0].node.worldPosition.clone(),f=t[0][1].node.worldPosition.clone(),this.shakeGame(),null===(a=R("Vibrate"))||void 0===a||null===(a=a.getComponent(ws))||void 0===a||a.vibrate(500),ga.playSound(Zn.THUNDERBOLT),n.clear([t[0]],"break"),e.next=41,Promise.all([this.playLightningAnimation(d,0),this.playLightningAnimation(f,1)]);case 41:return this.node.scene.emit($i.ADD_COMBO),this.node.scene.emit($i.ADD_SCORE),v=t[1][1].node.worldPosition.clone(),y=t[1][0].node.worldPosition.clone(),this.shakeGame(),null===(i=R("Vibrate"))||void 0===i||null===(i=i.getComponent(ws))||void 0===i||i.vibrate(500),ga.playSound(Zn.THUNDERBOLT),n.clear([t[1]],"break"),e.next=51,Promise.all([this.playLightningAnimation(y,0),this.playLightningAnimation(v,1)]);case 51:return this.node.scene.emit($i.ADD_COMBO),this.node.scene.emit($i.ADD_SCORE),this.cloud.active=!1,e.next=56,this.setBackgroundMaskActive(!1);case 56:this.maskTargets=[];case 57:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"playLightningAnimation",value:(u=Te(Se().mark((function e(t,n){var a,i,r,o,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.lightnings[n],i=t.subtract(a.worldPosition),r=Math.atan2(i.y,i.x)*(180/Math.PI)+180,o=i.length(),a.getComponent(s).width=o,a.angle=r,e.abrupt("return",new Promise((function(e){a.active=!0,l.scheduleOnce((function(){a.active=!1,e()}),.2)})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(l=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&(this.backgroundMask.node.active=!0),e.next=3,this.backgroundMask.changeStateFade(t,.25);case 3:t||(this.backgroundMask.node.active=!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"resetMasks",value:function(){this.masks.forEach((function(e){e.worldPosition=new j(-9999,-9999,0)}))}},{key:"setMaskProperties",value:function(e,t,n){n&&(this.masks[e].worldScale=n),this.masks[e].worldPosition=t}},{key:"createDefuseExplosionAt",value:(o=Te(Se().mark((function e(t){var n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadDefuseExplosionPrefab();case 2:return this.defuseExplosionPool||(this.defuseExplosionPool=new dh(this.createDefuseExplosion.bind(this),1,jp.getBombDefuseExplosion,jp.returnBombDefuseExplosion,jp.destroyBombDefuseExplosion)),(n=this.defuseExplosionPool.alloc()).setWorldPosition(t),a=n.getComponent(y),e.next=8,mn.runAnimationAsync(a);case 8:if(this.defuseExplosionPool){e.next=10;break}throw new Error("EffectManager: defuseExplosionPool is null");case 10:this.defuseExplosionPool.free(n);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"createBombExplosionAt",value:(r=Te(Se().mark((function e(t){var n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadBombExplosionPrefab();case 2:return this.bombExplosionPool||(this.bombExplosionPool=new dh(this.createBombExplosion.bind(this),1,Yp.getBombExplosion,Yp.returnBombExplosion,Yp.destroyBombExplosion)),(n=this.bombExplosionPool.alloc()).setWorldPosition(t),a=n.getComponent(y),e.next=8,mn.runAnimationAsync(a);case 8:if(this.bombExplosionPool){e.next=10;break}throw new Error("EffectManager: bombExplosionPool is null");case 10:this.bombExplosionPool.free(n);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"createDefuseExplosion",value:function(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return jp.createDefuseExplosion(this.defuseExplosion,this.node)}},{key:"createBombExplosion",value:function(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return Yp.createBombExplosion(this.bombExplosion,this.node)}},{key:"loadBombExplosionPrefab",value:(i=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.bombExplosion){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,jn.loadPrefabAsync(Fn.BOMB_EXPLODE_PREFAB);case 4:return(t=e.sent)&&(this.bombExplosion=t),e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"loadDefuseExplosionPrefab",value:(a=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.defuseExplosion){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,jn.loadPrefabAsync(Fn.BOMB_DEFUSE_PREFAB);case 4:return(t=e.sent)&&(this.defuseExplosion=t),e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"loadThunderAnimation",value:(n=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this.cloud.getChildByName("Top").getComponent(y)).defaultClip){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return e.next=5,jn.loadAnimClipAsync(Fn.CLOUD_IDLE_ANIM);case 5:return(n=e.sent)&&(t.defaultClip=n),e.abrupt("return",Promise.resolve());case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadTornadoAnimation",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this.tornado.getChildByName("Sprite").getComponent(y)).defaultClip){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return e.next=5,jn.loadAnimClipAsync(Fn.TORNADO_IDLE_ANIM);case 5:return(n=e.sent)&&(t.defaultClip=n),e.abrupt("return",Promise.resolve());case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),f}(f)).prototype,"cloud",[wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lp=Qe(Ip.prototype,"lightnings",[kp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Op=Qe(Ip.prototype,"backgroundMask",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp=Qe(Ip.prototype,"masks",[Cp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Mp=Qe(Ip.prototype,"tornado",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Np=Qe(Ip.prototype,"clearParticleHolder",[Ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fp=Qe(Ip.prototype,"clearParticle1",[Tp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bp=Qe(Ip.prototype,"clearParticle2",[xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gp=Qe(Ip.prototype,"starParticle",[Rp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pp=Ip))||Pp),jp=function(){function e(){xe(this,e)}return Pe(e,null,[{key:"createDefuseExplosion",value:function(e,t){var n=l(e);return t.addChild(n),n.active=!1,n}},{key:"destroyBombDefuseExplosion",value:function(e){e.destroy()}},{key:"getBombDefuseExplosion",value:function(e){e.active=!0}},{key:"returnBombDefuseExplosion",value:function(e){e.active=!1}}]),e}(),Yp=function(){function e(){xe(this,e)}return Pe(e,null,[{key:"createBombExplosion",value:function(e,t){var n=l(e);return t.addChild(n),n.active=!1,n}},{key:"destroyBombExplosion",value:function(e){e.destroy()}},{key:"getBombExplosion",value:function(e){e.active=!0}},{key:"returnBombExplosion",value:function(e){e.active=!1}}]),e}();n._RF.pop(),n._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var Xp="newbie",Jp="timer",Qp="combo",Zp="hint-item",$p="thunder-item",ed="storm-item",td="pliers-item";n._RF.pop(),n._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var nd=function(){function e(t){xe(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on($i.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on($i.GRID_MATCH_FAIL,this.showNextStep,this),this.showStep(this.currentStep),this.manager.node.scene.emit($i.HIDE_UI),this.manager.guideSkipButton.active=!0}},{key:"showNextStep",value:function(){this.currentStep+1<dc.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(n=Te(Se().mark((function e(t){var n,a,i,r,o,s,l,u,c,h,p,d;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.gameplay,a=n.board,i=n.effectManager,r=dc[t].startTile,o=dc[t].endTile,s=a.getTileAt(r.x,r.y),l=a.getTileAt(o.x,o.y),s&&l){e.next=7;break}return e.abrupt("return");case 7:return u=s.node.worldPosition,c=l.node.worldPosition,i.resetMasks(),i.setMaskProperties(0,u,s.node.worldScale),i.setMaskProperties(1,c,l.node.worldScale),i.setBackgroundMaskActive(!0),h=this.manager,p=h.guideHand,d=h.guideTextBox,p.node.active=!0,p.playHandAnimation(u,c),e.next=18,d.hide();case 18:return d.setText(dc[t].description),e.next=21,d.show();case 21:a.setIgnoreInput(!0),s.setIgnoreInput(!1),l.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.gameplay,n=t.board,a=t.effectManager,this.manager.node.scene.off($i.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off($i.GRID_MATCH_FAIL,this.showNextStep,this),n.setIgnoreInput(!1),e.t0=Promise,e.next=7,this.manager.guideTextBox.hide();case 7:return e.t1=e.sent,e.next=10,a.setBackgroundMaskActive(!1);case 10:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=14,e.t0.all.call(e.t0,e.t3);case 14:this.manager.guideHand.node.active=!1,this.manager.completeGuide(Xp);case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var ad=function(){function e(t){xe(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,a,i,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,a=t.guideInfoText,i=this.gameplay.uiManager.clock,r=i.getComponent(s).contentSize,o=r.width,l=r.height,u=i.node.worldPosition,o*=1.5,l*=1.5,e.next=9,this.gameplay.handleShowUI();case 9:return n.node.active=!0,n.setOtherMaskTransform(u.x,u.y,o,l),a.node.active=!0,a.string="Remove all tiles before\nthe time end",a.node.setWorldPosition(u.x,u.y-l/2-50,0),a.horizontalAlign=re.CENTER,a.getComponent(s).setAnchorPoint(.5,.5),e.next=18,n.show();case 18:this.manager.node.scene.once($i.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit($i.PAUSE_TIME);case 20:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideInfoText,a=t.guideMasks,this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit($i.RESUME_TIME),e.next=5,a.hide();case 5:n.node.active=!1,this.manager.completeGuide(Jp);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var id=function(){function e(t){xe(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,a,i,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,a=t.guideInfoText,i=this.gameplay.uiManager.comboContainer,r=i.getComponent(s).contentSize,o=r.width,l=r.height,u=i.worldPosition,o*=1.5,l*=1.5,n.node.active=!0,n.setOtherMaskTransform(u.x,u.y,o,l),a.node.active=!0,a.string="Remove tiles continuously\nto increase combo!",a.node.setWorldPosition(u.x-o/2-10,u.y,0),a.horizontalAlign=re.RIGHT,a.getComponent(s).setAnchorPoint(1,.5),e.next=16,n.show();case 16:this.manager.node.scene.once($i.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit($i.PAUSE_TIME);case 18:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideInfoText,a=t.guideMasks,this.manager.node.scene.emit($i.RESUME_TIME),a.node.off(i.EventType.TOUCH_START,this.close,this),e.next=5,a.hide();case 5:n.node.active=!1,this.manager.completeGuide(Qp);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var rd=function(){function e(t){xe(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,a,i,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,a=t.guideInfoText,i=this.gameplay.itemManager.items.find((function(e){return e.itemType===Cs.HINT}))){e.next=4;break}return e.abrupt("return");case 4:return r=i.node.worldPosition,o=i.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),a.node.active=!0,a.string="Tap to reveal a connectable pair",a.node.setPosition(0,0),a.node.setWorldPosition(a.node.worldPosition.x,r.y+u/2+30,0),a.horizontalAlign=re.CENTER,a.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once($i.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit($i.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,a=t.guideInfoText,this.manager.node.scene.emit($i.RESUME_TIME),e.next=4,n.hide();case 4:a.node.active=!1,this.manager.completeGuide(Zp);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var od=function(){function e(t){xe(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,a,i,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,a=t.guideInfoText,i=this.gameplay.itemManager.items.find((function(e){return e.itemType===Cs.THUNDER}))){e.next=4;break}return e.abrupt("return");case 4:return r=i.node.worldPosition,o=i.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),a.node.active=!0,a.string="Tap to remove 2 pairs",a.node.setPosition(0,0),a.node.setWorldPosition(a.node.worldPosition.x,r.y+u/2+30,0),a.horizontalAlign=re.CENTER,a.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once($i.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit($i.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,a=t.guideInfoText,this.manager.node.scene.emit($i.RESUME_TIME),e.next=4,n.hide();case 4:a.node.active=!1,this.manager.completeGuide($p);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var sd=function(){function e(t){xe(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,a,i,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,a=t.guideInfoText,i=this.gameplay.itemManager.items.find((function(e){return e.itemType===Cs.STORM}))){e.next=4;break}return e.abrupt("return");case 4:return r=i.node.worldPosition,o=i.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),a.node.active=!0,a.string="Tap to rearrange the tiles",a.node.setPosition(0,0),a.node.setWorldPosition(a.node.worldPosition.x,r.y+u/2+30,0),a.horizontalAlign=re.CENTER,a.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once($i.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit($i.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,a=t.guideInfoText,this.manager.node.scene.emit($i.RESUME_TIME),e.next=4,n.hide();case 4:a.node.active=!1,this.manager.completeGuide(ed);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var ld,ud,cd,hd,pd,dd,fd,vd,yd,md=function(){function e(t){xe(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Te(Se().mark((function e(){var t,n,a,i,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,a=t.guideInfoText,i=this.gameplay.itemManager.items.find((function(e){return e.itemType===Cs.PLIERS}))){e.next=4;break}return e.abrupt("return");case 4:return r=i.node.worldPosition,o=i.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),a.node.active=!0,a.string="Tap to remove bomb",a.node.setPosition(0,0),a.node.setWorldPosition(a.node.worldPosition.x,r.y+u/2+30,0),a.horizontalAlign=re.CENTER,a.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once($i.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit($i.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,a=t.guideInfoText,this.manager.node.scene.emit($i.RESUME_TIME),e.next=4,n.hide();case 4:a.node.active=!1,this.manager.completeGuide(td);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var gd,bd,wd,kd,Sd,Cd,Ed,Ad=a.ccclass,Td=a.property,xd=(ld=Ad("GuideHand"),ud=Td(i),cd=Td(i),hd=Td(M),ld((fd=Qe((dd=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"hand",fd,Fe(e)),Je(e,"circleHighlight",vd,Fe(e)),Je(e,"circleHighlightOpacity",yd,Fe(e)),e}return Pe(n,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(e,t){var n=this;this.handTween&&this.handTween.stop();var a=S(this.hand).to(.8,{worldPosition:t},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0}).to(.8,{worldPosition:e},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0});this.handTween=S(this.hand).repeatForever(a).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),S(this.circleHighlight).to(.6,{scale:new j(1.5,1.5)},{easing:"quadOut"}).start(),S(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(f)).prototype,"hand",[ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vd=Qe(dd.prototype,"circleHighlight",[cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd=Qe(dd.prototype,"circleHighlightOpacity",[hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pd=dd))||pd);n._RF.pop(),n._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var Rd,Pd,Id,_d,Ld,Od,Dd=a.ccclass,Md=a.property,Nd=(gd=Dd("GameMask"),bd=Md(s),wd=Md(T),gd((Cd=Qe((Sd=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"uiTransform",Cd,Fe(e)),Je(e,"sprite",Ed,Fe(e)),e}return Pe(n,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),n}(f)).prototype,"uiTransform",[bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ed=Qe(Sd.prototype,"sprite",[wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kd=Sd))||kd);n._RF.pop(),n._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var Fd,Bd,Gd,zd,Ud,Hd,qd,Vd=a.ccclass,Wd=a.property,Kd=a.executeInEditMode,jd=(Rd=Vd("AlphaMasks"),Pd=Kd(!0),Id=Wd(Nd),Rd(_d=Pd((Od=Qe((Ld=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"masks",Od,Fe(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent(s)}},{key:"start",value:function(){this.material=this.getComponent(T).getMaterialInstance(0)}},{key:"update",value:function(){var e=this,t=this.UITransform,n=t.width,a=t.height;this.masks.forEach((function(t,i){var r=t.uiTransform,o=r.width,s=r.height,l=r.anchorX,u=r.anchorY,c=o*t.node.scale.x,h=s*t.node.scale.y,p=new J(c/n,h/a),d=new J(.5+(.5-l)*p.x,.5-(.5-u)*p.y),f=new J(d.x+(t.node.worldPosition.x-e.node.worldPosition.x)/n,d.y-(t.node.worldPosition.y-e.node.worldPosition.y)/a);e.material.setProperty("mask".concat(i,"Texture"),t.texture),e.material.setProperty("ratio".concat(i),p),e.material.setProperty("center".concat(i),f)}))}},{key:"setMaskActive",value:function(e,t){e>=this.masks.length||this.material.setProperty("useMask".concat(e),t?1:0)}}]),n}(f)).prototype,"masks",[Id],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_d=Ld))||_d)||_d);n._RF.pop(),n._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var Yd,Xd,Jd,Qd,Zd,$d=a.ccclass,ef=a.property,tf=(Fd=$d("GuideMasks"),Bd=ef(yi),Gd=ef(jd),Fd((Hd=Qe((Ud=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"background",Hd,Fe(e)),Je(e,"alphaMasks",qd,Fe(e)),e}return Pe(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"show",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.background.node.active=!0,e.next=3,this.background.changeStateFade(!0,.25);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.background.changeStateFade(!1,.25);case 2:this.background.node.active=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit($i.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(e,t,n,a){this.alphaMasks.masks[1].node.worldPosition=new j(-9999,-9999,0);var i=this.alphaMasks.masks[0];this.setMaskTransform(i,e,t,n,a)}},{key:"setItemMaskTransform",value:function(e,t,n,a){this.alphaMasks.masks[0].node.worldPosition=new j(-9999,-9999,0);var i=this.alphaMasks.masks[1];this.setMaskTransform(i,e,t,n,a)}},{key:"setMaskTransform",value:function(e,t,n,a,i){e.uiTransform.setContentSize(a,i),e.node.setWorldPosition(t,n,0)}}]),i}(f)).prototype,"background",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd=Qe(Ud.prototype,"alphaMasks",[Gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zd=Ud))||zd);n._RF.pop(),n._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var nf,af,rf,of,sf,lf,uf,cf,hf,pf,df,ff,vf,yf=a.ccclass,mf=a.property,gf=(Yd=yf("GuideTextBox"),Xd=mf(u),Yd((Zd=Qe((Qd=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"guideText",Zd,Fe(e)),e}return Pe(i,[{key:"__preload",value:function(){this.opacityToggler=this.getComponent(yi),Ct.lazyValidateProperties(this)}},{key:"setText",value:function(e){this.guideText.string=e}},{key:"show",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.opacityToggler.changeStateFade(!0);case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.opacityToggler.changeStateFade(!1);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"guideText",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jd=Qd))||Jd);n._RF.pop(),n._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var bf,wf,kf,Sf,Cf,Ef,Af,Tf,xf,Rf,Pf,If,_f,Lf,Of,Df,Mf,Nf,Ff,Bf=game,Gf=Bf.player,zf=Bf.analytics,Uf=a.ccclass,Hf=a.property,qf=GameCore.Plugins.Analytics.Events,Vf=new J(0,10),Wf=new J(0,10),Kf="READY",jf="RUNNING",Yf=(nf=Uf("GuidelinesManager"),af=Hf(xd),rf=Hf(gf),of=Hf(u),sf=Hf(tf),lf=Hf(i),nf((hf=Qe((cf=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"guideHand",hf,Fe(e)),Je(e,"guideTextBox",pf,Fe(e)),Je(e,"guideInfoText",df,Fe(e)),Je(e,"guideMasks",ff,Fe(e)),Je(e,"guideSkipButton",vf,Fe(e)),e.guideHintDelay=null,e.guideStormDelay=null,e}return Pe(a,[{key:"init",value:function(e){this.gameplay=e,this.status=Kf,this.node.scene.on($i.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on($i.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on($i.USE_ITEM,this.handleUseItem,this),this.node.scene.on($i.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on($i.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on($i.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(Xp)&&this.resetGuideItemShowed(),this.startGuide(Xp)):this.startGuide(Jp)}},{key:"startGuide",value:function(e){if(this.status===jf)return!1;if(this.hasGuideItemShowed(e))return!1;switch(this.addGuideItemShowed(e),this.status=jf,e){case Xp:zf.event(qf.TUTORIAL_BEGIN),this.guide1=new nd(this),this.guide1.setup();break;case Jp:this.guide2=new ad(this),this.guide2.setup();break;case Qp:this.guide3=new id(this),this.guide3.setup();break;case Zp:this.guide4=new rd(this),this.guide4.setup();break;case $p:this.guide5=new od(this),this.guide5.setup();break;case ed:this.guide6=new sd(this),this.guide6.setup();break;case td:this.guide7=new md(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(e){zf.event(qf.TUTORIAL_STEP,{step:e}),this.status=Kf,this.addGuideItemShowed(e),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){return this.getCurrentLevel()>=Vf.x&&this.getCurrentLevel()<=Vf.y}},{key:"isShowErrorPathLevel",value:function(){return this.getCurrentLevel()>=Wf.x&&this.getCurrentLevel()<=Wf.y}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(e){return this.getGuideItemShowed().includes(e)}},{key:"addGuideItemShowed",value:function(e){if(!this.hasGuideItemShowed(e)){var t=this.getGuideItemShowed();t.push(e),Gf.setGameData({guideItemShowed:t})}}},{key:"resetGuideItemShowed",value:function(){Gf.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var e,t;return null!==(e=null===(t=Gf.getGameData())||void 0===t?void 0:t.guideItemShowed)&&void 0!==e?e:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(e){this.isNewbieGuideLevel()||e<2||(this.startGuide(Qp),this.node.scene.off($i.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var e=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=new oe(this.node).delay(5).call((function(){e.isNewbieGuideLevel()||(e.hasGuideItemShowed(Zp)&&e.status===Kf?e.node.scene.emit($i.SHOW_HINT):e.startGuide(Zp),e.startHintGuide())}))),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var e=this;null===this.guideStormDelay&&(this.guideStormDelay=new oe(this.node).delay(10).call((function(){if(!e.isNewbieGuideLevel()&&!e.hasGuideItemShowed(ed)){var t=e.gameplay.itemManager.items.find((function(e){return e.itemType===Cs.STORM}));t&&t.canActivate()&&(e.startGuide(ed)||e.startStormGuide())}}))),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide($p)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(td)}},{key:"handleUseItem",value:function(e){switch(this.startAutoGuides(),e){case Cs.HINT:this.addGuideItemShowed(Zp);break;case Cs.THUNDER:this.addGuideItemShowed($p);break;case Cs.STORM:this.addGuideItemShowed(ed);break;case Cs.PLIERS:this.addGuideItemShowed(td)}}},{key:"skipNewbieGuide",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.guideSkipButton.active=!1,e.next=3,this.guide1.close();case 3:t=this.getCurrentLevel()+1,Gf.setGameData({level:t}),this.node.scene.emit($i.NEXT_LEVEL);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"guideHand",[af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pf=Qe(cf.prototype,"guideTextBox",[rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),df=Qe(cf.prototype,"guideInfoText",[of],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ff=Qe(cf.prototype,"guideMasks",[sf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vf=Qe(cf.prototype,"guideSkipButton",[lf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uf=cf))||uf);n._RF.pop(),n._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var Xf,Jf=a.ccclass,Qf=a.property,Zf=(bf=Jf("SpecialItem"),wf=Qf({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),kf=Qf({type:p,tooltip:"The button that activates the item"}),Sf=Qf({type:g,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),Cf=Qf({type:u,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),Ef=Qf({type:i,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),Af=Qf({type:i,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),Tf=Qf({type:M,group:"Animation"}),xf=Qf({type:M,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),bf((If=Qe((Pf=function(e){_e(r,e);var t,n,a,i=Ge(r);function r(){var e;xe(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=i.call.apply(i,[this].concat(n)),"isDevButton",If,Fe(e)),Je(e,"button",_f,Fe(e)),Je(e,"quantity",Lf,Fe(e)),Je(e,"quantityLabel",Of,Fe(e)),Je(e,"quantityNode",Df,Fe(e)),Je(e,"plusNode",Mf,Fe(e)),Je(e,"glowUIOpacity",Nf,Fe(e)),Je(e,"uiOpacity",Ff,Fe(e)),e.requestItem=null,e.loadQuantity=null,e}return Pe(r,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"init",value:function(e){var t=this;this.node.scene.on($i.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on($i.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on($i.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on($i.IDLE_EXIT,(function(){t.button.interactable=!1,t.applyActivationStatus()})),this.node.scene.on($i.IDLE_ENTER,(function(){t.button.interactable=!0,t.applyActivationStatus()}))}},{key:"start",value:function(){var e=this.loadQuantity();this.setQuantity(e)}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"applyActivationStatus",value:(a=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.canActivate(),this.button.interactable=t,e.next=4,mn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:t?255:128}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"activate",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.quantity<=0)){e.next=3;break}return this.requestItem(),e.abrupt("return");case 3:this.vibrate(),this.setQuantity(this.quantity-1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"canActivate",value:function(){return!1}},{key:"setQuantity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();e<0&&(e=0),this.quantity=e,this.quantityLabel.string="".concat(this.quantity),e<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),t&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}},{key:"getQuantity",value:function(){return this.quantity}},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;this.isDevButton||t&&this.setQuantity(e,t.animate)}},{key:"vibrate",value:function(){var e;null===(e=R("Vibrate"))||void 0===e||null===(e=e.getComponent(ws))||void 0===e||e.vibrate(50)}},{key:"animateAddItem",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.glowUIOpacity.opacity=0,e.abrupt("return",Promise.all([mn.runTweenAsync(S(this.node).to(.1,{scale:new j(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:j.ONE},{easing:"elasticOut"})),mn.runTweenAsync(S(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))]));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(f)).prototype,"isDevButton",[wf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_f=Qe(Pf.prototype,"button",[kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lf=Qe(Pf.prototype,"quantity",[Sf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Of=Qe(Pf.prototype,"quantityLabel",[Cf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Df=Qe(Pf.prototype,"quantityNode",[Ef],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mf=Qe(Pf.prototype,"plusNode",[Af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nf=Qe(Pf.prototype,"glowUIOpacity",[Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ff=Qe(Pf.prototype,"uiOpacity",[xf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rf=Pf))||Rf);n._RF.pop(),n._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var $f,ev=(0,a.ccclass)("ItemManager")(Xf=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).sceneItems=new Set,e}return Pe(n,[{key:"items",get:function(){return We(this.sceneItems)}},{key:"onLoad",value:function(){this.syncItems()}},{key:"syncItems",value:function(){var e=this,t=R("Canvas/UI");t&&t.getComponentsInChildren(Zf).forEach((function(t){t.node.activeInHierarchy&&e.sceneItems.add(t)}))}}]),n}(f))||Xf;n._RF.pop(),n._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var tv,nv=a.ccclass,av=GameCore.Utils,iv={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},rv=nv("LevelManager")($f=function(e){_e(i,e);var t,n,a=Ge(i);function i(){return xe(this,i),a.apply(this,arguments)}return Pe(i,[{key:"loadLevel",value:(n=Te(Se().mark((function e(){var t,n,a,i,r,o,s,l,u=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:1,n=u.length>1&&void 0!==u[1]?u[1]:yl,e.next=4,this.loadLevelData(t);case 4:return a=e.sent,this.levelData=a||this.levelData||iv,i=this.levelData,r=i.rows,o=i.columns,av.Device.isMobile()&&o>=6&&r>=10&&(this.levelData.columns=5,this.levelData.rows=10),s="".concat(Fn.TILE_SKIN_FOLDER,"/").concat(n),e.next=11,jn.loadSpriteFramesDirAsync(s);case 11:return l=e.sent,e.abrupt("return",l);case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadLevelData",value:(t=Te(Se().mark((function e(){var t,n,a,i,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:1,n=10,a=this.paddingZero("".concat(Math.floor(t/n)+1),3),i=t%n,e.next=6,jn.loadJsonAsync("".concat(Fn.LEVEL_DATA_FOLDER,"/").concat(a));case 6:if(r=e.sent){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",r[i]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"paddingZero",value:function(e,t){return Array(t-e.length).fill("0").join("")+e}}]),i}(f))||$f;n._RF.pop(),n._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var ov=(0,a.ccclass)("ScoreManager")(tv=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).currentScore=0,e.tournamentStartScore=0,e}return Pe(n,[{key:"addScore",value:function(e,t,n){var a=this.getLevelMultiplier(t),i=this.getComboMultiplier(n),r=Math.floor(this.currentScore+e*a*i),o=10*Math.ceil(r/10);this.setScore(o)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var e=Dl.getMatchMode();this.currentScore=e===GameCore.Match.Modes.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(e){this.currentScore=e,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"updateScore",value:function(){this.node.scene.emit($i.SCORE_UPDATED,this.currentScore)}},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(e){return 1+.1*(e-1)}},{key:"getComboMultiplier",value:function(e){return 1+.1*(e-1)}}]),n}(f))||tv;n._RF.pop(),n._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);var sv=GameCore,lv=sv.Configs,uv=sv.Plugins,cv=globalThis.game.ads,hv=function(){function e(){xe(this,e)}var t,n,a;return Pe(e,[{key:"canbeShowInSDK",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=GameSDK.getSDKName();return(null==t||!t.length||!t.includes(n))&&!(null!=e&&e.length&&!e.includes(n))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"preloadAds",value:(a=Te(Se().mark((function e(){var t,n,a,i,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=lv.Ads,n=t.Enabled,a=t.InterstitialAdOptions,i=t.RewardedVideoAdOptions,n){e.next=3;break}return e.abrupt("return");case 3:r=GameCore.Plugins.Ads.Types,o=r.INTERSTITIAL,s=r.REWARDED_VIDEO,a.forEach((function(e){var t=e.PlacementId;cv.loadAdAsync(o,t).catch((function(){}))})),i.forEach((function(e){var t=e.PlacementId;cv.loadAdAsync(s,t).catch((function(){}))}));case 6:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"showBannerAds",value:function(){var e=lv.Ads,t=e.Enabled,n=e.BannerDisplayAdOptions;if(t){var a=se.instance.getVisibleSize(),i=Za.worldSizeToCssSize(a.height*ks);n.forEach((function(e){var t=e.PlacementId,n=e.Position,a=e.BannerHeight;"bottom"===n&&a>i||cv.showBannerAdAsync(t).catch((function(e){}))}))}}},{key:"hideBannerAds",value:function(){var e=lv.Ads,t=e.Enabled,n=e.BannerDisplayAdOptions;t&&n.forEach((function(e){var t=e.PlacementId;cv.hideBannerAdAsync(t).catch((function(e){}))}))}},{key:"showInterstitialAdAsync",value:(n=Te(Se().mark((function e(t){var n,a,i,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.forLevel,a=void 0===n?1:n,i=t.includeSDK,r=t.excludeSDK,this.inst.canbeShowInSDK(i,r)){e.next=3;break}return e.abrupt("return",!1);case 3:if(!(lv.Gameplay.StartAdAtLevel>=a)){e.next=5;break}return e.abrupt("return",!1);case 5:if(o=uv.Ads,s=o.Types,l=o.Status,cv.canbeShowInterstitialAd()){e.next=8;break}return e.abrupt("return",!1);case 8:if(u=Date.now(),e.prev=9,ga.muteAudio(!0),iu.showLoadingNotificationScreen(),cv.getAdStatus(s.INTERSTITIAL)===l.FILLED){e.next=16;break}return e.next=16,cv.loadAdAsync(s.INTERSTITIAL);case 16:return e.next=18,cv.showAdAsync(s.INTERSTITIAL);case 18:return e.abrupt("return",!0);case 21:return e.prev=21,e.t0=e.catch(9),console.warn("showInterstitialAdAsync failed",e.t0),e.abrupt("return",!1);case 25:return e.prev=25,ga.muteAudio(!1),c=(Date.now()-u)/1e3,setTimeout((function(){iu.closeNotificationScreen()}),c>.5?0:.5),cv.loadAdAsync(s.INTERSTITIAL).catch((function(){})),e.finish(25);case 31:case"end":return e.stop()}}),e,this,[[9,21,25,31]])}))),function(e){return n.apply(this,arguments)})},{key:"showRewardVideoAdAsync",value:(t=Te(Se().mark((function e(t){var n,a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.includeSDK,a=t.excludeSDK,this.inst.canbeShowInSDK(n,a)){e.next=3;break}return e.abrupt("return",!1);case 3:if(i=uv.Ads,r=i.Types,o=i.Status,e.prev=4,ga.muteAudio(!0),iu.showLoadingNotificationScreen(),cv.getAdStatus(r.REWARDED_VIDEO)===o.FILLED){e.next=11;break}return e.next=11,cv.loadAdAsync(r.REWARDED_VIDEO);case 11:return e.next=13,cv.showAdAsync(r.REWARDED_VIDEO);case 13:return iu.closeNotificationScreen(),e.abrupt("return",!0);case 17:return e.prev=17,e.t0=e.catch(4),console.warn("showRewardVideoAdAsync failed",e.t0),e.t0 instanceof Object&&"code"in e.t0&&"USER_INPUT"===e.t0.code?iu.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2):iu.showNotificationScreen("No ads to display.",2),e.abrupt("return",!1);case 22:return e.prev=22,ga.muteAudio(!1),cv.loadAdAsync(r.REWARDED_VIDEO).catch((function(){})),e.finish(22);case 26:case"end":return e.stop()}}),e,this,[[4,17,22,26]])}))),function(e){return t.apply(this,arguments)})}]),e}();try{new hv}catch(e){console.error("AdsUtils",e)}n._RF.pop(),n._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);var pv=GameCore,dv=pv.Utils,fv=pv.Configs,vv=globalThis.game,yv=vv.leaderboard,mv=vv.player,gv=function(){function e(){var t=this;xe(this,e),this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(Date.now()-t.lastFetchGlobalTournament>t.maxTimeRefetch)){e.next=7;break}return e.next=5,yv.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"});case 5:t.globalTournamentLBData=e.sent,t.globalTournamentLBData.sort((function(e,t){return e.expireTime-t.expireTime}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("fetchGlobalTournamentLeaderboardAsync",e.t0);case 12:return e.abrupt("return",t.globalTournamentLBData);case 13:case"end":return e.stop()}}),e,null,[[0,9]])}))),this.fetchTournamentsAsync=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(Date.now()-t.lastFetchTournamentsData>t.maxTimeRefetch)){e.next=7;break}return e.next=5,GameSDK.tournament.getTournamentsAsync();case 5:t.playerTournaments=e.sent,t.playerTournaments.sort((function(e,t){return e.getEndTime()-t.getEndTime()}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("fetchTournamentsAsync",e.t0);case 12:return e.abrupt("return",t.playerTournaments);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))}var t;return Pe(e,[{key:"processPlayerTournamentData",value:function(){var e,t=[],n=Ye(this.playerTournaments);try{for(n.s();!(e=n.n()).done;){var a,i,r=e.value,o="".concat(r.getID()),s=r.getContextID(),l=r.getEndTime(),u=this.parseTournamentPayload(r.getPayload());if(this.validateGameSDKTournamentPayload(u))if(!(l<Date.now()/1e3)&&"PAGE_HOSTED"!==r.getTournamentType()){var c=null!==(a=u.playerName)&&void 0!==a?a:"Player",h={id:o,title:null!==(i=r.getTitle())&&void 0!==i?i:this.createDefaultTournamentName(c),endTime:l,contextId:s,payload:u};t.push(h)}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"processGlobalTournamentLeaderboardData",value:function(){var e=[];if(fv.Mockup.Leaderboards.Enabled){for(var t=0;t<this.playerTournaments.length;t++){var n,a=this.playerTournaments[t],i=a.getTournamentType();if("PAGE_HOSTED"===i){var r="".concat(a.getID()),o=a.getContextID(),s=a.getEndTime(),l=this.parseTournamentPayload(a.getPayload()),u={id:r,title:null!==(n=a.getTitle())&&void 0!==n?n:"Global Tournament",endTime:s,contextId:o,payload:l,tournamentType:i};e.push(u)}}return e}for(var c=0;c<this.globalTournamentLBData.length;c++){var h,p={tournamentId:"",contextId:""},d=this.globalTournamentLBData[c];try{p=JSON.parse(d.description)}catch(e){continue}if(this.validateExpireTime(d)&&this.validateGlobalTournamentPayload(p)){var f={id:p.tournamentId,title:d.name,endTime:this.getTournamentEndTime(d),contextId:p.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:d._id,themeId:null!==(h=p.themeId)&&void 0!==h?h:gl.SUMMER}};e.push(f)}}return e}},{key:"validateGlobalTournamentPayload",value:function(e){var t=e.tournamentId,n=e.contextId;return!(!dv.Valid.isString(t)||""===t)&&!(!dv.Valid.isString(n)||""===n)}},{key:"getTournamentEndTime",value:function(e){var t=new Date(e.createdAt).getTime();return Math.round((1e3*e.expireTime+t)/1e3)}},{key:"validateExpireTime",value:function(e){return 1e3*this.getTournamentEndTime(e)-Date.now()>0}},{key:"validateGameSDKTournamentPayload",value:function(e){return!(!dv.Valid.isString(e.playerId)||""===e.playerId)&&(!(!dv.Valid.isString(e.playerName)||""===e.playerName)&&!(!dv.Valid.isString(e.leaderboardId)||""===e.leaderboardId))}},{key:"createDefaultTournamentName",value:function(e){var t=e.substring(0,7),n="".concat(t.split(" ")[0]||t,"'s Tournament"),a=GameCore.Utils.String.removeDiacritics(n);return"".concat(a)}},{key:"parseTournamentPayload",value:function(e){if("string"!=typeof e)return{};try{return JSON.parse(e)}catch(e){return{}}}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"requestTournamentDataAsync",value:(t=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getInstance(),e.next=3,Promise.all([t.fetchTournamentsAsync(),t.fetchGlobalTournamentLeaderboardAsync()]);case 3:return n=t.processPlayerTournamentData(),a=t.processGlobalTournamentLeaderboardData(),t.tournamentData=[].concat(We(n),We(a)),t.tournamentData.sort((function(e,t){return e.endTime-t.endTime})),t.tournamentData.forEach((function(e){var t=e.payload.leaderboardId;yv.isExistLeaderboardId(t)||yv.addLeaderboard({type:"tournament",name:t,autoSortRank:!0,leaderboardId:t})})),e.abrupt("return",t.tournamentData);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getAllTournamentData",value:function(){return this.getInstance().tournamentData}},{key:"getTournamentDataById",value:function(e){return this.getInstance().tournamentData.find((function(t){return t.id===e}))}},{key:"getPlayerTournamentData",value:function(){var e=this.getInstance(),t=mv.getPlayerId();return e.tournamentData.filter((function(e){return e.payload.playerId===t}))}},{key:"getFriendsTournamentData",value:function(){var e=this.getInstance(),t=mv.getPlayerId();return e.tournamentData.filter((function(e){var n=e.payload;return n.playerId!==t&&"global"!==n.playerId}))}},{key:"getGlobalTournamentData",value:function(){return this.getInstance().tournamentData.filter((function(e){return"global"===e.payload.playerId}))}},{key:"validateTournamentExpired",value:function(e){var t=this.getTournamentDataById(e);return!!t&&t.endTime<Date.now()/1e3}}]),e}();n._RF.pop(),n._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var bv=function(){function e(t){xe(this,e),this.game=null,this.data={},this.game=t.getGameplay(),this.manager=t,this.updateStateData(),this.logDebug()}return Pe(e,[{key:"logDebug",value:function(){var e=this.constructor.name;console.info("[STATE] ".concat(e),this.data)}},{key:"updateStateData",value:function(){if(this.game){var e=this.game.getGameData();e&&(this.data=e)}}},{key:"updateGameData",value:function(e){var t;null===(t=this.game)||void 0===t||t.setGameData(e)}}]),e}();n._RF.pop(),n._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var wv=globalThis.game,kv=wv.analytics,Sv=wv.monitorError,Cv=wv.match,Ev=wv.player,Av=wv.storage,Tv=GameCore.Match.Modes,xv=function(e){_e(s,e);var t,n,a,i,r,o=Ge(s);function s(e,t){var n;return xe(this,s),n=o.call(this,e),ga.stopAllSounds(),n.vibrateDevice(),n.pauseCountdown(),n.updateMatchCustomData(),n.handleGameOver(t),n.logLevelFailAnalytics(),n}return Pe(s,[{key:"pauseCountdown",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var e;null===(e=R("Vibrate"))||void 0===e||null===(e=e.getComponent(ws))||void 0===e||e.vibrate(500)}},{key:"handleGameOver",value:(r=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=Dl.getMatchMode())!==Tv.SINGLE){e.next=6;break}return e.next=4,this.handleTournamentCreateFlow();case 4:e.next=14;break;case 6:if(n!==Tv.TOURNAMENT){e.next=11;break}return this.handleTournamentGameOver(),e.abrupt("return");case 11:if(n!==Tv.CHALLENGE_FRIEND){e.next=14;break}return this.handleChallengeGameOver(),e.abrupt("return");case 14:this.showFailScreen(t);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"handleTournamentCreateFlow",value:(i=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Dl.processCreateTournamentAsync();case 3:e.next=12;break;case 5:if(e.prev=5,e.t0=e.catch(0),!(e.t0 instanceof dl)){e.next=9;break}return e.abrupt("return");case 9:return e.t0 instanceof pl&&(null==Sv||Sv.sendException(e.t0)),console.error(e.t0),e.abrupt("return");case 12:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(){return i.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(a=Te(Se().mark((function e(){var t,n,a,i,r,o,s,l,u,c=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null===(t=Dl.getMatchCustomData())||void 0===t?void 0:t.tournamentId){e.next=3;break}return e.abrupt("return");case 3:if(!gv.validateTournamentExpired(a)){e.next=10;break}return Av.setStorageData("tournament","animateTournamentLeader",!1),iu.showNotificationScreen("Tournament has ended",2),null===(i=this.game)||void 0===i||i.scheduleOnce((function(){var e;null===(e=c.game)||void 0===e||e.node.scene.emit($i.GAME_EXIT)}),2),e.abrupt("return");case 10:return e.prev=10,e.next=13,Dl.finishMatchAsync();case 13:s=Cv.getMatchState(),l=s.profiles,u=null!==(r=Av.getStorageData("tournament","previousScore"))&&void 0!==r?r:0,(null!==(o=l[Ev.getPlayerId()].score)&&void 0!==o?o:0)>u&&Av.setStorageData("tournament","animateTournamentLeader",!0),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(10),console.warn(e.t0);case 22:null===(n=this.game)||void 0===n||n.node.scene.emit($i.GAME_EXIT);case 23:case"end":return e.stop()}}),e,this,[[10,19]])}))),function(){return a.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(n=Te(Se().mark((function e(){var t,n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Cv.getMatchState(),n=t.id,e.next=4,Cv.api.getMatchAPI().getMatchDetailByIdAsync(n);case 4:return a=e.sent,i=new GameCore.Dtos.Match.Data(a).toObject().extraData,e.next=8,Dl.finishMatchAsync({extraData:null!=i?i:void 0});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.warn(e.t0);case 13:this.game.node.scene.emit($i.SHOW_CHALLENGE_RESULTS);case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return n.apply(this,arguments)})},{key:"showFailScreen",value:(t=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.data.level,!this.game){e.next=4;break}return e.next=4,hv.showInterstitialAdAsync({forLevel:n});case 4:ga.turnOffMusic(),t===ou&&ga.playSound(Zn.LEVEL_FAIL_TIMEOUT),ga.playSound(Zn.LEVEL_FAIL),iu.openScreen(na,{level:n,failKey:t});case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var e,t,n=this.data.level,a=void 0===n?1:n,i=null!==(e=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore())&&void 0!==e?e:0;Dl.updateMatchStateAfterLevelFinish(a,i)}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore();kv.levelFail(t,n)}}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){}}]),s}(bv);n._RF.pop(),n._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var Rv=globalThis.game,Pv=Rv.analytics,Iv=Rv.player,_v=Rv.leaderboard,Lv=Rv.match,Ov=Rv.monitorError,Dv=GameCore.Match.Modes,Mv=function(e){_e(s,e);var t,n,a,i,r,o=Ge(s);function s(e){var t;return xe(this,s),(t=o.call(this,e)).handleFinishStateFlow(),t}return Pe(s,[{key:"handleFinishStateFlow",value:(r=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),ga.turnUpMusic(),null===(t=this.game)||void 0===t||t.uiManager.pauseTime(),(n=Dl.getMatchMode())!==Dv.CHALLENGE_FRIEND&&this.updatePlayerProgress(),this.updateMatchCustomData(),this.handlePostScoreToLeaderboard(),n!==Dv.CHALLENGE_FRIEND){e.next=12;break}this.handleChallengeOver(),e.next=15;break;case 12:return e.next=14,this.handleTournamentCreateFlow();case 14:this.showLevelCompleteScreen();case 15:this.logLevelCompleteAnalytics();case 16:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"handleChallengeOver",value:(i=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Lv.getMatchState(),n=t.id,e.next=4,Dl.getMatchExtraDataAsync(n);case 4:return a=e.sent,e.next=7,Dl.finishMatchAsync({extraData:null!=a?a:void 0});case 7:e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(0),console.warn(e.t0),e.next=14,Dl.finishMatchAsync();case 14:this.game.node.scene.emit($i.SHOW_CHALLENGE_RESULTS);case 15:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(){return i.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"updateMatchCustomData",value:function(){var e,t,n=this.data.level,a=void 0===n?1:n,i=null!==(e=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore())&&void 0!==e?e:0;Dl.updateMatchStateAfterLevelFinish(a,i)}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore();Pv.levelComplete(t,n)}}},{key:"showLevelCompleteScreen",value:(a=Te(Se().mark((function e(){var t,n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=this.data.level,ga.turnOffMusic(),ga.playSound(Zn.LEVEL_COMPLETE),i=null!==(t=null===(n=Iv.getGameData())||void 0===n?void 0:n.coins)&&void 0!==t?t:0,iu.openScreen(ua,{level:a,currentCoin:i});case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"updatePlayerProgress",value:function(){if(this.game){var e=this.data.level;if(e){var t=e+1,n=Iv.getGameData();if(n){var a=n.totalLevel,i=n.level,r=Math.max(i,t),o=ke({},n);r<a&&(o.level=r),Iv.setGameData(o)}}}}},{key:"attemptCallCreateShortcut",value:function(){var e=this.data.level;(void 0===e?0:e)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("createShortcutAsync",e)}))}},{key:"handleTournamentCreateFlow",value:(n=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dl.getMatchMode()===Dv.SINGLE){e.next=3;break}return e.abrupt("return");case 3:if(t=Iv.getGameData()){e.next=6;break}return e.abrupt("return");case 6:if(n=t.lastCreateTournamentShown,a=void 0===n?0:n,Date.now()-a>3e5){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,e.next=13,Dl.processCreateTournamentAsync();case 13:e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(10),!(e.t0 instanceof dl)){e.next=19;break}return e.abrupt("return");case 19:return e.t0 instanceof pl&&(null==Ov||Ov.sendException(e.t0)),console.error(e.t0),e.abrupt("return");case 22:case"end":return e.stop()}}),e,null,[[10,15]])}))),function(){return n.apply(this,arguments)})},{key:"handlePostScoreToLeaderboard",value:(t=Te(Se().mark((function e(){var t,n,a,i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dl.getMatchMode()===Dv.TOURNAMENT){e.next=3;break}return e.abrupt("return");case 3:if(n=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore()){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,e.next=9,GameSDK.tournament.postScoreAsync(n);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),console.warn("GameSDK post score async",e.t0);case 14:if(a=Dl.getMatchCustomData()){e.next=17;break}return e.abrupt("return");case 17:if(i=a.leaderboardId,r=a.playerId,i&&r){e.next=20;break}return e.abrupt("return");case 20:return e.next=22,_v.setLeaderboardScoreAsync(i,r,n);case 22:case"end":return e.stop()}}),e,this,[[6,11]])}))),function(){return t.apply(this,arguments)})},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),s}(bv);n._RF.pop(),n._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var Nv=globalThis.game,Fv=Nv.player,Bv=Nv.match,Gv=GameCore.Match.Modes,zv=function(e){_e(i,e);var t,n,a=Ge(i);function i(e){var t;return xe(this,i),(t=a.call(this,e)).handleGameStart=function(){var e=Te(Se().mark((function e(n){var a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.game.levelManager.getLevelData(),t.game.board.create(n,i),t.game.board.setIgnoreInput(!0),e.next=5,t.game.board.animateTilesAppear();case 5:null!==(a=t.game.guidelinesManager)&&void 0!==a&&a.isNewbieGuideLevel()||t.game.board.setIgnoreInput(!1),t.ready();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.enableUI(),t.clearBoard(),t.loadLevel(),t.initCountdown(),t.initScore(),t}return Pe(i,[{key:"enableUI",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.enableHeader()}},{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(n=Te(Se().mark((function e(){var t,n,a,i,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.game){e.next=2;break}return e.abrupt("return");case 2:if(t=Dl.getMatchMode(),e.prev=3,t!==Gv.CHALLENGE_FRIEND){e.next=20;break}return n=Bv.getMatchState(),a=n.id,e.next=8,Dl.getMatchExtraDataAsync(a);case 8:if(null!=(i=e.sent)){e.next=11;break}throw new Error("Match mode ".concat(Gv.CHALLENGE_FRIEND," but no extraData (for opponent initialization) was found in match data."));case 11:return r=this.getLevelSkin(i.level),e.next=14,this.game.levelManager.loadLevel(i.level,r);case 14:o=e.sent,this.updateGameData({level:i.level,levelData:this.game.levelManager.getLevelData()}),ga.playSound(Zn.LEVEL_START),this.handleChallengeFriendGameStart(o,i),e.next=27;break;case 20:return s=this.getLevelSkin(this.data.level),e.next=23,this.game.levelManager.loadLevel(this.data.level,s);case 23:l=e.sent,this.updateGameData({levelData:this.game.levelManager.getLevelData()}),ga.playSound(Zn.LEVEL_START),this.handleGameStart(l);case 27:e.next=39;break;case 29:return e.prev=29,e.t0=e.catch(3),console.error("Error loading level:",e.t0),u=this.getLevelSkin(this.data.level),e.next=35,this.game.levelManager.loadLevel(this.data.level,u);case 35:c=e.sent,this.updateGameData({levelData:this.game.levelManager.getLevelData()}),ga.playSound(Zn.LEVEL_START),this.handleGameStart(c);case 39:this.updateGameData({levelData:this.game.levelManager.getLevelData()});case 40:case"end":return e.stop()}}),e,this,[[3,29]])}))),function(){return n.apply(this,arguments)})},{key:"getLevelSkin",value:function(e){var t=Cl.getLevelSkin(e),n=Cl.getUnlockedSkins();if(n.length<=1)return t;if(G.random()<=.5)return t;var a=n.indexOf(t);return n.splice(a,1),n[G.randomRangeInt(0,n.length)]}},{key:"handleChallengeFriendGameStart",value:(t=Te(Se().mark((function e(t,n){var a,i,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.game.levelManager.getLevelData(),i=n.level,r=n.fen,o=n.gravity,s=n.rules,l=n.time,u=Fv.getPlayerId(),e.next=5,Promise.all([Dl.setMatchCustomDataAsync({level:i,score:0}),Dl.setProfileMatchDataAsync({id:u,score:0})]);case 5:return this.game.board.create(t,ke(ke({},a),{},{level:i,customFen:r,mode:o,rules:s,time:l})),this.game.board.setIgnoreInput(!0),e.next=9,this.game.board.animateTilesAppear();case 9:this.game.board.setIgnoreInput(!1),this.ready();case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.initCurrentScore()}},{key:"initCountdown",value:function(){this.game&&this.game.uiManager.initCountdown()}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"pause",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),i}(bv);n._RF.pop(),n._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var Uv=function(e){_e(n,e);var t=Ge(n);function n(e){var a;return xe(this,n),(a=t.call(this,e)).startCountdown(),a}return Pe(n,[{key:"startCountdown",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.startCountdown()}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"playing",value:function(){}},{key:"fail",value:function(e){var t=this.manager.createFailState(this.manager,e);this.manager.change(t)}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){this.updateStateData()}}]),n}(bv);n._RF.pop(),n._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var Hv,qv=globalThis.game,Vv=qv.analytics,Wv=qv.match,Kv=function(e){_e(n,e);var t=Ge(n);function n(e){var a;return xe(this,n),a=t.call(this,e),ga.stopAllSounds(),ga.turnDownMusic(),a.handleGuideFlow(),a.setLevelText(),a.setLevelTime(),a.setGridPlayable(),a.logLevelStartAnalytics(),a}return Pe(n,[{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(e){if(GameCore.Utils.Valid.isDebugger()){var t=this.manager.createFailState(this.manager);this.manager.change(t)}}},{key:"finish",value:function(){if(GameCore.Utils.Valid.isDebugger()){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var e;null!==(e=this.manager.getGameplay().guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var e,t;null!==(e=this.game.guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.game.handleShowUI(),null===(t=this.game.guidelinesManager)||void 0===t||t.show()}},{key:"setLevelTime",value:function(){if(this.game){var e=this.data.levelData;e&&this.game.uiManager.setCountdownTime(e.time)}}},{key:"setLevelText",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e;this.game.uiManager.setLevelText(t)}}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=Wv.getMatchState().customData.score,a=void 0===n?0:n;Vv.levelStart(t,a)}}}]),n}(bv);n._RF.pop(),n._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var jv,Yv,Xv,Jv,Qv,Zv=(0,a.ccclass)("StateManager")(Hv=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(e){this.gameplay=e,this.state=new zv(this)}},{key:"change",value:function(e){this.state=e}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return this.state instanceof zv}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return this.state instanceof Kv}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return this.state instanceof Uv}},{key:"fail",value:function(e){this.state.fail(e)}},{key:"isFail",value:function(){return this.state instanceof xv}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return this.state instanceof Mv}},{key:"update",value:function(e){this.state&&this.state.update(e)}},{key:"createInitializeState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Me(zv,t)}},{key:"createReadyState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Me(Kv,t)}},{key:"createPlayingState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Me(Uv,t)}},{key:"createFailState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Me(xv,t)}},{key:"createFinishState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Me(Mv,t)}}]),n}(f))||Hv;n._RF.pop(),n._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);var $v,ey,ty,ny,ay,iy,ry,oy=a.ccclass,sy=a.property,ly=(jv=oy("Digit"),Yv=sy(u),jv((Qv=Qe((Jv=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"numberLabels",Qv,Fe(e)),e.labelUITransforms=[],e.labelUIOpacitys=[],e.previousNumber=0,e}return Pe(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.labelUITransforms=this.numberLabels.map((function(e){return e.getComponent(s)})),this.labelUIOpacitys=this.numberLabels.map((function(e){return e.getComponent(M)})),Ct.lazyValidateProperties(this)}},{key:"setNumber",value:function(e){this.previousNumber!==e&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[e].node.active||(this.numberLabels[e].node.active=!0),this.labelUIOpacitys[e].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[e].contentSize),this.previousNumber=e)}}]),n}(f)).prototype,"numberLabels",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xv=Jv))||Xv);n._RF.pop(),n._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var uy,cy=a.ccclass,hy=a.disallowMultiple,py=a.property,dy=($v=cy("Clock"),ey=py(i),ty=py(ly),$v(ny=hy((iy=Qe((ay=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"clockIcon",iy,Fe(e)),Je(e,"digits",ry,Fe(e)),e.time=0,e.remaining=0,e.running=!1,e.halfTime=!1,e.handleUpdateConfig=function(t){e.enabled&&console.log("Clock: handleUpdateConfig",t)},e.refillTime=function(){var t=Date.now(),n=S(e.node).to(.5,{scale:new j(1.1,1.1,1)}),a=S(e.node).to(.5,{scale:new j(1,1,1)}),i=S(e.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),r=S(e.clockIcon).repeat(5,i),o=S(e.node).to(3,{position:new j(0,0,0)},{onUpdate:function(){var n=Date.now(),a=(n-t)/3e3>1?1:(n-t)/3e3,i=G.lerp(0,120,a);e.setTime(i)}}).call((function(){e.setTime(120),a.start(),e.node.scene.emit($i.RESCUE_FINISHED)}));S(e.node).parallel(n,o).start(),r.start()},e}return Pe(n,[{key:"__preload",value:function(){this.listenEvents()}},{key:"start",value:function(){this.init()}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"listenEvents",value:function(){this.node.scene.on(Tn,this.handleUpdateConfig),this.node.scene.on($i.RESCUE_START,this.refillTime)}},{key:"setTime",value:function(e){this.time=e,this.updateTimeLabel(e),this.remaining=e}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit($i.TIME_OUT)}},{key:"update",value:function(e){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=e,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit($i.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}},{key:"updateTimeLabel",value:function(e){for(var t=this.convertSecondsToMmSs(e),n=0;n<t.length;n++)this.digits[n].setNumber(parseInt(t[n]))}},{key:"convertSecondsToMmSs",value:function(e){var t=Math.floor(e/60),n=Math.floor(e%60),a=this.padZero(t),i=this.padZero(n);return"".concat(a).concat(i)}},{key:"padZero",value:function(e){return e<10?"0".concat(e):"".concat(e)}}]),n}(f)).prototype,"clockIcon",[ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ry=Qe(ay.prototype,"digits",[ty],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ny=ay))||ny)||ny);n._RF.pop(),n._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var fy,vy,yy,my,gy,by,wy,ky,Sy,Cy=a.ccclass,Ey=Cy("ComboProgressBar")(uy=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"start",value:function(){this.progressBar=this.getComponent(io),this.opacity=this.getComponent(M),this.comboTimer=0,this.isActive=!1,this.node.scene.on($i.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(e){this.isActive&&(this.comboTimer>0?(this.comboTimer-=e,this.progressBar.progress=this.comboTimer/3):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit($i.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>0&&(this.isActive=!0,this.comboTimer=3),e>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),n}(f))||uy;n._RF.pop(),n._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var Ay,Ty,xy,Ry,Py,Iy,_y,Ly,Oy,Dy,My,Ny,Fy,By,Gy,zy,Uy,Hy=a.ccclass,qy=a.property,Vy=(fy=Hy("ScoreBlock"),vy=qy(T),yy=qy(O),my=qy(u),fy((wy=Qe((by=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"avatar",wy,Fe(e)),Je(e,"defaultAvatar",ky,Fe(e)),Je(e,"scoreText",Sy,Fe(e)),e}return Pe(i,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){this.node.scene.on($i.SCORE_UPDATED,this.updateScore,this)}},{key:"unListenGameEvents",value:function(){this.node.scene.off($i.SCORE_UPDATED,this.updateScore,this)}},{key:"updateInfo",value:(n=Te(Se().mark((function e(t,n){var a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n?(this.score=n,this.scoreText.string=n.toString()):(this.score=0,this.scoreText.string="0"),e.prev=1,e.next=4,GameCore.Utils.Image.loadImage(t);case 4:if(a=e.sent){e.next=7;break}return e.abrupt("return");case 7:(i=O.createWithImage(a)).packable=!0,this.avatar.spriteFrame=i,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.avatar.spriteFrame=this.defaultAvatar;case 15:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e,t){return n.apply(this,arguments)})},{key:"updateScore",value:(t=Te(Se().mark((function e(t){var n,a,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t-this.score,a=S(this.node).to(.1,{},{onUpdate:function(e,t){if(t){var a=Math.floor(n*t)+i.score;i.scoreText.string=a.toString()}}}),e.next=4,mn.runTweenAsync(a);case 4:this.scoreText.string=t.toString(),this.score=t;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),i}(f)).prototype,"avatar",[vy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ky=Qe(by.prototype,"defaultAvatar",[yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sy=Qe(by.prototype,"scoreText",[my],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gy=by))||gy);n._RF.pop(),n._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var Wy,Ky,jy,Yy,Xy,Jy=a.ccclass,Qy=a.property,Zy=globalThis.game,$y=(Zy.language,Zy.match),em=(Ay=Jy("Header"),Ty=Qy(u),xy=Qy(i),Ry=Qy(i),Py=Qy(i),Iy=Qy(i),_y=Qy(Vy),Ly=Qy(Vy),Ay((My=Qe((Dy=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"levelText",My,Fe(e)),Je(e,"settingNode",Ny,Fe(e)),Je(e,"homeNode",Fy,Fe(e)),Je(e,"leftNode",By,Fe(e)),Je(e,"coinNode",Gy,Fe(e)),Je(e,"playerScoreBlock",zy,Fe(e)),Je(e,"opponentScoreBlock",Uy,Fe(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"handleClickedPauseGame",value:function(){this.showSettingScreen(),this.node.scene.emit($i.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){iu.openScreen(ha),this.node.scene.emit($i.GAME_PAUSE)}},{key:"highlightCoinContainer",value:function(){var e=R("Canvas/Screens");if(e){var t=this.coinNode.worldPosition.clone();this.coinNode.parent=e,this.coinNode.worldPosition=t}}},{key:"removeCoinContainerHighlight",value:function(){var e=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=e}},{key:"showSettingScreen",value:function(){iu.openScreen(oa,{})}},{key:"setLevelText",value:function(e){this.levelText.string="Level ".concat(e)}},{key:"setButtonsSelectable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enableBtnNode(this.settingNode,e,!0),this.enableBtnNode(this.homeNode,e,!0)}},{key:"showChallengeScoreBlock",value:function(){var e=$y.getMatchState(),t=e.id,n=e.customData,a=n.playerId,i=n.opponentId;if(t&&a&&i){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0,this.playerScoreBlock.listenGameEvents();var r=e.profiles[a],o=e.profiles[i];this.playerScoreBlock.updateInfo(r.photo,r.score),this.opponentScoreBlock.updateInfo(o.photo,o.score)}}},{key:"hideChallengeScoreBlock",value:function(){this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1}},{key:"enableBtnNode",value:function(e,t,n){var a=e.getComponent(p);if(a&&(a.interactable=t),e.active=n,n)e.getComponent(yi)}}]),n}(f)).prototype,"levelText",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ny=Qe(Dy.prototype,"settingNode",[xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fy=Qe(Dy.prototype,"homeNode",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),By=Qe(Dy.prototype,"leftNode",[Py],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gy=Qe(Dy.prototype,"coinNode",[Iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zy=Qe(Dy.prototype,"playerScoreBlock",[_y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uy=Qe(Dy.prototype,"opponentScoreBlock",[Ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oy=Dy))||Oy);n._RF.pop(),n._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var tm=a.ccclass,nm=a.property,am=(Wy=tm("UIMasks"),Ky=nm(yi),Wy((Xy=Qe((Yy=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"background",Xy,Fe(e)),e}return Pe(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"show",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.background.node.active=!0,e.next=3,this.background.changeStateFade(!0,.25);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.background.changeStateFade(!1,.25);case 2:this.background.node.active=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"background",[Ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jy=Yy))||jy);n._RF.pop(),n._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var im,rm,om,sm,lm,um="bomb";n._RF.pop(),n._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var cm,hm,pm,dm,fm,vm,ym,mm,gm,bm,wm,km,Sm,Cm,Em,Am,Tm,xm,Rm,Pm=GameCore.Dtos.Player,Im=GameCore.Utils.Function,_m=a.ccclass,Lm=a.property,Om=globalThis.game.player,Dm=(im=_m("DevToolsContainer"),rm=Lm(i),im((lm=Qe((sm=function(e){_e(r,e);var t,n,a,i=Ge(r);function r(){var e;xe(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=i.call.apply(i,[this].concat(n)),"devToolsToggle",lm,Fe(e)),e.isActive=!0,e.game=null,e.debouncedStarsNotification=Im.debounce((function(){var e=Om.getGameData();e&&iu.showNotificationScreen("Stars added. Current stars: ".concat(e.stars))}),700),e}return Pe(r,[{key:"injectGameplay",value:function(e){this.game=e}},{key:"hideAllButtons",value:function(){var e=this;this.getComponentsInChildren(p).forEach((function(t){var n=t.node.parent;n&&n.name!==e.devToolsToggle.name&&(n.active=!1)}))}},{key:"showAllButtons",value:function(){var e=this;this.getComponentsInChildren(p).forEach((function(t){var n=t.node.parent;n&&n.name!==e.devToolsToggle.name&&(n.active=!0)}))}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){Om.setPlayerData(Pm.Data.getDefaultData()),iu.openScreen(la,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit($i.START_OVER)}},{key:"handleNextLevel",value:(a=Te(Se().mark((function e(){var t,n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=(null!==(t=null===(n=this.game)||void 0===n||null===(n=n.getGameData())||void 0===n?void 0:n.level)&&void 0!==t?t:1)+1,null===(a=this.game)||void 0===a||a.setGameData({level:i-1}),Om.setGameData({level:i}),this.node.scene.emit($i.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"handlePrevLevel",value:(n=Te(Se().mark((function e(){var t,n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Math.max((null!==(t=null===(n=this.game)||void 0===n||null===(n=n.getGameData())||void 0===n?void 0:n.level)&&void 0!==t?t:2)-1,1),null===(a=this.game)||void 0===a||a.setGameData({level:i-1}),Om.setGameData({level:i}),this.node.scene.emit($i.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(t=Te(Se().mark((function e(t){var n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Number(t.string),null===(n=this.game)||void 0===n||n.setGameData({level:a-1}),Om.setGameData({level:a}),this.node.scene.emit($i.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var e=globalThis.game.getBuildVersion();iu.showNotificationScreen("Build version: ".concat(e))}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit($i.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){this.node.scene.emit($i.TIME_OUT)}},{key:"handleClickExplodeButton",value:function(){var e,t,n=this.game;if(n){var a=null===(e=n.getGameData())||void 0===e||null===(e=e.levelData)||void 0===e?void 0:e.specials.bomb;if(a&&!(a<=0)){var i=n.board.getBombTiles();if(0!==i.length){var r=i[0];if((null===(t=r.special)||void 0===t?void 0:t.type)!==um)throw new Error("Invalid bomb tile");r.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit($i.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Cs.HINT,quantity:2}),this.node.scene.emit($i.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Cs.STORM,quantity:2}),this.node.scene.emit($i.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Cs.THUNDER,quantity:2}),this.node.scene.emit($i.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Cs.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit($i.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var e=Om.getGameData();e&&(Om.setGameData({stars:e.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchBundle",value:function(){x.emit(_n)}}]),r}(f)).prototype,"devToolsToggle",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om=sm))||om);n._RF.pop(),n._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var Mm,Nm,Fm,Bm,Gm,zm,Um,Hm,qm,Vm=a.ccclass,Wm=a.property,Km=GameCore,jm=Km.Utils,Ym=Km.Match,Xm=globalThis.game.match,Jm=(cm=Vm("UIManager"),hm=Wm(dy),pm=Wm(em),dm=Wm(Dm),fm=Wm(Ey),vm=Wm(i),ym=Wm(am),mm=Wm([i]),gm=Wm([i]),cm((km=Qe((wm=function(e){_e(o,e);var t,n,a,i,r=Ge(o);function o(){var e;xe(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=r.call.apply(r,[this].concat(n)),"clock",km,Fe(e)),Je(e,"header",Sm,Fe(e)),Je(e,"devTools",Cm,Fe(e)),Je(e,"comboProgressBar",Em,Fe(e)),Je(e,"comboContainer",Am,Fe(e)),Je(e,"uiMasks",Tm,Fe(e)),Je(e,"topAnimNodes",xm,Fe(e)),e.originTopNodesPos=[],Je(e,"botAnimNodes",Rm,Fe(e)),e.originBotNodesPos=[],e.hideBotWorldY=-80,e.entranceSignal=new ui,e.exitSignal=new ui,e.showDevTools=function(){e.devTools&&(e.devTools.node.active=!0)},e}return Pe(o,[{key:"onLoad",value:function(){var e=this;this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),d.once(Q.EVENT_AFTER_UPDATE,(function(){e.saveOriginPos(),e.initUIPos()}))}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var e=this;this.topAnimNodes.forEach((function(t){e.originTopNodesPos.push(t.position.clone())})),this.botAnimNodes.forEach((function(t){e.originBotNodesPos.push(t.position.clone())}))}},{key:"initUIPos",value:function(){var e=this;this.topAnimNodes.forEach((function(t,n){var a=e.originTopNodesPos[n].clone();a.y+=200,t.setPosition(a)}));var t=new j(0,this.hideBotWorldY,0);this.botAnimNodes.forEach((function(n,a){var i,r,o=e.originBotNodesPos[a].clone();t.y=e.hideBotWorldY;var s=null!==(i=null===(r=n.parent)||void 0===r?void 0:r.inverseTransformPoint(t,t).y)&&void 0!==i?i:200;o.y=s,n.setPosition(o)}))}},{key:"listensDevToolsEvents",value:function(){this.node.scene.on(zs.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}},{key:"listenRescueEvents",value:function(){this.node.scene.on($i.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on($i.RESCUE_FINISHED,this.hideRescueAnimation,this)}},{key:"initDevTools",value:function(e){var t=this;window.addEventListener("reset-game-data",(function(){var e;null===(e=t.devTools)||void 0===e||e.handleResetData()})),this.devTools&&(this.devTools.node.active=jm.Valid.isDebugger(),this.devTools.injectGameplay(e))}},{key:"setLevelText",value:function(e){this.header.setLevelText(e)}},{key:"initCountdown",value:function(){this.clock.init()}},{key:"setCountdownTime",value:function(e){this.clock.setTime(e)}},{key:"startCountdown",value:function(){this.clock.startCountdown()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause(),this.clock.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume(),this.clock.resume()}},{key:"setComboUI",value:function(e){this.comboContainer.getComponent(yi).changeStateFade(e,.1)}},{key:"disableHeader",value:function(){this.header.setButtonsSelectable(!1)}},{key:"enableHeader",value:function(){this.header.setButtonsSelectable()}},{key:"updateStatus",value:function(){Xm.getMatchState().mode===Ym.Modes.CHALLENGE_FRIEND?this.header.showChallengeScoreBlock():this.header.hideChallengeScoreBlock()}},{key:"showRescueAnimation",value:(i=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uiMasks.show();case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"hideRescueAnimation",value:(a=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uiMasks.hide();case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"playExitAnimUI",value:(n=Te(Se().mark((function e(){var t,n,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new ui,t=[],this.topAnimNodes.forEach((function(e,n){var i=a.originTopNodesPos[n].clone();i.y+=200;var r=S(e);r.to(.17,{position:i},{easing:"backIn"}),t.push(mn.runTweenAsync(r,a.exitSignal))})),n=new j(0,this.hideBotWorldY,0),this.botAnimNodes.forEach((function(e,i){var r,o,s=a.originBotNodesPos[i].clone();n.y=a.hideBotWorldY;var l=null!==(r=null===(o=e.parent)||void 0===o?void 0:o.inverseTransformPoint(n,n).y)&&void 0!==r?r:200;s.y=l;var u=S(e);u.to(.17,{position:s},{easing:"backIn"}),t.push(mn.runTweenAsync(u,a.exitSignal))})),e.next=9,Promise.all(t);case 9:if(!this.exitSignal.aborted){e.next=11;break}return e.abrupt("return");case 11:this.header.node.active=!1;case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(t=Te(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new ui,this.header.node.active=!0,t=[],this.topAnimNodes.forEach((function(e,a){var i=S(e);i.to(.2,{position:n.originTopNodesPos[a]},{easing:"backOut"}),t.push(mn.runTweenAsync(i,n.entranceSignal))})),this.botAnimNodes.forEach((function(e,a){var i=S(e);i.to(.2,{position:n.originBotNodesPos[a]},{easing:"backOut"}),t.push(mn.runTweenAsync(i,n.entranceSignal))})),e.next=9,Promise.all(t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"setInteractableItemButtons",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.botAnimNodes.forEach((function(t){var n=t.getComponent(Zf);if(n){if(!e)return void(n.button.interactable=!1);n.canActivate()&&(n.button.interactable=!0)}}))}}]),o}(f)).prototype,"clock",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sm=Qe(wm.prototype,"header",[pm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cm=Qe(wm.prototype,"devTools",[dm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Em=Qe(wm.prototype,"comboProgressBar",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am=Qe(wm.prototype,"comboContainer",[vm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tm=Qe(wm.prototype,"uiMasks",[ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xm=Qe(wm.prototype,"topAnimNodes",[mm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Rm=Qe(wm.prototype,"botAnimNodes",[gm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bm=wm))||bm);n._RF.pop(),n._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var Qm=globalThis.game,Zm=Qm.player,$m=Qm.ads,eg=Qm.event,tg=Qm.match,ng=Qm.storage,ag=Qm.analytics,ig=Qm.monitorError,rg=Qm.frameCapture,og=GameCore.Events,sg=GameCore.Match.Modes,lg=GameCore.Utils.Time,ug=GameCore.Configs.Gameplay,cg=a.ccclass,hg=a.property,pg=[];Mm=cg("Gameplay"),Nm=hg(eh),Fm=hg(yi),Bm=hg(Wh),Mm((Um=Qe((zm=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"board",Um,Fe(e)),Je(e,"opacityToggler",Hm,Fe(e)),Je(e,"pathDraw",qm,Fe(e)),e.gameData=null,e.defaultData={level:1,isMatchStartFromLoader:!1},e.rescueTiles=[],e.isAutoPlayEnabled=!1,e.handleOpenScreen=function(t){t.screenName===ia&&e.uiManager.highlightCoinContainer()},e.handleShowUI=Te(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.uiManager.updateStatus(),e.uiManager.disableHeader(),e.uiManager.setInteractableItemButtons(!1),t.next=5,e.uiManager.playEntranceAnimUI();case 5:e.uiManager.enableHeader(),e.uiManager.setInteractableItemButtons(!0);case 7:case"end":return t.stop()}}),t)}))),e.handleHideUI=Te(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.uiManager.disableHeader(),e.uiManager.setInteractableItemButtons(!1),t.next=4,e.uiManager.playExitAnimUI();case 4:case"end":return t.stop()}}),t)}))),e.handleCloseScreen=function(t){t.screenName===ia&&e.uiManager.unHighlightCoinContainer()},e.handlePauseGame=function(){e.node.scene.emit($i.PAUSE_TIME),e.node.pauseSystemEvents(!0),e.opacityToggler.changeStateFade(!1,.1),e.uiManager.setComboUI(!1),e.processCrazyGamesGameplayStop()},e.handleResumeGame=function(){var t;e.node.resumeSystemEvents(!0),e.stateManager.isPlaying()&&e.node.scene.emit($i.RESUME_TIME),e.processCrazyGamesGameplayStart(),e.opacityToggler.changeStateFade(!0,.1),e.uiManager.setComboUI(!0),null===(t=e.guidelinesManager)||void 0===t||t.startAutoGuides()},e.handleReplayGame=function(){var t=Te(Se().mark((function t(n){var a;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.handleHideHint(),a=ke(ke({},e.defaultData),n),t.prev=2,tg.getMatchState().mode!==sg.SINGLE){t.next=6;break}return t.next=6,Dl.finishMatchAsync();case 6:if(tg.getMatchState().mode===sg.CHALLENGE_FRIEND){t.next=9;break}return t.next=9,Dl.startMatchAsync();case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),console.warn("handleReplayGame",t.t0);case 14:e.setGameData(a),e.stateManager.initialize();case 16:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e){return t.apply(this,arguments)}}(),e.handleFinishGame=function(){var t;e.attemptCallCreateShortcut(),null!==(t=e.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()?(e.guidelinesManager.guideSkipButton.active=!1,e.handleNextLevel()):e.stateManager.finish()},e.handleNextLevel=Te(Se().mark((function t(){var n,a,i;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.gameData){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,tg.getMatchState().mode!==sg.SINGLE){t.next=6;break}return t.next=6,Dl.finishMatchAsync();case 6:return tg.getMatchState().mode===sg.TOURNAMENT&&e.scoreManager.updateTournamentStartScore(),t.next=9,Dl.startMatchAsync();case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),console.warn("handleReplayGame",t.t0);case 14:a=null!==(n=e.gameData.level)&&void 0!==n?n:1,i=a+1,e.setGameData({level:i}),e.stateManager.initialize(),console.log("Next level",e.gameData.level);case 19:case"end":return t.stop()}}),t,null,[[2,11]])}))),e.handleStartOver=Te(Se().mark((function t(){var n;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:Zm.setGameData({level:ug.Tutorial.Enabled?0:1}),e.gameData=Zm.getGameData(),e.stateManager.initialize(),console.info("Start over",null===(n=e.gameData)||void 0===n?void 0:n.level);case 4:case"end":return t.stop()}}),t)}))),e.handleMaxLevel=function(){e.gameData&&(e.initData(),iu.openScreen(ca,{level:e.gameData.level}),console.info("Max level",e.gameData.level))},e.handleExitGame=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{ng.setStorageData("dashboard","animateToCurrentLevel",!0),ng.setStorageData("collection","animateMapPackUnlock",!0)}catch(e){console.warn("handleExitGame",e)}case 1:case"end":return e.stop()}}),e)}))),e.handleTileClick=function(t){e.stateManager.playing(),e.board.handleTileClick(t),e.handleHideHint()},e.handleGridMatchSuccess=function(t,n){e.pathDraw.drawMatchPath(t,(function(t){var n=t.x,a=t.y;return e.board.getAnyTileWorldPosition(n,a)})),e.comboManager.addCombo(),e.handleAddScore(),e.effectManager.playClearFXAt([n[0].node.worldPosition,n[1].node.worldPosition])},e.handleGridMatchFail=function(t){var n;null!==(n=e.guidelinesManager)&&void 0!==n&&n.isShowErrorPathLevel()&&e.pathDraw.drawErrorPath(t,(function(t){var n=t.x,a=t.y;return e.board.getAnyTileWorldPosition(n,a)}))},e.checkIfGameIsFinish=function(){0===e.board.getUncleared().length&&e.node.scene.emit($i.GAME_FINISH)},e.handlePauseTime=function(){e.uiManager.pauseTime()},e.handleResumeTime=function(){e.uiManager.resumeTime()},e.handleClockTimeout=function(){e.stateManager.fail(ou)},e.handleHalfTime=function(){void 0!==e.guidelinesManager&&(e.board.getUncleared().length>=e.board.getCleared().length&&e.guidelinesManager.startThunderGuide()||e.board.getBombTiles().length>0&&e.guidelinesManager.startPliersGuide())},e.handleStartRescue=function(){var t,n;for(jn.setBlockInput(!0),e.board.setIgnoreInput(!0);e.rescueTiles.length>0;){var a=e.rescueTiles.pop();null==a||a.restore()}ag.levelRescue(null!==(t=null===(n=e.gameData)||void 0===n?void 0:n.level)&&void 0!==t?t:1)},e.handleFinishRescue=function(){jn.setBlockInput(!1),e.board.setIgnoreInput(!1)},e.handleBombExplode=function(){var t=Te(Se().mark((function t(n){var a;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.rescueTiles.push(n),e.board.setIgnoreInput(!0),jn.getBlockInput()||(ga.playSound(Zn.BOMB_EXPLODE_1),jn.setBlockInput(!0)),a=n.node.worldPosition,t.next=6,e.effectManager.createBombExplosionAt(new j(a.x,a.y,0));case 6:if(jn.setBlockInput(!1),!e.stateManager.isFail()){t.next=9;break}return t.abrupt("return");case 9:e.stateManager.fail(su);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleShowHint=function(){if(!e.pathDraw.isDrawingHint){var t=e.board.getHintPath();t&&(ga.playSound(Zn.HINT_ITEM),e.pathDraw.drawHintPath(t,(function(t){return e.board.getAnyTileWorldPosition(t.x,t.y)})),e.board.showHint())}},e.handleHideHint=function(){e.pathDraw.isDrawingHint&&(e.pathDraw.clearHintPath(),e.board.hideHint())},e.handleAddScore=function(){var t=e.levelManager.getLevelData().level,n=e.comboManager.getCombo();e.scoreManager.addScore(10,t,n)},e.handleUseItem=function(t){e.stateManager.playing(),t!==Cs.HINT&&e.handleHideHint()},e.handleAutoPlay=function(){e.isAutoPlayEnabled?e.disableAutoPlay():e.enableAutoPlay()},e.enableAutoPlay=function(){e.isAutoPlayEnabled=!0;e.node.scene.once($i.GAME_FINISH,(function(){e.disableAutoPlay()})),e.schedule(e.autoPlay,.5)},e.disableAutoPlay=function(){e.isAutoPlayEnabled=!1,e.unschedule(e.autoPlay)},e.autoPlay=function(){var t=e.board.getHintPath();if(!t)throw new Error("No path found");var n=t[0].a,a=t.slice(-1)[0].b,i=e.board.getTileAt(n.x,n.y),r=e.board.getTileAt(a.x,a.y);if(!i||!r)throw new Error("Tile is null");i.onClick(),r.onClick()},e.handleAddStars=function(t){var n=Zm.getGameData();if(!n)return Promise.resolve([]);Zm.setGameData({stars:n.stars+1});var a=t.startAnimationAt;a&&e.effectManager.playStarFXAt(a)},e.handleInviteFriends=Te(Se().mark((function t(){var n,a,i,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,iu.showLoadingScreen(),r=e.board.generateFenFromCurrentLevel(),o=null!==(n=Zm.getGameData())&&void 0!==n?n:{},s=o.level,l=void 0===s?1:s,l=Math.max(1,l),u=null!==(a=null===(i=e.gameData)||void 0===i?void 0:i.levelData)&&void 0!==a?a:{},c=u.mode,h=void 0===c?"":c,p=u.rules,d=void 0===p?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:p,f=u.time,v=void 0===f?0:f,rg.addWideframeRender("renderResultChallenge",ll),t.next=9,tg.context.choose.processAsync({playerId:Zm.getPlayerId(),fallbackSingleMode:!1,extraData:{level:l,fen:r,gravity:h,rules:d,time:v}});case 9:iu.closeLoadingScreen(),e.node.scene.emit($i.GAME_RESUME),e.node.scene.emit($i.GAME_REPLAY,{level:l}),t.next=24;break;case 14:if(t.prev=14,t.t0=t.catch(0),console.warn("Unable to invite friends",t.t0),iu.closeLoadingScreen(),iu.showNotificationScreen("Sorry, please try again later"),t.t0 instanceof Error){t.next=21;break}return t.abrupt("return");case 21:null==ig||ig.sendException(t.t0),e.node.scene.emit($i.GAME_RESUME),e.node.scene.emit($i.SHOW_UI);case 24:case"end":return t.stop()}}),t,null,[[0,14]])}))),e.handleReplayFriends=Te(Se().mark((function t(){var n,a,i,r,o,s,l,u,c,h,p,d,f,v,y;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=null!==(n=Zm.getGameData())&&void 0!==n?n:{},i=a.level,r=void 0===i?1:i,t.prev=1,l=tg.getMatchState().customData.opponentId){t.next=5;break}throw new Error("Opponent id is not found");case 5:return iu.showLoadingScreen(),u=e.board.generateFenFromCurrentLevel(),c=null!==(o=null===(s=e.gameData)||void 0===s?void 0:s.levelData)&&void 0!==o?o:{},h=c.mode,p=void 0===h?"":h,d=c.rules,f=void 0===d?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:d,v=c.time,y=void 0===v?0:v,t.next=10,tg.challenge.friend.processAsync({playerId:Zm.getPlayerId(),opponentId:l,extraData:{level:r,fen:u,gravity:p,rules:f,time:y}});case 10:iu.closeLoadingScreen(),e.node.scene.emit($i.GAME_RESUME),e.node.scene.emit($i.GAME_REPLAY,{level:r}),t.next=25;break;case 15:if(t.prev=15,t.t0=t.catch(1),console.warn("ReplayChallengeFriend",t.t0),iu.closeLoadingScreen(),iu.showNotificationScreen("Sorry, you cannot replay\nat this time.",3),t.t0 instanceof Error){t.next=22;break}return t.abrupt("return");case 22:null==ig||ig.sendException(t.t0),e.node.scene.emit($i.GAME_RESUME),e.node.scene.emit($i.GAME_REPLAY,{level:r});case 25:case"end":return t.stop()}}),t,null,[[1,15]])}))),e.handleAdShow=function(t){var n=t.placementId;n&&pg.includes(n)&&(pg.splice(pg.indexOf(n),1),$m.hideBannerAdAsync(n).catch((function(){})),0===pg.length&&eg.off(GameCore.Events.AD_SHOWING,e.handleAdShow))},e.handleAddItem=function(){var t=Te(Se().mark((function t(n){var a,i,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.animate,i=n.item,r=n.quantity,void 0!==(o=e.itemManager.items.find((function(e){return e.itemType===i})))){t.next=5;break}return console.warn("Item ".concat(i," not found")),t.abrupt("return");case 5:return s=o.getQuantity(),l=s+r,o.saveQuantity(l),e.uiManager.setInteractableItemButtons(!1),e.handlePauseGame(),t.next=12,a();case 12:o.setQuantity(l,!0),e.uiManager.setInteractableItemButtons(!0),e.handleResumeGame();case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Pe(n,[{key:"__preload",value:function(){this.initComponents(),Cl.init(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}},{key:"initUIManager",value:function(){var e;this.uiManager=null===(e=this.node.parent)||void 0===e?void 0:e.getComponentInChildren(Jm),this.uiManager.initDevTools(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(rv)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent(Zv)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(lu)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(Kp)}},{key:"initItemManager",value:function(){var e=this;this.itemManager=this.getComponent(ev),this.itemManager.syncItems(),this.itemManager.items.forEach((function(t){t.init(e)}))}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(up),this.comboManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(ov),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){ug.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(Yf),this.guidelinesManager.init(this))}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){pg=[],eg.off(GameCore.Events.AD_SHOWING,this.handleAdShow),eg.clear(og.OPENING_SCREEN),eg.clear(og.CLOSING_SCREEN),eg.on(og.OPENING_SCREEN,this.handleOpenScreen),eg.on(og.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on($i.SHOW_UI,this.handleShowUI),this.node.scene.on($i.HIDE_UI,this.handleHideUI),this.node.scene.on($i.GAME_PAUSE,this.handlePauseGame),this.node.scene.on($i.GAME_RESUME,this.handleResumeGame),this.node.scene.on($i.GAME_REPLAY,this.handleReplayGame),this.node.scene.on($i.GAME_FINISH,this.handleFinishGame),this.node.scene.on($i.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on($i.START_OVER,this.handleStartOver),this.node.scene.on($i.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on($i.GAME_EXIT,this.handleExitGame),this.node.scene.on($i.TILE_CLICK,this.handleTileClick),this.node.scene.on($i.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on($i.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on($i.PAUSE_TIME,this.handlePauseTime),this.node.scene.on($i.RESUME_TIME,this.handleResumeTime),this.node.scene.on($i.TIME_OUT,this.handleClockTimeout),this.node.scene.on($i.HALF_TIME,this.handleHalfTime),this.node.scene.on($i.RESCUE_START,this.handleStartRescue),this.node.scene.on($i.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on($i.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on($i.SHOW_HINT,this.handleShowHint),this.node.scene.on($i.ADD_SCORE,this.handleAddScore),this.node.scene.on($i.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on($i.USE_ITEM,this.handleUseItem),this.node.scene.on($i.ADD_ITEM,this.handleAddItem),this.node.scene.on($i.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on($i.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on($i.INVITE_FRIENDS,this.handleInviteFriends),this.node.scene.on($i.REPLAY_FRIENDS,this.handleReplayFriends)}},{key:"start",value:function(){this.initDataFirstTime(),this.initGame()}},{key:"initDataFirstTime",value:function(){var e=this.getSceneData(),t=(null!=e?e:{}).isMatchStartFromLoader,n=void 0!==t&&t,a=(null!=e?e:{}).level;void 0===a&&(a=Dl.getMatchMode()===sg.TOURNAMENT?1:0),this.initData(),this.setGameData({isMatchStartFromLoader:n,level:a})}},{key:"initData",value:function(){var e,t=null!==(e=Zm.getGameData())&&void 0!==e?e:{},n=t.level,a=void 0===n?1:n,i=t.items;i&&this.checkItemsRewardable()&&(i.hint<5&&(i.hint+=1),i.thunder<5&&(i.thunder+=1),i.storm<5&&(i.storm+=1),i.pliers<5&&(i.pliers+=1),Zm.setGameData({items:i,lastRewardedItems:Date.now()})),this.setGameData(ke(ke({},this.defaultData),{},{level:a}))}},{key:"checkItemsRewardable",value:function(){var e,t=(null!==(e=Zm.getGameData())&&void 0!==e?e:{}).lastRewardedItems,n=void 0===t?0:t;return!lg.isToday(n)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"setGameData",value:function(e){var t,n,a,i=null!==(t=null!==(n=e.level)&&void 0!==n?n:null===(a=this.gameData)||void 0===a?void 0:a.level)&&void 0!==t?t:1;this.gameData=ke(ke(ke({},this.gameData),e),{},{level:i})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return Vl.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var e,t=null!==(e=this.getGameData())&&void 0!==e?e:{},n=t.level,a=void 0===n?0:n,i=t.nextLevelCount;a<2||(void 0===i?0:i)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("checkAndCreateShortcutAsync",e)}))}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),n}(f)).prototype,"board",[Nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hm=Qe(zm.prototype,"opacityToggler",[Fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qm=Qe(zm.prototype,"pathDraw",[Bm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gm=zm));n._RF.pop(),n._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var dg=function(e){return e[e.STAR_CHEST=0]="STAR_CHEST",e[e.BALLOON=1]="BALLOON",e}(dg||{});N(dg),n._RF.pop(),n._RF.push({},"8f431E6HDFDbJx4cwc1mRYd","DefaultMapData",void 0),n._RF.pop(),n._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var fg,vg=function(e){return e.WORLD_TAB_SELECTED="world-tab-selected",e.FRIENDS_TAB_SELECTED="friends-tab-selected",e}(vg||{}),yg="#AE4212",mg="#3D5172",gg="#92200C",bg="#8F5542",wg="#8A4733",kg="#3e7110",Sg="#3e7110";n._RF.pop(),n._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),n._RF.pop(),n._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),n._RF.pop(),n._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),n._RF.pop(),n._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var Cg,Eg=a.ccclass,Ag=globalThis.game,Tg=Ag.player,xg=Ag.analytics;Eg("HintItem")(fg=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return(e=n.call.apply(n,[this].concat(i))).requestItem=function(){iu.openScreen(ia,{item:Cs.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},e.loadQuantity=function(){var e=Tg.getGameData();return null!=e&&e.items&&e?e.items[Cs.HINT]:0},e}return Pe(a,[{key:"itemType",get:function(){return Cs.HINT}},{key:"init",value:function(e){this.boardInstance=e.board,this.pathDrawer=e.pathDraw,this.setQuantity(this.loadQuantity()),Ue(Le(a.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ue(Le(a.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ue(Le(a.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ue(Le(a.prototype),"validateRequiredComponents",this).call(this),Ct.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>0}catch(e){return!1}}},{key:"activate",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pathDrawer.isDrawingHint){e.next=2;break}return e.abrupt("return");case 2:if(!(this.getQuantity()<=0)){e.next=6;break}return e.next=5,Ue(Le(a.prototype),"activate",this).call(this);case 5:return e.abrupt("return");case 6:return e.next=8,Ue(Le(a.prototype),"activate",this).call(this);case 8:xg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Cs.HINT}),this.node.scene.emit($i.USE_ITEM,Cs.HINT),this.node.scene.emit($i.SHOW_HINT);case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ue(Le(a.prototype),"saveQuantity",this).call(this,e,t);var n=Tg.getGameData();n&&Tg.setGameData({items:ke(ke({},n.items),{},Ie({},Cs.HINT,e))})}}]),a}(Zf));n._RF.pop(),n._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var Rg,Pg=a.ccclass,Ig=globalThis.game,_g=Ig.player,Lg=Ig.analytics;Pg("PliersItem")(Cg=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return(e=n.call.apply(n,[this].concat(i))).requestItem=function(){iu.openScreen(ia,{item:Cs.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},e.loadQuantity=function(){var e=_g.getGameData();return null!=e&&e.items&&e?e.items[Cs.PLIERS]:0},e}return Pe(a,[{key:"itemType",get:function(){return Cs.PLIERS}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Ue(Le(a.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ue(Le(a.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ue(Le(a.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ue(Le(a.prototype),"validateRequiredComponents",this).call(this),Ct.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getBombTiles().length>0}catch(e){return!1}}},{key:"activate",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,Ue(Le(a.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,Ue(Le(a.prototype),"activate",this).call(this);case 6:Lg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Cs.PLIERS}),this.node.scene.emit($i.USE_ITEM,Cs.PLIERS),t=nc(this.boardInstance.getBombTiles()),n=t.node.worldPosition,this.effectManager.createDefuseExplosionAt(new j(n.x,n.y,0)),ga.playSound(Zn.BOMB_DEFUSE),t.special.switch(qu.none),this.applyActivationStatus();case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ue(Le(a.prototype),"saveQuantity",this).call(this,e,t);var n=_g.getGameData();n&&_g.setGameData({items:ke(ke({},n.items),{},Ie({},Cs.PLIERS,e))})}}]),a}(Zf));n._RF.pop(),n._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var Og,Dg=a.ccclass,Mg=globalThis.game,Ng=Mg.player,Fg=Mg.analytics;Dg("StormItem")(Rg=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return(e=n.call.apply(n,[this].concat(i))).requestItem=function(){iu.openScreen(ia,{item:Cs.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},e.loadQuantity=function(){var e=Ng.getGameData();return null!=e&&e.items&&e?e.items[Cs.STORM]:0},e}return Pe(a,[{key:"itemType",get:function(){return Cs.STORM}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Ue(Le(a.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ue(Le(a.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ue(Le(a.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ue(Le(a.prototype),"validateRequiredComponents",this).call(this),Ct.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>2}catch(e){return!1}}},{key:"activate",value:(t=Te(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,Ue(Le(a.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,Ue(Le(a.prototype),"activate",this).call(this);case 6:return Fg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Cs.STORM}),this.node.scene.emit($i.USE_ITEM,Cs.STORM),this.node.scene.emit($i.HIDE_UI),t=new Promise((function(e){return i.scheduleOnce(e,.5)})),e.next=12,Promise.race([this.effectManager.loadTornadoAnimation(),t]);case 12:n=function(){var e=Te(Se().mark((function e(t,n){var a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ga.muteMusic(!0),ga.playSound(Zn.SHUFFLE_ITEM),ga.playSound(Zn.WIND),a=function(){return Promise.all(t.map((function(e,n,a){return e.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return Xu(t,i.boardInstance.getTileSize(),{x:n,y:a},10)}})})))},r=function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.forEach((function(e,t,a){e.node.setSiblingIndex(n.asArray().length-1-(t+a*n.width))})),e.next=3,Promise.all(n.map((function(e){return e.fly({getTilePosition:function(e){return Xu(n,i.boardInstance.getTileSize(),e)}})})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=7,a();case 7:return i.effectManager.playTornadoAnimation(),e.next=10,r();case 10:i.node.scene.emit($i.SHOW_UI),ga.muteMusic(!1);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.boardInstance.processShuffleRequest(n);case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ue(Le(a.prototype),"saveQuantity",this).call(this,e,t);var n=Ng.getGameData();n&&Ng.setGameData({items:ke(ke({},n.items),{},Ie({},Cs.STORM,e))})}}]),a}(Zf));n._RF.pop(),n._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var Bg,Gg=a.ccclass,zg=globalThis.game,Ug=zg.player,Hg=zg.analytics;Gg("ThunderItem")(Og=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return(e=n.call.apply(n,[this].concat(i))).requestItem=function(){iu.openScreen(ia,{item:Cs.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},e.loadQuantity=function(){var e=Ug.getGameData();return null!=e&&e.items&&e?e.items[Cs.THUNDER]:0},e}return Pe(a,[{key:"itemType",get:function(){return Cs.THUNDER}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,Ue(Le(a.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=Ue(Le(a.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=Ue(Le(a.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){Ue(Le(a.prototype),"validateRequiredComponents",this).call(this),Ct.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>=4}catch(e){return!1}}},{key:"activate",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,Ue(Le(a.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,Ue(Le(a.prototype),"activate",this).call(this);case 6:return Hg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Cs.THUNDER}),this.node.scene.emit($i.USE_ITEM,Cs.THUNDER),this.node.scene.emit($i.HIDE_UI),e.next=11,this.effectManager.loadThunderAnimation();case 11:if(ga.muteMusic(!0),!((t=this.boardInstance.getUncleared()).length<4)){e.next=15;break}throw new Error("Not enough uncleared tiles");case 15:return n=this.boardInstance.getPairs(2),jn.setBlockInput(!0),this.boardInstance.clearSelectedTile(),e.next=20,this.effectManager.playThunderAnimation(n,this.boardInstance);case 20:t.length>4&&this.node.scene.emit($i.SHOW_UI),ga.muteMusic(!1),jn.setBlockInput(!1);case 23:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;Ue(Le(a.prototype),"saveQuantity",this).call(this,e,t);var n=Ug.getGameData();n&&Ug.setGameData({items:ke(ke({},n.items),{},Ie({},Cs.THUNDER,e))})}}]),a}(Zf));n._RF.pop(),n._RF.push({},"0a97aK0agJOHb07cLs0JICj","PathHolder",void 0);var qg,Vg,Wg,Kg,jg,Yg,Xg,Jg,Qg,Zg,$g,eb,tb,nb=a.ccclass,ab=a.requireComponent;nb("PathHolder")(Bg=ab(M)(Bg=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"onLoad",value:function(){var e=this;this.node.scene.on($i.GRID_CREATE,(function(t){e.node.scale=t.node.scale}))}}]),n}(f))||Bg);n._RF.pop(),n._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var ib,rb,ob,sb,lb,ub,cb,hb=a.ccclass,pb=a.property,db=(qg=hb("Coin"),Vg=pb(ie),Wg=pb(ie),Kg=pb(y),jg=pb(_),Yg=pb(_),qg((Qg=Qe((Jg=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"explodeParticles",Qg,Fe(e)),Je(e,"emittingParticles",Zg,Fe(e)),Je(e,"animation",$g,Fe(e)),Je(e,"spin",eb,Fe(e)),Je(e,"rest",tb,Fe(e)),e}return Pe(n,[{key:"__preload",value:function(){Ct.lazyValidateProperties(this)}},{key:"playAnimation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;t>0&&this.scheduleOnce((function(){null!=n&&n.aborted||e.animation.play(e.spin.name)}),t),this.animation.play(this.spin.name)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),n}(f)).prototype,"explodeParticles",[Vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zg=Qe(Jg.prototype,"emittingParticles",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$g=Qe(Jg.prototype,"animation",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eb=Qe(Jg.prototype,"spin",[jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tb=Qe(Jg.prototype,"rest",[Yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xg=Jg))||Xg);n._RF.pop(),n._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var fb,vb,yb,mb,gb,bb,wb,kb,Sb,Cb=a.ccclass,Eb=a.property,Ab=j.ZERO.clone().add3f(0,-100,0),Tb=j.ZERO.clone().add3f(0,100,0),xb=(ib=Cb("CoinTextPopup"),rb=Eb(u),ob=Eb(M),ib((ub=Qe((lb=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"label",ub,Fe(e)),Je(e,"uiOpacity",cb,Fe(e)),e}return Pe(a,[{key:"__preload",value:function(){Ct.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(t=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=GameCore.Utils.Number.getShortNumber(t,3),this.label.string=a,this.node.active=!0,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(Ab),e.next=8,Promise.all([mn.runTweenAsync(S(this.node).to(1.5,{position:Tb},{easing:"sineOut"}),n),mn.runTweenAsync(S(this.node).to(.5,{scale:j.ONE},{easing:"backOut"}),n)]);case 8:return this.node.setScale(j.ONE),this.node.setPosition(Tb),
//! not subscribed to signal because in the case the user skipped the animation we'd still want them to see this node disappear
e.next=12,mn.runTweenAsync(S(this.uiOpacity).to(.5,{opacity:0}));case 12:this.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),a}(f)).prototype,"label",[rb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cb=Qe(lb.prototype,"uiOpacity",[ob],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sb=lb))||sb);n._RF.pop(),n._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var Rb=a.ccclass,Pb=a.disallowMultiple,Ib=a.property,_b=globalThis.game,Lb=_b.player,Ob=_b.monitorError,Db=999999999,Mb=10,Nb=1,Fb=1,Bb=(fb=Rb("CoinManager"),vb=Ib(P),yb=Ib(P),mb=Ib(i),fb(gb=Pb((wb=Qe((bb=function(e){_e(s,e);var t,n,a,i,r,o=Ge(s);function s(){var e;xe(this,s);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=o.call.apply(o,[this].concat(n))).coins=0,Je(e,"coinPrefab",wb,Fe(e)),Je(e,"coinTextPopup",kb,Fe(e)),Je(e,"coinAnimContainer",Sb,Fe(e)),e.collectionAnimSignal=null,e.coinObjects=[],e}return Pe(s,[{key:"__preload",value:function(){this.lifeCycleSignal=new ui,this.validateRequiredComponents(),this.getCoinsFromPlayerData()}},{key:"onLoad",value:function(){this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(e){this.updateCoins({coins:this.coins,collectionAnimation:void 0}),this.animSkipOverlay=e}},{key:"listenToCoinEvents",value:function(){this.node.scene.on($i.ADD_COINS,this.addCoins,this),this.node.scene.on($i.REMOVE_COINS,this.removeCoins,this)}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"prepareCoinCollection",value:function(){for(var e=0;e<Mb;e++){var t=l(this.coinPrefab);t.setParent(this.coinAnimContainer),t.setPosition(0,0),t.active=!1,this.coinObjects.push(t.getComponent(db))}}},{key:"prepareCoinTextPopup",value:function(){var e=l(this.coinTextPopup);e.setParent(this.node),e.active=!1,this.coinTextPopupNode=e.getComponent(xb)}},{key:"handleCollectionAnim",value:(r=Te(Se().mark((function e(t,n,a){var i,r,o,s,l,u=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.targetContainer){e.next=3;break}return console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played"),e.abrupt("return");case 3:if(0!==(o=this.coinObjects.slice(0,this.getShortAmount(t))).length){e.next=8;break}return console.warn("Requested coins amount is ".concat(t,". Shortened to ").concat(this.getShortAmount(t),". No coin objects was found to animate collection.")),null==Ob||Ob.sendException(new Error("Requested coins amount is ".concat(t,". Shortened to ").concat(this.getShortAmount(t),". No coin objects was found to animate collection.")),{coins:t,animatedCoins:o.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!this.targetContainer,coinCollectionCount:this.coinObjects.length}),e.abrupt("return");case 8:return e.next=10,null===(i=this.animSkipOverlay)||void 0===i?void 0:i.open({onSkip:function(){return u.collectionAnimSignal.abort()},opacity:150});case 10:return ga.playSound(Zn.COLLECT_STOCK_COINS),s=o.map(function(){var e=Te(Se().mark((function e(t){var i,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.explodeParticles.stopSystem(),t.emittingParticles.stopSystem(),t.node.active=!0,i=[0,.5*Math.min(n,a)],r=ne.apply(void 0,i),o=n-r,s=a+r,e.next=9,u.animateCoinExplode(t.node,o);case 9:return t.playAnimation(2*r,u.collectionAnimSignal),t.emittingParticles.resetSystem(),e.next=13,u.animateCoinFlyBack(u.collectionAnimSignal,t,s);case 13:t.emittingParticles.stopSystem(),t.stopAnimation();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l=function(){var e=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(s);case 2:return e.next=4,null===(t=u.targetContainer)||void 0===t?void 0:t.emitExplodeEffect(u.collectionAnimSignal);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=15,Promise.all([l(),this.animateCoinTextPopup(t,this.collectionAnimSignal,n+a/2)]);case 15:return e.next=17,null===(r=this.animSkipOverlay)||void 0===r?void 0:r.close();case 17:this.collectionAnimSignal.abort();case 18:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"animateCoinTextPopup",value:(i=Te(Se().mark((function e(t,n,a){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.waitTweenAsync(a,n);case 2:return e.next=4,this.coinTextPopupNode.show(t,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"animateCoinFlyBack",value:(a=Te(Se().mark((function e(t,n,a){var i,r,o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=n.node.worldPosition.clone(),r=j.ZERO.clone(),o=this.targetContainer.getCoinIconWorldScale(),e.next=5,mn.runTweenAsync(S(n.node).to(a,{scale:o},{onUpdate:function(e,t){if(void 0!==t){var a=D.cubicIn(t),o=s.targetContainer.getCoinIconWorldPosition();n.node.worldPosition=j.lerp(r,i,o,a)}}}),t);case 5:n.node.scale=j.ZERO,this.explodeParticlesAndDisableAfter(1,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"explodeParticlesAndDisableAfter",value:(n=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=n.explodeParticles).resetSystem(),e.next=4,mn.waitTweenAsync(t/10,this.lifeCycleSignal);case 4:if(!ui.hasBeenAborted(this.lifeCycleSignal)){e.next=6;break}return e.abrupt("return");case 6:return a.stopSystem(),e.next=9,mn.waitTweenAsync(t/10*9,this.lifeCycleSignal);case 9:if(!ui.hasBeenAborted(this.lifeCycleSignal)){e.next=11;break}return e.abrupt("return");case 11:n.node.setPosition(0,0,n.node.position.z),n.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"animateCoinExplode",value:(t=Te(Se().mark((function e(t,n){var a,i,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=[-200,200],r=ne((a=[-200,200])[0],a[1]),o=ne(i[0],i[1]),t.setPosition(0,0,t.position.z),t.setScale(j.ZERO),s=new j(r,o,t.position.z),e.next=9,Promise.all([mn.runTweenAsync(S(t).delay(.1*n).to(.8*n,{scale:j.ONE},{easing:"elasticOut"}),this.collectionAnimSignal),mn.runTweenAsync(S(t).to(n,{position:s},{easing:"circOut"}),this.collectionAnimSignal)]);case 9:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var e=Lb.getGameData();this.coins=e?e.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(e){var t,n;if(console.info("updateCoins",e.coins,null===(t=e.collectionAnimation)||void 0===t?void 0:t.animateTextOnly),this.coins>Db&&(this.coins=Db),e.coins!==this.coins){var a=Math.max(0,e.coins-this.coins);this.coins=e.coins,Lb.setGameData({coins:this.coins});var i=e.collectionAnimation;if(void 0===i||i.animateTextOnly)this.node.scene.emit($i.COIN_CHANGED,ke(ke({},e),{},{collectionAnimation:{animateTextOnly:!0,signal:this.collectionAnimSignal}}));else{null===(n=this.collectionAnimSignal)||void 0===n||n.abort();var r=i.floatDuration,o=void 0===r?Nb:r,s=i.flyDuration,l=void 0===s?Fb:s,u=i.signal,c=void 0===u?new ui:u,h=i.target,p=void 0===h?this.targetContainer:h;this.collectionAnimSignal=c,this.targetContainer=p;var d=ke(ke({},e),{},{collectionAnimation:{floatDuration:o,flyDuration:l,animateTextOnly:!1,signal:c,target:p}});this.node.scene.emit($i.COIN_CHANGED,d),this.handleCollectionAnim(a,o,l)}}}},{key:"addCoins",value:function(e){this.updateCoins(ke(ke({},e),{},{coins:this.coins+e.coins}))}},{key:"removeCoins",value:function(e){this.coins<e.coins?this.node.scene.emit($i.REMOVE_COINS_FAILED):(this.updateCoins(ke(ke({},e),{},{coins:this.coins-e.coins})),this.node.scene.emit($i.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit($i.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(e){return Math.min(e,Mb)}},{key:"untilFinishesCollectAnim",value:function(){return null===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(e){this.targetContainer=e}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var e,t;null===(e=this.collectionAnimSignal)||void 0===e||e.abort(),null===(t=this.lifeCycleSignal)||void 0===t||t.abort()}}]),s}(f)).prototype,"coinPrefab",[vb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kb=Qe(bb.prototype,"coinTextPopup",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sb=Qe(bb.prototype,"coinAnimContainer",[mb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gb=bb))||gb)||gb);n._RF.pop(),n._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),n._RF.pop(),n._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),n._RF.pop(),n._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),n._RF.pop(),n._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),n._RF.pop(),n._RF.push({},"f3b1eQ+t3FJYa35I0oznLiF","ParticleProperties",void 0);var Gb,zb,Ub,Hb,qb,Vb=Pe((function e(){xe(this,e),this.lifeCurrent=0,this.life=0,this.velocityX=0,this.velocityY=0,this.alpha=255,this.totalRotation=0,this.lastChange=0,this.currentFrame=0}));n._RF.pop(),n._RF.push({},"32b8eGxcghFHZOi1WYXHCjF","BaseParticle",void 0);var Wb,Kb,jb,Yb,Xb,Jb,Qb,Zb=a.ccclass,$b=a.property,ew=(Gb=Zb("BaseParticle"),zb=$b(T),Gb((qb=Qe((Hb=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"sprite",qb,Fe(e)),e.properties=new Vb,e}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.sprite)throw new Error("BaseParticle: Sprite not found")}},{key:"manualInit",value:function(e,t){this.manager=e;var n=t.tint,a=t.velocityX,i=t.velocityY,o=t.totalRotation,s=t.lifespan,l=t.startAngle,u=t.scale;this.properties.lastChange=0;var c=new r;r.fromHEX(c,n),this.sprite.color=c,this.properties.velocityX=a,this.properties.velocityY=i,this.properties.life=s,this.properties.lifeCurrent=s,this.properties.totalRotation=o,this.node.angle=l,this.node.setScale(u,u,1)}},{key:"manualUpdate",value:function(e){return this.computeVelocity(e),this.node.setPosition(this.node.position.x+this.properties.velocityX*e,this.node.position.y+this.properties.velocityY*e,0),this.node.angle+=this.properties.totalRotation*e/this.properties.life,this.properties.lifeCurrent-=e,this.properties.lifeCurrent<=0}},{key:"computeVelocity",value:function(e){var t=this.properties,n=t.velocityX,a=t.velocityY;a+=this.manager.getGravityY()*e,this.properties.velocityX=n,this.properties.velocityY=a}}]),n}(f)).prototype,"sprite",[zb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ub=Hb))||Ub);n._RF.pop(),n._RF.push({},"b6123+a2K1LoY60oZO9SYKX","StarConfetti",void 0);var tw=a.ccclass,nw=a.property,aw=(Wb=tw("StarConfetti"),Kb=nw([O]),jb=nw([O]),Wb((Jb=Qe((Xb=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"starXFrames",Jb,Fe(e)),Je(e,"starYFrames",Qb,Fe(e)),e.msPerFrame=.15,e.isYoyo=!1,e.isGravityChanged=!1,e}return Pe(n,[{key:"manualInit",value:function(e,t){Ue(Le(n.prototype),"manualInit",this).call(this,e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}},{key:"manualUpdate",value:function(e){var t=Ue(Le(n.prototype),"manualUpdate",this).call(this,e);return this.updateGravity(),this.updateVelocity(),this.updateFrameRate(),this.updateFrames(e),t}},{key:"updateGravity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0;this.properties.velocityX/=3,this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2)){this.properties.velocityX>0?this.properties.velocityX+=G.randomRangeInt(-12,6):this.properties.velocityX+=G.randomRangeInt(-6,12)}}},{key:"updateFrames",value:function(e){if(this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame){this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=4&&(this.isYoyo=!0,this.properties.currentFrame-=1);var t=Math.random()>.5?this.starXFrames:this.starYFrames;this.sprite.spriteFrame=t[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame}}},{key:"updateFrameRate",value:function(){this.properties.lifeCurrent<this.properties.life-2?this.msPerFrame=.15:this.msPerFrame=G.randomRangeInt(300,600)/1e3}}]),n}(ew)).prototype,"starXFrames",[Kb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qb=Qe(Xb.prototype,"starYFrames",[jb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yb=Xb))||Yb);n._RF.pop(),n._RF.push({},"9caadUsaKtPEoOe+T2+pqtd","Properties",void 0);var iw,rw=Pe((function e(){xe(this,e),this.delay=200,this.timeScale=2,this.tints=["#F1D171","#97E1FD","#7765D1","#ED4440","#F9E02A"],this.speedX={min:1583/75,max:1583*.24},this.speedY={min:1139.76,max:1219.76},this.gravityY=-664.86,this.lifespan={min:5,max:8},this.rotate={totalRotation:1080,random:!0},this.scale={min:.6,max:1},this.originGravityY=-664.86}));n._RF.pop(),n._RF.push({},"d1648PsavVBn7B059PS5fj6","BaseEmitter",void 0);var ow,sw=(0,a.ccclass)("BaseEmitter")(iw=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).properties=new rw,e}return Pe(n,[{key:"getGravityY",value:function(){return this.properties.gravityY}},{key:"setGravityY",value:function(e){this.properties.gravityY=e}}]),n}(f))||iw;n._RF.pop(),n._RF.push({},"654983p4rREVKci1CE8cSJ2","ConfettiEmitter",void 0);var lw,uw,cw,hw,pw,dw,fw,vw,yw,mw,gw,bw=(0,a.ccclass)("ConfettiEmitter")(ow=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=a.call.apply(a,[this].concat(n))).activeStarConfetti=[],e}return Pe(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(n=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jn.loadPrefabAsync("particles/StarConfetti");case 2:this.starConfettiPrefab=e.sent,this.starConfettiPool=new dh((function(){var e=l(t.starConfettiPrefab);return t.node.addChild(e),e.active=!1,e}),0,(function(e){var n=e.getComponent(aw);n?(t.activeStarConfetti.push(n),e.active=!0):console.error("StarConfetti not found")}),(function(e){e.getComponent(aw)?e.active=!1:console.error("StarConfetti not found")}),(function(e){e.isValid&&e.destroy()})),this.properties.timeScale=1.5,this.properties.gravityY=688.605,this.properties.lifespan.min=4,this.properties.lifespan.max=6,this.properties.rotate.totalRotation=1800;case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"runEffect",value:(t=Te(Se().mark((function e(t,n,a){var i,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.starConfettiPool){e.next=3;break}return e.next=3,this.createConfettiPool();case 3:this.properties.gravityY=this.properties.originGravityY,i=0;case 5:if(!(i<t)){e.next=31;break}if(r=this.starConfettiPool.alloc(),o=r.getComponent(aw)){e.next=11;break}return console.error("StarConfetti not found"),e.abrupt("return");case 11:if(r.setPosition(n.clone()),s=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],l=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),u=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,c=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,h=this.properties.rotate.random?180*Math.random():0,p=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,d={tint:s,velocityX:l,velocityY:u,lifespan:c,totalRotation:this.properties.rotate.totalRotation,startAngle:h,scale:p},o.manualInit(this,d),f=this.starConfettiPool.alloc(),v=f.getComponent(aw)){e.next=25;break}return console.error("StarConfetti not found"),e.abrupt("return");case 25:f.setPosition(a.clone()),d.velocityX=-l,v.manualInit(this,d);case 28:i++,e.next=5;break;case 31:case"end":return e.stop()}}),e,this)}))),function(e,n,a){return t.apply(this,arguments)})},{key:"clearEffect",value:function(){var e,t=Ye(this.activeStarConfetti);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.starConfettiPool.free(n.node)}}catch(e){t.e(e)}finally{t.f()}this.activeStarConfetti=[]}},{key:"update",value:function(e){var t=this,n=e*this.properties.timeScale,a=[];this.activeStarConfetti.forEach((function(e){e.manualUpdate(n)&&a.push(e)})),a.forEach((function(e){t.starConfettiPool.free(e.node),t.activeStarConfetti.splice(t.activeStarConfetti.indexOf(e),1)}))}}]),i}(sw))||ow;n._RF.pop(),n._RF.push({},"78c97IkjeJFQohPZudvcfeS","Ribbon",void 0);var ww,kw,Sw,Cw,Ew,Aw=a.ccclass,Tw=a.property,xw=(lw=Aw("Ribbon"),uw=Tw([O]),cw=Tw([O]),hw=Tw([O]),pw=Tw([O]),lw((vw=Qe((fw=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"ribbonA",vw,Fe(e)),Je(e,"ribbonB",yw,Fe(e)),Je(e,"ribbonC",mw,Fe(e)),Je(e,"ribbonD",gw,Fe(e)),e.useFrames=[],e.msPerFrame=.15,e.isYoyo=!1,e.isGravityChanged=!1,e.points=[],e}return Pe(n,[{key:"manualInit",value:function(e,t){Ue(Le(n.prototype),"manualInit",this).call(this,e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=new Array(10).fill(null).map((function(){return{x:0,y:0}}));var a=Math.random();this.useFrames=a<.25?this.ribbonA:a<.5?this.ribbonB:a<.75?this.ribbonC:this.ribbonD,this.sprite.enabled=!1}},{key:"manualUpdate",value:function(e){var t=Ue(Le(n.prototype),"manualUpdate",this).call(this,e);return this.updateFrames(e),this.updatePoints(),this.updateGravity(),this.updateVelocity(),t}},{key:"updateFrames",value:function(e){this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame&&(this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=this.useFrames.length&&(this.isYoyo=!0,this.properties.currentFrame-=1),this.sprite.spriteFrame=this.useFrames[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame)}},{key:"updatePoints",value:function(){if(!this.isGravityChanged){this.points.shift();var e=this.node.worldPosition,t=e.x,n=e.y;this.points.push({x:t,y:n})}}},{key:"updateGravity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0,this.points=[],this.sprite.enabled=!0,this.properties.velocityX/=3;this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function(){if(!this.isGravityChanged){this.properties.lifeCurrent>this.properties.life-1.8?this.properties.velocityX+=G.randomRangeInt(-24,24):this.properties.velocityX>0?this.properties.velocityX+=G.randomRangeInt(-20,12):this.properties.velocityX+=G.randomRangeInt(-12,20)}}},{key:"getGlobalPoints",value:function(){return this.points}},{key:"getColor",value:function(){return this.sprite.color}}]),n}(ew)).prototype,"ribbonA",[uw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yw=Qe(fw.prototype,"ribbonB",[cw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mw=Qe(fw.prototype,"ribbonC",[hw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gw=Qe(fw.prototype,"ribbonD",[pw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dw=fw))||dw);n._RF.pop(),n._RF.push({},"f2427J2HhBKdpkcqDn2Vv5H","RibbonEmitter",void 0);var Rw,Pw,Iw,_w,Lw,Ow,Dw,Mw=a.ccclass,Nw=a.property,Fw=(ww=Mw("RibbonEmitter"),kw=Nw(V),ww((Ew=Qe((Cw=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"graphics",Ew,Fe(e)),e.activeRibbonConfetti=[],e}return Pe(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(n=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jn.loadPrefabAsync("particles/Ribbon");case 2:this.ribbonPrefab=e.sent,this.ribbonConfettiPool=new dh((function(){var e=l(t.ribbonPrefab);return t.node.addChild(e),e.active=!1,e}),0,(function(e){var n=e.getComponent(xw);n?(t.activeRibbonConfetti.push(n),e.active=!0):console.error("StarConfetti not found")}),(function(e){e.getComponent(xw)?e.active=!1:console.error("StarConfetti not found")}),(function(e){e.destroy()}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"runEffect",value:(t=Te(Se().mark((function e(t,n,a){var i,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ribbonConfettiPool){e.next=3;break}return e.next=3,this.createConfettiPool();case 3:this.properties.gravityY=this.properties.originGravityY,i=0;case 5:if(!(i<t)){e.next=31;break}if(r=this.ribbonConfettiPool.alloc(),o=r.getComponent(xw)){e.next=11;break}return console.error("StarConfetti not found"),e.abrupt("return");case 11:if(r.setPosition(n.clone()),s=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],l=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),u=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,c=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,h=this.properties.rotate.random?180*Math.random():0,p=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,d={tint:s,velocityX:l,velocityY:u,lifespan:c,totalRotation:this.properties.rotate.totalRotation,startAngle:h,scale:p},o.manualInit(this,d),f=this.ribbonConfettiPool.alloc(),v=f.getComponent(xw)){e.next=25;break}return console.error("StarConfetti not found"),e.abrupt("return");case 25:f.setPosition(a.clone()),d.velocityX=-l,v.manualInit(this,d);case 28:i++,e.next=5;break;case 31:case"end":return e.stop()}}),e,this)}))),function(e,n,a){return t.apply(this,arguments)})},{key:"clearEffect",value:function(){var e,t=Ye(this.activeRibbonConfetti);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.ribbonConfettiPool.free(n.node)}}catch(e){t.e(e)}finally{t.f()}this.activeRibbonConfetti=[]}},{key:"update",value:function(e){var t=this,n=e*this.properties.timeScale;this.graphics.clear();var a=[];this.activeRibbonConfetti.forEach((function(e){e.manualUpdate(n)&&a.push(e),t.drawGraphics(e.getGlobalPoints(),e.getColor())})),a.forEach((function(e){t.ribbonConfettiPool.free(e.node),t.activeRibbonConfetti.splice(t.activeRibbonConfetti.indexOf(e),1)}))}},{key:"drawGraphics",value:function(e,t){if(this.graphics.node.active){var n,a=Ye(e);try{for(a.s();!(n=a.n()).done;){if(0===n.value.y)return}}catch(e){a.e(e)}finally{a.f()}if(!(e.length<2)){this.graphics.strokeColor=t;var i=new j(e[0].x,e[0].y,0);i=this.node.inverseTransformPoint(i,i),this.graphics.moveTo(i.x,i.y);for(var r=1;r<e.length;r++)i.x=e[r].x,i.y=e[r].y,i=this.node.inverseTransformPoint(i,i),this.graphics.lineTo(i.x,i.y);this.graphics.stroke()}}}}]),i}(sw)).prototype,"graphics",[kw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sw=Cw))||Sw);n._RF.pop(),n._RF.push({},"f7cfcFAL8tBE70g2A0+qMTR","PaperConfetti",void 0);var Bw,Gw=a.ccclass,zw=a.property,Uw=(Rw=Gw("PaperConfetti"),Pw=zw(bw),Iw=zw(Fw),Rw((Ow=Qe((Lw=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).spawnLeftPos=new j(-375,-791.5,0),e.spawnRightPos=new j(375,-791.5,0),Je(e,"confettiEmitter",Ow,Fe(e)),Je(e,"ribbonEmitter",Dw,Fe(e)),e}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.confettiEmitter)throw new Error("PaperConfetti: ConfettiEmitter not found");if(!this.ribbonEmitter)throw new Error("PaperConfetti: RibbonEmitter not found")}},{key:"runEffect",value:function(){var e=this;this.scheduleOnce((function(){e.confettiEmitter.runEffect(25,e.spawnLeftPos,e.spawnRightPos)}),.2),this.ribbonEmitter.runEffect(20,this.spawnLeftPos,this.spawnRightPos)}},{key:"clearEffect",value:function(){this.unscheduleAllCallbacks(),this.confettiEmitter.clearEffect(),this.ribbonEmitter.clearEffect()}}]),n}(f)).prototype,"confettiEmitter",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dw=Qe(Lw.prototype,"ribbonEmitter",[Iw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_w=Lw))||_w);n._RF.pop(),n._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var Hw,qw,Vw,Ww,Kw,jw,Yw,Xw,Jw,Qw,Zw,$w=a.ccclass,ek=a.disallowMultiple,tk=GameCore,nk=tk.Events,ak=tk.Configs,ik=globalThis.game,rk=ik.ads,ok=ik.player,sk=ik.event;$w("BootScene")(Bw=ek(Bw=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).processWhenCoreBooted=function(){Vl.switchScene(Js)},e.processWhenGameSdkStarted=function(){e.setupGameData()},e.handlePauseAudio=function(){sk.on(nk.VISIBILITY_HIDDEN,e.handleMuteAudio),sk.on(nk.VISIBILITY_VISIBLE,e.handleUnMuteAudio),sk.on(nk.VISIBILITY_VISIBLE,e.handleForceEngineRunning)},e.handleMuteAudio=function(){ga.muteAudio(!0)},e.handleUnMuteAudio=function(){rk.isAdFullSizeShowing()||ga.muteAudio(!1)},e.handleForceEngineRunning=function(){d.resume()},e}return Pe(n,[{key:"__preload",value:function(){this.setupAndroidPlatformAds(),this.validateRequiredComponents(),this.listenEvents(),this.preloadScenes()}},{key:"preloadScenes",value:function(){Vl.preloadScene(Js)}},{key:"onLoad",value:function(){this.handlePauseAudio(),ak.Core.StartSDKAfterLoadGame||iu.showLoadingFullScreen(Js)}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){sk.getEventEmitCount(nk.CORE_BOOTING)>0?this.processWhenCoreBooted():sk.once(nk.CORE_BOOTING,this.processWhenCoreBooted),sk.once(nk.GAME_SDK_STARTED,this.processWhenGameSdkStarted)}},{key:"setupGameData",value:function(){var e=ok.getGameData();if(e){var t=e.totalLevel,n=ke(ke({},e),{},{totalLevel:0===t?80:t});ok.setGameData(n)}}},{key:"setupAndroidPlatformAds",value:function(){}}]),n}(f))||Bw);n._RF.pop(),n._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var lk,uk,ck,hk,pk,dk,fk,vk,yk,mk=a.ccclass,gk=a.property,bk=(Hw=mk("RigidBodyObject"),qw=gk(C),Vw=gk(J),Ww=gk(C),Kw=gk(H),Hw((Xw=Qe((Yw=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"gravityScale",Xw,Fe(e)),Je(e,"linearVelocity",Jw,Fe(e)),Je(e,"bounce",Qw,Fe(e)),Je(e,"simulate",Zw,Fe(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(o).getComponent(s),this.uiTransform=this.node.getComponent(s)}},{key:"update",value:function(e){if(this.simulate){this.applyGravity();var t=this.node.worldPosition.clone();t.add(new j(this.linearVelocity.x*e,this.linearVelocity.y*e,0)),t=this.applyBounce(t),this.node.setWorldPosition(t)}}},{key:"applyForce",value:function(e){this.linearVelocity.add(e)}},{key:"applyGravity",value:function(){var e=new J(0,-9.8*this.gravityScale);this.applyForce(e)}},{key:"applyBounce",value:function(e){var t=this.uiTransform.getBoundingBoxToWorld();t.yMin<0&&(e.y=t.height/2,this.linearVelocity.y*=-this.bounce),t.xMin<0&&(e.x=t.width/2,this.linearVelocity.x*=-1);var n=this.canvas.width;return t.xMax>n&&(e.x=n-t.width/2,this.linearVelocity.x*=-1),e}}]),n}(f)).prototype,"gravityScale",[qw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Jw=Qe(Yw.prototype,"linearVelocity",[Vw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new J(0,0)}}),Qw=Qe(Yw.prototype,"bounce",[Ww],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zw=Qe(Yw.prototype,"simulate",[Kw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jw=Yw))||jw);n._RF.pop(),n._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var wk,kk,Sk,Ck,Ek,Ak,Tk,xk,Rk,Pk=a.ccclass,Ik=a.property,_k=a.disallowMultiple,Lk=function(){},Ok=(lk=Pk("AnimSkipOverlay"),uk=Ik(M),ck=Ik(M),hk=Ik(p),lk(pk=_k((fk=Qe((dk=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"containerUIOpacity",fk,Fe(e)),Je(e,"maskUIOpacity",vk,Fe(e)),Je(e,"skipButton",yk,Fe(e)),e.isOpened=!1,e.currentCallback=Lk,e}return Pe(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"open",value:(n=Te(Se().mark((function e(t){var n,a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.containerUIOpacity.node.active=!0,n=t.onSkip,a=t.opacity,i=void 0===a?255:a,r=t.transitionDuration,o=void 0===r?.2:r,this.maskUIOpacity.opacity=i,e.next=5,this.animateUIOpacity(0,255,o);case 5:this.currentCallback=n,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(xn,t);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"close",value:(t=Te(Se().mark((function e(){var t,n=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:.2,this.skipButton.interactable=!1,this.currentCallback=Lk,e.next=5,this.animateUIOpacity(255,0,t);case 5:this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(Rn);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateUIOpacity",value:function(e,t,n){return this.containerUIOpacity.opacity=e,mn.runTweenAsync(S(this.containerUIOpacity).to(n,{opacity:t}))}},{key:"untilClosed",value:function(){var e=this;return!1===this.isOpened?Promise.resolve():new Promise((function(t){e.node.scene.once(Rn,t)}))}}]),i}(f)).prototype,"containerUIOpacity",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vk=Qe(dk.prototype,"maskUIOpacity",[ck],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yk=Qe(dk.prototype,"skipButton",[hk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pk=dk))||pk)||pk);n._RF.pop(),n._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var Dk,Mk,Nk,Fk,Bk,Gk,zk,Uk,Hk,qk,Vk,Wk,Kk,jk,Yk,Xk,Jk,Qk=a.ccclass,Zk=a.property,$k=GameCore.Utils.Number.getShortNumber,eS=(wk=Qk("CoinContainer"),kk=Zk(u),Sk=Zk(T),Ck=Zk(M),wk((Tk=Qe((Ak=function(e){_e(r,e);var t,n,a,i=Ge(r);function r(){var e;xe(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=i.call.apply(i,[this].concat(n)),"coinLabel",Tk,Fe(e)),Je(e,"coinIcon",xk,Fe(e)),Je(e,"explosionCircle",Rk,Fe(e)),e.currentCoin=0,e}return Pe(r,[{key:"setCoinText",value:function(e){this.coinLabel.string=e}},{key:"handleAddCoinButton",value:function(){iu.openScreen(ra,{quantity:Ps})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on($i.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(a=Te(Se().mark((function e(t){var n,a,i,r,o,s,l;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.coins,void 0!==(i=t.collectionAnimation)&&!1!==this.node.activeInHierarchy){e.next=4;break}return this.setCoins(a),e.abrupt("return");case 4:if(r=i.signal,null===(n=this.animAbortSignal)||void 0===n||n.abort(),this.animAbortSignal=null!=r?r:new ui,!i.animateTextOnly){e.next=12;break}return e.next=10,this.animateCoinText(a,0,r);case 10:return this.setCoins(a),e.abrupt("return");case 12:return o=i.flyDuration,s=i.floatDuration,l=s+o,e.next=17,this.animateCoinText(a,l,r);case 17:this.setCoins(a);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"setCoins",value:function(e){this.setCoinText($k(e,3)),this.currentCoin=e}},{key:"animateCoinText",value:(n=Te(Se().mark((function e(t,n,a){var i,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.currentCoin,e.next=3,mn.waitTweenAsync(n,a);case 3:return ga.playSound(Zn.COLLECT_COINS),e.next=6,mn.runTweenAsync(S({}).to(1,{},{easing:"quadOut",onUpdate:function(e,n){if(n){var a=Math.round(i+(t-i)*n);r.setCoinText($k(a,3))}}}),a);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,a){return n.apply(this,arguments)})},{key:"emitExplodeEffect",value:(t=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0),e.next=4,Promise.all([mn.runTweenAsync(S(this.explosionCircle.node).to(.4,{scale:new j(3,3,3)},{easing:"quadOut"}),t),mn.runTweenAsync(S(this.explosionCircle).delay(.2).to(.2,{opacity:0}),t)]);case 4:this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var e;null===(e=this.animAbortSignal)||void 0===e||e.abort()}}]),r}(f)).prototype,"coinLabel",[kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xk=Qe(Ak.prototype,"coinIcon",[Sk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rk=Qe(Ak.prototype,"explosionCircle",[Ck],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ek=Ak))||Ek);n._RF.pop(),n._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);var tS,nS,aS,iS,rS,oS,sS,lS,uS,cS,hS,pS,dS,fS,vS,yS,mS,gS,bS,wS,kS,SS=a.ccclass,CS=a.property,ES=globalThis.game.player,AS=[1e3,1500];Dk=SS("ItemContainer"),Mk=CS({type:i,group:"Hint"}),Nk=CS({type:u,group:"Hint"}),Fk=CS({type:i,group:"Thunder"}),Bk=CS({type:u,group:"Thunder"}),Gk=CS({type:i,group:"Storm"}),zk=CS({type:u,group:"Storm"}),Uk=CS(P),Dk((Vk=Qe((qk=function(e){_e(u,e);var t,n,a,i,r,s=Ge(u);function u(){var e;xe(this,u);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=s.call.apply(s,[this].concat(n)),"hintNode",Vk,Fe(e)),Je(e,"hintLabel",Wk,Fe(e)),e.hintCollection=[],Je(e,"thunderNode",Kk,Fe(e)),Je(e,"thunderLabel",jk,Fe(e)),e.thunderCollection=[],Je(e,"stormNode",Yk,Fe(e)),Je(e,"stormLabel",Xk,Fe(e)),e.stormCollection=[],Je(e,"itemPrefab",Jk,Fe(e)),e}return Pe(u,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(o).node,this.widget=this.getComponent(E),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(M),this.validateRequiredComponents(),this.listenToEvents()}},{key:"start",value:function(){this.prepareItemCollection()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on($i.ADD_ITEMS,this.handleAddItems,this)}},{key:"prepareItemCollection",value:function(){for(var e=0;e<9;e++){var t=l(this.itemPrefab),n=l(this.itemPrefab),a=l(this.itemPrefab);t.parent=this.canvas,n.parent=this.canvas,a.parent=this.canvas,t.active=!1,n.active=!1,a.active=!1,this.hintCollection.push(t.getComponent(bk)),this.thunderCollection.push(n.getComponent(bk)),this.stormCollection.push(a.getComponent(bk))}}},{key:"updateStatus",value:function(e){var t=e.items;this.hintLabel.string="".concat(t.hint),this.thunderLabel.string="".concat(t.thunder),this.stormLabel.string="".concat(t.storm)}},{key:"show",value:(r=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=255,t=S(this.widget).to(1.5,{right:0},{easing:"quadOut"}),e.next=4,mn.runTweenAsync(t,this.animAbortSignal);case 4:this.widget.right=0;case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"hide",value:(i=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"}),e.next=3,mn.runTweenAsync(t);case 3:this.uiOpacity.opacity=0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"handleAddItems",value:(a=Te(Se().mark((function e(t){var n,a,i,r,o=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.animAbortSignal=null!==(n=t.signal)&&void 0!==n?n:new ui,a=ES.getGameData()){e.next=4;break}return e.abrupt("return");case 4:return this.updateStatus(a),i=this.show(),r=t.items.map((function(e){return o.animateItemCollection(e.item,e.quantity,1.5)})),e.next=9,Promise.all([i].concat(We(r)));case 9:return a.items=ke(ke({},a.items),{},{hint:a.items.hint+t.items[0].quantity,thunder:a.items.thunder+t.items[1].quantity,storm:a.items.storm+t.items[2].quantity}),ES.setGameData(a),this.updateStatus(a),e.next=14,this.hide();case 14:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"animateItemCollection",value:(n=Te(Se().mark((function e(t,n,a){var i,r,o=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(i=this.getItemCollection(t).slice(0,n)).length){e.next=3;break}return e.abrupt("return");case 3:return r=i.map((function(e,n){e.node.active=!0,e.node.position=new j(0,0,e.node.position.z),e.linearVelocity=new J(0,0),e.simulate=!0;var i=ne(Math.PI/3,2*Math.PI/3),r=ne(AS[0],AS[1])*Math.cos(i),s=ne(AS[0],AS[1])*Math.sin(i);e.applyForce(new J(r,s));var l=o.getTargetNode(t);if(l)return e.getComponent(T).spriteFrame=l.getComponent(T).spriteFrame,o.getItemAnimation(e,l,a+.03*n)})),e.next=6,Promise.all(r);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,a){return n.apply(this,arguments)})},{key:"getItemCollection",value:function(e){switch(e){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}},{key:"getTargetNode",value:function(e){switch(e){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}},{key:"getItemAnimation",value:(t=Te(Se().mark((function e(t,n){var a,i,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>2&&void 0!==o[2]?o[2]:0,t.node.scale=new j(2,2,2),e.next=4,mn.waitTweenAsync(a,this.animAbortSignal);case 4:return i=t.node.worldPosition.clone(),r=S(t.node).to(1,{scale:n.scale},{onUpdate:function(e,a){if(e&&a){var r=D.cubicIn(a);n&&(t.node.worldPosition=i.lerp(n.worldPosition,r))}},onComplete:function(){t.node.setPosition(0,0),t.node.active=!1}}),e.next=8,mn.runTweenAsync(r,this.animAbortSignal);case 8:t.node.scale=n.scale.clone(),t.node.setPosition(0,0),t.node.active=!1;case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"onDestroy",value:function(){var e;null===(e=this.animAbortSignal)||void 0===e||e.abort()}}]),u}(f)).prototype,"hintNode",[Mk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wk=Qe(qk.prototype,"hintLabel",[Nk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kk=Qe(qk.prototype,"thunderNode",[Fk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jk=Qe(qk.prototype,"thunderLabel",[Bk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yk=Qe(qk.prototype,"stormNode",[Gk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xk=Qe(qk.prototype,"stormLabel",[zk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jk=Qe(qk.prototype,"itemPrefab",[Uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hk=qk));n._RF.pop(),n._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var TS,xS,RS,PS,IS,_S,LS,OS,DS,MS,NS,FS=a.ccclass,BS=a.property,GS=a.disallowMultiple,zS=a.requireComponent,US=(tS=FS("DashboardPage"),nS=zS(E),aS=zS(M),iS=BS({type:i,displayName:"Page's container"}),rS=BS({type:i,displayName:"Placeholder"}),oS=BS({displayName:"Don't load page",tooltip:"Tell the component to not preload the page even if it hasn't loaded yet"}),sS=BS({type:P,displayName:"Page prefab",visible:function(){return!this.hasLoaded}}),lS=BS({displayName:"Darken background"}),uS=BS({type:g,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),cS=BS({displayName:"Use navbar shadow"}),hS=BS({type:g,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),tS(pS=GS(pS=nS(pS=aS((fS=Qe((dS=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"container",fS,Fe(e)),Je(e,"placeholder",vS,Fe(e)),Je(e,"hasLoaded",yS,Fe(e)),Je(e,"pagePrefab",mS,Fe(e)),Je(e,"darkenBackground",gS,Fe(e)),Je(e,"backgroundOpacity",bS,Fe(e)),Je(e,"useNavbarShadow",wS,Fe(e)),Je(e,"navbarShadowOpacity",kS,Fe(e)),e}return Pe(i,[{key:"onLoad",value:function(){this.containerUIOpacity=this.container.getComponent(M),this.placeholderUIOpacity=this.placeholder.getComponent(M),this.widgetComponent=this.node.getComponent(E),this.uiOpacity=this.node.getComponent(M),this.validateRequiredComponents();var e=this.container.getComponent(A);this.layoutComponents=e?[e]:[],this.widgetComponents=[this.widgetComponent].concat(We(this.container.getComponentsInChildren(E)))}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"updateWidgets",value:function(){this.widgetComponents.forEach((function(e){e.updateAlignment()}))}},{key:"updateLayouts",value:function(){this.layoutComponents.forEach((function(e){e.updateLayout()}))}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasLoaded){e.next=3;break}return e.next=3,this.create();case 3:this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,ma.trackCurrentPage(this.node.name,!0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return this.hasLoaded}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(t=Te(Se().mark((function e(){var t,n,a,i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=2;break}return e.abrupt("return");case 2:if(!this.hasLoaded){e.next=4;break}return e.abrupt("return");case 4:return a=l(this.pagePrefab),i=a.getComponentsInChildren(E),(t=this.widgetComponents).push.apply(t,We(i)),r=a.getComponentsInChildren(A),(n=this.layoutComponents).push.apply(n,We(r)),this.container.addChild(a),e.next=12,mn.waitTweenAsync(0);case 12:this.hasLoaded=!0;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}}]),i}(f)).prototype,"container",[iS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vS=Qe(dS.prototype,"placeholder",[rS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yS=Qe(dS.prototype,"hasLoaded",[oS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mS=Qe(dS.prototype,"pagePrefab",[sS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gS=Qe(dS.prototype,"darkenBackground",[lS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bS=Qe(dS.prototype,"backgroundOpacity",[uS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),wS=Qe(dS.prototype,"useNavbarShadow",[cS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),kS=Qe(dS.prototype,"navbarShadowOpacity",[hS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),pS=dS))||pS)||pS)||pS)||pS);n._RF.pop(),n._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var HS,qS,VS,WS,KS,jS,YS,XS,JS,QS,ZS,$S,eC,tC,nC,aC=a.ccclass,iC=a.property,rC=(TS=aC("ThemeProgressBar"),xS=iC(i),RS=iC(i),PS=iC(i),IS=iC(i),TS((OS=Qe((LS=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"progressBar",OS,Fe(e)),Je(e,"progressText",DS,Fe(e)),Je(e,"leftCap",MS,Fe(e)),Je(e,"rightCap",NS,Fe(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(e,t){e<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var n=this.progressBar.getComponent(Y);if(!n)throw new Error("ThemeProgressBar: progressBarComponent not found");n.progress=e/t;var a=this.progressText.getComponent(u);if(!a)throw new Error("ThemeProgressBar: progressTextComponent not found");a.string="".concat(e,"/").concat(t)}}]),n}(f)).prototype,"progressBar",[xS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DS=Qe(LS.prototype,"progressText",[RS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MS=Qe(LS.prototype,"leftCap",[PS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NS=Qe(LS.prototype,"rightCap",[IS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_S=LS))||_S);n._RF.pop(),n._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var oC,sC,lC,uC,cC,hC,pC,dC,fC,vC,yC,mC,gC,bC,wC,kC,SC,CC,EC,AC,TC,xC,RC=a.ccclass,PC=a.disallowMultiple,IC=a.property,_C=[50,160],LC=(HS=RC("LockAnimator"),qS=IC(ie),VS=IC(y),WS=IC(_),KS=IC(_),jS=IC(ls),YS=IC({type:g,min:0}),HS(XS=PC((QS=Qe((JS=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"floatingParticles",QS,Fe(e)),Je(e,"iconAnimation",ZS,Fe(e)),Je(e,"lockClip",$S,Fe(e)),Je(e,"unlockClip",eC,Fe(e)),Je(e,"trailTemplate",tC,Fe(e)),Je(e,"trailCount",nC,Fe(e)),e.trails=[],e}return Pe(i,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(n=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem(),e.next=4,this.playAnimation(this.unlockClip.name,t);case 4:this.floatingParticles.stopSystem();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var e=this;return Promise.all(this.trails.map((function(t){return mn.runTweenAsync(e.getExplodeTrail(t))})))}},{key:"getExplodeTrail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=ne(0,2*Math.PI),a=ne(_C[0],_C[1])*Math.cos(n),i=ne(_C[0],_C[1])*Math.sin(n),r=new j(a,i,e.node.position.z),o=e.node.scale.clone();return S(e.node).delay(t).call((function(){e.node.setPosition(0,0),e.reset(),e.node.active=!0})).to(.5,{position:r.clone()},{easing:"expoOut"}).to(.5,{scale:new j(0,0,1)},{easing:"expoIn"}).call((function(){e.node.setPosition(0,0),e.node.scale=o,e.reset(),e.node.active=!1}))}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var e=0;e<this.trailCount;e++){var t=l(this.trailTemplate.node);t.setParent(this.node),t.active=!1,this.trails.push(t.getComponent(ls))}}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"playAnimation",value:(t=Te(Se().mark((function e(t,n){var a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||null==n||!n.aborted){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.abrupt("return",new Promise((function(e){a.iconAnimation.once(y.EventType.FINISHED,(function(){e()})),null==n||n.addAbortListener((function(){a.iconAnimation.off(y.EventType.FINISHED),a.iconAnimation.stop(),e()})),a.iconAnimation.play(t)})));case 3:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})}]),i}(f)).prototype,"floatingParticles",[qS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZS=Qe(JS.prototype,"iconAnimation",[VS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$S=Qe(JS.prototype,"lockClip",[WS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eC=Qe(JS.prototype,"unlockClip",[KS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tC=Qe(JS.prototype,"trailTemplate",[jS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nC=Qe(JS.prototype,"trailCount",[YS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XS=JS))||XS)||XS);n._RF.pop(),n._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var OC,DC,MC,NC,FC,BC,GC,zC,UC,HC,qC,VC=a.ccclass,WC=a.property,KC={progress:0,max:10,isLocked:!0,themeId:gl.SUMMER,skin:ml},jC=(oC=VC("ThemeBlock"),sC=WC(i),lC=WC(M),uC=WC(i),cC=WC(M),hC=WC(LC),pC=WC(i),dC=WC(T),fC=WC([T]),vC=WC(u),yC=WC(H),oC((bC=Qe((gC=function(e){_e(o,e);var t,n,a,i,r=Ge(o);function o(){var e;xe(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=r.call.apply(r,[this].concat(n)),"mask",bC,Fe(e)),Je(e,"nodeUIOpacity",wC,Fe(e)),Je(e,"progressBar",kC,Fe(e)),Je(e,"backgroundUI",SC,Fe(e)),Je(e,"lockAnimator",CC,Fe(e)),Je(e,"themeLoadingRing",EC,Fe(e)),Je(e,"themeSprite",AC,Fe(e)),Je(e,"tileBlockIconSprite",TC,Fe(e)),Je(e,"titleLabel",xC,Fe(e)),e.visibilityTween=null,e.isVisible=!1,e.payload=KC,e}return Pe(o,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(e){this.payload.isLocked=e,this.updateThemeBlockDisplay()}},{key:"getSkinName",value:function(){return this.payload.skin}},{key:"__preload",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"updateThemeBlockDisplay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:KC;this.payload=e;var t=e.progress,n=e.max,a=e.isLocked,i=e.themeId,r=e.skin;this.updateTitle(i),this.updateSkinAsync(r),this.updateThemeAsync(i);var o=this.progressBar.getComponent(rC);if(!o)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=a,this.progressBar.active=!a,this.lockAnimator.node.active=a,a||o.setProgress(t,n)}},{key:"playUnlockAnim",value:(i=Te(Se().mark((function e(t){var n,a,i,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:KC,this.payload=ke(ke({},n),{},{isLocked:!1}),a=n.progress,i=n.max,r=this.progressBar.getComponent(rC)){e.next=6;break}throw new Error("ThemeBlock: progressBarComponent not found");case 6:return this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,r.setProgress(a,i),e.next=12,this.animateUnlockedState(t);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"updateTitle",value:function(e){switch(e){case gl.SUMMER:this.titleLabel.string="Summer";break;case gl.WINTER:this.titleLabel.string="Winter";break;case gl.AUTUMN:this.titleLabel.string="Autumn"}}},{key:"updateSkinAsync",value:(a=Te(Se().mark((function e(t){var n,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jn.loadSkinPreviewAsync(t);case 2:if(n=e.sent,this.tileBlockIconSprite){e.next=5;break}return e.abrupt("return");case 5:n.forEach((function(e,t){e&&(a.tileBlockIconSprite[t].spriteFrame=e)}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"updateThemeAsync",value:(n=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jn.loadThemePreviewAsync(t);case 2:if(n=e.sent,this.themeSprite&&n){e.next=5;break}return e.abrupt("return");case 5:this.themeSprite.spriteFrame=n,this.themeLoadingRing&&(this.themeLoadingRing.active=!1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"animateUnlockedState",value:(t=Te(Se().mark((function e(t){var n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.mask.getComponent(M),i=this.progressBar.getComponent(M),a){e.next=4;break}throw new Error("ThemeBlock: maskUIOpacity not found");case 4:if(i){e.next=6;break}throw new Error("ThemeBlock: progressBarUIOpacity not found");case 6:return this.mask.active=!0,a.opacity=null!==(n=a.opacity)&&void 0!==n?n:255,this.progressBar.active=!0,i.opacity=0,e.next=12,this.lockAnimator.unlock(t);case 12:return this.lockAnimator.node.active=!1,e.next=15,Promise.all([mn.runTweenAsync(S(a).to(.25,{opacity:0}),t),mn.runTweenAsync(S(i).to(.25,{opacity:255}),t)]);case 15:this.mask.active=!1,a.opacity=0,i.opacity=255;case 18:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getUITransform",value:function(){return this.uiTransform}},{key:"setVisible",value:function(e){var t;this.isVisible!==e&&(this.isVisible=e,null===(t=this.visibilityTween)||void 0===t||t.stop(),this.visibilityTween=S(this.nodeUIOpacity).to(.05,{opacity:e?255:0}).start())}}]),o}(f)).prototype,"mask",[sC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wC=Qe(gC.prototype,"nodeUIOpacity",[lC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kC=Qe(gC.prototype,"progressBar",[uC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SC=Qe(gC.prototype,"backgroundUI",[cC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CC=Qe(gC.prototype,"lockAnimator",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EC=Qe(gC.prototype,"themeLoadingRing",[pC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AC=Qe(gC.prototype,"themeSprite",[dC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TC=Qe(gC.prototype,"tileBlockIconSprite",[fC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xC=Qe(gC.prototype,"titleLabel",[vC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qe(gC.prototype,"isLocked",[yC],Object.getOwnPropertyDescriptor(gC.prototype,"isLocked"),gC.prototype),mC=gC))||mC);n._RF.pop(),n._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var YC,XC=a.ccclass,JC=a.property,QC=globalThis.game.storage,ZC=(OC=XC("CollectionsContent"),DC=JC(Tr),MC=JC(le),NC=JC(yi),FC=JC({type:C,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),OC((zC=Qe((GC=function(e){_e(r,e);var t,n,a,i=Ge(r);function r(){var e;xe(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=i.call.apply(i,[this].concat(n))).animateThemeTabUnlock=null,Je(e,"panelAnimator",zC,Fe(e)),Je(e,"themeScrollView",UC,Fe(e)),Je(e,"contentOpacity",HC,Fe(e)),e.themeBlocks=[],e.preservedScrollPosition=new J,Je(e,"offsetFromTopOfScrollView",qC,Fe(e)),e.updateBlocksVisibility=function(){var t=e.uiTransform.getBoundingBoxToWorld(),n=t.yMax,a=t.yMin;e.themeBlocks.forEach((function(e){var t=e.getUITransform().getBoundingBoxToWorld(),i=t.yMax,r=t.yMin,o=i<a||r>n;e.setVisible(!o)}))},e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return Pe(r,[{key:"__preload",value:function(){var e,t;this.uiTransform=this.getComponent(s),this.themeBlocks=null!==(e=null===(t=this.themeScrollView.content)||void 0===t?void 0:t.getComponentsInChildren(jC))&&void 0!==e?e:[],this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.themeScrollView.node.on(le.EventType.SCROLLING,this.updateBlocksVisibility),this.node.scene.on($i.HIDE_UI,this.hideContent),this.node.scene.on($i.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.themeScrollView.node.off(le.EventType.SCROLLING,this.updateBlocksVisibility),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off($i.HIDE_UI,this.hideContent),this.node.scene.off($i.SHOW_UI,this.showContent)}},{key:"init",value:function(e){0!==e.length&&this.getThemeTabs().forEach((function(t,n){return t.updateThemeBlockDisplay(e[n])}))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(e){var t=this,n=QC.getStorageData("collection","animateMapPackUnlock"),a=QC.getStorageData("collection","lastMapPack");e.forEach((function(e,i){var r=e.skin,o=e.progress,s=e.max,l=e.isLocked;if(o<s&&!l&&n&&a!==i+1)return t.animateThemeTabUnlock=e,QC.setStorageData("collection","animateMapPackUnlock",!1),QC.setStorageData("collection","lastMapPack",i+1),void t.setProgressToThemeTab(r,ke(ke({},e),{},{isLocked:!0}));t.setProgressToThemeTab(r,e)}))}},{key:"shouldAnimateThemeTabUnlock",value:function(){return null!==this.animateThemeTabUnlock}},{key:"playThemeTabUnlockAnim",value:(a=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.animateThemeTabUnlock){e.next=2;break}return e.abrupt("return");case 2:if(void 0!==(n=this.findThemeTab(this.animateThemeTabUnlock.skin))){e.next=5;break}throw new Error("CollectionsContent: ThemeTab not found");case 5:return e.next=7,n.playUnlockAnim(t,ke(ke({},this.animateThemeTabUnlock),{},{isLocked:!0}));case 7:this.animateThemeTabUnlock=null;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(n=Te(Se().mark((function e(t,n){var a,i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.findThemeTab(t)){e.next=3;break}return e.abrupt("return");case 3:return i=a.node.position.y,r=-i-this.offsetFromTopOfScrollView,e.next=7,this.scrollToOffset(new J(0,r),2,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"scrollToOffset",value:(t=Te(Se().mark((function e(t,n,a){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.themeScrollView.scrollToOffset(t,n),e.next=3,mn.waitTweenAsync(n,a);case 3:a.aborted&&(this.themeScrollView.stopAutoScroll(),this.themeScrollView.scrollToOffset(t,0));case 4:case"end":return e.stop()}}),e,this)}))),function(e,n,a){return t.apply(this,arguments)})},{key:"setProgressToThemeTab",value:function(e,t){var n=this.findThemeTab(e);if(void 0===n)throw new Error("CollectionsContent: ThemeTab not found");n.updateThemeBlockDisplay(t)}},{key:"findThemeTab",value:function(e){return this.getThemeTabs().find((function(t){return t.getSkinName()===e}))}},{key:"getThemeTabs",value:function(){return this.themeScrollView.content.getComponentsInChildren(jC)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}}]),r}(f)).prototype,"panelAnimator",[DC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UC=Qe(GC.prototype,"themeScrollView",[MC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HC=Qe(GC.prototype,"contentOpacity",[NC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qC=Qe(GC.prototype,"offsetFromTopOfScrollView",[FC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),BC=GC))||BC);n._RF.pop(),n._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var $C,eE,tE,nE,aE,iE,rE,oE,sE,lE,uE,cE,hE,pE,dE,fE,vE,yE,mE,gE,bE,wE,kE,SE,CE,EE,AE,TE=(0,a.ccclass)("CollectionsPage")(YC=function(e){_e(r,e);var t,n,a,i=Ge(r);function r(){var e;xe(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=i.call.apply(i,[this].concat(n))).payload=null,e}return Pe(r,[{key:"setPayload",value:function(e){this.payload=e}},{key:"mount",value:(a=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,jn.loadPrefabAsync(Fn.COLLECTIONS_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,Ue(Le(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.themeContent){e.next=12;break}if(this.themeContent=this.container.getComponentInChildren(ZC),this.themeContent){e.next=12;break}throw new Error("No theme content found");case 12:this.payload&&this.themeContent.init(this.payload);case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"transitionIn",value:(n=Te(Se().mark((function e(){var t,n,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(Le(r.prototype),"transitionIn",this).call(this);case 2:return this.themeContent.restoreScrollPosition(),this.themeContent.updateBlocksVisibility(),this.themeContent.enableUIAnimator(),this.themeContent.listenEvents(),t=mn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){a.node.scene.emit($i.SHOW_UI,{onComplete:function(){e()}})})),e.next=10,Promise.all([t,n]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(Le(r.prototype),"transitionOut",this).call(this);case 2:return this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents(),e.next=6,new Promise((function(e){t.node.scene.emit($i.HIDE_UI,{onComplete:function(){e()}})}));case 6:this.themeContent.disableUIAnimator(),this.themeContent.unlistenEvents();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(US))||YC;n._RF.pop(),n._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var xE,RE,PE,IE,_E,LE,OE,DE,ME,NE,FE,BE,GE,zE=a.ccclass,UE=a.property,HE=a.disallowMultiple,qE=a.requireComponent,VE=($C=zE("PageManagerItem"),eE=UE(US),tE=UE({type:ue(Fs)}),$C((iE=Qe((aE=Pe((function e(){xe(this,e),Je(this,"page",iE,this),Je(this,"pageType",rE,this)}))).prototype,"page",[eE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rE=Qe(aE.prototype,"pageType",[tE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nE=aE))||nE),WE=(oE=zE("PageManager"),sE=qE(s),lE=UE({type:M,displayName:"Background Mask",group:"Background Mask"}),uE=UE({type:C,displayName:"Transition duration",group:"Background Mask"}),cE=UE({type:C,displayName:"Transition delay",group:"Background Mask"}),hE=UE({type:M,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),pE=UE({type:C,displayName:"Transition duration",group:"Nav Bar Shadow"}),dE=UE({type:C,displayName:"Transition delay",group:"Nav Bar Shadow"}),fE=UE({type:[VE]}),vE=UE({type:ue(Fs)}),oE(yE=HE(yE=sE((gE=Qe((mE=function(e){_e(o,e);var t,n,a,i,r=Ge(o);function o(){var e;xe(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=r.call.apply(r,[this].concat(n)),"backgroundMask",gE,Fe(e)),Je(e,"backgroundMaskTransitionDuration",bE,Fe(e)),Je(e,"backgroundMaskTransitionDelay",wE,Fe(e)),Je(e,"navBarShadow",kE,Fe(e)),Je(e,"navBarShadowTransitionDuration",SE,Fe(e)),Je(e,"navBarShadowTransitionDelay",CE,Fe(e)),Je(e,"pageItems",EE,Fe(e)),Je(e,"currentScreen",AE,Fe(e)),e}return Pe(o,[{key:"unmountAndHideAll",value:function(){var e=this;this.pageItems.forEach((function(t){var n=t.page;t.pageType!==e.currentScreen&&(n.unmount(),n.hide())}))}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"updateCollectionsContentPayload",value:function(e){var t=this.getPage(Fs.collections);t&&t instanceof TE&&t.setPayload(e)}},{key:"navigate",value:(i=Te(Se().mark((function e(t,n,a){var i,r,o,s,l,u,c,h,p,d,f,v,y,m,g;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.from,r=t.to,null!==i){e.next=15;break}return(o=this.getPage(this.currentScreen)).show(),e.next=6,o.mount();case 6:return e.next=8,null==n?void 0:n(o);case 8:return this.node.scene.emit(Ds),e.next=11,o.transitionIn();case 11:return e.next=13,null==a?void 0:a(o);case 13:return this.currentScreen=r,e.abrupt("return");case 15:if(i===this.currentScreen){e.next=17;break}throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");case 17:if(s=this.getPage(this.currentScreen),(l=this.getPage(r))&&s){e.next=21;break}throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");case 21:if(u=this.uiTransform.width,c=this.getPageIndex(i),h=this.getPageIndex(r),p=Math.min(c,h),d=Math.max(c,h),f=(d-p)*u,v=c<h?1:-1,(y=this.pageItems.slice(p,d+1)).forEach((function(e,t){var n=e.page;n.show(),n.getWidget().enabled=!1,n.node.position=new j((t+p-c)*u,n.node.position.y,n.node.position.z)})),m=!1,l.hasLoadedPage()){e.next=36;break}return m=!0,iu.showLoadingScreen(),e.next=36,mn.waitTweenAsync(.5);case 36:return e.next=38,l.mount();case 38:return e.next=40,null==n?void 0:n(l);case 40:return this.node.scene.emit(Ds),e.next=43,Promise.all([s.transitionOut(),this.transition(f,v,y),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,l.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,l.getNavbarShadow())]);case 43:return(g=l.getWidget()).enabled=!0,g.left=0,g.right=0,l.updateWidgets(),l.updateLayouts(),y.forEach((function(e){e.pageType!==r&&(e.page.unmount(),e.page.hide())})),this.currentScreen=r,e.next=53,l.transitionIn();case 53:return e.next=55,null==a?void 0:a(l);case 55:m&&iu.closeLoadingScreen();case 56:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"getPage",value:function(e){var t=this.getPageIndex(e);return-1!==t?this.pageItems[t].page:null}},{key:"handleBackgroundMask",value:(a=Te(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runTweenAsync(S(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(t,{opacity:n}).start());case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"handleNavBarShadow",value:(n=Te(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runTweenAsync(S(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(t,{opacity:n}).start());case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getPageIndex",value:function(e){return this.pageItems.findIndex((function(t){return t.pageType===e}))}},{key:"transition",value:(t=Te(Se().mark((function e(t,n,a){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(a.map((function(e){var a=e.page;return mn.runTweenAsync(S(a.node).to(.5,{position:new j(a.node.position.x-t*n,a.node.position.y,a.node.position.z)},{easing:D.quintInOut}))})));case 2:case"end":return e.stop()}}),e)}))),function(e,n,a){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiTransform)throw new Error("PageManager requires UITransform component");if(!this.backgroundMask)throw new Error("PageManager requires background mask")}}]),o}(f)).prototype,"backgroundMask",[lE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bE=Qe(mE.prototype,"backgroundMaskTransitionDuration",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),wE=Qe(mE.prototype,"backgroundMaskTransitionDelay",[cE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),kE=Qe(mE.prototype,"navBarShadow",[hE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SE=Qe(mE.prototype,"navBarShadowTransitionDuration",[pE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),CE=Qe(mE.prototype,"navBarShadowTransitionDelay",[dE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),EE=Qe(mE.prototype,"pageItems",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AE=Qe(mE.prototype,"currentScreen",[vE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fs.home}}),yE=mE))||yE)||yE)||yE);n._RF.pop(),n._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var KE,jE,YE,XE,JE,QE,ZE=a.ccclass,$E=a.property,eA=(xE=ZE("StarProgressBar"),RE=$E(io),PE=$E(u),IE=$E(g),_E=$E(g),LE=$E(m),xE((ME=Qe((DE=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"progressBar",ME,Fe(e)),Je(e,"progressLabel",NE,Fe(e)),Je(e,"current",FE,Fe(e)),Je(e,"total",BE,Fe(e)),Je(e,"separator",GE,Fe(e)),e}return Pe(a,[{key:"setRange",value:function(e,t){this.total=t,this.current=e,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string="".concat(this.current).concat(this.separator).concat(this.total)}},{key:"animateTo",value:(t=Te(Se().mark((function e(t,n,a){var i,r,o,s,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Math.min(t,this.total)/this.total,r=this.current,o=1,s=S(this.progressBar).to(3,{progress:i},{easing:"quadOut",onUpdate:function(e,n){n&&(l.current=r+Math.floor((t-r)*n),null==a||a(l.current),l.current===r-o&&(o++,S(l.progressLabel.node).to(.05,{scale:new j(1.2,1.2,1.2)}).to(.05,{scale:j.ONE}).start()),l.updateProgressLabel())}}),null==n||n.addAbortListener((function(){l.current=t,l.updateProgress()})),e.next=7,mn.runTweenAsync(s,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,n,a){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),a}(f)).prototype,"progressBar",[RE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NE=Qe(DE.prototype,"progressLabel",[PE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FE=Qe(DE.prototype,"current",[IE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BE=Qe(DE.prototype,"total",[_E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GE=Qe(DE.prototype,"separator",[LE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OE=DE))||OE);n._RF.pop(),n._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var tA,nA,aA,iA,rA,oA,sA,lA,uA,cA,hA,pA=a.ccclass,dA=a.property,fA=(KE=pA("EventButton"),jE=dA({type:ue(dg)}),YE=dA(H),KE((QE=Qe((JE=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"eventType",QE,Fe(e)),e._isAvailable=!1,e}return Pe(n,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(e){this._isAvailable=e,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(Ns,{type:this.eventType})}},{key:"setAnimationState",value:function(e){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),Ue(Le(n.prototype),"setAnimationState",this).call(this,e)}}]),n}(ii)).prototype,"eventType",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dg.STAR_CHEST}}),Qe(JE.prototype,"isAvailable",[YE],Object.getOwnPropertyDescriptor(JE.prototype,"isAvailable"),JE.prototype),XE=JE))||XE);n._RF.pop(),n._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var vA,yA,mA,gA,bA,wA,kA,SA,CA,EA,AA,TA,xA,RA,PA,IA,_A,LA,OA=a.ccclass,DA=a.property,MA=globalThis.game.player,NA=(tA=OA("DashboardHeader"),nA=DA({type:eA,displayName:"Progress bar",group:"Star Chest"}),aA=DA({type:fA,displayName:"Button Component",group:"Star Chest"}),iA=DA({type:_,displayName:"Default Rest animation",group:"Star Chest"}),rA=DA({type:_,displayName:"Special Rest animation",group:"Star Chest"}),tA((lA=Qe((sA=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"starProgressBar",lA,Fe(e)),Je(e,"chestButton",uA,Fe(e)),Je(e,"defaultRestAnimation",cA,Fe(e)),Je(e,"specialRestAnimation",hA,Fe(e)),e.handleStarsUpdateEvent=function(t){var n,a;void 0!==(t=null!==(n=t)&&void 0!==n?n:null===(a=MA.getGameData())||void 0===a?void 0:a.stars)&&(e.starProgressBar.setRange(t,20),e.updateStarChestButtonAnimation(t))},e}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),x.on(_s,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function(){x.off(_s,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function(e){this.handleStarsUpdateEvent(e)}},{key:"updateStarChestButtonAnimation",value:function(e){this.chestButton.isAvailable=e>=20}},{key:"validateRequiredComponents",value:function(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}}]),n}(f)).prototype,"starProgressBar",[nA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uA=Qe(sA.prototype,"chestButton",[aA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cA=Qe(sA.prototype,"defaultRestAnimation",[iA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hA=Qe(sA.prototype,"specialRestAnimation",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oA=sA))||oA);n._RF.pop(),n._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var FA,BA,GA,zA,UA,HA,qA,VA,WA,KA,jA,YA,XA=a.ccclass,JA=a.property,QA=a.executeInEditMode,ZA=(vA=XA("JourneyLevelAvatar"),yA=JA({type:T,displayName:"Avatar node"}),mA=JA(i),gA=JA(y),bA=JA(M),wA=JA({type:_,group:"Animation"}),kA=JA({type:_,group:"Animation"}),SA=JA({type:_,group:"Animation"}),CA=JA({type:O,displayName:"Avatar sprite"}),vA(EA=QA((TA=Qe((AA=function(e){_e(r,e);var t,n,a,i=Ge(r);function r(){var e;xe(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=i.call.apply(i,[this].concat(n)),"sprite",TA,Fe(e)),Je(e,"lockIcon",xA,Fe(e)),Je(e,"animation",RA,Fe(e)),Je(e,"opacity",PA,Fe(e)),Je(e,"flashAnimation",IA,Fe(e)),Je(e,"unlockAnimation",_A,Fe(e)),Je(e,"spawnAnimation",LA,Fe(e)),e}return Pe(r,[{key:"avatarSprite",get:function(){var e,t;return null!==(e=null===(t=this.sprite)||void 0===t?void 0:t.spriteFrame)&&void 0!==e?e:null},set:function(e){this.sprite&&(this.sprite.spriteFrame=e)}},{key:"playUnlockAnimation",value:(a=Te(Se().mark((function e(){var t,n,a,i,r,o,s,l,u,c,h;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.playAnimation(this.unlockAnimation),n=this.lockIcon.position.x,a=this.lockIcon.position.y,i=[45,135],r=(Math.random()*(i[1]-i[0])+i[0])*(Math.PI/180),o=this.lockIcon.position.x+150*Math.cos(r),s=this.lockIcon.position.y+150*Math.sin(r),l=a-400,u=mn.runTweenAsync(S(this.lockIcon).delay(.3).to(.2,{position:new j(o,s,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new j(o,l,this.lockIcon.position.z)},{easing:"cubicIn"})),c=[0,360],h=mn.runTweenAsync(S(this.lockIcon).delay(.3).to(.6,{eulerAngles:new j(0,0,Math.random()*(c[1]-c[0])*(o>n?-1:1))},{easing:"sineOut"})),e.next=14,Promise.all([t,u,h]);case 14:this.lockIcon.position=new j(n,a,this.lockIcon.position.z),this.lockIcon.eulerAngles=new j(0,0,0);case 16:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"playFlashAnimation",value:(n=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.y,n=this.playAnimation(this.flashAnimation),a=mn.runTweenAsync(S(this.node).to(.1,{position:new j(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new j(this.node.position.x,t,this.node.position.z)},{easing:"sineIn"})),e.next=5,Promise.all([n,a]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(j.ZERO)}},{key:"playAnimation",value:(t=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runAnimationAsync(this.animation,t.name);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var e=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some((function(t){return null!==t&&(t.name===e.flashAnimation.name||t.name===e.unlockAnimation.name||t.name===e.spawnAnimation.name)})))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),r}(f)).prototype,"sprite",[yA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xA=Qe(AA.prototype,"lockIcon",[mA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RA=Qe(AA.prototype,"animation",[gA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PA=Qe(AA.prototype,"opacity",[bA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IA=Qe(AA.prototype,"flashAnimation",[wA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_A=Qe(AA.prototype,"unlockAnimation",[kA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LA=Qe(AA.prototype,"spawnAnimation",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qe(AA.prototype,"avatarSprite",[CA],Object.getOwnPropertyDescriptor(AA.prototype,"avatarSprite"),AA.prototype),EA=AA))||EA)||EA);n._RF.pop(),n._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var $A,eT,tT,nT,aT,iT,rT,oT,sT,lT,uT,cT,hT,pT,dT,fT,vT,yT,mT,gT,bT,wT,kT=a.ccclass,ST=a.property,CT=a.executeInEditMode,ET=(FA=kT("JourneyProgressBar"),BA=ST(io),GA=ST(u),zA=ST(M),UA=ST(g),HA=ST(g),qA=ST(m),FA(VA=CT((KA=Qe((WA=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"progressBar",KA,Fe(e)),Je(e,"progressLabel",jA,Fe(e)),Je(e,"labelUIOpacity",YA,Fe(e)),e.currentProgress=10,e.totalProgress=10,e.labelSeparator="/",e}return Pe(a,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(e){this.labelSeparator=e,this.updateProgress()}},{key:"setRange",value:function(e,t){this.totalProgress=t,e>t&&(e=t),this.currentProgress=e,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(t=Te(Se().mark((function e(t){var n,a,i,r,o,s,l,u,c,h,p,d,f,v=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.nextCurr,a=t.nextTotal,i=t.numberOfProgressBar,r=void 0===i?0:i,o=t.onProgressBarPassed,s=t.signal,l=n/a,u=S(this.labelUIOpacity).to(.2,{opacity:0}),c=S(this.labelUIOpacity).to(.2,{opacity:255}),h=r<1?1:Math.sqrt(r)+1,p=0===r?l:r+l,d=1,f=S({curr:this.progressBar.progress}).to(h,{curr:p},{easing:"sineInOut",onUpdate:function(e){if(void 0!==e){var t=e.curr;v.progressBar.progress=t%1,t>d&&(d=0===t?1:Math.ceil(t),null==o||o())}}}),e.next=10,Promise.all([mn.runTweenAsync(u,s),mn.runTweenAsync(f,s)]);case 10:return this.currentProgress=n,this.totalProgress=a,this.updateProgress(),e.next=15,mn.runTweenAsync(c,s);case 15:return this.labelUIOpacity.opacity=255,e.abrupt("return",l);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string="".concat(this.currentProgress).concat(this.separator).concat(this.totalProgress)}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),a}(f)).prototype,"progressBar",[BA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jA=Qe(WA.prototype,"progressLabel",[GA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YA=Qe(WA.prototype,"labelUIOpacity",[zA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qe(WA.prototype,"total",[UA],Object.getOwnPropertyDescriptor(WA.prototype,"total"),WA.prototype),Qe(WA.prototype,"current",[HA],Object.getOwnPropertyDescriptor(WA.prototype,"current"),WA.prototype),Qe(WA.prototype,"separator",[qA],Object.getOwnPropertyDescriptor(WA.prototype,"separator"),WA.prototype),VA=WA))||VA)||VA);n._RF.pop(),n._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var AT,TT,xT,RT,PT,IT,_T,LT,OT,DT,MT,NT,FT,BT,GT,zT,UT,HT=a.ccclass,qT=a.property,VT=($A=HT("ProgressConfiguration"),eT=qT(O),tT=qT(m),$A((iT=Qe((aT=Pe((function e(){xe(this,e),Je(this,"avatar",iT,this),Je(this,"themeId",rT,this)}))).prototype,"avatar",[eT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rT=Qe(aT.prototype,"themeId",[tT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nT=aT))||nT),WT=(oT=HT("JourneyProgressAnimator"),sT=qT(ET),lT=qT(i),uT=qT(T),cT=qT(ZA),hT=qT(VT),pT=qT({type:C,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),oT((vT=Qe((fT=function(e){_e(o,e);var t,n,a,i,r=Ge(o);function o(){var e;xe(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=r.call.apply(r,[this].concat(n)),"progressBar",vT,Fe(e)),Je(e,"currentLevelAvatarNode",yT,Fe(e)),Je(e,"currentLevelAvatar",mT,Fe(e)),Je(e,"nextLevelAvatar",gT,Fe(e)),Je(e,"progressConfigs",bT,Fe(e)),Je(e,"nextLevelYOffset",wT,Fe(e)),e.isAnimating=!1,e}return Pe(o,[{key:"setRange",value:function(e,t){this.progressBar.setRange(e,t)}},{key:"animateTo",value:(i=Te(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAnimating){e.next=3;break}return console.warn("JourneyProgressAnimator: animation already in progress"),e.abrupt("return",Promise.resolve());case 3:if(this.isAnimating=!0,t===this.progressBar.current){e.next=7;break}return e.next=7,this.progressBar.animateTo({nextCurr:t,nextTotal:this.progressBar.total,signal:n});case 7:this.isAnimating=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"animateToNextLevel",value:(a=Te(Se().mark((function e(t){var n,a,i,r,o,s,l,u,c,h=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.nextCurr,a=t.nextTotal,i=t.mapsPassed,r=t.signal,!this.isAnimating){e.next=4;break}return console.warn("JourneyProgressAnimator: animation already in progress"),e.abrupt("return");case 4:if(this.isAnimating=!0,0!=(o=i.length-2)){e.next=11;break}return e.next=9,this.progressBar.animateTo({nextCurr:n,nextTotal:a,signal:r});case 9:return this.isAnimating=!1,e.abrupt("return");case 11:return e.next=13,this.animateTargetAvaToCenter(r);case 13:return s=function(){if(1===l)return h.nextLevelAvatar.playUnlockAnimation(),void(l+=1);if(l>=i.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");h.nextLevelAvatar.playFlashAnimation(),h.setNextLevelAvatar(i[l].theme),l+=1},l=1,e.next=17,this.progressBar.animateTo({signal:r,nextCurr:n,nextTotal:a,numberOfProgressBar:o,onProgressBarPassed:s});case 17:return e.next=19,this.animateTargetAvaToPrev(r);case 19:u=i[i.length-1].theme,c=i[i.length-2].theme,this.setCurrentLevelAvatar(c),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=this.getSpriteFrameByThemeId(u),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1;case 27:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(n=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z),e.next=3,mn.runTweenAsync(S(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t);case 3:this.nextLevelAvatar.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(t=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.currentLevelAvatarNode.position.clone(),e.next=3,mn.runTweenAsync(S(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t);case 3:this.nextLevelAvatar.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:function(e){var t=this.progressConfigs.find((function(t){return t.themeId===e}));if(!t)throw new Error("JourneyProgressController: config not found for themeId ".concat(e));return t.avatar}},{key:"setAvatar",value:function(e,t){var n=this.getSpriteFrameByThemeId(e);t instanceof ZA?t.avatarSprite=n:t.spriteFrame=n}},{key:"setCurrentLevelAvatar",value:function(e){this.setAvatar(e,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(e){this.setAvatar(e,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}}]),o}(f)).prototype,"progressBar",[sT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yT=Qe(fT.prototype,"currentLevelAvatarNode",[lT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mT=Qe(fT.prototype,"currentLevelAvatar",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gT=Qe(fT.prototype,"nextLevelAvatar",[cT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bT=Qe(fT.prototype,"progressConfigs",[hT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wT=Qe(fT.prototype,"nextLevelYOffset",[pT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dT=fT))||dT);n._RF.pop(),n._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var KT,jT,YT,XT,JT,QT,ZT,$T,ex,tx,nx,ax,ix,rx,ox,sx=a.ccclass,lx=a.property,ux=globalThis.game.storage,cx=(AT=sx("HomeContent"),TT=lx(u),xT=lx(p),RT=lx(WT),PT=lx(Tr),IT=lx(NA),_T=lx(M),LT=lx(eS),AT((MT=Qe((DT=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"playButtonLabel",MT,Fe(e)),Je(e,"playButton",NT,Fe(e)),Je(e,"journeyProgressAnimator",FT,Fe(e)),Je(e,"panelAnimator",BT,Fe(e)),Je(e,"dashboardHeader",GT,Fe(e)),Je(e,"overlayDuringAnim",zT,Fe(e)),Je(e,"coinContainer",UT,Fe(e)),e}return Pe(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(Ls)}},{key:"setPlayButtonLabel",value:function(e){this.playButtonLabel.string=e}},{key:"updateStarProgress",value:function(e){this.dashboardHeader.updateStarProgress(e)}},{key:"setUnlockProgress",value:function(e){this.setProgress(e),this.updateCurrentMapInStorage(e)}},{key:"prepareUnlockProgressAnimation",value:function(e,t,n,a){var i=this;if(e.id===t.id){this.setProgress(ke(ke({},t),{},{progress:e.progress})),this.updateCurrentMapInStorage(t);var r=t.progress;return Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.playButton.interactable=!1,e.next=3,i.showOwnOverlay(a);case 3:return e.next=5,i.journeyProgressAnimator.animateTo(r,a);case 5:return e.next=7,i.hideOwnOverlay(a);case 7:i.playButton.interactable=!0;case 8:case"end":return e.stop()}}),e)})))}return this.setProgress(e),this.updateCurrentMapInStorage(t),Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.playButton.interactable=!1,e.next=3,i.showOwnOverlay(a);case 3:return e.next=5,i.journeyProgressAnimator.animateToNextLevel({nextCurr:t.progress,nextTotal:t.max,mapsPassed:n,signal:a});case 5:return e.next=7,i.hideOwnOverlay(a);case 7:i.playButton.interactable=!0;case 8:case"end":return e.stop()}}),e)})))}},{key:"hideOwnOverlay",value:(n=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runTweenAsync(S(this.overlayDuringAnim).to(.3,{opacity:0}),t);case 2:this.overlayDuringAnim.opacity=0;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"showOwnOverlay",value:(t=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runTweenAsync(S(this.overlayDuringAnim).to(.3,{opacity:150}),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setProgress",value:function(e){var t=e.currentTheme,n=e.nextTheme,a=e.progress,i=e.max;this.journeyProgressAnimator.setCurrentLevelAvatar(t),this.journeyProgressAnimator.setNextLevelAvatar(null!=n?n:t),this.journeyProgressAnimator.setRange(a,i)}},{key:"updateCurrentMapInStorage",value:function(e){ux.setStorageData("dashboard","animateToCurrentLevel",!1),ux.setStorageData("dashboard","lastMapPayload",e)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}}]),i}(f)).prototype,"playButtonLabel",[TT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NT=Qe(DT.prototype,"playButton",[xT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FT=Qe(DT.prototype,"journeyProgressAnimator",[RT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BT=Qe(DT.prototype,"panelAnimator",[PT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GT=Qe(DT.prototype,"dashboardHeader",[IT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zT=Qe(DT.prototype,"overlayDuringAnim",[_T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UT=Qe(DT.prototype,"coinContainer",[LT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OT=DT))||OT);n._RF.pop(),n._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var hx,px,dx,fx,vx,yx,mx,gx,bx,wx,kx,Sx,Cx,Ex=a.ccclass,Ax=a.property,Tx=globalThis.game.ads,xx=(KT=Ex("NavManager"),jT=Ax(i),YT=Ax(i),XT=Ax(kn),JT=Ax(H),QT=Ax({type:E,visible:function(){return this.useOffsetWhenSAB}}),ZT=Ax({type:C,visible:function(){return this.useOffsetWhenSAB}}),KT((tx=Qe((ex=function(e){_e(s,e);var t,n,a,i,r,o=Ge(s);function s(){var e;xe(this,s);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=o.call.apply(o,[this].concat(n)),"selectorNode",tx,Fe(e)),Je(e,"selectedButtonNode",nx,Fe(e)),Je(e,"autoLayout",ax,Fe(e)),Je(e,"useOffsetWhenSAB",ix,Fe(e)),Je(e,"offsetWidget",rx,Fe(e)),Je(e,"offsetWhenSAB",ox,Fe(e)),e.navButtons=[],e.isNavigating=!1,e}return Pe(s,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var e;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(e=this.selectedButtonNode)||void 0===e?void 0:e.getComponentInChildren("NavButton"),Ct.lazyValidateProperties(this)}},{key:"start",value:function(){this.useOffsetWhenSAB&&(Tx.getSafeAreaBottom(Za.cssSizeToWorldSize(1))>0&&(this.offsetWidget.bottom=this.offsetWhenSAB))}},{key:"select",value:(r=Te(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNavigating){e.next=2;break}return e.abrupt("return");case 2:if(this.navButtons.includes(t)){e.next=4;break}throw new Error("NavManager: Button not found");case 4:if(t!==this.selectedButton){e.next=6;break}return e.abrupt("return");case 6:if(!t.isWIP){e.next=9;break}return this.handleWIPButton(),e.abrupt("return");case 9:return this.isNavigating=!0,this.node.scene.emit(Os,{from:this.selectedButton.buttonType,to:t.buttonType}),e.abrupt("return",new Promise((function(e){n.node.scene.once(Ds,(function(){var a=n.selectedButton.deselect();n.autoLayout.selectedIndex=n.navButtons.indexOf(t),n.selectedButton=t;var i=n.autoLayout.getSelectedWorldX()-t.getSelectedWorldDistanceX(),r=n.playSelectorAnimation(i),o=t.select();Promise.all([a,o,r]).then((function(){n.isNavigating=!1,e()}))}))})));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(i=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNavigating){e.next=2;break}return e.abrupt("return");case 2:if(![Fs.store].includes(t.buttonType)){e.next=5;break}return this.handleWIPButton(),e.abrupt("return");case 5:return e.next=7,this.select(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"selectByType",value:(a=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.navButtons.find((function(e){return e.buttonType===t}))){e.next=3;break}throw new Error("NavManager: Button not found");case 3:return e.next=5,this.selectUsingSceneTransition(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"handleWIPButton",value:function(){iu.openScreen(fa)}},{key:"selectDefaultNavBtn",value:(n=Te(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentButton&&this.navButtons.includes(this.currentButton)){e.next=2;break}throw new Error("NavManager: Button not found");case 2:return t=this.currentButton.buttonType,this.node.scene.emit(Os,{from:null,to:t}),e.abrupt("return",new Promise((function(e){n.node.scene.once(Ds,(function(){n.autoLayout.selectedIndex=n.navButtons.indexOf(n.currentButton);var t=n.navButtons.map((function(e){return e===n.currentButton?e.select(!1):e.deselect(!1,!0)})),a=n.autoLayout.getSelectedWorldX()-n.currentButton.getSelectedWorldDistanceX();n.selectorNode.worldPosition=new j(a,n.selectorNode.worldPosition.y,0),Promise.all(t).then((function(){e()}))}))})));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playSelectorAnimation",value:(t=Te(Se().mark((function e(t){var n,a,i,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(1,1,1),a=this.selectorNode.worldPosition.clone(),i=new j(1.2*n.x,.8*n.y,1),e.next=7,mn.runTweenAsync(S(this.selectorNode).to(.3,{worldPosition:new j(t,a.y,0)},{easing:"quintInOut",onUpdate:function(e,t){if(void 0!==t){var a=r.calculateCurrentSquashScale(n,i,t);r.selectorNode.scale=a}}}));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.navButtons.forEach((function(t){var n=t.getComponentInChildren(p);n&&(n.interactable=!e)}))}},{key:"calculateCurrentSquashScale",value:function(e,t,n){var a=this.splitIntoSquashRatio(n);return e.clone().lerp(t,a)}},{key:"splitIntoSquashRatio",value:function(e){return e<.5?2*e:1-2*(e-.5)}}]),s}(f)).prototype,"selectorNode",[jT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nx=Qe(ex.prototype,"selectedButtonNode",[YT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ax=Qe(ex.prototype,"autoLayout",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ix=Qe(ex.prototype,"useOffsetWhenSAB",[JT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rx=Qe(ex.prototype,"offsetWidget",[QT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ox=Qe(ex.prototype,"offsetWhenSAB",[ZT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$T=ex))||$T);n._RF.pop(),n._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var Rx,Px,Ix,_x,Lx,Ox=a.ccclass,Dx=a.disallowMultiple,Mx=a.property,Nx=globalThis.game,Fx=Nx.event,Bx=Nx.storage,Gx=Nx.player,zx=Nx.leaderboard,Ux=GameCore.Events,Hx=GameCore.Match.Modes,qx=GameCore.Configs.DailyRewards,Vx=GameCore.Utils,Wx=Vx.Time,Kx=Vx.Json;hx=Ox("DashboardScene"),px=Mx(Bb),dx=Mx(xx),fx=Mx(Jn),vx=Mx(WE),yx=Mx(Ok),hx(mx=Dx((bx=Qe((gx=function(e){_e(u,e);var t,n,a,i,r,o,s,l=Ge(u);function u(){var e;xe(this,u);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=l.call.apply(l,[this].concat(n)),"coinManager",bx,Fe(e)),Je(e,"navManager",wx,Fe(e)),Je(e,"bgComp",kx,Fe(e)),Je(e,"pageManager",Sx,Fe(e)),Je(e,"pageAnimSkipOverlay",Cx,Fe(e)),e.firstNavigation=!0,e.isFirstNavToCollections=!0,e.hasLoadedGameSceneResourcesFinish=!1,e.playBgAnim=Te(Se().mark((function t(){var n,a,i,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(a=Bx.getStorage("dashboard"))){t.next=3;break}throw new Error("DashboardScene: dashboardStorage not found");case 3:if(i=null!==(n=a.animateToCurrentLevel)&&void 0!==n&&n,r=ke({},a.lastMapPayload),o=Cl.getCurrentMapProgress(),s=r.currentTheme===o.currentTheme&&r.nextTheme===o.nextTheme,l=o.currentTheme,i&&!s){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,mn.waitTweenAsync(2);case 12:return t.prev=12,t.next=15,e.bgComp.animateToNextTheme(l);case 15:t.next=19;break;case 17:t.prev=17,t.t0=t.catch(12);case 19:case"end":return t.stop()}}),t,null,[[12,17]])}))),e.handlePlayButtonPress=Te(Se().mark((function t(){var n,a,i,r,o,s,l,u,c,h,p,d;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Dl.startMatchAsync(Hx.SINGLE);case 3:return i=Cl.getCurrentMapProgress(),r=null!==(n=Gx.getGameData())&&void 0!==n?n:{},o=r.level,s=void 0===o?1:o,e.updateCurrentMapInStorage(i),Bx.setStorageData("collection","lastMapPack",i.id),Bx.setStorageData("collection","animateMapPackUnlock",!1),l=Bx.getStorage("leaderboard_content"),u=l.lastTabOpened,t.next=11,e.getPlayerLeader(u);case 11:if(t.t1=a=t.sent,t.t0=null!==t.t1,!t.t0){t.next=15;break}t.t0=void 0!==a;case 15:if(!t.t0){t.next=19;break}t.t2=a,t.next=20;break;case 19:t.t2={};case 20:return c=t.t2,h=c.score,p=c.rank,Bx.setStorageData("leaderboard_content","previousScore",h),Bx.setStorageData("leaderboard_content","previousRank",p),d={isMatchStartFromLoader:!0,level:s},t.next=28,Promise.all([e.untilGameSceneResourcesLoaded(),mn.waitTweenAsync(.3)]);case 28:Vl.switchScene(Qs,d),t.next=35;break;case 31:return t.prev=31,t.t3=t.catch(0),console.error(t.t3),t.abrupt("return");case 35:case"end":return t.stop()}}),t,null,[[0,31]])}))),e.onNavigate=function(){var t=Te(Se().mark((function t(n){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.firstNavigation&&(e.firstNavigation=!1,e.pageManager.unmountAndHideAll()),t.t0=n.to,t.next=t.t0===Fs.store?4:t.t0===Fs.collections?10:t.t0===Fs.tournaments?13:t.t0===Fs.leaderboard?16:t.t0===Fs.home?19:22;break;case 4:return e.navManager.setIgnoreInput(),t.next=7,e.pageManager.navigate(n);case 7:return e.handleNavigateToStore(),e.navManager.setIgnoreInput(!1),t.abrupt("break",23);case 10:return t.next=12,e.onNavigateToCollections(ke(ke({},n),{},{to:Fs.collections}));case 12:return t.abrupt("break",23);case 13:return t.next=15,e.onNavigateToTournaments(n);case 15:return t.abrupt("break",23);case 16:return t.next=18,e.onNavigateToLeaderboard(ke(ke({},n),{},{to:Fs.leaderboard}));case 18:return t.abrupt("break",23);case 19:return t.next=21,e.handleNavigateToHome(n);case 21:return t.abrupt("break",23);case 22:throw new Error("DashboardScene: Unhandled page name");case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleEventButtonPress=function(e){switch(e.type){case dg.STAR_CHEST:iu.openScreen(fa);break;case dg.BALLOON:iu.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}},e}return Pe(u,[{key:"__preload",value:function(){this.panelAnimationController=this.getComponent(gr),this.validateRequiredComponents(),this.listenNavigationEvents(),this.listenDashboardEvents(),this.panelAnimationController.init()}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(Os,this.onNavigate)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(Ls,this.handlePlayButtonPress),this.node.scene.on(Ns,this.handleEventButtonPress)}},{key:"onLoad",value:function(){this.coinManager.init(this.pageAnimSkipOverlay),Cl.init(),this.setPlayerLevel(),this.preloadGameSceneResources(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(Cl.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var e,t=(null!==(e=Gx.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;n=0===n?1:n,Gx.setGameData({level:n})}},{key:"preloadGameSceneResources",value:(s=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.hasLoadedGameSceneResourcesFinish=!0,this.node.emit(Ms);case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"untilGameSceneResourcesLoaded",value:function(){var e=this;return new Promise((function(t){e.hasLoadedGameSceneResourcesFinish?t():e.node.once(Ms,(function(){t()}))}))}},{key:"start",value:function(){Gx.getPlayerSetting("music")&&ga.playMusic(),this.playBgAnim(),this.navManager.selectDefaultNavBtn(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function(){Vl.preloadGameScene()}},{key:"initBgComp",value:function(){var e,t=Bx.getStorage("dashboard");if(null==t)throw new Error("DashboardScene: dashboardStorage not found");var n=null!==(e=t.animateToCurrentLevel)&&void 0!==e&&e,a=ke({},t.lastMapPayload),i=Cl.getCurrentMapProgress(),r=a.currentTheme===i.currentTheme&&a.nextTheme===i.nextTheme,o=i.currentTheme;n&&!r?this.bgComp.setCurrentTheme(a.currentTheme):this.bgComp.setCurrentTheme(o)}},{key:"getPlayerLeader",value:(o=Te(Se().mark((function e(t){var n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="global"==t?qs:Vs){e.next=3;break}return e.abrupt("return",null);case 3:return a=Gx.getPlayerId(),e.next=6,zx.getLeadersByPlayerIdsAsync(n,[a]);case 6:if(0!==(i=e.sent).length){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",i[0]);case 10:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(e){Bx.setStorageData("dashboard","animateToCurrentLevel",!1),Bx.setStorageData("dashboard","lastMapPayload",e)}},{key:"updateVolumeBackgroundMusic",value:function(){ga.turnUpMusic()}},{key:"checkDailyRewardsOpenable",value:function(){var e=Gx.getPlayerData().dailyRewarded,t=e.logDays,n=void 0===t?[]:t,a=e.lastRewarded,i=void 0===a?0:a;if(n.length>qx.MaxDays)return!0;if(qx.MockTime>0&&Date.now()-i>=1e3*qx.MockTime)return!0;return!Wx.isToday(i)}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"handleNavigateToStore",value:function(){}},{key:"onNavigateToCollections",value:(r=Te(Se().mark((function e(t){var n,a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),n=Cl.getCollectionUnlockProgress(),a=this.getCurrentUnlockingTheme(),e.next=5,this.pageManager.navigate(t,(function(e){return(i=e.getContainer().getComponentInChildren(ZC)).updateUnlockedProgress(n),Promise.resolve()}));case 5:if(void 0!==i){e.next=7;break}throw new Error("CollectionsContent not found");case 7:if(r=new ui,!(o=i.shouldAnimateThemeTabUnlock())){e.next=12;break}return e.next=12,this.pageAnimSkipOverlay.open({onSkip:function(){return r.abort()},opacity:200});case 12:if(!this.isFirstNavToCollections||null===a){e.next=16;break}return e.next=15,i.scrollToCurrentUnlockingTheme(a.skin,r);case 15:this.isFirstNavToCollections=!1;case 16:return e.next=18,i.playThemeTabUnlockAnim(r);case 18:if(!o){e.next=21;break}return e.next=21,this.pageAnimSkipOverlay.close();case 21:r.abort(),this.navManager.setIgnoreInput(!1);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onNavigateToTournaments",value:(i=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t);case 3:this.navManager.setIgnoreInput(!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"onNavigateToLeaderboard",value:(a=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t);case 3:this.navManager.setIgnoreInput(!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"setHomeDataAndGetNavAnim",value:function(){var e,t,n,a,i,r=this,o=this.pageManager.getPage(Fs.home).getContainer().getComponentInChildren(cx);this.coinManager.setTargetContainer(o.getCoinContainer());var s=null!==(e=null===(t=Gx.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:1,l="Level ".concat(s);o.setPlayButtonLabel(l),this.coinManager.emitCoinAmount();var u=null!==(n=null===(a=Gx.getGameData())||void 0===a?void 0:a.stars)&&void 0!==n?n:0;o.updateStarProgress(u);var c=Bx.getStorage("dashboard");if(null==c)throw new Error("DashboardScene: dashboardStorage not found");var h=null!==(i=c.animateToCurrentLevel)&&void 0!==i&&i,p=ke({},c.lastMapPayload),d=ke({},Cl.getCurrentMapProgress());if(Bx.getStorage("tournament").animateTournamentLeader)return o.setUnlockProgress(d),Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.navManager.selectByType(Fs.tournaments);case 2:case"end":return e.stop()}}),e)})));if(Kx.encode(p)===Kx.encode(d))o.setUnlockProgress(d);else if(h){var f=fl.mapOrder.findIndex((function(e){return e.id===p.id})),v=fl.mapOrder.findIndex((function(e){return e.id===d.id})),y=f===v;if(-1===f||-1===v)throw new Error("DashboardScene: map not found");
//! safe guard against dev tools time travel
if(!(f>v)){var m=fl.mapOrder.slice(f,v+2),g=new ui,b=o.prepareUnlockProgressAnimation(p,d,m,g);return Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.pageAnimSkipOverlay.open({onSkip:function(){return g.abort()},opacity:150});case 2:return e.next=4,b();case 4:if(g.aborted||y){e.next=7;break}return e.next=7,r.navManager.selectByType(Fs.collections);case 7:return e.next=9,r.pageAnimSkipOverlay.close();case 9:case"end":return e.stop()}}),e)})))}o.setUnlockProgress(d)}else o.setUnlockProgress(d)}},{key:"handleNavigateToHome",value:(n=Te(Se().mark((function e(t){var n,a,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t,Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=i.setHomeDataAndGetNavAnim();case 1:case"end":return e.stop()}}),e)}))));case 3:return this.navManager.setIgnoreInput(!1),e.next=6,this.tryOpenDailyRewardsScreen();case 6:return e.next=8,this.coinManager.untilFinishesCollectAnim();case 8:return e.next=10,this.pageAnimSkipOverlay.untilClosed();case 10:return e.next=12,null===(n=a)||void 0===n?void 0:n();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"tryOpenDailyRewardsScreen",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkDailyRewardsOpenable()){e.next=2;break}return e.abrupt("return");case 2:return iu.openScreen(da),e.abrupt("return",new Promise((function(e){Fx.on(Ux.CLOSED_SCREEN,(function t(n){n.screenName===da&&(e(),Fx.off(Ux.CLOSED_SCREEN,t))}))})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getCurrentUnlockingTheme",value:function(){var e=Cl.getCollectionUnlockProgress();if(0===e.length)return null;var t,n=e[0],a=Ye(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;i.isLocked||(n=i)}}catch(e){a.e(e)}finally{a.f()}return n}}]),u}(f)).prototype,"coinManager",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wx=Qe(gx.prototype,"navManager",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kx=Qe(gx.prototype,"bgComp",[fx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sx=Qe(gx.prototype,"pageManager",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cx=Qe(gx.prototype,"pageAnimSkipOverlay",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mx=gx))||mx);n._RF.pop(),n._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var jx,Yx=a.ccclass,Xx=a.property,Jx=globalThis.game.player,Qx=GameCore.Utils.Number.getShortNumber;Rx=Yx("HomePage"),Px=Xx({type:u,group:"Placeholders"}),Rx((Lx=Qe((_x=function(e){_e(o,e);var t,n,a,i,r=Ge(o);function o(){var e;xe(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=r.call.apply(r,[this].concat(n)),"coinLabel",Lx,Fe(e)),e}return Pe(o,[{key:"__preload",value:function(){var e;null===(e=Ue(Le(o.prototype),"__preload",this))||void 0===e||e.call(this),this.validateOwnRequiredComponents(),this.listenToCoinUpdateEvent()}},{key:"listenToCoinUpdateEvent",value:function(){this.node.scene.on($i.COIN_CHANGED,this.updateplaceholderCoins,this)}},{key:"updateplaceholderCoins",value:(i=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.coinLabel.string=Qx(t.coins,3);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"mount",value:(a=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(Le(o.prototype),"mount",this).call(this);case 2:if(this.homeContent){e.next=6;break}if(this.homeContent=this.container.getComponentInChildren(cx),this.homeContent){e.next=6;break}throw new Error("HomePage: homeContent not found");case 6:a=null!==(t=null===(n=Jx.getGameData())||void 0===n?void 0:n.coins)&&void 0!==t?t:0,this.updateplaceholderCoins({coins:a});case 8:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"transitionIn",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(Le(o.prototype),"transitionIn",this).call(this);case 2:this.homeContent.enableUIAnimator();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.homeContent.disableUIAnimator(),e.next=3,Ue(Le(o.prototype),"transitionOut",this).call(this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateOwnRequiredComponents",value:function(){if(!this.coinLabel)throw new Error("HomePage: coinLabel not found")}}]),o}(US)).prototype,"coinLabel",[Px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ix=_x));n._RF.pop(),n._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var Zx,$x,eR,tR,nR,aR,iR,rR,oR,sR,lR,uR,cR,hR,pR,dR,fR,vR,yR,mR,gR=(0,a.ccclass)("LeaderboardIsEmpty")(jx=function(e){_e(a,e);var t,n=Ge(a);function a(){return xe(this,a),n.apply(this,arguments)}return Pe(a,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"show",value:(t=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=255,t=this.node.position.clone(),(n=S(this.node)).to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)}),(a=S(this.node).repeat(2,n)).to(.05,{position:t}),e.next=9,mn.runTweenAsync(a);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),a}(f))||jx;n._RF.pop(),n._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var bR,wR,kR,SR,CR,ER,AR,TR=a.ccclass,xR=a.property,RR=a.requireComponent,PR=globalThis.game.analytics,IR=(Zx=TR("SwitchButton"),$x=RR([p,y]),eR=xR(H),tR=xR(i),nR=xR(i),aR=xR(H),iR=xR({visible:function(){return this.useSound},type:ea}),rR=xR(H),oR=xR({visible:function(){return this.useDesktopHover},type:_}),sR=xR({visible:function(){return this.useDesktopHover},type:_}),Zx(lR=$x((cR=Qe((uR=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"enable",cR,Fe(e)),Je(e,"nodeOn",hR,Fe(e)),Je(e,"nodeOff",pR,Fe(e)),Je(e,"useSound",dR,Fe(e)),Je(e,"soundKey",fR,Fe(e)),Je(e,"useDesktopHover",vR,Fe(e)),Je(e,"mouseEnterClip",yR,Fe(e)),Je(e,"mouseLeaveClip",mR,Fe(e)),e.isMouseLeaved=!1,e.onMouseEnter=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved=!1,e.animationComponent.play(e.mouseEnterClip.name))},e.onMouseLeave=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved||(e.isMouseLeaved=!0,e.animationComponent.play(e.mouseLeaveClip.name)))},e}return Pe(n,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(p),this.animationComponent=this.getComponent(y),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var e=this.animationComponent.clips.map((function(e){return null==e?void 0:e.name})).filter((function(e){return null!=e&&"string"==typeof e}));this.useDesktopHover&&(e.includes(this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),e.includes(this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(i.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(i.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(i.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(i.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(PR.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&ga.playSound(ta[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(e){this.node.active&&this.updateStatus(e)}},{key:"updateStatus",value:function(e){return this.enable===e||(this.onMouseLeave(null),this.enable=e,this.nodeOn.active=e,this.nodeOff.active=!e),this.enable}}]),n}(f)).prototype,"enable",[eR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),hR=Qe(uR.prototype,"nodeOn",[tR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pR=Qe(uR.prototype,"nodeOff",[nR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dR=Qe(uR.prototype,"useSound",[aR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),fR=Qe(uR.prototype,"soundKey",[iR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ea[Zn.BUTTON_CLICK]}}),vR=Qe(uR.prototype,"useDesktopHover",[rR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),yR=Qe(uR.prototype,"mouseEnterClip",[oR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mR=Qe(uR.prototype,"mouseLeaveClip",[sR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lR=uR))||lR)||lR);n._RF.pop(),n._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var _R,LR,OR,DR,MR,NR=a.ccclass,FR=a.property,BR=globalThis.game.analytics,GR=(bR=NR("Tabs"),wR=FR(IR),kR=FR(IR),bR((ER=Qe((CR=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"tabWorld",ER,Fe(e)),Je(e,"tabFriends",AR,Fe(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}},{key:"setInteractableButtons",value:function(e){this.tabWorld.getComponent(p).interactable=e,this.tabFriends.getComponent(p).interactable=e}},{key:"updateStatus",value:function(e){this.tabWorld.setEnabled("global"===e),this.tabFriends.setEnabled("friends"===e)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),BR.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:ma.getCurrentPage()}),this.node.scene.emit(vg.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),BR.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:ma.getCurrentPage()}),this.node.scene.emit(vg.FRIENDS_TAB_SELECTED)}}]),n}(f)).prototype,"tabWorld",[wR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AR=Qe(CR.prototype,"tabFriends",[kR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SR=CR))||SR);n._RF.pop(),n._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var zR,UR,HR,qR,VR,WR,KR,jR,YR,XR,JR,QR,ZR,$R,eP,tP,nP,aP,iP,rP,oP,sP,lP,uP,cP,hP,pP,dP,fP,vP,yP,mP,gP,bP,wP,kP,SP,CP,EP,AP,TP,xP=a.ccclass,RP=a.disallowMultiple,PP=a.property,IP=(_R=xP("LeaderSkeleton"),LR=PP(i),_R(OR=RP((MR=Qe((DR=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"container",MR,Fe(e)),e}return Pe(i,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"hide",value:(n=Te(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Te(Se().mark((function e(t,n){var a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,a=this.container.position.clone(),this.container.position=new j(a.x,a.y-100,a.z),(i=S(this.node).delay(t)).to(.2,{scale:j.ONE},{easing:"cubicOut"}),(r=S(this.container).delay(t)).to(.2,{position:a},{easing:"cubicOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),e.next=13,Promise.all([mn.runTweenAsync(i,n),mn.runTweenAsync(r,n),mn.runTweenAsync(o,n)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),i}(f)).prototype,"container",[LR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OR=DR))||OR)||OR);n._RF.pop(),n._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var _P,LP,OP,DP,MP,NP,FP,BP,GP,zP,UP,HP,qP,VP=a.ccclass,WP=a.property,KP=(zR=VP("Leader"),UR=WP(u),HR=WP(M),qR=WP({type:i,group:"Container"}),VR=WP({type:T,group:"Background"}),WR=WP({type:O,group:"Background"}),KR=WP({type:T,group:"Rank"}),jR=WP({type:u,group:"Rank"}),YR=WP({type:O,group:"Rank"}),XR=WP({type:O,group:"Rank"}),JR=WP({type:O,group:"Rank"}),QR=WP({type:O,group:"Rank"}),ZR=WP({type:T,group:"Avatar"}),$R=WP({type:M,group:"Avatar"}),eP=WP({type:T,group:"Score"}),tP=WP({type:u,group:"Score"}),nP=WP({type:O,group:"Score"}),aP=WP({type:M,group:"Score"}),iP=WP({type:M}),rP=WP({type:s}),zR((lP=Qe((sP=function(e){_e(l,e);var t,n,a,i,o,s=Ge(l);function l(){var e;xe(this,l);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=s.call.apply(s,[this].concat(n)),"nameLabel",lP,Fe(e)),Je(e,"nameOpacity",uP,Fe(e)),Je(e,"container",cP,Fe(e)),Je(e,"background",hP,Fe(e)),Je(e,"highlightBackground",pP,Fe(e)),Je(e,"rankSprite",dP,Fe(e)),Je(e,"rankLabel",fP,Fe(e)),Je(e,"goldRank",vP,Fe(e)),Je(e,"silverRank",yP,Fe(e)),Je(e,"bronzeRank",mP,Fe(e)),Je(e,"highlightRank",gP,Fe(e)),Je(e,"avatar",bP,Fe(e)),Je(e,"avatarOpacity",wP,Fe(e)),Je(e,"scoreBackground",kP,Fe(e)),Je(e,"scoreLabel",SP,Fe(e)),Je(e,"highlightScoreBackground",CP,Fe(e)),Je(e,"scoreOpacity",EP,Fe(e)),Je(e,"uiOpacity",AP,Fe(e)),Je(e,"uiTransform",TP,Fe(e)),e}return Pe(l,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e,t){this.updateBackground(e),this.updateRank(e,t),this.resetPhoto(),this.updateUsername(e),this.updateScore(e)}},{key:"updateBackground",value:function(e){this.background.spriteFrame=e.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(e,t){var n=e.rank;if(this.rankLabel.string!==n.toString()){this.rankLabel.string=t&&n>t?"".concat(t,"+"):n.toString(),this.rankSprite.spriteFrame=this.defaultRank;var a=new r(wg);switch(e.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,a=new r(Sg)),n){case 1:this.rankSprite.spriteFrame=this.goldRank,a=new r(yg);break;case 2:this.rankSprite.spriteFrame=this.silverRank,a=new r(mg);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,a=new r(gg)}this.rankLabel.shadowColor=a,this.rankLabel.outlineColor=a}}},{key:"setPhoto",value:function(e){e&&this.node.active&&(e.packable=!0,this.avatar.spriteFrame=e)}},{key:"resetPhoto",value:(o=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.defaultAvatar){e.next=7;break}return e.next=3,jn.loadSpriteFrameAsync("images/avatar-bg/spriteFrame");case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return");case 6:this.defaultAvatar=t;case 7:this.avatar.spriteFrame=this.defaultAvatar;case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"updateUsername",value:function(e){this.nameLabel.string=e.name,this.nameLabel.color=new r(e.isHighlight?kg:bg)}},{key:"updateScore",value:function(e){var t=Math.floor(e.score);this.scoreLabel.string=GameCore.Utils.Number.getShortNumber(t,7);var n=this.scoreLabel.getComponent(u);n.outlineColor=new r(e.isHighlight?Sg:wg),n.shadowColor=new r(e.isHighlight?Sg:wg),this.scoreBackground.spriteFrame=e.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(i=Te(Se().mark((function e(t,n){var a,i,r,o,s,l=this,u=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=u.length>2&&void 0!==u[2]?u[2]:.3,this.node.scale=new j(.8,.8,.8),this.setOpacity(0),i=this.container.position.clone(),this.container.position=new j(i.x,i.y-100,i.z),(r=S(this.node).delay(n)).to(a,{scale:j.ONE},{easing:"elasticOut"}),(o=S(this.container).delay(n)).to(a,{position:i},{easing:"backOut"}),(s=S(this.uiOpacity).delay(n)).to(a,{opacity:255},{easing:"cubicOut",onUpdate:function(){l.nameOpacity.opacity=l.uiOpacity.opacity,l.scoreOpacity.opacity=l.uiOpacity.opacity,l.avatarOpacity.opacity=l.uiOpacity.opacity}}),t.addAbortListener((function(){l.node.scale=j.ONE,l.container.position=i,l.uiOpacity.opacity=255,l.avatar.node.active=!0})),e.next=14,Promise.all([mn.runTweenAsync(r,t),mn.runTweenAsync(o,t),mn.runTweenAsync(s,t)]);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(a=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=S(this.node).to(n,{worldPosition:t},{easing:"quadOut"}),e.next=3,mn.runTweenAsync(a);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"runScaleAnimation",value:(n=Te(Se().mark((function e(t,n,a){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=S(this.node).to(a,{scale:new j(n,n,n)},{easing:"backOut"}),e.next=3,mn.runTweenAsync(i,t);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,a){return n.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(t=Te(Se().mark((function e(t,n,a,i,r){var o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=S({}).to(r,{},{easing:"quartOut",onUpdate:function(e,r){if(r){var o=Math.floor(t+(n-t)*r),l=Math.floor(a+(i-a)*r);s.updateRank({rank:o,isHighlight:!0}),s.updateScore({score:l,isHighlight:!0})}}}),e.next=3,mn.runTweenAsync(o);case 3:case"end":return e.stop()}}),e)}))),function(e,n,a,i,r){return t.apply(this,arguments)})},{key:"setOpacity",value:function(e){this.uiOpacity.opacity=e,this.nameOpacity.opacity=e,this.scoreOpacity.opacity=e,this.avatarOpacity.opacity=e}}]),l}(f)).prototype,"nameLabel",[UR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uP=Qe(sP.prototype,"nameOpacity",[HR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cP=Qe(sP.prototype,"container",[qR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hP=Qe(sP.prototype,"background",[VR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pP=Qe(sP.prototype,"highlightBackground",[WR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dP=Qe(sP.prototype,"rankSprite",[KR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fP=Qe(sP.prototype,"rankLabel",[jR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vP=Qe(sP.prototype,"goldRank",[YR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yP=Qe(sP.prototype,"silverRank",[XR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mP=Qe(sP.prototype,"bronzeRank",[JR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gP=Qe(sP.prototype,"highlightRank",[QR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bP=Qe(sP.prototype,"avatar",[ZR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wP=Qe(sP.prototype,"avatarOpacity",[$R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kP=Qe(sP.prototype,"scoreBackground",[eP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SP=Qe(sP.prototype,"scoreLabel",[tP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CP=Qe(sP.prototype,"highlightScoreBackground",[nP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EP=Qe(sP.prototype,"scoreOpacity",[aP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AP=Qe(sP.prototype,"uiOpacity",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TP=Qe(sP.prototype,"uiTransform",[rP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oP=sP))||oP);n._RF.pop(),n._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var jP,YP,XP,JP,QP,ZP,$P,eI,tI,nI,aI,iI,rI,oI,sI,lI,uI,cI=a.ccclass,hI=a.property,pI=globalThis.game,dI=pI.player,fI=pI.frameCapture,vI=(_P=cI("Leaders"),LP=hI(P),OP=hI(i),DP=hI(A),MP=hI(s),NP=hI(g),_P((GP=Qe((BP=function(e){_e(u,e);var t,n,a,i,r,o=Ge(u);function u(){var e;xe(this,u);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=o.call.apply(o,[this].concat(n)),"leaderPrefab",GP,Fe(e)),Je(e,"inactiveNodeContainer",zP,Fe(e)),Je(e,"layout",UP,Fe(e)),Je(e,"viewport",HP,Fe(e)),Je(e,"maxLeader",qP,Fe(e)),e.cachedPhotos=new Map,e.leaderData=[],e.leaderPoolArray=[],e.playerLeader=null,e.isHidden=!0,e}return Pe(u,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.batchNodes=this.getComponents(ys),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=dI.getPlayerId();for(var e=0;e<this.maxLeader;e++){var t=this.createLeader();this.leaderPoolArray.push(t)}var n=this.leaderPoolArray[0].uiTransform.contentSize;this.leaderContentHeight=n.height+this.layout.spacingY}},{key:"createLeader",value:function(){var e=l(this.leaderPrefab);return this.addLeaderToInactiveNode(e),e.getComponent(KP)}},{key:"updateData",value:(r=Te(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.playerLeader=null,this.isHidden=!1,this.leaderData=t,this.leaderData.sort((function(e,t){return t.score-e.score})),null!=dI){e.next=6;break}throw new Error("Player is not defined");case 6:return this.batchNodes.every((function(e){return e.enabled=!0})),e.next=9,Promise.all(this.leaderData.map((function(e,t){var a=e.playerId,i=e.photo,r=e.score,o=e.name,s=n.currentPlayerId===a;n.leaderData[t].rank=t+1;var l=n.maxLeader-1;if(!(t>=l)||s){var u=s&&t>l-1?n.leaderPoolArray[l]:n.leaderPoolArray[t];return n.layout.node.addChild(u.node),u.setOpacity(0),s&&(n.playerLeader=u),u.updateInfo({isHighlight:s,name:o,photo:i,rank:t+1,score:r},l),n.getAndSetLeaderPhoto({playerId:a,url:i,leader:u})}})));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getAndSetLeaderPhoto",value:(i=Te(Se().mark((function e(t){var n,a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.playerId,a=t.url,i=t.leader,"default"!==a){e.next=3;break}return e.abrupt("return");case 3:if(!this.cachedPhotos.has(n)){e.next=6;break}return i.setPhoto(this.cachedPhotos.get(n)),e.abrupt("return");case 6:return e.prev=6,e.next=9,this.loadAvatarImage(a,85,85,n);case 9:if(r=e.sent){e.next=12;break}return e.abrupt("return");case 12:o=O.createWithImage(r),this.cachedPhotos.set(n,o),i.setPhoto(o),e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(6),!(e.t0 instanceof DOMException&&"AbortError"===e.t0.name)){e.next=22;break}return console.info("Leaders: getAndSetLeaderPhoto was aborted"),e.abrupt("return");case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[6,17]])}))),function(e){return i.apply(this,arguments)})},{key:"removeLeaders",value:function(){var e=this;this.isHidden=!0,this.getActiveLeaders().forEach((function(t){t.resetPhoto(),e.addLeaderToInactiveNode(t.node)})),this.batchNodes.every((function(e){return e.enabled=!1}))}},{key:"getActiveLeaders",value:function(){var e=this;return this.leaderPoolArray.filter((function(t){return t.node.parent===e.layout.node}))}},{key:"getActiveLeaderChildren",value:function(){return this.layout.getComponentsInChildren(KP)}},{key:"showLeaders",value:(a=Te(Se().mark((function e(t){var n,a,i,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isHidden){e.next=2;break}return e.abrupt("return");case 2:if(!((n=this.getActiveLeaders()).length<1)){e.next=5;break}return e.abrupt("return");case 5:return a=Math.ceil(this.viewport.contentSize.height/this.leaderContentHeight),i=Math.min(n.length,a),e.next=10,Promise.all(n.map(function(){var e=Te(Se().mark((function e(n,a){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.isHidden){e.next=2;break}return e.abrupt("return");case 2:if(!(a<i)){e.next=5;break}return e.next=5,n.runShowUpAnimation(t,.1*a,.3);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"runUpdateLeadersRankAnimation",value:(n=Te(Se().mark((function e(t,n){var a,i,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=null!=t?t:0,i=null!=n?n:this.leaderData.length,i=Math.min(i,100),r=this.getActiveLeaderChildren(),o=this.leaderContentHeight,s=[],l=a;l<i;l++)r[l].updateRank({rank:l+1,isHighlight:!1}),u=r[l].node.worldPosition.clone(),s.push(r[l].runWorldPositionAnimation(u.add3f(0,-o,0),.25));return e.next=9,Promise.all(s);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"getPlayerLeader",value:function(){return this.playerLeader}},{key:"getLeaderByRank",value:function(e){return this.getActiveLeaders()[e-1]||null}},{key:"getLeaderDataByRank",value:function(e){return this.leaderData[e-1]||null}},{key:"updateVisibility",value:function(){var e=this.viewport.getBoundingBoxToWorld(),t=e.yMax,n=e.yMin;this.getActiveLeaders().forEach((function(e){var a=e.uiTransform;if(void 0!==a){var i=a.getBoundingBoxToWorld(),r=i.yMax,o=i.yMin,s=r<n||o>t;e.setOpacity(s?0:255)}}))}},{key:"loadAvatarImage",value:(t=Te(Se().mark((function e(t,n,a,i){var r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fI.captureAsync({width:n,height:a,name:"LeaderAvatar",renderOptions:Ie({},i,{name:i,type:"image",depth:0,position:[0,0],size:[n,a],image:t})});case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,GameCore.Utils.Image.loadImage(r);case 8:return e.abrupt("return",e.sent);case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),function(e,n,a,i){return t.apply(this,arguments)})},{key:"addLeaderToInactiveNode",value:function(e){this.inactiveNodeContainer.addChild(e),e.getComponent(KP).setOpacity(0)}}]),u}(f)).prototype,"leaderPrefab",[LP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zP=Qe(BP.prototype,"inactiveNodeContainer",[OP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UP=Qe(BP.prototype,"layout",[DP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HP=Qe(BP.prototype,"viewport",[MP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qP=Qe(BP.prototype,"maxLeader",[NP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FP=BP))||FP);n._RF.pop(),n._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var yI,mI=a.ccclass,gI=a.property,bI=globalThis.game,wI=bI.storage,kI=bI.leaderboard,SI=bI.player,CI=(jP=mI("LeaderboardContent"),YP=gI(Tr),XP=gI(GR),JP=gI(vI),QP=gI(le),ZP=gI({type:[IP]}),$P=gI(gR),eI=gI(yi),jP((aI=Qe((nI=function(e){_e(c,e);var t,n,a,i,r,o,l,u=Ge(c);function c(){var e;xe(this,c);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=u.call.apply(u,[this].concat(n)),"panelAnimator",aI,Fe(e)),Je(e,"tabs",iI,Fe(e)),Je(e,"leaders",rI,Fe(e)),Je(e,"scrollview",oI,Fe(e)),Je(e,"leaderSkeletons",sI,Fe(e)),Je(e,"leaderboardIsEmpty",lI,Fe(e)),Je(e,"contentOpacity",uI,Fe(e)),e.isHidden=!0,e.currentLb=null,e.animAbortSignal=null,e.fetchAbortController=null,e.handleUpdateVisibility=function(){e.leaders.updateVisibility()},e.handleFriendsTabSelected=Te(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return wI.setStorageData("leaderboard_content","lastTabOpened","friends"),e.cleanupSideEffects(),t.next=4,e.updateStatus("friends");case 4:case"end":return t.stop()}}),t)}))),e.handleWorldTabSelected=Te(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return wI.setStorageData("leaderboard_content","lastTabOpened","global"),e.cleanupSideEffects(),t.next=4,e.updateStatus("global");case 4:case"end":return t.stop()}}),t)}))),e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return Pe(c,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"listenEvents",value:function(){this.node.scene.on(vg.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(vg.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on($i.HIDE_UI,this.hideContent),this.node.scene.on($i.SHOW_UI,this.showContent),this.scrollview.node.on(le.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenEvents",value:function(){this.node.scene.off(vg.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(vg.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents(),this.scrollview.node.off(le.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenUIEvents",value:function(){this.node.scene.off($i.HIDE_UI,this.hideContent),this.node.scene.off($i.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(l=Te(Se().mark((function e(t,n){var a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.aborted){e.next=2;break}return e.abrupt("return",null);case 2:if(a=this.getLeaderboardName(t)){e.next=5;break}return e.abrupt("return",null);case 5:return i=GameCore.Configs.Leaderboards.Limit,e.next=8,kI.requestLeaderboardAsync(a,i);case 8:if(!n.aborted){e.next=10;break}return e.abrupt("return",null);case 10:return e.abrupt("return",kI.getLeaderboard(a));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"getLeaderboardName",value:function(e){return"friends"===e?Vs:qs}},{key:"loadMoreLeaderboard",value:(o=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.aborted){e.next=2;break}return e.abrupt("return",null);case 2:if(a=this.getLeaderboardName(t)){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,kI.loadMoreLeaderboardAsync(a,1e3);case 7:if(!n.aborted){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",kI.getLeaderboard(a));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"showLoading",value:(r=Te(Se().mark((function e(t){var n,a=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:0,this.scrollview.scrollToTop(0),this.scrollview.enabled=!1,e.next=5,Promise.all([this.leaderSkeletons.map((function(e,a){return e.show(a*n,t)}))]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"hideLoading",value:(i=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.leaderSkeletons.map((function(e){return e.hide(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"enter",value:function(){this.listenEvents(),this.isHidden=!1;var e=wI.getStorageData("leaderboard_content","lastTabOpened");"friends"===e&&this.handleFriendsTabSelected(),"global"===e&&this.handleWorldTabSelected()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){var e,t;null===(e=this.animAbortSignal)||void 0===e||e.abort(),this.animAbortSignal=null,null===(t=this.fetchAbortController)||void 0===t||t.abort(),this.fetchAbortController=null,this.leaders.removeLeaders(),this.leaderboardIsEmpty.hide()}},{key:"isAborted",value:function(){var e,t,n,a,i=null===(e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===e||e,r=null===(n=null===(a=this.fetchAbortController)||void 0===a?void 0:a.signal.aborted)||void 0===n||n;return i||r}},{key:"updateStatus",value:(a=Te(Se().mark((function e(t){var n,a,i,r,o,s,l,u,c,h,p,d,f;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this.animAbortSignal&&null===this.fetchAbortController){e.next=2;break}throw new Error("LeaderboardContent: LeaderboardContent is already loading. Please handle cancelling gracefully.");case 2:if(!this.isHidden){e.next=4;break}return e.abrupt("return");case 4:return this.tabs.updateStatus(t),this.animAbortSignal=new ui,this.fetchAbortController=new AbortController,e.next=9,this.showLoading(this.animAbortSignal);case 9:return e.next=11,this.loadLeaderboard(t,this.animAbortSignal);case 11:if(this.currentLb=e.sent,this.currentLb){e.next=14;break}return e.abrupt("return");case 14:if(0!==Object.values(this.currentLb.leaders).length){e.next=19;break}return this.leaderboardIsEmpty.show(),this.tabs.setInteractableButtons(!0),this.hideLoading(this.animAbortSignal),e.abrupt("return");case 19:if(a=SI.getPlayerId(),i=this.currentLb.leaders[a]){e.next=28;break}if(!(r=this.getLeaderboardName(t))){e.next=28;break}return e.next=26,kI.getLeadersByPlayerIdsAsync(r,[a]);case 26:(o=e.sent).length>0&&(i=o[0],this.currentLb.leaders[a]=i);case 28:return s=wI.getStorage("leaderboard_content"),l=s.previousScore,u=s.previousRank,c=null!==(n=i)&&void 0!==n?n:{},h=c.score,p=c.rank,l&&l<h&&u&&u!==p&&(this.currentLb.leaders[a].score=l),d=Object.values(this.currentLb.leaders),jn.setBlockInput(!0),this.tabs.setInteractableButtons(!1),e.next=36,this.hideLoading(this.animAbortSignal);case 36:if(!this.isAborted()){e.next=40;break}return jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 40:return this.leaders.updateData(d),this.scrollview.enabled=!0,e.next=44,this.leaders.showLeaders(this.animAbortSignal);case 44:if(!this.isAborted()){e.next=48;break}return jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 48:if(f=this.leaders.getPlayerLeader()){e.next=53;break}return jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 53:return e.next=55,this.scrollToLeader(f,1);case 55:if(!this.isAborted()){e.next=59;break}return jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 59:return e.next=61,this.runPlayerRankChangeAnimation(this.animAbortSignal,h);case 61:if(!this.isAborted()){e.next=65;break}return jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 65:wI.setStorageData("leaderboard_content","previousScore",h),wI.setStorageData("leaderboard_content","previousRank",p),jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0);case 69:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(n=Te(Se().mark((function e(t,n){var a,i,r,o,s,l,u,c,h,p,d,f,v,y,m;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=wI.getStorage("leaderboard_content"),(i=a.previousScore)&&!(i>=n)){e.next=3;break}return e.abrupt("return");case 3:if(r=this.leaders.getLeaderData(),-1!==(o=r.findIndex((function(e){return e.playerId===SI.getPlayerId()})))){e.next=7;break}return e.abrupt("return");case 7:if(s=r[o],l=s.score,u=s.rank,s.score=n,r.sort((function(e,t){return t.score-e.score})),r.forEach((function(e,t){e.rank=t+1})),c=this.leaders.getPlayerLeader()){e.next=15;break}return e.abrupt("return");case 15:if(u!==s.rank){e.next=18;break}return c.updateScore({score:s.score,isHighlight:!0}),e.abrupt("return");case 18:if(h=this.leaders.getLeaderByRank(s.rank)){e.next=21;break}return e.abrupt("return");case 21:return this.leaders.layout.enabled=!1,e.next=24,c.runScaleAnimation(t,1.1,.5);case 24:return p=Math.min(.5*(u-s.rank),2),d=[c.runUpdateDataAnimation(u,s.rank,l,s.score,p),this.scrollToLeader(h,p)],f=this.uiTransform.contentSize.height,v=this.scrollview.getMaxScrollOffset().y,y=-h.node.position.y-f/2,m=j.ZERO,y<0?m=new j(c.node.worldPosition.x,f+h.node.position.y,c.node.worldPosition.z):this.scrollview.getScrollOffset().y>=v-5&&(m=y<v?new j(c.node.worldPosition.x,f/2,c.node.worldPosition.z):h.node.worldPosition),m.equals(j.ZERO)||d.push(c.runWorldPositionAnimation(m,p)),e.next=34,Promise.all(d);case 34:return e.next=36,Promise.all([c.runScaleAnimation(t,1,.25),c.node.setSiblingIndex(s.rank-1),this.leaders.runUpdateLeadersRankAnimation(s.rank,u)]);case 36:this.leaders.layout.enabled=!0,this.leaders.layout.updateLayout();case 38:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"scrollToLeader",value:(t=Te(Se().mark((function e(t,n){var a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.uiTransform.contentSize,i=new J(0,-t.node.position.y-a.height/2),r=this.scrollview.getScrollOffset().clone(),i.y=Math.max(i.y,0),r.y=Math.max(r.y,0),o=i.y-r.y,!(Math.abs(o)<5)){e.next=8;break}return e.abrupt("return");case 8:return this.scrollview.scrollToOffset(i,n),e.abrupt("return",mn.waitTweenAsync(n));case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),c}(f)).prototype,"panelAnimator",[YP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iI=Qe(nI.prototype,"tabs",[XP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rI=Qe(nI.prototype,"leaders",[JP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oI=Qe(nI.prototype,"scrollview",[QP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sI=Qe(nI.prototype,"leaderSkeletons",[ZP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lI=Qe(nI.prototype,"leaderboardIsEmpty",[$P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uI=Qe(nI.prototype,"contentOpacity",[eI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tI=nI))||tI);n._RF.pop(),n._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var EI,AI,TI,xI,RI,PI,II,_I,LI,OI,DI,MI,NI,FI,BI,GI,zI;(0,a.ccclass)("LeaderboardPage")(yI=function(e){_e(r,e);var t,n,a,i=Ge(r);function r(){return xe(this,r),i.apply(this,arguments)}return Pe(r,[{key:"mount",value:(a=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,jn.loadPrefabAsync(Fn.LEADERBOARD_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,Ue(Le(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(CI),this.content){e.next=11;break}throw new Error("LeaderboardPage: Leaders not found");case 11:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"transitionIn",value:(n=Te(Se().mark((function e(){var t,n,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(Le(r.prototype),"transitionIn",this).call(this);case 2:return this.content.enableUIAnimator(),t=mn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){a.node.scene.emit($i.SHOW_UI,{onComplete:function(){e()}})})),e.next=7,Promise.all([t,n]);case 7:this.content.enter();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(Le(r.prototype),"transitionOut",this).call(this);case 2:return this.content.unlistenUIEvents(),e.next=5,new Promise((function(e){t.node.scene.emit($i.HIDE_UI,{onComplete:function(){e()}})}));case 5:this.content.disableUIAnimator();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"unmount",value:function(){var e,t;null===(e=this.content)||void 0===e||e.hide(),null===(t=this.content)||void 0===t||t.cleanup(),Ue(Le(r.prototype),"unmount",this).call(this)}}]),r}(US));n._RF.pop(),n._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var UI,HI,qI,VI,WI,KI=a.ccclass,jI=a.property,YI=globalThis.game,XI=YI.leaderboard,JI=YI.player,QI=(EI=KI("TournamentBlock"),AI=jI(i),TI=jI(u),xI=jI(u),RI=jI(u),PI=jI(u),II=jI(s),_I=jI({type:[T]}),EI((DI=Qe((OI=function(e){_e(r,e);var t,n,a,i=Ge(r);function r(){var e;xe(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=i.call.apply(i,[this].concat(n)),"container",DI,Fe(e)),Je(e,"titleLabel",MI,Fe(e)),Je(e,"timeLabel",NI,Fe(e)),Je(e,"playerCountLabel",FI,Fe(e)),Je(e,"playButtonLabel",BI,Fe(e)),Je(e,"uiTransform",GI,Fe(e)),Je(e,"banners",zI,Fe(e)),e}return Pe(r,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(M),this.validateRequiredComponents()}},{key:"activateThemeBanner",value:function(e){var t=!1;this.banners.forEach((function(n){n.node.active=n.node.name.toLowerCase()===e,n.node.active&&(t=!0)})),t||this.banners.forEach((function(e){e.node.active=e.node.name.toLowerCase()===gl.SUMMER}))}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"updateInfo",value:(a=Te(Se().mark((function e(t){var n,a,i,r,o,s,l,u,c,h,p;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.payload=t,n=t.endTime,a=t.title,i=t.payload,r=i.leaderboardId,o=i.themeId,r){e.next=5;break}return e.abrupt("return");case 5:return this.setPlayerCountWaiting(),this.updateTitle(a),this.updateEndTime(n),this.updateTournamentBanner(o),s={leaders:[],isPlayerInTournament:!1},e.prev=10,e.next=13,this.getLeadersPayload(r);case 13:(l=e.sent)&&(s=l),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),console.error("Fetch lb for tournament ".concat(a),e.t0);case 20:this.leadersPayload=s,u=this.leadersPayload,c=u.leaders,h=u.isPlayerInTournament,p=c.length,this.updatePlayerCount(p),this.updatePlayButtonLabel(h);case 25:case"end":return e.stop()}}),e,this,[[10,17]])}))),function(e){return a.apply(this,arguments)})},{key:"updateTitle",value:function(e){e&&(this.titleLabel.string=e)}},{key:"updateEndTime",value:function(e){var t=GameCore.Utils.Time.getRelativeTime(e);this.timeLabel.string="Ends ".concat(t)}},{key:"updatePlayerCount",value:function(e){this.playerCountLabel.string="".concat(e," ")+(e>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"updateTournamentBanner",value:function(e){e?this.activateThemeBanner(e):this.activateThemeBanner(gl.SUMMER)}},{key:"updatePlayButtonLabel",value:function(e){this.playButtonLabel.string=e?"Continue":"Join"}},{key:"getLeadersPayload",value:(n=Te(Se().mark((function e(t){var n,a,i,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=XI.getLeaderboardName(t)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,XI.requestLeaderboardAsync(n,0);case 5:if(a=XI.getLeaderboard(n)){e.next=8;break}return e.abrupt("return",null);case 8:for(i=Object.values(a.leaders),r=JI.getPlayerId(),o={leaders:[],player:void 0,isPlayerInTournament:!1},s=0,l=i;s<l.length;s++)(u=l[s]).playerId===r?(o.player=u,o.isPlayerInTournament=!0,o.leaders.push(u)):o.leaders.push(u);return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(t=Te(Se().mark((function e(t,n,a){var i,r,o,s,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,i=this.container.position.clone(),this.container.position=new j(i.x,i.y-100,i.z),(r=S(this.node).delay(t)).to(n,{scale:j.ONE},{easing:"elasticOut"}),(o=S(this.container).delay(t)).to(n,{position:i},{easing:"backOut"}),(s=S(this.uiOpacity).delay(t)).to(n,{opacity:255},{easing:"cubicOut"}),a.addAbortListener((function(){l.node.scale=j.ONE,l.container.position=i,l.uiOpacity.opacity=255})),e.next=13,Promise.all([mn.runTweenAsync(r,a),mn.runTweenAsync(o,a),mn.runTweenAsync(s,a)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n,a){return t.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var e=this.payload.id||"";if(gv.validateTournamentExpired(e))return this.node.scene.emit(tl.RELOAD_TOURNAMENT),void iu.showNotificationScreen("Tournament has ended",2);try{var t=JSON.stringify(this.payload);iu.showTournamentDetailScreen(t,"tournament_start")}catch(e){console.warn("handleOnTournamentClicked",e)}}}]),r}(f)).prototype,"container",[AI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MI=Qe(OI.prototype,"titleLabel",[TI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NI=Qe(OI.prototype,"timeLabel",[xI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FI=Qe(OI.prototype,"playerCountLabel",[RI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=Qe(OI.prototype,"playButtonLabel",[PI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GI=Qe(OI.prototype,"uiTransform",[II],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zI=Qe(OI.prototype,"banners",[_I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),LI=OI))||LI);n._RF.pop(),n._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var ZI,$I,e_,t_,n_,a_,i_,r_,o_,s_,l_,u_=a.ccclass,c_=a.property,h_=(UI=u_("TournamentBlockSkeleton"),HI=c_(i),UI((WI=Qe((VI=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"container",WI,Fe(e)),e}return Pe(i,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"hide",value:(n=Te(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Te(Se().mark((function e(t,n){var a,i,r,o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,a=this.container.position.clone(),this.container.position=new j(a.x,a.y-100,a.z),(i=S(this.node).delay(t)).to(.2,{scale:j.ONE},{easing:"elasticOut"}),(r=S(this.container).delay(t)).to(.2,{position:a},{easing:"backOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),n.addAbortListener((function(){s.node.scale=j.ONE,s.container.position=a,s.uiOpacity.opacity=255})),e.next=14,Promise.all([mn.runTweenAsync(i,n),mn.runTweenAsync(r,n),mn.runTweenAsync(o,n)]);case 14:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),i}(f)).prototype,"container",[HI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qI=VI))||qI);n._RF.pop(),n._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var p_,d_,f_,v_,y_,m_=a.ccclass,g_=a.property,b_=globalThis.game.player,w_=(ZI=m_("TournamentsBoard"),$I=g_(P),e_=g_(i),t_=g_(A),n_=g_(i),ZI((r_=Qe((i_=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"tournamentBlockPrefab",r_,Fe(e)),e.tournamentBlockArray=[],Je(e,"inactiveNodeContainer",o_,Fe(e)),Je(e,"layout",s_,Fe(e)),Je(e,"createTournamentButton",l_,Fe(e)),e}return Pe(a,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"start",value:function(){for(var e=0;e<20;e++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"updateData",value:function(e){var t=this,n=!1;e.forEach((function(e,a){var i=t.tournamentBlockArray[a];e.payload.playerId===b_.getPlayerId()&&(n=!0),i||(i=t.addTournamentBlock()),i.updateInfo(e),t.layout.node.addChild(i.node)})),n||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var e=l(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(e);var t=e.getComponent(QI);return this.tournamentBlockArray.push(t),t}},{key:"removeTournamentBlocks",value:function(){var e=this;this.getActiveTournamentBlocks().forEach((function(t){e.inactiveNodeContainer.addChild(t.node)})),this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var e=this;return this.tournamentBlockArray.filter((function(t){return t.node.parent===e.layout.node}))}},{key:"setCreateTournamentButtonActive",value:function(e){e?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=e}},{key:"showTournamentBlocks",value:(t=Te(Se().mark((function e(t,n){var a,i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((a=this.getActiveTournamentBlocks()).length<1)){e.next=3;break}return e.abrupt("return");case 3:return i=Math.ceil(t/this.tournamentBlockContentHeight),r=Math.min(a.length,i),e.next=8,Promise.all(a.map(function(){var e=Te(Se().mark((function e(t,a){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a>=r)){e.next=4;break}return e.next=3,t.runShowPopUpAnimation(.1*a,.3,n);case 3:return e.abrupt("return");case 4:t.uiOpacity.opacity=255;case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 8:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"updateVisibility",value:function(){var e=this.uiTransform.getBoundingBoxToWorld(),t=e.yMax,n=e.yMin;this.getActiveTournamentBlocks().forEach((function(e){var a=e.uiTransform;if(void 0!==a){var i=a.getBoundingBoxToWorld(),r=i.yMax,o=i.yMin,s=r<n||o>t;e.uiOpacity.opacity=s?0:255}}))}}]),a}(f)).prototype,"tournamentBlockPrefab",[$I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o_=Qe(i_.prototype,"inactiveNodeContainer",[e_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s_=Qe(i_.prototype,"layout",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l_=Qe(i_.prototype,"createTournamentButton",[n_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a_=i_))||a_);n._RF.pop(),n._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var k_,S_,C_,E_,A_,T_,x_,R_,P_,I_,__,L_,O_,D_,M_,N_=a.ccclass,F_=a.property,B_=(p_=N_("TournamentsNotAvailable"),d_=F_(p),p_((y_=Qe((v_=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"createButton",y_,Fe(e)),e}return Pe(a,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"show",value:(t=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.createButton.interactable=!0,this.uiOpacity.opacity=255,t=this.node.position.clone(),(n=S(this.node)).to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)}),(a=S(this.node).repeat(2,n)).to(.05,{position:t}),e.next=10,mn.runTweenAsync(a);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hide",value:function(){this.createButton.interactable=!1,this.uiOpacity.opacity=0}}]),a}(f)).prototype,"createButton",[d_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f_=v_))||f_);n._RF.pop(),n._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var G_,z_=a.ccclass,U_=a.property,H_=globalThis.game,q_=H_.storage,V_=H_.match,W_=GameCore.Utils.Object,K_=(k_=z_("TournamentContent"),S_=U_({type:Tr}),C_=U_(w_),E_=U_(B_),A_=U_(le),T_=U_({type:[h_]}),x_=U_(yi),k_((I_=Qe((P_=function(e){_e(o,e);var t,n,a,i,r=Ge(o);function o(){var e;xe(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=r.call.apply(r,[this].concat(n)),"panelAnimator",I_,Fe(e)),Je(e,"tournamentsBoard",__,Fe(e)),Je(e,"tournamentsNotAvailable",L_,Fe(e)),Je(e,"scrollView",O_,Fe(e)),Je(e,"skeletons",D_,Fe(e)),Je(e,"contentOpacity",M_,Fe(e)),e.animAbortSignal=null,e.softAbortSignal=null,e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return Pe(o,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(le.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(tl.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on($i.HIDE_UI,this.hideContent),this.node.scene.on($i.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(le.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(tl.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off($i.HIDE_UI,this.hideContent),this.node.scene.off($i.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(i=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.listenEvents(),null===this.animAbortSignal&&null===this.softAbortSignal){e.next=3;break}throw new Error("TournamentContent: TournamentContent is already running");case 3:return this.animAbortSignal=new ui,this.softAbortSignal=new ui,this.showTournamentResult(),e.next=8,this.showLoading(this.animAbortSignal);case 8:if(!this.isAborted()){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,gv.requestTournamentDataAsync();case 12:if(n=e.sent,!this.isAborted()){e.next=15;break}return e.abrupt("return");case 15:return e.next=17,this.hideLoading(this.animAbortSignal);case 17:if(!this.isAborted()){e.next=19;break}return e.abrupt("return");case 19:if(0!==n.length||null!==(t=this.softAbortSignal)&&void 0!==t&&t.aborted){e.next=22;break}return this.tournamentsNotAvailable.show(),e.abrupt("return");case 22:return this.scrollView.enabled=!0,this.tournamentsBoard.updateData(n),e.next=26,this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal);case 26:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"showLoading",value:(a=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.scrollView.scrollToTop(0),this.scrollView.enabled=!1,e.next=4,Promise.all([this.skeletons.map((function(e){return e.show(0,t)}))]);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"hideLoading",value:(n=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.skeletons.map((function(e){return e.hide(t)}))]);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"showTournamentResult",value:function(){try{if(!q_.getStorage("tournament").animateTournamentLeader)return;var e=gv.getAllTournamentData(),t=V_.getMatchState().customData.tournamentId;if(!t)throw new Error("Tournament ID not found");var n=e.find((function(e){return e.id===t}));if(!n)throw new Error("Tournament not found");var a=JSON.stringify(n);iu.showTournamentDetailScreen(a,"tournament_end")}catch(e){q_.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",e)}}},{key:"processCreateTournament",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Dl.processCreateTournamentAsync();case 3:e.next=13;break;case 5:if(e.prev=5,e.t0=e.catch(0),W_.hasOwn(e.t0,"code")){e.next=10;break}return iu.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament"),e.abrupt("return");case 10:if("USER_INPUT"!==e.t0.code){e.next=12;break}return e.abrupt("return");case 12:"INVALID_OPERATION"===e.t0.code?iu.showNotificationScreen(e.t0.message):iu.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament");case 13:this.reload();case 14:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return t.apply(this,arguments)})},{key:"isAborted",value:function(){var e,t;return null===(e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===e||e}},{key:"cleanup",value:function(){var e;this.unlistenEvents(),null===(e=this.animAbortSignal)||void 0===e||e.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var e;null===(e=this.softAbortSignal)||void 0===e||e.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.enter()}}]),o}(f)).prototype,"panelAnimator",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),__=Qe(P_.prototype,"tournamentsBoard",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L_=Qe(P_.prototype,"tournamentsNotAvailable",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O_=Qe(P_.prototype,"scrollView",[A_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_=Qe(P_.prototype,"skeletons",[T_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),M_=Qe(P_.prototype,"contentOpacity",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R_=P_))||R_);n._RF.pop(),n._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var j_,Y_,X_,J_,Q_,Z_;(0,a.ccclass)("TournamentPage")(G_=function(e){_e(r,e);var t,n,a,i=Ge(r);function r(){return xe(this,r),i.apply(this,arguments)}return Pe(r,[{key:"mount",value:(a=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,jn.loadPrefabAsync(Fn.TOURNAMENTS_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,Ue(Le(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(K_),this.content){e.next=11;break}throw new Error("LeaderboardPage: Leaders not found");case 11:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"transitionIn",value:(n=Te(Se().mark((function e(){var t,n,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ue(Le(r.prototype),"transitionIn",this).call(this);case 2:return this.content.enableUIAnimator(),t=mn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){a.node.scene.emit($i.SHOW_UI,{onComplete:function(){e()}})})),e.next=7,Promise.all([t,n]);case 7:this.content.enter();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Te(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(t=this.content)||void 0===t||t.softAbort(),this.content.unlistenUIEvents(),e.next=4,Ue(Le(r.prototype),"transitionOut",this).call(this);case 4:return e.next=6,new Promise((function(e){n.node.scene.emit($i.HIDE_UI,{onComplete:function(){e()}})}));case 6:this.content.disableUIAnimator();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"unmount",value:function(){var e;null===(e=this.content)||void 0===e||e.cleanup(),Ue(Le(r.prototype),"unmount",this).call(this)}}]),r}(US));n._RF.pop(),n._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var $_,eL,tL,nL,aL,iL,rL,oL,sL,lL=a.ccclass,uL=a.property;j_=lL("EventBadge"),Y_=uL(u),X_=uL(m),j_((Z_=Qe((Q_=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"label",Z_,Fe(e)),e}return Pe(n,[{key:"text",get:function(){return this.label.string},set:function(e){this.label.string=e}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(f)).prototype,"label",[Y_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qe(Q_.prototype,"text",[X_],Object.getOwnPropertyDescriptor(Q_.prototype,"text"),Q_.prototype),J_=Q_));n._RF.pop(),n._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var cL,hL,pL,dL,fL,vL,yL,mL,gL,bL,wL,kL,SL,CL,EL,AL,TL,xL,RL,PL,IL,_L,LL,OL,DL,ML,NL,FL,BL,GL,zL,UL,HL,qL,VL,WL,KL,jL,YL,XL,JL,QL,ZL,$L,eO,tO=a.ccclass,nO=a.property;$_=tO("EventProgressBar"),eL=nO(io),tL=nO(u),nL=nO(m),aL=nO({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),$_((oL=Qe((rL=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"progressBar",oL,Fe(e)),Je(e,"progressLabel",sL,Fe(e)),e}return Pe(n,[{key:"text",get:function(){return this.progressLabel.string},set:function(e){this.progressLabel.string=e}},{key:"progress",get:function(){return this.progressBar.progress},set:function(e){this.progressBar.progress=e}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(f)).prototype,"progressBar",[eL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sL=Qe(rL.prototype,"progressLabel",[tL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qe(rL.prototype,"text",[nL],Object.getOwnPropertyDescriptor(rL.prototype,"text"),rL.prototype),Qe(rL.prototype,"progress",[aL],Object.getOwnPropertyDescriptor(rL.prototype,"progress"),rL.prototype),iL=rL));n._RF.pop(),n._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var aO,iO=a.ccclass,rO=a.property,oO=a.executeInEditMode,sO=globalThis.game.analytics;cL=iO("NavButton"),hL=rO(H),pL=rO({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),dL=rO({type:C,group:{name:"Animation"}}),fL=rO({type:C,group:{name:"Animation"}}),vL=rO({type:C,group:{name:"Animation"}}),yL=rO({type:C,group:{name:"Animation"}}),mL=rO({type:C,group:{name:"Animation"}}),gL=rO({group:{name:"Animation"}}),bL=rO({type:C,group:{name:"Animation"}}),wL=rO({type:C,group:{name:"Animation"}}),kL=rO({group:{name:"Animation"}}),SL=rO({type:C,group:{name:"Animation"}}),CL=rO({type:C,group:{name:"Animation"}}),EL=rO({type:C,group:{name:"Animation"}}),AL=rO({type:C,group:{name:"Animation"}}),TL=rO({type:s}),xL=rO(i),RL=rO(M),PL=rO({type:s}),IL=rO({type:ue(Fs)}),_L=rO(xx),cL(LL=oO((DL=Qe((OL=function(e){_e(r,e);var t,n,a=Ge(r);function r(){var e;xe(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Je(e=a.call.apply(a,[this].concat(n)),"wip",DL,Fe(e)),Je(e,"isSelectedInEditor",ML,Fe(e)),Je(e,"animationDuration",NL,Fe(e)),Je(e,"selectedSpacing",FL,Fe(e)),Je(e,"deselectedSpacing",BL,Fe(e)),Je(e,"selectedIconY",GL,Fe(e)),Je(e,"selectedIconX",zL,Fe(e)),Je(e,"selectedIconScale",UL,Fe(e)),Je(e,"deselectedIconY",HL,Fe(e)),Je(e,"deselectedIconX",qL,Fe(e)),Je(e,"deselectedIconScale",VL,Fe(e)),Je(e,"selectedTextY",WL,Fe(e)),Je(e,"selectedTextX",KL,Fe(e)),Je(e,"deselectedTextY",jL,Fe(e)),Je(e,"deselectedTextX",YL,Fe(e)),Je(e,"spacer",XL,Fe(e)),Je(e,"icon",JL,Fe(e)),Je(e,"text",QL,Fe(e)),Je(e,"uiTransform",ZL,Fe(e)),Je(e,"screenType",$L,Fe(e)),Je(e,"navManager",eO,Fe(e)),e.isSelected=!1,e.onMouseEnter=function(t){e.isSelected||e.playHoverOnAnimation()},e.onMouseLeave=function(t){e.isSelected||e.playHoverOffAnimation()},e}return Pe(r,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(i.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(i.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(i.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(i.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var e,t;this.isSelected||(ga.playSound(Zn.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),sO.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:null!==(e=null===(t=this.node.parent)||void 0===t?void 0:t.name)&&void 0!==e?e:this.node.name,screen_name:ma.getCurrentPage()}))}},{key:"select",value:(n=Te(Se().mark((function e(){var t,n=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(n.length>0&&void 0!==n[0])||n[0],!this.isSelected){e.next=3;break}throw new Error("NavButton: Already selected");case 3:if(this.isSelected=!0,!t){e.next=9;break}return e.next=7,mn.runTweenAsync(this.playSelectAnimation());case 7:e.next=14;break;case 9:this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255;case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"deselect",value:(t=Te(Se().mark((function e(){var t,n,a=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(a.length>0&&void 0!==a[0])||a[0],n=a.length>1&&void 0!==a[1]&&a[1],this.isSelected||n){e.next=4;break}throw new Error("NavButton: Already deselected");case 4:if(this.isSelected=!1,!t){e.next=10;break}return e.next=8,mn.runTweenAsync(this.deselectAnimation());case 8:e.next=15;break;case 10:this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0;case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var e=new j(this.selectedIconX,this.selectedIconY,0),t=new j(this.deselectedIconX,this.deselectedIconY,0),n=this.node.scale.clone();this.node.scale=this.selectedIconScale;var a=this.uiTransform.convertToWorldSpaceAR(e),i=this.uiTransform.convertToWorldSpaceAR(t);return this.node.scale=n,i.x-a.x}},{key:"playHoverOnAnimation",value:function(){var e=S(this.icon);return e.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),mn.runTweenAsync(e)}},{key:"playHoverOffAnimation",value:function(){var e=S(this.icon);return e.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),mn.runTweenAsync(e)}},{key:"playSelectAnimation",value:function(){var e=this;return S(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var a=D.quintInOut(n),i=D.backOut(n),r=D.linear(n),o=n<.5?2*n:1,s=e.deselectedIconY+(e.selectedIconY-e.deselectedIconY)*i,l=e.deselectedIconX+(e.selectedIconX-e.deselectedIconX)*r;e.icon.setPosition(l,s,0);var u=e.deselectedIconScale.clone().lerp(e.selectedIconScale,a);e.icon.setScale(u.x,u.y,e.icon.scale.z);var c=255*o,h=e.deselectedTextY+(e.selectedTextY-e.deselectedTextY)*r,p=e.deselectedTextX+(e.selectedTextX-e.deselectedTextX)*r;e.text.opacity=c,e.text.node.setPosition(p,h,0)}}})}},{key:"deselectAnimation",value:function(){var e=this;return S(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var a=ce(e.selectedIconY,e.deselectedIconY,n),i=ce(e.selectedIconX,e.deselectedIconX,n);e.icon.setPosition(i,a,0);var r=ce(255,0,n<.5?2*n:1);e.text.opacity=r;var o=ce(e.selectedTextY,e.deselectedTextY,n),s=ce(e.selectedTextX,e.deselectedTextX,n);e.text.node.setPosition(s,o,0);var l=e.selectedIconScale.clone().lerp(e.deselectedIconScale,D.quintInOut(n));e.icon.setScale(l.x,l.y,e.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}}]),r}(f)).prototype,"wip",[hL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ML=Qe(OL.prototype,"isSelectedInEditor",[pL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),NL=Qe(OL.prototype,"animationDuration",[dL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),FL=Qe(OL.prototype,"selectedSpacing",[fL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),BL=Qe(OL.prototype,"deselectedSpacing",[vL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),GL=Qe(OL.prototype,"selectedIconY",[yL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),zL=Qe(OL.prototype,"selectedIconX",[mL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),UL=Qe(OL.prototype,"selectedIconScale",[gL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(1,1,1)}}),HL=Qe(OL.prototype,"deselectedIconY",[bL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qL=Qe(OL.prototype,"deselectedIconX",[wL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),VL=Qe(OL.prototype,"deselectedIconScale",[kL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(.8,.8,1)}}),WL=Qe(OL.prototype,"selectedTextY",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-10}}),KL=Qe(OL.prototype,"selectedTextX",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jL=Qe(OL.prototype,"deselectedTextY",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YL=Qe(OL.prototype,"deselectedTextX",[AL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XL=Qe(OL.prototype,"spacer",[TL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JL=Qe(OL.prototype,"icon",[xL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QL=Qe(OL.prototype,"text",[RL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZL=Qe(OL.prototype,"uiTransform",[PL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$L=Qe(OL.prototype,"screenType",[IL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eO=Qe(OL.prototype,"navManager",[_L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LL=OL))||LL);n._RF.pop(),n._RF.push({},"22d76GFn6BEoKFiZCFN1HmA","DraftScene",void 0);var lO,uO=a.ccclass,cO=a.disallowMultiple;uO("DraftScene")(aO=cO(aO=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"switchScene",value:function(){Vl.switchToGameScene()}}]),n}(f))||aO);n._RF.pop(),n._RF.push({},"27217ZS55VNqbq0d9w9Cc+3","Component",void 0);var hO,pO,dO,fO,vO,yO,mO,gO=a.ccclass,bO=a.executeInEditMode,wO=a.disallowMultiple,kO=GameCore.Events,SO=globalThis.game.event;gO("DraftComponent")(lO=wO(lO=bO(!0)(lO=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).locale="en",e.eventPayload={screenName:"DraftScene"},e}return Pe(n,[{key:"__preload",value:function(){console.log("DraftComponent",kO)}},{key:"onLoad",value:function(){console.log("DraftComponent",SO)}},{key:"start",value:function(){console.log("DraftComponent",false),this.makePersistent()}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}}]),n}(f))||lO)||lO);n._RF.pop(),n._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var CO,EO,AO,TO,xO,RO,PO,IO,_O,LO,OO,DO,MO,NO,FO,BO=a.ccclass,GO=a.property,zO=a.disallowMultiple,UO=globalThis.game,HO=UO.audio,qO=UO.player,VO=Dn;hO=BO("GameScene"),pO=GO(Ok),dO=GO(Bb),hO(fO=zO((yO=Qe((vO=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"animSkipOverlay",yO,Fe(e)),Je(e,"coinManager",mO,Fe(e)),e.handleGameExit=function(){e.scheduleOnce((function(){hv.hideBannerAds(),Vl.switchScene(Zs,{isMatchStartFromLoader:!0})}),.5)},e.handleShowResults=function(){e.scheduleOnce((function(){Vl.switchScene($s)}),.5)},e.handleGameMaskWhenLayoutChanged=function(e){var t=R("Canvas/Game/GameObjects");if(t){var n=t.getComponent(he);n&&(n.enabled=e===VO.Landscape)}},e.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch((function(e){console.warn("subscribeBotAsync",e)}))},e}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents(),hv.showBannerAds()}},{key:"onLoad",value:function(){this.coinManager.init(this.animSkipOverlay)}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){x.on(An,this.handleGameMaskWhenLayoutChanged),this.node.scene.on($i.GAME_EXIT,this.handleGameExit),this.node.scene.on($i.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}},{key:"start",value:function(){this.scheduleOnce(this.attemptCallSubscribeBot,.5),qO.getPlayerSetting("music")&&ga.playMusic(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function(){Vl.preloadDashboardScene()}},{key:"updateVolumeBackgroundMusic",value:function(){HO.setVolume(1,"global_music")}}]),n}(f)).prototype,"animSkipOverlay",[pO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mO=Qe(vO.prototype,"coinManager",[dO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fO=vO))||fO);n._RF.pop(),n._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);var WO,KO,jO,YO,XO,JO,QO,ZO=a.ccclass,$O=a.property;CO=ZO("ItemButton"),EO=$O(H),AO=$O(p),TO=$O({type:g}),xO=$O(u),RO=$O(i),PO=$O(i),CO((LO=Qe((_O=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"isDebug",LO,Fe(e)),Je(e,"button",OO,Fe(e)),Je(e,"quantity",DO,Fe(e)),Je(e,"quantityLabel",MO,Fe(e)),Je(e,"plusNode",NO,Fe(e)),Je(e,"quantityNode",FO,Fe(e)),e}return Pe(n,[{key:"__preload",value:function(){this.item=this.getComponent(Zf),this.validateRequiredComponents()}},{key:"start",value:function(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string="".concat(this.quantity),this.validateButton(),this.node.scene.on($i.GRID_CREATE,this.validateButton,this),this.node.scene.on($i.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on($i.GRID_CLEAR,this.validateButton,this)}},{key:"validateRequiredComponents",value:function(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}},{key:"validateButton",value:function(){var e=this;console.log("VALIDATE BUTTON"),this.canActivate().then((function(t){e.button.interactable=!0,e.plusNode.active=0==e.quantity,e.quantityNode.active=e.quantity>0}))}},{key:"activate",value:function(){var e=this;return new Promise((function(t){if(e.quantity<=0)return e.handleShowAddItemScreen(),void t();e.item.activate().then((function(){e.isDebug||(e.quantity--,e.quantityLabel.string="".concat(e.quantity),e.item.saveQuantity()),e.validateButton(),t()}))}))}},{key:"canActivate",value:function(){return Promise.resolve(!0)}},{key:"addQuantity",value:function(e){this.quantity+=e,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"clearQuantity",value:function(){this.quantity=0,this.quantityLabel.string="".concat(this.quantity),this.item.saveQuantity(),this.validateButton()}},{key:"handleShowAddItemScreen",value:function(){iu.openScreen(ia,{item:Cs.HINT,quantity:1})}}]),n}(f)).prototype,"isDebug",[EO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),OO=Qe(_O.prototype,"button",[AO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DO=Qe(_O.prototype,"quantity",[TO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),MO=Qe(_O.prototype,"quantityLabel",[xO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NO=Qe(_O.prototype,"plusNode",[RO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FO=Qe(_O.prototype,"quantityNode",[PO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IO=_O));n._RF.pop(),n._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var eD,tD,nD,aD,iD,rD,oD,sD=a.ccclass,lD=a.property;WO=sD("ComboEffect"),KO=lD(M),jO=lD(ie),WO((JO=Qe((XO=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"circleOpacity",JO,Fe(e)),Je(e,"particle",QO,Fe(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.circleOpacity)throw new Error("ComboEffect requires a circleOpacity component");if(!this.particle)throw new Error("ComboEffect requires a particle component")}},{key:"start",value:function(){this.node.scene.on($i.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){e>1&&(this.circleOpacity.node.scale=j.ZERO,this.circleOpacity.opacity=127.5,this.particle.resetSystem(),S(this.circleOpacity.node).to(.2,{scale:new j(1.3,1.3,1.3)},{easing:"quadOut"}).start(),S(this.circleOpacity).delay(.2).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),n}(f)).prototype,"circleOpacity",[KO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QO=Qe(XO.prototype,"particle",[jO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YO=XO));n._RF.pop(),n._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var uD,cD,hD,pD,dD,fD,vD,yD,mD,gD=a.ccclass,bD=a.property;eD=gD("ComboLabel"),tD=bD(u),nD=bD(i),eD((rD=Qe((iD=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"comboNumber",rD,Fe(e)),Je(e,"comboContainer",oD,Fe(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.opacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on($i.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>1?(this.opacity.opacity=255,this.comboNumber.string="".concat(e),S(this.comboContainer).to(.1,{scale:new j(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:j.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),n}(f)).prototype,"comboNumber",[tD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oD=Qe(iD.prototype,"comboContainer",[nD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aD=iD));n._RF.pop(),n._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var wD,kD=a.ccclass,SD=a.property;uD=kD("ComboPopup"),cD=SD(T),hD=SD(O),pD=SD(y),uD((vD=Qe((fD=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"textSprite",vD,Fe(e)),Je(e,"comboSprites",yD,Fe(e)),Je(e,"animation",mD,Fe(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"start",value:function(){this.node.scene.on($i.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"validateRequiredComponents",value:function(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}},{key:"handleOnComboUpdated",value:function(e){if(!(e<2))for(var t=this.comboSprites.length-1;t>=0;t--)if(e>=t+2){this.textSprite.spriteFrame=this.comboSprites[t],this.animation.play();break}}}]),n}(f)).prototype,"textSprite",[cD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yD=Qe(fD.prototype,"comboSprites",[hD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mD=Qe(fD.prototype,"animation",[pD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dD=fD));n._RF.pop(),n._RF.push({},"254d3fxjCBGlbC4XNKvKhF6","LoadScene",void 0);var CD,ED,AD,TD,xD,RD,PD,ID,_D,LD=a.ccclass,OD=a.disallowMultiple,DD=GameCore,MD=DD.Utils,ND=DD.Configs,FD=MD.Time,BD=globalThis.game,GD=BD.ads,zD=BD.player;LD("LoadScene")(wD=OD(wD=function(e){_e(i,e);var t,n,a=Ge(i);function i(){return xe(this,i),a.apply(this,arguments)}return Pe(i,[{key:"__preload",value:function(){this.processCrazyGamesLoadingStart(),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.processCrazyGamesLoadingStop()}},{key:"start",value:function(){this.loadCurrentPlayerTheme().catch((function(e){return console.error("loadCurrentPlayerTheme",e)})),this.handleShowAdWhenLoadGame().catch((function(e){console.error("handleShowAdWhenLoadGame",e)}))}},{key:"loadCurrentPlayerTheme",value:function(){var e=fl.mapOrder,t=e[0],n=zD.getGameData(),a=null==n?void 0:n.level;if(!GameCore.Utils.Valid.isNumber(a))return jn.loadThemeAsync(t.theme);var i,r=Ye(e);try{for(r.s();!(i=r.n()).done;){var o=i.value;if((a-=o.levelCount)<=0){t=o;break}}}catch(e){r.e(e)}finally{r.f()}return jn.loadThemeAsync(t.theme)}},{key:"handleShowAdWhenLoadGame",value:(n=Te(Se().mark((function e(){var t,n,a,i,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=ND.Ads,n=t.Enabled,a=t.ShowAdOnLoad,n){e.next=3;break}return e.abrupt("return");case 3:if(i=a.Enabled,r=a.DelaySeconds,o=a.PlacementId,i){e.next=6;break}return e.abrupt("return");case 6:if(e.prev=6,!(r>0)){e.next=10;break}return e.next=10,FD.sleepAsync(1e3*r);case 10:if(s=GD.getAdByPlacementId(o)){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,this.showAdWhenLoadGame(s);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),console.warn("handleShowAdWhenLoadGame failed",e.t0);case 20:return e.prev=20,hv.preloadAds(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[6,17,20,23]])}))),function(){return n.apply(this,arguments)})},{key:"showAdWhenLoadGame",value:(t=Te(Se().mark((function e(t){var n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.type,a=t.placementId,e.next=4,GD.loadAdAsync(n,a);case 4:return ga.muteAudio(!0),e.next=7,GD.showAdAsync(n,a);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("showAdWhenLoadGame failed",e.t0);case 12:return e.prev=12,ga.muteAudio(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])}))),function(e){return t.apply(this,arguments)})},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}}]),i}(f))||wD);n._RF.pop(),n._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var UD,HD,qD,VD,WD,KD,jD,YD,XD,JD,QD,ZD,$D,eM,tM,nM=a.ccclass,aM=a.property,iM=(CD=nM("PlayerScore"),ED=aM(i),AD=aM(u),TD=aM(T),CD((PD=Qe((RD=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"crown",PD,Fe(e)),Je(e,"playerScore",ID,Fe(e)),Je(e,"avatar",_D,Fe(e)),e}return Pe(a,[{key:"showCrown",value:function(e){this.crown.active=e}},{key:"setPlayerScore",value:function(e){this.playerScore.string=e.toString()}},{key:"playWaitingAnimation",value:function(){var e=this,t=0;this.playerScore.schedule((function(){t=(t+1)%4;var n=Array(t+1).join(".");e.playerScore.string="Waiting"+n}),.5);var n=this.playerScore.getComponent(M),a=S(n).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=S(n).repeatForever(a).start()}},{key:"stopWaitingAnimation",value:function(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(M).opacity=255}},{key:"loadPhoto",value:(t=Te(Se().mark((function e(t){var n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameCore.Utils.Image.loadImage(t);case 3:if(n=e.sent){e.next=6;break}throw new Error("Failed to load image");case 6:if(a=O.createWithImage(n)){e.next=9;break}throw new Error("Failed to create sprite frame");case 9:a.packable=!0,this.avatar.spriteFrame=a,e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return");case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e){return t.apply(this,arguments)})}]),a}(f)).prototype,"crown",[ED],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ID=Qe(RD.prototype,"playerScore",[AD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_D=Qe(RD.prototype,"avatar",[TD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xD=RD))||xD);n._RF.pop(),n._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var rM,oM=a.ccclass,sM=a.disallowMultiple,lM=a.property,uM=globalThis.game,cM=uM.match,hM=uM.player,pM=uM.monitorError,dM="Waiting";UD=oM("ChallengeResultScene"),HD=lM(g),qD=lM({type:iM,group:"Score"}),VD=lM({type:iM,group:"Score"}),WD=lM(Uw),KD=lM(u),jD=lM(rv),UD(YD=sM((JD=Qe((XD=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"pollingInterval",JD,Fe(e)),Je(e,"playerScore",QD,Fe(e)),Je(e,"opponentScore",ZD,Fe(e)),Je(e,"paperConfetti",$D,Fe(e)),Je(e,"titleText",eM,Fe(e)),Je(e,"levelManager",tM,Fe(e)),e.pollMatchState=Te(Se().mark((function t(){var n,a,i,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=cM.getMatchState(),null!==(a=n.id)){t.next=4;break}throw new Error("Match id is not found");case 4:return i=hM.getPlayerId(),r=Date.now(),t.next=8,cM.api.getMatchAPI().getMatchDetailByIdAsync(a);case 8:if(o=t.sent,s=Date.now(),l=Math.max(0,s-r,e.pollingInterval),u=new GameCore.Dtos.Match.Data(o).toObject(),c=u.blackPlayerId,h=u.blackPlayerScore,p=u.whitePlayerScore,d=u.blackPlayerFinish,f=u.whitePlayerFinish,v=i===c?h:p,y=i===c?p:h,m=i===c?d:f,g=i===c?f:d,b=d&&f,e.playerScore.setPlayerScore(v),e.opponentScore.setPlayerScore(y),e.playerScore.showCrown(b&&v>y),e.opponentScore.showCrown(b&&y>v),e.stopWaitingAnimation(),e.playerScore.stopWaitingAnimation(),e.opponentScore.stopWaitingAnimation(),b){t.next=32;break}e.titleText.string=dM,e.playWaitingAnimation(),m||e.playerScore.playWaitingAnimation(),g||e.opponentScore.playWaitingAnimation(),t.next=45;break;case 32:if(v!==y){t.next=36;break}e.titleText.string="Draw",t.next=45;break;case 36:if(!(v>y)){t.next=40;break}e.titleText.string="You Win",t.next=45;break;case 40:if(!(v<y)){t.next=44;break}e.titleText.string="You Lose",t.next=45;break;case 44:return t.abrupt("return");case 45:e.scheduleOnce(e.pollMatchState,l),t.next=52;break;case 48:t.prev=48,t.t0=t.catch(0),console.warn("ResultScene: Error on pollMatchState",t.t0),e.scheduleOnce(e.pollMatchState,e.pollingInterval);case 52:case"end":return t.stop()}}),t,null,[[0,48]])}))),e}return Pe(a,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents(),hv.showBannerAds()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"onLoad",value:function(){try{var e=cM.getMatchState(),t=e.customData,n=t.playerId,a=t.opponentId;if(null===n||null===a)throw new Error("ResultScene: playerId is ".concat(n," and opponentId is ").concat(a,". Expected to not be null."));var i=hM.getPlayer().photo,r=e.profiles[n],o=r.score,s=void 0===o?0:o,l=r.finished,u=void 0!==l&&l,c=e.profiles[a],h=c.photo,p=c.score,d=void 0===p?0:p,f=c.finished,v=void 0!==f&&f,y=u&&v,m=y&&s>d,g=y&&d>s;this.playerScore.loadPhoto(i),this.opponentScore.loadPhoto(h),this.playerScore.setPlayerScore(s),this.opponentScore.setPlayerScore(d),this.playerScore.showCrown(m),this.opponentScore.showCrown(g),u&&v?s===d?this.titleText.string="Draw":m?this.titleText.string="You Win":g&&(this.titleText.string="You Lose"):(this.titleText.string=dM,this.playWaitingAnimation(),u||this.playerScore.playWaitingAnimation(),v||this.opponentScore.playWaitingAnimation())}catch(e){console.warn("ResultScene: Error on load",e),this.transitionToDashboardScene()}}},{key:"listenEvents",value:function(){this.node.scene.on(In,this.onHomeButtonPressed,this),this.node.scene.on(Pn,this.onReplayButtonPressed,this)}},{key:"start",value:function(){var e=this;this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce((function(){e.paperConfetti.runEffect()}),.2)}},{key:"onDestroy",value:function(){this.unschedule(this.pollMatchState)}},{key:"onReplayButtonPressed",value:(t=Te(Se().mark((function e(){var t,n,a,i,r,o,s,l,u,c,h,p,d,f;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null!==(t=hM.getGameData())&&void 0!==t?t:{},a=n.level,i=void 0===a?1:a,i=Math.max(1,i),e.next=4,this.levelManager.loadLevelData(i);case 4:if(r=e.sent,e.prev=5,r){e.next=8;break}throw new Error("Level data is not found");case 8:if(o=cM.getMatchState().customData.opponentId){e.next=11;break}throw new Error("Opponent id is not found");case 11:return iu.showLoadingScreen(),s=eh.generateFen(r),l=r.mode,u=void 0===l?"":l,c=r.rules,h=void 0===c?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:c,p=r.time,d=void 0===p?0:p,f=r.level,e.next=16,cM.challenge.friend.processAsync({playerId:hM.getPlayerId(),opponentId:o,extraData:{level:f,fen:s,gravity:u,rules:h,time:d}});case 16:iu.closeLoadingScreen(),this.transitionToGameScene(),e.next=28;break;case 20:e.prev=20,e.t0=e.catch(5),console.warn("ReplayChallengeFriend",e.t0),iu.closeLoadingScreen(),iu.showNotificationScreen("Sorry, you cannot replay\nat this time.",2),null==pM||pM.sendException(e.t0 instanceof Error?e.t0:new Error("ReplayChallengeFriend"+JSON.stringify(e.t0))),this.scheduleOnce((function(){hv.hideBannerAds(),Vl.switchScene(Zs,{isMatchStartFromLoader:!0})}),2);case 28:case"end":return e.stop()}}),e,this,[[5,20]])}))),function(){return t.apply(this,arguments)})},{key:"onHomeButtonPressed",value:function(){this.transitionToDashboardScene()}},{key:"transitionToDashboardScene",value:function(){this.scheduleOnce((function(){hv.hideBannerAds(),Vl.switchScene(Zs,{isMatchStartFromLoader:!0})}),.5)}},{key:"transitionToGameScene",value:function(){this.scheduleOnce((function(){Vl.switchScene(Qs)}),.5)}},{key:"playWaitingAnimation",value:function(){var e=this,t=0;this.titleText.schedule((function(){t=(t+1)%4;var n=Array(t+1).join(".");e.titleText.string=dM+n}),.5);var n=this.titleText.getComponent(M),a=S(n).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=S(n).repeatForever(a).start()}},{key:"stopWaitingAnimation",value:function(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(M).opacity=255}}]),a}(f)).prototype,"pollingInterval",[HD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),QD=Qe(XD.prototype,"playerScore",[qD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZD=Qe(XD.prototype,"opponentScore",[VD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$D=Qe(XD.prototype,"paperConfetti",[WD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eM=Qe(XD.prototype,"titleText",[KD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tM=Qe(XD.prototype,"levelManager",[jD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YD=XD))||YD);n._RF.pop(),n._RF.push({},"2b2ebUm0nFD64V/fcD8RPF/","TestLayoutScene",void 0);var fM,vM=a.ccclass,yM=a.disallowMultiple;vM("TestLayoutScene")(rM=yM(rM=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).handleLayoutChange=function(){iu.closeNotificationScreen(),iu.showNotificationScreen("Layout changed")},e}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents()}},{key:"onLoad",value:function(){GameSDK.startGameAsync()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){x.on(An,this.handleLayoutChange)}},{key:"switchScene",value:function(){Vl.switchScene(el)}}]),n}(f))||rM);n._RF.pop(),n._RF.push({},"7dc71c6qMBI/ZZfA4rG4nFv","TestPerformanceScene",void 0);var mM,gM=a.ccclass,bM=a.disallowMultiple;gM("TestPerformanceScene")(fM=bM(fM=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"onLoad",value:function(){GameSDK.startGameAsync()}},{key:"listenEvents",value:function(){}},{key:"start",value:function(){}}]),n}(f))||fM);n._RF.pop(),n._RF.push({},"0a4aeK2lAdAjq0xWi6SCbV+","TestScene",void 0);var wM,kM=a.ccclass,SM=a.disallowMultiple,CM=GameCore.Events,EM=globalThis.game.event;kM("TestScene")(mM=SM(mM=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.listenScreenEvents(),GameSDK.startGameAsync().catch((function(e){console.warn("GameSDK.startGameAsync",e)}))}},{key:"listenScreenEvents",value:function(){EM.once(CM.CLOSED_SCREEN,(function(e){e.screenName}))}},{key:"start",value:function(){console.log("TestScene.start")}}]),n}(f))||mM);n._RF.pop(),n._RF.push({},"56a103phldKO7/xShKcD3bI","AnimationDemo",void 0);var AM;(0,a.ccclass)("AnimationDemo")(wM=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"onLoad",value:function(){}},{key:"switchToTestTransitionScene",value:function(){Vl.switchScene("TestTransitionScene")}}]),n}(f));n._RF.pop(),n._RF.push({},"a3b8adQtftPmKSSoumHWY1e","AudioDemo",void 0);var TM;(0,a.ccclass)("AudioDemo")(AM=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).isMusicMute=!1,e.isSoundMute=!1,e.listSounds=[],e}return Pe(n,[{key:"onLoad",value:function(){var e,t;this.musicComp=null===(e=R("Music"))||void 0===e?void 0:e.getComponent(qt),this.soundComp=null===(t=R("Sound"))||void 0===t?void 0:t.getComponent(Xt),this.validateRequiredComponents(),this.listSounds=[Zn.BG_MUSIC,Zn.BUTTON_CLICK,Zn.LEVEL_FAIL]}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"playBackgroundMusic",value:function(){this.musicComp.play(Zn.BG_MUSIC)}},{key:"pauseBackgroundMusic",value:function(){this.musicComp.pause(Zn.BG_MUSIC)}},{key:"stopBackgroundMusic",value:function(){this.musicComp.stop(Zn.BG_MUSIC)}},{key:"randomMusicChannelVolume",value:function(){var e=Math.random();this.musicComp.setVolume(e)}},{key:"toggleMuteMusicChannel",value:function(){this.isMusicMute?(this.musicComp.mute(!1),this.isMusicMute=!1):(this.musicComp.mute(!0),this.isMusicMute=!0)}},{key:"playRandomSound",value:function(){this.soundComp.play(this.listSounds[Math.floor(Math.random()*this.listSounds.length)])}},{key:"toggleMuteSoundChannel",value:function(){this.isSoundMute?(this.soundComp.mute(!1),this.isSoundMute=!1):(this.soundComp.mute(!0),this.isSoundMute=!0)}},{key:"randomSoundChannelVolume",value:function(){var e=Math.random();this.soundComp.setVolume(e)}}]),n}(f));n._RF.pop(),n._RF.push({},"6cd06Fd0pBFjbLSPqmcXcU+","CoinDemo",void 0);var xM;(0,a.ccclass)("CoinDemo")(TM=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"onLoad",value:function(){this.node.on($i.REMOVE_COINS_FAILED,this.onRemoveCoinsFailed,this)}},{key:"add500Coins",value:function(){console.log("Add 500 coins"),this.node.scene.emit($i.ADD_COINS,500)}},{key:"remove500Coins",value:function(){console.log("Remove 500 coins"),this.node.scene.emit($i.REMOVE_COINS,500)}},{key:"onRemoveCoinsFailed",value:function(){iu.openScreen(la,{duration:1.5,message:"Removing coins failed."})}}]),n}(f));n._RF.pop(),n._RF.push({},"9e6b330nHBK2oNz8N9/lpDx","FlowChallenge",void 0);var RM,PM=a.ccclass,IM=globalThis.game,_M=IM.match,LM=IM.player,OM=IM.event;PM("FlowChallenge")(xM=function(e){_e(s,e);var t,n,a,i,r,o=Ge(s);function s(){var e;xe(this,s);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=o.call.apply(o,[this].concat(n))).playerId="",e}return Pe(s,[{key:"onLoad",value:function(){this.playerId=LM.getPlayerId()}},{key:"showLoadingScreen",value:function(e){OM.emit(GameCore.Events.OPEN_SCREEN,{screenName:aa,screenData:{duration:e}})}},{key:"closeLoadingScreen",value:function(){OM.emit(GameCore.Events.CLOSE_SCREEN,{screenName:aa})}},{key:"inviteFriends",value:(r=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showLoadingScreen(0),e.next=4,_M.challenge.invite.processAsync({playerId:this.playerId});case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.warn("inviteFriends",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 10:return e.prev=10,this.closeLoadingScreen(),e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[0,6,10,13]])}))),function(){return r.apply(this,arguments)})},{key:"challengeFriend",value:(i=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(n),e.prev=1,this.showLoadingScreen(0),e.next=5,_M.challenge.friend.processAsync(ke(ke({},a),{},{playerId:this.playerId}));case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.warn("challengeFriend",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 11:return e.prev=11,this.closeLoadingScreen(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[1,7,11,14]])}))),function(e,t){return i.apply(this,arguments)})},{key:"joinChallenge",value:(a=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(n),e.prev=1,this.showLoadingScreen(0),e.next=5,_M.challenge.join.processAsync(ke(ke({},a),{},{playerId:this.playerId}));case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.warn("joinChallenge",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 11:return e.prev=11,this.closeLoadingScreen(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[1,7,11,14]])}))),function(e,t){return a.apply(this,arguments)})},{key:"continueChallenge",value:(n=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(n),e.prev=1,this.showLoadingScreen(0),e.next=5,_M.challenge.continue.processAsync(ke(ke({},a),{},{playerId:this.playerId}));case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.warn("continueChallenge",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 11:return e.prev=11,this.closeLoadingScreen(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[1,7,11,14]])}))),function(e,t){return n.apply(this,arguments)})},{key:"finishChallenge",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showLoadingScreen(0),e.next=4,_M.challenge.finish.processAsync({playerId:LM.getPlayerId(),playerScore:Math.floor(2*Math.random())});case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.warn("finishChallenge",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 10:return e.prev=10,this.closeLoadingScreen(),e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[0,6,10,13]])}))),function(){return t.apply(this,arguments)})}]),s}(f));n._RF.pop(),n._RF.push({},"f3decJ3ZlRLt6CDMHpl1XCe","FlowContext",void 0);var DM,MM=a.ccclass,NM=globalThis.game,FM=NM.match,BM=NM.player,GM=NM.context,zM=NM.event;MM("FlowContext")(RM=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=a.call.apply(a,[this].concat(n))).playerId="",e.changeContext=function(){var e=Te(Se().mark((function e(t,n,a){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return GM.receiveContext(t,n,a),e.next=3,GM.detectContextSessionType();case 3:game.context.detectContextGameMode();case 4:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),e}return Pe(i,[{key:"onLoad",value:function(){this.playerId=BM.getPlayerId()}},{key:"showLoadingScreen",value:function(e){zM.emit(GameCore.Events.OPEN_SCREEN,{screenName:aa,screenData:{duration:e}})}},{key:"closeLoadingScreen",value:function(){zM.emit(GameCore.Events.CLOSE_SCREEN,{screenName:aa})}},{key:"chooseFriends",value:(n=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(n),e.prev=1,this.showLoadingScreen(0),e.next=5,FM.context.choose.processAsync(ke(ke({},a),{},{playerId:this.playerId}));case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.warn("chooseFriends",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 11:return e.prev=11,this.closeLoadingScreen(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[1,7,11,14]])}))),function(e,t){return n.apply(this,arguments)})},{key:"processContextData",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showLoadingScreen(0),e.next=4,GM.processContextData();case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.warn("processContext",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 10:return e.prev=10,this.closeLoadingScreen(),e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[0,6,10,13]])}))),function(){return t.apply(this,arguments)})},{key:"setSingleContext",value:function(){this.changeContext("","SOLO",{})}},{key:"setTournamentContext",value:function(){this.changeUrl("/?context_source_id=123&context_type=GENERIC&tournament=true"),this.changeContext("mocked-context-id-tournament","THREAD",{})}},{key:"setShareInviteContext",value:function(){var e={type:GM.getSessionContextTypes().SHARE_INVITE,playerId:"4766619483409000",playerName:"Player",playerPhoto:""};this.changeContext("mocked-context-id-share-invite","THREAD",e)}},{key:"setMatchingGroupContext",value:function(){var e={type:GM.getSessionContextTypes().MATCHING_GROUP,playerId:"4766619483409000",playerName:"Player",playerPhoto:"",playerScore:100};this.changeContext("mocked-context-id-matching-group","GROUP",e)}},{key:"setChallengeFriendContext",value:function(){var e={type:GM.getSessionContextTypes().CHALLENGE_FRIEND,playerId:"4766619483409000",playerName:"Player",playerPhoto:""};this.changeContext("mocked-context-id-challenge-friend","THREAD",e)}},{key:"changeUrl",value:function(e){window.history.pushState({},"",e)}}]),i}(f));n._RF.pop(),n._RF.push({},"36562c8k/RF2p/1aLUWFaf8","FlowGroup",void 0);var UM,HM=a.ccclass,qM=globalThis.game,VM=qM.match,WM=qM.player,KM=qM.event;HM("FlowGroup")(DM=function(e){_e(r,e);var t,n,a,i=Ge(r);function r(){var e;xe(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=i.call.apply(i,[this].concat(n))).playerId="",e}return Pe(r,[{key:"onLoad",value:function(){this.playerId=WM.getPlayerId()}},{key:"showLoadingScreen",value:function(e){KM.emit(GameCore.Events.OPEN_SCREEN,{screenName:aa,screenData:{duration:e}})}},{key:"closeLoadingScreen",value:function(){KM.emit(GameCore.Events.CLOSE_SCREEN,{screenName:aa})}},{key:"startGroup",value:(a=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(n),e.prev=1,this.showLoadingScreen(0),e.next=5,VM.group.start.processAsync(ke(ke({},a),{},{playerId:this.playerId}));case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.warn("startGroup",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 11:return e.prev=11,this.closeLoadingScreen(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[1,7,11,14]])}))),function(e,t){return a.apply(this,arguments)})},{key:"joinGroup",value:(n=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(n),e.prev=1,this.showLoadingScreen(0),e.next=5,VM.group.join.processAsync(ke(ke({},a),{},{playerId:this.playerId}));case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.warn("joinGroup",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 11:return e.prev=11,this.closeLoadingScreen(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[1,7,11,14]])}))),function(e,t){return n.apply(this,arguments)})},{key:"finishGroup",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showLoadingScreen(0),WM.setPlayerDataByName("score",Math.floor(2*Math.random())),e.next=5,VM.group.finish.processAsync();case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.warn("finishGroup",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 11:return e.prev=11,this.closeLoadingScreen(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[0,7,11,14]])}))),function(){return t.apply(this,arguments)})}]),r}(f));n._RF.pop(),n._RF.push({},"46e6dOzDGJMa48+tVKTAEIT","FlowSingle",void 0);var jM,YM=a.ccclass,XM=globalThis.game,JM=XM.match,QM=XM.player,ZM=XM.event;YM("FlowSingle")(UM=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=a.call.apply(a,[this].concat(n))).playerId="",e}return Pe(i,[{key:"onLoad",value:function(){this.playerId=QM.getPlayerId()}},{key:"showLoadingScreen",value:function(e){ZM.emit(GameCore.Events.OPEN_SCREEN,{screenName:aa,screenData:{duration:e}})}},{key:"closeLoadingScreen",value:function(){ZM.emit(GameCore.Events.CLOSE_SCREEN,{screenName:aa})}},{key:"startSingle",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showLoadingScreen(0),e.next=4,JM.single.start.processAsync({playerId:this.playerId});case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.warn("startSingle",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 10:return e.prev=10,this.closeLoadingScreen(),e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[0,6,10,13]])}))),function(){return n.apply(this,arguments)})},{key:"finishSingle",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,QM.setPlayerDataByName("score",Math.floor(2*Math.random())),e.next=4,JM.single.finish.processAsync();case 4:e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),console.warn("finishSingle",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 10:return e.prev=10,this.closeLoadingScreen(),e.finish(10);case 13:case"end":return e.stop()}}),e,this,[[0,6,10,13]])}))),function(){return t.apply(this,arguments)})}]),i}(f));n._RF.pop(),n._RF.push({},"943b1Zkv9BAaZVhinus8Bkv","FlowTournament",void 0);var $M,eN,tN,nN,aN,iN,rN,oN=a.ccclass,sN=globalThis.game,lN=sN.match,uN=sN.player;oN("FlowTournament")(jM=function(e){_e(c,e);var t,n,a,i,r,o,s,l,u=Ge(c);function c(){var e;xe(this,c);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=u.call.apply(u,[this].concat(n))).playerId="",e}return Pe(c,[{key:"onLoad",value:function(){this.playerId=uN.getPlayerId()}},{key:"showLoadingScreen",value:function(e){iu.openScreen(aa,{duration:e})}},{key:"closeLoadingScreen",value:function(){iu.closeScreen(aa)}},{key:"joinTournament",value:(l=Te(Se().mark((function e(t,n){var a,i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(n),console.info("joinTournament",a),e.prev=2,this.showLoadingScreen(0),e.next=6,GameSDK.getTournamentAsync();case 6:return i=e.sent,r=i.getID().toString(),e.next=10,lN.tournament.join.processAsync({tournamentId:r,playerId:this.playerId});case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.warn("joinTournament",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 16:return e.prev=16,this.closeLoadingScreen(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[2,12,16,19]])}))),function(e,t){return l.apply(this,arguments)})},{key:"continueTournament",value:(s=Te(Se().mark((function e(t,n){var a,i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(n),console.info("continueTournament",a),e.prev=2,this.showLoadingScreen(0),e.next=6,GameSDK.getTournamentAsync();case 6:return i=e.sent,r=i.getContextID(),e.next=10,lN.tournament.continue.processAsync({contextId:r,playerId:this.playerId});case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.warn("continueTournament",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 16:return e.prev=16,this.closeLoadingScreen(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[2,12,16,19]])}))),function(e,t){return s.apply(this,arguments)})},{key:"finishTournament",value:(o=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showLoadingScreen(0),uN.setPlayerDataByName("score",Math.floor(2*Math.random())),e.next=5,lN.single.finish.processAsync();case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.warn("finishTournament",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 11:return e.prev=11,this.closeLoadingScreen(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[0,7,11,14]])}))),function(){return o.apply(this,arguments)})},{key:"createTournament",value:(r=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showLoadingScreen(0),t=GameCore.Utils.String.generateObjectId(),e.next=5,GameSDK.tournament.createAsync({initialScore:0,config:{title:"Tournament title",tournamentTitle:"Tournament title"},data:{playerId:this.playerId,playerName:"playerName",leaderboardId:t}});case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.warn("createTournament",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 11:return e.prev=11,this.closeLoadingScreen(),e.finish(11);case 14:case"end":return e.stop()}}),e,this,[[0,7,11,14]])}))),function(){return r.apply(this,arguments)})},{key:"postScoreTournament",value:(i=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=Number(t.string),console.warn("score",n),this.showLoadingScreen(0),e.next=6,GameSDK.tournament.postScoreAsync(n);case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.warn("postScoreTournament",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 12:return e.prev=12,this.closeLoadingScreen(),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,8,12,15]])}))),function(e){return i.apply(this,arguments)})},{key:"shareTournament",value:(a=Te(Se().mark((function e(t,n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(n),e.prev=1,this.showLoadingScreen(0),console.warn("payload",a),e.next=6,GameSDK.tournament.shareAsync(a);case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.warn("shareTournament",a),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 12:return e.prev=12,this.closeLoadingScreen(),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[1,8,12,15]])}))),function(e,t){return a.apply(this,arguments)})},{key:"getTournamentsAsync",value:(n=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{this.showLoadingScreen(0),t=GameSDK.tournament.getTournamentsAsync(),console.warn(t)}catch(e){console.warn("getTournamentsAsync",e),e instanceof Error&&iu.showNotificationScreen(e.message)}finally{this.closeLoadingScreen()}case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getTournamentAsync",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showLoadingScreen(0),e.next=4,GameSDK.getTournamentAsync();case 4:t=e.sent,console.warn(t),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.warn("getTournamentAsync",e.t0),e.t0 instanceof Error&&iu.showNotificationScreen(e.t0.message);case 12:return e.prev=12,this.closeLoadingScreen(),e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,8,12,15]])}))),function(){return t.apply(this,arguments)})}]),c}(f));n._RF.pop(),n._RF.push({},"d78a7DHN+5P/YjKftUFEZcU","JavaAds",void 0);var cN,hN=a.ccclass,pN=a.property,dN=globalThis.game.ads,fN=GameCore.Plugins.Ads.Types;$M=hN("JavaAds"),eN=pN(u),tN=pN(u),$M((iN=Qe((aN=function(e){_e(s,e);var t,n,a,i,o=Ge(s);function s(){var e;xe(this,s);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=o.call.apply(o,[this].concat(n)),"interLabel",iN,Fe(e)),Je(e,"rewardedLabel",rN,Fe(e)),e}return Pe(s,[{key:"__preload",value:function(){this.setupAds()}},{key:"setupAds",value:function(){}},{key:"onLoad",value:function(){}},{key:"start",value:function(){}},{key:"showBannerAds",value:function(){dN.showBannerAdAsync().catch((function(e){console.log("%c error: ","font-size:12px;background-color: #FFDD4D;color:#fff;",e)}))}},{key:"hideBannerAds",value:function(){dN.hideBannerAdAsync().catch((function(e){console.log("%c error: ","font-size:12px;background-color: #6EC1C2;color:#fff;",e)}))}},{key:"loadRewardedAds",value:(i=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showNotificationScreen("loading"),e.next=4,dN.loadAdAsync(fN.REWARDED_VIDEO);case 4:this.closeNotificationScreen(),this.rewardedLabel.color=new r(0,255,0),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("%c error: ","font-size:12px;background-color: #A8978E;color:#fff;",e.t0),this.showNotificationScreen("Load ads fail.",2);case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return i.apply(this,arguments)})},{key:"showRewardAds",value:(a=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showNotificationScreen("loading"),e.next=4,dN.showAdAsync(fN.REWARDED_VIDEO);case 4:this.closeNotificationScreen(),e.next=14;break;case 7:if(e.prev=7,e.t0=e.catch(0),console.warn("showTips failed",e.t0),!(e.t0 instanceof Object&&"code"in e.t0&&"USER_INPUT"===e.t0.code)){e.next=13;break}return this.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2),e.abrupt("return");case 13:this.showNotificationScreen("No ads to display.",2);case 14:return e.prev=14,this.rewardedLabel.color=new r(0,0,0),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[0,7,14,17]])}))),function(){return a.apply(this,arguments)})},{key:"loadInterAds",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showNotificationScreen("loading"),e.next=4,dN.loadAdAsync(fN.INTERSTITIAL);case 4:this.closeNotificationScreen(),this.interLabel.color=new r(0,255,0),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log("%c error: ","font-size:12px;background-color: #BAAC9A;color:#fff;",e.t0),this.showNotificationScreen("Load ads fail.",2);case 12:case"end":return e.stop()}}),e,this,[[0,8]])}))),function(){return n.apply(this,arguments)})},{key:"showInterAds",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.showNotificationScreen("loading"),e.next=4,dN.showAdAsync(fN.INTERSTITIAL);case 4:this.closeNotificationScreen(),e.next=14;break;case 7:if(e.prev=7,e.t0=e.catch(0),console.warn("showTips failed",e.t0),!(e.t0 instanceof Object&&"code"in e.t0&&"USER_INPUT"===e.t0.code)){e.next=13;break}return this.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2),e.abrupt("return");case 13:this.showNotificationScreen("No ads to display.",2);case 14:return e.prev=14,this.interLabel.color=new r(0,0,0),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[0,7,14,17]])}))),function(){return t.apply(this,arguments)})},{key:"showNotificationScreen",value:function(e,t){iu.showNotificationScreen(e,t)}},{key:"closeNotificationScreen",value:function(){iu.closeNotificationScreen()}}]),s}(f)).prototype,"interLabel",[eN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rN=Qe(aN.prototype,"rewardedLabel",[tN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nN=aN));n._RF.pop(),n._RF.push({},"64311EGU4RKDpfjDUran9nc","RewardedAdsTest",void 0);var vN,yN=a.ccclass,mN=globalThis.game.ads,gN=GameCore.Plugins.Ads.Types.REWARDED_VIDEO;yN("RewardedAdsTest")(cN=function(e){_e(a,e);var t,n=Ge(a);function a(){return xe(this,a),n.apply(this,arguments)}return Pe(a,[{key:"show",value:function(){this.showRewardedAds()}},{key:"showRewardedAds",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,iu.openScreen(aa,{message:"Loading ads..."}),e.next=4,mN.loadAdAsync(gN);case 4:return e.next=6,mN.showAdAsync(gN);case 6:iu.closeScreen(aa),iu.showNotificationScreen("Ads finished.",2),e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(0),console.warn("showTips failed",e.t0),"object"!==Ce(e.t0)||!e.t0||!("code"in e.t0)||"USER_INPUT"!==e.t0.code){e.next=16;break}return iu.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2),e.abrupt("return");case 16:iu.showNotificationScreen("No ads to display.",2);case 17:return e.prev=17,iu.closeScreen(aa),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[0,10,17,20]])}))),function(){return t.apply(this,arguments)})},{key:"close",value:function(){iu.closeScreen(aa)}}]),a}(f));n._RF.pop(),n._RF.push({},"0fd01MYjfdD+4IeN6PtQl3m","ScreenCongratulation",void 0);var bN,wN=a.ccclass,kN=globalThis.game.event;wN("ScreenCongratulation")(vN=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"show",value:function(){kN.emit(GameCore.Events.OPEN_SCREEN,{screenName:ca})}},{key:"close",value:function(){kN.emit(GameCore.Events.CLOSE_SCREEN,{screenName:ca})}}]),n}(f));n._RF.pop(),n._RF.push({},"bb2dcIUQjhPDLt7B6ga20s/","ScreenLoading",void 0);var SN,CN=a.ccclass,EN=globalThis.game.event;CN("ScreenLoading")(bN=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"show",value:function(e,t){var n=Number(t);EN.emit(GameCore.Events.OPEN_SCREEN,{screenName:aa,screenData:{duration:n}})}},{key:"close",value:function(){EN.emit(GameCore.Events.CLOSE_SCREEN,{screenName:aa})}}]),n}(f));n._RF.pop(),n._RF.push({},"71603KupFhNAYktx1isDcrj","ScreenNotification",void 0);var AN,TN=a.ccclass,xN=globalThis.game.event;TN("ScreenNotification")(SN=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"show",value:function(e,t){var n=String(t);xN.emit(GameCore.Events.OPEN_SCREEN,{screenName:la,screenData:{message:n}})}},{key:"close",value:function(){xN.emit(GameCore.Events.CLOSE_SCREEN,{screenName:aa})}}]),n}(f));n._RF.pop(),n._RF.push({},"1fb3eggYuVBQo5Uuzm/Nmjh","ScreenSettings",void 0);var RN,PN=a.ccclass,IN=globalThis.game.event;PN("ScreenSettings")(AN=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"show",value:function(e,t){var n=String(t);IN.emit(GameCore.Events.OPEN_SCREEN,{screenName:oa,screenData:{message:n}})}},{key:"close",value:function(){IN.emit(GameCore.Events.CLOSE_SCREEN,{screenName:oa})}}]),n}(f));n._RF.pop(),n._RF.push({},"08a36NCEUtD0ZoE9o0+nskC","ScreenTimeUp",void 0);var _N,LN=a.ccclass,ON=globalThis.game.event;LN("ScreenTimeUp")(RN=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"show",value:function(){ON.emit(GameCore.Events.OPEN_SCREEN,{screenName:na})}},{key:"close",value:function(){ON.emit(GameCore.Events.CLOSE_SCREEN,{screenName:na})}}]),n}(f));n._RF.pop(),n._RF.push({},"ae2cdksVsdJUKhhznchh9wJ","ScreenWinning",void 0);var DN,MN=a.ccclass,NN=globalThis.game.event;MN("ScreenWinning")(_N=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"show",value:function(){NN.emit(GameCore.Events.OPEN_SCREEN,{screenName:ua,screenData:{coins:50,level:12}})}},{key:"close",value:function(){NN.emit(GameCore.Events.CLOSE_SCREEN,{screenName:ua})}}]),n}(f));n._RF.pop(),n._RF.push({},"b45724VpPFL5ofnRhHicI4I","StartLevel",void 0);var FN,BN=a.ccclass,GN=globalThis.game.event;BN("StartLevel")(DN=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"show",value:function(){GN.emit(GameCore.Events.OPEN_SCREEN,{screenName:sa})}},{key:"close",value:function(){GN.emit(GameCore.Events.CLOSE_SCREEN,{screenName:sa})}}]),n}(f));n._RF.pop(),n._RF.push({},"abf91gNohBK7arKnziqu2PF","AnimationDemo2",void 0);var zN,UN,HN,qN,VN,WN;(0,a.ccclass)("AnimationDemo2")(FN=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"onLoad",value:function(){}},{key:"switchToTestScene",value:function(){Vl.switchScene("TestScene")}}]),n}(f));n._RF.pop(),n._RF.push({},"56b92F9LoxNs5aCgvw+tkq6","LoadingSceneTransition",void 0);var KN,jN,YN,XN,JN,QN,ZN,$N,eF,tF=a.ccclass,nF=a.requireComponent,aF=a.property;zN=tF("LoadingSceneTransition"),UN=nF([o]),HN=aF([i]),zN(qN=UN((WN=Qe((VN=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"targets",WN,Fe(e)),e.realTargets=[],e}return Pe(n,[{key:"start",value:function(){for(var e=this,t=0;t<this.targets.length;t++){var n=this.targets[t];if(n){var a=l(n);a.setParent(this.node),a.active=!1,this.realTargets.push(a)}}d.addPersistRootNode(this.node),d.once(Q.EVENT_BEFORE_SCENE_LAUNCH,(function(){e.playFadeOutAnimationClip()}))}},{key:"playFadeOutAnimationClip",value:function(){var e=this,t=0;this.realTargets&&0!==this.realTargets.length&&this.realTargets.forEach((function(n){n.active=!0;var a=n.getComponent(y);if(a){if(!a.clips.some((function(e){return"FadeOut"===(null==e?void 0:e.name)})))return e.node.destroy(),void console.warn("Not have FadeOut clip");a.play("FadeOut"),a.once(y.EventType.FINISHED,(function(){++t===e.realTargets.length&&e.node.destroy()}))}}))}}]),n}(f)).prototype,"targets",[HN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qN=VN))||qN);n._RF.pop(),n._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var iF,rF=a.ccclass,oF=a.property,sF=a.disallowMultiple,lF=GameCore.Events,uF=globalThis.game.event,cF=(KN=rF("BaseScreen"),jN=oF(i),YN=oF(i),XN=oF(M),KN(JN=sF((ZN=Qe((QN=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"container",ZN,Fe(e)),Je(e,"backgroundMask",$N,Fe(e)),Je(e,"screenOpacity",eF,Fe(e)),e.data={},e}return Pe(n,[{key:"__preload",value:function(){this.animation=this.getComponent(y),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function(){var e=this.getMaskOpacity(),t=this.getContainerOpacity();e&&t&&(e.opacity=0,t.opacity=0)}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function(e){this.screenOpacity.opacity=e}},{key:"open",value:function(e){e&&(this.data=e),this.show(),this.runAnimation("OpenScreen")}},{key:"close",value:function(){var e=this;this.node.active&&(this.animation.once(y.EventType.FINISHED,(function(){uF.emit(lF.CLOSED_SCREEN,{screenName:e.node.name}),e.hide()})),this.runAnimation("CloseScreen"))}},{key:"runAnimation",value:function(e){if(!this.isAnimationExist(e))throw new Error("".concat(this.node.name,": Animation component must have ").concat(e," clip"));this.animation.play(e)}},{key:"isAnimationExist",value:function(e){return this.animation.clips.some((function(t){return!(!t||t.name!==e)}))}},{key:"getMaskOpacity",value:function(){var e=this.backgroundMask.getComponent(M);return e||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function(){var e=this.container.getComponent(M);return e||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function(){this.setScreenOpacity(255);var e=this.node.getComponent(E);e&&(e.enabled=!0,e.updateAlignment(),this.node.getComponentsInChildren(E).forEach((function(e){e.updateAlignment()})))}},{key:"hide",value:function(){this.setScreenOpacity(0),this.node.setWorldPosition(new j(-1e3,-1e3,0));var e=this.node.getComponent(E);e&&(e.enabled=!1)}}]),n}(f)).prototype,"container",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$N=Qe(QN.prototype,"backgroundMask",[YN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eF=Qe(QN.prototype,"screenOpacity",[XN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JN=QN))||JN)||JN);n._RF.pop(),n._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var hF,pF,dF,fF,vF,yF,mF,gF,bF,wF,kF,SF,CF,EF,AF=a.ccclass,TF=a.requireComponent;AF("BackgroundMask")(iF=TF([M])(iF=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"onLoad",value:function(){var e=this.getComponent(M);e?(this.opacity=e,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var e,t,n=this.opacity.opacity/255;e=n,(t=document.getElementById("app-mask"))&&(t.style.background="rgb(0 0 0 / ".concat(e,")"))}}]),n}(f))||iF);n._RF.pop(),n._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var xF,RF,PF,IF,_F,LF,OF,DF,MF,NF,FF,BF,GF,zF,UF,HF,qF,VF,WF,KF,jF,YF=a.ccclass,XF=a.property,JF=a.disallowMultiple,QF=a.requireComponent,ZF=GameCore.Events,$F=globalThis.game.event;hF=YF("CongratulationScreen"),pF=QF(cF),dF=XF(i),fF=XF(i),vF=XF(p),yF=XF(p),mF=XF(p),hF(gF=JF(gF=pF((wF=Qe((bF=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"congratulation",wF,Fe(e)),Je(e,"confirmation",kF,Fe(e)),Je(e,"closeButtonComponent",SF,Fe(e)),Je(e,"yesButtonComponent",CF,Fe(e)),Je(e,"noButtonComponent",EF,Fe(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("CongratulationScreen: screen not found");e.validateEventPayload(t)&&(e.closeButtonComponent.interactable=!0,e.yesButtonComponent.interactable=!0,e.noButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.confirmationUIOpacity=this.confirmation.getComponent(M),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){$F.on(ZF.OPENING_SCREEN,this.handleOpeningScreen),$F.on(ZF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){$F.off(ZF.OPENING_SCREEN,this.handleOpeningScreen),$F.off(ZF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,iu.closeScreen(this.node.name)}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,S(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),S(this.confirmation).set({scale:new j(.8,.8,.8)}).to(.2,{scale:new j(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit($i.START_OVER)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit($i.GAME_REPLAY,{level:this.screen.data.level})}}]),n}(f)).prototype,"congratulation",[dF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kF=Qe(bF.prototype,"confirmation",[fF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SF=Qe(bF.prototype,"closeButtonComponent",[vF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CF=Qe(bF.prototype,"yesButtonComponent",[yF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EF=Qe(bF.prototype,"noButtonComponent",[mF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gF=bF))||gF)||gF);n._RF.pop(),n._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var eB,tB,nB,aB,iB,rB,oB=a.ccclass,sB=a.property,lB=(xF=oB("DayBlock"),RF=sB({type:T,group:"Background"}),PF=sB({type:T,group:"Background"}),IF=sB({type:O,group:"Background"}),_F=sB({type:O,group:"Background"}),LF=sB(u),OF=sB(u),DF=sB(i),MF=sB(i),NF=sB(i),xF((GF=Qe((BF=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"background",GF,Fe(e)),Je(e,"topBackground",zF,Fe(e)),Je(e,"blueBackground",UF,Fe(e)),Je(e,"blueTopBackground",HF,Fe(e)),Je(e,"dayLabel",qF,Fe(e)),Je(e,"coinLabel",VF,Fe(e)),Je(e,"rewardItemsNode",WF,Fe(e)),Je(e,"checkNode",KF,Fe(e)),Je(e,"glowNodes",jF,Fe(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(M),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new r(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new r("#3469bf")}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e){this.updateBackground(e),this.updateDayLabel(e),this.coinLabel.string=e.value.toString(),this.updateRewardItems(e)}},{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLabel.string="Day ".concat(e.day.toString());var t=this.defaultDayLabelOutlineColor;"rewarded"!==e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=t,this.dayLabel.shadowColor=t}},{key:"updateRewardItems",value:function(e){switch(e.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(e){this.glowNodes&&this.glowNodes.forEach((function(t){t.active=e}))}}]),n}(f)).prototype,"background",[RF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zF=Qe(BF.prototype,"topBackground",[PF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UF=Qe(BF.prototype,"blueBackground",[IF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HF=Qe(BF.prototype,"blueTopBackground",[_F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qF=Qe(BF.prototype,"dayLabel",[LF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VF=Qe(BF.prototype,"coinLabel",[OF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WF=Qe(BF.prototype,"rewardItemsNode",[DF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KF=Qe(BF.prototype,"checkNode",[MF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jF=Qe(BF.prototype,"glowNodes",[NF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FF=BF))||FF);n._RF.pop(),n._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var uB,cB=a.ccclass,hB=a.property,pB=a.requireComponent,dB=GameCore.Events,fB=globalThis.game,vB=fB.event,yB=fB.dailyRewards,mB=fB.player;eB=cB("DailyRewardsScreen"),tB=pB(cF),nB=hB([lB]),eB(aB=tB((rB=Qe((iB=function(e){_e(r,e);var t,n,a,i=Ge(r);function r(){var e;xe(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=i.call.apply(i,[this].concat(n)),"dailyBlocks",rB,Fe(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){vB.on(dB.OPENING_SCREEN,this.handleOpeningScreen),vB.on(dB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){vB.off(dB.OPENING_SCREEN,this.handleOpeningScreen),vB.off(dB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:(a=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.scene.emit($i.HIDE_UI),this.resetState(),e.next=4,this.updateRewardsData();case 4:this.loginDailyRewards(),this.updateDayBlocks(),this.runPopUpAnimation();case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"close",value:function(){vB.emit(dB.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit($i.SHOW_UI)}},{key:"resetState",value:function(){this.dailyBlocks.forEach((function(e){e.uiOpacity.opacity=0,e.node.scale=new j(1.2,1.2,1.2)}))}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("DailyRewardScreen: screen not found"),this.dailyBlocks.forEach((function(t,n){e.runAppearTween(t,.15*n)}))}},{key:"runAppearTween",value:function(e,t){S(e.uiOpacity).delay(t).to(.3,{opacity:255},{easing:"quadOut"}).start(),S(e.node).delay(t).to(.3,{scale:j.ONE},{easing:"backOut"}).start()}},{key:"handleOnClaim",value:function(){var e=this.getCurrentRewardData();e&&this.claimReward(e)}},{key:"handleOnClaimX2",value:(n=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getCurrentRewardData()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,hv.showRewardVideoAdAsync({});case 5:if(e.sent){e.next=8;break}return e.abrupt("return");case 8:this.claimReward(t,!0);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return this.rewardsData.find((function(e){return"ready"===e.status}))}},{key:"claimReward",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.value*(t?2:1),a=new ui;if(this.node.scene.emit($i.ADD_COINS,{coins:n,collectionAnimation:{animateTextOnly:!1,signal:a}}),e.items){var i=e.items.hint*(t?2:1),r=e.items.thunder*(t?2:1),o=e.items.storm*(t?2:1),s=mB.getGameData();s?(mB.setGameData({items:{hint:s.items.hint+i,thunder:s.items.thunder+r,storm:s.items.storm+o,pliers:s.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yB.requestDailyRewardsAsync();case 2:for(t=ke({},yB.getDailyRewards()),n=0;n<GameCore.Configs.DailyRewards.MaxDays;n++)t[n]=ke(ke({},t[n]),{},{value:Is[n].value,items:Is[n].items});if(t){e.next=6;break}return e.abrupt("return");case 6:this.rewardsData=Object.values(t),console.log("DailyRewardsScreen: rewardsData",this.rewardsData);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){yB.logLoginReward()}},{key:"updateDayBlocks",value:function(){var e=this;this.dailyBlocks.forEach((function(t,n){var a=e.rewardsData[n],i=a.id,r=a.type,o=a.value,s=a.status;t.updateInfo({day:i,type:r,value:o,status:s})}))}}]),r}(f)).prototype,"dailyBlocks",[nB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aB=iB))||aB);n._RF.pop(),n._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var gB,bB,wB,kB,SB,CB,EB,AB,TB,xB;(0,a.ccclass)("DayBlockRed")(uB=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n,[{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLabel.string="Day ".concat(e.day.toString());var t=this.defaultDayLabelOutlineColor;"ready"===e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=t,this.dayLabel.outlineColor=t}}]),n}(lB));n._RF.pop(),n._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var RB,PB,IB,_B,LB,OB,DB,MB,NB,FB=a.ccclass,BB=a.property,GB=a.requireComponent,zB=globalThis.game.event,UB=GameCore.Events;gB=FB("GetCoinScreen"),bB=GB(cF),wB=BB(u),kB=BB(p),SB=BB(p),gB(CB=bB((AB=Qe((EB=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"quantityLabel",AB,Fe(e)),Je(e,"closeButtonComponent",TB,Fe(e)),Je(e,"getNowButtonComponent",xB,Fe(e)),e.handleOpeningScreen=function(t){console.log("GetCoinScreen.OPENING_SCREEN",t),e.validateEventPayload(t)&&(e.closeButtonComponent.interactable=!0,e.getNowButtonComponent.interactable=!0,e.updateStatus())},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(a,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){zB.on(UB.OPENING_SCREEN,this.handleOpeningScreen),zB.on(UB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){zB.off(UB.OPENING_SCREEN,this.handleOpeningScreen),zB.off(UB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return"screenName"in e&&(e.screenName===this.node.name&&(this.payload=e,!0))}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit($i.HIDE_UI)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,zB.emit(UB.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit($i.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var e=this.getQuantity();e&&this.updateQuantityLabel(e)}},{key:"updateQuantityLabel",value:function(e){this.quantityLabel.string="x".concat(e.toString())}},{key:"getQuantity",value:function(){if(!this.payload||!("screenData"in this.payload))return 0;var e=this.payload.screenData;return e&&"quantity"in e&&e.quantity&&"number"==typeof e.quantity?e.quantity:0}},{key:"handleAddCoin",value:function(){var e=this.getQuantity();this.node.scene.emit($i.ADD_COINS,{coins:e,collectionAnimation:{animateTextOnly:!1}}),this.close()}},{key:"handleGetNowButtonClicked",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ga.stopAllSounds(),e.next=3,hv.showRewardVideoAdAsync({});case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:this.handleAddCoin();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"quantityLabel",[wB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TB=Qe(EB.prototype,"closeButtonComponent",[kB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xB=Qe(EB.prototype,"getNowButtonComponent",[SB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CB=EB))||CB);n._RF.pop(),n._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var HB,qB,VB,WB,KB,jB,YB,XB,JB,QB,ZB,$B,eG,tG,nG,aG,iG,rG,oG,sG,lG,uG,cG,hG,pG,dG=a.ccclass,fG=a.property,vG=(RB=dG("ItemCollectionFX"),PB=fG(T),IB=fG(M),_B=fG(ie),RB((DB=Qe((OB=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"sprite",DB,Fe(e)),Je(e,"glowUIOpacity",MB,Fe(e)),Je(e,"particles",NB,Fe(e)),e}return Pe(n,[{key:"__preload",value:function(){Ct.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){this.particles.resetSystem()}}]),n}(f)).prototype,"sprite",[PB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MB=Qe(OB.prototype,"glowUIOpacity",[IB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NB=Qe(OB.prototype,"particles",[_B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LB=OB))||LB);n._RF.pop(),n._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var yG,mG,gG,bG,wG,kG,SG,CG,EG,AG,TG,xG,RG,PG,IG,_G,LG,OG,DG,MG,NG,FG,BG,GG,zG,UG,HG,qG,VG,WG,KG=a.ccclass,jG=a.property,YG=globalThis.game,XG=YG.event,JG=YG.player,QG=YG.analytics,ZG=GameCore.Events;HB=KG("GetItemScreen"),qB=jG(P),VB=jG(T),WB=jG(T),KB=jG(T),jB=jG(T),YB=jG(u),XB=jG(u),JB=jG(u),QB=jG(p),ZB=jG(p),$B=jG(p),HB((nG=Qe((tG=function(e){_e(s,e);var t,n,a,i,r,o=Ge(s);function s(){var e;xe(this,s);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=o.call.apply(o,[this].concat(n)),"itemFxPrefab",nG,Fe(e)),Je(e,"hintSprite",aG,Fe(e)),Je(e,"stormSprite",iG,Fe(e)),Je(e,"pliersSprite",rG,Fe(e)),Je(e,"thunderSprite",oG,Fe(e)),Je(e,"titleLabel",sG,Fe(e)),Je(e,"descriptionLabel",lG,Fe(e)),Je(e,"coinLabel",uG,Fe(e)),Je(e,"closeButtonComponent",cG,Fe(e)),Je(e,"buyItemButtonComponent",hG,Fe(e)),Je(e,"getNowButtonComponent",pG,Fe(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("GetItemScreen: screen not found");if(e.validateEventPayload(t)){e.closeButtonComponent.interactable=!0,e.getNowButtonComponent.interactable=!0,e.buyItemButtonComponent.interactable=!0;var n=e.getItemType();n&&e.updateStatus(n)}},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){XG.on(ZG.OPENING_SCREEN,this.handleOpeningScreen),XG.on(ZG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){XG.off(ZG.OPENING_SCREEN,this.handleOpeningScreen),XG.off(ZG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function(){this.node.scene.emit($i.GAME_PAUSE)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.buyItemButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,XG.emit(ZG.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit($i.GAME_RESUME)}},{key:"updateStatus",value:function(e){this.updateItemIcon(e),this.updateTitle(e),this.updateDescription(),this.updateButtons(e)}},{key:"updateItemIcon",value:function(e){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach((function(e){e.node.active=!1})),e){case Cs.HINT:this.activeIcon=this.hintSprite;break;case Cs.STORM:this.activeIcon=this.stormSprite;break;case Cs.THUNDER:this.activeIcon=this.thunderSprite;break;case Cs.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}},{key:"updateTitle",value:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1);this.titleLabel.string=t}},{key:"updateDescription",value:function(){var e,t=null===(e=this.payload.screenData)||void 0===e?void 0:e.message;t&&(this.descriptionLabel.string=t)}},{key:"updateButtons",value:function(e){var t=this.canBuyItem(e);this.buyItemButtonComponent.node.active=t,this.getNowButtonComponent.node.active=!t,t&&(this.coinLabel.string="".concat(3*xs[e]))}},{key:"canBuyItem",value:function(e){var t=JG.getGameData();return!!t&&t.coins>=3*xs[e]}},{key:"getItemType",value:function(){var e=this.payload.screenData;return e&&e.item&&Object.values(Cs).includes(e.item)?e.item:null}},{key:"handleAddItem",value:(r=Te(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getItemType()){e.next=3;break}return e.abrupt("return");case 3:QG.event(GameCore.Plugins.Analytics.Events.EARN_ITEM,{item_name:t,value:3}),this.node.scene.emit($i.ADD_ITEM,{animate:function(){return n.animateAddItem(t)},item:t,quantity:3});case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"animateAddItem",value:(i=Te(Se().mark((function e(t){var n,a,i,r,o,s,l;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.activeIcon.spriteFrame,a=this.createItemCollectionNode(n),i=Ve(a,2),r=i[0],o=i[1],s=this.getItemButtonWorldPosition(t),l=new j(.5,.5,.5),o.glowUIOpacity.opacity=150,e.next=7,this.playScaleUpItemAnim(r,o);case 7:return e.next=9,mn.runTweenAsync(S(o.glowUIOpacity).to(.8,{opacity:0},{easing:"cubicIn"}));case 9:return e.next=11,this.playMoveCloseToItemButtonAnim(r,s,l);case 11:return e.next=13,this.playJumpAnim(r,l,s);case 13:ga.playSound("sounds/clicks"),r.destroy();case 15:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"playJumpAnim",value:(a=Te(Se().mark((function e(t,n,a){var i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.clone().add3f(0,70,0),r=n.clone().multiplyScalar(1.3),e.next=4,Promise.all([mn.runTweenAsync(S(t).to(.3,{worldPosition:i},{easing:"cubicOut"})),mn.runTweenAsync(S(t).to(.3,{scale:r},{easing:"cubicOut"}))]);case 4:return e.next=6,mn.runTweenAsync(S(t).to(.5,{worldPosition:a},{easing:"cubicIn"}));case 6:case"end":return e.stop()}}),e)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"playMoveCloseToItemButtonAnim",value:function(e,t,n){var a=t.clone().add3f(0,30,0);return mn.runTweenAsync(S(e).to(1,{worldPosition:a,scale:n},{easing:"cubicInOut"}))}},{key:"createItemCollectionNode",value:function(e){var t=l(this.itemFxPrefab),n=t.getComponent(vG);return t.setParent(this.node.parent),n.sprite.spriteFrame=e,t.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[t,n]}},{key:"playScaleUpItemAnim",value:function(e,t){return e.setScale(j.ZERO),mn.runTweenAsync(S(e).delay(.2).call((function(){t.playExplosionParticles(),ga.playSound("sounds/item_reward")})).to(.1,{scale:new j(.8,1.2,1)}).to(.1,{scale:new j(1.2,.8,1)}).to(.1,{scale:new j(1,1,1)}))}},{key:"getItemButtonWorldPosition",value:function(e){return this.getItemButton(e).worldPosition.clone()}},{key:"handleGetNowButtonClicked",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAllSounds(),e.next=3,hv.showRewardVideoAdAsync({});case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:this.handleAddItem(),this.close();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.node.scene.emit($i.REMOVE_COINS,{coins:3*xs[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var e;null===(e=R("Sound"))||void 0===e||null===(e=e.getComponent(Xt))||void 0===e||e.stopAll()}},{key:"getItemButton",value:function(e){switch(e){case Cs.HINT:return R("Canvas/UI/Footer/HintItemButton");case Cs.STORM:return R("Canvas/UI/Footer/StormItemButton");case Cs.THUNDER:return R("Canvas/UI/Footer/ThunderItemButton");case Cs.PLIERS:return R("Canvas/UI/Footer/PliersItemButton")}}}]),s}(f)).prototype,"itemFxPrefab",[qB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aG=Qe(tG.prototype,"hintSprite",[VB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iG=Qe(tG.prototype,"stormSprite",[WB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rG=Qe(tG.prototype,"pliersSprite",[KB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oG=Qe(tG.prototype,"thunderSprite",[jB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sG=Qe(tG.prototype,"titleLabel",[YB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lG=Qe(tG.prototype,"descriptionLabel",[XB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uG=Qe(tG.prototype,"coinLabel",[JB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cG=Qe(tG.prototype,"closeButtonComponent",[QB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hG=Qe(tG.prototype,"buyItemButtonComponent",[ZB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pG=Qe(tG.prototype,"getNowButtonComponent",[$B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eG=tG));n._RF.pop(),n._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var $G,ez=a.ccclass,tz=a.property,nz=a.requireComponent,az=GameCore,iz=az.Events,rz=az.Utils,oz=globalThis.game,sz=oz.event,lz=oz.player,uz="Coin Container";yG=ez("LevelCompleteScreen"),mG=nz(cF),gG=tz(eS),bG=tz(i),wG=tz(u),kG=tz(i),SG=tz(i),CG=tz(p),EG=tz(i),AG=tz(y),TG=tz(i),xG=tz({type:y,group:uz}),RG=tz({type:_,group:uz}),PG=tz({type:_,group:uz}),IG=tz(Uw),yG(_G=mG((OG=Qe((LG=function(e){_e(o,e);var t,n,a,i,r=Ge(o);function o(){var e;xe(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return(e=r.call.apply(r,[this].concat(n))).levelId=1,e.coins=40,e.currentCoin=0,Je(e,"coinContainer",OG,Fe(e)),Je(e,"playButton",DG,Fe(e)),Je(e,"coinText",MG,Fe(e)),Je(e,"levelText",NG,Fe(e)),Je(e,"nextLevelText",FG,Fe(e)),Je(e,"playButtonComponent",BG,Fe(e)),Je(e,"wellDoneText",GG,Fe(e)),Je(e,"coinAnimation",zG,Fe(e)),Je(e,"playButtonContainer",UG,Fe(e)),Je(e,"coinContainerAnimation",HG,Fe(e)),Je(e,"coinContainerEnterClip",qG,Fe(e)),Je(e,"coinContainerExitClip",VG,Fe(e)),Je(e,"paperConfetti",WG,Fe(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)&&(e.playButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(o,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onLoad",value:function(){var e=this,t=this.screen.open;this.screen.open=function(n){e.overrideOpenHandler(t,n)}}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){sz.on(iz.OPENING_SCREEN,this.handleOpeningScreen),sz.on(iz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){sz.off(iz.OPENING_SCREEN,this.handleOpeningScreen),sz.off(iz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){var t=null!=e?e:{},n=t.screenName,a=t.screenData;return n===this.node.name&&(!!rz.Valid.isObject(a)&&(rz.Valid.isNumber(a.level)&&(this.levelId=a.level,this.coins=this.levelId<5?Es:As),rz.Valid.isNumber(a.currentCoin)&&(this.currentCoin=a.currentCoin),!0))}},{key:"open",value:function(){this.updateComponents(),this.node.scene.emit($i.HIDE_UI)}},{key:"close",value:(i=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name);case 2:return sz.emit(iz.CLOSE_SCREEN,{screenName:this.node.name}),e.next=5,hv.showInterstitialAdAsync({forLevel:this.screen.data.level});case 5:this.handleNextLevel();case 6:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"overrideOpenHandler",value:(a=Te(Se().mark((function e(t,n){var a,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.screen.setScreenOpacity(255),this.coinText.string="x0",this.playButtonComponent.interactable=!1,this.paperConfetti.runEffect(),e.next=6,this.animateWellDoneText();case 6:this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z),t.call(this.screen,n),null===(a=this.screen.getComponent(y))||void 0===a||a.once(y.EventType.FINISHED,(function(){i.animateCoin()}));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"handleNextLevel",value:function(){var e=this.screen.data.level;if(e){var t=lz.getGameData();if(t)e>=t.totalLevel?this.node.scene.emit($i.MAX_LEVEL):this.node.scene.emit($i.NEXT_LEVEL);else console.warn("LevelCompleteScreen: gameData not found")}else console.warn("LevelCompleteScreen: level not found")}},{key:"updateComponents",value:function(){this.updateLevelText(),this.updateCoinContainer()}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoin})}},{key:"updateLevelText",value:function(){var e=lz.getGameData();if(e){this.levelText.getComponent(u).string="Level ".concat(this.levelId),console.log("LevelCompleteScreen: updateLevelText",this.levelId);var t=this.levelId+1>e.totalLevel?"Complete":"Level ".concat(this.levelId+1);this.nextLevelText.getComponent(u).string=t}else console.warn("LevelCompleteScreen: gameData not found")}},{key:"updateCoinString",value:function(){this.coinText.string="x".concat(this.coins),console.log("LevelCompleteScreen: updateCoinString",this.coins)}},{key:"animateCoin",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.screen.container){e.next=3;break}return console.warn("LevelCompleteScreen: screen not found"),e.abrupt("return");case 3:return this.coinAnimation.play(),e.next=6,this.animateCoinText({contentFn:function(e){return"x".concat(e)},currentQuantity:0,targetQuantity:this.coins});case 6:return e.next=8,this.animateCoinCollection();case 8:return e.next=10,mn.runTweenAsync(this.showPlayButton());case 10:this.updateCoinString();case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"animateCoinCollection",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name);case 2:this.node.scene.emit($i.ADD_COINS,{coins:this.coins,collectionAnimation:{animateTextOnly:!1,target:this.coinContainer}});case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"showPlayButton",value:function(){var e=this;return S(this.playButtonContainer).call((function(){e.playButtonContainer.setScale(0,0,e.playButtonContainer.scale.z)})).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).call((function(){e.playButtonComponent.interactable=!0}))}},{key:"handleClickedPlay",value:function(){this.playButtonComponent.interactable=!1,this.close()}},{key:"animateWellDoneText",value:function(){var e=this,t=this.wellDoneText.position.clone(),n=S(this.wellDoneText).call((function(){e.wellDoneText.setPosition(0,0,e.wellDoneText.position.z),e.wellDoneText.setScale(0,0,e.wellDoneText.scale.z)})).to(.5,{scale:new j(1.5,1.5,1)},{easing:"cubicOut"}).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).to(.5,{position:t},{easing:"backOut"});return mn.runTweenAsync(n)}},{key:"animateCoinText",value:function(e){var t=this,n=e.contentFn,a=e.currentQuantity,i=e.targetQuantity,r=e.duration,o=void 0===r?.8:r,s=S({currentQuantity:a}).to(o,{currentQuantity:i},{easing:"linear",onUpdate:function(e){if(e){var a=e.currentQuantity,i=Math.floor(a);t.coinText.string=n(i)}}});return mn.runTweenAsync(s)}}]),o}(f)).prototype,"coinContainer",[gG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DG=Qe(LG.prototype,"playButton",[bG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MG=Qe(LG.prototype,"coinText",[wG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NG=Qe(LG.prototype,"levelText",[kG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FG=Qe(LG.prototype,"nextLevelText",[SG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BG=Qe(LG.prototype,"playButtonComponent",[CG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GG=Qe(LG.prototype,"wellDoneText",[EG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zG=Qe(LG.prototype,"coinAnimation",[AG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UG=Qe(LG.prototype,"playButtonContainer",[TG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HG=Qe(LG.prototype,"coinContainerAnimation",[xG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qG=Qe(LG.prototype,"coinContainerEnterClip",[RG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VG=Qe(LG.prototype,"coinContainerExitClip",[PG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WG=Qe(LG.prototype,"paperConfetti",[IG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_G=LG))||_G);n._RF.pop(),n._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var cz,hz,pz,dz,fz,vz,yz,mz,gz=a.ccclass,bz=a.disallowMultiple,wz=a.requireComponent,kz=GameCore.Events,Sz=globalThis.game.event;gz("LoadingScreen")($G=bz($G=wz(cF)($G=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e.handleClosedScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!1)},e.handleOnCloseScreen=function(){iu.closeScreen(e.node.name)},e}return Pe(n,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Sz.on(kz.OPENING_SCREEN,this.handleOpeningScreen),Sz.on(kz.OPENED_SCREEN,this.handleOpenedScreen),Sz.on(kz.CLOSING_SCREEN,this.handleClosingScreen),Sz.on(kz.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){Sz.off(kz.OPENING_SCREEN,this.handleOpeningScreen),Sz.off(kz.OPENED_SCREEN,this.handleOpenedScreen),Sz.off(kz.CLOSING_SCREEN,this.handleClosingScreen),Sz.off(kz.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var e=this.screen.data.duration;e&&e>0&&this.scheduleOnce(this.handleOnCloseScreen,e)}}}]),n}(f))||$G)||$G);n._RF.pop(),n._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var Cz,Ez,Az,Tz,xz,Rz,Pz,Iz,_z=a.ccclass,Lz=a.disallowMultiple,Oz=a.requireComponent,Dz=a.property,Mz=GameCore,Nz=Mz.Events,Fz=Mz.Utils,Bz=globalThis.game.event;cz=_z("NotificationScreen"),hz=Oz(cF),pz=Dz(u),dz=Dz(p),cz(fz=Lz(fz=hz((yz=Qe((vz=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"message",yz,Fe(e)),Je(e,"touchZone",mz,Fe(e)),e.enableCloseOnTouch=!0,e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.updateScreenData(t)},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e}return Pe(n,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Bz.on(Nz.OPENING_SCREEN,this.handleOpeningScreen),Bz.on(Nz.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){Bz.off(Nz.OPENING_SCREEN,this.handleOpeningScreen),Bz.off(Nz.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"updateScreenData",value:function(e){var t=this,n=e.screenData;Fz.Valid.isObject(n)?(n.message&&(this.message.string=n.message),n.duration&&n.duration>0&&this.scheduleOnce((function(){iu.closeScreen(t.node.name)}),n.duration),!1===n.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),iu.closeScreen(this.node.name)}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),n}(f)).prototype,"message",[pz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mz=Qe(vz.prototype,"touchZone",[dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fz=vz))||fz)||fz);n._RF.pop(),n._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var Gz,zz,Uz,Hz,qz,Vz,Wz,Kz,jz,Yz,Xz,Jz,Qz,Zz,$z,eU,tU,nU,aU,iU,rU,oU,sU=a.ccclass,lU=a.property,uU=a.requireComponent,cU=GameCore.Events,hU=globalThis.game.event;Cz=sU("QuitLevelScreen"),Ez=uU(cF),Az=lU(p),Tz=lU(p),Cz(xz=Ez((Pz=Qe((Rz=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"noButton",Pz,Fe(e)),Je(e,"yesButton",Iz,Fe(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.noButton.interactable=!0,e.yesButton.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){hU.on(cU.OPENING_SCREEN,this.handleOpeningScreen),hU.on(cU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){hU.off(cU.OPENING_SCREEN,this.handleOpeningScreen),hU.off(cU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit($i.HIDE_UI)}},{key:"close",value:function(){this.noButton.interactable=!1,this.yesButton.interactable=!1,iu.closeScreen(this.node.name),this.node.scene.emit($i.SHOW_UI),this.node.scene.emit($i.GAME_RESUME)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedNo",value:function(){this.close()}},{key:"handleClickedYes",value:function(){this.node.scene.emit($i.GAME_EXIT)}}]),n}(f)).prototype,"noButton",[Az],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iz=Qe(Rz.prototype,"yesButton",[Tz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xz=Rz))||xz);n._RF.pop(),n._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var pU,dU,fU,vU,yU,mU,gU,bU,wU,kU,SU,CU,EU,AU,TU,xU,RU,PU,IU,_U,LU,OU,DU,MU,NU,FU,BU=a.ccclass,GU=a.property,zU=a.disallowMultiple,UU=a.requireComponent,HU=GameCore.Events,qU=globalThis.game,VU=qU.event,WU=qU.player;Gz=BU("RescuesScreen"),zz=UU(cF),Uz=GU(M),Hz=GU([i]),qz=GU(u),Vz=GU(u),Wz=GU(i),Kz=GU(i),jz=GU(y),Yz=GU(i),Xz=GU(i),Gz(Jz=zU(Jz=zz((Zz=Qe((Qz=function(e){_e(s,e);var t,n,a,i,r,o=Ge(s);function s(){var e;xe(this,s);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=o.call.apply(o,[this].concat(n)),"adOpacity",Zz,Fe(e)),Je(e,"animNodes",$z,Fe(e)),Je(e,"titleLabel",eU,Fe(e)),Je(e,"descriptionLabel",tU,Fe(e)),Je(e,"timer",nU,Fe(e)),Je(e,"bomb",aU,Fe(e)),Je(e,"bombAnim",iU,Fe(e)),Je(e,"replayButton",rU,Fe(e)),Je(e,"buyTimeButton",oU,Fe(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("RescuesScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){VU.on(HU.OPENING_SCREEN,this.handleOpeningScreen),VU.on(HU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){VU.off(HU.OPENING_SCREEN,this.handleOpeningScreen),VU.off(HU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:(r=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resetState();case 2:this.runOpenAnimation(),this.node.scene.emit($i.HIDE_UI);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"close",value:function(){VU.emit(HU.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(i=Te(Se().mark((function e(){var t,n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(null===(t=this.payload.screenData)||void 0===t?void 0:t.failKey)===su,this.titleLabel.string=n?"Boom!":"Time's Up!",this.descriptionLabel.string=n?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!n,this.bomb.active=n,n&&this.bombAnim.play(),a=WU.getGameData()){e.next=9;break}return e.abrupt("return");case 9:i=a.coins>=Rs,this.replayButton.active=!i,this.buyTimeButton.active=i,this.adOpacity.opacity=0;case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"runOpenAnimation",value:(a=Te(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.screen.container){e.next=3;break}return console.warn("TimeUpScreen: screen not found"),e.abrupt("return");case 3:return e.next=5,Promise.all(this.animNodes.map((function(e,n){t.runAppearTween(e,.1*n)})));case 5:return e.next=7,this.runShowAdContainer();case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"runAppearTween",value:(n=Te(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runTweenAsync(S(t).set({scale:new j(0,0,0)}).delay(n).to(1,{scale:new j(1,1,1)},{progress:function(e,t,n,a){return e+(t-e)*mn.elasticOut(a,.1,.45)}}));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var e=S(this.adOpacity);return e.delay(1),e.to(.5,{opacity:255}),mn.runTweenAsync(e)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit($i.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit($i.REMOVE_COINS,{coins:Rs,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hv.showRewardVideoAdAsync({});case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:this.startRescue();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit($i.SHOW_UI),this.node.scene.emit($i.RESCUE_START),this.close()}}]),s}(f)).prototype,"adOpacity",[Uz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$z=Qe(Qz.prototype,"animNodes",[Hz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eU=Qe(Qz.prototype,"titleLabel",[qz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tU=Qe(Qz.prototype,"descriptionLabel",[Vz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nU=Qe(Qz.prototype,"timer",[Wz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aU=Qe(Qz.prototype,"bomb",[Kz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iU=Qe(Qz.prototype,"bombAnim",[jz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rU=Qe(Qz.prototype,"replayButton",[Yz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oU=Qe(Qz.prototype,"buyTimeButton",[Xz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jz=Qz))||Jz)||Jz);n._RF.pop(),n._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var KU,jU,YU,XU,JU,QU,ZU,$U,eH,tH,nH,aH,iH,rH,oH,sH,lH,uH,cH,hH,pH,dH,fH,vH=a.ccclass,yH=a.property,mH=a.requireComponent,gH=GameCore,bH=gH.Events,wH=gH.Utils,kH=globalThis.game,SH=kH.player,CH=kH.event;pU=vH("SettingsScreen"),dU=mH(cF),fU=yH(i),vU=yH(i),yU=yH(i),mU=yH(IR),gU=yH(IR),bU=yH(IR),wU=yH(p),kU=yH(p),SU=yH(p),CU=yH(p),EU=yH(i),pU(AU=dU((xU=Qe((TU=function(e){_e(a,e);var t,n=Ge(a);function a(){var e;xe(this,a);for(var t=arguments.length,i=new Array(t),r=0;r<t;r++)i[r]=arguments[r];return Je(e=n.call.apply(n,[this].concat(i)),"musicSetting",xU,Fe(e)),Je(e,"soundSetting",RU,Fe(e)),Je(e,"vibrateSetting",PU,Fe(e)),Je(e,"musicSwitch",IU,Fe(e)),Je(e,"soundSwitch",_U,Fe(e)),Je(e,"vibrateSwitch",LU,Fe(e)),Je(e,"closeButtonComponent",OU,Fe(e)),Je(e,"continueButtonComponent",DU,Fe(e)),Je(e,"restartButtonComponent",MU,Fe(e)),Je(e,"inviteFriendsButtonComponent",NU,Fe(e)),Je(e,"animNodes",FU,Fe(e)),e.triggerSequence="",e.handleOpeningScreen=function(t){e.validateSwitchScreenPayload(t)&&(e.closeButtonComponent.interactable=!0,e.continueButtonComponent.interactable=!0,e.restartButtonComponent.interactable=!0,e.inviteFriendsButtonComponent.interactable=!0,e.updateStatus())},e.handleOpenedScreen=function(t){e.validateSwitchScreenPayload(t)&&e.open()},e.handleResetSequence=function(){e.triggerSequence=""},e.handleTriggerUnlockKey=function(t){if("code"in t){var n=t.code,a=zs.UNLOCK_SEQUENCE;"number"==typeof n&&-1!==a.indexOf(n.toString())&&(e.triggerSequence+=n.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",n,e.triggerSequence,e.triggerSequence===a),e.triggerSequence===a&&(e.node.scene.emit(zs.Events.UNLOCK_DEV_TOOLS),e.node.off(zs.Events.TRIGGER_UNLOCK_KEY)))}},e.updateVibrateButton=function(){var t=e.vibrateSetting.getComponentInChildren(p),n=e.vibrateSetting.getComponentInChildren(IR),a=e.vibrateSetting.getComponentInChildren(yi);if(t&&n&&a)if(wH.Device.isMobile()){var i,r=null!==(i=SH.getPlayerSetting("vibrate"))&&void 0!==i&&i;n.setEnabled(r)}else t.interactable=!1,n.setEnabled(!1),a.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")},e}return Pe(a,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){CH.on(bH.OPENING_SCREEN,this.handleOpeningScreen),CH.on(bH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){CH.off(bH.OPENING_SCREEN,this.handleOpeningScreen),CH.off(bH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(e){return e.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(zs.Events.TRIGGER_UNLOCK_KEY),this.node.on(zs.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(zs.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(zs.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(zs.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(zs.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit($i.HIDE_UI)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.continueButtonComponent.interactable=!1,this.restartButtonComponent.interactable=!1,this.inviteFriendsButtonComponent.interactable=!1,this.node.emit(zs.Events.TRIGGER_RESET_SEQUENCE),iu.closeScreen(this.node.name)}},{key:"updateStatus",value:function(){var e,t,n,a={music:null!==(e=SH.getPlayerSetting("music"))&&void 0!==e&&e,sound:null!==(t=SH.getPlayerSetting("sound"))&&void 0!==t&&t,vibrate:null!==(n=SH.getPlayerSetting("vibrate"))&&void 0!==n&&n};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(a.music),this.soundSwitch.setEnabled(a.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach((function(t,n){e.runAppearTween(t,.1*n)}))}},{key:"runAppearTween",value:function(e,t){var n=S(e);n.set({scale:new j(0,0,0)}),n.delay(t),n.to(1,{scale:new j(1,1,1)},{progress:function(e,t,n,a){return e+(t-e)*mn.elasticOut(a,.1,.45)}}),n.start()}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var e=this.musicSwitch.switch();SH.setSetting("music",e),this.node.emit(zs.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e?ga.playMusic():ga.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var e=this.soundSwitch.switch();SH.setSetting("sound",e),this.node.emit(zs.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var e=this.vibrateSwitch.switch();SH.setSetting("vibrate",e)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:function(){this.restartGame()}},{key:"handleClickedInviteFriends",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.close(),this.node.scene.emit($i.INVITE_FRIENDS);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit($i.GAME_RESUME),this.node.scene.emit($i.SHOW_UI)}},{key:"restartGame",value:function(){var e;this.close(),this.node.scene.emit($i.GAME_RESUME);var t=(null!==(e=SH.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;this.node.scene.emit($i.GAME_REPLAY,{level:n})}}]),a}(f)).prototype,"musicSetting",[fU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RU=Qe(TU.prototype,"soundSetting",[vU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PU=Qe(TU.prototype,"vibrateSetting",[yU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IU=Qe(TU.prototype,"musicSwitch",[mU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_U=Qe(TU.prototype,"soundSwitch",[gU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LU=Qe(TU.prototype,"vibrateSwitch",[bU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OU=Qe(TU.prototype,"closeButtonComponent",[wU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DU=Qe(TU.prototype,"continueButtonComponent",[kU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MU=Qe(TU.prototype,"restartButtonComponent",[SU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NU=Qe(TU.prototype,"inviteFriendsButtonComponent",[CU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FU=Qe(TU.prototype,"animNodes",[EU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AU=TU))||AU);n._RF.pop(),n._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var EH,AH,TH,xH,RH,PH,IH,_H,LH,OH,DH,MH,NH,FH,BH,GH,zH,UH,HH,qH,VH=a.ccclass,WH=a.property,KH=(KU=VH("StarChest"),jU=WH(T),YU=WH(M),XU=WH(ie),JU=WH(M),QU=WH(M),ZU=WH({type:C,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),$U=WH({type:C,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),eH=WH({type:C,displayName:"Centered Offset X",group:"Reward Animations"}),tH=WH({type:C,displayName:"Centered Offset Y",group:"Reward Animations"}),nH=WH({type:C,min:0,displayName:"Starting Scale",group:"Reward Animations"}),aH=WH({type:C,min:0,displayName:"Ending Scale",group:"Reward Animations"}),KU((oH=Qe((rH=function(e){_e(s,e);var t,n,a,i,r,o=Ge(s);function s(){var e;xe(this,s);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=o.call.apply(o,[this].concat(n)),"sprite",oH,Fe(e)),Je(e,"glowOpacity",sH,Fe(e)),Je(e,"explosionParticles",lH,Fe(e)),Je(e,"circle",uH,Fe(e)),Je(e,"uiOpacity",cH,Fe(e)),e.ogCenterX=0,e.ogCenterY=0,Je(e,"endingOffsetX",hH,Fe(e)),Je(e,"endingOffsetY",pH,Fe(e)),Je(e,"startingScale",dH,Fe(e)),Je(e,"endingScale",fH,Fe(e)),e}return Pe(s,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"moveToCenter",value:(r=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(this.endingOffsetX,this.endingOffsetY,this.node.position.z),e.next=3,mn.runTweenAsync(S(this.node).to(.7,{position:n},{easing:"quintInOut"}),t);case 3:this.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new j(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(i=Te(Se().mark((function e(t,n){var a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.startingScale+(this.endingScale-this.startingScale)*t,i=new j(a,a,a),e.next=4,Promise.all([mn.runTweenAsync(S(this.sprite.node).to(.2,{scale:i},{easing:"backOut"}),n),mn.runTweenAsync(S(this.glowOpacity.node).to(.2,{scale:i},{easing:"backOut"}),n)]);case 4:this.sprite.node.setScale(i),this.glowOpacity.node.setScale(i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"startShaking",value:function(){var e=this,t=this.node.position.clone();this.shakingTween={ogPos:t,tw:S({}).to(.1,{},{onUpdate:function(n,a){if(a){var i=t.x+10*(a-.5);e.node.position=new j(i,t.y,t.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(a=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.sprite.node.scale.clone().multiplyScalar(1.1),e.next=3,Promise.all([mn.runTweenAsync(S(this.sprite.node).to(.2,{scale:n},{easing:"cubicInOut"}),t),mn.runTweenAsync(S(this.glowOpacity.node).to(.2,{scale:n}),t),mn.runTweenAsync(S(this.glowOpacity).to(.5,{opacity:255}),t)]);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"explode",value:(n=Te(Se().mark((function e(t){var n,a,i,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(8,8,8),a=function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.circle.opacity=255,r.circle.node.setScale(j.ZERO),e.next=4,Promise.all([mn.runTweenAsync(S(r.circle).to(.3,{opacity:0}),t),mn.runTweenAsync(S(r.circle.node).to(.3,{scale:n},{easing:"cubicOut"}),t)]);case 4:r.circle.opacity=0,r.circle.node.scale=n;case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),i=function(){var e=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([mn.runTweenAsync(S(r.glowOpacity.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),t),mn.runTweenAsync(S(r.sprite.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),t)]);case 2:r.sprite.node.setScale(j.ZERO),r.glowOpacity.node.setScale(j.ZERO);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=5,Promise.all([this.explodeParticles(t),a(),i()]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"explodeParticles",value:(t=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.aborted){e.next=2;break}return e.abrupt("return");case 2:return this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem(),e.next=6,mn.waitTweenAsync(1);case 6:this.explosionParticles.node.active=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),s}(f)).prototype,"sprite",[jU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sH=Qe(rH.prototype,"glowOpacity",[YU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lH=Qe(rH.prototype,"explosionParticles",[XU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uH=Qe(rH.prototype,"circle",[JU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cH=Qe(rH.prototype,"uiOpacity",[QU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qe(rH.prototype,"startingOffsetX",[ZU],Object.getOwnPropertyDescriptor(rH.prototype,"startingOffsetX"),rH.prototype),Qe(rH.prototype,"startingOffsetY",[$U],Object.getOwnPropertyDescriptor(rH.prototype,"startingOffsetY"),rH.prototype),hH=Qe(rH.prototype,"endingOffsetX",[eH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pH=Qe(rH.prototype,"endingOffsetY",[tH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dH=Qe(rH.prototype,"startingScale",[nH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),fH=Qe(rH.prototype,"endingScale",[aH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),iH=rH))||iH);n._RF.pop(),n._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var jH,YH,XH,JH,QH,ZH,$H,eq,tq,nq,aq,iq,rq,oq,sq=a.ccclass,lq=a.property,uq=a.requireComponent,cq=GameCore.Events,hq=globalThis.game,pq=hq.event,dq=hq.player;EH=sq("StarChestScreen"),AH=uq(cF),TH=lq(eA),xH=lq(u),RH=lq(p),PH=lq(y),IH=lq(KH),_H=lq(M),LH=lq(Ok),OH=lq(u),EH(DH=AH((NH=Qe((MH=function(e){_e(o,e);var t,n,a,i,r=Ge(o);function o(){var e;xe(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=r.call.apply(r,[this].concat(n)),"starProgressBar",NH,Fe(e)),Je(e,"buttonLabel",FH,Fe(e)),Je(e,"button",BH,Fe(e)),Je(e,"chestAnimation",GH,Fe(e)),Je(e,"starChest",zH,Fe(e)),Je(e,"chestUnlockFXMask",UH,Fe(e)),Je(e,"skipOverlay",HH,Fe(e)),Je(e,"messageLabel",qH,Fe(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(o,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){pq.on(cq.OPENING_SCREEN,this.handleOpeningScreen),pq.on(cq.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){pq.off(cq.OPENING_SCREEN,this.handleOpeningScreen),pq.off(cq.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit($i.HIDE_UI);var e=dq.getGameData();if(e){var t=e.stars;this.numChestAvailable=Math.floor(t/20),this.starProgressBar.setRange(t,20),this.buttonLabel.string=this.numChestAvailable?"Open":"Continue",this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.button.interactable=!0,this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){pq.emit(cq.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit($i.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(i=Te(Se().mark((function e(){var t,n,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.numChestAvailable){e.next=3;break}return this.close(),e.abrupt("return");case 3:if(ga.turnDownMusic(),t=dq.getGameData()){e.next=7;break}return e.abrupt("return");case 7:return this.button.interactable=!1,n=t.stars,dq.setGameData({stars:t.stars-20*this.numChestAvailable}),a=new ui,e.next=13,this.skipOverlay.open({opacity:200,onSkip:function(){return a.abort()}});case 13:return e.next=15,this.handleUnlockAnimation(n,t.stars,a);case 15:return e.next=17,this.skipOverlay.close();case 17:ga.turnUpMusic(),x.emit(_s),this.close();case 20:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(a=Te(Se().mark((function e(t,n,a){var i,r,o,s,l,u=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.starChest.moveToCenter(a),this.fadeInChestUnlockFX(a)]);case 2:return this.chestAnimation.stop(),this.starChest.startShaking(),ga.playSound(Zn.STAR_CHEST_DRUM_ROLL,{loop:!0}),e.next=7,mn.waitTweenAsync(0);case 7:return i=t,r=this.numChestAvailable,o=function(e){return u.numChestAvailable>2?1-e/u.numChestAvailable:.35*(1-e/u.numChestAvailable)},s=function(e){i-e>=20&&(i=e,r--,u.starChest.scale(o(r),a),ga.playSound(Zn.STAR_CHEST_OPEN))},e.next=13,Promise.all([this.starProgressBar.animateTo(n,a,s)]);case 13:return e.next=15,mn.waitTweenAsync(1,a);case 15:return this.starChest.stopShaking(),e.next=18,this.starChest.glow(a);case 18:return ga.stopSound(Zn.STAR_CHEST_DRUM_ROLL),l=Ts*this.numChestAvailable,this.node.scene.emit($i.ADD_COINS,{coins:l,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:a}}),e.next=23,this.starChest.explode(a);case 23:return e.next=25,mn.waitTweenAsync(1,a);case 25:return e.next=27,Promise.all([this.fadeOutChestUnlockFX(a)]);case 27:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(n=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.chestUnlockFXMask.node.active=!0,e.next=3,mn.runTweenAsync(S(this.chestUnlockFXMask).to(.5,{opacity:150}),t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(t=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runTweenAsync(S(this.chestUnlockFXMask).to(.3,{opacity:0}),t);case 2:this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),o}(f)).prototype,"starProgressBar",[TH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FH=Qe(MH.prototype,"buttonLabel",[xH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BH=Qe(MH.prototype,"button",[RH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GH=Qe(MH.prototype,"chestAnimation",[PH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zH=Qe(MH.prototype,"starChest",[IH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UH=Qe(MH.prototype,"chestUnlockFXMask",[_H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HH=Qe(MH.prototype,"skipOverlay",[LH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qH=Qe(MH.prototype,"messageLabel",[OH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DH=MH))||DH);n._RF.pop(),n._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);var fq,vq,yq,mq,gq,bq=a.ccclass,wq=a.property,kq=a.requireComponent,Sq=GameCore.Events,Cq=globalThis.game.event;jH=bq("StartLevelScreen"),YH=kq(cF),XH=wq(i),JH=wq(i),QH=wq(i),ZH=wq(i),$H=wq(p),jH(eq=YH((nq=Qe((tq=function(e){_e(n,e);var t=Ge(n);function n(){var e;xe(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return Je(e=t.call.apply(t,[this].concat(i)),"playButton",nq,Fe(e)),Je(e,"goalText",aq,Fe(e)),Je(e,"levelText",iq,Fe(e)),Je(e,"missionText",rq,Fe(e)),Je(e,"playButtonComponent",oq,Fe(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StartLevelScreen: screen not found");e.validateEventPayload(t)&&(e.playButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Cq.on(Sq.OPENING_SCREEN,this.handleOpeningScreen),Cq.on(Sq.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Cq.off(Sq.OPENING_SCREEN,this.handleOpeningScreen),Cq.off(Sq.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){var t=null!=e?e:{},n=t.screenName,a=t.screenData;return n===this.node.name&&(null!=a&&a.level&&(this.levelId=a.level),null!=a&&a.mission&&(this.mission=a.mission),!0)}},{key:"open",value:function(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit($i.HIDE_UI)}},{key:"close",value:function(){this.playButtonComponent.interactable=!1,Cq.emit(Sq.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit($i.SHOW_UI)}},{key:"updateComponents",value:function(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}},{key:"updateGoalText",value:function(){var e=this.mission.mission;this.goalText.getComponent(u).string=e>1?"Goals":"Goal"}},{key:"updateLevelText",value:function(){this.levelText.getComponent(u).string="Level ".concat(this.levelId)}},{key:"updateDescriptionText",value:function(){this.missionText.getComponent(u).string=this.mission.description}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedPlay",value:function(){this.node.scene.emit($i.GAME_START),this.close()}}]),n}(f)).prototype,"playButton",[XH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aq=Qe(tq.prototype,"goalText",[JH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iq=Qe(tq.prototype,"levelText",[QH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rq=Qe(tq.prototype,"missionText",[ZH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oq=Qe(tq.prototype,"playButtonComponent",[$H],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eq=tq))||eq);n._RF.pop(),n._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var Eq,Aq,Tq,xq,Rq,Pq,Iq,_q,Lq,Oq,Dq,Mq,Nq,Fq,Bq,Gq,zq,Uq,Hq,qq,Vq,Wq,Kq,jq,Yq,Xq,Jq=a.ccclass,Qq=a.property,Zq=(fq=Jq("TournamentLeaderSkeleton"),vq=Qq(i),fq((gq=Qe((mq=function(e){_e(i,e);var t,n,a=Ge(i);function i(){var e;xe(this,i);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Je(e=a.call.apply(a,[this].concat(n)),"container",gq,Fe(e)),e}return Pe(i,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"hide",value:(n=Te(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Te(Se().mark((function e(t,n){var a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,a=this.container.position.clone(),this.container.position=new j(a.x,a.y-100,a.z),(i=S(this.node).delay(t)).to(.2,{scale:j.ONE},{easing:"elasticOut"}),(r=S(this.container).delay(t)).to(.2,{position:a},{easing:"backOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),e.next=13,Promise.all([mn.runTweenAsync(i,n),mn.runTweenAsync(r,n),mn.runTweenAsync(o,n)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),i}(f)).prototype,"container",[vq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yq=mq))||yq);n._RF.pop(),n._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var $q,eV=a.ccclass,tV=a.property,nV=a.requireComponent,aV=GameCore.Events,iV=GameCore.Utils.Object,rV=globalThis.game,oV=rV.event,sV=rV.storage,lV=rV.player,uV=rV.leaderboard;Eq=eV("TournamentDetailScreen"),Aq=nV(cF),Tq=tV(u),xq=tV(u),Rq=tV(u),Pq=tV(vI),Iq=tV(s),_q=tV({type:i,group:"Buttons"}),Lq=tV({type:i,group:"Buttons"}),Oq=tV({type:i,group:"Buttons"}),Dq=tV({type:[Zq]}),Mq=tV({type:[T]}),Nq=tV(Uw),Eq(Fq=Aq((Gq=Qe((Bq=function(e){_e(f,e);var t,n,a,i,r,o,s,l,u,c,h,p,d=Ge(f);function f(){var e;xe(this,f);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Je(e=d.call.apply(d,[this].concat(n)),"titleLabel",Gq,Fe(e)),Je(e,"timeLabel",zq,Fe(e)),Je(e,"playerCountLabel",Uq,Fe(e)),Je(e,"tournamentLeaders",Hq,Fe(e)),Je(e,"viewport",qq,Fe(e)),Je(e,"playButton",Vq,Fe(e)),Je(e,"continueButton",Wq,Fe(e)),Je(e,"replayButton",Kq,Fe(e)),Je(e,"leaderSkeletons",jq,Fe(e)),Je(e,"banners",Yq,Fe(e)),Je(e,"paperConfetti",Xq,Fe(e)),e.animAbortSignal=null,e.fetchAbortController=null,e.leadersPayload=null,e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("TournamentDetailScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(f,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(cF),this.tournamentScrollView=this.tournamentLeaders.node.getComponent(le),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){Ct.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){oV.on(aV.OPENING_SCREEN,this.handleOpeningScreen),oV.on(aV.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){oV.off(aV.OPENING_SCREEN,this.handleOpeningScreen),oV.off(aV.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"updateVisibility",value:function(){this.tournamentLeaders.updateVisibility()}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function(){if(this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit($i.HIDE_UI),this.tournamentScrollView.node.on(le.EventType.SCROLLING,this.updateVisibility,this),null!==this.animAbortSignal)throw new Error("TournamentContent: TournamentContent is already loading. Please handle cancelling gracefully.");this.animAbortSignal=new ui,this.updateInfo(this.animAbortSignal)}},{key:"close",value:function(){iu.closeTournamentDetailScreen(),this.node.scene.emit($i.SHOW_UI),this.tournamentScrollView.node.off(le.EventType.SCROLLING,this.updateVisibility,this),this.cleanup()}},{key:"cleanup",value:function(){var e,t;null===(e=this.fetchAbortController)||void 0===e||e.abort(),null===(t=this.animAbortSignal)||void 0===t||t.abort(),this.animAbortSignal=null,this.fetchAbortController=null,this.tournamentLeaders.removeLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(p=Te(Se().mark((function e(t){var n,a,i,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b,w,k,S;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=this.payload)||void 0===n||null===(n=n.screenData)||void 0===n?void 0:n.tournament){e.next=3;break}return e.abrupt("return");case 3:return(o=JSON.parse(r)).id=o.id.toString(),this.tournamentPayload=o,s=this.tournamentPayload,l=s.endTime,u=s.payload,c=s.title,h=u.leaderboardId,p=void 0===h?"":h,d=u.themeId,this.updateTitle(c),this.updateEndTime(l),this.updateTournamentBanner(d),f=sV.getStorage("tournament"),v=f.previousScore,y=f.previousRank,m=f.animateTournamentLeader,this.updateButtonsVisibility(m),e.next=15,this.showLoading(t);case 15:return e.next=17,this.getLeadersPayload(p);case 17:if(this.leadersPayload=e.sent,this.leadersPayload){e.next=22;break}return this.updatePlayerCount(0),this.hideLoading(t),e.abrupt("return");case 22:return g=this.leadersPayload,b=g.player,w=g.leaders,this.updatePlayerCount(w.length),k=null!==(a=null==b?void 0:b.score)&&void 0!==a?a:0,S=null!==(i=null==b?void 0:b.rank)&&void 0!==i?i:0,b&&m&&v&&v<k&&y&&y!==S&&(w.find((function(e){return e.playerId===b.playerId})).score=v),e.next=29,this.hideLoading(t);case 29:return this.tournamentLeaders.updateData(w),e.next=32,this.runShowUpAnimation(t);case 32:if(m){e.next=34;break}return e.abrupt("return");case 34:return sV.setStorageData("tournament","animateTournamentLeader",!1),e.next=37,this.runPlayerRankChangeAnimation(t,k);case 37:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"updateTournamentBanner",value:function(e){e?this.activateThemeBanner(e):this.activateThemeBanner(gl.SUMMER)}},{key:"activateThemeBanner",value:function(e){var t=!1;this.banners.forEach((function(n){n.node.active=n.node.name.toLowerCase()===e,n.node.active&&(t=!0)})),t||this.banners.forEach((function(e){e.node.active=e.node.name.toLowerCase()===gl.SUMMER}))}},{key:"showLoading",value:(h=Te(Se().mark((function e(t){var n,a=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:0,e.next=3,Promise.all([this.leaderSkeletons.map((function(e,a){return e.show(a*n,t)}))]);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"hideLoading",value:(c=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.leaderSkeletons.map((function(e){return e.hide(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"runShowUpAnimation",value:(u=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tournamentLeaders.showLeaders(t);case 2:if(n=this.tournamentLeaders.getPlayerLeader()){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this.scrollToLeader(n,1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(l=Te(Se().mark((function e(t,n){var a,i,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.tournamentLeaders.getLeaderData(),i=a.find((function(e){return e.playerId===lV.getPlayerId()}))){e.next=4;break}return e.abrupt("return");case 4:if(r=i.score,o=i.rank,r!==n){e.next=7;break}return e.abrupt("return");case 7:if(i.score=n,a.sort((function(e,t){return t.score-e.score})),a.forEach((function(e,t){e.rank=t+1})),s=this.tournamentLeaders.getPlayerLeader()){e.next=13;break}return e.abrupt("return");case 13:if(l=this.tournamentLeaders.getLeaderByRank(i.rank)){e.next=16;break}return e.abrupt("return");case 16:return this.tournamentLeaders.layout.enabled=!1,s.node.setParent(this.node,!0),e.next=20,s.runScaleAnimation(t,1.1,.5);case 20:return i.rank<=10&&ga.playSound(Zn.STAR_CHEST_DRUM_ROLL),u=Math.min(.5*(o-i.rank),2),c=[s.runUpdateDataAnimation(o,i.rank,r,i.score,u),this.scrollToLeader(l,u)],h=this.viewport.contentSize.height,p=this.viewport.getBoundingBoxToWorld(),d=this.tournamentScrollView.getMaxScrollOffset().y,f=-l.node.position.y-h/2,v=j.ZERO,f<0?v=new j(s.node.worldPosition.x,p.yMax+l.node.position.y,s.node.worldPosition.z):this.tournamentScrollView.getScrollOffset().y>=d-5&&(v=f<d?new j(s.node.worldPosition.x,p.center.y,s.node.worldPosition.z):l.node.worldPosition),v.equals(j.ZERO)||c.push(s.runWorldPositionAnimation(v,u)),e.next=32,Promise.all(c);case 32:return ga.stopSound(Zn.STAR_CHEST_DRUM_ROLL),e.next=35,Promise.all([s.runScaleAnimation(t,1,.25),s.node.setParent(this.tournamentLeaders.layout.node,!0),s.node.setSiblingIndex(i.rank-1),this.tournamentLeaders.runUpdateLeadersRankAnimation(i.rank,o),this.runPaperConfettiEffect(i.rank)]);case 35:this.tournamentLeaders.layout.enabled=!0,this.tournamentLeaders.layout.updateLayout();case 37:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"runPaperConfettiEffect",value:function(e){e>10||(this.paperConfetti.runEffect(),ga.playSound(Zn.LEADERBOARD_TRIUMPH))}},{key:"scrollToLeader",value:(s=Te(Se().mark((function e(t,n){var a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.tournamentLeaders.uiTransform.contentSize,i=new J(0,-t.node.position.y-a.height/2),r=this.tournamentScrollView.getScrollOffset().clone(),i.y=Math.max(i.y,0),r.y=Math.max(r.y,0),o=i.y-r.y,!(Math.abs(o)<5)){e.next=8;break}return e.abrupt("return");case 8:return this.tournamentScrollView.scrollToOffset(i,n),e.abrupt("return",mn.waitTweenAsync(n));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"updateTitle",value:function(e){e&&(this.titleLabel.string=e)}},{key:"updateEndTime",value:function(e){var t=GameCore.Utils.Time.getRelativeTime(e);t=(t=t.replace("seconds","secs").replace("second","sec")).replace("minutes","mins").replace("minute","min"),this.timeLabel.string="Ends ".concat(t)}},{key:"updatePlayerCount",value:function(e){var t=GameCore.Utils.Number.getShortNumber(e,3);this.playerCountLabel.string="".concat(t," ")+(e>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"getLeadersPayload",value:(o=Te(Se().mark((function e(t){var n,a,i,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=uV.getLeaderboardName(t)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,uV.requestLeaderboardAsync(n,0);case 5:if(a=uV.getLeaderboard(n)){e.next=8;break}return e.abrupt("return",null);case 8:for(i=Object.values(a.leaders),r=lV.getPlayerId(),o={leaders:[],player:void 0,isPlayerInTournament:!1},s=0,l=i;s<l.length;s++)(u=l[s]).playerId===r?(o.player=u,o.isPlayerInTournament=!0,o.leaders.push(u)):o.leaders.push(u);return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(e){this.playButton.active=!e,this.continueButton.active=e,this.replayButton.active=e}},{key:"handleOnPlay",value:(r=Te(Se().mark((function e(){var t,n,a,i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.tournamentPayload.id||"",!gv.validateTournamentExpired(t)){e.next=7;break}return this.close(),this.node.scene.emit(tl.RELOAD_TOURNAMENT),iu.showNotificationScreen("Tournament has ended",2),e.abrupt("return");case 7:return e.prev=7,iu.showLoadingNotificationScreen(),i=null===(n=this.leadersPayload)||void 0===n||null===(n=n.player)||void 0===n?void 0:n.score,r=null===(a=this.leadersPayload)||void 0===a||null===(a=a.player)||void 0===a?void 0:a.rank,sV.setStorageData("tournament","previousScore",i),sV.setStorageData("tournament","previousRank",r),e.next=15,this.processJoinTournament();case 15:e.next=34;break;case 17:if(e.prev=17,e.t0=e.catch(7),!iV.hasOwn(e.t0,"code")||"USER_INPUT"!==e.t0.code){e.next=22;break}return iu.closeNotificationScreen(),e.abrupt("return");case 22:return e.prev=22,e.next=25,this.processContinueTournament();case 25:e.next=34;break;case 27:if(e.prev=27,e.t1=e.catch(22),!iV.hasOwn(e.t1,"code")||"USER_INPUT"!==e.t1.code){e.next=32;break}return iu.closeNotificationScreen(),e.abrupt("return");case 32:console.error("processPlayButtonPressed",e.t1),iu.showNotificationScreen("Sorry, you cannot join\nat this time.",2);case 34:case"end":return e.stop()}}),e,this,[[7,17],[22,27]])}))),function(){return r.apply(this,arguments)})},{key:"processJoinTournament",value:(i=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.joinTournamentAsync();case 3:Vl.switchScene(Qs,{isMatchStartFromLoader:!0,level:1}),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.warn("processJoinTournament",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return i.apply(this,arguments)})},{key:"processContinueTournament",value:(a=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.continueTournamentAsync();case 3:Vl.switchScene(Qs,{isMatchStartFromLoader:!0,level:1}),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.warn("processContinueTournament",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return a.apply(this,arguments)})},{key:"joinTournamentAsync",value:(n=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.tournamentPayload.id||"",e.next=3,Dl.joinTournamentAsync(t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"continueTournamentAsync",value:(t=Te(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null!==(t=GameSDK.context.getID())&&void 0!==t?t:"",e.next=3,Dl.continueTournamentAsync(n);case 3:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var e,t,n=(null!==(e=null===(t=this.payload)||void 0===t?void 0:t.screenData)&&void 0!==e?e:{}).tournamentContextType;switch(void 0===n?"tournament_start":n){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}}]),f}(f)).prototype,"titleLabel",[Tq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zq=Qe(Bq.prototype,"timeLabel",[xq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uq=Qe(Bq.prototype,"playerCountLabel",[Rq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hq=Qe(Bq.prototype,"tournamentLeaders",[Pq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qq=Qe(Bq.prototype,"viewport",[Iq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vq=Qe(Bq.prototype,"playButton",[_q],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wq=Qe(Bq.prototype,"continueButton",[Lq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kq=Qe(Bq.prototype,"replayButton",[Oq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jq=Qe(Bq.prototype,"leaderSkeletons",[Dq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yq=Qe(Bq.prototype,"banners",[Mq],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xq=Qe(Bq.prototype,"paperConfetti",[Nq],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fq=Bq))||Fq);n._RF.pop(),n._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,a.ccclass)("TournamentLeader")($q=function(e){_e(n,e);var t=Ge(n);function n(){return xe(this,n),t.apply(this,arguments)}return Pe(n)}(KP));n._RF.pop(),n._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var cV=GameCore.Events,hV=globalThis.game,pV=hV.event,dV=hV.monitorError,fV=function(){function e(){var t=this;xe(this,e),this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=function(){if(!t.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void(null==dV||dV.sendException(new Error("Core: Booting callback is not set")));console.info(" Core: Boot"),t.callbackCoreBooting(),t.callbackCoreBooting=null},this.handleWhenCoreStarting=function(){if(!t.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void(null==dV||dV.sendException(new Error("Core: Starting callback is not set")));console.info(" Core: Starting"),t.callbackCoreStarting(),t.callbackCoreStarting=null},this.handleWhenCoreReady=function(){if(!t.callbackCoreReady)return console.error("Core: Ready callback is not set"),void(null==dV||dV.sendException(new Error("Core: Ready callback is not set")));console.info(" Core: Ready"),t.callbackCoreReady(),t.callbackCoreReady=null}}return Pe(e,[{key:"init",value:function(){this.listenEvents(),console.info("Core Manager: Initialized")}},{key:"listenEvents",value:function(){pV.once(cV.CORE_BOOTING,this.handleWhenCoreBooting),pV.once(cV.CORE_STARTING,this.handleWhenCoreStarting),pV.once(cV.CORE_READY,this.handleWhenCoreReady)}},{key:"requestStart",value:function(){pV.emit(cV.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(e){this.callbackCoreBooting=e,pV.getEventEmitCount(cV.CORE_BOOTING)>0&&(pV.off(cV.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}},{key:"onCoreStart",value:function(e){this.callbackCoreStarting=e,pV.getEventEmitCount(cV.CORE_STARTING)>0&&(pV.off(cV.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}},{key:"onCoreReady",value:function(e){this.callbackCoreReady=e,pV.getEventEmitCount(cV.CORE_READY)>0&&(pV.off(cV.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}]),e}();n._RF.pop(),n._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var vV=GameCore,yV=vV.Configs,mV=vV.Utils,gV=yV.GameEngine,bV=mV.Valid,wV=function(){function e(){var t=this;xe(this,e),this.overrideSettings=function(){ve.overrideSettings(ye.Category.ENGINE,"debug",bV.isDebugger())},this.handleResizeView=function(e){se.instance.resizeWithBrowserSize(!1);var n=e.width,a=e.height;t.resizeView(n,a)},this.handleViewResized=function(e){var t=e.width,n=e.height;se.instance.resizeWithBrowserSize(!0),console.info(" New View Size",{width:t,height:n})}}return Pe(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){x.on(Sn,this.handleResizeView),x.on(Cn,this.handleViewResized)}},{key:"setupAutoAtlas",value:function(){pe.instance.cacheAsset=!0}},{key:"setupDynamicAtlas",value:function(){switch(K.os){case K.OS.IOS:this.setupDynamicAtlasForIOS();break;case K.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(e){var t=e.Enabled,n=e.AutoAtlasSize,a=e.MaxAtlasCount,i=e.MaxAtlasSize,r=e.MaxFrameSize;if(de.instance.enabled=t,de.instance.textureSize=i,de.instance.maxFrameSize=r,de.instance.maxAtlasCount=a,de.instance.textureBleeding=!0,n){var o=this.getMaxTextureSize();if(!o)return;de.instance.textureSize=o}}},{key:"getMaxTextureSize",value:function(){if(!d.root)return-1;var e=d.root.device.capabilities;return e.maxTextureSize>8192?8192:e.maxTextureSize}},{key:"setupDynamicAtlasForIOS",value:function(){var e=gV.DynamicAtlas.IOS;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForAndroid",value:function(){var e=gV.DynamicAtlas.Android;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForDesktop",value:function(){var e=gV.DynamicAtlas.Desktop;this.setDynamicAtlas(e)}},{key:"setupBatcherLimit",value:function(){fe.BATCHER2D_MEM_INCREMENT=288,fe.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(e,t){var n,a=window.devicePixelRatio,i=a>=2?2/a:1,r=e*a*i,o=t*a*i;null===(n=d.root)||void 0===n||n.resize(r,o),B.windowSize=new G.Size(r,o),x.emit(Cn,{width:r,height:o})}}]),e}();n._RF.pop();var kV,SV=new(function(){function e(){xe(this,e),this._registry={},this._moduleCache={}}return Pe(e,[{key:"define",value:function(e,t,n){this._registry[e]={factory:t,resolveMap:n}}},{key:"require",value:function(e){return this._require(e)}},{key:"throwInvalidWrapper",value:function(e,t){throw new Error("Module '".concat(e,"' imported from '").concat(t,"' is expected be an ESM-wrapped CommonJS module but it doesn't."))}},{key:"_require",value:function(e,t){var n=this._moduleCache[e];if(n)return n.exports;var a={id:e,exports:{}};return this._moduleCache[e]=a,this._tryModuleLoad(a,e),a.exports}},{key:"_resolve",value:function(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}},{key:"_resolveFromInfos",value:function(e,t){var n,a;return e in cjsInfos?e:t&&null!==(n=null===(a=cjsInfos[t])||void 0===a?void 0:a.resolveCache[e])&&void 0!==n?n:void 0}},{key:"_tryModuleLoad",value:function(e,t){var n=!0;try{this._load(e,t),n=!1}finally{n&&delete this._moduleCache[t]}}},{key:"_load",value:function(e,t){var n=this._loadWrapper(t),a=n.factory,i=n.resolveMap,r=this._createRequire(e),o=i?this._createRequireWithResolveMap("function"==typeof i?i():i,r):r;a(e.exports,o,e)}},{key:"_loadWrapper",value:function(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}},{key:"_loadHostProvidedModules",value:function(e){return{factory:function(t,n,a){if("undefined"==typeof require)throw new Error("Current environment does not provide a require() for requiring '".concat(e,"'."));try{a.exports=require(e)}catch(t){throw new Error("Exception thrown when calling host defined require('".concat(e,"')."),{cause:t})}}}}},{key:"_createRequire",value:function(e){var t=this;return function(n){return t._require(n,e)}}},{key:"_createRequireWithResolveMap",value:function(e,t){return function(n){var a=e[n];if(a)return t(a);throw new Error("Unresolved specifier "+n)}}},{key:"_throwUnresolved",value:function(e,t){throw new Error("Unable to resolve ".concat(e," from ").concat(parent,"."))}}]),e}());function CV(e){return(CV="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var EV="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";SV.define(EV,(function(e,t,n,a,i){!function(t,a){"object"===CV(e)&&void 0!==n?n.exports=a():"function"==typeof define&&define.amd?define(a):t.ResizeObserver=a()}(this,(function(){var e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,a){return e[0]===t&&(n=a,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),a=this.__entries__[n];return a&&a[1]},t.prototype.set=function(t,n){var a=e(this.__entries__,t);~a?this.__entries__[a][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,a=e(n,t);~a&&n.splice(a,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,a=this.__entries__;n<a.length;n++){var i=a[n];e.call(t,i[1],i[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,n="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),a="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var i=["top","right","bottom","left","width","height","size","weight"],r="undefined"!=typeof MutationObserver,o=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,i=!1,r=0;function o(){n&&(n=!1,e()),i&&l()}function s(){a(o)}function l(){var e=Date.now();if(n){if(e-r<2)return;i=!0}else n=!0,i=!1,setTimeout(s,t);r=e}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),r?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;i.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(e,t){for(var n=0,a=Object.keys(t);n<a.length;n++){var i=a[n];Object.defineProperty(e,i,{value:t[i],enumerable:!1,writable:!1,configurable:!0})}return e},l=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||n},u=v(0,0,0,0);function c(e){return parseFloat(e)||0}function h(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+c(e["border-"+n+"-width"])}),0)}function p(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return u;var a=l(e).getComputedStyle(e),i=function(e){for(var t={},n=0,a=["top","right","bottom","left"];n<a.length;n++){var i=a[n],r=e["padding-"+i];t[i]=c(r)}return t}(a),r=i.left+i.right,o=i.top+i.bottom,s=c(a.width),p=c(a.height);if("border-box"===a.boxSizing&&(Math.round(s+r)!==t&&(s-=h(a,"left","right")+r),Math.round(p+o)!==n&&(p-=h(a,"top","bottom")+o)),!function(e){return e===l(e).document.documentElement}(e)){var d=Math.round(s+r)-t,f=Math.round(p+o)-n;1!==Math.abs(d)&&(s-=d),1!==Math.abs(f)&&(p-=f)}return v(i.left,i.top,s,p)}var d="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof l(e).SVGGraphicsElement}:function(e){return e instanceof l(e).SVGElement&&"function"==typeof e.getBBox};function f(e){return t?d(e)?function(e){var t=e.getBBox();return v(0,0,t.width,t.height)}(e):p(e):u}function v(e,t,n,a){return{x:e,y:t,width:n,height:a}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=f(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),m=function(e,t){var n,a,i,r,o,l,u,c=(a=(n=t).x,i=n.y,r=n.width,o=n.height,l="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(l.prototype),s(u,{x:a,y:i,width:r,height:o,top:i,right:a+r,bottom:o+i,left:a}),u);s(this,{target:e,contentRect:c})},g=function(){function t(t,n,a){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=a}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new m(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),b="undefined"!=typeof WeakMap?new WeakMap:new e,w=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=o.getInstance(),a=new g(t,n,this);b.set(this,a)};return["observe","unobserve","disconnect"].forEach((function(e){w.prototype[e]=function(){var t;return(t=b.get(this))[e].apply(t,arguments)}})),void 0!==n.ResizeObserver?n.ResizeObserver:w})),kV=n.exports}),{}),SV.require(EV),n._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var AV=Dn,TV=Mn,xV=TV.Portrait,RV=TV.Landscape,PV=GameCore.Utils.Function,IV=function(){function e(){var t=this;xe(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(e){console.info(" View resize by system"),window.devicePixelRatio=e||window.devicePixelRatio,t.setupOrientationByScreenSize(),t.resizeGameView()},this.handleViewResize=PV.debounce((function(){console.info(" View resize by window"),t.setupOrientationByScreenSize(),t.resizeGameView()}),200),this.handleBodyResize=PV.debounce((function(){console.info(" View resize by body"),t.resizeGameDiv(),t.setupOrientationByScreenSize(),t.resizeGameView()}),200)}return Pe(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),x.emit(En),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){K.isBrowser?(B.on("window-resize",this.handleViewResize,this),B.on("orientation-change",this.handleViewResize,this)):K.isMobile?window.addEventListener("resize",this.handleViewResize,{capture:!1,passive:!0}):console.warn("LayoutManager: Not support this platform"),x.on(En,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){new kV(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){se.instance.resizeWithBrowserSize(!0),se.instance.setOrientation(fe.ORIENTATION_AUTO),se.instance.setResolutionPolicy(me.ContentStrategy.FIXED_WIDTH),se.instance.setResolutionPolicy(me.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=se.instance.getResolutionPolicy()}},{key:"setupOrientationByScreenSize",value:function(){var e=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(me.ContentStrategy.FIXED_WIDTH),e<1?this.setPortraitView():this.setLandscapeView()}},{key:"resizeGameDiv",value:function(){var e=document.getElementById("GameDiv");if(e){var t=Za.getScreenWidthCss(),n=Za.getScreenHeightCss();e.style.width="".concat(t,"px"),e.style.height="".concat(n,"px")}}},{key:"resizeGameView",value:function(){var e=Za.getScreenWidthCss(),t=Za.getScreenHeightCss();x.emit(Sn,{width:e,height:t})}},{key:"setPortraitView",value:function(){var e=xV.WIDTH,t=xV.HEIGHT;this.currentLayout=AV.Portrait,this.changeDesignResolutionSize(e,t)}},{key:"setLandscapeView",value:function(){var e=RV.WIDTH,t=RV.HEIGHT;e=xV.WIDTH,t=xV.HEIGHT,this.resolutionPolicy.setContentStrategy(me.ContentStrategy.EXACT_FIT),this.currentLayout=AV.Landscape,this.changeDesignResolutionSize(e,t)}},{key:"changeDesignResolutionSize",value:function(e,t){se.instance.setDesignResolutionSize(e,t,this.resolutionPolicy),this.currentLayout=Nn,x.emit(An,AV.Landscape),console.info(" Change layout to",this.currentLayout)}},{key:"getScreenRatio",value:function(){return Za.getScreenWidthCss()/Za.getScreenHeightCss()}}]),e}();n._RF.pop(),n._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var _V=GameCore,LV=_V.Utils,OV=_V.Dtos,DV=LV.Valid,MV=["code","cols","encoding","idSize","rows"],NV=["addRandomTilesPerMove","maxSpaceOfPair"],FV=function(){function e(){xe(this,e)}return Pe(e,[{key:"init",value:function(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function(){var e=OV.Match;e.CustomData.addDefaultData(js),e.CustomData.addValidateFunction("score",(function(e){if(!DV.isNumber(e)||e<0)throw new Error("score ".concat(e," is invalid"))}))}},{key:"setupMatchData",value:function(){var e=this,t=OV.Match;t.Data.addDefaultData(Bs),t.Data.addValidateFunction("extraData",(function(t){if(null!=t){if(!DV.isObject(t))throw new Error("extraData ".concat(t," must be a record of string keys"));var n=t,a=Object.keys(n);if(!a.includes("level"))throw new Error("extraData.level is missing");if(!DV.isNumber(n.level))throw new Error("extraData.level ".concat(n.level," must be a number"));if(!a.includes("fen"))throw new Error("extraData.fen is missing");if(e.validateFen(n.fen),!a.includes("gravity"))throw new Error("extraData.gravity is missing");if(!DV.isString(n.gravity))throw new Error("extraData.gravity ".concat(n.gravity," must be a string"));if(!a.includes("rules"))throw new Error("extraData.rules is missing");if(e.validateLevelRules(n.rules),!a.includes("time"))throw new Error("extraData.time is missing");if(!DV.isNumber(n.time))throw new Error("extraData.time ".concat(n.time," must be a number"))}}))}},{key:"validateFen",value:function(e){if(!DV.isObject(e))throw new Error("extraData.fen ".concat(e," must be a record of string keys"));var t=this.validateKeys(e,MV);if(!DV.isNumber(t.idSize))throw new Error("fen.idSize must be a number");if(!DV.isString(t.code))throw new Error("fen.code must be a string");if(!DV.isNumber(t.rows))throw new Error("fen.rows must be a number");if(!DV.isNumber(t.cols))throw new Error("fen.cols must be a number");if(!DV.isObject(t.encoding))throw new Error("fen.encoding must be a record of string keys");var n=this.validateKeys(t.encoding,Object.values(qu));Object.entries(n).forEach((function(e){var t=Ve(e,2),n=t[0],a=t[1];if(!DV.isString(a))throw new Error("fen.encoding.".concat(n," ").concat(a," must be a string"))}))}},{key:"validateLevelRules",value:function(e){if(!DV.isObject(e))throw new Error("extraData.rules ".concat(e," must be a record of string keys"));var t=this.validateKeys(e,NV);if(!DV.isNumber(t.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!DV.isNumber(t.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function(e,t){return Object.keys(e).forEach((function(e){if(!t.includes(e))throw new Error("Key ".concat(e," is missing"))})),e}}]),e}();n._RF.pop(),n._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var BV=GameCore,GV=BV.Utils,zV=BV.Dtos,UV=GV.Valid,HV=globalThis.game.player,qV=function(){function e(){xe(this,e)}return Pe(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var e=zV.Player;e.Data.addDefaultData(Ys),e.GameData.addDefaultData(Hs),e.GameData.addValidateFunction("stars",(function(e){if(!UV.isNumber(e)||e<0)throw new Error("stars ".concat(e," is invalid"))})),e.GameData.addValidateFunction("totalLevel",(function(e){if(!UV.isNumber(e)||e<1)throw new Error("totalLevel ".concat(e," is invalid"))})),e.GameData.addValidateFunction("levelVersion",(function(e){if(!UV.isNumber(e)||e<0)throw new Error("levelVersion ".concat(e," is invalid"))})),e.GameData.addValidateFunction("lastRewardedItems",(function(e){if(!UV.isNumber(e)||e<0)throw new Error("lastRewardedItems ".concat(e," is invalid"))})),e.GameData.addValidateFunction("lastCreateTournamentShown",(function(e){if(!UV.isNumber(e)||e<0)throw new Error("lastCreateTournamentShown ".concat(e," is invalid"))})),e.GameData.addValidateFunction("guideItemShowed",(function(e){if(!Array.isArray(e))throw new Error("guideItemShowed ".concat(e," is invalid"))})),e.GameData.addValidateFunction("items",(function(e){if(!UV.isObject(e))throw new Error("items ".concat(e," is invalid"));var t=Object.keys(e),n=Object.values(e);if(!t.includes(Cs.HINT))throw new Error("item ".concat(Cs.HINT," not found"));if(!t.includes(Cs.THUNDER))throw new Error("item ".concat(Cs.THUNDER," not found"));if(!t.includes(Cs.STORM))throw new Error("item ".concat(Cs.STORM," not found"));if(!t.includes(Cs.PLIERS))throw new Error("item ".concat(Cs.PLIERS," not found"));n.forEach((function(e){if(!UV.isNumber(e)||e<0)throw new Error("item ".concat(e," is invalid"))}))})),e.GameData.addValidateFunction("skins",(function(e){if(!UV.isObject(e))throw new Error("skins ".concat(e," is invalid"))}))}},{key:"requestConnectedPlayers",value:function(){HV.requestConnectedPlayers().catch((function(e){console.warn("player.requestConnectedPlayers",e)}))}}]),e}();n._RF.pop(),n._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var VV=GameCore,WV=VV.Events,KV=VV.Utils.Valid,jV=globalThis.game,YV=jV.event,XV=jV.adaptivePerformance,JV=function(){function e(){var t=this;xe(this,e),this.handleBeginFrame=function(){d.on(Q.EVENT_AFTER_UPDATE,t.lateUpdate),d.on(Q.EVENT_BEFORE_UPDATE,t.updateActualFPS)},this.handleAfterSceneLaunch=function(e){XV&&XV.trackingScene(e.name)},this.handleRequestResizeGame=function(e){var t=e.forcePixelRatio;KV.isNumber(t)&&x.emit(En,t)},this.lateUpdate=function(){var e=1e3*x.deltaTime;null==XV||XV.updatePostStepDeltaTime(e)},this.updateActualFPS=function(){var e,t=null===(e=d.root)||void 0===e?void 0:e.fps;KV.isNumber(t)&&(null==XV||XV.updateActualFPS(t))}}return Pe(e,[{key:"init",value:function(){XV&&this.listenEvents()}},{key:"listenEvents",value:function(){YV.on(WV.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),d.once(Q.EVENT_BEGIN_FRAME,this.handleBeginFrame),d.on(Q.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();n._RF.pop(),n._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var QV=globalThis.game.canvasRecorder,ZV=function(){function e(){xe(this,e)}return Pe(e,[{key:"init",value:function(){if(x.canvas&&QV){QV.setCanvas(x.canvas);var e=QV.getOptions(),t=QV.waitNextFrame;QV.waitNextFrame=Te(Se().mark((function n(){return Se().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.syncFps){n.next=4;break}return n.abrupt("return",new Promise((function(e){d.once(Q.EVENT_AFTER_RENDER,e),x.pause(),x.step()})));case 4:return x.resume(),n.next=7,t.call(QV);case 7:return n.abrupt("return",Promise.resolve());case 8:case"end":return n.stop()}}),n)})))}}}]),e}();n._RF.pop(),n._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var $V=function(){function e(){var t=this;xe(this,e),this.hideCocosStats=function(){clearInterval(t.waiter),t.waiter=setInterval(t.checkProfilerReady,100)},this.checkProfilerReady=function(){if(W){W._showFPS=!1;var e=W._rootNode;e&&(e.active=!1,e.isValid&&(e.destroyAllChildren(),e.removeAllChildren(),e.destroy(),clearInterval(t.waiter)))}}}return Pe(e,[{key:"init",value:function(){W&&d.on(Q.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();n._RF.pop(),n._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var eW=GameCore,tW=eW.Configs,nW=eW.Events,aW=tW.GameEngine,iW=globalThis.game.event,rW=[".png",".jpg",".jpeg",".webp"],oW=function(){function e(){var t=this;xe(this,e),this.useHighQuality=!1,this.upgradableAssets=new Map,this.requestUpdateDynamicAssets=function(){x.emit(Ln)},this.collectUpgradableAssets=function(e){var n,a=Ye(e.output=e.input);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(rW.includes(i.ext)&&!t.upgradableAssets.has(i.uuid)){t.useHighQuality&&(i.url=t.replaceAssetUrl(i.url),i.requestUpgrade=!0);var r={uuid:i.uuid,url:i.url,options:i.options,upgraded:i.upgraded,requestUpgrade:i.requestUpgrade,ext:i.ext};t.upgradableAssets.set(i.uuid,r)}}}catch(e){a.e(e)}finally{a.f()}},this.replaceAssetUrl=function(e){return t.useHighQuality?e.replace("native/","native32/"):e},this.handleUpgradeQuality=function(){t.useHighQuality=!0;var e=0,n=0,a=pe.instance,i=a.assets,r=a.loadAny,o=0;t.upgradableAssets.forEach((function(a){if(a.upgraded||a.requestUpgrade)e++;else{n++;var s=i.get(a.uuid);s instanceof L?(a.url=t.replaceAssetUrl(a.url),console.info("DynamicAssets: Process upgrade quality",a.uuid,a,s),r(a,a.options,(function(e,i){o++,e?console.warn("DynamicAssets: Upgrade error",e):(s.reset(i),a.upgraded=!0,t.upgradableAssets.set(a.uuid,a),console.info("DynamicAssets: Upgrade done",a.uuid,i,s),o>=n&&t.requestUpdateDynamicAssets())}))):console.warn("DynamicAssets: Asset not found",a.uuid)}})),console.warn("DynamicAssets: Upgradable Assets Info",{needUpgrade:n,upgraded:e,total:t.upgradableAssets.size})}}return Pe(e,[{key:"init",value:function(){var e=aW.DynamicAssets.Enabled;console.info("DynamicAssets: init",{EDITOR:false,Enabled:e}),e&&(pe.instance.transformPipeline.insert(this.collectUpgradableAssets,3),this.listenEvents())}},{key:"listenEvents",value:function(){var e=this;x.on(_n,this.handleUpgradeQuality),iW.on(nW.SCENE_LAUNCHED,(function(t){var n=t.sceneName;[Xs,Js].includes(n)||e.handleUpgradeQuality()}))}}]),e}();n._RF.pop(),n._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var sW=GameCore,lW=sW.Configs,uW=sW.Events,cW=lW.GameEngine,hW=globalThis.game.event,pW=function(){function e(){var t=this;xe(this,e),this.result=[],this.requestUpdateDynamicAtlas=function(){requestAnimationFrame(t.updateDynamicAtlas)},this.createAtlas=function(){return de.instance.newAtlas()},this.updateDynamicAtlas=function(){var e=d.getScene();if(e){var n=e.getComponentsInChildren(ge),a=[];if(n.forEach((function(e){if(e.enabled&&e.node.activeInHierarchy)if("spriteFrame"in e){if(e.spriteFrame instanceof O){var t=e.spriteFrame,n=t.uuid,i=t.packable,r=t.texture,o=t.original;if(i)if(r instanceof be){var s=r.getId(),l=r.width,u=r.height,c=(null==o?void 0:o._texture)||{width:0,height:0},h=c.width,p=c.height;if(o){var d=o._texture.getId();if(s===d)return void console.warn("DynamicAtlas: Skip original texture",e.name,{ori:o._texture,tex:r});s=d}var f=(o?h:l)+2,v=(o?p:u)+2;a.push({id:s,name:n,w:f,h:v,x:-1,y:-1,comp:e})}else console.warn("DynamicAtlas: Skip non-texture2d texture",e.name);else console.warn("DynamicAtlas: Skip non-packable texture",e.name)}}else console.warn("DynamicAtlas: Skip non-sprite component",e.name,e)})),0!==a.length){console.info("DynamicAtlas: collect info",a);var i=[];a.forEach((function(e){i.find((function(t){return t.id===e.id}))||i.push(e)})),0!==i.length&&(t.result=[],t.resetDynamicAtlas(),t.fillTextures(i),t.refreshComponents(n))}}},this.calculateOptimizedAtlas=function(e,n){var a=We(e),i=function(e){var t,n=0,a=0,i=Ye(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;n+=r.w*r.h,a=Math.max(a,r.w)}}catch(e){i.e(e)}finally{i.f()}e.sort((function(e,t){return t.h-e.h}));var o,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}],l=0,u=0,c=Ye(e);try{for(c.s();!(o=c.n()).done;)for(var h=o.value,p=s.length-1;p>=0;p--){var d=s[p];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,u=Math.max(u,h.y+h.h),l=Math.max(l,h.x+h.w),h.w===d.w&&h.h===d.h){var f=s.pop();p<s.length&&(s[p]=f)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(s.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}}catch(e){c.e(e)}finally{c.f()}return{w:l,h:u,fill:n/(l*u)||0}}(a=e.reduce((function(e,t){return e.some((function(e){return e.id===t.id}))||e.push(t),e}),[])),r=i.w,o=i.h,s=i.fill;if(r>n||o>n){var l=a.slice(0,a.length-1);return t.calculateOptimizedAtlas(l,n)}return console.info("DynamicAtlas: packed map info",r,o,s,a),a},this.fillTextures=function(e){if(0!==e.length){var n=de.instance.textureSize;t.result=t.calculateOptimizedAtlas(e,n)}},this.drawTexture=function(e,n,a){var i=n.texture,r=i.getId(),o=t.result.find((function(e){return e.id===r}))||{x:-1,y:-1},s=o.x,l=o.y;if(s<0||l<0)return e.originalInsertSpriteFrame(n);var u=e._innerTextureInfos[r];u||(a&&(e._texture.drawTextureAt(i.image,s-1,l),e._texture.drawTextureAt(i.image,s+1,l),e._texture.drawTextureAt(i.image,s,l-1),e._texture.drawTextureAt(i.image,s,l+1)),e._texture.drawTextureAt(i.image,s,l),e._count++,e._innerTextureInfos[r]={texture:i,x:s,y:l});var c=n.rect,h=c.x,p=c.y;h+=(null==u?void 0:u.x)||s,p+=(null==u?void 0:u.y)||l;var d={texture:e._texture,x:h,y:p};return e._innerSpriteFrames.push(n),d},this.refreshComponents=function(e){e.forEach((function(e){e.node.active&&(e.node.active=!1,e.node.active=!0)}))}}return Pe(e,[{key:"init",value:function(){var e=cW.DynamicAtlas.TextureAtlasOptimize;e&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:e}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){x.on(Ln,this.requestUpdateDynamicAtlas),hW.on(uW.SCENE_LAUNCHED,this.requestUpdateDynamicAtlas)}},{key:"overrideDynamicAtlas",value:function(){var e=this,t=de.instance;de.instance.insertSpriteFrame=function(n){if(t._atlasIndex>=t._maxAtlasCount)return null;if(!n||n.original)return null;if(!n.packable)return null;var a=e.getAtlas(),i=a?a.insertSpriteFrame(n):null;return!i&&t._atlasIndex<t._maxAtlasCount?(a=e.getAtlas())?a.insertSpriteFrame(n):null:i}}},{key:"resetDynamicAtlas",value:function(){de.instance.reset()}},{key:"getAtlas",value:function(){var e=this,t=de.instance,n=t._atlases,a=void 0===n?[]:n,i=t._atlasIndex,r=t.textureBleeding,o=a[i];return o||(o=this.createAtlas()),o.originalInsertSpriteFrame||(o.originalInsertSpriteFrame=o.insertSpriteFrame,o.insertSpriteFrame=function(t){return e.drawTexture(o,t,r)}),o}}]),e}();n._RF.pop();var dW={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};n._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var fW=GameCore.Events,vW=globalThis.game,yW=vW.event,mW=vW.language,gW=function(){function e(){var t=this;xe(this,e),this.handleLanguageChanged=function(){var e=Te(Se().mark((function e(n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=n.locale,x.emit("update-language",a),t.updateComponentInEditor();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}var n,a,i;return Pe(e,[{key:"init",value:function(){var e=this;this.addLanguage("en").then((function(){e.setLanguage("en"),e.listenEvent()}))}},{key:"listenEvent",value:function(){yW.on(fW.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(i=Te(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLangData(t);case 2:n=e.sent,mW.add(t,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setLanguage",value:function(e){mW.choose(e)}},{key:"getLangData",value:(a=Te(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="en"===e.t0?3:"ru"===e.t0?4:5;break;case 3:return e.abrupt("return",dW);case 4:return e.abrupt("return",this.loadLanguageAsync(t));case 5:throw new Error("Language ".concat(t," not supported"));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"loadLanguageAsync",value:(n=Te(Se().mark((function e(n){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.import("db://assets/resources/locales/".concat(n,".json"));case 2:a=e.sent.default,mW.add(n,a);case 4:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"updateComponentInEditor",value:function(){}}]),e}();n._RF.pop(),n._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var bW=GameCore,wW=bW.Configs,kW=bW.Utils,SW=wW.Mockup,CW=kW.Number,EW=globalThis.game.leaderboard,AW=function(){function e(){var t=this;xe(this,e),this.handleWhenGameSDKStarted=function(){wW.Mockup.Leaderboards.Enabled?t.setupLeaderboardsMockup():t.setupLeaderboards()}}var t,n,a,i,r;return Pe(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(r=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setupLeaderboardByConfigs();case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var e=wW.Leaderboards.LeaderboardId;e?(EW.addLeaderboard({name:qs,type:"global",autoSortRank:!0,leaderboardId:e}),EW.addLeaderboard({name:Vs,type:"friends",autoSortRank:!0,leaderboardId:e})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(i=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard();case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(a=Te(Se().mark((function e(){var t,n,a,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=qs,n=Ws,e.next=4,EW.createLeaderboardAsync({_id:n,name:t,numberOfLeaders:100});case 4:return a=e.sent,EW.addLeaderboard({name:t,type:"global",autoSortRank:!0,leaderboardId:a}),e.next=8,EW.requestLeaderboardAsync(t,10);case 8:i=EW.getLeaderboard(t),console.info("setupGlobalLeaderboard fetch new",i,i&&Object.keys(i.leaders).length),i=EW.getLeaderboard(t),console.info("setupGlobalLeaderboard load more",i,i&&Object.keys(i.leaders).length);case 12:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(n=Te(Se().mark((function e(){var t,n,a,i,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Vs,n=Ks,a=0,(i=SW.GameSDK.Player.ConnectedPlayers).Enabled&&(a=CW.random(i.NumOfPlayers)),e.next=7,EW.createLeaderboardAsync({_id:n,name:t,numberOfLeaders:a});case 7:return r=e.sent,EW.addLeaderboard({name:t,type:"friends",autoSortRank:!0,leaderboardId:r}),e.next=11,EW.requestLeaderboardAsync(t,10);case 11:o=EW.getLeaderboard(t),console.info("setupFriendsLeaderboard done",o);case 13:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(t=Te(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,gv.requestTournamentDataAsync();case 2:(t=e.sent).forEach((function(e){var t=e.payload.leaderboardId;EW.isExistLeaderboardId(t)||EW.addLeaderboard({type:"tournament",name:t,autoSortRank:!0,leaderboardId:t})})),console.info("setupGlobalTournamentLeaderboard done",t);case 5:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var TW=GameCore,xW=TW.Configs,RW=TW.Utils,PW=TW.Events,IW=xW.PerformanceMonitor,_W=globalThis.game.event,LW=function(){function e(){var t=this;xe(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){t.startTraceFps()},this.handleLateUpdate=function(){if(t.mark){if(t.fpsTraceDuration-=x.deltaTime,t.fpsTraceDuration<=0&&!t.traceStopped)return t.traceStopped=!0,t.unListenEvents(),t.updateFPS(),void t.mark.stop(t.markName);t.fpsTraceIntervalTimer-=x.deltaTime,t.fpsTraceIntervalTimer>0||(t.fpsTraceIntervalTimer=t.fpsTraceInterval,t.updateFPS(),t.mark.stop(t.markName),t.startTraceFps())}}}return Pe(e,[{key:"mark",get:function(){return IW.FpsTracking?RW.Mark:null}},{key:"init",value:function(){var e=IW.FpsTracking,t=e.TrackingDuration,n=e.TrackingInterval;this.fpsTraceDuration=null!=t?t:60,this.fpsTraceInterval=null!=n?n:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){_W.once(PW.GAME_READY,this.handleStartTraceFps),d.on(Q.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"unListenEvents",value:function(){d.off(Q.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var e,t;if(this.mark){var n=this.getFPS(),a=this.getDrawCalls(),i=this.getDeviceRender(),r=this.getTextureMemory();this.minFps=Math.min(null!==(e=this.minFps)&&void 0!==e?e:n,n),this.maxFps=Math.max(null!==(t=this.maxFps)&&void 0!==t?t:0,n),this.mark.putMetric(this.markName,"FPS Metric",n),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",i),this.mark.putAttr(this.markName,"Draw Calls",a.toString()),this.mark.putAttr(this.markName,"Texture Memory",r.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info("FPS: ".concat(n," Min: ").concat(this.minFps," Max: ").concat(this.maxFps,", draw calls: ").concat(a,", texture memory: ").concat(r.toFixed(2),"MB"))}}},{key:"getFPS",value:function(){if(!d.root)return 0;var e=d.root.fps;return Math.floor(e)||0}},{key:"getDrawCalls",value:function(){return d.root&&d.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return d.root&&d.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return d.root&&d.root.device.memoryStatus.textureSize/1048576||0}}]),e}();n._RF.pop(),n._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var OW=GameCore.Events,DW=globalThis.game.event,MW=function(){function e(){xe(this,e),this.handleHotReload=function(){x.restart()},this.handleUpdateConfig=function(e){if("Gameplay"===e.type){x.emit(Tn,e.config);var t=e.id,n=e.type;DW.emit(OW.REMOTE_CONFIG_UPDATED,{id:t,type:n})}}}return Pe(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){DW.on(OW.REQUEST_HOT_RELOAD,this.handleHotReload),DW.on(OW.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();n._RF.pop(),n._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var NW=function(){function e(){xe(this,e)}return Pe(e,[{key:"init",value:function(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}},{key:"initLanguages",value:function(){(new gW).init()}},{key:"initCocosStats",value:function(){(new $V).init()}},{key:"initLeaderboards",value:function(){(new AW).init()}},{key:"initRemoteConfig",value:function(){(new MW).init()}},{key:"initDynamicAtlas",value:function(){(new pW).init()}},{key:"initDynamicAssets",value:function(){(new oW).init()}},{key:"initCanvasRecorder",value:function(){(new ZV).init()}},{key:"initPerformanceMonitor",value:function(){(new LW).init()}},{key:"initAdaptivePerformance",value:function(){(new JV).init()}}]),e}();n._RF.pop(),n._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var FW=globalThis.game.event,BW=GameCore,GW=BW.Events,zW=BW.Configs,UW=BW.Utils,HW=function(){function e(){var t=this;xe(this,e),this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var e=Te(Se().mark((function e(n){var a,i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.sceneName,i=n.sceneData,r=t.correctSceneName(a),console.info("Switching",r,null!=i?i:{}),r){e.next=5;break}return e.abrupt("return");case 5:iu.showLoadingFullScreen(r),t.startScene({sceneName:r,sceneData:i});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.preloadScene=function(e,n){var a=e.sceneName;t.startMeasure(a),d.preloadScene(a,t.onSceneProgress,t.onScenePreloaded(a,n))},this.startMeasure=function(e){t.mark&&(t.queueLoadScene[e]&&(t.mark.putAttr(t.markName,"Canceled","true"),t.stopMeasure(e)),console.groupCollapsed(" Load scene progress"),t.mark.measure(t.markName),t.mark.putAttr(t.markName,"Cancel","false"),t.mark.putAttr(t.markName,"Success","false"),t.mark.putMetric(t.markName,e),t.mark.start(t.markName),t.queueLoadScene[e]=!0)},this.stopMeasure=function(e){t.mark&&t.queueLoadScene[e]&&(t.mark.rmAttr(t.markName,"File"),t.mark.putAttr(t.markName,"Success","true"),t.mark.stop(t.markName),t.queueLoadScene[e]=!1,console.groupEnd())},this.onSceneProgress=function(e,n,a){var i=e/n;t.mark&&t.mark.putAttr(t.markName,"Last File","".concat(a.id," (").concat(a.ext,")"));var r=Math.floor(70*i+30);GameSDK.setLoadingProgress(r)},this.onScenePreloaded=function(e,t){return function(n){n?console.warn("SceneManager.onScenePreloaded",{sceneName:e,error:n}):FW.emit(GW.SCENE_LOADED,{sceneName:e}),t&&t(e,n)}},this.onDirectorLoadScene=function(e){return function(n,a){if(n)console.warn("SceneManager.onSceneLoaded",n);else if(null!=a&&a.scene){var i=a.name;t.handleBeforeSceneLaunch(a,e)(),d.once(Q.EVENT_AFTER_SCENE_LAUNCH,t.handleSceneLaunched(i,e))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(e,n){return function(){FW.emit(GW.SCENE_LOADED,{sceneName:e.name}),t.setSceneData(e,null!=n?n:{}),x.emit(En)}},this.handleSceneLaunched=function(e,n){return function(){iu.hideLoadingFullScreen(e),d.once(Q.EVENT_AFTER_RENDER,(function(){var a;FW.emit(GW.SCENE_LAUNCHED,{sceneName:e}),ma.switchSceneTracking(),null===(a=t.callbackSwitchScene)||void 0===a||a.call(t,{sceneName:e,sceneData:n})}))}},this.handleSceneLoaded=function(e){var n=e.sceneName;t.stopMeasure(n)}}return Pe(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){FW.on(GW.SWITCH_SCENE,this.switchScene),FW.on(GW.PRELOAD_SCENE,this.preloadScene),FW.on(GW.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(e){var t=this.getCurrentScene();return t&&e===t.name?null:e}},{key:"startScene",value:function(e){var t=this,n=e.sceneName,a=e.sceneData;this.preloadScene({sceneName:n},(function(e,i){e===n&&(i?console.warn("SceneManager.startScene",{sceneName:n,error:i}):d.loadScene(n,t.onDirectorLoadScene(a)))}))}},{key:"mark",get:function(){return zW.PerformanceMonitor.LoadResources?UW.Mark:null}},{key:"getCurrentScene",value:function(){return d.getScene()}},{key:"getLoadedScenes",value:function(){var e=this,t=[];return Object.keys(this.queueLoadScene).map((function(n){e.queueLoadScene[n]||t.push(n)})),t}},{key:"onSwitchScene",value:function(e){this.callbackSwitchScene=e}},{key:"setSceneData",value:function(e,t){if(t&&("data"in e||e.scene.attr({data:{}}),"data"in e)){var n=e.data||{};e.scene.attr({data:ke(ke({},n),t)}),console.info("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:n})}}}]),e}();n._RF.pop(),n._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var qW=globalThis.game.event,VW=GameCore.Events,WW=function(){function e(){var t=this;xe(this,e),this.screens={},this.handleOpenScreen=function(e){var n=e.screenName,a=e.screenData;t.openScreen(n,a)},this.handleCloseScreen=function(e){var n=e.screenName;t.closeScreen(n)}}return Pe(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){qW.on(VW.OPEN_SCREEN,this.handleOpenScreen),qW.on(VW.CLOSE_SCREEN,this.handleCloseScreen)}},{key:"addScreen",value:function(e){this.screens[e.node.name]=e}},{key:"getScreen",value:function(e){return this.screens[e]}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:function(e,t){var n=this.getScreen(e);if(n&&n.node){n.node.active=!0,n.node.setPosition(new j(0,0,0));var a={screenName:e,screenData:t};qW.emit(VW.OPENING_SCREEN,a),ma.trackCurrentPage(e,!0),n.scheduleOnce((function(){n.open(t),qW.emit(VW.OPENED_SCREEN,a)}),0)}else console.warn("ScreenManager.openScreen","Screen ".concat(e," not found"))}},{key:"closeScreen",value:function(e){var t,n=this.getScreen(e);if(n){if(null!==(t=n.node)&&void 0!==t&&t.active){var a={screenName:e};qW.emit(VW.CLOSING_SCREEN,a),n.close(),ma.trackCurrentPage(e,!1)}}else console.warn("ScreenManager.closeScreen","Screen ".concat(e," not found"))}},{key:"closeAllScreens",value:function(){var e=this;Object.keys(this.screens).forEach((function(t){e.closeScreen(t)}))}}]),e}();n._RF.pop(),n._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var KW=GameCore,jW=KW.Configs,YW=KW.Events,XW=KW.Plugins,JW=globalThis.game,QW=JW.player,ZW=JW.context,$W=JW.event,eK=JW.analytics,tK=JW.monitorError;new(function(){function e(){var t=this;xe(this,e),this.coreManager=new fV,this.matchManager=new FV,this.sceneManager=new HW,this.screenManager=new WW,this.engineManager=new wV,this.layoutManager=new IV,this.playerManager=new qV,this.pluginsManager=new NW,this.handleWhenCoreBoot=function(){x.inited?t.handleCocosInit():x.once(we.EVENT_POST_PROJECT_INIT,t.handleCocosInit)},this.handleCocosInit=function(){t.coreManager.requestStart()},this.handleWhenCoreStart=function(){t.playerManager.setupDefaultGameData(),t.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){t.initPlugins(),console.groupEnd(),jW.Core.StartSDKAfterLoadGame?$W.on(YW.SCENE_LOADED,t.handleStartGameWhenMainSceneReady):t.processStartGame(),t.preloadScenes()},this.handleStartGameWhenMainSceneReady=function(e){var n=e.sceneName,a=QW.isFirstLogin();if(a&&n===Qs)t.processStartGame();else{if(a||n!==Zs)return void console.warn("handleStartGameWhenMainSceneReady",e);t.processStartGame()}$W.off(YW.SCENE_LOADED,t.handleStartGameWhenMainSceneReady)},this.handleSwitchScene=function(e){var n=e.sceneName,a=t.sceneManager.getCurrentScene();if((null==a?void 0:a.name)===n){t.screenManager.closeAllScreens(),t.screenManager.clearScreens();var i=null==a?void 0:a.getComponentsInChildren(cF);i&&(console.groupCollapsed(" Screens in ".concat(n)),i.forEach((function(e){console.info(e.name,e),t.screenManager.addScreen(e)})),console.groupEnd())}},console.groupCollapsed(" Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}var t,n;return Pe(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"preloadScenes",value:function(){QW.isFirstLogin()?Vl.preloadGameScene():Vl.preloadDashboardScene()}},{key:"processStartGame",value:(n=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.groupEnd(),eK.event(XW.Analytics.Events.LOAD_COMPLETE),e.next=4,this.startGameAsync();case 4:this.startProcessContextData(),this.playerManager.requestConnectedPlayers(),$W.emit(YW.GAME_READY),eK.event(XW.Analytics.Events.APP_READY);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"startGameAsync",value:(t=Te(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameSDK.startGameAsync();case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("GameSDK.startGameAsync",e.t0),e.t0 instanceof Error&&(null==tK||tK.sendException(e.t0));case 9:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(){return t.apply(this,arguments)})},{key:"startProcessContextData",value:function(){ZW.processContextData().catch((function(e){console.error("startProcessContextData",e)}))}},{key:"initPlugins",value:function(){this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/start-scene', 'chunks:///start-scene.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});