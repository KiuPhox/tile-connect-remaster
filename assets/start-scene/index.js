System.register("chunks:///start-scene.js",["cc"],(function(e,t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b,w,k,S,C,E,A,T,x,P,R,I,_,L,O,D,M,N,F,B,G,z,U,H,q,V,W,K,j,Y,X,$,J,Q,Z,ee,te,ne,ie,ae,re,oe,se,le,ue,ce,he,pe,de,fe,ve,ye,me,ge,be,we;return{setters:[function(e){n=e.cclegacy,i=e._decorator,a=e.Node,r=e.Color,o=e.Canvas,s=e.UITransform,l=e.instantiate,u=e.Label,c=e.RichText,h=e.Toggle,p=e.Button,d=e.director,f=e.Component,v=e.isCCObject,y=e.Animation,m=e.CCString,g=e.CCInteger,b=e.AudioSource,w=e.resources,k=e.AudioClip,S=e.tween,C=e.CCFloat,E=e.Widget,A=e.Layout,T=e.Sprite,x=e.game,P=e.find,R=e.Prefab,I=e.JsonAsset,_=e.AnimationClip,L=e.ImageAsset,O=e.SpriteFrame,D=e.easing,M=e.UIOpacity,N=e.ccenum,F=e.view,B=e.screen,G=e.math,z=e.EventHandler,U=e.animation,H=e.CCBoolean,q=e.Input,V=e.Graphics,W=e.profiler,K=e.sys,j=e.Vec3,Y=e.ProgressBar,X=e.Font,$=e.Vec2,J=e.Director,Q=e.Layers,Z=e.randomRangeInt,ee=e.pseudoRandomRangeInt,te=e.pseudoRandom,ne=e.randomRange,ie=e.Pool,ae=e.ParticleSystem2D,re=e.HorizontalTextAlignment,oe=e.Tween,se=e.View,le=e.ScrollView,ue=e.Enum,ce=e.lerp,he=e.Mask,pe=e.AssetManager,de=e.DynamicAtlasManager,fe=e.macro,ve=e.settings,ye=e.Settings,me=e.ResolutionPolicy,ge=e.UIRenderer,be=e.Texture2D,we=e.Game}],execute:function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function ke(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){Re(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function Se(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
Se=function(){return t};var e,t={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var r=t&&t.prototype instanceof y?t:y,o=Object.create(r.prototype),s=new R(i||[]);return a(o,"_invoke",{value:A(e,n,s)}),o}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var p="suspendedStart",d="executing",f="completed",v={};function y(){}function m(){}function g(){}var b={};u(b,o,(function(){return this}));var w=Object.getPrototypeOf,k=w&&w(w(I([])));k&&k!==n&&i.call(k,o)&&(b=k);var S=g.prototype=y.prototype=Object.create(b);function C(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function n(a,r,o,s){var l=h(e[a],e,r);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&i.call(c,"__await")?t.resolve(c.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(c).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var r;a(this,"_invoke",{value:function(e,i){function a(){return new t((function(t,a){n(e,i,t,a)}))}return r=r?r.then(a,a):a()}})}function A(t,n,i){var a=p;return function(r,o){if(a===d)throw new Error("Generator is already running");if(a===f){if("throw"===r)throw o;return{value:e,done:!0}}for(i.method=r,i.arg=o;;){var s=i.delegate;if(s){var l=T(s,i);if(l){if(l===v)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===p)throw a=f,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=d;var u=h(t,n,i);if("normal"===u.type){if(a=i.done?f:"suspendedYield",u.arg===v)continue;return{value:u.arg,done:i.done}}"throw"===u.type&&(a=f,i.method="throw",i.arg=u.arg)}}}function T(t,n){var i=n.method,a=t.iterator[i];if(a===e)return n.delegate=null,"throw"===i&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),v;var r=h(a,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;var o=r.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function I(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,r=function n(){for(;++a<t.length;)if(i.call(t,a))return n.value=t[a],n.done=!1,n;return n.value=e,n.done=!0,n};return r.next=r}}throw new TypeError(typeof t+" is not iterable")}return m.prototype=g,a(S,"constructor",{value:g,configurable:!0}),a(g,"constructor",{value:m,configurable:!0}),m.displayName=u(g,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,u(e,l,"GeneratorFunction")),e.prototype=Object.create(S),e},t.awrap=function(e){return{__await:e}},C(E.prototype),u(E.prototype,s,(function(){return this})),t.AsyncIterator=E,t.async=function(e,n,i,a,r){void 0===r&&(r=Promise);var o=new E(c(e,n,i,a),r);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C(S),u(S,l,"Generator"),u(S,o,(function(){return this})),u(S,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var i in t)n.push(i);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=I,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(P),!t)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function a(i,a){return s.type="throw",s.arg=t,n.next=i,a&&(n.method="next",n.arg=e),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],s=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),u=i.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),P(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;P(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:I(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),v}},t}function Ce(){Ce=function(e,t){return new n(e,void 0,t)};var e=RegExp.prototype,t=new WeakMap;function n(e,i,a){var r=new RegExp(e,i);return t.set(r,a||t.get(e)),Le(r,n.prototype)}function i(e,n){var i=t.get(n);return Object.keys(i).reduce((function(t,n){var a=i[n];if("number"==typeof a)t[n]=e[a];else{for(var r=0;void 0===e[a[r]]&&r+1<a.length;)r++;t[n]=e[a[r]]}return t}),Object.create(null))}return Ie(n,RegExp),n.prototype.exec=function(t){var n=e.exec.call(this,t);if(n){n.groups=i(n,this);var a=n.indices;a&&(a.groups=i(a,this))}return n},n.prototype[Symbol.replace]=function(n,a){if("string"==typeof a){var r=t.get(this);return e[Symbol.replace].call(this,n,a.replace(/\$<([^>]+)>/g,(function(e,t){var n=r[t];return"$"+(Array.isArray(n)?n.join("$"):n)})))}if("function"==typeof a){var o=this;return e[Symbol.replace].call(this,n,(function(){var e=arguments;return"object"!=typeof e[e.length-1]&&(e=[].slice.call(e)).push(i(e,o)),a.apply(this,e)}))}return e[Symbol.replace].call(this,n,a)},Ce.apply(this,arguments)}function Ee(e,t,n,i,a,r,o){try{var s=e[r](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(i,a)}function Ae(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function o(e){Ee(r,i,a,o,s,"next",e)}function s(e){Ee(r,i,a,o,s,"throw",e)}o(void 0)}))}}function Te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xe(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,Ye(i.key),i)}}function Pe(e,t,n){return t&&xe(e.prototype,t),n&&xe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Re(e,t,n){return(t=Ye(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ie(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Le(e,t)}function _e(e){return(_e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Le(e,t){return(Le=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Oe(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function De(e,t,n){return(De=Oe()?Reflect.construct.bind():function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&Le(a,n.prototype),a}).apply(null,arguments)}function Me(e){var t="function"==typeof Map?new Map:void 0;return(Me=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return De(e,arguments,_e(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Le(i,e)})(e)}function Ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fe(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Ne(e)}function Be(e){var t=Oe();return function(){var n,i=_e(e);if(t){var a=_e(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return Fe(this,n)}}function Ge(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_e(e)););return e}function ze(){return(ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=Ge(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}}).apply(this,arguments)}function Ue(e,t,n,i){return(Ue="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,n,i){var a,r=Ge(e,t);if(r){if((a=Object.getOwnPropertyDescriptor(r,t)).set)return a.set.call(i,n),!0;if(!a.writable)return!1}if(a=Object.getOwnPropertyDescriptor(i,t)){if(!a.writable)return!1;a.value=n,Object.defineProperty(i,t,a)}else Re(i,t,n);return!0})(e,t,n,i)}function He(e,t,n,i,a){if(!Ue(e,t,n,i||e)&&a)throw new TypeError("failed to set property");return n}function qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r,o,s=[],l=!0,u=!1;try{if(r=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(s.push(i.value),s.length!==t);l=!0);}catch(e){u=!0,a=e}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}(e,t)||We(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e){return function(e){if(Array.isArray(e))return Ke(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||We(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function We(e,t){if(e){if("string"==typeof e)return Ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ke(e,t):void 0}}function Ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function je(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=We(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}function Ye(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function Xe(e,t,n,i){n&&Object.defineProperty(e,t,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function $e(e,t,n,i,a){var r={};return Object.keys(i).forEach((function(e){r[e]=i[e]})),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=n.slice().reverse().reduce((function(n,i){return i(e,t,n)||n}),r),a&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(a):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,t,r),r=null),r}var Je,Qe,Ze,et,tt,nt,it,at,rt;n._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);var ot=i.ccclass,st=i.property;Je=ot("internal.DebugViewRuntimeControl"),Qe=st(a),Ze=st(a),et=st(a),Je((it=$e((nt=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];return Xe(e=t.call.apply(t,[this].concat(a)),"compositeModeToggle",it,Ne(e)),Xe(e,"singleModeToggle",at,Ne(e)),Xe(e,"EnableAllCompositeModeButton",rt,Ne(e)),e._single=0,e.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],e.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],e.strMisc=["CSM Layer Coloration","Lighting With Albedo"],e.compositeModeToggleList=[],e.singleModeToggleList=[],e.miscModeToggleList=[],e.textComponentList=[],e.labelComponentList=[],e.textContentList=[],e._currentColorIndex=0,e.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],e.color=[r.WHITE,r.BLACK,r.RED,r.GREEN,r.BLUE],e}return Pe(n,[{key:"start",value:function(){if(this.node.parent.getComponent(o)){var e=this.node.parent.getComponent(s),t=.5*e.width,n=.5*e.height,i=.1*t-t,a=n-.1*n,d=this.node.getChildByName("MiscMode"),f=l(d);f.parent=this.node,f.name="Buttons";var v=l(d);v.parent=this.node,v.name="Titles";for(var y=0;y<2;y++){var m=l(this.EnableAllCompositeModeButton.getChildByName("Label"));m.setPosition(i+(y>0?450:150),a,0),m.setScale(.75,.75,.75),m.parent=v;var g=m.getComponent(u);g.string=y?"----------Composite Mode----------":"----------Single Mode----------",g.color=r.WHITE,g.overflow=0,this.labelComponentList[this.labelComponentList.length]=g}a-=20;for(var b=0,w=0;w<this.strSingle.length;w++,b++){w===this.strSingle.length>>1&&(i+=200,b=0);var k=w?l(this.singleModeToggle):this.singleModeToggle;k.setPosition(i,a-20*b,0),k.setScale(.5,.5,.5),k.parent=this.singleModeToggle.parent;var S=k.getComponentInChildren(c);S.string=this.strSingle[w],this.textComponentList[this.textComponentList.length]=S,this.textContentList[this.textContentList.length]=S.string,k.on(h.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[w]=k}i+=200,this.EnableAllCompositeModeButton.setPosition(i+15,a,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(p.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=f;var C=this.EnableAllCompositeModeButton.getComponentInChildren(u);this.labelComponentList[this.labelComponentList.length]=C;var E=l(this.EnableAllCompositeModeButton);E.setPosition(i+90,a,0),E.setScale(.5,.5,.5),E.on(p.EventType.CLICK,this.changeTextColor,this),E.parent=f,(C=E.getComponentInChildren(u)).string="TextColor",this.labelComponentList[this.labelComponentList.length]=C;var A=l(this.EnableAllCompositeModeButton);A.setPosition(i+200,a,0),A.setScale(.5,.5,.5),A.on(p.EventType.CLICK,this.hideUI,this),A.parent=this.node.parent,(C=A.getComponentInChildren(u)).string="Hide UI",this.labelComponentList[this.labelComponentList.length]=C,this.hideButtonLabel=C,a-=40;for(var T=0;T<this.strMisc.length;T++){var x=l(this.compositeModeToggle);x.setPosition(i,a-20*T,0),x.setScale(.5,.5,.5),x.parent=d;var P=x.getComponentInChildren(c);P.string=this.strMisc[T],this.textComponentList[this.textComponentList.length]=P,this.textContentList[this.textContentList.length]=P.string,x.getComponent(h).isChecked=!!T,x.on(h.EventType.TOGGLE,T?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[T]=x}a-=150;for(var R=0;R<this.strComposite.length;R++){var I=R?l(this.compositeModeToggle):this.compositeModeToggle;I.setPosition(i,a-20*R,0),I.setScale(.5,.5,.5),I.parent=this.compositeModeToggle.parent;var _=I.getComponentInChildren(c);_.string=this.strComposite[R],this.textComponentList[this.textComponentList.length]=_,this.textContentList[this.textContentList.length]=_.string,I.on(h.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[R]=I}}else console.error("debug-view-runtime-control should be child of Canvas")}},{key:"isTextMatched",value:function(e,t){var n=new String(e),i=n.search(">");return-1===i?e===t:(n=(n=n.substr(i+1)).substr(0,n.search("<")))===t}},{key:"toggleSingleMode",value:function(e){for(var t=d.root.debugView,n=e.getComponentInChildren(c),i=0;i<this.strSingle.length;i++)this.isTextMatched(n.string,this.strSingle[i])&&(t.singleMode=i)}},{key:"toggleCompositeMode",value:function(e){for(var t=d.root.debugView,n=e.getComponentInChildren(c),i=0;i<this.strComposite.length;i++)this.isTextMatched(n.string,this.strComposite[i])&&t.enableCompositeMode(i,e.isChecked)}},{key:"toggleLightingWithAlbedo",value:function(e){d.root.debugView.lightingWithAlbedo=e.isChecked}},{key:"toggleCSMColoration",value:function(e){d.root.debugView.csmLayerColoration=e.isChecked}},{key:"enableAllCompositeMode",value:function(e){var t=d.root.debugView;t.enableAllCompositeMode(!0);for(var n=0;n<this.compositeModeToggleList.length;n++){this.compositeModeToggleList[n].getComponent(h).isChecked=!0}var i=this.miscModeToggleList[0].getComponent(h);i.isChecked=!1,t.csmLayerColoration=!1,(i=this.miscModeToggleList[1].getComponent(h)).isChecked=!0,t.lightingWithAlbedo=!0}},{key:"hideUI",value:function(e){var t=this.node.getChildByName("Titles"),n=!t.active;this.singleModeToggleList[0].parent.active=n,this.miscModeToggleList[0].parent.active=n,this.compositeModeToggleList[0].parent.active=n,this.EnableAllCompositeModeButton.parent.active=n,t.active=n,this.hideButtonLabel.string=n?"Hide UI":"Show UI"}},{key:"changeTextColor",value:function(e){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(var t=0;t<this.textComponentList.length;t++)this.textComponentList[t].string=this.strColor[this._currentColorIndex]+this.textContentList[t]+"</color>";for(var n=0;n<this.labelComponentList.length;n++)this.labelComponentList[n].color=this.color[this._currentColorIndex]}},{key:"onLoad",value:function(){}},{key:"update",value:function(e){}}]),n}(f)).prototype,"compositeModeToggle",[Qe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),at=$e(nt.prototype,"singleModeToggle",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rt=$e(nt.prototype,"EnableAllCompositeModeButton",[et],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tt=nt));n._RF.pop(),n._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);var lt,ut,ct,ht,pt,dt,ft,vt,yt,mt=GameCore.Utils,gt=mt.Array,bt=mt.Object,wt=mt.Valid,kt=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"],St=function(){function e(){Te(this,e),this.validComponentCalled={}}return Pe(e,[{key:"validateRequiredComponents",value:function(e){var t,n=e.name,i=e.constructor,a=je(this.getRequiredComponentNames(i));try{for(a.s();!(t=a.n()).done;){var r=t.value;if(!e.getComponent(r))throw new Error(`${n}: Missing required ${r} component`)}}catch(e){a.e(e)}finally{a.f()}}},{key:"validateRequiredProperties",value:function(e){var t,n=e.name,i=e.constructor,a=je(this.getRequiredPropNames(i));try{for(a.s();!(t=a.n()).done;){var r=t.value;if(!bt.hasOwn(e,r))throw new Error(`${n}: Missing required ${r} property`);var o=this.getProperty(r,e);if(!v(o))throw new Error(`${n}: ${r} property is not a cc object`)}}catch(e){a.e(e)}finally{a.f()}}},{key:"validateCustomProperties",value:function(e){var t,n=e.name,i=je(this.getCustomPropNames(e));try{for(i.s();!(t=i.n()).done;){var a=t.value;if(!bt.hasOwn(e,a))throw new Error(`${n}: Missing required ${a} property`);var r=this.getProperty(a,e);if(!v(r))throw new Error(`${n}: ${a} property is not a cc object`)}}catch(e){i.e(e)}finally{i.f()}}},{key:"getProperty",value:function(e,t){var n;if(bt.hasOwn(t,e))return(null!==(n=Object.getOwnPropertyDescriptor(t,e))&&void 0!==n?n:{}).value}},{key:"getProps",value:function(e){if(!bt.hasOwn(e,"__props__"))return[];var t=e.__props__;return Array.isArray(t)?t:[]}},{key:"getRequiredPropNames",value:function(e){return this.getProps(e).filter((function(t){return"node"!==t&&(!!bt.hasOwn(e,t)&&(!!v(e[t])&&!t.startsWith("_")))}))}},{key:"getBaseComponentName",value:function(e){for(var t=0,n=kt;t<n.length;t++){var i=n[t];if(i.indexOf(e)>=0)return i}return e}},{key:"getRequiredComponentNames",value:function(e){var t=this;if(!bt.hasOwn(e,"_requireComponent"))return[];var n=e._requireComponent;return Array.isArray(n)?n.map((function(e){return t.getBaseComponentName(e)})):[]}},{key:"getCustomPropNames",value:function(e){var t=this,n=Object.keys(e),i=this.getProps(e.constructor);return gt.difference(n,i).filter((function(e){return!e.startsWith("_")})).filter((function(n){if(!bt.hasOwn(e,n))return!1;var i=t.getProperty(n,e);return!(!wt.isObject(i)||!v(i))}))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"lazyValidateProperties",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t){var n=e.constructor,i=n.name;if(!this.inst.validComponentCalled[i])try{this.inst.validateRequiredComponents(e),this.inst.validateRequiredProperties(e),this.inst.validateCustomProperties(e)}catch(t){e.enabled=!1,console.error(t)}finally{this.inst.validComponentCalled[i]=!0}}}}]),e}();try{new St}catch(e){console.error("ComponentUtils",e)}n._RF.pop(),n._RF.push({},"60ac3vor0dMT5bXi8D3VSJN","BubbleAnimation",void 0);var Ct=i.ccclass,Et=i.property;lt=Ct("BubbleAnimation"),ut=Et(y),ct=Et(m),ht=Et(g),lt((ft=$e((dt=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"animation",ft,Ne(e)),Xe(e,"clipName",vt,Ne(e)),Xe(e,"repeat",yt,Ne(e)),e.currentRepeat=-1,e}return Pe(n,[{key:"__preload",value:function(){this.animation=this.getComponent(y),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"play",value:function(){var e=this;this.animation&&(this.animation.clips.find((function(t){return(null==t?void 0:t.name)===e.clipName}))?(this.currentRepeat=-1,this.animation.play(this.clipName)):console.warn(`BubbleAnimation: Animation component must have ${this.clipName} clip`))}},{key:"onBubbleAnimationLoop",value:function(){this.animation&&-1!==this.repeat&&(this.currentRepeat++,this.currentRepeat>this.repeat&&this.animation.stop())}}]),n}(f)).prototype,"animation",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vt=$e(dt.prototype,"clipName",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Bubble"}}),yt=$e(dt.prototype,"repeat",[ht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),pt=dt));n._RF.pop(),n._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);var At=function(e){Ie(n,GameCore.Plugins.Audio.BaseAudioPlayer);var t=Be(n);function n(e,i){var a;return Te(this,n),(a=t.call(this,e)).audioSource=i,a}return Pe(n,[{key:"play",value:function(e){if(e){var t=e.volume,n=void 0===t?1:t,i=e.loop,a=void 0!==i&&i;this.audioSource.volume=n,this.audioSource.loop=a}this.audioSource.play()}},{key:"pause",value:function(){this.audioSource.pause()}},{key:"resume",value:function(){this.audioSource.state===b.AudioState.PAUSED&&this.audioSource.play()}},{key:"stop",value:function(){this.audioSource.stop()}},{key:"setVolume",value:function(e){this.audioSource.volume=e}},{key:"getAudioSource",value:function(){return this.audioSource}}]),n}();n._RF.pop(),n._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);var Tt=function(e){Ie(i,e);var t,n=Be(i);function i(e,t){var a;return Te(this,i),(a=n.call(this,t)).allowMultipleTracking={},a.handleLoadedAudio=function(e,t){var n=a.node.addComponent(b);return n.clip=t,n.playOnAwake=!1,new At(e,n)},a.node=e,a}return Pe(i,[{key:"playing",value:function(e){var t,n=null===(t=this.getAudioClip(e))||void 0===t?void 0:t.audioPlayer;return!!n&&n.getAudioSource().state===b.AudioState.PLAYING}},{key:"onLoadAudio",value:(t=Ae(Se().mark((function e(t,n){var i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){w.load(t,k,(function(a,r){try{if(a)throw new Error(a.message);if(!i.node.isValid)return;var o=i.handleLoadedAudio(t,r);e(o)}catch(a){a instanceof Error?n(a):n(new Error("Audio load: Unknown error"))}}))})));case 1:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})},{key:"playWithRealConfig",value:function(e,t){if(this.isCanPlay(t)){if(t){var n=t.volume,i=void 0===n?1:n,a=t.allowMultiple,r=void 0!==a&&a;if(t.volume=this.getVolume()*i,r)return void this.requestDuplicateAudioPlayer(e.getKey(),e.getAudioSource().clip,t).play(t)}e.play(t)}}},{key:"isCanPlay",value:function(e){var t=this;if(e){var n=e.checkList;if((void 0===n?[]:n).some((function(e){var n=t.getAudioClip(e);return!!n&&n.audioPlayer.getAudioSource().state===b.AudioState.PLAYING})))return!1}return!0}},{key:"requestDuplicateAudioPlayer",value:function(e,t,n){var i=this.getDuplicateAudioFromPool(e);if(i){if(n){var a=i.key,r=n.volume,o=void 0===r?1:r;this.setAudioClip(a,{volume:o})}return i.audioPlayer}var s=`${e}_${this.allowMultipleTracking[e].currentPostFix}`,l=this.handleLoadedAudio(s,t);return this.allowMultipleTracking[e].list.push({audioPlayer:l,key:s}),this.allowMultipleTracking[e].currentPostFix+=1,this.setAudioClip(s,{audioPlayer:l,volume:1}),l}},{key:"getDuplicateAudioFromPool",value:function(e){if(this.allowMultipleTracking[e]){var t=this.allowMultipleTracking[e].list.find((function(e){return e.audioPlayer.getAudioSource().state!==b.AudioState.PLAYING}));if(t)return t}else this.allowMultipleTracking[e]={currentPostFix:1,list:[]};return null}}]),i}(GameCore.Plugins.Audio.BaseChannelManager);n._RF.pop();var xt,Pt,Rt,It,_t;n._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);var Lt,Ot,Dt,Mt,Nt,Ft=i.ccclass,Bt=i.property,Gt=globalThis.game,zt=Gt.audio,Ut=Gt.player,Ht=(xt=Ft("Music"),Pt=Bt(m),xt((_t=$e((It=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"channelId",_t,Ne(e)),e.channel=null,e}return Pe(n,[{key:"__preload",value:function(){this.makePersistent(),this.channel=new Tt(this.node,this.channelId),zt.addChannel(this.channel)}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"playing",value:function(e){var t,n;return null!==(t=null===(n=this.channel)||void 0===n?void 0:n.playing(e))&&void 0!==t&&t}},{key:"play",value:function(e,t){var n;this.isMusicEnable()&&(null!==(n=t)&&void 0!==n&&n.loop||(t=ke(ke({},t),{},{loop:!0})),zt.play(e,t,this.channelId))}},{key:"isMusicEnable",value:function(){return!!Ut.getPlayerSetting("music")}},{key:"setVolume",value:function(e){zt.setVolume(e,this.channelId)}},{key:"pause",value:function(e){zt.pause(e,this.channelId)}},{key:"resume",value:function(e){this.isMusicEnable()&&zt.resume(e,this.channelId)}},{key:"stop",value:function(e){zt.stop(e,this.channelId)}},{key:"mute",value:function(e){e?zt.mute(this.channelId):zt.unmute(this.channelId)}}]),n}(f)).prototype,"channelId",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),Rt=It))||Rt);n._RF.pop(),n._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);var qt=i.ccclass,Vt=i.property,Wt=globalThis.game,Kt=Wt.audio,jt=Wt.player,Yt=(Lt=qt("Sound"),Ot=Vt(m),Lt((Nt=$e((Mt=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"channelId",Nt,Ne(e)),e.channel=null,e}return Pe(n,[{key:"__preload",value:function(){this.channel=new Tt(this.node,this.channelId),Kt.addChannel(this.channel)}},{key:"onLoad",value:function(){""===this.channelId&&(this.channelId=this.node.uuid)}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"removePersistent",value:function(){d.removePersistRootNode(this.node)}},{key:"play",value:function(e,t){this.isSoundEnable()&&Kt.play(e,t,this.channelId)}},{key:"isSoundEnable",value:function(){return!!jt.getPlayerSetting("sound")}},{key:"setVolume",value:function(e){Kt.setVolume(e,this.channelId)}},{key:"pause",value:function(e){Kt.pause(e,this.channelId)}},{key:"resume",value:function(e){this.isSoundEnable()&&Kt.resume(e,this.channelId)}},{key:"stop",value:function(e){Kt.stop(e,this.channelId)}},{key:"stopAll",value:function(){Kt.stopAll(this.channelId)}},{key:"mute",value:function(e){e?Kt.mute(this.channelId):Kt.unmute(this.channelId)}}]),n}(f)).prototype,"channelId",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Dt=Mt))||Dt);n._RF.pop(),n._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);var Xt,$t,Jt,Qt,Zt,en,tn,nn,an,rn,on,sn,ln,un,cn,hn,pn,dn,fn,vn,yn=function(){function e(){Te(this,e)}return Pe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"elasticOut",value:function(e,t,n){if(void 0===t&&(t=.1),void 0===n&&(n=.1),0===e)return 0;if(1===e)return 1;var i=n/4;return t<1?t=1:i=n*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*e)*Math.sin((e-i)*(2*Math.PI)/n)+1}},{key:"easeOutExpo",value:function(e){return 1===e?1:1-Math.pow(2,-10*e)}},{key:"easeInExpo",value:function(e){return 0===e?0:Math.pow(2,10*e-10)}},{key:"runTweenAsync",value:function(e,t){return new Promise((function(n){var i=e.call((function(){n({tween:e})})).start();t&&(t.aborted?(i.stop(),n({tween:e})):t.addAbortListener((function(){i.stop(),n({tween:e})})))}))}},{key:"waitTweenAsync",value:function(e,t){return new Promise((function(n){var i=S({});i.delay(e),i.call((function(){n()})),i.start(),t&&(t.aborted?(i.stop(),n()):t.addAbortListener((function(){i.stop(),n()})))}))}},{key:"runAnimationAsync",value:function(e,t){return new Promise((function(n){e.play(t),e.once(y.EventType.FINISHED,(function(){n()}))}))}}]),e}();try{new yn}catch(e){console.error("AnimUtils",e)}n._RF.pop(),n._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);var mn=i.ccclass,gn=i.property,bn=(Xt=mn("AutoLayoutWrappee"),$t=gn({type:s}),Jt=gn({type:s}),Xt((en=$e((Zt=Pe((function e(){Te(this,e),Xe(this,"wrapeeContainer",en,this),Xe(this,"wrapee",tn,this)}))).prototype,"wrapeeContainer",[$t],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tn=$e(Zt.prototype,"wrapee",[Jt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qt=Zt))||Qt),wn=(nn=mn("AutoLayout"),an=gn({displayName:"Use Auto Layout"}),rn=gn({type:[bn],displayName:"Children",visible(){return this.useAutoLayout}}),on=gn({visible:!1,serializable:!0}),sn=gn({type:g,displayName:"Selected Index",visible(){return this.useAutoLayout}}),ln=gn({type:C,displayName:"Deselected Icon Width",group:"Edge Icons",visible(){return this.useAutoLayout}}),un=gn({visible:!1,serializable:!0}),nn((pn=$e((hn=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"useAutoLayout",pn,Ne(e)),Xe(e,"children",dn,Ne(e)),e.mappedChildren=[],Xe(e,"selected",fn,Ne(e)),Xe(e,"deselectedIconW",vn,Ne(e)),e.tweens=[],e}return Pe(i,[{key:"selectedIndex",get:function(){return this.selected},set:function(e){this.selected=e,this.updateLayout(!0)}},{key:"deselectedIconWidth",get:function(){return this.deselectedIconW},set:function(e){this.deselectedIconW=e,this.updateLayout(!0)}},{key:"__preload",value:function(){this.mappedChildren=this.children.map((function(e){var t=e.wrapeeContainer.getComponent(E);if(!t)throw new Error("AutoLayout: Widget component not found");return ke(ke({},e),{},{wrapeeContainerWidget:t})}))}},{key:"updateLayout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._layoutDirty||e)&&(this.updateChildrenAnchors(),this.mappedChildren.forEach((function(e){return e.wrapeeContainerWidget.updateAlignment()}))),ze(_e(i.prototype),"updateLayout",this).call(this,e)}},{key:"getSelectedWorldX",value:function(){var e=this.mappedChildren[this.selectedIndex].wrapeeContainer;return 0===this.selectedIndex||this.selectedIndex===this.children.length-1?e.getBoundingBoxToWorld().xMin+this.getAnchorX(this.selectedIndex)*e.width:e.getBoundingBoxToWorld().center.x}},{key:"getAnchorX",value:function(e){if(e<this.selectedIndex)return 0;if(e>this.selectedIndex)return 1;if(0===e){var t=this.mappedChildren[e].wrapeeContainer.width,n=this.deselectedIconWidth/2,i=this.paddingLeft;return((i+t+(t-n+this.spacingX))/2-i)/t}if(e===this.children.length-1){var a=this.mappedChildren[e].wrapeeContainer.width,r=a-this.deselectedIconWidth/2+this.spacingX;return((r+a+this.paddingRight)/2-r)/a}return.5}},{key:"updateChildrenAnchors",value:(t=Ae(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.tweens.forEach((function(e){return e.stop()})),this.tweens=[],e.next=4,Promise.all([this.children.flatMap((function(e,n){return t.getChildrenAnchorsTweens(e,t.getAnchorX(n))})).map((function(e){return yn.runTweenAsync(e)}))]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateChildrenAnchorsEditor",value:function(){var e=this;this.children.forEach((function(t,n){var i=e.getAnchorX(n);t.wrapee.setAnchorPoint(i,t.wrapee.anchorY),t.wrapeeContainer.setAnchorPoint(i,t.wrapeeContainer.anchorY)}))}},{key:"getChildrenAnchorsTweens",value:function(e,t){return[S(e.wrapee).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapee.setAnchorPoint(t,e.wrapee.anchorY)})),S(e.wrapeeContainer).to(.3,{anchorX:t},{easing:"sineInOut"}).call((function(){e.wrapeeContainer.setAnchorPoint(t,e.wrapeeContainer.anchorY)}))]}}]),i}(A)).prototype,"useAutoLayout",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),dn=$e(hn.prototype,"children",[rn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fn=$e(hn.prototype,"selected",[on],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$e(hn.prototype,"selectedIndex",[sn],Object.getOwnPropertyDescriptor(hn.prototype,"selectedIndex"),hn.prototype),$e(hn.prototype,"deselectedIconWidth",[ln],Object.getOwnPropertyDescriptor(hn.prototype,"deselectedIconWidth"),hn.prototype),vn=$e(hn.prototype,"deselectedIconW",[un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cn=hn))||cn);n._RF.pop(),n._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);var kn="view-resize",Sn="view-resized",Cn="request-view-resize",En="layout-changed",An="gameplay-update-config",Tn="opened-skip-overlay",xn="closed-skip-overlay",Pn="result-scene-replay",Rn="result-scene-home",In="upgrade-quality",_n="upgrade-dynamic-atlas";n._RF.pop(),n._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);var Ln,On,Dn,Mn,Nn,Fn={Portrait:"portrait",Landscape:"landscape"},Bn={Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}};n._RF.pop(),n._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);var Gn=i.ccclass,zn=i.property;Ln=Gn("Background"),On=zn({type:T}),Ln((Nn=$e((Mn=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"sprite",Nn,Ne(e)),e.handleSpriteTypeWhenLayoutChanged=function(t){t===Fn.Landscape?e.setBackgroundType(T.Type.TILED):e.setBackgroundType(T.Type.SIMPLE)},e}return Pe(n,[{key:"__preload",value:function(){this.sprite=this.getComponent(T),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){x.on(En,this.handleSpriteTypeWhenLayoutChanged)}},{key:"setBackgroundType",value:function(e){this.sprite&&(this.sprite.type=e)}}]),n}(f)).prototype,"sprite",[On],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dn=Mn));n._RF.pop(),n._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var Un=function(e){return e.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",e.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",e.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",e.COLLECTIONS_CONTENT_PREFAB="game-objects/dashboard-scene/CollectionsContent",e.CLOUD_IDLE_ANIM="animations/CloudIdle",e.TORNADO_IDLE_ANIM="animations/TornadoIdle",e.TILE_BREAK_ANIM="animations/TileBreak",e.TILE_CLEAR_ANIM="animations/TileClear",e.TILE_SHAKE_ANIM="animations/TileShake",e.TILE_SKIN_FOLDER="loadable/tiles",e.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",e.ITEM_POPUP_FOLDER="loadable/item-popup",e.SUMMER_BG="images/bg/summer",e.AUTUMN_BG="images/bg/autumn",e.WINTER_BG="images/bg/winter",e.SUMMER_BG_PREVIEW="images/preview/summer",e.AUTUMN_BG_PREVIEW="images/preview/autumn",e.WINTER_BG_PREVIEW="images/preview/winter",e.COLLECTIONS_PAGE="pages/CollectionsContent",e.LEADERBOARD_PAGE="pages/LeaderboardContent",e.TOURNAMENTS_PAGE="pages/TournamentsContent",e.LEVEL_DATA_FOLDER="levels-json",e}(Un||{});n._RF.pop(),n._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);var Hn={summer:Un.SUMMER_BG,autumn:Un.AUTUMN_BG,winter:Un.WINTER_BG},qn={summer:Un.SUMMER_BG_PREVIEW,autumn:Un.AUTUMN_BG_PREVIEW,winter:Un.WINTER_BG_PREVIEW};n._RF.pop(),n._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);var Vn,Wn,Kn,jn,Yn,Xn,$n,Jn=function(){function e(){Te(this,e)}var t,n,i,a,r,o,s,l,u,c;return Pe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"setBlockInput",value:function(e){var t=P("Canvas/InputBlocker");t?t.active=e:console.warn("InputBlocker not found")}},{key:"getBlockInput",value:function(){var e=P("Canvas/InputBlocker");return e?e.active:(console.warn("InputBlocker not found"),!1)}},{key:"loadPrefabAsync",value:function(e){var t=w.getInfoWithPath(e,R);if(t&&null!==w.get(t.path,R)){var n=w.get(t.path,R);if(null!==n)return Promise.resolve(n)}return new Promise((function(t){w.load(e,R,(function(e,n){e&&t(null),t(n)}))}))}},{key:"loadJsonAsync",value:(c=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=w.getInfoWithPath(t,I);if(n&&null!==w.get(n.path,I)){var i=w.get(n.path,I);null!==i&&e(i.json)}w.load(t,I,(function(t,n){t&&e(null),n&&n.json||e(null),e(n.json)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return c.apply(this,arguments)})},{key:"loadAnimClipAsync",value:(u=Ae(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=w.getInfoWithPath(t,_))||null===w.get(n.path,_)){e.next=5;break}if(null===(i=w.get(n.path,_))){e.next=5;break}return e.abrupt("return",Promise.resolve(i));case 5:return e.abrupt("return",new Promise((function(e){w.load(t,_,(function(t,n){t&&e(null),e(n)}))})));case 6:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})},{key:"loadImageSpriteFrameAsync",value:(l=Ae(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=w.getInfoWithPath(t,L))||null===w.get(n.path,L)){e.next=5;break}if(null===(i=w.get(n.path,L))){e.next=5;break}return e.abrupt("return",Promise.resolve(O.createWithImage(i)));case 5:return e.abrupt("return",new Promise((function(e){w.load(t,L,(function(t,n){t&&e(null),e(O.createWithImage(n))}))})));case 6:case"end":return e.stop()}}),e)}))),function(e){return l.apply(this,arguments)})},{key:"loadSpriteFrameAsync",value:(s=Ae(Se().mark((function e(t){var n,i,a,r=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!(r.length>1&&void 0!==r[1])||r[1],!(i=w.getInfoWithPath(t,O))||null===w.get(i.path,O)){e.next=7;break}if(null===(a=w.get(i.path,O))){e.next=7;break}return a.packable=n,e.abrupt("return",Promise.resolve(a));case 7:return e.abrupt("return",new Promise((function(e){w.load(t,O,(function(t,i){!t&&i?(i.packable=n,e(i)):e(null)}))})));case 8:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"loadSpriteFramesDirAsync",value:(o=Ae(Se().mark((function e(t){var n,i,a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((n=w.getDirWithPath(t,O)).length>0)){e.next=23;break}i=[],a=je(n),e.prev=4,a.s();case 6:if((r=a.n()).done){e.next=14;break}if(o=r.value,s=w.get(o.path,O)){e.next=11;break}return e.abrupt("return",this.loadSpriteFramesFromDirAsync(t));case 11:i.push(s);case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),a.e(e.t0);case 19:return e.prev=19,a.f(),e.finish(19);case 22:return e.abrupt("return",i);case 23:return e.abrupt("return",this.loadSpriteFramesFromDirAsync(t));case 24:case"end":return e.stop()}}),e,this,[[4,16,19,22]])}))),function(e){return o.apply(this,arguments)})},{key:"loadSpriteFramesFromDirAsync",value:(r=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){w.loadDir(t,O,(function(t,n){t&&e([]),e(n)}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"lazyLoadDashboardSceneResourcesAsync",value:(a=Ae(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.loadPrefabAsync(Un.COLLECTIONS_CONTENT_PREFAB));case 1:case"end":return t.stop()}}),t)}))),function(){return a.apply(this,arguments)})},{key:"loadThemeAsync",value:(i=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.loadSpriteFrameAsync(`${Hn[t]}/spriteFrame`));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"loadThemePreviewAsync",value:(n=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.loadSpriteFrameAsync(`${qn[t]}/spriteFrame`));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"loadSkinPreviewAsync",value:(t=Ae(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],i=1;i<=4;i++)a=`${Un.TILE_SKIN_PREVIEW_FOLDER}/${t.replace(/-/g,"_")}_${i}/spriteFrame`,n.push(this.loadSpriteFrameAsync(a));return e.abrupt("return",Promise.all(n));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();try{new Jn}catch(e){console.error("GeneralUtils",e)}n._RF.pop(),n._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);var Qn=i.ccclass,Zn=i.property,ei=(Vn=Qn("MultiBackground"),Wn=Zn({type:T}),Kn=Zn({type:T}),Vn((Xn=$e((Yn=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"background1",Xn,Ne(e)),Xe(e,"background2",$n,Ne(e)),e.currentThemeId="",e}return Pe(a,[{key:"__preload",value:function(){this.currentBackground=this.background1,this.nextBackground=this.background2,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"setCurrentTheme",value:(n=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn.loadThemeAsync(t);case 2:if(n=e.sent){e.next=5;break}return e.abrupt("return");case 5:n.packable=!1,this.background1.spriteFrame=n,this.background2.spriteFrame=n,this.currentThemeId=t;case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"onDestroy",value:function(){var e;null===(e=this.tween)||void 0===e||e.stop()}},{key:"animateToNextTheme",value:(t=Ae(Se().mark((function e(t){var n,i,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentThemeId!==t){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Jn.loadThemeAsync(t);case 4:if(n=e.sent){e.next=7;break}return e.abrupt("return");case 7:if(n.packable=!1,this.currentThemeId=t,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=n,this.nextBackground.node.setSiblingIndex(1),i=this.nextBackground.getComponent(M)){e.next=15;break}throw new Error(`${this.nextBackground.node.name} UIOpacity is required`);case 15:return i.opacity=0,this.tween=S({progress:0}),this.tween.to(3,{progress:255},{progress:function(e,t,n,a){var r=Math.floor(e+(t-e)*D.sineOut(a));return i.opacity=r,r}}),this.tween.call((function(){a.currentBackground.node.active=!1;var e=a.currentBackground;a.currentBackground=a.nextBackground,a.nextBackground=e})),e.abrupt("return",yn.runTweenAsync(this.tween));case 20:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(f)).prototype,"background1",[Wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$n=$e(Yn.prototype,"background2",[Kn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jn=Yn))||jn);n._RF.pop(),n._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);var ti={BUTTON_CLICK:"sounds/use_item_click",BOMB_DEFUSE:"sounds/bomb_defuse",BOMB_EXPLODE_1:"sounds/bomb_explode_1",BOMB_EXPLODE_2:"sounds/bomb_explode_2",CLICKS:"sounds/clicks",CLOSE_POPUP_CLICK:"sounds/close_popup_click",COLLECT_STARS:"sounds/collect_stars",COMBO_1:"sounds/combo_1",COMBO_2:"sounds/combo_2",COMBO_3:"sounds/combo_3",COMBO_4:"sounds/combo_4",COMBO_5:"sounds/combo_5",DAILY_REWARD:"sounds/daily_reward",EXTRA_TIME_SPAWN:"sounds/extra_time_spawn",GIFT_CHARGE:"sounds/gift_charge",GIFT_EXPLODE:"sounds/gift_explode",GIFT_REVEAL:"sounds/gift_reveal",HINT_ITEM:"sounds/hint_item",INVALID_MATCH:"sounds/invalid_match",LEVEL_COMPLETE:"sounds/level_complete",LEVEL_FAIL:"sounds/level_fail",LEVEL_START:"sounds/level_start",PROGRESS_STAR:"sounds/progress_star",RESCUE_TIMER:"sounds/rescue_timer",ROCKET_FLY:"sounds/rocket_fly",SHUFFLE_ITEM:"sounds/shuffle_item",THREE_STARS:"sounds/three_stars",TICKING_BOMB_BEFORE_EXPLODE:"sounds/ticking_bomb_before_explode",TILE_SELECT:"sounds/tile_select",USE_ITEM_CLICK:"sounds/use_item_click",BG_MUSIC:"musics/bg_music",PATCH_SHIFT:"sounds/patch_shift",THUNDERBOLT:"sounds/thunderbolt",WIND:"sounds/wind",COLLECT_COINS:"sounds/collect_coins",COLLECT_STOCK_COINS:"sounds/collect_stock_coins",LEVEL_FAIL_TIMEOUT:"sounds/level_fail_timeout",STAR_CHEST_DRUM_ROLL:"sounds/star_chest_drum_roll",STAR_CHEST_OPEN:"sounds/star_chest_open",LEADERBOARD_TRIUMPH:"sounds/leaderboard_triumph",ITEM_REWARD:"sounds/item_reward"},ni=Object.values(ti),ii=ni.reduce((function(e,t,n){return ke(ke({},e),{},{[t]:n})}),{});N(ii);var ai=ni;n._RF.pop(),n._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var ri="RescuesScreen",oi="LoadingScreen",si="GetItemScreen",li="GetCoinScreen",ui="SettingsScreen",ci="NotificationScreen",hi="LevelCompleteScreen",pi="CongratulationScreen",di="QuitLevelScreen",fi="TournamentDetailScreen",vi="DailyRewardsScreen",yi="StarChestScreen",mi=[ci,oi];n._RF.pop(),n._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);var gi=globalThis.game.analytics,bi=function(){function e(){Te(this,e)}return Pe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"trackCurrentPage",value:function(e,t){if(!mi.includes(e)&&(t||this.trackingPages.includes(e))){this.trackingPages=this.trackingPages.filter((function(t){return t!==e})),t&&this.trackingPages.push(e);var n=this.getCurrentPage();gi.pageview(n)}}},{key:"switchSceneTracking",value:function(){this.trackingPages=[];var e=this.getCurrentPage();gi.pageview(e)}},{key:"getCurrentPage",value:function(){var e,t;return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:null!==(e=null===(t=d.getScene())||void 0===t?void 0:t.name)&&void 0!==e?e:"Unknown Scene"}}]),e}();bi.trackingPages=[];try{new bi}catch(e){console.error("AnalyticsUtils",e)}n._RF.pop(),n._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);var wi=function(){function e(){Te(this,e)}return Pe(e,[{key:"sound",get:function(){var e,t;return null!==(e=null===(t=P("Sound"))||void 0===t?void 0:t.getComponent(Yt))&&void 0!==e?e:null}},{key:"music",get:function(){var e,t;return null!==(e=null===(t=P("Music"))||void 0===t?void 0:t.getComponent(Ht))&&void 0!==e?e:null}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"muteAudio",value:function(e){this.muteMusic(e),this.muteSound(e)}},{key:"playSound",value:function(e,t){var n;null===(n=this.inst.sound)||void 0===n||n.play(e,t)}},{key:"pauseSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.pause(e)}},{key:"resumeSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.resume(e)}},{key:"stopSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.stop(e)}},{key:"stopAllSounds",value:function(){var e;null===(e=this.inst.sound)||void 0===e||e.stopAll()}},{key:"muteSound",value:function(e){var t;null===(t=this.inst.sound)||void 0===t||t.mute(e)}},{key:"playMusic",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!n&&null!==(e=this.inst.music)&&void 0!==e&&e.playing(ti.BG_MUSIC)||null===(t=this.inst.music)||void 0===t||t.play(ti.BG_MUSIC)}},{key:"pauseMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.pause(ti.BG_MUSIC)}},{key:"muteMusic",value:function(e){var t;null===(t=this.inst.music)||void 0===t||t.mute(e)}},{key:"turnUpMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(.8)}},{key:"turnDownMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(.4)}},{key:"turnOffMusic",value:function(){var e;null===(e=this.inst.music)||void 0===e||e.setVolume(0)}}]),e}();try{new wi}catch(e){console.error("AudioUtils",e)}n._RF.pop(),n._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);var ki,Si,Ci,Ei,Ai,Ti,xi,Pi,Ri,Ii,_i,Li,Oi,Di,Mi,Ni,Fi,Bi,Gi,zi,Ui,Hi,qi,Vi,Wi,Ki,ji,Yi,Xi,$i,Ji,Qi,Zi,ea=function(){function e(){Te(this,e)}return Pe(e,[{key:"getWindowSizeVsWorldGameRatio",value:function(){var e=F.getVisibleSize();return B.windowSize.width/window.devicePixelRatio/e.width}},{key:"getBoundingBoxTo",value:function(e,t){var n=G.mat4();G.Mat4.fromSRT(n,t.getRotation(),t.getPosition(),t.getScale());var i=t.getComponent(s);if(!i)throw new Error("Node must have UITransform component");var a=i.anchorPoint,r=i.contentSize,o=r.width,l=r.height,u=new G.Rect(-a.x*o,-a.y*l,o,l),c=G.mat4();if(G.Mat4.multiply(c,e,n),u.transformMat4(c),!t.children||0===t.children.length)return u;var h,p=t.children,d=t.getWorldMatrix(),f=je(p);try{for(f.s();!(h=f.n()).done;){var v=h.value;if(null!=v&&v.active)if(v.getComponent(s)){var y=this.getBoundingBoxTo(d,v);y&&G.Rect.union(u,u,y)}}}catch(e){f.e(e)}finally{f.f()}return u}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"getBoundingBoxToWorld",value:function(e){if(e.parent){var t=e.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(t,e)}var n=e.getComponent(s);if(!n)throw new Error("Node must have UITransform component");return n.getBoundingBox()}},{key:"worldSizeToCssSize",value:function(e){return e*this.inst.getWindowSizeVsWorldGameRatio()}},{key:"cssSizeToWorldSize",value:function(e){return e/this.inst.getWindowSizeVsWorldGameRatio()}},{key:"getScreenWidthCss",value:function(){var e=document,t=e.body,n=e.documentElement,i=t.clientWidth,a=n.clientWidth;return Math.max(a,i)||0}},{key:"getScreenHeightCss",value:function(){var e=document,t=e.body,n=e.documentElement,i=t.clientHeight,a=n.clientHeight;return Math.max(a,i)||0}}]),e}();try{new ea}catch(e){console.error("CocosUtils",e)}n._RF.pop(),n._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);var ta=i.ccclass,na=i.property,ia=i.disallowMultiple,aa=i.executionOrder,ra=globalThis.game.analytics,oa=(ki=ta("ExtendedButton"),Si=aa(111),Ci=na(z),Ei=na(z),Ai=na(U.AnimationController),Ti=na({override:!0,visible:!1}),xi=na({override:!0,visible:!1}),Pi=na({override:!0,visible:!1}),Ri=na({override:!0,visible:!1}),Ii=na({override:!0,visible:!1}),_i=na({override:!0,visible:!1}),Li=na({override:!0,visible:!1}),Oi=na({override:!0,visible:!1}),Di=na({override:!0,visible:!1}),Mi=na({override:!0,visible:!1}),Ni=na({override:!0,visible:!1}),Fi=na(H),Bi=na(H),Gi=na(H),zi=na({visible(){return this.makeSound},type:ii}),Ui=na({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),Hi=na({visible(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),ki(qi=ia(qi=Si((Wi=$e((Vi=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"clickStartEvents",Wi,Ne(e)),Xe(e,"clickEndEvents",Ki,Ne(e)),Xe(e,"animationController",ji,Ne(e)),Xe(e,"useDesktopHover",Yi,Ne(e)),Xe(e,"emitAnalyticsEvents",Xi,Ne(e)),Xe(e,"makeSound",$i,Ne(e)),Xe(e,"soundKey",Ji,Ne(e)),Xe(e,"disableSpamClick",Qi,Ne(e)),Xe(e,"disableSpamDelay",Zi,Ne(e)),e.currentClickBoundingBox=null,e.hasDown=!1,e.hasUp=!1,e.hasFinishClickCycle=!1,e.onTouchStart=function(t){e.interactable&&(e.hasDown||(e.currentClickBoundingBox=ea.getBoundingBoxToWorld(e.node),e.handleDown(t)))},e.onTouchEnd=function(t){e.interactable&&e.hasDown&&(e.hasUp||e.handleUp(t))},e.onTouchCancel=function(t){var n,i;if(e.interactable&&e.hasDown&&!e.hasUp){var a=t.getUILocation();null!==(n=null===(i=e.currentClickBoundingBox)||void 0===i?void 0:i.contains(a))&&void 0!==n&&n?e.handleUp(t):(e.hasUp=!0,e.hasFinishClickCycle=!0,e.handleResetButtonState(),e.emitClickEndEvents(t))}},e.onMouseEnter=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||(e.hasFinishClickCycle=!1,e.setAnimationState("HOVER")))},e.onMouseLeave=function(t){e.useDesktopHover&&e.interactable&&(e.hasDown||e.hasUp||e.hasFinishClickCycle||e.handleResetButtonState())},e.handleResetButtonState=function(){e.hasDown=!1,e.hasUp=!1,e.setAnimationState("RESET")},e}return Pe(n,[{key:"transition",get:function(){return p.Transition.NONE},set:function(e){He(_e(n.prototype),"transition",p.Transition.NONE,this,!0)}},{key:"normalColor",get:function(){return ze(_e(n.prototype),"normalColor",this)},set:function(e){He(_e(n.prototype),"normalColor",e,this,!0)}},{key:"pressedColor",get:function(){return ze(_e(n.prototype),"pressedColor",this)},set:function(e){He(_e(n.prototype),"pressedColor",e,this,!0)}},{key:"hoverColor",get:function(){return ze(_e(n.prototype),"hoverColor",this)},set:function(e){He(_e(n.prototype),"hoverColor",e,this,!0)}},{key:"disabledColor",get:function(){return ze(_e(n.prototype),"disabledColor",this)},set:function(e){He(_e(n.prototype),"disabledColor",e,this,!0)}},{key:"normalSprite",get:function(){return ze(_e(n.prototype),"normalSprite",this)},set:function(e){He(_e(n.prototype),"normalSprite",e,this,!0)}},{key:"pressedSprite",get:function(){return ze(_e(n.prototype),"pressedSprite",this)},set:function(e){He(_e(n.prototype),"pressedSprite",e,this,!0)}},{key:"hoverSprite",get:function(){return ze(_e(n.prototype),"hoverSprite",this)},set:function(e){He(_e(n.prototype),"hoverSprite",e,this,!0)}},{key:"disabledSprite",get:function(){return ze(_e(n.prototype),"disabledSprite",this)},set:function(e){He(_e(n.prototype),"disabledSprite",e,this,!0)}},{key:"duration",get:function(){return ze(_e(n.prototype),"duration",this)},set:function(e){He(_e(n.prototype),"duration",e,this,!0)}},{key:"zoomScale",get:function(){return ze(_e(n.prototype),"zoomScale",this)},set:function(e){He(_e(n.prototype),"zoomScale",e,this,!0)}},{key:"__preload",value:function(){ze(_e(n.prototype),"__preload",this).call(this),St.lazyValidateProperties(this)}},{key:"onDestroy",value:function(){var e;null===(e=ze(_e(n.prototype),"onDestroy",this))||void 0===e||e.call(this)}},{key:"onEnable",value:function(){var e;null===(e=ze(_e(n.prototype),"onEnable",this))||void 0===e||e.call(this),this.node.off(q.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(a.EventType.TOUCH_START,this.onTouchStart),this.node.on(a.EventType.TOUCH_END,this.onTouchEnd),this.node.on(a.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){var e;null===(e=ze(_e(n.prototype),"onDisable",this))||void 0===e||e.call(this),this.node.off(a.EventType.TOUCH_START,this.onTouchStart),this.node.off(a.EventType.TOUCH_END,this.onTouchEnd),this.node.off(a.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}},{key:"handleDown",value:function(e){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&wi.playSound(ai[this.soundKey]),this.emitClickStartEvents(e)}},{key:"emitClickStartEvents",value:function(e){this.clickStartEvents.forEach((function(t){t.emit([e,t.customEventData])}))}},{key:"emitClickEndEvents",value:function(e){this.clickEndEvents.forEach((function(t){t.emit([e,t.customEventData])}))}},{key:"handleUp",value:function(e){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}},{key:"emitButtonEvents",value:function(e){this.interactable&&(this.emitAnalyticsEvents&&ra.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:bi.getCurrentPage()}),this.clickEvents.forEach((function(t){t.emit([e,t.customEventData])})))}},{key:"setAnimationState",value:function(e){this.animationController.setValue("DOWN","DOWN"===e),this.animationController.setValue("HOVER","HOVER"===e),this.animationController.setValue("RESET","RESET"===e)}},{key:"fakeClick",value:function(){var e=this;this.setAnimationState("DOWN"),this.scheduleOnce((function(){e.setAnimationState("RESET")}),0)}},{key:"resetButtonState",value:function(){this.handleResetButtonState()}}]),n}(p)).prototype,"clickStartEvents",[Ci],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ki=$e(Vi.prototype,"clickEndEvents",[Ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ji=$e(Vi.prototype,"animationController",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(Vi.prototype,"transition",[Ti],Object.getOwnPropertyDescriptor(Vi.prototype,"transition"),Vi.prototype),$e(Vi.prototype,"normalColor",[xi],Object.getOwnPropertyDescriptor(Vi.prototype,"normalColor"),Vi.prototype),$e(Vi.prototype,"pressedColor",[Pi],Object.getOwnPropertyDescriptor(Vi.prototype,"pressedColor"),Vi.prototype),$e(Vi.prototype,"hoverColor",[Ri],Object.getOwnPropertyDescriptor(Vi.prototype,"hoverColor"),Vi.prototype),$e(Vi.prototype,"disabledColor",[Ii],Object.getOwnPropertyDescriptor(Vi.prototype,"disabledColor"),Vi.prototype),$e(Vi.prototype,"normalSprite",[_i],Object.getOwnPropertyDescriptor(Vi.prototype,"normalSprite"),Vi.prototype),$e(Vi.prototype,"pressedSprite",[Li],Object.getOwnPropertyDescriptor(Vi.prototype,"pressedSprite"),Vi.prototype),$e(Vi.prototype,"hoverSprite",[Oi],Object.getOwnPropertyDescriptor(Vi.prototype,"hoverSprite"),Vi.prototype),$e(Vi.prototype,"disabledSprite",[Di],Object.getOwnPropertyDescriptor(Vi.prototype,"disabledSprite"),Vi.prototype),$e(Vi.prototype,"duration",[Mi],Object.getOwnPropertyDescriptor(Vi.prototype,"duration"),Vi.prototype),$e(Vi.prototype,"zoomScale",[Ni],Object.getOwnPropertyDescriptor(Vi.prototype,"zoomScale"),Vi.prototype),Yi=$e(Vi.prototype,"useDesktopHover",[Fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xi=$e(Vi.prototype,"emitAnalyticsEvents",[Bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$i=$e(Vi.prototype,"makeSound",[Gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ji=$e(Vi.prototype,"soundKey",[zi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ii[ti.BUTTON_CLICK]}}),Qi=$e(Vi.prototype,"disableSpamClick",[Ui],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Zi=$e(Vi.prototype,"disableSpamDelay",[Hi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),qi=Vi))||qi)||qi)||qi);n._RF.pop(),n._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);var sa,la,ua,ca,ha=function(){function e(){Te(this,e),this.eventTarget=new EventTarget,this.isAborted=!1}var t;return Pe(e,[{key:"aborted",get:function(){return this.isAborted}},{key:"reason",get:function(){return this.abortReason}},{key:"addAbortListener",value:function(e){this.eventTarget.addEventListener("abort",e)}},{key:"removeAbortListener",value:function(e){this.eventTarget.removeEventListener("abort",e)}},{key:"abort",value:function(e){this.isAborted||(this.isAborted=!0,this.abortReason=e,this.eventTarget.dispatchEvent(new Event("abort")))}},{key:"untilAborted",value:(t=Ae(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAborted){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){t.addAbortListener((function(){return e()}))})));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"hasBeenAborted",value:function(e){return null==e||e.aborted}}]),e}();n._RF.pop(),n._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);var pa,da,fa,va=i.ccclass,ya=i.requireComponent,ma=i.property,ga=va("OpacityToggler")(sa=ya([M])((ua=$e((la=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"activeValue",ua,Ne(e)),Xe(e,"inActiveValue",ca,Ne(e)),e.signal=new ha,e}return Pe(i,[{key:"__preload",value:function(){this.opacityComponent=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"changeState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.signal.abort(),this.opacityComponent.opacity=e?this.activeValue:this.inActiveValue}},{key:"changeStateFade",value:(t=Ae(Se().mark((function e(){var t,n,i,a=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]&&a[0],n=a.length>1&&void 0!==a[1]?a[1]:.2,this.signal.abort(),this.signal=new ha,i=t?this.activeValue:this.inActiveValue,e.next=7,yn.runTweenAsync(S(this.opacityComponent).to(n,{opacity:i}),this.signal);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"activeValue",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),ca=$e(la.prototype,"inActiveValue",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),sa=la))||sa)||sa;n._RF.pop(),n._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);var ba,wa,ka,Sa,Ca,Ea,Aa,Ta,xa,Pa,Ra,Ia,_a,La,Oa,Da,Ma,Na,Fa,Ba,Ga=i.ccclass,za=i.property,Ua=i.requireComponent,Ha=i.disallowMultiple,qa=i.executeInEditMode,Va=Bn,Wa=Va.Portrait,Ka=Va.Landscape;Ga("DebugResolution")(pa=Ha(pa=Ua([V])(pa=qa(!0)(((fa=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).handleLayoutChange=function(){var t;null===(t=e.graphics)||void 0===t||t.clear(),e.start()},e}return Pe(n,[{key:"drawPortrait",get:function(){return n._drawPortrait},set:function(e){e!==n._drawPortrait&&(e?this.drawPortraitResolution():this.graphics.clear(),n._drawPortrait=e,n._drawLandscape&&this.drawLandscapeResolution())}},{key:"drawLandscape",get:function(){return n._drawLandscape},set:function(e){e!==n._drawLandscape&&(e?this.drawLandscapeResolution():this.graphics.clear(),n._drawLandscape=e,n._drawPortrait&&this.drawPortraitResolution())}},{key:"__preload",value:function(){this.graphics=this.getComponent(V),this.validateRequiredComponents(),this.listenGameEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){x.on(En,this.handleLayoutChange)}},{key:"start",value:function(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}},{key:"drawPortraitResolution",value:function(){var e=this.graphics,t=Wa.WIDTH,n=Wa.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=r.GREEN,e.rect(i,a,t,n),e.stroke()}},{key:"drawLandscapeResolution",value:function(){var e=this.graphics,t=Ka.WIDTH,n=Ka.HEIGHT,i=-t/2,a=-n/2;e.strokeColor=r.CYAN,e.rect(i,a,t,n),e.stroke()}}]),n}(f))._drawPortrait=!0,fa._drawLandscape=!0,$e((da=fa).prototype,"drawPortrait",[za],Object.getOwnPropertyDescriptor(da.prototype,"drawPortrait"),da.prototype),$e(da.prototype,"drawLandscape",[za],Object.getOwnPropertyDescriptor(da.prototype,"drawLandscape"),da.prototype),pa=da))||pa)||pa)||pa);n._RF.pop(),n._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);var ja=i.ccclass,Ya=i.executionOrder,Xa=i.property,$a=GameCore.Utils,Ja=r.RED,Qa=r.BLACK,Za=r.MAGENTA;ba=ja("GameStats"),wa=Ya(-1e3),ka=Xa(u),Sa=Xa(u),Ca=Xa(u),Ea=Xa(u),Aa=Xa(u),Ta=Xa(u),xa=Xa(u),Pa=Xa(u),ba(Ra=wa((_a=$e((Ia=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"fpsLabel",_a,Ne(e)),Xe(e,"drawCountLabel",La,Ne(e)),Xe(e,"logicTimeLabel",Oa,Ne(e)),Xe(e,"physicTimeLabel",Da,Ne(e)),Xe(e,"renderTimeLabel",Ma,Ne(e)),Xe(e,"objectMemoryUsageLabel",Na,Ne(e)),Xe(e,"textureMemoryUsageLabel",Fa,Ne(e)),Xe(e,"devicePixelRatioLabel",Ba,Ne(e)),e.refreshInterval=.5,e.handleMouseDown=function(){e.bg.enabled=!e.bg.enabled},e.waitForStats=function(){W.stats&&(e.unschedule(e.waitForStats),e.node.active=!0,e.stats=W.stats,e.startUpdateStats())},e.updateStats=function(){e.updateFps(),e.updateDrawCalls(),e.updateLogicTime(),e.updatePhysicTime(),e.updateRenderTime(),e.updateObjectMemoryUsage(),e.updateTextureMemoryUsage(),e.updateDevicePixelRatio()},e}return Pe(n,[{key:"__preload",value:function(){this.bg=this.getComponent(T),this.validateRequiredComponents(),this.listenInputEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenInputEvents",value:function(){this.node.on(q.EventType.TOUCH_START,this.handleMouseDown)}},{key:"start",value:function(){this.bg.enabled=!1,this.node.active=!1,W&&$a.Valid.isDebugger()&&(W.showStats(),this.schedule(this.waitForStats,.5,20))}},{key:"startUpdateStats",value:function(){this.schedule(this.updateStats,this.refreshInterval)}},{key:"updateFps",value:function(){var e=this.getFps();this.updateFpsColor(e),this.fpsLabel.string=`FPS: ${e}`}},{key:"updateFpsColor",value:function(e){this.fpsLabel.color=e<30?Ja:e<48?Za:Qa}},{key:"updateDrawCalls",value:function(){var e=this.getDrawCalls();this.updateDrawCallsColor(e),this.drawCountLabel.string=`Draw Calls: ${e}`}},{key:"updateDrawCallsColor",value:function(e){var t=K.os===K.OS.IOS,n=t?80:25,i=t?60:15;this.drawCountLabel.color=e>n?Ja:e>i?Za:Qa}},{key:"updateLogicTime",value:function(){var e=this.getLogicTime();this.updateLogicTimeColor(e),this.logicTimeLabel.string=`Logic Time: ${e.toFixed(2)}ms`}},{key:"updateLogicTimeColor",value:function(e){this.logicTimeLabel.color=e>10?Ja:e>5?Za:Qa}},{key:"updatePhysicTime",value:function(){var e=this.getPhysicTime();this.updatePhysicTimeColor(e),this.physicTimeLabel.string=`Physic Time: ${e.toFixed(2)}ms`}},{key:"updatePhysicTimeColor",value:function(e){this.physicTimeLabel.color=e>10?Ja:e>5?Za:Qa}},{key:"updateRenderTime",value:function(){var e=this.getRenderTime();this.updateRenderTimeColor(e),this.renderTimeLabel.string=`Render Time: ${e.toFixed(2)}ms`}},{key:"updateRenderTimeColor",value:function(e){this.renderTimeLabel.color=e>10?Ja:e>5?Za:Qa}},{key:"updateObjectMemoryUsage",value:function(){var e=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(e),this.objectMemoryUsageLabel.string=`Object Mem: ${e.toFixed(2)}MB`}},{key:"updateObjectMemoryUsageColor",value:function(e){this.objectMemoryUsageLabel.color=e>40?Ja:e>25?Za:Qa}},{key:"updateTextureMemoryUsage",value:function(){var e=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(e),this.textureMemoryUsageLabel.string=`Texture Mem: ${e.toFixed(2)}MB`}},{key:"updateTextureMemoryUsageColor",value:function(e){this.textureMemoryUsageLabel.color=e>50?Ja:e>35?Za:Qa}},{key:"updateDevicePixelRatio",value:function(){var e=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(e),this.devicePixelRatioLabel.string=`Device Pixel Ratio: ${e}`}},{key:"updateDevicePixelRatioColor",value:function(e){this.devicePixelRatioLabel.color=e>2?Ja:e<=1?Za:Qa}},{key:"getFps",value:function(){var e=this.stats.fps.counter;return Math.floor(e.value)||0}},{key:"getDrawCalls",value:function(){return this.stats.draws.counter.value||0}},{key:"getLogicTime",value:function(){var e=this.stats.logic.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getPhysicTime",value:function(){var e=this.stats.physics.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getRenderTime",value:function(){var e=this.stats.render.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getObjectMemoryUsage",value:function(){var e=this.stats.bufferMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getTextureMemoryUsage",value:function(){var e=this.stats.textureMemory.counter;return Math.floor(1e3*e.value)/1e3||0}},{key:"getDevicePixelRatio",value:function(){return window.devicePixelRatio||0}}]),n}(f)).prototype,"fpsLabel",[ka],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La=$e(Ia.prototype,"drawCountLabel",[Sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oa=$e(Ia.prototype,"logicTimeLabel",[Ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Da=$e(Ia.prototype,"physicTimeLabel",[Ea],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ma=$e(Ia.prototype,"renderTimeLabel",[Aa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Na=$e(Ia.prototype,"objectMemoryUsageLabel",[Ta],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fa=$e(Ia.prototype,"textureMemoryUsageLabel",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ba=$e(Ia.prototype,"devicePixelRatioLabel",[Pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ra=Ia))||Ra);n._RF.pop(),n._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var er,tr=function(e){return e.INVITE_FRIENDS="invite-friends",e.REPLAY_FRIENDS="replay-friends",e.SHOW_CHALLENGE_RESULTS="show-challenge-results",e.NEXT_LEVEL="next-level",e.MAX_LEVEL="max-level",e.START_OVER="start-over",e.SELECT_LEVEL="select-level",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_REPLAY="game-replay",e.GAME_FINISH="game-finish",e.GAME_EXIT="game-exit",e.USE_ITEM="use-item",e.SKIP_LEVEL="skip-level",e.ADD_ITEM="add-item",e.ADD_ITEMS="add-items",e.ADD_COINS="add-coins",e.REMOVE_COINS="remove-coins",e.REMOVE_COINS_SUCCESS="remove-coins-success",e.REMOVE_COINS_FAILED="remove-coins-failed",e.COIN_CHANGED="coin-changed",e.ADD_STARS="add-stars",e.PAUSE_TIME="pause-time",e.RESUME_TIME="resume-time",e.TIME_OUT="time-out",e.HALF_TIME="half-time",e.RESCUE_START="rescue-time",e.RESCUE_FINISHED="clock-animation-finished",e.APPLY_GRAVITY="apply-gravity",e.IDLE_ENTER="idle-enter",e.IDLE_EXIT="idle-exit",e.GRID_MATCH="grid-match",e.GRID_MATCH_SUCCESS="grid-match-success",e.GRID_MATCH_FAIL="grid-match-fail",e.GRID_CLEAR="grid-clear",e.GRID_CREATE="grid-create",e.TILE_CLICK="tile-click",e.BOMB_EXPLODE="bomb-explode",e.SHOW_HINT="show-hint",e.ADD_COMBO="add-combo",e.COMBO_UPDATED="combo-updated",e.COMBO_ENDED="combo-ended",e.ADD_SCORE="add-score",e.SCORE_UPDATED="score-updated",e.REGISTER_ANIMATOR="register-animator",e.UNREGISTER_ANIMATOR="unregister-animator",e.SHOW_UI="show-ui",e.HIDE_UI="hide-ui",e.AUTO_PLAY="auto-play",e.GUIDE_MASK_CLICKED="guide-mask-clicked",e}(tr||{});n._RF.pop(),n._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);var nr,ir,ar,rr,or,sr,lr,ur,cr,hr,pr,dr,fr,vr,yr,mr,gr,br,wr=(0,i.ccclass)("PanelAnimationController")(er=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).animators=new Set,e.handleRegistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)&&console.warn("Animator already registered."),e.animators.add(t)},e.handleUnregistration=function(t){if(!t)throw new Error("Invalid event payload.");e.animators.has(t)||console.warn("Animator not registered."),e.animators.delete(t)},e.handleShowUIs=function(t){var n=!1,i=Array.from(e.animators.values()).map((function(e){var i;e.isReadyForAnimation()||n||(n=!0,null==t||null===(i=t.fallback)||void 0===i||i.call(t));return e.handleShowUI()}));Promise.all(i).then((function(){var e;null==t||null===(e=t.onComplete)||void 0===e||e.call(t)}))},e.handleHideUIs=function(t){var n=!1,i=Array.from(e.animators.values()).map((function(e){var i;e.isReadyForAnimation()||n||(n=!0,null==t||null===(i=t.fallback)||void 0===i||i.call(t));return e.handleHideUI()}));Promise.all(i).then((function(){var e;null==t||null===(e=t.onComplete)||void 0===e||e.call(t)}))},e}return Pe(n,[{key:"init",value:function(){this.node.scene.off(tr.REGISTER_ANIMATOR),this.node.scene.off(tr.UNREGISTER_ANIMATOR),this.node.scene.off(tr.SHOW_UI),this.node.scene.off(tr.HIDE_UI),this.node.scene.on(tr.REGISTER_ANIMATOR,this.handleRegistration),this.node.scene.on(tr.UNREGISTER_ANIMATOR,this.handleUnregistration),this.node.scene.on(tr.SHOW_UI,this.handleShowUIs),this.node.scene.on(tr.HIDE_UI,this.handleHideUIs)}}]),n}(f))||er;n._RF.pop(),n._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);var kr,Sr,Cr,Er,Ar=i.ccclass,Tr=i.property,xr=(nr=Ar("AnimationConfig"),ir=Tr({type:[E]}),nr((or=$e((rr=function(){function e(){Te(this,e),Xe(this,"startHidden",or,this),Xe(this,"nodes",sr,this),Xe(this,"posOffset",lr,this),Xe(this,"showEase",ur,this),Xe(this,"hideEase",cr,this),Xe(this,"showDuration",hr,this),Xe(this,"hideDuration",pr,this)}return Pe(e,[{key:"setConfig",value:function(e){e&&Object.assign(this,e)}}]),e}()).prototype,"startHidden",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),sr=$e(rr.prototype,"nodes",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lr=$e(rr.prototype,"posOffset",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ur=$e(rr.prototype,"showEase",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),cr=$e(rr.prototype,"hideEase",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),hr=$e(rr.prototype,"showDuration",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pr=$e(rr.prototype,"hideDuration",[Tr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ar=rr))||ar),Pr=(dr=Ar("PanelAnimator"),fr=Tr({type:xr,displayName:"Top animation nodes"}),vr=Tr({type:xr,displayName:"Bottom animation nodes"}),dr((gr=$e((mr=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"topConfig",gr,Ne(e)),Xe(e,"botConfig",br,Ne(e)),e.isReady=!1,e}return Pe(a,[{key:"onEnable",value:function(){this.node.scene.emit(tr.REGISTER_ANIMATOR,this)}},{key:"onDisable",value:function(){this.node.scene.emit(tr.UNREGISTER_ANIMATOR,this)}},{key:"onLoad",value:function(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}},{key:"initUIPos",value:function(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}},{key:"isReadyForAnimation",value:function(){return this.isReady}},{key:"handleShowUI",value:(n=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady){e.next=3;break}return console.warn(`${this.node.name}'s ${this.name}: not ready`),e.abrupt("return");case 3:return e.abrupt("return",Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")]));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleHideUI",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReady){e.next=3;break}return console.warn(`${this.node.name}'s ${this.name}: not ready`),e.abrupt("return");case 3:return e.abrupt("return",Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")]));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"createAnimator",value:function(e,t){var n=e.nodes,i=e.posOffset,r=e.showEase,o=e.hideEase,s=e.showDuration,l=e.hideDuration,u=n.map((function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom}:{mode:"position",value:e.node.position.y}})),c=n.map((function(e){return"top"===t&&e.isAlignTop?{mode:"top",value:e.top+i}:"bottom"===t&&e.isAlignBottom?{mode:"bottom",value:e.bottom-i}:{mode:"position",value:e.node.position.y+i}})),h="shown";return{switchState:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(h===e)return Promise.resolve(null);h=e;var i="hidden"===e?u:c,p="hidden"===e?c:u,d="hidden"===e?l:s,f="hidden"===e?o:r;return t?(n.forEach((function(e,t){var n=i[t],a=p[t].value;"top"===n.mode&&(e.top=a),"bottom"===n.mode&&(e.bottom=a),"position"===n.mode&&(e.node.position=new j(e.node.position.x,a,e.node.position.z))})),Promise.resolve(null)):Promise.all(n.map((function(e,t){var n=i[t],r=p[t].value;return yn.runTweenAsync(a.getTween({widget:e,config:n,target:r,easing:f,duration:d}))})))}}}},{key:"setAnimator",value:function(e){var t=e.topConfig,n=e.botConfig,i=new xr,a=new xr;i.setConfig(t),a.setConfig(n),this.topConfig=i,this.botConfig=a,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}}],[{key:"getTween",value:function(e){var t=e.widget,n=e.config,i=e.target,a=e.easing,r=e.duration;return"top"===n.mode?S(t).call((function(){t.top=n.value})).to(r,{top:i},{easing:a}):"bottom"===n.mode?S(t).call((function(){t.bottom=n.value})).to(r,{bottom:i},{easing:a}):S(t.node.position).call((function(){t.node.position=new j(t.node.position.x,n.value,t.node.position.z)})).to(r,{y:i},{easing:a})}}]),a}(f)).prototype,"topConfig",[fr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new xr}}),br=$e(mr.prototype,"botConfig",[vr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new xr}}),yr=mr))||yr);n._RF.pop(),n._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);var Rr,Ir,_r,Lr,Or,Dr,Mr,Nr,Fr,Br,Gr,zr=i.ccclass,Ur=i.requireComponent,Hr=i.property,qr=globalThis.game,Vr=qr.ads,Wr=qr.event;zr("ResizeWithBannerAd")(kr=Ur(E)((Cr=$e((Sr=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"willShowBanner",Cr,Ne(e)),Xe(e,"includeSAB",Er,Ne(e)),e.handleAdShow=function(t){var n,i=t.placementId;null!==i&&((null===(n=Vr.getAdByPlacementId(i))||void 0===n?void 0:n.type)===GameCore.Plugins.Ads.Types.BANNER&&e.resizeToFitBannerAd())},e.handleAdClose=function(t){var n,i=t.placementId;null!==i&&((null===(n=Vr.getAdByPlacementId(i))||void 0===n?void 0:n.type)===GameCore.Plugins.Ads.Types.BANNER&&e.updateWidgets(Vr.getSafeAreaBottom(ea.cssSizeToWorldSize(1))))},e}return Pe(n,[{key:"__preload",value:function(){this.widget=this.getComponent(E),St.lazyValidateProperties(this),Wr.on(GameCore.Events.AD_SHOWING,this.handleAdShow),Wr.on(GameCore.Events.AD_CLOSED,this.handleAdClose)}},{key:"onDestroy",value:function(){Wr.off(GameCore.Events.AD_SHOWING,this.handleAdShow),Wr.off(GameCore.Events.AD_CLOSED,this.handleAdClose)}},{key:"start",value:function(){var e=Vr.getSafeAreaBottom(ea.cssSizeToWorldSize(1));this.willShowBanner||n.isBannerAdShowing()?this.resizeToFitBannerAd():e>0&&this.includeSAB&&this.updateWidgets(e)}},{key:"resizeToFitBannerAd",value:function(){var e=this,t=GameCore.Configs.Ads,n=t.Enabled,i=t.BannerDisplayAdOptions;if(n)if(this.widget.isAlignBottom){var a=0;i.forEach((function(t){var n=t.PlacementId;"bottom"===t.Position&&Vr.canbeShowBannerAd(n)&&(a=Vr.getBannerHeight(n,ea.cssSizeToWorldSize(1),e.includeSAB))})),a>0&&this.updateWidgets(a)}else console.warn("Widget does not align to bottom, ResizeWithBannerAds will have no effect!")}},{key:"updateWidgets",value:function(e){this.widget.bottom=e,this.widget.updateAlignment(),this.getComponentsInChildren(E).forEach((function(e){e.updateAlignment()}))}}],[{key:"isBannerAdShowing",value:function(){return Vr.enabled&&Vr.getAdStatus(GameCore.Plugins.Ads.Types.BANNER)===GameCore.Plugins.Ads.Status.SHOWING}}]),n}(f)).prototype,"willShowBanner",[Hr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Er=$e(Sr.prototype,"includeSAB",[Hr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),kr=Sr))||kr);n._RF.pop(),n._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);var Kr,jr,Yr,Xr,$r,Jr,Qr,Zr,eo,to,no=i.ccclass,io=i.property,ao=i.executeInEditMode,ro=i.requireComponent,oo=(Rr=no("TapperedProgressBar"),Ir=ro(M),_r=io({type:M,displayName:"Fill opacity"}),Lr=io({type:T,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),Or=io({type:T,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),Dr=io({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),Rr(Mr=ao(Mr=Ir((Fr=$e((Nr=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"uiOpacity",Fr,Ne(e)),Xe(e,"leftCap",Br,Ne(e)),Xe(e,"rightCap",Gr,Ne(e)),e}return Pe(n,[{key:"progress",get:function(){return ze(_e(n.prototype),"progress",this)},set:function(e){He(_e(n.prototype),"progress",e,this,!0),this.updateAppearance()}},{key:"updateAppearance",value:function(){if(null!==this.uiOpacity)if(this.progress<=0)this.uiOpacity.opacity=0;else if(this.progress>.1)this.uiOpacity.opacity=255;else{var e=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=e}}},{key:"start",value:function(){this.updateAppearance()}}]),n}(Y)).prototype,"uiOpacity",[_r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Br=$e(Nr.prototype,"leftCap",[Lr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gr=$e(Nr.prototype,"rightCap",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$e(Nr.prototype,"progress",[Dr],Object.getOwnPropertyDescriptor(Nr.prototype,"progress"),Nr.prototype),Mr=Nr))||Mr)||Mr)||Mr);n._RF.pop(),n._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);var so,lo,uo,co,ho,po,fo,vo,yo,mo=i.ccclass,go=i.property,bo=i.requireComponent,wo=i.executeInEditMode,ko=i.disallowMultiple,So=globalThis.game.language;Kr=mo("Localize"),jr=bo(u),Yr=wo(!0),Xr=go({visible:!0}),$r=go({group:{name:"Fonts",id:"fonts",displayOrder:1},type:X}),Jr=go({group:{name:"Fonts",id:"fonts",displayOrder:2},type:X}),Kr(Qr=ko(Qr=jr(Qr=Yr(($e((Zr=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"enFont",eo,Ne(e)),Xe(e,"ruFont",to,Ne(e)),e.handleLanguageChanged=function(){e.updateTransToNode()},e}return Pe(n,[{key:"key",get:function(){return this._key},set:function(e){e&&(this._key=e,this.updateTransToNode())}},{key:"__preload",value:function(){this.label=this.getComponent(u),this.validateRequiredComponents(),this.updateTransToNode()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"start",value:function(){this.listenEvent()}},{key:"listenEvent",value:function(){x.on("update-language",this.handleLanguageChanged)}},{key:"updateTransToNode",value:function(){if(this.node.active&&this._key)try{var e=So.getText(this._key),t=this.getFontByLang();this.label.font=t,this.label.string=e,this.node.emit("update-trans",e)}catch(e){console.warn(e)}}},{key:"getFontByLang",value:function(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(So.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}]),n}(f)).prototype,"key",[Xr],Object.getOwnPropertyDescriptor(Zr.prototype,"key"),Zr.prototype),eo=$e(Zr.prototype,"enFont",[$r],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),to=$e(Zr.prototype,"ruFont",[Jr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qr=Zr))||Qr)||Qr)||Qr);n._RF.pop(),n._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);var Co,Eo,Ao,To,xo,Po,Ro,Io,_o,Lo=i.ccclass,Oo=i.property,Do=function(){function e(t,n){var i;Te(this,e),n=null!==(i=n)&&void 0!==i?i:{response:1,dampen:1,eager:1},this.k1=e.calcK1(n),this.k2=e.calcK2(n),this.k3=e.calcK3(n),this.xp=t.clone(),this.y=t.clone(),this.yd=new $(0,0)}return Pe(e,[{key:"update",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===n&&(n=new $((t.x-this.xp.x)/e,(t.y-this.xp.y)/e),this.xp.x=t.x,this.xp.y=t.y);var i=Math.max(this.k2,e*e/2+e*this.k1/2,e*this.k1);return this.y.x=this.y.x+e*this.yd.x,this.y.y=this.y.y+e*this.yd.y,this.yd.x=this.yd.x+e*(t.x+this.k3*n.x-this.y.x-this.k1*this.yd.x)/i,this.yd.y=this.yd.y+e*(t.y+this.k3*n.y-this.y.y-this.k1*this.yd.y)/i,this.y}},{key:"setDynamics",value:function(t){this.k1=e.calcK1(t),this.k2=e.calcK2(t),this.k3=e.calcK3(t)}},{key:"reset",value:function(e){this.xp.set(e.x,e.y),this.y.set(e.x,e.y),this.yd.set(0,0)}},{key:"currentState",get:function(){return this.y}}],[{key:"calcK1",value:function(e){return e.dampen/(Math.PI*e.response)}},{key:"calcK2",value:function(e){return 1/(2*Math.PI*e.response*(2*Math.PI*e.response))}},{key:"calcK3",value:function(e){return e.eager*e.dampen/(2*Math.PI*e.response)}}]),e}(),Mo=(so=Lo("SODConfig"),lo=Oo({type:C,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),uo=Oo({type:C,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),co=Oo({type:C,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),so((fo=$e((po=Pe((function e(){Te(this,e),Xe(this,"response",fo,this),Xe(this,"dampen",vo,this),Xe(this,"eager",yo,this)}))).prototype,"response",[lo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),vo=$e(po.prototype,"dampen",[uo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),yo=$e(po.prototype,"eager",[co],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ho=po))||ho);n._RF.pop(),n._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);var No,Fo,Bo,Go,zo,Uo,Ho,qo,Vo,Wo,Ko,jo,Yo,Xo,$o,Jo,Qo,Zo,es,ts,ns,is,as,rs,os,ss,ls=i.ccclass,us=i.property,cs=(Co=ls("Trail"),Eo=us({type:a,displayName:"Target"}),Ao=us({type:V,displayName:"Graphics"}),To=us({type:[Mo],displayName:"Trail Nodes"}),Co((Ro=$e((Po=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"target",Ro,Ne(e)),Xe(e,"graphics",Io,Ne(e)),Xe(e,"trailNodes",_o,Ne(e)),e.trailNodeInstances=[],e}return Pe(n,[{key:"reset",value:function(){var e,t=je(this.trailNodeInstances);try{for(t.s();!(e=t.n()).done;){e.value.reset(new $(this.node.worldPosition.x,this.node.worldPosition.y))}}catch(e){t.e(e)}finally{t.f()}this.graphics.clear()}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.spawnTrailNodes()}},{key:"update",value:function(e){this.graphics.clear();var t=this.trailNodeInstances[0];this.drawTrail(e,t,this.target.worldPosition.x,this.target.worldPosition.y);for(var n=1;n<this.trailNodeInstances.length;n++){var i=this.trailNodeInstances[n-1],a=this.trailNodeInstances[n];this.drawTrail(e,a,i.currentState.x,i.currentState.y)}}},{key:"drawTrail",value:function(e,t,n,i){var a=this.graphics,r=new $(n,i),o=t.update(e,r),s=new j(r.x,r.y,0),l=new j(o.x,o.y,0);a.node.inverseTransformPoint(s,s),a.node.inverseTransformPoint(l,l),a.moveTo(s.x,s.y),a.lineTo(l.x,l.y),a.stroke()}},{key:"spawnTrailNodes",value:function(){var e,t=je(this.trailNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value,i=new $(this.node.worldPosition.x,this.node.worldPosition.y),a=new Do(i,n);this.trailNodeInstances.push(a)}}catch(e){t.e(e)}finally{t.f()}}},{key:"validateRequiredComponents",value:function(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}]),n}(f)).prototype,"target",[Eo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Io=$e(Po.prototype,"graphics",[Ao],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_o=$e(Po.prototype,"trailNodes",[To],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xo=Po))||xo);n._RF.pop(),n._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);var hs,ps=i.ccclass,ds=i.executionOrder,fs=i.property,vs="Batch By Name",ys="Batch Label",ms="Batch Sprite",gs=(No=ps("BatchNodes"),Fo=ds(99999),Bo=fs({group:{name:vs}}),Go=fs({type:[g],group:{name:vs}}),zo=fs({type:[m],group:{name:vs}}),Uo=fs({group:{name:ys}}),Ho=fs({group:{name:ys}}),qo=fs({group:{name:ys}}),Vo=fs({group:{name:ms}}),Wo=fs({group:{name:ms}}),Ko=fs({readonly:!0}),jo=fs({readonly:!0}),Yo=fs({readonly:!0}),No(Xo=Fo((Jo=$e(($o=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"batchByName",Jo,Ne(e)),Xe(e,"depthNames",Qo,Ne(e)),Xe(e,"listName",Zo,Ne(e)),Xe(e,"batchLabel",es,Ne(e)),Xe(e,"depthLabel",ts,Ne(e)),Xe(e,"typeLabel",ns,Ne(e)),Xe(e,"batchSprite",is,Ne(e)),Xe(e,"depthSprite",as,Ne(e)),Xe(e,"batchAllNodes",rs,Ne(e)),Xe(e,"batchDepth",os,Ne(e)),Xe(e,"checkOverlap",ss,Ne(e)),e.batchNode={},e.labelChildren=[],e.spriteChildren=[],e.allChildren=[],e.nameChildren=[],e.originalParents={},e.isInited=!1,e.onAfterUpdate=function(){e.isInited&&e.hierarchyChildren()},e.onAfterRender=function(){e.isInited&&e.restoreOriginalChildren()},e}return Pe(n,[{key:"__preload",value:function(){this.enabled&&(d.on(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.on(J.EVENT_AFTER_RENDER,this.onAfterRender))}},{key:"onDestroy",value:function(){d.off(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.off(J.EVENT_AFTER_RENDER,this.onAfterRender)}},{key:"onLoad",value:function(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}},{key:"onEnable",value:function(){d.on(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.on(J.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0}},{key:"onDisable",value:function(){this.restoreOriginalChildren(),d.off(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),d.off(J.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}},{key:"setupBatchNodes",value:function(e){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(e),this.createGlobalNodes(e),this.createGlobalNameNodes(e),this.createGlobalLabelNode(e),this.createGlobalSpriteNode(e),this.sortGlobalNodes()}},{key:"sortGlobalNodes",value:function(){var e,t,n,i=this;null===(e=this.batchNode.node)||void 0===e||e.setSiblingIndex(0),null===(t=this.batchNode.label)||void 0===t||t.setSiblingIndex(this.depthLabel),null===(n=this.batchNode.sprite)||void 0===n||n.setSiblingIndex(this.depthSprite),this.listName.forEach((function(e,t){var n;null===(n=i.batchNode[e])||void 0===n||n.setSiblingIndex(i.depthNames[t])}))}},{key:"createGlobalNodes",value:function(e){if(this.batchAllNodes){var t=new a("GlobalBatchNode");t.active=!0,this.batchNode.node=t,e.addChild(t)}}},{key:"createGlobalNameNodes",value:function(e){var t=this;this.batchByName&&this.listName.forEach((function(n){if(!t.batchNode[n]){var i=new a(n);i.active=!0,t.batchNode[n]=i,e.addChild(i)}}))}},{key:"createGlobalLabelNode",value:function(e){if(this.batchLabel){var t=new a("GlobalLabelNode");t.active=!0,this.batchNode.label=t,e.addChild(t)}}},{key:"createGlobalSpriteNode",value:function(e){if(this.batchSprite){var t=new a("GlobalSpriteNode");t.active=!0,this.batchNode.sprite=t,e.addChild(t)}}},{key:"saveOriginalParents",value:function(){var e=this;[].concat(Ve(this.labelChildren),Ve(this.spriteChildren)).forEach((function(t){t.node.parent&&(e.originalParents[t.uuid]=t.node.parent)})),this.nameChildren.forEach((function(t){t.parent&&(e.originalParents[t.uuid]=t.parent)}))}},{key:"saveOriginalChildren",value:function(e){var t=this;e.children.forEach((function(e){t.saveLabelChildren(e),t.saveSpriteChildren(e),t.saveNodeChildrenByName(e),t.saveNodeChildrenByType(e)})),this.saveOriginalParents()}},{key:"saveLabelChildren",value:function(e){var t;if(this.batchLabel){var n=e.getComponentsInChildren(u);"char"===this.typeLabel&&n.filter((function(e){return e.cacheMode===u.CacheMode.CHAR})),0!==n.length&&(t=this.labelChildren).push.apply(t,Ve(n))}}},{key:"saveSpriteChildren",value:function(e){var t;if(this.batchSprite){var n=e.getComponentsInChildren(T);0!==n.length&&(t=this.spriteChildren).push.apply(t,Ve(n))}}},{key:"saveNodeChildrenByName",value:function(e){var t=this;this.batchByName&&e.children.forEach((function(e){t.listName.includes(e.name)?t.nameChildren.push(e):t.saveNodeChildrenByName(e)}))}},{key:"saveNodeChildrenByType",value:function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.batchAllNodes){var a=e.getComponentsInChildren(f);(t=this.allChildren).push.apply(t,Ve(a)),this.batchDepth>0&&i<this.batchDepth&&this.allChildren.forEach((function(e){n.saveNodeChildrenByType(e.node,n.batchDepth)}))}}},{key:"hierarchyChildren",value:function(){var e,t=this;this.labelChildren.forEach((function(n){var i;n.node.isValid&&null!==(i=n.node.parent)&&void 0!==i&&i.active&&(e=t.batchNode.label,n.node.setParent(e,!0),n.node.layer=Q.Enum.UI_2D)})),this.spriteChildren.forEach((function(n){var i;n.node.isValid&&null!==(i=n.node.parent)&&void 0!==i&&i.active&&(e=t.batchNode.sprite,n.node.setParent(e,!0),n.node.layer=Q.Enum.UI_2D)})),this.allChildren.forEach((function(n){var i;n.node.isValid&&null!==(i=n.node.parent)&&void 0!==i&&i.active&&(e=t.batchNode.node,n.node.setParent(e,!0),n.node.layer=Q.Enum.UI_2D)})),this.allChildren.sort((function(e,t){var n=e.constructor.name,i=t.constructor.name;return n<i?-1:n>i?1:0})),this.nameChildren.forEach((function(n){var i;n.isValid&&null!==(i=n.parent)&&void 0!==i&&i.active&&(e=t.batchNode[n.name],n.setParent(e,!0),n.layer=Q.Enum.UI_2D)}))}},{key:"restoreOriginalChildren",value:function(){var e=this,t=[].concat(Ve(this.labelChildren),Ve(this.spriteChildren));t.length>0&&t.forEach((function(t){var n=e.originalParents[t.uuid];n&&t.node.setParent(n,!0)})),this.nameChildren.forEach((function(t){var n=e.originalParents[t.uuid];n&&t.setParent(n,!0)}))}}]),n}(f)).prototype,"batchByName",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Qo=$e($o.prototype,"depthNames",[Go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Zo=$e($o.prototype,"listName",[zo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),es=$e($o.prototype,"batchLabel",[Uo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ts=$e($o.prototype,"depthLabel",[Ho],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ns=$e($o.prototype,"typeLabel",[qo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),is=$e($o.prototype,"batchSprite",[Vo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),as=$e($o.prototype,"depthSprite",[Wo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rs=$e($o.prototype,"batchAllNodes",[Ko],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),os=$e($o.prototype,"batchDepth",[jo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ss=$e($o.prototype,"checkOverlap",[Yo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Xo=$o))||Xo)||Xo);n._RF.pop(),n._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);var bs=i.ccclass,ws=GameCore.Utils,ks=globalThis.game.player,Ss=bs("Vibrate")(hs=function(e){Ie(n,e);var t=Be(n);function n(){return Te(this,n),t.apply(this,arguments)}return Pe(n,[{key:"vibrate",value:function(e){if(this.isVibrateEnable()&&!ws.Browser.vibrate(e)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}},{key:"isVibrateEnable",value:function(){return!!ks.getPlayerSetting("vibrate")}}]),n}(f))||hs;n._RF.pop(),n._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);var Cs=1/6;n._RF.pop(),n._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);var Es={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};n._RF.pop(),n._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);var As=10,Ts=50,xs=100,Ps={[Es.HINT]:80,[Es.THUNDER]:200,[Es.STORM]:150,[Es.PLIERS]:150},Rs=200,Is=40;n._RF.pop(),n._RF.push({},"63645sZ1tlEZL2530kj5xkt","CollectionSceneEvents",void 0),n._RF.pop(),n._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);var _s={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};n._RF.pop(),n._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);var Ls="STARS_UPDATED",Os="PLAY_BUTTON_PRESS",Ds="REQUEST_NAVIGATION",Ms="REQUEST_NAVIGATION_ANIMATION",Ns="GAME_SCENE_RESOURCES_LOADED",Fs="DASHBOARD_EVENTS_BUTTON_PRESS";n._RF.pop(),n._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var Bs=function(e){return e[e.store=0]="store",e[e.collections=1]="collections",e[e.home=2]="home",e[e.leaderboard=3]="leaderboard",e[e.tournaments=4]="tournaments",e}(Bs||{});N(Bs),n._RF.pop(),n._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);var Gs=ke(ke({},GameCore.Dtos.Match.Data.getDefaultData()),{},{extraData:null});n._RF.pop(),n._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var zs=function(e){return e.UNLOCK_DEV_TOOLS="unlock-dev-tools",e.TRIGGER_UNLOCK_KEY="trigger-unlock-key",e.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",e}(zs||{}),Us={Events:zs,UNLOCK_SEQUENCE:"101013012031"};n._RF.pop(),n._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);n._RF.pop(),n._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);var Hs={level:0,coins:0,stars:0,totalLevel:80,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:{[Es.HINT]:0,[Es.THUNDER]:0,[Es.STORM]:0,[Es.PLIERS]:0},skins:{}};n._RF.pop(),n._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);var qs="global-leaderboard-key",Vs="friends-leaderboard-key",Ws="global-leaderboard-id",Ks="friends-leaderboard-id";n._RF.pop(),n._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);var js=ke(ke({},GameCore.Dtos.Match.CustomData.getDefaultData()),{},{score:0});n._RF.pop(),n._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);var Ys={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:Hs,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};n._RF.pop(),n._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);var Xs="BootScene",$s="GameScene",Js="DashboardScene",Qs="ChallengeResultScene";n._RF.pop(),n._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var Zs=function(e){return e.RELOAD_TOURNAMENT="reload-tournament",e}(Zs||{});n._RF.pop(),n._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);var el=GameCore,tl=el.Configs,nl=el.Utils.Object,il=tl.FrameCapture,al=il.Enabled,rl=il.WideframeConfigs,ol=function(){var e=Ae(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(al){e.next=3;break}return console.warn("FrameCapture is not enabled"),e.abrupt("return",null);case 3:if(n=ll(t)){e.next=6;break}return e.abrupt("return",null);case 6:return sl(n,rl.CustomResultChallenge),i=window.game.frameCapture,a=rl.CustomResultChallenge,r=a.Width,o=a.Height,e.abrupt("return",i.captureAsync({name:"CustomResultChallenge",width:r,height:o,renderOptions:n}));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),sl=function(e,t){var n=t.Width,i=t.Height,a=t.Wideframe;e.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:a,size:[n,i],position:[0,0]}},ll=function(e){try{var t=e.playerId,n=void 0===t?"10":t,i=e.playerPhoto,a=void 0===i?"":i,r=e.playerScore,o=void 0===r?0:r,s=e.opponentId,l=void 0===s?"20":s,u=e.opponentPhoto,c=void 0===u?"":u,h=e.opponentScore,p=void 0===h?0:h,d=e.isPlayerFinished,f=e.isOpponentFinished,v=rl.CustomResultChallenge.RenderOptions,y=nl.camelCaseKeys(nl.clone(v)),m=y.playerPhoto,g=y.opponentPhoto,b=o===p,w=o>p,k=null!=d?d:f,S=d&&f;return"image"===m.type&&(m.name=`${n}`,m.image=a),"image"===g.type&&(g.name=`${l}`,g.image=c),k&&ul(y,{playerScore:o,opponentScore:p,isPlayerFinished:d,isOpponentFinished:f}),!S||b?(delete y.leftCrown,delete y.rightCrown,y):(w?delete y.rightCrown:delete y.leftCrown,y)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},ul=function(e,t){var n=e.leftScore,i=e.rightScore,a=t.playerScore,r=void 0===a?0:a,o=t.opponentScore,s=void 0===o?0:o,l=t.isPlayerFinished,u=t.isOpponentFinished;"text"===n.type&&(n.text=l?`${r}`:"???"),"text"===i.type&&(i.text=u?`${s}`:"???")};n._RF.pop(),n._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);var cl=function(e){Ie(n,e);var t=Be(n);function n(e,i){var a;return Te(this,n),(a=t.call(this,i)).code=e,a}return Pe(n)}(Me(Error));n._RF.pop(),n._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);var hl=function(e){Ie(n,e);var t=Be(n);function n(e,i){var a;return Te(this,n),(a=t.call(this,"PLAYER_HAS_TOURNAMENT","Player has a tournament")).playerId=e,a.tournamentId=i,a}return Pe(n)}(cl);n._RF.pop(),n._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);var pl={themeNames:["summer","autumn","winter"],skinNames:["cakes","car","cosmetics","flower","fruit","ice-cream","sport","tool"],mapOrder:[{id:1,theme:"summer",skin:"fruit",levelCount:10},{id:2,theme:"autumn",skin:"flower",levelCount:10},{id:3,theme:"winter",skin:"tool",levelCount:10},{id:4,theme:"summer",skin:"sport",levelCount:10},{id:5,theme:"autumn",skin:"cosmetics",levelCount:10},{id:6,theme:"winter",skin:"ice-cream",levelCount:10},{id:7,theme:"summer",skin:"cakes",levelCount:10},{id:8,theme:"autumn",skin:"car",levelCount:10}]};n._RF.pop(),n._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);var dl="cakes",fl="flower",vl="fruit";n._RF.pop(),n._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);var yl={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter"};N(yl),n._RF.pop(),n._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);var ml={currentProgress:0,maxProgress:10,isLocked:!0,themeId:"summer"},gl={id:0,currentSkin:dl,currentTheme:yl.SUMMER,nextSkin:null,nextTheme:null,progress:0,max:10},bl={skin:"cakes",themeId:"summer",progress:0,max:10,isLocked:!0},wl=globalThis.game.storage,kl=function(){function e(){Te(this,e),this.mapData=pl,this.playerSkinProgress=null}return Pe(e,[{key:"initDashboardSceneStorage",value:function(){var e=wl.getStorage("dashboard");if(null==e){var t=this.getCurrentMapProgressInstance();wl.addStorage("dashboard",{lastMapPayload:t,numOfMapsPassed:0,animateToCurrentLevel:!1});var n=wl.getStorage("collection");if(null==n){wl.addStorage("collection",{lastMapPack:t.id,animateMapPackUnlock:!1});var i=wl.getStorage("leaderboard_content");if(null==i){wl.addStorage("leaderboard_content",{lastTabOpened:"global"});var a=wl.getStorage("tournament");null==a&&wl.addStorage("tournament",{animateTournamentLeader:!1})}}}}},{key:"getCurrentMapProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),gl;for(var e=this.mapData.mapOrder,t=void 0,n=void 0,i=void 0,a=void 0,r=0,o=0,s=0,l=0;l<e.length;l++){var u=this.playerSkinProgress[e[l].skin];if(u.currentProgress<u.maxProgress){var c,h,p,d;s=e[l].id,t=e[l].skin,n=e[l].theme,i=null!==(c=null===(h=e[l+1])||void 0===h?void 0:h.skin)&&void 0!==c?c:t,a=null!==(p=null===(d=e[l+1])||void 0===d?void 0:d.theme)&&void 0!==p?p:n,r=u.currentProgress,o=u.maxProgress;break}}if(void 0===t||void 0===i||void 0===n||void 0===a){var f=e[e.length-1];return s=f.id,t=f.skin,n=f.theme,i=f.skin,a=f.theme,r=f.levelCount,o=f.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:s,currentSkin:t,currentTheme:n,nextSkin:i,nextTheme:a,progress:r,max:o}}return console.log("getMapCurrentProgress",t,i,r,o),{id:s,currentSkin:t,currentTheme:n,nextSkin:i,nextTheme:a,progress:r,max:o}}},{key:"getUnlockedSkinsInstance",value:function(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];for(var e=[],t=0,n=Object.keys(this.playerSkinProgress);t<n.length;t++){var i=n[t];this.playerSkinProgress[i].isLocked||e.push(i)}return console.log("getUnlockedSkins",e),e}},{key:"getLevelSkinInstance",value:function(e){var t,n=null!=e?e:1,i=this.mapData.mapOrder,a=0,r=je(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(a+o.levelCount>=n)return console.log("getMapSkin",o.skin),o.skin;a+=o.levelCount}}catch(e){r.e(e)}finally{r.f()}var s=i[i.length-1];return console.log("getMapSkin",s.skin),s.skin}},{key:"getLevelThemeInstance",value:function(e){var t,n=null!=e?e:1,i=this.mapData.mapOrder,a=0,r=je(i);try{for(r.s();!(t=r.n()).done;){var o=t.value;if(a+o.levelCount>=n)return console.log("getMapTheme",o.theme),o.theme;a+=o.levelCount}}catch(e){r.e(e)}finally{r.f()}var s=i[i.length-1];return console.log("getMapTheme",s.theme),s.theme}},{key:"getCollectionUnlockProgressInstance",value:function(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[bl];for(var e=[],t=0,n=Object.entries(this.playerSkinProgress);t<n.length;t++){var i=n[t],a=i[1],r=a.currentProgress,o=a.maxProgress,s=a.isLocked,l=a.themeId;e.push({progress:r,max:o,isLocked:s,skin:i[0],themeId:l})}return e}},{key:"updatePlayerSkinProgress",value:function(){var e=globalThis.game.player.getGameData();if(null!=e&&e.skins&&Object.keys(e.skins).length>0){this.playerSkinProgress={};for(var t=0,n=Object.keys(e.skins);t<n.length;t++){var i=n[t];this.playerSkinProgress[i]=ke(ke({},ml),e.skins[i])}}else{console.log("getPlayerSkinProgress: playerData not found, use data from level");var a=this.mapData.mapOrder;this.playerSkinProgress={};var r,o=je(a);try{for(o.s();!(r=o.n()).done;){var s=r.value;this.playerSkinProgress[s.skin]={themeId:s.theme,currentProgress:0,maxProgress:s.levelCount,isLocked:!0}}}catch(e){o.e(e)}finally{o.f()}this.updatePlayerSkinProgressByLevel(),console.log(this.playerSkinProgress)}}},{key:"updatePlayerSkinProgressByLevel",value:function(){var e,t=globalThis.game.player.getGameData(),n=(null!==(e=null==t?void 0:t.level)&&void 0!==e?e:1)-1,i=this.mapData.mapOrder;this.playerSkinProgress[i[0].skin].isLocked=!1;var a,r=je(i);try{for(r.s();!(a=r.n()).done;){var o=a.value,s=o.levelCount,l=o.skin;if(!(n<=0)){var u=n-s>=0?s:n;n-=u,console.log("getPlayerSkinProgressByLevel",l,u),this.increaseProgressInstance(l,u,!1)}}}catch(e){r.e(e)}finally{r.f()}}},{key:"increaseProgressInstance",value:function(e,t,n){if(null!==this.playerSkinProgress)if(this.playerSkinProgress[e]){var i=this.playerSkinProgress[e],a=i.currentProgress,r=i.maxProgress,o=a+t>r?r:a+t;if(o>0&&(this.playerSkinProgress[e].isLocked=!1),o===r){var s,l=this.mapData.mapOrder,u=l.findIndex((function(t){return t.skin===e})),c=null===(s=l[u+1])||void 0===s?void 0:s.skin;c&&this.unlockSkinInstance(c,!1)}this.playerSkinProgress[e].currentProgress=o,this.playerSkinProgress[e].maxProgress=r,n&&this.syncPlayerSkinProgress()}else console.warn("increaseProgress: skin not found",e);else console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?")}},{key:"unlockSkinInstance",value:function(e,t){null!==this.playerSkinProgress?this.playerSkinProgress[e]?(this.playerSkinProgress[e].isLocked=!1,t&&this.syncPlayerSkinProgress()):console.warn("unlockSkin: skin not found",e):console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}},{key:"syncPlayerSkinProgress",value:function(){var e=globalThis.game.player.getGameData();globalThis.game.player.setGameData(ke(ke({},e),{},{skins:this.playerSkinProgress}))}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"init",value:function(){var e=this.getInstance();e.updatePlayerSkinProgress(),e.initDashboardSceneStorage()}},{key:"getCurrentMapProgress",value:function(){return this.getInstance().getCurrentMapProgressInstance()}},{key:"getUnlockedSkins",value:function(){return this.getInstance().getUnlockedSkinsInstance()}},{key:"getLevelSkin",value:function(e){return this.getInstance().getLevelSkinInstance(e)}},{key:"getLevelTheme",value:function(e){return this.getInstance().getLevelThemeInstance(e)}},{key:"getCollectionUnlockProgress",value:function(){return this.getInstance().getCollectionUnlockProgressInstance()}},{key:"increaseProgress",value:function(e,t,n){this.getInstance().increaseProgressInstance(e,t,n)}},{key:"unlockSkin",value:function(e,t){this.getInstance().unlockSkinInstance(e,t)}}]),e}();n._RF.pop(),n._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);var Sl=globalThis.game,Cl=Sl.match,El=Sl.player,Al=Sl.leaderboard,Tl=Sl.frameCapture,xl=GameCore.Utils,Pl=xl.Object,Rl=xl.Valid,Il=GameCore.Match.Modes,_l=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"],Ll=function(){function e(){Te(this,e)}var t,n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b;return Pe(e,[{key:"processStartSingleModeAsync",value:(b=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=El.getPlayerId(),e.next=3,Cl.single.start.processAsync({playerId:t});case 3:case"end":return e.stop()}}),e)}))),function(){return b.apply(this,arguments)})},{key:"processFinishSingleModeAsync",value:(g=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Cl.single.finish.processAsync();case 2:case"end":return e.stop()}}),e)}))),function(){return g.apply(this,arguments)})},{key:"processStartTournamentModeAsync",value:(m=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=El.getPlayerId(),n=GameSDK.context.getID(),e.next=4,Cl.tournament.continue.processAsync({playerId:t,contextId:n});case 4:case"end":return e.stop()}}),e)}))),function(){return m.apply(this,arguments)})},{key:"processFinishTournamentModeAsync",value:(y=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=El.getPlayerId(),n=El.getBestScore(),e.next=4,Cl.tournament.finish.processAsync({playerId:t,bestScore:n});case 4:case"end":return e.stop()}}),e)}))),function(){return y.apply(this,arguments)})},{key:"processStartChallengeModeAsync",value:(v=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.processContinueChallengeAsync();case 3:e.next=15;break;case 5:if(e.prev=5,e.t0=e.catch(0),Pl.hasOwn(e.t0,"name")&&!Rl.isString(e.t0.name)){e.next=9;break}throw e.t0;case 9:if("PlayerHasFinishedMatch"!==e.t0.name){e.next=12;break}return e.next=12,this.processChallengeNewOpponentAsync();case 12:if("PlayerNotJoinInMatch"!==e.t0.name){e.next=15;break}return e.next=15,this.processJoinChallengeAsync();case 15:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return v.apply(this,arguments)})},{key:"processFinishChallengeModeAsync",value:(f=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Tl.addWideframeRender("renderResultChallenge",Tl.wideframe.renderResultChallenge),e.next=3,Cl.challenge.finish.processAsync(t);case 3:case"end":return e.stop()}}),e)}))),function(e){return f.apply(this,arguments)})},{key:"processContinueChallengeAsync",value:(d=Ae(Se().mark((function e(){var t,n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getMatchState(),n=t.id,i=t.customData,a=i.playerId,r=i.opponentId,Rl.isString(n)){e.next=4;break}throw new Error("Invalid match id");case 4:if(Rl.isString(a)){e.next=6;break}throw new Error("Invalid player id");case 6:if(Rl.isString(r)){e.next=8;break}throw new Error("Invalid opponent id");case 8:if(o=GameSDK.context.getID()){e.next=11;break}throw new Error("Cannot get contextId");case 11:return e.next=13,Cl.challenge.continue.processAsync({matchId:n,contextId:o,playerId:a,opponentId:r});case 13:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"processChallengeNewOpponentAsync",value:(p=Ae(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=El.getConnectedPlayerIds(100,0),n=Math.floor(Math.random()*t.length),i=El.getPlayerId(),a=t[n],e.next=6,Cl.challenge.friend.processAsync({playerId:i,opponentId:a});case 6:case"end":return e.stop()}}),e)}))),function(){return p.apply(this,arguments)})},{key:"processJoinChallengeAsync",value:(h=Ae(Se().mark((function e(){var t,n,i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getMatchState(),n=t.id,i=t.customData,a=i.playerId,r=i.opponentId,Rl.isString(n)){e.next=4;break}throw new Error("Invalid match id");case 4:if(Rl.isString(a)){e.next=6;break}throw new Error("Invalid player id");case 6:if(Rl.isString(r)){e.next=8;break}throw new Error("Invalid opponent id");case 8:return e.next=10,Cl.challenge.join.processAsync({matchId:n,playerId:a,opponentId:r});case 10:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"getMatchState",value:function(){var e=Cl.getMatchState();if(!e)throw new Error("Match state not found");return e}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"startMatchAsync",value:(c=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=null!=t?t:this.getMatchMode(),e.t0=n,e.next=e.t0===Il.SINGLE?5:e.t0===Il.TOURNAMENT?8:e.t0===Il.CHALLENGE_FRIEND?11:14;break;case 5:return e.next=7,this.inst.processStartSingleModeAsync();case 7:return e.abrupt("break",16);case 8:return e.next=10,this.inst.processStartTournamentModeAsync();case 10:return e.abrupt("break",16);case 11:return e.next=13,this.inst.processStartChallengeModeAsync();case 13:return e.abrupt("break",16);case 14:return e.next=16,this.inst.processStartSingleModeAsync();case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.warn("startMatchAsync",e.t1);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e){return c.apply(this,arguments)})},{key:"setProfileMatchDataAsync",value:(u=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Cl.handler.setProfileData(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setProfileMatchDataAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return u.apply(this,arguments)})},{key:"setMatchCustomDataAsync",value:(l=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Cl.handler.setMatchCustomData(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setMatchCustomDataAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return l.apply(this,arguments)})},{key:"setLeaderboardScoreAsync",value:(s=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Cl.handler.setLeaderboardScore(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.warn("setLeaderboardScoreAsync",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(e){return s.apply(this,arguments)})},{key:"finishMatchAsync",value:(o=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=this.getMatchMode(),e.t0=n,e.next=e.t0===Il.SINGLE?5:e.t0===Il.TOURNAMENT?8:e.t0===Il.CHALLENGE_FRIEND?11:14;break;case 5:return e.next=7,this.inst.processFinishSingleModeAsync();case 7:return e.abrupt("break",16);case 8:return e.next=10,this.inst.processFinishTournamentModeAsync();case 10:return e.abrupt("break",16);case 11:return e.next=13,this.inst.processFinishChallengeModeAsync(t);case 13:return e.abrupt("break",16);case 14:return e.next=16,this.inst.processFinishSingleModeAsync();case 16:e.next=21;break;case 18:e.prev=18,e.t1=e.catch(0),console.warn("finishMatchAsync",e.t1);case 21:case"end":return e.stop()}}),e,this,[[0,18]])}))),function(e){return o.apply(this,arguments)})},{key:"joinTournamentAsync",value:(r=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=El.getPlayerId(),e.next=3,Cl.tournament.join.processAsync({tournamentId:t,playerId:n});case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"continueTournamentAsync",value:(a=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=El.getPlayerId(),e.next=3,Cl.tournament.continue.processAsync({playerId:n,contextId:t});case 3:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"createTournamentName",value:function(){var e=`${_l[G.randomRangeInt(0,_l.length-1)]} Tournament`;return`${GameCore.Utils.String.removeDiacritics(e)}`}},{key:"getShortName",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,i=e.split(" "),a=0,r="",o=je(i);try{for(o.s();!(t=o.n()).done;){var s=t.value;if(a+s.length+1>n)break;r+=`${s} `,a+=s.length+1}}catch(e){o.e(e)}finally{o.f()}return r.slice(0,-1)}},{key:"createTournamentPayload",value:function(){var e,t,n,i=GameCore.Utils.String.generateObjectId(),a=El.getPlayerId(),r=El.getPlayer().name,o=El.getGameData(),s=null!==(e=null==o?void 0:o.level)&&void 0!==e?e:1,l=kl.getLevelTheme(s),u=this.inst.getMatchState().profiles;return{score:null!==(t=null===(n=(void 0===u?{}:u)[a])||void 0===n?void 0:n.score)&&void 0!==t?t:0,playerId:a,mode:Il.TOURNAMENT,name:this.createTournamentName(),leaderboardId:i,payload:{playerId:a,playerName:r,leaderboardId:i,themeId:l}}}},{key:"getTournamentsAsync",value:(i=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameSDK.tournament.getTournamentsAsync();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return",[]);case 10:case"end":return e.stop()}}),e,null,[[0,6]])}))),function(){return i.apply(this,arguments)})},{key:"processCreateTournamentAsync",value:(n=Ae(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTournamentsAsync();case 2:if(t=e.sent,!(n=t.find((function(e){var t,n=JSON.parse(null!==(t=e.getPayload())&&void 0!==t?t:"{}");return"DEFAULT"===e.getTournamentType()&&n.playerId===El.getPlayerId()})))){e.next=6;break}throw new hl(El.getPlayerId(),n.getID());case 6:return i=this.createTournamentPayload(),El.setGameData({lastCreateTournamentShown:Date.now()}),e.next=10,Cl.tournament.create.processAsync(i);case 10:a=i.leaderboardId,Al.addLeaderboard({name:a,type:"tournament",autoSortRank:!0,leaderboardId:a});case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getMatchMode",value:function(){var e=this.inst.getMatchState();return Rl.isString(e.mode)?e.mode:null}},{key:"getMatchCustomData",value:function(){var e=this.inst.getMatchState();return Rl.isObject(e.customData)?e.customData:null}},{key:"getMatchExtraDataAsync",value:(t=Ae(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Cl.api.getMatchAPI().getMatchDetailByIdAsync(t);case 2:return n=e.sent,i=new GameCore.Dtos.Match.Data(n).toObject(),a=i.extraData,e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"updateMatchStateAfterLevelFinish",value:function(e,t){this.setMatchCustomDataAsync({level:e,score:t});var n=El.getPlayerId();this.setProfileMatchDataAsync({id:n,score:t})}}]),e}();try{new Ll}catch(e){console.error("MatchUtils",e)}n._RF.pop(),n._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);var Ol,Dl,Ml,Nl,Fl,Bl,Gl,zl=globalThis.game.event,Ul=GameCore.Events,Hl=function(){function e(){Te(this,e)}return Pe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"switchScene",value:function(e,t){zl.emit(Ul.SWITCH_SCENE,{sceneName:e,sceneData:t})}},{key:"preloadScene",value:function(e){zl.emit(Ul.PRELOAD_SCENE,{sceneName:e})}},{key:"preloadDashboardScene",value:function(){this.preloadScene(Js)}},{key:"switchToDashboardScene",value:function(e){this.switchScene(Js,e)}},{key:"preloadGameScene",value:function(){this.preloadScene($s)}},{key:"switchToGameScene",value:function(e){this.switchScene($s,e)}},{key:"getSceneData",value:function(e){return"data"in e.scene&&e.scene.data||{}}}]),e}();try{new Hl}catch(e){console.error("SceneUtils",e)}n._RF.pop(),n._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);var ql,Vl,Wl,Kl,jl,Yl=i.ccclass,Xl=i.property,$l=(Ol=Yl("LoadingFullScreen"),Dl=Xl(Y),Ml=Xl(u),Ol((Bl=$e((Fl=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"progressBar",Bl,Ne(e)),Xe(e,"loadingText",Gl,Ne(e)),e}return Pe(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"runLoadingTextAnimation",value:function(){var e=this,t=0;this.schedule((function(){t=t>2?0:t+1,e.loadingText.string="Loading"+".".repeat(t)}),.5)}},{key:"stopLoadingTextAnimation",value:function(){this.unscheduleAllCallbacks()}},{key:"show",value:(n=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=0,this.progressBar.progress=0,t=S(this.uiOpacity).to(.2,{opacity:255},{easing:"cubicOut"}),n=S(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"}),this.runLoadingTextAnimation(),yn.runTweenAsync(t),e.next=8,yn.runTweenAsync(n);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.uiOpacity&&this.progressBar){e.next=2;break}return e.abrupt("return");case 2:return this.uiOpacity.opacity=255,this.progressBar.progress=.9,t=S(this.uiOpacity).to(.15,{opacity:0},{easing:"cubicIn"}),n=S(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"}),this.runLoadingTextAnimation(),e.next=9,yn.runTweenAsync(n);case 9:return this.stopLoadingTextAnimation(),e.next=12,yn.runTweenAsync(t);case 12:this.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"progressBar",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gl=$e(Fl.prototype,"loadingText",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nl=Fl))||Nl);n._RF.pop(),n._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);var Jl=i.ccclass,Ql=i.property,Zl=(ql=Jl("Loading"),Vl=Ql(R),ql((jl=$e((Kl=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"loadingPrefab",jl,Ne(e)),e.loadingNode=null,e}return Pe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.makePersistent()}},{key:"makePersistent",value:function(){d.addPersistRootNode(this.node)}},{key:"createLoadingFullScreen",value:function(){var e,t=P("Canvas");if(t&&!t.getChildByName("Loading")){this.loadingNode||(this.loadingNode=l(this.loadingPrefab));var n=l._clone(this.loadingNode);this.loadingFullScreen=n.getComponent($l),this.node.active=!1,null===(e=P("Canvas"))||void 0===e||e.addChild(n)}}},{key:"show",value:(n=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.createLoadingFullScreen(),!this.node.active){e.next=3;break}return e.abrupt("return");case 3:return this.node.active=!0,e.next=6,this.loadingFullScreen.show();case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=this.node)&&void 0!==t&&t.active){e.next=2;break}return e.abrupt("return");case 2:if(this.loadingFullScreen){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,this.loadingFullScreen.hide();case 6:this.node.active=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"loadingPrefab",[Vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wl=Kl))||Wl);n._RF.pop(),n._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);var eu=globalThis.game.event,tu=GameCore.Events,nu=function(){function e(){Te(this,e),this.showedScreens=[]}var t,n;return Pe(e,null,[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"openScreen",value:function(e,t){eu.emit(tu.OPEN_SCREEN,{screenName:e,screenData:t})}},{key:"closeScreen",value:function(e){eu.emit(tu.CLOSE_SCREEN,{screenName:e})}},{key:"showLoadingScreen",value:function(e){this.openScreen(oi,{duration:e})}},{key:"closeLoadingScreen",value:function(){this.closeScreen(oi)}},{key:"showNotificationScreen",value:function(e,t){this.openScreen(ci,{message:e,duration:t})}},{key:"closeNotificationScreen",value:function(){this.closeScreen(ci)}},{key:"addShowedScene",value:function(e){this.inst.showedScreens.includes(e)||this.inst.showedScreens.push(e)}},{key:"showLoadingFullScreen",value:(n=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.inst.showedScreens.includes(t)){e.next=2;break}return e.abrupt("return");case 2:if(this.addShowedScene(t),n=P("Loading")){e.next=6;break}return e.abrupt("return");case 6:return n.active=!0,e.next=9,n.getComponent(Zl).show();case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"hideLoadingFullScreen",value:(t=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.inst.showedScreens.includes(t)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,null===(n=P("Loading"))||void 0===n?void 0:n.getComponent(Zl).hide();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"showLoadingNotificationScreen",value:function(){this.openScreen(ci,{message:"Loading",enableCloseOnTouch:!1})}},{key:"showTournamentDetailScreen",value:function(e,t){this.openScreen(fi,{tournament:e,tournamentContextType:t})}},{key:"closeTournamentDetailScreen",value:function(){this.closeScreen(fi)}}]),e}();try{new nu}catch(e){console.error("ScreenUtils",e)}n._RF.pop(),n._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);var iu=GameCore,au=iu.Utils,ru=iu.Configs,ou=globalThis.game,su=ou.leaderboard,lu=ou.player,uu=function(){function e(){var t=this;Te(this,e),this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(Date.now()-t.lastFetchGlobalTournament>t.maxTimeRefetch)){e.next=7;break}return e.next=5,su.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"});case 5:t.globalTournamentLBData=e.sent,t.globalTournamentLBData.sort((function(e,t){return e.expireTime-t.expireTime}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("fetchGlobalTournamentLeaderboardAsync",e.t0);case 12:return e.abrupt("return",t.globalTournamentLBData);case 13:case"end":return e.stop()}}),e,null,[[0,9]])}))),this.fetchTournamentsAsync=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(Date.now()-t.lastFetchTournamentsData>t.maxTimeRefetch)){e.next=7;break}return e.next=5,GameSDK.tournament.getTournamentsAsync();case 5:t.playerTournaments=e.sent,t.playerTournaments.sort((function(e,t){return e.getEndTime()-t.getEndTime()}));case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("fetchTournamentsAsync",e.t0);case 12:return e.abrupt("return",t.playerTournaments);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))}var t;return Pe(e,[{key:"processPlayerTournamentData",value:function(){var e,t=[],n=je(this.playerTournaments);try{for(n.s();!(e=n.n()).done;){var i,a,r=e.value,o=`${r.getID()}`,s=r.getContextID(),l=r.getEndTime(),u=this.parseTournamentPayload(r.getPayload());if(this.validateGameSDKTournamentPayload(u))if(!(l<Date.now()/1e3)&&"PAGE_HOSTED"!==r.getTournamentType()){var c=null!==(i=u.playerName)&&void 0!==i?i:"Player",h={id:o,title:null!==(a=r.getTitle())&&void 0!==a?a:this.createDefaultTournamentName(c),endTime:l,contextId:s,payload:u};t.push(h)}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"processGlobalTournamentLeaderboardData",value:function(){var e=[];if(ru.Mockup.Leaderboards.Enabled){for(var t=0;t<this.playerTournaments.length;t++){var n,i=this.playerTournaments[t],a=i.getTournamentType();if("PAGE_HOSTED"===a){var r=`${i.getID()}`,o=i.getContextID(),s=i.getEndTime(),l=this.parseTournamentPayload(i.getPayload()),u={id:r,title:null!==(n=i.getTitle())&&void 0!==n?n:"Global Tournament",endTime:s,contextId:o,payload:l,tournamentType:a};e.push(u)}}return e}for(var c=0;c<this.globalTournamentLBData.length;c++){var h,p={tournamentId:"",contextId:""},d=this.globalTournamentLBData[c];try{p=JSON.parse(d.description)}catch(e){continue}if(this.validateExpireTime(d)&&this.validateGlobalTournamentPayload(p)){var f={id:p.tournamentId,title:d.name,endTime:this.getTournamentEndTime(d),contextId:p.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:d._id,themeId:null!==(h=p.themeId)&&void 0!==h?h:yl.SUMMER}};e.push(f)}}return e}},{key:"validateGlobalTournamentPayload",value:function(e){var t=e.tournamentId,n=e.contextId;return!(!au.Valid.isString(t)||""===t)&&!(!au.Valid.isString(n)||""===n)}},{key:"getTournamentEndTime",value:function(e){var t=new Date(e.createdAt).getTime();return Math.round((1e3*e.expireTime+t)/1e3)}},{key:"validateExpireTime",value:function(e){return 1e3*this.getTournamentEndTime(e)-Date.now()>0}},{key:"validateGameSDKTournamentPayload",value:function(e){return!(!au.Valid.isString(e.playerId)||""===e.playerId)&&(!(!au.Valid.isString(e.playerName)||""===e.playerName)&&!(!au.Valid.isString(e.leaderboardId)||""===e.leaderboardId))}},{key:"createDefaultTournamentName",value:function(e){var t=e.substring(0,7),n=`${t.split(" ")[0]||t}'s Tournament`;return`${GameCore.Utils.String.removeDiacritics(n)}`}},{key:"parseTournamentPayload",value:function(e){if("string"!=typeof e)return{};try{return JSON.parse(e)}catch(e){return{}}}}],[{key:"getInstance",value:function(){return this._instance||(this._instance=new e),this._instance}},{key:"requestTournamentDataAsync",value:(t=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getInstance(),e.next=3,Promise.all([t.fetchTournamentsAsync(),t.fetchGlobalTournamentLeaderboardAsync()]);case 3:return n=t.processPlayerTournamentData(),i=t.processGlobalTournamentLeaderboardData(),t.tournamentData=[].concat(Ve(n),Ve(i)),t.tournamentData.sort((function(e,t){return e.endTime-t.endTime})),t.tournamentData.forEach((function(e){var t=e.payload.leaderboardId;su.isExistLeaderboardId(t)||su.addLeaderboard({type:"tournament",name:t,autoSortRank:!0,leaderboardId:t})})),e.abrupt("return",t.tournamentData);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getAllTournamentData",value:function(){return this.getInstance().tournamentData}},{key:"getTournamentDataById",value:function(e){return this.getInstance().tournamentData.find((function(t){return t.id===e}))}},{key:"getPlayerTournamentData",value:function(){var e=this.getInstance(),t=lu.getPlayerId();return e.tournamentData.filter((function(e){return e.payload.playerId===t}))}},{key:"getFriendsTournamentData",value:function(){var e=this.getInstance(),t=lu.getPlayerId();return e.tournamentData.filter((function(e){var n=e.payload;return n.playerId!==t&&"global"!==n.playerId}))}},{key:"getGlobalTournamentData",value:function(){return this.getInstance().tournamentData.filter((function(e){return"global"===e.payload.playerId}))}},{key:"validateTournamentExpired",value:function(e){var t=this.getTournamentDataById(e);return!!t&&t.endTime<Date.now()/1e3}}]),e}();n._RF.pop(),n._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);var cu,hu="time",pu="bomb";n._RF.pop(),n._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);var du=(0,i.ccclass)("InputController")(cu=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).pointerDownOutSideCanvas=!1,e.handleElementPointerDown=function(){e.pointerDownOutSideCanvas=!0},e.handleElementPointerUp=function(t){e.pointerDownOutSideCanvas=!1},e}return Pe(n,[{key:"onLoad",value:function(){this.listenInputEvents()}},{key:"listenInputEvents",value:function(){K.os!==K.OS.WINDOWS&&K.os!==K.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}},{key:"onDestroy",value:function(){K.os!==K.OS.WINDOWS&&K.os!==K.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}}]),n}(f))||cu;n._RF.pop(),n._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);var fu={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};n._RF.pop(),n._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);var vu="fall-down",yu="fly-up",mu="push-left",gu="push-right",bu="put-column-middle",wu="put-row-middle";function ku(e){for(var t=e.array,n=e.isLighter,i=e.out,a=void 0===i?new Set:i,r=0;r<t.length;r++)if(n(t.get(r)))for(var o=r+1;o<t.length;o++)if(!n(t.get(o))){t.swap(r,o),a.add(t.get(r));break}return a}n._RF.pop(),n._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);var Su=function(){function e(t){var n;Te(this,e),this.array=[];var i=null!=t?t:{},a=i.width,r=void 0===a?1:a,o=i.height,s=void 0===o?1:o,l=t instanceof e?t.array:null!==(n=null==t?void 0:t.content)&&void 0!==n?n:[];if(l.length!==r*s)throw new Error("Invalid content length");this.width=r,this.height=s,this.array=Array.from(l)}return Pe(e,[{key:"asArray",value:function(){return this.array}},{key:"get",value:function(e,t){return this.array[t*this.width+e]}},{key:"set",value:function(e,t,n){this.array[t*this.width+e]=n}},{key:"isInBounds",value:function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}},{key:"forEach",value:function(e){for(var t=0;t<this.height;t++)for(var n=0;n<this.width;n++)e(this.get(n,t),n,t)}},{key:"map",value:function(e){for(var t=[],n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.push(e(this.get(i,n),i,n));return t}},{key:"reduce",value:function(e,t){for(var n=t,i=0;i<this.height;i++)for(var a=0;a<this.width;a++)n=e(n,this.get(a,i),a,i);return n}},{key:"swap",value:function(e,t){var n=qe(e,2),i=n[0],a=n[1],r=qe(t,2),o=r[0],s=r[1],l=this.get(i,a);this.set(i,a,this.get(o,s)),this.set(o,s,l)}},{key:"shuffle",value:function(e){for(var t,n=Ve(e=null!==(t=e)&&void 0!==t?t:this.map((function(e,t,n){return[t,n]}))),i=new Set,a=n.length-1;a>0;a--){var r=Z(0,a+1),o=[n[r],n[a]];n[a]=o[0],n[r]=o[1],i.add(this.get(n[a][0],n[a][1])),i.add(this.get(n[r][0],n[r][1]))}for(var s=0;s<n.length;s++){var l=qe(e[s],2),u=l[0],c=l[1],h=qe(n[s],2),p=h[0],d=h[1];this.swap([u,c],[p,d])}return i}},{key:"toShuffled",value:function(t){var n=new e({width:this.width,height:this.height,content:this.array}),i=n.shuffle(t);return[n,i]}},{key:"gravitate",value:function(e){var t=this,n=qe(e.rowRange,2),i=n[0],a=n[1],r=qe(e.colRange,2),o=r[0],s=r[1],l=e.direction,u=e.isLighter,c=e.onSwap,h=e.out,p=void 0===h?new Set:h,d=s-o+1,f=a-i+1;switch(l){case fu.Up:for(var v=function(e){ku({array:{length:f,get:function(n){return t.get(e,a-n)},swap:function(n,i){var r=t.get(e,a-n),o=t.get(e,a-i);t.swap([e,a-n],[e,a-i]),null==c||c(r,o)}},isLighter:u,out:p})},y=o;y<=s;y++)v(y);return p;case fu.Down:for(var m=function(e){ku({array:{length:f,get:function(n){return t.get(e,i+n)},swap:function(n,a){var r=t.get(e,i+n),o=t.get(e,i+a);t.swap([e,i+n],[e,i+a]),null==c||c(r,o)}},isLighter:u,out:p})},g=o;g<=s;g++)m(g);return p;case fu.Left:for(var b=function(e){ku({array:{length:d,get:function(n){return t.get(o+n,e)},swap:function(n,i){var a=t.get(o+n,e),r=t.get(o+i,e);t.swap([o+n,e],[o+i,e]),null==c||c(a,r)}},isLighter:u,out:p})},w=i;w<=a;w++)b(w);return p;case fu.Right:for(var k=function(e){ku({array:{length:d,get:function(n){return t.get(s-n,e)},swap:function(n,i){var a=t.get(s-n,e),r=t.get(s-i,e);t.swap([s-n,e],[s-i,e]),null==c||c(a,r)}},isLighter:u,out:p})},S=i;S<=a;S++)k(S);return p;default:throw new Error("Invalid direction")}}},{key:"toGravitated",value:function(){var t=new e({width:this.width,height:this.height,content:this.array}),n=t.gravitate.apply(t,arguments);return[t,n]}},{key:"toRotated",value:function(){for(var t=new e({width:this.height,height:this.width,content:new Array(this.width*this.height)}),n=0;n<this.height;n++)for(var i=0;i<this.width;i++)t.set(this.height-1-n,i,this.get(i,n));return t}}]),e}();n._RF.pop(),n._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),n._RF.pop(),n._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);var Cu,Eu,Au,Tu,xu,Pu,Ru,Iu,_u,Lu,Ou,Du,Mu,Nu,Fu,Bu,Gu,zu,Uu,Hu,qu,Vu,Wu,Ku,ju,Yu={bomb:"bomb",star:"star",none:"none"};n._RF.pop(),n._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);var Xu=i.ccclass,$u=i.property,Ju=i.requireComponent,Qu=(Cu=Xu("Tile"),Eu=Ju([s]),Au=Ju([M]),Tu=$u(T),xu=$u(T),Pu=$u(T),Ru=$u(a),Iu=$u({type:s,displayName:"Background's UI Transform"}),_u=$u({type:M,displayName:"This UI Opacity"}),Lu=$u(M),Ou=$u(M),Du=$u(oa),Mu=$u(y),Cu(Nu=Eu(Nu=Au((Bu=$e((Fu=function(e){Ie(h,e);var t,n,i,a,r,o,s,l,u,c=Be(h);function h(){var e;Te(this,h);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=c.call.apply(c,[this].concat(n)),"icon",Bu,Ne(e)),Xe(e,"bombComponent",Gu,Ne(e)),Xe(e,"starComponent",zu,Ne(e)),Xe(e,"background",Uu,Ne(e)),Xe(e,"bgUITransform",Hu,Ne(e)),Xe(e,"uiOpacity",qu,Ne(e)),Xe(e,"shineOpacity",Vu,Ne(e)),Xe(e,"glowOpacity",Wu,Ne(e)),Xe(e,"button",Ku,Ne(e)),Xe(e,"animationComponent",ju,Ne(e)),e.id=null,e.isEmpty=!1,e.coord=new $,e.restoreSignal=new ha,e}return Pe(h,[{key:"onLoad",value:function(){St.lazyValidateProperties(this),this.special=this.createSpecialHandler(Yu.none)}},{key:"update",value:function(e){var t;(null===(t=this.special)||void 0===t?void 0:t.type)===Yu.bomb&&this.special.update(e)}},{key:"onDestroy",value:function(){var e,t;(null===(e=this.special)||void 0===e?void 0:e.type)===Yu.bomb&&(null===(t=this.special)||void 0===t||t.onDestroy())}},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.button.interactable=!e}},{key:"getCoord",value:function(){return this.coord}},{key:"setCoord",value:function(e,t){this.coord.set(e,t)}},{key:"isSimilarTo",value:function(e){return this.id===e.id}},{key:"inSamePositionAs",value:function(e,t){return e instanceof h?this.coord.equals(e.getCoord()):this.coord.x===e&&this.coord.y===t}},{key:"isHidden",value:function(){return this.isEmpty}},{key:"getSize",value:function(){return[this.bgUITransform.width,this.bgUITransform.height]}},{key:"onClick",value:function(){this.isHidden()||this.node.scene.emit(tr.TILE_CLICK,this)}},{key:"setIdentity",value:function(e){this.id=e,this.icon.spriteFrame=e;var t=qe(this.getSize(),2),n=t[0],i=t[1],a=e.originalSize,r=a.width,o=a.height,s=Math.max(r/(.7*n),o/(.7*i));s>1&&this.icon.node.setScale(new j(1/s,1/s,1))}},{key:"setSpecialType",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Yu.none,n=arguments.length>1?arguments[1]:void 0;null===(e=this.special)||void 0===e||e.switch(t,n)}},{key:"setFocused",value:(u=Ae(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=S(this.shineOpacity).to(.2,{opacity:t?255:0},{easing:"quadIn"}),this.shineOpacity.node.scale=t?j.ZERO:j.ONE,i=S(this.shineOpacity.node).to(.2,{scale:t?j.ONE:j.ZERO},{easing:"quadOut"}),t?((a=S(this.glowOpacity).to(2,{opacity:150})).to(2,{opacity:20}),this.glowOpacityTween=S(this.glowOpacity).repeatForever(a).start()):(this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0),e.next=6,Promise.all([yn.runTweenAsync(n),yn.runTweenAsync(i)]);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"setEmpty",value:function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty){var i;if(this.restoreSignal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),n)return this.uiOpacity.opacity=0,void(null===(i=this.special)||void 0===i||i.switch(Yu.none));(null===(e=this.special)||void 0===e?void 0:e.type)===Yu.star&&this.special.clear(),null===(t=this.special)||void 0===t||t.switch(Yu.none),this.uiOpacity.opacity=0}}},{key:"setHint",value:(l=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return e.next=3,this.loadShakeClip();case 3:this.shakeClip&&this.runAnimation(this.shakeClip.name),e.next=10;break;case 6:return this.animationComponent.stop(),n=S(this.background).to(.1,{scale:j.ONE,eulerAngles:j.ZERO}),e.next=10,yn.runTweenAsync(n);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"playClearFX",value:(s=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null,"clear"!==t){e.next=7;break}return e.next=4,this.loadClearClip();case 4:n=this.clearClip,e.next=10;break;case 7:return e.next=9,this.loadBreakClip();case 9:n=this.breakClip;case 10:if(null===n){e.next=13;break}return e.next=13,this.runAnimation(n.name);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"restore",value:(o=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.restoreSignal.abort(),this.restoreSignal=new ha,this.isEmpty=!1,this.setIgnoreInput(!0),t&&this.setIdentity(t),this.uiOpacity.opacity=255,this.node.setScale(j.ZERO),this.button.fakeClick(),e.next=10,yn.runTweenAsync(S(this.node).to(.3,{scale:j.ONE},{easing:"backOut"}),this.restoreSignal);case 10:this.node.setScale(j.ONE),this.setIgnoreInput(!1);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"sync",value:(r=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.duration,i=void 0===n?.3:n,a=t.delay,r=void 0===a?0:a,o=t.easing,s=void 0===o?"cubicOut":o,l=t.getTargetPosition,u=l(this.coord),c=new j(u.x,u.y,this.node.position.z),e.next=5,yn.runTweenAsync(S(this.node).delay(r).to(i,{position:c},{easing:s}));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fly",value:(a=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=300,i=Math.sqrt(Math.pow(this.node.position.x,2)+Math.pow(this.node.position.y,2)),a=Math.max(n-.7*i,0),r=i/1e3,o=this.node.position.clone(),s=t.getTilePosition(this.coord),l=new j(s.x,s.y,this.node.position.z),u=this.background,c=2,h=1,p=360,d=.0025*a,f=0,v=new j(0,0,0),y=.75-d,(g=S(m={value:0,prevElapsed:0})).delay(r),g.to(.5,{value:0},{progress:function(e,t,n,i){var a=(c*=-1)*i,r=o.clone();return r.x+=a,b.node.setPosition(r),n}}),g.to(d,{value:1},{progress:function(e,t,i,r){var o=yn.easeOutExpo(r),s=d*r-m.prevElapsed,l=d*r,c=a*o;b.setHeight(c,n);var f=b.node.position.clone();h+=.1,j.rotateZ(f,f,new j(0,0,0),h*Math.PI*s),b.node.setPosition(new j(f.x,f.y,f.z));var v=(p+=10)*s;return u.angle+=v,m.prevElapsed=l,i}}),g.call((function(){v.set((b.node.position.x+l.x)/2,(b.node.position.y+l.y)/2,0),m.prevElapsed=0,u.angle%=360,u.angle-=360,f=u.angle})),g.to(y,{value:0},{progress:function(e,t,i,r){var o=y*r-m.prevElapsed,s=y*r,l=a*(1-r);b.setHeight(l,n);var c=b.node.position.clone();return j.rotateZ(c,c,v,Math.PI/y*o),b.node.setPosition(new j(c.x,c.y,c.z)),u.angle+=-f/y*o,m.prevElapsed=s,i}}),g.call((function(){b.node.setPosition(l),b.setHeight(0,n),u.angle=0})),e.abrupt("return",yn.runTweenAsync(g));case 25:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"loadBreakClip",value:(i=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.breakClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Jn.loadAnimClipAsync(Un.TILE_BREAK_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.breakClip=t,this.animationComponent.addClip(this.breakClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"loadClearClip",value:(n=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.clearClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Jn.loadAnimClipAsync(Un.TILE_CLEAR_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.clearClip=t,this.animationComponent.addClip(this.clearClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadShakeClip",value:(t=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.shakeClip){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Jn.loadAnimClipAsync(Un.TILE_SHAKE_ANIM);case 4:if(t=e.sent){e.next=7;break}return e.abrupt("return",Promise.resolve());case 7:this.shakeClip=t,this.animationComponent.addClip(this.shakeClip);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"runAnimation",value:function(e){var t=this;return this.animationComponent.play(e),new Promise((function(e){t.animationComponent.once(y.EventType.FINISHED,(function(){e()}))}))}},{key:"setHeight",value:function(e,t){var n=this.background;n.setPosition(new j(n.position.x,e,0)),n.setScale(new j(1+e/t*.3,1+e/t*.3,1))}},{key:"createSpecialHandler",value:function(e,t){var n=this;switch(e){case Yu.bomb:return this.createBombHandler(null!=t?t:90);case Yu.star:return this.createStarHandler();default:return{type:Yu.none,switch:function(e,t){n.special=n.createSpecialHandler(e,t)}}}}},{key:"createBombHandler",value:function(e){var t=this,n=!1,i=e,a=function(){n=!0},r=function(){n=!1};this.node.scene.on(tr.TILE_CLICK,a),this.node.scene.on(tr.USE_ITEM,a),this.node.scene.on(tr.RESUME_TIME,a),this.node.scene.on(tr.PAUSE_TIME,r),this.node.scene.on(tr.TIME_OUT,r),this.bombComponent.node.active=!0;var o=function(){n=!1,t.bombComponent.node.active=!1,i=e,t.node.scene.off(tr.TILE_CLICK,a),t.node.scene.off(tr.USE_ITEM,a),t.node.scene.off(tr.GAME_RESUME,a),t.node.scene.off(tr.GAME_PAUSE,r),t.node.scene.off(tr.TIME_OUT,r)};return{type:Yu.bomb,update:function(a){n&&(i-=a,t.bombComponent.fillRange=-i/e,i<=0&&(n=!1,t.bombComponent.node.active=!1,t.node.scene.emit(tr.BOMB_EXPLODE,t),t.setEmpty()))},cleanup:o,onDestroy:function(){t.node.scene.off(tr.TILE_CLICK,a),t.node.scene.off(tr.USE_ITEM,a),t.node.scene.off(tr.GAME_RESUME,a),t.node.scene.off(tr.GAME_PAUSE,r),t.node.scene.off(tr.TIME_OUT,r)},switch:function(e,n){o(),t.special=t.createSpecialHandler(e,n)},detonateImmediately:function(){i=0}}}},{key:"createStarHandler",value:function(){var e=this;this.starComponent.node.active=!0;var t=function(){e.starComponent.node.active=!1};return{type:Yu.star,clear:function(){e.starComponent.node.active=!1;var t=e.node.worldPosition,n=t.x,i=t.y;e.node.scene.emit(tr.ADD_STARS,{startAnimationAt:[n,i]})},cleanup:t,switch:function(n){t(),e.special=e.createSpecialHandler(n)}}}}]),h}(f)).prototype,"icon",[Tu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gu=$e(Fu.prototype,"bombComponent",[xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zu=$e(Fu.prototype,"starComponent",[Pu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uu=$e(Fu.prototype,"background",[Ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hu=$e(Fu.prototype,"bgUITransform",[Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qu=$e(Fu.prototype,"uiOpacity",[_u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vu=$e(Fu.prototype,"shineOpacity",[Lu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wu=$e(Fu.prototype,"glowOpacity",[Ou],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=$e(Fu.prototype,"button",[Du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ju=$e(Fu.prototype,"animationComponent",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nu=Fu))||Nu)||Nu)||Nu);function Zu(e,t,n){var i=qe(e,2),a=i[0],r=i[1],o=qe(t,2),s=o[0],l=o[1],u=qe(n,2),c=u[0]/(a*s),h=u[1]/(r*l);return Math.min(c,h)}function ec(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=n.x,r=n.y,o=qe(t,2),s=o[0],l=o[1],u=s*(a-(e.width-1)/2)+i*(a-e.width/2),c=l*(r-(e.height-1)/2)+i*(r-e.height/2);return-1===a&&(u+=t[0]/4),a===e.width&&(u-=t[0]/4),-1===r&&(c+=t[1]/4),r===e.height&&(c-=t[1]/4),{x:u,y:c}}function tc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],n=qe(e,2),i=n[0],a=n[1],r=qe(t,2),o=r[0],s=r[1],l=1-o,u=1-s,c=i*l,h=a*u;return[c,h]}function nc(e){for(var t=e.split("-"),n=[],i=0;i<t.length;){switch(t[i]){case"normal":i+=1;break;case"fall":n.push(vu),i+=2;break;case"fly":n.push(yu),i+=2;break;case"push":"left"===t[i+1]?(n.push(mu),i+=2):(n.push(gu),i+=2);break;case"put":"columns"===t[i+1]?(n.push(bu),i+=3):(n.push(wu),i+=3)}}return n}function ic(e){return(e instanceof Su?e.asArray():e).filter((function(e){return!e.isHidden()}))}function ac(e){return(e instanceof Su?e.asArray():e).filter((function(e){return e.isHidden()}))}function rc(e,t){var n=t.getCoord(),i=n.x,a=n.y;return Object.values(fu).reduce((function(t,n){var r=n.x,o=n.y,s=i+r,l=a+o;return e.isInBounds(s,l)&&t.push(e.get(s,l)),t}),[])}function oc(e){return Array.isArray(e)}function sc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=oc(e)?e:e.asArray();return n[ee(t,0,n.length)]}function lc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e instanceof Su?e.asArray():e,i=sc(n,t),a=n.find((function(e){return e.isSimilarTo(i)&&!e.inSamePositionAs(i)}));if(void 0===a)throw new Error("Could not find a matching tile");return[i,a]}n._RF.pop(),n._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),n._RF.pop(),n._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),n._RF.pop(),n._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),n._RF.pop(),n._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),n._RF.pop(),n._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),n._RF.pop(),n._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),n._RF.pop(),n._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),n._RF.pop(),n._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),n._RF.pop(),n._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0),n._RF.pop(),n._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),n._RF.pop(),n._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0),n._RF.pop(),n._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);var uc=function(e){return e};function cc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:uc;return Se().mark((function i(){var a,r;return Se().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:a=t,e<=0&&(e=1/0),r=0;case 3:if(!(r<e)){i.next=10;break}return i.next=6,n(a);case 6:a=1e9*te(a);case 7:r++,i.next=3;break;case 10:case"end":return i.stop()}}),i)}))()}function hc(e){return Array.isArray(e)}function pc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=hc(e)?e:e.asArray();if(i.length<t)return new Set(i);for(var a=new Set,r=cc(-1,n),o=r.next();a.size<t;){if(o.done)throw new Error("RNG exhausted");a.add(sc(i,o.value)),o=r.next()}return a}n._RF.pop(),n._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),n._RF.pop(),n._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),n._RF.pop(),n._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);var dc=[1,4];function fc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),i=t.specials,a=i.bomb,r=ee.apply(void 0,[n].concat(dc)),o=pc(e,a,n),s=e.asArray().filter((function(e){return!o.has(e)})),l=pc(s,r,n);o.forEach((function(e){var n=2*t.time/3;e.setSpecialType(Yu.bomb,n)})),l.forEach((function(e){return e.setSpecialType(Yu.star)}))}function vc(e){var t=e.levelData,n=t.columns,i=t.rows,a=e.identities,r=e.createTile,o=e.seed,s=function(e,t,n){var i,a=[],r=je(cc(t/2,e,(function(e){return ee(e,0,n.length)})));try{for(r.s();!(i=r.n()).done;){var o=i.value;a.push(n[o]),a.push(n[o])}}catch(e){r.e(e)}finally{r.f()}return GameCore.Utils.Array.shuffle(a),a}(void 0===o?Date.now():o,n*i,a).map((function(e){var t=r(e);return t.setIdentity(e),t}));return new Su({width:n,height:i,content:s})}function yc(e){var t=e.customFen,n=e.identities,i=e.createTile,a=t.idSize,r=t.cols,o=t.rows,s=t.code;if(n.length<t.idSize)throw new Error(`Invalid grid code. There are not enough identities/frames ${n.length} to fill it according to fen code ${a}`);var l=s.split(":");if(l.length!==o)throw new Error("Invalid grid code");var u=l.reduceRight((function(e,a){var r=Array.from(a.matchAll(Ce(/([a-zA-Z]+)(\d+)|./g,{ttype:1,itype:2})),(function(e){var a,r=null!==(a=e.groups)&&void 0!==a?a:{ttype:void 0,itype:void 0},o=r.ttype,s=r.itype;if(void 0!==o&&void 0!==s){var l=n[parseInt(s,10)],u=i(l),c=function(e,t){var n=Object.entries(t).find((function(t){var n=qe(t,2);n[0];return n[1]===e}));if(void 0===n)throw new Error(`Invalid special type ${e}`);return n[0]}(o,t.encoding);return u.setSpecialType(c),u}var h=i(n[0]);return h.setEmpty(),h}));return e.concat(r)}),[]);return new Su({width:r,height:o,content:u})}function mc(e){var t=e.toRotated();return t.forEach((function(e,t,n){e.setCoord(t,n)})),t}function gc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now(),n=e.asArray(),i=sc(e,t),a=rc(e,i);if(!a.some((function(e){return e.isSimilarTo(i)}))){var r=sc(a,t),o=n.find((function(e){return!e.inSamePositionAs(i)&&!e.inSamePositionAs(r)&&e.isSimilarTo(r)}));o.setIdentity(i.id),r.setIdentity(i.id)}}n._RF.pop(),n._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),n._RF.pop(),n._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0),n._RF.pop(),n._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0),n._RF.pop(),n._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),n._RF.pop(),n._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0),n._RF.pop(),n._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),n._RF.pop(),n._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var bc=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];function wc(e,t){return e[0]===t[0]&&e[1]===t[1]}function kc(e){return new $(e[0],e[1])}function Sc(e,t){return e.x>=-1&&e.x<t.width+1&&e.y>=-1&&e.y<t.height+1}function Cc(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ec;return t.map((function(t){return[e.tile[0]+t.x,e.tile[1]+t.y]}))}n._RF.pop(),n._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);var Ec=[fu.Up,fu.Down,fu.Left,fu.Right],Ac=function(){function e(t,n){var i;if(Te(this,e),this.f=0,this.g=0,this.h=0,n&&wc(t,n.tile))throw new Error("Tile cannot be its own parent");this.tile=t,this.parent=n;var a=e.calcDirection(this),r=n&&a&&n.cache.direction&&!a.equals(n.cache.direction)?1:0;this.cache={direction:a,turns:r+(null!==(i=null==n?void 0:n.cache.turns)&&void 0!==i?i:0)}}return Pe(e,[{key:"getKey",value:function(){var e;return`x:${this.tile[0]},y:${this.tile[1]},d:${null===(e=this.cache.direction)||void 0===e?void 0:e.toString()}`}},{key:"equals",value:function(e){return this.getKey()===e.getKey()}}],[{key:"calcDirection",value:function(e){if(e.parent){var t=e.parent.tile,n=e.tile;return new $(n[0]-t[0],n[1]-t[1])}return null}}]),e}();function Tc(e,t){var n=e.tile,i=t.tile;return Math.abs(n[0]-i[0])+Math.abs(n[1]-i[1])}function xc(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=[],r=je(Ec);try{var o=function(){var r=n.value,o={x:t[0]+r.x,y:t[1]+r.y};if(e.isInBounds(o.x,o.y))return(e.get(o.x,o.y).isHidden()||i.find((function(e){return wc(e,[o.x,o.y])})))&&a.push(r),1;Sc(o,e)&&a.push(r)};for(r.s();!(n=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}return a}function Pc(e,t,n,i){if(i){var a=bc[4].startTile,r=bc[4].endTile;if(t[0]===a.x&&t[1]===a.y&&n[0]===r.x&&n[1]===r.y)return[{a:a,b:r}];if(t[0]===r.x&&t[1]===r.y&&n[0]===a.x&&n[1]===a.y)return[{a:a,b:r}]}return function(e,t,n){var i=[],a=[],r=new Ac(t,null),o=new Ac(n,null),s=[o.tile];for(i.push(r);i.length>0;){var l=i.shift();if(a.push(l),wc(l.tile,o.tile)){for(var u=[],c=l,h=l,p=l.parent;p;)p.cache.turns!==h.cache.turns&&(u.unshift({a:kc(p.tile),b:kc(c.tile)}),c=p),h=p,p=p.parent;return u.unshift({a:kc(h.tile),b:kc(c.tile)}),u}var d,f=je(Cc(l,xc(e,l.tile,s)));try{var v=function(){var e=d.value,t=new Ac(e,l);if(t.cache.turns>8)return 0;var n=wc(t.tile,o.tile),r=a.some((function(e){return e.equals(t)}));if(i.some((function(e){return e.equals(t)}))||r&&!n)return 0;t.g=l.g+1+t.cache.turns,t.h=Tc(t,o),t.f=t.g+t.h,i.push(t)};for(f.s();!(d=f.n()).done;)v()}catch(e){f.e(e)}finally{f.f()}i.sort((function(e,t){return e.f-t.f}))}var y=r.tile,m=o.tile;return y[0]===m[0]||y[1]===m[1]?[{a:kc(y),b:kc(m)}]:[{a:kc(y),b:{x:y[0],y:m[1]}},{a:{x:y[0],y:m[1]},b:kc(m)}]}(e,t,n)}n._RF.pop(),n._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),n._RF.pop(),n._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);var Rc={[Yu.bomb]:"b",[Yu.star]:"s",[Yu.none]:"t"};function Ic(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rc,n=e.width,i=e.height,a=[],r=new Map,o=i-1;o>=0;o--){for(var s=[],l=0;l<n;l++){var u,c,h=e.get(l,o),p=h.isHidden()?null:h.id;if(null!==p){var d=null!==(u=null===(c=h.special)||void 0===c?void 0:c.type)&&void 0!==u?u:Yu.none,f=t[d];if(!r.has(p)){var v=r.size.toString();r.set(p,v)}var y=`${f}${r.get(p)}`;s.push(y)}else s.push(".")}a.push(s.join(""))}return{code:a.join(":"),idSize:r.size,encoding:t,rows:i,cols:n}}function _c(e){return e.reduce((function(e,t,n,i){return t.inSamePositionAs(n,i)||e.push([t,[n,i]]),e}),[])}n._RF.pop(),n._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),n._RF.pop();var Lc=Se().mark(Oc);function Oc(e,t){var n,i,a,r,o,s,l,u;return Se().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=0,i=e-1,a=0,r=t-1;case 4:if(!(n<=i&&a<=r)){c.next=39;break}o=n;case 6:if(!(o<=i)){c.next=12;break}return c.next=9,{x:o,y:a};case 9:o++,c.next=6;break;case 12:a++,s=a;case 14:if(!(s<=r)){c.next=20;break}return c.next=17,{x:i,y:s};case 17:s++,c.next=14;break;case 20:i--,l=i;case 22:if(!(l>=n)){c.next=28;break}return c.next=25,{x:l,y:r};case 25:l--,c.next=22;break;case 28:r--,u=r;case 30:if(!(u>=a)){c.next=36;break}return c.next=33,{x:n,y:u};case 33:u--,c.next=30;break;case 36:n++,c.next=4;break;case 39:case"end":return c.stop()}}),Lc)}n._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),n._RF.pop(),n._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);var Dc,Mc,Nc,Fc,Bc,Gc,zc,Uc,Hc=function(){function e(t,n){Te(this,e),this.coord=new $(t,n)}return Pe(e,[{key:"isHidden",value:function(){return!0}},{key:"isSimilarTo",value:function(){return!1}}]),e}();function qc(e){return new $(e[0],e[1])}function Vc(e,t,n){if(void 0===t||void 0===n)return function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Oc,i=Array.from(n(e.width,e.height)).map((function(t){var n=t.x,i=t.y;return[e.get(n,i),[n,i]]})).filter((function(e){return!qe(e,1)[0].isHidden()})),a=[],r=function(){var t=qe(i.shift(),2),n=t[0],r=t[1];if(a.find((function(e){return jc(e,r)})))return 0;a.push(r);var o,s=je(i);try{var l,u=function(){var t=qe(o.value,2),i=t[0],s=t[1];if(!i.isSimilarTo(n)||a.find((function(e){return jc(e,s)})))return 0;var l=Vc(e,r,s);return null!==l?{v:{v:l}}:void 0};for(s.s();!(o=s.n()).done;)if(0!==(l=u())&&l)return l.v}catch(e){s.e(e)}finally{s.f()}};for(;i.length>0;)if(0!==(t=r())&&t)return t.v;return null}(e);var i,a=[t[0]+1,t[1]+1],r=[n[0]+1,n[1]+1],o=function(e){var t=new Array(e.width+2).fill(null).map((function(e,t){return new Hc(t-1,-1)})),n=new Array(e.width+2).fill(null).map((function(t,n){return new Hc(n-1,e.height)})),i=new Array(e.height).fill(null).map((function(e,t){return new Hc(-1,t)})),a=new Array(e.height).fill(null).map((function(t,n){return new Hc(e.width,n)})),r=function(r,o){var s=r-1,l=o-1;return-1===s?i[l]:s===e.width?a[l]:-1===l?t[s]:l===e.height?n[s]:e.get(s,l)};return{get:(e,t)=>r(e,t),width:e.width+2,height:e.height+2}}(e),s=[a,r];if(a[0]===r[0]&&Xc(o,s,a[1],r[1],a[0])||a[1]===r[1]&&$c(o,s,a[0],r[0],a[1]))return Zc([{a:qc(a),b:qc(r)}],{x:-1,y:-1});var l=a[1]<=r[1]?a:r,u=a[1]<=r[1]?r:a,c=a[0]<=r[0]?a:r,h=a[0]<=r[0]?r:a,p=[],d=[];return-1===(i=Jc(o,s,1,qc(l),qc(u)))&&-1===(i=Jc(o,s,-1,qc(l),qc(u)))||(p=[{a:qc(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:r[0],y:i}},{a:{x:r[0],y:i},b:qc(r)}]),-1===(i=Qc(o,s,1,qc(c),qc(h)))&&-1===(i=Qc(o,s,-1,qc(c),qc(h)))||(p=[{a:qc(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:r[1]}},{a:{x:i,y:r[1]},b:qc(r)}]),-1!==(i=function(e,t,n,i){for(var a=n.y+1;a<i.y;a++)if(Xc(e,t,n.y,a,n.x)&&$c(e,t,n.x,i.x,a)&&Xc(e,t,a,i.y,i.x))return a;return-1}(o,s,qc(l),qc(u)))?d=[{a:qc(a),b:{x:a[0],y:i}},{a:{x:a[0],y:i},b:{x:r[0],y:i}},{a:{x:r[0],y:i},b:qc(r)}]:-1!==(i=function(e,t,n,i){for(var a=n.x+1;a<i.x;a++)if($c(e,t,n.x,a,n.y)&&Xc(e,t,n.y,i.y,a)&&$c(e,t,a,i.x,i.y))return a;return-1}(o,s,qc(c),qc(h)))&&(d=[{a:qc(a),b:{x:i,y:a[1]}},{a:{x:i,y:a[1]},b:{x:i,y:r[1]}},{a:{x:i,y:r[1]},b:qc(r)}]),p.length>0&&d.length>0?Zc(Wc(p)<=Wc(d)?p:d,{x:-1,y:-1}):p.length>0?Zc(p,{x:-1,y:-1}):d.length>0?Zc(d,{x:-1,y:-1}):null}function Wc(e){var t,n=0,i=je(e);try{for(i.s();!(t=i.n()).done;){n+=Kc(t.value)}}catch(e){i.e(e)}finally{i.f()}return n}function Kc(e){return e.a.x===e.b.x?Math.abs(e.a.y-e.b.y):e.a.y===e.b.y?Math.abs(e.a.x-e.b.x):0}function jc(e,t){return e[0]===t[0]&&e[1]===t[1]}function Yc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=e.get.apply(e,Ve(t));return i.isHidden()||n.some((function(e){return jc(e,t)}))}function Xc(e,t,n,i,a){for(var r=Math.min(n,i),o=Math.max(n,i),s=r;s<=o;s++)if(!Yc(e,[a,s],t))return!1;return!0}function $c(e,t,n,i,a){for(var r=Math.min(n,i),o=Math.max(n,i),s=r;s<=o;s++)if(!Yc(e,[s,a],t))return!1;return!0}function Jc(e,t,n,i,a){var r=1===n?a.y:i.y,o=1===n?i.x:a.x;if(Xc(e,t,i.y,a.y,o))for(;r>=0&&r<e.height&&Yc(e,[i.x,r],t)&&Yc(e,[a.x,r],t);){if($c(e,t,i.x,a.x,r))return r;r+=n}return-1}function Qc(e,t,n,i,a){var r=1===n?a.x:i.x,o=1===n?i.y:a.y;if($c(e,t,i.x,a.x,o))for(;r>=0&&r<e.width&&Yc(e,[r,i.y],t)&&Yc(e,[r,a.y],t);){if(Xc(e,t,i.y,a.y,r))return r;r+=n}return-1}function Zc(e,t){return e.map((function(e){return{a:{x:e.a.x+t.x,y:e.a.y+t.y},b:{x:e.b.x+t.x,y:e.b.y+t.y}}}))}n._RF.pop(),n._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);var eh,th=i.ccclass,nh=i.property,ih=i.requireComponent,ah=globalThis.game.monitorError,rh=(Dc=th("Board"),Mc=ih(s),Nc=nh(Qu),Fc=nh({displayName:"Tile Spacing",group:"Create config"}),Dc(Bc=Mc((zc=$e((Gc=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"tilePrefab",zc,Ne(e)),Xe(e,"tileTrim",Uc,Ne(e)),e.tileSize=[0,0],e.selectedTile=null,e.layoutType="portrait",e.parsedGravityRules=[],e.normalMatches=0,e.normalMatchesSinceLastSpawn=0,e.spawnAttempts=0,e.hintPath=null,e.hintTiles=null,e.animationQueue=[],e.isConsumingAnimation=!1,e.onLayoutChanged=function(t){e.layoutType=t},e}return Pe(a,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),St.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenLayoutevents()}},{key:"onDestroy",value:function(){this.unlistenLayoutevents()}},{key:"create",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now(),a=Ve(e);GameCore.Utils.Array.shuffle(a),e=a.slice(0,t.colors),this.levelData=t,this.parsedGravityRules=nc(t.mode);var r=function(e){var t=l(n.tilePrefab.node),i=t.getComponent(Qu);return i.setIdentity(e),n.node.addChild(t),t.active=!0,i},o=!1;if(void 0!==t.customFen)try{o=!0,this.grid=yc({customFen:t.customFen,identities:e,createTile:r}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)}))}catch(e){console.error("Error creating grid from custom fen",e,"falling back to random grid"),o=!1}o||(this.grid=vc({levelData:t,seed:i,identities:e,createTile:r}),this.grid.forEach((function(e,t,n){e.setCoord(t,n),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)})),gc(this.grid,i),fc(this.grid,t,i)),"landscape"===this.layoutType&&0!==t.level&&(this.grid=mc(this.grid));var s=[this.tileTrim.x,this.tileTrim.y];this.tileSize=tc(this.tilePrefab.getSize(),s);var u=[this.grid.width,this.grid.height],c=[this.uiTransform.width,this.uiTransform.height],h=Zu(u,this.tilePrefab.getSize(),c);this.node.setScale(h,h),this.node.scene.emit(tr.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}},{key:"destroyTiles",value:function(){var e;null===(e=this.grid)||void 0===e||e.forEach((function(e){return e.node.destroy()}))}},{key:"animateTilesAppear",value:function(){var e=this,t=function(t,n){var i=$.ZERO.clone();return e.parsedGravityRules.forEach((function(a){var r=e.getPrimitiveDirection(t,n,a);i.subtract2f(r.x,r.y)})),i.normalize()};return new Promise((function(n){var i=function(){var i=Ae(Se().mark((function i(){return Se().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all(e.grid.map((function(n,i,a){var r=ne(0,.5),o=n.node.scale.clone(),s=t(i,a),l=ec(e.grid,e.tileSize,{x:i,y:a}),u=s.multiplyScalar(100).add2f(l.x,l.y);return n.node.setPosition(u.x,u.y),n.node.setScale(0,0),Promise.all([yn.runTweenAsync(S(n.node).delay(r).to(.5,{scale:o},{easing:"elasticOut"})),n.sync({getTargetPosition:function(t){return ec(e.grid,e.tileSize,t)},easing:"backOut",duration:.5,delay:r})])})));case 2:n();case 3:case"end":return i.stop()}}),i)})));return function(){return i.apply(this,arguments)}}();e.animationQueue.push(i),e.consumeAnimationQueue()}))}},{key:"handleTileClick",value:function(e){if(!e.isHidden()){if(this.selectedTile===e)return this.selectedTile=null,void e.setFocused(!1);if(!this.selectedTile)return this.selectedTile=e,void e.setFocused(!0);if(!this.selectedTile.isSimilarTo(e))return this.selectedTile.setFocused(!1),this.selectedTile=e,void e.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,e),this.selectedTile=null}}},{key:"clearSelectedTile",value:function(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}},{key:"match",value:function(e,t){var n=[e.getCoord().x,e.getCoord().y],i=[t.getCoord().x,t.getCoord().y],a=Vc(this.grid,n,i);if(null===a){wi.playSound(ti.INVALID_MATCH),this.shakeGrid();var r=0===this.levelData.level,o=Pc(this.grid,n,i,r);return this.node.scene.emit(tr.GRID_MATCH,[e,t]),void this.node.scene.emit(tr.GRID_MATCH_FAIL,o)}this.node.scene.emit(tr.GRID_MATCH,[e,t]),this.node.scene.emit(tr.GRID_MATCH_SUCCESS,a,[e,t]),this.clear([[e,t]],"clear")}},{key:"clear",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"clear";this.normalMatches+=e.length,e.forEach((function(e){var i=qe(e,2),a=i[0],r=i[1];a.setEmpty(),r.setEmpty(),a.playClearFX(n),r.playClearFX(n),t.node.scene.emit(tr.GRID_CLEAR,[a,r])})),this.processGameplayCycle()}},{key:"showHint",value:function(){if(this.hintPath){var e=this.hintPath[0].a,t=this.hintPath[this.hintPath.length-1].b,n=this.getTileAt(e.x,e.y),i=this.getTileAt(t.x,t.y);n.setHint(!0),i.setHint(!0),this.hintTiles=[n,i]}}},{key:"hideHint",value:function(){if(this.hintTiles){var e=qe(this.hintTiles,2),t=e[0],n=e[1];t.setHint(!1),n.setHint(!1),this.hintTiles=null}}},{key:"getHintPath",value:function(){return this.hintPath}},{key:"getTileAt",value:function(e,t){return this.grid.isInBounds(e,t)?this.grid.get(e,t):null}},{key:"getAnyTileWorldPosition",value:function(e,t){var n=ec(this.grid,this.tileSize,{x:e,y:t});this.tilePrefab.node.setPosition(n.x,n.y);var i=this.tilePrefab.node.getWorldPosition();return{x:i.x,y:i.y}}},{key:"getTileSize",value:function(){return this.tileSize}},{key:"getUncleared",value:function(){return ic(this.grid)}},{key:"getCleared",value:function(){return ac(this.grid)}},{key:"getBombTiles",value:function(){return ic((e=this.grid)instanceof Su?e.asArray():e).filter((function(e){var t;return(null===(t=e.special)||void 0===t?void 0:t.type)===Yu.bomb}));var e}},{key:"getPairs",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=[],i=t?ic(this.grid):ac(this.grid),a=function(){var e=qe(lc(i),2),t=e[0],a=e[1];n.push([t,a]),i=i.filter((function(e){return e!==t&&e!==a}))};n.length<e;)a();return n}},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.grid.forEach((function(t){return t.setIgnoreInput(e)}))}},{key:"processShuffleRequest",value:function(e){var t=this.processShuffleStep(this.grid,!0,e);this.grid=t[0],this.hintPath=t[1],this.consumeAnimationQueue()}},{key:"getCurrentFen",value:function(){return Ic(this.grid)}},{key:"generateFenFromCurrentLevel",value:function(e){return a.generateFen(null!=e?e:this.levelData)}},{key:"listenLayoutevents",value:function(){x.on(En,this.onLayoutChanged)}},{key:"unlistenLayoutevents",value:function(){x.off(En,this.onLayoutChanged)}},{key:"shakeGrid",value:(n=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.clone(),n=S(this.node).to(.05,{position:t.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:t.clone().subtract3f(ne(5,10),ne(5,10),0)}),i=S(this.node).repeat(2,n).to(.05,{position:t}),e.next=5,yn.runTweenAsync(i);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"processGameplayCycle",value:function(){var e=ic(this.grid);if(0!==e.length){var t=this.grid,n=e.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,i=this.normalMatchesSinceLastSpawn>=2;n&&(i?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),e.length>14&&(t=this.processGravitationStep(t));var a=this.processShuffleStep(t);this.consumeAnimationQueue(),this.grid=a[0],this.hintPath=a[1]}}},{key:"processSpawnStep",value:function(){var e=qe(pc(ac(this.grid),2),2),t=e[0],n=e[1];t.restore(),n.restore(t.id)}},{key:"processGravitationStep",value:function(e){var t,n=this,i=e,a=[],r=je(this.parsedGravityRules);try{var o=function(){var e=t.value,r=_c(i=n.toGravitated(i,e));if(0===r.length)return 1;r.forEach((function(e){var t=qe(e,2),n=t[0],i=t[1],a=i[0],r=i[1];n.setCoord(a,r)})),i.forEach((function(e){e.node.setSiblingIndex(0)}));var o=function(){var e=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(r.map((function(e){var t=qe(e,2),a=t[0],r=qe(t[1],2),o=r[0],s=r[1];return a.sync({delay:.25,duration:.25,getTargetPosition:function(){return ec(i,n.tileSize,{x:o,y:s})}})})));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();a.push(o)};for(r.s();!(t=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}var s=function(){var e=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0,n=a;case 1:if(!(t<n.length)){e.next=8;break}return i=n[t],e.next=5,i();case 5:t++,e.next=1;break;case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return this.animationQueue.push(s),i}},{key:"toGravitated",value:function(e,t){var n=new Su(e),i=e.height-1,a=e.width-1,r=[0,i],o=[0,a],s=Math.floor(e.height/2),l=Math.floor(e.width/2),u=function(e){return e.isHidden()};switch(t){case vu:n.gravitate({rowRange:r,colRange:o,direction:fu.Down,isLighter:u});break;case yu:n.gravitate({rowRange:r,colRange:o,direction:fu.Up,isLighter:u});break;case mu:n.gravitate({rowRange:r,colRange:o,direction:fu.Left,isLighter:u});break;case gu:n.gravitate({rowRange:r,colRange:o,direction:fu.Right,isLighter:u});break;case bu:n.gravitate({rowRange:r,colRange:[l,a],direction:fu.Left,isLighter:u,out:n.gravitate({rowRange:r,colRange:[0,l-1],direction:fu.Right,isLighter:u})});break;case wu:n.gravitate({rowRange:[s,i],colRange:o,direction:fu.Down,isLighter:u,out:n.gravitate({rowRange:[0,s-1],colRange:o,direction:fu.Up,isLighter:u})})}return n}},{key:"getPrimitiveDirection",value:function(e,t,n){var i=Math.floor(this.grid.height/2),a=Math.floor(this.grid.width/2);switch(n){case vu:return fu.Down;case yu:return fu.Up;case mu:return fu.Left;case gu:return fu.Right;case bu:return e>=a?fu.Left:fu.Right;case wu:return t>=i?fu.Up:fu.Down}}},{key:"processShuffleStep",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,a=Vc(e),r=ic(e).map((function(e){var t=e.getCoord();return[t.x,t.y]}));if(null!==a&&!n)return[e,a];var o=100;do{var s=e.toShuffled(r),l=qe(s,1);a=Vc(t=l[0]),o--}while(null===a&&o>0);if(o<=0)return null==ah||ah.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",levelData:this.levelData,gridAsArray:t.asArray()}),this.node.scene.emit(tr.GAME_EXIT),[e,a];var u=_c(t);if(0===u.length)return[t,a];u.forEach((function(e){var t=qe(e,2),n=t[0],i=qe(t[1],2),a=i[0],r=i[1];n.setCoord(a,r)}));var c=void 0!==i?function(){return i(e,t)}:this.createShuffleAnimationHandler(e,t);return this.animationQueue.push(c),[t,a]}},{key:"createShuffleAnimationHandler",value:function(e,t){var n=this,i=function(){var i=Ae(Se().mark((function i(){return Se().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,Promise.all(e.map((function(e,i,a){return e.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return ec(t,n.tileSize,{x:i,y:a},10)}})})));case 2:case"end":return i.stop()}}),i)})));return function(){return i.apply(this,arguments)}}(),a=function(){var e=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.forEach((function(e){e.node.setSiblingIndex(0)})),e.next=3,Promise.all(t.map((function(e){return e.sync({duration:.6,easing:"smooth",delay:ne(0,.4),getTargetPosition:function(e){return ec(t,n.tileSize,e)}})})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return function(){var e=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i();case 2:return e.next=4,a();case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}},{key:"consumeAnimationQueue",value:(t=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isConsumingAnimation){e.next=2;break}return e.abrupt("return");case 2:this.isConsumingAnimation=!0;case 3:if(!(this.animationQueue.length>0)){e.next=12;break}if(0!==this.getUncleared().length){e.next=7;break}return this.animationQueue=[],e.abrupt("break",12);case 7:return t=this.animationQueue.shift(),e.next=10,t();case 10:e.next=3;break;case 12:this.isConsumingAnimation=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}],[{key:"generateFen",value:function(e){var t=e,n=Array.from({length:e.colors},(function(e,t){return t+1})),i=Date.now(),a=vc({levelData:t,seed:i,identities:n,createTile:function(e){var t=e,n=void 0,i=new $(0,0);return{get id(){return t},get special(){return n},get coord(){return i},setIdentity:function(e){t=e},isHidden:function(){return!1},setSpecialType:function(e){n={type:e}},setCoord:function(e,t){return i.set(e,t)},getCoord:function(){return i},isSimilarTo:function(e){return e.id===t},inSamePositionAs:function(e){return e.getCoord().equals(i)}}}});return a.forEach((function(e,t,n){e.setCoord(t,n)})),gc(a,i),fc(a,t,i),Ic(a)}}]),a}(f)).prototype,"tilePrefab",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uc=$e(Gc.prototype,"tileTrim",[Fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $(.025,.1)}}),Bc=Gc))||Bc)||Bc);n._RF.pop(),n._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);var oh=(0,i.ccclass)("Line")(eh=function(e){Ie(n,e);var t=Be(n);function n(){return Te(this,n),t.apply(this,arguments)}return Pe(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s)}},{key:"setPoints",value:function(e,t){this.node.setWorldPosition((e.x+t.x)/2,(e.y+t.y)/2,0),this.uiTransform.width=$.distance(e,t)+10,this.uiTransform.width/=this.node.worldScale.x;var n=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI;this.node.eulerAngles=new j(0,0,n)}}]),n}(f))||eh;n._RF.pop(),n._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);var sh,lh,uh,ch,hh,ph,dh,fh,vh,yh,mh,gh=function(e){Ie(n,e);var t=Be(n);function n(e,i,a,r,o){var s;return Te(this,n),(s=t.call(this,e,i,o)).ator=a,s.ftor=r,s}return Pe(n,[{key:"alloc",value:function(){var e=ze(_e(n.prototype),"alloc",this).call(this);return this.ator&&this.ator(e),e}},{key:"free",value:function(e){this.ftor&&this.ftor(e),ze(_e(n.prototype),"free",this).call(this,e)}}]),n}(ie);n._RF.pop(),n._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);var bh,wh,kh,Sh,Ch,Eh,Ah,Th,xh,Ph=i.ccclass,Rh=i.property,Ih=(sh=Ph("PathDrawer"),lh=Rh({group:"Line",displayName:"Prefab",type:R}),uh=Rh({group:"Line",displayName:"Holder",type:a,tooltip:"Line Prefab"}),ch=Rh({group:"Point",displayName:"Prefab",type:R}),hh=Rh({group:"Point",displayName:"Holder",type:a}),sh((fh=$e((dh=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"linePrefab",fh,Ne(e)),Xe(e,"lineHolder",vh,Ne(e)),e.lineNodes=[],Xe(e,"pointPrefab",yh,Ne(e)),Xe(e,"pointHolder",mh,Ne(e)),e.pointNodes=[],e}return Pe(n,[{key:"start",value:function(){var e=this;this.linePool=new gh((function(){var t=l(e.linePrefab);return e.lineHolder.addChild(t),t.parent=e.lineHolder,t.active=!1,t}),0,(function(t){e.lineNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()})),this.pointPool=new gh((function(){var t=l(e.pointPrefab);return e.pointHolder.addChild(t),t.active=!1,t}),0,(function(t){e.pointNodes.push(t),t.active=!0}),(function(e){e.active=!1}),(function(e){e.isValid&&e.destroy()}))}},{key:"drawPath",value:function(e){this.clearPath();var t,n=je(e);try{for(n.s();!(t=n.n()).done;){var i,a=t.value;null===(i=this.linePool.alloc().getComponent(oh))||void 0===i||i.setPoints(a.a,a.b)}}catch(e){n.e(e)}finally{n.f()}}},{key:"clearPath",value:function(){var e,t=je(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.linePool.free(n)}}catch(e){t.e(e)}finally{t.f()}this.lineNodes=[];var i,a=je(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var r=i.value;this.pointPool.free(r)}}catch(e){a.e(e)}finally{a.f()}this.pointNodes=[]}}]),n}(f)).prototype,"linePrefab",[lh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vh=$e(dh.prototype,"lineHolder",[uh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yh=$e(dh.prototype,"pointPrefab",[ch],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mh=$e(dh.prototype,"pointHolder",[hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ph=dh))||ph);n._RF.pop(),n._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);var _h,Lh=i.ccclass,Oh=i.property,Dh=(bh=Lh("ErrorDrawer"),wh=Oh(O),kh=Oh(O),Sh=Oh(O),bh((Ah=$e((Eh=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"one",Ah,Ne(e)),Xe(e,"two",Th,Ne(e)),Xe(e,"error",xh,Ne(e)),e}return Pe(n,[{key:"start",value:function(){ze(_e(n.prototype),"start",this).call(this),this.pathAppearDuration=0}},{key:"drawPath",value:function(e){var t=this;if(this.clearPath(),e.forEach((function(n,i){var a;if(null===(a=t.linePool.alloc().getComponent(oh))||void 0===a||a.setPoints(n.a,n.b),0!==i){var r=t.pointPool.alloc();r.setWorldPosition(new j(n.a.x,n.a.y,0));var o=r.getComponent(T);1===i&&e.length>3?o.spriteFrame=t.one:2===i&&e.length>3?o.spriteFrame=t.two:o.spriteFrame=t.error}})),1===e.length){var n=this.pointPool.alloc();n.setWorldPosition(new j(e[0].a.x+e[0].b.x,e[0].a.y+e[0].b.y,0).multiplyScalar(.5)),n.getComponent(T).spriteFrame=this.error}this.pathAppearDuration=.8}},{key:"update",value:function(e){this.pathAppearDuration>0&&(this.pathAppearDuration-=e,this.pathAppearDuration<=0&&this.clearPath())}}]),n}(Ih)).prototype,"one",[wh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Th=$e(Eh.prototype,"two",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xh=$e(Eh.prototype,"error",[Sh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch=Eh))||Ch);n._RF.pop(),n._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);var Mh,Nh=(0,i.ccclass)("HintDrawer")(_h=function(e){Ie(n,e);var t=Be(n);function n(){return Te(this,n),t.apply(this,arguments)}return Pe(n,[{key:"drawPath",value:function(e){this.clearPath(),this.createPath(e),this.showPath()}},{key:"createPath",value:function(e){var t=this;e.forEach((function(e){var n;null===(n=t.linePool.alloc().getComponent(oh))||void 0===n||n.setPoints(e.a,e.b),t.pointPool.alloc().setWorldPosition(e.a.x,e.a.y,0)})),this.pointPool.alloc().setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0)}},{key:"showPath",value:function(){var e,t=je(this.lineNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value.getComponent(M);n.opacity=0,S(n).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){t.e(e)}finally{t.f()}var i,a=je(this.pointNodes);try{for(a.s();!(i=a.n()).done;){var r=i.value.getComponent(M);r.opacity=0,S(r).to(.2,{opacity:255},{easing:"quadOut"}).start()}}catch(e){a.e(e)}finally{a.f()}}},{key:"clearPath",value:function(){var e,t=this,n=je(this.lineNodes);try{var i=function(){var n=e.value,i=n.getComponent(M);S(i).to(.15,{opacity:0},{onComplete:function(){i.opacity=255,t.linePool.free(n)}}).start()};for(n.s();!(e=n.n()).done;)i()}catch(e){n.e(e)}finally{n.f()}var a,r=je(this.pointNodes);try{var o=function(){var e=a.value,n=e.getComponent(M);S(n).to(.15,{opacity:0},{onComplete:function(){n.opacity=255,t.pointPool.free(e)}}).start()};for(r.s();!(a=r.n()).done;)o()}catch(e){r.e(e)}finally{r.f()}this.lineNodes=[],this.pointNodes=[]}}]),n}(Ih))||_h;n._RF.pop(),n._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);var Fh,Bh,Gh,zh,Uh,Hh,qh,Vh,Wh,Kh=(0,i.ccclass)("MatchDrawer")(Mh=function(e){Ie(a,e);var t,n,i=Be(a);function a(){return Te(this,a),i.apply(this,arguments)}return Pe(a,[{key:"drawPath",value:function(e){var t=this;e.forEach((function(e,n){var i,a=t.linePool.alloc();null===(i=a.getComponent(oh))||void 0===i||i.setPoints(e.a,e.b),t.animateLine(a);var r=t.pointPool.alloc();r.setWorldPosition(e.a.x,e.a.y,0),t.animatePoint(r,n)}));var n=this.pointPool.alloc();n.setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0),this.animatePoint(n,e.length)}},{key:"animateLine",value:(n=Ae(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.getComponent(M)).opacity=0,i=S(n).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0}),e.next=5,yn.runTweenAsync(i);case 5:n.opacity=255,this.linePool.free(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"animatePoint",value:(t=Ae(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.scale=j.ZERO,i=S(t).delay(.03*n).to(.2,{scale:j.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:j.ZERO},{easing:"backIn"}),e.next=4,yn.runTweenAsync(i);case 4:this.pointPool.free(t);case 5:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"clearPath",value:function(){this.lineNodes=[],this.pointNodes=[]}}]),a}(Ih))||Mh;n._RF.pop(),n._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);var jh,Yh=i.ccclass,Xh=i.property,$h=(Fh=Yh("PathDraw"),Bh=Xh({group:{name:"Path Drawer"},type:Kh}),Gh=Xh({group:{name:"Path Drawer"},type:Nh}),zh=Xh({group:{name:"Path Drawer"},type:Dh}),Fh((qh=$e((Hh=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"matchPath",qh,Ne(e)),Xe(e,"hintPath",Vh,Ne(e)),Xe(e,"errorPath",Wh,Ne(e)),e.isDrawingHint=!1,e}return Pe(n,[{key:"drawMatchPath",value:function(e,t){var n,i=je(e=e.map((function(e){return ke({},e)})));try{for(i.s();!(n=i.n()).done;){var a=n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.matchPath.drawPath(e)}},{key:"clearMatchPath",value:function(){this.matchPath.clearPath()}},{key:"drawHintPath",value:function(e,t){if(!this.isDrawingHint){this.isDrawingHint=!0;var n,i=je(e=e.map((function(e){return ke({},e)})));try{for(i.s();!(n=i.n()).done;){var a=n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.hintPath.drawPath(e)}}},{key:"clearHintPath",value:function(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}},{key:"drawErrorPath",value:function(e,t){var n,i=je(e=e.map((function(e){return ke({},e)})));try{for(i.s();!(n=i.n()).done;){var a=n.value;a.a=t(a.a),a.b=t(a.b)}}catch(e){i.e(e)}finally{i.f()}this.errorPath.drawPath(e)}}]),n}(f)).prototype,"matchPath",[Bh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vh=$e(Hh.prototype,"hintPath",[Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wh=$e(Hh.prototype,"errorPath",[zh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uh=Hh))||Uh);n._RF.pop(),n._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);var Jh,Qh,Zh,ep,tp,np,ip,ap,rp,op,sp,lp,up,cp,hp,pp,dp,fp=(0,i.ccclass)("ComboManager")(jh=function(e){Ie(n,e);var t=Be(n);function n(){return Te(this,n),t.apply(this,arguments)}return Pe(n,[{key:"init",value:function(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(tr.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(tr.GAME_FINISH,this.resetCombo,this),this.node.scene.on(tr.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(tr.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(tr.ADD_COMBO,this.addCombo,this)}},{key:"addCombo",value:function(){this.setCombo(this.currentCombo+1)}},{key:"resetCombo",value:function(){this.setCombo(0)}},{key:"getCombo",value:function(){return this.currentCombo}},{key:"setCombo",value:function(e){if(this.currentCombo=e,e>0&&e<5){var t=[ti.COMBO_1,ti.COMBO_2,ti.COMBO_3,ti.COMBO_4,ti.COMBO_5];wi.playSound(t[e])}else e>=5&&wi.playSound(ti.COMBO_5);e>0&&this.vibrate(e),this.emitEvent&&this.node.scene.emit(tr.COMBO_UPDATED,e)}},{key:"vibrate",value:function(e){var t;null===(t=P("Vibrate"))||void 0===t||null===(t=t.getComponent(Ss))||void 0===t||t.vibrate(Math.min(20+20*e,220))}},{key:"setEmitEvent",value:function(e){this.emitEvent=e}}]),n}(f))||jh;n._RF.pop(),n._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);var vp,yp,mp,gp,bp,wp=i.ccclass,kp=i.property,Sp=i.disallowMultiple,Cp=(Jh=wp("ShiningStar"),Qh=kp(T),Zh=kp({serializable:!0,visible:!1}),ep=kp({type:C,displayName:"Scale up duration",min:.001}),tp=kp({serializable:!0,visible:!1}),np=kp({type:C,displayName:"Bounce and Fall duration",min:.001}),ip=kp({serializable:!0,visible:!1}),ap=kp({type:C,displayName:"Start scale"}),rp=kp({serializable:!0,visible:!1}),op=kp({type:C,displayName:"End scale"}),Jh(sp=Sp((up=$e((lp=function(e){Ie(u,e);var t,n,i,a,r,o,s,l=Be(u);function u(){var e;Te(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=l.call.apply(l,[this].concat(n)),"shine",up,Ne(e)),Xe(e,"twScaleUpDuration",cp,Ne(e)),Xe(e,"twBounceAndFallDuration",hp,Ne(e)),Xe(e,"twStartScale",pp,Ne(e)),Xe(e,"twEndScale",dp,Ne(e)),e.isBeingAnimated=!1,e}return Pe(u,[{key:"scaleUpDuration",get:function(){return this.twScaleUpDuration},set:function(e){this.twScaleUpDuration=e}},{key:"bounceAndFallDuration",get:function(){return this.twBounceAndFallDuration},set:function(e){this.twBounceAndFallDuration=e}},{key:"startScale",get:function(){return this.twStartScale},set:function(e){this.twStartScale=e}},{key:"endScale",get:function(){return this.twEndScale},set:function(e){this.twEndScale=e}},{key:"isAvailable",get:function(){return!this.isBeingAnimated}},{key:"__preload",value:function(){this.shineOpacity=this.shine.node.getComponent(M),this.uiOpacity=this.node.getComponent(M),this.validateRequiredComponents()}},{key:"onLoad",value:function(){this.uiOpacity.opacity=0}},{key:"playAnimation",value:(s=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isAvailable){e.next=2;break}throw new Error("ShiningStar: This star is being animated.");case 2:return this.isBeingAnimated=!0,e.next=5,this.animateAppear();case 5:return e.next=7,this.animateDisappear();case 7:this.isBeingAnimated=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"animateAppear",value:(o=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.shineOpacity.opacity=255,e.next=3,Promise.all([this.animateFadeIn(),this.animateScaleUp()]);case 3:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"animateDisappear",value:(r=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.animateBounceAndFall(),this.animateScaleDown()]);case 2:this.node.setScale(0,0),this.uiOpacity.opacity=0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"animateBounceAndFall",value:(a=Ae(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.x,n=this.node.position.y,i=[60,120],a=(Math.random()*(i[1]-i[0])+i[0])*(Math.PI/180),r=t+200*Math.cos(a),o=n+200*Math.sin(a),s=n-500,l=yn.runTweenAsync(S(this.node).to(.2*this.twBounceAndFallDuration,{position:new j(r,o,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new j(r,s,this.node.position.z)},{easing:"cubicIn"})),u=[0,360],c=yn.runTweenAsync(S(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new j(0,0,Math.random()*(u[1]-u[0])*(r>t?-1:1))},{easing:"sineOut"})),e.next=13,Promise.all([l,c]);case 13:this.node.eulerAngles=new j(0,0,0);case 14:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"animateFadeIn",value:(i=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Math.max(this.scaleUpDuration/4,.01),e.next=3,yn.runTweenAsync(S(this.uiOpacity).to(t,{opacity:255}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"animateScaleUp",value:(n=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.setScale(this.startScale,this.startScale),t=new j(this.endScale,this.endScale,1),e.next=4,yn.runTweenAsync(S(this.node).to(this.scaleUpDuration,{scale:t},{easing:"cubicOut"}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"animateScaleDown",value:(t=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new j(0,0,1),e.next=3,yn.runTweenAsync(S(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:t},{easing:"cubicIn"}));case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),u}(f)).prototype,"shine",[Qh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cp=$e(lp.prototype,"twScaleUpDuration",[Zh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),$e(lp.prototype,"scaleUpDuration",[ep],Object.getOwnPropertyDescriptor(lp.prototype,"scaleUpDuration"),lp.prototype),hp=$e(lp.prototype,"twBounceAndFallDuration",[tp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),$e(lp.prototype,"bounceAndFallDuration",[np],Object.getOwnPropertyDescriptor(lp.prototype,"bounceAndFallDuration"),lp.prototype),pp=$e(lp.prototype,"twStartScale",[ip],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),$e(lp.prototype,"startScale",[ap],Object.getOwnPropertyDescriptor(lp.prototype,"startScale"),lp.prototype),dp=$e(lp.prototype,"twEndScale",[rp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$e(lp.prototype,"endScale",[op],Object.getOwnPropertyDescriptor(lp.prototype,"endScale"),lp.prototype),sp=lp))||sp)||sp);n._RF.pop(),n._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);var Ep,Ap,Tp,xp,Pp,Rp,Ip,_p,Lp,Op,Dp,Mp,Np,Fp,Bp,Gp,zp,Up,Hp,qp,Vp,Wp=i.ccclass,Kp=i.property,jp=i.disallowMultiple,Yp=(vp=Wp("StarParticles"),yp=Kp({type:[Cp],displayName:"Prebuilt Shining stars"}),vp(mp=jp((bp=$e((gp=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"shiningStars",bp,Ne(e)),e}return Pe(i,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"fireShiningStarAt",value:(t=Ae(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(n=this.getFirstAvailableShiningStar())){e.next=3;break}throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");case 3:return i=qe(t,2),a=i[0],r=i[1],o=new j(a,r,this.node.worldPosition.z),n.node.worldPosition=o,e.next=8,n.playAnimation();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getFirstAvailableShiningStar",value:function(){return this.shiningStars.find((function(e){return e.isAvailable}))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),i}(f)).prototype,"shiningStars",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mp=gp))||mp)||mp);n._RF.pop(),n._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);var Xp=i.ccclass,$p=i.property,Jp=(Ep=Xp("EffectManager"),Ap=$p({group:"Thunder Effect",type:a}),Tp=$p({group:"Thunder Effect",type:a}),xp=$p({group:"Mask Effect",type:ga}),Pp=$p({group:"Mask Effect",type:a}),Rp=$p({group:"Tornado Effect",type:a}),Ip=$p({group:"Clear Particle Effect",type:a,displayName:"Particle holder node"}),_p=$p({group:"Clear Particle Effect",type:ae,displayName:"Emitter 1"}),Lp=$p({group:"Clear Particle Effect",type:ae,displayName:"Emitter 2"}),Op=$p({group:"Star Particles Effect",type:Yp}),Ep((Np=$e((Mp=function(e){Ie(f,e);var t,n,i,a,r,o,l,u,c,h,p,d=Be(f);function f(){var e;Te(this,f);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=d.call.apply(d,[this].concat(n)),"cloud",Np,Ne(e)),Xe(e,"lightnings",Fp,Ne(e)),Xe(e,"backgroundMask",Bp,Ne(e)),Xe(e,"masks",Gp,Ne(e)),Xe(e,"tornado",zp,Ne(e)),e.bombExplosion=null,e.bombExplosionPool=null,e.defuseExplosion=null,e.defuseExplosionPool=null,Xe(e,"clearParticleHolder",Up,Ne(e)),Xe(e,"clearParticle1",Hp,Ne(e)),Xe(e,"clearParticle2",qp,Ne(e)),Xe(e,"starParticle",Vp,Ne(e)),e.maskTargets=[],e.handleBoardCreate=function(t){e.clearParticleHolder.scale=t.node.scale},e}return Pe(f,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"update",value:function(){var e=this;this.maskTargets.length>0&&this.maskTargets.forEach((function(t,n){t.isHidden()||(e.masks[n].worldPosition=t.node.worldPosition.clone())}))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(tr.GRID_CREATE,this.handleBoardCreate,this)}},{key:"playClearFXAt",value:function(e){this.clearParticle1.node.setWorldPosition(new j(e[0].x,e[0].y,1)),this.clearParticle2.node.setWorldPosition(new j(e[1].x,e[1].y,1)),this.clearParticle1.resetSystem(),this.clearParticle2.resetSystem()}},{key:"playStarFXAt",value:function(e){this.starParticle.fireShiningStarAt(e)}},{key:"playTornadoAnimation",value:(p=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this.tornado.getChildByName("Sprite").getComponent(y).defaultClip){e.next=4;break}return console.warn("EffectManager: Tornado animation is not loaded when animation play request was made."),e.abrupt("return");case 4:return this.tornado.active=!0,(t=S(this.tornado)).set({scale:new j(0,0,0)}),t.delay(.5),t.to(.5,{scale:new j(1,1,1)},{easing:"quadOut"}),t.to(.5,{scale:new j(0,0,0)},{easing:"quadIn"}),t.set({active:!1}),Jn.setBlockInput(!0),e.next=14,yn.runTweenAsync(t);case 14:Jn.setBlockInput(!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"shakeGame",value:(h=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.clone(),n=S(this.node).to(.05,{position:t.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:t.clone().subtract3f(ne(5,10),ne(5,10),0)}).to(.05,{position:t}),e.next=4,yn.runTweenAsync(n);case 4:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"playThunderAnimation",value:(c=Ae(Se().mark((function e(t,n){var i,a,r,o,l,u,c,h,p,d,f,v,y;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.cloud.active=!0,r=P("Canvas").getComponent(s),o=r.width,l=r.height,u=Math.floor(4*Math.random()),c=0,h=0,e.t0=u,e.next=0===e.t0?9:1===e.t0?12:2===e.t0?15:3===e.t0?18:21;break;case 9:return c=Math.random()*o-o/2,h=l/2+300,e.abrupt("break",21);case 12:return c=Math.random()*o-o/2,h=-l/2-300,e.abrupt("break",21);case 15:return c=-o/2-300,h=Math.random()*l-l/2,e.abrupt("break",21);case 18:return c=o/2+300,h=Math.random()*l-l/2,e.abrupt("break",21);case 21:return this.cloud.position=new j(c,h),this.resetMasks(),this.setMaskProperties(0,t[0][0].node.worldPosition,t[0][0].node.worldScale),this.setMaskProperties(1,t[0][1].node.worldPosition,t[0][1].node.worldScale),this.setMaskProperties(2,t[1][0].node.worldPosition,t[1][0].node.worldScale),this.setMaskProperties(3,t[1][1].node.worldPosition,t[1][1].node.worldScale),this.maskTargets=[t[0][0],t[0][1],t[1][0],t[1][1]],e.next=30,this.setBackgroundMaskActive(!0);case 30:return p=S(this.cloud).to(.8,{position:new j(0,300)},{easing:"quadOut"}),e.next=33,yn.runTweenAsync(p);case 33:return d=t[0][0].node.worldPosition.clone(),f=t[0][1].node.worldPosition.clone(),this.shakeGame(),null===(i=P("Vibrate"))||void 0===i||null===(i=i.getComponent(Ss))||void 0===i||i.vibrate(500),wi.playSound(ti.THUNDERBOLT),n.clear([t[0]],"break"),e.next=41,Promise.all([this.playLightningAnimation(d,0),this.playLightningAnimation(f,1)]);case 41:return this.node.scene.emit(tr.ADD_COMBO),this.node.scene.emit(tr.ADD_SCORE),v=t[1][1].node.worldPosition.clone(),y=t[1][0].node.worldPosition.clone(),this.shakeGame(),null===(a=P("Vibrate"))||void 0===a||null===(a=a.getComponent(Ss))||void 0===a||a.vibrate(500),wi.playSound(ti.THUNDERBOLT),n.clear([t[1]],"break"),e.next=51,Promise.all([this.playLightningAnimation(y,0),this.playLightningAnimation(v,1)]);case 51:return this.node.scene.emit(tr.ADD_COMBO),this.node.scene.emit(tr.ADD_SCORE),this.cloud.active=!1,e.next=56,this.setBackgroundMaskActive(!1);case 56:this.maskTargets=[];case 57:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"playLightningAnimation",value:(u=Ae(Se().mark((function e(t,n){var i,a,r,o,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.lightnings[n],a=t.subtract(i.worldPosition),r=Math.atan2(a.y,a.x)*(180/Math.PI)+180,o=a.length(),i.getComponent(s).width=o,i.angle=r,e.abrupt("return",new Promise((function(e){i.active=!0,l.scheduleOnce((function(){i.active=!1,e()}),.2)})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"setBackgroundMaskActive",value:(l=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t&&(this.backgroundMask.node.active=!0),e.next=3,this.backgroundMask.changeStateFade(t,.25);case 3:t||(this.backgroundMask.node.active=!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return l.apply(this,arguments)})},{key:"resetMasks",value:function(){this.masks.forEach((function(e){e.worldPosition=new j(-9999,-9999,0)}))}},{key:"setMaskProperties",value:function(e,t,n){n&&(this.masks[e].worldScale=n),this.masks[e].worldPosition=t}},{key:"createDefuseExplosionAt",value:(o=Ae(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadDefuseExplosionPrefab();case 2:return this.defuseExplosionPool||(this.defuseExplosionPool=new gh(this.createDefuseExplosion.bind(this),1,Qp.getBombDefuseExplosion,Qp.returnBombDefuseExplosion,Qp.destroyBombDefuseExplosion)),(n=this.defuseExplosionPool.alloc()).setWorldPosition(t),i=n.getComponent(y),e.next=8,yn.runAnimationAsync(i);case 8:if(this.defuseExplosionPool){e.next=10;break}throw new Error("EffectManager: defuseExplosionPool is null");case 10:this.defuseExplosionPool.free(n);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"createBombExplosionAt",value:(r=Ae(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadBombExplosionPrefab();case 2:return this.bombExplosionPool||(this.bombExplosionPool=new gh(this.createBombExplosion.bind(this),1,Zp.getBombExplosion,Zp.returnBombExplosion,Zp.destroyBombExplosion)),(n=this.bombExplosionPool.alloc()).setWorldPosition(t),i=n.getComponent(y),e.next=8,yn.runAnimationAsync(i);case 8:if(this.bombExplosionPool){e.next=10;break}throw new Error("EffectManager: bombExplosionPool is null");case 10:this.bombExplosionPool.free(n);case 11:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"createDefuseExplosion",value:function(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return Qp.createDefuseExplosion(this.defuseExplosion,this.node)}},{key:"createBombExplosion",value:function(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return Zp.createBombExplosion(this.bombExplosion,this.node)}},{key:"loadBombExplosionPrefab",value:(a=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.bombExplosion){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Jn.loadPrefabAsync(Un.BOMB_EXPLODE_PREFAB);case 4:return(t=e.sent)&&(this.bombExplosion=t),e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"loadDefuseExplosionPrefab",value:(i=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.defuseExplosion){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.next=4,Jn.loadPrefabAsync(Un.BOMB_DEFUSE_PREFAB);case 4:return(t=e.sent)&&(this.defuseExplosion=t),e.abrupt("return",Promise.resolve());case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"loadThunderAnimation",value:(n=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this.cloud.getChildByName("Top").getComponent(y)).defaultClip){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return e.next=5,Jn.loadAnimClipAsync(Un.CLOUD_IDLE_ANIM);case 5:return(n=e.sent)&&(t.defaultClip=n),e.abrupt("return",Promise.resolve());case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadTornadoAnimation",value:(t=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this.tornado.getChildByName("Sprite").getComponent(y)).defaultClip){e.next=3;break}return e.abrupt("return",Promise.resolve());case 3:return e.next=5,Jn.loadAnimClipAsync(Un.TORNADO_IDLE_ANIM);case 5:return(n=e.sent)&&(t.defaultClip=n),e.abrupt("return",Promise.resolve());case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),f}(f)).prototype,"cloud",[Ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fp=$e(Mp.prototype,"lightnings",[Tp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bp=$e(Mp.prototype,"backgroundMask",[xp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gp=$e(Mp.prototype,"masks",[Pp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zp=$e(Mp.prototype,"tornado",[Rp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Up=$e(Mp.prototype,"clearParticleHolder",[Ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hp=$e(Mp.prototype,"clearParticle1",[_p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qp=$e(Mp.prototype,"clearParticle2",[Lp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vp=$e(Mp.prototype,"starParticle",[Op],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dp=Mp))||Dp),Qp=function(){function e(){Te(this,e)}return Pe(e,null,[{key:"createDefuseExplosion",value:function(e,t){var n=l(e);return t.addChild(n),n.active=!1,n}},{key:"destroyBombDefuseExplosion",value:function(e){e.destroy()}},{key:"getBombDefuseExplosion",value:function(e){e.active=!0}},{key:"returnBombDefuseExplosion",value:function(e){e.active=!1}}]),e}(),Zp=function(){function e(){Te(this,e)}return Pe(e,null,[{key:"createBombExplosion",value:function(e,t){var n=l(e);return t.addChild(n),n.active=!1,n}},{key:"destroyBombExplosion",value:function(e){e.destroy()}},{key:"getBombExplosion",value:function(e){e.active=!0}},{key:"returnBombExplosion",value:function(e){e.active=!1}}]),e}();n._RF.pop(),n._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);var ed="newbie",td="timer",nd="combo",id="hint-item",ad="thunder-item",rd="storm-item",od="pliers-item";n._RF.pop(),n._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);var sd=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:function(){this.currentStep=0,this.manager.node.scene.on(tr.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(tr.GRID_MATCH_FAIL,this.showNextStep,this),this.showStep(this.currentStep),this.manager.node.scene.emit(tr.HIDE_UI),this.manager.guideSkipButton.active=!0}},{key:"showNextStep",value:function(){this.currentStep+1<bc.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}},{key:"showStep",value:(n=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.gameplay,i=n.board,a=n.effectManager,r=bc[t].startTile,o=bc[t].endTile,s=i.getTileAt(r.x,r.y),l=i.getTileAt(o.x,o.y),s&&l){e.next=7;break}return e.abrupt("return");case 7:return u=s.node.worldPosition,c=l.node.worldPosition,a.resetMasks(),a.setMaskProperties(0,u,s.node.worldScale),a.setMaskProperties(1,c,l.node.worldScale),a.setBackgroundMaskActive(!0),h=this.manager,p=h.guideHand,d=h.guideTextBox,p.node.active=!0,p.playHandAnimation(u,c),e.next=18,d.hide();case 18:return d.setText(bc[t].description),e.next=21,d.show();case 21:i.setIgnoreInput(!0),s.setIgnoreInput(!1),l.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"close",value:(t=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.gameplay,n=t.board,i=t.effectManager,this.manager.node.scene.off(tr.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(tr.GRID_MATCH_FAIL,this.showNextStep,this),n.setIgnoreInput(!1),e.t0=Promise,e.next=7,this.manager.guideTextBox.hide();case 7:return e.t1=e.sent,e.next=10,i.setBackgroundMaskActive(!1);case 10:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=14,e.t0.all.call(e.t0,e.t3);case 14:this.manager.guideHand.node.active=!1,this.manager.completeGuide(ed);case 16:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);var ld=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Ae(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.uiManager.clock,r=a.getComponent(s).contentSize,o=r.width,l=r.height,u=a.node.worldPosition,o*=1.5,l*=1.5,e.next=9,this.gameplay.handleShowUI();case 9:return n.node.active=!0,n.setOtherMaskTransform(u.x,u.y,o,l),i.node.active=!0,i.string="Remove all tiles before\nthe time end",i.node.setWorldPosition(u.x,u.y-l/2-50,0),i.horizontalAlign=re.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=18,n.show();case 18:this.manager.node.scene.once(tr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(tr.PAUSE_TIME);case 20:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideInfoText,i=t.guideMasks,this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(tr.RESUME_TIME),e.next=5,i.hide();case 5:n.node.active=!1,this.manager.completeGuide(td);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);var ud=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Ae(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.uiManager.comboContainer,r=a.getComponent(s).contentSize,o=r.width,l=r.height,u=a.worldPosition,o*=1.5,l*=1.5,n.node.active=!0,n.setOtherMaskTransform(u.x,u.y,o,l),i.node.active=!0,i.string="Remove tiles continuously\nto increase combo!",i.node.setWorldPosition(u.x-o/2-10,u.y,0),i.horizontalAlign=re.RIGHT,i.getComponent(s).setAnchorPoint(1,.5),e.next=16,n.show();case 16:this.manager.node.scene.once(tr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(tr.PAUSE_TIME);case 18:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideInfoText,i=t.guideMasks,this.manager.node.scene.emit(tr.RESUME_TIME),i.node.off(a.EventType.TOUCH_START,this.close,this),e.next=5,i.hide();case 5:n.node.active=!1,this.manager.completeGuide(nd);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);var cd=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Ae(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===Es.HINT}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to reveal a connectable pair",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=re.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(tr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(tr.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(tr.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(id);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);var hd=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Ae(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===Es.THUNDER}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to remove 2 pairs",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=re.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(tr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(tr.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(tr.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(ad);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);var pd=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Ae(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===Es.STORM}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to rearrange the tiles",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=re.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(tr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(tr.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(tr.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(rd);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);var dd,fd,vd,yd,md,gd,bd,wd,kd,Sd=function(){function e(t){Te(this,e),this.manager=t,this.gameplay=t.gameplay}var t,n;return Pe(e,[{key:"setup",value:(n=Ae(Se().mark((function e(){var t,n,i,a,r,o,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.manager,n=t.guideMasks,i=t.guideInfoText,a=this.gameplay.itemManager.items.find((function(e){return e.itemType===Es.PLIERS}))){e.next=4;break}return e.abrupt("return");case 4:return r=a.node.worldPosition,o=a.getComponent(s).contentSize,l=o.width,u=o.height,l+=40,u+=40,n.node.active=!0,n.setItemMaskTransform(r.x,r.y,l,u),i.node.active=!0,i.string="Tap to remove bomb",i.node.setPosition(0,0),i.node.setWorldPosition(i.node.worldPosition.x,r.y+u/2+30,0),i.horizontalAlign=re.CENTER,i.getComponent(s).setAnchorPoint(.5,.5),e.next=19,n.show();case 19:this.manager.node.scene.once(tr.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(tr.PAUSE_TIME);case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"close",value:(t=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.manager,n=t.guideMasks,i=t.guideInfoText,this.manager.node.scene.emit(tr.RESUME_TIME),e.next=4,n.hide();case 4:i.node.active=!1,this.manager.completeGuide(od);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);var Cd,Ed,Ad,Td,xd,Pd,Rd,Id=i.ccclass,_d=i.property,Ld=(dd=Id("GuideHand"),fd=_d(a),vd=_d(a),yd=_d(M),dd((bd=$e((gd=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"hand",bd,Ne(e)),Xe(e,"circleHighlight",wd,Ne(e)),Xe(e,"circleHighlightOpacity",kd,Ne(e)),e}return Pe(n,[{key:"start",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}},{key:"playHandAnimation",value:function(e,t){var n=this;this.handTween&&this.handTween.stop();var i=S(this.hand).to(.8,{worldPosition:t},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0}).to(.8,{worldPosition:e},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((function(){n.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0});this.handTween=S(this.hand).repeatForever(i).start()}},{key:"playHighlightAnimation",value:function(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),S(this.circleHighlight).to(.6,{scale:new j(1.5,1.5)},{easing:"quadOut"}).start(),S(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}]),n}(f)).prototype,"hand",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd=$e(gd.prototype,"circleHighlight",[vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kd=$e(gd.prototype,"circleHighlightOpacity",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),md=gd))||md);n._RF.pop(),n._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);var Od,Dd,Md,Nd,Fd,Bd,Gd=i.ccclass,zd=i.property,Ud=(Cd=Gd("GameMask"),Ed=zd(s),Ad=zd(T),Cd((Pd=$e((xd=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"uiTransform",Pd,Ne(e)),Xe(e,"sprite",Rd,Ne(e)),e}return Pe(n,[{key:"texture",get:function(){return this.sprite.spriteFrame.texture}}]),n}(f)).prototype,"uiTransform",[Ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd=$e(xd.prototype,"sprite",[Ad],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Td=xd))||Td);n._RF.pop(),n._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);var Hd,qd,Vd,Wd,Kd,jd,Yd,Xd=i.ccclass,$d=i.property,Jd=i.executeInEditMode,Qd=(Od=Xd("AlphaMasks"),Dd=Jd(!0),Md=$d(Ud),Od(Nd=Dd((Bd=$e((Fd=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"masks",Bd,Ne(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.UITransform=this.node.getComponent(s)}},{key:"start",value:function(){this.material=this.getComponent(T).getMaterialInstance(0)}},{key:"update",value:function(){var e=this,t=this.UITransform,n=t.width,i=t.height;this.masks.forEach((function(t,a){var r=t.uiTransform,o=r.width,s=r.height,l=r.anchorX,u=r.anchorY,c=o*t.node.scale.x,h=s*t.node.scale.y,p=new $(c/n,h/i),d=new $(.5+(.5-l)*p.x,.5-(.5-u)*p.y),f=new $(d.x+(t.node.worldPosition.x-e.node.worldPosition.x)/n,d.y-(t.node.worldPosition.y-e.node.worldPosition.y)/i);e.material.setProperty(`mask${a}Texture`,t.texture),e.material.setProperty(`ratio${a}`,p),e.material.setProperty(`center${a}`,f)}))}},{key:"setMaskActive",value:function(e,t){e>=this.masks.length||this.material.setProperty(`useMask${e}`,t?1:0)}}]),n}(f)).prototype,"masks",[Md],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nd=Fd))||Nd)||Nd);n._RF.pop(),n._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);var Zd,ef,tf,nf,af,rf=i.ccclass,of=i.property,sf=(Hd=rf("GuideMasks"),qd=of(ga),Vd=of(Qd),Hd((jd=$e((Kd=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"background",jd,Ne(e)),Xe(e,"alphaMasks",Yd,Ne(e)),e}return Pe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"show",value:(n=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.background.node.active=!0,e.next=3,this.background.changeStateFade(!0,.25);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.background.changeStateFade(!1,.25);case 2:this.background.node.active=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"onClick",value:function(){this.node.scene.emit(tr.GUIDE_MASK_CLICKED)}},{key:"setOtherMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[1].node.worldPosition=new j(-9999,-9999,0);var a=this.alphaMasks.masks[0];this.setMaskTransform(a,e,t,n,i)}},{key:"setItemMaskTransform",value:function(e,t,n,i){this.alphaMasks.masks[0].node.worldPosition=new j(-9999,-9999,0);var a=this.alphaMasks.masks[1];this.setMaskTransform(a,e,t,n,i)}},{key:"setMaskTransform",value:function(e,t,n,i,a){e.uiTransform.setContentSize(i,a),e.node.setWorldPosition(t,n,0)}}]),a}(f)).prototype,"background",[qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yd=$e(Kd.prototype,"alphaMasks",[Vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wd=Kd))||Wd);n._RF.pop(),n._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);var lf,uf,cf,hf,pf,df,ff,vf,yf,mf,gf,bf,wf,kf=i.ccclass,Sf=i.property,Cf=(Zd=kf("GuideTextBox"),ef=Sf(u),Zd((af=$e((nf=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"guideText",af,Ne(e)),e}return Pe(a,[{key:"__preload",value:function(){this.opacityToggler=this.getComponent(ga),St.lazyValidateProperties(this)}},{key:"setText",value:function(e){this.guideText.string=e}},{key:"show",value:(n=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.opacityToggler.changeStateFade(!0);case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.opacityToggler.changeStateFade(!1);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"guideText",[ef],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tf=nf))||tf);n._RF.pop(),n._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);var Ef,Af,Tf,xf,Pf,Rf,If,_f,Lf,Of,Df,Mf,Nf,Ff,Bf,Gf,zf,Uf,Hf,qf=game,Vf=qf.player,Wf=qf.analytics,Kf=i.ccclass,jf=i.property,Yf=GameCore.Plugins.Analytics.Events,Xf=new $(0,10),$f=new $(0,10),Jf="READY",Qf="RUNNING",Zf=(lf=Kf("GuidelinesManager"),uf=jf(Ld),cf=jf(Cf),hf=jf(u),pf=jf(sf),df=jf(a),lf((yf=$e((vf=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"guideHand",yf,Ne(e)),Xe(e,"guideTextBox",mf,Ne(e)),Xe(e,"guideInfoText",gf,Ne(e)),Xe(e,"guideMasks",bf,Ne(e)),Xe(e,"guideSkipButton",wf,Ne(e)),e.guideHintDelay=null,e.guideStormDelay=null,e}return Pe(i,[{key:"init",value:function(e){this.gameplay=e,this.status=Jf,this.node.scene.on(tr.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(tr.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(tr.USE_ITEM,this.handleUseItem,this),this.node.scene.on(tr.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(tr.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(tr.GAME_PAUSE,this.stopAutoGuides,this)}},{key:"show",value:function(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(ed)&&this.resetGuideItemShowed(),this.startGuide(ed)):this.startGuide(td)}},{key:"startGuide",value:function(e){if(this.status===Qf)return!1;if(this.hasGuideItemShowed(e))return!1;switch(this.addGuideItemShowed(e),this.status=Qf,e){case ed:Wf.event(Yf.TUTORIAL_BEGIN),this.guide1=new sd(this),this.guide1.setup();break;case td:this.guide2=new ld(this),this.guide2.setup();break;case nd:this.guide3=new ud(this),this.guide3.setup();break;case id:this.guide4=new cd(this),this.guide4.setup();break;case ad:this.guide5=new hd(this),this.guide5.setup();break;case rd:this.guide6=new pd(this),this.guide6.setup();break;case od:this.guide7=new Sd(this),this.guide7.setup()}return!0}},{key:"completeGuide",value:function(e){Wf.event(Yf.TUTORIAL_STEP,{step:e}),this.status=Jf,this.addGuideItemShowed(e),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}},{key:"isHintGuideLevel",value:function(){return this.getCurrentLevel()>=Xf.x&&this.getCurrentLevel()<=Xf.y}},{key:"isShowErrorPathLevel",value:function(){return this.getCurrentLevel()>=$f.x&&this.getCurrentLevel()<=$f.y}},{key:"isNewbieGuideLevel",value:function(){return 0===this.getCurrentLevel()}},{key:"hasGuideItemShowed",value:function(e){return this.getGuideItemShowed().includes(e)}},{key:"addGuideItemShowed",value:function(e){if(!this.hasGuideItemShowed(e)){var t=this.getGuideItemShowed();t.push(e),Vf.setGameData({guideItemShowed:t})}}},{key:"resetGuideItemShowed",value:function(){Vf.setGameData({guideItemShowed:[]})}},{key:"getGuideItemShowed",value:function(){var e,t;return null!==(e=null===(t=Vf.getGameData())||void 0===t?void 0:t.guideItemShowed)&&void 0!==e?e:[]}},{key:"getCurrentLevel",value:function(){return this.gameplay.levelManager.getLevelData().level}},{key:"startComboGuide",value:function(e){this.isNewbieGuideLevel()||e<2||(this.startGuide(nd),this.node.scene.off(tr.COMBO_UPDATED,this.startComboGuide,this))}},{key:"startAutoGuides",value:function(){this.startHintGuide(),this.startStormGuide()}},{key:"stopAutoGuides",value:function(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}},{key:"startHintGuide",value:function(){var e=this;this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=new oe(this.node).delay(5).call((function(){e.isNewbieGuideLevel()||(e.hasGuideItemShowed(id)&&e.status===Jf?e.node.scene.emit(tr.SHOW_HINT):e.startGuide(id),e.startHintGuide())}))),this.guideHintDelay.stop(),this.guideHintDelay.start())}},{key:"startStormGuide",value:function(){var e=this;null===this.guideStormDelay&&(this.guideStormDelay=new oe(this.node).delay(10).call((function(){if(!e.isNewbieGuideLevel()&&!e.hasGuideItemShowed(rd)){var t=e.gameplay.itemManager.items.find((function(e){return e.itemType===Es.STORM}));t&&t.canActivate()&&(e.startGuide(rd)||e.startStormGuide())}}))),this.guideStormDelay.stop(),this.guideStormDelay.start()}},{key:"startThunderGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(ad)}},{key:"startPliersGuide",value:function(){return!this.isNewbieGuideLevel()&&this.startGuide(od)}},{key:"handleUseItem",value:function(e){switch(this.startAutoGuides(),e){case Es.HINT:this.addGuideItemShowed(id);break;case Es.THUNDER:this.addGuideItemShowed(ad);break;case Es.STORM:this.addGuideItemShowed(rd);break;case Es.PLIERS:this.addGuideItemShowed(od)}}},{key:"skipNewbieGuide",value:(t=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.guideSkipButton.active=!1,e.next=3,this.guide1.close();case 3:t=this.getCurrentLevel()+1,Vf.setGameData({level:t}),this.node.scene.emit(tr.NEXT_LEVEL);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"guideHand",[uf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mf=$e(vf.prototype,"guideTextBox",[cf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gf=$e(vf.prototype,"guideInfoText",[hf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bf=$e(vf.prototype,"guideMasks",[pf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wf=$e(vf.prototype,"guideSkipButton",[df],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ff=vf))||ff);n._RF.pop(),n._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);var ev,tv=i.ccclass,nv=i.property,iv=(Ef=tv("SpecialItem"),Af=nv({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),Tf=nv({type:p,tooltip:"The button that activates the item"}),xf=nv({type:g,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),Pf=nv({type:u,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),Rf=nv({type:a,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),If=nv({type:a,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),_f=nv({type:M,group:"Animation"}),Lf=nv({type:M,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),Ef((Mf=$e((Df=function(e){Ie(r,e);var t,n,i,a=Be(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"isDevButton",Mf,Ne(e)),Xe(e,"button",Nf,Ne(e)),Xe(e,"quantity",Ff,Ne(e)),Xe(e,"quantityLabel",Bf,Ne(e)),Xe(e,"quantityNode",Gf,Ne(e)),Xe(e,"plusNode",zf,Ne(e)),Xe(e,"glowUIOpacity",Uf,Ne(e)),Xe(e,"uiOpacity",Hf,Ne(e)),e.requestItem=null,e.loadQuantity=null,e}return Pe(r,[{key:"itemType",get:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"init",value:function(e){var t=this;this.node.scene.on(tr.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(tr.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(tr.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(tr.IDLE_EXIT,(function(){t.button.interactable=!1,t.applyActivationStatus()})),this.node.scene.on(tr.IDLE_ENTER,(function(){t.button.interactable=!0,t.applyActivationStatus()}))}},{key:"start",value:function(){var e=this.loadQuantity();this.setQuantity(e)}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"applyActivationStatus",value:(i=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.canActivate(),this.button.interactable=t,e.next=4,yn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:t?255:128}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"activate",value:(n=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.quantity<=0)){e.next=3;break}return this.requestItem(),e.abrupt("return");case 3:this.vibrate(),this.setQuantity(this.quantity-1);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"canActivate",value:function(){return!1}},{key:"setQuantity",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();e<0&&(e=0),this.quantity=e,this.quantityLabel.string=`${this.quantity}`,e<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),t&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}},{key:"getQuantity",value:function(){return this.quantity}},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;this.isDevButton||t&&this.setQuantity(e,t.animate)}},{key:"vibrate",value:function(){var e;null===(e=P("Vibrate"))||void 0===e||null===(e=e.getComponent(Ss))||void 0===e||e.vibrate(50)}},{key:"animateAddItem",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.glowUIOpacity.opacity=0,e.abrupt("return",Promise.all([yn.runTweenAsync(S(this.node).to(.1,{scale:new j(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:j.ONE},{easing:"elasticOut"})),yn.runTweenAsync(S(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))]));case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(f)).prototype,"isDevButton",[Af],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Nf=$e(Df.prototype,"button",[Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ff=$e(Df.prototype,"quantity",[xf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bf=$e(Df.prototype,"quantityLabel",[Pf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gf=$e(Df.prototype,"quantityNode",[Rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zf=$e(Df.prototype,"plusNode",[If],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uf=$e(Df.prototype,"glowUIOpacity",[_f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hf=$e(Df.prototype,"uiOpacity",[Lf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Of=Df))||Of);n._RF.pop(),n._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);var av,rv=(0,i.ccclass)("ItemManager")(ev=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).sceneItems=new Set,e}return Pe(n,[{key:"items",get:function(){return Ve(this.sceneItems)}},{key:"onLoad",value:function(){this.syncItems()}},{key:"syncItems",value:function(){var e=this,t=P("Canvas/UI");t&&t.getComponentsInChildren(iv).forEach((function(t){t.node.activeInHierarchy&&e.sceneItems.add(t)}))}}]),n}(f))||ev;n._RF.pop(),n._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);var ov,sv=i.ccclass,lv=GameCore.Utils,uv={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]},cv=sv("LevelManager")(av=function(e){Ie(a,e);var t,n,i=Be(a);function a(){return Te(this,a),i.apply(this,arguments)}return Pe(a,[{key:"loadLevel",value:(n=Ae(Se().mark((function e(){var t,n,i,a,r,o,s,l,u=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:1,n=u.length>1&&void 0!==u[1]?u[1]:fl,e.next=4,this.loadLevelData(t);case 4:return i=e.sent,this.levelData=i||this.levelData||uv,a=this.levelData,r=a.rows,o=a.columns,lv.Device.isMobile()&&o>=6&&r>=10&&(this.levelData.columns=5,this.levelData.rows=10),s=`${Un.TILE_SKIN_FOLDER}/${n}`,e.next=11,Jn.loadSpriteFramesDirAsync(s);case 11:return l=e.sent,e.abrupt("return",l);case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"loadLevelData",value:(t=Ae(Se().mark((function e(){var t,n,i,a,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:1,n=10,i=this.paddingZero(`${Math.floor(t/n)+1}`,3),a=t%n,e.next=6,Jn.loadJsonAsync(`${Un.LEVEL_DATA_FOLDER}/${i}`);case 6:if(r=e.sent){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",r[a]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getLevelData",value:function(){return this.levelData}},{key:"paddingZero",value:function(e,t){return Array(t-e.length).fill("0").join("")+e}}]),a}(f))||av;n._RF.pop(),n._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);var hv=(0,i.ccclass)("ScoreManager")(ov=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).currentScore=0,e.tournamentStartScore=0,e}return Pe(n,[{key:"addScore",value:function(e,t,n){var i=this.getLevelMultiplier(t),a=this.getComboMultiplier(n),r=Math.floor(this.currentScore+e*i*a),o=10*Math.ceil(r/10);this.setScore(o)}},{key:"init",value:function(){this.initCurrentScore(),this.updateScore()}},{key:"initCurrentScore",value:function(){var e=Ll.getMatchMode();this.currentScore=e===GameCore.Match.Modes.TOURNAMENT?this.tournamentStartScore:0}},{key:"setScore",value:function(e){this.currentScore=e,this.updateScore()}},{key:"updateTournamentStartScore",value:function(){this.tournamentStartScore=this.currentScore}},{key:"updateScore",value:function(){this.node.scene.emit(tr.SCORE_UPDATED,this.currentScore)}},{key:"getCurrentScore",value:function(){return this.currentScore}},{key:"getLevelMultiplier",value:function(e){return 1+.1*(e-1)}},{key:"getComboMultiplier",value:function(e){return 1+.1*(e-1)}}]),n}(f))||ov;n._RF.pop(),n._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);var pv=GameCore,dv=pv.Configs,fv=pv.Plugins,vv=globalThis.game.ads,yv=function(){function e(){Te(this,e)}var t,n,i;return Pe(e,[{key:"canbeShowInSDK",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=GameSDK.getSDKName();return(null==t||!t.length||!t.includes(n))&&!(null!=e&&e.length&&!e.includes(n))}}],[{key:"inst",get:function(){return this._instance||(this._instance=new e),this._instance}},{key:"preloadAds",value:(i=Ae(Se().mark((function e(){var t,n,i,a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=dv.Ads,n=t.Enabled,i=t.InterstitialAdOptions,a=t.RewardedVideoAdOptions,n){e.next=3;break}return e.abrupt("return");case 3:r=GameCore.Plugins.Ads.Types,o=r.INTERSTITIAL,s=r.REWARDED_VIDEO,i.forEach((function(e){var t=e.PlacementId;vv.loadAdAsync(o,t).catch((function(){}))})),a.forEach((function(e){var t=e.PlacementId;vv.loadAdAsync(s,t).catch((function(){}))}));case 6:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"showBannerAds",value:function(){var e=dv.Ads,t=e.Enabled,n=e.BannerDisplayAdOptions;if(t){var i=se.instance.getVisibleSize(),a=ea.worldSizeToCssSize(i.height*Cs);n.forEach((function(e){var t=e.PlacementId,n=e.Position,i=e.BannerHeight;"bottom"===n&&i>a||vv.showBannerAdAsync(t).catch((function(e){}))}))}}},{key:"hideBannerAds",value:function(){var e=dv.Ads,t=e.Enabled,n=e.BannerDisplayAdOptions;t&&n.forEach((function(e){var t=e.PlacementId;vv.hideBannerAdAsync(t).catch((function(e){}))}))}},{key:"showInterstitialAdAsync",value:(n=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.forLevel,i=void 0===n?1:n,a=t.includeSDK,r=t.excludeSDK,this.inst.canbeShowInSDK(a,r)){e.next=3;break}return e.abrupt("return",!1);case 3:if(!(dv.Gameplay.StartAdAtLevel>=i)){e.next=5;break}return e.abrupt("return",!1);case 5:if(o=fv.Ads,s=o.Types,l=o.Status,vv.canbeShowInterstitialAd()){e.next=8;break}return e.abrupt("return",!1);case 8:if(u=Date.now(),e.prev=9,wi.muteAudio(!0),nu.showLoadingNotificationScreen(),vv.getAdStatus(s.INTERSTITIAL)===l.FILLED){e.next=16;break}return e.next=16,vv.loadAdAsync(s.INTERSTITIAL);case 16:return e.next=18,vv.showAdAsync(s.INTERSTITIAL);case 18:return e.abrupt("return",!0);case 21:return e.prev=21,e.t0=e.catch(9),console.warn("showInterstitialAdAsync failed",e.t0),e.abrupt("return",!1);case 25:return e.prev=25,wi.muteAudio(!1),c=(Date.now()-u)/1e3,setTimeout((function(){nu.closeNotificationScreen()}),c>.5?0:.5),vv.loadAdAsync(s.INTERSTITIAL).catch((function(){})),e.finish(25);case 31:case"end":return e.stop()}}),e,this,[[9,21,25,31]])}))),function(e){return n.apply(this,arguments)})},{key:"showRewardVideoAdAsync",value:(t=Ae(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.includeSDK,i=t.excludeSDK,this.inst.canbeShowInSDK(n,i)){e.next=3;break}return e.abrupt("return",!1);case 3:if(a=fv.Ads,r=a.Types,o=a.Status,e.prev=4,wi.muteAudio(!0),nu.showLoadingNotificationScreen(),vv.getAdStatus(r.REWARDED_VIDEO)===o.FILLED){e.next=11;break}return e.next=11,vv.loadAdAsync(r.REWARDED_VIDEO);case 11:return e.next=13,vv.showAdAsync(r.REWARDED_VIDEO);case 13:return nu.closeNotificationScreen(),e.abrupt("return",!0);case 17:return e.prev=17,e.t0=e.catch(4),console.warn("showRewardVideoAdAsync failed",e.t0),e.t0 instanceof Object&&"code"in e.t0&&"USER_INPUT"===e.t0.code?nu.showNotificationScreen("Sorry, no rewards!\n You have cancelled the ad.",2):nu.showNotificationScreen("No ads to display.",2),e.abrupt("return",!1);case 22:return e.prev=22,wi.muteAudio(!1),vv.loadAdAsync(r.REWARDED_VIDEO).catch((function(){})),e.finish(22);case 26:case"end":return e.stop()}}),e,this,[[4,17,22,26]])}))),function(e){return t.apply(this,arguments)})}]),e}();try{new yv}catch(e){console.error("AdsUtils",e)}n._RF.pop(),n._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);var mv=function(){function e(t){Te(this,e),this.game=null,this.data={},this.game=t.getGameplay(),this.manager=t,this.updateStateData(),this.logDebug()}return Pe(e,[{key:"logDebug",value:function(){var e=this.constructor.name;console.info(`[STATE] ${e}`,this.data)}},{key:"updateStateData",value:function(){if(this.game){var e=this.game.getGameData();e&&(this.data=e)}}},{key:"updateGameData",value:function(e){var t;null===(t=this.game)||void 0===t||t.setGameData(e)}}]),e}();n._RF.pop(),n._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);var gv=globalThis.game,bv=gv.analytics,wv=gv.monitorError,kv=gv.match,Sv=gv.player,Cv=gv.storage,Ev=GameCore.Match.Modes,Av=function(e){Ie(s,e);var t,n,i,a,r,o=Be(s);function s(e,t){var n;return Te(this,s),n=o.call(this,e),wi.stopAllSounds(),n.vibrateDevice(),n.pauseCountdown(),n.updateMatchCustomData(),n.handleGameOver(t),n.logLevelFailAnalytics(),n}return Pe(s,[{key:"pauseCountdown",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.pauseTime()}},{key:"vibrateDevice",value:function(){var e;null===(e=P("Vibrate"))||void 0===e||null===(e=e.getComponent(Ss))||void 0===e||e.vibrate(500)}},{key:"handleGameOver",value:(r=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=Ll.getMatchMode())!==Ev.SINGLE){e.next=6;break}return e.next=4,this.handleTournamentCreateFlow();case 4:e.next=14;break;case 6:if(n!==Ev.TOURNAMENT){e.next=11;break}return this.handleTournamentGameOver(),e.abrupt("return");case 11:if(n!==Ev.CHALLENGE_FRIEND){e.next=14;break}return this.handleChallengeGameOver(),e.abrupt("return");case 14:this.showFailScreen(t);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"handleTournamentCreateFlow",value:(a=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ll.processCreateTournamentAsync();case 3:e.next=12;break;case 5:if(e.prev=5,e.t0=e.catch(0),!(e.t0 instanceof hl)){e.next=9;break}return e.abrupt("return");case 9:return e.t0 instanceof cl&&(null==wv||wv.sendException(e.t0)),console.error(e.t0),e.abrupt("return");case 12:case"end":return e.stop()}}),e,null,[[0,5]])}))),function(){return a.apply(this,arguments)})},{key:"handleTournamentGameOver",value:(i=Ae(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=null===(t=Ll.getMatchCustomData())||void 0===t?void 0:t.tournamentId){e.next=3;break}return e.abrupt("return");case 3:if(!uu.validateTournamentExpired(i)){e.next=10;break}return Cv.setStorageData("tournament","animateTournamentLeader",!1),nu.showNotificationScreen("Tournament has ended",2),null===(a=this.game)||void 0===a||a.scheduleOnce((function(){var e;null===(e=c.game)||void 0===e||e.node.scene.emit(tr.GAME_EXIT)}),2),e.abrupt("return");case 10:return e.prev=10,e.next=13,Ll.finishMatchAsync();case 13:s=kv.getMatchState(),l=s.profiles,u=null!==(r=Cv.getStorageData("tournament","previousScore"))&&void 0!==r?r:0,(null!==(o=l[Sv.getPlayerId()].score)&&void 0!==o?o:0)>u&&Cv.setStorageData("tournament","animateTournamentLeader",!0),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(10),console.warn(e.t0);case 22:null===(n=this.game)||void 0===n||n.node.scene.emit(tr.GAME_EXIT);case 23:case"end":return e.stop()}}),e,this,[[10,19]])}))),function(){return i.apply(this,arguments)})},{key:"handleChallengeGameOver",value:(n=Ae(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=kv.getMatchState(),n=t.id,e.next=4,kv.api.getMatchAPI().getMatchDetailByIdAsync(n);case 4:return i=e.sent,a=new GameCore.Dtos.Match.Data(i).toObject().extraData,e.next=8,Ll.finishMatchAsync({extraData:null!=a?a:void 0});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.warn(e.t0);case 13:this.game.node.scene.emit(tr.SHOW_CHALLENGE_RESULTS);case 14:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return n.apply(this,arguments)})},{key:"showFailScreen",value:(t=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.data.level,!this.game){e.next=4;break}return e.next=4,yv.showInterstitialAdAsync({forLevel:n});case 4:wi.turnOffMusic(),t===hu&&wi.playSound(ti.LEVEL_FAIL_TIMEOUT),wi.playSound(ti.LEVEL_FAIL),nu.openScreen(ri,{level:n,failKey:t});case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateMatchCustomData",value:function(){var e,t,n=this.data.level,i=void 0===n?1:n,a=null!==(e=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore())&&void 0!==e?e:0;Ll.updateMatchStateAfterLevelFinish(i,a)}},{key:"logLevelFailAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore();bv.levelFail(t,n)}}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(){}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){}}]),s}(mv);n._RF.pop(),n._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);var Tv=globalThis.game,xv=Tv.analytics,Pv=Tv.player,Rv=Tv.leaderboard,Iv=Tv.match,_v=Tv.monitorError,Lv=GameCore.Match.Modes,Ov=function(e){Ie(s,e);var t,n,i,a,r,o=Be(s);function s(e){var t;return Te(this,s),(t=o.call(this,e)).handleFinishStateFlow(),t}return Pe(s,[{key:"handleFinishStateFlow",value:(r=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),wi.turnUpMusic(),null===(t=this.game)||void 0===t||t.uiManager.pauseTime(),(n=Ll.getMatchMode())!==Lv.CHALLENGE_FRIEND&&this.updatePlayerProgress(),this.updateMatchCustomData(),this.handlePostScoreToLeaderboard(),n!==Lv.CHALLENGE_FRIEND){e.next=12;break}this.handleChallengeOver(),e.next=15;break;case 12:return e.next=14,this.handleTournamentCreateFlow();case 14:this.showLevelCompleteScreen();case 15:this.logLevelCompleteAnalytics();case 16:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"handleChallengeOver",value:(a=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Iv.getMatchState(),n=t.id,e.next=4,Ll.getMatchExtraDataAsync(n);case 4:return i=e.sent,e.next=7,Ll.finishMatchAsync({extraData:null!=i?i:void 0});case 7:e.next=14;break;case 9:return e.prev=9,e.t0=e.catch(0),console.warn(e.t0),e.next=14,Ll.finishMatchAsync();case 14:this.game.node.scene.emit(tr.SHOW_CHALLENGE_RESULTS);case 15:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(){return a.apply(this,arguments)})},{key:"processCrazyGamesEvent",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"updateMatchCustomData",value:function(){var e,t,n=this.data.level,i=void 0===n?1:n,a=null!==(e=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore())&&void 0!==e?e:0;Ll.updateMatchStateAfterLevelFinish(i,a)}},{key:"logLevelCompleteAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=this.game.scoreManager.getCurrentScore();xv.levelComplete(t,n)}}},{key:"showLevelCompleteScreen",value:(i=Ae(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=this.data.level,wi.turnOffMusic(),wi.playSound(ti.LEVEL_COMPLETE),a=null!==(t=null===(n=Pv.getGameData())||void 0===n?void 0:n.coins)&&void 0!==t?t:0,nu.openScreen(hi,{level:i,currentCoin:a});case 5:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"updatePlayerProgress",value:function(){if(this.game){var e=this.data.level;if(e){var t=e+1,n=Pv.getGameData();if(n){var i=n.totalLevel,a=n.level,r=Math.max(a,t),o=ke({},n);r<i&&(o.level=r),Pv.setGameData(o)}}}}},{key:"attemptCallCreateShortcut",value:function(){var e=this.data.level;(void 0===e?0:e)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("createShortcutAsync",e)}))}},{key:"handleTournamentCreateFlow",value:(n=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ll.getMatchMode()===Lv.SINGLE){e.next=3;break}return e.abrupt("return");case 3:if(t=Pv.getGameData()){e.next=6;break}return e.abrupt("return");case 6:if(n=t.lastCreateTournamentShown,i=void 0===n?0:n,Date.now()-i>3e5){e.next=10;break}return e.abrupt("return");case 10:return e.prev=10,e.next=13,Ll.processCreateTournamentAsync();case 13:e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(10),!(e.t0 instanceof hl)){e.next=19;break}return e.abrupt("return");case 19:return e.t0 instanceof cl&&(null==_v||_v.sendException(e.t0)),console.error(e.t0),e.abrupt("return");case 22:case"end":return e.stop()}}),e,null,[[10,15]])}))),function(){return n.apply(this,arguments)})},{key:"handlePostScoreToLeaderboard",value:(t=Ae(Se().mark((function e(){var t,n,i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ll.getMatchMode()===Lv.TOURNAMENT){e.next=3;break}return e.abrupt("return");case 3:if(n=null===(t=this.game)||void 0===t?void 0:t.scoreManager.getCurrentScore()){e.next=6;break}return e.abrupt("return");case 6:return e.prev=6,e.next=9,GameSDK.tournament.postScoreAsync(n);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(6),console.warn("GameSDK post score async",e.t0);case 14:if(i=Ll.getMatchCustomData()){e.next=17;break}return e.abrupt("return");case 17:if(a=i.leaderboardId,r=i.playerId,a&&r){e.next=20;break}return e.abrupt("return");case 20:return e.next=22,Rv.setLeaderboardScoreAsync(a,r,n);case 22:case"end":return e.stop()}}),e,this,[[6,11]])}))),function(){return t.apply(this,arguments)})},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),s}(mv);n._RF.pop(),n._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);var Dv=globalThis.game,Mv=Dv.player,Nv=Dv.match,Fv=GameCore.Match.Modes,Bv=function(e){Ie(a,e);var t,n,i=Be(a);function a(e){var t;return Te(this,a),(t=i.call(this,e)).handleGameStart=function(){var e=Ae(Se().mark((function e(n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.game.levelManager.getLevelData(),t.game.board.create(n,a),t.game.board.setIgnoreInput(!0),e.next=5,t.game.board.animateTilesAppear();case 5:null!==(i=t.game.guidelinesManager)&&void 0!==i&&i.isNewbieGuideLevel()||t.game.board.setIgnoreInput(!1),t.ready();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),t.enableUI(),t.clearBoard(),t.loadLevel(),t.initCountdown(),t.initScore(),t}return Pe(a,[{key:"enableUI",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.enableHeader()}},{key:"clearBoard",value:function(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.pathDraw.clearMatchPath())}},{key:"loadLevel",value:(n=Ae(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.game){e.next=2;break}return e.abrupt("return");case 2:if(t=Ll.getMatchMode(),e.prev=3,t!==Fv.CHALLENGE_FRIEND){e.next=20;break}return n=Nv.getMatchState(),i=n.id,e.next=8,Ll.getMatchExtraDataAsync(i);case 8:if(null!=(a=e.sent)){e.next=11;break}throw new Error(`Match mode ${Fv.CHALLENGE_FRIEND} but no extraData (for opponent initialization) was found in match data.`);case 11:return r=this.getLevelSkin(a.level),e.next=14,this.game.levelManager.loadLevel(a.level,r);case 14:o=e.sent,this.updateGameData({level:a.level,levelData:this.game.levelManager.getLevelData()}),wi.playSound(ti.LEVEL_START),this.handleChallengeFriendGameStart(o,a),e.next=27;break;case 20:return s=this.getLevelSkin(this.data.level),e.next=23,this.game.levelManager.loadLevel(this.data.level,s);case 23:l=e.sent,this.updateGameData({levelData:this.game.levelManager.getLevelData()}),wi.playSound(ti.LEVEL_START),this.handleGameStart(l);case 27:e.next=39;break;case 29:return e.prev=29,e.t0=e.catch(3),console.error("Error loading level:",e.t0),u=this.getLevelSkin(this.data.level),e.next=35,this.game.levelManager.loadLevel(this.data.level,u);case 35:c=e.sent,this.updateGameData({levelData:this.game.levelManager.getLevelData()}),wi.playSound(ti.LEVEL_START),this.handleGameStart(c);case 39:this.updateGameData({levelData:this.game.levelManager.getLevelData()});case 40:case"end":return e.stop()}}),e,this,[[3,29]])}))),function(){return n.apply(this,arguments)})},{key:"getLevelSkin",value:function(e){var t=kl.getLevelSkin(e),n=kl.getUnlockedSkins();if(n.length<=1)return t;if(G.random()<=.5)return t;var i=n.indexOf(t);return n.splice(i,1),n[G.randomRangeInt(0,n.length)]}},{key:"handleChallengeFriendGameStart",value:(t=Ae(Se().mark((function e(t,n){var i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.game.levelManager.getLevelData(),a=n.level,r=n.fen,o=n.gravity,s=n.rules,l=n.time,u=Mv.getPlayerId(),e.next=5,Promise.all([Ll.setMatchCustomDataAsync({level:a,score:0}),Ll.setProfileMatchDataAsync({id:u,score:0})]);case 5:return this.game.board.create(t,ke(ke({},i),{},{level:a,customFen:r,mode:o,rules:s,time:l})),this.game.board.setIgnoreInput(!0),e.next=9,this.game.board.animateTilesAppear();case 9:this.game.board.setIgnoreInput(!1),this.ready();case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"initScore",value:function(){this.game&&this.game.scoreManager.initCurrentScore()}},{key:"initCountdown",value:function(){this.game&&this.game.uiManager.initCountdown()}},{key:"initialize",value:function(){}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"pause",value:function(){}},{key:"playing",value:function(){}},{key:"fail",value:function(){}},{key:"finish",value:function(){}},{key:"update",value:function(){}}]),a}(mv);n._RF.pop(),n._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);var Gv=function(e){Ie(n,e);var t=Be(n);function n(e){var i;return Te(this,n),(i=t.call(this,e)).startCountdown(),i}return Pe(n,[{key:"startCountdown",value:function(){var e;null===(e=this.game)||void 0===e||e.uiManager.startCountdown()}},{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){var e=this.manager.createReadyState(this.manager);this.manager.change(e)}},{key:"playing",value:function(){}},{key:"fail",value:function(e){var t=this.manager.createFailState(this.manager,e);this.manager.change(t)}},{key:"finish",value:function(){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}},{key:"update",value:function(){this.updateStateData()}}]),n}(mv);n._RF.pop(),n._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);var zv,Uv=globalThis.game,Hv=Uv.analytics,qv=Uv.match,Vv=function(e){Ie(n,e);var t=Be(n);function n(e){var i;return Te(this,n),i=t.call(this,e),wi.stopAllSounds(),wi.turnDownMusic(),i.handleGuideFlow(),i.setLevelText(),i.setLevelTime(),i.setGridPlayable(),i.logLevelStartAnalytics(),i}return Pe(n,[{key:"initialize",value:function(){var e=this.manager.createInitializeState(this.manager);this.manager.change(e)}},{key:"ready",value:function(){}},{key:"playing",value:function(){var e=this.manager.createPlayingState(this.manager);this.manager.change(e)}},{key:"fail",value:function(e){if(GameCore.Utils.Valid.isDebugger()){var t=this.manager.createFailState(this.manager);this.manager.change(t)}}},{key:"finish",value:function(){if(GameCore.Utils.Valid.isDebugger()){var e=this.manager.createFinishState(this.manager);this.manager.change(e)}}},{key:"update",value:function(){}},{key:"setGridPlayable",value:function(){var e;null!==(e=this.manager.getGameplay().guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}},{key:"handleGuideFlow",value:function(){var e,t;null!==(e=this.game.guidelinesManager)&&void 0!==e&&e.isNewbieGuideLevel()||this.game.handleShowUI(),null===(t=this.game.guidelinesManager)||void 0===t||t.show()}},{key:"setLevelTime",value:function(){if(this.game){var e=this.data.levelData;e&&this.game.uiManager.setCountdownTime(e.time)}}},{key:"setLevelText",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e;this.game.uiManager.setLevelText(t)}}},{key:"logLevelStartAnalytics",value:function(){if(this.game){var e=this.data.level,t=void 0===e?0:e,n=qv.getMatchState().customData.score,i=void 0===n?0:n;Hv.levelStart(t,i)}}}]),n}(mv);n._RF.pop(),n._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);var Wv,Kv,jv,Yv,Xv,$v=(0,i.ccclass)("StateManager")(zv=function(e){Ie(n,e);var t=Be(n);function n(){return Te(this,n),t.apply(this,arguments)}return Pe(n,[{key:"getGameplay",value:function(){return this.gameplay}},{key:"init",value:function(e){this.gameplay=e,this.state=new Bv(this)}},{key:"change",value:function(e){this.state=e}},{key:"initialize",value:function(){this.state.initialize()}},{key:"isInitialize",value:function(){return this.state instanceof Bv}},{key:"ready",value:function(){this.state.ready()}},{key:"isReady",value:function(){return this.state instanceof Vv}},{key:"playing",value:function(){this.state.playing()}},{key:"isPlaying",value:function(){return this.state instanceof Gv}},{key:"fail",value:function(e){this.state.fail(e)}},{key:"isFail",value:function(){return this.state instanceof Av}},{key:"finish",value:function(){this.state.finish()}},{key:"isFinished",value:function(){return this.state instanceof Ov}},{key:"update",value:function(e){this.state&&this.state.update(e)}},{key:"createInitializeState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return De(Bv,t)}},{key:"createReadyState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return De(Vv,t)}},{key:"createPlayingState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return De(Gv,t)}},{key:"createFailState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return De(Av,t)}},{key:"createFinishState",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return De(Ov,t)}}]),n}(f))||zv;n._RF.pop(),n._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);var Jv,Qv,Zv,ey,ty,ny,iy,ay=i.ccclass,ry=i.property,oy=(Wv=ay("Digit"),Kv=ry(u),Wv((Xv=$e((Yv=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"numberLabels",Xv,Ne(e)),e.labelUITransforms=[],e.labelUIOpacitys=[],e.previousNumber=0,e}return Pe(n,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.labelUITransforms=this.numberLabels.map((function(e){return e.getComponent(s)})),this.labelUIOpacitys=this.numberLabels.map((function(e){return e.getComponent(M)})),St.lazyValidateProperties(this)}},{key:"setNumber",value:function(e){this.previousNumber!==e&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[e].node.active||(this.numberLabels[e].node.active=!0),this.labelUIOpacitys[e].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[e].contentSize),this.previousNumber=e)}}]),n}(f)).prototype,"numberLabels",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jv=Yv))||jv);n._RF.pop(),n._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);var sy,ly=i.ccclass,uy=i.disallowMultiple,cy=i.property,hy=(Jv=ly("Clock"),Qv=cy(a),Zv=cy(oy),Jv(ey=uy((ny=$e((ty=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"clockIcon",ny,Ne(e)),Xe(e,"digits",iy,Ne(e)),e.time=0,e.remaining=0,e.running=!1,e.halfTime=!1,e.handleUpdateConfig=function(t){e.enabled&&console.log("Clock: handleUpdateConfig",t)},e.refillTime=function(){var t=Date.now(),n=S(e.node).to(.5,{scale:new j(1.1,1.1,1)}),i=S(e.node).to(.5,{scale:new j(1,1,1)}),a=S(e.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),r=S(e.clockIcon).repeat(5,a),o=S(e.node).to(3,{position:new j(0,0,0)},{onUpdate:function(){var n=Date.now(),i=(n-t)/3e3>1?1:(n-t)/3e3,a=G.lerp(0,120,i);e.setTime(a)}}).call((function(){e.setTime(120),i.start(),e.node.scene.emit(tr.RESCUE_FINISHED)}));S(e.node).parallel(n,o).start(),r.start()},e}return Pe(n,[{key:"__preload",value:function(){this.listenEvents()}},{key:"start",value:function(){this.init()}},{key:"init",value:function(){this.running=!1,this.halfTime=!1}},{key:"listenEvents",value:function(){this.node.scene.on(An,this.handleUpdateConfig),this.node.scene.on(tr.RESCUE_START,this.refillTime)}},{key:"setTime",value:function(e){this.time=e,this.updateTimeLabel(e),this.remaining=e}},{key:"startCountdown",value:function(){this.running=!0,this.remaining=this.time}},{key:"pause",value:function(){this.running=!1}},{key:"resume",value:function(){this.running=!0}},{key:"endCountDown",value:function(){this.running=!1,this.remaining=0,this.node.scene.emit(tr.TIME_OUT)}},{key:"update",value:function(e){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=e,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(tr.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}},{key:"updateTimeLabel",value:function(e){for(var t=this.convertSecondsToMmSs(e),n=0;n<t.length;n++)this.digits[n].setNumber(parseInt(t[n]))}},{key:"convertSecondsToMmSs",value:function(e){var t=Math.floor(e/60),n=Math.floor(e%60);return`${this.padZero(t)}${this.padZero(n)}`}},{key:"padZero",value:function(e){return e<10?`0${e}`:`${e}`}}]),n}(f)).prototype,"clockIcon",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iy=$e(ty.prototype,"digits",[Zv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ey=ty))||ey)||ey);n._RF.pop(),n._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);var py,dy,fy,vy,yy,my,gy,by,wy,ky=i.ccclass,Sy=ky("ComboProgressBar")(sy=function(e){Ie(n,e);var t=Be(n);function n(){return Te(this,n),t.apply(this,arguments)}return Pe(n,[{key:"start",value:function(){this.progressBar=this.getComponent(oo),this.opacity=this.getComponent(M),this.comboTimer=0,this.isActive=!1,this.node.scene.on(tr.COMBO_UPDATED,this.handleComboUpdated,this)}},{key:"update",value:function(e){this.isActive&&(this.comboTimer>0?(this.comboTimer-=e,this.progressBar.progress=this.comboTimer/3):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(tr.COMBO_ENDED)))}},{key:"handleComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>0&&(this.isActive=!0,this.comboTimer=3),e>1&&(this.opacity.opacity=255)}},{key:"pause",value:function(){this.isActive=!1}},{key:"resume",value:function(){this.isActive=!0}}]),n}(f))||sy;n._RF.pop(),n._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);var Cy,Ey,Ay,Ty,xy,Py,Ry,Iy,_y,Ly,Oy,Dy,My,Ny,Fy,By,Gy,zy=i.ccclass,Uy=i.property,Hy=(py=zy("ScoreBlock"),dy=Uy(T),fy=Uy(O),vy=Uy(u),py((gy=$e((my=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"avatar",gy,Ne(e)),Xe(e,"defaultAvatar",by,Ne(e)),Xe(e,"scoreText",wy,Ne(e)),e}return Pe(a,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){this.node.scene.on(tr.SCORE_UPDATED,this.updateScore,this)}},{key:"unListenGameEvents",value:function(){this.node.scene.off(tr.SCORE_UPDATED,this.updateScore,this)}},{key:"updateInfo",value:(n=Ae(Se().mark((function e(t,n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n?(this.score=n,this.scoreText.string=n.toString()):(this.score=0,this.scoreText.string="0"),e.prev=1,e.next=4,GameCore.Utils.Image.loadImage(t);case 4:if(i=e.sent){e.next=7;break}return e.abrupt("return");case 7:(a=O.createWithImage(i)).packable=!0,this.avatar.spriteFrame=a,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.avatar.spriteFrame=this.defaultAvatar;case 15:case"end":return e.stop()}}),e,this,[[1,12]])}))),function(e,t){return n.apply(this,arguments)})},{key:"updateScore",value:(t=Ae(Se().mark((function e(t){var n,i,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t-this.score,i=S(this.node).to(.1,{},{onUpdate:function(e,t){if(t){var i=Math.floor(n*t)+a.score;a.scoreText.string=i.toString()}}}),e.next=4,yn.runTweenAsync(i);case 4:this.scoreText.string=t.toString(),this.score=t;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),a}(f)).prototype,"avatar",[dy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),by=$e(my.prototype,"defaultAvatar",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wy=$e(my.prototype,"scoreText",[vy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yy=my))||yy);n._RF.pop(),n._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);var qy,Vy,Wy,Ky,jy,Yy=i.ccclass,Xy=i.property,$y=globalThis.game,Jy=($y.language,$y.match),Qy=(Cy=Yy("Header"),Ey=Xy(u),Ay=Xy(a),Ty=Xy(a),xy=Xy(a),Py=Xy(a),Ry=Xy(Hy),Iy=Xy(Hy),Cy((Oy=$e((Ly=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"levelText",Oy,Ne(e)),Xe(e,"settingNode",Dy,Ne(e)),Xe(e,"homeNode",My,Ne(e)),Xe(e,"leftNode",Ny,Ne(e)),Xe(e,"coinNode",Fy,Ne(e)),Xe(e,"playerScoreBlock",By,Ne(e)),Xe(e,"opponentScoreBlock",Gy,Ne(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"handleClickedPauseGame",value:function(){this.showSettingScreen(),this.node.scene.emit(tr.GAME_PAUSE)}},{key:"handleReturnHome",value:function(){nu.openScreen(di),this.node.scene.emit(tr.GAME_PAUSE)}},{key:"highlightCoinContainer",value:function(){var e=P("Canvas/Screens");if(e){var t=this.coinNode.worldPosition.clone();this.coinNode.parent=e,this.coinNode.worldPosition=t}}},{key:"removeCoinContainerHighlight",value:function(){var e=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=e}},{key:"showSettingScreen",value:function(){nu.openScreen(ui,{})}},{key:"setLevelText",value:function(e){this.levelText.string=`Level ${e}`}},{key:"setButtonsSelectable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enableBtnNode(this.settingNode,e,!0),this.enableBtnNode(this.homeNode,e,!0)}},{key:"showChallengeScoreBlock",value:function(){var e=Jy.getMatchState(),t=e.id,n=e.customData,i=n.playerId,a=n.opponentId;if(t&&i&&a){this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0,this.playerScoreBlock.listenGameEvents();var r=e.profiles[i],o=e.profiles[a];this.playerScoreBlock.updateInfo(r.photo,r.score),this.opponentScoreBlock.updateInfo(o.photo,o.score)}}},{key:"hideChallengeScoreBlock",value:function(){this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1}},{key:"enableBtnNode",value:function(e,t,n){var i=e.getComponent(p);if(i&&(i.interactable=t),e.active=n,n)e.getComponent(ga)}}]),n}(f)).prototype,"levelText",[Ey],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dy=$e(Ly.prototype,"settingNode",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),My=$e(Ly.prototype,"homeNode",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ny=$e(Ly.prototype,"leftNode",[xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fy=$e(Ly.prototype,"coinNode",[Py],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),By=$e(Ly.prototype,"playerScoreBlock",[Ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gy=$e(Ly.prototype,"opponentScoreBlock",[Iy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_y=Ly))||_y);n._RF.pop(),n._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);var Zy=i.ccclass,em=i.property,tm=(qy=Zy("UIMasks"),Vy=em(ga),qy((jy=$e((Ky=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"background",jy,Ne(e)),e}return Pe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"show",value:(n=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.background.node.active=!0,e.next=3,this.background.changeStateFade(!0,.25);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"hide",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.background.changeStateFade(!1,.25);case 2:this.background.node.active=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),a}(f)).prototype,"background",[Vy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wy=Ky))||Wy);n._RF.pop(),n._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);var nm,im,am,rm,om,sm="bomb";n._RF.pop(),n._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);var lm,um,cm,hm,pm,dm,fm,vm,ym,mm,gm,bm,wm,km,Sm,Cm,Em,Am,Tm,xm=GameCore.Dtos.Player,Pm=GameCore.Utils.Function,Rm=i.ccclass,Im=i.property,_m=globalThis.game.player,Lm=(nm=Rm("DevToolsContainer"),im=Im(a),nm((om=$e((rm=function(e){Ie(r,e);var t,n,i,a=Be(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"devToolsToggle",om,Ne(e)),e.isActive=!0,e.game=null,e.debouncedStarsNotification=Pm.debounce((function(){var e=_m.getGameData();e&&nu.showNotificationScreen(`Stars added. Current stars: ${e.stars}`)}),700),e}return Pe(r,[{key:"injectGameplay",value:function(e){this.game=e}},{key:"hideAllButtons",value:function(){var e=this;this.getComponentsInChildren(p).forEach((function(t){var n=t.node.parent;n&&n.name!==e.devToolsToggle.name&&(n.active=!1)}))}},{key:"showAllButtons",value:function(){var e=this;this.getComponentsInChildren(p).forEach((function(t){var n=t.node.parent;n&&n.name!==e.devToolsToggle.name&&(n.active=!0)}))}},{key:"handleClickDevToolsButton",value:function(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}},{key:"handleResetData",value:function(){_m.setPlayerData(xm.Data.getDefaultData()),nu.openScreen(ci,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(tr.START_OVER)}},{key:"handleNextLevel",value:(i=Ae(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(null!==(t=null===(n=this.game)||void 0===n||null===(n=n.getGameData())||void 0===n?void 0:n.level)&&void 0!==t?t:1)+1,null===(i=this.game)||void 0===i||i.setGameData({level:a-1}),_m.setGameData({level:a}),this.node.scene.emit(tr.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"handlePrevLevel",value:(n=Ae(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Math.max((null!==(t=null===(n=this.game)||void 0===n||null===(n=n.getGameData())||void 0===n?void 0:n.level)&&void 0!==t?t:2)-1,1),null===(i=this.game)||void 0===i||i.setGameData({level:a-1}),_m.setGameData({level:a}),this.node.scene.emit(tr.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleEnterSelectLevel",value:(t=Ae(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Number(t.string),null===(n=this.game)||void 0===n||n.setGameData({level:i-1}),_m.setGameData({level:i}),this.node.scene.emit(tr.NEXT_LEVEL);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"handleClickBuildVersionButton",value:function(){var e=globalThis.game.getBuildVersion();nu.showNotificationScreen(`Build version: ${e}`)}},{key:"handleClickWinLevelButton",value:function(){this.node.scene.emit(tr.GAME_FINISH)}},{key:"handleClickTimeOutButton",value:function(){this.node.scene.emit(tr.TIME_OUT)}},{key:"handleClickExplodeButton",value:function(){var e,t,n=this.game;if(n){var i=null===(e=n.getGameData())||void 0===e||null===(e=e.levelData)||void 0===e?void 0:e.specials.bomb;if(i&&!(i<=0)){var a=n.board.getBombTiles();if(0!==a.length){var r=a[0];if((null===(t=r.special)||void 0===t?void 0:t.type)!==sm)throw new Error("Invalid bomb tile");r.special.detonateImmediately()}else console.info("No bomb tiles found")}}}},{key:"handleFillItem",value:function(){this.node.scene.emit(tr.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Es.HINT,quantity:2}),this.node.scene.emit(tr.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Es.STORM,quantity:2}),this.node.scene.emit(tr.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Es.THUNDER,quantity:2}),this.node.scene.emit(tr.ADD_ITEM,{animate:function(){return Promise.resolve()},item:Es.PLIERS,quantity:2})}},{key:"handleAutoPlay",value:function(){this.node.scene.emit(tr.AUTO_PLAY)}},{key:"handleAddStars",value:function(){var e=_m.getGameData();e&&(_m.setGameData({stars:e.stars+10}),this.debouncedStarsNotification())}},{key:"handleSwitchBundle",value:function(){x.emit(In)}}]),r}(f)).prototype,"devToolsToggle",[im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am=rm))||am);n._RF.pop(),n._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);var Om,Dm,Mm,Nm,Fm,Bm,Gm,zm,Um,Hm=i.ccclass,qm=i.property,Vm=GameCore,Wm=Vm.Utils,Km=Vm.Match,jm=globalThis.game.match,Ym=(lm=Hm("UIManager"),um=qm(hy),cm=qm(Qy),hm=qm(Lm),pm=qm(Sy),dm=qm(a),fm=qm(tm),vm=qm([a]),ym=qm([a]),lm((bm=$e((gm=function(e){Ie(o,e);var t,n,i,a,r=Be(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"clock",bm,Ne(e)),Xe(e,"header",wm,Ne(e)),Xe(e,"devTools",km,Ne(e)),Xe(e,"comboProgressBar",Sm,Ne(e)),Xe(e,"comboContainer",Cm,Ne(e)),Xe(e,"uiMasks",Em,Ne(e)),Xe(e,"topAnimNodes",Am,Ne(e)),e.originTopNodesPos=[],Xe(e,"botAnimNodes",Tm,Ne(e)),e.originBotNodesPos=[],e.hideBotWorldY=-80,e.entranceSignal=new ha,e.exitSignal=new ha,e.showDevTools=function(){e.devTools&&(e.devTools.node.active=!0)},e}return Pe(o,[{key:"onLoad",value:function(){var e=this;this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),d.once(J.EVENT_AFTER_UPDATE,(function(){e.saveOriginPos(),e.initUIPos()}))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"saveOriginPos",value:function(){var e=this;this.topAnimNodes.forEach((function(t){e.originTopNodesPos.push(t.position.clone())})),this.botAnimNodes.forEach((function(t){e.originBotNodesPos.push(t.position.clone())}))}},{key:"initUIPos",value:function(){var e=this;this.topAnimNodes.forEach((function(t,n){var i=e.originTopNodesPos[n].clone();i.y+=200,t.setPosition(i)}));var t=new j(0,this.hideBotWorldY,0);this.botAnimNodes.forEach((function(n,i){var a,r,o=e.originBotNodesPos[i].clone();t.y=e.hideBotWorldY;var s=null!==(a=null===(r=n.parent)||void 0===r?void 0:r.inverseTransformPoint(t,t).y)&&void 0!==a?a:200;o.y=s,n.setPosition(o)}))}},{key:"listensDevToolsEvents",value:function(){this.node.scene.on(Us.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}},{key:"listenRescueEvents",value:function(){this.node.scene.on(tr.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(tr.RESCUE_FINISHED,this.hideRescueAnimation,this)}},{key:"initDevTools",value:function(e){var t=this;window.addEventListener("reset-game-data",(function(){var e;null===(e=t.devTools)||void 0===e||e.handleResetData()})),this.devTools&&(this.devTools.node.active=Wm.Valid.isDebugger(),this.devTools.injectGameplay(e))}},{key:"setLevelText",value:function(e){this.header.setLevelText(e)}},{key:"initCountdown",value:function(){this.clock.init()}},{key:"setCountdownTime",value:function(e){this.clock.setTime(e)}},{key:"startCountdown",value:function(){this.clock.startCountdown()}},{key:"pauseTime",value:function(){this.comboProgressBar.pause(),this.clock.pause()}},{key:"resumeTime",value:function(){this.comboProgressBar.resume(),this.clock.resume()}},{key:"setComboUI",value:function(e){this.comboContainer.getComponent(ga).changeStateFade(e,.1)}},{key:"disableHeader",value:function(){this.header.setButtonsSelectable(!1)}},{key:"enableHeader",value:function(){this.header.setButtonsSelectable()}},{key:"updateStatus",value:function(){jm.getMatchState().mode===Km.Modes.CHALLENGE_FRIEND?this.header.showChallengeScoreBlock():this.header.hideChallengeScoreBlock()}},{key:"showRescueAnimation",value:(a=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uiMasks.show();case 2:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"hideRescueAnimation",value:(i=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uiMasks.hide();case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"playExitAnimUI",value:(n=Ae(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new ha,t=[],this.topAnimNodes.forEach((function(e,n){var a=i.originTopNodesPos[n].clone();a.y+=200;var r=S(e);r.to(.17,{position:a},{easing:"backIn"}),t.push(yn.runTweenAsync(r,i.exitSignal))})),n=new j(0,this.hideBotWorldY,0),this.botAnimNodes.forEach((function(e,a){var r,o,s=i.originBotNodesPos[a].clone();n.y=i.hideBotWorldY;var l=null!==(r=null===(o=e.parent)||void 0===o?void 0:o.inverseTransformPoint(n,n).y)&&void 0!==r?r:200;s.y=l;var u=S(e);u.to(.17,{position:s},{easing:"backIn"}),t.push(yn.runTweenAsync(u,i.exitSignal))})),e.next=9,Promise.all(t);case 9:if(!this.exitSignal.aborted){e.next=11;break}return e.abrupt("return");case 11:this.header.node.active=!1;case 12:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playEntranceAnimUI",value:(t=Ae(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new ha,this.header.node.active=!0,t=[],this.topAnimNodes.forEach((function(e,i){var a=S(e);a.to(.2,{position:n.originTopNodesPos[i]},{easing:"backOut"}),t.push(yn.runTweenAsync(a,n.entranceSignal))})),this.botAnimNodes.forEach((function(e,i){var a=S(e);a.to(.2,{position:n.originBotNodesPos[i]},{easing:"backOut"}),t.push(yn.runTweenAsync(a,n.entranceSignal))})),e.next=9,Promise.all(t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"highlightCoinContainer",value:function(){this.header.highlightCoinContainer()}},{key:"unHighlightCoinContainer",value:function(){this.header.removeCoinContainerHighlight()}},{key:"setInteractableItemButtons",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.botAnimNodes.forEach((function(t){var n=t.getComponent(iv);if(n){if(!e)return void(n.button.interactable=!1);n.canActivate()&&(n.button.interactable=!0)}}))}}]),o}(f)).prototype,"clock",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wm=$e(gm.prototype,"header",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),km=$e(gm.prototype,"devTools",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sm=$e(gm.prototype,"comboProgressBar",[pm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cm=$e(gm.prototype,"comboContainer",[dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Em=$e(gm.prototype,"uiMasks",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am=$e(gm.prototype,"topAnimNodes",[vm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tm=$e(gm.prototype,"botAnimNodes",[ym],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mm=gm))||mm);n._RF.pop(),n._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);var Xm=globalThis.game,$m=Xm.player,Jm=Xm.ads,Qm=Xm.event,Zm=Xm.match,eg=Xm.storage,tg=Xm.analytics,ng=Xm.monitorError,ig=Xm.frameCapture,ag=Xm.leaderboard,rg=GameCore.Events,og=GameCore.Match.Modes,sg=GameCore.Utils.Time,lg=GameCore.Configs.Gameplay,ug=i.ccclass,cg=i.property,hg=[];Om=ug("Gameplay"),Dm=cg(rh),Mm=cg(ga),Nm=cg($h),Om((Gm=$e((Bm=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"board",Gm,Ne(e)),Xe(e,"opacityToggler",zm,Ne(e)),Xe(e,"pathDraw",Um,Ne(e)),e.gameData=null,e.defaultData={level:1,isMatchStartFromLoader:!1},e.rescueTiles=[],e.isAutoPlayEnabled=!1,e.handleOpenScreen=function(t){t.screenName===si&&e.uiManager.highlightCoinContainer()},e.handleShowUI=Ae(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.uiManager.updateStatus(),e.uiManager.disableHeader(),e.uiManager.setInteractableItemButtons(!1),t.next=5,e.uiManager.playEntranceAnimUI();case 5:e.uiManager.enableHeader(),e.uiManager.setInteractableItemButtons(!0);case 7:case"end":return t.stop()}}),t)}))),e.handleHideUI=Ae(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.uiManager.disableHeader(),e.uiManager.setInteractableItemButtons(!1),t.next=4,e.uiManager.playExitAnimUI();case 4:case"end":return t.stop()}}),t)}))),e.handleCloseScreen=function(t){t.screenName===si&&e.uiManager.unHighlightCoinContainer()},e.handlePauseGame=function(){e.node.scene.emit(tr.PAUSE_TIME),e.node.pauseSystemEvents(!0),e.opacityToggler.changeStateFade(!1,.1),e.uiManager.setComboUI(!1),e.processCrazyGamesGameplayStop()},e.handleResumeGame=function(){var t;e.node.resumeSystemEvents(!0),e.stateManager.isPlaying()&&e.node.scene.emit(tr.RESUME_TIME),e.processCrazyGamesGameplayStart(),e.opacityToggler.changeStateFade(!0,.1),e.uiManager.setComboUI(!0),null===(t=e.guidelinesManager)||void 0===t||t.startAutoGuides()},e.handleReplayGame=function(){var t=Ae(Se().mark((function t(n){var i;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.handleHideHint(),i=ke(ke({},e.defaultData),n),t.prev=2,Zm.getMatchState().mode!==og.SINGLE){t.next=6;break}return t.next=6,Ll.finishMatchAsync();case 6:if(Zm.getMatchState().mode===og.CHALLENGE_FRIEND){t.next=9;break}return t.next=9,Ll.startMatchAsync();case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),console.warn("handleReplayGame",t.t0);case 14:e.setGameData(i),e.stateManager.initialize();case 16:case"end":return t.stop()}}),t,null,[[2,11]])})));return function(e){return t.apply(this,arguments)}}(),e.handleFinishGame=function(){var t;e.attemptCallCreateShortcut(),null!==(t=e.guidelinesManager)&&void 0!==t&&t.isNewbieGuideLevel()?(e.guidelinesManager.guideSkipButton.active=!1,e.handleNextLevel()):e.stateManager.finish()},e.handleNextLevel=Ae(Se().mark((function t(){var n,i,a;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.gameData){t.next=2;break}return t.abrupt("return");case 2:if(t.prev=2,Zm.getMatchState().mode!==og.SINGLE){t.next=6;break}return t.next=6,Ll.finishMatchAsync();case 6:return Zm.getMatchState().mode===og.TOURNAMENT&&e.scoreManager.updateTournamentStartScore(),t.next=9,Ll.startMatchAsync();case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(2),console.warn("handleReplayGame",t.t0);case 14:i=null!==(n=e.gameData.level)&&void 0!==n?n:1,a=i+1,e.setGameData({level:a}),e.stateManager.initialize(),console.log("Next level",e.gameData.level);case 19:case"end":return t.stop()}}),t,null,[[2,11]])}))),e.handleStartOver=Ae(Se().mark((function t(){var n;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:$m.setGameData({level:lg.Tutorial.Enabled?0:1}),e.gameData=$m.getGameData(),e.stateManager.initialize(),console.info("Start over",null===(n=e.gameData)||void 0===n?void 0:n.level);case 4:case"end":return t.stop()}}),t)}))),e.handleMaxLevel=function(){e.gameData&&(e.initData(),nu.openScreen(pi,{level:e.gameData.level}),console.info("Max level",e.gameData.level))},e.handleExitGame=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{eg.setStorageData("dashboard","animateToCurrentLevel",!0),eg.setStorageData("collection","animateMapPackUnlock",!0)}catch(e){console.warn("handleExitGame",e)}case 1:case"end":return e.stop()}}),e)}))),e.handleTileClick=function(t){e.stateManager.playing(),e.board.handleTileClick(t),e.handleHideHint()},e.handleGridMatchSuccess=function(t,n){e.pathDraw.drawMatchPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)})),e.comboManager.addCombo(),e.handleAddScore(),e.effectManager.playClearFXAt([n[0].node.worldPosition,n[1].node.worldPosition])},e.handleGridMatchFail=function(t){var n;null!==(n=e.guidelinesManager)&&void 0!==n&&n.isShowErrorPathLevel()&&e.pathDraw.drawErrorPath(t,(function(t){var n=t.x,i=t.y;return e.board.getAnyTileWorldPosition(n,i)}))},e.checkIfGameIsFinish=function(){0===e.board.getUncleared().length&&e.node.scene.emit(tr.GAME_FINISH)},e.handlePauseTime=function(){e.uiManager.pauseTime()},e.handleResumeTime=function(){e.uiManager.resumeTime()},e.handleClockTimeout=function(){e.stateManager.fail(hu)},e.handleHalfTime=function(){void 0!==e.guidelinesManager&&(e.board.getUncleared().length>=e.board.getCleared().length&&e.guidelinesManager.startThunderGuide()||e.board.getBombTiles().length>0&&e.guidelinesManager.startPliersGuide())},e.handleStartRescue=function(){var t,n;for(Jn.setBlockInput(!0),e.board.setIgnoreInput(!0);e.rescueTiles.length>0;){var i=e.rescueTiles.pop();null==i||i.restore()}tg.levelRescue(null!==(t=null===(n=e.gameData)||void 0===n?void 0:n.level)&&void 0!==t?t:1)},e.handleFinishRescue=function(){Jn.setBlockInput(!1),e.board.setIgnoreInput(!1)},e.handleBombExplode=function(){var t=Ae(Se().mark((function t(n){var i;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.rescueTiles.push(n),e.board.setIgnoreInput(!0),Jn.getBlockInput()||(wi.playSound(ti.BOMB_EXPLODE_1),Jn.setBlockInput(!0)),i=n.node.worldPosition,t.next=6,e.effectManager.createBombExplosionAt(new j(i.x,i.y,0));case 6:if(Jn.setBlockInput(!1),!e.stateManager.isFail()){t.next=9;break}return t.abrupt("return");case 9:e.stateManager.fail(pu);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleShowHint=function(){if(!e.pathDraw.isDrawingHint){var t=e.board.getHintPath();t&&(wi.playSound(ti.HINT_ITEM),e.pathDraw.drawHintPath(t,(function(t){return e.board.getAnyTileWorldPosition(t.x,t.y)})),e.board.showHint())}},e.handleHideHint=function(){e.pathDraw.isDrawingHint&&(e.pathDraw.clearHintPath(),e.board.hideHint())},e.handleAddScore=function(){var t=e.levelManager.getLevelData().level,n=e.comboManager.getCombo();e.scoreManager.addScore(10,t,n)},e.handleUseItem=function(t){e.stateManager.playing(),t!==Es.HINT&&e.handleHideHint()},e.handleAutoPlay=function(){e.isAutoPlayEnabled?e.disableAutoPlay():e.enableAutoPlay()},e.enableAutoPlay=function(){e.isAutoPlayEnabled=!0;e.node.scene.once(tr.GAME_FINISH,(function(){e.disableAutoPlay()})),e.schedule(e.autoPlay,.5)},e.disableAutoPlay=function(){e.isAutoPlayEnabled=!1,e.unschedule(e.autoPlay)},e.autoPlay=function(){var t=e.board.getHintPath();if(!t)throw new Error("No path found");var n=t[0].a,i=t.slice(-1)[0].b,a=e.board.getTileAt(n.x,n.y),r=e.board.getTileAt(i.x,i.y);if(!a||!r)throw new Error("Tile is null");a.onClick(),r.onClick()},e.handleAddStars=function(t){var n=$m.getGameData();if(!n)return Promise.resolve([]);$m.setGameData({stars:n.stars+1});var i=t.startAnimationAt;i&&e.effectManager.playStarFXAt(i)},e.handleInviteFriends=Ae(Se().mark((function t(){var n,i,a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,nu.showLoadingScreen(),r=e.board.generateFenFromCurrentLevel(),o=null!==(n=$m.getGameData())&&void 0!==n?n:{},s=o.level,l=void 0===s?1:s,l=Math.max(1,l),u=null!==(i=null===(a=e.gameData)||void 0===a?void 0:a.levelData)&&void 0!==i?i:{},c=u.mode,h=void 0===c?"":c,p=u.rules,d=void 0===p?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:p,f=u.time,v=void 0===f?0:f,ig.addWideframeRender("renderResultChallenge",ol),t.next=9,Zm.context.choose.processAsync({playerId:$m.getPlayerId(),fallbackSingleMode:!1,extraData:{level:l,fen:r,gravity:h,rules:d,time:v}});case 9:nu.closeLoadingScreen(),e.node.scene.emit(tr.GAME_RESUME),e.node.scene.emit(tr.GAME_REPLAY,{level:l}),t.next=24;break;case 14:if(t.prev=14,t.t0=t.catch(0),console.warn("Unable to invite friends",t.t0),nu.closeLoadingScreen(),nu.showNotificationScreen("Sorry, please try again later"),t.t0 instanceof Error){t.next=21;break}return t.abrupt("return");case 21:null==ng||ng.sendException(t.t0),e.node.scene.emit(tr.GAME_RESUME),e.node.scene.emit(tr.SHOW_UI);case 24:case"end":return t.stop()}}),t,null,[[0,14]])}))),e.handleReplayFriends=Ae(Se().mark((function t(){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=null!==(n=$m.getGameData())&&void 0!==n?n:{},a=i.level,r=void 0===a?1:a,t.prev=1,l=Zm.getMatchState().customData.opponentId){t.next=5;break}throw new Error("Opponent id is not found");case 5:return nu.showLoadingScreen(),u=e.board.generateFenFromCurrentLevel(),c=null!==(o=null===(s=e.gameData)||void 0===s?void 0:s.levelData)&&void 0!==o?o:{},h=c.mode,p=void 0===h?"":h,d=c.rules,f=void 0===d?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:d,v=c.time,y=void 0===v?0:v,t.next=10,Zm.challenge.friend.processAsync({playerId:$m.getPlayerId(),opponentId:l,extraData:{level:r,fen:u,gravity:p,rules:f,time:y}});case 10:nu.closeLoadingScreen(),e.node.scene.emit(tr.GAME_RESUME),e.node.scene.emit(tr.GAME_REPLAY,{level:r}),t.next=25;break;case 15:if(t.prev=15,t.t0=t.catch(1),console.warn("ReplayChallengeFriend",t.t0),nu.closeLoadingScreen(),nu.showNotificationScreen("Sorry, you cannot replay\nat this time.",3),t.t0 instanceof Error){t.next=22;break}return t.abrupt("return");case 22:null==ng||ng.sendException(t.t0),e.node.scene.emit(tr.GAME_RESUME),e.node.scene.emit(tr.GAME_REPLAY,{level:r});case 25:case"end":return t.stop()}}),t,null,[[1,15]])}))),e.handleAdShow=function(t){var n=t.placementId;n&&hg.includes(n)&&(hg.splice(hg.indexOf(n),1),Jm.hideBannerAdAsync(n).catch((function(){})),0===hg.length&&Qm.off(GameCore.Events.AD_SHOWING,e.handleAdShow))},e.handleAddItem=function(){var t=Ae(Se().mark((function t(n){var i,a,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=n.animate,a=n.item,r=n.quantity,void 0!==(o=e.itemManager.items.find((function(e){return e.itemType===a})))){t.next=5;break}return console.warn(`Item ${a} not found`),t.abrupt("return");case 5:return s=o.getQuantity(),l=s+r,o.saveQuantity(l),e.uiManager.setInteractableItemButtons(!1),e.handlePauseGame(),t.next=12,i();case 12:o.setQuantity(l,!0),e.uiManager.setInteractableItemButtons(!0),e.handleResumeGame();case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e}return Pe(i,[{key:"__preload",value:function(){this.initComponents(),kl.init(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}},{key:"initComponents",value:function(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}},{key:"initUIManager",value:function(){var e;this.uiManager=null===(e=this.node.parent)||void 0===e?void 0:e.getComponentInChildren(Ym),this.uiManager.initDevTools(this)}},{key:"initLevelManager",value:function(){this.levelManager=this.getComponent(cv)}},{key:"initStateManager",value:function(){this.stateManager=this.getComponent($v)}},{key:"initInputController",value:function(){this.inputController=this.getComponent(du)}},{key:"initEffectManager",value:function(){this.effectManager=this.getComponent(Jp)}},{key:"initItemManager",value:function(){var e=this;this.itemManager=this.getComponent(rv),this.itemManager.syncItems(),this.itemManager.items.forEach((function(t){t.init(e)}))}},{key:"initComboManager",value:function(){this.comboManager=this.getComponent(fp),this.comboManager.init()}},{key:"initScoreManager",value:function(){this.scoreManager=this.getComponent(hv),this.scoreManager.init()}},{key:"initGuidelinesManager",value:function(){lg.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(Zf),this.guidelinesManager.init(this))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenCoreEvents",value:function(){hg=[],Qm.off(GameCore.Events.AD_SHOWING,this.handleAdShow),Qm.clear(rg.OPENING_SCREEN),Qm.clear(rg.CLOSING_SCREEN),Qm.on(rg.OPENING_SCREEN,this.handleOpenScreen),Qm.on(rg.CLOSING_SCREEN,this.handleCloseScreen)}},{key:"listenInputEvents",value:function(){this.node.scene.on(tr.SHOW_UI,this.handleShowUI),this.node.scene.on(tr.HIDE_UI,this.handleHideUI),this.node.scene.on(tr.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(tr.GAME_RESUME,this.handleResumeGame),this.node.scene.on(tr.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(tr.GAME_FINISH,this.handleFinishGame),this.node.scene.on(tr.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(tr.START_OVER,this.handleStartOver),this.node.scene.on(tr.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(tr.GAME_EXIT,this.handleExitGame),this.node.scene.on(tr.TILE_CLICK,this.handleTileClick),this.node.scene.on(tr.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(tr.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(tr.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(tr.RESUME_TIME,this.handleResumeTime),this.node.scene.on(tr.TIME_OUT,this.handleClockTimeout),this.node.scene.on(tr.HALF_TIME,this.handleHalfTime),this.node.scene.on(tr.RESCUE_START,this.handleStartRescue),this.node.scene.on(tr.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(tr.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(tr.SHOW_HINT,this.handleShowHint),this.node.scene.on(tr.ADD_SCORE,this.handleAddScore),this.node.scene.on(tr.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(tr.USE_ITEM,this.handleUseItem),this.node.scene.on(tr.ADD_ITEM,this.handleAddItem),this.node.scene.on(tr.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(tr.ADD_STARS,this.handleAddStars)}},{key:"listenFlowEvents",value:function(){this.node.scene.on(tr.INVITE_FRIENDS,this.handleInviteFriends),this.node.scene.on(tr.REPLAY_FRIENDS,this.handleReplayFriends)}},{key:"start",value:function(){this.initDataFirstTime(),this.initGame(),this.trySetTournamentStorage()}},{key:"initDataFirstTime",value:function(){var e=this.getSceneData(),t=(null!=e?e:{}).isMatchStartFromLoader,n=void 0!==t&&t,i=(null!=e?e:{}).level;void 0===i&&(i=Ll.getMatchMode()===og.TOURNAMENT?1:0),this.initData(),this.setGameData({isMatchStartFromLoader:n,level:i})}},{key:"initData",value:function(){var e,t=null!==(e=$m.getGameData())&&void 0!==e?e:{},n=t.level,i=void 0===n?1:n,a=t.items;a&&this.checkItemsRewardable()&&(a.hint<5&&(a.hint+=1),a.thunder<5&&(a.thunder+=1),a.storm<5&&(a.storm+=1),a.pliers<5&&(a.pliers+=1),$m.setGameData({items:a,lastRewardedItems:Date.now()})),this.setGameData(ke(ke({},this.defaultData),{},{level:i}))}},{key:"checkItemsRewardable",value:function(){var e,t=(null!==(e=$m.getGameData())&&void 0!==e?e:{}).lastRewardedItems,n=void 0===t?0:t;return!sg.isToday(n)}},{key:"initGame",value:function(){this.stateManager.init(this),this.stateManager.initialize()}},{key:"trySetTournamentStorage",value:(t=Ae(Se().mark((function e(){var t,n,i,a,r,o,s,l;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ll.getMatchMode()===og.TOURNAMENT){e.next=3;break}return e.abrupt("return");case 3:if(n=null!==(t=Ll.getMatchCustomData())&&void 0!==t?t:{},i=n.leaderboardId){e.next=6;break}return e.abrupt("return");case 6:return e.next=8,uu.requestTournamentDataAsync();case 8:if(a=ag.getLeaderboardName(i)){e.next=11;break}return e.abrupt("return");case 11:return e.next=13,ag.getLeadersByPlayerIdsAsync(a,[$m.getPlayerId()]);case 13:if(0!==(r=e.sent).length){e.next=16;break}return e.abrupt("return");case 16:o=r[0],s=o.score,l=o.rank,eg.setStorageData("tournament","previousScore",s),eg.setStorageData("tournament","previousRank",l);case 19:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"setGameData",value:function(e){var t,n,i,a=null!==(t=null!==(n=e.level)&&void 0!==n?n:null===(i=this.gameData)||void 0===i?void 0:i.level)&&void 0!==t?t:1;this.gameData=ke(ke(ke({},this.gameData),e),{},{level:a})}},{key:"getGameData",value:function(){return this.gameData}},{key:"getSceneData",value:function(){return Hl.getSceneData(this.node.scene)}},{key:"attemptCallCreateShortcut",value:function(){var e,t=null!==(e=this.getGameData())&&void 0!==e?e:{},n=t.level,i=void 0===n?0:n,a=t.nextLevelCount;i<2||(void 0===a?0:a)<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((function(e){console.warn("checkAndCreateShortcutAsync",e)}))}},{key:"processCrazyGamesGameplayStart",value:function(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}},{key:"processCrazyGamesGameplayStop",value:function(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}},{key:"disableRewardAdsItemForCrazyGames",value:function(){GameSDK.getSDKName()}}]),i}(f)).prototype,"board",[Dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zm=$e(Bm.prototype,"opacityToggler",[Mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Um=$e(Bm.prototype,"pathDraw",[Nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fm=Bm));n._RF.pop(),n._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var pg=function(e){return e[e.STAR_CHEST=0]="STAR_CHEST",e[e.BALLOON=1]="BALLOON",e}(pg||{});N(pg),n._RF.pop(),n._RF.push({},"8f431E6HDFDbJx4cwc1mRYd","DefaultMapData",void 0),n._RF.pop(),n._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var dg,fg=function(e){return e.WORLD_TAB_SELECTED="world-tab-selected",e.FRIENDS_TAB_SELECTED="friends-tab-selected",e}(fg||{}),vg="#AE4212",yg="#3D5172",mg="#92200C",gg="#8F5542",bg="#8A4733",wg="#3e7110",kg="#3e7110";n._RF.pop(),n._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),n._RF.pop(),n._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),n._RF.pop(),n._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),n._RF.pop(),n._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);var Sg,Cg=i.ccclass,Eg=globalThis.game,Ag=Eg.player,Tg=Eg.analytics;Cg("HintItem")(dg=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){nu.openScreen(si,{item:Es.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},e.loadQuantity=function(){var e=Ag.getGameData();return null!=e&&e.items&&e?e.items[Es.HINT]:0},e}return Pe(i,[{key:"itemType",get:function(){return Es.HINT}},{key:"init",value:function(e){this.boardInstance=e.board,this.pathDrawer=e.pathDraw,this.setQuantity(this.loadQuantity()),ze(_e(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=ze(_e(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=ze(_e(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){ze(_e(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>0}catch(e){return!1}}},{key:"activate",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pathDrawer.isDrawingHint){e.next=2;break}return e.abrupt("return");case 2:if(!(this.getQuantity()<=0)){e.next=6;break}return e.next=5,ze(_e(i.prototype),"activate",this).call(this);case 5:return e.abrupt("return");case 6:return e.next=8,ze(_e(i.prototype),"activate",this).call(this);case 8:Tg.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Es.HINT}),this.node.scene.emit(tr.USE_ITEM,Es.HINT),this.node.scene.emit(tr.SHOW_HINT);case 11:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;ze(_e(i.prototype),"saveQuantity",this).call(this,e,t);var n=Ag.getGameData();n&&Ag.setGameData({items:ke(ke({},n.items),{},{[Es.HINT]:e})})}}]),i}(iv));n._RF.pop(),n._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);var xg,Pg=i.ccclass,Rg=globalThis.game,Ig=Rg.player,_g=Rg.analytics;Pg("PliersItem")(Sg=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){nu.openScreen(si,{item:Es.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},e.loadQuantity=function(){var e=Ig.getGameData();return null!=e&&e.items&&e?e.items[Es.PLIERS]:0},e}return Pe(i,[{key:"itemType",get:function(){return Es.PLIERS}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,ze(_e(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=ze(_e(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=ze(_e(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){ze(_e(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getBombTiles().length>0}catch(e){return!1}}},{key:"activate",value:(t=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,ze(_e(i.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,ze(_e(i.prototype),"activate",this).call(this);case 6:_g.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Es.PLIERS}),this.node.scene.emit(tr.USE_ITEM,Es.PLIERS),t=sc(this.boardInstance.getBombTiles()),n=t.node.worldPosition,this.effectManager.createDefuseExplosionAt(new j(n.x,n.y,0)),wi.playSound(ti.BOMB_DEFUSE),t.special.switch(Yu.none),this.applyActivationStatus();case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;ze(_e(i.prototype),"saveQuantity",this).call(this,e,t);var n=Ig.getGameData();n&&Ig.setGameData({items:ke(ke({},n.items),{},{[Es.PLIERS]:e})})}}]),i}(iv));n._RF.pop(),n._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);var Lg,Og=i.ccclass,Dg=globalThis.game,Mg=Dg.player,Ng=Dg.analytics;Og("StormItem")(xg=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){nu.openScreen(si,{item:Es.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},e.loadQuantity=function(){var e=Mg.getGameData();return null!=e&&e.items&&e?e.items[Es.STORM]:0},e}return Pe(i,[{key:"itemType",get:function(){return Es.STORM}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,ze(_e(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=ze(_e(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=ze(_e(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){ze(_e(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>2}catch(e){return!1}}},{key:"activate",value:(t=Ae(Se().mark((function e(){var t,n,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,ze(_e(i.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,ze(_e(i.prototype),"activate",this).call(this);case 6:return Ng.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Es.STORM}),this.node.scene.emit(tr.USE_ITEM,Es.STORM),this.node.scene.emit(tr.HIDE_UI),t=new Promise((function(e){return a.scheduleOnce(e,.5)})),e.next=12,Promise.race([this.effectManager.loadTornadoAnimation(),t]);case 12:n=function(){var e=Ae(Se().mark((function e(t,n){var i,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return wi.muteMusic(!0),wi.playSound(ti.SHUFFLE_ITEM),wi.playSound(ti.WIND),i=function(){return Promise.all(t.map((function(e,n,i){return e.sync({duration:.4,easing:"smooth",getTargetPosition:function(){return ec(t,a.boardInstance.getTileSize(),{x:n,y:i},10)}})})))},r=function(){var e=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.forEach((function(e,t,i){e.node.setSiblingIndex(n.asArray().length-1-(t+i*n.width))})),e.next=3,Promise.all(n.map((function(e){return e.fly({getTilePosition:function(e){return ec(n,a.boardInstance.getTileSize(),e)}})})));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=7,i();case 7:return a.effectManager.playTornadoAnimation(),e.next=10,r();case 10:a.node.scene.emit(tr.SHOW_UI),wi.muteMusic(!1);case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.boardInstance.processShuffleRequest(n);case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;ze(_e(i.prototype),"saveQuantity",this).call(this,e,t);var n=Mg.getGameData();n&&Mg.setGameData({items:ke(ke({},n.items),{},{[Es.STORM]:e})})}}]),i}(iv));n._RF.pop(),n._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);var Fg,Bg=i.ccclass,Gg=globalThis.game,zg=Gg.player,Ug=Gg.analytics;Bg("ThunderItem")(Lg=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return(e=n.call.apply(n,[this].concat(a))).requestItem=function(){nu.openScreen(si,{item:Es.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},e.loadQuantity=function(){var e=zg.getGameData();return null!=e&&e.items&&e?e.items[Es.THUNDER]:0},e}return Pe(i,[{key:"itemType",get:function(){return Es.THUNDER}},{key:"init",value:function(e){this.boardInstance=e.board,this.effectManager=e.effectManager,ze(_e(i.prototype),"init",this).call(this,e)}},{key:"onDestroy",value:function(){var e;if(this.boardInstance){this.node.scene.targetOff(this);var t,n=this.boardInstance.node;if(null!=n)this.boardInstance.node.targetOff(this),null===(e=ze(_e(i.prototype),"onDestroy",this))||void 0===e||e.call(this);else null===(t=ze(_e(i.prototype),"onDestroy",this))||void 0===t||t.call(this)}}},{key:"validateRequiredComponents",value:function(){ze(_e(i.prototype),"validateRequiredComponents",this).call(this),St.lazyValidateProperties(this)}},{key:"canActivate",value:function(){try{return this.boardInstance.getUncleared().length>=4}catch(e){return!1}}},{key:"activate",value:(t=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.getQuantity()<=0)){e.next=4;break}return e.next=3,ze(_e(i.prototype),"activate",this).call(this);case 3:return e.abrupt("return");case 4:return e.next=6,ze(_e(i.prototype),"activate",this).call(this);case 6:return Ug.event(GameCore.Plugins.Analytics.Events.USE_ITEM,{item_name:Es.THUNDER}),this.node.scene.emit(tr.USE_ITEM,Es.THUNDER),this.node.scene.emit(tr.HIDE_UI),e.next=11,this.effectManager.loadThunderAnimation();case 11:if(wi.muteMusic(!0),!((t=this.boardInstance.getUncleared()).length<4)){e.next=15;break}throw new Error("Not enough uncleared tiles");case 15:return n=this.boardInstance.getPairs(2),Jn.setBlockInput(!0),this.boardInstance.clearSelectedTile(),e.next=20,this.effectManager.playThunderAnimation(n,this.boardInstance);case 20:t.length>4&&this.node.scene.emit(tr.SHOW_UI),wi.muteMusic(!1),Jn.setBlockInput(!1);case 23:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"saveQuantity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;ze(_e(i.prototype),"saveQuantity",this).call(this,e,t);var n=zg.getGameData();n&&zg.setGameData({items:ke(ke({},n.items),{},{[Es.THUNDER]:e})})}}]),i}(iv));n._RF.pop(),n._RF.push({},"0a97aK0agJOHb07cLs0JICj","PathHolder",void 0);var Hg,qg,Vg,Wg,Kg,jg,Yg,Xg,$g,Jg,Qg,Zg,eb,tb=i.ccclass,nb=i.requireComponent;tb("PathHolder")(Fg=nb(M)(Fg=function(e){Ie(n,e);var t=Be(n);function n(){return Te(this,n),t.apply(this,arguments)}return Pe(n,[{key:"onLoad",value:function(){var e=this;this.node.scene.on(tr.GRID_CREATE,(function(t){e.node.scale=t.node.scale}))}}]),n}(f))||Fg);n._RF.pop(),n._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);var ib,ab,rb,ob,sb,lb,ub,cb=i.ccclass,hb=i.property,pb=(Hg=cb("Coin"),qg=hb(ae),Vg=hb(ae),Wg=hb(y),Kg=hb(_),jg=hb(_),Hg(($g=$e((Xg=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"explodeParticles",$g,Ne(e)),Xe(e,"emittingParticles",Jg,Ne(e)),Xe(e,"animation",Qg,Ne(e)),Xe(e,"spin",Zg,Ne(e)),Xe(e,"rest",eb,Ne(e)),e}return Pe(n,[{key:"__preload",value:function(){St.lazyValidateProperties(this)}},{key:"playAnimation",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1?arguments[1]:void 0;t>0&&this.scheduleOnce((function(){null!=n&&n.aborted||e.animation.play(e.spin.name)}),t),this.animation.play(this.spin.name)}},{key:"stopAnimation",value:function(){this.animation.play(this.rest.name)}}]),n}(f)).prototype,"explodeParticles",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jg=$e(Xg.prototype,"emittingParticles",[Vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qg=$e(Xg.prototype,"animation",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zg=$e(Xg.prototype,"spin",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eb=$e(Xg.prototype,"rest",[jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yg=Xg))||Yg);n._RF.pop(),n._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);var db,fb,vb,yb,mb,gb,bb,wb,kb,Sb=i.ccclass,Cb=i.property,Eb=j.ZERO.clone().add3f(0,-100,0),Ab=j.ZERO.clone().add3f(0,100,0),Tb=(ib=Sb("CoinTextPopup"),ab=Cb(u),rb=Cb(M),ib((lb=$e((sb=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"label",lb,Ne(e)),Xe(e,"uiOpacity",ub,Ne(e)),e}return Pe(i,[{key:"__preload",value:function(){St.lazyValidateProperties(this),this.node.active=!1}},{key:"show",value:(t=Ae(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=GameCore.Utils.Number.getShortNumber(t,3),this.label.string=i,this.node.active=!0,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(Eb),e.next=8,Promise.all([yn.runTweenAsync(S(this.node).to(1.5,{position:Ab},{easing:"sineOut"}),n),yn.runTweenAsync(S(this.node).to(.5,{scale:j.ONE},{easing:"backOut"}),n)]);case 8:return this.node.setScale(j.ONE),this.node.setPosition(Ab),
//! not subscribed to signal because in the case the user skipped the animation we'd still want them to see this node disappear
e.next=12,yn.runTweenAsync(S(this.uiOpacity).to(.5,{opacity:0}));case 12:this.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),i}(f)).prototype,"label",[ab],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ub=$e(sb.prototype,"uiOpacity",[rb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ob=sb))||ob);n._RF.pop(),n._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);var xb=i.ccclass,Pb=i.disallowMultiple,Rb=i.property,Ib=globalThis.game,_b=Ib.player,Lb=Ib.monitorError,Ob=999999999,Db=10,Mb=1,Nb=1,Fb=(db=xb("CoinManager"),fb=Rb(R),vb=Rb(R),yb=Rb(a),db(mb=Pb((bb=$e((gb=function(e){Ie(s,e);var t,n,i,a,r,o=Be(s);function s(){var e;Te(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=o.call.apply(o,[this].concat(n))).coins=0,Xe(e,"coinPrefab",bb,Ne(e)),Xe(e,"coinTextPopup",wb,Ne(e)),Xe(e,"coinAnimContainer",kb,Ne(e)),e.collectionAnimSignal=null,e.coinObjects=[],e}return Pe(s,[{key:"__preload",value:function(){this.lifeCycleSignal=new ha,this.validateRequiredComponents(),this.getCoinsFromPlayerData()}},{key:"onLoad",value:function(){this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}},{key:"start",value:function(){this.emitCoinAmount()}},{key:"init",value:function(e){this.updateCoins({coins:this.coins,collectionAnimation:void 0}),this.animSkipOverlay=e}},{key:"listenToCoinEvents",value:function(){this.node.scene.on(tr.ADD_COINS,this.addCoins,this),this.node.scene.on(tr.REMOVE_COINS,this.removeCoins,this)}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"prepareCoinCollection",value:function(){for(var e=0;e<Db;e++){var t=l(this.coinPrefab);t.setParent(this.coinAnimContainer),t.setPosition(0,0),t.active=!1,this.coinObjects.push(t.getComponent(pb))}}},{key:"prepareCoinTextPopup",value:function(){var e=l(this.coinTextPopup);e.setParent(this.node),e.active=!1,this.coinTextPopupNode=e.getComponent(Tb)}},{key:"handleCollectionAnim",value:(r=Ae(Se().mark((function e(t,n,i){var a,r,o,s,l,u=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.targetContainer){e.next=3;break}return console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played"),e.abrupt("return");case 3:if(0!==(o=this.coinObjects.slice(0,this.getShortAmount(t))).length){e.next=8;break}return console.warn(`Requested coins amount is ${t}. Shortened to ${this.getShortAmount(t)}. No coin objects was found to animate collection.`),null==Lb||Lb.sendException(new Error(`Requested coins amount is ${t}. Shortened to ${this.getShortAmount(t)}. No coin objects was found to animate collection.`),{coins:t,animatedCoins:o.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!this.targetContainer,coinCollectionCount:this.coinObjects.length}),e.abrupt("return");case 8:return e.next=10,null===(a=this.animSkipOverlay)||void 0===a?void 0:a.open({onSkip:function(){return u.collectionAnimSignal.abort()},opacity:150});case 10:return wi.playSound(ti.COLLECT_STOCK_COINS),s=o.map(function(){var e=Ae(Se().mark((function e(t){var a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.explodeParticles.stopSystem(),t.emittingParticles.stopSystem(),t.node.active=!0,a=[0,.5*Math.min(n,i)],r=ne.apply(void 0,a),o=n-r,s=i+r,e.next=9,u.animateCoinExplode(t.node,o);case 9:return t.playAnimation(2*r,u.collectionAnimSignal),t.emittingParticles.resetSystem(),e.next=13,u.animateCoinFlyBack(u.collectionAnimSignal,t,s);case 13:t.emittingParticles.stopSystem(),t.stopAnimation();case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),l=function(){var e=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(s);case 2:return e.next=4,null===(t=u.targetContainer)||void 0===t?void 0:t.emitExplodeEffect(u.collectionAnimSignal);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=15,Promise.all([l(),this.animateCoinTextPopup(t,this.collectionAnimSignal,n+i/2)]);case 15:return e.next=17,null===(r=this.animSkipOverlay)||void 0===r?void 0:r.close();case 17:this.collectionAnimSignal.abort();case 18:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"animateCoinTextPopup",value:(a=Ae(Se().mark((function e(t,n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.waitTweenAsync(i,n);case 2:return e.next=4,this.coinTextPopupNode.show(t,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"animateCoinFlyBack",value:(i=Ae(Se().mark((function e(t,n,i){var a,r,o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.node.worldPosition.clone(),r=j.ZERO.clone(),o=this.targetContainer.getCoinIconWorldScale(),e.next=5,yn.runTweenAsync(S(n.node).to(i,{scale:o},{onUpdate:function(e,t){if(void 0!==t){var i=D.cubicIn(t),o=s.targetContainer.getCoinIconWorldPosition();n.node.worldPosition=j.lerp(r,a,o,i)}}}),t);case 5:n.node.scale=j.ZERO,this.explodeParticlesAndDisableAfter(1,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"explodeParticlesAndDisableAfter",value:(n=Ae(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=n.explodeParticles).resetSystem(),e.next=4,yn.waitTweenAsync(t/10,this.lifeCycleSignal);case 4:if(!ha.hasBeenAborted(this.lifeCycleSignal)){e.next=6;break}return e.abrupt("return");case 6:return i.stopSystem(),e.next=9,yn.waitTweenAsync(t/10*9,this.lifeCycleSignal);case 9:if(!ha.hasBeenAborted(this.lifeCycleSignal)){e.next=11;break}return e.abrupt("return");case 11:n.node.setPosition(0,0,n.node.position.z),n.node.active=!1;case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"animateCoinExplode",value:(t=Ae(Se().mark((function e(t,n){var i,a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=[-200,200],r=ne((i=[-200,200])[0],i[1]),o=ne(a[0],a[1]),t.setPosition(0,0,t.position.z),t.setScale(j.ZERO),s=new j(r,o,t.position.z),e.next=9,Promise.all([yn.runTweenAsync(S(t).delay(.1*n).to(.8*n,{scale:j.ONE},{easing:"elasticOut"}),this.collectionAnimSignal),yn.runTweenAsync(S(t).to(n,{position:s},{easing:"circOut"}),this.collectionAnimSignal)]);case 9:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"getCoinsFromPlayerData",value:function(){var e=_b.getGameData();this.coins=e?e.coins:0}},{key:"getCoins",value:function(){return this.coins}},{key:"updateCoins",value:function(e){var t,n;if(console.info("updateCoins",e.coins,null===(t=e.collectionAnimation)||void 0===t?void 0:t.animateTextOnly),this.coins>Ob&&(this.coins=Ob),e.coins!==this.coins){var i=Math.max(0,e.coins-this.coins);this.coins=e.coins,_b.setGameData({coins:this.coins});var a=e.collectionAnimation;if(void 0===a||a.animateTextOnly)this.node.scene.emit(tr.COIN_CHANGED,ke(ke({},e),{},{collectionAnimation:{animateTextOnly:!0,signal:this.collectionAnimSignal}}));else{null===(n=this.collectionAnimSignal)||void 0===n||n.abort();var r=a.floatDuration,o=void 0===r?Mb:r,s=a.flyDuration,l=void 0===s?Nb:s,u=a.signal,c=void 0===u?new ha:u,h=a.target,p=void 0===h?this.targetContainer:h;this.collectionAnimSignal=c,this.targetContainer=p;var d=ke(ke({},e),{},{collectionAnimation:{floatDuration:o,flyDuration:l,animateTextOnly:!1,signal:c,target:p}});this.node.scene.emit(tr.COIN_CHANGED,d),this.handleCollectionAnim(i,o,l)}}}},{key:"addCoins",value:function(e){this.updateCoins(ke(ke({},e),{},{coins:this.coins+e.coins}))}},{key:"removeCoins",value:function(e){this.coins<e.coins?this.node.scene.emit(tr.REMOVE_COINS_FAILED):(this.updateCoins(ke(ke({},e),{},{coins:this.coins-e.coins})),this.node.scene.emit(tr.REMOVE_COINS_SUCCESS))}},{key:"emitCoinAmount",value:function(){this.node.scene.emit(tr.COIN_CHANGED,{coins:this.coins})}},{key:"getShortAmount",value:function(e){return Math.min(e,Db)}},{key:"untilFinishesCollectAnim",value:function(){return null===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}},{key:"setTargetContainer",value:function(e){this.targetContainer=e}},{key:"getTargetContainer",value:function(){return this.targetContainer}},{key:"onDestroy",value:function(){var e,t;null===(e=this.collectionAnimSignal)||void 0===e||e.abort(),null===(t=this.lifeCycleSignal)||void 0===t||t.abort()}}]),s}(f)).prototype,"coinPrefab",[fb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wb=$e(gb.prototype,"coinTextPopup",[vb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kb=$e(gb.prototype,"coinAnimContainer",[yb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mb=gb))||mb)||mb);n._RF.pop(),n._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),n._RF.pop(),n._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),n._RF.pop(),n._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),n._RF.pop(),n._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),n._RF.pop(),n._RF.push({},"f3b1eQ+t3FJYa35I0oznLiF","ParticleProperties",void 0);var Bb,Gb,zb,Ub,Hb,qb=Pe((function e(){Te(this,e),this.lifeCurrent=0,this.life=0,this.velocityX=0,this.velocityY=0,this.alpha=255,this.totalRotation=0,this.lastChange=0,this.currentFrame=0}));n._RF.pop(),n._RF.push({},"32b8eGxcghFHZOi1WYXHCjF","BaseParticle",void 0);var Vb,Wb,Kb,jb,Yb,Xb,$b,Jb=i.ccclass,Qb=i.property,Zb=(Bb=Jb("BaseParticle"),Gb=Qb(T),Bb((Hb=$e((Ub=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"sprite",Hb,Ne(e)),e.properties=new qb,e}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.sprite)throw new Error("BaseParticle: Sprite not found")}},{key:"manualInit",value:function(e,t){this.manager=e;var n=t.tint,i=t.velocityX,a=t.velocityY,o=t.totalRotation,s=t.lifespan,l=t.startAngle,u=t.scale;this.properties.lastChange=0;var c=new r;r.fromHEX(c,n),this.sprite.color=c,this.properties.velocityX=i,this.properties.velocityY=a,this.properties.life=s,this.properties.lifeCurrent=s,this.properties.totalRotation=o,this.node.angle=l,this.node.setScale(u,u,1)}},{key:"manualUpdate",value:function(e){return this.computeVelocity(e),this.node.setPosition(this.node.position.x+this.properties.velocityX*e,this.node.position.y+this.properties.velocityY*e,0),this.node.angle+=this.properties.totalRotation*e/this.properties.life,this.properties.lifeCurrent-=e,this.properties.lifeCurrent<=0}},{key:"computeVelocity",value:function(e){var t=this.properties,n=t.velocityX,i=t.velocityY;i+=this.manager.getGravityY()*e,this.properties.velocityX=n,this.properties.velocityY=i}}]),n}(f)).prototype,"sprite",[Gb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zb=Ub))||zb);n._RF.pop(),n._RF.push({},"b6123+a2K1LoY60oZO9SYKX","StarConfetti",void 0);var ew=i.ccclass,tw=i.property,nw=(Vb=ew("StarConfetti"),Wb=tw([O]),Kb=tw([O]),Vb((Xb=$e((Yb=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"starXFrames",Xb,Ne(e)),Xe(e,"starYFrames",$b,Ne(e)),e.msPerFrame=.15,e.isYoyo=!1,e.isGravityChanged=!1,e}return Pe(n,[{key:"manualInit",value:function(e,t){ze(_e(n.prototype),"manualInit",this).call(this,e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}},{key:"manualUpdate",value:function(e){var t=ze(_e(n.prototype),"manualUpdate",this).call(this,e);return this.updateGravity(),this.updateVelocity(),this.updateFrameRate(),this.updateFrames(e),t}},{key:"updateGravity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0;this.properties.velocityX/=3,this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2)){this.properties.velocityX>0?this.properties.velocityX+=G.randomRangeInt(-12,6):this.properties.velocityX+=G.randomRangeInt(-6,12)}}},{key:"updateFrames",value:function(e){if(this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame){this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=4&&(this.isYoyo=!0,this.properties.currentFrame-=1);var t=Math.random()>.5?this.starXFrames:this.starYFrames;this.sprite.spriteFrame=t[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame}}},{key:"updateFrameRate",value:function(){this.properties.lifeCurrent<this.properties.life-2?this.msPerFrame=.15:this.msPerFrame=G.randomRangeInt(300,600)/1e3}}]),n}(Zb)).prototype,"starXFrames",[Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$b=$e(Yb.prototype,"starYFrames",[Kb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jb=Yb))||jb);n._RF.pop(),n._RF.push({},"9caadUsaKtPEoOe+T2+pqtd","Properties",void 0);var iw,aw=Pe((function e(){Te(this,e),this.delay=200,this.timeScale=2,this.tints=["#F1D171","#97E1FD","#7765D1","#ED4440","#F9E02A"],this.speedX={min:1583/75,max:1583*.24},this.speedY={min:1139.76,max:1219.76},this.gravityY=-664.86,this.lifespan={min:5,max:8},this.rotate={totalRotation:1080,random:!0},this.scale={min:.6,max:1},this.originGravityY=-664.86}));n._RF.pop(),n._RF.push({},"d1648PsavVBn7B059PS5fj6","BaseEmitter",void 0);var rw,ow=(0,i.ccclass)("BaseEmitter")(iw=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).properties=new aw,e}return Pe(n,[{key:"getGravityY",value:function(){return this.properties.gravityY}},{key:"setGravityY",value:function(e){this.properties.gravityY=e}}]),n}(f))||iw;n._RF.pop(),n._RF.push({},"654983p4rREVKci1CE8cSJ2","ConfettiEmitter",void 0);var sw,lw,uw,cw,hw,pw,dw,fw,vw,yw,mw,gw=(0,i.ccclass)("ConfettiEmitter")(rw=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=i.call.apply(i,[this].concat(n))).activeStarConfetti=[],e}return Pe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(n=Ae(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn.loadPrefabAsync("particles/StarConfetti");case 2:this.starConfettiPrefab=e.sent,this.starConfettiPool=new gh((function(){var e=l(t.starConfettiPrefab);return t.node.addChild(e),e.active=!1,e}),0,(function(e){var n=e.getComponent(nw);n?(t.activeStarConfetti.push(n),e.active=!0):console.error("StarConfetti not found")}),(function(e){e.getComponent(nw)?e.active=!1:console.error("StarConfetti not found")}),(function(e){e.isValid&&e.destroy()})),this.properties.timeScale=1.5,this.properties.gravityY=688.605,this.properties.lifespan.min=4,this.properties.lifespan.max=6,this.properties.rotate.totalRotation=1800;case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"runEffect",value:(t=Ae(Se().mark((function e(t,n,i){var a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.starConfettiPool){e.next=3;break}return e.next=3,this.createConfettiPool();case 3:this.properties.gravityY=this.properties.originGravityY,a=0;case 5:if(!(a<t)){e.next=31;break}if(r=this.starConfettiPool.alloc(),o=r.getComponent(nw)){e.next=11;break}return console.error("StarConfetti not found"),e.abrupt("return");case 11:if(r.setPosition(n.clone()),s=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],l=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),u=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,c=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,h=this.properties.rotate.random?180*Math.random():0,p=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,d={tint:s,velocityX:l,velocityY:u,lifespan:c,totalRotation:this.properties.rotate.totalRotation,startAngle:h,scale:p},o.manualInit(this,d),f=this.starConfettiPool.alloc(),v=f.getComponent(nw)){e.next=25;break}return console.error("StarConfetti not found"),e.abrupt("return");case 25:f.setPosition(i.clone()),d.velocityX=-l,v.manualInit(this,d);case 28:a++,e.next=5;break;case 31:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"clearEffect",value:function(){var e,t=je(this.activeStarConfetti);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.starConfettiPool.free(n.node)}}catch(e){t.e(e)}finally{t.f()}this.activeStarConfetti=[]}},{key:"update",value:function(e){var t=this,n=e*this.properties.timeScale,i=[];this.activeStarConfetti.forEach((function(e){e.manualUpdate(n)&&i.push(e)})),i.forEach((function(e){t.starConfettiPool.free(e.node),t.activeStarConfetti.splice(t.activeStarConfetti.indexOf(e),1)}))}}]),a}(ow))||rw;n._RF.pop(),n._RF.push({},"78c97IkjeJFQohPZudvcfeS","Ribbon",void 0);var bw,ww,kw,Sw,Cw,Ew=i.ccclass,Aw=i.property,Tw=(sw=Ew("Ribbon"),lw=Aw([O]),uw=Aw([O]),cw=Aw([O]),hw=Aw([O]),sw((fw=$e((dw=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"ribbonA",fw,Ne(e)),Xe(e,"ribbonB",vw,Ne(e)),Xe(e,"ribbonC",yw,Ne(e)),Xe(e,"ribbonD",mw,Ne(e)),e.useFrames=[],e.msPerFrame=.15,e.isYoyo=!1,e.isGravityChanged=!1,e.points=[],e}return Pe(n,[{key:"manualInit",value:function(e,t){ze(_e(n.prototype),"manualInit",this).call(this,e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=new Array(10).fill(null).map((function(){return{x:0,y:0}}));var i=Math.random();this.useFrames=i<.25?this.ribbonA:i<.5?this.ribbonB:i<.75?this.ribbonC:this.ribbonD,this.sprite.enabled=!1}},{key:"manualUpdate",value:function(e){var t=ze(_e(n.prototype),"manualUpdate",this).call(this,e);return this.updateFrames(e),this.updatePoints(),this.updateGravity(),this.updateVelocity(),t}},{key:"updateFrames",value:function(e){this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame&&(this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=this.useFrames.length&&(this.isYoyo=!0,this.properties.currentFrame-=1),this.sprite.spriteFrame=this.useFrames[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame)}},{key:"updatePoints",value:function(){if(!this.isGravityChanged){this.points.shift();var e=this.node.worldPosition,t=e.x,n=e.y;this.points.push({x:t,y:n})}}},{key:"updateGravity",value:function(){if(!(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)){this.isGravityChanged=!0,this.points=[],this.sprite.enabled=!0,this.properties.velocityX/=3;this.manager.setGravityY(-23745/667)}}},{key:"updateVelocity",value:function(){if(!this.isGravityChanged){this.properties.lifeCurrent>this.properties.life-1.8?this.properties.velocityX+=G.randomRangeInt(-24,24):this.properties.velocityX>0?this.properties.velocityX+=G.randomRangeInt(-20,12):this.properties.velocityX+=G.randomRangeInt(-12,20)}}},{key:"getGlobalPoints",value:function(){return this.points}},{key:"getColor",value:function(){return this.sprite.color}}]),n}(Zb)).prototype,"ribbonA",[lw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vw=$e(dw.prototype,"ribbonB",[uw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),yw=$e(dw.prototype,"ribbonC",[cw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mw=$e(dw.prototype,"ribbonD",[hw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pw=dw))||pw);n._RF.pop(),n._RF.push({},"f2427J2HhBKdpkcqDn2Vv5H","RibbonEmitter",void 0);var xw,Pw,Rw,Iw,_w,Lw,Ow,Dw=i.ccclass,Mw=i.property,Nw=(bw=Dw("RibbonEmitter"),ww=Mw(V),bw((Cw=$e((Sw=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"graphics",Cw,Ne(e)),e.activeRibbonConfetti=[],e}return Pe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"createConfettiPool",value:(n=Ae(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn.loadPrefabAsync("particles/Ribbon");case 2:this.ribbonPrefab=e.sent,this.ribbonConfettiPool=new gh((function(){var e=l(t.ribbonPrefab);return t.node.addChild(e),e.active=!1,e}),0,(function(e){var n=e.getComponent(Tw);n?(t.activeRibbonConfetti.push(n),e.active=!0):console.error("StarConfetti not found")}),(function(e){e.getComponent(Tw)?e.active=!1:console.error("StarConfetti not found")}),(function(e){e.destroy()}));case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"runEffect",value:(t=Ae(Se().mark((function e(t,n,i){var a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ribbonConfettiPool){e.next=3;break}return e.next=3,this.createConfettiPool();case 3:this.properties.gravityY=this.properties.originGravityY,a=0;case 5:if(!(a<t)){e.next=31;break}if(r=this.ribbonConfettiPool.alloc(),o=r.getComponent(Tw)){e.next=11;break}return console.error("StarConfetti not found"),e.abrupt("return");case 11:if(r.setPosition(n.clone()),s=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],l=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),u=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,c=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,h=this.properties.rotate.random?180*Math.random():0,p=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,d={tint:s,velocityX:l,velocityY:u,lifespan:c,totalRotation:this.properties.rotate.totalRotation,startAngle:h,scale:p},o.manualInit(this,d),f=this.ribbonConfettiPool.alloc(),v=f.getComponent(Tw)){e.next=25;break}return console.error("StarConfetti not found"),e.abrupt("return");case 25:f.setPosition(i.clone()),d.velocityX=-l,v.manualInit(this,d);case 28:a++,e.next=5;break;case 31:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"clearEffect",value:function(){var e,t=je(this.activeRibbonConfetti);try{for(t.s();!(e=t.n()).done;){var n=e.value;this.ribbonConfettiPool.free(n.node)}}catch(e){t.e(e)}finally{t.f()}this.activeRibbonConfetti=[]}},{key:"update",value:function(e){var t=this,n=e*this.properties.timeScale;this.graphics.clear();var i=[];this.activeRibbonConfetti.forEach((function(e){e.manualUpdate(n)&&i.push(e),t.drawGraphics(e.getGlobalPoints(),e.getColor())})),i.forEach((function(e){t.ribbonConfettiPool.free(e.node),t.activeRibbonConfetti.splice(t.activeRibbonConfetti.indexOf(e),1)}))}},{key:"drawGraphics",value:function(e,t){if(this.graphics.node.active){var n,i=je(e);try{for(i.s();!(n=i.n()).done;){if(0===n.value.y)return}}catch(e){i.e(e)}finally{i.f()}if(!(e.length<2)){this.graphics.strokeColor=t;var a=new j(e[0].x,e[0].y,0);a=this.node.inverseTransformPoint(a,a),this.graphics.moveTo(a.x,a.y);for(var r=1;r<e.length;r++)a.x=e[r].x,a.y=e[r].y,a=this.node.inverseTransformPoint(a,a),this.graphics.lineTo(a.x,a.y);this.graphics.stroke()}}}}]),a}(ow)).prototype,"graphics",[ww],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kw=Sw))||kw);n._RF.pop(),n._RF.push({},"f7cfcFAL8tBE70g2A0+qMTR","PaperConfetti",void 0);var Fw,Bw=i.ccclass,Gw=i.property,zw=(xw=Bw("PaperConfetti"),Pw=Gw(gw),Rw=Gw(Nw),xw((Lw=$e((_w=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).spawnLeftPos=new j(-375,-791.5,0),e.spawnRightPos=new j(375,-791.5,0),Xe(e,"confettiEmitter",Lw,Ne(e)),Xe(e,"ribbonEmitter",Ow,Ne(e)),e}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.confettiEmitter)throw new Error("PaperConfetti: ConfettiEmitter not found");if(!this.ribbonEmitter)throw new Error("PaperConfetti: RibbonEmitter not found")}},{key:"runEffect",value:function(){var e=this;this.scheduleOnce((function(){e.confettiEmitter.runEffect(25,e.spawnLeftPos,e.spawnRightPos)}),.2),this.ribbonEmitter.runEffect(20,this.spawnLeftPos,this.spawnRightPos)}},{key:"clearEffect",value:function(){this.unscheduleAllCallbacks(),this.confettiEmitter.clearEffect(),this.ribbonEmitter.clearEffect()}}]),n}(f)).prototype,"confettiEmitter",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ow=$e(_w.prototype,"ribbonEmitter",[Rw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iw=_w))||Iw);n._RF.pop(),n._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);var Uw,Hw,qw,Vw,Ww,Kw,jw,Yw,Xw,$w,Jw,Qw=i.ccclass,Zw=i.disallowMultiple,ek=GameCore,tk=ek.Events,nk=ek.Configs,ik=ek.Utils,ak=ik.Time,rk=ik.Valid,ok=globalThis.game,sk=ok.ads,lk=ok.player,uk=ok.event;Qw("BootScene")(Fw=Zw(Fw=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=i.call.apply(i,[this].concat(n))).processWhenGameSdkStarted=function(){e.setupGameData()},e.handlePauseAudio=function(){uk.on(tk.VISIBILITY_HIDDEN,e.handleMuteAudio),uk.on(tk.VISIBILITY_VISIBLE,e.handleUnMuteAudio),uk.on(tk.VISIBILITY_VISIBLE,e.handleForceEngineRunning)},e.handleMuteAudio=function(){wi.muteAudio(!0)},e.handleUnMuteAudio=function(){sk.isAdFullSizeShowing()||wi.muteAudio(!1)},e.handleForceEngineRunning=function(){d.resume()},e}return Pe(a,[{key:"__preload",value:function(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.validateRequiredComponents(),this.listenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"onLoad",value:function(){this.handlePauseAudio(),nk.Core.StartSDKAfterLoadGame||nu.showLoadingFullScreen(Xs)}},{key:"start",value:function(){this.processCrazyGamesLoadingStop(),this.loadCurrentPlayerTheme().catch((function(e){return console.error("loadCurrentPlayerTheme",e)})),this.handleShowAdWhenLoadGame().catch((function(e){console.error("handleShowAdWhenLoadGame",e)}))}},{key:"listenEvents",value:function(){uk.once(tk.GAME_SDK_STARTED,this.processWhenGameSdkStarted)}},{key:"setupGameData",value:function(){var e=lk.getGameData();if(e){var t=e.totalLevel,n=ke(ke({},e),{},{totalLevel:0===t?80:t});lk.setGameData(n)}}},{key:"loadCurrentPlayerTheme",value:function(){var e=pl.mapOrder,t=e[0],n=lk.getGameData();console.log("loadCurrentPlayerTheme",n);var i=null==n?void 0:n.level;if(!rk.isNumber(i))return Jn.loadThemeAsync(t.theme);var a,r=je(e);try{for(r.s();!(a=r.n()).done;){var o=a.value;if((i-=o.levelCount)<=0){t=o;break}}}catch(e){r.e(e)}finally{r.f()}return Jn.loadThemeAsync(t.theme)}},{key:"handleShowAdWhenLoadGame",value:(n=Ae(Se().mark((function e(){var t,n,i,a,r,o,s;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=nk.Ads,n=t.Enabled,i=t.ShowAdOnLoad,n){e.next=3;break}return e.abrupt("return");case 3:if(a=i.Enabled,r=i.DelaySeconds,o=i.PlacementId,a){e.next=6;break}return e.abrupt("return");case 6:if(e.prev=6,!(r>0)){e.next=10;break}return e.next=10,ak.sleepAsync(1e3*r);case 10:if(s=sk.getAdByPlacementId(o)){e.next=13;break}return e.abrupt("return");case 13:return e.next=15,this.showAdWhenLoadGame(s);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(6),console.warn("handleShowAdWhenLoadGame failed",e.t0);case 20:return e.prev=20,yv.preloadAds(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[6,17,20,23]])}))),function(){return n.apply(this,arguments)})},{key:"showAdWhenLoadGame",value:(t=Ae(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=t.type,i=t.placementId,e.next=4,sk.loadAdAsync(n,i);case 4:return wi.muteAudio(!0),e.next=7,sk.showAdAsync(n,i);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.warn("showAdWhenLoadGame failed",e.t0);case 12:return e.prev=12,wi.muteAudio(!1),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,9,12,15]])}))),function(e){return t.apply(this,arguments)})},{key:"processCrazyGamesLoadingStart",value:function(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}},{key:"processCrazyGamesLoadingStop",value:function(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}},{key:"setupAndroidPlatformAds",value:function(){}}]),a}(f))||Fw);n._RF.pop(),n._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);var ck,hk,pk,dk,fk,vk,yk,mk,gk,bk=i.ccclass,wk=i.property,kk=(Uw=bk("RigidBodyObject"),Hw=wk(C),qw=wk($),Vw=wk(C),Ww=wk(H),Uw((Yw=$e((jw=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"gravityScale",Yw,Ne(e)),Xe(e,"linearVelocity",Xw,Ne(e)),Xe(e,"bounce",$w,Ne(e)),Xe(e,"simulate",Jw,Ne(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(o).getComponent(s),this.uiTransform=this.node.getComponent(s)}},{key:"update",value:function(e){if(this.simulate){this.applyGravity();var t=this.node.worldPosition.clone();t.add(new j(this.linearVelocity.x*e,this.linearVelocity.y*e,0)),t=this.applyBounce(t),this.node.setWorldPosition(t)}}},{key:"applyForce",value:function(e){this.linearVelocity.add(e)}},{key:"applyGravity",value:function(){var e=new $(0,-9.8*this.gravityScale);this.applyForce(e)}},{key:"applyBounce",value:function(e){var t=this.uiTransform.getBoundingBoxToWorld();t.yMin<0&&(e.y=t.height/2,this.linearVelocity.y*=-this.bounce),t.xMin<0&&(e.x=t.width/2,this.linearVelocity.x*=-1);var n=this.canvas.width;return t.xMax>n&&(e.x=n-t.width/2,this.linearVelocity.x*=-1),e}}]),n}(f)).prototype,"gravityScale",[Hw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Xw=$e(jw.prototype,"linearVelocity",[qw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new $(0,0)}}),$w=$e(jw.prototype,"bounce",[Vw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jw=$e(jw.prototype,"simulate",[Ww],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kw=jw))||Kw);n._RF.pop(),n._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);var Sk,Ck,Ek,Ak,Tk,xk,Pk,Rk,Ik,_k=i.ccclass,Lk=i.property,Ok=i.disallowMultiple,Dk=function(){},Mk=(ck=_k("AnimSkipOverlay"),hk=Lk(M),pk=Lk(M),dk=Lk(p),ck(fk=Ok((yk=$e((vk=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"containerUIOpacity",yk,Ne(e)),Xe(e,"maskUIOpacity",mk,Ne(e)),Xe(e,"skipButton",gk,Ne(e)),e.isOpened=!1,e.currentCallback=Dk,e}return Pe(a,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}},{key:"onSkipButtonPress",value:function(){this.currentCallback(),this.close()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"open",value:(n=Ae(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.containerUIOpacity.node.active=!0,n=t.onSkip,i=t.opacity,a=void 0===i?255:i,r=t.transitionDuration,o=void 0===r?.2:r,this.maskUIOpacity.opacity=a,e.next=5,this.animateUIOpacity(0,255,o);case 5:this.currentCallback=n,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit(Tn,t);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"close",value:(t=Ae(Se().mark((function e(){var t,n=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:.2,this.skipButton.interactable=!1,this.currentCallback=Dk,e.next=5,this.animateUIOpacity(255,0,t);case 5:this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(xn);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateUIOpacity",value:function(e,t,n){return this.containerUIOpacity.opacity=e,yn.runTweenAsync(S(this.containerUIOpacity).to(n,{opacity:t}))}},{key:"untilClosed",value:function(){var e=this;return!1===this.isOpened?Promise.resolve():new Promise((function(t){e.node.scene.once(xn,t)}))}}]),a}(f)).prototype,"containerUIOpacity",[hk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mk=$e(vk.prototype,"maskUIOpacity",[pk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gk=$e(vk.prototype,"skipButton",[dk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fk=vk))||fk)||fk);n._RF.pop(),n._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);var Nk,Fk,Bk,Gk,zk,Uk,Hk,qk,Vk,Wk,Kk,jk,Yk,Xk,$k,Jk,Qk,Zk=i.ccclass,eS=i.property,tS=GameCore.Utils.Number.getShortNumber,nS=(Sk=Zk("CoinContainer"),Ck=eS(u),Ek=eS(T),Ak=eS(M),Sk((Pk=$e((xk=function(e){Ie(r,e);var t,n,i,a=Be(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"coinLabel",Pk,Ne(e)),Xe(e,"coinIcon",Rk,Ne(e)),Xe(e,"explosionCircle",Ik,Ne(e)),e.currentCoin=0,e}return Pe(r,[{key:"setCoinText",value:function(e){this.coinLabel.string=e}},{key:"handleAddCoinButton",value:function(){nu.openScreen(li,{quantity:Is})}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.listenToEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(tr.COIN_CHANGED,this.updateCoins,this)}},{key:"updateCoins",value:(i=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.coins,void 0!==(a=t.collectionAnimation)&&!1!==this.node.activeInHierarchy){e.next=4;break}return this.setCoins(i),e.abrupt("return");case 4:if(r=a.signal,null===(n=this.animAbortSignal)||void 0===n||n.abort(),this.animAbortSignal=null!=r?r:new ha,!a.animateTextOnly){e.next=12;break}return e.next=10,this.animateCoinText(i,0,r);case 10:return this.setCoins(i),e.abrupt("return");case 12:return o=a.flyDuration,s=a.floatDuration,l=s+o,e.next=17,this.animateCoinText(i,l,r);case 17:this.setCoins(i);case 18:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setCoins",value:function(e){this.setCoinText(tS(e,3)),this.currentCoin=e}},{key:"animateCoinText",value:(n=Ae(Se().mark((function e(t,n,i){var a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.currentCoin,e.next=3,yn.waitTweenAsync(n,i);case 3:return wi.playSound(ti.COLLECT_COINS),e.next=6,yn.runTweenAsync(S({}).to(1,{},{easing:"quadOut",onUpdate:function(e,n){if(n){var i=Math.round(a+(t-a)*n);r.setCoinText(tS(i,3))}}}),i);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return n.apply(this,arguments)})},{key:"emitExplodeEffect",value:(t=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0),e.next=4,Promise.all([yn.runTweenAsync(S(this.explosionCircle.node).to(.4,{scale:new j(3,3,3)},{easing:"quadOut"}),t),yn.runTweenAsync(S(this.explosionCircle).delay(.2).to(.2,{opacity:0}),t)]);case 4:this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getCoinIconWorldPosition",value:function(){return this.coinIcon.node.worldPosition}},{key:"getCoinIconWorldScale",value:function(){return this.coinIcon.node.worldScale}},{key:"onDestroy",value:function(){var e;null===(e=this.animAbortSignal)||void 0===e||e.abort()}}]),r}(f)).prototype,"coinLabel",[Ck],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rk=$e(xk.prototype,"coinIcon",[Ek],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ik=$e(xk.prototype,"explosionCircle",[Ak],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tk=xk))||Tk);n._RF.pop(),n._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);var iS,aS,rS,oS,sS,lS,uS,cS,hS,pS,dS,fS,vS,yS,mS,gS,bS,wS,kS,SS,CS,ES=i.ccclass,AS=i.property,TS=globalThis.game.player,xS=[1e3,1500];Nk=ES("ItemContainer"),Fk=AS({type:a,group:"Hint"}),Bk=AS({type:u,group:"Hint"}),Gk=AS({type:a,group:"Thunder"}),zk=AS({type:u,group:"Thunder"}),Uk=AS({type:a,group:"Storm"}),Hk=AS({type:u,group:"Storm"}),qk=AS(R),Nk((Kk=$e((Wk=function(e){Ie(u,e);var t,n,i,a,r,s=Be(u);function u(){var e;Te(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=s.call.apply(s,[this].concat(n)),"hintNode",Kk,Ne(e)),Xe(e,"hintLabel",jk,Ne(e)),e.hintCollection=[],Xe(e,"thunderNode",Yk,Ne(e)),Xe(e,"thunderLabel",Xk,Ne(e)),e.thunderCollection=[],Xe(e,"stormNode",$k,Ne(e)),Xe(e,"stormLabel",Jk,Ne(e)),e.stormCollection=[],Xe(e,"itemPrefab",Qk,Ne(e)),e}return Pe(u,[{key:"onLoad",value:function(){this.canvas=this.node.scene.getComponentInChildren(o).node,this.widget=this.getComponent(E),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(M),this.validateRequiredComponents(),this.listenToEvents()}},{key:"start",value:function(){this.prepareItemCollection()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenToEvents",value:function(){this.node.scene.on(tr.ADD_ITEMS,this.handleAddItems,this)}},{key:"prepareItemCollection",value:function(){for(var e=0;e<9;e++){var t=l(this.itemPrefab),n=l(this.itemPrefab),i=l(this.itemPrefab);t.parent=this.canvas,n.parent=this.canvas,i.parent=this.canvas,t.active=!1,n.active=!1,i.active=!1,this.hintCollection.push(t.getComponent(kk)),this.thunderCollection.push(n.getComponent(kk)),this.stormCollection.push(i.getComponent(kk))}}},{key:"updateStatus",value:function(e){var t=e.items;this.hintLabel.string=`${t.hint}`,this.thunderLabel.string=`${t.thunder}`,this.stormLabel.string=`${t.storm}`}},{key:"show",value:(r=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=255,t=S(this.widget).to(1.5,{right:0},{easing:"quadOut"}),e.next=4,yn.runTweenAsync(t,this.animAbortSignal);case 4:this.widget.right=0;case 5:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"hide",value:(a=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=S(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"}),e.next=3,yn.runTweenAsync(t);case 3:this.uiOpacity.opacity=0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"handleAddItems",value:(i=Ae(Se().mark((function e(t){var n,i,a,r,o=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.animAbortSignal=null!==(n=t.signal)&&void 0!==n?n:new ha,i=TS.getGameData()){e.next=4;break}return e.abrupt("return");case 4:return this.updateStatus(i),a=this.show(),r=t.items.map((function(e){return o.animateItemCollection(e.item,e.quantity,1.5)})),e.next=9,Promise.all([a].concat(Ve(r)));case 9:return i.items=ke(ke({},i.items),{},{hint:i.items.hint+t.items[0].quantity,thunder:i.items.thunder+t.items[1].quantity,storm:i.items.storm+t.items[2].quantity}),TS.setGameData(i),this.updateStatus(i),e.next=14,this.hide();case 14:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"animateItemCollection",value:(n=Ae(Se().mark((function e(t,n,i){var a,r,o=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=this.getItemCollection(t).slice(0,n)).length){e.next=3;break}return e.abrupt("return");case 3:return r=a.map((function(e,n){e.node.active=!0,e.node.position=new j(0,0,e.node.position.z),e.linearVelocity=new $(0,0),e.simulate=!0;var a=ne(Math.PI/3,2*Math.PI/3),r=ne(xS[0],xS[1])*Math.cos(a),s=ne(xS[0],xS[1])*Math.sin(a);e.applyForce(new $(r,s));var l=o.getTargetNode(t);if(l)return e.getComponent(T).spriteFrame=l.getComponent(T).spriteFrame,o.getItemAnimation(e,l,i+.03*n)})),e.next=6,Promise.all(r);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return n.apply(this,arguments)})},{key:"getItemCollection",value:function(e){switch(e){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}},{key:"getTargetNode",value:function(e){switch(e){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}},{key:"getItemAnimation",value:(t=Ae(Se().mark((function e(t,n){var i,a,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.length>2&&void 0!==o[2]?o[2]:0,t.node.scale=new j(2,2,2),e.next=4,yn.waitTweenAsync(i,this.animAbortSignal);case 4:return a=t.node.worldPosition.clone(),r=S(t.node).to(1,{scale:n.scale},{onUpdate:function(e,i){if(e&&i){var r=D.cubicIn(i);n&&(t.node.worldPosition=a.lerp(n.worldPosition,r))}},onComplete:function(){t.node.setPosition(0,0),t.node.active=!1}}),e.next=8,yn.runTweenAsync(r,this.animAbortSignal);case 8:t.node.scale=n.scale.clone(),t.node.setPosition(0,0),t.node.active=!1;case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"onDestroy",value:function(){var e;null===(e=this.animAbortSignal)||void 0===e||e.abort()}}]),u}(f)).prototype,"hintNode",[Fk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jk=$e(Wk.prototype,"hintLabel",[Bk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yk=$e(Wk.prototype,"thunderNode",[Gk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xk=$e(Wk.prototype,"thunderLabel",[zk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$k=$e(Wk.prototype,"stormNode",[Uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jk=$e(Wk.prototype,"stormLabel",[Hk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qk=$e(Wk.prototype,"itemPrefab",[qk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vk=Wk));n._RF.pop(),n._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);var PS,RS,IS,_S,LS,OS,DS,MS,NS,FS,BS,GS=i.ccclass,zS=i.property,US=i.disallowMultiple,HS=i.requireComponent,qS=(iS=GS("DashboardPage"),aS=HS(E),rS=HS(M),oS=zS({type:a,displayName:"Page's container"}),sS=zS({type:a,displayName:"Placeholder"}),lS=zS({displayName:"Don't load page",tooltip:"Tell the component to not preload the page even if it hasn't loaded yet"}),uS=zS({type:R,displayName:"Page prefab",visible:function(){return!this.hasLoaded}}),cS=zS({displayName:"Darken background"}),hS=zS({type:g,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),pS=zS({displayName:"Use navbar shadow"}),dS=zS({type:g,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),iS(fS=US(fS=aS(fS=rS((yS=$e((vS=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"container",yS,Ne(e)),Xe(e,"placeholder",mS,Ne(e)),Xe(e,"hasLoaded",gS,Ne(e)),Xe(e,"pagePrefab",bS,Ne(e)),Xe(e,"darkenBackground",wS,Ne(e)),Xe(e,"backgroundOpacity",kS,Ne(e)),Xe(e,"useNavbarShadow",SS,Ne(e)),Xe(e,"navbarShadowOpacity",CS,Ne(e)),e}return Pe(a,[{key:"onLoad",value:function(){this.containerUIOpacity=this.container.getComponent(M),this.placeholderUIOpacity=this.placeholder.getComponent(M),this.widgetComponent=this.node.getComponent(E),this.uiOpacity=this.node.getComponent(M),this.validateRequiredComponents();var e=this.container.getComponent(A);this.layoutComponents=e?[e]:[],this.widgetComponents=[this.widgetComponent].concat(Ve(this.container.getComponentsInChildren(E)))}},{key:"start",value:function(){this.container.active=!0,this.placeholder.active=!0}},{key:"getWidget",value:function(){return this.widgetComponent}},{key:"updateWidgets",value:function(){this.widgetComponents.forEach((function(e){e.updateAlignment()}))}},{key:"updateLayouts",value:function(){this.layoutComponents.forEach((function(e){e.updateLayout()}))}},{key:"show",value:function(){this.uiOpacity.opacity=255}},{key:"hide",value:function(){this.uiOpacity.opacity=0}},{key:"mount",value:(n=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.hasLoaded){e.next=3;break}return e.next=3,this.create();case 3:this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,bi.trackCurrentPage(this.node.name,!0);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"unmount",value:function(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}},{key:"transitionIn",value:function(){return Promise.resolve()}},{key:"transitionOut",value:function(){return Promise.resolve()}},{key:"hasLoadedPage",value:function(){return this.hasLoaded}},{key:"getContainer",value:function(){return this.container}},{key:"getDarkenBackground",value:function(){return this.darkenBackground?this.backgroundOpacity:0}},{key:"getNavbarShadow",value:function(){return this.useNavbarShadow?this.navbarShadowOpacity:0}},{key:"create",value:(t=Ae(Se().mark((function e(){var t,n,i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=2;break}return e.abrupt("return");case 2:if(!this.hasLoaded){e.next=4;break}return e.abrupt("return");case 4:return i=l(this.pagePrefab),a=i.getComponentsInChildren(E),(t=this.widgetComponents).push.apply(t,Ve(a)),r=i.getComponentsInChildren(A),(n=this.layoutComponents).push.apply(n,Ve(r)),this.container.addChild(i),e.next=12,yn.waitTweenAsync(0);case 12:this.hasLoaded=!0;case 13:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),a}(f)).prototype,"container",[oS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mS=$e(vS.prototype,"placeholder",[sS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gS=$e(vS.prototype,"hasLoaded",[lS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bS=$e(vS.prototype,"pagePrefab",[uS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wS=$e(vS.prototype,"darkenBackground",[cS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),kS=$e(vS.prototype,"backgroundOpacity",[hS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),SS=$e(vS.prototype,"useNavbarShadow",[pS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),CS=$e(vS.prototype,"navbarShadowOpacity",[dS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),fS=vS))||fS)||fS)||fS)||fS);n._RF.pop(),n._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);var VS,WS,KS,jS,YS,XS,$S,JS,QS,ZS,eC,tC,nC,iC,aC,rC=i.ccclass,oC=i.property,sC=(PS=rC("ThemeProgressBar"),RS=oC(a),IS=oC(a),_S=oC(a),LS=oC(a),PS((MS=$e((DS=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"progressBar",MS,Ne(e)),Xe(e,"progressText",NS,Ne(e)),Xe(e,"leftCap",FS,Ne(e)),Xe(e,"rightCap",BS,Ne(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}},{key:"setProgress",value:function(e,t){e<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);var n=this.progressBar.getComponent(Y);if(!n)throw new Error("ThemeProgressBar: progressBarComponent not found");n.progress=e/t;var i=this.progressText.getComponent(u);if(!i)throw new Error("ThemeProgressBar: progressTextComponent not found");i.string=`${e}/${t}`}}]),n}(f)).prototype,"progressBar",[RS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NS=$e(DS.prototype,"progressText",[IS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FS=$e(DS.prototype,"leftCap",[_S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BS=$e(DS.prototype,"rightCap",[LS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OS=DS))||OS);n._RF.pop(),n._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);var lC,uC,cC,hC,pC,dC,fC,vC,yC,mC,gC,bC,wC,kC,SC,CC,EC,AC,TC,xC,PC,RC,IC=i.ccclass,_C=i.disallowMultiple,LC=i.property,OC=[50,160],DC=(VS=IC("LockAnimator"),WS=LC(ae),KS=LC(y),jS=LC(_),YS=LC(_),XS=LC(cs),$S=LC({type:g,min:0}),VS(JS=_C((ZS=$e((QS=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"floatingParticles",ZS,Ne(e)),Xe(e,"iconAnimation",eC,Ne(e)),Xe(e,"lockClip",tC,Ne(e)),Xe(e,"unlockClip",nC,Ne(e)),Xe(e,"trailTemplate",iC,Ne(e)),Xe(e,"trailCount",aC,Ne(e)),e.trails=[],e}return Pe(a,[{key:"onLoad",value:function(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}},{key:"unlock",value:(n=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem(),e.next=4,this.playAnimation(this.unlockClip.name,t);case 4:this.floatingParticles.stopSystem();case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fireExplosionParticles",value:function(){this.explodeTrails()}},{key:"lock",value:function(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}},{key:"explodeTrails",value:function(){var e=this;return Promise.all(this.trails.map((function(t){return yn.runTweenAsync(e.getExplodeTrail(t))})))}},{key:"getExplodeTrail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=ne(0,2*Math.PI),i=ne(OC[0],OC[1])*Math.cos(n),a=ne(OC[0],OC[1])*Math.sin(n),r=new j(i,a,e.node.position.z),o=e.node.scale.clone();return S(e.node).delay(t).call((function(){e.node.setPosition(0,0),e.reset(),e.node.active=!0})).to(.5,{position:r.clone()},{easing:"expoOut"}).to(.5,{scale:new j(0,0,1)},{easing:"expoIn"}).call((function(){e.node.setPosition(0,0),e.node.scale=o,e.reset(),e.node.active=!1}))}},{key:"prepareTrails",value:function(){this.trailTemplate.node.active=!1;for(var e=0;e<this.trailCount;e++){var t=l(this.trailTemplate.node);t.setParent(this.node),t.active=!1,this.trails.push(t.getComponent(cs))}}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"playAnimation",value:(t=Ae(Se().mark((function e(t,n){var i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||null==n||!n.aborted){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return e.abrupt("return",new Promise((function(e){i.iconAnimation.once(y.EventType.FINISHED,(function(){e()})),null==n||n.addAbortListener((function(){i.iconAnimation.off(y.EventType.FINISHED),i.iconAnimation.stop(),e()})),i.iconAnimation.play(t)})));case 3:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})}]),a}(f)).prototype,"floatingParticles",[WS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eC=$e(QS.prototype,"iconAnimation",[KS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tC=$e(QS.prototype,"lockClip",[jS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nC=$e(QS.prototype,"unlockClip",[YS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iC=$e(QS.prototype,"trailTemplate",[XS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aC=$e(QS.prototype,"trailCount",[$S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),JS=QS))||JS)||JS);n._RF.pop(),n._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);var MC,NC,FC,BC,GC,zC,UC,HC,qC,VC,WC,KC=i.ccclass,jC=i.property,YC={progress:0,max:10,isLocked:!0,themeId:yl.SUMMER,skin:vl},XC=(lC=KC("ThemeBlock"),uC=jC(a),cC=jC(M),hC=jC(a),pC=jC(M),dC=jC(DC),fC=jC(a),vC=jC(T),yC=jC([T]),mC=jC(u),gC=jC(H),lC((kC=$e((wC=function(e){Ie(o,e);var t,n,i,a,r=Be(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"mask",kC,Ne(e)),Xe(e,"nodeUIOpacity",SC,Ne(e)),Xe(e,"progressBar",CC,Ne(e)),Xe(e,"backgroundUI",EC,Ne(e)),Xe(e,"lockAnimator",AC,Ne(e)),Xe(e,"themeLoadingRing",TC,Ne(e)),Xe(e,"themeSprite",xC,Ne(e)),Xe(e,"tileBlockIconSprite",PC,Ne(e)),Xe(e,"titleLabel",RC,Ne(e)),e.visibilityTween=null,e.isVisible=!1,e.payload=YC,e}return Pe(o,[{key:"isLocked",get:function(){return this.payload.isLocked},set:function(e){this.payload.isLocked=e,this.updateThemeBlockDisplay()}},{key:"getSkinName",value:function(){return this.payload.skin}},{key:"__preload",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"updateThemeBlockDisplay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:YC;this.payload=e;var t=e.progress,n=e.max,i=e.isLocked,a=e.themeId,r=e.skin;this.updateTitle(a),this.updateSkinAsync(r),this.updateThemeAsync(a);var o=this.progressBar.getComponent(sC);if(!o)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=i,this.progressBar.active=!i,this.lockAnimator.node.active=i,i||o.setProgress(t,n)}},{key:"playUnlockAnim",value:(a=Ae(Se().mark((function e(t){var n,i,a,r,o=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:YC,this.payload=ke(ke({},n),{},{isLocked:!1}),i=n.progress,a=n.max,r=this.progressBar.getComponent(sC)){e.next=6;break}throw new Error("ThemeBlock: progressBarComponent not found");case 6:return this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,r.setProgress(i,a),e.next=12,this.animateUnlockedState(t);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"updateTitle",value:function(e){switch(e){case yl.SUMMER:this.titleLabel.string="Summer";break;case yl.WINTER:this.titleLabel.string="Winter";break;case yl.AUTUMN:this.titleLabel.string="Autumn"}}},{key:"updateSkinAsync",value:(i=Ae(Se().mark((function e(t){var n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn.loadSkinPreviewAsync(t);case 2:if(n=e.sent,this.tileBlockIconSprite){e.next=5;break}return e.abrupt("return");case 5:n.forEach((function(e,t){e&&(i.tileBlockIconSprite[t].spriteFrame=e)}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"updateThemeAsync",value:(n=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jn.loadThemePreviewAsync(t);case 2:if(n=e.sent,this.themeSprite&&n){e.next=5;break}return e.abrupt("return");case 5:this.themeSprite.spriteFrame=n,this.themeLoadingRing&&(this.themeLoadingRing.active=!1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"animateUnlockedState",value:(t=Ae(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.mask.getComponent(M),a=this.progressBar.getComponent(M),i){e.next=4;break}throw new Error("ThemeBlock: maskUIOpacity not found");case 4:if(a){e.next=6;break}throw new Error("ThemeBlock: progressBarUIOpacity not found");case 6:return this.mask.active=!0,i.opacity=null!==(n=i.opacity)&&void 0!==n?n:255,this.progressBar.active=!0,a.opacity=0,e.next=12,this.lockAnimator.unlock(t);case 12:return this.lockAnimator.node.active=!1,e.next=15,Promise.all([yn.runTweenAsync(S(i).to(.25,{opacity:0}),t),yn.runTweenAsync(S(a).to(.25,{opacity:255}),t)]);case 15:this.mask.active=!1,i.opacity=0,a.opacity=255;case 18:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getUITransform",value:function(){return this.uiTransform}},{key:"setVisible",value:function(e){var t;this.isVisible!==e&&(this.isVisible=e,null===(t=this.visibilityTween)||void 0===t||t.stop(),this.visibilityTween=S(this.nodeUIOpacity).to(.05,{opacity:e?255:0}).start())}}]),o}(f)).prototype,"mask",[uC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SC=$e(wC.prototype,"nodeUIOpacity",[cC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CC=$e(wC.prototype,"progressBar",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EC=$e(wC.prototype,"backgroundUI",[pC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AC=$e(wC.prototype,"lockAnimator",[dC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TC=$e(wC.prototype,"themeLoadingRing",[fC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xC=$e(wC.prototype,"themeSprite",[vC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PC=$e(wC.prototype,"tileBlockIconSprite",[yC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RC=$e(wC.prototype,"titleLabel",[mC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(wC.prototype,"isLocked",[gC],Object.getOwnPropertyDescriptor(wC.prototype,"isLocked"),wC.prototype),bC=wC))||bC);n._RF.pop(),n._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);var $C,JC=i.ccclass,QC=i.property,ZC=globalThis.game.storage,eE=(MC=JC("CollectionsContent"),NC=QC(Pr),FC=QC(le),BC=QC(ga),GC=QC({type:C,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),MC((HC=$e((UC=function(e){Ie(r,e);var t,n,i,a=Be(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=a.call.apply(a,[this].concat(n))).animateThemeTabUnlock=null,Xe(e,"panelAnimator",HC,Ne(e)),Xe(e,"themeScrollView",qC,Ne(e)),Xe(e,"contentOpacity",VC,Ne(e)),e.themeBlocks=[],e.preservedScrollPosition=new $,Xe(e,"offsetFromTopOfScrollView",WC,Ne(e)),e.updateBlocksVisibility=function(){var t=e.uiTransform.getBoundingBoxToWorld(),n=t.yMax,i=t.yMin;e.themeBlocks.forEach((function(e){var t=e.getUITransform().getBoundingBoxToWorld(),a=t.yMax,r=t.yMin,o=a<i||r>n;e.setVisible(!o)}))},e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return Pe(r,[{key:"__preload",value:function(){var e,t;this.uiTransform=this.getComponent(s),this.themeBlocks=null!==(e=null===(t=this.themeScrollView.content)||void 0===t?void 0:t.getComponentsInChildren(XC))&&void 0!==e?e:[],this.validateRequiredComponents()}},{key:"listenEvents",value:function(){this.themeScrollView.node.on(le.EventType.SCROLLING,this.updateBlocksVisibility),this.node.scene.on(tr.HIDE_UI,this.hideContent),this.node.scene.on(tr.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.themeScrollView.node.off(le.EventType.SCROLLING,this.updateBlocksVisibility),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(tr.HIDE_UI,this.hideContent),this.node.scene.off(tr.SHOW_UI,this.showContent)}},{key:"init",value:function(e){0!==e.length&&this.getThemeTabs().forEach((function(t,n){return t.updateThemeBlockDisplay(e[n])}))}},{key:"preserveScrollPosition",value:function(){this.themeScrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.getScrollOffset())}},{key:"restoreScrollPosition",value:function(){this.themeScrollView.scrollToOffset(this.preservedScrollPosition,0)}},{key:"updateUnlockedProgress",value:function(e){var t=this,n=ZC.getStorageData("collection","animateMapPackUnlock"),i=ZC.getStorageData("collection","lastMapPack");e.forEach((function(e,a){var r=e.skin,o=e.progress,s=e.max,l=e.isLocked;if(o<s&&!l&&n&&i!==a+1)return t.animateThemeTabUnlock=e,ZC.setStorageData("collection","animateMapPackUnlock",!1),ZC.setStorageData("collection","lastMapPack",a+1),void t.setProgressToThemeTab(r,ke(ke({},e),{},{isLocked:!0}));t.setProgressToThemeTab(r,e)}))}},{key:"shouldAnimateThemeTabUnlock",value:function(){return null!==this.animateThemeTabUnlock}},{key:"playThemeTabUnlockAnim",value:(i=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.animateThemeTabUnlock){e.next=2;break}return e.abrupt("return");case 2:if(void 0!==(n=this.findThemeTab(this.animateThemeTabUnlock.skin))){e.next=5;break}throw new Error("CollectionsContent: ThemeTab not found");case 5:return e.next=7,n.playUnlockAnim(t,ke(ke({},this.animateThemeTabUnlock),{},{isLocked:!0}));case 7:this.animateThemeTabUnlock=null;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"scrollToCurrentUnlockingTheme",value:(n=Ae(Se().mark((function e(t,n){var i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.findThemeTab(t)){e.next=3;break}return e.abrupt("return");case 3:return a=i.node.position.y,r=-a-this.offsetFromTopOfScrollView,e.next=7,this.scrollToOffset(new $(0,r),2,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"scrollToOffset",value:(t=Ae(Se().mark((function e(t,n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.themeScrollView.scrollToOffset(t,n),e.next=3,yn.waitTweenAsync(n,i);case 3:i.aborted&&(this.themeScrollView.stopAutoScroll(),this.themeScrollView.scrollToOffset(t,0));case 4:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"setProgressToThemeTab",value:function(e,t){var n=this.findThemeTab(e);if(void 0===n)throw new Error("CollectionsContent: ThemeTab not found");n.updateThemeBlockDisplay(t)}},{key:"findThemeTab",value:function(e){return this.getThemeTabs().find((function(t){return t.getSkinName()===e}))}},{key:"getThemeTabs",value:function(){return this.themeScrollView.content.getComponentsInChildren(XC)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),r}(f)).prototype,"panelAnimator",[NC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qC=$e(UC.prototype,"themeScrollView",[FC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VC=$e(UC.prototype,"contentOpacity",[BC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WC=$e(UC.prototype,"offsetFromTopOfScrollView",[GC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),zC=UC))||zC);n._RF.pop(),n._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);var tE,nE,iE,aE,rE,oE,sE,lE,uE,cE,hE,pE,dE,fE,vE,yE,mE,gE,bE,wE,kE,SE,CE,EE,AE,TE,xE,PE=(0,i.ccclass)("CollectionsPage")($C=function(e){Ie(r,e);var t,n,i,a=Be(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=a.call.apply(a,[this].concat(n))).payload=null,e}return Pe(r,[{key:"setPayload",value:function(e){this.payload=e}},{key:"mount",value:(i=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,Jn.loadPrefabAsync(Un.COLLECTIONS_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,ze(_e(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.themeContent){e.next=12;break}if(this.themeContent=this.container.getComponentInChildren(eE),this.themeContent){e.next=12;break}throw new Error("No theme content found");case 12:this.payload&&this.themeContent.init(this.payload);case 13:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ae(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(_e(r.prototype),"transitionIn",this).call(this);case 2:return this.themeContent.restoreScrollPosition(),this.themeContent.updateBlocksVisibility(),this.themeContent.enableUIAnimator(),this.themeContent.listenEvents(),t=yn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){i.node.scene.emit(tr.SHOW_UI,{onComplete:function(){e()}})})),e.next=10,Promise.all([t,n]);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ae(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(_e(r.prototype),"transitionOut",this).call(this);case 2:return this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents(),e.next=6,new Promise((function(e){t.node.scene.emit(tr.HIDE_UI,{onComplete:function(){e()}})}));case 6:this.themeContent.disableUIAnimator(),this.themeContent.unlistenEvents();case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(qS))||$C;n._RF.pop(),n._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);var RE,IE,_E,LE,OE,DE,ME,NE,FE,BE,GE,zE,UE,HE=i.ccclass,qE=i.property,VE=i.disallowMultiple,WE=i.requireComponent,KE=(tE=HE("PageManagerItem"),nE=qE(qS),iE=qE({type:ue(Bs)}),tE((oE=$e((rE=Pe((function e(){Te(this,e),Xe(this,"page",oE,this),Xe(this,"pageType",sE,this)}))).prototype,"page",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sE=$e(rE.prototype,"pageType",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aE=rE))||aE),jE=(lE=HE("PageManager"),uE=WE(s),cE=qE({type:M,displayName:"Background Mask",group:"Background Mask"}),hE=qE({type:C,displayName:"Transition duration",group:"Background Mask"}),pE=qE({type:C,displayName:"Transition delay",group:"Background Mask"}),dE=qE({type:M,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),fE=qE({type:C,displayName:"Transition duration",group:"Nav Bar Shadow"}),vE=qE({type:C,displayName:"Transition delay",group:"Nav Bar Shadow"}),yE=qE({type:[KE]}),mE=qE({type:ue(Bs)}),lE(gE=VE(gE=uE((wE=$e((bE=function(e){Ie(o,e);var t,n,i,a,r=Be(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"backgroundMask",wE,Ne(e)),Xe(e,"backgroundMaskTransitionDuration",kE,Ne(e)),Xe(e,"backgroundMaskTransitionDelay",SE,Ne(e)),Xe(e,"navBarShadow",CE,Ne(e)),Xe(e,"navBarShadowTransitionDuration",EE,Ne(e)),Xe(e,"navBarShadowTransitionDelay",AE,Ne(e)),Xe(e,"pageItems",TE,Ne(e)),Xe(e,"currentScreen",xE,Ne(e)),e}return Pe(o,[{key:"unmountAndHideAll",value:function(){var e=this;this.pageItems.forEach((function(t){var n=t.page;t.pageType!==e.currentScreen&&(n.unmount(),n.hide())}))}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"updateCollectionsContentPayload",value:function(e){var t=this.getPage(Bs.collections);t&&t instanceof PE&&t.setPayload(e)}},{key:"navigate",value:(a=Ae(Se().mark((function e(t,n,i){var a,r,o,s,l,u,c,h,p,d,f,v,y,m,g;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.from,r=t.to,null!==a){e.next=15;break}return(o=this.getPage(this.currentScreen)).show(),e.next=6,o.mount();case 6:return e.next=8,null==n?void 0:n(o);case 8:return this.node.scene.emit(Ms),e.next=11,o.transitionIn();case 11:return e.next=13,null==i?void 0:i(o);case 13:return this.currentScreen=r,e.abrupt("return");case 15:if(a===this.currentScreen){e.next=17;break}throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");case 17:if(s=this.getPage(this.currentScreen),(l=this.getPage(r))&&s){e.next=21;break}throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");case 21:if(u=this.uiTransform.width,c=this.getPageIndex(a),h=this.getPageIndex(r),p=Math.min(c,h),d=Math.max(c,h),f=(d-p)*u,v=c<h?1:-1,(y=this.pageItems.slice(p,d+1)).forEach((function(e,t){var n=e.page;n.show(),n.getWidget().enabled=!1,n.node.position=new j((t+p-c)*u,n.node.position.y,n.node.position.z)})),m=!1,l.hasLoadedPage()){e.next=36;break}return m=!0,nu.showLoadingScreen(),e.next=36,yn.waitTweenAsync(.5);case 36:return e.next=38,l.mount();case 38:return e.next=40,null==n?void 0:n(l);case 40:return this.node.scene.emit(Ms),e.next=43,Promise.all([s.transitionOut(),this.transition(f,v,y),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,l.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,l.getNavbarShadow())]);case 43:return(g=l.getWidget()).enabled=!0,g.left=0,g.right=0,l.updateWidgets(),l.updateLayouts(),y.forEach((function(e){e.pageType!==r&&(e.page.unmount(),e.page.hide())})),this.currentScreen=r,e.next=53,l.transitionIn();case 53:return e.next=55,null==i?void 0:i(l);case 55:m&&nu.closeLoadingScreen();case 56:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"getPage",value:function(e){var t=this.getPageIndex(e);return-1!==t?this.pageItems[t].page:null}},{key:"handleBackgroundMask",value:(i=Ae(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(t,{opacity:n}).start());case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"handleNavBarShadow",value:(n=Ae(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(t,{opacity:n}).start());case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getPageIndex",value:function(e){return this.pageItems.findIndex((function(t){return t.pageType===e}))}},{key:"transition",value:(t=Ae(Se().mark((function e(t,n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(i.map((function(e){var i=e.page;return yn.runTweenAsync(S(i.node).to(.5,{position:new j(i.node.position.x-t*n,i.node.position.y,i.node.position.z)},{easing:D.quintInOut}))})));case 2:case"end":return e.stop()}}),e)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiTransform)throw new Error("PageManager requires UITransform component");if(!this.backgroundMask)throw new Error("PageManager requires background mask")}}]),o}(f)).prototype,"backgroundMask",[cE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kE=$e(bE.prototype,"backgroundMaskTransitionDuration",[hE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),SE=$e(bE.prototype,"backgroundMaskTransitionDelay",[pE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),CE=$e(bE.prototype,"navBarShadow",[dE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EE=$e(bE.prototype,"navBarShadowTransitionDuration",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),AE=$e(bE.prototype,"navBarShadowTransitionDelay",[vE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),TE=$e(bE.prototype,"pageItems",[yE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xE=$e(bE.prototype,"currentScreen",[mE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Bs.home}}),gE=bE))||gE)||gE)||gE);n._RF.pop(),n._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);var YE,XE,$E,JE,QE,ZE,eA=i.ccclass,tA=i.property,nA=(RE=eA("StarProgressBar"),IE=tA(oo),_E=tA(u),LE=tA(g),OE=tA(g),DE=tA(m),RE((FE=$e((NE=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"progressBar",FE,Ne(e)),Xe(e,"progressLabel",BE,Ne(e)),Xe(e,"current",GE,Ne(e)),Xe(e,"total",zE,Ne(e)),Xe(e,"separator",UE,Ne(e)),e}return Pe(i,[{key:"setRange",value:function(e,t){this.total=t,this.current=e,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"updateProgress",value:function(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}},{key:"updateProgressLabel",value:function(){this.progressLabel.string=`${this.current}${this.separator}${this.total}`}},{key:"animateTo",value:(t=Ae(Se().mark((function e(t,n,i){var a,r,o,s,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Math.min(t,this.total)/this.total,r=this.current,o=1,s=S(this.progressBar).to(3,{progress:a},{easing:"quadOut",onUpdate:function(e,n){n&&(l.current=r+Math.floor((t-r)*n),null==i||i(l.current),l.current===r-o&&(o++,S(l.progressLabel.node).to(.05,{scale:new j(1.2,1.2,1.2)}).to(.05,{scale:j.ONE}).start()),l.updateProgressLabel())}}),null==n||n.addAbortListener((function(){l.current=t,l.updateProgress()})),e.next=7,yn.runTweenAsync(s,n);case 7:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(f)).prototype,"progressBar",[IE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BE=$e(NE.prototype,"progressLabel",[_E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GE=$e(NE.prototype,"current",[LE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zE=$e(NE.prototype,"total",[OE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UE=$e(NE.prototype,"separator",[DE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ME=NE))||ME);n._RF.pop(),n._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);var iA,aA,rA,oA,sA,lA,uA,cA,hA,pA,dA,fA=i.ccclass,vA=i.property,yA=(YE=fA("EventButton"),XE=vA({type:ue(pg)}),$E=vA(H),YE((ZE=$e((QE=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"eventType",ZE,Ne(e)),e._isAvailable=!1,e}return Pe(n,[{key:"isAvailable",get:function(){return this._isAvailable},set:function(e){this._isAvailable=e,this.fakeClick()}},{key:"handleClick",value:function(){this.node.scene.emit(Fs,{type:this.eventType})}},{key:"setAnimationState",value:function(e){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),ze(_e(n.prototype),"setAnimationState",this).call(this,e)}}]),n}(oa)).prototype,"eventType",[XE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pg.STAR_CHEST}}),$e(QE.prototype,"isAvailable",[$E],Object.getOwnPropertyDescriptor(QE.prototype,"isAvailable"),QE.prototype),JE=QE))||JE);n._RF.pop(),n._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);var mA,gA,bA,wA,kA,SA,CA,EA,AA,TA,xA,PA,RA,IA,_A,LA,OA,DA,MA=i.ccclass,NA=i.property,FA=globalThis.game.player,BA=(iA=MA("DashboardHeader"),aA=NA({type:nA,displayName:"Progress bar",group:"Star Chest"}),rA=NA({type:yA,displayName:"Button Component",group:"Star Chest"}),oA=NA({type:_,displayName:"Default Rest animation",group:"Star Chest"}),sA=NA({type:_,displayName:"Special Rest animation",group:"Star Chest"}),iA((cA=$e((uA=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"starProgressBar",cA,Ne(e)),Xe(e,"chestButton",hA,Ne(e)),Xe(e,"defaultRestAnimation",pA,Ne(e)),Xe(e,"specialRestAnimation",dA,Ne(e)),e.handleStarsUpdateEvent=function(t){var n,i;void 0!==(t=null!==(n=t)&&void 0!==n?n:null===(i=FA.getGameData())||void 0===i?void 0:i.stars)&&(e.starProgressBar.setRange(t,20),e.updateStarChestButtonAnimation(t))},e}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),x.on(Ls,this.handleStarsUpdateEvent)}},{key:"onDestroy",value:function(){x.off(Ls,this.handleStarsUpdateEvent)}},{key:"updateStarProgress",value:function(e){this.handleStarsUpdateEvent(e)}},{key:"updateStarChestButtonAnimation",value:function(e){this.chestButton.isAvailable=e>=20}},{key:"validateRequiredComponents",value:function(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}}]),n}(f)).prototype,"starProgressBar",[aA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hA=$e(uA.prototype,"chestButton",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pA=$e(uA.prototype,"defaultRestAnimation",[oA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dA=$e(uA.prototype,"specialRestAnimation",[sA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lA=uA))||lA);n._RF.pop(),n._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);var GA,zA,UA,HA,qA,VA,WA,KA,jA,YA,XA,$A,JA=i.ccclass,QA=i.property,ZA=i.executeInEditMode,eT=(mA=JA("JourneyLevelAvatar"),gA=QA({type:T,displayName:"Avatar node"}),bA=QA(a),wA=QA(y),kA=QA(M),SA=QA({type:_,group:"Animation"}),CA=QA({type:_,group:"Animation"}),EA=QA({type:_,group:"Animation"}),AA=QA({type:O,displayName:"Avatar sprite"}),mA(TA=ZA((PA=$e((xA=function(e){Ie(r,e);var t,n,i,a=Be(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"sprite",PA,Ne(e)),Xe(e,"lockIcon",RA,Ne(e)),Xe(e,"animation",IA,Ne(e)),Xe(e,"opacity",_A,Ne(e)),Xe(e,"flashAnimation",LA,Ne(e)),Xe(e,"unlockAnimation",OA,Ne(e)),Xe(e,"spawnAnimation",DA,Ne(e)),e}return Pe(r,[{key:"avatarSprite",get:function(){var e,t;return null!==(e=null===(t=this.sprite)||void 0===t?void 0:t.spriteFrame)&&void 0!==e?e:null},set:function(e){this.sprite&&(this.sprite.spriteFrame=e)}},{key:"playUnlockAnimation",value:(i=Ae(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c,h;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.playAnimation(this.unlockAnimation),n=this.lockIcon.position.x,i=this.lockIcon.position.y,a=[45,135],r=(Math.random()*(a[1]-a[0])+a[0])*(Math.PI/180),o=this.lockIcon.position.x+150*Math.cos(r),s=this.lockIcon.position.y+150*Math.sin(r),l=i-400,u=yn.runTweenAsync(S(this.lockIcon).delay(.3).to(.2,{position:new j(o,s,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new j(o,l,this.lockIcon.position.z)},{easing:"cubicIn"})),c=[0,360],h=yn.runTweenAsync(S(this.lockIcon).delay(.3).to(.6,{eulerAngles:new j(0,0,Math.random()*(c[1]-c[0])*(o>n?-1:1))},{easing:"sineOut"})),e.next=14,Promise.all([t,u,h]);case 14:this.lockIcon.position=new j(n,i,this.lockIcon.position.z),this.lockIcon.eulerAngles=new j(0,0,0);case 16:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"playFlashAnimation",value:(n=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.node.position.y,n=this.playAnimation(this.flashAnimation),i=yn.runTweenAsync(S(this.node).to(.1,{position:new j(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new j(this.node.position.x,t,this.node.position.z)},{easing:"sineIn"})),e.next=5,Promise.all([n,i]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playSpawnAnimation",value:function(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}},{key:"hideImmediately",value:function(){this.opacity.opacity=0,this.node.setScale(j.ZERO)}},{key:"playAnimation",value:(t=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runAnimationAsync(this.animation,t.name);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){var e=this;if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some((function(t){return null!==t&&(t.name===e.flashAnimation.name||t.name===e.unlockAnimation.name||t.name===e.spawnAnimation.name)})))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}]),r}(f)).prototype,"sprite",[gA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RA=$e(xA.prototype,"lockIcon",[bA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IA=$e(xA.prototype,"animation",[wA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_A=$e(xA.prototype,"opacity",[kA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LA=$e(xA.prototype,"flashAnimation",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OA=$e(xA.prototype,"unlockAnimation",[CA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DA=$e(xA.prototype,"spawnAnimation",[EA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(xA.prototype,"avatarSprite",[AA],Object.getOwnPropertyDescriptor(xA.prototype,"avatarSprite"),xA.prototype),TA=xA))||TA)||TA);n._RF.pop(),n._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);var tT,nT,iT,aT,rT,oT,sT,lT,uT,cT,hT,pT,dT,fT,vT,yT,mT,gT,bT,wT,kT,ST,CT=i.ccclass,ET=i.property,AT=i.executeInEditMode,TT=(GA=CT("JourneyProgressBar"),zA=ET(oo),UA=ET(u),HA=ET(M),qA=ET(g),VA=ET(g),WA=ET(m),GA(KA=AT((YA=$e((jA=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"progressBar",YA,Ne(e)),Xe(e,"progressLabel",XA,Ne(e)),Xe(e,"labelUIOpacity",$A,Ne(e)),e.currentProgress=10,e.totalProgress=10,e.labelSeparator="/",e}return Pe(i,[{key:"total",get:function(){return this.totalProgress}},{key:"current",get:function(){return this.currentProgress}},{key:"separator",get:function(){return this.labelSeparator},set:function(e){this.labelSeparator=e,this.updateProgress()}},{key:"setRange",value:function(e,t){this.totalProgress=t,e>t&&(e=t),this.currentProgress=e,this.updateProgress()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"animateTo",value:(t=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.nextCurr,i=t.nextTotal,a=t.numberOfProgressBar,r=void 0===a?0:a,o=t.onProgressBarPassed,s=t.signal,l=n/i,u=S(this.labelUIOpacity).to(.2,{opacity:0}),c=S(this.labelUIOpacity).to(.2,{opacity:255}),h=r<1?1:Math.sqrt(r)+1,p=0===r?l:r+l,d=1,f=S({curr:this.progressBar.progress}).to(h,{curr:p},{easing:"sineInOut",onUpdate:function(e){if(void 0!==e){var t=e.curr;v.progressBar.progress=t%1,t>d&&(d=0===t?1:Math.ceil(t),null==o||o())}}}),e.next=10,Promise.all([yn.runTweenAsync(u,s),yn.runTweenAsync(f,s)]);case 10:return this.currentProgress=n,this.totalProgress=i,this.updateProgress(),e.next=15,yn.runTweenAsync(c,s);case 15:return this.labelUIOpacity.opacity=255,e.abrupt("return",l);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateProgress",value:function(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string=`${this.currentProgress}${this.separator}${this.totalProgress}`}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}]),i}(f)).prototype,"progressBar",[zA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XA=$e(jA.prototype,"progressLabel",[UA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$A=$e(jA.prototype,"labelUIOpacity",[HA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(jA.prototype,"total",[qA],Object.getOwnPropertyDescriptor(jA.prototype,"total"),jA.prototype),$e(jA.prototype,"current",[VA],Object.getOwnPropertyDescriptor(jA.prototype,"current"),jA.prototype),$e(jA.prototype,"separator",[WA],Object.getOwnPropertyDescriptor(jA.prototype,"separator"),jA.prototype),KA=jA))||KA)||KA);n._RF.pop(),n._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);var xT,PT,RT,IT,_T,LT,OT,DT,MT,NT,FT,BT,GT,zT,UT,HT,qT,VT=i.ccclass,WT=i.property,KT=(tT=VT("ProgressConfiguration"),nT=WT(O),iT=WT(m),tT((oT=$e((rT=Pe((function e(){Te(this,e),Xe(this,"avatar",oT,this),Xe(this,"themeId",sT,this)}))).prototype,"avatar",[nT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sT=$e(rT.prototype,"themeId",[iT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aT=rT))||aT),jT=(lT=VT("JourneyProgressAnimator"),uT=WT(TT),cT=WT(a),hT=WT(T),pT=WT(eT),dT=WT(KT),fT=WT({type:C,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),lT((mT=$e((yT=function(e){Ie(o,e);var t,n,i,a,r=Be(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"progressBar",mT,Ne(e)),Xe(e,"currentLevelAvatarNode",gT,Ne(e)),Xe(e,"currentLevelAvatar",bT,Ne(e)),Xe(e,"nextLevelAvatar",wT,Ne(e)),Xe(e,"progressConfigs",kT,Ne(e)),Xe(e,"nextLevelYOffset",ST,Ne(e)),e.isAnimating=!1,e}return Pe(o,[{key:"setRange",value:function(e,t){this.progressBar.setRange(e,t)}},{key:"animateTo",value:(a=Ae(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isAnimating){e.next=3;break}return console.warn("JourneyProgressAnimator: animation already in progress"),e.abrupt("return",Promise.resolve());case 3:if(this.isAnimating=!0,t===this.progressBar.current){e.next=7;break}return e.next=7,this.progressBar.animateTo({nextCurr:t,nextTotal:this.progressBar.total,signal:n});case 7:this.isAnimating=!1;case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"animateToNextLevel",value:(i=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.nextCurr,i=t.nextTotal,a=t.mapsPassed,r=t.signal,!this.isAnimating){e.next=4;break}return console.warn("JourneyProgressAnimator: animation already in progress"),e.abrupt("return");case 4:if(this.isAnimating=!0,0!=(o=a.length-2)){e.next=11;break}return e.next=9,this.progressBar.animateTo({nextCurr:n,nextTotal:i,signal:r});case 9:return this.isAnimating=!1,e.abrupt("return");case 11:return e.next=13,this.animateTargetAvaToCenter(r);case 13:return s=function(){if(1===l)return h.nextLevelAvatar.playUnlockAnimation(),void(l+=1);if(l>=a.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");h.nextLevelAvatar.playFlashAnimation(),h.setNextLevelAvatar(a[l].theme),l+=1},l=1,e.next=17,this.progressBar.animateTo({signal:r,nextCurr:n,nextTotal:i,numberOfProgressBar:o,onProgressBarPassed:s});case 17:return e.next=19,this.animateTargetAvaToPrev(r);case 19:u=a[a.length-1].theme,c=a[a.length-2].theme,this.setCurrentLevelAvatar(c),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=this.getSpriteFrameByThemeId(u),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1;case 27:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"animateTargetAvaToCenter",value:(n=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z),e.next=3,yn.runTweenAsync(S(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t);case 3:this.nextLevelAvatar.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"moveTargetAvaToOriginal",value:function(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}},{key:"animateTargetAvaToPrev",value:(t=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.currentLevelAvatarNode.position.clone(),e.next=3,yn.runTweenAsync(S(this.nextLevelAvatar.node).to(1,{position:n},{easing:"cubicInOut"}),t);case 3:this.nextLevelAvatar.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSpriteFrameByThemeId",value:function(e){var t=this.progressConfigs.find((function(t){return t.themeId===e}));if(!t)throw new Error(`JourneyProgressController: config not found for themeId ${e}`);return t.avatar}},{key:"setAvatar",value:function(e,t){var n=this.getSpriteFrameByThemeId(e);t instanceof eT?t.avatarSprite=n:t.spriteFrame=n}},{key:"setCurrentLevelAvatar",value:function(e){this.setAvatar(e,this.currentLevelAvatar)}},{key:"setNextLevelAvatar",value:function(e){this.setAvatar(e,this.nextLevelAvatar)}},{key:"onLoad",value:function(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),o}(f)).prototype,"progressBar",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gT=$e(yT.prototype,"currentLevelAvatarNode",[cT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bT=$e(yT.prototype,"currentLevelAvatar",[hT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wT=$e(yT.prototype,"nextLevelAvatar",[pT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kT=$e(yT.prototype,"progressConfigs",[dT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ST=$e(yT.prototype,"nextLevelYOffset",[fT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),vT=yT))||vT);n._RF.pop(),n._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);var YT,XT,$T,JT,QT,ZT,ex,tx,nx,ix,ax,rx,ox,sx,lx,ux=i.ccclass,cx=i.property,hx=globalThis.game.storage,px=(xT=ux("HomeContent"),PT=cx(u),RT=cx(p),IT=cx(jT),_T=cx(Pr),LT=cx(BA),OT=cx(M),DT=cx(nS),xT((FT=$e((NT=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"playButtonLabel",FT,Ne(e)),Xe(e,"playButton",BT,Ne(e)),Xe(e,"journeyProgressAnimator",GT,Ne(e)),Xe(e,"panelAnimator",zT,Ne(e)),Xe(e,"dashboardHeader",UT,Ne(e)),Xe(e,"overlayDuringAnim",HT,Ne(e)),Xe(e,"coinContainer",qT,Ne(e)),e}return Pe(a,[{key:"__preload",value:function(){this.validateRequiredComponents()}},{key:"getCoinContainer",value:function(){return this.coinContainer}},{key:"handlePlayButtonPress",value:function(){this.playButton.interactable=!1,this.node.scene.emit(Os)}},{key:"setPlayButtonLabel",value:function(e){this.playButtonLabel.string=e}},{key:"updateStarProgress",value:function(e){this.dashboardHeader.updateStarProgress(e)}},{key:"setUnlockProgress",value:function(e){this.setProgress(e),this.updateCurrentMapInStorage(e)}},{key:"prepareUnlockProgressAnimation",value:function(e,t,n,i){var a=this;if(e.id===t.id){this.setProgress(ke(ke({},t),{},{progress:e.progress})),this.updateCurrentMapInStorage(t);var r=t.progress;return Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.playButton.interactable=!1,e.next=3,a.showOwnOverlay(i);case 3:return e.next=5,a.journeyProgressAnimator.animateTo(r,i);case 5:return e.next=7,a.hideOwnOverlay(i);case 7:a.playButton.interactable=!0;case 8:case"end":return e.stop()}}),e)})))}return this.setProgress(e),this.updateCurrentMapInStorage(t),Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.playButton.interactable=!1,e.next=3,a.showOwnOverlay(i);case 3:return e.next=5,a.journeyProgressAnimator.animateToNextLevel({nextCurr:t.progress,nextTotal:t.max,mapsPassed:n,signal:i});case 5:return e.next=7,a.hideOwnOverlay(i);case 7:a.playButton.interactable=!0;case 8:case"end":return e.stop()}}),e)})))}},{key:"hideOwnOverlay",value:(n=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.overlayDuringAnim).to(.3,{opacity:0}),t);case 2:this.overlayDuringAnim.opacity=0;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"showOwnOverlay",value:(t=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.overlayDuringAnim).to(.3,{opacity:150}),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setProgress",value:function(e){var t=e.currentTheme,n=e.nextTheme,i=e.progress,a=e.max;this.journeyProgressAnimator.setCurrentLevelAvatar(t),this.journeyProgressAnimator.setNextLevelAvatar(null!=n?n:t),this.journeyProgressAnimator.setRange(i,a)}},{key:"updateCurrentMapInStorage",value:function(e){hx.setStorageData("dashboard","animateToCurrentLevel",!1),hx.setStorageData("dashboard","lastMapPayload",e)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),a}(f)).prototype,"playButtonLabel",[PT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BT=$e(NT.prototype,"playButton",[RT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GT=$e(NT.prototype,"journeyProgressAnimator",[IT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zT=$e(NT.prototype,"panelAnimator",[_T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UT=$e(NT.prototype,"dashboardHeader",[LT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HT=$e(NT.prototype,"overlayDuringAnim",[OT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qT=$e(NT.prototype,"coinContainer",[DT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MT=NT))||MT);n._RF.pop(),n._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);var dx,fx,vx,yx,mx,gx,bx,wx,kx,Sx,Cx,Ex,Ax,Tx=i.ccclass,xx=i.property,Px=globalThis.game.ads,Rx=(YT=Tx("NavManager"),XT=xx(a),$T=xx(a),JT=xx(wn),QT=xx(H),ZT=xx({type:E,visible:function(){return this.useOffsetWhenSAB}}),ex=xx({type:C,visible:function(){return this.useOffsetWhenSAB}}),YT((ix=$e((nx=function(e){Ie(s,e);var t,n,i,a,r,o=Be(s);function s(){var e;Te(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=o.call.apply(o,[this].concat(n)),"selectorNode",ix,Ne(e)),Xe(e,"selectedButtonNode",ax,Ne(e)),Xe(e,"autoLayout",rx,Ne(e)),Xe(e,"useOffsetWhenSAB",ox,Ne(e)),Xe(e,"offsetWidget",sx,Ne(e)),Xe(e,"offsetWhenSAB",lx,Ne(e)),e.navButtons=[],e.isNavigating=!1,e}return Pe(s,[{key:"currentButton",get:function(){return this.selectedButton}},{key:"onLoad",value:function(){var e;this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=null===(e=this.selectedButtonNode)||void 0===e?void 0:e.getComponentInChildren("NavButton"),St.lazyValidateProperties(this)}},{key:"start",value:function(){this.useOffsetWhenSAB&&(Px.getSafeAreaBottom(ea.cssSizeToWorldSize(1))>0&&(this.offsetWidget.bottom=this.offsetWhenSAB))}},{key:"select",value:(r=Ae(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNavigating){e.next=2;break}return e.abrupt("return");case 2:if(this.navButtons.includes(t)){e.next=4;break}throw new Error("NavManager: Button not found");case 4:if(t!==this.selectedButton){e.next=6;break}return e.abrupt("return");case 6:if(!t.isWIP){e.next=9;break}return this.handleWIPButton(),e.abrupt("return");case 9:return this.isNavigating=!0,this.node.scene.emit(Ds,{from:this.selectedButton.buttonType,to:t.buttonType}),e.abrupt("return",new Promise((function(e){n.node.scene.once(Ms,(function(){var i=n.selectedButton.deselect();n.autoLayout.selectedIndex=n.navButtons.indexOf(t),n.selectedButton=t;var a=n.autoLayout.getSelectedWorldX()-t.getSelectedWorldDistanceX(),r=n.playSelectorAnimation(a),o=t.select();Promise.all([i,o,r]).then((function(){n.isNavigating=!1,e()}))}))})));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"selectUsingSceneTransition",value:(a=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isNavigating){e.next=2;break}return e.abrupt("return");case 2:if(![Bs.store].includes(t.buttonType)){e.next=5;break}return this.handleWIPButton(),e.abrupt("return");case 5:return e.next=7,this.select(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"selectByType",value:(i=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.navButtons.find((function(e){return e.buttonType===t}))){e.next=3;break}throw new Error("NavManager: Button not found");case 3:return e.next=5,this.selectUsingSceneTransition(n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"handleWIPButton",value:function(){nu.openScreen(yi)}},{key:"selectDefaultNavBtn",value:(n=Ae(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentButton&&this.navButtons.includes(this.currentButton)){e.next=2;break}throw new Error("NavManager: Button not found");case 2:return t=this.currentButton.buttonType,this.node.scene.emit(Ds,{from:null,to:t}),e.abrupt("return",new Promise((function(e){n.node.scene.once(Ms,(function(){n.autoLayout.selectedIndex=n.navButtons.indexOf(n.currentButton);var t=n.navButtons.map((function(e){return e===n.currentButton?e.select(!1):e.deselect(!1,!0)})),i=n.autoLayout.getSelectedWorldX()-n.currentButton.getSelectedWorldDistanceX();n.selectorNode.worldPosition=new j(i,n.selectorNode.worldPosition.y,0),Promise.all(t).then((function(){e()}))}))})));case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"playSelectorAnimation",value:(t=Ae(Se().mark((function e(t){var n,i,a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(1,1,1),i=this.selectorNode.worldPosition.clone(),a=new j(1.2*n.x,.8*n.y,1),e.next=7,yn.runTweenAsync(S(this.selectorNode).to(.3,{worldPosition:new j(t,i.y,0)},{easing:"quintInOut",onUpdate:function(e,t){if(void 0!==t){var i=r.calculateCurrentSquashScale(n,a,t);r.selectorNode.scale=i}}}));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"setIgnoreInput",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.navButtons.forEach((function(t){var n=t.getComponentInChildren(p);n&&(n.interactable=!e)}))}},{key:"calculateCurrentSquashScale",value:function(e,t,n){var i=this.splitIntoSquashRatio(n);return e.clone().lerp(t,i)}},{key:"splitIntoSquashRatio",value:function(e){return e<.5?2*e:1-2*(e-.5)}}]),s}(f)).prototype,"selectorNode",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ax=$e(nx.prototype,"selectedButtonNode",[$T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rx=$e(nx.prototype,"autoLayout",[JT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ox=$e(nx.prototype,"useOffsetWhenSAB",[QT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sx=$e(nx.prototype,"offsetWidget",[ZT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lx=$e(nx.prototype,"offsetWhenSAB",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tx=nx))||tx);n._RF.pop(),n._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);var Ix,_x,Lx,Ox,Dx,Mx=i.ccclass,Nx=i.disallowMultiple,Fx=i.property,Bx=globalThis.game,Gx=Bx.event,zx=Bx.storage,Ux=Bx.player,Hx=Bx.leaderboard,qx=GameCore.Events,Vx=GameCore.Match.Modes,Wx=GameCore.Configs.DailyRewards,Kx=GameCore.Utils,jx=Kx.Time,Yx=Kx.Json;dx=Mx("DashboardScene"),fx=Fx(Fb),vx=Fx(Rx),yx=Fx(ei),mx=Fx(jE),gx=Fx(Mk),dx(bx=Nx((kx=$e((wx=function(e){Ie(u,e);var t,n,i,a,r,o,s,l=Be(u);function u(){var e;Te(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=l.call.apply(l,[this].concat(n)),"coinManager",kx,Ne(e)),Xe(e,"navManager",Sx,Ne(e)),Xe(e,"bgComp",Cx,Ne(e)),Xe(e,"pageManager",Ex,Ne(e)),Xe(e,"pageAnimSkipOverlay",Ax,Ne(e)),e.firstNavigation=!0,e.isFirstNavToCollections=!0,e.hasLoadedGameSceneResourcesFinish=!1,e.playBgAnim=Ae(Se().mark((function t(){var n,i,a,r,o,s,l;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=(i=zx.getStorage("dashboard"))){t.next=3;break}throw new Error("DashboardScene: dashboardStorage not found");case 3:if(a=null!==(n=i.animateToCurrentLevel)&&void 0!==n&&n,r=ke({},i.lastMapPayload),o=kl.getCurrentMapProgress(),s=r.currentTheme===o.currentTheme&&r.nextTheme===o.nextTheme,l=o.currentTheme,a&&!s){t.next=10;break}return t.abrupt("return");case 10:return t.next=12,yn.waitTweenAsync(2);case 12:return t.prev=12,t.next=15,e.bgComp.animateToNextTheme(l);case 15:t.next=19;break;case 17:t.prev=17,t.t0=t.catch(12);case 19:case"end":return t.stop()}}),t,null,[[12,17]])}))),e.handlePlayButtonPress=Ae(Se().mark((function t(){var n,i,a,r,o,s,l,u,c,h,p,d;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Ll.startMatchAsync(Vx.SINGLE);case 3:return a=kl.getCurrentMapProgress(),r=null!==(n=Ux.getGameData())&&void 0!==n?n:{},o=r.level,s=void 0===o?1:o,e.updateCurrentMapInStorage(a),zx.setStorageData("collection","lastMapPack",a.id),zx.setStorageData("collection","animateMapPackUnlock",!1),l=zx.getStorage("leaderboard_content"),u=l.lastTabOpened,t.next=11,e.getPlayerLeader(u);case 11:if(t.t1=i=t.sent,t.t0=null!==t.t1,!t.t0){t.next=15;break}t.t0=void 0!==i;case 15:if(!t.t0){t.next=19;break}t.t2=i,t.next=20;break;case 19:t.t2={};case 20:return c=t.t2,h=c.score,p=c.rank,zx.setStorageData("leaderboard_content","previousScore",h),zx.setStorageData("leaderboard_content","previousRank",p),d={level:s,isMatchStartFromLoader:!0},t.next=28,Promise.all([e.untilGameSceneResourcesLoaded(),yn.waitTweenAsync(.3)]);case 28:Hl.switchScene($s,d),t.next=35;break;case 31:return t.prev=31,t.t3=t.catch(0),console.error(t.t3),t.abrupt("return");case 35:case"end":return t.stop()}}),t,null,[[0,31]])}))),e.onNavigate=function(){var t=Ae(Se().mark((function t(n){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.firstNavigation&&(e.firstNavigation=!1,e.pageManager.unmountAndHideAll()),t.t0=n.to,t.next=t.t0===Bs.store?4:t.t0===Bs.collections?10:t.t0===Bs.tournaments?13:t.t0===Bs.leaderboard?16:t.t0===Bs.home?19:22;break;case 4:return e.navManager.setIgnoreInput(),t.next=7,e.pageManager.navigate(n);case 7:return e.handleNavigateToStore(),e.navManager.setIgnoreInput(!1),t.abrupt("break",23);case 10:return t.next=12,e.onNavigateToCollections(ke(ke({},n),{},{to:Bs.collections}));case 12:return t.abrupt("break",23);case 13:return t.next=15,e.onNavigateToTournaments(n);case 15:return t.abrupt("break",23);case 16:return t.next=18,e.onNavigateToLeaderboard(ke(ke({},n),{},{to:Bs.leaderboard}));case 18:return t.abrupt("break",23);case 19:return t.next=21,e.handleNavigateToHome(n);case 21:return t.abrupt("break",23);case 22:throw new Error("DashboardScene: Unhandled page name");case 23:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleEventButtonPress=function(e){switch(e.type){case pg.STAR_CHEST:nu.openScreen(yi);break;case pg.BALLOON:nu.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}},e}return Pe(u,[{key:"__preload",value:function(){this.panelAnimationController=this.getComponent(wr),this.validateRequiredComponents(),this.listenNavigationEvents(),this.listenDashboardEvents(),this.panelAnimationController.init()}},{key:"listenNavigationEvents",value:function(){this.node.scene.on(Ds,this.onNavigate)}},{key:"listenDashboardEvents",value:function(){this.node.scene.on(Os,this.handlePlayButtonPress),this.node.scene.on(Fs,this.handleEventButtonPress)}},{key:"onLoad",value:function(){this.coinManager.init(this.pageAnimSkipOverlay),kl.init(),this.setPlayerLevel(),this.preloadGameSceneResources(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(kl.getCollectionUnlockProgress())}},{key:"setPlayerLevel",value:function(){var e,t=(null!==(e=Ux.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;n=0===n?1:n,Ux.setGameData({level:n})}},{key:"preloadGameSceneResources",value:(s=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.hasLoadedGameSceneResourcesFinish=!0,this.node.emit(Ns);case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"untilGameSceneResourcesLoaded",value:function(){var e=this;return new Promise((function(t){e.hasLoadedGameSceneResourcesFinish?t():e.node.once(Ns,(function(){t()}))}))}},{key:"start",value:function(){Ux.getPlayerSetting("music")&&wi.playMusic(),this.playBgAnim(),this.navManager.selectDefaultNavBtn(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function(){Hl.preloadGameScene()}},{key:"initBgComp",value:function(){var e,t=zx.getStorage("dashboard");if(null==t)throw new Error("DashboardScene: dashboardStorage not found");var n=null!==(e=t.animateToCurrentLevel)&&void 0!==e&&e,i=ke({},t.lastMapPayload),a=kl.getCurrentMapProgress(),r=i.currentTheme===a.currentTheme&&i.nextTheme===a.nextTheme,o=a.currentTheme;n&&!r?this.bgComp.setCurrentTheme(i.currentTheme):this.bgComp.setCurrentTheme(o)}},{key:"getPlayerLeader",value:(o=Ae(Se().mark((function e(t){var n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n="global"==t?qs:Vs){e.next=3;break}return e.abrupt("return",null);case 3:return i=Ux.getPlayerId(),e.next=6,Hx.getLeadersByPlayerIdsAsync(n,[i]);case 6:if(0!==(a=e.sent).length){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",a[0]);case 10:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"updateCurrentMapInStorage",value:function(e){zx.setStorageData("dashboard","animateToCurrentLevel",!1),zx.setStorageData("dashboard","lastMapPayload",e)}},{key:"updateVolumeBackgroundMusic",value:function(){wi.turnUpMusic()}},{key:"checkDailyRewardsOpenable",value:function(){var e=Ux.getPlayerData().dailyRewarded,t=e.logDays,n=void 0===t?[]:t,i=e.lastRewarded,a=void 0===i?0:i;if(n.length>Wx.MaxDays)return!0;if(Wx.MockTime>0&&Date.now()-a>=1e3*Wx.MockTime)return!0;return!jx.isToday(a)}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"handleNavigateToStore",value:function(){}},{key:"onNavigateToCollections",value:(r=Ae(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),n=kl.getCollectionUnlockProgress(),i=this.getCurrentUnlockingTheme(),e.next=5,this.pageManager.navigate(t,(function(e){return(a=e.getContainer().getComponentInChildren(eE)).updateUnlockedProgress(n),Promise.resolve()}));case 5:if(void 0!==a){e.next=7;break}throw new Error("CollectionsContent not found");case 7:if(r=new ha,!(o=a.shouldAnimateThemeTabUnlock())){e.next=12;break}return e.next=12,this.pageAnimSkipOverlay.open({onSkip:function(){return r.abort()},opacity:200});case 12:if(!this.isFirstNavToCollections||null===i){e.next=16;break}return e.next=15,a.scrollToCurrentUnlockingTheme(i.skin,r);case 15:this.isFirstNavToCollections=!1;case 16:return e.next=18,a.playThemeTabUnlockAnim(r);case 18:if(!o){e.next=21;break}return e.next=21,this.pageAnimSkipOverlay.close();case 21:r.abort(),this.navManager.setIgnoreInput(!1);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"onNavigateToTournaments",value:(a=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t);case 3:this.navManager.setIgnoreInput(!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"onNavigateToLeaderboard",value:(i=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t);case 3:this.navManager.setIgnoreInput(!1);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"setHomeDataAndGetNavAnim",value:function(){var e,t,n,i,a,r=this,o=this.pageManager.getPage(Bs.home).getContainer().getComponentInChildren(px);this.coinManager.setTargetContainer(o.getCoinContainer());var s=`Level ${null!==(e=null===(t=Ux.getGameData())||void 0===t?void 0:t.level)&&void 0!==e?e:1}`;o.setPlayButtonLabel(s),this.coinManager.emitCoinAmount();var l=null!==(n=null===(i=Ux.getGameData())||void 0===i?void 0:i.stars)&&void 0!==n?n:0;o.updateStarProgress(l);var u=zx.getStorage("dashboard");if(null==u)throw new Error("DashboardScene: dashboardStorage not found");var c=null!==(a=u.animateToCurrentLevel)&&void 0!==a&&a,h=ke({},u.lastMapPayload),p=ke({},kl.getCurrentMapProgress());if(zx.getStorage("tournament").animateTournamentLeader)return o.setUnlockProgress(p),Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.navManager.selectByType(Bs.tournaments);case 2:case"end":return e.stop()}}),e)})));if(Yx.encode(h)===Yx.encode(p))o.setUnlockProgress(p);else if(c){var d=pl.mapOrder.findIndex((function(e){return e.id===h.id})),f=pl.mapOrder.findIndex((function(e){return e.id===p.id})),v=d===f;if(-1===d||-1===f)throw new Error("DashboardScene: map not found");
//! safe guard against dev tools time travel
if(!(d>f)){var y=pl.mapOrder.slice(d,f+2),m=new ha,g=o.prepareUnlockProgressAnimation(h,p,y,m);return Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.pageAnimSkipOverlay.open({onSkip:function(){return m.abort()},opacity:150});case 2:return e.next=4,g();case 4:if(m.aborted||v){e.next=7;break}return e.next=7,r.navManager.selectByType(Bs.collections);case 7:return e.next=9,r.pageAnimSkipOverlay.close();case 9:case"end":return e.stop()}}),e)})))}o.setUnlockProgress(p)}else o.setUnlockProgress(p)}},{key:"handleNavigateToHome",value:(n=Ae(Se().mark((function e(t){var n,i,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.navManager.setIgnoreInput(),e.next=3,this.pageManager.navigate(t,Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=a.setHomeDataAndGetNavAnim();case 1:case"end":return e.stop()}}),e)}))));case 3:return this.navManager.setIgnoreInput(!1),e.next=6,this.tryOpenDailyRewardsScreen();case 6:return e.next=8,this.coinManager.untilFinishesCollectAnim();case 8:return e.next=10,this.pageAnimSkipOverlay.untilClosed();case 10:return e.next=12,null===(n=i)||void 0===n?void 0:n();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"tryOpenDailyRewardsScreen",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkDailyRewardsOpenable()){e.next=2;break}return e.abrupt("return");case 2:return nu.openScreen(vi),e.abrupt("return",new Promise((function(e){Gx.on(qx.CLOSED_SCREEN,(function t(n){n.screenName===vi&&(e(),Gx.off(qx.CLOSED_SCREEN,t))}))})));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getCurrentUnlockingTheme",value:function(){var e=kl.getCollectionUnlockProgress();if(0===e.length)return null;var t,n=e[0],i=je(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.isLocked||(n=a)}}catch(e){i.e(e)}finally{i.f()}return n}}]),u}(f)).prototype,"coinManager",[fx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sx=$e(wx.prototype,"navManager",[vx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cx=$e(wx.prototype,"bgComp",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ex=$e(wx.prototype,"pageManager",[mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ax=$e(wx.prototype,"pageAnimSkipOverlay",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bx=wx))||bx);n._RF.pop(),n._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);var Xx,$x=i.ccclass,Jx=i.property,Qx=globalThis.game.player,Zx=GameCore.Utils.Number.getShortNumber;Ix=$x("HomePage"),_x=Jx({type:u,group:"Placeholders"}),Ix((Dx=$e((Ox=function(e){Ie(o,e);var t,n,i,a,r=Be(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"coinLabel",Dx,Ne(e)),e}return Pe(o,[{key:"__preload",value:function(){var e;null===(e=ze(_e(o.prototype),"__preload",this))||void 0===e||e.call(this),this.validateOwnRequiredComponents(),this.listenToCoinUpdateEvent()}},{key:"listenToCoinUpdateEvent",value:function(){this.node.scene.on(tr.COIN_CHANGED,this.updateplaceholderCoins,this)}},{key:"updateplaceholderCoins",value:(a=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.coinLabel.string=Zx(t.coins,3);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"mount",value:(i=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(_e(o.prototype),"mount",this).call(this);case 2:if(this.homeContent){e.next=6;break}if(this.homeContent=this.container.getComponentInChildren(px),this.homeContent){e.next=6;break}throw new Error("HomePage: homeContent not found");case 6:i=null!==(t=null===(n=Qx.getGameData())||void 0===n?void 0:n.coins)&&void 0!==t?t:0,this.updateplaceholderCoins({coins:i});case 8:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(_e(o.prototype),"transitionIn",this).call(this);case 2:this.homeContent.enableUIAnimator();case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.homeContent.disableUIAnimator(),e.next=3,ze(_e(o.prototype),"transitionOut",this).call(this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"validateOwnRequiredComponents",value:function(){if(!this.coinLabel)throw new Error("HomePage: coinLabel not found")}}]),o}(qS)).prototype,"coinLabel",[_x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lx=Ox));n._RF.pop(),n._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);var eP,tP,nP,iP,aP,rP,oP,sP,lP,uP,cP,hP,pP,dP,fP,vP,yP,mP,gP,bP,wP=(0,i.ccclass)("LeaderboardIsEmpty")(Xx=function(e){Ie(i,e);var t,n=Be(i);function i(){return Te(this,i),n.apply(this,arguments)}return Pe(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"show",value:(t=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uiOpacity.opacity=255,t=this.node.position.clone(),(n=S(this.node)).to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)}),(i=S(this.node).repeat(2,n)).to(.05,{position:t}),e.next=9,yn.runTweenAsync(i);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hide",value:function(){this.uiOpacity.opacity=0}}]),i}(f))||Xx;n._RF.pop(),n._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);var kP,SP,CP,EP,AP,TP,xP,PP=i.ccclass,RP=i.property,IP=i.requireComponent,_P=globalThis.game.analytics,LP=(eP=PP("SwitchButton"),tP=IP([p,y]),nP=RP(H),iP=RP(a),aP=RP(a),rP=RP(H),oP=RP({visible(){return this.useSound},type:ii}),sP=RP(H),lP=RP({visible(){return this.useDesktopHover},type:_}),uP=RP({visible(){return this.useDesktopHover},type:_}),eP(cP=tP((pP=$e((hP=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"enable",pP,Ne(e)),Xe(e,"nodeOn",dP,Ne(e)),Xe(e,"nodeOff",fP,Ne(e)),Xe(e,"useSound",vP,Ne(e)),Xe(e,"soundKey",yP,Ne(e)),Xe(e,"useDesktopHover",mP,Ne(e)),Xe(e,"mouseEnterClip",gP,Ne(e)),Xe(e,"mouseLeaveClip",bP,Ne(e)),e.isMouseLeaved=!1,e.onMouseEnter=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved=!1,e.animationComponent.play(e.mouseEnterClip.name))},e.onMouseLeave=function(t){e.useDesktopHover&&e.buttonComponent.interactable&&(e.isMouseLeaved||(e.isMouseLeaved=!0,e.animationComponent.play(e.mouseLeaveClip.name)))},e}return Pe(n,[{key:"__preload",value:function(){this.buttonComponent=this.getComponent(p),this.animationComponent=this.getComponent(y),this.validateRequiredComponents()}},{key:"onLoad",value:function(){var e=this.animationComponent.clips.map((function(e){return null==e?void 0:e.name})).filter((function(e){return null!=e&&"string"==typeof e}));this.useDesktopHover&&(e.includes(this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),e.includes(this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"onEnable",value:function(){this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"switch",value:function(){return!!this.node.active&&(_P.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&wi.playSound(ai[this.soundKey]),this.updateStatus(!this.enable))}},{key:"setEnabled",value:function(e){this.node.active&&this.updateStatus(e)}},{key:"updateStatus",value:function(e){return this.enable===e||(this.onMouseLeave(null),this.enable=e,this.nodeOn.active=e,this.nodeOff.active=!e),this.enable}}]),n}(f)).prototype,"enable",[nP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),dP=$e(hP.prototype,"nodeOn",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fP=$e(hP.prototype,"nodeOff",[aP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vP=$e(hP.prototype,"useSound",[rP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),yP=$e(hP.prototype,"soundKey",[oP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ii[ti.BUTTON_CLICK]}}),mP=$e(hP.prototype,"useDesktopHover",[sP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),gP=$e(hP.prototype,"mouseEnterClip",[lP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bP=$e(hP.prototype,"mouseLeaveClip",[uP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cP=hP))||cP)||cP);n._RF.pop(),n._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);var OP,DP,MP,NP,FP,BP=i.ccclass,GP=i.property,zP=globalThis.game.analytics,UP=(kP=BP("Tabs"),SP=GP(LP),CP=GP(LP),kP((TP=$e((AP=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"tabWorld",TP,Ne(e)),Xe(e,"tabFriends",xP,Ne(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}},{key:"setInteractableButtons",value:function(e){this.tabWorld.getComponent(p).interactable=e,this.tabFriends.getComponent(p).interactable=e}},{key:"updateStatus",value:function(e){this.tabWorld.setEnabled("global"===e),this.tabFriends.setEnabled("friends"===e)}},{key:"handleTabWorldSelect",value:function(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),zP.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:bi.getCurrentPage()}),this.node.scene.emit(fg.WORLD_TAB_SELECTED)}},{key:"handleTabFriendsSelect",value:function(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),zP.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:this.node.name,screen_name:bi.getCurrentPage()}),this.node.scene.emit(fg.FRIENDS_TAB_SELECTED)}}]),n}(f)).prototype,"tabWorld",[SP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xP=$e(AP.prototype,"tabFriends",[CP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EP=AP))||EP);n._RF.pop(),n._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);var HP,qP,VP,WP,KP,jP,YP,XP,$P,JP,QP,ZP,eR,tR,nR,iR,aR,rR,oR,sR,lR,uR,cR,hR,pR,dR,fR,vR,yR,mR,gR,bR,wR,kR,SR,CR,ER,AR,TR,xR,PR,RR=i.ccclass,IR=i.disallowMultiple,_R=i.property,LR=(OP=RR("LeaderSkeleton"),DP=_R(a),OP(MP=IR((FP=$e((NP=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"container",FP,Ne(e)),e}return Pe(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"hide",value:(n=Ae(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Ae(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,i=this.container.position.clone(),this.container.position=new j(i.x,i.y-100,i.z),(a=S(this.node).delay(t)).to(.2,{scale:j.ONE},{easing:"cubicOut"}),(r=S(this.container).delay(t)).to(.2,{position:i},{easing:"cubicOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),e.next=13,Promise.all([yn.runTweenAsync(a,n),yn.runTweenAsync(r,n),yn.runTweenAsync(o,n)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(f)).prototype,"container",[DP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MP=NP))||MP)||MP);n._RF.pop(),n._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);var OR,DR,MR,NR,FR,BR,GR,zR,UR,HR,qR,VR,WR,KR=i.ccclass,jR=i.property,YR=(HP=KR("Leader"),qP=jR(u),VP=jR(M),WP=jR({type:a,group:"Container"}),KP=jR({type:T,group:"Background"}),jP=jR({type:O,group:"Background"}),YP=jR({type:T,group:"Rank"}),XP=jR({type:u,group:"Rank"}),$P=jR({type:O,group:"Rank"}),JP=jR({type:O,group:"Rank"}),QP=jR({type:O,group:"Rank"}),ZP=jR({type:O,group:"Rank"}),eR=jR({type:T,group:"Avatar"}),tR=jR({type:M,group:"Avatar"}),nR=jR({type:T,group:"Score"}),iR=jR({type:u,group:"Score"}),aR=jR({type:O,group:"Score"}),rR=jR({type:M,group:"Score"}),oR=jR({type:M}),sR=jR({type:s}),HP((cR=$e((uR=function(e){Ie(l,e);var t,n,i,a,o,s=Be(l);function l(){var e;Te(this,l);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=s.call.apply(s,[this].concat(n)),"nameLabel",cR,Ne(e)),Xe(e,"nameOpacity",hR,Ne(e)),Xe(e,"container",pR,Ne(e)),Xe(e,"background",dR,Ne(e)),Xe(e,"highlightBackground",fR,Ne(e)),Xe(e,"rankSprite",vR,Ne(e)),Xe(e,"rankLabel",yR,Ne(e)),Xe(e,"goldRank",mR,Ne(e)),Xe(e,"silverRank",gR,Ne(e)),Xe(e,"bronzeRank",bR,Ne(e)),Xe(e,"highlightRank",wR,Ne(e)),Xe(e,"avatar",kR,Ne(e)),Xe(e,"avatarOpacity",SR,Ne(e)),Xe(e,"scoreBackground",CR,Ne(e)),Xe(e,"scoreLabel",ER,Ne(e)),Xe(e,"highlightScoreBackground",AR,Ne(e)),Xe(e,"scoreOpacity",TR,Ne(e)),Xe(e,"uiOpacity",xR,Ne(e)),Xe(e,"uiTransform",PR,Ne(e)),e}return Pe(l,[{key:"onLoad",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e,t){this.updateBackground(e),this.updateRank(e,t),this.resetPhoto(),this.updateUsername(e),this.updateScore(e)}},{key:"updateBackground",value:function(e){this.background.spriteFrame=e.isHighlight?this.highlightBackground:this.defaultBackground}},{key:"updateRank",value:function(e,t){var n=e.rank;if(this.rankLabel.string!==n.toString()){this.rankLabel.string=t&&n>t?`${t}+`:n.toString(),this.rankSprite.spriteFrame=this.defaultRank;var i=new r(bg);switch(e.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,i=new r(kg)),n){case 1:this.rankSprite.spriteFrame=this.goldRank,i=new r(vg);break;case 2:this.rankSprite.spriteFrame=this.silverRank,i=new r(yg);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,i=new r(mg)}this.rankLabel.shadowColor=i,this.rankLabel.outlineColor=i}}},{key:"setPhoto",value:function(e){e&&this.node.active&&(e.packable=!0,this.avatar.spriteFrame=e)}},{key:"resetPhoto",value:(o=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.defaultAvatar){e.next=7;break}return e.next=3,Jn.loadSpriteFrameAsync("images/avatar-bg/spriteFrame");case 3:if(t=e.sent){e.next=6;break}return e.abrupt("return");case 6:this.defaultAvatar=t;case 7:this.avatar.spriteFrame=this.defaultAvatar;case 8:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"updateUsername",value:function(e){this.nameLabel.string=e.name,this.nameLabel.color=new r(e.isHighlight?wg:gg)}},{key:"updateScore",value:function(e){var t=Math.floor(e.score);this.scoreLabel.string=GameCore.Utils.Number.getShortNumber(t,7);var n=this.scoreLabel.getComponent(u);n.outlineColor=new r(e.isHighlight?kg:bg),n.shadowColor=new r(e.isHighlight?kg:bg),this.scoreBackground.spriteFrame=e.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}},{key:"runShowUpAnimation",value:(a=Ae(Se().mark((function e(t,n){var i,a,r,o,s,l=this,u=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=u.length>2&&void 0!==u[2]?u[2]:.3,this.node.scale=new j(.8,.8,.8),this.setOpacity(0),a=this.container.position.clone(),this.container.position=new j(a.x,a.y-100,a.z),(r=S(this.node).delay(n)).to(i,{scale:j.ONE},{easing:"elasticOut"}),(o=S(this.container).delay(n)).to(i,{position:a},{easing:"backOut"}),(s=S(this.uiOpacity).delay(n)).to(i,{opacity:255},{easing:"cubicOut",onUpdate:function(){l.nameOpacity.opacity=l.uiOpacity.opacity,l.scoreOpacity.opacity=l.uiOpacity.opacity,l.avatarOpacity.opacity=l.uiOpacity.opacity}}),t.addAbortListener((function(){l.node.scale=j.ONE,l.container.position=a,l.uiOpacity.opacity=255,l.avatar.node.active=!0})),e.next=14,Promise.all([yn.runTweenAsync(r,t),yn.runTweenAsync(o,t),yn.runTweenAsync(s,t)]);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"runWorldPositionAnimation",value:(i=Ae(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=S(this.node).to(n,{worldPosition:t},{easing:"quadOut"}),e.next=3,yn.runTweenAsync(i);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"runScaleAnimation",value:(n=Ae(Se().mark((function e(t,n,i){var a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=S(this.node).to(i,{scale:new j(n,n,n)},{easing:"backOut"}),e.next=3,yn.runTweenAsync(a,t);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t,i){return n.apply(this,arguments)})},{key:"runUpdateDataAnimation",value:(t=Ae(Se().mark((function e(t,n,i,a,r){var o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=S({}).to(r,{},{easing:"quartOut",onUpdate:function(e,r){if(r){var o=Math.floor(t+(n-t)*r),l=Math.floor(i+(a-i)*r);s.updateRank({rank:o,isHighlight:!0}),s.updateScore({score:l,isHighlight:!0})}}}),e.next=3,yn.runTweenAsync(o);case 3:case"end":return e.stop()}}),e)}))),function(e,n,i,a,r){return t.apply(this,arguments)})},{key:"setOpacity",value:function(e){this.uiOpacity.opacity=e,this.nameOpacity.opacity=e,this.scoreOpacity.opacity=e,this.avatarOpacity.opacity=e}}]),l}(f)).prototype,"nameLabel",[qP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hR=$e(uR.prototype,"nameOpacity",[VP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pR=$e(uR.prototype,"container",[WP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dR=$e(uR.prototype,"background",[KP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fR=$e(uR.prototype,"highlightBackground",[jP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vR=$e(uR.prototype,"rankSprite",[YP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yR=$e(uR.prototype,"rankLabel",[XP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mR=$e(uR.prototype,"goldRank",[$P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gR=$e(uR.prototype,"silverRank",[JP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bR=$e(uR.prototype,"bronzeRank",[QP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wR=$e(uR.prototype,"highlightRank",[ZP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kR=$e(uR.prototype,"avatar",[eR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SR=$e(uR.prototype,"avatarOpacity",[tR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CR=$e(uR.prototype,"scoreBackground",[nR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ER=$e(uR.prototype,"scoreLabel",[iR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AR=$e(uR.prototype,"highlightScoreBackground",[aR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TR=$e(uR.prototype,"scoreOpacity",[rR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xR=$e(uR.prototype,"uiOpacity",[oR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PR=$e(uR.prototype,"uiTransform",[sR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lR=uR))||lR);n._RF.pop(),n._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);var XR,$R,JR,QR,ZR,eI,tI,nI,iI,aI,rI,oI,sI,lI,uI,cI,hI,pI=i.ccclass,dI=i.property,fI=globalThis.game,vI=fI.player,yI=fI.frameCapture,mI=(OR=pI("Leaders"),DR=dI(R),MR=dI(a),NR=dI(A),FR=dI(s),BR=dI(g),OR((UR=$e((zR=function(e){Ie(u,e);var t,n,i,a,r,o=Be(u);function u(){var e;Te(this,u);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=o.call.apply(o,[this].concat(n)),"leaderPrefab",UR,Ne(e)),Xe(e,"inactiveNodeContainer",HR,Ne(e)),Xe(e,"layout",qR,Ne(e)),Xe(e,"viewport",VR,Ne(e)),Xe(e,"maxLeader",WR,Ne(e)),e.cachedPhotos=new Map,e.leaderData=[],e.leaderPoolArray=[],e.playerLeader=null,e.isHidden=!0,e}return Pe(u,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.batchNodes=this.getComponents(gs),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"__preload",value:function(){this.currentPlayerId=vI.getPlayerId();for(var e=0;e<this.maxLeader;e++){var t=this.createLeader();this.leaderPoolArray.push(t)}var n=this.leaderPoolArray[0].uiTransform.contentSize;this.leaderContentHeight=n.height+this.layout.spacingY}},{key:"createLeader",value:function(){var e=l(this.leaderPrefab);return this.addLeaderToInactiveNode(e),e.getComponent(YR)}},{key:"updateData",value:(r=Ae(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.playerLeader=null,this.isHidden=!1,this.leaderData=t,this.leaderData.sort((function(e,t){return t.score-e.score})),null!=vI){e.next=6;break}throw new Error("Player is not defined");case 6:return this.batchNodes.every((function(e){return e.enabled=!0})),e.next=9,Promise.all(this.leaderData.map((function(e,t){var i=e.playerId,a=e.photo,r=e.score,o=e.name,s=n.currentPlayerId===i;n.leaderData[t].rank=t+1;var l=n.maxLeader-1;if(!(t>=l)||s){var u=s&&t>l-1?n.leaderPoolArray[l]:n.leaderPoolArray[t];return n.layout.node.addChild(u.node),u.setOpacity(0),s&&(n.playerLeader=u),u.updateInfo({isHighlight:s,name:o,photo:a,rank:t+1,score:r},l),n.getAndSetLeaderPhoto({playerId:i,url:a,leader:u})}})));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getAndSetLeaderPhoto",value:(a=Ae(Se().mark((function e(t){var n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.playerId,i=t.url,a=t.leader,"default"!==i){e.next=3;break}return e.abrupt("return");case 3:if(!this.cachedPhotos.has(n)){e.next=6;break}return a.setPhoto(this.cachedPhotos.get(n)),e.abrupt("return");case 6:return e.prev=6,e.next=9,this.loadAvatarImage(i,85,85,n);case 9:if(r=e.sent){e.next=12;break}return e.abrupt("return");case 12:o=O.createWithImage(r),this.cachedPhotos.set(n,o),a.setPhoto(o),e.next=23;break;case 17:if(e.prev=17,e.t0=e.catch(6),!(e.t0 instanceof DOMException&&"AbortError"===e.t0.name)){e.next=22;break}return console.info("Leaders: getAndSetLeaderPhoto was aborted"),e.abrupt("return");case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[6,17]])}))),function(e){return a.apply(this,arguments)})},{key:"removeLeaders",value:function(){var e=this;this.isHidden=!0,this.getActiveLeaders().forEach((function(t){t.resetPhoto(),e.addLeaderToInactiveNode(t.node)})),this.batchNodes.every((function(e){return e.enabled=!1}))}},{key:"getActiveLeaders",value:function(){var e=this;return this.leaderPoolArray.filter((function(t){return t.node.parent===e.layout.node}))}},{key:"getActiveLeaderChildren",value:function(){return this.layout.getComponentsInChildren(YR)}},{key:"showLeaders",value:(i=Ae(Se().mark((function e(t){var n,i,a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isHidden){e.next=2;break}return e.abrupt("return");case 2:if(!((n=this.getActiveLeaders()).length<1)){e.next=5;break}return e.abrupt("return");case 5:return i=Math.ceil(this.viewport.contentSize.height/this.leaderContentHeight),a=Math.min(n.length,i),e.next=10,Promise.all(n.map(function(){var e=Ae(Se().mark((function e(n,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.isHidden){e.next=2;break}return e.abrupt("return");case 2:if(!(i<a)){e.next=5;break}return e.next=5,n.runShowUpAnimation(t,.1*i,.3);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"runUpdateLeadersRankAnimation",value:(n=Ae(Se().mark((function e(t,n){var i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=null!=t?t:0,a=null!=n?n:this.leaderData.length,a=Math.min(a,100),r=this.getActiveLeaderChildren(),o=this.leaderContentHeight,s=[],l=i;l<a;l++)r[l].updateRank({rank:l+1,isHighlight:!1}),u=r[l].node.worldPosition.clone(),s.push(r[l].runWorldPositionAnimation(u.add3f(0,-o,0),.25));return e.next=9,Promise.all(s);case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getLeaderData",value:function(){return this.leaderData}},{key:"getPlayerLeader",value:function(){return this.playerLeader}},{key:"getLeaderByRank",value:function(e){return this.getActiveLeaders()[e-1]||null}},{key:"getLeaderDataByRank",value:function(e){return this.leaderData[e-1]||null}},{key:"updateVisibility",value:function(){var e=this.viewport.getBoundingBoxToWorld(),t=e.yMax,n=e.yMin;this.getActiveLeaders().forEach((function(e){var i=e.uiTransform;if(void 0!==i){var a=i.getBoundingBoxToWorld(),r=a.yMax,o=a.yMin,s=r<n||o>t;e.setOpacity(s?0:255)}}))}},{key:"loadAvatarImage",value:(t=Ae(Se().mark((function e(t,n,i,a){var r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,yI.captureAsync({width:n,height:i,name:"LeaderAvatar",renderOptions:{[a]:{name:a,type:"image",depth:0,position:[0,0],size:[n,i],image:t}}});case 3:if(r=e.sent){e.next=6;break}return e.abrupt("return",null);case 6:return e.next=8,GameCore.Utils.Image.loadImage(r);case 8:return e.abrupt("return",e.sent);case 11:return e.prev=11,e.t0=e.catch(0),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),function(e,n,i,a){return t.apply(this,arguments)})},{key:"addLeaderToInactiveNode",value:function(e){this.inactiveNodeContainer.addChild(e),e.getComponent(YR).setOpacity(0)}}]),u}(f)).prototype,"leaderPrefab",[DR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HR=$e(zR.prototype,"inactiveNodeContainer",[MR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qR=$e(zR.prototype,"layout",[NR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VR=$e(zR.prototype,"viewport",[FR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WR=$e(zR.prototype,"maxLeader",[BR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GR=zR))||GR);n._RF.pop(),n._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);var gI,bI=i.ccclass,wI=i.property,kI=globalThis.game,SI=kI.storage,CI=kI.leaderboard,EI=kI.player,AI=(XR=bI("LeaderboardContent"),$R=wI(Pr),JR=wI(UP),QR=wI(mI),ZR=wI(le),eI=wI({type:[LR]}),tI=wI(wP),nI=wI(ga),XR((rI=$e((aI=function(e){Ie(c,e);var t,n,i,a,r,o,l,u=Be(c);function c(){var e;Te(this,c);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=u.call.apply(u,[this].concat(n)),"panelAnimator",rI,Ne(e)),Xe(e,"tabs",oI,Ne(e)),Xe(e,"leaders",sI,Ne(e)),Xe(e,"scrollview",lI,Ne(e)),Xe(e,"leaderSkeletons",uI,Ne(e)),Xe(e,"leaderboardIsEmpty",cI,Ne(e)),Xe(e,"contentOpacity",hI,Ne(e)),e.isHidden=!0,e.currentLb=null,e.animAbortSignal=null,e.fetchAbortController=null,e.handleUpdateVisibility=function(){e.leaders.updateVisibility()},e.handleFriendsTabSelected=Ae(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return SI.setStorageData("leaderboard_content","lastTabOpened","friends"),e.cleanupSideEffects(),t.next=4,e.updateStatus("friends");case 4:case"end":return t.stop()}}),t)}))),e.handleWorldTabSelected=Ae(Se().mark((function t(){return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return SI.setStorageData("leaderboard_content","lastTabOpened","global"),e.cleanupSideEffects(),t.next=4,e.updateStatus("global");case 4:case"end":return t.stop()}}),t)}))),e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return Pe(c,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"listenEvents",value:function(){this.node.scene.on(fg.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(fg.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(tr.HIDE_UI,this.hideContent),this.node.scene.on(tr.SHOW_UI,this.showContent),this.scrollview.node.on(le.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenEvents",value:function(){this.node.scene.off(fg.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(fg.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents(),this.scrollview.node.off(le.EventType.SCROLLING,this.handleUpdateVisibility)}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(tr.HIDE_UI,this.hideContent),this.node.scene.off(tr.SHOW_UI,this.showContent)}},{key:"loadLeaderboard",value:(l=Ae(Se().mark((function e(t,n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.aborted){e.next=2;break}return e.abrupt("return",null);case 2:if(i=this.getLeaderboardName(t)){e.next=5;break}return e.abrupt("return",null);case 5:return a=GameCore.Configs.Leaderboards.Limit,e.next=8,CI.requestLeaderboardAsync(i,a);case 8:if(!n.aborted){e.next=10;break}return e.abrupt("return",null);case 10:return e.abrupt("return",CI.getLeaderboard(i));case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"getLeaderboardName",value:function(e){return"friends"===e?Vs:qs}},{key:"loadMoreLeaderboard",value:(o=Ae(Se().mark((function e(t,n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.aborted){e.next=2;break}return e.abrupt("return",null);case 2:if(i=this.getLeaderboardName(t)){e.next=5;break}return e.abrupt("return",null);case 5:return e.next=7,CI.loadMoreLeaderboardAsync(i,1e3);case 7:if(!n.aborted){e.next=9;break}return e.abrupt("return",null);case 9:return e.abrupt("return",CI.getLeaderboard(i));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"showLoading",value:(r=Ae(Se().mark((function e(t){var n,i=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:0,this.scrollview.scrollToTop(0),this.scrollview.enabled=!1,e.next=5,Promise.all([this.leaderSkeletons.map((function(e,i){return e.show(i*n,t)}))]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"hideLoading",value:(a=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.leaderSkeletons.map((function(e){return e.hide(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"enter",value:function(){this.listenEvents(),this.isHidden=!1;var e=SI.getStorageData("leaderboard_content","lastTabOpened");"friends"===e&&this.handleFriendsTabSelected(),"global"===e&&this.handleWorldTabSelected()}},{key:"hide",value:function(){this.isHidden=!0}},{key:"cleanup",value:function(){this.unlistenEvents(),this.cleanupSideEffects()}},{key:"cleanupSideEffects",value:function(){var e,t;null===(e=this.animAbortSignal)||void 0===e||e.abort(),this.animAbortSignal=null,null===(t=this.fetchAbortController)||void 0===t||t.abort(),this.fetchAbortController=null,this.leaders.removeLeaders(),this.leaderboardIsEmpty.hide()}},{key:"isAborted",value:function(){var e,t,n,i,a=null===(e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===e||e,r=null===(n=null===(i=this.fetchAbortController)||void 0===i?void 0:i.signal.aborted)||void 0===n||n;return a||r}},{key:"updateStatus",value:(i=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===this.animAbortSignal&&null===this.fetchAbortController){e.next=2;break}throw new Error("LeaderboardContent: LeaderboardContent is already loading. Please handle cancelling gracefully.");case 2:if(!this.isHidden){e.next=4;break}return e.abrupt("return");case 4:return this.tabs.updateStatus(t),this.animAbortSignal=new ha,this.fetchAbortController=new AbortController,e.next=9,this.showLoading(this.animAbortSignal);case 9:return e.next=11,this.loadLeaderboard(t,this.animAbortSignal);case 11:if(this.currentLb=e.sent,this.currentLb){e.next=14;break}return e.abrupt("return");case 14:if(0!==Object.values(this.currentLb.leaders).length){e.next=19;break}return this.leaderboardIsEmpty.show(),this.tabs.setInteractableButtons(!0),this.hideLoading(this.animAbortSignal),e.abrupt("return");case 19:if(i=EI.getPlayerId(),a=this.currentLb.leaders[i]){e.next=28;break}if(!(r=this.getLeaderboardName(t))){e.next=28;break}return e.next=26,CI.getLeadersByPlayerIdsAsync(r,[i]);case 26:(o=e.sent).length>0&&(a=o[0],this.currentLb.leaders[i]=a);case 28:return s=SI.getStorage("leaderboard_content"),l=s.previousScore,u=s.previousRank,c=null!==(n=a)&&void 0!==n?n:{},h=c.score,p=c.rank,l&&l<h&&u&&u!==p&&(this.currentLb.leaders[i].score=l),d=Object.values(this.currentLb.leaders),Jn.setBlockInput(!0),this.tabs.setInteractableButtons(!1),e.next=36,this.hideLoading(this.animAbortSignal);case 36:if(!this.isAborted()){e.next=40;break}return Jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 40:return this.leaders.updateData(d),this.scrollview.enabled=!0,e.next=44,this.leaders.showLeaders(this.animAbortSignal);case 44:if(!this.isAborted()){e.next=48;break}return Jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 48:if(f=this.leaders.getPlayerLeader()){e.next=53;break}return Jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 53:return e.next=55,this.scrollToLeader(f,1);case 55:if(!this.isAborted()){e.next=59;break}return Jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 59:return e.next=61,this.runPlayerRankChangeAnimation(this.animAbortSignal,h);case 61:if(!this.isAborted()){e.next=65;break}return Jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0),e.abrupt("return");case 65:SI.setStorageData("leaderboard_content","previousScore",h),SI.setStorageData("leaderboard_content","previousRank",p),Jn.setBlockInput(!1),this.tabs.setInteractableButtons(!0);case 69:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(n=Ae(Se().mark((function e(t,n){var i,a,r,o,s,l,u,c,h,p,d,f,v,y,m;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=SI.getStorage("leaderboard_content"),(a=i.previousScore)&&!(a>=n)){e.next=3;break}return e.abrupt("return");case 3:if(r=this.leaders.getLeaderData(),-1!==(o=r.findIndex((function(e){return e.playerId===EI.getPlayerId()})))){e.next=7;break}return e.abrupt("return");case 7:if(s=r[o],l=s.score,u=s.rank,s.score=n,r.sort((function(e,t){return t.score-e.score})),r.forEach((function(e,t){e.rank=t+1})),c=this.leaders.getPlayerLeader()){e.next=15;break}return e.abrupt("return");case 15:if(u!==s.rank){e.next=18;break}return c.updateScore({score:s.score,isHighlight:!0}),e.abrupt("return");case 18:if(h=this.leaders.getLeaderByRank(s.rank)){e.next=21;break}return e.abrupt("return");case 21:return this.leaders.layout.enabled=!1,e.next=24,c.runScaleAnimation(t,1.1,.5);case 24:return p=Math.min(.5*(u-s.rank),2),d=[c.runUpdateDataAnimation(u,s.rank,l,s.score,p),this.scrollToLeader(h,p)],f=this.uiTransform.contentSize.height,v=this.scrollview.getMaxScrollOffset().y,y=-h.node.position.y-f/2,m=j.ZERO,y<0?m=new j(c.node.worldPosition.x,f+h.node.position.y,c.node.worldPosition.z):this.scrollview.getScrollOffset().y>=v-5&&(m=y<v?new j(c.node.worldPosition.x,f/2,c.node.worldPosition.z):h.node.worldPosition),m.equals(j.ZERO)||d.push(c.runWorldPositionAnimation(m,p)),e.next=34,Promise.all(d);case 34:return e.next=36,Promise.all([c.runScaleAnimation(t,1,.25),c.node.setSiblingIndex(s.rank-1),this.leaders.runUpdateLeadersRankAnimation(s.rank,u)]);case 36:this.leaders.layout.enabled=!0,this.leaders.layout.updateLayout();case 38:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"scrollToLeader",value:(t=Ae(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.uiTransform.contentSize,a=new $(0,-t.node.position.y-i.height/2),r=this.scrollview.getScrollOffset().clone(),a.y=Math.max(a.y,0),r.y=Math.max(r.y,0),o=a.y-r.y,!(Math.abs(o)<5)){e.next=8;break}return e.abrupt("return");case 8:return this.scrollview.scrollToOffset(a,n),e.abrupt("return",yn.waitTweenAsync(n));case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),c}(f)).prototype,"panelAnimator",[$R],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oI=$e(aI.prototype,"tabs",[JR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sI=$e(aI.prototype,"leaders",[QR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lI=$e(aI.prototype,"scrollview",[ZR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uI=$e(aI.prototype,"leaderSkeletons",[eI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cI=$e(aI.prototype,"leaderboardIsEmpty",[tI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hI=$e(aI.prototype,"contentOpacity",[nI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iI=aI))||iI);n._RF.pop(),n._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);var TI,xI,PI,RI,II,_I,LI,OI,DI,MI,NI,FI,BI,GI,zI,UI,HI;(0,i.ccclass)("LeaderboardPage")(gI=function(e){Ie(r,e);var t,n,i,a=Be(r);function r(){return Te(this,r),a.apply(this,arguments)}return Pe(r,[{key:"mount",value:(i=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,Jn.loadPrefabAsync(Un.LEADERBOARD_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,ze(_e(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(AI),this.content){e.next=11;break}throw new Error("LeaderboardPage: Leaders not found");case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ae(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(_e(r.prototype),"transitionIn",this).call(this);case 2:return this.content.enableUIAnimator(),t=yn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){i.node.scene.emit(tr.SHOW_UI,{onComplete:function(){e()}})})),e.next=7,Promise.all([t,n]);case 7:this.content.enter();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ae(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(_e(r.prototype),"transitionOut",this).call(this);case 2:return this.content.unlistenUIEvents(),e.next=5,new Promise((function(e){t.node.scene.emit(tr.HIDE_UI,{onComplete:function(){e()}})}));case 5:this.content.disableUIAnimator();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"unmount",value:function(){var e,t;null===(e=this.content)||void 0===e||e.hide(),null===(t=this.content)||void 0===t||t.cleanup(),ze(_e(r.prototype),"unmount",this).call(this)}}]),r}(qS));n._RF.pop(),n._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);var qI,VI,WI,KI,jI,YI=i.ccclass,XI=i.property,$I=globalThis.game,JI=$I.leaderboard,QI=$I.player,ZI=(TI=YI("TournamentBlock"),xI=XI(a),PI=XI(u),RI=XI(u),II=XI(u),_I=XI(u),LI=XI(s),OI=XI({type:[T]}),TI((NI=$e((MI=function(e){Ie(r,e);var t,n,i,a=Be(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"container",NI,Ne(e)),Xe(e,"titleLabel",FI,Ne(e)),Xe(e,"timeLabel",BI,Ne(e)),Xe(e,"playerCountLabel",GI,Ne(e)),Xe(e,"playButtonLabel",zI,Ne(e)),Xe(e,"uiTransform",UI,Ne(e)),Xe(e,"banners",HI,Ne(e)),e}return Pe(r,[{key:"onLoad",value:function(){this.uiOpacity=this.node.getComponent(M),this.validateRequiredComponents()}},{key:"activateThemeBanner",value:function(e){var t=!1;this.banners.forEach((function(n){n.node.active=n.node.name.toLowerCase()===e,n.node.active&&(t=!0)})),t||this.banners.forEach((function(e){e.node.active=e.node.name.toLowerCase()===yl.SUMMER}))}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"updateInfo",value:(i=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.payload=t,n=t.endTime,i=t.title,a=t.payload,r=a.leaderboardId,o=a.themeId,r){e.next=5;break}return e.abrupt("return");case 5:return this.setPlayerCountWaiting(),this.updateTitle(i),this.updateEndTime(n),this.updateTournamentBanner(o),s={leaders:[],isPlayerInTournament:!1},e.prev=10,e.next=13,this.getLeadersPayload(r);case 13:(l=e.sent)&&(s=l),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(10),console.error(`Fetch lb for tournament ${i}`,e.t0);case 20:this.leadersPayload=s,u=this.leadersPayload,c=u.leaders,h=u.isPlayerInTournament,p=c.length,this.updatePlayerCount(p),this.updatePlayButtonLabel(h);case 25:case"end":return e.stop()}}),e,this,[[10,17]])}))),function(e){return i.apply(this,arguments)})},{key:"updateTitle",value:function(e){e&&(this.titleLabel.string=e)}},{key:"updateEndTime",value:function(e){var t=GameCore.Utils.Time.getRelativeTime(e);this.timeLabel.string=`Ends ${t}`}},{key:"updatePlayerCount",value:function(e){this.playerCountLabel.string=`${e} `+(e>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"updateTournamentBanner",value:function(e){e?this.activateThemeBanner(e):this.activateThemeBanner(yl.SUMMER)}},{key:"updatePlayButtonLabel",value:function(e){this.playButtonLabel.string=e?"Continue":"Join"}},{key:"getLeadersPayload",value:(n=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=JI.getLeaderboardName(t)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,JI.requestLeaderboardAsync(n,0);case 5:if(i=JI.getLeaderboard(n)){e.next=8;break}return e.abrupt("return",null);case 8:for(a=Object.values(i.leaders),r=QI.getPlayerId(),o={leaders:[],player:void 0,isPlayerInTournament:!1},s=0,l=a;s<l.length;s++)(u=l[s]).playerId===r?(o.player=u,o.isPlayerInTournament=!0,o.leaders.push(u)):o.leaders.push(u);return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"runShowPopUpAnimation",value:(t=Ae(Se().mark((function e(t,n,i){var a,r,o,s,l=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,a=this.container.position.clone(),this.container.position=new j(a.x,a.y-100,a.z),(r=S(this.node).delay(t)).to(n,{scale:j.ONE},{easing:"elasticOut"}),(o=S(this.container).delay(t)).to(n,{position:a},{easing:"backOut"}),(s=S(this.uiOpacity).delay(t)).to(n,{opacity:255},{easing:"cubicOut"}),i.addAbortListener((function(){l.node.scale=j.ONE,l.container.position=a,l.uiOpacity.opacity=255})),e.next=13,Promise.all([yn.runTweenAsync(r,i),yn.runTweenAsync(o,i),yn.runTweenAsync(s,i)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n,i){return t.apply(this,arguments)})},{key:"handleOnTournamentClicked",value:function(){var e=this.payload.id||"";if(uu.validateTournamentExpired(e))return this.node.scene.emit(Zs.RELOAD_TOURNAMENT),void nu.showNotificationScreen("Tournament has ended",2);try{var t=JSON.stringify(this.payload);nu.showTournamentDetailScreen(t,"tournament_start")}catch(e){console.warn("handleOnTournamentClicked",e)}}}]),r}(f)).prototype,"container",[xI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FI=$e(MI.prototype,"titleLabel",[PI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=$e(MI.prototype,"timeLabel",[RI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GI=$e(MI.prototype,"playerCountLabel",[II],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zI=$e(MI.prototype,"playButtonLabel",[_I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UI=$e(MI.prototype,"uiTransform",[LI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HI=$e(MI.prototype,"banners",[OI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DI=MI))||DI);n._RF.pop(),n._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);var e_,t_,n_,i_,a_,r_,o_,s_,l_,u_,c_,h_=i.ccclass,p_=i.property,d_=(qI=h_("TournamentBlockSkeleton"),VI=p_(a),qI((jI=$e((KI=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"container",jI,Ne(e)),e}return Pe(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"hide",value:(n=Ae(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Ae(Se().mark((function e(t,n){var i,a,r,o,s=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,i=this.container.position.clone(),this.container.position=new j(i.x,i.y-100,i.z),(a=S(this.node).delay(t)).to(.2,{scale:j.ONE},{easing:"elasticOut"}),(r=S(this.container).delay(t)).to(.2,{position:i},{easing:"backOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),n.addAbortListener((function(){s.node.scale=j.ONE,s.container.position=i,s.uiOpacity.opacity=255})),e.next=14,Promise.all([yn.runTweenAsync(a,n),yn.runTweenAsync(r,n),yn.runTweenAsync(o,n)]);case 14:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),a}(f)).prototype,"container",[VI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WI=KI))||WI);n._RF.pop(),n._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);var f_,v_,y_,m_,g_,b_=i.ccclass,w_=i.property,k_=globalThis.game.player,S_=(e_=b_("TournamentsBoard"),t_=w_(R),n_=w_(a),i_=w_(A),a_=w_(a),e_((s_=$e((o_=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"tournamentBlockPrefab",s_,Ne(e)),e.tournamentBlockArray=[],Xe(e,"inactiveNodeContainer",l_,Ne(e)),Xe(e,"layout",u_,Ne(e)),Xe(e,"createTournamentButton",c_,Ne(e)),e}return Pe(i,[{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"start",value:function(){for(var e=0;e<20;e++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"updateData",value:function(e){var t=this,n=!1;e.forEach((function(e,i){var a=t.tournamentBlockArray[i];e.payload.playerId===k_.getPlayerId()&&(n=!0),a||(a=t.addTournamentBlock()),a.updateInfo(e),t.layout.node.addChild(a.node)})),n||this.setCreateTournamentButtonActive(!0)}},{key:"addTournamentBlock",value:function(){var e=l(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(e);var t=e.getComponent(ZI);return this.tournamentBlockArray.push(t),t}},{key:"removeTournamentBlocks",value:function(){var e=this;this.getActiveTournamentBlocks().forEach((function(t){e.inactiveNodeContainer.addChild(t.node)})),this.setCreateTournamentButtonActive(!1)}},{key:"getActiveTournamentBlocks",value:function(){var e=this;return this.tournamentBlockArray.filter((function(t){return t.node.parent===e.layout.node}))}},{key:"setCreateTournamentButtonActive",value:function(e){e?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=e}},{key:"showTournamentBlocks",value:(t=Ae(Se().mark((function e(t,n){var i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((i=this.getActiveTournamentBlocks()).length<1)){e.next=3;break}return e.abrupt("return");case 3:return a=Math.ceil(t/this.tournamentBlockContentHeight),r=Math.min(i.length,a),e.next=8,Promise.all(i.map(function(){var e=Ae(Se().mark((function e(t,i){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i>=r)){e.next=4;break}return e.next=3,t.runShowPopUpAnimation(.1*i,.3,n);case 3:return e.abrupt("return");case 4:t.uiOpacity.opacity=255;case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 8:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"updateVisibility",value:function(){var e=this.uiTransform.getBoundingBoxToWorld(),t=e.yMax,n=e.yMin;this.getActiveTournamentBlocks().forEach((function(e){var i=e.uiTransform;if(void 0!==i){var a=i.getBoundingBoxToWorld(),r=a.yMax,o=a.yMin,s=r<n||o>t;e.uiOpacity.opacity=s?0:255}}))}}]),i}(f)).prototype,"tournamentBlockPrefab",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l_=$e(o_.prototype,"inactiveNodeContainer",[n_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u_=$e(o_.prototype,"layout",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c_=$e(o_.prototype,"createTournamentButton",[a_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r_=o_))||r_);n._RF.pop(),n._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);var C_,E_,A_,T_,x_,P_,R_,I_,__,L_,O_,D_,M_,N_,F_,B_=i.ccclass,G_=i.property,z_=(f_=B_("TournamentsNotAvailable"),v_=G_(p),f_((g_=$e((m_=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"createButton",g_,Ne(e)),e}return Pe(i,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"show",value:(t=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.createButton.interactable=!0,this.uiOpacity.opacity=255,t=this.node.position.clone(),(n=S(this.node)).to(.05,{position:t.clone().add3f(5,0,0)}),n.to(.05,{position:t.clone().add3f(-5,0,0)}),(i=S(this.node).repeat(2,n)).to(.05,{position:t}),e.next=10,yn.runTweenAsync(i);case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"hide",value:function(){this.createButton.interactable=!1,this.uiOpacity.opacity=0}}]),i}(f)).prototype,"createButton",[v_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y_=m_))||y_);n._RF.pop(),n._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);var U_,H_=i.ccclass,q_=i.property,V_=globalThis.game,W_=V_.storage,K_=V_.match,j_=GameCore.Utils.Object,Y_=(C_=H_("TournamentContent"),E_=q_({type:Pr}),A_=q_(S_),T_=q_(z_),x_=q_(le),P_=q_({type:[d_]}),R_=q_(ga),C_((L_=$e((__=function(e){Ie(o,e);var t,n,i,a,r=Be(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"panelAnimator",L_,Ne(e)),Xe(e,"tournamentsBoard",O_,Ne(e)),Xe(e,"tournamentsNotAvailable",D_,Ne(e)),Xe(e,"scrollView",M_,Ne(e)),Xe(e,"skeletons",N_,Ne(e)),Xe(e,"contentOpacity",F_,Ne(e)),e.animAbortSignal=null,e.softAbortSignal=null,e.hideContent=function(){e.contentOpacity.changeStateFade(!1,.1)},e.showContent=function(){e.contentOpacity.changeStateFade(!0,.1)},e}return Pe(o,[{key:"onLoad",value:function(){this.uiTransform=this.node.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenEvents",value:function(){this.scrollView.node.on(le.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(Zs.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(tr.HIDE_UI,this.hideContent),this.node.scene.on(tr.SHOW_UI,this.showContent)}},{key:"unlistenEvents",value:function(){this.scrollView.node.off(le.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(Zs.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}},{key:"unlistenUIEvents",value:function(){this.node.scene.off(tr.HIDE_UI,this.hideContent),this.node.scene.off(tr.SHOW_UI,this.showContent)}},{key:"onScrolling",value:function(){this.tournamentsBoard.updateVisibility()}},{key:"enableUIAnimator",value:function(){this.panelAnimator.enabled=!0}},{key:"disableUIAnimator",value:function(){this.panelAnimator.enabled=!1}},{key:"enter",value:(a=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.listenEvents(),null===this.animAbortSignal&&null===this.softAbortSignal){e.next=3;break}throw new Error("TournamentContent: TournamentContent is already running");case 3:return this.animAbortSignal=new ha,this.softAbortSignal=new ha,e.next=7,this.showLoading(this.animAbortSignal);case 7:if(!this.isAborted()){e.next=9;break}return e.abrupt("return");case 9:return e.next=11,uu.requestTournamentDataAsync();case 11:if(n=e.sent,!this.isAborted()){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,this.hideLoading(this.animAbortSignal);case 16:if(!this.isAborted()){e.next=18;break}return e.abrupt("return");case 18:if(0!==n.length||null!==(t=this.softAbortSignal)&&void 0!==t&&t.aborted){e.next=21;break}return this.tournamentsNotAvailable.show(),e.abrupt("return");case 21:return this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(n),e.next=26,this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal);case 26:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"showLoading",value:(i=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.scrollView.scrollToTop(0),this.scrollView.enabled=!1,e.next=4,Promise.all([this.skeletons.map((function(e){return e.show(0,t)}))]);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"hideLoading",value:(n=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.skeletons.map((function(e){return e.hide(t)}))]);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"tryShowTournamentResult",value:function(){try{if(!W_.getStorage("tournament").animateTournamentLeader)return;var e=uu.getAllTournamentData(),t=K_.getMatchState().customData.tournamentId;if(!t)throw new Error("Tournament ID not found");var n=e.find((function(e){return e.id===t}));if(!n)throw new Error("Tournament not found");var i=JSON.stringify(n);nu.showTournamentDetailScreen(i,"tournament_end")}catch(e){W_.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",e)}}},{key:"processCreateTournament",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ll.processCreateTournamentAsync();case 3:e.next=13;break;case 5:if(e.prev=5,e.t0=e.catch(0),j_.hasOwn(e.t0,"code")){e.next=10;break}return nu.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament"),e.abrupt("return");case 10:if("USER_INPUT"!==e.t0.code){e.next=12;break}return e.abrupt("return");case 12:"INVALID_OPERATION"===e.t0.code?nu.showNotificationScreen(e.t0.message):nu.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament");case 13:this.reload();case 14:case"end":return e.stop()}}),e,this,[[0,5]])}))),function(){return t.apply(this,arguments)})},{key:"isAborted",value:function(){var e,t;return null===(e=null===(t=this.animAbortSignal)||void 0===t?void 0:t.aborted)||void 0===e||e}},{key:"cleanup",value:function(){var e;this.unlistenEvents(),null===(e=this.animAbortSignal)||void 0===e||e.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}},{key:"softAbort",value:function(){var e;null===(e=this.softAbortSignal)||void 0===e||e.abort(),this.softAbortSignal=null}},{key:"reload",value:function(){this.softAbort(),this.cleanup(),this.enter()}}]),o}(f)).prototype,"panelAnimator",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O_=$e(__.prototype,"tournamentsBoard",[A_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_=$e(__.prototype,"tournamentsNotAvailable",[T_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=$e(__.prototype,"scrollView",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N_=$e(__.prototype,"skeletons",[P_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),F_=$e(__.prototype,"contentOpacity",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I_=__))||I_);n._RF.pop(),n._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);var X_,$_,J_,Q_,Z_,eL;(0,i.ccclass)("TournamentPage")(U_=function(e){Ie(r,e);var t,n,i,a=Be(r);function r(){return Te(this,r),a.apply(this,arguments)}return Pe(r,[{key:"mount",value:(i=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.pagePrefab){e.next=5;break}return e.next=3,Jn.loadPrefabAsync(Un.TOURNAMENTS_PAGE);case 3:(t=e.sent)&&this.node&&(this.pagePrefab=t);case 5:return e.next=7,ze(_e(r.prototype),"mount",this).call(this);case 7:if(this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(Y_),this.content){e.next=11;break}throw new Error("LeaderboardPage: Leaders not found");case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"transitionIn",value:(n=Ae(Se().mark((function e(){var t,n,i=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ze(_e(r.prototype),"transitionIn",this).call(this);case 2:return this.content.enableUIAnimator(),t=yn.runTweenAsync(S(this.containerUIOpacity).to(.2,{opacity:255})),n=new Promise((function(e){i.node.scene.emit(tr.SHOW_UI,{onComplete:function(){e()}})})),e.next=7,Promise.all([t,n]);case 7:this.content.enter();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"transitionOut",value:(t=Ae(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null===(t=this.content)||void 0===t||t.softAbort(),this.content.unlistenUIEvents(),e.next=4,ze(_e(r.prototype),"transitionOut",this).call(this);case 4:return e.next=6,new Promise((function(e){n.node.scene.emit(tr.HIDE_UI,{onComplete:function(){e()}})}));case 6:this.content.disableUIAnimator();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"unmount",value:function(){var e;null===(e=this.content)||void 0===e||e.cleanup(),ze(_e(r.prototype),"unmount",this).call(this)}}]),r}(qS));n._RF.pop(),n._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);var tL,nL,iL,aL,rL,oL,sL,lL,uL,cL=i.ccclass,hL=i.property;X_=cL("EventBadge"),$_=hL(u),J_=hL(m),X_((eL=$e((Z_=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"label",eL,Ne(e)),e}return Pe(n,[{key:"text",get:function(){return this.label.string},set:function(e){this.label.string=e}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}]),n}(f)).prototype,"label",[$_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(Z_.prototype,"text",[J_],Object.getOwnPropertyDescriptor(Z_.prototype,"text"),Z_.prototype),Q_=Z_));n._RF.pop(),n._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);var pL,dL,fL,vL,yL,mL,gL,bL,wL,kL,SL,CL,EL,AL,TL,xL,PL,RL,IL,_L,LL,OL,DL,ML,NL,FL,BL,GL,zL,UL,HL,qL,VL,WL,KL,jL,YL,XL,$L,JL,QL,ZL,eO,tO,nO,iO=i.ccclass,aO=i.property;tL=iO("EventProgressBar"),nL=aO(oo),iL=aO(u),aL=aO(m),rL=aO({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),tL((lL=$e((sL=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"progressBar",lL,Ne(e)),Xe(e,"progressLabel",uL,Ne(e)),e}return Pe(n,[{key:"text",get:function(){return this.progressLabel.string},set:function(e){this.progressLabel.string=e}},{key:"progress",get:function(){return this.progressBar.progress},set:function(e){this.progressBar.progress=e}},{key:"__preload",value:function(){}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}]),n}(f)).prototype,"progressBar",[nL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uL=$e(sL.prototype,"progressLabel",[iL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(sL.prototype,"text",[aL],Object.getOwnPropertyDescriptor(sL.prototype,"text"),sL.prototype),$e(sL.prototype,"progress",[rL],Object.getOwnPropertyDescriptor(sL.prototype,"progress"),sL.prototype),oL=sL));n._RF.pop(),n._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);var rO,oO,sO,lO,uO,cO,hO,pO=i.ccclass,dO=i.property,fO=i.executeInEditMode,vO=globalThis.game.analytics;pL=pO("NavButton"),dL=dO(H),fL=dO({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),vL=dO({type:C,group:{name:"Animation"}}),yL=dO({type:C,group:{name:"Animation"}}),mL=dO({type:C,group:{name:"Animation"}}),gL=dO({type:C,group:{name:"Animation"}}),bL=dO({type:C,group:{name:"Animation"}}),wL=dO({group:{name:"Animation"}}),kL=dO({type:C,group:{name:"Animation"}}),SL=dO({type:C,group:{name:"Animation"}}),CL=dO({group:{name:"Animation"}}),EL=dO({type:C,group:{name:"Animation"}}),AL=dO({type:C,group:{name:"Animation"}}),TL=dO({type:C,group:{name:"Animation"}}),xL=dO({type:C,group:{name:"Animation"}}),PL=dO({type:s}),RL=dO(a),IL=dO(M),_L=dO({type:s}),LL=dO({type:ue(Bs)}),OL=dO(Rx),pL(DL=fO((NL=$e((ML=function(e){Ie(r,e);var t,n,i=Be(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Xe(e=i.call.apply(i,[this].concat(n)),"wip",NL,Ne(e)),Xe(e,"isSelectedInEditor",FL,Ne(e)),Xe(e,"animationDuration",BL,Ne(e)),Xe(e,"selectedSpacing",GL,Ne(e)),Xe(e,"deselectedSpacing",zL,Ne(e)),Xe(e,"selectedIconY",UL,Ne(e)),Xe(e,"selectedIconX",HL,Ne(e)),Xe(e,"selectedIconScale",qL,Ne(e)),Xe(e,"deselectedIconY",VL,Ne(e)),Xe(e,"deselectedIconX",WL,Ne(e)),Xe(e,"deselectedIconScale",KL,Ne(e)),Xe(e,"selectedTextY",jL,Ne(e)),Xe(e,"selectedTextX",YL,Ne(e)),Xe(e,"deselectedTextY",XL,Ne(e)),Xe(e,"deselectedTextX",$L,Ne(e)),Xe(e,"spacer",JL,Ne(e)),Xe(e,"icon",QL,Ne(e)),Xe(e,"text",ZL,Ne(e)),Xe(e,"uiTransform",eO,Ne(e)),Xe(e,"screenType",tO,Ne(e)),Xe(e,"navManager",nO,Ne(e)),e.isSelected=!1,e.onMouseEnter=function(t){e.isSelected||e.playHoverOnAnimation()},e.onMouseLeave=function(t){e.isSelected||e.playHoverOffAnimation()},e}return Pe(r,[{key:"isWIP",get:function(){return this.wip}},{key:"buttonType",get:function(){return this.screenType}},{key:"update",value:function(){}},{key:"onEnable",value:function(){this.node.on(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onDisable",value:function(){this.node.off(a.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(a.EventType.MOUSE_LEAVE,this.onMouseLeave)}},{key:"onEditorUpdate",value:function(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}},{key:"setSelected",value:function(){var e,t;this.isSelected||(wi.playSound(ti.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),vO.event(GameCore.Plugins.Analytics.Events.BUTTON_CLICK,{button_name:null!==(e=null===(t=this.node.parent)||void 0===t?void 0:t.name)&&void 0!==e?e:this.node.name,screen_name:bi.getCurrentPage()}))}},{key:"select",value:(n=Ae(Se().mark((function e(){var t,n=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(n.length>0&&void 0!==n[0])||n[0],!this.isSelected){e.next=3;break}throw new Error("NavButton: Already selected");case 3:if(this.isSelected=!0,!t){e.next=9;break}return e.next=7,yn.runTweenAsync(this.playSelectAnimation());case 7:e.next=14;break;case 9:this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255;case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"deselect",value:(t=Ae(Se().mark((function e(){var t,n,i=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=!(i.length>0&&void 0!==i[0])||i[0],n=i.length>1&&void 0!==i[1]&&i[1],this.isSelected||n){e.next=4;break}throw new Error("NavButton: Already deselected");case 4:if(this.isSelected=!1,!t){e.next=10;break}return e.next=8,yn.runTweenAsync(this.deselectAnimation());case 8:e.next=15;break;case 10:this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0;case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSelectedWorldDistanceX",value:function(){var e=new j(this.selectedIconX,this.selectedIconY,0),t=new j(this.deselectedIconX,this.deselectedIconY,0),n=this.node.scale.clone();this.node.scale=this.selectedIconScale;var i=this.uiTransform.convertToWorldSpaceAR(e),a=this.uiTransform.convertToWorldSpaceAR(t);return this.node.scale=n,a.x-i.x}},{key:"playHoverOnAnimation",value:function(){var e=S(this.icon);return e.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),yn.runTweenAsync(e)}},{key:"playHoverOffAnimation",value:function(){var e=S(this.icon);return e.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),yn.runTweenAsync(e)}},{key:"playSelectAnimation",value:function(){var e=this;return S(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=D.quintInOut(n),a=D.backOut(n),r=D.linear(n),o=n<.5?2*n:1,s=e.deselectedIconY+(e.selectedIconY-e.deselectedIconY)*a,l=e.deselectedIconX+(e.selectedIconX-e.deselectedIconX)*r;e.icon.setPosition(l,s,0);var u=e.deselectedIconScale.clone().lerp(e.selectedIconScale,i);e.icon.setScale(u.x,u.y,e.icon.scale.z);var c=255*o,h=e.deselectedTextY+(e.selectedTextY-e.deselectedTextY)*r,p=e.deselectedTextX+(e.selectedTextX-e.deselectedTextX)*r;e.text.opacity=c,e.text.node.setPosition(p,h,0)}}})}},{key:"deselectAnimation",value:function(){var e=this;return S(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:function(t,n){if(void 0!==n){var i=ce(e.selectedIconY,e.deselectedIconY,n),a=ce(e.selectedIconX,e.deselectedIconX,n);e.icon.setPosition(a,i,0);var r=ce(255,0,n<.5?2*n:1);e.text.opacity=r;var o=ce(e.selectedTextY,e.deselectedTextY,n),s=ce(e.selectedTextX,e.deselectedTextX,n);e.text.node.setPosition(s,o,0);var l=e.selectedIconScale.clone().lerp(e.deselectedIconScale,D.quintInOut(n));e.icon.setScale(l.x,l.y,e.icon.scale.z)}}})}},{key:"onLoad",value:function(){this.uiTransform=this.getComponent(s),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}}]),r}(f)).prototype,"wip",[dL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),FL=$e(ML.prototype,"isSelectedInEditor",[fL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),BL=$e(ML.prototype,"animationDuration",[vL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),GL=$e(ML.prototype,"selectedSpacing",[yL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),zL=$e(ML.prototype,"deselectedSpacing",[mL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),UL=$e(ML.prototype,"selectedIconY",[gL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),HL=$e(ML.prototype,"selectedIconX",[bL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qL=$e(ML.prototype,"selectedIconScale",[wL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(1,1,1)}}),VL=$e(ML.prototype,"deselectedIconY",[kL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WL=$e(ML.prototype,"deselectedIconX",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),KL=$e(ML.prototype,"deselectedIconScale",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(.8,.8,1)}}),jL=$e(ML.prototype,"selectedTextY",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-10}}),YL=$e(ML.prototype,"selectedTextX",[AL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XL=$e(ML.prototype,"deselectedTextY",[TL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$L=$e(ML.prototype,"deselectedTextX",[xL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),JL=$e(ML.prototype,"spacer",[PL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QL=$e(ML.prototype,"icon",[RL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZL=$e(ML.prototype,"text",[IL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eO=$e(ML.prototype,"uiTransform",[_L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tO=$e(ML.prototype,"screenType",[LL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nO=$e(ML.prototype,"navManager",[OL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DL=ML))||DL);n._RF.pop(),n._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);var yO,mO,gO,bO,wO,kO,SO,CO,EO,AO,TO,xO,PO,RO,IO,_O=i.ccclass,LO=i.property,OO=i.disallowMultiple,DO=globalThis.game,MO=DO.audio,NO=DO.player,FO=Fn;rO=_O("GameScene"),oO=LO(Mk),sO=LO(Fb),rO(lO=OO((cO=$e((uO=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"animSkipOverlay",cO,Ne(e)),Xe(e,"coinManager",hO,Ne(e)),e.handleGameExit=function(){e.scheduleOnce((function(){yv.hideBannerAds(),Hl.switchScene(Js,{isMatchStartFromLoader:!0})}),.5)},e.handleShowResults=function(){e.scheduleOnce((function(){Hl.switchScene(Qs)}),.5)},e.handleGameMaskWhenLayoutChanged=function(e){var t=P("Canvas/Game/GameObjects");if(t){var n=t.getComponent(he);n&&(n.enabled=e===FO.Landscape)}},e.attemptCallSubscribeBot=function(){"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch((function(e){console.warn("subscribeBotAsync",e)}))},e}return Pe(n,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenGameEvents(),yv.showBannerAds()}},{key:"onLoad",value:function(){this.coinManager.init(this.animSkipOverlay)}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenGameEvents",value:function(){x.on(En,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(tr.GAME_EXIT,this.handleGameExit),this.node.scene.on(tr.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}},{key:"start",value:function(){this.scheduleOnce(this.attemptCallSubscribeBot,.5),NO.getPlayerSetting("music")&&wi.playMusic(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}},{key:"preloadScenes",value:function(){Hl.preloadDashboardScene()}},{key:"updateVolumeBackgroundMusic",value:function(){MO.setVolume(1,"global_music")}}]),n}(f)).prototype,"animSkipOverlay",[oO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hO=$e(uO.prototype,"coinManager",[sO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lO=uO))||lO);n._RF.pop(),n._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);var BO,GO,zO,UO,HO,qO,VO,WO=i.ccclass,KO=i.property;yO=WO("ItemButton"),mO=KO(H),gO=KO(p),bO=KO({type:g}),wO=KO(u),kO=KO(a),SO=KO(a),yO((AO=$e((EO=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"isDebug",AO,Ne(e)),Xe(e,"button",TO,Ne(e)),Xe(e,"quantity",xO,Ne(e)),Xe(e,"quantityLabel",PO,Ne(e)),Xe(e,"plusNode",RO,Ne(e)),Xe(e,"quantityNode",IO,Ne(e)),e}return Pe(n,[{key:"__preload",value:function(){this.item=this.getComponent(iv),this.validateRequiredComponents()}},{key:"start",value:function(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string=`${this.quantity}`,this.validateButton(),this.node.scene.on(tr.GRID_CREATE,this.validateButton,this),this.node.scene.on(tr.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(tr.GRID_CLEAR,this.validateButton,this)}},{key:"validateRequiredComponents",value:function(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}},{key:"validateButton",value:function(){var e=this;console.log("VALIDATE BUTTON"),this.canActivate().then((function(t){e.button.interactable=!0,e.plusNode.active=0==e.quantity,e.quantityNode.active=e.quantity>0}))}},{key:"activate",value:function(){var e=this;return new Promise((function(t){if(e.quantity<=0)return e.handleShowAddItemScreen(),void t();e.item.activate().then((function(){e.isDebug||(e.quantity--,e.quantityLabel.string=`${e.quantity}`,e.item.saveQuantity()),e.validateButton(),t()}))}))}},{key:"canActivate",value:function(){return Promise.resolve(!0)}},{key:"addQuantity",value:function(e){this.quantity+=e,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}},{key:"clearQuantity",value:function(){this.quantity=0,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}},{key:"handleShowAddItemScreen",value:function(){nu.openScreen(si,{item:Es.HINT,quantity:1})}}]),n}(f)).prototype,"isDebug",[mO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),TO=$e(EO.prototype,"button",[gO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xO=$e(EO.prototype,"quantity",[bO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),PO=$e(EO.prototype,"quantityLabel",[wO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RO=$e(EO.prototype,"plusNode",[kO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IO=$e(EO.prototype,"quantityNode",[SO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CO=EO));n._RF.pop(),n._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);var jO,YO,XO,$O,JO,QO,ZO,eD=i.ccclass,tD=i.property;BO=eD("ComboEffect"),GO=tD(M),zO=tD(ae),BO((qO=$e((HO=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"circleOpacity",qO,Ne(e)),Xe(e,"particle",VO,Ne(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){if(!this.circleOpacity)throw new Error("ComboEffect requires a circleOpacity component");if(!this.particle)throw new Error("ComboEffect requires a particle component")}},{key:"start",value:function(){this.node.scene.on(tr.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){e>1&&(this.circleOpacity.node.scale=j.ZERO,this.circleOpacity.opacity=127.5,this.particle.resetSystem(),S(this.circleOpacity.node).to(.2,{scale:new j(1.3,1.3,1.3)},{easing:"quadOut"}).start(),S(this.circleOpacity).delay(.2).to(.2,{opacity:0},{easing:"expoIn"}).start())}}]),n}(f)).prototype,"circleOpacity",[GO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VO=$e(HO.prototype,"particle",[zO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UO=HO));n._RF.pop(),n._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);var nD,iD,aD,rD,oD,sD,lD,uD,cD,hD=i.ccclass,pD=i.property;jO=hD("ComboLabel"),YO=pD(u),XO=pD(a),jO((QO=$e((JO=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"comboNumber",QO,Ne(e)),Xe(e,"comboContainer",ZO,Ne(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.opacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"start",value:function(){this.node.scene.on(tr.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"handleOnComboUpdated",value:function(e){0===e?this.opacity.opacity=0:e>1?(this.opacity.opacity=255,this.comboNumber.string=`${e}`,S(this.comboContainer).to(.1,{scale:new j(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:j.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}]),n}(f)).prototype,"comboNumber",[YO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZO=$e(JO.prototype,"comboContainer",[XO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$O=JO));n._RF.pop(),n._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);var dD,fD,vD,yD,mD,gD,bD,wD,kD,SD=i.ccclass,CD=i.property;nD=SD("ComboPopup"),iD=CD(T),aD=CD(O),rD=CD(y),nD((lD=$e((sD=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"textSprite",lD,Ne(e)),Xe(e,"comboSprites",uD,Ne(e)),Xe(e,"animation",cD,Ne(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"start",value:function(){this.node.scene.on(tr.COMBO_UPDATED,this.handleOnComboUpdated,this)}},{key:"validateRequiredComponents",value:function(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}},{key:"handleOnComboUpdated",value:function(e){if(!(e<2))for(var t=this.comboSprites.length-1;t>=0;t--)if(e>=t+2){this.textSprite.spriteFrame=this.comboSprites[t],this.animation.play();break}}}]),n}(f)).prototype,"textSprite",[iD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uD=$e(sD.prototype,"comboSprites",[aD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cD=$e(sD.prototype,"animation",[rD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oD=sD));n._RF.pop(),n._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);var ED,AD,TD,xD,PD,RD,ID,_D,LD,OD,DD,MD,ND,FD,BD,GD=i.ccclass,zD=i.property,UD=(dD=GD("PlayerScore"),fD=zD(a),vD=zD(u),yD=zD(T),dD((bD=$e((gD=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"crown",bD,Ne(e)),Xe(e,"playerScore",wD,Ne(e)),Xe(e,"avatar",kD,Ne(e)),e}return Pe(i,[{key:"showCrown",value:function(e){this.crown.active=e}},{key:"setPlayerScore",value:function(e){this.playerScore.string=e.toString()}},{key:"playWaitingAnimation",value:function(){var e=this,t=0;this.playerScore.schedule((function(){t=(t+1)%4;var n=Array(t+1).join(".");e.playerScore.string="Waiting"+n}),.5);var n=this.playerScore.getComponent(M),i=S(n).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=S(n).repeatForever(i).start()}},{key:"stopWaitingAnimation",value:function(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(M).opacity=255}},{key:"loadPhoto",value:(t=Ae(Se().mark((function e(t){var n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameCore.Utils.Image.loadImage(t);case 3:if(n=e.sent){e.next=6;break}throw new Error("Failed to load image");case 6:if(i=O.createWithImage(n)){e.next=9;break}throw new Error("Failed to create sprite frame");case 9:i.packable=!0,this.avatar.spriteFrame=i,e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(0),console.error(e.t0),e.abrupt("return");case 17:case"end":return e.stop()}}),e,this,[[0,13]])}))),function(e){return t.apply(this,arguments)})}]),i}(f)).prototype,"crown",[fD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wD=$e(gD.prototype,"playerScore",[vD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kD=$e(gD.prototype,"avatar",[yD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mD=gD))||mD);n._RF.pop(),n._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);var HD,qD,VD,WD,KD,jD,YD,XD,$D,JD=i.ccclass,QD=i.disallowMultiple,ZD=i.property,eM=globalThis.game,tM=eM.match,nM=eM.player,iM=eM.monitorError,aM="Waiting";ED=JD("ChallengeResultScene"),AD=ZD(g),TD=ZD({type:UD,group:"Score"}),xD=ZD({type:UD,group:"Score"}),PD=ZD(zw),RD=ZD(u),ID=ZD(cv),ED(_D=QD((OD=$e((LD=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"pollingInterval",OD,Ne(e)),Xe(e,"playerScore",DD,Ne(e)),Xe(e,"opponentScore",MD,Ne(e)),Xe(e,"paperConfetti",ND,Ne(e)),Xe(e,"titleText",FD,Ne(e)),Xe(e,"levelManager",BD,Ne(e)),e.pollMatchState=Ae(Se().mark((function t(){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b;return Se().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=tM.getMatchState(),null!==(i=n.id)){t.next=4;break}throw new Error("Match id is not found");case 4:return a=nM.getPlayerId(),r=Date.now(),t.next=8,tM.api.getMatchAPI().getMatchDetailByIdAsync(i);case 8:if(o=t.sent,s=Date.now(),l=Math.max(0,s-r,e.pollingInterval),u=new GameCore.Dtos.Match.Data(o).toObject(),c=u.blackPlayerId,h=u.blackPlayerScore,p=u.whitePlayerScore,d=u.blackPlayerFinish,f=u.whitePlayerFinish,v=a===c?h:p,y=a===c?p:h,m=a===c?d:f,g=a===c?f:d,b=d&&f,e.playerScore.setPlayerScore(v),e.opponentScore.setPlayerScore(y),e.playerScore.showCrown(b&&v>y),e.opponentScore.showCrown(b&&y>v),e.stopWaitingAnimation(),e.playerScore.stopWaitingAnimation(),e.opponentScore.stopWaitingAnimation(),b){t.next=32;break}e.titleText.string=aM,e.playWaitingAnimation(),m||e.playerScore.playWaitingAnimation(),g||e.opponentScore.playWaitingAnimation(),t.next=45;break;case 32:if(v!==y){t.next=36;break}e.titleText.string="Draw",t.next=45;break;case 36:if(!(v>y)){t.next=40;break}e.titleText.string="You Win",t.next=45;break;case 40:if(!(v<y)){t.next=44;break}e.titleText.string="You Lose",t.next=45;break;case 44:return t.abrupt("return");case 45:e.scheduleOnce(e.pollMatchState,l),t.next=52;break;case 48:t.prev=48,t.t0=t.catch(0),console.warn("ResultScene: Error on pollMatchState",t.t0),e.scheduleOnce(e.pollMatchState,e.pollingInterval);case 52:case"end":return t.stop()}}),t,null,[[0,48]])}))),e}return Pe(i,[{key:"__preload",value:function(){this.validateRequiredComponents(),this.listenEvents(),yv.showBannerAds()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"onLoad",value:function(){try{var e=tM.getMatchState(),t=e.customData,n=t.playerId,i=t.opponentId;if(null===n||null===i)throw new Error(`ResultScene: playerId is ${n} and opponentId is ${i}. Expected to not be null.`);var a=nM.getPlayer().photo,r=e.profiles[n],o=r.score,s=void 0===o?0:o,l=r.finished,u=void 0!==l&&l,c=e.profiles[i],h=c.photo,p=c.score,d=void 0===p?0:p,f=c.finished,v=void 0!==f&&f,y=u&&v,m=y&&s>d,g=y&&d>s;this.playerScore.loadPhoto(a),this.opponentScore.loadPhoto(h),this.playerScore.setPlayerScore(s),this.opponentScore.setPlayerScore(d),this.playerScore.showCrown(m),this.opponentScore.showCrown(g),u&&v?s===d?this.titleText.string="Draw":m?this.titleText.string="You Win":g&&(this.titleText.string="You Lose"):(this.titleText.string=aM,this.playWaitingAnimation(),u||this.playerScore.playWaitingAnimation(),v||this.opponentScore.playWaitingAnimation())}catch(e){console.warn("ResultScene: Error on load",e),this.transitionToDashboardScene()}}},{key:"listenEvents",value:function(){this.node.scene.on(Rn,this.onHomeButtonPressed,this),this.node.scene.on(Pn,this.onReplayButtonPressed,this)}},{key:"start",value:function(){var e=this;this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce((function(){e.paperConfetti.runEffect()}),.2)}},{key:"onDestroy",value:function(){this.unschedule(this.pollMatchState)}},{key:"onReplayButtonPressed",value:(t=Ae(Se().mark((function e(){var t,n,i,a,r,o,s,l,u,c,h,p,d,f;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null!==(t=nM.getGameData())&&void 0!==t?t:{},i=n.level,a=void 0===i?1:i,a=Math.max(1,a),e.next=4,this.levelManager.loadLevelData(a);case 4:if(r=e.sent,e.prev=5,r){e.next=8;break}throw new Error("Level data is not found");case 8:if(o=tM.getMatchState().customData.opponentId){e.next=11;break}throw new Error("Opponent id is not found");case 11:return nu.showLoadingScreen(),s=rh.generateFen(r),l=r.mode,u=void 0===l?"":l,c=r.rules,h=void 0===c?{addRandomTilesPerMove:0,maxSpaceOfPair:0}:c,p=r.time,d=void 0===p?0:p,f=r.level,e.next=16,tM.challenge.friend.processAsync({playerId:nM.getPlayerId(),opponentId:o,extraData:{level:f,fen:s,gravity:u,rules:h,time:d}});case 16:nu.closeLoadingScreen(),this.transitionToGameScene(),e.next=28;break;case 20:e.prev=20,e.t0=e.catch(5),console.warn("ReplayChallengeFriend",e.t0),nu.closeLoadingScreen(),nu.showNotificationScreen("Sorry, you cannot replay\nat this time.",2),null==iM||iM.sendException(e.t0 instanceof Error?e.t0:new Error("ReplayChallengeFriend"+JSON.stringify(e.t0))),this.scheduleOnce((function(){yv.hideBannerAds(),Hl.switchScene(Js,{isMatchStartFromLoader:!0})}),2);case 28:case"end":return e.stop()}}),e,this,[[5,20]])}))),function(){return t.apply(this,arguments)})},{key:"onHomeButtonPressed",value:function(){this.transitionToDashboardScene()}},{key:"transitionToDashboardScene",value:function(){this.scheduleOnce((function(){yv.hideBannerAds(),Hl.switchScene(Js,{isMatchStartFromLoader:!0})}),.5)}},{key:"transitionToGameScene",value:function(){this.scheduleOnce((function(){Hl.switchScene($s)}),.5)}},{key:"playWaitingAnimation",value:function(){var e=this,t=0;this.titleText.schedule((function(){t=(t+1)%4;var n=Array(t+1).join(".");e.titleText.string=aM+n}),.5);var n=this.titleText.getComponent(M),i=S(n).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=S(n).repeatForever(i).start()}},{key:"stopWaitingAnimation",value:function(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(M).opacity=255}}]),i}(f)).prototype,"pollingInterval",[AD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),DD=$e(LD.prototype,"playerScore",[TD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MD=$e(LD.prototype,"opponentScore",[xD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ND=$e(LD.prototype,"paperConfetti",[PD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FD=$e(LD.prototype,"titleText",[RD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BD=$e(LD.prototype,"levelManager",[ID],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_D=LD))||_D);n._RF.pop(),n._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);var rM,oM=i.ccclass,sM=i.property,lM=i.disallowMultiple,uM=GameCore.Events,cM=globalThis.game.event,hM=(HD=oM("BaseScreen"),qD=sM(a),VD=sM(a),WD=sM(M),HD(KD=lM((YD=$e((jD=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"container",YD,Ne(e)),Xe(e,"backgroundMask",XD,Ne(e)),Xe(e,"screenOpacity",$D,Ne(e)),e.data={},e}return Pe(n,[{key:"__preload",value:function(){this.animation=this.getComponent(y),this.validateRequiredComponents(),this.initializeNodes()}},{key:"initializeNodes",value:function(){var e=this.getMaskOpacity(),t=this.getContainerOpacity();e&&t&&(e.opacity=0,t.opacity=0)}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"setScreenOpacity",value:function(e){this.screenOpacity.opacity=e}},{key:"open",value:function(e){e&&(this.data=e),this.show(),this.runAnimation("OpenScreen")}},{key:"close",value:function(){var e=this;this.node.active&&(this.animation.once(y.EventType.FINISHED,(function(){cM.emit(uM.CLOSED_SCREEN,{screenName:e.node.name}),e.hide()})),this.runAnimation("CloseScreen"))}},{key:"runAnimation",value:function(e){if(!this.isAnimationExist(e))throw new Error(`${this.node.name}: Animation component must have ${e} clip`);this.animation.play(e)}},{key:"isAnimationExist",value:function(e){return this.animation.clips.some((function(t){return!(!t||t.name!==e)}))}},{key:"getMaskOpacity",value:function(){var e=this.backgroundMask.getComponent(M);return e||(console.warn("BaseScreen: maskOpacity not found"),null)}},{key:"getContainerOpacity",value:function(){var e=this.container.getComponent(M);return e||(console.warn("BaseScreen: containerOpacity not found"),null)}},{key:"show",value:function(){this.setScreenOpacity(255);var e=this.node.getComponent(E);e&&(e.enabled=!0,e.updateAlignment(),this.node.getComponentsInChildren(E).forEach((function(e){e.updateAlignment()})))}},{key:"hide",value:function(){this.setScreenOpacity(0),this.node.setWorldPosition(new j(-1e3,-1e3,0));var e=this.node.getComponent(E);e&&(e.enabled=!1)}}]),n}(f)).prototype,"container",[qD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XD=$e(jD.prototype,"backgroundMask",[VD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$D=$e(jD.prototype,"screenOpacity",[WD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KD=jD))||KD)||KD);n._RF.pop(),n._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);var pM,dM,fM,vM,yM,mM,gM,bM,wM,kM,SM,CM,EM,AM,TM=i.ccclass,xM=i.requireComponent;TM("BackgroundMask")(rM=xM([M])(rM=function(e){Ie(n,e);var t=Be(n);function n(){return Te(this,n),t.apply(this,arguments)}return Pe(n,[{key:"onLoad",value:function(){var e=this.getComponent(M);e?(this.opacity=e,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}},{key:"updateMaskAlpha",value:function(){var e,t,n=this.opacity.opacity/255;e=n,(t=document.getElementById("app-mask"))&&(t.style.background=`rgb(0 0 0 / ${e})`)}}]),n}(f))||rM);n._RF.pop(),n._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);var PM,RM,IM,_M,LM,OM,DM,MM,NM,FM,BM,GM,zM,UM,HM,qM,VM,WM,KM,jM,YM,XM=i.ccclass,$M=i.property,JM=i.disallowMultiple,QM=i.requireComponent,ZM=GameCore.Events,eN=globalThis.game.event;pM=XM("CongratulationScreen"),dM=QM(hM),fM=$M(a),vM=$M(a),yM=$M(p),mM=$M(p),gM=$M(p),pM(bM=JM(bM=dM((kM=$e((wM=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"congratulation",kM,Ne(e)),Xe(e,"confirmation",SM,Ne(e)),Xe(e,"closeButtonComponent",CM,Ne(e)),Xe(e,"yesButtonComponent",EM,Ne(e)),Xe(e,"noButtonComponent",AM,Ne(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("CongratulationScreen: screen not found");e.validateEventPayload(t)&&(e.closeButtonComponent.interactable=!0,e.yesButtonComponent.interactable=!0,e.noButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.confirmationUIOpacity=this.confirmation.getComponent(M),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){eN.on(ZM.OPENING_SCREEN,this.handleOpeningScreen),eN.on(ZM.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){eN.off(ZM.OPENING_SCREEN,this.handleOpeningScreen),eN.off(ZM.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){this.confirmation.active=!1,this.congratulation.active=!0}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,nu.closeScreen(this.node.name)}},{key:"handleStartOver",value:function(){this.confirmation.active=!0,this.congratulation.active=!1,S(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),S(this.confirmation).set({scale:new j(.8,.8,.8)}).to(.2,{scale:new j(1,1,1)},{easing:"backOut"}).start()}},{key:"handleYesStartOver",value:function(){this.close(),this.node.scene.emit(tr.START_OVER)}},{key:"handleNoStartOver",value:function(){this.requestGameReplay()}},{key:"handleClickedClose",value:function(){this.requestGameReplay()}},{key:"requestGameReplay",value:function(){this.close(),this.node.scene.emit(tr.GAME_REPLAY,{level:this.screen.data.level})}}]),n}(f)).prototype,"congratulation",[fM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SM=$e(wM.prototype,"confirmation",[vM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CM=$e(wM.prototype,"closeButtonComponent",[yM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EM=$e(wM.prototype,"yesButtonComponent",[mM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AM=$e(wM.prototype,"noButtonComponent",[gM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bM=wM))||bM)||bM);n._RF.pop(),n._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);var tN,nN,iN,aN,rN,oN,sN=i.ccclass,lN=i.property,uN=(PM=sN("DayBlock"),RM=lN({type:T,group:"Background"}),IM=lN({type:T,group:"Background"}),_M=lN({type:O,group:"Background"}),LM=lN({type:O,group:"Background"}),OM=lN(u),DM=lN(u),MM=lN(a),NM=lN(a),FM=lN(a),PM((zM=$e((GM=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"background",zM,Ne(e)),Xe(e,"topBackground",UM,Ne(e)),Xe(e,"blueBackground",HM,Ne(e)),Xe(e,"blueTopBackground",qM,Ne(e)),Xe(e,"dayLabel",VM,Ne(e)),Xe(e,"coinLabel",WM,Ne(e)),Xe(e,"rewardItemsNode",KM,Ne(e)),Xe(e,"checkNode",jM,Ne(e)),Xe(e,"glowNodes",YM,Ne(e)),e}return Pe(n,[{key:"onLoad",value:function(){this.uiOpacity=this.getComponent(M),this.initDefaultProperties(),this.validateRequiredComponents()}},{key:"initDefaultProperties",value:function(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new r(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new r("#3469bf")}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"updateInfo",value:function(e){this.updateBackground(e),this.updateDayLabel(e),this.coinLabel.string=e.value.toString(),this.updateRewardItems(e)}},{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLabel.string=`Day ${e.day.toString()}`;var t=this.defaultDayLabelOutlineColor;"rewarded"!==e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=t,this.dayLabel.shadowColor=t}},{key:"updateRewardItems",value:function(e){switch(e.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}},{key:"setGlowNodesActive",value:function(e){this.glowNodes&&this.glowNodes.forEach((function(t){t.active=e}))}}]),n}(f)).prototype,"background",[RM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UM=$e(GM.prototype,"topBackground",[IM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HM=$e(GM.prototype,"blueBackground",[_M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qM=$e(GM.prototype,"blueTopBackground",[LM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VM=$e(GM.prototype,"dayLabel",[OM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WM=$e(GM.prototype,"coinLabel",[DM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KM=$e(GM.prototype,"rewardItemsNode",[MM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jM=$e(GM.prototype,"checkNode",[NM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YM=$e(GM.prototype,"glowNodes",[FM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),BM=GM))||BM);n._RF.pop(),n._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);var cN,hN=i.ccclass,pN=i.property,dN=i.requireComponent,fN=GameCore.Events,vN=globalThis.game,yN=vN.event,mN=vN.dailyRewards,gN=vN.player;tN=hN("DailyRewardsScreen"),nN=dN(hM),iN=pN([uN]),tN(aN=nN((oN=$e((rN=function(e){Ie(r,e);var t,n,i,a=Be(r);function r(){var e;Te(this,r);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=a.call.apply(a,[this].concat(n)),"dailyBlocks",oN,Ne(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(r,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){yN.on(fN.OPENING_SCREEN,this.handleOpeningScreen),yN.on(fN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){yN.off(fN.OPENING_SCREEN,this.handleOpeningScreen),yN.off(fN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:(i=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.scene.emit(tr.HIDE_UI),this.resetState(),e.next=4,this.updateRewardsData();case 4:this.loginDailyRewards(),this.updateDayBlocks(),this.runPopUpAnimation();case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"close",value:function(){yN.emit(fN.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(tr.SHOW_UI)}},{key:"resetState",value:function(){this.dailyBlocks.forEach((function(e){e.uiOpacity.opacity=0,e.node.scale=new j(1.2,1.2,1.2)}))}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("DailyRewardScreen: screen not found"),this.dailyBlocks.forEach((function(t,n){e.runAppearTween(t,.15*n)}))}},{key:"runAppearTween",value:function(e,t){S(e.uiOpacity).delay(t).to(.3,{opacity:255},{easing:"quadOut"}).start(),S(e.node).delay(t).to(.3,{scale:j.ONE},{easing:"backOut"}).start()}},{key:"handleOnClaim",value:function(){var e=this.getCurrentRewardData();e&&this.claimReward(e)}},{key:"handleOnClaimX2",value:(n=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getCurrentRewardData()){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,yv.showRewardVideoAdAsync({});case 5:if(e.sent){e.next=8;break}return e.abrupt("return");case 8:this.claimReward(t,!0);case 10:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getCurrentRewardData",value:function(){return this.rewardsData.find((function(e){return"ready"===e.status}))}},{key:"claimReward",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.value*(t?2:1),i=new ha;if(this.node.scene.emit(tr.ADD_COINS,{coins:n,collectionAnimation:{animateTextOnly:!1,signal:i}}),e.items){var a=e.items.hint*(t?2:1),r=e.items.thunder*(t?2:1),o=e.items.storm*(t?2:1),s=gN.getGameData();s?(gN.setGameData({items:{hint:s.items.hint+a,thunder:s.items.thunder+r,storm:s.items.storm+o,pliers:s.items.pliers}}),this.close()):this.close()}else this.close()}},{key:"updateRewardsData",value:(t=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mN.requestDailyRewardsAsync();case 2:for(t=ke({},mN.getDailyRewards()),n=0;n<GameCore.Configs.DailyRewards.MaxDays;n++)t[n]=ke(ke({},t[n]),{},{value:_s[n].value,items:_s[n].items});if(t){e.next=6;break}return e.abrupt("return");case 6:this.rewardsData=Object.values(t),console.log("DailyRewardsScreen: rewardsData",this.rewardsData);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"loginDailyRewards",value:function(){mN.logLoginReward()}},{key:"updateDayBlocks",value:function(){var e=this;this.dailyBlocks.forEach((function(t,n){var i=e.rewardsData[n],a=i.id,r=i.type,o=i.value,s=i.status;t.updateInfo({day:a,type:r,value:o,status:s})}))}}]),r}(f)).prototype,"dailyBlocks",[iN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aN=rN))||aN);n._RF.pop(),n._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);var bN,wN,kN,SN,CN,EN,AN,TN,xN,PN;(0,i.ccclass)("DayBlockRed")(cN=function(e){Ie(n,e);var t=Be(n);function n(){return Te(this,n),t.apply(this,arguments)}return Pe(n,[{key:"updateBackground",value:function(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}},{key:"updateDayLabel",value:function(e){this.dayLabel.string=`Day ${e.day.toString()}`;var t=this.defaultDayLabelOutlineColor;"ready"===e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=t,this.dayLabel.outlineColor=t}}]),n}(uN));n._RF.pop(),n._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);var RN,IN,_N,LN,ON,DN,MN,NN,FN,BN=i.ccclass,GN=i.property,zN=i.requireComponent,UN=globalThis.game.event,HN=GameCore.Events;bN=BN("GetCoinScreen"),wN=zN(hM),kN=GN(u),SN=GN(p),CN=GN(p),bN(EN=wN((TN=$e((AN=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"quantityLabel",TN,Ne(e)),Xe(e,"closeButtonComponent",xN,Ne(e)),Xe(e,"getNowButtonComponent",PN,Ne(e)),e.handleOpeningScreen=function(t){console.log("GetCoinScreen.OPENING_SCREEN",t),e.validateEventPayload(t)&&(e.closeButtonComponent.interactable=!0,e.getNowButtonComponent.interactable=!0,e.updateStatus())},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(i,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){UN.on(HN.OPENING_SCREEN,this.handleOpeningScreen),UN.on(HN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){UN.off(HN.OPENING_SCREEN,this.handleOpeningScreen),UN.off(HN.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return"screenName"in e&&(e.screenName===this.node.name&&(this.payload=e,!0))}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(tr.HIDE_UI)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,UN.emit(HN.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(tr.SHOW_UI)}},{key:"updateStatus",value:function(){this.updateCoinQuantity()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("GetCoinScreen: screen not found")}},{key:"updateCoinQuantity",value:function(){var e=this.getQuantity();e&&this.updateQuantityLabel(e)}},{key:"updateQuantityLabel",value:function(e){this.quantityLabel.string=`x${e.toString()}`}},{key:"getQuantity",value:function(){if(!this.payload||!("screenData"in this.payload))return 0;var e=this.payload.screenData;return e&&"quantity"in e&&e.quantity&&"number"==typeof e.quantity?e.quantity:0}},{key:"handleAddCoin",value:function(){var e=this.getQuantity();this.node.scene.emit(tr.ADD_COINS,{coins:e,collectionAnimation:{animateTextOnly:!1}}),this.close()}},{key:"handleGetNowButtonClicked",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return wi.stopAllSounds(),e.next=3,yv.showRewardVideoAdAsync({});case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:this.handleAddCoin();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),i}(f)).prototype,"quantityLabel",[kN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xN=$e(AN.prototype,"closeButtonComponent",[SN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PN=$e(AN.prototype,"getNowButtonComponent",[CN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EN=AN))||EN);n._RF.pop(),n._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);var qN,VN,WN,KN,jN,YN,XN,$N,JN,QN,ZN,eF,tF,nF,iF,aF,rF,oF,sF,lF,uF,cF,hF,pF,dF,fF=i.ccclass,vF=i.property,yF=(RN=fF("ItemCollectionFX"),IN=vF(T),_N=vF(M),LN=vF(ae),RN((MN=$e((DN=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"sprite",MN,Ne(e)),Xe(e,"glowUIOpacity",NN,Ne(e)),Xe(e,"particles",FN,Ne(e)),e}return Pe(n,[{key:"__preload",value:function(){St.lazyValidateProperties(this)}},{key:"playExplosionParticles",value:function(){this.particles.resetSystem()}}]),n}(f)).prototype,"sprite",[IN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NN=$e(DN.prototype,"glowUIOpacity",[_N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FN=$e(DN.prototype,"particles",[LN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ON=DN))||ON);n._RF.pop(),n._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);var mF,gF,bF,wF,kF,SF,CF,EF,AF,TF,xF,PF,RF,IF,_F,LF,OF,DF,MF,NF,FF,BF,GF,zF,UF,HF,qF,VF,WF,KF,jF=i.ccclass,YF=i.property,XF=globalThis.game,$F=XF.event,JF=XF.player,QF=XF.analytics,ZF=GameCore.Events;qN=jF("GetItemScreen"),VN=YF(R),WN=YF(T),KN=YF(T),jN=YF(T),YN=YF(T),XN=YF(u),$N=YF(u),JN=YF(u),QN=YF(p),ZN=YF(p),eF=YF(p),qN((iF=$e((nF=function(e){Ie(s,e);var t,n,i,a,r,o=Be(s);function s(){var e;Te(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=o.call.apply(o,[this].concat(n)),"itemFxPrefab",iF,Ne(e)),Xe(e,"hintSprite",aF,Ne(e)),Xe(e,"stormSprite",rF,Ne(e)),Xe(e,"pliersSprite",oF,Ne(e)),Xe(e,"thunderSprite",sF,Ne(e)),Xe(e,"titleLabel",lF,Ne(e)),Xe(e,"descriptionLabel",uF,Ne(e)),Xe(e,"coinLabel",cF,Ne(e)),Xe(e,"closeButtonComponent",hF,Ne(e)),Xe(e,"buyItemButtonComponent",pF,Ne(e)),Xe(e,"getNowButtonComponent",dF,Ne(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("GetItemScreen: screen not found");if(e.validateEventPayload(t)){e.closeButtonComponent.interactable=!0,e.getNowButtonComponent.interactable=!0,e.buyItemButtonComponent.interactable=!0;var n=e.getItemType();n&&e.updateStatus(n)}},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){$F.on(ZF.OPENING_SCREEN,this.handleOpeningScreen),$F.on(ZF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){$F.off(ZF.OPENING_SCREEN,this.handleOpeningScreen),$F.off(ZF.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function(){this.node.scene.emit(tr.GAME_PAUSE)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.buyItemButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,$F.emit(ZF.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(tr.GAME_RESUME)}},{key:"updateStatus",value:function(e){this.updateItemIcon(e),this.updateTitle(e),this.updateDescription(),this.updateButtons(e)}},{key:"updateItemIcon",value:function(e){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach((function(e){e.node.active=!1})),e){case Es.HINT:this.activeIcon=this.hintSprite;break;case Es.STORM:this.activeIcon=this.stormSprite;break;case Es.THUNDER:this.activeIcon=this.thunderSprite;break;case Es.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}},{key:"updateTitle",value:function(e){var t=e.charAt(0).toUpperCase()+e.slice(1);this.titleLabel.string=t}},{key:"updateDescription",value:function(){var e,t=null===(e=this.payload.screenData)||void 0===e?void 0:e.message;t&&(this.descriptionLabel.string=t)}},{key:"updateButtons",value:function(e){var t=this.canBuyItem(e);this.buyItemButtonComponent.node.active=t,this.getNowButtonComponent.node.active=!t,t&&(this.coinLabel.string=""+3*Ps[e])}},{key:"canBuyItem",value:function(e){var t=JF.getGameData();return!!t&&t.coins>=3*Ps[e]}},{key:"getItemType",value:function(){var e=this.payload.screenData;return e&&e.item&&Object.values(Es).includes(e.item)?e.item:null}},{key:"handleAddItem",value:(r=Ae(Se().mark((function e(){var t,n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getItemType()){e.next=3;break}return e.abrupt("return");case 3:QF.event(GameCore.Plugins.Analytics.Events.EARN_ITEM,{item_name:t,value:3}),this.node.scene.emit(tr.ADD_ITEM,{animate:function(){return n.animateAddItem(t)},item:t,quantity:3});case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"animateAddItem",value:(a=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.activeIcon.spriteFrame,i=this.createItemCollectionNode(n),a=qe(i,2),r=a[0],o=a[1],s=this.getItemButtonWorldPosition(t),l=new j(.5,.5,.5),o.glowUIOpacity.opacity=150,e.next=7,this.playScaleUpItemAnim(r,o);case 7:return e.next=9,yn.runTweenAsync(S(o.glowUIOpacity).to(.8,{opacity:0},{easing:"cubicIn"}));case 9:return e.next=11,this.playMoveCloseToItemButtonAnim(r,s,l);case 11:return e.next=13,this.playJumpAnim(r,l,s);case 13:wi.playSound("sounds/clicks"),r.destroy();case 15:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"playJumpAnim",value:(i=Ae(Se().mark((function e(t,n,i){var a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=i.clone().add3f(0,70,0),r=n.clone().multiplyScalar(1.3),e.next=4,Promise.all([yn.runTweenAsync(S(t).to(.3,{worldPosition:a},{easing:"cubicOut"})),yn.runTweenAsync(S(t).to(.3,{scale:r},{easing:"cubicOut"}))]);case 4:return e.next=6,yn.runTweenAsync(S(t).to(.5,{worldPosition:i},{easing:"cubicIn"}));case 6:case"end":return e.stop()}}),e)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"playMoveCloseToItemButtonAnim",value:function(e,t,n){var i=t.clone().add3f(0,30,0);return yn.runTweenAsync(S(e).to(1,{worldPosition:i,scale:n},{easing:"cubicInOut"}))}},{key:"createItemCollectionNode",value:function(e){var t=l(this.itemFxPrefab),n=t.getComponent(yF);return t.setParent(this.node.parent),n.sprite.spriteFrame=e,t.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[t,n]}},{key:"playScaleUpItemAnim",value:function(e,t){return e.setScale(j.ZERO),yn.runTweenAsync(S(e).delay(.2).call((function(){t.playExplosionParticles(),wi.playSound("sounds/item_reward")})).to(.1,{scale:new j(.8,1.2,1)}).to(.1,{scale:new j(1.2,.8,1)}).to(.1,{scale:new j(1,1,1)}))}},{key:"getItemButtonWorldPosition",value:function(e){return this.getItemButton(e).worldPosition.clone()}},{key:"handleGetNowButtonClicked",value:(n=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAllSounds(),e.next=3,yv.showRewardVideoAdAsync({});case 3:if(e.sent){e.next=6;break}return e.abrupt("return");case 6:this.handleAddItem(),this.close();case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"handleBuyItemButtonClicked",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.node.scene.emit(tr.REMOVE_COINS,{coins:3*Ps[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"stopAllSounds",value:function(){var e;null===(e=P("Sound"))||void 0===e||null===(e=e.getComponent(Yt))||void 0===e||e.stopAll()}},{key:"getItemButton",value:function(e){switch(e){case Es.HINT:return P("Canvas/UI/Footer/HintItemButton");case Es.STORM:return P("Canvas/UI/Footer/StormItemButton");case Es.THUNDER:return P("Canvas/UI/Footer/ThunderItemButton");case Es.PLIERS:return P("Canvas/UI/Footer/PliersItemButton")}}}]),s}(f)).prototype,"itemFxPrefab",[VN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aF=$e(nF.prototype,"hintSprite",[WN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rF=$e(nF.prototype,"stormSprite",[KN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oF=$e(nF.prototype,"pliersSprite",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sF=$e(nF.prototype,"thunderSprite",[YN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lF=$e(nF.prototype,"titleLabel",[XN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uF=$e(nF.prototype,"descriptionLabel",[$N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cF=$e(nF.prototype,"coinLabel",[JN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hF=$e(nF.prototype,"closeButtonComponent",[QN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pF=$e(nF.prototype,"buyItemButtonComponent",[ZN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dF=$e(nF.prototype,"getNowButtonComponent",[eF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tF=nF));n._RF.pop(),n._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);var eB,tB=i.ccclass,nB=i.property,iB=i.requireComponent,aB=GameCore,rB=aB.Events,oB=aB.Utils,sB=globalThis.game,lB=sB.event,uB=sB.player,cB="Coin Container";mF=tB("LevelCompleteScreen"),gF=iB(hM),bF=nB(nS),wF=nB(a),kF=nB(u),SF=nB(a),CF=nB(a),EF=nB(p),AF=nB(a),TF=nB(y),xF=nB(a),PF=nB({type:y,group:cB}),RF=nB({type:_,group:cB}),IF=nB({type:_,group:cB}),_F=nB(zw),mF(LF=gF((DF=$e((OF=function(e){Ie(o,e);var t,n,i,a,r=Be(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return(e=r.call.apply(r,[this].concat(n))).levelId=1,e.coins=40,e.currentCoin=0,Xe(e,"coinContainer",DF,Ne(e)),Xe(e,"playButton",MF,Ne(e)),Xe(e,"coinText",NF,Ne(e)),Xe(e,"levelText",FF,Ne(e)),Xe(e,"nextLevelText",BF,Ne(e)),Xe(e,"playButtonComponent",GF,Ne(e)),Xe(e,"wellDoneText",zF,Ne(e)),Xe(e,"coinAnimation",UF,Ne(e)),Xe(e,"playButtonContainer",HF,Ne(e)),Xe(e,"coinContainerAnimation",qF,Ne(e)),Xe(e,"coinContainerEnterClip",VF,Ne(e)),Xe(e,"coinContainerExitClip",WF,Ne(e)),Xe(e,"paperConfetti",KF,Ne(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)&&(e.playButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(o,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onLoad",value:function(){var e=this,t=this.screen.open;this.screen.open=function(n){e.overrideOpenHandler(t,n)}}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){lB.on(rB.OPENING_SCREEN,this.handleOpeningScreen),lB.on(rB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){lB.off(rB.OPENING_SCREEN,this.handleOpeningScreen),lB.off(rB.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){var t=null!=e?e:{},n=t.screenName,i=t.screenData;return n===this.node.name&&(!!oB.Valid.isObject(i)&&(oB.Valid.isNumber(i.level)&&(this.levelId=i.level,this.coins=this.levelId<5?As:Ts),oB.Valid.isNumber(i.currentCoin)&&(this.currentCoin=i.currentCoin),!0))}},{key:"open",value:function(){this.updateComponents(),this.node.scene.emit(tr.HIDE_UI)}},{key:"close",value:(a=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name);case 2:return lB.emit(rB.CLOSE_SCREEN,{screenName:this.node.name}),e.next=5,yv.showInterstitialAdAsync({forLevel:this.screen.data.level});case 5:this.handleNextLevel();case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"overrideOpenHandler",value:(i=Ae(Se().mark((function e(t,n){var i,a=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.screen.setScreenOpacity(255),this.coinText.string="x0",this.playButtonComponent.interactable=!1,this.paperConfetti.runEffect(),e.next=6,this.animateWellDoneText();case 6:this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z),t.call(this.screen,n),null===(i=this.screen.getComponent(y))||void 0===i||i.once(y.EventType.FINISHED,(function(){a.animateCoin()}));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"handleNextLevel",value:function(){var e=this.screen.data.level;if(e){var t=uB.getGameData();if(t)e>=t.totalLevel?this.node.scene.emit(tr.MAX_LEVEL):this.node.scene.emit(tr.NEXT_LEVEL);else console.warn("LevelCompleteScreen: gameData not found")}else console.warn("LevelCompleteScreen: level not found")}},{key:"updateComponents",value:function(){this.updateLevelText(),this.updateCoinContainer()}},{key:"updateCoinContainer",value:function(){this.coinContainer.updateCoins({coins:this.currentCoin})}},{key:"updateLevelText",value:function(){var e=uB.getGameData();if(e){this.levelText.getComponent(u).string=`Level ${this.levelId}`,console.log("LevelCompleteScreen: updateLevelText",this.levelId);var t=this.levelId+1>e.totalLevel?"Complete":`Level ${this.levelId+1}`;this.nextLevelText.getComponent(u).string=t}else console.warn("LevelCompleteScreen: gameData not found")}},{key:"updateCoinString",value:function(){this.coinText.string=`x${this.coins}`,console.log("LevelCompleteScreen: updateCoinString",this.coins)}},{key:"animateCoin",value:(n=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.screen.container){e.next=3;break}return console.warn("LevelCompleteScreen: screen not found"),e.abrupt("return");case 3:return this.coinAnimation.play(),e.next=6,this.animateCoinText({contentFn:function(e){return`x${e}`},currentQuantity:0,targetQuantity:this.coins});case 6:return e.next=8,this.animateCoinCollection();case 8:return e.next=10,yn.runTweenAsync(this.showPlayButton());case 10:this.updateCoinString();case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"animateCoinCollection",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name);case 2:this.node.scene.emit(tr.ADD_COINS,{coins:this.coins,collectionAnimation:{animateTextOnly:!1,target:this.coinContainer}});case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"showPlayButton",value:function(){var e=this;return S(this.playButtonContainer).call((function(){e.playButtonContainer.setScale(0,0,e.playButtonContainer.scale.z)})).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).call((function(){e.playButtonComponent.interactable=!0}))}},{key:"handleClickedPlay",value:function(){this.playButtonComponent.interactable=!1,this.close()}},{key:"animateWellDoneText",value:function(){var e=this,t=this.wellDoneText.position.clone(),n=S(this.wellDoneText).call((function(){e.wellDoneText.setPosition(0,0,e.wellDoneText.position.z),e.wellDoneText.setScale(0,0,e.wellDoneText.scale.z)})).to(.5,{scale:new j(1.5,1.5,1)},{easing:"cubicOut"}).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).to(.5,{position:t},{easing:"backOut"});return yn.runTweenAsync(n)}},{key:"animateCoinText",value:function(e){var t=this,n=e.contentFn,i=e.currentQuantity,a=e.targetQuantity,r=e.duration,o=void 0===r?.8:r,s=S({currentQuantity:i}).to(o,{currentQuantity:a},{easing:"linear",onUpdate:function(e){if(e){var i=e.currentQuantity,a=Math.floor(i);t.coinText.string=n(a)}}});return yn.runTweenAsync(s)}}]),o}(f)).prototype,"coinContainer",[bF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MF=$e(OF.prototype,"playButton",[wF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NF=$e(OF.prototype,"coinText",[kF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FF=$e(OF.prototype,"levelText",[SF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BF=$e(OF.prototype,"nextLevelText",[CF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GF=$e(OF.prototype,"playButtonComponent",[EF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zF=$e(OF.prototype,"wellDoneText",[AF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UF=$e(OF.prototype,"coinAnimation",[TF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HF=$e(OF.prototype,"playButtonContainer",[xF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qF=$e(OF.prototype,"coinContainerAnimation",[PF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VF=$e(OF.prototype,"coinContainerEnterClip",[RF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WF=$e(OF.prototype,"coinContainerExitClip",[IF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KF=$e(OF.prototype,"paperConfetti",[_F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LF=OF))||LF);n._RF.pop(),n._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);var hB,pB,dB,fB,vB,yB,mB,gB,bB=i.ccclass,wB=i.disallowMultiple,kB=i.requireComponent,SB=GameCore.Events,CB=globalThis.game.event;bB("LoadingScreen")(eB=wB(eB=kB(hM)(eB=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return(e=t.call.apply(t,[this].concat(a))).handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e.handleClosedScreen=function(t){e.validateEventPayload(t)&&(e.enabled=!1)},e.handleOnCloseScreen=function(){nu.closeScreen(e.node.name)},e}return Pe(n,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){CB.on(SB.OPENING_SCREEN,this.handleOpeningScreen),CB.on(SB.OPENED_SCREEN,this.handleOpenedScreen),CB.on(SB.CLOSING_SCREEN,this.handleClosingScreen),CB.on(SB.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"unListenScreenEvents",value:function(){CB.off(SB.OPENING_SCREEN,this.handleOpeningScreen),CB.off(SB.OPENED_SCREEN,this.handleOpenedScreen),CB.off(SB.CLOSING_SCREEN,this.handleClosingScreen),CB.off(SB.CLOSED_SCREEN,this.handleClosedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"open",value:function(){if(this.enabled){var e=this.screen.data.duration;e&&e>0&&this.scheduleOnce(this.handleOnCloseScreen,e)}}}]),n}(f))||eB)||eB);n._RF.pop(),n._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);var EB,AB,TB,xB,PB,RB,IB,_B,LB=i.ccclass,OB=i.disallowMultiple,DB=i.requireComponent,MB=i.property,NB=GameCore,FB=NB.Events,BB=NB.Utils,GB=globalThis.game.event;hB=LB("NotificationScreen"),pB=DB(hM),dB=MB(u),fB=MB(p),hB(vB=OB(vB=pB((mB=$e((yB=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"message",mB,Ne(e)),Xe(e,"touchZone",gB,Ne(e)),e.enableCloseOnTouch=!0,e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&e.updateScreenData(t)},e.handleClosingScreen=function(t){e.validateEventPayload(t)&&e.unscheduleAllCallbacks()},e}return Pe(n,[{key:"__preload",value:function(){this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"onLoad",value:function(){this.validateRequiredComponents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){GB.on(FB.OPENING_SCREEN,this.handleOpeningScreen),GB.on(FB.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"unListenScreenEvents",value:function(){GB.off(FB.OPENING_SCREEN,this.handleOpeningScreen),GB.off(FB.CLOSING_SCREEN,this.handleClosingScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name}},{key:"updateScreenData",value:function(e){var t=this,n=e.screenData;BB.Valid.isObject(n)?(n.message&&(this.message.string=n.message),n.duration&&n.duration>0&&this.scheduleOnce((function(){nu.closeScreen(t.node.name)}),n.duration),!1===n.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}},{key:"handleClickedClose",value:function(){this.unscheduleAllCallbacks(),nu.closeScreen(this.node.name)}},{key:"closeOnTouch",value:function(){this.enableCloseOnTouch&&this.handleClickedClose()}}]),n}(f)).prototype,"message",[dB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gB=$e(yB.prototype,"touchZone",[fB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vB=yB))||vB)||vB);n._RF.pop(),n._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);var zB,UB,HB,qB,VB,WB,KB,jB,YB,XB,$B,JB,QB,ZB,eG,tG,nG,iG,aG,rG,oG,sG,lG=i.ccclass,uG=i.property,cG=i.requireComponent,hG=GameCore.Events,pG=globalThis.game.event;EB=lG("QuitLevelScreen"),AB=cG(hM),TB=uG(p),xB=uG(p),EB(PB=AB((IB=$e((RB=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"noButton",IB,Ne(e)),Xe(e,"yesButton",_B,Ne(e)),e.handleOpeningScreen=function(t){e.validateEventPayload(t)&&(e.noButton.interactable=!0,e.yesButton.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){pG.on(hG.OPENING_SCREEN,this.handleOpeningScreen),pG.on(hG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){pG.off(hG.OPENING_SCREEN,this.handleOpeningScreen),pG.off(hG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(tr.HIDE_UI)}},{key:"close",value:function(){this.noButton.interactable=!1,this.yesButton.interactable=!1,nu.closeScreen(this.node.name),this.node.scene.emit(tr.SHOW_UI),this.node.scene.emit(tr.GAME_RESUME)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedNo",value:function(){this.close()}},{key:"handleClickedYes",value:function(){this.node.scene.emit(tr.GAME_EXIT)}}]),n}(f)).prototype,"noButton",[TB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_B=$e(RB.prototype,"yesButton",[xB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PB=RB))||PB);n._RF.pop(),n._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);var dG,fG,vG,yG,mG,gG,bG,wG,kG,SG,CG,EG,AG,TG,xG,PG,RG,IG,_G,LG,OG,DG,MG,NG,FG,BG,GG=i.ccclass,zG=i.property,UG=i.disallowMultiple,HG=i.requireComponent,qG=GameCore.Events,VG=globalThis.game,WG=VG.event,KG=VG.player;zB=GG("RescuesScreen"),UB=HG(hM),HB=zG(M),qB=zG([a]),VB=zG(u),WB=zG(u),KB=zG(a),jB=zG(a),YB=zG(y),XB=zG(a),$B=zG(a),zB(JB=UG(JB=UB((ZB=$e((QB=function(e){Ie(s,e);var t,n,i,a,r,o=Be(s);function s(){var e;Te(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=o.call.apply(o,[this].concat(n)),"adOpacity",ZB,Ne(e)),Xe(e,"animNodes",eG,Ne(e)),Xe(e,"titleLabel",tG,Ne(e)),Xe(e,"descriptionLabel",nG,Ne(e)),Xe(e,"timer",iG,Ne(e)),Xe(e,"bomb",aG,Ne(e)),Xe(e,"bombAnim",rG,Ne(e)),Xe(e,"replayButton",oG,Ne(e)),Xe(e,"buyTimeButton",sG,Ne(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("RescuesScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(s,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){WG.on(qG.OPENING_SCREEN,this.handleOpeningScreen),WG.on(qG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){WG.off(qG.OPENING_SCREEN,this.handleOpeningScreen),WG.off(qG.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return e.screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:(r=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.resetState();case 2:this.runOpenAnimation(),this.node.scene.emit(tr.HIDE_UI);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"close",value:function(){WG.emit(qG.CLOSE_SCREEN,{screenName:this.node.name})}},{key:"resetState",value:(a=Ae(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(null===(t=this.payload.screenData)||void 0===t?void 0:t.failKey)===pu,this.titleLabel.string=n?"Boom!":"Time's Up!",this.descriptionLabel.string=n?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!n,this.bomb.active=n,n&&this.bombAnim.play(),i=KG.getGameData()){e.next=9;break}return e.abrupt("return");case 9:a=i.coins>=Rs,this.replayButton.active=!a,this.buyTimeButton.active=a,this.adOpacity.opacity=0;case 13:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"runOpenAnimation",value:(i=Ae(Se().mark((function e(){var t=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.screen.container){e.next=3;break}return console.warn("TimeUpScreen: screen not found"),e.abrupt("return");case 3:return e.next=5,Promise.all(this.animNodes.map((function(e,n){t.runAppearTween(e,.1*n)})));case 5:return e.next=7,this.runShowAdContainer();case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"runAppearTween",value:(n=Ae(Se().mark((function e(t,n){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(t).set({scale:new j(0,0,0)}).delay(n).to(1,{scale:new j(1,1,1)},{progress:function(e,t,n,i){return e+(t-e)*yn.elasticOut(i,.1,.45)}}));case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"runShowAdContainer",value:function(){var e=S(this.adOpacity);return e.delay(1),e.to(.5,{opacity:255}),yn.runTweenAsync(e)}},{key:"handleClickReplayButton",value:function(){this.close(),this.node.scene.emit(tr.GAME_REPLAY,{level:this.screen.data.level})}},{key:"handleClickBuyTimeButton",value:function(){this.node.scene.emit(tr.REMOVE_COINS,{coins:Rs,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}},{key:"handleClickAdButton",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yv.showRewardVideoAdAsync({});case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:this.startRescue();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"startRescue",value:function(){this.node.scene.emit(tr.SHOW_UI),this.node.scene.emit(tr.RESCUE_START),this.close()}}]),s}(f)).prototype,"adOpacity",[HB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eG=$e(QB.prototype,"animNodes",[qB],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tG=$e(QB.prototype,"titleLabel",[VB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nG=$e(QB.prototype,"descriptionLabel",[WB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iG=$e(QB.prototype,"timer",[KB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aG=$e(QB.prototype,"bomb",[jB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rG=$e(QB.prototype,"bombAnim",[YB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oG=$e(QB.prototype,"replayButton",[XB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sG=$e(QB.prototype,"buyTimeButton",[$B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JB=QB))||JB)||JB);n._RF.pop(),n._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);var jG,YG,XG,$G,JG,QG,ZG,ez,tz,nz,iz,az,rz,oz,sz,lz,uz,cz,hz,pz,dz,fz,vz,yz=i.ccclass,mz=i.property,gz=i.requireComponent,bz=GameCore,wz=bz.Events,kz=bz.Utils,Sz=globalThis.game,Cz=Sz.player,Ez=Sz.event;dG=yz("SettingsScreen"),fG=gz(hM),vG=mz(a),yG=mz(a),mG=mz(a),gG=mz(LP),bG=mz(LP),wG=mz(LP),kG=mz(p),SG=mz(p),CG=mz(p),EG=mz(p),AG=mz(a),dG(TG=fG((PG=$e((xG=function(e){Ie(i,e);var t,n=Be(i);function i(){var e;Te(this,i);for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return Xe(e=n.call.apply(n,[this].concat(a)),"musicSetting",PG,Ne(e)),Xe(e,"soundSetting",RG,Ne(e)),Xe(e,"vibrateSetting",IG,Ne(e)),Xe(e,"musicSwitch",_G,Ne(e)),Xe(e,"soundSwitch",LG,Ne(e)),Xe(e,"vibrateSwitch",OG,Ne(e)),Xe(e,"closeButtonComponent",DG,Ne(e)),Xe(e,"continueButtonComponent",MG,Ne(e)),Xe(e,"restartButtonComponent",NG,Ne(e)),Xe(e,"inviteFriendsButtonComponent",FG,Ne(e)),Xe(e,"animNodes",BG,Ne(e)),e.triggerSequence="",e.handleOpeningScreen=function(t){e.validateSwitchScreenPayload(t)&&(e.closeButtonComponent.interactable=!0,e.continueButtonComponent.interactable=!0,e.restartButtonComponent.interactable=!0,e.inviteFriendsButtonComponent.interactable=!0,e.updateStatus())},e.handleOpenedScreen=function(t){e.validateSwitchScreenPayload(t)&&e.open()},e.handleResetSequence=function(){e.triggerSequence=""},e.handleTriggerUnlockKey=function(t){if("code"in t){var n=t.code,i=Us.UNLOCK_SEQUENCE;"number"==typeof n&&-1!==i.indexOf(n.toString())&&(e.triggerSequence+=n.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",n,e.triggerSequence,e.triggerSequence===i),e.triggerSequence===i&&(e.node.scene.emit(Us.Events.UNLOCK_DEV_TOOLS),e.node.off(Us.Events.TRIGGER_UNLOCK_KEY)))}},e.updateVibrateButton=function(){var t=e.vibrateSetting.getComponentInChildren(p),n=e.vibrateSetting.getComponentInChildren(LP),i=e.vibrateSetting.getComponentInChildren(ga);if(t&&n&&i)if(kz.Device.isMobile()){var a,r=null!==(a=Cz.getPlayerSetting("vibrate"))&&void 0!==a&&a;n.setEnabled(r)}else t.interactable=!1,n.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")},e}return Pe(i,[{key:"onLoad",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}},{key:"onDestroy",value:function(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){Ez.on(wz.OPENING_SCREEN,this.handleOpeningScreen),Ez.on(wz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){Ez.off(wz.OPENING_SCREEN,this.handleOpeningScreen),Ez.off(wz.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateSwitchScreenPayload",value:function(e){return e.screenName===this.node.name}},{key:"listenUnlockDevTools",value:function(){this.node.off(Us.Events.TRIGGER_UNLOCK_KEY),this.node.on(Us.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(Us.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"unListenUnlockDevTools",value:function(){this.node.off(Us.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(Us.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}},{key:"open",value:function(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(Us.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(tr.HIDE_UI)}},{key:"close",value:function(){this.closeButtonComponent.interactable=!1,this.continueButtonComponent.interactable=!1,this.restartButtonComponent.interactable=!1,this.inviteFriendsButtonComponent.interactable=!1,this.node.emit(Us.Events.TRIGGER_RESET_SEQUENCE),nu.closeScreen(this.node.name)}},{key:"updateStatus",value:function(){var e,t,n,i={music:null!==(e=Cz.getPlayerSetting("music"))&&void 0!==e&&e,sound:null!==(t=Cz.getPlayerSetting("sound"))&&void 0!==t&&t,vibrate:null!==(n=Cz.getPlayerSetting("vibrate"))&&void 0!==n&&n};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(i.music),this.soundSwitch.setEnabled(i.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}},{key:"runPopUpAnimation",value:function(){var e=this;this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach((function(t,n){e.runAppearTween(t,.1*n)}))}},{key:"runAppearTween",value:function(e,t){var n=S(e);n.set({scale:new j(0,0,0)}),n.delay(t),n.to(1,{scale:new j(1,1,1)},{progress:function(e,t,n,i){return e+(t-e)*yn.elasticOut(i,.1,.45)}}),n.start()}},{key:"switchMusicButton",value:function(){if(this.musicSwitch){var e=this.musicSwitch.switch();Cz.setSetting("music",e),this.node.emit(Us.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e?wi.playMusic():wi.pauseMusic()}else console.warn("SettingsScreen: musicSwitch not found")}},{key:"switchSoundButton",value:function(){if(this.soundSwitch){var e=this.soundSwitch.switch();Cz.setSetting("sound",e),this.node.emit(Us.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}else console.warn("SettingsScreen: soundSwitch not found")}},{key:"switchVibrateButton",value:function(){if(this.vibrateSwitch){var e=this.vibrateSwitch.switch();Cz.setSetting("vibrate",e)}else console.warn("SettingsScreen: vibrateSwitch not found")}},{key:"handleClickedResume",value:function(){this.resumeGame()}},{key:"handleClickedClose",value:function(){this.resumeGame()}},{key:"handleClickedReplayGame",value:function(){this.restartGame()}},{key:"handleClickedInviteFriends",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.close(),this.node.scene.emit(tr.INVITE_FRIENDS);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"resumeGame",value:function(){this.close(),this.node.scene.emit(tr.GAME_RESUME),this.node.scene.emit(tr.SHOW_UI)}},{key:"restartGame",value:function(){var e;this.close(),this.node.scene.emit(tr.GAME_RESUME);var t=(null!==(e=Cz.getGameData())&&void 0!==e?e:{}).level,n=void 0===t?1:t;this.node.scene.emit(tr.GAME_REPLAY,{level:n})}}]),i}(f)).prototype,"musicSetting",[vG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RG=$e(xG.prototype,"soundSetting",[yG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IG=$e(xG.prototype,"vibrateSetting",[mG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_G=$e(xG.prototype,"musicSwitch",[gG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LG=$e(xG.prototype,"soundSwitch",[bG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OG=$e(xG.prototype,"vibrateSwitch",[wG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DG=$e(xG.prototype,"closeButtonComponent",[kG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MG=$e(xG.prototype,"continueButtonComponent",[SG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NG=$e(xG.prototype,"restartButtonComponent",[CG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FG=$e(xG.prototype,"inviteFriendsButtonComponent",[EG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BG=$e(xG.prototype,"animNodes",[AG],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),TG=xG))||TG);n._RF.pop(),n._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);var Az,Tz,xz,Pz,Rz,Iz,_z,Lz,Oz,Dz,Mz,Nz,Fz,Bz,Gz,zz,Uz,Hz,qz,Vz,Wz=i.ccclass,Kz=i.property,jz=(jG=Wz("StarChest"),YG=Kz(T),XG=Kz(M),$G=Kz(ae),JG=Kz(M),QG=Kz(M),ZG=Kz({type:C,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),ez=Kz({type:C,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),tz=Kz({type:C,displayName:"Centered Offset X",group:"Reward Animations"}),nz=Kz({type:C,displayName:"Centered Offset Y",group:"Reward Animations"}),iz=Kz({type:C,min:0,displayName:"Starting Scale",group:"Reward Animations"}),az=Kz({type:C,min:0,displayName:"Ending Scale",group:"Reward Animations"}),jG((sz=$e((oz=function(e){Ie(s,e);var t,n,i,a,r,o=Be(s);function s(){var e;Te(this,s);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=o.call.apply(o,[this].concat(n)),"sprite",sz,Ne(e)),Xe(e,"glowOpacity",lz,Ne(e)),Xe(e,"explosionParticles",uz,Ne(e)),Xe(e,"circle",cz,Ne(e)),Xe(e,"uiOpacity",hz,Ne(e)),e.ogCenterX=0,e.ogCenterY=0,Xe(e,"endingOffsetX",pz,Ne(e)),Xe(e,"endingOffsetY",dz,Ne(e)),Xe(e,"startingScale",fz,Ne(e)),Xe(e,"endingScale",vz,Ne(e)),e}return Pe(s,[{key:"startingOffsetX",get:function(){return this.node.position.x}},{key:"startingOffsetY",get:function(){return this.node.position.y}},{key:"__preload",value:function(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"moveToCenter",value:(r=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(this.endingOffsetX,this.endingOffsetY,this.node.position.z),e.next=3,yn.runTweenAsync(S(this.node).to(.7,{position:n},{easing:"quintInOut"}),t);case 3:this.node.position=n;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"respawnAtStartingState",value:function(){this.node.position=new j(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}},{key:"scale",value:(a=Ae(Se().mark((function e(t,n){var i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.startingScale+(this.endingScale-this.startingScale)*t,a=new j(i,i,i),e.next=4,Promise.all([yn.runTweenAsync(S(this.sprite.node).to(.2,{scale:a},{easing:"backOut"}),n),yn.runTweenAsync(S(this.glowOpacity.node).to(.2,{scale:a},{easing:"backOut"}),n)]);case 4:this.sprite.node.setScale(a),this.glowOpacity.node.setScale(a);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"startShaking",value:function(){var e=this,t=this.node.position.clone();this.shakingTween={ogPos:t,tw:S({}).to(.1,{},{onUpdate:function(n,i){if(i){var a=t.x+10*(i-.5);e.node.position=new j(a,t.y,t.z)}}}).repeatForever().start()}}},{key:"stopShaking",value:function(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}},{key:"glow",value:(i=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.sprite.node.scale.clone().multiplyScalar(1.1),e.next=3,Promise.all([yn.runTweenAsync(S(this.sprite.node).to(.2,{scale:n},{easing:"cubicInOut"}),t),yn.runTweenAsync(S(this.glowOpacity.node).to(.2,{scale:n}),t),yn.runTweenAsync(S(this.glowOpacity).to(.5,{opacity:255}),t)]);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"explode",value:(n=Ae(Se().mark((function e(t){var n,i,a,r=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new j(8,8,8),i=function(){var e=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.circle.opacity=255,r.circle.node.setScale(j.ZERO),e.next=4,Promise.all([yn.runTweenAsync(S(r.circle).to(.3,{opacity:0}),t),yn.runTweenAsync(S(r.circle.node).to(.3,{scale:n},{easing:"cubicOut"}),t)]);case 4:r.circle.opacity=0,r.circle.node.scale=n;case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),a=function(){var e=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([yn.runTweenAsync(S(r.glowOpacity.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),t),yn.runTweenAsync(S(r.sprite.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),t)]);case 2:r.sprite.node.setScale(j.ZERO),r.glowOpacity.node.setScale(j.ZERO);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),e.next=5,Promise.all([this.explodeParticles(t),i(),a()]);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"explodeParticles",value:(t=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.aborted){e.next=2;break}return e.abrupt("return");case 2:return this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem(),e.next=6,yn.waitTweenAsync(1);case 6:this.explosionParticles.node.active=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),s}(f)).prototype,"sprite",[YG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lz=$e(oz.prototype,"glowOpacity",[XG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uz=$e(oz.prototype,"explosionParticles",[$G],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cz=$e(oz.prototype,"circle",[JG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hz=$e(oz.prototype,"uiOpacity",[QG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e(oz.prototype,"startingOffsetX",[ZG],Object.getOwnPropertyDescriptor(oz.prototype,"startingOffsetX"),oz.prototype),$e(oz.prototype,"startingOffsetY",[ez],Object.getOwnPropertyDescriptor(oz.prototype,"startingOffsetY"),oz.prototype),pz=$e(oz.prototype,"endingOffsetX",[tz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dz=$e(oz.prototype,"endingOffsetY",[nz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fz=$e(oz.prototype,"startingScale",[iz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),vz=$e(oz.prototype,"endingScale",[az],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rz=oz))||rz);n._RF.pop(),n._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);var Yz,Xz,$z,Jz,Qz,Zz,eU,tU,nU,iU,aU,rU,oU,sU,lU=i.ccclass,uU=i.property,cU=i.requireComponent,hU=GameCore.Events,pU=globalThis.game,dU=pU.event,fU=pU.player;Az=lU("StarChestScreen"),Tz=cU(hM),xz=uU(nA),Pz=uU(u),Rz=uU(p),Iz=uU(y),_z=uU(jz),Lz=uU(M),Oz=uU(Mk),Dz=uU(u),Az(Mz=Tz((Fz=$e((Nz=function(e){Ie(o,e);var t,n,i,a,r=Be(o);function o(){var e;Te(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=r.call.apply(r,[this].concat(n)),"starProgressBar",Fz,Ne(e)),Xe(e,"buttonLabel",Bz,Ne(e)),Xe(e,"button",Gz,Ne(e)),Xe(e,"chestAnimation",zz,Ne(e)),Xe(e,"starChest",Uz,Ne(e)),Xe(e,"chestUnlockFXMask",Hz,Ne(e)),Xe(e,"skipOverlay",qz,Ne(e)),Xe(e,"messageLabel",Vz,Ne(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StarChestScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(o,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){dU.on(hU.OPENING_SCREEN,this.handleOpeningScreen),dU.on(hU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){dU.off(hU.OPENING_SCREEN,this.handleOpeningScreen),dU.off(hU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name}},{key:"open",value:function(){this.runPopUpAnimation(),this.node.scene.emit(tr.HIDE_UI);var e=fU.getGameData();if(e){var t=e.stars;this.numChestAvailable=Math.floor(t/20),this.starProgressBar.setRange(t,20),this.buttonLabel.string=this.numChestAvailable?"Open":"Continue",this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.button.interactable=!0,this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}}},{key:"close",value:function(){dU.emit(hU.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(tr.SHOW_UI)}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StarChestScreen: screen not found")}},{key:"handleClickButton",value:(a=Ae(Se().mark((function e(){var t,n,i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.numChestAvailable){e.next=3;break}return this.close(),e.abrupt("return");case 3:if(wi.turnDownMusic(),t=fU.getGameData()){e.next=7;break}return e.abrupt("return");case 7:return this.button.interactable=!1,n=t.stars,fU.setGameData({stars:t.stars-20*this.numChestAvailable}),i=new ha,e.next=13,this.skipOverlay.open({opacity:200,onSkip:function(){return i.abort()}});case 13:return e.next=15,this.handleUnlockAnimation(n,t.stars,i);case 15:return e.next=17,this.skipOverlay.close();case 17:wi.turnUpMusic(),x.emit(Ls),this.close();case 20:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"handleUnlockAnimation",value:(i=Ae(Se().mark((function e(t,n,i){var a,r,o,s,l,u=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this.starChest.moveToCenter(i),this.fadeInChestUnlockFX(i)]);case 2:return this.chestAnimation.stop(),this.starChest.startShaking(),wi.playSound(ti.STAR_CHEST_DRUM_ROLL,{loop:!0}),e.next=7,yn.waitTweenAsync(0);case 7:return a=t,r=this.numChestAvailable,o=function(e){return u.numChestAvailable>2?1-e/u.numChestAvailable:.35*(1-e/u.numChestAvailable)},s=function(e){a-e>=20&&(a=e,r--,u.starChest.scale(o(r),i),wi.playSound(ti.STAR_CHEST_OPEN))},e.next=13,Promise.all([this.starProgressBar.animateTo(n,i,s)]);case 13:return e.next=15,yn.waitTweenAsync(1,i);case 15:return this.starChest.stopShaking(),e.next=18,this.starChest.glow(i);case 18:return wi.stopSound(ti.STAR_CHEST_DRUM_ROLL),l=xs*this.numChestAvailable,this.node.scene.emit(tr.ADD_COINS,{coins:l,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:i}}),e.next=23,this.starChest.explode(i);case 23:return e.next=25,yn.waitTweenAsync(1,i);case 25:return e.next=27,Promise.all([this.fadeOutChestUnlockFX(i)]);case 27:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return i.apply(this,arguments)})},{key:"fadeInChestUnlockFX",value:(n=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.chestUnlockFXMask.node.active=!0,e.next=3,yn.runTweenAsync(S(this.chestUnlockFXMask).to(.5,{opacity:150}),t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fadeOutChestUnlockFX",value:(t=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.chestUnlockFXMask).to(.3,{opacity:0}),t);case 2:this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1;case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),o}(f)).prototype,"starProgressBar",[xz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bz=$e(Nz.prototype,"buttonLabel",[Pz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gz=$e(Nz.prototype,"button",[Rz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zz=$e(Nz.prototype,"chestAnimation",[Iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uz=$e(Nz.prototype,"starChest",[_z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hz=$e(Nz.prototype,"chestUnlockFXMask",[Lz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qz=$e(Nz.prototype,"skipOverlay",[Oz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vz=$e(Nz.prototype,"messageLabel",[Dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mz=Nz))||Mz);n._RF.pop(),n._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);var vU,yU,mU,gU,bU,wU=i.ccclass,kU=i.property,SU=i.requireComponent,CU=GameCore.Events,EU=globalThis.game.event;Yz=wU("StartLevelScreen"),Xz=SU(hM),$z=kU(a),Jz=kU(a),Qz=kU(a),Zz=kU(a),eU=kU(p),Yz(tU=Xz((iU=$e((nU=function(e){Ie(n,e);var t=Be(n);function n(){var e;Te(this,n);for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];return Xe(e=t.call.apply(t,[this].concat(a)),"playButton",iU,Ne(e)),Xe(e,"goalText",aU,Ne(e)),Xe(e,"levelText",rU,Ne(e)),Xe(e,"missionText",oU,Ne(e)),Xe(e,"playButtonComponent",sU,Ne(e)),e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("StartLevelScreen: screen not found");e.validateEventPayload(t)&&(e.playButtonComponent.interactable=!0)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(n,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){EU.on(CU.OPENING_SCREEN,this.handleOpeningScreen),EU.on(CU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){EU.off(CU.OPENING_SCREEN,this.handleOpeningScreen),EU.off(CU.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"validateEventPayload",value:function(e){var t=null!=e?e:{},n=t.screenName,i=t.screenData;return n===this.node.name&&(null!=i&&i.level&&(this.levelId=i.level),null!=i&&i.mission&&(this.mission=i.mission),!0)}},{key:"open",value:function(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(tr.HIDE_UI)}},{key:"close",value:function(){this.playButtonComponent.interactable=!1,EU.emit(CU.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(tr.SHOW_UI)}},{key:"updateComponents",value:function(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}},{key:"updateGoalText",value:function(){var e=this.mission.mission;this.goalText.getComponent(u).string=e>1?"Goals":"Goal"}},{key:"updateLevelText",value:function(){this.levelText.getComponent(u).string=`Level ${this.levelId}`}},{key:"updateDescriptionText",value:function(){this.missionText.getComponent(u).string=this.mission.description}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"handleClickedPlay",value:function(){this.node.scene.emit(tr.GAME_START),this.close()}}]),n}(f)).prototype,"playButton",[$z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aU=$e(nU.prototype,"goalText",[Jz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rU=$e(nU.prototype,"levelText",[Qz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oU=$e(nU.prototype,"missionText",[Zz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sU=$e(nU.prototype,"playButtonComponent",[eU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tU=nU))||tU);n._RF.pop(),n._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);var AU,TU,xU,PU,RU,IU,_U,LU,OU,DU,MU,NU,FU,BU,GU,zU,UU,HU,qU,VU,WU,KU,jU,YU,XU,$U,JU=i.ccclass,QU=i.property,ZU=(vU=JU("TournamentLeaderSkeleton"),yU=QU(a),vU((bU=$e((gU=function(e){Ie(a,e);var t,n,i=Be(a);function a(){var e;Te(this,a);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xe(e=i.call.apply(i,[this].concat(n)),"container",bU,Ne(e)),e}return Pe(a,[{key:"__preload",value:function(){this.uiOpacity=this.getComponent(M),this.validateRequiredComponents()}},{key:"hide",value:(n=Ae(Se().mark((function e(t){var n=this;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn.runTweenAsync(S(this.uiOpacity).to(.2,{opacity:0}).call((function(){n.node.active=!1})),t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"show",value:(t=Ae(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0,i=this.container.position.clone(),this.container.position=new j(i.x,i.y-100,i.z),(a=S(this.node).delay(t)).to(.2,{scale:j.ONE},{easing:"elasticOut"}),(r=S(this.container).delay(t)).to(.2,{position:i},{easing:"backOut"}),(o=S(this.uiOpacity).delay(t)).to(.2,{opacity:255},{easing:"cubicOut"}),e.next=13,Promise.all([yn.runTweenAsync(a,n),yn.runTweenAsync(r,n),yn.runTweenAsync(o,n)]);case 13:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"validateRequiredComponents",value:function(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}]),a}(f)).prototype,"container",[yU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mU=gU))||mU);n._RF.pop(),n._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);var eH,tH=i.ccclass,nH=i.property,iH=i.requireComponent,aH=GameCore.Events,rH=GameCore.Utils.Object,oH=globalThis.game,sH=oH.event,lH=oH.storage,uH=oH.player,cH=oH.leaderboard;AU=tH("TournamentDetailScreen"),TU=iH(hM),xU=nH(u),PU=nH(u),RU=nH(u),IU=nH(mI),_U=nH(s),LU=nH({type:a,group:"Buttons"}),OU=nH({type:a,group:"Buttons"}),DU=nH({type:a,group:"Buttons"}),MU=nH({type:[ZU]}),NU=nH({type:[T]}),FU=nH(zw),AU(BU=TU((zU=$e((GU=function(e){Ie(f,e);var t,n,i,a,r,o,s,l,u,c,h,p,d=Be(f);function f(){var e;Te(this,f);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return Xe(e=d.call.apply(d,[this].concat(n)),"titleLabel",zU,Ne(e)),Xe(e,"timeLabel",UU,Ne(e)),Xe(e,"playerCountLabel",HU,Ne(e)),Xe(e,"tournamentLeaders",qU,Ne(e)),Xe(e,"viewport",VU,Ne(e)),Xe(e,"playButton",WU,Ne(e)),Xe(e,"continueButton",KU,Ne(e)),Xe(e,"replayButton",jU,Ne(e)),Xe(e,"leaderSkeletons",YU,Ne(e)),Xe(e,"banners",XU,Ne(e)),Xe(e,"paperConfetti",$U,Ne(e)),e.animAbortSignal=null,e.fetchAbortController=null,e.leadersPayload=null,e.handleOpeningScreen=function(t){if(!e.screen)throw new Error("TournamentDetailScreen: screen not found");e.validateEventPayload(t)},e.handleOpenedScreen=function(t){e.validateEventPayload(t)&&e.open()},e}return Pe(f,[{key:"__preload",value:function(){this.enabled=!1,this.screen=this.getComponent(hM),this.tournamentScrollView=this.tournamentLeaders.node.getComponent(le),this.validateRequiredComponents(),this.listenScreenEvents()}},{key:"onDestroy",value:function(){this.unListenScreenEvents()}},{key:"validateRequiredComponents",value:function(){St.lazyValidateProperties(this)}},{key:"listenScreenEvents",value:function(){sH.on(aH.OPENING_SCREEN,this.handleOpeningScreen),sH.on(aH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"unListenScreenEvents",value:function(){sH.off(aH.OPENING_SCREEN,this.handleOpeningScreen),sH.off(aH.OPENED_SCREEN,this.handleOpenedScreen)}},{key:"updateVisibility",value:function(){this.tournamentLeaders.updateVisibility()}},{key:"validateEventPayload",value:function(e){return(null!=e?e:{}).screenName===this.node.name&&(this.payload=e,!0)}},{key:"open",value:function(){if(this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(tr.HIDE_UI),this.tournamentScrollView.node.on(le.EventType.SCROLLING,this.updateVisibility,this),null!==this.animAbortSignal)throw new Error("TournamentContent: TournamentContent is already loading. Please handle cancelling gracefully.");this.animAbortSignal=new ha,this.updateInfo(this.animAbortSignal)}},{key:"close",value:function(){nu.closeTournamentDetailScreen(),this.node.scene.emit(tr.SHOW_UI),this.tournamentScrollView.node.off(le.EventType.SCROLLING,this.updateVisibility,this),this.cleanup()}},{key:"cleanup",value:function(){var e,t;null===(e=this.fetchAbortController)||void 0===e||e.abort(),null===(t=this.animAbortSignal)||void 0===t||t.abort(),this.animAbortSignal=null,this.fetchAbortController=null,this.tournamentLeaders.removeLeaders()}},{key:"runPopUpAnimation",value:function(){this.screen.container||console.warn("StartLevelScreen: screen not found")}},{key:"updateInfo",value:(p=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l,u,c,h,p,d,f,v,y,m,g,b,w,k,S;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(n=this.payload)||void 0===n||null===(n=n.screenData)||void 0===n?void 0:n.tournament){e.next=3;break}return e.abrupt("return");case 3:return(o=JSON.parse(r)).id=o.id.toString(),this.tournamentPayload=o,s=this.tournamentPayload,l=s.endTime,u=s.payload,c=s.title,h=u.leaderboardId,p=void 0===h?"":h,d=u.themeId,this.updateTitle(c),this.updateEndTime(l),this.updateTournamentBanner(d),f=lH.getStorage("tournament"),v=f.previousScore,y=f.previousRank,m=f.animateTournamentLeader,this.updateButtonsVisibility(m),e.next=15,this.showLoading(t);case 15:return e.next=17,this.getLeadersPayload(p);case 17:if(this.leadersPayload=e.sent,this.leadersPayload){e.next=22;break}return this.updatePlayerCount(0),this.hideLoading(t),e.abrupt("return");case 22:return g=this.leadersPayload,b=g.player,w=g.leaders,this.updatePlayerCount(w.length),k=null!==(i=null==b?void 0:b.score)&&void 0!==i?i:0,S=null!==(a=null==b?void 0:b.rank)&&void 0!==a?a:0,b&&m&&v&&v<k&&y&&y!==S&&(w.find((function(e){return e.playerId===b.playerId})).score=v),e.next=29,this.hideLoading(t);case 29:return this.tournamentLeaders.updateData(w),e.next=32,this.runShowUpAnimation(t);case 32:if(m){e.next=34;break}return e.abrupt("return");case 34:return lH.setStorageData("tournament","animateTournamentLeader",!1),e.next=37,this.runPlayerRankChangeAnimation(t,k);case 37:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"updateTournamentBanner",value:function(e){e?this.activateThemeBanner(e):this.activateThemeBanner(yl.SUMMER)}},{key:"activateThemeBanner",value:function(e){var t=!1;this.banners.forEach((function(n){n.node.active=n.node.name.toLowerCase()===e,n.node.active&&(t=!0)})),t||this.banners.forEach((function(e){e.node.active=e.node.name.toLowerCase()===yl.SUMMER}))}},{key:"showLoading",value:(h=Ae(Se().mark((function e(t){var n,i=arguments;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:0,e.next=3,Promise.all([this.leaderSkeletons.map((function(e,i){return e.show(i*n,t)}))]);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"hideLoading",value:(c=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this.leaderSkeletons.map((function(e){return e.hide(t)})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"runShowUpAnimation",value:(u=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.tournamentLeaders.showLeaders(t);case 2:if(n=this.tournamentLeaders.getPlayerLeader()){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this.scrollToLeader(n,1);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return u.apply(this,arguments)})},{key:"runPlayerRankChangeAnimation",value:(l=Ae(Se().mark((function e(t,n){var i,a,r,o,s,l,u,c,h,p,d,f,v;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.tournamentLeaders.getLeaderData(),a=i.find((function(e){return e.playerId===uH.getPlayerId()}))){e.next=4;break}return e.abrupt("return");case 4:if(r=a.score,o=a.rank,r!==n){e.next=7;break}return e.abrupt("return");case 7:if(a.score=n,i.sort((function(e,t){return t.score-e.score})),i.forEach((function(e,t){e.rank=t+1})),s=this.tournamentLeaders.getPlayerLeader()){e.next=13;break}return e.abrupt("return");case 13:if(l=this.tournamentLeaders.getLeaderByRank(a.rank)){e.next=16;break}return e.abrupt("return");case 16:return this.tournamentLeaders.layout.enabled=!1,s.node.setParent(this.node,!0),e.next=20,s.runScaleAnimation(t,1.1,.5);case 20:return a.rank<=10&&wi.playSound(ti.STAR_CHEST_DRUM_ROLL),u=Math.min(.5*(o-a.rank),2),c=[s.runUpdateDataAnimation(o,a.rank,r,a.score,u),this.scrollToLeader(l,u)],h=this.viewport.contentSize.height,p=this.viewport.getBoundingBoxToWorld(),d=this.tournamentScrollView.getMaxScrollOffset().y,f=-l.node.position.y-h/2,v=j.ZERO,f<0?v=new j(s.node.worldPosition.x,p.yMax+l.node.position.y,s.node.worldPosition.z):this.tournamentScrollView.getScrollOffset().y>=d-5&&(v=f<d?new j(s.node.worldPosition.x,p.center.y,s.node.worldPosition.z):l.node.worldPosition),v.equals(j.ZERO)||c.push(s.runWorldPositionAnimation(v,u)),e.next=32,Promise.all(c);case 32:return wi.stopSound(ti.STAR_CHEST_DRUM_ROLL),e.next=35,Promise.all([s.runScaleAnimation(t,1,.25),s.node.setParent(this.tournamentLeaders.layout.node,!0),s.node.setSiblingIndex(a.rank-1),this.tournamentLeaders.runUpdateLeadersRankAnimation(a.rank,o),this.runPaperConfettiEffect(a.rank)]);case 35:this.tournamentLeaders.layout.enabled=!0,this.tournamentLeaders.layout.updateLayout();case 37:case"end":return e.stop()}}),e,this)}))),function(e,t){return l.apply(this,arguments)})},{key:"runPaperConfettiEffect",value:function(e){e>10||(this.paperConfetti.runEffect(),wi.playSound(ti.LEADERBOARD_TRIUMPH))}},{key:"scrollToLeader",value:(s=Ae(Se().mark((function e(t,n){var i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=this.tournamentLeaders.uiTransform.contentSize,a=new $(0,-t.node.position.y-i.height/2),r=this.tournamentScrollView.getScrollOffset().clone(),a.y=Math.max(a.y,0),r.y=Math.max(r.y,0),o=a.y-r.y,!(Math.abs(o)<5)){e.next=8;break}return e.abrupt("return");case 8:return this.tournamentScrollView.scrollToOffset(a,n),e.abrupt("return",yn.waitTweenAsync(n));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"updateTitle",value:function(e){e&&(this.titleLabel.string=e)}},{key:"updateEndTime",value:function(e){var t=GameCore.Utils.Time.getRelativeTime(e);t=(t=t.replace("seconds","secs").replace("second","sec")).replace("minutes","mins").replace("minute","min"),this.timeLabel.string=`Ends ${t}`}},{key:"updatePlayerCount",value:function(e){var t=GameCore.Utils.Number.getShortNumber(e,3);this.playerCountLabel.string=`${t} `+(e>1?"players":"player")}},{key:"setPlayerCountWaiting",value:function(){this.playerCountLabel.string="Loading..."}},{key:"getLeadersPayload",value:(o=Ae(Se().mark((function e(t){var n,i,a,r,o,s,l,u;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=cH.getLeaderboardName(t)){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,cH.requestLeaderboardAsync(n,0);case 5:if(i=cH.getLeaderboard(n)){e.next=8;break}return e.abrupt("return",null);case 8:for(a=Object.values(i.leaders),r=uH.getPlayerId(),o={leaders:[],player:void 0,isPlayerInTournament:!1},s=0,l=a;s<l.length;s++)(u=l[s]).playerId===r?(o.player=u,o.isPlayerInTournament=!0,o.leaders.push(u)):o.leaders.push(u);return e.abrupt("return",o);case 13:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"updateButtonsVisibility",value:function(e){this.playButton.active=!e,this.continueButton.active=e,this.replayButton.active=e}},{key:"handleOnPlay",value:(r=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.tournamentPayload.id||"",!uu.validateTournamentExpired(t)){e.next=7;break}return this.close(),this.node.scene.emit(Zs.RELOAD_TOURNAMENT),nu.showNotificationScreen("Tournament has ended",2),e.abrupt("return");case 7:return e.prev=7,nu.showLoadingNotificationScreen(),e.next=11,this.processJoinTournament();case 11:e.next=30;break;case 13:if(e.prev=13,e.t0=e.catch(7),!rH.hasOwn(e.t0,"code")||"USER_INPUT"!==e.t0.code){e.next=18;break}return nu.closeNotificationScreen(),e.abrupt("return");case 18:return e.prev=18,e.next=21,this.processContinueTournament();case 21:e.next=30;break;case 23:if(e.prev=23,e.t1=e.catch(18),!rH.hasOwn(e.t1,"code")||"USER_INPUT"!==e.t1.code){e.next=28;break}return nu.closeNotificationScreen(),e.abrupt("return");case 28:console.error("processPlayButtonPressed",e.t1),nu.showNotificationScreen("Sorry, you cannot join\nat this time.",2);case 30:case"end":return e.stop()}}),e,this,[[7,13],[18,23]])}))),function(){return r.apply(this,arguments)})},{key:"processJoinTournament",value:(a=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.joinTournamentAsync();case 3:Hl.switchScene($s,{isMatchStartFromLoader:!0,level:1}),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.warn("processJoinTournament",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return a.apply(this,arguments)})},{key:"processContinueTournament",value:(i=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.continueTournamentAsync();case 3:Hl.switchScene($s,{isMatchStartFromLoader:!0,level:1}),e.next=10;break;case 6:throw e.prev=6,e.t0=e.catch(0),console.warn("processContinueTournament",e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,6]])}))),function(){return i.apply(this,arguments)})},{key:"joinTournamentAsync",value:(n=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.tournamentPayload.id||"",e.next=3,Ll.joinTournamentAsync(t);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"continueTournamentAsync",value:(t=Ae(Se().mark((function e(){var t,n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null!==(t=GameSDK.context.getID())&&void 0!==t?t:"",e.next=3,Ll.continueTournamentAsync(n);case 3:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"updateButtonVisibility",value:function(){var e,t,n=(null!==(e=null===(t=this.payload)||void 0===t?void 0:t.screenData)&&void 0!==e?e:{}).tournamentContextType;switch(void 0===n?"tournament_start":n){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}}]),f}(f)).prototype,"titleLabel",[xU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UU=$e(GU.prototype,"timeLabel",[PU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HU=$e(GU.prototype,"playerCountLabel",[RU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qU=$e(GU.prototype,"tournamentLeaders",[IU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VU=$e(GU.prototype,"viewport",[_U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WU=$e(GU.prototype,"playButton",[LU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KU=$e(GU.prototype,"continueButton",[OU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jU=$e(GU.prototype,"replayButton",[DU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YU=$e(GU.prototype,"leaderSkeletons",[MU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),XU=$e(GU.prototype,"banners",[NU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$U=$e(GU.prototype,"paperConfetti",[FU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BU=GU))||BU);n._RF.pop(),n._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);(0,i.ccclass)("TournamentLeader")(eH=function(e){Ie(n,e);var t=Be(n);function n(){return Te(this,n),t.apply(this,arguments)}return Pe(n)}(YR));n._RF.pop(),n._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);var hH=GameCore.Events,pH=globalThis.game,dH=pH.event,fH=pH.monitorError,vH=function(){function e(){var t=this;Te(this,e),this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=function(){if(!t.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void(null==fH||fH.sendException(new Error("Core: Booting callback is not set")));console.info(" Core: Boot"),t.callbackCoreBooting(),t.callbackCoreBooting=null},this.handleWhenCoreStarting=function(){if(!t.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void(null==fH||fH.sendException(new Error("Core: Starting callback is not set")));console.info(" Core: Starting"),t.callbackCoreStarting(),t.callbackCoreStarting=null},this.handleWhenCoreReady=function(){if(!t.callbackCoreReady)return console.error("Core: Ready callback is not set"),void(null==fH||fH.sendException(new Error("Core: Ready callback is not set")));console.info(" Core: Ready"),t.callbackCoreReady(),t.callbackCoreReady=null}}return Pe(e,[{key:"init",value:function(){this.listenEvents(),console.info("Core Manager: Initialized")}},{key:"listenEvents",value:function(){dH.once(hH.CORE_BOOTING,this.handleWhenCoreBooting),dH.once(hH.CORE_STARTING,this.handleWhenCoreStarting),dH.once(hH.CORE_READY,this.handleWhenCoreReady)}},{key:"requestStart",value:function(){dH.emit(hH.REQUEST_CORE_START)}},{key:"onCoreBoot",value:function(e){this.callbackCoreBooting=e,dH.getEventEmitCount(hH.CORE_BOOTING)>0&&(dH.off(hH.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}},{key:"onCoreStart",value:function(e){this.callbackCoreStarting=e,dH.getEventEmitCount(hH.CORE_STARTING)>0&&(dH.off(hH.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}},{key:"onCoreReady",value:function(e){this.callbackCoreReady=e,dH.getEventEmitCount(hH.CORE_READY)>0&&(dH.off(hH.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}]),e}();n._RF.pop(),n._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);var yH=GameCore,mH=yH.Configs,gH=yH.Utils,bH=mH.GameEngine,wH=gH.Valid,kH=function(){function e(){var t=this;Te(this,e),this.overrideSettings=function(){ve.overrideSettings(ye.Category.ENGINE,"debug",wH.isDebugger())},this.handleResizeView=function(e){se.instance.resizeWithBrowserSize(!1);var n=e.width,i=e.height;t.resizeView(n,i)},this.handleViewResized=function(e){var t=e.width,n=e.height;se.instance.resizeWithBrowserSize(!0),console.info(" New View Size",{width:t,height:n})}}return Pe(e,[{key:"init",value:function(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.listenEvents(),console.info("Engine Manager: Initialized")}},{key:"listenEvents",value:function(){x.on(kn,this.handleResizeView),x.on(Sn,this.handleViewResized)}},{key:"setupAutoAtlas",value:function(){pe.instance.cacheAsset=!0}},{key:"setupDynamicAtlas",value:function(){switch(K.os){case K.OS.IOS:this.setupDynamicAtlasForIOS();break;case K.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}},{key:"setDynamicAtlas",value:function(e){var t=e.Enabled,n=e.AutoAtlasSize,i=e.MaxAtlasCount,a=e.MaxAtlasSize,r=e.MaxFrameSize;if(de.instance.enabled=t,de.instance.textureSize=a,de.instance.maxFrameSize=r,de.instance.maxAtlasCount=i,de.instance.textureBleeding=!0,n){var o=this.getMaxTextureSize();if(!o)return;de.instance.textureSize=o}}},{key:"getMaxTextureSize",value:function(){if(!d.root)return-1;var e=d.root.device.capabilities;return e.maxTextureSize>8192?8192:e.maxTextureSize}},{key:"setupDynamicAtlasForIOS",value:function(){var e=bH.DynamicAtlas.IOS;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForAndroid",value:function(){var e=bH.DynamicAtlas.Android;this.setDynamicAtlas(e)}},{key:"setupDynamicAtlasForDesktop",value:function(){var e=bH.DynamicAtlas.Desktop;this.setDynamicAtlas(e)}},{key:"setupBatcherLimit",value:function(){fe.BATCHER2D_MEM_INCREMENT=288,fe.MAX_LABEL_CANVAS_POOL_SIZE=125}},{key:"resizeView",value:function(e,t){var n,i=window.devicePixelRatio,a=i>=2?2/i:1,r=e*i*a,o=t*i*a;null===(n=d.root)||void 0===n||n.resize(r,o),B.windowSize=new G.Size(r,o),x.emit(Sn,{width:r,height:o})}}]),e}();n._RF.pop();var SH,CH=new(function(){function e(){Te(this,e),this._registry={},this._moduleCache={}}return Pe(e,[{key:"define",value:function(e,t,n){this._registry[e]={factory:t,resolveMap:n}}},{key:"require",value:function(e){return this._require(e)}},{key:"throwInvalidWrapper",value:function(e,t){throw new Error(`Module '${e}' imported from '${t}' is expected be an ESM-wrapped CommonJS module but it doesn't.`)}},{key:"_require",value:function(e,t){var n=this._moduleCache[e];if(n)return n.exports;var i={id:e,exports:{}};return this._moduleCache[e]=i,this._tryModuleLoad(i,e),i.exports}},{key:"_resolve",value:function(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}},{key:"_resolveFromInfos",value:function(e,t){var n,i;return e in cjsInfos?e:t&&null!==(n=null===(i=cjsInfos[t])||void 0===i?void 0:i.resolveCache[e])&&void 0!==n?n:void 0}},{key:"_tryModuleLoad",value:function(e,t){var n=!0;try{this._load(e,t),n=!1}finally{n&&delete this._moduleCache[t]}}},{key:"_load",value:function(e,t){var n=this._loadWrapper(t),i=n.factory,a=n.resolveMap,r=this._createRequire(e),o=a?this._createRequireWithResolveMap("function"==typeof a?a():a,r):r;i(e.exports,o,e)}},{key:"_loadWrapper",value:function(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}},{key:"_loadHostProvidedModules",value:function(e){return{factory:function(t,n,i){if("undefined"==typeof require)throw new Error(`Current environment does not provide a require() for requiring '${e}'.`);try{i.exports=require(e)}catch(t){throw new Error(`Exception thrown when calling host defined require('${e}').`,{cause:t})}}}}},{key:"_createRequire",value:function(e){var t=this;return function(n){return t._require(n,e)}}},{key:"_createRequireWithResolveMap",value:function(e,t){return function(n){var i=e[n];if(i)return t(i);throw new Error("Unresolved specifier "+n)}}},{key:"_throwUnresolved",value:function(e,t){throw new Error(`Unable to resolve ${e} from ${parent}.`)}}]),e}()),EH="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";CH.define(EH,(function(e,t,n,i,a){!function(t,i){"object"==typeof e&&void 0!==n?n.exports=i():"function"==typeof define&&define.amd?define(i):t.ResizeObserver=i()}(this,(function(){var e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,i){return e[0]===t&&(n=i,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),i=this.__entries__[n];return i&&i[1]},t.prototype.set=function(t,n){var i=e(this.__entries__,t);~i?this.__entries__[i][1]=n:this.__entries__.push([t,n])},t.prototype.delete=function(t){var n=this.__entries__,i=e(n,t);~i&&n.splice(i,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,i=this.__entries__;n<i.length;n++){var a=i[n];e.call(t,a[1],a[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,n="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),i="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(n):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],r="undefined"!=typeof MutationObserver,o=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var n=!1,a=!1,r=0;function o(){n&&(n=!1,e()),a&&l()}function s(){i(o)}function l(){var e=Date.now();if(n){if(e-r<2)return;a=!0}else n=!0,a=!1,setTimeout(s,t);r=e}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),r?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t;a.some((function(e){return!!~n.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),s=function(e,t){for(var n=0,i=Object.keys(t);n<i.length;n++){var a=i[n];Object.defineProperty(e,a,{value:t[a],enumerable:!1,writable:!1,configurable:!0})}return e},l=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||n},u=v(0,0,0,0);function c(e){return parseFloat(e)||0}function h(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){return t+c(e["border-"+n+"-width"])}),0)}function p(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return u;var i=l(e).getComputedStyle(e),a=function(e){for(var t={},n=0,i=["top","right","bottom","left"];n<i.length;n++){var a=i[n],r=e["padding-"+a];t[a]=c(r)}return t}(i),r=a.left+a.right,o=a.top+a.bottom,s=c(i.width),p=c(i.height);if("border-box"===i.boxSizing&&(Math.round(s+r)!==t&&(s-=h(i,"left","right")+r),Math.round(p+o)!==n&&(p-=h(i,"top","bottom")+o)),!function(e){return e===l(e).document.documentElement}(e)){var d=Math.round(s+r)-t,f=Math.round(p+o)-n;1!==Math.abs(d)&&(s-=d),1!==Math.abs(f)&&(p-=f)}return v(a.left,a.top,s,p)}var d="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof l(e).SVGGraphicsElement}:function(e){return e instanceof l(e).SVGElement&&"function"==typeof e.getBBox};function f(e){return t?d(e)?function(e){var t=e.getBBox();return v(0,0,t.width,t.height)}(e):p(e):u}function v(e,t,n,i){return{x:e,y:t,width:n,height:i}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=v(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=f(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),m=function(e,t){var n,i,a,r,o,l,u,c=(i=(n=t).x,a=n.y,r=n.width,o=n.height,l="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,u=Object.create(l.prototype),s(u,{x:i,y:a,width:r,height:o,top:a,right:i+r,bottom:o+a,left:i}),u);s(this,{target:e,contentRect:c})},g=function(){function t(t,n,i){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=n,this.callbackCtx_=i}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new m(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),b="undefined"!=typeof WeakMap?new WeakMap:new e,w=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=o.getInstance(),i=new g(t,n,this);b.set(this,i)};return["observe","unobserve","disconnect"].forEach((function(e){w.prototype[e]=function(){var t;return(t=b.get(this))[e].apply(t,arguments)}})),void 0!==n.ResizeObserver?n.ResizeObserver:w})),SH=n.exports}),{}),CH.require(EH),n._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);var AH=Fn,TH=Bn,xH=TH.Portrait,PH=TH.Landscape,RH=GameCore.Utils.Function,IH=function(){function e(){var t=this;Te(this,e),this.currentLayout="",this.handleViewResizeBySystem=function(e){console.info(" View resize by system"),window.devicePixelRatio=e||window.devicePixelRatio,t.setupOrientationByScreenSize(),t.resizeGameView()},this.handleViewResize=RH.debounce((function(){console.info(" View resize by window"),t.setupOrientationByScreenSize(),t.resizeGameView()}),200),this.handleBodyResize=RH.debounce((function(){console.info(" View resize by body"),t.resizeGameDiv(),t.setupOrientationByScreenSize(),t.resizeGameView()}),200)}return Pe(e,[{key:"init",value:function(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),x.emit(Cn),console.info("Layout Manager: Initialized")}},{key:"listenResizeEvent",value:function(){K.isBrowser?(B.on("window-resize",this.handleViewResize,this),B.on("orientation-change",this.handleViewResize,this)):K.isMobile?window.addEventListener("resize",this.handleViewResize,{capture:!1,passive:!0}):console.warn("LayoutManager: Not support this platform"),x.on(Cn,this.handleViewResizeBySystem)}},{key:"listenObserverEvent",value:function(){new SH(this.handleBodyResize).observe(document.body)}},{key:"setupResolutionPolicy",value:function(){se.instance.resizeWithBrowserSize(!0),se.instance.setOrientation(fe.ORIENTATION_AUTO),se.instance.setResolutionPolicy(me.ContentStrategy.FIXED_WIDTH),se.instance.setResolutionPolicy(me.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=se.instance.getResolutionPolicy()}},{key:"setupOrientationByScreenSize",value:function(){var e=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(me.ContentStrategy.FIXED_WIDTH),e<1?this.setPortraitView():this.setLandscapeView()}},{key:"resizeGameDiv",value:function(){var e=document.getElementById("GameDiv");if(e){var t=ea.getScreenWidthCss(),n=ea.getScreenHeightCss();e.style.width=`${t}px`,e.style.height=`${n}px`}}},{key:"resizeGameView",value:function(){var e=ea.getScreenWidthCss(),t=ea.getScreenHeightCss();x.emit(kn,{width:e,height:t})}},{key:"setPortraitView",value:function(){var e=xH.WIDTH,t=xH.HEIGHT;this.currentLayout=AH.Portrait,this.changeDesignResolutionSize(e,t)}},{key:"setLandscapeView",value:function(){var e=PH.WIDTH,t=PH.HEIGHT;this.currentLayout=AH.Landscape,this.changeDesignResolutionSize(e,t)}},{key:"changeDesignResolutionSize",value:function(e,t){se.instance.setDesignResolutionSize(e,t,this.resolutionPolicy),x.emit(En,this.currentLayout),console.info(" Change layout to",this.currentLayout)}},{key:"getScreenRatio",value:function(){return ea.getScreenWidthCss()/ea.getScreenHeightCss()}}]),e}();n._RF.pop(),n._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);var _H=GameCore,LH=_H.Utils,OH=_H.Dtos,DH=LH.Valid,MH=["code","cols","encoding","idSize","rows"],NH=["addRandomTilesPerMove","maxSpaceOfPair"],FH=function(){function e(){Te(this,e)}return Pe(e,[{key:"init",value:function(){console.info("Match Manager: Initialized")}},{key:"setupDefaultMatchData",value:function(){this.setupMatchData(),this.setupMatchCustomData()}},{key:"setupMatchCustomData",value:function(){var e=OH.Match;e.CustomData.addDefaultData(js),e.CustomData.addValidateFunction("score",(function(e){if(!DH.isNumber(e)||e<0)throw new Error(`score ${e} is invalid`)}))}},{key:"setupMatchData",value:function(){var e=this,t=OH.Match;t.Data.addDefaultData(Gs),t.Data.addValidateFunction("extraData",(function(t){if(null!=t){if(!DH.isObject(t))throw new Error(`extraData ${t} must be a record of string keys`);var n=t,i=Object.keys(n);if(!i.includes("level"))throw new Error("extraData.level is missing");if(!DH.isNumber(n.level))throw new Error(`extraData.level ${n.level} must be a number`);if(!i.includes("fen"))throw new Error("extraData.fen is missing");if(e.validateFen(n.fen),!i.includes("gravity"))throw new Error("extraData.gravity is missing");if(!DH.isString(n.gravity))throw new Error(`extraData.gravity ${n.gravity} must be a string`);if(!i.includes("rules"))throw new Error("extraData.rules is missing");if(e.validateLevelRules(n.rules),!i.includes("time"))throw new Error("extraData.time is missing");if(!DH.isNumber(n.time))throw new Error(`extraData.time ${n.time} must be a number`)}}))}},{key:"validateFen",value:function(e){if(!DH.isObject(e))throw new Error(`extraData.fen ${e} must be a record of string keys`);var t=this.validateKeys(e,MH);if(!DH.isNumber(t.idSize))throw new Error("fen.idSize must be a number");if(!DH.isString(t.code))throw new Error("fen.code must be a string");if(!DH.isNumber(t.rows))throw new Error("fen.rows must be a number");if(!DH.isNumber(t.cols))throw new Error("fen.cols must be a number");if(!DH.isObject(t.encoding))throw new Error("fen.encoding must be a record of string keys");var n=this.validateKeys(t.encoding,Object.values(Yu));Object.entries(n).forEach((function(e){var t=qe(e,2),n=t[0],i=t[1];if(!DH.isString(i))throw new Error(`fen.encoding.${n} ${i} must be a string`)}))}},{key:"validateLevelRules",value:function(e){if(!DH.isObject(e))throw new Error(`extraData.rules ${e} must be a record of string keys`);var t=this.validateKeys(e,NH);if(!DH.isNumber(t.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!DH.isNumber(t.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}},{key:"validateKeys",value:function(e,t){return Object.keys(e).forEach((function(e){if(!t.includes(e))throw new Error(`Key ${e} is missing`)})),e}}]),e}();n._RF.pop(),n._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);var BH=GameCore,GH=BH.Utils,zH=BH.Dtos,UH=GH.Valid,HH=globalThis.game.player,qH=function(){function e(){Te(this,e)}return Pe(e,[{key:"init",value:function(){console.info("Player Manager: Initialized")}},{key:"setupDefaultGameData",value:function(){var e=zH.Player;e.Data.addDefaultData(Ys),e.GameData.addDefaultData(Hs),e.GameData.addValidateFunction("stars",(function(e){if(!UH.isNumber(e)||e<0)throw new Error(`stars ${e} is invalid`)})),e.GameData.addValidateFunction("totalLevel",(function(e){if(!UH.isNumber(e)||e<1)throw new Error(`totalLevel ${e} is invalid`)})),e.GameData.addValidateFunction("levelVersion",(function(e){if(!UH.isNumber(e)||e<0)throw new Error(`levelVersion ${e} is invalid`)})),e.GameData.addValidateFunction("lastRewardedItems",(function(e){if(!UH.isNumber(e)||e<0)throw new Error(`lastRewardedItems ${e} is invalid`)})),e.GameData.addValidateFunction("lastCreateTournamentShown",(function(e){if(!UH.isNumber(e)||e<0)throw new Error(`lastCreateTournamentShown ${e} is invalid`)})),e.GameData.addValidateFunction("guideItemShowed",(function(e){if(!Array.isArray(e))throw new Error(`guideItemShowed ${e} is invalid`)})),e.GameData.addValidateFunction("items",(function(e){if(!UH.isObject(e))throw new Error(`items ${e} is invalid`);var t=Object.keys(e),n=Object.values(e);if(!t.includes(Es.HINT))throw new Error(`item ${Es.HINT} not found`);if(!t.includes(Es.THUNDER))throw new Error(`item ${Es.THUNDER} not found`);if(!t.includes(Es.STORM))throw new Error(`item ${Es.STORM} not found`);if(!t.includes(Es.PLIERS))throw new Error(`item ${Es.PLIERS} not found`);n.forEach((function(e){if(!UH.isNumber(e)||e<0)throw new Error(`item ${e} is invalid`)}))})),e.GameData.addValidateFunction("skins",(function(e){if(!UH.isObject(e))throw new Error(`skins ${e} is invalid`)}))}},{key:"requestConnectedPlayers",value:function(){HH.requestConnectedPlayers().catch((function(e){console.warn("player.requestConnectedPlayers",e)}))}}]),e}();n._RF.pop(),n._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);var VH=GameCore,WH=VH.Events,KH=VH.Utils.Valid,jH=globalThis.game,YH=jH.event,XH=jH.adaptivePerformance,$H=function(){function e(){var t=this;Te(this,e),this.handleBeginFrame=function(){d.on(J.EVENT_AFTER_UPDATE,t.lateUpdate),d.on(J.EVENT_BEFORE_UPDATE,t.updateActualFPS)},this.handleAfterSceneLaunch=function(e){XH&&XH.trackingScene(e.name)},this.handleRequestResizeGame=function(e){var t=e.forcePixelRatio;KH.isNumber(t)&&x.emit(Cn,t)},this.lateUpdate=function(){var e=1e3*x.deltaTime;null==XH||XH.updatePostStepDeltaTime(e)},this.updateActualFPS=function(){var e,t=null===(e=d.root)||void 0===e?void 0:e.fps;KH.isNumber(t)&&(null==XH||XH.updateActualFPS(t))}}return Pe(e,[{key:"init",value:function(){XH&&this.listenEvents()}},{key:"listenEvents",value:function(){YH.on(WH.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),d.once(J.EVENT_BEGIN_FRAME,this.handleBeginFrame),d.on(J.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}]),e}();n._RF.pop(),n._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);var JH=globalThis.game.canvasRecorder,QH=function(){function e(){Te(this,e)}return Pe(e,[{key:"init",value:function(){if(x.canvas&&JH){JH.setCanvas(x.canvas);var e=JH.getOptions(),t=JH.waitNextFrame;JH.waitNextFrame=Ae(Se().mark((function n(){return Se().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.syncFps){n.next=4;break}return n.abrupt("return",new Promise((function(e){d.once(J.EVENT_AFTER_RENDER,e),x.pause(),x.step()})));case 4:return x.resume(),n.next=7,t.call(JH);case 7:return n.abrupt("return",Promise.resolve());case 8:case"end":return n.stop()}}),n)})))}}}]),e}();n._RF.pop(),n._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);var ZH=function(){function e(){var t=this;Te(this,e),this.hideCocosStats=function(){clearInterval(t.waiter),t.waiter=setInterval(t.checkProfilerReady,100)},this.checkProfilerReady=function(){if(W){W._showFPS=!1;var e=W._rootNode;e&&(e.active=!1,e.isValid&&(e.destroyAllChildren(),e.removeAllChildren(),e.destroy(),clearInterval(t.waiter)))}}}return Pe(e,[{key:"init",value:function(){W&&d.on(J.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}]),e}();n._RF.pop(),n._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);var eq=GameCore,tq=eq.Configs,nq=eq.Events,iq=tq.GameEngine,aq=globalThis.game.event,rq=[".png",".jpg",".jpeg",".webp"],oq=function(){function e(){var t=this;Te(this,e),this.useHighQuality=!1,this.upgradableAssets=new Map,this.requestUpdateDynamicAssets=function(){x.emit(_n)},this.collectUpgradableAssets=function(e){var n,i=je(e.output=e.input);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(rq.includes(a.ext)&&!t.upgradableAssets.has(a.uuid)){t.useHighQuality&&(a.url=t.replaceAssetUrl(a.url),a.requestUpgrade=!0);var r={uuid:a.uuid,url:a.url,options:a.options,upgraded:a.upgraded,requestUpgrade:a.requestUpgrade,ext:a.ext};t.upgradableAssets.set(a.uuid,r)}}}catch(e){i.e(e)}finally{i.f()}},this.replaceAssetUrl=function(e){return t.useHighQuality?e.replace("native/","native32/"):e},this.handleUpgradeQuality=function(){t.useHighQuality=!0;var e=0,n=0,i=pe.instance,a=i.assets,r=i.loadAny,o=0;t.upgradableAssets.forEach((function(i){if(i.upgraded||i.requestUpgrade)e++;else{n++;var s=a.get(i.uuid);s instanceof L?(i.url=t.replaceAssetUrl(i.url),console.info("DynamicAssets: Process upgrade quality",i.uuid,i,s),r(i,i.options,(function(e,a){o++,e?console.warn("DynamicAssets: Upgrade error",e):(s.reset(a),i.upgraded=!0,t.upgradableAssets.set(i.uuid,i),console.info("DynamicAssets: Upgrade done",i.uuid,a,s),o>=n&&t.requestUpdateDynamicAssets())}))):console.warn("DynamicAssets: Asset not found",i.uuid)}})),console.warn("DynamicAssets: Upgradable Assets Info",{needUpgrade:n,upgraded:e,total:t.upgradableAssets.size})}}return Pe(e,[{key:"init",value:function(){var e=iq.DynamicAssets.Enabled;console.info("DynamicAssets: init",{EDITOR:false,Enabled:e}),e&&(pe.instance.transformPipeline.insert(this.collectUpgradableAssets,3),this.listenEvents())}},{key:"listenEvents",value:function(){var e=this;x.on(In,this.handleUpgradeQuality),aq.on(nq.SCENE_LAUNCHED,(function(t){var n=t.sceneName;[Xs].includes(n)||e.handleUpgradeQuality()}))}}]),e}();n._RF.pop(),n._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);var sq=GameCore,lq=sq.Configs,uq=sq.Events,cq=lq.GameEngine,hq=globalThis.game.event,pq=function(){function e(){var t=this;Te(this,e),this.result=[],this.requestUpdateDynamicAtlas=function(){requestAnimationFrame(t.updateDynamicAtlas)},this.createAtlas=function(){return de.instance.newAtlas()},this.updateDynamicAtlas=function(){var e=d.getScene();if(e){var n=e.getComponentsInChildren(ge),i=[];if(n.forEach((function(e){if(e.enabled&&e.node.activeInHierarchy)if("spriteFrame"in e){if(e.spriteFrame instanceof O){var t=e.spriteFrame,n=t.uuid,a=t.packable,r=t.texture,o=t.original;if(a)if(r instanceof be){var s=r.getId(),l=r.width,u=r.height,c=(null==o?void 0:o._texture)||{width:0,height:0},h=c.width,p=c.height;if(o){var d=o._texture.getId();if(s===d)return void console.warn("DynamicAtlas: Skip original texture",e.name,{ori:o._texture,tex:r});s=d}var f=(o?h:l)+2,v=(o?p:u)+2;i.push({id:s,name:n,w:f,h:v,x:-1,y:-1,comp:e})}else console.warn("DynamicAtlas: Skip non-texture2d texture",e.name);else console.warn("DynamicAtlas: Skip non-packable texture",e.name)}}else console.warn("DynamicAtlas: Skip non-sprite component",e.name,e)})),0!==i.length){console.info("DynamicAtlas: collect info",i);var a=[];i.forEach((function(e){a.find((function(t){return t.id===e.id}))||a.push(e)})),0!==a.length&&(t.result=[],t.resetDynamicAtlas(),t.fillTextures(a),t.refreshComponents(n))}}},this.calculateOptimizedAtlas=function(e,n){var i=Ve(e),a=function(e){var t,n=0,i=0,a=je(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;n+=r.w*r.h,i=Math.max(i,r.w)}}catch(e){a.e(e)}finally{a.f()}e.sort((function(e,t){return t.h-e.h}));var o,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),i),h:1/0}],l=0,u=0,c=je(e);try{for(c.s();!(o=c.n()).done;)for(var h=o.value,p=s.length-1;p>=0;p--){var d=s[p];if(!(h.w>d.w||h.h>d.h)){if(h.x=d.x,h.y=d.y,u=Math.max(u,h.y+h.h),l=Math.max(l,h.x+h.w),h.w===d.w&&h.h===d.h){var f=s.pop();p<s.length&&(s[p]=f)}else h.h===d.h?(d.x+=h.w,d.w-=h.w):h.w===d.w?(d.y+=h.h,d.h-=h.h):(s.push({x:d.x+h.w,y:d.y,w:d.w-h.w,h:h.h}),d.y+=h.h,d.h-=h.h);break}}}catch(e){c.e(e)}finally{c.f()}return{w:l,h:u,fill:n/(l*u)||0}}(i=e.reduce((function(e,t){return e.some((function(e){return e.id===t.id}))||e.push(t),e}),[])),r=a.w,o=a.h,s=a.fill;if(r>n||o>n){var l=i.slice(0,i.length-1);return t.calculateOptimizedAtlas(l,n)}return console.info("DynamicAtlas: packed map info",r,o,s,i),i},this.fillTextures=function(e){if(0!==e.length){var n=de.instance.textureSize;t.result=t.calculateOptimizedAtlas(e,n)}},this.drawTexture=function(e,n,i){var a=n.texture,r=a.getId(),o=t.result.find((function(e){return e.id===r}))||{x:-1,y:-1},s=o.x,l=o.y;if(s<0||l<0)return e.originalInsertSpriteFrame(n);var u=e._innerTextureInfos[r];u||(i&&(e._texture.drawTextureAt(a.image,s-1,l),e._texture.drawTextureAt(a.image,s+1,l),e._texture.drawTextureAt(a.image,s,l-1),e._texture.drawTextureAt(a.image,s,l+1)),e._texture.drawTextureAt(a.image,s,l),e._count++,e._innerTextureInfos[r]={texture:a,x:s,y:l});var c=n.rect,h=c.x,p=c.y;h+=(null==u?void 0:u.x)||s,p+=(null==u?void 0:u.y)||l;var d={texture:e._texture,x:h,y:p};return e._innerSpriteFrames.push(n),d},this.refreshComponents=function(e){e.forEach((function(e){e.node.active&&(e.node.active=!1,e.node.active=!0)}))}}return Pe(e,[{key:"init",value:function(){var e=cq.DynamicAtlas.TextureAtlasOptimize;e&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:e}),this.listenEvents(),this.overrideDynamicAtlas())}},{key:"listenEvents",value:function(){x.on(_n,this.requestUpdateDynamicAtlas),hq.on(uq.SCENE_LAUNCHED,this.requestUpdateDynamicAtlas)}},{key:"overrideDynamicAtlas",value:function(){var e=this,t=de.instance;de.instance.insertSpriteFrame=function(n){if(t._atlasIndex>=t._maxAtlasCount)return null;if(!n||n.original)return null;if(!n.packable)return null;var i=e.getAtlas(),a=i?i.insertSpriteFrame(n):null;return!a&&t._atlasIndex<t._maxAtlasCount?(i=e.getAtlas())?i.insertSpriteFrame(n):null:a}}},{key:"resetDynamicAtlas",value:function(){de.instance.reset()}},{key:"getAtlas",value:function(){var e=this,t=de.instance,n=t._atlases,i=void 0===n?[]:n,a=t._atlasIndex,r=t.textureBleeding,o=i[a];return o||(o=this.createAtlas()),o.originalInsertSpriteFrame||(o.originalInsertSpriteFrame=o.insertSpriteFrame,o.insertSpriteFrame=function(t){return e.drawTexture(o,t,r)}),o}}]),e}();n._RF.pop();var dq={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};n._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);var fq=GameCore.Events,vq=globalThis.game,yq=vq.event,mq=vq.language,gq=function(){function e(){var t=this;Te(this,e),this.handleLanguageChanged=function(){var e=Ae(Se().mark((function e(n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n.locale,x.emit("update-language",i),t.updateComponentInEditor();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}var n,i,a;return Pe(e,[{key:"init",value:function(){var e=this;this.addLanguage("en").then((function(){e.setLanguage("en"),e.listenEvent()}))}},{key:"listenEvent",value:function(){yq.on(fq.LANGUAGE_CHANGED,this.handleLanguageChanged)}},{key:"addLanguage",value:(a=Ae(Se().mark((function e(t){var n;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getLangData(t);case 2:n=e.sent,mq.add(t,n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"setLanguage",value:function(e){mq.choose(e)}},{key:"getLangData",value:(i=Ae(Se().mark((function e(t){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t,e.next="en"===e.t0?3:"ru"===e.t0?4:5;break;case 3:return e.abrupt("return",dq);case 4:return e.abrupt("return",this.loadLanguageAsync(t));case 5:throw new Error(`Language ${t} not supported`);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"loadLanguageAsync",value:(n=Ae(Se().mark((function e(n){var i;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.import(`db://assets/resources/locales/${n}.json`);case 2:i=e.sent.default,mq.add(n,i);case 4:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"updateComponentInEditor",value:function(){}}]),e}();n._RF.pop(),n._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);var bq=GameCore,wq=bq.Configs,kq=bq.Utils,Sq=wq.Mockup,Cq=kq.Number,Eq=globalThis.game.leaderboard,Aq=function(){function e(){var t=this;Te(this,e),this.handleWhenGameSDKStarted=function(){wq.Mockup.Leaderboards.Enabled?t.setupLeaderboardsMockup():t.setupLeaderboards()}}var t,n,i,a,r;return Pe(e,[{key:"init",value:function(){this.handleWhenGameSDKStarted()}},{key:"setupLeaderboards",value:(r=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setupLeaderboardByConfigs();case 1:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"setupLeaderboardByConfigs",value:function(){var e=wq.Leaderboards.LeaderboardId;e?(Eq.addLeaderboard({name:qs,type:"global",autoSortRank:!0,leaderboardId:e}),Eq.addLeaderboard({name:Vs,type:"friends",autoSortRank:!0,leaderboardId:e})):console.warn("LeaderboardId in Configs is not set")}},{key:"setupLeaderboardsMockup",value:(a=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard();case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"setupMockGlobalLeaderboard",value:(i=Ae(Se().mark((function e(){var t,n,i,a;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=qs,n=Ws,e.next=4,Eq.createLeaderboardAsync({_id:n,name:t,numberOfLeaders:100});case 4:return i=e.sent,Eq.addLeaderboard({name:t,type:"global",autoSortRank:!0,leaderboardId:i}),e.next=8,Eq.requestLeaderboardAsync(t,10);case 8:a=Eq.getLeaderboard(t),console.info("setupGlobalLeaderboard fetch new",a,a&&Object.keys(a.leaders).length),a=Eq.getLeaderboard(t),console.info("setupGlobalLeaderboard load more",a,a&&Object.keys(a.leaders).length);case 12:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"setupMockFriendsLeaderboard",value:(n=Ae(Se().mark((function e(){var t,n,i,a,r,o;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Vs,n=Ks,i=0,(a=Sq.GameSDK.Player.ConnectedPlayers).Enabled&&(i=Cq.random(a.NumOfPlayers)),e.next=7,Eq.createLeaderboardAsync({_id:n,name:t,numberOfLeaders:i});case 7:return r=e.sent,Eq.addLeaderboard({name:t,type:"friends",autoSortRank:!0,leaderboardId:r}),e.next=11,Eq.requestLeaderboardAsync(t,10);case 11:o=Eq.getLeaderboard(t),console.info("setupFriendsLeaderboard done",o);case 13:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"setupMockGlobalTournamentLeaderboard",value:(t=Ae(Se().mark((function e(){var t;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,uu.requestTournamentDataAsync();case 2:(t=e.sent).forEach((function(e){var t=e.payload.leaderboardId;Eq.isExistLeaderboardId(t)||Eq.addLeaderboard({type:"tournament",name:t,autoSortRank:!0,leaderboardId:t})})),console.info("setupGlobalTournamentLeaderboard done",t);case 5:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}();n._RF.pop(),n._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);var Tq=GameCore,xq=Tq.Configs,Pq=Tq.Utils,Rq=Tq.Events,Iq=xq.PerformanceMonitor,_q=globalThis.game.event,Lq=function(){function e(){var t=this;Te(this,e),this.markName="FPS Tracking",this.handleStartTraceFps=function(){t.startTraceFps()},this.handleLateUpdate=function(){if(t.mark){if(t.fpsTraceDuration-=x.deltaTime,t.fpsTraceDuration<=0&&!t.traceStopped)return t.traceStopped=!0,t.unListenEvents(),t.updateFPS(),void t.mark.stop(t.markName);t.fpsTraceIntervalTimer-=x.deltaTime,t.fpsTraceIntervalTimer>0||(t.fpsTraceIntervalTimer=t.fpsTraceInterval,t.updateFPS(),t.mark.stop(t.markName),t.startTraceFps())}}}return Pe(e,[{key:"mark",get:function(){return Iq.FpsTracking?Pq.Mark:null}},{key:"init",value:function(){var e=Iq.FpsTracking,t=e.TrackingDuration,n=e.TrackingInterval;this.fpsTraceDuration=null!=t?t:60,this.fpsTraceInterval=null!=n?n:10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}},{key:"listenEvents",value:function(){_q.once(Rq.GAME_READY,this.handleStartTraceFps),d.on(J.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"unListenEvents",value:function(){d.off(J.EVENT_AFTER_UPDATE,this.handleLateUpdate)}},{key:"startTraceFps",value:function(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}},{key:"updateFPS",value:function(){var e,t;if(this.mark){var n=this.getFPS(),i=this.getDrawCalls(),a=this.getDeviceRender(),r=this.getTextureMemory();this.minFps=Math.min(null!==(e=this.minFps)&&void 0!==e?e:n,n),this.maxFps=Math.max(null!==(t=this.maxFps)&&void 0!==t?t:0,n),this.mark.putMetric(this.markName,"FPS Metric",n),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",a),this.mark.putAttr(this.markName,"Draw Calls",i.toString()),this.mark.putAttr(this.markName,"Texture Memory",r.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info(`FPS: ${n} Min: ${this.minFps} Max: ${this.maxFps}, draw calls: ${i}, texture memory: ${r.toFixed(2)}MB`)}}},{key:"getFPS",value:function(){if(!d.root)return 0;var e=d.root.fps;return Math.floor(e)||0}},{key:"getDrawCalls",value:function(){return d.root&&d.root.device.numDrawCalls||0}},{key:"getDeviceRender",value:function(){return d.root&&d.root.device.renderer||"Unknown"}},{key:"getTextureMemory",value:function(){return d.root&&d.root.device.memoryStatus.textureSize/1048576||0}}]),e}();n._RF.pop(),n._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);var Oq=GameCore.Events,Dq=globalThis.game.event,Mq=function(){function e(){Te(this,e),this.handleHotReload=function(){x.restart()},this.handleUpdateConfig=function(e){if("Gameplay"===e.type){x.emit(An,e.config);var t=e.id,n=e.type;Dq.emit(Oq.REMOTE_CONFIG_UPDATED,{id:t,type:n})}}}return Pe(e,[{key:"init",value:function(){this.listenEvents()}},{key:"listenEvents",value:function(){Dq.on(Oq.REQUEST_HOT_RELOAD,this.handleHotReload),Dq.on(Oq.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}]),e}();n._RF.pop(),n._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);var Nq=function(){function e(){Te(this,e)}return Pe(e,[{key:"init",value:function(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}},{key:"initLanguages",value:function(){(new gq).init()}},{key:"initCocosStats",value:function(){(new ZH).init()}},{key:"initLeaderboards",value:function(){(new Aq).init()}},{key:"initRemoteConfig",value:function(){(new Mq).init()}},{key:"initDynamicAtlas",value:function(){(new pq).init()}},{key:"initDynamicAssets",value:function(){(new oq).init()}},{key:"initCanvasRecorder",value:function(){(new QH).init()}},{key:"initPerformanceMonitor",value:function(){(new Lq).init()}},{key:"initAdaptivePerformance",value:function(){(new $H).init()}}]),e}();n._RF.pop(),n._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);var Fq=globalThis.game.event,Bq=GameCore,Gq=Bq.Events,zq=Bq.Configs,Uq=Bq.Utils,Hq=function(){function e(){var t=this;Te(this,e),this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=function(){var e=Ae(Se().mark((function e(n){var i,a,r;return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.sceneName,a=n.sceneData,r=t.correctSceneName(i),console.info("Switching",r,null!=a?a:{}),r){e.next=5;break}return e.abrupt("return");case 5:nu.showLoadingFullScreen(r),t.startScene({sceneName:r,sceneData:a});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.preloadScene=function(e,n){var i=e.sceneName;t.startMeasure(i),d.preloadScene(i,t.onSceneProgress,t.onScenePreloaded(i,n))},this.startMeasure=function(e){t.mark&&(t.queueLoadScene[e]&&(t.mark.putAttr(t.markName,"Canceled","true"),t.stopMeasure(e)),console.groupCollapsed(" Load scene progress"),t.mark.measure(t.markName),t.mark.putAttr(t.markName,"Cancel","false"),t.mark.putAttr(t.markName,"Success","false"),t.mark.putMetric(t.markName,e),t.mark.start(t.markName),t.queueLoadScene[e]=!0)},this.stopMeasure=function(e){t.mark&&t.queueLoadScene[e]&&(t.mark.rmAttr(t.markName,"File"),t.mark.putAttr(t.markName,"Success","true"),t.mark.stop(t.markName),t.queueLoadScene[e]=!1,console.groupEnd())},this.onSceneProgress=function(e,n,i){var a=e/n;t.mark&&t.mark.putAttr(t.markName,"Last File",`${i.id} (${i.ext})`);var r=Math.floor(70*a+30);GameSDK.setLoadingProgress(r)},this.onScenePreloaded=function(e,t){return function(n){n?console.warn("SceneManager.onScenePreloaded",{sceneName:e,error:n}):(t&&t(e,n),Fq.emit(Gq.SCENE_LOADED,{sceneName:e,isPreload:!0}))}},this.onDirectorLoadScene=function(e){return function(n,i){if(n)console.warn("SceneManager.onSceneLoaded",n);else if(null!=i&&i.scene){var a=i.name;t.handleBeforeSceneLaunch(i,e)(),d.once(J.EVENT_AFTER_SCENE_LAUNCH,t.handleSceneLaunched(a,e))}else console.warn("SceneManager.onSceneLoaded","Scene not found")}},this.handleBeforeSceneLaunch=function(e,n){return function(){t.setSceneData(e,null!=n?n:{}),x.emit(Cn),Fq.emit(Gq.SCENE_LOADED,{sceneName:e.name})}},this.handleSceneLaunched=function(e,n){return function(){nu.hideLoadingFullScreen(e),d.once(J.EVENT_AFTER_RENDER,(function(){var i;bi.switchSceneTracking(),null===(i=t.callbackSwitchScene)||void 0===i||i.call(t,{sceneName:e,sceneData:n}),Fq.emit(Gq.SCENE_LAUNCHED,{sceneName:e})}))}},this.handleSceneLoaded=function(e){var n=e.sceneName;t.stopMeasure(n)}}return Pe(e,[{key:"init",value:function(){this.listenEvents(),console.info("Scene Manager: Initialized")}},{key:"listenEvents",value:function(){Fq.on(Gq.SWITCH_SCENE,this.switchScene),Fq.on(Gq.PRELOAD_SCENE,this.preloadScene),Fq.on(Gq.SCENE_LOADED,this.handleSceneLoaded)}},{key:"correctSceneName",value:function(e){var t=this.getCurrentScene();return t&&e===t.name?null:e}},{key:"startScene",value:function(e){var t=this,n=e.sceneName,i=e.sceneData;this.preloadScene({sceneName:n},(function(e,a){e===n&&(a?console.warn("SceneManager.startScene",{sceneName:n,error:a}):d.loadScene(n,t.onDirectorLoadScene(i)))}))}},{key:"mark",get:function(){return zq.PerformanceMonitor.LoadResources?Uq.Mark:null}},{key:"getCurrentScene",value:function(){return d.getScene()}},{key:"getLoadedScenes",value:function(){var e=this,t=[];return Object.keys(this.queueLoadScene).map((function(n){e.queueLoadScene[n]||t.push(n)})),t}},{key:"onSwitchScene",value:function(e){this.callbackSwitchScene=e}},{key:"setSceneData",value:function(e,t){if(t&&("data"in e||e.scene.attr({data:{}}),"data"in e)){var n=e.data||{};e.scene.attr({data:ke(ke({},n),t)}),console.info("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:n})}}}]),e}();n._RF.pop(),n._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);var qq=globalThis.game.event,Vq=GameCore.Events,Wq=function(){function e(){var t=this;Te(this,e),this.screens={},this.handleOpenScreen=function(e){var n=e.screenName,i=e.screenData;t.openScreen(n,i)},this.handleCloseScreen=function(e){var n=e.screenName;t.closeScreen(n)}}return Pe(e,[{key:"init",value:function(){this.listenEvents(),console.info("Screen Manager: Initialized")}},{key:"listenEvents",value:function(){qq.on(Vq.OPEN_SCREEN,this.handleOpenScreen),qq.on(Vq.CLOSE_SCREEN,this.handleCloseScreen)}},{key:"addScreen",value:function(e){this.screens[e.node.name]=e}},{key:"getScreen",value:function(e){return this.screens[e]}},{key:"clearScreens",value:function(){this.screens={}}},{key:"openScreen",value:function(e,t){var n=this.getScreen(e);if(n&&n.node){n.node.active=!0,n.node.setPosition(new j(0,0,0));var i={screenName:e,screenData:t};qq.emit(Vq.OPENING_SCREEN,i),bi.trackCurrentPage(e,!0),n.scheduleOnce((function(){n.open(t),qq.emit(Vq.OPENED_SCREEN,i)}),0)}else console.warn("ScreenManager.openScreen",`Screen ${e} not found`)}},{key:"closeScreen",value:function(e){var t,n=this.getScreen(e);if(n){if(null!==(t=n.node)&&void 0!==t&&t.active){var i={screenName:e};qq.emit(Vq.CLOSING_SCREEN,i),n.close(),bi.trackCurrentPage(e,!1)}}else console.warn("ScreenManager.closeScreen",`Screen ${e} not found`)}},{key:"closeAllScreens",value:function(){var e=this;Object.keys(this.screens).forEach((function(t){e.closeScreen(t)}))}}]),e}();n._RF.pop(),n._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);var Kq=GameCore,jq=Kq.Configs,Yq=Kq.Events,Xq=Kq.Plugins,$q=globalThis.game,Jq=$q.player,Qq=$q.context,Zq=$q.event,eV=$q.analytics,tV=$q.monitorError;new(function(){function e(){var t=this;Te(this,e),this.coreManager=new vH,this.matchManager=new FH,this.sceneManager=new Hq,this.screenManager=new Wq,this.engineManager=new kH,this.layoutManager=new IH,this.playerManager=new qH,this.pluginsManager=new Nq,this.handleWhenCoreBoot=function(){x.inited?t.handleCocosInit():x.once(we.EVENT_POST_PROJECT_INIT,t.handleCocosInit)},this.handleCocosInit=function(){t.coreManager.requestStart()},this.handleWhenCoreStart=function(){t.playerManager.setupDefaultGameData(),t.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=function(){t.initPlugins(),t.preloadScenes(),console.groupEnd(),jq.Core.StartSDKAfterLoadGame?(Zq.on(Yq.SCENE_LAUNCHED,t.handleStartGameWhenMainSceneReady),t.switchScene()):t.processStartGame()},this.handleStartGameWhenMainSceneReady=function(e){var n=e.sceneName,i=Jq.isFirstLogin();if(i&&n===$s)t.processStartGame();else{if(i||n!==Js)return void console.warn("handleStartGameWhenMainSceneReady",e);t.processStartGame()}Zq.off(Yq.SCENE_LAUNCHED,t.handleStartGameWhenMainSceneReady)},this.handleSwitchScene=function(e){var n=e.sceneName,i=t.sceneManager.getCurrentScene();if((null==i?void 0:i.name)===n){t.screenManager.closeAllScreens(),t.screenManager.clearScreens();var a=null==i?void 0:i.getComponentsInChildren(hM);a&&(console.groupCollapsed(` Screens in ${n}`),a.forEach((function(e){console.info(e.name,e),t.screenManager.addScreen(e)})),console.groupEnd())}},console.groupCollapsed(" Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}var t,n;return Pe(e,[{key:"initManagers",value:function(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}},{key:"listenEvents",value:function(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}},{key:"preloadScenes",value:function(){Jq.isFirstLogin()?Hl.preloadGameScene():Hl.preloadDashboardScene()}},{key:"switchScene",value:function(){Jq.isFirstLogin()?(nu.addShowedScene($s),Hl.switchToGameScene()):(nu.addShowedScene(Js),Hl.switchToDashboardScene())}},{key:"processStartGame",value:(n=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.groupEnd(),eV.event(Xq.Analytics.Events.LOAD_COMPLETE),e.next=4,this.startGameAsync();case 4:this.startProcessContextData(),this.playerManager.requestConnectedPlayers(),eV.event(Xq.Analytics.Events.APP_READY,{success:!0}),Zq.emit(Yq.GAME_READY);case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"startGameAsync",value:(t=Ae(Se().mark((function e(){return Se().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,GameSDK.startGameAsync();case 3:eV.event(Xq.Analytics.Events.GAME_SDK_READY,{success:!0}),e.next=11;break;case 6:e.prev=6,e.t0=e.catch(0),console.warn("GameSDK.startGameAsync",e.t0),eV.event(Xq.Analytics.Events.GAME_SDK_READY,{success:!1}),e.t0 instanceof Error&&(null==tV||tV.sendException(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,6]])}))),function(){return t.apply(this,arguments)})},{key:"startProcessContextData",value:function(){Qq.processContextData().catch((function(e){console.error("startProcessContextData",e)}))}},{key:"initPlugins",value:function(){this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}}]),e}()),n._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/start-scene', 'chunks:///start-scene.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});