System.register("chunks:///start-scene.js",["cc"],(function(e,t){var i,n,a,s,o,r,l,c,h,d,u,p,m,g,y,b,f,w,S,v,E,C,T,A,R,I,P,_,L,D,O,N,M,k,x,F,B,z,U,G,H,V,q,W,K,Y,j,X,$,Q,J,Z,ee,te,ie,ne,ae,se,oe,re,le,ce,he,de,ue,pe,me,ge,ye,be,fe,we,Se;return{setters:[function(e){i=e.cclegacy,n=e.Node,a=e._decorator,s=e.Component,o=e.Color,r=e.Canvas,l=e.UITransform,c=e.instantiate,h=e.Label,d=e.RichText,u=e.Toggle,p=e.Button,m=e.director,g=e.isCCObject,y=e.Animation,b=e.CCString,f=e.CCInteger,w=e.AudioSource,S=e.resources,v=e.AudioClip,E=e.tween,C=e.CCFloat,T=e.Layout,A=e.Widget,R=e.Sprite,I=e.ccenum,P=e.find,_=e.Prefab,L=e.JsonAsset,D=e.AnimationClip,O=e.ImageAsset,N=e.SpriteFrame,M=e.Enum,k=e.easing,x=e.UIOpacity,F=e.view,B=e.screen,z=e.math,U=e.EventHandler,G=e.animation,H=e.CCBoolean,V=e.Input,q=e.Graphics,W=e.game,K=e.profiler,Y=e.sys,j=e.Vec3,X=e.ProgressBar,$=e.Font,Q=e.Vec2,J=e.Director,Z=e.Layers,ee=e.randomRangeInt,te=e.pseudoRandomRangeInt,ie=e.pseudoRandom,ne=e.randomRange,ae=e.Pool,se=e.ParticleSystem2D,oe=e.HorizontalTextAlignment,re=e.Tween,le=e.View,ce=e.ScrollView,he=e.lerp,de=e.Mask,ue=e.settings,pe=e.Settings,me=e.AssetManager,ge=e.DynamicAtlasManager,ye=e.macro,be=e.ResolutionPolicy,fe=e.UIRenderer,we=e.Texture2D,Se=e.Game}],execute:function(){function e(e,t,i,n){i&&Object.defineProperty(e,t,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(n):void 0})}function ve(e,t,i,n,a){var s={};return Object.keys(n).forEach((function(e){s[e]=n[e]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=i.slice().reverse().reduce((function(i,n){return n(e,t,i)||i}),s),a&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(a):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(e,t,s),s=null),s}var Ee,Ce,Te,Ae,Re,Ie,Pe,_e,Le;i._RF.push({},"b2bd1+njXxJxaFY3ymm06WU","debug-view-runtime-control",void 0);const{ccclass:De,property:Oe}=a;Ee=De("internal.DebugViewRuntimeControl"),Ce=Oe(n),Te=Oe(n),Ae=Oe(n),Ee((Pe=ve((Ie=class extends s{constructor(){super(...arguments),e(this,"compositeModeToggle",Pe,this),e(this,"singleModeToggle",_e,this),e(this,"EnableAllCompositeModeButton",Le,this),this._single=0,this.strSingle=["No Single Debug","Vertex Color","Vertex Normal","Vertex Tangent","World Position","Vertex Mirror","Face Side","UV0","UV1","UV Lightmap","Project Depth","Linear Depth","Fragment Normal","Fragment Tangent","Fragment Binormal","Base Color","Diffuse Color","Specular Color","Transparency","Metallic","Roughness","Specular Intensity","IOR","Direct Diffuse","Direct Specular","Direct All","Env Diffuse","Env Specular","Env All","Emissive","Light Map","Shadow","AO","Fresnel","Direct Transmit Diffuse","Direct Transmit Specular","Env Transmit Diffuse","Env Transmit Specular","Transmit All","Direct Internal Specular","Env Internal Specular","Internal All","Fog"],this.strComposite=["Direct Diffuse","Direct Specular","Env Diffuse","Env Specular","Emissive","Light Map","Shadow","AO","Normal Map","Fog","Tone Mapping","Gamma Correction","Fresnel","Transmit Diffuse","Transmit Specular","Internal Specular","TT"],this.strMisc=["CSM Layer Coloration","Lighting With Albedo"],this.compositeModeToggleList=[],this.singleModeToggleList=[],this.miscModeToggleList=[],this.textComponentList=[],this.labelComponentList=[],this.textContentList=[],this._currentColorIndex=0,this.strColor=["<color=#ffffff>","<color=#000000>","<color=#ff0000>","<color=#00ff00>","<color=#0000ff>"],this.color=[o.WHITE,o.BLACK,o.RED,o.GREEN,o.BLUE]}start(){if(!this.node.parent.getComponent(r))return void console.error("debug-view-runtime-control should be child of Canvas");const e=this.node.parent.getComponent(l),t=.5*e.width,i=.5*e.height;let n=.1*t-t,a=i-.1*i;const s=this.node.getChildByName("MiscMode"),m=c(s);m.parent=this.node,m.name="Buttons";const g=c(s);g.parent=this.node,g.name="Titles";for(let e=0;e<2;e++){const t=c(this.EnableAllCompositeModeButton.getChildByName("Label"));t.setPosition(n+(e>0?450:150),a,0),t.setScale(.75,.75,.75),t.parent=g;const i=t.getComponent(h);i.string=e?"----------Composite Mode----------":"----------Single Mode----------",i.color=o.WHITE,i.overflow=0,this.labelComponentList[this.labelComponentList.length]=i}a-=20;let y=0;for(let e=0;e<this.strSingle.length;e++,y++){e===this.strSingle.length>>1&&(n+=200,y=0);const t=e?c(this.singleModeToggle):this.singleModeToggle;t.setPosition(n,a-20*y,0),t.setScale(.5,.5,.5),t.parent=this.singleModeToggle.parent;const i=t.getComponentInChildren(d);i.string=this.strSingle[e],this.textComponentList[this.textComponentList.length]=i,this.textContentList[this.textContentList.length]=i.string,t.on(u.EventType.TOGGLE,this.toggleSingleMode,this),this.singleModeToggleList[e]=t}n+=200,this.EnableAllCompositeModeButton.setPosition(n+15,a,0),this.EnableAllCompositeModeButton.setScale(.5,.5,.5),this.EnableAllCompositeModeButton.on(p.EventType.CLICK,this.enableAllCompositeMode,this),this.EnableAllCompositeModeButton.parent=m;let b=this.EnableAllCompositeModeButton.getComponentInChildren(h);this.labelComponentList[this.labelComponentList.length]=b;const f=c(this.EnableAllCompositeModeButton);f.setPosition(n+90,a,0),f.setScale(.5,.5,.5),f.on(p.EventType.CLICK,this.changeTextColor,this),f.parent=m,b=f.getComponentInChildren(h),b.string="TextColor",this.labelComponentList[this.labelComponentList.length]=b;const w=c(this.EnableAllCompositeModeButton);w.setPosition(n+200,a,0),w.setScale(.5,.5,.5),w.on(p.EventType.CLICK,this.hideUI,this),w.parent=this.node.parent,b=w.getComponentInChildren(h),b.string="Hide UI",this.labelComponentList[this.labelComponentList.length]=b,this.hideButtonLabel=b,a-=40;for(let e=0;e<this.strMisc.length;e++){const t=c(this.compositeModeToggle);t.setPosition(n,a-20*e,0),t.setScale(.5,.5,.5),t.parent=s;const i=t.getComponentInChildren(d);i.string=this.strMisc[e],this.textComponentList[this.textComponentList.length]=i,this.textContentList[this.textContentList.length]=i.string;t.getComponent(u).isChecked=!!e,t.on(u.EventType.TOGGLE,e?this.toggleLightingWithAlbedo:this.toggleCSMColoration,this),this.miscModeToggleList[e]=t}a-=150;for(let e=0;e<this.strComposite.length;e++){const t=e?c(this.compositeModeToggle):this.compositeModeToggle;t.setPosition(n,a-20*e,0),t.setScale(.5,.5,.5),t.parent=this.compositeModeToggle.parent;const i=t.getComponentInChildren(d);i.string=this.strComposite[e],this.textComponentList[this.textComponentList.length]=i,this.textContentList[this.textContentList.length]=i.string,t.on(u.EventType.TOGGLE,this.toggleCompositeMode,this),this.compositeModeToggleList[e]=t}}isTextMatched(e,t){let i=new String(e);const n=i.search(">");return-1===n?e===t:(i=i.substr(n+1),i=i.substr(0,i.search("<")),i===t)}toggleSingleMode(e){const t=m.root.debugView,i=e.getComponentInChildren(d);for(let e=0;e<this.strSingle.length;e++)this.isTextMatched(i.string,this.strSingle[e])&&(t.singleMode=e)}toggleCompositeMode(e){const t=m.root.debugView,i=e.getComponentInChildren(d);for(let n=0;n<this.strComposite.length;n++)this.isTextMatched(i.string,this.strComposite[n])&&t.enableCompositeMode(n,e.isChecked)}toggleLightingWithAlbedo(e){m.root.debugView.lightingWithAlbedo=e.isChecked}toggleCSMColoration(e){m.root.debugView.csmLayerColoration=e.isChecked}enableAllCompositeMode(e){const t=m.root.debugView;t.enableAllCompositeMode(!0);for(let e=0;e<this.compositeModeToggleList.length;e++){this.compositeModeToggleList[e].getComponent(u).isChecked=!0}let i=this.miscModeToggleList[0].getComponent(u);i.isChecked=!1,t.csmLayerColoration=!1,i=this.miscModeToggleList[1].getComponent(u),i.isChecked=!0,t.lightingWithAlbedo=!0}hideUI(e){const t=this.node.getChildByName("Titles"),i=!t.active;this.singleModeToggleList[0].parent.active=i,this.miscModeToggleList[0].parent.active=i,this.compositeModeToggleList[0].parent.active=i,this.EnableAllCompositeModeButton.parent.active=i,t.active=i,this.hideButtonLabel.string=i?"Hide UI":"Show UI"}changeTextColor(e){this._currentColorIndex++,this._currentColorIndex>=this.strColor.length&&(this._currentColorIndex=0);for(let e=0;e<this.textComponentList.length;e++)this.textComponentList[e].string=this.strColor[this._currentColorIndex]+this.textContentList[e]+"</color>";for(let e=0;e<this.labelComponentList.length;e++)this.labelComponentList[e].color=this.color[this._currentColorIndex]}onLoad(){}update(e){}}).prototype,"compositeModeToggle",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_e=ve(Ie.prototype,"singleModeToggle",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Le=ve(Ie.prototype,"EnableAllCompositeModeButton",[Ae],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Re=Ie));i._RF.pop(),i._RF.push({},"95972yG/ulEg4gycbc+QB5Y","ComponentUtils",void 0);const{Utils:{Array:Ne,Object:Me,Valid:ke}}=GameCore,xe=["cc.Mask","cc.Label","cc.Canvas","cc.Camera","cc.Layout","cc.Button","cc.Sprite","cc.Widget","cc.Renderer","cc.Animation","cc.UIOpacity"];class Fe{constructor(){this.validComponentCalled={}}static get inst(){return this._instance||(this._instance=new Fe),this._instance}static lazyValidateProperties(e){if(!(!(arguments.length>1&&void 0!==arguments[1])||arguments[1]))return;const{constructor:t}=e,{name:i}=t;if(!this.inst.validComponentCalled[i])try{this.inst.validateRequiredComponents(e),this.inst.validateRequiredProperties(e),this.inst.validateCustomProperties(e)}catch(t){e.enabled=!1,console.error(t)}finally{this.inst.validComponentCalled[i]=!0}}validateRequiredComponents(e){const{name:t,constructor:i}=e,n=this.getRequiredComponentNames(i);for(const i of n)if(!e.getComponent(i))throw new Error(`${t}: Missing required ${i} component`)}validateRequiredProperties(e){const{name:t,constructor:i}=e,n=this.getRequiredPropNames(i);for(const i of n){if(!Me.hasOwn(e,i))throw new Error(`${t}: Missing required ${i} property`);const n=this.getProperty(i,e);if(!g(n))throw new Error(`${t}: ${i} property is not a cc object`)}}validateCustomProperties(e){const{name:t}=e,i=this.getCustomPropNames(e);for(const n of i){if(!Me.hasOwn(e,n))throw new Error(`${t}: Missing required ${n} property`);const i=this.getProperty(n,e);if(!g(i))throw new Error(`${t}: ${n} property is not a cc object`)}}getProperty(e,t){if(!Me.hasOwn(t,e))return;const{value:i}=Object.getOwnPropertyDescriptor(t,e)??{};return i}getProps(e){if(!Me.hasOwn(e,"__props__"))return[];const{__props__:t}=e;return Array.isArray(t)?t:[]}getRequiredPropNames(e){return this.getProps(e).filter((t=>"node"!==t&&(!!Me.hasOwn(e,t)&&(!!g(e[t])&&t.indexOf("_")<0))))}getBaseComponentName(e){for(const t of xe){if(t.indexOf(e)>=0)return t}return e}getRequiredComponentNames(e){if(!Me.hasOwn(e,"_requireComponent"))return[];const{_requireComponent:t}=e;return Array.isArray(t)?t.map((e=>this.getBaseComponentName(e))):[]}getCustomPropNames(e){const t=Object.keys(e),i=this.getProps(e.constructor);return Ne.difference(t,i).filter((e=>e.indexOf("_")<0)).filter((t=>{if(!Me.hasOwn(e,t))return!1;const i=this.getProperty(t,e);return!(!ke.isObject(i)||!g(i))}))}}try{new Fe}catch(e){console.error("ComponentUtils",e)}var Be,ze,Ue,Ge,He,Ve,qe,We,Ke;i._RF.pop(),i._RF.push({},"60ac3vor0dMT5bXi8D3VSJN","BubbleAnimation",void 0);const{ccclass:Ye,property:je}=a,{Array:Xe}=GameCore.Utils;Be=Ye("BubbleAnimation"),ze=je(y),Ue=je(b),Ge=je(f),Be((qe=ve((Ve=class extends s{constructor(){super(...arguments),e(this,"animation",qe,this),e(this,"clipName",We,this),e(this,"repeat",Ke,this),this.currentRepeat=-1}__preload(){this.animation=this.getComponent(y),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}play(){if(!this.animation)return;Xe.search(this.animation.clips,(e=>e?.name===this.clipName))?(this.currentRepeat=-1,this.animation.play(this.clipName)):console.warn(`BubbleAnimation: Animation component must have ${this.clipName} clip`)}onBubbleAnimationLoop(){this.animation&&-1!==this.repeat&&(this.currentRepeat++,this.currentRepeat>this.repeat&&this.animation.stop())}}).prototype,"animation",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),We=ve(Ve.prototype,"clipName",[Ue],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Bubble"}}),Ke=ve(Ve.prototype,"repeat",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),He=Ve));i._RF.pop(),i._RF.push({},"cc0a5OvhdRCMZRZuRscaz+7","AudioPlayer",void 0);const{Plugins:{Audio:{BaseAudioPlayer:$e}}}=GameCore;class Qe extends $e{constructor(e,t){super(e),this.audioSource=t}play(e){if(e){const{volume:t=1,loop:i=!1}=e;this.audioSource.volume=t,this.audioSource.loop=i}this.audioSource.play()}pause(){this.audioSource.pause()}resume(){this.audioSource.state===w.AudioState.PAUSED&&this.audioSource.play()}stop(){this.audioSource.stop()}setVolume(e){this.audioSource.volume=e}getAudioSource(){return this.audioSource}}i._RF.pop(),i._RF.push({},"8b5ecHv/+BJiorK1kiVbTcf","AudioChannel",void 0);const{Plugins:{Audio:{BaseChannelManager:Je}},Utils:{Array:Ze}}=GameCore;class et extends Je{constructor(e,t){super(t),this.allowMultipleTracking={},this.handleLoadedAudio=(e,t)=>{const i=this.node.addComponent(w);return i.clip=t,i.playOnAwake=!1,new Qe(e,i)},this.node=e}playing(e){const t=this.getAudioClip(e)?.audioPlayer;return!!t&&t.getAudioSource().state===w.AudioState.PLAYING}async onLoadAudio(e,t){return new Promise(((t,i)=>{S.load(e,v,((n,a)=>{try{if(n)throw new Error(n.message);if(!this.node.isValid)return;const i=this.handleLoadedAudio(e,a);t(i)}catch(n){n instanceof Error?i(n):i(new Error("Audio load: Unknown error"))}}))}))}playWithRealConfig(e,t){if(this.isCanPlay(t)){if(t){const{volume:i=1,allowMultiple:n=!1}=t;if(t.volume=this.getVolume()*i,n){return void this.requestDuplicateAudioPlayer(e.getKey(),e.getAudioSource().clip,t).play(t)}}e.play(t)}}isCanPlay(e){if(e){const{checkList:t=[]}=e;if(t.some((e=>{const t=this.getAudioClip(e);if(t){return t.audioPlayer.getAudioSource().state===w.AudioState.PLAYING}return!1})))return!1}return!0}requestDuplicateAudioPlayer(e,t,i){const n=this.getDuplicateAudioFromPool(e);if(n){if(i){const{key:e}=n,{volume:t=1}=i;this.setAudioClip(e,{volume:t})}return n.audioPlayer}const a=`${e}_${this.allowMultipleTracking[e].currentPostFix}`,s=this.handleLoadedAudio(a,t);return this.allowMultipleTracking[e].list.push({audioPlayer:s,key:a}),this.allowMultipleTracking[e].currentPostFix+=1,this.setAudioClip(a,{audioPlayer:s,volume:1}),s}getDuplicateAudioFromPool(e){if(this.allowMultipleTracking[e]){const{list:t}=this.allowMultipleTracking[e],i=Ze.search(t,(e=>e.audioPlayer.getAudioSource().state!==w.AudioState.PLAYING));if(i)return i}else this.allowMultipleTracking[e]={currentPostFix:1,list:[]};return null}}i._RF.pop();var tt,it,nt,at,st;i._RF.push({},"1a025mmN7BL7r5cF6gWR4b/","Music",void 0);const{ccclass:ot,property:rt}=a,{audio:lt,player:ct}=globalThis.game;let ht=(tt=ot("Music"),it=rt(b),tt((st=ve((at=class extends s{constructor(){super(...arguments),e(this,"channelId",st,this),this.channel=null}__preload(){this.makePersistent(),this.channel=new et(this.node,this.channelId),lt.addChannel(this.channel)}makePersistent(){m.addPersistRootNode(this.node)}playing(e){return this.channel?.playing(e)??!1}play(e,t){this.isMusicEnable()&&(t?.loop||(t={...t,loop:!0}),lt.play(e,t,this.channelId))}isMusicEnable(){return!!ct.getPlayerSetting("music")}setVolume(e){lt.setVolume(e,this.channelId)}pause(e){lt.pause(e,this.channelId)}resume(e){this.isMusicEnable()&&lt.resume(e,this.channelId)}stop(e){lt.stop(e,this.channelId)}mute(e){e?lt.mute(this.channelId):lt.unmute(this.channelId)}}).prototype,"channelId",[it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"global_music"}}),nt=at))||nt);var dt,ut,pt,mt,gt;i._RF.pop(),i._RF.push({},"1299a7X1XNNEKxSKMV6E5jQ","Sound",void 0);const{ccclass:yt,property:bt}=a,{audio:ft,player:wt}=globalThis.game;let St=(dt=yt("Sound"),ut=bt(b),dt((gt=ve((mt=class extends s{constructor(){super(...arguments),e(this,"channelId",gt,this),this.channel=null}__preload(){this.channel=new et(this.node,this.channelId),ft.addChannel(this.channel)}onLoad(){""===this.channelId&&(this.channelId=this.node.uuid)}makePersistent(){m.addPersistRootNode(this.node)}removePersistent(){m.removePersistRootNode(this.node)}play(e,t){this.isSoundEnable()&&ft.play(e,t,this.channelId)}isSoundEnable(){return!!wt.getPlayerSetting("sound")}setVolume(e){ft.setVolume(e,this.channelId)}pause(e){ft.pause(e,this.channelId)}resume(e){this.isSoundEnable()&&ft.resume(e,this.channelId)}stop(e){ft.stop(e,this.channelId)}stopAll(){ft.stopAll(this.channelId)}mute(e){e?ft.mute(this.channelId):ft.unmute(this.channelId)}}).prototype,"channelId",[ut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),pt=mt))||pt);i._RF.pop(),i._RF.push({},"99b8eEF6WlE8pzPfD+whiJu","AnimUtils",void 0);class vt{static get inst(){return this._instance||(this._instance=new vt),this._instance}static elasticOut(e,t,i){if(void 0===t&&(t=.1),void 0===i&&(i=.1),0===e)return 0;if(1===e)return 1;{let n=i/4;return t<1?t=1:n=i*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*e)*Math.sin((e-n)*(2*Math.PI)/i)+1}}static easeOutExpo(e){return 1===e?1:1-Math.pow(2,-10*e)}static easeInExpo(e){return 0===e?0:Math.pow(2,10*e-10)}static runTweenAsync(e,t){return new Promise((i=>{const n=e.call((()=>{i({tween:e})})).start();t&&(t.aborted?(n.stop(),i({tween:e})):t.addAbortListener((()=>{n.stop(),i({tween:e})})))}))}static waitTweenAsync(e,t){return new Promise((i=>{const n=E({});n.delay(e),n.call((()=>{i()})),n.start(),t&&(t.aborted?(n.stop(),i()):t.addAbortListener((()=>{n.stop(),i()})))}))}static runAnimationAsync(e,t){return new Promise((i=>{e.play(t),e.once(y.EventType.FINISHED,(()=>{i()}))}))}}try{new vt}catch(e){console.error("AnimUtils",e)}var Et,Ct,Tt,At,Rt,It,Pt,_t,Lt,Dt,Ot,Nt,Mt,kt,xt,Ft,Bt,zt,Ut,Gt;i._RF.pop(),i._RF.push({},"84a2dB5IaRJ8JB+n9yXfBc7","AutoLayout",void 0);const{ccclass:Ht,property:Vt}=a;let qt=(Et=Ht("AutoLayoutWrappee"),Ct=Vt({type:l}),Tt=Vt({type:l}),Et((It=ve((Rt=class{constructor(){e(this,"wrapeeContainer",It,this),e(this,"wrapee",Pt,this)}}).prototype,"wrapeeContainer",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pt=ve(Rt.prototype,"wrapee",[Tt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),At=Rt))||At),Wt=(_t=Ht("AutoLayout"),Lt=Vt({displayName:"Use Auto Layout"}),Dt=Vt({type:[qt],displayName:"Children",visible(){return this.useAutoLayout}}),Ot=Vt({visible:!1,serializable:!0}),Nt=Vt({type:f,displayName:"Selected Index",visible(){return this.useAutoLayout}}),Mt=Vt({type:C,displayName:"Deselected Icon Width",group:"Edge Icons",visible(){return this.useAutoLayout}}),kt=Vt({visible:!1,serializable:!0}),_t((Bt=ve((Ft=class extends T{constructor(){super(...arguments),e(this,"useAutoLayout",Bt,this),e(this,"children",zt,this),this.mappedChildren=[],e(this,"selected",Ut,this),e(this,"deselectedIconW",Gt,this),this.tweens=[]}get selectedIndex(){return this.selected}set selectedIndex(e){this.selected=e,this.updateLayout(!0)}get deselectedIconWidth(){return this.deselectedIconW}set deselectedIconWidth(e){this.deselectedIconW=e,this.updateLayout(!0)}__preload(){this.mappedChildren=this.children.map((e=>{const t=e.wrapeeContainer.getComponent(A);if(!t)throw new Error("AutoLayout: Widget component not found");return{...e,wrapeeContainerWidget:t}}))}updateLayout(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._layoutDirty||e)&&(this.updateChildrenAnchors(),this.mappedChildren.forEach((e=>e.wrapeeContainerWidget.updateAlignment()))),super.updateLayout(e)}getSelectedWorldX(){const e=this.mappedChildren[this.selectedIndex].wrapeeContainer;if(0===this.selectedIndex||this.selectedIndex===this.children.length-1){const{xMin:t}=e.getBoundingBoxToWorld();return t+this.getAnchorX(this.selectedIndex)*e.width}return e.getBoundingBoxToWorld().center.x}getAnchorX(e){if(e<this.selectedIndex)return 0;if(e>this.selectedIndex)return 1;if(0===e){const t=this.mappedChildren[e].wrapeeContainer.width,i=this.deselectedIconWidth/2,n=this.paddingLeft;return((n+t+(t-i+this.spacingX))/2-n)/t}if(e===this.children.length-1){const t=this.mappedChildren[e].wrapeeContainer.width,i=t-this.deselectedIconWidth/2+this.spacingX;return((i+t+this.paddingRight)/2-i)/t}return.5}async updateChildrenAnchors(){this.tweens.forEach((e=>e.stop())),this.tweens=[],await Promise.all([this.children.flatMap(((e,t)=>this.getChildrenAnchorsTweens(e,this.getAnchorX(t)))).map((e=>vt.runTweenAsync(e)))])}updateChildrenAnchorsEditor(){this.children.forEach(((e,t)=>{const i=this.getAnchorX(t);e.wrapee.setAnchorPoint(i,e.wrapee.anchorY),e.wrapeeContainer.setAnchorPoint(i,e.wrapeeContainer.anchorY)}))}getChildrenAnchorsTweens(e,t){return[E(e.wrapee).to(.3,{anchorX:t},{easing:"sineInOut"}).call((()=>{e.wrapee.setAnchorPoint(t,e.wrapee.anchorY)})),E(e.wrapeeContainer).to(.3,{anchorX:t},{easing:"sineInOut"}).call((()=>{e.wrapeeContainer.setAnchorPoint(t,e.wrapeeContainer.anchorY)}))]}}).prototype,"useAutoLayout",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),zt=ve(Ft.prototype,"children",[Dt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ut=ve(Ft.prototype,"selected",[Ot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ve(Ft.prototype,"selectedIndex",[Nt],Object.getOwnPropertyDescriptor(Ft.prototype,"selectedIndex"),Ft.prototype),ve(Ft.prototype,"deselectedIconWidth",[Mt],Object.getOwnPropertyDescriptor(Ft.prototype,"deselectedIconWidth"),Ft.prototype),Gt=ve(Ft.prototype,"deselectedIconW",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xt=Ft))||xt);var Kt,Yt,jt,Xt,$t;i._RF.pop(),i._RF.push({},"ca427NpeqpC3bUoGTd9I/BM","Background",void 0);const{ccclass:Qt,property:Jt}=a;Kt=Qt("Background"),Yt=Jt({type:R}),Kt(($t=ve((Xt=class extends s{constructor(){super(...arguments),e(this,"sprite",$t,this)}__preload(){this.validateRequiredComponents(),this.listenGameEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenGameEvents(){}}).prototype,"sprite",[Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jt=Xt));i._RF.pop(),i._RF.push({},"bf320amyc1I86bS3oK0M9NR","DashboardEvents",void 0);const Zt="STARS_UPDATED",ei="PLAY_BUTTON_PRESS",ti="REQUEST_NAVIGATION",ii="REQUEST_NAVIGATION_ANIMATION",ni="DASHBOARD_EVENTS_BUTTON_PRESS";i._RF.pop(),i._RF.push({},"68b8bf0Va5JT7NVPECDNC5l","DashboardScreens",void 0);var ai=function(e){return e[e.store=0]="store",e[e.collections=1]="collections",e[e.home=2]="home",e[e.leaderboard=3]="leaderboard",e[e.tournaments=4]="tournaments",e}(ai||{});I(ai),i._RF.pop(),i._RF.push({},"a0756pde9lOeoJ4TckTOcMV","AnimAbortSignal",void 0);class si{constructor(){this.isAborted=!1,this.abortReason="",this.eventTarget=new EventTarget}get aborted(){return this.isAborted}get reason(){return this.abortReason}addAbortListener(e){this.eventTarget.addEventListener("abort",e)}removeAbortListener(e){this.eventTarget.removeEventListener("abort",e)}abort(e){this.isAborted||(this.isAborted=!0,this.abortReason=e,this.eventTarget.dispatchEvent(new Event("abort")))}async untilAborted(){if(!this.isAborted)return new Promise((e=>{this.addAbortListener((()=>e()))}))}static hasBeenAborted(e){return null==e||e.aborted}}i._RF.pop(),i._RF.push({},"a6e4bjV/RVH17qBEx1mZaFg","ResourcePaths",void 0);var oi=function(e){return e.BOMB_RESCUE_PREFAB="game-objects/bomb/BombRescue",e.BOMB_EXPLODE_PREFAB="game-objects/bomb/BombExplode",e.BOMB_DEFUSE_PREFAB="game-objects/bomb/DefuseExplode",e.COLLECTIONS_CONTENT_PREFAB="game-objects/dashboard-scene/CollectionsContent",e.CLOUD_IDLE_ANIM="animations/CloudIdle",e.TORNADO_IDLE_ANIM="animations/TornadoIdle",e.TILE_BREAK_ANIM="animations/TileBreak",e.TILE_CLEAR_ANIM="animations/TileClear",e.TILE_SHAKE_ANIM="animations/TileShake",e.TILE_SKIN_FOLDER="loadable/tiles",e.TILE_SKIN_PREVIEW_FOLDER="loadable/tiles-preview",e.ITEM_POPUP_FOLDER="loadable/item-popup",e.SUMMER_BG="images/bg/summer",e.AUTUMN_BG="images/bg/autumn",e.WINTER_BG="images/bg/winter",e.SUMMER_BG_PREVIEW="images/preview/summer",e.AUTUMN_BG_PREVIEW="images/preview/autumn",e.WINTER_BG_PREVIEW="images/preview/winter",e.COLLECTIONS_PAGE="pages/CollectionsContent",e.LEADERBOARD_PAGE="pages/LeaderboardContent",e.TOURNAMENTS_PAGE="pages/TournamentsContent",e.LEVEL_DATA_FOLDER="levels-json",e}(oi||{});i._RF.pop(),i._RF.push({},"2a657+TsltMe4rrDmyWGrLy","ThemeResourcesPath",void 0);const ri={summer:oi.SUMMER_BG,autumn:oi.AUTUMN_BG,winter:oi.WINTER_BG},li={summer:oi.SUMMER_BG_PREVIEW,autumn:oi.AUTUMN_BG_PREVIEW,winter:oi.WINTER_BG_PREVIEW};i._RF.pop(),i._RF.push({},"669a1OtNF9EDrMRLWTjxk4B","GeneralUtils",void 0);class ci{static get inst(){return this._instance||(this._instance=new ci),this._instance}static setBlockInput(e){const t=P("Canvas/InputBlocker");t?t.active=e:console.warn("InputBlocker not found")}static getBlockInput(){const e=P("Canvas/InputBlocker");return e?e.active:(console.warn("InputBlocker not found"),!1)}static loadPrefabAsync(e){const t=S.getInfoWithPath(e,_);if(t&&null!==S.get(t.path,_)){const e=S.get(t.path,_);if(null!==e)return Promise.resolve(e)}return new Promise((t=>{S.load(e,_,((e,i)=>{t(e?null:i)}))}))}static async loadJsonAsync(e){return new Promise((t=>{const i=S.getInfoWithPath(e,L);if(i&&null!==S.get(i.path,L)){const e=S.get(i.path,L);if(null!==e)return void t(e.json)}S.load(e,L,((e,i)=>{e?t(null):i&&i.json?t(i.json):t(null)}))}))}static async loadAnimClipAsync(e){const t=S.getInfoWithPath(e,D);if(t&&null!==S.get(t.path,D)){const e=S.get(t.path,D);if(null!==e)return Promise.resolve(e)}return new Promise((t=>{S.load(e,D,((e,i)=>{t(e?null:i)}))}))}static async loadImageSpriteFrameAsync(e){const t=S.getInfoWithPath(e,O);if(t&&null!==S.get(t.path,O)){const e=S.get(t.path,O);if(null!==e)return Promise.resolve(N.createWithImage(e))}return new Promise((t=>{S.load(e,O,((e,i)=>{t(e?null:N.createWithImage(i))}))}))}static async loadSpriteFrameAsync(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const i=S.getInfoWithPath(e,N);if(i&&null!==S.get(i.path,N)){const e=S.get(i.path,N);if(null!==e)return e.packable=t,Promise.resolve(e)}return new Promise((i=>{S.load(e,N,((e,n)=>{!e&&n?(n.packable=t,i(n)):i(null)}))}))}static async loadSpriteFramesDirAsync(e){const t=S.getDirWithPath(e,N);if(t.length>0){const i=[];for(const n of t){const t=S.get(n.path,N);if(!t)return this.loadSpriteFramesFromDirAsync(e);i.push(t)}return i}return this.loadSpriteFramesFromDirAsync(e)}static async loadSpriteFramesFromDirAsync(e){return new Promise((t=>{S.loadDir(e,N,((e,i)=>{t(e?[]:i)}))}))}static async lazyLoadDashboardSceneResourcesAsync(){return ci.loadPrefabAsync(oi.COLLECTIONS_CONTENT_PREFAB)}static async loadThemeAsync(e){return this.loadSpriteFrameAsync(`${ri[e]}/spriteFrame`)}static async loadThemePreviewAsync(e){return this.loadSpriteFrameAsync(`${li[e]}/spriteFrame`)}static async loadSkinPreviewAsync(e){const t=[];for(let i=1;i<=4;i++){const n=`${oi.TILE_SKIN_PREVIEW_FOLDER}/${e.replace(/-/g,"_")}_${i}/spriteFrame`;t.push(this.loadSpriteFrameAsync(n))}return Promise.all(t)}}try{new ci}catch(e){console.error("GeneralUtils",e)}var hi,di,ui,pi,mi,gi,yi,bi,fi,wi,Si,vi,Ei,Ci,Ti,Ai,Ri,Ii,Pi,_i,Li;i._RF.pop(),i._RF.push({},"ab9cd/wERRKYqhDoYtJ1L3w","MultiBackground",void 0);const{ccclass:Di,property:Oi}=a,{monitorError:Ni}=globalThis.game,{Utils:{Number:Mi}}=GameCore;let ki=(hi=Di("MultiBackground"),di=Oi({type:R}),ui=Oi({type:R}),pi=Oi({type:l}),mi=Oi({type:l}),gi=Oi({type:l}),yi=Oi(f),bi=Oi(A),fi=Oi({type:M(ai)}),wi=Oi({type:M(ai)}),hi((Ei=ve((vi=class extends s{constructor(){super(...arguments),e(this,"background1",Ei,this),e(this,"background2",Ci,this),e(this,"screenUiTransform",Ti,this),e(this,"background1Uitransform",Ai,this),e(this,"background2UiTransform",Ri,this),e(this,"backgroundNudgeAmount",Ii,this),e(this,"nudgeableWidget",Pi,this),e(this,"pageOrder",_i,this),e(this,"homePage",Li,this),this.currentThemeId="",this.tryNudgeBackground=e=>{let{to:t}=e;const i=this.getDirection(this.homePage,t),n=Mi.sign(i),a=Math.abs(i),s=this.backgroundNudgeAmount*a,o=Math.min(this.background1Uitransform.width,this.background2UiTransform.width),r=Math.max(0,(o-this.screenUiTransform.width)/2),l=Math.min(r,s)*n;E(this.nudgeableWidget).to(.5,{horizontalCenter:l},{easing:k.cubicInOut}).start()}}onLoad(){this.currentBackground=this.background1,this.nextBackground=this.background2,Fe.lazyValidateProperties(this),this.listenToNavigationEvents()}onDestroy(){this.tweenSignal?.abort(),this.unlistenToNavigationEvents()}listenToNavigationEvents(){this.node.scene.on(ii,this.tryNudgeBackground)}unlistenToNavigationEvents(){this.node.scene.off(ii,this.tryNudgeBackground)}getDirection(e,t){const i=this.pageOrder.indexOf(e),n=this.pageOrder.indexOf(t);return-1===i||-1===n?(Ni?.sendException(new Error("MultiBackground.getDirection: fromIndex or toIndex is -1")),0):i-n}async setCurrentTheme(e){const t=await ci.loadThemeAsync(e);t?(t.packable=!1,this.background1.spriteFrame=t,this.background2.spriteFrame=t,this.currentThemeId=e):Ni?.sendException(new Error(`MultiBackground.setCurrentTheme: Failed to load theme ${e}'s sprite.`))}async animateToNextTheme(e){if(this.currentThemeId===e)return Promise.resolve();const t=await ci.loadThemeAsync(e);if(!t)return void Ni?.sendException(new Error(`MultiBackground.animateToNextTheme: Failed to load theme ${e}'s sprite.`));t.packable=!1,this.currentThemeId=e,this.nextBackground.node.active=!0,this.nextBackground.spriteFrame=t,this.nextBackground.node.setSiblingIndex(1);const i=this.nextBackground.getComponent(x);if(!i)throw new Error(`${this.nextBackground.node.name} UIOpacity is required`);if(i.opacity=0,this.tweenSignal?.abort(),this.tweenSignal=new si,await vt.runTweenAsync(E(i).to(1,{opacity:255}),this.tweenSignal),this.tweenSignal.aborted)return;this.currentBackground.node.active=!1;const n=this.currentBackground;this.currentBackground=this.nextBackground,this.nextBackground=n}}).prototype,"background1",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ci=ve(vi.prototype,"background2",[ui],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ti=ve(vi.prototype,"screenUiTransform",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ai=ve(vi.prototype,"background1Uitransform",[mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ri=ve(vi.prototype,"background2UiTransform",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ii=ve(vi.prototype,"backgroundNudgeAmount",[yi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Pi=ve(vi.prototype,"nudgeableWidget",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_i=ve(vi.prototype,"pageOrder",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Li=ve(vi.prototype,"homePage",[wi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ai.home}}),Si=vi))||Si);i._RF.pop(),i._RF.push({},"d159egaUVVLHKLg1UL865ub","SoundKeys",void 0);const{Utils:{Object:xi}}=GameCore,Fi={BUTTON_CLICK:"sounds/use_item_click",BOMB_DEFUSE:"sounds/bomb_defuse",BOMB_EXPLODE_1:"sounds/bomb_explode_1",BOMB_EXPLODE_2:"sounds/bomb_explode_2",CLICKS:"sounds/clicks",CLOSE_POPUP_CLICK:"sounds/close_popup_click",COLLECT_STARS:"sounds/collect_stars",COMBO_1:"sounds/combo_1",COMBO_2:"sounds/combo_2",COMBO_3:"sounds/combo_3",COMBO_4:"sounds/combo_4",COMBO_5:"sounds/combo_5",DAILY_REWARD:"sounds/daily_reward",EXTRA_TIME_SPAWN:"sounds/extra_time_spawn",GIFT_CHARGE:"sounds/gift_charge",GIFT_EXPLODE:"sounds/gift_explode",GIFT_REVEAL:"sounds/gift_reveal",HINT_ITEM:"sounds/hint_item",INVALID_MATCH:"sounds/invalid_match",LEVEL_COMPLETE:"sounds/level_complete",LEVEL_FAIL:"sounds/level_fail",LEVEL_START:"sounds/level_start",PROGRESS_STAR:"sounds/progress_star",RESCUE_TIMER:"sounds/rescue_timer",ROCKET_FLY:"sounds/rocket_fly",SHUFFLE_ITEM:"sounds/shuffle_item",THREE_STARS:"sounds/three_stars",TICKING_BOMB_BEFORE_EXPLODE:"sounds/ticking_bomb_before_explode",TILE_SELECT:"sounds/tile_select",USE_ITEM_CLICK:"sounds/use_item_click",BG_MUSIC:"musics/bg_music",PATCH_SHIFT:"sounds/patch_shift",THUNDERBOLT:"sounds/thunderbolt",WIND:"sounds/wind",COLLECT_COINS:"sounds/collect_coins",COLLECT_STOCK_COINS:"sounds/collect_stock_coins",LEVEL_FAIL_TIMEOUT:"sounds/level_fail_timeout",STAR_CHEST_DRUM_ROLL:"sounds/star_chest_drum_roll",STAR_CHEST_OPEN:"sounds/star_chest_open",LEADERBOARD_TRIUMPH:"sounds/leaderboard_triumph",ITEM_REWARD:"sounds/item_reward"},Bi=xi.vals(Fi),zi=Bi.reduce(((e,t,i)=>({...e,[t]:i})),{});I(zi);const Ui=Bi;i._RF.pop(),i._RF.push({},"0eeb868JeVE67iFwhbkRCmE","ScreenKeys",void 0);var Gi=function(e){return e[e.RESCUES_SCREEN=0]="RESCUES_SCREEN",e[e.LOADING_SCREEN=1]="LOADING_SCREEN",e[e.GET_ITEM_SCREEN=2]="GET_ITEM_SCREEN",e[e.GET_COIN_SCREEN=3]="GET_COIN_SCREEN",e[e.SETTINGS_SCREEN=4]="SETTINGS_SCREEN",e[e.START_LEVEL_SCREEN=5]="START_LEVEL_SCREEN",e[e.NOTIFICATION_SCREEN=6]="NOTIFICATION_SCREEN",e[e.LEVEL_COMPLETE_SCREEN=7]="LEVEL_COMPLETE_SCREEN",e[e.CONGRATULATION_SCREEN=8]="CONGRATULATION_SCREEN",e[e.QUIT_LEVEL_SCREEN=9]="QUIT_LEVEL_SCREEN",e[e.TOURNAMENT_DETAIL_SCREEN=10]="TOURNAMENT_DETAIL_SCREEN",e[e.DAILY_REWARDS_SCREEN=11]="DAILY_REWARDS_SCREEN",e[e.STAR_CHEST_SCREEN=12]="STAR_CHEST_SCREEN",e}(Gi||{});const Hi={[Gi.RESCUES_SCREEN]:"RescuesScreen",[Gi.LOADING_SCREEN]:"LoadingScreen",[Gi.GET_ITEM_SCREEN]:"GetItemScreen",[Gi.GET_COIN_SCREEN]:"GetCoinScreen",[Gi.SETTINGS_SCREEN]:"SettingsScreen",[Gi.START_LEVEL_SCREEN]:"StartLevelScreen",[Gi.NOTIFICATION_SCREEN]:"NotificationScreen",[Gi.LEVEL_COMPLETE_SCREEN]:"LevelCompleteScreen",[Gi.CONGRATULATION_SCREEN]:"CongratulationScreen",[Gi.QUIT_LEVEL_SCREEN]:"QuitLevelScreen",[Gi.TOURNAMENT_DETAIL_SCREEN]:"TournamentDetailScreen",[Gi.DAILY_REWARDS_SCREEN]:"DailyRewardsScreen",[Gi.STAR_CHEST_SCREEN]:"StarChestScreen"},Vi={[Hi[Gi.RESCUES_SCREEN]]:Gi.RESCUES_SCREEN,[Hi[Gi.LOADING_SCREEN]]:Gi.LOADING_SCREEN,[Hi[Gi.GET_ITEM_SCREEN]]:Gi.GET_ITEM_SCREEN,[Hi[Gi.GET_COIN_SCREEN]]:Gi.GET_COIN_SCREEN,[Hi[Gi.SETTINGS_SCREEN]]:Gi.SETTINGS_SCREEN,[Hi[Gi.START_LEVEL_SCREEN]]:Gi.START_LEVEL_SCREEN,[Hi[Gi.NOTIFICATION_SCREEN]]:Gi.NOTIFICATION_SCREEN,[Hi[Gi.LEVEL_COMPLETE_SCREEN]]:Gi.LEVEL_COMPLETE_SCREEN,[Hi[Gi.CONGRATULATION_SCREEN]]:Gi.CONGRATULATION_SCREEN,[Hi[Gi.QUIT_LEVEL_SCREEN]]:Gi.QUIT_LEVEL_SCREEN,[Hi[Gi.TOURNAMENT_DETAIL_SCREEN]]:Gi.TOURNAMENT_DETAIL_SCREEN,[Hi[Gi.DAILY_REWARDS_SCREEN]]:Gi.DAILY_REWARDS_SCREEN,[Hi[Gi.STAR_CHEST_SCREEN]]:Gi.STAR_CHEST_SCREEN},qi=[Gi[Gi.NOTIFICATION_SCREEN],Gi[Gi.LOADING_SCREEN]];i._RF.pop(),i._RF.push({},"09bc071ZcpI978b1NdKUaqD","AnalyticsUtils",void 0);const{analytics:Wi}=globalThis.game,{Utils:{Array:Ki}}=GameCore;class Yi{static get inst(){return this._instance||(this._instance=new Yi),this._instance}static trackCurrentPage(e,t){if(Ki.has(qi,e))return;if(!t&&!Ki.has(this.trackingPages,e))return;this.trackingPages=this.trackingPages.filter((t=>t!==e)),t&&this.trackingPages.push(e);const i=this.getCurrentPage();Wi.pageview(i)}static switchSceneTracking(){this.trackingPages=[];const e=this.getCurrentPage();Wi.pageview(e)}static getCurrentPage(){return this.trackingPages.length>0?this.trackingPages[this.trackingPages.length-1]:m.getScene()?.name??"Unknown Scene"}}Yi.trackingPages=[];try{new Yi}catch(e){console.error("AnalyticsUtils",e)}i._RF.pop(),i._RF.push({},"31871PLRYRJu7yCCX5F6lWK","AudioUtils",void 0);class ji{static get inst(){return this._instance||(this._instance=new ji),this._instance}get sound(){return P("Sound")?.getComponent(St)??null}get music(){return P("Music")?.getComponent(ht)??null}static muteAudio(e){this.muteMusic(e),this.muteSound(e)}static playSound(e,t){this.inst.sound?.play(e,t)}static pauseSound(e){this.inst.sound?.pause(e)}static resumeSound(e){this.inst.sound?.resume(e)}static stopSound(e){this.inst.sound?.stop(e)}static stopAllSounds(){this.inst.sound?.stopAll()}static muteSound(e){this.inst.sound?.mute(e)}static playMusic(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.inst.music?.playing(Fi.BG_MUSIC)||this.inst.music?.play(Fi.BG_MUSIC)}static pauseMusic(){this.inst.music?.pause(Fi.BG_MUSIC)}static muteMusic(e){this.inst.music?.mute(e)}static turnUpMusic(){this.inst.music?.setVolume(.8)}static turnDownMusic(){this.inst.music?.setVolume(.4)}static turnOffMusic(){this.inst.music?.setVolume(0)}}try{new ji}catch(e){console.error("AudioUtils",e)}i._RF.pop(),i._RF.push({},"05faedSJ2NHFqLe9b3g4RIl","CocosUtils",void 0);class Xi{static get inst(){return this._instance||(this._instance=new Xi),this._instance}static getBoundingBoxToWorld(e){if(e.parent){const t=e.parent.getWorldMatrix();return this.inst.getBoundingBoxTo(t,e)}const t=e.getComponent(l);if(!t)throw new Error("Node must have UITransform component");return t.getBoundingBox()}static worldSizeToCssSize(e){return e*this.inst.getWindowSizeVsWorldGameRatio()}static cssSizeToWorldSize(e){return e/this.inst.getWindowSizeVsWorldGameRatio()}static getScreenWidthCss(){const{body:e,documentElement:t}=document,{clientWidth:i}=e,{clientWidth:n}=t;return Math.max(n,i)||0}static getScreenHeightCss(){const{body:e,documentElement:t}=document,{clientHeight:i}=e,{clientHeight:n}=t;return Math.max(n,i)||0}getWindowSizeVsWorldGameRatio(){const e=F.getVisibleSize(),{width:t}=B.windowSize;return t/window.devicePixelRatio/e.width}getBoundingBoxTo(e,t){const i=z.mat4();z.Mat4.fromSRT(i,t.getRotation(),t.getPosition(),t.getScale());const n=t.getComponent(l);if(!n)throw new Error("Node must have UITransform component");const{anchorPoint:a,contentSize:s}=n,{width:o,height:r}=s,c=new z.Rect(-a.x*o,-a.y*r,o,r),h=z.mat4();if(z.Mat4.multiply(h,e,i),c.transformMat4(h),!t.children||0===t.children.length)return c;const d=t.children,u=t.getWorldMatrix();for(const e of d){if(!e?.active)continue;if(e.getComponent(l)){const t=this.getBoundingBoxTo(u,e);t&&z.Rect.union(c,c,t)}}return c}}try{new Xi}catch(e){console.error("CocosUtils",e)}var $i,Qi,Ji,Zi,en,tn,nn,an,sn,on,rn,ln,cn,hn,dn,un,pn,mn,gn,yn,bn,fn,wn,Sn,vn,En,Cn,Tn,An,Rn,In,Pn,_n;i._RF.pop(),i._RF.push({},"ef63ctZn6BPAout9ufUgFVq","ExtendedButton",void 0);const{ccclass:Ln,property:Dn,disallowMultiple:On,executionOrder:Nn}=a,{analytics:Mn}=globalThis.game,{Plugins:{Analytics:{Events:kn}}}=GameCore;let xn=($i=Ln("ExtendedButton"),Qi=Nn(111),Ji=Dn(U),Zi=Dn(U),en=Dn(G.AnimationController),tn=Dn({override:!0,visible:!1}),nn=Dn({override:!0,visible:!1}),an=Dn({override:!0,visible:!1}),sn=Dn({override:!0,visible:!1}),on=Dn({override:!0,visible:!1}),rn=Dn({override:!0,visible:!1}),ln=Dn({override:!0,visible:!1}),cn=Dn({override:!0,visible:!1}),hn=Dn({override:!0,visible:!1}),dn=Dn({override:!0,visible:!1}),un=Dn({override:!0,visible:!1}),pn=Dn(H),mn=Dn(H),gn=Dn(H),yn=Dn({visible(){return this.makeSound},type:zi}),bn=Dn({tooltip:"Add a delay after click to prevent spamming (not apply for cancel click)"}),fn=Dn({visible(){return this.disableSpamClick},tooltip:"Delay time in seconds"}),$i(wn=On(wn=Qi((vn=ve((Sn=class extends p{constructor(){super(...arguments),e(this,"clickStartEvents",vn,this),e(this,"clickEndEvents",En,this),e(this,"animationController",Cn,this),e(this,"useDesktopHover",Tn,this),e(this,"emitAnalyticsEvents",An,this),e(this,"makeSound",Rn,this),e(this,"soundKey",In,this),e(this,"disableSpamClick",Pn,this),e(this,"disableSpamDelay",_n,this),this.currentClickBoundingBox=null,this.hasDown=!1,this.hasUp=!1,this.hasFinishClickCycle=!1,this.onTouchStart=e=>{this.interactable&&(this.hasDown||(this.currentClickBoundingBox=Xi.getBoundingBoxToWorld(this.node),this.handleDown(e)))},this.onTouchEnd=e=>{this.interactable&&this.hasDown&&(this.hasUp||this.handleUp(e))},this.onTouchCancel=e=>{if(!this.interactable)return;if(!this.hasDown)return;if(this.hasUp)return;const t=e.getUILocation();this.currentClickBoundingBox?.contains(t)??1?(this.hasUp=!0,this.hasFinishClickCycle=!0,this.handleResetButtonState(),this.emitClickEndEvents(e)):this.handleUp(e)},this.onMouseEnter=e=>{this.useDesktopHover&&this.interactable&&(this.hasDown||(this.hasFinishClickCycle=!1,this.setAnimationState("HOVER")))},this.onMouseLeave=e=>{this.useDesktopHover&&this.interactable&&(this.hasDown||this.hasUp||this.hasFinishClickCycle||this.handleResetButtonState())},this.handleResetButtonState=()=>{this.hasDown=!1,this.hasUp=!1,this.setAnimationState("RESET")}}get transition(){return p.Transition.NONE}set transition(e){super.transition=p.Transition.NONE}get normalColor(){return super.normalColor}set normalColor(e){super.normalColor=e}get pressedColor(){return super.pressedColor}set pressedColor(e){super.pressedColor=e}get hoverColor(){return super.hoverColor}set hoverColor(e){super.hoverColor=e}get disabledColor(){return super.disabledColor}set disabledColor(e){super.disabledColor=e}get normalSprite(){return super.normalSprite}set normalSprite(e){super.normalSprite=e}get pressedSprite(){return super.pressedSprite}set pressedSprite(e){super.pressedSprite=e}get hoverSprite(){return super.hoverSprite}set hoverSprite(e){super.hoverSprite=e}get disabledSprite(){return super.disabledSprite}set disabledSprite(e){super.disabledSprite=e}get duration(){return super.duration}set duration(e){super.duration=e}get zoomScale(){return super.zoomScale}set zoomScale(e){super.zoomScale=e}__preload(){super.__preload(),Fe.lazyValidateProperties(this)}onDestroy(){super.onDestroy?.()}onEnable(){super.onEnable?.(),this.node.off(V.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(n.EventType.TOUCH_START,this.onTouchStart),this.node.on(n.EventType.TOUCH_END,this.onTouchEnd),this.node.on(n.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.on(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onDisable(){super.onDisable?.(),this.node.off(n.EventType.TOUCH_START,this.onTouchStart),this.node.off(n.EventType.TOUCH_END,this.onTouchEnd),this.node.off(n.EventType.TOUCH_CANCEL,this.onTouchCancel),this.node.off(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(n.EventType.MOUSE_LEAVE,this.onMouseLeave),this.unschedule(this.handleResetButtonState),this.handleResetButtonState()}handleDown(e){this.hasDown=!0,this.setAnimationState("DOWN"),this.makeSound&&ji.playSound(Ui[this.soundKey]),this.emitClickStartEvents(e)}emitClickStartEvents(e){this.clickStartEvents.forEach((t=>{t.emit([e,t.customEventData])}))}emitClickEndEvents(e){this.clickEndEvents.forEach((t=>{t.emit([e,t.customEventData])}))}handleUp(e){this.hasUp=!0,this.hasFinishClickCycle=!0,this.setAnimationState("RESET"),this.disableSpamClick?this.scheduleOnce(this.handleResetButtonState,this.disableSpamDelay):this.handleResetButtonState(),this.emitButtonEvents(e),this.emitClickEndEvents(e)}emitButtonEvents(e){this.interactable&&(this.emitAnalyticsEvents&&Mn.event(kn.BUTTON_CLICK,{button_name:this.node.name,screen_name:Yi.getCurrentPage()}),this.clickEvents.forEach((t=>{t.emit([e,t.customEventData])})))}setAnimationState(e){this.animationController.setValue("DOWN","DOWN"===e),this.animationController.setValue("HOVER","HOVER"===e),this.animationController.setValue("RESET","RESET"===e)}fakeClick(){this.setAnimationState("DOWN"),this.scheduleOnce((()=>{this.setAnimationState("RESET")}),0)}resetButtonState(){this.handleResetButtonState()}}).prototype,"clickStartEvents",[Ji],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),En=ve(Sn.prototype,"clickEndEvents",[Zi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cn=ve(Sn.prototype,"animationController",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(Sn.prototype,"transition",[tn],Object.getOwnPropertyDescriptor(Sn.prototype,"transition"),Sn.prototype),ve(Sn.prototype,"normalColor",[nn],Object.getOwnPropertyDescriptor(Sn.prototype,"normalColor"),Sn.prototype),ve(Sn.prototype,"pressedColor",[an],Object.getOwnPropertyDescriptor(Sn.prototype,"pressedColor"),Sn.prototype),ve(Sn.prototype,"hoverColor",[sn],Object.getOwnPropertyDescriptor(Sn.prototype,"hoverColor"),Sn.prototype),ve(Sn.prototype,"disabledColor",[on],Object.getOwnPropertyDescriptor(Sn.prototype,"disabledColor"),Sn.prototype),ve(Sn.prototype,"normalSprite",[rn],Object.getOwnPropertyDescriptor(Sn.prototype,"normalSprite"),Sn.prototype),ve(Sn.prototype,"pressedSprite",[ln],Object.getOwnPropertyDescriptor(Sn.prototype,"pressedSprite"),Sn.prototype),ve(Sn.prototype,"hoverSprite",[cn],Object.getOwnPropertyDescriptor(Sn.prototype,"hoverSprite"),Sn.prototype),ve(Sn.prototype,"disabledSprite",[hn],Object.getOwnPropertyDescriptor(Sn.prototype,"disabledSprite"),Sn.prototype),ve(Sn.prototype,"duration",[dn],Object.getOwnPropertyDescriptor(Sn.prototype,"duration"),Sn.prototype),ve(Sn.prototype,"zoomScale",[un],Object.getOwnPropertyDescriptor(Sn.prototype,"zoomScale"),Sn.prototype),Tn=ve(Sn.prototype,"useDesktopHover",[pn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),An=ve(Sn.prototype,"emitAnalyticsEvents",[mn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Rn=ve(Sn.prototype,"makeSound",[gn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),In=ve(Sn.prototype,"soundKey",[yn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zi[Fi.BUTTON_CLICK]}}),Pn=ve(Sn.prototype,"disableSpamClick",[bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),_n=ve(Sn.prototype,"disableSpamDelay",[fn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),wn=Sn))||wn)||wn)||wn);var Fn,Bn,zn,Un;i._RF.pop(),i._RF.push({},"0e570DdAIZPKY6DNtNerFmX","OpacityToggler",void 0);const{ccclass:Gn,requireComponent:Hn,property:Vn}=a;let qn=Gn("OpacityToggler")(Fn=Hn([x])((zn=ve((Bn=class extends s{constructor(){super(...arguments),e(this,"activeValue",zn,this),e(this,"inActiveValue",Un,this),this.signal=new si}__preload(){this.opacityComponent=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}changeState(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.signal.abort(),this.opacityComponent.opacity=e?this.activeValue:this.inActiveValue}async changeStateFade(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2;this.signal.abort(),this.signal=new si;const i=e?this.activeValue:this.inActiveValue;await vt.runTweenAsync(E(this.opacityComponent).to(t,{opacity:i}),this.signal)}}).prototype,"activeValue",[Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),Un=ve(Bn.prototype,"inActiveValue",[Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 128}}),Fn=Bn))||Fn)||Fn;i._RF.pop(),i._RF.push({},"244e9OHsmpDnpHQKeLzgiiX","GameEvents",void 0);const Wn="view-resize",Kn="view-resized",Yn="request-view-resize",jn="layout-changed",Xn="gameplay-update-config",$n="opened-skip-overlay",Qn="closed-skip-overlay",Jn="result-scene-replay",Zn="result-scene-home",ea="upgrade-quality",ta="upgrade-dynamic-atlas";i._RF.pop(),i._RF.push({},"5c76fxO2ppOqYp4WNO+Kavm","GameWorld",void 0);const ia={Layout:{Portrait:"portrait",Landscape:"landscape"},DesignSize:{Portrait:{WIDTH:750,HEIGHT:1583},Landscape:{WIDTH:1920,HEIGHT:1583}},FORCE_LAYOUT:"none",FIT_CANVAS_TO_VIEW:!1,FULL_PORTRAIT_SIZE:!0,FULL_LANDSCAPE_SIZE:!0};var na,aa,sa;i._RF.pop(),i._RF.push({},"7ef37Q3PZpKYaeik5JzGwNy","DebugResolution",void 0);const{ccclass:oa,property:ra,requireComponent:la,disallowMultiple:ca,executeInEditMode:ha}=a,{Portrait:da,Landscape:ua}=ia.DesignSize;oa("DebugResolution")(na=ca(na=la([q])(na=ha(!0)(((sa=class e extends s{constructor(){super(...arguments),this.handleLayoutChange=()=>{this.graphics?.clear(),this.start()}}set drawPortrait(t){t!==e._drawPortrait&&(t?this.drawPortraitResolution():this.graphics.clear(),e._drawPortrait=t,e._drawLandscape&&this.drawLandscapeResolution())}get drawPortrait(){return e._drawPortrait}set drawLandscape(t){t!==e._drawLandscape&&(t?this.drawLandscapeResolution():this.graphics.clear(),e._drawLandscape=t,e._drawPortrait&&this.drawPortraitResolution())}get drawLandscape(){return e._drawLandscape}__preload(){this.graphics=this.getComponent(q),this.validateRequiredComponents(),this.listenGameEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenGameEvents(){W.on(jn,this.handleLayoutChange)}start(){this.drawPortrait&&this.drawPortraitResolution(),this.drawLandscape&&this.drawLandscapeResolution()}drawPortraitResolution(){const{graphics:e}=this,t=da.WIDTH,i=da.HEIGHT,n=-t/2,a=-i/2;e.strokeColor=o.GREEN,e.rect(n,a,t,i),e.stroke()}drawLandscapeResolution(){const{graphics:e}=this,t=ua.WIDTH,i=ua.HEIGHT,n=-t/2;let a=-i/2;e.strokeColor=o.CYAN,e.rect(n,a,t,i),e.stroke()}})._drawPortrait=!0,sa._drawLandscape=!0,ve((aa=sa).prototype,"drawPortrait",[ra],Object.getOwnPropertyDescriptor(aa.prototype,"drawPortrait"),aa.prototype),ve(aa.prototype,"drawLandscape",[ra],Object.getOwnPropertyDescriptor(aa.prototype,"drawLandscape"),aa.prototype),na=aa))||na)||na)||na);var pa,ma,ga,ya,ba,fa,wa,Sa,va,Ea,Ca,Ta,Aa,Ra,Ia,Pa,_a,La,Da,Oa;i._RF.pop(),i._RF.push({},"0e2d6yn/BVObK1kyTJ5a09a","GameStats",void 0);const{ccclass:Na,executionOrder:Ma,property:ka}=a,{Utils:{Valid:xa}}=GameCore,Fa=o.RED,Ba=o.BLACK,za=o.MAGENTA;pa=Na("GameStats"),ma=Ma(-1e3),ga=ka(h),ya=ka(h),ba=ka(h),fa=ka(h),wa=ka(h),Sa=ka(h),va=ka(h),Ea=ka(h),pa(Ca=ma((Aa=ve((Ta=class extends s{constructor(){super(...arguments),e(this,"fpsLabel",Aa,this),e(this,"drawCountLabel",Ra,this),e(this,"logicTimeLabel",Ia,this),e(this,"physicTimeLabel",Pa,this),e(this,"renderTimeLabel",_a,this),e(this,"objectMemoryUsageLabel",La,this),e(this,"textureMemoryUsageLabel",Da,this),e(this,"devicePixelRatioLabel",Oa,this),this.refreshInterval=.5,this.handleMouseDown=()=>{this.bg.enabled=!this.bg.enabled},this.waitForStats=()=>{K.stats&&(this.unschedule(this.waitForStats),this.node.active=!0,this.stats=K.stats,this.startUpdateStats())},this.updateStats=()=>{this.updateFps(),this.updateDrawCalls(),this.updateLogicTime(),this.updatePhysicTime(),this.updateRenderTime(),this.updateObjectMemoryUsage(),this.updateTextureMemoryUsage(),this.updateDevicePixelRatio()}}__preload(){this.bg=this.getComponent(R),this.validateRequiredComponents(),this.listenInputEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenInputEvents(){this.node.on(V.EventType.TOUCH_START,this.handleMouseDown)}start(){this.bg.enabled=!1,this.node.active=!1,K&&xa.isDebugger()&&(K.showStats(),this.schedule(this.waitForStats,.5,20))}startUpdateStats(){this.schedule(this.updateStats,this.refreshInterval)}updateFps(){const e=this.getFps();this.updateFpsColor(e),this.fpsLabel.string=`FPS: ${e}`}updateFpsColor(e){this.fpsLabel.color=e<30?Fa:e<48?za:Ba}updateDrawCalls(){const e=this.getDrawCalls();this.updateDrawCallsColor(e),this.drawCountLabel.string=`Draw Calls: ${e}`}updateDrawCallsColor(e){const t=Y.os===Y.OS.IOS,i=t?80:25,n=t?60:15;this.drawCountLabel.color=e>i?Fa:e>n?za:Ba}updateLogicTime(){const e=this.getLogicTime();this.updateLogicTimeColor(e),this.logicTimeLabel.string=`Logic Time: ${e.toFixed(2)}ms`}updateLogicTimeColor(e){this.logicTimeLabel.color=e>10?Fa:e>5?za:Ba}updatePhysicTime(){const e=this.getPhysicTime();this.updatePhysicTimeColor(e),this.physicTimeLabel.string=`Physic Time: ${e.toFixed(2)}ms`}updatePhysicTimeColor(e){this.physicTimeLabel.color=e>10?Fa:e>5?za:Ba}updateRenderTime(){const e=this.getRenderTime();this.updateRenderTimeColor(e),this.renderTimeLabel.string=`Render Time: ${e.toFixed(2)}ms`}updateRenderTimeColor(e){this.renderTimeLabel.color=e>10?Fa:e>5?za:Ba}updateObjectMemoryUsage(){const e=this.getObjectMemoryUsage();this.updateObjectMemoryUsageColor(e),this.objectMemoryUsageLabel.string=`Object Mem: ${e.toFixed(2)}MB`}updateObjectMemoryUsageColor(e){this.objectMemoryUsageLabel.color=e>40?Fa:e>25?za:Ba}updateTextureMemoryUsage(){const e=this.getTextureMemoryUsage();this.updateTextureMemoryUsageColor(e),this.textureMemoryUsageLabel.string=`Texture Mem: ${e.toFixed(2)}MB`}updateTextureMemoryUsageColor(e){this.textureMemoryUsageLabel.color=e>50?Fa:e>35?za:Ba}updateDevicePixelRatio(){const e=this.getDevicePixelRatio();this.updateDevicePixelRatioColor(e),this.devicePixelRatioLabel.string=`Device Pixel Ratio: ${e}`}updateDevicePixelRatioColor(e){this.devicePixelRatioLabel.color=e>2?Fa:e<=1?za:Ba}getFps(){const{counter:e}=this.stats.fps;return Math.floor(e.value)||0}getDrawCalls(){const{counter:e}=this.stats.draws;return e.value||0}getLogicTime(){const{counter:e}=this.stats.logic;return Math.floor(1e3*e.value)/1e3||0}getPhysicTime(){const{counter:e}=this.stats.physics;return Math.floor(1e3*e.value)/1e3||0}getRenderTime(){const{counter:e}=this.stats.render;return Math.floor(1e3*e.value)/1e3||0}getObjectMemoryUsage(){const{counter:e}=this.stats.bufferMemory;return Math.floor(1e3*e.value)/1e3||0}getTextureMemoryUsage(){const{counter:e}=this.stats.textureMemory;return Math.floor(1e3*e.value)/1e3||0}getDevicePixelRatio(){return window.devicePixelRatio||0}}).prototype,"fpsLabel",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ra=ve(Ta.prototype,"drawCountLabel",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ia=ve(Ta.prototype,"logicTimeLabel",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pa=ve(Ta.prototype,"physicTimeLabel",[fa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_a=ve(Ta.prototype,"renderTimeLabel",[wa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),La=ve(Ta.prototype,"objectMemoryUsageLabel",[Sa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Da=ve(Ta.prototype,"textureMemoryUsageLabel",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oa=ve(Ta.prototype,"devicePixelRatioLabel",[Ea],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ca=Ta))||Ca);i._RF.pop(),i._RF.push({},"ca922n1V0RLioEyUJg8hQXH","GameEvents",void 0);var Ua,Ga=function(e){return e.INVITE_FRIENDS="invite-friends",e.REPLAY_FRIENDS="replay-friends",e.SHOW_CHALLENGE_RESULTS="show-challenge-results",e.NEXT_LEVEL="next-level",e.MAX_LEVEL="max-level",e.START_OVER="start-over",e.SELECT_LEVEL="select-level",e.GAME_START="game-start",e.GAME_PAUSE="game-pause",e.GAME_RESUME="game-resume",e.GAME_REPLAY="game-replay",e.GAME_FINISH="game-finish",e.GAME_EXIT="game-exit",e.USE_ITEM="use-item",e.SKIP_LEVEL="skip-level",e.ADD_ITEM="add-item",e.ADD_ITEMS="add-items",e.ADD_COINS="add-coins",e.REMOVE_COINS="remove-coins",e.REMOVE_COINS_SUCCESS="remove-coins-success",e.REMOVE_COINS_FAILED="remove-coins-failed",e.COIN_CHANGED="coin-changed",e.ADD_STARS="add-stars",e.PAUSE_TIME="pause-time",e.RESUME_TIME="resume-time",e.TIME_OUT="time-out",e.HALF_TIME="half-time",e.RESCUE_START="rescue-time",e.RESCUE_FINISHED="clock-animation-finished",e.APPLY_GRAVITY="apply-gravity",e.IDLE_ENTER="idle-enter",e.IDLE_EXIT="idle-exit",e.GRID_MATCH="grid-match",e.GRID_MATCH_SUCCESS="grid-match-success",e.GRID_MATCH_FAIL="grid-match-fail",e.GRID_CLEAR="grid-clear",e.GRID_CREATE="grid-create",e.GRID_RESIZE="grid-resize",e.TILE_CLICK="tile-click",e.BOMB_EXPLODE="bomb-explode",e.SHOW_HINT="show-hint",e.ADD_COMBO="add-combo",e.COMBO_UPDATED="combo-updated",e.COMBO_ENDED="combo-ended",e.ADD_SCORE="add-score",e.SCORE_UPDATED="score-updated",e.REGISTER_ANIMATOR="register-animator",e.UNREGISTER_ANIMATOR="unregister-animator",e.SHOW_UI="show-ui",e.HIDE_UI="hide-ui",e.AUTO_PLAY="auto-play",e.GUIDE_MASK_CLICKED="guide-mask-clicked",e}(Ga||{});i._RF.pop(),i._RF.push({},"8249dDH5xBEc4nnCGRgSjaW","PanelAnimationController",void 0);const{ccclass:Ha}=a;let Va=Ha("PanelAnimationController")(Ua=class extends s{constructor(){super(...arguments),this.animators=new Set,this.handleRegistration=e=>{if(!e)throw new Error("Invalid event payload.");this.animators.has(e)&&console.warn("Animator already registered."),this.animators.add(e)},this.handleUnregistration=e=>{if(!e)throw new Error("Invalid event payload.");this.animators.has(e)||console.warn("Animator not registered."),this.animators.delete(e)},this.handleShowUIs=e=>{let t=!1;const i=[];this.animators.forEach((e=>{i.push(e)}));const n=[];for(const a of i)a.isReadyForAnimation()||t||(t=!0,e?.fallback?.()),n.push(a.handleShowUI());void 0!==e?.onComplete&&n.length>0&&Promise.all(n).then(e.onComplete)},this.handleHideUIs=e=>{let t=!1;const i=[];this.animators.forEach((e=>{i.push(e)}));const n=[];for(const a of i)a.isReadyForAnimation()||t||(t=!0,e?.fallback?.()),n.push(a.handleHideUI());void 0!==e?.onComplete&&n.length>0&&Promise.all(n).then(e.onComplete)}}init(){this.node.scene.off(Ga.REGISTER_ANIMATOR),this.node.scene.off(Ga.UNREGISTER_ANIMATOR),this.node.scene.off(Ga.SHOW_UI),this.node.scene.off(Ga.HIDE_UI),this.node.scene.on(Ga.REGISTER_ANIMATOR,this.handleRegistration),this.node.scene.on(Ga.UNREGISTER_ANIMATOR,this.handleUnregistration),this.node.scene.on(Ga.SHOW_UI,this.handleShowUIs),this.node.scene.on(Ga.HIDE_UI,this.handleHideUIs)}})||Ua;var qa,Wa,Ka,Ya,ja,Xa,$a,Qa,Ja,Za,es,ts,is,ns,as,ss,os,rs;i._RF.pop(),i._RF.push({},"f190aWZvVlGiplYX4XrZG3a","PanelAnimator",void 0);const{ccclass:ls,property:cs}=a,{Utils:{Object:hs}}=GameCore;let ds=(qa=ls("AnimationConfig"),Wa=cs({type:[A]}),qa((ja=ve((Ya=class{constructor(){e(this,"startHidden",ja,this),e(this,"nodes",Xa,this),e(this,"posOffset",$a,this),e(this,"showEase",Qa,this),e(this,"hideEase",Ja,this),e(this,"showDuration",Za,this),e(this,"hideDuration",es,this)}setConfig(e){e&&hs.assign(this,e)}}).prototype,"startHidden",[cs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xa=ve(Ya.prototype,"nodes",[Wa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$a=ve(Ya.prototype,"posOffset",[cs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Qa=ve(Ya.prototype,"showEase",[cs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backOut"}}),Ja=ve(Ya.prototype,"hideEase",[cs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"backIn"}}),Za=ve(Ya.prototype,"showDuration",[cs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),es=ve(Ya.prototype,"hideDuration",[cs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ka=Ya))||Ka),us=(ts=ls("PanelAnimator"),is=cs({type:ds,displayName:"Top animation nodes"}),ns=cs({type:ds,displayName:"Bottom animation nodes"}),ts((os=ve((ss=class t extends s{constructor(){super(...arguments),e(this,"topConfig",os,this),e(this,"botConfig",rs,this),this.isReady=!1}onEnable(){this.node.scene.emit(Ga.REGISTER_ANIMATOR,this)}onDisable(){this.node.scene.emit(Ga.UNREGISTER_ANIMATOR,this)}onLoad(){this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos(),this.isReady=!0}initUIPos(){this.topAnimator.switchState(this.topConfig.startHidden?"hidden":"shown",!0),this.botAnimator.switchState(this.botConfig.startHidden?"hidden":"shown",!0)}isReadyForAnimation(){return this.isReady}async handleShowUI(){if(this.isReady)return Promise.all([this.topAnimator.switchState("shown"),this.botAnimator.switchState("shown")]);console.warn(`${this.node.name}'s ${this.name}: not ready`)}async handleHideUI(){if(this.isReady)return Promise.all([this.topAnimator.switchState("hidden"),this.botAnimator.switchState("hidden")]);console.warn(`${this.node.name}'s ${this.name}: not ready`)}createAnimator(e,i){let{nodes:n,posOffset:a,showEase:s,hideEase:o,showDuration:r,hideDuration:l}=e;const c=n.map((e=>"top"===i&&e.isAlignTop?{mode:"top",value:e.top}:"bottom"===i&&e.isAlignBottom?{mode:"bottom",value:e.bottom}:{mode:"position",value:e.node.position.y})),h=n.map((e=>"top"===i&&e.isAlignTop?{mode:"top",value:e.top+a}:"bottom"===i&&e.isAlignBottom?{mode:"bottom",value:e.bottom-a}:{mode:"position",value:e.node.position.y+a}));let d="shown";return{switchState:function(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(d===e)return Promise.resolve(null);d=e;const a="hidden"===e?c:h,u="hidden"===e?h:c,p="hidden"===e?l:r,m="hidden"===e?o:s;return i?(n.forEach(((e,t)=>{const i=a[t],n=u[t].value;"top"===i.mode&&(e.top=n),"bottom"===i.mode&&(e.bottom=n),"position"===i.mode&&(e.node.position=new j(e.node.position.x,n,e.node.position.z))})),Promise.resolve(null)):Promise.all(n.map(((e,i)=>{const n=a[i],s=u[i].value;return vt.runTweenAsync(t.getTween({widget:e,config:n,target:s,easing:m,duration:p}))})))}}}setAnimator(e){let{topConfig:t,botConfig:i}=e;const n=new ds,a=new ds;n.setConfig(t),a.setConfig(i),this.topConfig=n,this.botConfig=a,this.topAnimator=this.createAnimator(this.topConfig,"top"),this.botAnimator=this.createAnimator(this.botConfig,"bottom"),this.initUIPos()}static getTween(e){let{widget:t,config:i,target:n,easing:a,duration:s}=e;return"top"===i.mode?E(t).call((()=>{t.top=i.value})).to(s,{top:n},{easing:a}):"bottom"===i.mode?E(t).call((()=>{t.bottom=i.value})).to(s,{bottom:n},{easing:a}):E(t.node.position).call((()=>{t.node.position=new j(t.node.position.x,i.value,t.node.position.z)})).to(s,{y:n},{easing:a})}}).prototype,"topConfig",[is],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ds}}),rs=ve(ss.prototype,"botConfig",[ns],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ds}}),as=ss))||as);var ps,ms,gs,ys;i._RF.pop(),i._RF.push({},"6ea01hdw/9MHb28SCDAiRss","ResizeWithBannerAd",void 0);const{ccclass:bs,requireComponent:fs,property:ws}=a,{ads:Ss,event:vs}=globalThis.game,{Events:Es,Configs:{Ads:Cs},Plugins:{Ads:{Types:Ts,Status:As}}}=GameCore;bs("ResizeWithBannerAd")(ps=fs(A)((gs=ve((ms=class t extends s{constructor(){super(...arguments),e(this,"willShowBanner",gs,this),e(this,"includeSAB",ys,this),this.handleAdShow=e=>{let{placementId:t}=e;if(null===t)return;Ss.getAdByPlacementId(t)?.type===Ts.BANNER&&this.resizeToFitBannerAd()},this.handleAdClose=e=>{let{placementId:t}=e;if(null===t)return;Ss.getAdByPlacementId(t)?.type===Ts.BANNER&&this.updateWidgets(Ss.getSafeAreaBottom(Xi.cssSizeToWorldSize(1)))}}__preload(){this.widget=this.getComponent(A),Fe.lazyValidateProperties(this),vs.on(Es.AD_SHOWING,this.handleAdShow),vs.on(Es.AD_CLOSED,this.handleAdClose)}onDestroy(){vs.off(Es.AD_SHOWING,this.handleAdShow),vs.off(Es.AD_CLOSED,this.handleAdClose)}start(){const e=Ss.getSafeAreaBottom(Xi.cssSizeToWorldSize(1));this.willShowBanner||t.isBannerAdShowing()?this.resizeToFitBannerAd():e>0&&this.includeSAB&&this.updateWidgets(e)}resizeToFitBannerAd(){const{Enabled:e,BannerDisplayAdOptions:t}=Cs;if(!e)return;if(!this.widget.isAlignBottom)return void console.warn("Widget does not align to bottom, ResizeWithBannerAds will have no effect!");let i=null,n=null,a=null,s=null;const o=Xi.cssSizeToWorldSize(1);t.forEach((e=>{let{PlacementId:t,Position:r,BannerWidth:l}=e;if(Ss.canbeShowBannerAd(t))switch(r){case"top":i=Ss.getBannerHeight(t,o);break;case"bottom":n=Ss.getBannerHeight(t,o,this.includeSAB);break;case"left":{if(void 0===l)break;let e=l;"getBannerOffset"in GameSDK.extra&&(e+=GameSDK.extra.getBannerOffset()),a=e*o;break}case"right":{if(void 0===l)break;let e=l;"getBannerOffset"in GameSDK.extra&&(e+=GameSDK.extra.getBannerOffset()),s=e*o;break}}})),this.updateWidgets(i,n,a,s)}updateWidgets(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.widget.top=e??this.widget.top,this.widget.bottom=t??this.widget.bottom,this.widget.left=i??this.widget.left,this.widget.right=n??this.widget.right,this.widget.updateAlignment();this.getComponentsInChildren(A).forEach((e=>{e.updateAlignment()}))}static isBannerAdShowing(){return Ss.enabled&&Ss.getAdStatus(Ts.BANNER)===As.SHOWING}}).prototype,"willShowBanner",[ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ys=ve(ms.prototype,"includeSAB",[ws],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ps=ms))||ps);var Rs,Is,Ps,_s,Ls,Ds,Os,Ns,Ms,ks,xs;i._RF.pop(),i._RF.push({},"3d28fQaHU5Lm4/Zyq/Jd2b6","TapperedProgressBar",void 0);const{ccclass:Fs,property:Bs,executeInEditMode:zs,requireComponent:Us}=a;let Gs=(Rs=Fs("TapperedProgressBar"),Is=Us(x),Ps=Bs({type:x,displayName:"Fill opacity"}),_s=Bs({type:R,displayName:"Left Cap",tooltip:"If assigned, will be displayed when progress is larger than 0%"}),Ls=Bs({type:R,displayName:"Right Cap",tooltip:"If assigned, will be displayed when progress is at 100%"}),Ds=Bs({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress",override:!0}),Rs(Os=zs(Os=Is((Ms=ve((Ns=class extends X{constructor(){super(...arguments),e(this,"uiOpacity",Ms,this),e(this,"leftCap",ks,this),e(this,"rightCap",xs,this)}get progress(){return super.progress}set progress(e){super.progress=e,this.updateAppearance()}updateAppearance(){if(null===this.uiOpacity)return;if(this.progress<=0)return void(this.uiOpacity.opacity=0);if(this.progress>.1)return void(this.uiOpacity.opacity=255);const e=Math.floor(this.progress/.05*255);this.uiOpacity.opacity=e}start(){this.updateAppearance()}}).prototype,"uiOpacity",[Ps],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ks=ve(Ns.prototype,"leftCap",[_s],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xs=ve(Ns.prototype,"rightCap",[Ls],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ve(Ns.prototype,"progress",[Ds],Object.getOwnPropertyDescriptor(Ns.prototype,"progress"),Ns.prototype),Os=Ns))||Os)||Os)||Os);var Hs,Vs,qs,Ws,Ks,Ys,js,Xs,$s,Qs;i._RF.pop(),i._RF.push({},"bce15LcVrxOfYMa9rbXN/qi","Localize",void 0);const{ccclass:Js,property:Zs,requireComponent:eo,executeInEditMode:to,disallowMultiple:io}=a,{language:no}=globalThis.game;Hs=Js("Localize"),Vs=eo(h),qs=to(!0),Ws=Zs({visible:!0}),Ks=Zs({group:{name:"Fonts",id:"fonts",displayOrder:1},type:$}),Ys=Zs({group:{name:"Fonts",id:"fonts",displayOrder:2},type:$}),Hs(js=io(js=Vs(js=qs((ve((Xs=class extends s{constructor(){super(...arguments),e(this,"enFont",$s,this),e(this,"ruFont",Qs,this),this.handleLanguageChanged=()=>{this.updateTransToNode()}}set key(e){e&&(this._key=e,this.updateTransToNode())}get key(){return this._key}__preload(){this.label=this.getComponent(h),this.validateRequiredComponents(),this.updateTransToNode()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}start(){this.listenEvent()}listenEvent(){W.on("update-language",this.handleLanguageChanged)}updateTransToNode(){if(this.node.active&&this._key)try{const e=no.getText(this._key),t=this.getFontByLang();this.label.font=t,this.label.string=e,this.node.emit("update-trans",e)}catch(e){console.warn(e)}}getFontByLang(){if(!this.enFont||!this.ruFont)throw new Error("Font is not found");switch(no.getCurrentLocale()){case"en":return this.enFont;case"ru":return this.ruFont;default:return this.enFont}}}).prototype,"key",[Ws],Object.getOwnPropertyDescriptor(Xs.prototype,"key"),Xs.prototype),$s=ve(Xs.prototype,"enFont",[Ks],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qs=ve(Xs.prototype,"ruFont",[Ys],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),js=Xs))||js)||js)||js);var ao,so,oo,ro,lo,co,ho,uo,po;i._RF.pop(),i._RF.push({},"aef305TaZhKVo1f4/qH1kf+","SecondOrderDynamics",void 0);const{ccclass:mo,property:go}=a;class yo{constructor(e,t){t=t??{response:1,dampen:1,eager:1},this.k1=yo.calcK1(t),this.k2=yo.calcK2(t),this.k3=yo.calcK3(t),this.xp=e.clone(),this.y=e.clone(),this.yd=new Q(0,0)}update(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;null===i&&(i=new Q((t.x-this.xp.x)/e,(t.y-this.xp.y)/e),this.xp.x=t.x,this.xp.y=t.y);const n=Math.max(this.k2,e*e/2+e*this.k1/2,e*this.k1);return this.y.x=this.y.x+e*this.yd.x,this.y.y=this.y.y+e*this.yd.y,this.yd.x=this.yd.x+e*(t.x+this.k3*i.x-this.y.x-this.k1*this.yd.x)/n,this.yd.y=this.yd.y+e*(t.y+this.k3*i.y-this.y.y-this.k1*this.yd.y)/n,this.y}setDynamics(e){this.k1=yo.calcK1(e),this.k2=yo.calcK2(e),this.k3=yo.calcK3(e)}reset(e){this.xp.set(e.x,e.y),this.y.set(e.x,e.y),this.yd.set(0,0)}get currentState(){return this.y}static calcK1(e){return e.dampen/(Math.PI*e.response)}static calcK2(e){return 1/(2*Math.PI*e.response*(2*Math.PI*e.response))}static calcK3(e){return e.eager*e.dampen/(2*Math.PI*e.response)}}let bo=(ao=mo("SODConfig"),so=go({type:C,displayName:"Responsiveness",tooltip:"Higher values will result shorter response times."}),oo=go({type:C,displayName:"Dampening",tooltip:"Higher values will result in less overshoot and oscillation."}),ro=go({type:C,displayName:"Eagerness",tooltip:"Higher values will result in more overshoot and oscillation, negative values will result in anticipation."}),ao((ho=ve((co=class{constructor(){e(this,"response",ho,this),e(this,"dampen",uo,this),e(this,"eager",po,this)}}).prototype,"response",[so],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),uo=ve(co.prototype,"dampen",[oo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),po=ve(co.prototype,"eager",[ro],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lo=co))||lo);var fo,wo,So,vo,Eo,Co,To,Ao,Ro;i._RF.pop(),i._RF.push({},"e9e74FEHyRLvar32WZD/F11","Trail",void 0);const{ccclass:Io,property:Po}=a;let _o=(fo=Io("Trail"),wo=Po({type:n,displayName:"Target"}),So=Po({type:q,displayName:"Graphics"}),vo=Po({type:[bo],displayName:"Trail Nodes"}),fo((To=ve((Co=class extends s{constructor(){super(...arguments),e(this,"target",To,this),e(this,"graphics",Ao,this),e(this,"trailNodes",Ro,this),this.trailNodeInstances=[]}reset(){for(const e of this.trailNodeInstances)e.reset(new Q(this.node.worldPosition.x,this.node.worldPosition.y));this.graphics.clear()}onLoad(){this.validateRequiredComponents(),this.spawnTrailNodes()}update(e){this.graphics.clear();const t=this.trailNodeInstances[0];this.drawTrail(e,t,this.target.worldPosition.x,this.target.worldPosition.y);for(let t=1;t<this.trailNodeInstances.length;t++){const i=this.trailNodeInstances[t-1],n=this.trailNodeInstances[t];this.drawTrail(e,n,i.currentState.x,i.currentState.y)}}drawTrail(e,t,i,n){const{graphics:a}=this,s=new Q(i,n),o=t.update(e,s),r=new j(s.x,s.y,0),l=new j(o.x,o.y,0);a.node.inverseTransformPoint(r,r),a.node.inverseTransformPoint(l,l),a.moveTo(r.x,r.y),a.lineTo(l.x,l.y),a.stroke()}spawnTrailNodes(){for(const e of this.trailNodes){const t=new Q(this.node.worldPosition.x,this.node.worldPosition.y),i=new yo(t,e);this.trailNodeInstances.push(i)}}validateRequiredComponents(){if(!this.target)throw new Error("Target is not set");if(!this.graphics)throw new Error("Graphics is not set");0===this.trailNodes.length&&console.warn("No trail nodes are set")}}).prototype,"target",[wo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ao=ve(Co.prototype,"graphics",[So],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ro=ve(Co.prototype,"trailNodes",[vo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Eo=Co))||Eo);var Lo,Do,Oo,No,Mo,ko,xo,Fo,Bo,zo,Uo,Go,Ho,Vo,qo,Wo,Ko,Yo,jo,Xo,$o,Qo,Jo,Zo,er,tr;i._RF.pop(),i._RF.push({},"a2260jBMJFPCrn/Q4Vo4iB1","BatchNodes",void 0);const{ccclass:ir,executionOrder:nr,property:ar}=a,{Utils:{Array:sr}}=GameCore,or="Batch By Name",rr="Batch Label",lr="Batch Sprite";let cr=(Lo=ir("BatchNodes"),Do=nr(99999),Oo=ar({group:{name:or}}),No=ar({type:[f],group:{name:or}}),Mo=ar({type:[b],group:{name:or}}),ko=ar({group:{name:rr}}),xo=ar({group:{name:rr}}),Fo=ar({group:{name:rr}}),Bo=ar({group:{name:lr}}),zo=ar({group:{name:lr}}),Uo=ar({readonly:!0}),Go=ar({readonly:!0}),Ho=ar({readonly:!0}),Lo(Vo=Do((Wo=ve((qo=class extends s{constructor(){super(...arguments),e(this,"batchByName",Wo,this),e(this,"depthNames",Ko,this),e(this,"listName",Yo,this),e(this,"batchLabel",jo,this),e(this,"depthLabel",Xo,this),e(this,"typeLabel",$o,this),e(this,"batchSprite",Qo,this),e(this,"depthSprite",Jo,this),e(this,"batchAllNodes",Zo,this),e(this,"batchDepth",er,this),e(this,"checkOverlap",tr,this),this.batchNode={},this.labelChildren=[],this.spriteChildren=[],this.allChildren=[],this.nameChildren=[],this.originalParents={},this.isInited=!1,this.onAfterUpdate=()=>{this.isInited&&this.hierarchyChildren()},this.onAfterRender=()=>{this.isInited&&this.restoreOriginalChildren()}}__preload(){this.enabled&&(m.on(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.on(J.EVENT_AFTER_RENDER,this.onAfterRender))}onDestroy(){m.off(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.off(J.EVENT_AFTER_RENDER,this.onAfterRender)}onLoad(){this.enabled&&(this.setupBatchNodes(this.node),this.isInited=!0)}onEnable(){m.on(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.on(J.EVENT_AFTER_RENDER,this.onAfterRender),this.setupBatchNodes(this.node),this.isInited=!0}onDisable(){this.restoreOriginalChildren(),m.off(J.EVENT_AFTER_UPDATE,this.onAfterUpdate),m.off(J.EVENT_AFTER_RENDER,this.onAfterRender),this.isInited=!1}setupBatchNodes(e){this.allChildren=[],this.nameChildren=[],this.labelChildren=[],this.spriteChildren=[],this.saveOriginalChildren(e),this.createGlobalNodes(e),this.createGlobalNameNodes(e),this.createGlobalLabelNode(e),this.createGlobalSpriteNode(e),this.sortGlobalNodes()}sortGlobalNodes(){this.batchNode.node?.setSiblingIndex(0),this.batchNode.label?.setSiblingIndex(this.depthLabel),this.batchNode.sprite?.setSiblingIndex(this.depthSprite),this.listName.forEach(((e,t)=>{this.batchNode[e]?.setSiblingIndex(this.depthNames[t])}))}createGlobalNodes(e){if(!this.batchAllNodes)return;const t=new n("GlobalBatchNode");t.active=!0,this.batchNode.node=t,e.addChild(t)}createGlobalNameNodes(e){this.batchByName&&this.listName.forEach((t=>{if(this.batchNode[t])return;const i=new n(t);i.active=!0,this.batchNode[t]=i,e.addChild(i)}))}createGlobalLabelNode(e){if(!this.batchLabel)return;const t=new n("GlobalLabelNode");t.active=!0,this.batchNode.label=t,e.addChild(t)}createGlobalSpriteNode(e){if(!this.batchSprite)return;const t=new n("GlobalSpriteNode");t.active=!0,this.batchNode.sprite=t,e.addChild(t)}saveOriginalParents(){[...this.labelChildren,...this.spriteChildren].forEach((e=>{e.node.parent&&(this.originalParents[e.uuid]=e.node.parent)})),this.nameChildren.forEach((e=>{e.parent&&(this.originalParents[e.uuid]=e.parent)}))}saveOriginalChildren(e){e.children.forEach((e=>{this.saveLabelChildren(e),this.saveSpriteChildren(e),this.saveNodeChildrenByName(e),this.saveNodeChildrenByType(e)})),this.saveOriginalParents()}saveLabelChildren(e){if(!this.batchLabel)return;const t=e.getComponentsInChildren(h);"char"===this.typeLabel&&t.filter((e=>e.cacheMode===h.CacheMode.CHAR)),0!==t.length&&this.labelChildren.push(...t)}saveSpriteChildren(e){if(!this.batchSprite)return;const t=e.getComponentsInChildren(R);0!==t.length&&this.spriteChildren.push(...t)}saveNodeChildrenByName(e){this.batchByName&&e.children.forEach((e=>{sr.has(this.listName,e.name)?this.nameChildren.push(e):this.saveNodeChildrenByName(e)}))}saveNodeChildrenByType(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.batchAllNodes)return;const i=e.getComponentsInChildren(s);this.allChildren.push(...i),this.batchDepth>0&&t<this.batchDepth&&this.allChildren.forEach((e=>{this.saveNodeChildrenByType(e.node,this.batchDepth)}))}hierarchyChildren(){let e;this.labelChildren.forEach((t=>{t.node.isValid&&t.node.activeInHierarchy&&(e=this.batchNode.label,t.node.isChildOf(e)||(t.node.setParent(e,!0),t.node.layer=Z.Enum.UI_2D))})),this.spriteChildren.forEach((t=>{t.node.isValid&&t.node.activeInHierarchy&&(e=this.batchNode.sprite,t.node.isChildOf(e)||(t.node.setParent(e,!0),t.node.layer=Z.Enum.UI_2D))})),this.allChildren.forEach((t=>{t.node.isValid&&t.node.activeInHierarchy&&(e=this.batchNode.node,t.node.isChildOf(e)||(t.node.setParent(e,!0),t.node.layer=Z.Enum.UI_2D))})),this.allChildren.sort(((e,t)=>{const i=e.constructor.name,n=t.constructor.name;return i<n?-1:i>n?1:0})),this.nameChildren.forEach((t=>{if(!t.isValid)return;if(!t.activeInHierarchy)return;if(!t.isTransformDirty())return;const i=t.getComponent(x);i&&i.opacity<1||(e=this.batchNode[t.name],t.isChildOf(e)||(t.setParent(e,!0),t.layer=Z.Enum.UI_2D))}))}restoreOriginalChildren(){const e=[...this.labelChildren,...this.spriteChildren];e.length>0&&e.forEach((e=>{const t=this.originalParents[e.uuid];t&&(e.node.isChildOf(t)||e.node.setParent(t,!0))})),this.nameChildren.forEach((e=>{const t=this.originalParents[e.uuid];t&&(e.isChildOf(t)||e.setParent(t,!0))}))}}).prototype,"batchByName",[Oo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ko=ve(qo.prototype,"depthNames",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yo=ve(qo.prototype,"listName",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),jo=ve(qo.prototype,"batchLabel",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Xo=ve(qo.prototype,"depthLabel",[xo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$o=ve(qo.prototype,"typeLabel",[Fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"char"}}),Qo=ve(qo.prototype,"batchSprite",[Bo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Jo=ve(qo.prototype,"depthSprite",[zo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Zo=ve(qo.prototype,"batchAllNodes",[Uo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),er=ve(qo.prototype,"batchDepth",[Go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tr=ve(qo.prototype,"checkOverlap",[Ho],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Vo=qo))||Vo)||Vo);var hr;i._RF.pop(),i._RF.push({},"9b958Lf6PFClb/JuJfTLzxG","Vibrate",void 0);const{ccclass:dr}=a,{Utils:{Browser:ur}}=GameCore,{player:pr}=globalThis.game;let mr=dr("Vibrate")(hr=class extends s{vibrate(e){if(!this.isVibrateEnable())return;if(!ur.vibrate(e)){if("performHapticFeedbackAsync"in GameSDK.extra)return void GameSDK.extra.performHapticFeedbackAsync();console.warn("Vibrate failed")}}isVibrateEnable(){return!!pr.getPlayerSetting("vibrate")}})||hr;i._RF.pop(),i._RF.push({},"358fdIqjFdNzZGa95REWt2F","Ads",void 0);const gr=1/6;i._RF.pop(),i._RF.push({},"542caJcCPRMI5EaOkgOzhek","ItemKeys",void 0);const yr={HINT:"hint",THUNDER:"thunder",STORM:"storm",PLIERS:"pliers"};i._RF.pop(),i._RF.push({},"62927KYr+tCcIzOaPtVc/q8","CoinData",void 0);const br=10,fr=50,wr=100,Sr={[yr.HINT]:80,[yr.THUNDER]:200,[yr.STORM]:150,[yr.PLIERS]:150},vr=200,Er=40;i._RF.pop(),i._RF.push({},"8328a20Ku5GF4anma0sBaxm","DailyRewardsData",void 0);const Cr={0:{id:1,type:"coin",value:20},1:{id:2,type:"coin",value:30},2:{id:3,type:"coin",value:50},3:{id:4,type:"coin",value:100},4:{id:5,type:"coin",value:150},5:{id:6,type:"coin",value:200},6:{id:7,type:"coin",value:250,items:{hint:3,thunder:3,storm:3,pliers:0}}};i._RF.pop(),i._RF.push({},"8875b8IrVpJWJr/45aS1gql","DefaultRespMatchData",void 0);const{Dtos:{Match:{Data:Tr}}}=GameCore,Ar={...Tr.getDefaultData(),extraData:null};i._RF.pop(),i._RF.push({},"ad867amogBFGJo9jp78EnQP","DevTools",void 0);var Rr=function(e){return e.UNLOCK_DEV_TOOLS="unlock-dev-tools",e.TRIGGER_UNLOCK_KEY="trigger-unlock-key",e.TRIGGER_RESET_SEQUENCE="trigger-reset-sequence",e}(Rr||{});const Ir={Events:Rr,UNLOCK_SEQUENCE:"101013012031"};i._RF.pop(),i._RF.push({},"7decaASyaFOAp2izq8DsREg","TotalLevel",void 0);i._RF.pop(),i._RF.push({},"f8533KH/fxOfYqya9sgLrSj","GameData",void 0);const Pr={level:0,coins:0,stars:0,totalLevel:80,levelVersion:0,lastRewardedItems:0,lastCreateTournamentShown:0,guideItemShowed:[],items:{[yr.HINT]:0,[yr.THUNDER]:0,[yr.STORM]:0,[yr.PLIERS]:0},skins:{}};i._RF.pop(),i._RF.push({},"52b52FNwvhBKY/becAy420o","Leaderboard",void 0);const _r="global-leaderboard-key",Lr="friends-leaderboard-key",Dr="global-leaderboard-id",Or="friends-leaderboard-id";i._RF.pop(),i._RF.push({},"3b9bcPJBxpNOqG2I6exTOVn","MatchCustomData",void 0);const{Dtos:{Match:{CustomData:Nr}}}=GameCore,Mr={...Nr.getDefaultData(),score:0};i._RF.pop(),i._RF.push({},"074c4KXFZ1Pq6d+66PrLd2+","PlayerData",void 0);const kr={score:0,endlessScore:0,settings:{sound:!0,music:!0,vibrate:!0,language:"en"},gameData:Pr,isFirstLogin:!0,dailyRewarded:{logDays:[],lastRewarded:0}};i._RF.pop(),i._RF.push({},"32598ObpVZK/pecmWIdcs+7","SceneKeys",void 0);const xr="BootScene",Fr="GameScene",Br="DashboardScene",zr="ChallengeResultScene";i._RF.pop(),i._RF.push({},"f16ffbXQPtDK58g6BNFwzJv","Tournament",void 0);var Ur=function(e){return e.RELOAD_TOURNAMENT="reload-tournament",e}(Ur||{});i._RF.pop(),i._RF.push({},"598f2UgQ+NGBYLWv34s6Vev","renderCustomResultChallenge",void 0);const{Configs:{FrameCapture:{Enabled:Gr,WideframeConfigs:Hr}},Utils:{Object:Vr}}=GameCore,qr=async e=>{if(!Gr)return console.warn("FrameCapture is not enabled"),null;const t=Kr(e);if(!t)return null;Wr(t,Hr.CustomResultChallenge);const{frameCapture:i}=window.game,{Width:n,Height:a}=Hr.CustomResultChallenge;return i.captureAsync({name:"CustomResultChallenge",width:n,height:a,renderOptions:t})},Wr=(e,t)=>{const{Width:i,Height:n,Wideframe:a}=t;e.wideframe={name:"custom-result-challenge",type:"image",depth:0,image:a,size:[i,n],position:[0,0]}},Kr=e=>{try{const{playerId:t="10",playerPhoto:i="",playerScore:n=0,opponentId:a="20",opponentPhoto:s="",opponentScore:o=0,isPlayerFinished:r,isOpponentFinished:l}=e,{RenderOptions:c}=Hr.CustomResultChallenge,h=Vr.camelCaseKeys(Vr.clone(c)),{playerPhoto:d,opponentPhoto:u}=h,p=n===o,m=n>o,g=r??l,y=r&&l;return"image"===d.type&&(d.name=`${t}`,d.image=i),"image"===u.type&&(u.name=`${a}`,u.image=s),g&&Yr(h,{playerScore:n,opponentScore:o,isPlayerFinished:r,isOpponentFinished:l}),!y||p?(delete h.leftCrown,delete h.rightCrown,h):(m?delete h.rightCrown:delete h.leftCrown,h)}catch(e){return console.warn("getRenderOptionsShareScore",e),null}},Yr=(e,t)=>{const{leftScore:i,rightScore:n}=e,{playerScore:a=0,opponentScore:s=0,isPlayerFinished:o,isOpponentFinished:r}=t;"text"===i.type&&(i.text=o?`${a}`:"???"),"text"===n.type&&(n.text=r?`${s}`:"???")};i._RF.pop(),i._RF.push({},"ad7acMQ2iJNKKA2RkT+nGNI","CommonError",void 0);class jr extends Error{constructor(e,t){super(t),this.code=e}}i._RF.pop(),i._RF.push({},"5ff78u05/tPepABfMzNaOjM","PlayerHasTournamentError",void 0);class Xr extends jr{constructor(e,t){super("PLAYER_HAS_TOURNAMENT","Player has a tournament"),this.playerId=e,this.tournamentId=t}}i._RF.pop(),i._RF.push({},"e14dbcdc89LQJIggfi5qO6U","MapData",void 0);const $r={themeNames:["summer","autumn","winter"],skinNames:["cakes","car","cosmetics","flower","fruit","ice-cream","sport","tool"],mapOrder:[{id:1,theme:"summer",skin:"fruit",levelCount:10},{id:2,theme:"autumn",skin:"flower",levelCount:10},{id:3,theme:"winter",skin:"tool",levelCount:10},{id:4,theme:"summer",skin:"sport",levelCount:10},{id:5,theme:"autumn",skin:"cosmetics",levelCount:10},{id:6,theme:"winter",skin:"ice-cream",levelCount:10},{id:7,theme:"summer",skin:"cakes",levelCount:10},{id:8,theme:"autumn",skin:"car",levelCount:10}]};i._RF.pop(),i._RF.push({},"c0656MbbYRE+KSk63rv74ZI","SkinKeys",void 0);const Qr="cakes",Jr="flower",Zr="fruit";i._RF.pop(),i._RF.push({},"3f1dbbPrPVBy5lNYySV74Qq","ThemeKeys",void 0);const el={SUMMER:"summer",AUTUMN:"autumn",WINTER:"winter"};I(el),i._RF.pop(),i._RF.push({},"6093adbLQZKpqgUpTV/sHj1","ThemeUtils",void 0);const{player:tl,storage:il}=globalThis.game,{Array:nl}=GameCore.Utils,al={currentProgress:0,maxProgress:10,isLocked:!0,themeId:"summer"},sl={id:0,currentSkin:Qr,currentTheme:el.SUMMER,nextSkin:null,nextTheme:null,progress:0,max:10},ol={skin:"cakes",themeId:"summer",progress:0,max:10,isLocked:!0};class rl{constructor(){this.mapData=$r,this.playerSkinProgress=null}static getInstance(){return this._instance||(this._instance=new rl),this._instance}static init(){const e=this.getInstance();e.updatePlayerSkinProgress(),e.initDashboardSceneStorage()}initDashboardSceneStorage(){const e=il.getStorage("dashboard");if(null!=e)return;const t=this.getCurrentMapProgressInstance();il.addStorage("dashboard",{lastMapPayload:t,numOfMapsPassed:0,animateToCurrentLevel:!1});const i=il.getStorage("collection");if(null!=i)return;il.addStorage("collection",{lastMapPack:t.id,animateMapPackUnlock:!1});const n=il.getStorage("leaderboard_content");if(null!=n)return;il.addStorage("leaderboard_content",{lastTabOpened:"global"});const a=il.getStorage("tournament");null==a&&il.addStorage("tournament",{animateTournamentLeader:!1})}static getCurrentMapProgress(){return this.getInstance().getCurrentMapProgressInstance()}getCurrentMapProgressInstance(){if(null===this.playerSkinProgress)return console.warn("getCurrentMapProgress: playerSkinProgress not found. Have you called init()?"),sl;const e=this.mapData.mapOrder;let t,i,n,a,s=0,o=0,r=0;for(let l=0;l<e.length;l++){const c=this.playerSkinProgress[e[l].skin];if(c.currentProgress<c.maxProgress){r=e[l].id,t=e[l].skin,i=e[l].theme,n=e[l+1]?.skin??t,a=e[l+1]?.theme??i,s=c.currentProgress,o=c.maxProgress;break}}if(void 0===t||void 0===n||void 0===i||void 0===a){const l=e[e.length-1];return r=l.id,t=l.skin,i=l.theme,n=l.skin,a=l.theme,s=l.levelCount,o=l.levelCount,console.log("getMapCurrentProgress: all skin completed"),{id:r,currentSkin:t,currentTheme:i,nextSkin:n,nextTheme:a,progress:s,max:o}}return console.log("getMapCurrentProgress",t,n,s,o),{id:r,currentSkin:t,currentTheme:i,nextSkin:n,nextTheme:a,progress:s,max:o}}static getUnlockedSkins(){return this.getInstance().getUnlockedSkinsInstance()}getUnlockedSkinsInstance(){if(null===this.playerSkinProgress||void 0===this.playerSkinProgress)return console.warn("getUnlockedSkins: playerSkinProgress not found. Have you called init()?"),["cakes"];const e=Object.keys(this.playerSkinProgress),t=[];for(const i of e){const{isLocked:e}=this.playerSkinProgress[i];e||t.push(i)}return console.log("getUnlockedSkins",t),t}static getLevelSkin(e){return this.getInstance().getLevelSkinInstance(e)}getLevelSkinInstance(e){const t=e??1,{mapOrder:i}=this.mapData;let n=0;for(const e of i){if(n+e.levelCount>=t)return console.log("getMapSkin",e.skin),e.skin;n+=e.levelCount}const a=i[i.length-1];return console.log("getMapSkin",a.skin),a.skin}static getLevelTheme(e){return this.getInstance().getLevelThemeInstance(e)}getLevelThemeInstance(e){const t=e??1,{mapOrder:i}=this.mapData;let n=0;for(const e of i){if(n+e.levelCount>=t)return console.log("getMapTheme",e.theme),e.theme;n+=e.levelCount}const a=i[i.length-1];return console.log("getMapTheme",a.theme),a.theme}static getCollectionUnlockProgress(){return this.getInstance().getCollectionUnlockProgressInstance()}getCollectionUnlockProgressInstance(){if(null===this.playerSkinProgress)return console.warn("getCollectionUnlockProgress: playerSkinProgress not found. Have you called init()?"),[ol];const e=[];for(const t of Object.entries(this.playerSkinProgress)){const{currentProgress:i,maxProgress:n,isLocked:a,themeId:s}=t[1];e.push({progress:i,max:n,isLocked:a,skin:t[0],themeId:s})}return e}updatePlayerSkinProgress(){const e=tl.getGameData();if(e?.skins&&Object.keys(e.skins).length>0){this.playerSkinProgress={};for(const t of Object.keys(e.skins))this.playerSkinProgress[t]={...al,...e.skins[t]};return}console.log("getPlayerSkinProgress: playerData not found, use data from level");const t=this.mapData.mapOrder;this.playerSkinProgress={};for(const e of t)this.playerSkinProgress[e.skin]={themeId:e.theme,currentProgress:0,maxProgress:e.levelCount,isLocked:!0};this.updatePlayerSkinProgressByLevel(),console.log(this.playerSkinProgress)}updatePlayerSkinProgressByLevel(){let e=(tl.getGameData()?.level??1)-1;const{mapOrder:t}=this.mapData;this.playerSkinProgress[t[0].skin].isLocked=!1;for(const i of t){const{levelCount:t,skin:n}=i;if(e<=0)continue;const a=e-t>=0?t:e;e-=a,console.log("getPlayerSkinProgressByLevel",n,a),this.increaseProgressInstance(n,a,!1)}}static increaseProgress(e,t,i){this.getInstance().increaseProgressInstance(e,t,i)}increaseProgressInstance(e,t,i){if(null===this.playerSkinProgress)return void console.warn("increaseProgress: playerSkinProgress not found. Have you called init()?");if(!this.playerSkinProgress[e])return void console.warn("increaseProgress: skin not found",e);const{currentProgress:n,maxProgress:a}=this.playerSkinProgress[e],s=n+t>a?a:n+t;if(s>0&&(this.playerSkinProgress[e].isLocked=!1),s===a){const t=this.mapData.mapOrder,i=t[nl.searchIndex(t,(t=>t.skin===e))+1]?.skin;i&&this.unlockSkinInstance(i,!1)}this.playerSkinProgress[e].currentProgress=s,this.playerSkinProgress[e].maxProgress=a,i&&this.syncPlayerSkinProgress()}static unlockSkin(e,t){this.getInstance().unlockSkinInstance(e,t)}unlockSkinInstance(e,t){null!==this.playerSkinProgress?this.playerSkinProgress[e]?(this.playerSkinProgress[e].isLocked=!1,t&&this.syncPlayerSkinProgress()):console.warn("unlockSkin: skin not found",e):console.warn("unlockSkin: playerSkinProgress not found. Have you called init()?")}syncPlayerSkinProgress(){tl.setGameData({skins:this.playerSkinProgress})}}i._RF.pop(),i._RF.push({},"0397cr2IpZEwbRzwQhlVHMO","MatchUtils",void 0);const{match:ll,player:cl,leaderboard:hl,frameCapture:dl}=globalThis.game,{Utils:{Object:ul,Valid:pl,String:ml,Array:gl},Match:{Modes:yl},Dtos:{Match:{Data:bl}}}=GameCore,fl=["Champion","Ultimate","Grand","Elite","Master's","Premier","Epic","Pro's","Supreme","Legendary","Victory","Prime","Titan's","Hero's","Star's"];class wl{static get inst(){return this._instance||(this._instance=new wl),this._instance}static async startMatchAsync(e){try{switch(e??this.getMatchMode()){case yl.SINGLE:await this.inst.processStartSingleModeAsync();break;case yl.TOURNAMENT:await this.inst.processStartTournamentModeAsync();break;case yl.CHALLENGE_FRIEND:await this.inst.processStartChallengeModeAsync();break;default:await this.inst.processStartSingleModeAsync()}}catch(e){console.warn("startMatchAsync",e)}}static async setProfileMatchDataAsync(e){try{await ll.handler.setProfileData(e)}catch(e){console.warn("setProfileMatchDataAsync",e)}}static async setMatchCustomDataAsync(e){try{await ll.handler.setMatchCustomData(e)}catch(e){console.warn("setMatchCustomDataAsync",e)}}static async setLeaderboardScoreAsync(e){try{await ll.handler.setLeaderboardScore(e)}catch(e){console.warn("setLeaderboardScoreAsync",e)}}static async finishMatchAsync(e){try{switch(this.getMatchMode()){case yl.SINGLE:await this.inst.processFinishSingleModeAsync();break;case yl.TOURNAMENT:await this.inst.processFinishTournamentModeAsync();break;case yl.CHALLENGE_FRIEND:await this.inst.processFinishChallengeModeAsync(e);break;default:await this.inst.processFinishSingleModeAsync()}}catch(e){console.warn("finishMatchAsync",e)}}static async joinTournamentAsync(e){const t=cl.getPlayerId();await ll.tournament.join.processAsync({tournamentId:e,playerId:t})}static async continueTournamentAsync(e){const t=cl.getPlayerId();await ll.tournament.continue.processAsync({playerId:t,contextId:e})}async processStartSingleModeAsync(){const e=cl.getPlayerId();await ll.single.start.processAsync({playerId:e})}async processFinishSingleModeAsync(){await ll.single.finish.processAsync()}async processStartTournamentModeAsync(){const e=cl.getPlayerId(),t=GameSDK.context.getID();await ll.tournament.continue.processAsync({playerId:e,contextId:t})}async processFinishTournamentModeAsync(){const e=cl.getPlayerId(),t=cl.getBestScore();await ll.tournament.finish.processAsync({playerId:e,bestScore:t})}async processStartChallengeModeAsync(){try{await this.processContinueChallengeAsync()}catch(e){if(!ul.hasOwn(e,"name")||pl.isString(e.name))throw e;"PlayerHasFinishedMatch"===e.name&&await this.processChallengeNewOpponentAsync(),"PlayerNotJoinInMatch"===e.name&&await this.processJoinChallengeAsync()}}async processFinishChallengeModeAsync(e){dl.addWideframeRender("renderResultChallenge",dl.wideframe.renderResultChallenge),await ll.challenge.finish.processAsync(e)}async processContinueChallengeAsync(){const{id:e,customData:t}=this.getMatchState(),{playerId:i,opponentId:n}=t;if(!pl.isString(e))throw new Error("Invalid match id");if(!pl.isString(i))throw new Error("Invalid player id");if(!pl.isString(n))throw new Error("Invalid opponent id");const a=GameSDK.context.getID();if(!a)throw new Error("Cannot get contextId");await ll.challenge.continue.processAsync({matchId:e,contextId:a,playerId:i,opponentId:n})}async processChallengeNewOpponentAsync(){const e=cl.getConnectedPlayerIds(100,0),t=Math.floor(Math.random()*e.length),i=cl.getPlayerId(),n=e[t];await ll.challenge.friend.processAsync({playerId:i,opponentId:n})}async processJoinChallengeAsync(){const{id:e,customData:t}=this.getMatchState(),{playerId:i,opponentId:n}=t;if(!pl.isString(e))throw new Error("Invalid match id");if(!pl.isString(i))throw new Error("Invalid player id");if(!pl.isString(n))throw new Error("Invalid opponent id");await ll.challenge.join.processAsync({matchId:e,playerId:i,opponentId:n})}getMatchState(){const e=ll.getMatchState();if(!e)throw new Error("Match state not found");return e}static createTournamentName(){const e=`${fl[z.randomRangeInt(0,fl.length-1)]} Tournament`;return`${ml.removeDiacritics(e)}`}static getShortName(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;const i=e.split(" ");let n=0,a="";for(const e of i){if(n+e.length+1>t)break;a+=`${e} `,n+=e.length+1}return a.slice(0,-1)}static createTournamentPayload(){const e=ml.generateObjectId(),t=cl.getPlayerId(),{name:i}=cl.getPlayer(),n=cl.getGameData()?.level??1,a=rl.getLevelTheme(n),s=this.inst.getMatchState(),{profiles:o={}}=s;return{score:o[t]?.score??0,playerId:t,mode:yl.TOURNAMENT,name:this.createTournamentName(),leaderboardId:e,payload:{playerId:t,playerName:i,leaderboardId:e,themeId:a}}}static async getTournamentsAsync(){try{return await GameSDK.tournament.getTournamentsAsync()}catch(e){return console.error(e),[]}}static async processCreateTournamentAsync(){const e=await this.getTournamentsAsync(),t=gl.search(e,(e=>{const t=JSON.parse(e.getPayload()??"{}");return"DEFAULT"===e.getTournamentType()&&t.playerId===cl.getPlayerId()}));if(t)throw new Xr(cl.getPlayerId(),t.getID());const i=this.createTournamentPayload();cl.setGameData({lastCreateTournamentShown:Date.now()}),await ll.tournament.create.processAsync(i);const{leaderboardId:n}=i;hl.addLeaderboard({name:n,type:"tournament",autoSortRank:!0,leaderboardId:n})}static getMatchMode(){const e=this.inst.getMatchState();return pl.isString(e.mode)?e.mode:null}static getMatchCustomData(){const e=this.inst.getMatchState();return pl.isObject(e.customData)?e.customData:null}static async getMatchExtraDataAsync(e){const t=await ll.api.getMatchAPI().getMatchDetailByIdAsync(e);return new bl(t).toObject().extraData}static updateMatchStateAfterLevelFinish(e,t){this.setMatchCustomDataAsync({level:e,score:t});const i=cl.getPlayerId();this.setProfileMatchDataAsync({id:i,score:t})}}try{new wl}catch(e){console.error("MatchUtils",e)}i._RF.pop(),i._RF.push({},"97ca9J9nzNCeIjC1l+ZT/Hm","SceneUtils",void 0);const{event:Sl}=globalThis.game,{Events:vl}=GameCore;class El{static get inst(){return this._instance||(this._instance=new El),this._instance}static switchScene(e,t){Sl.emit(vl.SWITCH_SCENE,{sceneName:e,sceneData:t})}static preloadScene(e){Sl.emit(vl.PRELOAD_SCENE,{sceneName:e})}static preloadDashboardScene(){this.preloadScene(Br)}static switchToDashboardScene(e){this.switchScene(Br,e)}static preloadGameScene(){this.preloadScene(Fr)}static switchToGameScene(e){this.switchScene(Fr,e)}static getSceneData(e){return"data"in e.scene&&e.scene.data||{}}}try{new El}catch(e){console.error("SceneUtils",e)}var Cl,Tl,Al,Rl,Il,Pl,_l;i._RF.pop(),i._RF.push({},"46b8aK6CThLtpMhZPEfDrNs","LoadingFullScreen",void 0);const{ccclass:Ll,property:Dl}=a;let Ol=(Cl=Ll("LoadingFullScreen"),Tl=Dl(X),Al=Dl(h),Cl((Pl=ve((Il=class extends s{constructor(){super(...arguments),e(this,"progressBar",Pl,this),e(this,"loadingText",_l,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}runLoadingTextAnimation(){let e=0;this.schedule((()=>{e=e>2?0:e+1,this.loadingText.string="Loading";for(let t=0;t<e;t++)this.loadingText.string+="."}),.5)}stopLoadingTextAnimation(){this.unscheduleAllCallbacks()}async show(){this.uiOpacity.opacity=0,this.progressBar.progress=0;const e=E(this.uiOpacity).to(.2,{opacity:255},{easing:"cubicOut"}),t=E(this.progressBar).to(8,{progress:.9},{easing:"cubicOut"});this.runLoadingTextAnimation(),vt.runTweenAsync(e),await vt.runTweenAsync(t)}async hide(){if(!this.uiOpacity||!this.progressBar)return;this.uiOpacity.opacity=255,this.progressBar.progress=.9;const e=E(this.uiOpacity).to(.15,{opacity:0},{easing:"cubicIn"}),t=E(this.progressBar).to(.2,{progress:1},{easing:"cubicIn"});this.runLoadingTextAnimation(),await vt.runTweenAsync(t),this.stopLoadingTextAnimation(),await vt.runTweenAsync(e),this.node.active=!1}}).prototype,"progressBar",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_l=ve(Il.prototype,"loadingText",[Al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rl=Il))||Rl);var Nl,Ml,kl,xl,Fl;i._RF.pop(),i._RF.push({},"74caciRBKZLu7ymXYJK2GYy","Loading",void 0);const{ccclass:Bl,property:zl}=a;let Ul=(Nl=Bl("Loading"),Ml=zl(_),Nl((Fl=ve((xl=class extends s{constructor(){super(...arguments),e(this,"loadingPrefab",Fl,this),this.loadingNode=null}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onLoad(){this.makePersistent()}makePersistent(){m.addPersistRootNode(this.node)}createLoadingFullScreen(){const e=P("Canvas");if(!e)return;if(e.getChildByName("Loading"))return;this.loadingNode||(this.loadingNode=c(this.loadingPrefab));const t=c._clone(this.loadingNode);this.loadingFullScreen=t.getComponent(Ol),this.node.active=!1,P("Canvas")?.addChild(t)}async show(){this.createLoadingFullScreen(),this.node.active||(this.node.active=!0,await this.loadingFullScreen.show())}async hide(){this.node?.active&&this.loadingFullScreen&&(await this.loadingFullScreen.hide(),this.node.active=!1)}}).prototype,"loadingPrefab",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kl=xl))||kl);i._RF.pop(),i._RF.push({},"a0dcdDZxhZImZ8Cfg4Dc7SJ","ScreenUtils",void 0);const{event:Gl}=globalThis.game,{Events:Hl,Utils:{Array:Vl}}=GameCore;class ql{constructor(){this.showedScreens=[]}static get inst(){return this._instance||(this._instance=new ql),this._instance}static openScreen(e,t){const i=Hi[e];Gl.emit(Hl.OPEN_SCREEN,{screenName:i,screenData:t})}static closeScreen(e){const t=Hi[e];Gl.emit(Hl.CLOSE_SCREEN,{screenName:t})}static showLoadingScreen(e){this.openScreen(Gi.LOADING_SCREEN,{duration:e})}static closeLoadingScreen(){this.closeScreen(Gi.LOADING_SCREEN)}static showNotificationScreen(e,t){this.openScreen(Gi.NOTIFICATION_SCREEN,{message:e,duration:t})}static closeNotificationScreen(){this.closeScreen(Gi.NOTIFICATION_SCREEN)}static addShowedScene(e){Vl.has(this.inst.showedScreens,e)||this.inst.showedScreens.push(e)}static async showLoadingFullScreen(e){if(Vl.has(this.inst.showedScreens,e))return;this.addShowedScene(e);const t=P("Loading");t&&(t.active=!0,await t.getComponent(Ul).show())}static async hideLoadingFullScreen(e){Vl.has(this.inst.showedScreens,e)||await(P("Loading")?.getComponent(Ul).hide())}static showLoadingNotificationScreen(){this.openScreen(Gi.NOTIFICATION_SCREEN,{message:"Loading",enableCloseOnTouch:!1})}static showTournamentDetailScreen(e,t){this.openScreen(Gi.TOURNAMENT_DETAIL_SCREEN,{tournament:e,tournamentContextType:t})}static closeTournamentDetailScreen(){this.closeScreen(Gi.TOURNAMENT_DETAIL_SCREEN)}}try{new ql}catch(e){console.error("ScreenUtils",e)}i._RF.pop(),i._RF.push({},"d6fb7/+FFxLs7k5w6K38JYb","TournamentUtils",void 0);const{Utils:{String:Wl,Valid:Kl,Array:Yl},Configs:{Mockup:{Leaderboards:jl}}}=GameCore,{leaderboard:Xl,player:$l}=globalThis.game;class Ql{constructor(){this.globalTournamentLBData=[],this.playerTournaments=[],this.tournamentData=[],this.maxTimeRefetch=5e3,this.lastFetchTournamentsData=0,this.lastFetchGlobalTournament=0,this.fetchGlobalTournamentLeaderboardAsync=async()=>{try{Date.now()-this.lastFetchGlobalTournament>this.maxTimeRefetch&&(this.globalTournamentLBData=await Xl.requestLeaderboardsAsync({limit:100,type:"world_tournament_leaderboard"}),this.globalTournamentLBData.sort(((e,t)=>e.expireTime-t.expireTime)))}catch(e){console.warn("fetchGlobalTournamentLeaderboardAsync",e)}return this.globalTournamentLBData},this.fetchTournamentsAsync=async()=>{try{Date.now()-this.lastFetchTournamentsData>this.maxTimeRefetch&&(this.playerTournaments=await GameSDK.tournament.getTournamentsAsync(),this.playerTournaments.sort(((e,t)=>e.getEndTime()-t.getEndTime())))}catch(e){console.warn("fetchTournamentsAsync",e)}return this.playerTournaments}}static getInstance(){return this._instance||(this._instance=new Ql),this._instance}static async requestTournamentDataAsync(){const e=this.getInstance();await Promise.all([e.fetchTournamentsAsync(),e.fetchGlobalTournamentLeaderboardAsync()]);const t=e.processPlayerTournamentData(),i=e.processGlobalTournamentLeaderboardData();return e.tournamentData=[...t,...i],e.tournamentData.sort(((e,t)=>e.endTime-t.endTime)),e.tournamentData.forEach((e=>{const{payload:t}=e,{leaderboardId:i}=t;i&&(Xl.isExistLeaderboardId(i)||Xl.addLeaderboard({type:"tournament",name:i,autoSortRank:!0,leaderboardId:i}))})),e.tournamentData}static getAllTournamentData(){return this.getInstance().tournamentData}static getTournamentDataById(e){const t=this.getInstance();return Yl.search(t.tournamentData,(t=>t.id===e))}static getPlayerTournamentData(){const e=this.getInstance(),t=$l.getPlayerId();return e.tournamentData.filter((e=>{const{payload:i}=e;return i.playerId===t}))}static getFriendsTournamentData(){const e=this.getInstance(),t=$l.getPlayerId();return e.tournamentData.filter((e=>{const{payload:i}=e;return i.playerId!==t&&"global"!==i.playerId}))}static getGlobalTournamentData(){return this.getInstance().tournamentData.filter((e=>{const{payload:t}=e;return"global"===t.playerId}))}static validateTournamentExpired(e){const t=this.getTournamentDataById(e);if(!t)return!1;const{endTime:i}=t;return i<Date.now()/1e3}processPlayerTournamentData(){const e=[];for(const t of this.playerTournaments){const i=`${t.getID()}`,n=t.getContextID(),a=t.getEndTime(),s=this.parseTournamentPayload(t.getPayload());if(!this.validateGameSDKTournamentPayload(s))continue;if(a<Date.now()/1e3)continue;if("PAGE_HOSTED"===t.getTournamentType())continue;const o=s.playerName??"Player",r={id:i,title:t.getTitle()??this.createDefaultTournamentName(o),endTime:a,contextId:n,payload:s};e.push(r)}return e}processGlobalTournamentLeaderboardData(){const e=[],{Enabled:t}=jl;if(t){for(let t=0;t<this.playerTournaments.length;t++){const i=this.playerTournaments[t],n=i.getTournamentType();if("PAGE_HOSTED"!==n)continue;const a=`${i.getID()}`,s=i.getContextID(),o=i.getEndTime(),r=this.parseTournamentPayload(i.getPayload()),l={id:a,title:i.getTitle()??"Global Tournament",endTime:o,contextId:s,payload:r,tournamentType:n};e.push(l)}return e}for(let t=0;t<this.globalTournamentLBData.length;t++){let i={tournamentId:"",contextId:""};const n=this.globalTournamentLBData[t];try{i=JSON.parse(n.description)}catch(e){continue}if(!this.validateExpireTime(n))continue;if(!this.validateGlobalTournamentPayload(i))continue;const a={id:i.tournamentId,title:n.name,endTime:this.getTournamentEndTime(n),contextId:i.contextId,payload:{playerId:"global",playerName:"global",leaderboardId:n._id,themeId:i.themeId??el.SUMMER}};e.push(a)}return e}validateGlobalTournamentPayload(e){const{tournamentId:t,contextId:i}=e;return!(!Kl.isString(t)||""===t)&&!(!Kl.isString(i)||""===i)}getTournamentEndTime(e){const t=new Date(e.createdAt).getTime();return Math.round((1e3*e.expireTime+t)/1e3)}validateExpireTime(e){return 1e3*this.getTournamentEndTime(e)-Date.now()>0}validateGameSDKTournamentPayload(e){return!(!Kl.isString(e.playerId)||""===e.playerId)&&(!(!Kl.isString(e.playerName)||""===e.playerName)&&!(!Kl.isString(e.leaderboardId)||""===e.leaderboardId))}createDefaultTournamentName(e){const t=e.substring(0,7),i=`${t.split(" ")[0]||t}'s Tournament`;return`${Wl.removeDiacritics(i)}`}parseTournamentPayload(e){if("string"!=typeof e)return{};try{return JSON.parse(e)}catch(e){return{}}}}i._RF.pop(),i._RF.push({},"d90c4WisP9LybAFqNuS6imZ","FailKeys",void 0);const Jl="time",Zl="bomb";var ec;i._RF.pop(),i._RF.push({},"44b50YkamZDD5fO9vdZKeG7","InputController",void 0);const{ccclass:tc}=a;let ic=tc("InputController")(ec=class extends s{constructor(){super(...arguments),this.handleElementPointerDown=()=>{},this.handleElementPointerUp=e=>{}}onLoad(){this.listenInputEvents()}listenInputEvents(){Y.os!==Y.OS.WINDOWS&&Y.os!==Y.OS.OSX||(document.addEventListener("pointerup",this.handleElementPointerUp),document.addEventListener("pointerdown",this.handleElementPointerDown))}onDestroy(){Y.os!==Y.OS.WINDOWS&&Y.os!==Y.OS.OSX||(document.removeEventListener("pointerup",this.handleElementPointerUp),document.removeEventListener("pointerdown",this.handleElementPointerDown))}})||ec;i._RF.pop(),i._RF.push({},"7f144HjLfBLWbFvbRFCCt8e","Directions",void 0);const nc={Up:{x:0,y:1},Down:{x:0,y:-1},Left:{x:-1,y:0},Right:{x:1,y:0}};i._RF.pop(),i._RF.push({},"361eckT3VBO5ZFyetePNmNY","LevelGravity",void 0);const ac="fall-down",sc="fly-up",oc="push-left",rc="push-right",lc="put-column-middle",cc="put-row-middle";function hc(e){const{array:t,isLighter:i,out:n=new Set}=e;for(let e=0;e<t.length;e++)if(i(t.get(e)))for(let a=e+1;a<t.length;a++)if(!i(t.get(a))){t.swap(e,a),n.add(t.get(e));break}return n}i._RF.pop(),i._RF.push({},"cf506DevntPeIl9QrpMEBY0","Grid",void 0);class dc{constructor(e){this.array=[];const{width:t=1,height:i=1}=e??{},n=e instanceof dc?e.array:e?.content??[];if(n.length!==t*i)throw new Error("Invalid content length");this.width=t,this.height=i,this.array=[...n]}asArray(){return this.array}get(e,t){return this.array[t*this.width+e]}set(e,t,i){this.array[t*this.width+e]=i}isInBounds(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height}forEach(e){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)e(this.get(i,t),i,t)}map(e){const t=[];for(let i=0;i<this.height;i++)for(let n=0;n<this.width;n++)t.push(e(this.get(n,i),n,i));return t}reduce(e,t){let i=t;for(let t=0;t<this.height;t++)for(let n=0;n<this.width;n++)i=e(i,this.get(n,t),n,t);return i}swap(e,t){const[i,n]=e,[a,s]=t,o=this.get(i,n);this.set(i,n,this.get(a,s)),this.set(a,s,o)}shuffle(e){e=e??this.map(((e,t,i)=>[t,i]));const t=[...e],i=new Set;for(let e=t.length-1;e>0;e--){const n=ee(0,e+1);[t[e],t[n]]=[t[n],t[e]],i.add(this.get(t[e][0],t[e][1])),i.add(this.get(t[n][0],t[n][1]))}for(let i=0;i<t.length;i++){const[n,a]=e[i],[s,o]=t[i];this.swap([n,a],[s,o])}return i}toShuffled(e){const t=new dc({width:this.width,height:this.height,content:this.array}),i=t.shuffle(e);return[t,i]}gravitate(e){const{rowRange:[t,i],colRange:[n,a],direction:s,isLighter:o,onSwap:r,out:l=new Set}=e,c=a-n+1,h=i-t+1;switch(s){case nc.Up:for(let e=n;e<=a;e++)hc({array:{length:h,get:t=>this.get(e,i-t),swap:(t,n)=>{const a=this.get(e,i-t),s=this.get(e,i-n);this.swap([e,i-t],[e,i-n]),r?.(a,s)}},isLighter:o,out:l});return l;case nc.Down:for(let e=n;e<=a;e++)hc({array:{length:h,get:i=>this.get(e,t+i),swap:(i,n)=>{const a=this.get(e,t+i),s=this.get(e,t+n);this.swap([e,t+i],[e,t+n]),r?.(a,s)}},isLighter:o,out:l});return l;case nc.Left:for(let e=t;e<=i;e++)hc({array:{length:c,get:t=>this.get(n+t,e),swap:(t,i)=>{const a=this.get(n+t,e),s=this.get(n+i,e);this.swap([n+t,e],[n+i,e]),r?.(a,s)}},isLighter:o,out:l});return l;case nc.Right:for(let e=t;e<=i;e++)hc({array:{length:c,get:t=>this.get(a-t,e),swap:(t,i)=>{const n=this.get(a-t,e),s=this.get(a-i,e);this.swap([a-t,e],[a-i,e]),r?.(n,s)}},isLighter:o,out:l});return l;default:throw new Error("Invalid direction")}}toGravitated(){const e=new dc({width:this.width,height:this.height,content:this.array}),t=e.gravitate(...arguments);return[e,t]}toRotated(){const e=new dc({width:this.height,height:this.width,content:new Array(this.width*this.height)});for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)e.set(this.height-1-t,i,this.get(i,t));return e}}i._RF.pop(),i._RF.push({},"4046cPYak1BDIVFKksVPsnk","index",void 0),i._RF.pop(),i._RF.push({},"c517dy1TKlPd7mHxulLPv1G","TileSpecialTypes",void 0);const uc={bomb:"bomb",star:"star",none:"none"};var pc,mc,gc,yc,bc,fc,wc,Sc,vc,Ec,Cc,Tc,Ac,Rc,Ic,Pc,_c,Lc,Dc,Oc,Nc,Mc,kc,xc,Fc;i._RF.pop(),i._RF.push({},"ea140gA27tJa4LD9MT3t93/","Tile",void 0);const{ccclass:Bc,property:zc,requireComponent:Uc}=a;let Gc=(pc=Bc("Tile"),mc=Uc([l]),gc=Uc([x]),yc=zc(R),bc=zc(R),fc=zc(R),wc=zc(n),Sc=zc({type:l,displayName:"Background's UI Transform"}),vc=zc({type:x,displayName:"This UI Opacity"}),Ec=zc(x),Cc=zc(x),Tc=zc(xn),Ac=zc(y),pc(Rc=mc(Rc=gc((Pc=ve((Ic=class t extends s{constructor(){super(...arguments),e(this,"icon",Pc,this),e(this,"bombComponent",_c,this),e(this,"starComponent",Lc,this),e(this,"background",Dc,this),e(this,"bgUITransform",Oc,this),e(this,"uiOpacity",Nc,this),e(this,"shineOpacity",Mc,this),e(this,"glowOpacity",kc,this),e(this,"button",xc,this),e(this,"animationComponent",Fc,this),this.id=null,this.isEmpty=!1,this.coord=new Q,this.restoreSignal=new si}onLoad(){Fe.lazyValidateProperties(this),this.special=this.createSpecialHandler(uc.none)}update(e){this.special?.type===uc.bomb&&this.special.update(e)}onDestroy(){this.special?.type===uc.bomb&&this.special?.onDestroy()}setIgnoreInput(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.button.interactable=!e}getCoord(){return this.coord}setCoord(e,t){this.coord.set(e,t)}isSimilarTo(e){return this.id===e.id}inSamePositionAs(e,i){return e instanceof t?this.coord.equals(e.getCoord()):this.coord.x===e&&this.coord.y===i}isHidden(){return this.isEmpty}getSize(){return[this.bgUITransform.width,this.bgUITransform.height]}onClick(){this.isHidden()||this.node.scene.emit(Ga.TILE_CLICK,this)}setIdentity(e){this.id=e,this.icon.spriteFrame=e;const[t,i]=this.getSize(),{width:n,height:a}=e.originalSize,s=Math.max(n/(.7*t),a/(.7*i));s>1&&this.icon.node.setScale(new j(1/s,1/s,1))}setSpecialType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:uc.none,t=arguments.length>1?arguments[1]:void 0;this.special?.switch(e,t)}async setFocused(e){const t=E(this.shineOpacity).to(.2,{opacity:e?255:0},{easing:"quadIn"});this.shineOpacity.node.scale=e?j.ZERO:j.ONE;const i=E(this.shineOpacity.node).to(.2,{scale:e?j.ONE:j.ZERO},{easing:"quadOut"});if(e){const e=E(this.glowOpacity).to(2,{opacity:150});e.to(2,{opacity:20}),this.glowOpacityTween=E(this.glowOpacity).repeatForever(e).start()}else this.glowOpacityTween&&this.glowOpacityTween.stop(),this.glowOpacity.opacity=0;await Promise.all([vt.runTweenAsync(t),vt.runTweenAsync(i)])}setEmpty(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.isEmpty){if(this.restoreSignal.abort(),this.isEmpty=!0,this.setIgnoreInput(!0),this.button.resetButtonState(),e)return this.uiOpacity.opacity=0,void this.special?.switch(uc.none);this.special?.type===uc.star&&this.special.clear(),this.special?.switch(uc.none),this.uiOpacity.opacity=0}}async setHint(e){if(e)await this.loadShakeClip(),this.shakeClip&&this.runAnimation(this.shakeClip.name);else{this.animationComponent.stop();const e=E(this.background).to(.1,{scale:j.ONE,eulerAngles:j.ZERO});await vt.runTweenAsync(e)}}async playClearFX(e){let t=null;"clear"===e?(await this.loadClearClip(),t=this.clearClip):(await this.loadBreakClip(),t=this.breakClip),null!==t&&await this.runAnimation(t.name)}async restore(e){this.restoreSignal.abort(),this.restoreSignal=new si,this.isEmpty=!1,this.setIgnoreInput(!0),e&&this.setIdentity(e),this.uiOpacity.opacity=255,this.node.setScale(j.ZERO),this.button.fakeClick(),await vt.runTweenAsync(E(this.node).to(.3,{scale:j.ONE},{easing:"backOut"}),this.restoreSignal),this.node.setScale(j.ONE),this.setIgnoreInput(!1)}async sync(e){const{duration:t=.3,delay:i=0,easing:n="cubicOut",getTargetPosition:a}=e,s=a(this.coord),o=new j(s.x,s.y,this.node.position.z);await vt.runTweenAsync(E(this.node).delay(i).to(t,{position:o},{easing:n}))}async fly(e){const t=300,i=Math.sqrt(this.node.position.x**2+this.node.position.y**2),n=Math.max(t-.7*i,0),a=i/1e3,s=this.node.position.clone(),o=e.getTilePosition(this.coord),r=new j(o.x,o.y,this.node.position.z),l=this.background;let c=2;let h=1,d=360;const u=.0025*n;let p=0;const m=new j(0,0,0),g=.75-u,y={value:0,prevElapsed:0},b=E(y);return b.delay(a),b.to(.5,{value:0},{progress:(e,t,i,n)=>{c*=-1;const a=c*n,o=s.clone();return o.x+=a,this.node.setPosition(o),i}}),b.to(u,{value:1},{progress:(e,i,a,s)=>{const o=vt.easeOutExpo(s),r=u*s-y.prevElapsed,c=u*s,p=n*o;this.setHeight(p,t);const m=this.node.position.clone();h+=.1,j.rotateZ(m,m,new j(0,0,0),h*Math.PI*r),this.node.setPosition(new j(m.x,m.y,m.z)),d+=10;const g=d*r;return l.angle+=g,y.prevElapsed=c,a}}),b.call((()=>{m.set((this.node.position.x+r.x)/2,(this.node.position.y+r.y)/2,0),y.prevElapsed=0,l.angle%=360,l.angle-=360,p=l.angle})),b.to(g,{value:0},{progress:(e,i,a,s)=>{const o=g*s-y.prevElapsed,r=g*s,c=n*(1-s);this.setHeight(c,t);const h=this.node.position.clone();return j.rotateZ(h,h,m,Math.PI/g*o),this.node.setPosition(new j(h.x,h.y,h.z)),l.angle+=-p/g*o,y.prevElapsed=r,a}}),b.call((()=>{this.node.setPosition(r),this.setHeight(0,t),l.angle=0})),vt.runTweenAsync(b)}async loadBreakClip(){if(this.breakClip)return Promise.resolve();const e=await ci.loadAnimClipAsync(oi.TILE_BREAK_ANIM);if(!e)return Promise.resolve();this.breakClip=e,this.animationComponent.addClip(this.breakClip)}async loadClearClip(){if(this.clearClip)return Promise.resolve();const e=await ci.loadAnimClipAsync(oi.TILE_CLEAR_ANIM);if(!e)return Promise.resolve();this.clearClip=e,this.animationComponent.addClip(this.clearClip)}async loadShakeClip(){if(this.shakeClip)return Promise.resolve();const e=await ci.loadAnimClipAsync(oi.TILE_SHAKE_ANIM);if(!e)return Promise.resolve();this.shakeClip=e,this.animationComponent.addClip(this.shakeClip)}runAnimation(e){return this.animationComponent.play(e),new Promise((e=>{this.animationComponent.once(y.EventType.FINISHED,(()=>{e()}))}))}setHeight(e,t){const i=this.background;i.setPosition(new j(i.position.x,e,0)),i.setScale(new j(1+e/t*.3,1+e/t*.3,1))}createSpecialHandler(e,t){switch(e){case uc.bomb:return this.createBombHandler(t??90);case uc.star:return this.createStarHandler();default:return{type:uc.none,switch:(e,t)=>{this.special=this.createSpecialHandler(e,t)}}}}createBombHandler(e){let t=!1,i=e;const n=()=>{t=!0},a=()=>{t=!1};this.node.scene.on(Ga.TILE_CLICK,n),this.node.scene.on(Ga.USE_ITEM,n),this.node.scene.on(Ga.RESUME_TIME,n),this.node.scene.on(Ga.PAUSE_TIME,a),this.node.scene.on(Ga.TIME_OUT,a),this.bombComponent.node.active=!0;const s=()=>{t=!1,this.bombComponent.node.active=!1,this.node.scene.emit(Ga.BOMB_EXPLODE,this),this.setEmpty()},o=()=>{t=!1,this.bombComponent.node.active=!1,i=e,this.node.scene.off(Ga.TILE_CLICK,n),this.node.scene.off(Ga.USE_ITEM,n),this.node.scene.off(Ga.GAME_RESUME,n),this.node.scene.off(Ga.GAME_PAUSE,a),this.node.scene.off(Ga.TIME_OUT,a)};return{type:uc.bomb,update:n=>{t&&(i-=n,this.bombComponent.fillRange=-i/e,i<=0&&s())},cleanup:o,onDestroy:()=>{this.node.scene.off(Ga.TILE_CLICK,n),this.node.scene.off(Ga.USE_ITEM,n),this.node.scene.off(Ga.GAME_RESUME,n),this.node.scene.off(Ga.GAME_PAUSE,a),this.node.scene.off(Ga.TIME_OUT,a)},switch:(e,t)=>{o(),this.special=this.createSpecialHandler(e,t)},detonateImmediately:()=>{i=0}}}createStarHandler(){this.starComponent.node.active=!0;const e=()=>{this.starComponent.node.active=!1};return{type:uc.star,clear:()=>{this.starComponent.node.active=!1;const{x:e,y:t}=this.node.worldPosition;this.node.scene.emit(Ga.ADD_STARS,{startAnimationAt:[e,t]})},cleanup:e,switch:t=>{e(),this.special=this.createSpecialHandler(t)}}}}).prototype,"icon",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_c=ve(Ic.prototype,"bombComponent",[bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lc=ve(Ic.prototype,"starComponent",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dc=ve(Ic.prototype,"background",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oc=ve(Ic.prototype,"bgUITransform",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nc=ve(Ic.prototype,"uiOpacity",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mc=ve(Ic.prototype,"shineOpacity",[Ec],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kc=ve(Ic.prototype,"glowOpacity",[Cc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xc=ve(Ic.prototype,"button",[Tc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fc=ve(Ic.prototype,"animationComponent",[Ac],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rc=Ic))||Rc)||Rc)||Rc);function Hc(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const{x:a,y:s}=i,[o,r]=t;let l=o*(a-(e.width-1)/2)+n*(a-e.width/2),c=r*(s-(e.height-1)/2)+n*(s-e.height/2);return-1===a&&(l+=t[0]/4),a===e.width&&(l-=t[0]/4),-1===s&&(c+=t[1]/4),s===e.height&&(c-=t[1]/4),{x:l,y:c}}function Vc(e){switch(e){case ac:return rc;case sc:return oc;case oc:return ac;case rc:return sc;case lc:return cc;case cc:return lc}}function qc(e){return(e instanceof dc?e.asArray():e).filter((e=>!e.isHidden()))}function Wc(e){return(e instanceof dc?e.asArray():e).filter((e=>e.isHidden()))}i._RF.pop(),i._RF.push({},"d6995j9hvVJYKs6vvV+rs1I","index",void 0),i._RF.pop(),i._RF.push({},"cb8ddC2w59DpqVoQENbYYcU","calcBoardScale",void 0),i._RF.pop(),i._RF.push({},"305c7LJx+ROLI4g8tTiAFyb","calcTilePosition",void 0),i._RF.pop(),i._RF.push({},"c522ca1UPhDYaToWf66t1X2","calcTileSize",void 0),i._RF.pop(),i._RF.push({},"37667B66RZBc5chlMqN6mH8","parseLevelGravity",void 0),i._RF.pop(),i._RF.push({},"f0f0bXgdxJHIJWOmA6n0Ood","getUncleared",void 0),i._RF.pop(),i._RF.push({},"a90bcq22hlMzbYdivjPpm0h","getBombTiles",void 0),i._RF.pop(),i._RF.push({},"92e23drVfRIgbDVZLTSdEkI","getCleared",void 0),i._RF.pop(),i._RF.push({},"7105bfR+Y5F1a0SDiMXZ9mV","getNearbyTiles",void 0);const{Utils:{Object:Kc}}=GameCore;function Yc(e,t){const{x:i,y:n}=t.getCoord();return Kc.vals(nc).reduce(((t,a)=>{let{x:s,y:o}=a;const[r,l]=[i+s,n+o];return e.isInBounds(r,l)&&t.push(e.get(r,l)),t}),[])}function jc(e){return Array.isArray(e)}function Xc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();const i=jc(e)?e:e.asArray();return i[te(t,0,i.length)]}i._RF.pop(),i._RF.push({},"d1b9bBg+dBA+7n/Sz+RCIAX","getRandomTile",void 0),i._RF.pop(),i._RF.push({},"c4bf3uyS1pEdrTrwDEXeuZP","getRandomPair",void 0);const{Array:$c}=GameCore.Utils;function Qc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();const i=e instanceof dc?e.asArray():e,n=Xc(i,t),a=$c.search(i,(e=>e.isSimilarTo(n)&&!e.inSamePositionAs(n)));if(void 0===a)throw new Error("Could not find a matching tile");return[n,a]}i._RF.pop(),i._RF.push({},"cf8d6gfx2ZIsqm978cNLWaV","pseudoRandomIterable",void 0);const Jc=e=>e;function Zc(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Jc;return function*(){let n=t;e<=0&&(e=1/0);for(let t=0;t<e;t++)yield i(n),n=1e9*ie(n)}()}function eh(e){return Array.isArray(e)}function th(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();const n=eh(e)?e:e.asArray();if(n.length<t)return new Set(n);const a=new Set,s=Zc(-1,i);let o=s.next();for(;a.size<t;){if(o.done)throw new Error("RNG exhausted");a.add(Xc(n,o.value)),o=s.next()}return a}i._RF.pop(),i._RF.push({},"718b6Wu0pdGVK5KYSUDctVX","getRandomTiles",void 0),i._RF.pop(),i._RF.push({},"17ccarKybRNwYcZnBQhCUYy","index",void 0),i._RF.pop(),i._RF.push({},"bab6dqrPz9AaaBN5cy+QzPj","assignSpecialTiles",void 0);const ih=[1,4];function nh(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();const{specials:n}=t,a=n.bomb,s=te(i,...ih),o=th(e,a,i),r=e.asArray().filter((e=>!o.has(e))),l=th(r,s,i);o.forEach((e=>{const i=2*t.time/3;e.setSpecialType(uc.bomb,i)})),l.forEach((e=>e.setSpecialType(uc.star)))}i._RF.pop(),i._RF.push({},"228efPdzUNCMp4yYcBs9r+3","index",void 0),i._RF.pop(),i._RF.push({},"09be7lmGLNMvIObiqskePhz","createGrid",void 0);const{Utils:{Array:ah}}=GameCore;function sh(e){const{levelData:{columns:t,rows:i},identities:n,createTile:a,seed:s=Date.now()}=e,o=function(e,t,i){const n=[],a=t/2,s=e=>te(e,0,i.length);for(const t of Zc(a,e,s))n.push(i[t]),n.push(i[t]);return ah.shuffle(n),n}(s,t*i,n).map((e=>{const t=a(e);return t.setIdentity(e),t}));return new dc({width:t,height:i,content:o})}i._RF.pop(),i._RF.push({},"5d998xlab9FLIpvw+sXMIYw","createGridFromFen",void 0);const{Array:oh}=GameCore.Utils;function rh(e,t){const i=oh.search(Object.entries(t),(t=>{let[i,n]=t;return n===e}));if(void 0===i)throw new Error(`Invalid special type ${e}`);return i[0]}i._RF.pop(),i._RF.push({},"30de5d+cW5OjKyEubKVREbU","createRotatedGrid",void 0),i._RF.pop(),i._RF.push({},"9ceb6vNbn9PKozkdGjjZD67","ensureOneMatch",void 0);const{Array:lh}=GameCore.Utils;function ch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();const i=e.asArray(),n=Xc(e,t),a=Yc(e,n);if(a.some((e=>e.isSimilarTo(n))))return;const s=Xc(a,t),o=lh.search(i,(e=>!e.inSamePositionAs(n)&&!e.inSamePositionAs(s)&&e.isSimilarTo(s)));o.setIdentity(n.id),s.setIdentity(n.id)}i._RF.pop(),i._RF.push({},"89318H0TDxMlJsVFwuKgrh3","index",void 0),i._RF.pop(),i._RF.push({},"fb4a9VOCxBBvpXFCcSt4P3J","NewbieSteps",void 0);var hh=[{startTile:{x:0,y:1},endTile:{x:3,y:1},description:"Tap to connect"},{startTile:{x:2,y:2},endTile:{x:3,y:0},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:0},endTile:{x:3,y:3},description:"Connect similar tiles with less than 2 turns"},{startTile:{x:0,y:4},endTile:{x:2,y:3},description:"More than 2 turns are NOT allowed"},{startTile:{x:1,y:4},endTile:{x:1,y:2},description:"There's obstacle between the tiles"}];i._RF.pop(),i._RF.push({},"627d5N3oStP8q9+ABNqnHBq","getBestPath",void 0);const{Array:dh}=GameCore.Utils;function uh(e,t){return e[0]===t[0]&&e[1]===t[1]}function ph(e){return new Q(e[0],e[1])}function mh(e,t){return e.x>=-1&&e.x<t.width+1&&e.y>=-1&&e.y<t.height+1}function gh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yh;return t.map((t=>[e.tile[0]+t.x,e.tile[1]+t.y]))}const yh=[nc.Up,nc.Down,nc.Left,nc.Right];class bh{constructor(e,t){if(this.f=0,this.g=0,this.h=0,t&&uh(e,t.tile))throw new Error("Tile cannot be its own parent");this.tile=e,this.parent=t;const i=bh.calcDirection(this),n=t&&i&&t.cache.direction&&!i.equals(t.cache.direction)?1:0;this.cache={direction:i,turns:n+(t?.cache.turns??0)}}static calcDirection(e){if(e.parent){const t=e.parent.tile,i=e.tile;return new Q(i[0]-t[0],i[1]-t[1])}return null}getKey(){return`x:${this.tile[0]},y:${this.tile[1]},d:${this.cache.direction?.toString()}`}equals(e){return this.getKey()===e.getKey()}}function fh(e,t){const i=e.tile,n=t.tile;return Math.abs(i[0]-n[0])+Math.abs(i[1]-n[1])}function wh(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const n=[];for(const a of yh){const s={x:t[0]+a.x,y:t[1]+a.y};if(e.isInBounds(s.x,s.y)){(e.get(s.x,s.y).isHidden()||dh.search(i,(e=>uh(e,[s.x,s.y]))))&&n.push(a)}else mh(s,e)&&n.push(a)}return n}function Sh(e,t,i,n){if(n){const e=hh[4].startTile,n=hh[4].endTile;if(t[0]===e.x&&t[1]===e.y&&i[0]===n.x&&i[1]===n.y)return[{a:e,b:n}];if(t[0]===n.x&&t[1]===n.y&&i[0]===e.x&&i[1]===e.y)return[{a:e,b:n}]}return function(e,t,i){const n=[],a=[],s=new bh(t,null),o=new bh(i,null),r=[o.tile];for(n.push(s);n.length>0;){const t=n.shift();if(a.push(t),uh(t.tile,o.tile)){const e=[];let i=t,n=t,a=t.parent;for(;a;)a.cache.turns!==n.cache.turns&&(e.unshift({a:ph(a.tile),b:ph(i.tile)}),i=a),n=a,a=a.parent;return e.unshift({a:ph(n.tile),b:ph(i.tile)}),e}const i=gh(t,wh(e,t.tile,r));for(const e of i){const i=new bh(e,t);if(i.cache.turns>8)continue;const s=uh(i.tile,o.tile),r=a.some((e=>e.equals(i)));n.some((e=>e.equals(i)))||r&&!s||(i.g=t.g+1+i.cache.turns,i.h=fh(i,o),i.f=i.g+i.h,n.push(i))}n.sort(((e,t)=>e.f-t.f))}const l=s.tile,c=o.tile;return l[0]===c[0]||l[1]===c[1]?[{a:ph(l),b:ph(c)}]:[{a:ph(l),b:{x:l[0],y:c[1]}},{a:{x:l[0],y:c[1]},b:ph(c)}]}(e,t,i)}i._RF.pop(),i._RF.push({},"b622ea7Aw5LT5yfRAx8qSap","getErrorPath",void 0),i._RF.pop(),i._RF.push({},"716f6/ILpZCPp1nebbdk8Oj","getGridFen",void 0);const vh={[uc.bomb]:"b",[uc.star]:"s",[uc.none]:"t"};function Eh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vh;const{width:i,height:n}=e,a=[],s=new Map;for(let o=n-1;o>=0;o--){const n=[];for(let a=0;a<i;a++){const i=e.get(a,o),r=i.isHidden()?null:i.id;if(null===r){n.push(".");continue}const l=t[i.special?.type??uc.none];if(!s.has(r)){const e=s.size.toString();s.set(r,e)}const c=`${l}${s.get(r)}`;n.push(c)}a.push(n.join(""))}return{code:a.join(":"),idSize:s.size,encoding:t,rows:n,cols:i}}function Ch(e){return e.reduce(((e,t,i,n)=>(t.inSamePositionAs(i,n)||e.push([t,[i,n]]),e)),[])}function*Th(e,t){let i=0,n=e-1,a=0,s=t-1;for(;i<=n&&a<=s;){for(let e=i;e<=n;e++)yield{x:e,y:a};a++;for(let e=a;e<=s;e++)yield{x:n,y:e};n--;for(let e=n;e>=i;e--)yield{x:e,y:s};s--;for(let e=s;e>=a;e--)yield{x:i,y:e};i++}}i._RF.pop(),i._RF.push({},"badfeEqwgFEorJVHO9tJSXZ","getOutOfSync",void 0),i._RF.pop(),i._RF.push({},"cd0d548/WxD7KCyW2hwySVO","traverseSpiralIn",void 0),i._RF.pop(),i._RF.push({},"373ceVkYCtMTrQObvzJgg7s","getValidPath",void 0);const{Array:Ah}=GameCore.Utils;class Rh{constructor(e,t){this.coord=new Q(e,t)}isHidden(){return!0}isSimilarTo(){return!1}}function Ih(e){return new Q(e[0],e[1])}function Ph(e,t,i){if(void 0===t||void 0===i)return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Th;const i=[];for(const n of t(e.width,e.height)){const t=e.get(n.x,n.y);t.isHidden()||i.push([t,[n.x,n.y]])}const n=[];for(;i.length>0;){const[t,a]=i.shift();if(!Ah.search(n,(e=>Dh(e,a)))){n.push(a);for(const[s,o]of i){if(!s.isSimilarTo(t)||Ah.search(n,(e=>Dh(e,o))))continue;const i=Ph(e,a,o);if(null!==i)return i}}}return null}(e);const n=[t[0]+1,t[1]+1],a=[i[0]+1,i[1]+1],s=function(e){const t=Ah.fillWith(e.width+2,(e=>new Rh(e-1,-1))),i=Ah.fillWith(e.width+2,(t=>new Rh(t-1,e.height))),n=Ah.fillWith(e.height,(e=>new Rh(-1,e))),a=Ah.fillWith(e.height,(t=>new Rh(e.width,t))),s=(s,o)=>{const r=s-1,l=o-1;return-1===r?n[l]:r===e.width?a[l]:-1===l?t[r]:l===e.height?i[r]:e.get(r,l)};return{get:(e,t)=>s(e,t),width:e.width+2,height:e.height+2}}(e),o=[n,a];if(n[0]===a[0]&&Nh(s,o,n[1],a[1],n[0])||n[1]===a[1]&&Mh(s,o,n[0],a[0],n[1]))return Fh([{a:Ih(n),b:Ih(a)}],{x:-1,y:-1});let r;const l=n[1]<=a[1]?n:a,c=n[1]<=a[1]?a:n,h=n[0]<=a[0]?n:a,d=n[0]<=a[0]?a:n;let u=[],p=[];return-1===(r=kh(s,o,1,Ih(l),Ih(c)))&&-1===(r=kh(s,o,-1,Ih(l),Ih(c)))||(u=[{a:Ih(n),b:{x:n[0],y:r}},{a:{x:n[0],y:r},b:{x:a[0],y:r}},{a:{x:a[0],y:r},b:Ih(a)}]),-1===(r=xh(s,o,1,Ih(h),Ih(d)))&&-1===(r=xh(s,o,-1,Ih(h),Ih(d)))||(u=[{a:Ih(n),b:{x:r,y:n[1]}},{a:{x:r,y:n[1]},b:{x:r,y:a[1]}},{a:{x:r,y:a[1]},b:Ih(a)}]),-1!==(r=function(e,t,i,n){for(let a=i.y+1;a<n.y;a++)if(Nh(e,t,i.y,a,i.x)&&Mh(e,t,i.x,n.x,a)&&Nh(e,t,a,n.y,n.x))return a;return-1}(s,o,Ih(l),Ih(c)))?p=[{a:Ih(n),b:{x:n[0],y:r}},{a:{x:n[0],y:r},b:{x:a[0],y:r}},{a:{x:a[0],y:r},b:Ih(a)}]:-1!==(r=function(e,t,i,n){for(let a=i.x+1;a<n.x;a++)if(Mh(e,t,i.x,a,i.y)&&Nh(e,t,i.y,n.y,a)&&Mh(e,t,a,n.x,n.y))return a;return-1}(s,o,Ih(h),Ih(d)))&&(p=[{a:Ih(n),b:{x:r,y:n[1]}},{a:{x:r,y:n[1]},b:{x:r,y:a[1]}},{a:{x:r,y:a[1]},b:Ih(a)}]),u.length>0&&p.length>0?Fh(_h(u)<=_h(p)?u:p,{x:-1,y:-1}):u.length>0?Fh(u,{x:-1,y:-1}):p.length>0?Fh(p,{x:-1,y:-1}):null}function _h(e){let t=0;for(const i of e)t+=Lh(i);return t}function Lh(e){return e.a.x===e.b.x?Math.abs(e.a.y-e.b.y):e.a.y===e.b.y?Math.abs(e.a.x-e.b.x):0}function Dh(e,t){return e[0]===t[0]&&e[1]===t[1]}function Oh(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const n=e.get(...t);return n.isHidden()||i.some((e=>Dh(e,t)))}function Nh(e,t,i,n,a){const s=Math.min(i,n),o=Math.max(i,n);for(let i=s;i<=o;i++)if(!Oh(e,[a,i],t))return!1;return!0}function Mh(e,t,i,n,a){const s=Math.min(i,n),o=Math.max(i,n);for(let i=s;i<=o;i++)if(!Oh(e,[i,a],t))return!1;return!0}function kh(e,t,i,n,a){let s=1===i?a.y:n.y;const o=1===i?n.x:a.x;if(Nh(e,t,n.y,a.y,o))for(;s>=0&&s<e.height&&Oh(e,[n.x,s],t)&&Oh(e,[a.x,s],t);){if(Mh(e,t,n.x,a.x,s))return s;s+=i}return-1}function xh(e,t,i,n,a){let s=1===i?a.x:n.x;const o=1===i?n.y:a.y;if(Mh(e,t,n.x,a.x,o))for(;s>=0&&s<e.width&&Oh(e,[s,n.y],t)&&Oh(e,[s,a.y],t);){if(Nh(e,t,n.y,a.y,s))return s;s+=i}return-1}function Fh(e,t){return e.map((e=>({a:{x:e.a.x+t.x,y:e.a.y+t.y},b:{x:e.b.x+t.x,y:e.b.y+t.y}})))}var Bh,zh,Uh,Gh,Hh,Vh,qh,Wh,Kh,Yh;i._RF.pop(),i._RF.push({},"0cceagmIDZNoZTxP8hBPplh","Board",void 0);const{ccclass:jh,property:Xh,requireComponent:$h}=a,{monitorError:Qh}=globalThis.game,{Utils:{Array:Jh}}=GameCore;let Zh=(Bh=jh("Board"),zh=$h(l),Uh=Xh(Gc),Gh=Xh(n),Hh=Xh({displayName:"Tile Spacing",group:"Create config"}),Bh(Vh=zh((Wh=ve((qh=class t extends s{constructor(){super(...arguments),e(this,"tilePrefab",Wh,this),e(this,"tilesHolder",Kh,this),e(this,"tileTrim",Yh,this),this.tileSize=[0,0],this.selectedTile=null,this.layoutType="portrait",this.parsedGravityRules=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.hintTiles=null,this.animationQueue=[],this.isConsumingAnimation=!1,this.handleViewResized=()=>{this.updateTilesHolderScale()},this.onLayoutChanged=e=>{this.layoutType=e}}onLoad(){this.uiTransform=this.getComponent(l),Fe.lazyValidateProperties(this),this.tilePrefab.node.active=!1,this.listenLayoutevents()}onDestroy(){this.unlistenLayoutevents()}create(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Date.now();const n=[...e];Jh.shuffle(n),e=n.slice(0,t.colors),this.levelData=t,this.parsedGravityRules=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.split("-"),n=[];let a=0;for(;a<i.length;){let e=null;switch(i[a]){case"normal":a+=1;break;case"fall":e=ac,a+=2;break;case"fly":e=sc,a+=2;break;case"push":"left"===i[a+1]?(e=oc,a+=2):(e=rc,a+=2);break;case"put":"columns"===i[a+1]?(e=lc,a+=3):(e=cc,a+=3)}e&&(t&&(e=Vc(e)),n.push(e))}return n}(t.mode,this.layoutType===ia.Layout.Landscape);const a=e=>{const t=c(this.tilePrefab.node),i=t.getComponent(Gc);return i.setIdentity(e),this.tilesHolder.addChild(t),t.active=!0,i};let s=!1;if(void 0!==t.customFen)try{s=!0,this.grid=function(e){let{customFen:t,identities:i,createTile:n}=e;const{idSize:a,cols:s,rows:o,code:r}=t;if(i.length<t.idSize)throw new Error(`Invalid grid code. There are not enough identities/frames ${i.length} to fill it according to fen code ${a}`);const l=r.split(":");if(l.length!==o)throw new Error("Invalid grid code");const c=/[a-zA-Z]+\d+|./g,h=/[a-zA-Z]+/,d=/\d+/,u=l.reduceRight(((e,a)=>{const s=[],o=a.matchAll(c);for(const e of o){const a=e[0],o=d.exec(a)?.[0],r=void 0!==o?parseInt(o,10):void 0,l=void 0!==r&&!isNaN(r)&&r<i.length?i[r]:void 0,c=n(void 0!==l?l:i[0]),u=h.exec(a)?.[0],p=void 0!==u?rh(u,t.encoding):void 0;p&&l?c.setSpecialType(p):c.setEmpty(),s.push(c)}return e.concat(s)}),[]);return new dc({width:s,height:o,content:u})}({customFen:t.customFen,identities:e,createTile:a}),this.grid.forEach(((e,t,i)=>{e.setCoord(t,i),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)}))}catch(e){console.error("Error creating grid from custom fen",e,"falling back to random grid"),s=!1}s||(this.grid=sh({levelData:t,seed:i,identities:e,createTile:a}),this.grid.forEach(((e,t,i)=>{e.setCoord(t,i),e.setIgnoreInput(!1),e.node.setSiblingIndex(0)})),ch(this.grid,i),nh(this.grid,t,i)),this.handleBoardLayout();const o=[this.tileTrim.x,this.tileTrim.y];this.tileSize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0];const[i,n]=e,[a,s]=t,[o,r]=[1-a,1-s],[l,c]=[i*o,n*r];return[l,c]}(this.tilePrefab.getSize(),o),this.updateTilesHolderScale(),this.node.scene.emit(Ga.GRID_CREATE,this),this.selectedTile=null,this.animationQueue=[],this.normalMatches=0,this.normalMatchesSinceLastSpawn=0,this.spawnAttempts=0,this.hintPath=null,this.processGameplayCycle()}updateTilesHolderScale(){if(!this.grid)return;const e=[this.grid.width,this.grid.height],t=[this.uiTransform.width,this.uiTransform.height],i=function(e,t,i){const[n,a]=e,[s,o]=t,[r,l]=i,[c,h]=[r/(n*s),l/(a*o)];return Math.min(c,h)}(e,this.tilePrefab.getSize(),t);this.tilesHolder.setScale(i,i),this.node.scene.emit(Ga.GRID_RESIZE,i)}handleBoardLayout(){this.layoutType===ia.Layout.Landscape&&0!==this.levelData.level&&(this.grid=function(e){const t=e.toRotated();return t.forEach(((e,t,i)=>{e.setCoord(t,i)})),t}(this.grid))}destroyTiles(){this.grid?.forEach((e=>e.node.destroy()))}animateTilesAppear(){const e=(e,t)=>{const i=Q.ZERO.clone();return this.parsedGravityRules.forEach((n=>{const a=this.getPrimitiveDirection(e,t,n);i.subtract2f(a.x,a.y)})),i.normalize()};return new Promise((t=>{this.animationQueue.push((async()=>{await Promise.all(this.grid.map(((t,i,n)=>{const a=ne(0,.5),s=t.node.scale.clone(),o=e(i,n),r=Hc(this.grid,this.tileSize,{x:i,y:n}),l=o.multiplyScalar(100).add2f(r.x,r.y);return t.node.setPosition(l.x,l.y),t.node.setScale(0,0),Promise.all([vt.runTweenAsync(E(t.node).delay(a).to(.5,{scale:s},{easing:"elasticOut"})),t.sync({getTargetPosition:e=>Hc(this.grid,this.tileSize,e),easing:"backOut",duration:.5,delay:a})])}))),t()})),this.consumeAnimationQueue()}))}handleTileClick(e){if(!e.isHidden()){if(this.selectedTile===e)return this.selectedTile=null,void e.setFocused(!1);if(!this.selectedTile)return this.selectedTile=e,void e.setFocused(!0);if(!this.selectedTile.isSimilarTo(e))return this.selectedTile.setFocused(!1),this.selectedTile=e,void e.setFocused(!0);this.selectedTile.setFocused(!1),this.match(this.selectedTile,e),this.selectedTile=null}}clearSelectedTile(){this.selectedTile&&(this.selectedTile.setFocused(!1),this.selectedTile=null)}match(e,t){const i=[e.getCoord().x,e.getCoord().y],n=[t.getCoord().x,t.getCoord().y],a=Ph(this.grid,i,n);if(null===a){ji.playSound(Fi.INVALID_MATCH),this.shakeGrid();const a=0===this.levelData.level,s=Sh(this.grid,i,n,a);return this.node.scene.emit(Ga.GRID_MATCH,[e,t]),void this.node.scene.emit(Ga.GRID_MATCH_FAIL,s)}this.node.scene.emit(Ga.GRID_MATCH,[e,t]),this.node.scene.emit(Ga.GRID_MATCH_SUCCESS,a,[e,t]),this.clear([[e,t]],"clear")}clear(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"clear";this.normalMatches+=e.length,e.forEach((e=>{let[i,n]=e;i.setEmpty(),n.setEmpty(),i.playClearFX(t),n.playClearFX(t),this.node.scene.emit(Ga.GRID_CLEAR,[i,n])})),this.processGameplayCycle()}showHint(){if(!this.hintPath)return;const e=this.hintPath[0].a,t=this.hintPath[this.hintPath.length-1].b,i=this.getTileAt(e.x,e.y),n=this.getTileAt(t.x,t.y);i.setHint(!0),n.setHint(!0),this.hintTiles=[i,n]}hideHint(){if(this.hintTiles){const[e,t]=this.hintTiles;e.setHint(!1),t.setHint(!1),this.hintTiles=null}}getHintPath(){return this.hintPath}getTileAt(e,t){return this.grid.isInBounds(e,t)?this.grid.get(e,t):null}getAnyTileWorldPosition(e,t){const i=Hc(this.grid,this.tileSize,{x:e,y:t});this.tilePrefab.node.setPosition(i.x,i.y);const n=this.tilePrefab.node.getWorldPosition();return{x:n.x,y:n.y}}getTileSize(){return this.tileSize}getGridSize(){return[this.grid.width,this.grid.height]}getUncleared(){return qc(this.grid)}getCleared(){return Wc(this.grid)}getBombTiles(){return qc((e=this.grid)instanceof dc?e.asArray():e).filter((e=>e.special?.type===uc.bomb));var e}getPairs(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=[];let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1]?qc(this.grid):Wc(this.grid);for(;t.length<e;){const[e,n]=Qc(i);t.push([e,n]),i=i.filter((t=>t!==e&&t!==n))}return t}setIgnoreInput(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.grid.forEach((t=>t.setIgnoreInput(e)))}processShuffleRequest(e){const t=this.processShuffleStep(this.grid,!0,e);this.grid=t[0],this.hintPath=t[1],this.consumeAnimationQueue()}getCurrentFen(){return Eh(this.grid)}generateFenFromCurrentLevel(e){return t.generateFen(e??this.levelData)}static generateFen(e){const t=e,i=[];for(let e=0;e<t.colors;e++)i.push(e+1);const n=Date.now(),a=sh({levelData:t,seed:n,identities:i,createTile:e=>{let t,i=e;const n=new Q(0,0);return{get id(){return i},get special(){return t},get coord(){return n},setIdentity:e=>{i=e},isHidden:()=>!1,setSpecialType:e=>{t={type:e}},setCoord:(e,t)=>n.set(e,t),getCoord:()=>n,isSimilarTo:e=>e.id===i,inSamePositionAs:e=>e.getCoord().equals(n)}}});return a.forEach(((e,t,i)=>{e.setCoord(t,i)})),ch(a,n),nh(a,t,n),Eh(a)}listenLayoutevents(){W.on(Kn,this.handleViewResized),W.on(jn,this.onLayoutChanged)}unlistenLayoutevents(){W.off(Kn,this.handleViewResized),W.off(jn,this.onLayoutChanged)}async shakeGrid(){const e=this.tilesHolder.position.clone(),t=E(this.tilesHolder).to(.05,{position:e.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:e.clone().subtract3f(ne(5,10),ne(5,10),0)}),i=E(this.tilesHolder).repeat(2,t).to(.05,{position:e});await vt.runTweenAsync(i)}processGameplayCycle(){const e=qc(this.grid);if(0===e.length)return;let t=this.grid;const i=e.length>=2&&this.spawnAttempts<this.levelData.rules.addRandomTilesPerMove&&this.normalMatches>=5,n=this.normalMatchesSinceLastSpawn>=2;i&&(n?(this.spawnAttempts++,this.normalMatchesSinceLastSpawn=0,this.processSpawnStep()):this.normalMatchesSinceLastSpawn++),e.length>14&&(t=this.processGravitationStep(t));const a=this.processShuffleStep(t);this.consumeAnimationQueue(),this.grid=a[0],this.hintPath=a[1]}processSpawnStep(){const[e,t]=th(Wc(this.grid),2);e.restore(),t.restore(e.id)}processGravitationStep(e){let t=e;const i=[];for(const e of this.parsedGravityRules){t=this.toGravitated(t,e);const n=Ch(t);if(0===n.length)continue;n.forEach((e=>{let[t,i]=e;const n=i[0],a=i[1];t.setCoord(n,a)})),t.forEach((e=>{e.node.setSiblingIndex(0)}));const a=async()=>{await Promise.all(n.map((e=>{let[i,[n,a]]=e;return i.sync({delay:.25,duration:.25,getTargetPosition:()=>Hc(t,this.tileSize,{x:n,y:a})})})))};i.push(a)}return this.animationQueue.push((async()=>{for(const e of i)await e()})),t}toGravitated(e,t){const i=new dc(e),n=e.height-1,a=e.width-1,s=[0,n],o=[0,a],r=Math.floor(e.height/2),l=Math.floor(e.width/2),c=e=>e.isHidden();switch(t){case ac:i.gravitate({rowRange:s,colRange:o,direction:nc.Down,isLighter:c});break;case sc:i.gravitate({rowRange:s,colRange:o,direction:nc.Up,isLighter:c});break;case oc:i.gravitate({rowRange:s,colRange:o,direction:nc.Left,isLighter:c});break;case rc:i.gravitate({rowRange:s,colRange:o,direction:nc.Right,isLighter:c});break;case lc:i.gravitate({rowRange:s,colRange:[l,a],direction:nc.Left,isLighter:c,out:i.gravitate({rowRange:s,colRange:[0,l-1],direction:nc.Right,isLighter:c})});break;case cc:i.gravitate({rowRange:[r,n],colRange:o,direction:nc.Down,isLighter:c,out:i.gravitate({rowRange:[0,r-1],colRange:o,direction:nc.Up,isLighter:c})})}return i}getPrimitiveDirection(e,t,i){const n=Math.floor(this.grid.height/2),a=Math.floor(this.grid.width/2);switch(i){case ac:return nc.Down;case sc:return nc.Up;case oc:return nc.Left;case rc:return nc.Right;case lc:return e>=a?nc.Left:nc.Right;case cc:return t>=n?nc.Down:nc.Up}}processShuffleStep(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,n=Ph(e);const a=qc(e).map((e=>{const t=e.getCoord();return[t.x,t.y]}));if(null!==n&&!t)return[e,n];let s,o=100;do{[s]=e.toShuffled(a),n=Ph(s),o--}while(null===n&&o>0);if(o<=0)return Qh?.sendException(new Error("No paths found after 100 shuffle attempts"),{message:"No paths found after 100 shuffle attempts",levelData:this.levelData,gridAsArray:s.asArray()}),this.node.scene.emit(Ga.GAME_EXIT),[e,n];const r=Ch(s);if(0===r.length)return[s,n];r.forEach((e=>{let[t,[i,n]]=e;t.setCoord(i,n)}));const l=void 0!==i?()=>i(e,s):this.createShuffleAnimationHandler(e,s);return this.animationQueue.push(l),[s,n]}createShuffleAnimationHandler(e,t){const i=async()=>{await Promise.all(e.map(((e,i,n)=>e.sync({duration:.4,easing:"smooth",getTargetPosition:()=>Hc(t,this.tileSize,{x:i,y:n},10)}))))},n=async()=>{t.forEach((e=>{e.node.setSiblingIndex(0)})),await Promise.all(t.map((e=>e.sync({duration:.6,easing:"smooth",delay:ne(0,.4),getTargetPosition:e=>Hc(t,this.tileSize,e)}))))};return async()=>{await i(),await n()}}async consumeAnimationQueue(){if(!this.isConsumingAnimation){for(this.isConsumingAnimation=!0;this.animationQueue.length>0;){if(0===this.getUncleared().length){this.animationQueue=[];break}const e=this.animationQueue.shift();await e()}this.isConsumingAnimation=!1}}}).prototype,"tilePrefab",[Uh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kh=ve(qh.prototype,"tilesHolder",[Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yh=ve(qh.prototype,"tileTrim",[Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Q(.025,.1)}}),Vh=qh))||Vh)||Vh);var ed;i._RF.pop(),i._RF.push({},"c92ec8pmUJGbrL9PLjum+i5","Line",void 0);const{ccclass:td}=a;let id=td("Line")(ed=class extends s{onLoad(){this.uiTransform=this.getComponent(l)}setPoints(e,t){this.node.setWorldPosition((e.x+t.x)/2,(e.y+t.y)/2,0),this.uiTransform.width=Q.distance(e,t)+10,this.uiTransform.width/=this.node.worldScale.x;const i=180*Math.atan2(t.y-e.y,t.x-e.x)/Math.PI;this.node.eulerAngles=new j(0,0,i)}})||ed;i._RF.pop(),i._RF.push({},"1e7cch8i/5DkYHOwJowrjeg","AFPool",void 0);class nd extends ae{constructor(e,t,i,n,a){super(e,t,a),this.ator=i,this.ftor=n}alloc(){const e=super.alloc();return this.ator&&this.ator(e),e}free(e){this.ftor&&this.ftor(e),super.free(e)}}var ad,sd,od,rd,ld,cd,hd,dd,ud,pd,md;i._RF.pop(),i._RF.push({},"6f7a1msxIxIbYLx5PpbL/BZ","PathDrawer",void 0);const{ccclass:gd,property:yd}=a;let bd=(ad=gd("PathDrawer"),sd=yd({group:"Line",displayName:"Prefab",type:_}),od=yd({group:"Line",displayName:"Holder",type:n,tooltip:"Line Prefab"}),rd=yd({group:"Point",displayName:"Prefab",type:_}),ld=yd({group:"Point",displayName:"Holder",type:n}),ad((dd=ve((hd=class extends s{constructor(){super(...arguments),e(this,"linePrefab",dd,this),e(this,"lineHolder",ud,this),this.lineNodes=[],e(this,"pointPrefab",pd,this),e(this,"pointHolder",md,this),this.pointNodes=[]}start(){this.linePool=new nd((()=>{const e=c(this.linePrefab);return this.lineHolder.addChild(e),e.parent=this.lineHolder,e.active=!1,e}),0,(e=>{this.lineNodes.push(e),e.active=!0}),(e=>{e.active=!1}),(e=>{e.isValid&&e.destroy()})),this.pointPool=new nd((()=>{const e=c(this.pointPrefab);return this.pointHolder.addChild(e),e.active=!1,e}),0,(e=>{this.pointNodes.push(e),e.active=!0}),(e=>{e.active=!1}),(e=>{e.isValid&&e.destroy()}))}drawPath(e){this.clearPath();for(const t of e){this.linePool.alloc().getComponent(id)?.setPoints(t.a,t.b)}}clearPath(){for(const e of this.lineNodes)this.linePool.free(e);this.lineNodes=[];for(const e of this.pointNodes)this.pointPool.free(e);this.pointNodes=[]}}).prototype,"linePrefab",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ud=ve(hd.prototype,"lineHolder",[od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pd=ve(hd.prototype,"pointPrefab",[rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),md=ve(hd.prototype,"pointHolder",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cd=hd))||cd);var fd,wd,Sd,vd,Ed,Cd,Td,Ad,Rd;i._RF.pop(),i._RF.push({},"5cc7bAmTI1JL7nwLzZcp45u","ErrorDrawer",void 0);const{ccclass:Id,property:Pd}=a;let _d=(fd=Id("ErrorDrawer"),wd=Pd(N),Sd=Pd(N),vd=Pd(N),fd((Td=ve((Cd=class extends bd{constructor(){super(...arguments),e(this,"one",Td,this),e(this,"two",Ad,this),e(this,"error",Rd,this)}start(){super.start(),this.pathAppearDuration=0}drawPath(e){if(this.clearPath(),e.forEach(((t,i)=>{if(this.linePool.alloc().getComponent(id)?.setPoints(t.a,t.b),0!==i){const n=this.pointPool.alloc();n.setWorldPosition(new j(t.a.x,t.a.y,0));const a=n.getComponent(R);1===i&&e.length>3?a.spriteFrame=this.one:2===i&&e.length>3?a.spriteFrame=this.two:a.spriteFrame=this.error}})),1===e.length){const t=this.pointPool.alloc();t.setWorldPosition(new j(e[0].a.x+e[0].b.x,e[0].a.y+e[0].b.y,0).multiplyScalar(.5)),t.getComponent(R).spriteFrame=this.error}this.pathAppearDuration=.8}update(e){this.pathAppearDuration>0&&(this.pathAppearDuration-=e,this.pathAppearDuration<=0&&this.clearPath())}}).prototype,"one",[wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad=ve(Cd.prototype,"two",[Sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd=ve(Cd.prototype,"error",[vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ed=Cd))||Ed);var Ld;i._RF.pop(),i._RF.push({},"880e8aL9NFPj68zH2xVRIFR","HintDrawer",void 0);const{ccclass:Dd}=a;let Od=Dd("HintDrawer")(Ld=class extends bd{drawPath(e){this.clearPath(),this.createPath(e),this.showPath()}createPath(e){e.forEach((e=>{this.linePool.alloc().getComponent(id)?.setPoints(e.a,e.b);this.pointPool.alloc().setWorldPosition(e.a.x,e.a.y,0)}));this.pointPool.alloc().setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0)}showPath(){for(const e of this.lineNodes){const t=e.getComponent(x);t.opacity=0,E(t).to(.2,{opacity:255},{easing:"quadOut"}).start()}for(const e of this.pointNodes){const t=e.getComponent(x);t.opacity=0,E(t).to(.2,{opacity:255},{easing:"quadOut"}).start()}}clearPath(){for(const e of this.lineNodes){const t=e.getComponent(x);E(t).to(.15,{opacity:0},{onComplete:()=>{t.opacity=255,this.linePool.free(e)}}).start()}for(const e of this.pointNodes){const t=e.getComponent(x);E(t).to(.15,{opacity:0},{onComplete:()=>{t.opacity=255,this.pointPool.free(e)}}).start()}this.lineNodes=[],this.pointNodes=[]}})||Ld;var Nd;i._RF.pop(),i._RF.push({},"25f67BW5/5Jzox4v+yBBbyS","MatchDrawer",void 0);const{ccclass:Md}=a;let kd=Md("MatchDrawer")(Nd=class extends bd{drawPath(e){e.forEach(((e,t)=>{const i=this.linePool.alloc();i.getComponent(id)?.setPoints(e.a,e.b),this.animateLine(i);const n=this.pointPool.alloc();n.setWorldPosition(e.a.x,e.a.y,0),this.animatePoint(n,t)}));const t=this.pointPool.alloc();t.setWorldPosition(e[e.length-1].b.x,e[e.length-1].b.y,0),this.animatePoint(t,e.length)}async animateLine(e){const t=e.getComponent(x);t.opacity=0;const i=E(t).to(.25,{opacity:255},{easing:"quadOut"}).delay(.1).to(.2,{opacity:0});await vt.runTweenAsync(i),t.opacity=255,this.linePool.free(e)}async animatePoint(e,t){e.scale=j.ZERO;const i=E(e).delay(.03*t).to(.2,{scale:j.ONE},{easing:"quadOut"}).delay(.1).to(.2,{scale:j.ZERO},{easing:"backIn"});await vt.runTweenAsync(i),this.pointPool.free(e)}clearPath(){this.lineNodes=[],this.pointNodes=[]}})||Nd;var xd,Fd,Bd,zd,Ud,Gd,Hd,Vd,qd;i._RF.pop(),i._RF.push({},"bfdf2THr9lPJ4TOVDN8VgE4","PathDraw",void 0);const{ccclass:Wd,property:Kd}=a;let Yd=(xd=Wd("PathDraw"),Fd=Kd({group:{name:"Path Drawer"},type:kd}),Bd=Kd({group:{name:"Path Drawer"},type:Od}),zd=Kd({group:{name:"Path Drawer"},type:_d}),xd((Hd=ve((Gd=class extends s{constructor(){super(...arguments),e(this,"matchPath",Hd,this),e(this,"hintPath",Vd,this),e(this,"errorPath",qd,this),this.isDrawingHint=!1}drawMatchPath(e,t){e=e.map((e=>({...e})));for(const i of e)i.a=t(i.a),i.b=t(i.b);this.matchPath.drawPath(e)}clearMatchPath(){this.matchPath.clearPath()}drawHintPath(e,t){if(!this.isDrawingHint){this.isDrawingHint=!0,e=e.map((e=>({...e})));for(const i of e)i.a=t(i.a),i.b=t(i.b);this.hintPath.drawPath(e)}}clearHintPath(){this.isDrawingHint&&(this.isDrawingHint=!1,this.hintPath.clearPath())}drawErrorPath(e,t){e=e.map((e=>({...e})));for(const i of e)i.a=t(i.a),i.b=t(i.b);this.errorPath.drawPath(e)}}).prototype,"matchPath",[Fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vd=ve(Gd.prototype,"hintPath",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qd=ve(Gd.prototype,"errorPath",[zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ud=Gd))||Ud);var jd;i._RF.pop(),i._RF.push({},"3afb9sM0KZKyod8UtofqZYu","ComboManager",void 0);const{ccclass:Xd}=a;let $d=Xd("ComboManager")(jd=class extends s{init(){this.currentCombo=0,this.setEmitEvent(!0),this.node.scene.on(Ga.COMBO_ENDED,this.resetCombo,this),this.node.scene.on(Ga.GAME_FINISH,this.resetCombo,this),this.node.scene.on(Ga.GAME_REPLAY,this.resetCombo,this),this.node.scene.on(Ga.NEXT_LEVEL,this.resetCombo,this),this.node.scene.on(Ga.ADD_COMBO,this.addCombo,this)}addCombo(){this.setCombo(this.currentCombo+1)}resetCombo(){this.setCombo(0)}getCombo(){return this.currentCombo}setCombo(e){if(this.currentCombo=e,e>0&&e<5){const t=[Fi.COMBO_1,Fi.COMBO_2,Fi.COMBO_3,Fi.COMBO_4,Fi.COMBO_5];ji.playSound(t[e])}else e>=5&&ji.playSound(Fi.COMBO_5);e>0&&this.vibrate(e),this.emitEvent&&this.node.scene.emit(Ga.COMBO_UPDATED,e)}vibrate(e){P("Vibrate")?.getComponent(mr)?.vibrate(Math.min(20+20*e,220))}setEmitEvent(e){this.emitEvent=e}})||jd;var Qd,Jd,Zd,eu,tu,iu,nu,au,su,ou,ru,lu,cu,hu,du,uu,pu;i._RF.pop(),i._RF.push({},"da8a1SD+ahMFpc6MIdiFP5H","ShiningStar",void 0);const{ccclass:mu,property:gu,disallowMultiple:yu}=a;let bu=(Qd=mu("ShiningStar"),Jd=gu(R),Zd=gu({serializable:!0,visible:!1}),eu=gu({type:C,displayName:"Scale up duration",min:.001}),tu=gu({serializable:!0,visible:!1}),iu=gu({type:C,displayName:"Bounce and Fall duration",min:.001}),nu=gu({serializable:!0,visible:!1}),au=gu({type:C,displayName:"Start scale"}),su=gu({serializable:!0,visible:!1}),ou=gu({type:C,displayName:"End scale"}),Qd(ru=yu((cu=ve((lu=class extends s{constructor(){super(...arguments),e(this,"shine",cu,this),e(this,"twScaleUpDuration",hu,this),e(this,"twBounceAndFallDuration",du,this),e(this,"twStartScale",uu,this),e(this,"twEndScale",pu,this),this.isBeingAnimated=!1}get scaleUpDuration(){return this.twScaleUpDuration}set scaleUpDuration(e){this.twScaleUpDuration=e}get bounceAndFallDuration(){return this.twBounceAndFallDuration}set bounceAndFallDuration(e){this.twBounceAndFallDuration=e}get startScale(){return this.twStartScale}set startScale(e){this.twStartScale=e}get endScale(){return this.twEndScale}set endScale(e){this.twEndScale=e}get isAvailable(){return!this.isBeingAnimated}__preload(){this.shineOpacity=this.shine.node.getComponent(x),this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents()}onLoad(){this.uiOpacity.opacity=0}async playAnimation(){if(!this.isAvailable)throw new Error("ShiningStar: This star is being animated.");this.isBeingAnimated=!0,await this.animateAppear(),await this.animateDisappear(),this.isBeingAnimated=!1}async animateAppear(){this.shineOpacity.opacity=255,await Promise.all([this.animateFadeIn(),this.animateScaleUp()])}async animateDisappear(){await Promise.all([this.animateBounceAndFall(),this.animateScaleDown()]),this.node.setScale(0,0),this.uiOpacity.opacity=0}async animateBounceAndFall(){const e=this.node.position.x,t=this.node.position.y,i=[60,120],n=(Math.random()*(i[1]-i[0])+i[0])*(Math.PI/180),a=e+200*Math.cos(n),s=t+200*Math.sin(n),o=t-500,r=vt.runTweenAsync(E(this.node).to(.2*this.twBounceAndFallDuration,{position:new j(a,s,this.node.position.z)},{easing:"sineOut"}).to(.4*this.twBounceAndFallDuration,{position:new j(a,o,this.node.position.z)},{easing:"cubicIn"})),l=[0,360],c=vt.runTweenAsync(E(this.node).to(this.twBounceAndFallDuration,{eulerAngles:new j(0,0,Math.random()*(l[1]-l[0])*(a>e?-1:1))},{easing:"sineOut"}));await Promise.all([r,c]),this.node.eulerAngles=new j(0,0,0)}async animateFadeIn(){const e=Math.max(this.scaleUpDuration/4,.01);await vt.runTweenAsync(E(this.uiOpacity).to(e,{opacity:255}))}async animateScaleUp(){this.node.setScale(this.startScale,this.startScale);const e=new j(this.endScale,this.endScale,1);await vt.runTweenAsync(E(this.node).to(this.scaleUpDuration,{scale:e},{easing:"cubicOut"}))}async animateScaleDown(){const e=new j(0,0,1);await vt.runTweenAsync(E(this.node).delay(.1*this.bounceAndFallDuration).to(.5*this.bounceAndFallDuration,{scale:e},{easing:"cubicIn"}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"shine",[Jd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hu=ve(lu.prototype,"twScaleUpDuration",[Zd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ve(lu.prototype,"scaleUpDuration",[eu],Object.getOwnPropertyDescriptor(lu.prototype,"scaleUpDuration"),lu.prototype),du=ve(lu.prototype,"twBounceAndFallDuration",[tu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ve(lu.prototype,"bounceAndFallDuration",[iu],Object.getOwnPropertyDescriptor(lu.prototype,"bounceAndFallDuration"),lu.prototype),uu=ve(lu.prototype,"twStartScale",[nu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ve(lu.prototype,"startScale",[au],Object.getOwnPropertyDescriptor(lu.prototype,"startScale"),lu.prototype),pu=ve(lu.prototype,"twEndScale",[su],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),ve(lu.prototype,"endScale",[ou],Object.getOwnPropertyDescriptor(lu.prototype,"endScale"),lu.prototype),ru=lu))||ru)||ru);var fu,wu,Su,vu,Eu;i._RF.pop(),i._RF.push({},"2e9aaj8L6lN1pTv2xGEj1sE","StarParticles",void 0);const{ccclass:Cu,property:Tu,disallowMultiple:Au}=a,{Array:Ru}=GameCore.Utils;let Iu=(fu=Cu("StarParticles"),wu=Tu({type:[bu],displayName:"Prebuilt Shining stars"}),fu(Su=Au((Eu=ve((vu=class extends s{constructor(){super(...arguments),e(this,"shiningStars",Eu,this)}__preload(){this.validateRequiredComponents()}async fireShiningStarAt(e){const t=this.getFirstAvailableShiningStar();if(void 0===t)throw new Error("No available shining stars. Please add more prebuilt shining stars or calls this function later.");const[i,n]=e,a=new j(i,n,this.node.worldPosition.z);t.node.worldPosition=a,await t.playAnimation()}getFirstAvailableShiningStar(){return Ru.search(this.shiningStars,(e=>e.isAvailable))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"shiningStars",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Su=vu))||Su)||Su);var Pu,_u,Lu,Du,Ou,Nu,Mu,ku,xu,Fu,Bu,zu,Uu,Gu,Hu,Vu,qu,Wu,Ku,Yu,ju;i._RF.pop(),i._RF.push({},"2913d3KShhIEaPfSLUhFqvA","EffectManager",void 0);const{ccclass:Xu,property:$u}=a;let Qu=(Pu=Xu("EffectManager"),_u=$u({group:"Thunder Effect",type:n}),Lu=$u({group:"Thunder Effect",type:n}),Du=$u({group:"Mask Effect",type:qn}),Ou=$u({group:"Mask Effect",type:n}),Nu=$u({group:"Tornado Effect",type:n}),Mu=$u({group:"Clear Particle Effect",type:n,displayName:"Particle holder node"}),ku=$u({group:"Clear Particle Effect",type:se,displayName:"Emitter 1"}),xu=$u({group:"Clear Particle Effect",type:se,displayName:"Emitter 2"}),Fu=$u({group:"Star Particles Effect",type:Iu}),Pu((Uu=ve((zu=class extends s{constructor(){super(...arguments),e(this,"cloud",Uu,this),e(this,"lightnings",Gu,this),e(this,"backgroundMask",Hu,this),e(this,"masks",Vu,this),e(this,"tornado",qu,this),this.bombExplosion=null,this.bombExplosionPool=null,this.defuseExplosion=null,this.defuseExplosionPool=null,e(this,"clearParticleHolder",Wu,this),e(this,"clearParticle1",Ku,this),e(this,"clearParticle2",Yu,this),e(this,"starParticle",ju,this),this.maskTargets=[]}__preload(){this.validateRequiredComponents()}update(){this.maskTargets.length>0&&this.maskTargets.forEach(((e,t)=>{if(e.isHidden())return;this.masks[t].worldPosition=e.node.worldPosition.clone()}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}start(){this.node.scene.on(Ga.GRID_RESIZE,this.handleBoardResize,this)}playClearFXAt(e){this.clearParticle1.node.setWorldPosition(new j(e[0].x,e[0].y,1)),this.clearParticle2.node.setWorldPosition(new j(e[1].x,e[1].y,1)),this.clearParticle1.resetSystem(),this.clearParticle2.resetSystem()}playStarFXAt(e){this.starParticle.fireShiningStarAt(e)}async playTornadoAnimation(){if(null===this.tornado.getChildByName("Sprite").getComponent(y).defaultClip)return void console.warn("EffectManager: Tornado animation is not loaded when animation play request was made.");this.tornado.active=!0;const e=E(this.tornado);e.set({scale:new j(0,0,0)}),e.delay(.5),e.to(.5,{scale:new j(1,1,1)},{easing:"quadOut"}),e.to(.5,{scale:new j(0,0,0)},{easing:"quadIn"}),e.set({active:!1}),ci.setBlockInput(!0),await vt.runTweenAsync(e),ci.setBlockInput(!1)}async shakeGame(){const e=this.node.position.clone(),t=E(this.node).to(.05,{position:e.clone().add3f(ne(5,10),ne(5,10),0)}).to(.05,{position:e.clone().subtract3f(ne(5,10),ne(5,10),0)}).to(.05,{position:e});await vt.runTweenAsync(t)}handleBoardResize(e){this.clearParticleHolder.setScale(e,e)}async playThunderAnimation(e,t){this.cloud.active=!0;const i=P("Canvas").getComponent(l),{width:n,height:a}=i;let s=0,o=0;switch(Math.floor(4*Math.random())){case 0:s=Math.random()*n-n/2,o=a/2+300;break;case 1:s=Math.random()*n-n/2,o=-a/2-300;break;case 2:s=-n/2-300,o=Math.random()*a-a/2;break;case 3:s=n/2+300,o=Math.random()*a-a/2}this.cloud.position=new j(s,o),this.resetMasks(),this.setMaskProperties(0,e[0][0].node.worldPosition,e[0][0].node.worldScale),this.setMaskProperties(1,e[0][1].node.worldPosition,e[0][1].node.worldScale),this.setMaskProperties(2,e[1][0].node.worldPosition,e[1][0].node.worldScale),this.setMaskProperties(3,e[1][1].node.worldPosition,e[1][1].node.worldScale),this.maskTargets=[e[0][0],e[0][1],e[1][0],e[1][1]],await this.setBackgroundMaskActive(!0);const r=E(this.cloud).to(.8,{position:new j(0,300)},{easing:"quadOut"});await vt.runTweenAsync(r);const c=e[0][0].node.worldPosition.clone(),h=e[0][1].node.worldPosition.clone();this.shakeGame(),P("Vibrate")?.getComponent(mr)?.vibrate(500),ji.playSound(Fi.THUNDERBOLT),t.clear([e[0]],"break"),await Promise.all([this.playLightningAnimation(c,0),this.playLightningAnimation(h,1)]),this.node.scene.emit(Ga.ADD_COMBO),this.node.scene.emit(Ga.ADD_SCORE);const d=e[1][1].node.worldPosition.clone(),u=e[1][0].node.worldPosition.clone();this.shakeGame(),P("Vibrate")?.getComponent(mr)?.vibrate(500),ji.playSound(Fi.THUNDERBOLT),t.clear([e[1]],"break"),await Promise.all([this.playLightningAnimation(u,0),this.playLightningAnimation(d,1)]),this.node.scene.emit(Ga.ADD_COMBO),this.node.scene.emit(Ga.ADD_SCORE),this.cloud.active=!1,await this.setBackgroundMaskActive(!1),this.maskTargets=[]}async playLightningAnimation(e,t){const i=this.lightnings[t],n=e.subtract(i.worldPosition),a=Math.atan2(n.y,n.x)*(180/Math.PI)+180,s=n.length();return i.getComponent(l).width=s,i.angle=a,new Promise((e=>{i.active=!0,this.scheduleOnce((()=>{i.active=!1,e()}),.2)}))}async setBackgroundMaskActive(e){e&&(this.backgroundMask.node.active=!0),await this.backgroundMask.changeStateFade(e,.25),e||(this.backgroundMask.node.active=!1)}resetMasks(){this.masks.forEach((e=>{e.worldPosition=new j(-9999,-9999,0)}))}setMaskProperties(e,t,i){i&&(this.masks[e].worldScale=i),this.masks[e].worldPosition=t}async createDefuseExplosionAt(e){await this.loadDefuseExplosionPrefab(),this.defuseExplosionPool||(this.defuseExplosionPool=new nd(this.createDefuseExplosion.bind(this),1,Ju.getBombDefuseExplosion,Ju.returnBombDefuseExplosion,Ju.destroyBombDefuseExplosion));const t=this.defuseExplosionPool.alloc();t.setWorldPosition(e);const i=t.getComponent(y);if(await vt.runAnimationAsync(i),!this.defuseExplosionPool)throw new Error("EffectManager: defuseExplosionPool is null");this.defuseExplosionPool.free(t)}async createBombExplosionAt(e){await this.loadBombExplosionPrefab(),this.bombExplosionPool||(this.bombExplosionPool=new nd(this.createBombExplosion.bind(this),1,Zu.getBombExplosion,Zu.returnBombExplosion,Zu.destroyBombExplosion));const t=this.bombExplosionPool.alloc();t.setWorldPosition(e);const i=t.getComponent(y);if(await vt.runAnimationAsync(i),!this.bombExplosionPool)throw new Error("EffectManager: bombExplosionPool is null");this.bombExplosionPool.free(t)}createDefuseExplosion(){if(!this.defuseExplosion)throw new Error("EffectManager: defuseExplosion is not loaded!");return Ju.createDefuseExplosion(this.defuseExplosion,this.node)}createBombExplosion(){if(!this.bombExplosion)throw new Error("EffectManager: bombExplosion is not loaded!");return Zu.createBombExplosion(this.bombExplosion,this.node)}async loadBombExplosionPrefab(){if(this.bombExplosion)return Promise.resolve();const e=await ci.loadPrefabAsync(oi.BOMB_EXPLODE_PREFAB);return e&&(this.bombExplosion=e),Promise.resolve()}async loadDefuseExplosionPrefab(){if(this.defuseExplosion)return Promise.resolve();const e=await ci.loadPrefabAsync(oi.BOMB_DEFUSE_PREFAB);return e&&(this.defuseExplosion=e),Promise.resolve()}async loadThunderAnimation(){const e=this.cloud.getChildByName("Top").getComponent(y);if(null!==e.defaultClip)return Promise.resolve();const t=await ci.loadAnimClipAsync(oi.CLOUD_IDLE_ANIM);return t&&(e.defaultClip=t),Promise.resolve()}async loadTornadoAnimation(){const e=this.tornado.getChildByName("Sprite").getComponent(y);if(null!==e.defaultClip)return Promise.resolve();const t=await ci.loadAnimClipAsync(oi.TORNADO_IDLE_ANIM);return t&&(e.defaultClip=t),Promise.resolve()}}).prototype,"cloud",[_u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gu=ve(zu.prototype,"lightnings",[Lu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Hu=ve(zu.prototype,"backgroundMask",[Du],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vu=ve(zu.prototype,"masks",[Ou],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qu=ve(zu.prototype,"tornado",[Nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wu=ve(zu.prototype,"clearParticleHolder",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=ve(zu.prototype,"clearParticle1",[ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yu=ve(zu.prototype,"clearParticle2",[xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ju=ve(zu.prototype,"starParticle",[Fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bu=zu))||Bu);class Ju{static createDefuseExplosion(e,t){const i=c(e);return t.addChild(i),i.active=!1,i}static destroyBombDefuseExplosion(e){e.destroy()}static getBombDefuseExplosion(e){e.active=!0}static returnBombDefuseExplosion(e){e.active=!1}}class Zu{static createBombExplosion(e,t){const i=c(e);return t.addChild(i),i.active=!1,i}static destroyBombExplosion(e){e.destroy()}static getBombExplosion(e){e.active=!0}static returnBombExplosion(e){e.active=!1}}i._RF.pop(),i._RF.push({},"062f3AVHntKsIyireZmXg9P","GuideKeys",void 0);const ep="newbie",tp="timer",ip="combo",np="hint-item",ap="thunder-item",sp="storm-item",op="pliers-item";i._RF.pop(),i._RF.push({},"6448denZfFEUru9tWmWGb7N","Guide01Newbie",void 0);const rp=.7261538461538461;class lp{constructor(e){this.manager=e,this.gameplay=e.gameplay}setup(){this.currentStep=0,this.manager.node.scene.on(Ga.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.on(Ga.GRID_MATCH_FAIL,this.showNextStep,this),W.on(Kn,this.handleViewResized,this),W.on(jn,this.handleViewResized,this),this.showStep(this.currentStep),this.manager.node.scene.emit(Ga.HIDE_UI),this.manager.guideSkipButton.active=!0}showNextStep(){this.currentStep+1<hh.length?(this.currentStep+=1,this.showStep(this.currentStep)):this.close()}async showStep(e){const{board:t,effectManager:i}=this.gameplay,n=hh[e].startTile,a=hh[e].endTile,s=t.getTileAt(n.x,n.y),o=t.getTileAt(a.x,a.y);if(!s||!o)return;const r=s.node.worldPosition,l=o.node.worldPosition;i.resetMasks(),i.setMaskProperties(0,r,s.node.worldScale),i.setMaskProperties(1,l,o.node.worldScale),i.setBackgroundMaskActive(!0);const{guideHand:c,guideTextBox:h}=this.manager;c.node.active=!0,c.playHandAnimation(r,l),this.alignGuideTextBox(),this.alignSkipButton(),await h.hide(),h.setText(hh[e].description),await h.show(),t.setIgnoreInput(!0),s.setIgnoreInput(!1),o.setIgnoreInput(!1),this.gameplay.comboManager.setEmitEvent(!1)}handleViewResized(){const{board:e,effectManager:t}=this.gameplay,i=hh[this.currentStep].startTile,n=hh[this.currentStep].endTile,a=e.getTileAt(i.x,i.y),s=e.getTileAt(n.x,n.y);if(!a||!s)return;const o=a.node.worldPosition,r=s.node.worldPosition;t.setMaskProperties(0,o,a.node.worldScale),t.setMaskProperties(1,r,s.node.worldScale),this.alignGuideTextBox(),this.alignSkipButton()}alignGuideTextBox(){const{board:e}=this.gameplay,{guideTextBox:t}=this.manager,i=e.getTileAt(0,0);if(!i)return;const n=i.node.worldPosition,a=e.tilesHolder.getWorldScale(),s=e.getTileSize()[1]*a.y,o=a.clone().multiplyScalar(rp);t.node.setWorldScale(o),t.node.setWorldPosition(new j(t.node.worldPosition.x,(n.y-s/2)/2))}alignSkipButton(){const{board:e}=this.gameplay,{guideSkipButton:t}=this.manager;if(!t)return;const i=e.getTileAt(0,e.getGridSize()[1]-1);if(!i)return;const n=i.node.worldPosition,a=e.tilesHolder.getWorldScale(),s=e.getTileSize()[1]*a.y,o=a.clone().multiplyScalar(rp),r=t.getComponent(l).contentSize.height*o.y;t.setWorldScale(o),t.setWorldPosition(new j(t.worldPosition.x,n.y+(s+r)/2+30))}async close(){const{board:e,effectManager:t}=this.gameplay;this.manager.node.scene.off(Ga.GRID_MATCH_SUCCESS,this.showNextStep,this),this.manager.node.scene.off(Ga.GRID_MATCH_FAIL,this.showNextStep,this),W.off(Kn,this.handleViewResized,this),W.off(jn,this.handleViewResized,this),e.setIgnoreInput(!1),await Promise.all([await this.manager.guideTextBox.hide(),await t.setBackgroundMaskActive(!1)]),this.manager.guideHand.node.active=!1,this.manager.completeGuide(ep)}}i._RF.pop(),i._RF.push({},"a52daB3sGxP8JyGBZo5K1+X","Guide02Timer",void 0);class cp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,{clock:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.node.worldPosition;n*=1.5,a*=1.5,await this.gameplay.handleShowUI(),e.node.active=!0,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.active=!0,t.string="Remove all tiles before\nthe time end",t.node.setWorldPosition(s.x,s.y-a/2-50,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(Kn,this.handleViewResized,this),W.on(jn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,{clock:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.node.worldPosition;n*=1.5,a*=1.5,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.setWorldPosition(s.x,s.y-a/2-50,0)}async close(){const{guideInfoText:e,guideMasks:t}=this.manager;this.gameplay.comboManager.setEmitEvent(!0),this.gameplay.stateManager.isPlaying()&&this.manager.node.scene.emit(Ga.RESUME_TIME),await t.hide(),e.node.active=!1,this.manager.completeGuide(tp),W.off(Kn,this.handleViewResized,this),W.off(jn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"add56o6JFNHAZiCO6F+Z9jK","Guide03Combo",void 0);class hp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,{comboContainer:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.worldPosition;n*=1.5,a*=1.5,e.node.active=!0,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.active=!0,t.string="Remove tiles continuously\nto increase combo!",t.node.setWorldPosition(s.x-n/2-10,s.y,0),t.horizontalAlign=oe.RIGHT,t.getComponent(l).setAnchorPoint(1,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(Kn,this.handleViewResized,this),W.on(jn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,{comboContainer:i}=this.gameplay.uiManager;let{width:n,height:a}=i.getComponent(l).contentSize;const s=i.worldPosition;n*=1.5,a*=1.5,e.setOtherMaskTransform(s.x,s.y,n,a),t.node.setWorldPosition(s.x-n/2-10,s.y,0)}async close(){const{guideInfoText:e,guideMasks:t}=this.manager;this.manager.node.scene.emit(Ga.RESUME_TIME),t.node.off(n.EventType.TOUCH_START,this.close,this),await t.hide(),e.node.active=!1,this.manager.completeGuide(ip),W.off(Kn,this.handleViewResized,this),W.off(jn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"fd93d+WLXVHk4yJGmVeSjmR","Guide04Hint",void 0);const{Array:dp}=GameCore.Utils;class up{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=dp.search(this.gameplay.itemManager.items,(e=>e.itemType===yr.HINT));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to reveal a connectable pair",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(Kn,this.handleViewResized,this),W.on(jn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=dp.search(this.gameplay.itemManager.items,(e=>e.itemType===yr.HINT));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ga.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(np),W.off(Kn,this.handleViewResized,this),W.off(jn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"b08f4dC/r1EPbsfAe1wtcBg","Guide05Thunder",void 0);const{Array:pp}=GameCore.Utils;class mp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=pp.search(this.gameplay.itemManager.items,(e=>e.itemType===yr.THUNDER));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to remove 2 pairs",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(Kn,this.handleViewResized,this),W.on(jn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=pp.search(this.gameplay.itemManager.items,(e=>e.itemType===yr.THUNDER));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ga.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(ap),W.off(Kn,this.handleViewResized,this),W.off(jn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"f4ef8MBZxxKC4bfuDzsLQ5X","Guide06Storm",void 0);const{Array:gp}=GameCore.Utils;class yp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=gp.search(this.gameplay.itemManager.items,(e=>e.itemType===yr.STORM));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to rearrange the tiles",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(Kn,this.handleViewResized,this),W.on(jn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=gp.search(this.gameplay.itemManager.items,(e=>e.itemType===yr.STORM));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ga.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(sp),W.off(Kn,this.handleViewResized,this),W.off(jn,this.handleViewResized,this)}}i._RF.pop(),i._RF.push({},"9920dDqYP9ITJp0bSlZ+K9R","Guide07Pliers",void 0);const{Array:bp}=GameCore.Utils;class fp{constructor(e){this.manager=e,this.gameplay=e.gameplay}async setup(){const{guideMasks:e,guideInfoText:t}=this.manager,i=bp.search(this.gameplay.itemManager.items,(e=>e.itemType===yr.PLIERS));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.node.active=!0,e.setItemMaskTransform(n.x,n.y,a,s),t.node.active=!0,t.string="Tap to remove bomb",t.node.setPosition(0,0),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0),t.horizontalAlign=oe.CENTER,t.getComponent(l).setAnchorPoint(.5,.5),await e.show(),this.manager.node.scene.once(Ga.GUIDE_MASK_CLICKED,this.close,this),this.manager.node.scene.emit(Ga.PAUSE_TIME),W.on(Kn,this.handleViewResized,this),W.on(jn,this.handleViewResized,this)}handleViewResized(){const{guideMasks:e,guideInfoText:t}=this.manager,i=bp.search(this.gameplay.itemManager.items,(e=>e.itemType===yr.PLIERS));if(!i)return;const n=i.node.worldPosition;let{width:a,height:s}=i.getComponent(l).contentSize;a+=40,s+=40,e.setItemMaskTransform(n.x,n.y,a,s),t.node.setWorldPosition(t.node.worldPosition.x,n.y+s/2+30,0)}async close(){const{guideMasks:e,guideInfoText:t}=this.manager;this.manager.node.scene.emit(Ga.RESUME_TIME),await e.hide(),t.node.active=!1,this.manager.completeGuide(op),W.off(Kn,this.handleViewResized,this),W.off(jn,this.handleViewResized,this)}}var wp,Sp,vp,Ep,Cp,Tp,Ap,Rp,Ip;i._RF.pop(),i._RF.push({},"8ab11Ocp6VMg5ZkRHXv4Odu","GuideHand",void 0);const{ccclass:Pp,property:_p}=a;let Lp=(wp=Pp("GuideHand"),Sp=_p(n),vp=_p(n),Ep=_p(x),wp((Ap=ve((Tp=class extends s{constructor(){super(...arguments),e(this,"hand",Ap,this),e(this,"circleHighlight",Rp,this),e(this,"circleHighlightOpacity",Ip,this)}start(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255}playHandAnimation(e,t){this.handTween&&this.handTween.stop();const i=E(this.hand).to(.8,{worldPosition:t},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((()=>{this.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0}).to(.8,{worldPosition:e},{easing:"quartOut"}).to(.2,{scale:new j(.9,.9,.9),angle:15}).call((()=>{this.playHighlightAnimation()})).to(.2,{scale:j.ONE,angle:0});this.handTween=E(this.hand).repeatForever(i).start()}playHighlightAnimation(){this.circleHighlight.setScale(0,0),this.circleHighlightOpacity.opacity=255,this.circleHighlight.position=this.hand.position.clone(),E(this.circleHighlight).to(.6,{scale:new j(1.5,1.5)},{easing:"quadOut"}).start(),E(this.circleHighlightOpacity).to(.6,{opacity:0},{easing:"quadIn"}).start()}}).prototype,"hand",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rp=ve(Tp.prototype,"circleHighlight",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ip=ve(Tp.prototype,"circleHighlightOpacity",[Ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cp=Tp))||Cp);var Dp,Op,Np,Mp,kp,xp,Fp;i._RF.pop(),i._RF.push({},"b2213ccDllApaGIouur6a6b","GameMask",void 0);const{ccclass:Bp,property:zp}=a;let Up=(Dp=Bp("GameMask"),Op=zp(l),Np=zp(R),Dp((xp=ve((kp=class extends s{constructor(){super(...arguments),e(this,"uiTransform",xp,this),e(this,"sprite",Fp,this)}get texture(){return this.sprite.spriteFrame.texture}}).prototype,"uiTransform",[Op],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fp=ve(kp.prototype,"sprite",[Np],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mp=kp))||Mp);var Gp,Hp,Vp,qp,Wp,Kp;i._RF.pop(),i._RF.push({},"ad9c7KiarJHXpRRfn9GOaVx","AlphaMasks",void 0);const{ccclass:Yp,property:jp,executeInEditMode:Xp}=a;let $p=(Gp=Yp("AlphaMasks"),Hp=Xp(!0),Vp=jp(Up),Gp(qp=Hp((Kp=ve((Wp=class extends s{constructor(){super(...arguments),e(this,"masks",Kp,this)}onLoad(){this.UITransform=this.node.getComponent(l)}start(){this.material=this.getComponent(R).getMaterialInstance(0)}update(){const{width:e,height:t}=this.UITransform;this.masks.forEach(((i,n)=>{const{width:a,height:s,anchorX:o,anchorY:r}=i.uiTransform,l=a*i.node.scale.x,c=s*i.node.scale.y,h=new Q(l/e,c/t),d=new Q(.5+(.5-o)*h.x,.5-(.5-r)*h.y),u=new Q(d.x+(i.node.worldPosition.x-this.node.worldPosition.x)/e,d.y-(i.node.worldPosition.y-this.node.worldPosition.y)/t);this.material.setProperty(`mask${n}Texture`,i.texture),this.material.setProperty(`ratio${n}`,h),this.material.setProperty(`center${n}`,u)}))}setMaskActive(e,t){e>=this.masks.length||this.material.setProperty(`useMask${e}`,t?1:0)}}).prototype,"masks",[Vp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qp=Wp))||qp)||qp);var Qp,Jp,Zp,em,tm,im,nm;i._RF.pop(),i._RF.push({},"69569cXv55L852IkWTL0swz","GuideMasks",void 0);const{ccclass:am,property:sm}=a;let om=(Qp=am("GuideMasks"),Jp=sm(qn),Zp=sm($p),Qp((im=ve((tm=class extends s{constructor(){super(...arguments),e(this,"background",im,this),e(this,"alphaMasks",nm,this)}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.background.node.active=!0,await this.background.changeStateFade(!0,.25)}async hide(){await this.background.changeStateFade(!1,.25),this.background.node.active=!1}onClick(){this.node.scene.emit(Ga.GUIDE_MASK_CLICKED)}setOtherMaskTransform(e,t,i,n){this.alphaMasks.masks[1].node.worldPosition=new j(-9999,-9999,0);const a=this.alphaMasks.masks[0];this.setMaskTransform(a,e,t,i,n)}setItemMaskTransform(e,t,i,n){this.alphaMasks.masks[0].node.worldPosition=new j(-9999,-9999,0);const a=this.alphaMasks.masks[1];this.setMaskTransform(a,e,t,i,n)}setMaskTransform(e,t,i,n,a){e.uiTransform.setContentSize(n,a),e.node.setWorldPosition(t,i,0)}}).prototype,"background",[Jp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nm=ve(tm.prototype,"alphaMasks",[Zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),em=tm))||em);var rm,lm,cm,hm,dm;i._RF.pop(),i._RF.push({},"abfb9zudJhHdZfeUgbnBrs0","GuideTextBox",void 0);const{ccclass:um,property:pm}=a;let mm=(rm=um("GuideTextBox"),lm=pm(h),rm((dm=ve((hm=class extends s{constructor(){super(...arguments),e(this,"guideText",dm,this)}__preload(){this.opacityToggler=this.getComponent(qn),Fe.lazyValidateProperties(this)}setText(e){this.guideText.string=e}async show(){await this.opacityToggler.changeStateFade(!0)}async hide(){await this.opacityToggler.changeStateFade(!1)}}).prototype,"guideText",[lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm=hm))||cm);var gm,ym,bm,fm,wm,Sm,vm,Em,Cm,Tm,Am,Rm,Im;i._RF.pop(),i._RF.push({},"4d800jyvxFJIYnkeNGud6KJ","GuidelinesManager",void 0);const{player:Pm,analytics:_m}=game,{ccclass:Lm,property:Dm}=a,{Plugins:{Analytics:{Events:Om}},Utils:{Array:Nm}}=GameCore,Mm=new Q(0,10),km=new Q(0,10),xm="READY",Fm="RUNNING";let Bm=(gm=Lm("GuidelinesManager"),ym=Dm(Lp),bm=Dm(mm),fm=Dm(h),wm=Dm(om),Sm=Dm(n),gm((Cm=ve((Em=class extends s{constructor(){super(...arguments),e(this,"guideHand",Cm,this),e(this,"guideTextBox",Tm,this),e(this,"guideInfoText",Am,this),e(this,"guideMasks",Rm,this),e(this,"guideSkipButton",Im,this),this.guideHintDelay=null,this.guideStormDelay=null}init(e){this.gameplay=e,this.status=xm,this.node.scene.on(Ga.COMBO_UPDATED,this.startComboGuide,this),this.node.scene.on(Ga.TILE_CLICK,this.startAutoGuides,this),this.node.scene.on(Ga.USE_ITEM,this.handleUseItem,this),this.node.scene.on(Ga.GAME_FINISH,this.stopAutoGuides,this),this.node.scene.on(Ga.GAME_REPLAY,this.stopAutoGuides,this),this.node.scene.on(Ga.GAME_PAUSE,this.stopAutoGuides,this)}show(){this.isNewbieGuideLevel()?(this.hasGuideItemShowed(ep)&&this.resetGuideItemShowed(),this.startGuide(ep)):this.startGuide(tp)}startGuide(e){if(this.status===Fm)return!1;if(this.hasGuideItemShowed(e))return!1;switch(this.addGuideItemShowed(e),this.status=Fm,e){case ep:_m.event(Om.TUTORIAL_BEGIN),this.guide1=new lp(this),this.guide1.setup();break;case tp:this.guide2=new cp(this),this.guide2.setup();break;case ip:this.guide3=new hp(this),this.guide3.setup();break;case np:this.guide4=new up(this),this.guide4.setup();break;case ap:this.guide5=new mp(this),this.guide5.setup();break;case sp:this.guide6=new yp(this),this.guide6.setup();break;case op:this.guide7=new fp(this),this.guide7.setup()}return!0}completeGuide(e){_m.event(Om.TUTORIAL_STEP,{step:e}),this.status=xm,this.addGuideItemShowed(e),this.gameplay.stateManager.isPlaying()&&this.startAutoGuides()}isHintGuideLevel(){return this.getCurrentLevel()>=Mm.x&&this.getCurrentLevel()<=Mm.y}isShowErrorPathLevel(){return this.getCurrentLevel()>=km.x&&this.getCurrentLevel()<=km.y}isNewbieGuideLevel(){return 0===this.getCurrentLevel()}hasGuideItemShowed(e){return Nm.has(this.getGuideItemShowed(),e)}addGuideItemShowed(e){if(this.hasGuideItemShowed(e))return;const t=this.getGuideItemShowed();t.push(e),Pm.setGameData({guideItemShowed:t})}resetGuideItemShowed(){Pm.setGameData({guideItemShowed:[]})}getGuideItemShowed(){return Pm.getGameData()?.guideItemShowed??[]}getCurrentLevel(){return this.gameplay.levelManager.getLevelData().level}startComboGuide(e){this.isNewbieGuideLevel()||e<2||(this.startGuide(ip),this.node.scene.off(Ga.COMBO_UPDATED,this.startComboGuide,this))}startAutoGuides(){this.startHintGuide(),this.startStormGuide()}stopAutoGuides(){null!==this.guideHintDelay&&this.guideHintDelay.stop(),null!==this.guideStormDelay&&this.guideStormDelay.stop()}startHintGuide(){this.isHintGuideLevel()&&(null===this.guideHintDelay&&(this.guideHintDelay=new re(this.node).delay(5).call((()=>{this.isNewbieGuideLevel()||(this.hasGuideItemShowed(np)&&this.status===xm?this.node.scene.emit(Ga.SHOW_HINT):this.startGuide(np),this.startHintGuide())}))),this.guideHintDelay.stop(),this.guideHintDelay.start())}startStormGuide(){null===this.guideStormDelay&&(this.guideStormDelay=new re(this.node).delay(10).call((()=>{if(this.isNewbieGuideLevel())return;if(this.hasGuideItemShowed(sp))return;const e=Nm.search(this.gameplay.itemManager.items,(e=>e.itemType===yr.STORM));e&&e.canActivate()&&(this.startGuide(sp)||this.startStormGuide())}))),this.guideStormDelay.stop(),this.guideStormDelay.start()}startThunderGuide(){return!this.isNewbieGuideLevel()&&this.startGuide(ap)}startPliersGuide(){return!this.isNewbieGuideLevel()&&this.startGuide(op)}handleUseItem(e){switch(this.startAutoGuides(),e){case yr.HINT:this.addGuideItemShowed(np);break;case yr.THUNDER:this.addGuideItemShowed(ap);break;case yr.STORM:this.addGuideItemShowed(sp);break;case yr.PLIERS:this.addGuideItemShowed(op)}}async skipNewbieGuide(){this.guideSkipButton.active=!1,await this.guide1.close();const e=this.getCurrentLevel()+1;Pm.setGameData({level:e}),this.node.scene.emit(Ga.NEXT_LEVEL)}}).prototype,"guideHand",[ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tm=ve(Em.prototype,"guideTextBox",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Am=ve(Em.prototype,"guideInfoText",[fm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rm=ve(Em.prototype,"guideMasks",[wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Im=ve(Em.prototype,"guideSkipButton",[Sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm=Em))||vm);var zm,Um,Gm,Hm,Vm,qm,Wm,Km,Ym,jm,Xm,$m,Qm,Jm,Zm,eg,tg,ig,ng;i._RF.pop(),i._RF.push({},"c3d9fl9+INO3ac7Q2zvmRKy","SpecialItem",void 0);const{ccclass:ag,property:sg}=a;let og=(zm=ag("SpecialItem"),Um=sg({editorOnly:!0,tooltip:"A debug button has infinite quantity"}),Gm=sg({type:p,tooltip:"The button that activates the item"}),Hm=sg({type:f,group:"Quantity",tooltip:"The starting quantity of the item",displayName:"Quantity"}),Vm=sg({type:h,group:"Quantity",tooltip:"The label that shows the quantity",displayName:"Label"}),qm=sg({type:n,group:"Quantity",tooltip:"The node that shows the quantity of the item",displayName:"Quantity node"}),Wm=sg({type:n,group:"Quantity",tooltip:"The node that shows the plus icon when there is no item",displayName:"Plus node"}),Km=sg({type:x,group:"Animation"}),Ym=sg({type:x,tooltip:"The opacity component of the button",displayName:"Button UI Opacity"}),zm(($m=ve((Xm=class extends s{constructor(){super(...arguments),e(this,"isDevButton",$m,this),e(this,"button",Qm,this),e(this,"quantity",Jm,this),e(this,"quantityLabel",Zm,this),e(this,"quantityNode",eg,this),e(this,"plusNode",tg,this),e(this,"glowUIOpacity",ig,this),e(this,"uiOpacity",ng,this),this.requestItem=null,this.loadQuantity=null}get itemType(){}onLoad(){this.validateRequiredComponents()}init(e){this.node.scene.on(Ga.GRID_CREATE,this.applyActivationStatus,this),this.node.scene.on(Ga.GRID_MATCH,this.applyActivationStatus,this),this.node.scene.on(Ga.GRID_CLEAR,this.applyActivationStatus,this),this.node.scene.on(Ga.IDLE_EXIT,(()=>{this.button.interactable=!1,this.applyActivationStatus()})),this.node.scene.on(Ga.IDLE_ENTER,(()=>{this.button.interactable=!0,this.applyActivationStatus()}))}start(){const e=this.loadQuantity();this.setQuantity(e)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async applyActivationStatus(){const e=this.canActivate();this.button.interactable=e,await vt.runTweenAsync(E(this.uiOpacity).to(.2,{opacity:e?255:128}))}async activate(){this.quantity<=0?this.requestItem():(this.vibrate(),this.setQuantity(this.quantity-1))}canActivate(){return!1}setQuantity(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.isDevButton)return this.quantityLabel.string="i",this.quantityNode.active=!0,this.plusNode.active=!1,void this.applyActivationStatus();e<0&&(e=0),this.quantity=e,this.quantityLabel.string=`${this.quantity}`,e<=0?(this.quantityNode.active=!1,this.plusNode.active=!0):(this.quantityNode.active=!0,this.plusNode.active=!1),t&&this.animateAddItem(),this.applyActivationStatus(),this.saveQuantity()}getQuantity(){return this.quantity}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;this.isDevButton||t&&this.setQuantity(e,t.animate)}vibrate(){P("Vibrate")?.getComponent(mr)?.vibrate(50)}async animateAddItem(){return this.glowUIOpacity.opacity=0,Promise.all([vt.runTweenAsync(E(this.node).to(.1,{scale:new j(1.15,1.15,1.15)},{easing:"cubicOut"}).delay(.2).to(.7,{scale:j.ONE},{easing:"elasticOut"})),vt.runTweenAsync(E(this.glowUIOpacity).to(.1,{opacity:100}).delay(.2).to(.6,{opacity:0}))])}}).prototype,"isDevButton",[Um],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Qm=ve(Xm.prototype,"button",[Gm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jm=ve(Xm.prototype,"quantity",[Hm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Zm=ve(Xm.prototype,"quantityLabel",[Vm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eg=ve(Xm.prototype,"quantityNode",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tg=ve(Xm.prototype,"plusNode",[Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ig=ve(Xm.prototype,"glowUIOpacity",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ng=ve(Xm.prototype,"uiOpacity",[Ym],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jm=Xm))||jm);var rg;i._RF.pop(),i._RF.push({},"e1fd9AcoshNdK0i6vow/F2P","ItemManager",void 0);const{ccclass:lg}=a;let cg=lg("ItemManager")(rg=class extends s{constructor(){super(...arguments),this.sceneItems=new Set}get items(){return[...this.sceneItems]}onLoad(){this.syncItems()}syncItems(){const e=P("Canvas/UI");if(!e)return;e.getComponentsInChildren(og).forEach((e=>{e.node.activeInHierarchy&&this.sceneItems.add(e)}))}})||rg;var hg;i._RF.pop(),i._RF.push({},"bbe87JDGgVEkJdgCL2ydwxX","LevelManager",void 0);const{ccclass:dg}=a,{Utils:{Device:ug,String:pg}}=GameCore,mg={level:1,mode:"normal",time:900,colors:12,specials:{bomb:0,rocket:0},rules:{maxSpaceOfPair:1,addRandomTilesPerMove:0},columns:5,rows:6,theme:["flower"]};let gg=dg("LevelManager")(hg=class extends s{async loadLevel(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Jr;const i=await this.loadLevelData(e);this.levelData=i||this.levelData||mg;const{rows:n,columns:a}=this.levelData;ug.isMobile()&&a>=6&&n>=10&&(this.levelData.columns=5,this.levelData.rows=10);const s=`${oi.TILE_SKIN_FOLDER}/${t}`;return await ci.loadSpriteFramesDirAsync(s)}async loadLevelData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=this.paddingZero(`${Math.floor(e/10)+1}`,3),i=e%10,n=await ci.loadJsonAsync(`${oi.LEVEL_DATA_FOLDER}/${t}`);return n?n[i]:null}getLevelData(){return this.levelData}paddingZero(e,t){let i="";for(let n=0;n<t-e.length;n++)i+="0";return i+e}})||hg;var yg;i._RF.pop(),i._RF.push({},"3f8fenpEyBKaaNxBYL5960v","ScoreManager",void 0);const{ccclass:bg}=a,{Match:{Modes:fg}}=GameCore;let wg=bg("ScoreManager")(yg=class extends s{constructor(){super(...arguments),this.currentScore=0,this.tournamentStartScore=0}addScore(e,t,i){const n=this.getLevelMultiplier(t),a=this.getComboMultiplier(i),s=Math.floor(this.currentScore+e*n*a),o=10*Math.ceil(s/10);this.setScore(o)}init(){this.initCurrentScore(),this.updateScore()}initCurrentScore(){const e=wl.getMatchMode();this.currentScore=e===fg.TOURNAMENT?this.tournamentStartScore:0}setScore(e){this.currentScore=e,this.updateScore()}updateTournamentStartScore(){this.tournamentStartScore=this.currentScore}updateScore(){this.node.scene.emit(Ga.SCORE_UPDATED,this.currentScore)}getCurrentScore(){return this.currentScore}getLevelMultiplier(e){return 1+.1*(e-1)}getComboMultiplier(e){return 1+.1*(e-1)}})||yg;i._RF.pop(),i._RF.push({},"4a4bfX6KIJCcIozlNHuAwoi","AdsUtils",void 0);const{Configs:Sg,Plugins:{Ads:{Types:vg,Status:Eg}},Utils:{Array:Cg}}=GameCore,{ads:Tg}=globalThis.game;class Ag{static get inst(){return this._instance||(this._instance=new Ag),this._instance}static async preloadAds(){const{Enabled:e,InterstitialAdOptions:t,RewardedVideoAdOptions:i}=Sg.Ads;if(!e)return;const{INTERSTITIAL:n,REWARDED_VIDEO:a}=vg;t.forEach((e=>{const{PlacementId:t}=e;Tg.loadAdAsync(n,t).catch((()=>{}))})),i.forEach((e=>{const{PlacementId:t}=e;Tg.loadAdAsync(a,t).catch((()=>{}))}))}static showBannerAds(){const{Enabled:e,BannerDisplayAdOptions:t}=Sg.Ads;if(!e)return;const i=le.instance.getVisibleSize(),n=Xi.worldSizeToCssSize(i.height*gr);t.forEach((e=>{let{PlacementId:t,Position:i,BannerHeight:a}=e;"bottom"===i&&a>n||Tg.showBannerAdAsync(t).catch((e=>{}))}))}static hideBannerAds(){const{Enabled:e,BannerDisplayAdOptions:t}=Sg.Ads;e&&t.forEach((e=>{let{PlacementId:t}=e;Tg.hideBannerAdAsync(t).catch((e=>{}))}))}static async showInterstitialAdAsync(e){const{forLevel:t=1,includeSDK:i,excludeSDK:n}=e;if(!this.inst.canbeShowInSDK(i,n))return!1;if(Sg.Gameplay.StartAdAtLevel>=t)return!1;if(!Tg.canbeShowInterstitialAd())return!1;const a=Date.now();try{ji.muteAudio(!0),ql.showLoadingNotificationScreen();return Tg.getAdStatus(vg.INTERSTITIAL)!==Eg.FILLED&&await Tg.loadAdAsync(vg.INTERSTITIAL),await Tg.showAdAsync(vg.INTERSTITIAL),!0}catch(e){return console.warn("showInterstitialAdAsync failed",e),!1}finally{ji.muteAudio(!1);const e=(Date.now()-a)/1e3;setTimeout((()=>{ql.closeNotificationScreen()}),e>.5?0:.5),Tg.loadAdAsync(vg.INTERSTITIAL).catch((()=>{}))}}static async showRewardVideoAdAsync(e){const{includeSDK:t,excludeSDK:i}=e;if(!this.inst.canbeShowInSDK(t,i))return!1;try{ji.muteAudio(!0),ql.showLoadingNotificationScreen();return Tg.getAdStatus(vg.REWARDED_VIDEO)!==Eg.FILLED&&await Tg.loadAdAsync(vg.REWARDED_VIDEO),await Tg.showAdAsync(vg.REWARDED_VIDEO),ql.closeNotificationScreen(),!0}catch(e){if(console.warn("showRewardVideoAdAsync failed",e),e instanceof Object&&"code"in e&&"USER_INPUT"===e.code){const e="Sorry, no rewards!\n You have cancelled the ad.";ql.showNotificationScreen(e,2)}else ql.showNotificationScreen("No ads to display.",2);return!1}finally{ji.muteAudio(!1),Tg.loadAdAsync(vg.REWARDED_VIDEO).catch((()=>{}))}}canbeShowInSDK(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const i=GameSDK.getSDKName();return(!t?.length||!Cg.has(t,i))&&!(e?.length&&!Cg.has(e,i))}}try{new Ag}catch(e){console.error("AdsUtils",e)}i._RF.pop(),i._RF.push({},"e6116mseMNPD6VcLUtkvez6","BaseState",void 0);class Rg{constructor(e){this.game=null,this.data={},this.game=e.getGameplay(),this.manager=e,this.updateStateData(),this.logDebug()}logDebug(){const e=this.constructor.name;console.info(`[STATE] ${e}`,this.data)}updateStateData(){if(!this.game)return;const e=this.game.getGameData();e&&(this.data=e)}updateGameData(e){this.game?.setGameData(e)}}i._RF.pop(),i._RF.push({},"e4ee7Ho9zJPVKobpdsCwGlp","FailState",void 0);const{analytics:Ig,monitorError:Pg,match:_g,player:Lg,storage:Dg}=globalThis.game,{Match:{Modes:Og},Dtos:{Match:{Data:Ng}}}=GameCore;class Mg extends Rg{constructor(e,t){super(e),ji.stopAllSounds(),this.vibrateDevice(),this.pauseCountdown(),this.updateMatchCustomData(),this.handleGameOver(t),this.logLevelFailAnalytics()}pauseCountdown(){this.game?.uiManager.pauseTime()}vibrateDevice(){P("Vibrate")?.getComponent(mr)?.vibrate(500)}async handleGameOver(e){const t=wl.getMatchMode();if(ci.setBlockInput(!0),t===Og.SINGLE)return await this.handleTournamentCreateFlow(),void this.showFailScreen(e);if(t===Og.TOURNAMENT)await this.handleTournamentGameOver();else{if(t!==Og.CHALLENGE_FRIEND)return void this.showFailScreen(e);await this.handleChallengeGameOver()}ci.setBlockInput(!1)}async handleTournamentCreateFlow(){try{await wl.processCreateTournamentAsync()}catch(e){if(e instanceof Xr)return;return e instanceof jr&&Pg?.sendException(e),void console.error(e)}}async handleTournamentGameOver(){const e=wl.getMatchCustomData()?.tournamentId;if(!e)return;if(Ql.validateTournamentExpired(e)){Dg.setStorageData("tournament","animateTournamentLeader",!1);const e=2;return ql.showNotificationScreen("Tournament has ended",e),void this.game?.scheduleOnce((()=>{this.game?.node.scene.emit(Ga.GAME_EXIT)}),e)}try{await wl.finishMatchAsync();const{profiles:e}=_g.getMatchState(),t=Dg.getStorageData("tournament","previousScore")??0;(e[Lg.getPlayerId()].score??0)>t&&Dg.setStorageData("tournament","animateTournamentLeader",!0)}catch(e){console.warn(e)}this.game?.node.scene.emit(Ga.GAME_EXIT)}async handleChallengeGameOver(){try{const{id:e}=_g.getMatchState(),t=await _g.api.getMatchAPI().getMatchDetailByIdAsync(e),i=new Ng(t).toObject().extraData;await wl.finishMatchAsync({extraData:i??void 0})}catch(e){console.warn(e)}this.game.node.scene.emit(Ga.SHOW_CHALLENGE_RESULTS)}async showFailScreen(e){const{level:t}=this.data;this.game&&await Ag.showInterstitialAdAsync({forLevel:t}),ji.turnOffMusic(),e===Jl&&ji.playSound(Fi.LEVEL_FAIL_TIMEOUT),ji.playSound(Fi.LEVEL_FAIL),ql.openScreen(Gi.RESCUES_SCREEN,{level:t,failKey:e})}updateMatchCustomData(){const{level:e=1}=this.data,t=this.game?.scoreManager.getCurrentScore()??0;wl.updateMatchStateAfterLevelFinish(e,t)}logLevelFailAnalytics(){if(!this.game)return;const{level:e=0}=this.data,t=this.game.scoreManager.getCurrentScore();Ig.levelFail(e,t)}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){}playing(){const e=this.manager.createPlayingState(this.manager);this.manager.change(e)}fail(){}finish(){const e=this.manager.createFinishState(this.manager);this.manager.change(e)}update(){}}i._RF.pop(),i._RF.push({},"a9bc11SkV9L/5L+Y+fhswfJ","FinishState",void 0);const{analytics:kg,player:xg,leaderboard:Fg,match:Bg,monitorError:zg}=globalThis.game,{Match:{Modes:Ug}}=GameCore;class Gg extends Rg{constructor(e){super(e),this.handleFinishStateFlow()}async handleFinishStateFlow(){this.processCrazyGamesEvent(),this.attemptCallCreateShortcut(),ji.turnUpMusic(),this.game?.uiManager.pauseTime();const e=wl.getMatchMode();e!==Ug.CHALLENGE_FRIEND&&this.updatePlayerProgress(),this.updateMatchCustomData(),this.handlePostScoreToLeaderboard(),e===Ug.CHALLENGE_FRIEND?this.handleChallengeOver():(await this.handleTournamentCreateFlow(),this.showLevelCompleteScreen()),this.logLevelCompleteAnalytics()}async handleChallengeOver(){try{const{id:e}=Bg.getMatchState(),t=await wl.getMatchExtraDataAsync(e);await wl.finishMatchAsync({extraData:t??void 0})}catch(e){console.warn(e),await wl.finishMatchAsync()}this.game.node.scene.emit(Ga.SHOW_CHALLENGE_RESULTS)}processCrazyGamesEvent(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}updateMatchCustomData(){const{level:e=1}=this.data,t=this.game?.scoreManager.getCurrentScore()??0;wl.updateMatchStateAfterLevelFinish(e,t)}logLevelCompleteAnalytics(){if(!this.game)return;const{level:e=0}=this.data,t=this.game.scoreManager.getCurrentScore();kg.levelComplete(e,t)}async showLevelCompleteScreen(){const{level:e}=this.data;ji.turnOffMusic(),ji.playSound(Fi.LEVEL_COMPLETE);const t=xg.getGameData()?.coins??0;ql.openScreen(Gi.LEVEL_COMPLETE_SCREEN,{level:e,currentCoin:t})}updatePlayerProgress(){if(!this.game)return;const{level:e}=this.data;if(!e)return;const t=e+1,i=xg.getGameData();if(!i)return;const n=i.totalLevel,a=i.level,s=Math.max(a,t),o={...i};s<n&&(o.level=s),xg.setGameData(o)}attemptCallCreateShortcut(){const{level:e=0}=this.data;e<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((e=>{console.warn("createShortcutAsync",e)}))}async handleTournamentCreateFlow(){if(wl.getMatchMode()!==Ug.SINGLE)return;const e=xg.getGameData();if(!e)return;const{lastCreateTournamentShown:t=0}=e;if(Date.now()-t>3e5)try{await wl.processCreateTournamentAsync()}catch(e){if(e instanceof Xr)return;return e instanceof jr&&zg?.sendException(e),void console.error(e)}}async handlePostScoreToLeaderboard(){if(wl.getMatchMode()!==Ug.TOURNAMENT)return;const e=this.game?.scoreManager.getCurrentScore();if(!e)return;try{await GameSDK.tournament.postScoreAsync(e)}catch(e){console.warn("GameSDK post score async",e)}const t=wl.getMatchCustomData();if(!t)return;const{leaderboardId:i,playerId:n}=t;i&&n&&await Fg.setLeaderboardScoreAsync(i,n,e)}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){}playing(){}fail(){}finish(){}update(){}}i._RF.pop(),i._RF.push({},"37a5cRy3ANBGpVlH3wyS3Ra","InitializeState",void 0);const{player:Hg,match:Vg}=globalThis.game,{Match:{Modes:qg}}=GameCore;class Wg extends Rg{constructor(e){super(e),this.handleSingleGameStart=async e=>{const t=this.game.levelManager.getLevelData(),i=this.data.level,n=Hg.getPlayerId();await Promise.all([wl.setMatchCustomDataAsync({level:i,score:0}),wl.setProfileMatchDataAsync({id:n,score:0})]),this.game.board.create(e,t),this.game.board.setIgnoreInput(!0),await this.game.board.animateTilesAppear(),this.game.guidelinesManager?.isNewbieGuideLevel()||this.game.board.setIgnoreInput(!1),this.ready()},this.enableUI(),this.clearBoard(),this.loadLevel(),this.initCountdown(),this.initScore()}enableUI(){this.game?.uiManager.enableHeader()}clearBoard(){this.game&&(this.game.rescueTiles=[],this.game.board.destroyTiles(),this.game.pathDraw.clearMatchPath())}async loadLevel(){if(!this.game)return;const e=wl.getMatchMode();try{if(e===qg.CHALLENGE_FRIEND){const{id:e}=Vg.getMatchState(),t=await wl.getMatchExtraDataAsync(e);if(null==t)throw new Error(`Match mode ${qg.CHALLENGE_FRIEND} but no extraData (for opponent initialization) was found in match data.`);const i=this.getLevelSkin(t.level),n=await this.game.levelManager.loadLevel(t.level,i);this.updateGameData({level:t.level,levelData:this.game.levelManager.getLevelData()}),ji.playSound(Fi.LEVEL_START),this.handleChallengeFriendGameStart(n,t)}else{const e=this.getLevelSkin(this.data.level),t=await this.game.levelManager.loadLevel(this.data.level,e);this.updateGameData({levelData:this.game.levelManager.getLevelData()}),ji.playSound(Fi.LEVEL_START),this.handleSingleGameStart(t)}}catch(e){console.error("Error loading level:",e);const t=this.getLevelSkin(this.data.level),i=await this.game.levelManager.loadLevel(this.data.level,t);this.updateGameData({levelData:this.game.levelManager.getLevelData()}),ji.playSound(Fi.LEVEL_START),this.handleSingleGameStart(i)}this.updateGameData({levelData:this.game.levelManager.getLevelData()})}getLevelSkin(e){const t=rl.getLevelSkin(e),i=rl.getUnlockedSkins();if(i.length<=1)return t;if(z.random()<=.5)return t;const n=i.indexOf(t);return i.splice(n,1),i[z.randomRangeInt(0,i.length)]}async handleChallengeFriendGameStart(e,t){const i=this.game.levelManager.getLevelData(),{level:n,fen:a,gravity:s,rules:o,time:r}=t,l=Hg.getPlayerId();await Promise.all([wl.setMatchCustomDataAsync({level:n,score:0}),wl.setProfileMatchDataAsync({id:l,score:0})]),this.game.board.create(e,{...i,level:n,customFen:a,mode:s,rules:o,time:r}),this.game.board.setIgnoreInput(!0),await this.game.board.animateTilesAppear(),this.game.board.setIgnoreInput(!1),this.ready()}initScore(){this.game&&this.game.scoreManager.initCurrentScore()}initCountdown(){this.game&&this.game.uiManager.initCountdown()}initialize(){}ready(){const e=this.manager.createReadyState(this.manager);this.manager.change(e)}pause(){}playing(){}fail(){}finish(){}update(){}}i._RF.pop(),i._RF.push({},"e3b372NaI5HvY5HnTleBQKd","PlayingState",void 0);class Kg extends Rg{constructor(e){super(e),this.startCountdown()}startCountdown(){this.game?.uiManager.startCountdown()}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){const e=this.manager.createReadyState(this.manager);this.manager.change(e)}playing(){}fail(e){const t=this.manager.createFailState(this.manager,e);this.manager.change(t)}finish(){const e=this.manager.createFinishState(this.manager);this.manager.change(e)}update(){this.updateStateData()}}i._RF.pop(),i._RF.push({},"5ef69tJ5eNNv7o22H/XfSD2","ReadyState",void 0);const{analytics:Yg,match:jg}=globalThis.game,{Utils:{Valid:Xg}}=GameCore;class $g extends Rg{constructor(e){super(e),ji.stopAllSounds(),ji.turnDownMusic(),this.handleGuideFlow(),this.setLevelText(),this.setLevelTime(),this.setGridPlayable(),this.logLevelStartAnalytics()}initialize(){const e=this.manager.createInitializeState(this.manager);this.manager.change(e)}ready(){}playing(){const e=this.manager.createPlayingState(this.manager);this.manager.change(e)}fail(e){if(!Xg.isDebugger())return;const t=this.manager.createFailState(this.manager);this.manager.change(t)}finish(){if(!Xg.isDebugger())return;const e=this.manager.createFinishState(this.manager);this.manager.change(e)}update(){}setGridPlayable(){this.manager.getGameplay().guidelinesManager?.isNewbieGuideLevel()||this.manager.getGameplay().board.setIgnoreInput(!1)}handleGuideFlow(){this.game.guidelinesManager?.isNewbieGuideLevel()||this.game.handleShowUI(),this.game.guidelinesManager?.show()}setLevelTime(){if(!this.game)return;const{levelData:e}=this.data;e&&this.game.uiManager.setCountdownTime(e.time)}setLevelText(){if(!this.game)return;const{level:e=0}=this.data;this.game.uiManager.setLevelText(e)}logLevelStartAnalytics(){if(!this.game)return;const{level:e=0}=this.data,t=jg.getMatchState(),{score:i=0}=t.customData;Yg.levelStart(e,i)}}var Qg;i._RF.pop(),i._RF.push({},"bb0e3beWSxOOLCv7gjyg2s0","StateManager",void 0);const{ccclass:Jg}=a;let Zg=Jg("StateManager")(Qg=class extends s{getGameplay(){return this.gameplay}init(e){this.gameplay=e,this.state=new Wg(this)}change(e){this.state=e}initialize(){this.state.initialize()}isInitialize(){return this.state instanceof Wg}ready(){this.state.ready()}isReady(){return this.state instanceof $g}playing(){this.state.playing()}isPlaying(){return this.state instanceof Kg}fail(e){this.state.fail(e)}isFail(){return this.state instanceof Mg}finish(){this.state.finish()}isFinished(){return this.state instanceof Gg}update(e){this.state&&this.state.update(e)}createInitializeState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Wg(...t)}createReadyState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new $g(...t)}createPlayingState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Kg(...t)}createFailState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Mg(...t)}createFinishState(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return new Gg(...t)}})||Qg;var ey,ty,iy,ny,ay;i._RF.pop(),i._RF.push({},"659a5DHz/dCjaYaS9/4ZunE","Digit",void 0);const{ccclass:sy,property:oy}=a;let ry=(ey=sy("Digit"),ty=oy(h),ey((ay=ve((ny=class extends s{constructor(){super(...arguments),e(this,"numberLabels",ay,this),this.labelUITransforms=[],this.labelUIOpacitys=[],this.previousNumber=0}onLoad(){this.uiTransform=this.getComponent(l),this.labelUITransforms=this.numberLabels.map((e=>e.getComponent(l))),this.labelUIOpacitys=this.numberLabels.map((e=>e.getComponent(x))),Fe.lazyValidateProperties(this)}setNumber(e){this.previousNumber!==e&&(this.labelUIOpacitys[this.previousNumber].opacity=0,this.numberLabels[e].node.active||(this.numberLabels[e].node.active=!0),this.labelUIOpacitys[e].opacity=255,this.uiTransform.setContentSize(this.labelUITransforms[e].contentSize),this.previousNumber=e)}}).prototype,"numberLabels",[ty],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iy=ny))||iy);var ly,cy,hy,dy,uy,py,my;i._RF.pop(),i._RF.push({},"9e40aEq56tMKLFoeACyl+eH","Clock",void 0);const{ccclass:gy,disallowMultiple:yy,property:by}=a;let fy=(ly=gy("Clock"),cy=by(n),hy=by(ry),ly(dy=yy((py=ve((uy=class extends s{constructor(){super(...arguments),e(this,"clockIcon",py,this),e(this,"digits",my,this),this.time=0,this.remaining=0,this.running=!1,this.halfTime=!1,this.handleUpdateConfig=e=>{this.enabled&&console.log("Clock: handleUpdateConfig",e)},this.refillTime=()=>{const e=Date.now(),t=E(this.node).to(.5,{scale:new j(1.1,1.1,1)}),i=E(this.node).to(.5,{scale:new j(1,1,1)}),n=E(this.clockIcon).to(.15,{angle:-15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}).to(.15,{angle:15},{easing:"cubicOut"}).to(.15,{angle:0},{easing:"cubicIn"}),a=E(this.clockIcon).repeat(5,n),s=E(this.node).to(3,{position:new j(0,0,0)},{onUpdate:()=>{const t=Date.now(),i=(t-e)/3e3>1?1:(t-e)/3e3,n=z.lerp(0,120,i);this.setTime(n)}}).call((()=>{this.setTime(120),i.start(),this.node.scene.emit(Ga.RESCUE_FINISHED)}));E(this.node).parallel(t,s).start(),a.start()}}__preload(){this.listenEvents()}start(){this.init()}init(){this.running=!1,this.halfTime=!1}listenEvents(){this.node.scene.on(Xn,this.handleUpdateConfig),this.node.scene.on(Ga.RESCUE_START,this.refillTime)}setTime(e){this.time=e,this.updateTimeLabel(e),this.remaining=e}startCountdown(){this.running=!0,this.remaining=this.time}pause(){this.running=!1}resume(){this.running=!0}endCountDown(){this.running=!1,this.remaining=0,this.node.scene.emit(Ga.TIME_OUT)}update(e){this.running&&(this.remaining<=0?this.endCountDown():(this.remaining-=e,!this.halfTime&&this.remaining<=this.time/2&&(this.halfTime=!0,this.node.scene.emit(Ga.HALF_TIME)),this.remaining>=0&&this.updateTimeLabel(this.remaining)))}updateTimeLabel(e){const t=this.convertSecondsToMmSs(e);for(let e=0;e<t.length;e++)this.digits[e].setNumber(parseInt(t[e]))}convertSecondsToMmSs(e){const t=Math.floor(e/60),i=Math.floor(e%60);return`${this.padZero(t)}${this.padZero(i)}`}padZero(e){return e<10?`0${e}`:`${e}`}}).prototype,"clockIcon",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),my=ve(uy.prototype,"digits",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),dy=uy))||dy)||dy);var wy;i._RF.pop(),i._RF.push({},"ed00dMDxYRJP4fZMawN9JnW","ComboProgressBar",void 0);const{ccclass:Sy}=a;let vy=Sy("ComboProgressBar")(wy=class extends s{start(){this.progressBar=this.getComponent(Gs),this.opacity=this.getComponent(x),this.comboTimer=0,this.isActive=!1,this.node.scene.on(Ga.COMBO_UPDATED,this.handleComboUpdated,this)}update(e){this.isActive&&(this.comboTimer>0?(this.comboTimer-=e,this.progressBar.progress=this.comboTimer/3):(this.isActive=!1,this.opacity.opacity=0,this.node.scene.emit(Ga.COMBO_ENDED)))}handleComboUpdated(e){0===e?this.opacity.opacity=0:e>0&&(this.isActive=!0,this.comboTimer=3),e>1&&(this.opacity.opacity=255)}pause(){this.isActive=!1}resume(){this.isActive=!0}})||wy;var Ey,Cy,Ty,Ay,Ry,Iy,Py,_y,Ly;i._RF.pop(),i._RF.push({},"46f05OkhTtGz6xBJuPMZGqH","ScoreBlock",void 0);const{ccclass:Dy,property:Oy}=a,{Utils:{Image:Ny}}=GameCore;let My=(Ey=Dy("ScoreBlock"),Cy=Oy(R),Ty=Oy(N),Ay=Oy(h),Ey((Py=ve((Iy=class extends s{constructor(){super(...arguments),e(this,"avatar",Py,this),e(this,"defaultAvatar",_y,this),e(this,"scoreText",Ly,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenGameEvents(){this.node.scene.on(Ga.SCORE_UPDATED,this.updateScore,this)}unListenGameEvents(){this.node.scene.off(Ga.SCORE_UPDATED,this.updateScore,this)}async updateInfo(e,t){t?(this.score=t,this.scoreText.string=t.toString()):(this.score=0,this.scoreText.string="0");try{const t=await Ny.loadImage(e);if(!t)return;const i=N.createWithImage(t);i.packable=!0,this.avatar.spriteFrame=i}catch{this.avatar.spriteFrame=this.defaultAvatar}}async updateScore(e){const t=e-this.score,i=E(this.node).to(.1,{},{onUpdate:(e,i)=>{if(!i)return;const n=Math.floor(t*i)+this.score;this.scoreText.string=n.toString()}});await vt.runTweenAsync(i),this.scoreText.string=e.toString(),this.score=e}}).prototype,"avatar",[Cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_y=ve(Iy.prototype,"defaultAvatar",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ly=ve(Iy.prototype,"scoreText",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry=Iy))||Ry);var ky,xy,Fy,By,zy,Uy,Gy,Hy,Vy,qy,Wy,Ky,Yy,jy,Xy,$y,Qy;i._RF.pop(),i._RF.push({},"61791zAr2tJR4p22EZ5QRfk","Header",void 0);const{ccclass:Jy,property:Zy}=a,{match:eb}=globalThis.game;let tb=(ky=Jy("Header"),xy=Zy(h),Fy=Zy(n),By=Zy(n),zy=Zy(n),Uy=Zy(n),Gy=Zy(My),Hy=Zy(My),ky((Wy=ve((qy=class extends s{constructor(){super(...arguments),e(this,"levelText",Wy,this),e(this,"settingNode",Ky,this),e(this,"homeNode",Yy,this),e(this,"leftNode",jy,this),e(this,"coinNode",Xy,this),e(this,"playerScoreBlock",$y,this),e(this,"opponentScoreBlock",Qy,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}handleClickedPauseGame(){this.showSettingScreen(),this.node.scene.emit(Ga.GAME_PAUSE)}handleReturnHome(){ql.openScreen(Gi.QUIT_LEVEL_SCREEN),this.node.scene.emit(Ga.GAME_PAUSE)}highlightCoinContainer(){const e=P("Canvas/Screens");if(!e)return;const t=this.coinNode.worldPosition.clone();this.coinNode.parent=e,this.coinNode.worldPosition=t}removeCoinContainerHighlight(){const e=this.coinNode.worldPosition.clone();this.coinNode.parent=this.leftNode,this.coinNode.worldPosition=e}showSettingScreen(){ql.openScreen(Gi.SETTINGS_SCREEN,{})}setLevelText(e){this.levelText.string=`Level ${e}`}setButtonsSelectable(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.enableBtnNode(this.settingNode,e,!0),this.enableBtnNode(this.homeNode,e,!0)}showChallengeScoreBlock(){const e=eb.getMatchState(),t=e.id,{playerId:i,opponentId:n}=e.customData;if(!t||!i||!n)return;this.playerScoreBlock.node.active=!0,this.opponentScoreBlock.node.active=!0,this.playerScoreBlock.listenGameEvents();const a=e.profiles[i],s=e.profiles[n];this.playerScoreBlock.updateInfo(a.photo,a.score),this.opponentScoreBlock.updateInfo(s.photo,s.score)}hideChallengeScoreBlock(){this.playerScoreBlock.node.active=!1,this.opponentScoreBlock.node.active=!1}enableBtnNode(e,t,i){const n=e.getComponent(p);if(n&&(n.interactable=t),e.active=i,i){e.getComponent(qn)}}}).prototype,"levelText",[xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ky=ve(qy.prototype,"settingNode",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yy=ve(qy.prototype,"homeNode",[By],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jy=ve(qy.prototype,"leftNode",[zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xy=ve(qy.prototype,"coinNode",[Uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$y=ve(qy.prototype,"playerScoreBlock",[Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qy=ve(qy.prototype,"opponentScoreBlock",[Hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vy=qy))||Vy);var ib,nb,ab,sb,ob;i._RF.pop(),i._RF.push({},"396015KIPBL3bHTUOHN7pCl","UIMasks",void 0);const{ccclass:rb,property:lb}=a;let cb=(ib=rb("UIMasks"),nb=lb(qn),ib((ob=ve((sb=class extends s{constructor(){super(...arguments),e(this,"background",ob,this)}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.background.node.active=!0,await this.background.changeStateFade(!0,.25)}async hide(){await this.background.changeStateFade(!1,.25),this.background.node.active=!1}}).prototype,"background",[nb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ab=sb))||ab);i._RF.pop(),i._RF.push({},"805dbJxaCpKBpzq9ejSgrc8","TileType",void 0);const hb="bomb";var db,ub,pb,mb,gb;i._RF.pop(),i._RF.push({},"151afQBVDpOYpTjtwP+wYH+","DevTools",void 0);const{Dtos:{Player:yb},Utils:{Function:bb}}=GameCore,{ccclass:fb,property:wb}=a,{player:Sb}=globalThis.game;let vb=(db=fb("DevToolsContainer"),ub=wb(n),db((gb=ve((mb=class extends s{constructor(){super(...arguments),e(this,"devToolsToggle",gb,this),this.isActive=!0,this.game=null,this.debouncedStarsNotification=bb.debounce((()=>{const e=Sb.getGameData();e&&ql.showNotificationScreen(`Stars added. Current stars: ${e.stars}`)}),700)}injectGameplay(e){this.game=e}hideAllButtons(){this.getComponentsInChildren(p).forEach((e=>{const{parent:t}=e.node;t&&t.name!==this.devToolsToggle.name&&(t.active=!1)}))}showAllButtons(){this.getComponentsInChildren(p).forEach((e=>{const{parent:t}=e.node;t&&t.name!==this.devToolsToggle.name&&(t.active=!0)}))}handleClickDevToolsButton(){this.isActive?(this.hideAllButtons(),this.isActive=!1):(this.showAllButtons(),this.isActive=!0)}handleResetData(){Sb.setPlayerData(yb.Data.getDefaultData()),ql.openScreen(Gi.NOTIFICATION_SCREEN,{duration:3,message:"Items and stars will only be reset if you refresh the game page now."}),this.node.scene.emit(Ga.START_OVER)}async handleNextLevel(){const e=(this.game?.getGameData()?.level??1)+1;this.game?.setGameData({level:e-1}),Sb.setGameData({level:e}),this.node.scene.emit(Ga.NEXT_LEVEL)}async handlePrevLevel(){const e=Math.max((this.game?.getGameData()?.level??2)-1,1);this.game?.setGameData({level:e-1}),Sb.setGameData({level:e}),this.node.scene.emit(Ga.NEXT_LEVEL)}async handleEnterSelectLevel(e){const t=Number(e.string);this.game?.setGameData({level:t-1}),Sb.setGameData({level:t}),this.node.scene.emit(Ga.NEXT_LEVEL)}handleClickBuildVersionButton(){const e=globalThis.game.getBuildVersion();ql.showNotificationScreen(`Build version: ${e}`)}handleClickWinLevelButton(){this.node.scene.emit(Ga.GAME_FINISH)}handleClickTimeOutButton(){this.node.scene.emit(Ga.TIME_OUT)}handleClickExplodeButton(){const e=this.game;if(!e)return;const t=e.getGameData()?.levelData?.specials.bomb;if(!t||t<=0)return;const i=e.board.getBombTiles();if(0===i.length)return void console.info("No bomb tiles found");const n=i[0];if(n.special?.type!==hb)throw new Error("Invalid bomb tile");n.special.detonateImmediately()}handleFillItem(){this.node.scene.emit(Ga.ADD_ITEM,{animate:()=>Promise.resolve(),item:yr.HINT,quantity:2}),this.node.scene.emit(Ga.ADD_ITEM,{animate:()=>Promise.resolve(),item:yr.STORM,quantity:2}),this.node.scene.emit(Ga.ADD_ITEM,{animate:()=>Promise.resolve(),item:yr.THUNDER,quantity:2}),this.node.scene.emit(Ga.ADD_ITEM,{animate:()=>Promise.resolve(),item:yr.PLIERS,quantity:2})}handleAutoPlay(){this.node.scene.emit(Ga.AUTO_PLAY)}handleAddStars(){const e=Sb.getGameData();e&&(Sb.setGameData({stars:e.stars+10}),this.debouncedStarsNotification())}handleSwitchBundle(){W.emit(ea)}}).prototype,"devToolsToggle",[ub],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pb=mb))||pb);var Eb,Cb,Tb,Ab,Rb,Ib,Pb,_b,Lb,Db,Ob,Nb,Mb,kb,xb,Fb,Bb,zb,Ub;i._RF.pop(),i._RF.push({},"a3b0f6zU+1D97PyszsgST1H","UIManager",void 0);const{ccclass:Gb,property:Hb}=a,{Utils:{Valid:Vb},Match:{Modes:qb}}=GameCore,{match:Wb}=globalThis.game;let Kb=(Eb=Gb("UIManager"),Cb=Hb(fy),Tb=Hb(tb),Ab=Hb(vb),Rb=Hb(vy),Ib=Hb(n),Pb=Hb(cb),_b=Hb([n]),Lb=Hb([n]),Eb((Nb=ve((Ob=class extends s{constructor(){super(...arguments),e(this,"clock",Nb,this),e(this,"header",Mb,this),e(this,"devTools",kb,this),e(this,"comboProgressBar",xb,this),e(this,"comboContainer",Fb,this),e(this,"uiMasks",Bb,this),e(this,"topAnimNodes",zb,this),this.originTopNodesPos=[],e(this,"botAnimNodes",Ub,this),this.originBotNodesPos=[],this.hideBotWorldY=-80,this.entranceSignal=new si,this.exitSignal=new si,this.showDevTools=()=>{this.devTools&&(this.devTools.node.active=!0)}}onLoad(){this.validateRequiredComponents(),this.listensDevToolsEvents(),this.listenRescueEvents(),m.once(J.EVENT_AFTER_UPDATE,(()=>{this.saveOriginPos(),this.initUIPos()}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}saveOriginPos(){this.topAnimNodes.forEach((e=>{this.originTopNodesPos.push(e.position.clone())})),this.botAnimNodes.forEach((e=>{this.originBotNodesPos.push(e.position.clone())}))}initUIPos(){this.topAnimNodes.forEach(((e,t)=>{const i=this.originTopNodesPos[t].clone();i.y+=200,e.setPosition(i)}));const e=new j(0,this.hideBotWorldY,0);this.botAnimNodes.forEach(((t,i)=>{const n=this.originBotNodesPos[i].clone();e.y=this.hideBotWorldY;const a=t.parent?.inverseTransformPoint(e,e).y??200;n.y=a,t.setPosition(n)}))}listensDevToolsEvents(){this.node.scene.on(Ir.Events.UNLOCK_DEV_TOOLS,this.showDevTools)}listenRescueEvents(){this.node.scene.on(Ga.RESCUE_START,this.showRescueAnimation,this),this.node.scene.on(Ga.RESCUE_FINISHED,this.hideRescueAnimation,this)}initDevTools(e){window.addEventListener("reset-game-data",(()=>{this.devTools?.handleResetData()})),this.devTools&&(this.devTools.node.active=Vb.isDebugger(),this.devTools.injectGameplay(e))}setLevelText(e){this.header.setLevelText(e)}initCountdown(){this.clock.init()}setCountdownTime(e){this.clock.setTime(e)}startCountdown(){this.clock.startCountdown()}pauseTime(){this.comboProgressBar.pause(),this.clock.pause()}resumeTime(){this.comboProgressBar.resume(),this.clock.resume()}setComboUI(e){this.comboContainer.getComponent(qn).changeStateFade(e,.1)}disableHeader(){this.header.setButtonsSelectable(!1)}enableHeader(){this.header.setButtonsSelectable()}updateStatus(){const{mode:e}=Wb.getMatchState();e===qb.CHALLENGE_FRIEND?this.header.showChallengeScoreBlock():this.header.hideChallengeScoreBlock()}async showRescueAnimation(){await this.uiMasks.show()}async hideRescueAnimation(){await this.uiMasks.hide()}async playExitAnimUI(){this.entranceSignal.abort(),this.exitSignal.abort(),this.exitSignal=new si;const e=[];this.topAnimNodes.forEach(((t,i)=>{const n=new j(t.position.x,this.originTopNodesPos[i].y+200,0),a=E(t);a.to(.17,{position:n},{easing:"backIn"}),e.push(vt.runTweenAsync(a,this.exitSignal))}));const t=new j(0,this.hideBotWorldY,0);this.botAnimNodes.forEach((i=>{t.y=this.hideBotWorldY;const n=i.parent?.inverseTransformPoint(t,t).y??200,a=new j(i.position.x,n,0),s=E(i);s.to(.17,{position:a},{easing:"backIn"}),e.push(vt.runTweenAsync(s,this.exitSignal))})),await Promise.all(e),this.exitSignal.aborted||(this.header.node.active=!1)}async playEntranceAnimUI(){this.exitSignal.abort(),this.entranceSignal.abort(),this.entranceSignal=new si,this.header.node.active=!0;const e=[];this.topAnimNodes.forEach(((t,i)=>{const n=new j(t.position.x,this.originTopNodesPos[i].y,0),a=E(t);a.to(.2,{position:n},{easing:"backOut"}),e.push(vt.runTweenAsync(a,this.entranceSignal))})),this.botAnimNodes.forEach(((t,i)=>{const n=new j(t.position.x,this.originBotNodesPos[i].y,0),a=E(t);a.to(.2,{position:n},{easing:"backOut"}),e.push(vt.runTweenAsync(a,this.entranceSignal))})),await Promise.all(e)}highlightCoinContainer(){this.header.highlightCoinContainer()}unHighlightCoinContainer(){this.header.removeCoinContainerHighlight()}setInteractableItemButtons(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.botAnimNodes.forEach((t=>{const i=t.getComponent(og);if(i){if(!e)return void(i.button.interactable=!1);i.canActivate()&&(i.button.interactable=!0)}}))}}).prototype,"clock",[Cb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mb=ve(Ob.prototype,"header",[Tb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kb=ve(Ob.prototype,"devTools",[Ab],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xb=ve(Ob.prototype,"comboProgressBar",[Rb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fb=ve(Ob.prototype,"comboContainer",[Ib],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bb=ve(Ob.prototype,"uiMasks",[Pb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zb=ve(Ob.prototype,"topAnimNodes",[_b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ub=ve(Ob.prototype,"botAnimNodes",[Lb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Db=Ob))||Db);var Yb,jb,Xb,$b,Qb,Jb,Zb,ef,tf;i._RF.pop(),i._RF.push({},"157f203vjtMma2FDvAlyM6h","Gameplay",void 0);const{player:nf,ads:af,event:sf,match:of,storage:rf,analytics:lf,monitorError:cf,frameCapture:hf,leaderboard:df}=globalThis.game,{Events:uf,Utils:{Time:pf,Array:mf},Configs:{Gameplay:gf},Match:{Modes:yf}}=GameCore,{ccclass:bf,property:ff}=a;let wf=[];Yb=bf("Gameplay"),jb=ff(Zh),Xb=ff(qn),$b=ff(Yd),Yb((Zb=ve((Jb=class extends s{constructor(){super(...arguments),e(this,"board",Zb,this),e(this,"opacityToggler",ef,this),e(this,"pathDraw",tf,this),this.gameData=null,this.defaultData={level:1,isMatchStartFromLoader:!1},this.rescueTiles=[],this.isAutoPlayEnabled=!1,this.handleOpenScreen=e=>{const{screenName:t}=e;t===Hi[Gi.GET_ITEM_SCREEN]&&this.uiManager.highlightCoinContainer()},this.handleShowUI=async()=>{this.uiManager.updateStatus(),this.uiManager.disableHeader(),this.uiManager.setInteractableItemButtons(!1),await this.uiManager.playEntranceAnimUI(),this.uiManager.enableHeader(),this.uiManager.setInteractableItemButtons(!0)},this.handleHideUI=async()=>{this.uiManager.disableHeader(),this.uiManager.setInteractableItemButtons(!1),await this.uiManager.playExitAnimUI()},this.handleCloseScreen=e=>{let{screenName:t}=e;t===Hi[Gi.GET_ITEM_SCREEN]&&this.uiManager.unHighlightCoinContainer()},this.handlePauseGame=()=>{this.node.scene.emit(Ga.PAUSE_TIME),this.node.pauseSystemEvents(!0),this.opacityToggler.changeStateFade(!1,.1),this.uiManager.setComboUI(!1),this.processCrazyGamesGameplayStop()},this.handleResumeGame=()=>{this.node.resumeSystemEvents(!0),this.stateManager.isPlaying()&&this.node.scene.emit(Ga.RESUME_TIME),this.processCrazyGamesGameplayStart(),this.opacityToggler.changeStateFade(!0,.1),this.uiManager.setComboUI(!0),this.guidelinesManager?.startAutoGuides()},this.handleReplayGame=async e=>{this.handleHideHint();const t={...this.defaultData,...e};try{of.getMatchState().mode===yf.SINGLE&&await wl.finishMatchAsync(),of.getMatchState().mode!==yf.CHALLENGE_FRIEND&&await wl.startMatchAsync()}catch(e){console.warn("handleReplayGame",e)}this.setGameData(t),this.stateManager.initialize()},this.handleFinishGame=()=>{this.attemptCallCreateShortcut(),this.guidelinesManager?.isNewbieGuideLevel()?(this.guidelinesManager.guideSkipButton.active=!1,this.handleNextLevel()):this.stateManager.finish()},this.handleNextLevel=async()=>{if(!this.gameData)return;try{of.getMatchState().mode===yf.SINGLE&&await wl.finishMatchAsync(),of.getMatchState().mode===yf.TOURNAMENT&&this.scoreManager.updateTournamentStartScore(),await wl.startMatchAsync()}catch(e){console.warn("handleReplayGame",e)}const e=(this.gameData.level??1)+1;this.setGameData({level:e}),this.stateManager.initialize(),console.log("Next level",this.gameData.level)},this.handleStartOver=async()=>{nf.setGameData({level:gf.Tutorial.Enabled?0:1}),this.gameData=nf.getGameData(),this.stateManager.initialize(),console.info("Start over",this.gameData?.level)},this.handleMaxLevel=()=>{this.gameData&&(this.initData(),ql.openScreen(Gi.CONGRATULATION_SCREEN,{level:this.gameData.level}),console.info("Max level",this.gameData.level))},this.handleExitGame=async()=>{try{rf.setStorageData("dashboard","animateToCurrentLevel",!0),rf.setStorageData("collection","animateMapPackUnlock",!0)}catch(e){console.warn("handleExitGame",e)}},this.handleTileClick=e=>{this.stateManager.playing(),this.board.handleTileClick(e),this.handleHideHint()},this.handleGridMatchSuccess=(e,t)=>{this.pathDraw.drawMatchPath(e,(e=>{let{x:t,y:i}=e;return this.board.getAnyTileWorldPosition(t,i)})),this.comboManager.addCombo(),this.handleAddScore(),this.effectManager.playClearFXAt([t[0].node.worldPosition,t[1].node.worldPosition])},this.handleGridMatchFail=e=>{this.guidelinesManager?.isShowErrorPathLevel()&&this.pathDraw.drawErrorPath(e,(e=>{let{x:t,y:i}=e;return this.board.getAnyTileWorldPosition(t,i)}))},this.checkIfGameIsFinish=()=>{0===this.board.getUncleared().length&&this.node.scene.emit(Ga.GAME_FINISH)},this.handlePauseTime=()=>{this.uiManager.pauseTime()},this.handleResumeTime=()=>{this.uiManager.resumeTime()},this.handleClockTimeout=()=>{this.stateManager.fail(Jl)},this.handleHalfTime=()=>{void 0!==this.guidelinesManager&&(this.board.getUncleared().length>=this.board.getCleared().length&&this.guidelinesManager.startThunderGuide()||this.board.getBombTiles().length>0&&this.guidelinesManager.startPliersGuide())},this.handleStartRescue=()=>{for(ci.setBlockInput(!0),this.board.setIgnoreInput(!0);this.rescueTiles.length>0;){this.rescueTiles.pop()?.restore()}lf.levelRescue(this.gameData?.level??1)},this.handleFinishRescue=()=>{ci.setBlockInput(!1),this.board.setIgnoreInput(!1)},this.handleBombExplode=async e=>{this.rescueTiles.push(e),this.board.setIgnoreInput(!0),ci.getBlockInput()||(ji.playSound(Fi.BOMB_EXPLODE_1),ci.setBlockInput(!0));const t=e.node.worldPosition;await this.effectManager.createBombExplosionAt(new j(t.x,t.y,0)),ci.setBlockInput(!1),this.stateManager.isFail()||this.stateManager.fail(Zl)},this.handleShowHint=()=>{if(this.pathDraw.isDrawingHint)return;const e=this.board.getHintPath();e&&(ji.playSound(Fi.HINT_ITEM),this.pathDraw.drawHintPath(e,(e=>this.board.getAnyTileWorldPosition(e.x,e.y))),this.board.showHint())},this.handleHideHint=()=>{this.pathDraw.isDrawingHint&&(this.pathDraw.clearHintPath(),this.board.hideHint())},this.handleAddScore=()=>{const e=this.levelManager.getLevelData().level,t=this.comboManager.getCombo();this.scoreManager.addScore(10,e,t)},this.handleUseItem=e=>{this.stateManager.playing(),e!==yr.HINT&&this.handleHideHint()},this.handleAutoPlay=()=>{this.isAutoPlayEnabled?this.disableAutoPlay():this.enableAutoPlay()},this.enableAutoPlay=()=>{this.isAutoPlayEnabled=!0;this.node.scene.once(Ga.GAME_FINISH,(()=>{this.disableAutoPlay()})),this.schedule(this.autoPlay,.5)},this.disableAutoPlay=()=>{this.isAutoPlayEnabled=!1,this.unschedule(this.autoPlay)},this.autoPlay=()=>{const e=this.board.getHintPath();if(!e)throw new Error("No path found");{const t=e[0].a,i=e.slice(-1)[0].b,n=this.board.getTileAt(t.x,t.y),a=this.board.getTileAt(i.x,i.y);if(!n||!a)throw new Error("Tile is null");n.onClick(),a.onClick()}},this.handleAddStars=e=>{const t=nf.getGameData();if(!t)return Promise.resolve([]);nf.setGameData({stars:t.stars+1});const{startAnimationAt:i}=e;i&&this.effectManager.playStarFXAt(i)},this.handleInviteFriends=async()=>{try{ql.showLoadingScreen();const e=this.board.generateFenFromCurrentLevel();let{level:t=1}=nf.getGameData()??{};t=Math.max(1,t);const{mode:i="",rules:n={addRandomTilesPerMove:0,maxSpaceOfPair:0},time:a=0}=this.gameData?.levelData??{};hf.addWideframeRender("renderResultChallenge",qr),await of.context.choose.processAsync({playerId:nf.getPlayerId(),fallbackSingleMode:!1,extraData:{level:t,fen:e,gravity:i,rules:n,time:a}}),ql.closeLoadingScreen(),this.node.scene.emit(Ga.GAME_RESUME),this.node.scene.emit(Ga.GAME_REPLAY,{level:t})}catch(e){if(console.warn("Unable to invite friends",e),ql.closeLoadingScreen(),ql.showNotificationScreen("Sorry, please try again later"),!(e instanceof Error))return;cf?.sendException(e),this.node.scene.emit(Ga.GAME_RESUME),this.node.scene.emit(Ga.SHOW_UI)}},this.handleReplayFriends=async()=>{const{level:e=1}=nf.getGameData()??{};try{const{opponentId:t}=of.getMatchState().customData;if(!t)throw new Error("Opponent id is not found");ql.showLoadingScreen();const i=this.board.generateFenFromCurrentLevel(),{mode:n="",rules:a={addRandomTilesPerMove:0,maxSpaceOfPair:0},time:s=0}=this.gameData?.levelData??{};await of.challenge.friend.processAsync({playerId:nf.getPlayerId(),opponentId:t,extraData:{level:e,fen:i,gravity:n,rules:a,time:s}}),ql.closeLoadingScreen(),this.node.scene.emit(Ga.GAME_RESUME),this.node.scene.emit(Ga.GAME_REPLAY,{level:e})}catch(t){if(console.warn("ReplayChallengeFriend",t),ql.closeLoadingScreen(),ql.showNotificationScreen("Sorry, you cannot replay\nat this time.",3),!(t instanceof Error))return;cf?.sendException(t),this.node.scene.emit(Ga.GAME_RESUME),this.node.scene.emit(Ga.GAME_REPLAY,{level:e})}},this.handleAdShow=e=>{let{placementId:t}=e;t&&-1!==wf.indexOf(t)&&(wf.splice(wf.indexOf(t),1),af.hideBannerAdAsync(t).catch((()=>{})),0===wf.length&&sf.off(uf.AD_SHOWING,this.handleAdShow))},this.handleAddItem=async e=>{const{animate:t,item:i,quantity:n}=e,a=mf.search(this.itemManager.items,(e=>e.itemType===i));if(void 0===a)return void console.warn(`Item ${i} not found`);const s=a.getQuantity()+n;a.saveQuantity(s),this.uiManager.setInteractableItemButtons(!1),this.handlePauseGame(),await t(),a.setQuantity(s,!0),this.uiManager.setInteractableItemButtons(!0),this.handleResumeGame()}}__preload(){this.initComponents(),this.validateRequiredComponents(),this.listenCoreEvents(),this.listenInputEvents(),this.listenFlowEvents()}onLoad(){rl.init()}initComponents(){this.initUIManager(),this.initLevelManager(),this.initStateManager(),this.initEffectManager(),this.initItemManager(),this.initComboManager(),this.initScoreManager(),this.initInputController(),this.initGuidelinesManager()}initUIManager(){this.uiManager=this.node.parent?.getComponentInChildren(Kb),this.uiManager.initDevTools(this)}initLevelManager(){this.levelManager=this.getComponent(gg)}initStateManager(){this.stateManager=this.getComponent(Zg)}initInputController(){this.inputController=this.getComponent(ic)}initEffectManager(){this.effectManager=this.getComponent(Qu)}initItemManager(){this.itemManager=this.getComponent(cg),this.itemManager.syncItems(),this.itemManager.items.forEach((e=>{e.init(this)}))}initComboManager(){this.comboManager=this.getComponent($d),this.comboManager.init()}initScoreManager(){this.scoreManager=this.getComponent(wg),this.scoreManager.init()}initGuidelinesManager(){gf.Tutorial.Enabled&&(this.guidelinesManager=this.getComponent(Bm),this.guidelinesManager.init(this))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenCoreEvents(){wf=[],sf.off(uf.AD_SHOWING,this.handleAdShow),sf.clear(uf.OPENING_SCREEN),sf.clear(uf.CLOSING_SCREEN),sf.on(uf.OPENING_SCREEN,this.handleOpenScreen),sf.on(uf.CLOSING_SCREEN,this.handleCloseScreen)}listenInputEvents(){this.node.scene.on(Ga.SHOW_UI,this.handleShowUI),this.node.scene.on(Ga.HIDE_UI,this.handleHideUI),this.node.scene.on(Ga.GAME_PAUSE,this.handlePauseGame),this.node.scene.on(Ga.GAME_RESUME,this.handleResumeGame),this.node.scene.on(Ga.GAME_REPLAY,this.handleReplayGame),this.node.scene.on(Ga.GAME_FINISH,this.handleFinishGame),this.node.scene.on(Ga.NEXT_LEVEL,this.handleNextLevel),this.node.scene.on(Ga.START_OVER,this.handleStartOver),this.node.scene.on(Ga.MAX_LEVEL,this.handleMaxLevel),this.node.scene.on(Ga.GAME_EXIT,this.handleExitGame),this.node.scene.on(Ga.TILE_CLICK,this.handleTileClick),this.node.scene.on(Ga.GRID_MATCH_SUCCESS,this.handleGridMatchSuccess),this.node.scene.on(Ga.GRID_MATCH_FAIL,this.handleGridMatchFail),this.node.scene.on(Ga.PAUSE_TIME,this.handlePauseTime),this.node.scene.on(Ga.RESUME_TIME,this.handleResumeTime),this.node.scene.on(Ga.TIME_OUT,this.handleClockTimeout),this.node.scene.on(Ga.HALF_TIME,this.handleHalfTime),this.node.scene.on(Ga.RESCUE_START,this.handleStartRescue),this.node.scene.on(Ga.RESCUE_FINISHED,this.handleFinishRescue),this.node.scene.on(Ga.BOMB_EXPLODE,this.handleBombExplode),this.node.scene.on(Ga.SHOW_HINT,this.handleShowHint),this.node.scene.on(Ga.ADD_SCORE,this.handleAddScore),this.node.scene.on(Ga.GRID_CLEAR,this.checkIfGameIsFinish),this.node.scene.on(Ga.USE_ITEM,this.handleUseItem),this.node.scene.on(Ga.ADD_ITEM,this.handleAddItem),this.node.scene.on(Ga.AUTO_PLAY,this.handleAutoPlay),this.node.scene.on(Ga.ADD_STARS,this.handleAddStars)}listenFlowEvents(){this.node.scene.on(Ga.INVITE_FRIENDS,this.handleInviteFriends),this.node.scene.on(Ga.REPLAY_FRIENDS,this.handleReplayFriends)}start(){this.initDataFirstTime(),this.initGame(),this.trySetTournamentStorage()}initDataFirstTime(){const e=this.getSceneData();let{level:t}=e??{};void 0===t&&(t=wl.getMatchMode()===yf.TOURNAMENT?1:0),this.initData(),this.setGameData({level:t})}initData(){const{level:e=1,items:t}=nf.getGameData()??{};t&&this.checkItemsRewardable()&&(t.hint<5&&(t.hint+=1),t.thunder<5&&(t.thunder+=1),t.storm<5&&(t.storm+=1),t.pliers<5&&(t.pliers+=1),nf.setGameData({items:t,lastRewardedItems:Date.now()})),this.setGameData({...this.defaultData,level:e})}checkItemsRewardable(){const{lastRewardedItems:e=0}=nf.getGameData()??{};return!pf.isToday(e)}initGame(){this.stateManager.init(this),this.stateManager.initialize()}async trySetTournamentStorage(){if(wl.getMatchMode()!==yf.TOURNAMENT)return;const{leaderboardId:e}=wl.getMatchCustomData()??{};if(!e)return;await Ql.requestTournamentDataAsync();const t=df.getLeaderboardName(e);if(!t)return;const i=await df.getLeadersByPlayerIdsAsync(t,[nf.getPlayerId()]);if(0===i.length)return;const{score:n,rank:a}=i[0];rf.setStorageData("tournament","previousScore",n),rf.setStorageData("tournament","previousRank",a)}setGameData(e){const t=e.level??this.gameData?.level??1;this.gameData={...this.gameData,...e,level:t}}getGameData(){return this.gameData}getSceneData(){return El.getSceneData(this.node.scene)}attemptCallCreateShortcut(){const{level:e=0,nextLevelCount:t=0}=this.getGameData()??{};e<2||t<2||"checkAndCreateShortcutAsync"in GameSDK.extra&&GameSDK.extra.checkAndCreateShortcutAsync().catch((e=>{console.warn("checkAndCreateShortcutAsync",e)}))}processCrazyGamesGameplayStart(){"gameplayStart"in GameSDK.extra&&GameSDK.extra.gameplayStart()}processCrazyGamesGameplayStop(){"gameplayStop"in GameSDK.extra&&GameSDK.extra.gameplayStop()}disableRewardAdsItemForCrazyGames(){GameSDK.getSDKName()}}).prototype,"board",[jb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ef=ve(Jb.prototype,"opacityToggler",[Xb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tf=ve(Jb.prototype,"pathDraw",[$b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qb=Jb));i._RF.pop(),i._RF.push({},"c863f/bTTdAjqEM+Kj9OaKi","DashboardEventButtonTypes",void 0);var Sf=function(e){return e[e.STAR_CHEST=0]="STAR_CHEST",e[e.BALLOON=1]="BALLOON",e}(Sf||{});I(Sf),i._RF.pop(),i._RF.push({},"17fa4eEXEhIfZh+ad9Oqcmw","Leaderboard",void 0);var vf=function(e){return e.WORLD_TAB_SELECTED="world-tab-selected",e.FRIENDS_TAB_SELECTED="friends-tab-selected",e}(vf||{});const Ef="#AE4212",Cf="#3D5172",Tf="#92200C",Af="#8F5542",Rf="#8A4733",If="#3e7110",Pf="#3e7110";var _f;i._RF.pop(),i._RF.push({},"4cd93d4ECxKDYSG9apAx603","LevelMission",void 0),i._RF.pop(),i._RF.push({},"78297LLtrJKMpOIidCw/BA9","index",void 0),i._RF.pop(),i._RF.push({},"176c3V0yoFEhIdpVcCIhDz7","isEmptyBoard",void 0),i._RF.pop(),i._RF.push({},"5262atLmldNy7Q3MtHgiSRI","HintItem",void 0);const{ccclass:Lf}=a,{player:Df,analytics:Of}=globalThis.game,{Plugins:{Analytics:{Events:Nf}}}=GameCore;Lf("HintItem")(_f=class extends og{constructor(){super(...arguments),this.requestItem=()=>{ql.openScreen(Gi.GET_ITEM_SCREEN,{item:yr.HINT,message:"Shows a pair of tiles\nthat can be connected.",quantity:1})},this.loadQuantity=()=>{const e=Df.getGameData();return e?.items&&e?e.items[yr.HINT]:0}}get itemType(){return yr.HINT}init(e){this.boardInstance=e.board,this.pathDrawer=e.pathDraw,this.setQuantity(this.loadQuantity()),super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getUncleared().length>0}catch(e){return!1}}async activate(){this.pathDrawer.isDrawingHint||(this.getQuantity()<=0?await super.activate():(await super.activate(),Of.event(Nf.USE_ITEM,{item_name:yr.HINT}),this.node.scene.emit(Ga.USE_ITEM,yr.HINT),this.node.scene.emit(Ga.SHOW_HINT)))}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=Df.getGameData();i&&Df.setGameData({items:{...i.items,[yr.HINT]:e}})}});var Mf;i._RF.pop(),i._RF.push({},"3f4c1AB+jdNFqylpogoaiDZ","PliersItem",void 0);const{ccclass:kf}=a,{player:xf,analytics:Ff}=globalThis.game,{Plugins:{Analytics:{Events:Bf}}}=GameCore;kf("PliersItem")(Mf=class extends og{constructor(){super(...arguments),this.requestItem=()=>{ql.openScreen(Gi.GET_ITEM_SCREEN,{item:yr.PLIERS,message:"Removes a random bomb\nfrom the game field.",quantity:1})},this.loadQuantity=()=>{const e=xf.getGameData();return e?.items&&e?e.items[yr.PLIERS]:0}}get itemType(){return yr.PLIERS}init(e){this.boardInstance=e.board,this.effectManager=e.effectManager,super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getBombTiles().length>0}catch(e){return!1}}async activate(){if(this.getQuantity()<=0)return void await super.activate();await super.activate(),Ff.event(Bf.USE_ITEM,{item_name:yr.PLIERS}),this.node.scene.emit(Ga.USE_ITEM,yr.PLIERS);const e=Xc(this.boardInstance.getBombTiles()),t=e.node.worldPosition;this.effectManager.createDefuseExplosionAt(new j(t.x,t.y,0)),ji.playSound(Fi.BOMB_DEFUSE),e.special.switch(uc.none),this.applyActivationStatus()}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=xf.getGameData();i&&xf.setGameData({items:{...i.items,[yr.PLIERS]:e}})}});var zf;i._RF.pop(),i._RF.push({},"d6e51+oy6NCF7cKvf6KOWiu","StormItem",void 0);const{ccclass:Uf}=a,{player:Gf,analytics:Hf}=globalThis.game,{Plugins:{Analytics:{Events:Vf}}}=GameCore;Uf("StormItem")(zf=class extends og{constructor(){super(...arguments),this.requestItem=()=>{ql.openScreen(Gi.GET_ITEM_SCREEN,{item:yr.STORM,message:"Randomly rearranges the \ntiles on the game field.",quantity:1})},this.loadQuantity=()=>{const e=Gf.getGameData();return e?.items&&e?e.items[yr.STORM]:0}}get itemType(){return yr.STORM}init(e){this.boardInstance=e.board,this.effectManager=e.effectManager,super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getUncleared().length>2}catch(e){return!1}}async activate(){if(this.getQuantity()<=0)return void await super.activate();await super.activate(),Hf.event(Vf.USE_ITEM,{item_name:yr.STORM}),this.node.scene.emit(Ga.USE_ITEM,yr.STORM),this.node.scene.emit(Ga.HIDE_UI);const e=new Promise((e=>this.scheduleOnce(e,.5)));await Promise.race([this.effectManager.loadTornadoAnimation(),e]);this.boardInstance.processShuffleRequest((async(e,t)=>{ji.muteMusic(!0),ji.playSound(Fi.SHUFFLE_ITEM),ji.playSound(Fi.WIND);await(()=>Promise.all(e.map(((t,i,n)=>t.sync({duration:.4,easing:"smooth",getTargetPosition:()=>Hc(e,this.boardInstance.getTileSize(),{x:i,y:n},10)})))))(),this.effectManager.playTornadoAnimation(),await(async()=>{t.forEach(((e,i,n)=>{e.node.setSiblingIndex(t.asArray().length-1-(i+n*t.width))})),await Promise.all(t.map((e=>e.fly({getTilePosition:e=>Hc(t,this.boardInstance.getTileSize(),e)}))))})(),this.node.scene.emit(Ga.SHOW_UI),ji.muteMusic(!1)}))}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=Gf.getGameData();i&&Gf.setGameData({items:{...i.items,[yr.STORM]:e}})}});var qf;i._RF.pop(),i._RF.push({},"b30ffJjU2lAH5yu2NkzVVnO","ThunderItem",void 0);const{ccclass:Wf}=a,{player:Kf,analytics:Yf}=globalThis.game,{Plugins:{Analytics:{Events:jf}}}=GameCore;Wf("ThunderItem")(qf=class extends og{constructor(){super(...arguments),this.requestItem=()=>{ql.openScreen(Gi.GET_ITEM_SCREEN,{item:yr.THUNDER,message:"Remove 2 pair of tiles\non the game field.",quantity:1})},this.loadQuantity=()=>{const e=Kf.getGameData();return e?.items&&e?e.items[yr.THUNDER]:0}}get itemType(){return yr.THUNDER}init(e){this.boardInstance=e.board,this.effectManager=e.effectManager,super.init(e)}onDestroy(){if(!this.boardInstance)return;this.node.scene.targetOff(this);const e=this.boardInstance.node;null!=e?(this.boardInstance.node.targetOff(this),super.onDestroy?.()):super.onDestroy?.()}validateRequiredComponents(){super.validateRequiredComponents(),Fe.lazyValidateProperties(this)}canActivate(){try{return this.boardInstance.getUncleared().length>=4}catch(e){return!1}}async activate(){if(this.getQuantity()<=0)return void await super.activate();await super.activate(),Yf.event(jf.USE_ITEM,{item_name:yr.THUNDER}),this.node.scene.emit(Ga.USE_ITEM,yr.THUNDER),this.node.scene.emit(Ga.HIDE_UI),await this.effectManager.loadThunderAnimation(),ji.muteMusic(!0);const e=this.boardInstance.getUncleared();if(e.length<4)throw new Error("Not enough uncleared tiles");const t=this.boardInstance.getPairs(2);ci.setBlockInput(!0),this.boardInstance.clearSelectedTile(),await this.effectManager.playThunderAnimation(t,this.boardInstance),e.length>4&&this.node.scene.emit(Ga.SHOW_UI),ji.muteMusic(!1),ci.setBlockInput(!1)}saveQuantity(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getQuantity(),t=arguments.length>1?arguments[1]:void 0;super.saveQuantity(e,t);const i=Kf.getGameData();i&&Kf.setGameData({items:{...i.items,[yr.THUNDER]:e}})}});var Xf;i._RF.pop(),i._RF.push({},"0a97aK0agJOHb07cLs0JICj","PathHolder",void 0);const{ccclass:$f,requireComponent:Qf}=a;$f("PathHolder")(Xf=Qf(x)(Xf=class extends s{onLoad(){this.node.scene.on(Ga.GRID_RESIZE,(e=>{this.node.setScale(e,e)}))}})||Xf);var Jf,Zf,ew,tw,iw,nw,aw,sw,ow,rw,lw,cw,hw;i._RF.pop(),i._RF.push({},"944cbG3+yRMsJZimXjukGdn","Coin",void 0);const{ccclass:dw,property:uw}=a;let pw=(Jf=dw("Coin"),Zf=uw(se),ew=uw(se),tw=uw(y),iw=uw(D),nw=uw(D),Jf((ow=ve((sw=class extends s{constructor(){super(...arguments),e(this,"explodeParticles",ow,this),e(this,"emittingParticles",rw,this),e(this,"animation",lw,this),e(this,"spin",cw,this),e(this,"rest",hw,this)}__preload(){Fe.lazyValidateProperties(this)}playAnimation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;e>0&&this.scheduleOnce((()=>{t?.aborted||this.animation.play(this.spin.name)}),e),this.animation.play(this.spin.name)}stopAnimation(){this.animation.play(this.rest.name)}}).prototype,"explodeParticles",[Zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rw=ve(sw.prototype,"emittingParticles",[ew],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lw=ve(sw.prototype,"animation",[tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cw=ve(sw.prototype,"spin",[iw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hw=ve(sw.prototype,"rest",[nw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aw=sw))||aw);var mw,gw,yw,bw,fw,ww,Sw;i._RF.pop(),i._RF.push({},"0c6a8vx5IhFvKJ5IUimm0Je","CoinTextPopup",void 0);const{ccclass:vw,property:Ew}=a,Cw=j.ZERO.clone().add3f(0,-100,0),Tw=j.ZERO.clone().add3f(0,100,0),{Utils:{Number:Aw}}=GameCore;let Rw=(mw=vw("CoinTextPopup"),gw=Ew(h),yw=Ew(x),mw((ww=ve((fw=class extends s{constructor(){super(...arguments),e(this,"label",ww,this),e(this,"uiOpacity",Sw,this)}__preload(){Fe.lazyValidateProperties(this),this.node.active=!1}async show(e,t){const i=Aw.getShortNumber(e,3);this.label.string=i,this.node.active=!0,this.uiOpacity.opacity=255,this.node.setScale(.5,.5,.5),this.node.setPosition(Cw),await Promise.all([vt.runTweenAsync(E(this.node).to(1.5,{position:Tw},{easing:"sineOut"}),t),vt.runTweenAsync(E(this.node).to(.5,{scale:j.ONE},{easing:"backOut"}),t)]),this.node.setScale(j.ONE),this.node.setPosition(Tw),
//! not subscribed to signal because in the case the user skipped the animation we'd still want them to see this node disappear
await vt.runTweenAsync(E(this.uiOpacity).to(.5,{opacity:0})),this.node.active=!1}}).prototype,"label",[gw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sw=ve(fw.prototype,"uiOpacity",[yw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bw=fw))||bw);var Iw,Pw,_w,Lw,Dw,Ow,Nw,Mw,kw;i._RF.pop(),i._RF.push({},"8a5c3m7o41LNqGBKPo0oqf1","CoinManager",void 0);const{ccclass:xw,disallowMultiple:Fw,property:Bw}=a,{player:zw,monitorError:Uw}=globalThis.game,Gw=999999999,Hw={MAX_COIN_COUNT:10,DISTANCE_RANGE:[1e3,1500],STAGGER:.03,FLOAT_DURATION:1,FLY_DURATION:1};let Vw=(Iw=xw("CoinManager"),Pw=Bw(_),_w=Bw(_),Lw=Bw(n),Iw(Dw=Fw((Nw=ve((Ow=class extends s{constructor(){super(...arguments),this.coins=0,e(this,"coinPrefab",Nw,this),e(this,"coinTextPopup",Mw,this),e(this,"coinAnimContainer",kw,this),this.collectionAnimSignal=null,this.coinObjects=[]}__preload(){this.lifeCycleSignal=new si,this.validateRequiredComponents(),this.getCoinsFromPlayerData()}onLoad(){this.prepareCoinCollection(),this.prepareCoinTextPopup(),this.listenToCoinEvents()}start(){this.emitCoinAmount()}init(e){this.updateCoins({coins:this.coins,collectionAnimation:void 0}),this.animSkipOverlay=e}listenToCoinEvents(){this.node.scene.on(Ga.ADD_COINS,this.addCoins,this),this.node.scene.on(Ga.REMOVE_COINS,this.removeCoins,this)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}prepareCoinCollection(){for(let e=0;e<Hw.MAX_COIN_COUNT;e++){const e=c(this.coinPrefab);e.setParent(this.coinAnimContainer),e.setPosition(0,0),e.active=!1,this.coinObjects.push(e.getComponent(pw))}}prepareCoinTextPopup(){const e=c(this.coinTextPopup);e.setParent(this.node),e.active=!1,this.coinTextPopupNode=e.getComponent(Rw)}async handleCollectionAnim(e,t,i){if(!this.targetContainer)return void console.warn("No target coin container assigned to CoinManager. No coin collection animation will be played");const n=this.coinObjects.slice(0,this.getShortAmount(e));if(0===n.length)return console.warn(`Requested coins amount is ${e}. Shortened to ${this.getShortAmount(e)}. No coin objects was found to animate collection.`),void Uw?.sendException(new Error(`Requested coins amount is ${e}. Shortened to ${this.getShortAmount(e)}. No coin objects was found to animate collection.`),{coins:e,animatedCoins:n.length,hasCoinTextPopup:!!this.coinTextPopupNode,hasTargetContainer:!!this.targetContainer,coinCollectionCount:this.coinObjects.length});await(this.animSkipOverlay?.open({onSkip:()=>this.collectionAnimSignal.abort(),opacity:150})),ji.playSound(Fi.COLLECT_STOCK_COINS);const a=n.map((async e=>{e.explodeParticles.stopSystem(),e.emittingParticles.stopSystem(),e.node.active=!0;const n=[0,.5*Math.min(t,i)],a=ne(...n),s=t-a,o=i+a;await this.animateCoinExplode(e.node,s),e.playAnimation(2*a,this.collectionAnimSignal),e.emittingParticles.resetSystem(),await this.animateCoinFlyBack(this.collectionAnimSignal,e,o),e.emittingParticles.stopSystem(),e.stopAnimation()}));await Promise.all([(async()=>{await Promise.all(a),await(this.targetContainer?.emitExplodeEffect(this.collectionAnimSignal))})(),this.animateCoinTextPopup(e,this.collectionAnimSignal,t+i/2)]),await(this.animSkipOverlay?.close()),this.collectionAnimSignal.abort()}async animateCoinTextPopup(e,t,i){await vt.waitTweenAsync(i,t),await this.coinTextPopupNode.show(e,t)}async animateCoinFlyBack(e,t,i){const n=t.node.worldPosition.clone(),a=j.ZERO.clone(),s=this.targetContainer.getCoinIconWorldScale();await vt.runTweenAsync(E(t.node).to(i,{scale:s},{onUpdate:(e,i)=>{if(void 0===i)return;const s=k.cubicIn(i),o=this.targetContainer.getCoinIconWorldPosition();t.node.worldPosition=j.lerp(a,n,o,s)}}),e),t.node.scale=j.ZERO,this.explodeParticlesAndDisableAfter(1,t)}async explodeParticlesAndDisableAfter(e,t){const i=t.explodeParticles;i.resetSystem(),await vt.waitTweenAsync(e/10,this.lifeCycleSignal),si.hasBeenAborted(this.lifeCycleSignal)||(i.stopSystem(),await vt.waitTweenAsync(e/10*9,this.lifeCycleSignal),si.hasBeenAborted(this.lifeCycleSignal)||(t.node.setPosition(0,0,t.node.position.z),t.node.active=!1))}async animateCoinExplode(e,t){const i=[-200,200],n=[-200,200],a=ne(i[0],i[1]),s=ne(n[0],n[1]);e.setPosition(0,0,e.position.z),e.setScale(j.ZERO);const o=new j(a,s,e.position.z);await Promise.all([vt.runTweenAsync(E(e).delay(.1*t).to(.8*t,{scale:j.ONE},{easing:"elasticOut"}),this.collectionAnimSignal),vt.runTweenAsync(E(e).to(t,{position:o},{easing:"circOut"}),this.collectionAnimSignal)])}getCoinsFromPlayerData(){const e=zw.getGameData();this.coins=e?e.coins:0}getCoins(){return this.coins}updateCoins(e){if(console.info("updateCoins",e.coins,e.collectionAnimation?.animateTextOnly),this.coins>Gw&&(this.coins=Gw),e.coins===this.coins)return;const t=Math.max(0,e.coins-this.coins);this.coins=e.coins,zw.setGameData({coins:this.coins});const{collectionAnimation:i}=e;if(void 0===i||i.animateTextOnly)return void this.node.scene.emit(Ga.COIN_CHANGED,{...e,collectionAnimation:{animateTextOnly:!0,signal:this.collectionAnimSignal}});this.collectionAnimSignal?.abort();const{floatDuration:n=Hw.FLOAT_DURATION,flyDuration:a=Hw.FLY_DURATION,signal:s=new si,target:o=this.targetContainer}=i;this.collectionAnimSignal=s,this.targetContainer=o;const r={...e,collectionAnimation:{floatDuration:n,flyDuration:a,animateTextOnly:!1,signal:s,target:o}};this.node.scene.emit(Ga.COIN_CHANGED,r),this.handleCollectionAnim(t,n,a)}addCoins(e){this.updateCoins({...e,coins:this.coins+e.coins})}removeCoins(e){this.coins<e.coins?this.node.scene.emit(Ga.REMOVE_COINS_FAILED):(this.updateCoins({...e,coins:this.coins-e.coins}),this.node.scene.emit(Ga.REMOVE_COINS_SUCCESS))}emitCoinAmount(){this.node.scene.emit(Ga.COIN_CHANGED,{coins:this.coins})}getShortAmount(e){return Math.min(e,Hw.MAX_COIN_COUNT)}untilFinishesCollectAnim(){return null===this.collectionAnimSignal?Promise.resolve():this.collectionAnimSignal.untilAborted()}setTargetContainer(e){this.targetContainer=e}getTargetContainer(){return this.targetContainer}onDestroy(){this.collectionAnimSignal?.abort(),this.lifeCycleSignal?.abort()}}).prototype,"coinPrefab",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mw=ve(Ow.prototype,"coinTextPopup",[_w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kw=ve(Ow.prototype,"coinAnimContainer",[Lw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dw=Ow))||Dw)||Dw);i._RF.pop(),i._RF.push({},"d2a57+mB4NG9rcdh+dy1VPe","traverse4",void 0),i._RF.pop(),i._RF.push({},"ca614iJ+X5LrL1rX/wDQDTD","shuffle",void 0),i._RF.pop(),i._RF.push({},"1cf4cygDSdP5JL+7w3wIJL7","traverseRandom",void 0),i._RF.pop(),i._RF.push({},"1faa9NgJrBE7p8Zs/HBWrZn","pad",void 0),i._RF.pop(),i._RF.push({},"f3b1eQ+t3FJYa35I0oznLiF","ParticleProperties",void 0);class qw{constructor(){this.lifeCurrent=0,this.life=0,this.velocityX=0,this.velocityY=0,this.alpha=255,this.totalRotation=0,this.lastChange=0,this.currentFrame=0}}var Ww,Kw,Yw,jw,Xw;i._RF.pop(),i._RF.push({},"32b8eGxcghFHZOi1WYXHCjF","BaseParticle",void 0);const{ccclass:$w,property:Qw}=a;let Jw=(Ww=$w("BaseParticle"),Kw=Qw(R),Ww((Xw=ve((jw=class extends s{constructor(){super(...arguments),e(this,"sprite",Xw,this),this.properties=new qw}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.sprite)throw new Error("BaseParticle: Sprite not found")}manualInit(e,t){this.manager=e;const{tint:i,velocityX:n,velocityY:a,totalRotation:s,lifespan:r,startAngle:l,scale:c}=t;this.properties.lastChange=0;const h=new o;o.fromHEX(h,i),this.sprite.color=h,this.properties.velocityX=n,this.properties.velocityY=a,this.properties.life=r,this.properties.lifeCurrent=r,this.properties.totalRotation=s,this.node.angle=l,this.node.setScale(c,c,1)}manualUpdate(e){return this.computeVelocity(e),this.node.setPosition(this.node.position.x+this.properties.velocityX*e,this.node.position.y+this.properties.velocityY*e,0),this.node.angle+=this.properties.totalRotation*e/this.properties.life,this.properties.lifeCurrent-=e,this.properties.lifeCurrent<=0}computeVelocity(e){const{velocityX:t,velocityY:i}=this.properties,n=t;let a=i;a+=this.manager.getGravityY()*e,this.properties.velocityX=n,this.properties.velocityY=a}}).prototype,"sprite",[Kw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yw=jw))||Yw);var Zw,eS,tS,iS,nS,aS,sS;i._RF.pop(),i._RF.push({},"b6123+a2K1LoY60oZO9SYKX","StarConfetti",void 0);const{ccclass:oS,property:rS}=a;let lS=(Zw=oS("StarConfetti"),eS=rS([N]),tS=rS([N]),Zw((aS=ve((nS=class extends Jw{constructor(){super(...arguments),e(this,"starXFrames",aS,this),e(this,"starYFrames",sS,this),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}manualInit(e,t){super.manualInit(e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1}manualUpdate(e){const t=super.manualUpdate(e);return this.updateGravity(),this.updateVelocity(),this.updateFrameRate(),this.updateFrames(e),t}updateGravity(){if(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)return;this.isGravityChanged=!0;this.properties.velocityX/=3,this.manager.setGravityY(-23745/667)}updateVelocity(){if(this.properties.lifeCurrent>this.properties.life-2)return;this.properties.velocityX>0?this.properties.velocityX+=z.randomRangeInt(-12,6):this.properties.velocityX+=z.randomRangeInt(-6,12)}updateFrames(e){if(this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame){this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=4&&(this.isYoyo=!0,this.properties.currentFrame-=1);const e=Math.random()>.5?this.starXFrames:this.starYFrames;this.sprite.spriteFrame=e[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame}}updateFrameRate(){this.properties.lifeCurrent<this.properties.life-2?this.msPerFrame=.15:this.msPerFrame=z.randomRangeInt(300,600)/1e3}}).prototype,"starXFrames",[eS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sS=ve(nS.prototype,"starYFrames",[tS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iS=nS))||iS);i._RF.pop(),i._RF.push({},"9caadUsaKtPEoOe+T2+pqtd","Properties",void 0);class cS{constructor(){this.delay=200,this.timeScale=2,this.tints=["#F1D171","#97E1FD","#7765D1","#ED4440","#F9E02A"],this.speedX={min:1583/75,max:1583*.24},this.speedY={min:1139.76,max:1219.76},this.gravityY=-664.86,this.lifespan={min:5,max:8},this.rotate={totalRotation:1080,random:!0},this.scale={min:.6,max:1},this.originGravityY=-664.86}}var hS;i._RF.pop(),i._RF.push({},"d1648PsavVBn7B059PS5fj6","BaseEmitter",void 0);const{ccclass:dS}=a;let uS=dS("BaseEmitter")(hS=class extends s{constructor(){super(...arguments),this.properties=new cS}getGravityY(){return this.properties.gravityY}setGravityY(e){this.properties.gravityY=e}})||hS;var pS;i._RF.pop(),i._RF.push({},"654983p4rREVKci1CE8cSJ2","ConfettiEmitter",void 0);const{ccclass:mS}=a;let gS=mS("ConfettiEmitter")(pS=class extends uS{constructor(){super(...arguments),this.activeStarConfetti=[]}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async createConfettiPool(){this.starConfettiPrefab=await ci.loadPrefabAsync("particles/StarConfetti"),this.starConfettiPool=new nd((()=>{const e=c(this.starConfettiPrefab);return this.node.addChild(e),e.active=!1,e}),0,(e=>{const t=e.getComponent(lS);t?(this.activeStarConfetti.push(t),e.active=!0):console.error("StarConfetti not found")}),(e=>{e.getComponent(lS)?e.active=!1:console.error("StarConfetti not found")}),(e=>{e.isValid&&e.destroy()})),this.properties.timeScale=1.5,this.properties.gravityY=688.605,this.properties.lifespan.min=4,this.properties.lifespan.max=6,this.properties.rotate.totalRotation=1800}async runEffect(e,t,i){this.starConfettiPool||await this.createConfettiPool(),this.properties.gravityY=this.properties.originGravityY;for(let n=0;n<e;n++){const e=this.starConfettiPool.alloc(),n=e.getComponent(lS);if(!n)return void console.error("StarConfetti not found");e.setPosition(t.clone());const a=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],s=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),o=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,r=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,l=this.properties.rotate.random?180*Math.random():0,c=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,h={tint:a,velocityX:s,velocityY:o,lifespan:r,totalRotation:this.properties.rotate.totalRotation,startAngle:l,scale:c};n.manualInit(this,h);const d=this.starConfettiPool.alloc(),u=d.getComponent(lS);if(!u)return void console.error("StarConfetti not found");d.setPosition(i.clone()),h.velocityX=-s,u.manualInit(this,h)}}clearEffect(){for(const e of this.activeStarConfetti)this.starConfettiPool.free(e.node);this.activeStarConfetti=[]}update(e){const t=e*this.properties.timeScale,i=[];this.activeStarConfetti.forEach((e=>{e.manualUpdate(t)&&i.push(e)})),i.forEach((e=>{this.starConfettiPool.free(e.node),this.activeStarConfetti.splice(this.activeStarConfetti.indexOf(e),1)}))}})||pS;var yS,bS,fS,wS,SS,vS,ES,CS,TS,AS,RS;i._RF.pop(),i._RF.push({},"78c97IkjeJFQohPZudvcfeS","Ribbon",void 0);const{ccclass:IS,property:PS}=a,{Utils:{Array:_S}}=GameCore;let LS=(yS=IS("Ribbon"),bS=PS([N]),fS=PS([N]),wS=PS([N]),SS=PS([N]),yS((CS=ve((ES=class extends Jw{constructor(){super(...arguments),e(this,"ribbonA",CS,this),e(this,"ribbonB",TS,this),e(this,"ribbonC",AS,this),e(this,"ribbonD",RS,this),this.useFrames=[],this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=[]}manualInit(e,t){super.manualInit(e,t),this.msPerFrame=.15,this.isYoyo=!1,this.isGravityChanged=!1,this.points=_S.fillWith(10,(()=>({x:0,y:0})));const i=Math.random();this.useFrames=i<.25?this.ribbonA:i<.5?this.ribbonB:i<.75?this.ribbonC:this.ribbonD,this.sprite.enabled=!1}manualUpdate(e){const t=super.manualUpdate(e);return this.updateFrames(e),this.updatePoints(),this.updateGravity(),this.updateVelocity(),t}updateFrames(e){this.properties.lastChange+=e,this.properties.lastChange>=this.msPerFrame&&(this.isYoyo?this.properties.currentFrame--:this.properties.currentFrame++,this.properties.currentFrame<0&&(this.isYoyo=!1,this.properties.currentFrame=1),this.properties.currentFrame>=this.useFrames.length&&(this.isYoyo=!0,this.properties.currentFrame-=1),this.sprite.spriteFrame=this.useFrames[this.properties.currentFrame],this.properties.lastChange-=this.msPerFrame)}updatePoints(){if(this.isGravityChanged)return;this.points.shift();const{x:e,y:t}=this.node.worldPosition;this.points.push({x:e,y:t})}updateGravity(){if(this.properties.lifeCurrent>this.properties.life-2||this.isGravityChanged)return;this.isGravityChanged=!0,this.points=[],this.sprite.enabled=!0,this.properties.velocityX/=3;this.manager.setGravityY(-23745/667)}updateVelocity(){if(this.isGravityChanged)return;this.properties.lifeCurrent>this.properties.life-1.8?this.properties.velocityX+=z.randomRangeInt(-24,24):this.properties.velocityX>0?this.properties.velocityX+=z.randomRangeInt(-20,12):this.properties.velocityX+=z.randomRangeInt(-12,20)}getGlobalPoints(){return this.points}getColor(){return this.sprite.color}}).prototype,"ribbonA",[bS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),TS=ve(ES.prototype,"ribbonB",[fS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AS=ve(ES.prototype,"ribbonC",[wS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RS=ve(ES.prototype,"ribbonD",[SS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vS=ES))||vS);var DS,OS,NS,MS,kS;i._RF.pop(),i._RF.push({},"f2427J2HhBKdpkcqDn2Vv5H","RibbonEmitter",void 0);const{ccclass:xS,property:FS}=a;let BS=(DS=xS("RibbonEmitter"),OS=FS(q),DS((kS=ve((MS=class extends uS{constructor(){super(...arguments),e(this,"graphics",kS,this),this.activeRibbonConfetti=[]}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async createConfettiPool(){this.ribbonPrefab=await ci.loadPrefabAsync("particles/Ribbon"),this.ribbonConfettiPool=new nd((()=>{const e=c(this.ribbonPrefab);return this.node.addChild(e),e.active=!1,e}),0,(e=>{const t=e.getComponent(LS);t?(this.activeRibbonConfetti.push(t),e.active=!0):console.error("StarConfetti not found")}),(e=>{e.getComponent(LS)?e.active=!1:console.error("StarConfetti not found")}),(e=>{e.destroy()}))}async runEffect(e,t,i){this.ribbonConfettiPool||await this.createConfettiPool(),this.properties.gravityY=this.properties.originGravityY;for(let n=0;n<e;n++){const e=this.ribbonConfettiPool.alloc(),n=e.getComponent(LS);if(!n)return void console.error("StarConfetti not found");e.setPosition(t.clone());const a=this.properties.tints[Math.floor(Math.random()*this.properties.tints.length)],s=Math.random()*(this.properties.speedX.max-this.properties.speedX.min),o=Math.random()*(this.properties.speedY.max-this.properties.speedY.min)+this.properties.speedY.min,r=Math.random()*(this.properties.lifespan.max-this.properties.lifespan.min)+this.properties.lifespan.min,l=this.properties.rotate.random?180*Math.random():0,c=Math.random()*(this.properties.scale.max-this.properties.scale.min)+this.properties.scale.min,h={tint:a,velocityX:s,velocityY:o,lifespan:r,totalRotation:this.properties.rotate.totalRotation,startAngle:l,scale:c};n.manualInit(this,h);const d=this.ribbonConfettiPool.alloc(),u=d.getComponent(LS);if(!u)return void console.error("StarConfetti not found");d.setPosition(i.clone()),h.velocityX=-s,u.manualInit(this,h)}}clearEffect(){for(const e of this.activeRibbonConfetti)this.ribbonConfettiPool.free(e.node);this.activeRibbonConfetti=[]}update(e){const t=e*this.properties.timeScale;this.graphics.clear();const i=[];this.activeRibbonConfetti.forEach((e=>{e.manualUpdate(t)&&i.push(e),this.drawGraphics(e.getGlobalPoints(),e.getColor())})),i.forEach((e=>{this.ribbonConfettiPool.free(e.node),this.activeRibbonConfetti.splice(this.activeRibbonConfetti.indexOf(e),1)}))}drawGraphics(e,t){if(!this.graphics.node.active)return;for(const t of e)if(0===t.y)return;if(e.length<2)return;this.graphics.strokeColor=t;let i=new j(e[0].x,e[0].y,0);i=this.node.inverseTransformPoint(i,i),this.graphics.moveTo(i.x,i.y);for(let t=1;t<e.length;t++)i.x=e[t].x,i.y=e[t].y,i=this.node.inverseTransformPoint(i,i),this.graphics.lineTo(i.x,i.y);this.graphics.stroke()}}).prototype,"graphics",[OS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NS=MS))||NS);var zS,US,GS,HS,VS,qS,WS;i._RF.pop(),i._RF.push({},"f7cfcFAL8tBE70g2A0+qMTR","PaperConfetti",void 0);const{ccclass:KS,property:YS}=a;let jS=(zS=KS("PaperConfetti"),US=YS(gS),GS=YS(BS),zS((qS=ve((VS=class extends s{constructor(){super(...arguments),this.spawnLeftPos=new j(-375,-791.5,0),this.spawnRightPos=new j(375,-791.5,0),e(this,"confettiEmitter",qS,this),e(this,"ribbonEmitter",WS,this)}__preload(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.confettiEmitter)throw new Error("PaperConfetti: ConfettiEmitter not found");if(!this.ribbonEmitter)throw new Error("PaperConfetti: RibbonEmitter not found")}runEffect(){this.scheduleOnce((()=>{this.confettiEmitter.runEffect(25,this.spawnLeftPos,this.spawnRightPos)}),.2),this.ribbonEmitter.runEffect(20,this.spawnLeftPos,this.spawnRightPos)}clearEffect(){this.unscheduleAllCallbacks(),this.confettiEmitter.clearEffect(),this.ribbonEmitter.clearEffect()}}).prototype,"confettiEmitter",[US],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WS=ve(VS.prototype,"ribbonEmitter",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HS=VS))||HS);var XS;i._RF.pop(),i._RF.push({},"4a9beTdMntC0q9yngb8a2go","BootScene",void 0);const{ccclass:$S,disallowMultiple:QS}=a,{Events:JS,Configs:ZS,Utils:{Time:ev,Valid:tv}}=GameCore,{ads:iv,player:nv,event:av}=globalThis.game;$S("BootScene")(XS=QS(XS=class extends s{constructor(){super(...arguments),this.processWhenGameSdkStarted=()=>{this.setupGameData()},this.processPreloadAssets=()=>{this.loadCurrentPlayerTheme().catch((e=>console.error("loadCurrentPlayerTheme",e)))},this.handleShowAdWhenLoadGame=async()=>{const{Enabled:e,ShowAdOnLoad:t}=ZS.Ads;if(!e)return;const{Enabled:i,DelaySeconds:n,PlacementId:a}=t;if(i)try{n>0&&await ev.sleepAsync(1e3*n);const e=iv.getAdByPlacementId(a);if(!e)return;await this.showAdWhenLoadGame(e)}catch(e){console.warn("handleShowAdWhenLoadGame failed",e)}finally{Ag.preloadAds()}},this.handlePauseAudio=()=>{av.on(JS.VISIBILITY_HIDDEN,this.handleMuteAudio),av.on(JS.VISIBILITY_VISIBLE,this.handleUnMuteAudio),av.on(JS.VISIBILITY_VISIBLE,this.handleForceEngineRunning)},this.handleMuteAudio=()=>{ji.muteAudio(!0)},this.handleUnMuteAudio=()=>{iv.isAdFullSizeShowing()||ji.muteAudio(!1)},this.handleForceEngineRunning=()=>{m.resume()}}__preload(){this.setupAndroidPlatformAds(),this.processCrazyGamesLoadingStart(),this.validateRequiredComponents(),this.listenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onLoad(){this.handlePauseAudio(),this.processPreloadAssets(),ZS.Core.StartSDKAfterLoadGame||ql.showLoadingFullScreen(xr)}start(){this.processCrazyGamesLoadingStop()}listenEvents(){av.once(JS.GAME_SDK_STARTED,this.processWhenGameSdkStarted),av.once(JS.GAME_READY,this.handleShowAdWhenLoadGame)}setupGameData(){const e=nv.getGameData();if(!e)return;const{totalLevel:t}=e,i={...e,totalLevel:0===t?80:t};nv.setGameData(i)}loadCurrentPlayerTheme(){const e=$r.mapOrder;let t=e[0];const i=nv.getGameData();console.log("loadCurrentPlayerTheme",i);let n=i?.level;if(!tv.isNumber(n))return ci.loadThemeAsync(t.theme);for(const i of e)if(n-=i.levelCount,n<=0){t=i;break}return ci.loadThemeAsync(t.theme)}async showAdWhenLoadGame(e){try{const{type:t,placementId:i}=e;await iv.loadAdAsync(t,i),ji.muteAudio(!0),await iv.showAdAsync(t,i)}catch(e){console.warn("showAdWhenLoadGame failed",e)}finally{ji.muteAudio(!1)}}processCrazyGamesLoadingStart(){"gameLoadingStart"in GameSDK.extra&&GameSDK.extra.gameLoadingStart()}processCrazyGamesLoadingStop(){"gameLoadingStop"in GameSDK.extra&&GameSDK.extra.gameLoadingStop()}setupAndroidPlatformAds(){}})||XS);var sv,ov,rv,lv,cv,hv,dv,uv,pv,mv,gv;i._RF.pop(),i._RF.push({},"29f874DL75LO5NzzNYZvHDh","RigidBodyObject",void 0);const{ccclass:yv,property:bv}=a;let fv=(sv=yv("RigidBodyObject"),ov=bv(C),rv=bv(Q),lv=bv(C),cv=bv(H),sv((uv=ve((dv=class extends s{constructor(){super(...arguments),e(this,"gravityScale",uv,this),e(this,"linearVelocity",pv,this),e(this,"bounce",mv,this),e(this,"simulate",gv,this)}onLoad(){this.canvas=this.node.scene.getComponentInChildren(r).getComponent(l),this.uiTransform=this.node.getComponent(l)}update(e){if(!this.simulate)return;this.applyGravity();let t=this.node.worldPosition.clone();t.add(new j(this.linearVelocity.x*e,this.linearVelocity.y*e,0)),t=this.applyBounce(t),this.node.setWorldPosition(t)}applyForce(e){this.linearVelocity.add(e)}applyGravity(){const e=new Q(0,-9.8*this.gravityScale);this.applyForce(e)}applyBounce(e){const t=this.uiTransform.getBoundingBoxToWorld();t.yMin<0&&(e.y=t.height/2,this.linearVelocity.y*=-this.bounce),t.xMin<0&&(e.x=t.width/2,this.linearVelocity.x*=-1);const i=this.canvas.width;return t.xMax>i&&(e.x=i-t.width/2,this.linearVelocity.x*=-1),e}}).prototype,"gravityScale",[ov],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),pv=ve(dv.prototype,"linearVelocity",[rv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Q(0,0)}}),mv=ve(dv.prototype,"bounce",[lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gv=ve(dv.prototype,"simulate",[cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hv=dv))||hv);var wv,Sv,vv,Ev,Cv,Tv,Av,Rv,Iv;i._RF.pop(),i._RF.push({},"93d88BQCU5B0L/TmaCaYNfm","AnimSkipOverlay",void 0);const{ccclass:Pv,property:_v,disallowMultiple:Lv}=a,Dv=()=>{};let Ov=(wv=Pv("AnimSkipOverlay"),Sv=_v(x),vv=_v(x),Ev=_v(p),wv(Cv=Lv((Av=ve((Tv=class extends s{constructor(){super(...arguments),e(this,"containerUIOpacity",Av,this),e(this,"maskUIOpacity",Rv,this),e(this,"skipButton",Iv,this),this.isOpened=!1,this.currentCallback=Dv}__preload(){this.validateRequiredComponents(),this.containerUIOpacity.node.active=!1,this.skipButton.interactable=!1}onSkipButtonPress(){this.currentCallback(),this.close()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async open(e){this.containerUIOpacity.node.active=!0;const{onSkip:t,opacity:i=255,transitionDuration:n=.2}=e;this.maskUIOpacity.opacity=i,await this.animateUIOpacity(0,255,n),this.currentCallback=t,this.skipButton.interactable=!0,this.isOpened=!0,this.node.scene.emit($n,e)}async close(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.2;this.skipButton.interactable=!1,this.currentCallback=Dv,await this.animateUIOpacity(255,0,e),this.maskUIOpacity.opacity=0,this.containerUIOpacity.node.active=!1,this.isOpened=!1,this.node.scene.emit(Qn)}animateUIOpacity(e,t,i){return this.containerUIOpacity.opacity=e,vt.runTweenAsync(E(this.containerUIOpacity).to(i,{opacity:t}))}untilClosed(){return!1===this.isOpened?Promise.resolve():new Promise((e=>{this.node.scene.once(Qn,e)}))}}).prototype,"containerUIOpacity",[Sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rv=ve(Tv.prototype,"maskUIOpacity",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iv=ve(Tv.prototype,"skipButton",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cv=Tv))||Cv)||Cv);var Nv,Mv,kv,xv,Fv,Bv,zv,Uv,Gv;i._RF.pop(),i._RF.push({},"755d1r2cMRLvo4fObNWxss/","CoinContainer",void 0);const{ccclass:Hv,property:Vv}=a,{Utils:{Number:qv}}=GameCore;let Wv=(Nv=Hv("CoinContainer"),Mv=Vv(h),kv=Vv(R),xv=Vv(x),Nv((zv=ve((Bv=class extends s{constructor(){super(...arguments),e(this,"coinLabel",zv,this),e(this,"coinIcon",Uv,this),e(this,"explosionCircle",Gv,this),this.currentCoin=0}setCoinText(e){this.coinLabel.string=e}handleAddCoinButton(){ql.openScreen(Gi.GET_COIN_SCREEN,{quantity:Er})}onLoad(){this.validateRequiredComponents(),this.listenToEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenToEvents(){this.node.scene.on(Ga.COIN_CHANGED,this.updateCoins,this)}async updateCoins(e){const{coins:t,collectionAnimation:i}=e;if(void 0===i||!1===this.node.activeInHierarchy)return void this.setCoins(t);const{signal:n}=i;if(this.animAbortSignal?.abort(),this.animAbortSignal=n??new si,i.animateTextOnly)return await this.animateCoinText(t,0,n),void this.setCoins(t);const a=i.flyDuration,s=i.floatDuration+a;await this.animateCoinText(t,s,n),this.setCoins(t)}setCoins(e){this.setCoinText(qv.getShortNumber(e,3)),this.currentCoin=e}async animateCoinText(e,t,i){const n=this.currentCoin;await vt.waitTweenAsync(t,i),ji.playSound(Fi.COLLECT_COINS),await vt.runTweenAsync(E({}).to(1,{},{easing:"quadOut",onUpdate:(t,i)=>{if(!i)return;const a=Math.round(n+(e-n)*i);this.setCoinText(qv.getShortNumber(a,3))}}),i)}async emitExplodeEffect(e){this.explosionCircle.opacity=255,this.explosionCircle.node.setScale(0,0),await Promise.all([vt.runTweenAsync(E(this.explosionCircle.node).to(.4,{scale:new j(3,3,3)},{easing:"quadOut"}),e),vt.runTweenAsync(E(this.explosionCircle).delay(.2).to(.2,{opacity:0}),e)]),this.explosionCircle.node.setScale(0,0),this.explosionCircle.opacity=0}getCoinIconWorldPosition(){return this.coinIcon.node.worldPosition}getCoinIconWorldScale(){return this.coinIcon.node.worldScale}onDestroy(){this.animAbortSignal?.abort()}}).prototype,"coinLabel",[Mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uv=ve(Bv.prototype,"coinIcon",[kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gv=ve(Bv.prototype,"explosionCircle",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fv=Bv))||Fv);var Kv,Yv,jv,Xv,$v,Qv,Jv,Zv,eE,tE,iE,nE,aE,sE,oE,rE,lE;i._RF.pop(),i._RF.push({},"a1833nGls5Ac4p0tpu/jEqi","ItemContainer",void 0);const{ccclass:cE,property:hE}=a,{player:dE}=globalThis.game,uE=[1e3,1500];Kv=cE("ItemContainer"),Yv=hE({type:n,group:"Hint"}),jv=hE({type:h,group:"Hint"}),Xv=hE({type:n,group:"Thunder"}),$v=hE({type:h,group:"Thunder"}),Qv=hE({type:n,group:"Storm"}),Jv=hE({type:h,group:"Storm"}),Zv=hE(_),Kv((iE=ve((tE=class extends s{constructor(){super(...arguments),e(this,"hintNode",iE,this),e(this,"hintLabel",nE,this),this.hintCollection=[],e(this,"thunderNode",aE,this),e(this,"thunderLabel",sE,this),this.thunderCollection=[],e(this,"stormNode",oE,this),e(this,"stormLabel",rE,this),this.stormCollection=[],e(this,"itemPrefab",lE,this)}onLoad(){this.canvas=this.node.scene.getComponentInChildren(r).node,this.widget=this.getComponent(A),this.defaultRightWidget=this.widget.right,this.uiOpacity=this.getComponent(x),this.validateRequiredComponents(),this.listenToEvents()}start(){this.prepareItemCollection()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenToEvents(){this.node.scene.on(Ga.ADD_ITEMS,this.handleAddItems,this)}prepareItemCollection(){for(let e=0;e<9;e++){const e=c(this.itemPrefab),t=c(this.itemPrefab),i=c(this.itemPrefab);e.parent=this.canvas,t.parent=this.canvas,i.parent=this.canvas,e.active=!1,t.active=!1,i.active=!1,this.hintCollection.push(e.getComponent(fv)),this.thunderCollection.push(t.getComponent(fv)),this.stormCollection.push(i.getComponent(fv))}}updateStatus(e){const{items:t}=e;this.hintLabel.string=`${t.hint}`,this.thunderLabel.string=`${t.thunder}`,this.stormLabel.string=`${t.storm}`}async show(){this.uiOpacity.opacity=255;const e=E(this.widget).to(1.5,{right:0},{easing:"quadOut"});await vt.runTweenAsync(e,this.animAbortSignal),this.widget.right=0}async hide(){const e=E(this.widget).to(1,{right:this.defaultRightWidget},{easing:"quadIn"});await vt.runTweenAsync(e),this.uiOpacity.opacity=0}async handleAddItems(e){this.animAbortSignal=e.signal??new si;const t=dE.getGameData();if(!t)return;this.updateStatus(t);const i=this.show(),n=e.items.map((e=>this.animateItemCollection(e.item,e.quantity,1.5)));await Promise.all([i,...n]),t.items={...t.items,hint:t.items.hint+e.items[0].quantity,thunder:t.items.thunder+e.items[1].quantity,storm:t.items.storm+e.items[2].quantity},dE.setGameData(t),this.updateStatus(t),await this.hide()}async animateItemCollection(e,t,i){const n=this.getItemCollection(e).slice(0,t);if(0===n.length)return;const a=n.map(((t,n)=>{t.node.active=!0,t.node.position=new j(0,0,t.node.position.z),t.linearVelocity=new Q(0,0),t.simulate=!0;const a=ne(Math.PI/3,2*Math.PI/3),s=ne(uE[0],uE[1])*Math.cos(a),o=ne(uE[0],uE[1])*Math.sin(a);t.applyForce(new Q(s,o));const r=this.getTargetNode(e);if(r)return t.getComponent(R).spriteFrame=r.getComponent(R).spriteFrame,this.getItemAnimation(t,r,i+.03*n)}));await Promise.all(a)}getItemCollection(e){switch(e){case"hint":return this.hintCollection;case"thunder":return this.thunderCollection;case"storm":return this.stormCollection;default:return[]}}getTargetNode(e){switch(e){case"hint":return this.hintNode;case"thunder":return this.thunderNode;case"storm":return this.stormNode;default:return null}}async getItemAnimation(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;e.node.scale=new j(2,2,2),await vt.waitTweenAsync(i,this.animAbortSignal);const n=e.node.worldPosition.clone(),a=E(e.node).to(1,{scale:t.scale},{onUpdate:(i,a)=>{if(!i||!a)return;const s=k.cubicIn(a);t&&(e.node.worldPosition=n.lerp(t.worldPosition,s))},onComplete:()=>{e.node.setPosition(0,0),e.node.active=!1}});await vt.runTweenAsync(a,this.animAbortSignal),e.node.scale=t.scale.clone(),e.node.setPosition(0,0),e.node.active=!1}onDestroy(){this.animAbortSignal?.abort()}}).prototype,"hintNode",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nE=ve(tE.prototype,"hintLabel",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aE=ve(tE.prototype,"thunderNode",[Xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sE=ve(tE.prototype,"thunderLabel",[$v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oE=ve(tE.prototype,"stormNode",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rE=ve(tE.prototype,"stormLabel",[Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lE=ve(tE.prototype,"itemPrefab",[Zv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eE=tE));var pE,mE,gE,yE,bE,fE,wE,SE,vE,EE,CE,TE,AE,RE,IE,PE,_E,LE,DE,OE,NE;i._RF.pop(),i._RF.push({},"ba822axo49BibgkqkEhhqVp","DashboardPage",void 0);const{ccclass:ME,property:kE,disallowMultiple:xE,requireComponent:FE}=a;let BE=(pE=ME("DashboardPage"),mE=FE(A),gE=FE(x),yE=kE({type:n,displayName:"Page's container"}),bE=kE({type:n,displayName:"Placeholder"}),fE=kE({displayName:"Don't load page",tooltip:"Tell the component to not preload the page even if it hasn't loaded yet"}),wE=kE({type:_,displayName:"Page prefab",visible:function(){return!this.hasLoaded}}),SE=kE({displayName:"Darken background"}),vE=kE({type:f,min:0,max:255,displayName:"Background opacity",visible:function(){return this.darkenBackground}}),EE=kE({displayName:"Use navbar shadow"}),CE=kE({type:f,min:0,max:255,displayName:"Navbar shadow opacity",visible:function(){return this.useNavbarShadow}}),pE(TE=xE(TE=mE(TE=gE((RE=ve((AE=class extends s{constructor(){super(...arguments),e(this,"container",RE,this),e(this,"placeholder",IE,this),e(this,"hasLoaded",PE,this),e(this,"pagePrefab",_E,this),e(this,"darkenBackground",LE,this),e(this,"backgroundOpacity",DE,this),e(this,"useNavbarShadow",OE,this),e(this,"navbarShadowOpacity",NE,this)}onLoad(){this.containerUIOpacity=this.container.getComponent(x),this.placeholderUIOpacity=this.placeholder.getComponent(x),this.widgetComponent=this.node.getComponent(A),this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents();const e=this.container.getComponent(T);this.layoutComponents=e?[e]:[],this.widgetComponents=[this.widgetComponent,...this.container.getComponentsInChildren(A)]}start(){this.container.active=!0,this.placeholder.active=!0}getWidget(){return this.widgetComponent}updateWidgets(){this.widgetComponents.forEach((e=>{e.updateAlignment()}))}updateLayouts(){this.layoutComponents.forEach((e=>{e.updateLayout()}))}show(){this.uiOpacity.opacity=255}hide(){this.uiOpacity.opacity=0}async mount(){this.hasLoaded||await this.create(),this.placeholderUIOpacity.opacity=0,this.containerUIOpacity.opacity=255,Yi.trackCurrentPage(this.node.name,!0)}unmount(){255===this.placeholderUIOpacity.opacity&&0===this.containerUIOpacity.opacity||(this.placeholderUIOpacity.opacity=255,this.containerUIOpacity.opacity=0)}transitionIn(){return Promise.resolve()}transitionOut(){return Promise.resolve()}hasLoadedPage(){return this.hasLoaded}getContainer(){return this.container}getDarkenBackground(){return this.darkenBackground?this.backgroundOpacity:0}getNavbarShadow(){return this.useNavbarShadow?this.navbarShadowOpacity:0}async create(){if(!this.pagePrefab)return;if(this.hasLoaded)return;const e=c(this.pagePrefab),t=e.getComponentsInChildren(A);this.widgetComponents.push(...t);const i=e.getComponentsInChildren(T);this.layoutComponents.push(...i),this.container.addChild(e),await vt.waitTweenAsync(0),this.hasLoaded=!0}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"container",[yE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IE=ve(AE.prototype,"placeholder",[bE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PE=ve(AE.prototype,"hasLoaded",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_E=ve(AE.prototype,"pagePrefab",[wE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LE=ve(AE.prototype,"darkenBackground",[SE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),DE=ve(AE.prototype,"backgroundOpacity",[vE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),OE=ve(AE.prototype,"useNavbarShadow",[EE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),NE=ve(AE.prototype,"navbarShadowOpacity",[CE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),TE=AE))||TE)||TE)||TE)||TE);var zE,UE,GE,HE,VE,qE,WE,KE,YE,jE,XE;i._RF.pop(),i._RF.push({},"18bbbp5z2VHVKp4jjjmsAhu","ThemeProgressBar",void 0);const{ccclass:$E,property:QE}=a;let JE=(zE=$E("ThemeProgressBar"),UE=QE(n),GE=QE(n),HE=QE(n),VE=QE(n),zE((KE=ve((WE=class extends s{constructor(){super(...arguments),e(this,"progressBar",KE,this),e(this,"progressText",YE,this),e(this,"leftCap",jE,this),e(this,"rightCap",XE,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.progressBar)throw new Error("ThemeProgressBar: progressBar not found");if(!this.progressText)throw new Error("ThemeProgressBar: progressText not found");if(!this.leftCap)throw new Error("ThemeProgressBar: leftCap not found");if(!this.rightCap)throw new Error("ThemeProgressBar: rightCap not found")}setProgress(e,t){e<=0?(this.leftCap.active=!1,this.rightCap.active=!1):(this.leftCap.active=!0,this.rightCap.active=!0);const i=this.progressBar.getComponent(X);if(!i)throw new Error("ThemeProgressBar: progressBarComponent not found");i.progress=e/t;const n=this.progressText.getComponent(h);if(!n)throw new Error("ThemeProgressBar: progressTextComponent not found");n.string=`${e}/${t}`}}).prototype,"progressBar",[UE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YE=ve(WE.prototype,"progressText",[GE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jE=ve(WE.prototype,"leftCap",[HE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XE=ve(WE.prototype,"rightCap",[VE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qE=WE))||qE);var ZE,eC,tC,iC,nC,aC,sC,oC,rC,lC,cC,hC,dC,uC,pC;i._RF.pop(),i._RF.push({},"e62f9TdkTxOyJy6vcnplnCB","LockAnimator",void 0);const{ccclass:mC,disallowMultiple:gC,property:yC}=a,bC=[50,160];let fC=(ZE=mC("LockAnimator"),eC=yC(se),tC=yC(y),iC=yC(D),nC=yC(D),aC=yC(_o),sC=yC({type:f,min:0}),ZE(oC=gC((lC=ve((rC=class extends s{constructor(){super(...arguments),e(this,"floatingParticles",lC,this),e(this,"iconAnimation",cC,this),e(this,"lockClip",hC,this),e(this,"unlockClip",dC,this),e(this,"trailTemplate",uC,this),e(this,"trailCount",pC,this),this.trails=[]}onLoad(){this.validateRequiredComponents(),this.prepareTrails(),this.floatingParticles.node.active=!1}async unlock(e){this.floatingParticles.node.active=!0,this.floatingParticles.resetSystem(),await this.playAnimation(this.unlockClip.name,e),this.floatingParticles.stopSystem()}fireExplosionParticles(){this.explodeTrails()}lock(){this.playAnimation(this.lockClip.name),this.floatingParticles.node.active&&this.floatingParticles.stopSystem()}explodeTrails(){return Promise.all(this.trails.map((e=>vt.runTweenAsync(this.getExplodeTrail(e)))))}getExplodeTrail(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=ne(0,2*Math.PI),n=ne(bC[0],bC[1])*Math.cos(i),a=ne(bC[0],bC[1])*Math.sin(i),s=new j(n,a,e.node.position.z),o=e.node.scale.clone();return E(e.node).delay(t).call((()=>{e.node.setPosition(0,0),e.reset(),e.node.active=!0})).to(.5,{position:s.clone()},{easing:"expoOut"}).to(.5,{scale:new j(0,0,1)},{easing:"expoIn"}).call((()=>{e.node.setPosition(0,0),e.node.scale=o,e.reset(),e.node.active=!1}))}prepareTrails(){this.trailTemplate.node.active=!1;for(let e=0;e<this.trailCount;e++){const e=c(this.trailTemplate.node);e.setParent(this.node),e.active=!1,this.trails.push(e.getComponent(_o))}}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async playAnimation(e,t){return t&&t?.aborted?Promise.resolve():new Promise((i=>{this.iconAnimation.once(y.EventType.FINISHED,(()=>{i()})),t?.addAbortListener((()=>{this.iconAnimation.off(y.EventType.FINISHED),this.iconAnimation.stop(),i()})),this.iconAnimation.play(e)}))}}).prototype,"floatingParticles",[eC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cC=ve(rC.prototype,"iconAnimation",[tC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hC=ve(rC.prototype,"lockClip",[iC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dC=ve(rC.prototype,"unlockClip",[nC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uC=ve(rC.prototype,"trailTemplate",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pC=ve(rC.prototype,"trailCount",[sC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oC=rC))||oC)||oC);var wC,SC,vC,EC,CC,TC,AC,RC,IC,PC,_C,LC,DC,OC,NC,MC,kC,xC,FC,BC,zC,UC;i._RF.pop(),i._RF.push({},"aef0d6qo8hNUJ7qNl2wuT29","ThemeBlock",void 0);const{ccclass:GC,property:HC}=a,VC={progress:0,max:10,isLocked:!0,themeId:el.SUMMER,skin:Zr};let qC=(wC=GC("ThemeBlock"),SC=HC(n),vC=HC(x),EC=HC(n),CC=HC(x),TC=HC(fC),AC=HC(n),RC=HC(R),IC=HC([R]),PC=HC(h),_C=HC(H),wC((OC=ve((DC=class extends s{constructor(){super(...arguments),e(this,"mask",OC,this),e(this,"nodeUIOpacity",NC,this),e(this,"progressBar",MC,this),e(this,"backgroundUI",kC,this),e(this,"lockAnimator",xC,this),e(this,"themeLoadingRing",FC,this),e(this,"themeSprite",BC,this),e(this,"tileBlockIconSprite",zC,this),e(this,"titleLabel",UC,this),this.visibilityTween=null,this.isVisible=!1,this.payload=VC}set isLocked(e){this.payload.isLocked=e,this.updateThemeBlockDisplay()}get isLocked(){return this.payload.isLocked}getSkinName(){return this.payload.skin}__preload(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateThemeBlockDisplay(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:VC;this.payload=e;const{progress:t,max:i,isLocked:n,themeId:a,skin:s}=e;this.updateTitle(a),this.updateSkinAsync(s),this.updateThemeAsync(a);const o=this.progressBar.getComponent(JE);if(!o)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=n,this.progressBar.active=!n,this.lockAnimator.node.active=n,n||o.setProgress(t,i)}async playUnlockAnim(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:VC;this.payload={...t,isLocked:!1};const{progress:i,max:n}=t,a=this.progressBar.getComponent(JE);if(!a)throw new Error("ThemeBlock: progressBarComponent not found");this.mask.active=!0,this.progressBar.active=!1,this.lockAnimator.node.active=!0,a.setProgress(i,n),await this.animateUnlockedState(e)}updateTitle(e){switch(e){case el.SUMMER:this.titleLabel.string="Summer";break;case el.WINTER:this.titleLabel.string="Winter";break;case el.AUTUMN:this.titleLabel.string="Autumn"}}async updateSkinAsync(e){const t=await ci.loadSkinPreviewAsync(e);this.tileBlockIconSprite&&t.forEach(((e,t)=>{e&&(this.tileBlockIconSprite[t].spriteFrame=e)}))}async updateThemeAsync(e){const t=await ci.loadThemePreviewAsync(e);this.themeSprite&&t&&(this.themeSprite.spriteFrame=t,this.themeLoadingRing&&(this.themeLoadingRing.active=!1))}async animateUnlockedState(e){const t=this.mask.getComponent(x),i=this.progressBar.getComponent(x);if(!t)throw new Error("ThemeBlock: maskUIOpacity not found");if(!i)throw new Error("ThemeBlock: progressBarUIOpacity not found");this.mask.active=!0,t.opacity=t.opacity??255,this.progressBar.active=!0,i.opacity=0,await this.lockAnimator.unlock(e),this.lockAnimator.node.active=!1,await Promise.all([vt.runTweenAsync(E(t).to(.25,{opacity:0}),e),vt.runTweenAsync(E(i).to(.25,{opacity:255}),e)]),this.mask.active=!1,t.opacity=0,i.opacity=255}getUITransform(){return this.uiTransform}setVisible(e){this.isVisible!==e&&(this.isVisible=e,this.visibilityTween?.stop(),this.visibilityTween=E(this.nodeUIOpacity).to(.05,{opacity:e?255:0}).start())}}).prototype,"mask",[SC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NC=ve(DC.prototype,"nodeUIOpacity",[vC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MC=ve(DC.prototype,"progressBar",[EC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kC=ve(DC.prototype,"backgroundUI",[CC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xC=ve(DC.prototype,"lockAnimator",[TC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FC=ve(DC.prototype,"themeLoadingRing",[AC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BC=ve(DC.prototype,"themeSprite",[RC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zC=ve(DC.prototype,"tileBlockIconSprite",[IC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),UC=ve(DC.prototype,"titleLabel",[PC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(DC.prototype,"isLocked",[_C],Object.getOwnPropertyDescriptor(DC.prototype,"isLocked"),DC.prototype),LC=DC))||LC);var WC,KC,YC,jC,XC,$C,QC,JC,ZC,eT,tT;i._RF.pop(),i._RF.push({},"b3a4dy5XgpIT6stybzgYjnu","CollectionsContent",void 0);const{ccclass:iT,property:nT}=a,{storage:aT}=globalThis.game,{Array:sT}=GameCore.Utils;let oT=(WC=iT("CollectionsContent"),KC=nT(us),YC=nT(ce),jC=nT(qn),XC=nT({type:C,displayName:"Offset from top of scroll view",tooltip:"The offset between the first theme tab and the top of the scroll view"}),WC((JC=ve((QC=class extends s{constructor(){super(...arguments),this.animateThemeTabUnlock=null,e(this,"panelAnimator",JC,this),e(this,"themeScrollView",ZC,this),e(this,"contentOpacity",eT,this),this.themeBlocks=[],this.preservedScrollPosition=new Q,e(this,"offsetFromTopOfScrollView",tT,this),this.updateBlocksVisibility=()=>{const{yMax:e,yMin:t}=this.uiTransform.getBoundingBoxToWorld();this.themeBlocks.forEach((i=>{const n=i.getUITransform(),{yMax:a,yMin:s}=n.getBoundingBoxToWorld(),o=a<t||s>e;i.setVisible(!o)}))},this.hideContent=()=>{this.contentOpacity.changeStateFade(!1,.1)},this.showContent=()=>{this.contentOpacity.changeStateFade(!0,.1)}}__preload(){this.uiTransform=this.getComponent(l),this.themeBlocks=this.themeScrollView.content?.getComponentsInChildren(qC)??[],this.validateRequiredComponents()}listenEvents(){this.themeScrollView.node.on(ce.EventType.SCROLLING,this.updateBlocksVisibility),this.node.scene.on(Ga.HIDE_UI,this.hideContent),this.node.scene.on(Ga.SHOW_UI,this.showContent)}unlistenEvents(){this.themeScrollView.node.off(ce.EventType.SCROLLING,this.updateBlocksVisibility),this.unlistenUIEvents()}unlistenUIEvents(){this.node.scene.off(Ga.HIDE_UI,this.hideContent),this.node.scene.off(Ga.SHOW_UI,this.showContent)}init(e){if(0===e.length)return;this.getThemeTabs().forEach(((t,i)=>t.updateThemeBlockDisplay(e[i])))}preserveScrollPosition(){this.themeScrollView.stopAutoScroll(),this.preservedScrollPosition.set(this.themeScrollView.getScrollOffset())}restoreScrollPosition(){this.themeScrollView.scrollToOffset(this.preservedScrollPosition,0)}updateUnlockedProgress(e){const t=aT.getStorageData("collection","animateMapPackUnlock"),i=aT.getStorageData("collection","lastMapPack");e.forEach(((e,n)=>{const{skin:a,progress:s,max:o,isLocked:r}=e;if(s<o&&!r&&t&&i!==n+1)return this.animateThemeTabUnlock=e,aT.setStorageData("collection","animateMapPackUnlock",!1),aT.setStorageData("collection","lastMapPack",n+1),void this.setProgressToThemeTab(a,{...e,isLocked:!0});this.setProgressToThemeTab(a,e)}))}shouldAnimateThemeTabUnlock(){return null!==this.animateThemeTabUnlock}async playThemeTabUnlockAnim(e){if(!this.animateThemeTabUnlock)return;const t=this.findThemeTab(this.animateThemeTabUnlock.skin);if(void 0===t)throw new Error("CollectionsContent: ThemeTab not found");await t.playUnlockAnim(e,{...this.animateThemeTabUnlock,isLocked:!0}),this.animateThemeTabUnlock=null}async scrollToCurrentUnlockingTheme(e,t){const i=this.findThemeTab(e);if(!i)return;const{y:n}=i.node.position,a=-n-this.offsetFromTopOfScrollView;await this.scrollToOffset(new Q(0,a),2,t)}async scrollToOffset(e,t,i){this.themeScrollView.scrollToOffset(e,t),await vt.waitTweenAsync(t,i),i.aborted&&(this.themeScrollView.stopAutoScroll(),this.themeScrollView.scrollToOffset(e,0))}setProgressToThemeTab(e,t){const i=this.findThemeTab(e);if(void 0===i)throw new Error("CollectionsContent: ThemeTab not found");i.updateThemeBlockDisplay(t)}findThemeTab(e){return sT.search(this.getThemeTabs(),(t=>t.getSkinName()===e))}getThemeTabs(){return this.themeScrollView.content.getComponentsInChildren(qC)}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"panelAnimator",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZC=ve(QC.prototype,"themeScrollView",[YC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eT=ve(QC.prototype,"contentOpacity",[jC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tT=ve(QC.prototype,"offsetFromTopOfScrollView",[XC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 407.5}}),$C=QC))||$C);var rT;i._RF.pop(),i._RF.push({},"dab8cbliOBAeZ7iVs959mBm","CollectionsPage",void 0);const{ccclass:lT}=a;let cT=lT("CollectionsPage")(rT=class extends BE{constructor(){super(...arguments),this.payload=null}setPayload(e){this.payload=e}async mount(){if(!this.pagePrefab){const e=await ci.loadPrefabAsync(oi.COLLECTIONS_PAGE);e&&this.node&&(this.pagePrefab=e)}if(await super.mount(),this.containerUIOpacity.opacity=0,!this.themeContent&&(this.themeContent=this.container.getComponentInChildren(oT),!this.themeContent))throw new Error("No theme content found");this.payload&&this.themeContent.init(this.payload)}async transitionIn(){await super.transitionIn(),this.themeContent.restoreScrollPosition(),this.themeContent.updateBlocksVisibility(),this.themeContent.enableUIAnimator(),this.themeContent.listenEvents();const e=vt.runTweenAsync(E(this.containerUIOpacity).to(.2,{opacity:255})),t=new Promise((e=>{this.node.scene.emit(Ga.SHOW_UI,{onComplete:()=>{e()}})}));await Promise.all([e,t])}async transitionOut(){await super.transitionOut(),this.themeContent.preserveScrollPosition(),this.themeContent.unlistenUIEvents(),await new Promise((e=>{this.node.scene.emit(Ga.HIDE_UI,{onComplete:()=>{e()}})})),this.themeContent.disableUIAnimator(),this.themeContent.unlistenEvents()}})||rT;var hT,dT,uT,pT,mT,gT,yT,bT,fT,wT,ST,vT,ET,CT,TT,AT,RT,IT,PT,_T,LT,DT,OT,NT,MT,kT,xT;i._RF.pop(),i._RF.push({},"2381b1mKt1PUq5W+fsaaOYP","PageManager",void 0);const{ccclass:FT,property:BT,disallowMultiple:zT,requireComponent:UT}=a,{Array:GT}=GameCore.Utils;let HT=(hT=FT("PageManagerItem"),dT=BT(BE),uT=BT({type:M(ai)}),hT((gT=ve((mT=class{constructor(){e(this,"page",gT,this),e(this,"pageType",yT,this)}}).prototype,"page",[dT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yT=ve(mT.prototype,"pageType",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pT=mT))||pT),VT=(bT=FT("PageManager"),fT=UT(l),wT=BT({type:x,displayName:"Background Mask",group:"Background Mask"}),ST=BT({type:C,displayName:"Transition duration",group:"Background Mask"}),vT=BT({type:C,displayName:"Transition delay",group:"Background Mask"}),ET=BT({type:x,displayName:"Nav Bar Shadow",group:"Nav Bar Shadow"}),CT=BT({type:C,displayName:"Transition duration",group:"Nav Bar Shadow"}),TT=BT({type:C,displayName:"Transition delay",group:"Nav Bar Shadow"}),AT=BT({type:[HT]}),RT=BT({type:M(ai)}),bT(IT=zT(IT=fT((_T=ve((PT=class extends s{constructor(){super(...arguments),e(this,"backgroundMask",_T,this),e(this,"backgroundMaskTransitionDuration",LT,this),e(this,"backgroundMaskTransitionDelay",DT,this),e(this,"navBarShadow",OT,this),e(this,"navBarShadowTransitionDuration",NT,this),e(this,"navBarShadowTransitionDelay",MT,this),e(this,"pageItems",kT,this),e(this,"currentScreen",xT,this)}unmountAndHideAll(){this.pageItems.forEach((e=>{const{page:t,pageType:i}=e;i!==this.currentScreen&&(t.unmount(),t.hide())}))}onLoad(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}updateCollectionsContentPayload(e){const t=this.getPage(ai.collections);t&&t instanceof cT&&t.setPayload(e)}async navigate(e,t,i){const{from:n,to:a}=e;if(null===n){const e=this.getPage(this.currentScreen);return e.show(),await e.mount(),await(t?.(e)),this.node.scene.emit(ii,{from:null,to:a}),await e.transitionIn(),await(i?.(e)),void(this.currentScreen=a)}if(n!==this.currentScreen)throw new Error("PageManager: Cannot navigate from a different screen. Perhaps you forgot to update the currentScreen property.");const s=this.getPage(this.currentScreen),o=this.getPage(a);if(!o||!s)throw new Error("PageManager: Cannot navigate to/from a null page. Perhaps you forgot to add the page to the pageItems array in the editor.");const r=this.uiTransform.width,l=this.getPageIndex(n),c=this.getPageIndex(a),h=Math.min(l,c),d=Math.max(l,c),u=(d-h)*r,p=l<c?1:-1,m=this.pageItems.slice(h,d+1);m.forEach(((e,t)=>{let{page:i}=e;i.show();i.getWidget().enabled=!1,i.node.position=new j((t+h-l)*r,i.node.position.y,i.node.position.z)}));let g=!1;o.hasLoadedPage()||(g=!0,ql.showLoadingScreen(),await vt.waitTweenAsync(.5)),await o.mount(),await(t?.(o)),this.node.scene.emit(ii,{from:n,to:a}),await Promise.all([s.transitionOut(),this.transition(u,p,m),this.handleBackgroundMask(this.backgroundMaskTransitionDuration,o.getDarkenBackground()),this.handleNavBarShadow(this.navBarShadowTransitionDuration,o.getNavbarShadow())]);const y=o.getWidget();y.enabled=!0,y.left=0,y.right=0,o.updateWidgets(),o.updateLayouts(),m.forEach((e=>{e.pageType!==a&&(e.page.unmount(),e.page.hide())})),this.currentScreen=a,await o.transitionIn(),await(i?.(o)),g&&ql.closeLoadingScreen()}getPage(e){const t=this.getPageIndex(e);return-1!==t?this.pageItems[t].page:null}async handleBackgroundMask(e,t){await vt.runTweenAsync(E(this.backgroundMask).delay(this.backgroundMaskTransitionDelay).to(e,{opacity:t}).start())}async handleNavBarShadow(e,t){await vt.runTweenAsync(E(this.navBarShadow).delay(this.navBarShadowTransitionDelay).to(e,{opacity:t}).start())}getPageIndex(e){return GT.searchIndex(this.pageItems,(t=>t.pageType===e))}async transition(e,t,i){await Promise.all(i.map((i=>{let{page:n}=i;return vt.runTweenAsync(E(n.node).to(.5,{position:new j(n.node.position.x-e*t,n.node.position.y,n.node.position.z)},{easing:k.quintInOut}))})))}validateRequiredComponents(){if(!this.uiTransform)throw new Error("PageManager requires UITransform component");if(!this.backgroundMask)throw new Error("PageManager requires background mask")}}).prototype,"backgroundMask",[wT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LT=ve(PT.prototype,"backgroundMaskTransitionDuration",[ST],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),DT=ve(PT.prototype,"backgroundMaskTransitionDelay",[vT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),OT=ve(PT.prototype,"navBarShadow",[ET],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NT=ve(PT.prototype,"navBarShadowTransitionDuration",[CT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),MT=ve(PT.prototype,"navBarShadowTransitionDelay",[TT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),kT=ve(PT.prototype,"pageItems",[AT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xT=ve(PT.prototype,"currentScreen",[RT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ai.home}}),IT=PT))||IT)||IT)||IT);var qT,WT,KT,YT,jT,XT,$T,QT,JT,ZT,eA,tA,iA;i._RF.pop(),i._RF.push({},"500274Qu9dAjJwYv27wMaMU","StarProgressBar",void 0);const{ccclass:nA,property:aA}=a;let sA=(qT=nA("StarProgressBar"),WT=aA(Gs),KT=aA(h),YT=aA(f),jT=aA(f),XT=aA(b),qT((JT=ve((QT=class extends s{constructor(){super(...arguments),e(this,"progressBar",JT,this),e(this,"progressLabel",ZT,this),e(this,"current",eA,this),e(this,"total",tA,this),e(this,"separator",iA,this)}setRange(e,t){this.total=t,this.current=e,this.updateProgress()}onLoad(){this.validateRequiredComponents()}updateProgress(){this.progressBar.progress=Math.min(this.current,this.total)/this.total,this.updateProgressLabel()}updateProgressLabel(){this.progressLabel.string=`${this.current}${this.separator}${this.total}`}async animateTo(e,t,i){const n=Math.min(e,this.total)/this.total,a=this.current;let s=1;const o=E(this.progressBar).to(3,{progress:n},{easing:"quadOut",onUpdate:(t,n)=>{n&&(this.current=a+Math.floor((e-a)*n),i?.(this.current),this.current===a-s&&(s++,E(this.progressLabel.node).to(.05,{scale:new j(1.2,1.2,1.2)}).to(.05,{scale:j.ONE}).start()),this.updateProgressLabel())}});t?.addAbortListener((()=>{this.current=e,this.updateProgress()})),await vt.runTweenAsync(o,t)}validateRequiredComponents(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}).prototype,"progressBar",[WT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZT=ve(QT.prototype,"progressLabel",[KT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eA=ve(QT.prototype,"current",[YT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tA=ve(QT.prototype,"total",[jT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iA=ve(QT.prototype,"separator",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$T=QT))||$T);var oA,rA,lA,cA,hA,dA;i._RF.pop(),i._RF.push({},"83036ocqiZHXrI3Aq0dBJRD","EventButton",void 0);const{ccclass:uA,property:pA}=a;let mA=(oA=uA("EventButton"),rA=pA({type:M(Sf)}),lA=pA(H),oA((dA=ve((hA=class extends xn{constructor(){super(...arguments),e(this,"eventType",dA,this),this._isAvailable=!1}get isAvailable(){return this._isAvailable}set isAvailable(e){this._isAvailable=e,this.fakeClick()}handleClick(){this.node.scene.emit(ni,{type:this.eventType})}setAnimationState(e){this.animationController.setValue("RESET-SPECIAL",this._isAvailable),super.setAnimationState(e)}}).prototype,"eventType",[rA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sf.STAR_CHEST}}),ve(hA.prototype,"isAvailable",[lA],Object.getOwnPropertyDescriptor(hA.prototype,"isAvailable"),hA.prototype),cA=hA))||cA);var gA,yA,bA,fA,wA,SA,vA,EA,CA,TA,AA;i._RF.pop(),i._RF.push({},"87a11fQFYVFcphsqf5ivVof","DashboardHeader",void 0);const{ccclass:RA,property:IA}=a,{player:PA}=globalThis.game;let _A=(gA=RA("DashboardHeader"),yA=IA({type:sA,displayName:"Progress bar",group:"Star Chest"}),bA=IA({type:mA,displayName:"Button Component",group:"Star Chest"}),fA=IA({type:D,displayName:"Default Rest animation",group:"Star Chest"}),wA=IA({type:D,displayName:"Special Rest animation",group:"Star Chest"}),gA((EA=ve((vA=class extends s{constructor(){super(...arguments),e(this,"starProgressBar",EA,this),e(this,"chestButton",CA,this),e(this,"defaultRestAnimation",TA,this),e(this,"specialRestAnimation",AA,this),this.handleStarsUpdateEvent=e=>{void 0!==(e=e??PA.getGameData()?.stars)&&(this.starProgressBar.setRange(e,20),this.updateStarChestButtonAnimation(e))}}__preload(){this.validateRequiredComponents(),W.on(Zt,this.handleStarsUpdateEvent)}onDestroy(){W.off(Zt,this.handleStarsUpdateEvent)}updateStarProgress(e){this.handleStarsUpdateEvent(e)}updateStarChestButtonAnimation(e){this.chestButton.isAvailable=e>=20}validateRequiredComponents(){if(!this.starProgressBar)throw new Error("DashboardHeader: starProgressBar not found");if(!this.chestButton)throw new Error("DashboardHeader: chestButton not found");if(!this.defaultRestAnimation)throw new Error("DashboardHeader: defaultRestAnimation not found");if(!this.specialRestAnimation)throw new Error("DashboardHeader: specialRestAnimation not found")}}).prototype,"starProgressBar",[yA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CA=ve(vA.prototype,"chestButton",[bA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TA=ve(vA.prototype,"defaultRestAnimation",[fA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AA=ve(vA.prototype,"specialRestAnimation",[wA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SA=vA))||SA);var LA,DA,OA,NA,MA,kA,xA,FA,BA,zA,UA,GA,HA,VA,qA,WA,KA,YA;i._RF.pop(),i._RF.push({},"3b954Re2cRHvYJeBVAukYp9","JourneyLevelAvatar",void 0);const{ccclass:jA,property:XA,executeInEditMode:$A}=a;let QA=(LA=jA("JourneyLevelAvatar"),DA=XA({type:R,displayName:"Avatar node"}),OA=XA(n),NA=XA(y),MA=XA(x),kA=XA({type:D,group:"Animation"}),xA=XA({type:D,group:"Animation"}),FA=XA({type:D,group:"Animation"}),BA=XA({type:N,displayName:"Avatar sprite"}),LA(zA=$A((GA=ve((UA=class extends s{constructor(){super(...arguments),e(this,"sprite",GA,this),e(this,"lockIcon",HA,this),e(this,"animation",VA,this),e(this,"opacity",qA,this),e(this,"flashAnimation",WA,this),e(this,"unlockAnimation",KA,this),e(this,"spawnAnimation",YA,this)}get avatarSprite(){return this.sprite?.spriteFrame??null}set avatarSprite(e){this.sprite&&(this.sprite.spriteFrame=e)}async playUnlockAnimation(){const e=this.playAnimation(this.unlockAnimation),t=this.lockIcon.position.x,i=this.lockIcon.position.y,n=[45,135],a=(Math.random()*(n[1]-n[0])+n[0])*(Math.PI/180),s=this.lockIcon.position.x+150*Math.cos(a),o=this.lockIcon.position.y+150*Math.sin(a),r=i-400,l=vt.runTweenAsync(E(this.lockIcon).delay(.3).to(.2,{position:new j(s,o,this.lockIcon.position.z)},{easing:"sineOut"}).to(.4,{position:new j(s,r,this.lockIcon.position.z)},{easing:"cubicIn"})),c=[0,360],h=vt.runTweenAsync(E(this.lockIcon).delay(.3).to(.6,{eulerAngles:new j(0,0,Math.random()*(c[1]-c[0])*(s>t?-1:1))},{easing:"sineOut"}));await Promise.all([e,l,h]),this.lockIcon.position=new j(t,i,this.lockIcon.position.z),this.lockIcon.eulerAngles=new j(0,0,0)}async playFlashAnimation(){const e=this.node.position.y,t=this.playAnimation(this.flashAnimation),i=vt.runTweenAsync(E(this.node).to(.1,{position:new j(this.node.position.x,this.node.position.y+10,this.node.position.z)},{easing:"sineOut"}).to(.1,{position:new j(this.node.position.x,e,this.node.position.z)},{easing:"sineIn"}));await Promise.all([t,i])}playSpawnAnimation(){this.opacity.opacity=255,this.playAnimation(this.spawnAnimation)}hideImmediately(){this.opacity.opacity=0,this.node.setScale(j.ZERO)}async playAnimation(e){await vt.runAnimationAsync(this.animation,e.name)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.sprite)throw new Error("JourneyLevelAvatar: Avatar node is required");if(!this.lockIcon)throw new Error("JourneyLevelAvatar: Lock icon is required");if(!this.flashAnimation)throw new Error("JourneyLevelAvatar: Flash animation is required");if(!this.unlockAnimation)throw new Error("JourneyLevelAvatar: Unlock animation is required");if(!this.animation)throw new Error("JourneyLevelAvatar: Animation component is required");if(!this.animation.clips.some((e=>null!==e&&(e.name===this.flashAnimation.name||e.name===this.unlockAnimation.name||e.name===this.spawnAnimation.name))))throw new Error("JourneyLevelAvatar: Animation component does not contain required animations")}}).prototype,"sprite",[DA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HA=ve(UA.prototype,"lockIcon",[OA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VA=ve(UA.prototype,"animation",[NA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qA=ve(UA.prototype,"opacity",[MA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WA=ve(UA.prototype,"flashAnimation",[kA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KA=ve(UA.prototype,"unlockAnimation",[xA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YA=ve(UA.prototype,"spawnAnimation",[FA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(UA.prototype,"avatarSprite",[BA],Object.getOwnPropertyDescriptor(UA.prototype,"avatarSprite"),UA.prototype),zA=UA))||zA)||zA);var JA,ZA,eR,tR,iR,nR,aR,sR,oR,rR,lR,cR;i._RF.pop(),i._RF.push({},"a392bibG75JPKzG0y2ZS2YY","JourneyProgressBar",void 0);const{ccclass:hR,property:dR,executeInEditMode:uR}=a;let pR=(JA=hR("JourneyProgressBar"),ZA=dR(Gs),eR=dR(h),tR=dR(x),iR=dR(f),nR=dR(f),aR=dR(b),JA(sR=uR((rR=ve((oR=class extends s{constructor(){super(...arguments),e(this,"progressBar",rR,this),e(this,"progressLabel",lR,this),e(this,"labelUIOpacity",cR,this),this.currentProgress=10,this.totalProgress=10,this.labelSeparator="/"}get total(){return this.totalProgress}get current(){return this.currentProgress}get separator(){return this.labelSeparator}set separator(e){this.labelSeparator=e,this.updateProgress()}setRange(e,t){this.totalProgress=t,e>t&&(e=t),this.currentProgress=e,this.updateProgress()}onLoad(){this.validateRequiredComponents()}async animateTo(e){const{nextCurr:t,nextTotal:i,numberOfProgressBar:n=0,onProgressBarPassed:a,signal:s}=e,o=t/i,r=E(this.labelUIOpacity).to(.2,{opacity:0}),l=E(this.labelUIOpacity).to(.2,{opacity:255}),c=n<1?1:Math.sqrt(n)+1,h=0===n?o:n+o;let d=1;const u=E({curr:this.progressBar.progress}).to(c,{curr:h},{easing:"sineInOut",onUpdate:e=>{if(void 0===e)return;const{curr:t}=e;this.progressBar.progress=t%1,t>d&&(d=0===t?1:Math.ceil(t),a?.())}});return await Promise.all([vt.runTweenAsync(r,s),vt.runTweenAsync(u,s)]),this.currentProgress=t,this.totalProgress=i,this.updateProgress(),await vt.runTweenAsync(l,s),this.labelUIOpacity.opacity=255,o}updateProgress(){this.progressBar.progress=this.currentProgress/this.totalProgress,this.progressLabel.string=`${this.currentProgress}${this.separator}${this.totalProgress}`}validateRequiredComponents(){if(!this.progressBar)throw new Error("JourneyProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("JourneyProgressBar: Missing required component Label")}}).prototype,"progressBar",[ZA],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lR=ve(oR.prototype,"progressLabel",[eR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cR=ve(oR.prototype,"labelUIOpacity",[tR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(oR.prototype,"total",[iR],Object.getOwnPropertyDescriptor(oR.prototype,"total"),oR.prototype),ve(oR.prototype,"current",[nR],Object.getOwnPropertyDescriptor(oR.prototype,"current"),oR.prototype),ve(oR.prototype,"separator",[aR],Object.getOwnPropertyDescriptor(oR.prototype,"separator"),oR.prototype),sR=oR))||sR)||sR);var mR,gR,yR,bR,fR,wR,SR,vR,ER,CR,TR,AR,RR,IR,PR,_R,LR,DR,OR,NR,MR,kR;i._RF.pop(),i._RF.push({},"8a41bfxLylDhLk57kewW14A","JourneyProgressAnimator",void 0);const{ccclass:xR,property:FR}=a,{Array:BR}=GameCore.Utils;let zR=(mR=xR("ProgressConfiguration"),gR=FR(N),yR=FR(b),mR((wR=ve((fR=class{constructor(){e(this,"avatar",wR,this),e(this,"themeId",SR,this)}}).prototype,"avatar",[gR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SR=ve(fR.prototype,"themeId",[yR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bR=fR))||bR),UR=(vR=xR("JourneyProgressAnimator"),ER=FR(pR),CR=FR(n),TR=FR(R),AR=FR(QA),RR=FR(zR),IR=FR({type:C,displayName:"Next Level Y Offset on Animation",group:"Unlocked Animation"}),vR((LR=ve((_R=class extends s{constructor(){super(...arguments),e(this,"progressBar",LR,this),e(this,"currentLevelAvatarNode",DR,this),e(this,"currentLevelAvatar",OR,this),e(this,"nextLevelAvatar",NR,this),e(this,"progressConfigs",MR,this),e(this,"nextLevelYOffset",kR,this),this.isAnimating=!1}setRange(e,t){this.progressBar.setRange(e,t)}async animateTo(e,t){if(this.isAnimating)return console.warn("JourneyProgressAnimator: animation already in progress"),Promise.resolve();this.isAnimating=!0,e!==this.progressBar.current&&await this.progressBar.animateTo({nextCurr:e,nextTotal:this.progressBar.total,signal:t}),this.isAnimating=!1}async animateToNextLevel(e){let{nextCurr:t,nextTotal:i,mapsPassed:n,signal:a}=e;if(this.isAnimating)return void console.warn("JourneyProgressAnimator: animation already in progress");this.isAnimating=!0;const s=n.length-2;if(0===s)return await this.progressBar.animateTo({nextCurr:t,nextTotal:i,signal:a}),void(this.isAnimating=!1);await this.animateTargetAvaToCenter(a);let o=1;await this.progressBar.animateTo({signal:a,nextCurr:t,nextTotal:i,numberOfProgressBar:s,onProgressBarPassed:()=>{if(1===o)return this.nextLevelAvatar.playUnlockAnimation(),void(o+=1);if(o>=n.length)throw new Error("JourneyProgressAnimator: currThemeIndex out of bounds");this.nextLevelAvatar.playFlashAnimation(),this.setNextLevelAvatar(n[o].theme),o+=1}}),await this.animateTargetAvaToPrev(a);const r=n[n.length-1].theme,l=n[n.length-2].theme;this.setCurrentLevelAvatar(l),this.nextLevelAvatar.hideImmediately(),this.moveTargetAvaToOriginal(),this.nextLevelAvatar.avatarSprite=this.getSpriteFrameByThemeId(r),this.nextLevelAvatar.playSpawnAnimation(),this.isAnimating=!1}async animateTargetAvaToCenter(e){const t=new j(0,this.nextLevelYOffset+this.nextLevelAvatar.node.position.y,this.nextLevelAvatar.node.position.z);await vt.runTweenAsync(E(this.nextLevelAvatar.node).to(1,{position:t},{easing:"cubicInOut"}),e),this.nextLevelAvatar.node.position=t}moveTargetAvaToOriginal(){this.nextLevelAvatar.node.position=this.originalNextLevelAvatarPosition.clone()}async animateTargetAvaToPrev(e){const t=this.currentLevelAvatarNode.position.clone();await vt.runTweenAsync(E(this.nextLevelAvatar.node).to(1,{position:t},{easing:"cubicInOut"}),e),this.nextLevelAvatar.node.position=t}getSpriteFrameByThemeId(e){const t=BR.search(this.progressConfigs,(t=>t.themeId===e));if(!t)throw new Error(`JourneyProgressController: config not found for themeId ${e}`);return t.avatar}setAvatar(e,t){const i=this.getSpriteFrameByThemeId(e);t instanceof QA?t.avatarSprite=i:t.spriteFrame=i}setCurrentLevelAvatar(e){this.setAvatar(e,this.currentLevelAvatar)}setNextLevelAvatar(e){this.setAvatar(e,this.nextLevelAvatar)}onLoad(){this.validateRequiredComponents(),this.originalNextLevelAvatarPosition=this.nextLevelAvatar.node.position.clone()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"progressBar",[ER],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DR=ve(_R.prototype,"currentLevelAvatarNode",[CR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OR=ve(_R.prototype,"currentLevelAvatar",[TR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NR=ve(_R.prototype,"nextLevelAvatar",[AR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MR=ve(_R.prototype,"progressConfigs",[RR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kR=ve(_R.prototype,"nextLevelYOffset",[IR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),PR=_R))||PR);var GR,HR,VR,qR,WR,KR,YR,jR,XR,$R,QR,JR,ZR,eI,tI,iI,nI;i._RF.pop(),i._RF.push({},"c2ddaEnKBVFvrM5x5nbfT7h","HomeContent",void 0);const{ccclass:aI,property:sI}=a,{storage:oI}=globalThis.game;let rI=(GR=aI("HomeContent"),HR=sI(h),VR=sI(p),qR=sI(UR),WR=sI(us),KR=sI(_A),YR=sI(x),jR=sI(Wv),GR((QR=ve(($R=class extends s{constructor(){super(...arguments),e(this,"playButtonLabel",QR,this),e(this,"playButton",JR,this),e(this,"journeyProgressAnimator",ZR,this),e(this,"panelAnimator",eI,this),e(this,"dashboardHeader",tI,this),e(this,"overlayDuringAnim",iI,this),e(this,"coinContainer",nI,this)}__preload(){this.validateRequiredComponents()}getCoinContainer(){return this.coinContainer}handlePlayButtonPress(){this.playButton.interactable=!1,this.node.scene.emit(ei)}setPlayButtonLabel(e){this.playButtonLabel.string=e}updateStarProgress(e){this.dashboardHeader.updateStarProgress(e)}setUnlockProgress(e){this.setProgress(e),this.updateCurrentMapInStorage(e)}prepareUnlockProgressAnimation(e,t,i,n){if(e.id===t.id){this.setProgress({...t,progress:e.progress}),this.updateCurrentMapInStorage(t);const i=t.progress;return async()=>{this.playButton.interactable=!1,await this.showOwnOverlay(n),await this.journeyProgressAnimator.animateTo(i,n),await this.hideOwnOverlay(n),this.playButton.interactable=!0}}return this.setProgress(e),this.updateCurrentMapInStorage(t),async()=>{this.playButton.interactable=!1,await this.showOwnOverlay(n),await this.journeyProgressAnimator.animateToNextLevel({nextCurr:t.progress,nextTotal:t.max,mapsPassed:i,signal:n}),await this.hideOwnOverlay(n),this.playButton.interactable=!0}}async hideOwnOverlay(e){await vt.runTweenAsync(E(this.overlayDuringAnim).to(.3,{opacity:0}),e),this.overlayDuringAnim.opacity=0}async showOwnOverlay(e){await vt.runTweenAsync(E(this.overlayDuringAnim).to(.3,{opacity:150}),e)}setProgress(e){const{currentTheme:t,nextTheme:i,progress:n,max:a}=e;this.journeyProgressAnimator.setCurrentLevelAvatar(t),this.journeyProgressAnimator.setNextLevelAvatar(i??t),this.journeyProgressAnimator.setRange(n,a)}updateCurrentMapInStorage(e){oI.setStorageData("dashboard","animateToCurrentLevel",!1),oI.setStorageData("dashboard","lastMapPayload",e)}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"playButtonLabel",[HR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JR=ve($R.prototype,"playButton",[VR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZR=ve($R.prototype,"journeyProgressAnimator",[qR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eI=ve($R.prototype,"panelAnimator",[WR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tI=ve($R.prototype,"dashboardHeader",[KR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iI=ve($R.prototype,"overlayDuringAnim",[YR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nI=ve($R.prototype,"coinContainer",[jR],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XR=$R))||XR);var lI,cI,hI,dI,uI,pI,mI,gI,yI,bI,fI,wI,SI,vI,EI;i._RF.pop(),i._RF.push({},"f555belwQ1NHJr4np65OtcU","NavManager",void 0);const{ccclass:CI,property:TI}=a,{ads:AI}=globalThis.game,{Utils:{Array:RI}}=GameCore;let II=(lI=CI("NavManager"),cI=TI(n),hI=TI(n),dI=TI(Wt),uI=TI(H),pI=TI({type:A,visible:function(){return this.useOffsetWhenSAB}}),mI=TI({type:C,visible:function(){return this.useOffsetWhenSAB}}),lI((bI=ve((yI=class extends s{constructor(){super(...arguments),e(this,"selectorNode",bI,this),e(this,"selectedButtonNode",fI,this),e(this,"autoLayout",wI,this),e(this,"useOffsetWhenSAB",SI,this),e(this,"offsetWidget",vI,this),e(this,"offsetWhenSAB",EI,this),this.navButtons=[],this.isNavigating=!1}get currentButton(){return this.selectedButton}onLoad(){this.navButtons=this.node.getComponentsInChildren("NavButton"),this.selectedButton=this.selectedButtonNode?.getComponentInChildren("NavButton"),Fe.lazyValidateProperties(this)}start(){if(!this.useOffsetWhenSAB)return;AI.getSafeAreaBottom(Xi.cssSizeToWorldSize(1))>0&&(this.offsetWidget.bottom=this.offsetWhenSAB)}async select(e){if(!this.isNavigating){if(!RI.has(this.navButtons,e))throw new Error("NavManager: Button not found");if(e!==this.selectedButton){if(!e.isWIP)return this.isNavigating=!0,this.node.scene.emit(ti,{from:this.selectedButton.buttonType,to:e.buttonType}),new Promise((t=>{this.node.scene.once(ii,(()=>{const i=this.selectedButton.deselect();this.autoLayout.selectedIndex=this.navButtons.indexOf(e),this.selectedButton=e;const n=this.autoLayout.getSelectedWorldX()-e.getSelectedWorldDistanceX(),a=this.playSelectorAnimation(n),s=e.select();Promise.all([i,s,a]).then((()=>{this.isNavigating=!1,t()}))}))}));this.handleWIPButton()}}}async selectUsingSceneTransition(e){this.isNavigating||(RI.has([ai.store],e.buttonType)?this.handleWIPButton():await this.select(e))}async selectByType(e){const t=RI.search(this.navButtons,(t=>t.buttonType===e));if(!t)throw new Error("NavManager: Button not found");await this.selectUsingSceneTransition(t)}handleWIPButton(){ql.openScreen(Gi.STAR_CHEST_SCREEN)}async selectDefaultNavBtn(){if(!this.currentButton||!RI.has(this.navButtons,this.currentButton))throw new Error("NavManager: Button not found");const e=this.currentButton.buttonType;return this.node.scene.emit(ti,{from:null,to:e}),new Promise((e=>{this.node.scene.once(ii,(()=>{this.autoLayout.selectedIndex=this.navButtons.indexOf(this.currentButton);const t=this.navButtons.map((e=>e===this.currentButton?e.select(!1):e.deselect(!1,!0))),i=this.autoLayout.getSelectedWorldX()-this.currentButton.getSelectedWorldDistanceX();this.selectorNode.worldPosition=new j(i,this.selectorNode.worldPosition.y,0),Promise.all(t).then((()=>{e()}))}))}))}async playSelectorAnimation(e){const t=new j(1,1,1),i=this.selectorNode.worldPosition.clone(),n=new j(1.2*t.x,.8*t.y,1);await vt.runTweenAsync(E(this.selectorNode).to(.3,{worldPosition:new j(e,i.y,0)},{easing:"quintInOut",onUpdate:(e,i)=>{if(void 0===i)return;const a=this.calculateCurrentSquashScale(t,n,i);this.selectorNode.scale=a}}))}setIgnoreInput(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.navButtons.forEach((t=>{const i=t.getComponentInChildren(p);i&&(i.interactable=!e)}))}calculateCurrentSquashScale(e,t,i){const n=this.splitIntoSquashRatio(i);return e.clone().lerp(t,n)}splitIntoSquashRatio(e){return e<.5?2*e:1-2*(e-.5)}}).prototype,"selectorNode",[cI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fI=ve(yI.prototype,"selectedButtonNode",[hI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wI=ve(yI.prototype,"autoLayout",[dI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SI=ve(yI.prototype,"useOffsetWhenSAB",[uI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),vI=ve(yI.prototype,"offsetWidget",[pI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EI=ve(yI.prototype,"offsetWhenSAB",[mI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),gI=yI))||gI);var PI,_I,LI,DI,OI,NI,MI,kI,xI,FI,BI,zI,UI;i._RF.pop(),i._RF.push({},"d48a1TnKg1F4YRzzKmQOD5k","DashboardScene",void 0);const{ccclass:GI,disallowMultiple:HI,property:VI}=a,{event:qI,storage:WI,player:KI,leaderboard:YI}=globalThis.game,{Events:jI,Match:{Modes:XI},Configs:{DailyRewards:$I},Utils:{Time:QI,Json:JI,Array:ZI}}=GameCore;PI=GI("DashboardScene"),_I=VI(Vw),LI=VI(II),DI=VI(ki),OI=VI(VT),NI=VI(Ov),PI(MI=HI((xI=ve((kI=class extends s{constructor(){super(...arguments),e(this,"coinManager",xI,this),e(this,"navManager",FI,this),e(this,"bgComp",BI,this),e(this,"pageManager",zI,this),e(this,"pageAnimSkipOverlay",UI,this),this.firstNavigation=!0,this.isFirstNavToCollections=!0,this.playBgAnim=async()=>{const e=WI.getStorage("dashboard");if(null==e)throw new Error("DashboardScene: dashboardStorage not found");const t=e.animateToCurrentLevel??!1,i={...e.lastMapPayload},n=rl.getCurrentMapProgress(),a=i.currentTheme===n.currentTheme&&i.nextTheme===n.nextTheme,s=n.currentTheme;if(t&&!a){await vt.waitTweenAsync(2);try{await this.bgComp.animateToNextTheme(s)}catch(e){}}},this.handlePlayButtonPress=async()=>{try{await wl.startMatchAsync(XI.SINGLE);const e=rl.getCurrentMapProgress(),{level:t=1}=KI.getGameData()??{};this.updateCurrentMapInStorage(e),WI.setStorageData("collection","lastMapPack",e.id),WI.setStorageData("collection","animateMapPackUnlock",!1);const{lastTabOpened:i}=WI.getStorage("leaderboard_content");this.getPlayerLeader(i).then((e=>{if(!e)return;const{score:t,rank:i}=e;WI.setStorageData("leaderboard_content","previousScore",t),WI.setStorageData("leaderboard_content","previousRank",i)})),El.switchScene(Fr,{level:t})}catch(e){return void console.error(e)}},this.onNavigate=async e=>{switch(this.firstNavigation&&(this.firstNavigation=!1,this.pageManager.unmountAndHideAll()),e.to){case ai.store:this.navManager.setIgnoreInput(),await this.pageManager.navigate(e),this.handleNavigateToStore(),this.navManager.setIgnoreInput(!1);break;case ai.collections:await this.onNavigateToCollections({...e,to:ai.collections});break;case ai.tournaments:await this.onNavigateToTournaments(e);break;case ai.leaderboard:await this.onNavigateToLeaderboard({...e,to:ai.leaderboard});break;case ai.home:await this.handleNavigateToHome(e);break;default:throw new Error("DashboardScene: Unhandled page name")}},this.handleEventButtonPress=e=>{switch(e.type){case Sf.STAR_CHEST:ql.openScreen(Gi.STAR_CHEST_SCREEN);break;case Sf.BALLOON:ql.showNotificationScreen("Coming soon!");break;default:throw new Error("DashboardScene: Unhandled event button type")}}}__preload(){this.panelAnimationController=this.getComponent(Va),this.validateRequiredComponents(),this.listenNavigationEvents(),this.listenDashboardEvents(),this.panelAnimationController.init()}listenNavigationEvents(){this.node.scene.on(ti,this.onNavigate)}listenDashboardEvents(){this.node.scene.on(ei,this.handlePlayButtonPress),this.node.scene.on(ni,this.handleEventButtonPress)}onLoad(){this.coinManager.init(this.pageAnimSkipOverlay),rl.init(),this.setPlayerLevel(),this.initBgComp(),this.pageManager.updateCollectionsContentPayload(rl.getCollectionUnlockProgress())}setPlayerLevel(){let{level:e=1}=KI.getGameData()??{};e=0===e?1:e,KI.setGameData({level:e})}start(){KI.getPlayerSetting("music")&&ji.playMusic(),this.playBgAnim(),this.navManager.selectDefaultNavBtn(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}preloadScenes(){El.preloadGameScene()}initBgComp(){const e=WI.getStorage("dashboard");if(null==e)throw new Error("DashboardScene: dashboardStorage not found");const t=e.animateToCurrentLevel??!1,i={...e.lastMapPayload},n=rl.getCurrentMapProgress(),a=i.currentTheme===n.currentTheme&&i.nextTheme===n.nextTheme,s=n.currentTheme;t&&!a?this.bgComp.setCurrentTheme(i.currentTheme):this.bgComp.setCurrentTheme(s)}async getPlayerLeader(e){const t="global"==e?_r:Lr;if(!t)return null;const i=KI.getPlayerId(),n=await YI.getLeadersByPlayerIdsAsync(t,[i]);return 0===n.length?null:n[0]}updateCurrentMapInStorage(e){WI.setStorageData("dashboard","animateToCurrentLevel",!1),WI.setStorageData("dashboard","lastMapPayload",e)}updateVolumeBackgroundMusic(){ji.turnUpMusic()}checkDailyRewardsOpenable(){const{logDays:e=[],lastRewarded:t=0}=KI.getPlayerData().dailyRewarded;if(e.length>$I.MaxDays)return!0;if($I.MockTime>0){if(Date.now()-t>=1e3*$I.MockTime)return!0}return!QI.isToday(t)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}handleNavigateToStore(){}async onNavigateToCollections(e){this.navManager.setIgnoreInput();const t=rl.getCollectionUnlockProgress(),i=this.getCurrentUnlockingTheme();let n;if(await this.pageManager.navigate(e,(e=>(n=e.getContainer().getComponentInChildren(oT),n.updateUnlockedProgress(t),Promise.resolve()))),void 0===n)throw new Error("CollectionsContent not found");const a=new si,s=n.shouldAnimateThemeTabUnlock();s&&await this.pageAnimSkipOverlay.open({onSkip:()=>a.abort(),opacity:200}),this.isFirstNavToCollections&&null!==i&&(await n.scrollToCurrentUnlockingTheme(i.skin,a),this.isFirstNavToCollections=!1),await n.playThemeTabUnlockAnim(a),s&&await this.pageAnimSkipOverlay.close(),a.abort(),this.navManager.setIgnoreInput(!1)}async onNavigateToTournaments(e){this.navManager.setIgnoreInput(),await this.pageManager.navigate(e),this.navManager.setIgnoreInput(!1)}async onNavigateToLeaderboard(e){this.navManager.setIgnoreInput(),await this.pageManager.navigate(e),this.navManager.setIgnoreInput(!1)}setHomeDataAndGetNavAnim(){const e=this.pageManager.getPage(ai.home).getContainer().getComponentInChildren(rI);this.coinManager.setTargetContainer(e.getCoinContainer());const t=`Level ${KI.getGameData()?.level??1}`;e.setPlayButtonLabel(t),this.coinManager.emitCoinAmount();const i=KI.getGameData()?.stars??0;e.updateStarProgress(i);const n=WI.getStorage("dashboard");if(null==n)throw new Error("DashboardScene: dashboardStorage not found");const a=n.animateToCurrentLevel??!1,s={...n.lastMapPayload},o={...rl.getCurrentMapProgress()},{animateTournamentLeader:r}=WI.getStorage("tournament");if(r)return e.setUnlockProgress(o),async()=>{await this.navManager.selectByType(ai.tournaments)};if(JI.encode(s)===JI.encode(o))return void e.setUnlockProgress(o);if(!a)
//! this is bad for user experience
return void e.setUnlockProgress(o);const l=ZI.searchIndex($r.mapOrder,(e=>e.id===s.id)),c=ZI.searchIndex($r.mapOrder,(e=>e.id===o.id)),h=l===c;if(-1===l||-1===c)throw new Error("DashboardScene: map not found");
//! safe guard against dev tools time travel
if(l>c)return void e.setUnlockProgress(o);const d=$r.mapOrder.slice(l,c+2),u=new si,p=e.prepareUnlockProgressAnimation(s,o,d,u);return async()=>{await this.pageAnimSkipOverlay.open({onSkip:()=>u.abort(),opacity:150}),await p(),u.aborted||h||await this.navManager.selectByType(ai.collections),await this.pageAnimSkipOverlay.close()}}async handleNavigateToHome(e){let t;this.navManager.setIgnoreInput(),await this.pageManager.navigate(e,(async()=>{t=this.setHomeDataAndGetNavAnim()})),this.navManager.setIgnoreInput(!1),await this.tryOpenDailyRewardsScreen(),await this.coinManager.untilFinishesCollectAnim(),await this.pageAnimSkipOverlay.untilClosed(),await(t?.())}async tryOpenDailyRewardsScreen(){if(this.checkDailyRewardsOpenable())return ql.openScreen(Gi.DAILY_REWARDS_SCREEN),new Promise((e=>{const t=i=>{i.screenName===Hi[Gi.DAILY_REWARDS_SCREEN]&&(e(),qI.off(jI.CLOSED_SCREEN,t))};qI.on(jI.CLOSED_SCREEN,t)}))}getCurrentUnlockingTheme(){const e=rl.getCollectionUnlockProgress();if(0===e.length)return null;let t=e[0];for(const i of e){const{isLocked:e}=i;e||(t=i)}return t}}).prototype,"coinManager",[_I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FI=ve(kI.prototype,"navManager",[LI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=ve(kI.prototype,"bgComp",[DI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zI=ve(kI.prototype,"pageManager",[OI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UI=ve(kI.prototype,"pageAnimSkipOverlay",[NI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MI=kI))||MI);var eP,tP,iP,nP,aP;i._RF.pop(),i._RF.push({},"53f87ljsxFJUKsBbXk8WVkJ","HomePage",void 0);const{ccclass:sP,property:oP}=a,{player:rP}=globalThis.game,{Utils:{Number:lP}}=GameCore;eP=sP("HomePage"),tP=oP({type:h,group:"Placeholders"}),eP((aP=ve((nP=class extends BE{constructor(){super(...arguments),e(this,"coinLabel",aP,this)}__preload(){super.__preload?.(),this.validateOwnRequiredComponents(),this.listenToCoinUpdateEvent()}listenToCoinUpdateEvent(){this.node.scene.on(Ga.COIN_CHANGED,this.updateplaceholderCoins,this)}async updateplaceholderCoins(e){this.coinLabel.string=lP.getShortNumber(e.coins,3)}async mount(){if(await super.mount(),!this.homeContent&&(this.homeContent=this.container.getComponentInChildren(rI),!this.homeContent))throw new Error("HomePage: homeContent not found");const e=rP.getGameData()?.coins??0;this.updateplaceholderCoins({coins:e})}async transitionIn(){await super.transitionIn(),this.homeContent.enableUIAnimator()}async transitionOut(){this.homeContent.disableUIAnimator(),await super.transitionOut()}validateOwnRequiredComponents(){if(!this.coinLabel)throw new Error("HomePage: coinLabel not found")}}).prototype,"coinLabel",[tP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iP=nP));var cP;i._RF.pop(),i._RF.push({},"332aaP3dkhKxZNHiMFB1bKn","LeaderboardIsEmpty",void 0);const{ccclass:hP}=a;let dP=hP("LeaderboardIsEmpty")(cP=class extends s{onLoad(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.uiOpacity.opacity=255;const e=this.node.position.clone(),t=E(this.node);t.to(.05,{position:e.clone().add3f(5,0,0)}),t.to(.05,{position:e.clone().add3f(-5,0,0)});const i=E(this.node).repeat(2,t);i.to(.05,{position:e}),await vt.runTweenAsync(i)}hide(){this.uiOpacity.opacity=0}})||cP;var uP,pP,mP,gP,yP,bP,fP,wP,SP,vP,EP,CP,TP,AP,RP,IP,PP,_P,LP,DP;i._RF.pop(),i._RF.push({},"aa4b0d0u0hLeqd3+/PQZ/QD","SwitchButton",void 0);const{ccclass:OP,property:NP,requireComponent:MP}=a,{analytics:kP}=globalThis.game,{Utils:{Array:xP},Plugins:{Analytics:{Events:FP}}}=GameCore;let BP=(uP=OP("SwitchButton"),pP=MP([p,y]),mP=NP(H),gP=NP(n),yP=NP(n),bP=NP(H),fP=NP({visible(){return this.useSound},type:zi}),wP=NP(H),SP=NP({visible(){return this.useDesktopHover},type:D}),vP=NP({visible(){return this.useDesktopHover},type:D}),uP(EP=pP((TP=ve((CP=class extends s{constructor(){super(...arguments),e(this,"enable",TP,this),e(this,"nodeOn",AP,this),e(this,"nodeOff",RP,this),e(this,"useSound",IP,this),e(this,"soundKey",PP,this),e(this,"useDesktopHover",_P,this),e(this,"mouseEnterClip",LP,this),e(this,"mouseLeaveClip",DP,this),this.isMouseLeaved=!1,this.onMouseEnter=e=>{this.useDesktopHover&&this.buttonComponent.interactable&&(this.isMouseLeaved=!1,this.animationComponent.play(this.mouseEnterClip.name))},this.onMouseLeave=e=>{this.useDesktopHover&&this.buttonComponent.interactable&&(this.isMouseLeaved||(this.isMouseLeaved=!0,this.animationComponent.play(this.mouseLeaveClip.name)))}}__preload(){this.buttonComponent=this.getComponent(p),this.animationComponent=this.getComponent(y),this.validateRequiredComponents()}onLoad(){const e=this.animationComponent.clips.map((e=>e?.name)).filter((e=>null!=e&&"string"==typeof e));this.useDesktopHover&&(xP.has(e,this.mouseEnterClip.name)||this.animationComponent.addClip(this.mouseEnterClip),xP.has(e,this.mouseLeaveClip.name)||this.animationComponent.addClip(this.mouseLeaveClip))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onEnable(){this.node.on(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onDisable(){this.node.off(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}switch(){return!!this.node.active&&(kP.event(FP.BUTTON_CLICK,{button_name:this.node.name,enable:!this.enable}),this.useSound&&ji.playSound(Ui[this.soundKey]),this.updateStatus(!this.enable))}setEnabled(e){this.node.active&&this.updateStatus(e)}updateStatus(e){return this.enable===e||(this.onMouseLeave(null),this.enable=e,this.nodeOn.active=e,this.nodeOff.active=!e),this.enable}}).prototype,"enable",[mP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),AP=ve(CP.prototype,"nodeOn",[gP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RP=ve(CP.prototype,"nodeOff",[yP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IP=ve(CP.prototype,"useSound",[bP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),PP=ve(CP.prototype,"soundKey",[fP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zi[Fi.BUTTON_CLICK]}}),_P=ve(CP.prototype,"useDesktopHover",[wP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),LP=ve(CP.prototype,"mouseEnterClip",[SP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DP=ve(CP.prototype,"mouseLeaveClip",[vP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EP=CP))||EP)||EP);var zP,UP,GP,HP,VP,qP,WP;i._RF.pop(),i._RF.push({},"2871awUXL9J0I+rBEFNHN7o","Tabs",void 0);const{ccclass:KP,property:YP}=a,{analytics:jP}=globalThis.game,{Plugins:{Analytics:{Events:XP}}}=GameCore;let $P=(zP=KP("Tabs"),UP=YP(BP),GP=YP(BP),zP((qP=ve((VP=class extends s{constructor(){super(...arguments),e(this,"tabWorld",qP,this),e(this,"tabFriends",WP,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.tabWorld)throw new Error("Tabs: tabWorld not found");if(!this.tabFriends)throw new Error("Tabs: tabFriends not found")}setInteractableButtons(e){this.tabWorld.getComponent(p).interactable=e,this.tabFriends.getComponent(p).interactable=e}updateStatus(e){this.tabWorld.setEnabled("global"===e),this.tabFriends.setEnabled("friends"===e)}handleTabWorldSelect(){this.tabWorld.setEnabled(!0),this.tabFriends.setEnabled(!1),jP.event(XP.BUTTON_CLICK,{button_name:this.node.name,screen_name:Yi.getCurrentPage()}),this.node.scene.emit(vf.WORLD_TAB_SELECTED)}handleTabFriendsSelect(){this.tabWorld.setEnabled(!1),this.tabFriends.setEnabled(!0),jP.event(XP.BUTTON_CLICK,{button_name:this.node.name,screen_name:Yi.getCurrentPage()}),this.node.scene.emit(vf.FRIENDS_TAB_SELECTED)}}).prototype,"tabWorld",[UP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WP=ve(VP.prototype,"tabFriends",[GP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HP=VP))||HP);var QP,JP,ZP,e_,t_;i._RF.pop(),i._RF.push({},"69c90PvoTtGfZyDw8FbbOvV","LeaderSkeleton",void 0);const{ccclass:i_,disallowMultiple:n_,property:a_}=a;let s_=(QP=i_("LeaderSkeleton"),JP=a_(n),QP(ZP=n_((t_=ve((e_=class extends s{constructor(){super(...arguments),e(this,"container",t_,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}async hide(e){await vt.runTweenAsync(E(this.uiOpacity).to(.2,{opacity:0}).call((()=>{this.node.active=!1})),e)}async show(e,t){this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const i=this.container.position.clone();this.container.position=new j(i.x,i.y-100,i.z);const n=E(this.node).delay(e);n.to(.2,{scale:j.ONE},{easing:"cubicOut"});const a=E(this.container).delay(e);a.to(.2,{position:i},{easing:"cubicOut"});const s=E(this.uiOpacity).delay(e);s.to(.2,{opacity:255},{easing:"cubicOut"}),await Promise.all([vt.runTweenAsync(n,t),vt.runTweenAsync(a,t),vt.runTweenAsync(s,t)])}validateRequiredComponents(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}).prototype,"container",[JP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZP=e_))||ZP)||ZP);var o_,r_,l_,c_,h_,d_,u_,p_,m_,g_,y_,b_,f_,w_,S_,v_,E_,C_,T_,A_,R_,I_,P_,__,L_,D_,O_,N_,M_,k_,x_,F_,B_,z_,U_,G_,H_,V_,q_,W_,K_;i._RF.pop(),i._RF.push({},"53da1+ne4RJ4p0kTjp52K/1","Leader",void 0);const{ccclass:Y_,property:j_}=a,{Utils:{Number:X_}}=GameCore;let $_=(o_=Y_("Leader"),r_=j_(h),l_=j_(x),c_=j_({type:n,group:"Container"}),h_=j_({type:R,group:"Background"}),d_=j_({type:N,group:"Background"}),u_=j_({type:R,group:"Rank"}),p_=j_({type:h,group:"Rank"}),m_=j_({type:N,group:"Rank"}),g_=j_({type:N,group:"Rank"}),y_=j_({type:N,group:"Rank"}),b_=j_({type:N,group:"Rank"}),f_=j_({type:R,group:"Avatar"}),w_=j_({type:x,group:"Avatar"}),S_=j_({type:R,group:"Score"}),v_=j_({type:h,group:"Score"}),E_=j_({type:N,group:"Score"}),C_=j_({type:x,group:"Score"}),T_=j_({type:x}),A_=j_({type:l}),o_((P_=ve((I_=class extends s{constructor(){super(...arguments),e(this,"nameLabel",P_,this),e(this,"nameOpacity",__,this),e(this,"container",L_,this),e(this,"background",D_,this),e(this,"highlightBackground",O_,this),e(this,"rankSprite",N_,this),e(this,"rankLabel",M_,this),e(this,"goldRank",k_,this),e(this,"silverRank",x_,this),e(this,"bronzeRank",F_,this),e(this,"highlightRank",B_,this),e(this,"avatar",z_,this),e(this,"avatarOpacity",U_,this),e(this,"scoreBackground",G_,this),e(this,"scoreLabel",H_,this),e(this,"highlightScoreBackground",V_,this),e(this,"scoreOpacity",q_,this),e(this,"uiOpacity",W_,this),e(this,"uiTransform",K_,this)}onLoad(){this.defaultBackground=this.background.spriteFrame,this.defaultRank=this.rankSprite.spriteFrame,this.defaultScoreBackground=this.scoreBackground.spriteFrame,this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateInfo(e,t){this.updateBackground(e),this.updateRank(e,t),this.resetPhoto(),this.updateUsername(e),this.updateScore(e)}updateBackground(e){this.background.spriteFrame=e.isHighlight?this.highlightBackground:this.defaultBackground}updateRank(e,t){const i=e.rank;if(this.rankLabel.string===i.toString())return;this.rankLabel.string=t&&i>t?`${t}+`:i.toString(),this.rankSprite.spriteFrame=this.defaultRank;let n=new o(Rf);switch(e.isHighlight&&(this.rankSprite.spriteFrame=this.highlightRank,n=new o(Pf)),i){case 1:this.rankSprite.spriteFrame=this.goldRank,n=new o(Ef);break;case 2:this.rankSprite.spriteFrame=this.silverRank,n=new o(Cf);break;case 3:this.rankSprite.spriteFrame=this.bronzeRank,n=new o(Tf)}this.rankLabel.shadowColor=n,this.rankLabel.outlineColor=n}setPhoto(e){e&&this.node.active&&(e.packable=!0,this.avatar.spriteFrame=e)}async resetPhoto(){if(!this.defaultAvatar){const e=await ci.loadSpriteFrameAsync("images/avatar-bg/spriteFrame");if(!e)return;this.defaultAvatar=e}this.avatar.spriteFrame=this.defaultAvatar}updateUsername(e){this.nameLabel.string=e.name,this.nameLabel.color=new o(e.isHighlight?If:Af)}updateScore(e){const t=Math.floor(e.score);this.scoreLabel.string=X_.getShortNumber(t,7);const i=this.scoreLabel.getComponent(h);i.outlineColor=new o(e.isHighlight?Pf:Rf),i.shadowColor=new o(e.isHighlight?Pf:Rf),this.scoreBackground.spriteFrame=e.isHighlight?this.highlightScoreBackground:this.defaultScoreBackground}async runShowUpAnimation(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.3;this.node.scale=new j(.8,.8,.8),this.setOpacity(0);const n=this.container.position.clone();this.container.position=new j(n.x,n.y-100,n.z);const a=E(this.node).delay(t);a.to(i,{scale:j.ONE},{easing:"elasticOut"});const s=E(this.container).delay(t);s.to(i,{position:n},{easing:"backOut"});const o=E(this.uiOpacity).delay(t);o.to(i,{opacity:255},{easing:"cubicOut",onUpdate:()=>{this.nameOpacity.opacity=this.uiOpacity.opacity,this.scoreOpacity.opacity=this.uiOpacity.opacity,this.avatarOpacity.opacity=this.uiOpacity.opacity}}),e.addAbortListener((()=>{this.node.scale=j.ONE,this.container.position=n,this.uiOpacity.opacity=255,this.avatar.node.active=!0})),await Promise.all([vt.runTweenAsync(a,e),vt.runTweenAsync(s,e),vt.runTweenAsync(o,e)])}async runWorldPositionAnimation(e,t){const i=E(this.node).to(t,{worldPosition:e},{easing:"quadOut"});await vt.runTweenAsync(i)}async runScaleAnimation(e,t,i){const n=E(this.node).to(i,{scale:new j(t,t,t)},{easing:"backOut"});await vt.runTweenAsync(n,e)}async runUpdateDataAnimation(e,t,i,n,a){const s=E({}).to(a,{},{easing:"quartOut",onUpdate:(a,s)=>{if(!s)return;const o=Math.floor(e+(t-e)*s),r=Math.floor(i+(n-i)*s);this.updateRank({rank:o,isHighlight:!0}),this.updateScore({score:r,isHighlight:!0})}});await vt.runTweenAsync(s)}setOpacity(e){this.uiOpacity.opacity=e,this.nameOpacity.opacity=e,this.scoreOpacity.opacity=e,this.avatarOpacity.opacity=e}}).prototype,"nameLabel",[r_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),__=ve(I_.prototype,"nameOpacity",[l_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L_=ve(I_.prototype,"container",[c_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_=ve(I_.prototype,"background",[h_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O_=ve(I_.prototype,"highlightBackground",[d_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N_=ve(I_.prototype,"rankSprite",[u_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M_=ve(I_.prototype,"rankLabel",[p_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k_=ve(I_.prototype,"goldRank",[m_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x_=ve(I_.prototype,"silverRank",[g_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F_=ve(I_.prototype,"bronzeRank",[y_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B_=ve(I_.prototype,"highlightRank",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z_=ve(I_.prototype,"avatar",[f_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U_=ve(I_.prototype,"avatarOpacity",[w_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),G_=ve(I_.prototype,"scoreBackground",[S_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H_=ve(I_.prototype,"scoreLabel",[v_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),V_=ve(I_.prototype,"highlightScoreBackground",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q_=ve(I_.prototype,"scoreOpacity",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),W_=ve(I_.prototype,"uiOpacity",[T_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K_=ve(I_.prototype,"uiTransform",[A_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R_=I_))||R_);var Q_,J_,Z_,eL,tL,iL,nL,aL,sL,oL,rL,lL,cL;i._RF.pop(),i._RF.push({},"173acdyc/VOnLkPsoSfdfnr","Leaders",void 0);const{ccclass:hL,property:dL}=a,{player:uL,frameCapture:pL}=globalThis.game,{Utils:{Image:mL}}=GameCore;let gL=(Q_=hL("Leaders"),J_=dL(_),Z_=dL(n),eL=dL(T),tL=dL(l),iL=dL(f),Q_((sL=ve((aL=class extends s{constructor(){super(...arguments),e(this,"leaderPrefab",sL,this),e(this,"inactiveNodeContainer",oL,this),e(this,"layout",rL,this),e(this,"viewport",lL,this),e(this,"maxLeader",cL,this),this.cachedPhotos=new Map,this.leaderData=[],this.leaderPoolArray=[],this.playerLeader=null,this.isHidden=!0}onLoad(){this.uiTransform=this.getComponent(l),this.batchNodes=this.getComponents(cr),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}__preload(){this.currentPlayerId=uL.getPlayerId();for(let e=0;e<this.maxLeader;e++){const e=this.createLeader();this.leaderPoolArray.push(e)}const{contentSize:e}=this.leaderPoolArray[0].uiTransform;this.leaderContentHeight=e.height+this.layout.spacingY}createLeader(){const e=c(this.leaderPrefab);return this.addLeaderToInactiveNode(e),e.getComponent($_)}async updateData(e){if(this.playerLeader=null,this.isHidden=!1,this.leaderData=e,this.leaderData.sort(((e,t)=>t.score-e.score)),null==uL)throw new Error("Player is not defined");this.batchNodes.every((e=>e.enabled=!0)),await Promise.all(this.leaderData.map(((e,t)=>{let{playerId:i,photo:n,score:a,name:s}=e;const o=this.currentPlayerId===i;this.leaderData[t].rank=t+1;const r=this.maxLeader-1;if(t>=r&&!o)return;const l=o&&t>r-1?this.leaderPoolArray[r]:this.leaderPoolArray[t];return this.layout.node.addChild(l.node),l.setOpacity(0),o&&(this.playerLeader=l),l.updateInfo({isHighlight:o,name:s,photo:n,rank:t+1,score:a},r),this.getAndSetLeaderPhoto({playerId:i,url:n,leader:l})})))}async getAndSetLeaderPhoto(e){const{playerId:t,url:i,leader:n}=e;if("default"!==i)if(this.cachedPhotos.has(t))n.setPhoto(this.cachedPhotos.get(t));else try{const e=await this.loadAvatarImage(i,85,85,t);if(!e)return;const a=N.createWithImage(e);this.cachedPhotos.set(t,a),n.setPhoto(a)}catch(e){if(e instanceof DOMException&&"AbortError"===e.name)return void console.info("Leaders: getAndSetLeaderPhoto was aborted");throw e}}removeLeaders(){this.isHidden=!0,this.getActiveLeaders().forEach((e=>{e.resetPhoto(),this.addLeaderToInactiveNode(e.node)})),this.batchNodes.every((e=>e.enabled=!1))}getActiveLeaders(){return this.leaderPoolArray.filter((e=>e.node.parent===this.layout.node))}getActiveLeaderChildren(){return this.layout.getComponentsInChildren($_)}async showLeaders(e){if(this.isHidden)return;const t=this.getActiveLeaders();if(t.length<1)return;const i=Math.ceil(this.viewport.contentSize.height/this.leaderContentHeight),n=Math.min(t.length,i);await Promise.all(t.map((async(t,i)=>{this.isHidden||i<n&&await t.runShowUpAnimation(e,.1*i,.3)})))}async runUpdateLeadersRankAnimation(e,t){const i=e??0;let n=t??this.leaderData.length;n=Math.min(n,100);const a=this.getActiveLeaderChildren(),s=this.leaderContentHeight,o=[];for(let e=i;e<n;e++){a[e].updateRank({rank:e+1,isHighlight:!1});const t=a[e].node.worldPosition.clone();o.push(a[e].runWorldPositionAnimation(t.add3f(0,-s,0),.25))}await Promise.all(o)}getLeaderData(){return this.leaderData}getPlayerLeader(){return this.playerLeader}getLeaderByRank(e){return this.getActiveLeaders()[e-1]||null}getLeaderDataByRank(e){return this.leaderData[e-1]||null}updateVisibility(){const{yMax:e,yMin:t}=this.viewport.getBoundingBoxToWorld();this.getActiveLeaders().forEach((i=>{const n=i.uiTransform;if(void 0===n)return;const{yMax:a,yMin:s}=n.getBoundingBoxToWorld(),o=a<t||s>e;i.setOpacity(o?0:255)}))}async loadAvatarImage(e,t,i,n){try{const a=await pL.captureAsync({width:t,height:i,name:"LeaderAvatar",renderOptions:{[n]:{name:n,type:"image",depth:0,position:[0,0],size:[t,i],image:e}}});return a?await mL.loadImage(a):null}catch(e){return null}}addLeaderToInactiveNode(e){this.inactiveNodeContainer.addChild(e),e.getComponent($_).setOpacity(0)}}).prototype,"leaderPrefab",[J_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oL=ve(aL.prototype,"inactiveNodeContainer",[Z_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rL=ve(aL.prototype,"layout",[eL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lL=ve(aL.prototype,"viewport",[tL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cL=ve(aL.prototype,"maxLeader",[iL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nL=aL))||nL);var yL,bL,fL,wL,SL,vL,EL,CL,TL,AL,RL,IL,PL,_L,LL,DL,OL;i._RF.pop(),i._RF.push({},"2aa67vEWR9HaJkCtpsuUyRX","LeaderboardContent",void 0);const{ccclass:NL,property:ML}=a,{storage:kL,leaderboard:xL,player:FL}=globalThis.game,{Utils:{Object:BL,Array:zL},Configs:{Leaderboards:UL}}=GameCore;let GL=(yL=NL("LeaderboardContent"),bL=ML(us),fL=ML($P),wL=ML(gL),SL=ML(ce),vL=ML({type:[s_]}),EL=ML(dP),CL=ML(qn),yL((RL=ve((AL=class extends s{constructor(){super(...arguments),e(this,"panelAnimator",RL,this),e(this,"tabs",IL,this),e(this,"leaders",PL,this),e(this,"scrollview",_L,this),e(this,"leaderSkeletons",LL,this),e(this,"leaderboardIsEmpty",DL,this),e(this,"contentOpacity",OL,this),this.isHidden=!0,this.currentLb=null,this.animAbortSignal=null,this.fetchAbortController=null,this.handleUpdateVisibility=()=>{this.leaders.updateVisibility()},this.handleFriendsTabSelected=async()=>{kL.setStorageData("leaderboard_content","lastTabOpened","friends"),this.cleanupSideEffects(),await this.updateStatus("friends")},this.handleWorldTabSelected=async()=>{kL.setStorageData("leaderboard_content","lastTabOpened","global"),this.cleanupSideEffects(),await this.updateStatus("global")},this.hideContent=()=>{this.contentOpacity.changeStateFade(!1,.1)},this.showContent=()=>{this.contentOpacity.changeStateFade(!0,.1)}}onLoad(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}listenEvents(){this.node.scene.on(vf.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.on(vf.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.node.scene.on(Ga.HIDE_UI,this.hideContent),this.node.scene.on(Ga.SHOW_UI,this.showContent),this.scrollview.node.on(ce.EventType.SCROLLING,this.handleUpdateVisibility)}unlistenEvents(){this.node.scene.off(vf.FRIENDS_TAB_SELECTED,this.handleFriendsTabSelected),this.node.scene.off(vf.WORLD_TAB_SELECTED,this.handleWorldTabSelected),this.unlistenUIEvents(),this.scrollview.node.off(ce.EventType.SCROLLING,this.handleUpdateVisibility)}unlistenUIEvents(){this.node.scene.off(Ga.HIDE_UI,this.hideContent),this.node.scene.off(Ga.SHOW_UI,this.showContent)}async loadLeaderboard(e,t){if(t.aborted)return null;const i=this.getLeaderboardName(e);return i?(await xL.requestLeaderboardAsync(i,UL.Limit),t.aborted?null:xL.getLeaderboard(i)):null}getLeaderboardName(e){return"friends"===e?Lr:_r}async loadMoreLeaderboard(e,t){if(t.aborted)return null;const i=this.getLeaderboardName(e);return i?(await xL.loadMoreLeaderboardAsync(i,1e3),t.aborted?null:xL.getLeaderboard(i)):null}async showLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.scrollview.scrollToTop(0),this.scrollview.enabled=!1,await Promise.all([this.leaderSkeletons.map(((i,n)=>i.show(n*t,e)))])}async hideLoading(e){await Promise.all(this.leaderSkeletons.map((t=>t.hide(e))))}enter(){this.listenEvents(),this.isHidden=!1;const e=kL.getStorageData("leaderboard_content","lastTabOpened");"friends"===e&&this.handleFriendsTabSelected(),"global"===e&&this.handleWorldTabSelected()}hide(){this.isHidden=!0}cleanup(){this.unlistenEvents(),this.cleanupSideEffects()}cleanupSideEffects(){this.animAbortSignal?.abort(),this.animAbortSignal=null,this.fetchAbortController?.abort(),this.fetchAbortController=null,this.leaders.removeLeaders(),this.leaderboardIsEmpty.hide()}isAborted(){const e=this.animAbortSignal?.aborted??!0,t=this.fetchAbortController?.signal.aborted??!0;return e||t}async updateStatus(e){if(null!==this.animAbortSignal||null!==this.fetchAbortController)throw new Error("LeaderboardContent: LeaderboardContent is already loading. Please handle cancelling gracefully.");if(this.isHidden)return;if(this.tabs.updateStatus(e),this.animAbortSignal=new si,this.fetchAbortController=new AbortController,await this.showLoading(this.animAbortSignal),this.currentLb=await this.loadLeaderboard(e,this.animAbortSignal),!this.currentLb)return;if(0===BL.vals(this.currentLb.leaders).length)return this.leaderboardIsEmpty.show(),this.tabs.setInteractableButtons(!0),void this.hideLoading(this.animAbortSignal);const t=FL.getPlayerId();let i=this.currentLb.leaders[t];if(!i){const n=this.getLeaderboardName(e);if(n){const e=await xL.getLeadersByPlayerIdsAsync(n,[t]);e.length>0&&(i=e[0],this.currentLb.leaders[t]=i)}}const{previousScore:n,previousRank:a}=kL.getStorage("leaderboard_content"),{score:s,rank:o}=i??{};n&&n<s&&a&&a!==o&&(this.currentLb.leaders[t].score=n);const r=BL.vals(this.currentLb.leaders);if(ci.setBlockInput(!0),this.tabs.setInteractableButtons(!1),await this.hideLoading(this.animAbortSignal),this.isAborted())return ci.setBlockInput(!1),void this.tabs.setInteractableButtons(!0);if(this.leaders.updateData(r),this.scrollview.enabled=!0,await this.leaders.showLeaders(this.animAbortSignal),this.isAborted())return ci.setBlockInput(!1),void this.tabs.setInteractableButtons(!0);const l=this.leaders.getPlayerLeader();return l?(await this.scrollToLeader(l,1),this.isAborted()?(ci.setBlockInput(!1),void this.tabs.setInteractableButtons(!0)):(await this.runPlayerRankChangeAnimation(this.animAbortSignal,s),this.isAborted()?(ci.setBlockInput(!1),void this.tabs.setInteractableButtons(!0)):(kL.setStorageData("leaderboard_content","previousScore",s),kL.setStorageData("leaderboard_content","previousRank",o),ci.setBlockInput(!1),void this.tabs.setInteractableButtons(!0)))):(ci.setBlockInput(!1),void this.tabs.setInteractableButtons(!0))}async runPlayerRankChangeAnimation(e,t){const{previousScore:i}=kL.getStorage("leaderboard_content");if(!i||i>=t)return;const n=this.leaders.getLeaderData(),a=zL.searchIndex(n,(e=>e.playerId===FL.getPlayerId()));if(-1===a)return;const s=n[a],{score:o,rank:r}=s;s.score=t,n.sort(((e,t)=>t.score-e.score)),n.forEach(((e,t)=>{e.rank=t+1}));const l=this.leaders.getPlayerLeader();if(!l)return;if(r===s.rank)return void l.updateScore({score:s.score,isHighlight:!0});const c=this.leaders.getLeaderByRank(s.rank);if(!c)return;this.leaders.layout.enabled=!1,await l.runScaleAnimation(e,1.1,.5);const h=Math.min(.5*(r-s.rank),2),d=[l.runUpdateDataAnimation(r,s.rank,o,s.score,h),this.scrollToLeader(c,h)],u=this.uiTransform.contentSize.height,p=this.scrollview.getMaxScrollOffset().y,m=-c.node.position.y-u/2;let g=j.ZERO;m<0?g=new j(l.node.worldPosition.x,u+c.node.position.y,l.node.worldPosition.z):this.scrollview.getScrollOffset().y>=p-5&&(g=m<p?new j(l.node.worldPosition.x,u/2,l.node.worldPosition.z):c.node.worldPosition),g.equals(j.ZERO)||d.push(l.runWorldPositionAnimation(g,h)),await Promise.all(d),await Promise.all([l.runScaleAnimation(e,1,.25),l.node.setSiblingIndex(s.rank-1),this.leaders.runUpdateLeadersRankAnimation(s.rank,r)]),this.leaders.layout.enabled=!0,this.leaders.layout.updateLayout()}async scrollToLeader(e,t){const{contentSize:i}=this.uiTransform,n=new Q(0,-e.node.position.y-i.height/2),a=this.scrollview.getScrollOffset().clone();n.y=Math.max(n.y,0),a.y=Math.max(a.y,0);const s=n.y-a.y;if(!(Math.abs(s)<5))return this.scrollview.scrollToOffset(n,t),vt.waitTweenAsync(t)}}).prototype,"panelAnimator",[bL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IL=ve(AL.prototype,"tabs",[fL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PL=ve(AL.prototype,"leaders",[wL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_L=ve(AL.prototype,"scrollview",[SL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LL=ve(AL.prototype,"leaderSkeletons",[vL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DL=ve(AL.prototype,"leaderboardIsEmpty",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OL=ve(AL.prototype,"contentOpacity",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TL=AL))||TL);var HL;i._RF.pop(),i._RF.push({},"ae514KD4phHMYC0AD3CIw68","LeaderboardPage",void 0);const{ccclass:VL}=a;VL("LeaderboardPage")(HL=class extends BE{async mount(){if(!this.pagePrefab){const e=await ci.loadPrefabAsync(oi.LEADERBOARD_PAGE);e&&this.node&&(this.pagePrefab=e)}if(await super.mount(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(GL),!this.content)throw new Error("LeaderboardPage: Leaders not found")}async transitionIn(){await super.transitionIn(),this.content.enableUIAnimator();const e=vt.runTweenAsync(E(this.containerUIOpacity).to(.2,{opacity:255})),t=new Promise((e=>{this.node.scene.emit(Ga.SHOW_UI,{onComplete:()=>{e()}})}));await Promise.all([e,t]),this.content.enter()}async transitionOut(){await super.transitionOut(),this.content.unlistenUIEvents(),await new Promise((e=>{this.node.scene.emit(Ga.HIDE_UI,{onComplete:()=>{e()}})})),this.content.disableUIAnimator()}unmount(){this.content?.hide(),this.content?.cleanup(),super.unmount()}});var qL,WL,KL,YL,jL,XL,$L,QL,JL,ZL,eD,tD,iD,nD,aD,sD,oD;i._RF.pop(),i._RF.push({},"8cd04RxbahLDaxq9FJf6hBh","TournamentBlock",void 0);const{ccclass:rD,property:lD}=a,{leaderboard:cD,player:hD}=globalThis.game,{Utils:{Time:dD}}=GameCore;let uD=(qL=rD("TournamentBlock"),WL=lD(n),KL=lD(h),YL=lD(h),jL=lD(h),XL=lD(h),$L=lD(l),QL=lD({type:[R]}),qL((eD=ve((ZL=class extends s{constructor(){super(...arguments),e(this,"container",eD,this),e(this,"titleLabel",tD,this),e(this,"timeLabel",iD,this),e(this,"playerCountLabel",nD,this),e(this,"playButtonLabel",aD,this),e(this,"uiTransform",sD,this),e(this,"banners",oD,this)}onLoad(){this.uiOpacity=this.node.getComponent(x),this.validateRequiredComponents()}activateThemeBanner(e){let t=!1;this.banners.forEach((i=>{i.node.active=i.node.name.toLowerCase()===e,i.node.active&&(t=!0)})),t||this.banners.forEach((e=>{e.node.active=e.node.name.toLowerCase()===el.SUMMER}))}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async updateInfo(e){this.payload=e;const{endTime:t,title:i}=e,{leaderboardId:n,themeId:a}=e.payload;if(!n)return;this.setPlayerCountWaiting(),this.updateTitle(i),this.updateEndTime(t),this.updateTournamentBanner(a);let s={leaders:[],isPlayerInTournament:!1};try{const e=await this.getLeadersPayload(n);e&&(s=e)}catch(e){console.error(`Fetch lb for tournament ${i}`,e)}this.leadersPayload=s;const{leaders:o,isPlayerInTournament:r}=this.leadersPayload,l=o.length;this.updatePlayerCount(l),this.updatePlayButtonLabel(r)}updateTitle(e){e&&(this.titleLabel.string=e)}updateEndTime(e){const t=dD.getRelativeTime(e);this.timeLabel.string=`Ends ${t}`}updatePlayerCount(e){this.playerCountLabel.string=`${e} `+(e>1?"players":"player")}setPlayerCountWaiting(){this.playerCountLabel.string="Loading..."}updateTournamentBanner(e){e?this.activateThemeBanner(e):this.activateThemeBanner(el.SUMMER)}updatePlayButtonLabel(e){this.playButtonLabel.string=e?"Continue":"Join"}async getLeadersPayload(e){const t=cD.getLeaderboardName(e);if(!t)return null;await cD.requestLeaderboardAsync(t,0);const i=cD.getLeaderboard(t);if(!i)return null;const n=GameCore.Utils.Object.vals(i.leaders),a=hD.getPlayerId(),s={leaders:[],player:void 0,isPlayerInTournament:!1};for(const e of n){const{playerId:t}=e;t===a?(s.player=e,s.isPlayerInTournament=!0,s.leaders.push(e)):s.leaders.push(e)}return s}async runShowPopUpAnimation(e,t,i){this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const n=this.container.position.clone();this.container.position=new j(n.x,n.y-100,n.z);const a=E(this.node).delay(e);a.to(t,{scale:j.ONE},{easing:"elasticOut"});const s=E(this.container).delay(e);s.to(t,{position:n},{easing:"backOut"});const o=E(this.uiOpacity).delay(e);o.to(t,{opacity:255},{easing:"cubicOut"}),i.addAbortListener((()=>{this.node.scale=j.ONE,this.container.position=n,this.uiOpacity.opacity=255})),await Promise.all([vt.runTweenAsync(a,i),vt.runTweenAsync(s,i),vt.runTweenAsync(o,i)])}handleOnTournamentClicked(){const e=this.payload.id||"";if(Ql.validateTournamentExpired(e))return this.node.scene.emit(Ur.RELOAD_TOURNAMENT),void ql.showNotificationScreen("Tournament has ended",2);try{const e=JSON.stringify(this.payload);ql.showTournamentDetailScreen(e,"tournament_start")}catch(e){console.warn("handleOnTournamentClicked",e)}}}).prototype,"container",[WL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tD=ve(ZL.prototype,"titleLabel",[KL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iD=ve(ZL.prototype,"timeLabel",[YL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nD=ve(ZL.prototype,"playerCountLabel",[jL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aD=ve(ZL.prototype,"playButtonLabel",[XL],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sD=ve(ZL.prototype,"uiTransform",[$L],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oD=ve(ZL.prototype,"banners",[QL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),JL=ZL))||JL);var pD,mD,gD,yD,bD;i._RF.pop(),i._RF.push({},"a409buwLfZLQq7cmBGiqhF5","TournamentBlockSkeleton",void 0);const{ccclass:fD,property:wD}=a;let SD=(pD=fD("TournamentBlockSkeleton"),mD=wD(n),pD((bD=ve((yD=class extends s{constructor(){super(...arguments),e(this,"container",bD,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async hide(e){await vt.runTweenAsync(E(this.uiOpacity).to(.2,{opacity:0}).call((()=>{this.node.active=!1})),e)}async show(e,t){this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const i=this.container.position.clone();this.container.position=new j(i.x,i.y-100,i.z);const n=E(this.node).delay(e);n.to(.2,{scale:j.ONE},{easing:"elasticOut"});const a=E(this.container).delay(e);a.to(.2,{position:i},{easing:"backOut"});const s=E(this.uiOpacity).delay(e);s.to(.2,{opacity:255},{easing:"cubicOut"}),t.addAbortListener((()=>{this.node.scale=j.ONE,this.container.position=i,this.uiOpacity.opacity=255})),await Promise.all([vt.runTweenAsync(n,t),vt.runTweenAsync(a,t),vt.runTweenAsync(s,t)])}}).prototype,"container",[mD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gD=yD))||gD);var vD,ED,CD,TD,AD,RD,ID,PD,_D,LD,DD;i._RF.pop(),i._RF.push({},"5f82fye3oxHQrxKbP9TC2di","TournamentsBoard",void 0);const{ccclass:OD,property:ND}=a,{player:MD}=globalThis.game;let kD=(vD=OD("TournamentsBoard"),ED=ND(_),CD=ND(n),TD=ND(T),AD=ND(n),vD((PD=ve((ID=class extends s{constructor(){super(...arguments),e(this,"tournamentBlockPrefab",PD,this),this.tournamentBlockArray=[],e(this,"inactiveNodeContainer",_D,this),e(this,"layout",LD,this),e(this,"createTournamentButton",DD,this)}onLoad(){this.uiTransform=this.getComponent(l),this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}start(){for(let e=0;e<20;e++)this.addTournamentBlock();this.tournamentBlockContentHeight=this.tournamentBlockArray[0].uiTransform.contentSize.height+this.layout.spacingY}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateData(e){let t=!1;e.forEach(((e,i)=>{let n=this.tournamentBlockArray[i];e.payload.playerId===MD.getPlayerId()&&(t=!0),n||(n=this.addTournamentBlock()),n.updateInfo(e),this.layout.node.addChild(n.node)})),t||this.setCreateTournamentButtonActive(!0)}addTournamentBlock(){const e=c(this.tournamentBlockPrefab);this.inactiveNodeContainer.addChild(e);const t=e.getComponent(uD);return this.tournamentBlockArray.push(t),t}removeTournamentBlocks(){this.getActiveTournamentBlocks().forEach((e=>{this.inactiveNodeContainer.addChild(e.node)})),this.setCreateTournamentButtonActive(!1)}getActiveTournamentBlocks(){return this.tournamentBlockArray.filter((e=>e.node.parent===this.layout.node))}setCreateTournamentButtonActive(e){e?this.layout.node.addChild(this.createTournamentButton):this.layout.node.removeChild(this.createTournamentButton),this.createTournamentButton.active=e}async showTournamentBlocks(e,t){const i=this.getActiveTournamentBlocks();if(i.length<1)return;const n=Math.ceil(e/this.tournamentBlockContentHeight),a=Math.min(i.length,n);await Promise.all(i.map((async(e,i)=>{i>=a?await e.runShowPopUpAnimation(.1*i,.3,t):e.uiOpacity.opacity=255})))}updateVisibility(){const{yMax:e,yMin:t}=this.uiTransform.getBoundingBoxToWorld();this.getActiveTournamentBlocks().forEach((i=>{const n=i.uiTransform;if(void 0===n)return;const{yMax:a,yMin:s}=n.getBoundingBoxToWorld(),o=a<t||s>e;i.uiOpacity.opacity=o?0:255}))}}).prototype,"tournamentBlockPrefab",[ED],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_D=ve(ID.prototype,"inactiveNodeContainer",[CD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LD=ve(ID.prototype,"layout",[TD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DD=ve(ID.prototype,"createTournamentButton",[AD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RD=ID))||RD);var xD,FD,BD,zD,UD;i._RF.pop(),i._RF.push({},"f8a7b0St3FAkb1PvvvJTLCh","TournamentsNotAvailable",void 0);const{ccclass:GD,property:HD}=a;let VD=(xD=GD("TournamentsNotAvailable"),FD=HD(p),xD((UD=ve((zD=class extends s{constructor(){super(...arguments),e(this,"createButton",UD,this)}onLoad(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async show(){this.createButton.interactable=!0,this.uiOpacity.opacity=255;const e=this.node.position.clone(),t=E(this.node);t.to(.05,{position:e.clone().add3f(5,0,0)}),t.to(.05,{position:e.clone().add3f(-5,0,0)});const i=E(this.node).repeat(2,t);i.to(.05,{position:e}),await vt.runTweenAsync(i)}hide(){this.createButton.interactable=!1,this.uiOpacity.opacity=0}}).prototype,"createButton",[FD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BD=zD))||BD);var qD,WD,KD,YD,jD,XD,$D,QD,JD,ZD,eO,tO,iO,nO,aO;i._RF.pop(),i._RF.push({},"199fcQ5IEZFbJCfSrGNrGDQ","TournamentContent",void 0);const{ccclass:sO,property:oO}=a,{storage:rO,match:lO}=globalThis.game,{Utils:{Object:cO,Array:hO}}=GameCore;let dO=(qD=sO("TournamentContent"),WD=oO({type:us}),KD=oO(kD),YD=oO(VD),jD=oO(ce),XD=oO({type:[SD]}),$D=oO(qn),qD((ZD=ve((JD=class extends s{constructor(){super(...arguments),e(this,"panelAnimator",ZD,this),e(this,"tournamentsBoard",eO,this),e(this,"tournamentsNotAvailable",tO,this),e(this,"scrollView",iO,this),e(this,"skeletons",nO,this),e(this,"contentOpacity",aO,this),this.animAbortSignal=null,this.softAbortSignal=null,this.hideContent=()=>{this.contentOpacity.changeStateFade(!1,.1)},this.showContent=()=>{this.contentOpacity.changeStateFade(!0,.1)}}onLoad(){this.uiTransform=this.node.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenEvents(){this.scrollView.node.on(ce.EventType.SCROLLING,this.onScrolling,this),this.node.scene.on(Ur.RELOAD_TOURNAMENT,this.reload,this),this.node.scene.on(Ga.HIDE_UI,this.hideContent),this.node.scene.on(Ga.SHOW_UI,this.showContent)}unlistenEvents(){this.scrollView.node.off(ce.EventType.SCROLLING,this.onScrolling,this),this.node.scene.off(Ur.RELOAD_TOURNAMENT,this.reload,this),this.unlistenUIEvents()}unlistenUIEvents(){this.node.scene.off(Ga.HIDE_UI,this.hideContent),this.node.scene.off(Ga.SHOW_UI,this.showContent)}onScrolling(){this.tournamentsBoard.updateVisibility()}enableUIAnimator(){this.panelAnimator.enabled=!0}disableUIAnimator(){this.panelAnimator.enabled=!1}async enter(){if(this.listenEvents(),null!==this.animAbortSignal||null!==this.softAbortSignal)throw new Error("TournamentContent: TournamentContent is already running");if(this.animAbortSignal=new si,this.softAbortSignal=new si,await this.showLoading(this.animAbortSignal),this.isAborted())return;const e=await Ql.requestTournamentDataAsync();this.isAborted()||(await this.hideLoading(this.animAbortSignal),this.isAborted()||(0!==e.length||this.softAbortSignal?.aborted?(this.tryShowTournamentResult(),this.scrollView.enabled=!0,this.tournamentsBoard.updateData(e),await this.tournamentsBoard.showTournamentBlocks(this.uiTransform.contentSize.height-this.tournamentsBoard.layout.paddingTop,this.animAbortSignal)):this.tournamentsNotAvailable.show()))}async showLoading(e){this.scrollView.scrollToTop(0),this.scrollView.enabled=!1,await Promise.all([this.skeletons.map((t=>t.show(0,e)))])}async hideLoading(e){await Promise.all([this.skeletons.map((t=>t.hide(e)))])}tryShowTournamentResult(){try{const{animateTournamentLeader:e}=rO.getStorage("tournament");if(!e)return;const t=Ql.getAllTournamentData(),{tournamentId:i}=lO.getMatchState().customData;if(!i)throw new Error("Tournament ID not found");const n=hO.search(t,(e=>e.id===i));if(!n)throw new Error("Tournament not found");const a=JSON.stringify(n);ql.showTournamentDetailScreen(a,"tournament_end")}catch(e){rO.setStorageData("tournament","animateTournamentLeader",!1),console.warn("showTournamentResult",e)}}async processCreateTournament(){try{await wl.processCreateTournamentAsync()}catch(e){if(!cO.hasOwn(e,"code"))return void ql.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament");if("USER_INPUT"===e.code)return;"INVALID_OPERATION"===e.code?ql.showNotificationScreen(e.message):ql.showNotificationScreen("Sorry. Unknown error. Failed to Create Tournament")}this.reload()}isAborted(){return this.animAbortSignal?.aborted??!0}cleanup(){this.unlistenEvents(),this.animAbortSignal?.abort(),this.animAbortSignal=null,this.tournamentsBoard.removeTournamentBlocks(),this.tournamentsNotAvailable.hide()}softAbort(){this.softAbortSignal?.abort(),this.softAbortSignal=null}reload(){this.softAbort(),this.cleanup(),this.enter()}}).prototype,"panelAnimator",[WD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eO=ve(JD.prototype,"tournamentsBoard",[KD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tO=ve(JD.prototype,"tournamentsNotAvailable",[YD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iO=ve(JD.prototype,"scrollView",[jD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nO=ve(JD.prototype,"skeletons",[XD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aO=ve(JD.prototype,"contentOpacity",[$D],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QD=JD))||QD);var uO;i._RF.pop(),i._RF.push({},"bce5eh0LHVP2bCJ6u+kFjuA","TournamentPage",void 0);const{ccclass:pO}=a;pO("TournamentPage")(uO=class extends BE{async mount(){if(!this.pagePrefab){const e=await ci.loadPrefabAsync(oi.TOURNAMENTS_PAGE);e&&this.node&&(this.pagePrefab=e)}if(await super.mount(),this.containerUIOpacity.opacity=0,this.content=this.container.getComponentInChildren(dO),!this.content)throw new Error("LeaderboardPage: Leaders not found")}async transitionIn(){await super.transitionIn(),this.content.enableUIAnimator();const e=vt.runTweenAsync(E(this.containerUIOpacity).to(.2,{opacity:255})),t=new Promise((e=>{this.node.scene.emit(Ga.SHOW_UI,{onComplete:()=>{e()}})}));await Promise.all([e,t]),this.content.enter()}async transitionOut(){this.content?.softAbort(),this.content.unlistenUIEvents(),await super.transitionOut(),await new Promise((e=>{this.node.scene.emit(Ga.HIDE_UI,{onComplete:()=>{e()}})})),this.content.disableUIAnimator()}unmount(){this.content?.cleanup(),super.unmount()}});var mO,gO,yO,bO,fO,wO;i._RF.pop(),i._RF.push({},"b8271vI+3pO9q8SKMYpqLKv","EventBadge",void 0);const{ccclass:SO,property:vO}=a;mO=SO("EventBadge"),gO=vO(h),yO=vO(b),mO((wO=ve((fO=class extends s{constructor(){super(...arguments),e(this,"label",wO,this)}get text(){return this.label.string}set text(e){this.label.string=e}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.label)throw new Error("EventBadge: Missing required component Label")}}).prototype,"label",[gO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(fO.prototype,"text",[yO],Object.getOwnPropertyDescriptor(fO.prototype,"text"),fO.prototype),bO=fO));var EO,CO,TO,AO,RO,IO,PO,_O,LO;i._RF.pop(),i._RF.push({},"7712cs4XLJAgpKqlO3gPqkF","EventProgressBar",void 0);const{ccclass:DO,property:OO}=a;EO=DO("EventProgressBar"),CO=OO(Gs),TO=OO(h),AO=OO(b),RO=OO({range:[0,1,.01],slide:!0,tooltip:"i18n:progress.progress"}),EO((_O=ve((PO=class extends s{constructor(){super(...arguments),e(this,"progressBar",_O,this),e(this,"progressLabel",LO,this)}get text(){return this.progressLabel.string}get progress(){return this.progressBar.progress}set progress(e){this.progressBar.progress=e}set text(e){this.progressLabel.string=e}__preload(){}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.progressBar)throw new Error("EventProgressBar: Missing required component TapperedProgressBar");if(!this.progressLabel)throw new Error("EventProgressBar: Missing required component Label")}}).prototype,"progressBar",[CO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LO=ve(PO.prototype,"progressLabel",[TO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(PO.prototype,"text",[AO],Object.getOwnPropertyDescriptor(PO.prototype,"text"),PO.prototype),ve(PO.prototype,"progress",[RO],Object.getOwnPropertyDescriptor(PO.prototype,"progress"),PO.prototype),IO=PO));var NO,MO,kO,xO,FO,BO,zO,UO,GO,HO,VO,qO,WO,KO,YO,jO,XO,$O,QO,JO,ZO,eN,tN,iN,nN,aN,sN,oN,rN,lN,cN,hN,dN,uN,pN,mN,gN,yN,bN,fN,wN,SN,vN,EN,CN;i._RF.pop(),i._RF.push({},"7741dWPNcdHRqGVvif/L/MP","NavButton",void 0);const{ccclass:TN,property:AN,executeInEditMode:RN}=a,{analytics:IN}=globalThis.game,{Plugins:{Analytics:{Events:PN}}}=GameCore;NO=TN("NavButton"),MO=AN(H),kO=AN({group:{name:"Animation"},displayName:"Is Selected",tooltip:"This is for the editor only and will be ignored at runtime",editorOnly:!0}),xO=AN({type:C,group:{name:"Animation"}}),FO=AN({type:C,group:{name:"Animation"}}),BO=AN({type:C,group:{name:"Animation"}}),zO=AN({type:C,group:{name:"Animation"}}),UO=AN({type:C,group:{name:"Animation"}}),GO=AN({group:{name:"Animation"}}),HO=AN({type:C,group:{name:"Animation"}}),VO=AN({type:C,group:{name:"Animation"}}),qO=AN({group:{name:"Animation"}}),WO=AN({type:C,group:{name:"Animation"}}),KO=AN({type:C,group:{name:"Animation"}}),YO=AN({type:C,group:{name:"Animation"}}),jO=AN({type:C,group:{name:"Animation"}}),XO=AN({type:l}),$O=AN(n),QO=AN(x),JO=AN({type:l}),ZO=AN({type:M(ai)}),eN=AN(II),NO(tN=RN((nN=ve((iN=class extends s{constructor(){super(...arguments),e(this,"wip",nN,this),e(this,"isSelectedInEditor",aN,this),e(this,"animationDuration",sN,this),e(this,"selectedSpacing",oN,this),e(this,"deselectedSpacing",rN,this),e(this,"selectedIconY",lN,this),e(this,"selectedIconX",cN,this),e(this,"selectedIconScale",hN,this),e(this,"deselectedIconY",dN,this),e(this,"deselectedIconX",uN,this),e(this,"deselectedIconScale",pN,this),e(this,"selectedTextY",mN,this),e(this,"selectedTextX",gN,this),e(this,"deselectedTextY",yN,this),e(this,"deselectedTextX",bN,this),e(this,"spacer",fN,this),e(this,"icon",wN,this),e(this,"text",SN,this),e(this,"uiTransform",vN,this),e(this,"screenType",EN,this),e(this,"navManager",CN,this),this.isSelected=!1,this.onMouseEnter=e=>{this.isSelected||this.playHoverOnAnimation()},this.onMouseLeave=e=>{this.isSelected||this.playHoverOffAnimation()}}get isWIP(){return this.wip}get buttonType(){return this.screenType}update(){}onEnable(){this.node.on(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.on(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onDisable(){this.node.off(n.EventType.MOUSE_ENTER,this.onMouseEnter),this.node.off(n.EventType.MOUSE_LEAVE,this.onMouseLeave)}onEditorUpdate(){null!==this.icon&&void 0!==this.icon&&null!==this.text&&void 0!==this.icon&&null!==this.spacer&&void 0!==this.spacer&&(this.isSelectedInEditor?(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0))}setSelected(){this.isSelected||(ji.playSound(Fi.PATCH_SHIFT),this.navManager.selectUsingSceneTransition(this),IN.event(PN.BUTTON_CLICK,{button_name:this.node.parent?.name??this.node.name,screen_name:Yi.getCurrentPage()}))}async select(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isSelected)throw new Error("NavButton: Already selected");this.isSelected=!0,e?await vt.runTweenAsync(this.playSelectAnimation()):(this.icon.setScale(this.selectedIconScale),this.icon.setPosition(this.selectedIconX,this.selectedIconY,0),this.text.node.setPosition(this.selectedTextX,this.selectedTextY,0),this.spacer.width=this.selectedSpacing,this.text.opacity=255)}async deselect(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.isSelected&&!t)throw new Error("NavButton: Already deselected");this.isSelected=!1,e?await vt.runTweenAsync(this.deselectAnimation()):(this.icon.setScale(this.deselectedIconScale),this.icon.setPosition(this.deselectedIconX,this.deselectedIconY,0),this.text.node.setPosition(this.deselectedTextX,this.deselectedTextY,0),this.spacer.width=this.deselectedSpacing,this.text.opacity=0)}getSelectedWorldDistanceX(){const e=new j(this.selectedIconX,this.selectedIconY,0),t=new j(this.deselectedIconX,this.deselectedIconY,0),i=this.node.scale.clone();this.node.scale=this.selectedIconScale;const n=this.uiTransform.convertToWorldSpaceAR(e),a=this.uiTransform.convertToWorldSpaceAR(t);return this.node.scale=i,a.x-n.x}playHoverOnAnimation(){const e=E(this.icon);return e.to(.1,{scale:this.deselectedIconScale.clone().add3f(.1,.1,0)},{easing:"cubicIn"}),vt.runTweenAsync(e)}playHoverOffAnimation(){const e=E(this.icon);return e.to(.1,{scale:this.deselectedIconScale},{easing:"cubicOut"}),vt.runTweenAsync(e)}playSelectAnimation(){return E(this.spacer).to(this.animationDuration,{width:this.selectedSpacing},{easing:"linear",onUpdate:(e,t)=>{if(void 0===t)return;const i=k.quintInOut(t),n=k.backOut(t),a=k.linear(t),s=t<.5?2*t:1,o=this.deselectedIconY+(this.selectedIconY-this.deselectedIconY)*n,r=this.deselectedIconX+(this.selectedIconX-this.deselectedIconX)*a;this.icon.setPosition(r,o,0);const l=this.deselectedIconScale.clone().lerp(this.selectedIconScale,i);this.icon.setScale(l.x,l.y,this.icon.scale.z);const c=255*s,h=this.deselectedTextY+(this.selectedTextY-this.deselectedTextY)*a,d=this.deselectedTextX+(this.selectedTextX-this.deselectedTextX)*a;this.text.opacity=c,this.text.node.setPosition(d,h,0)}})}deselectAnimation(){return E(this.spacer).to(this.animationDuration,{width:this.deselectedSpacing},{easing:"linear",onUpdate:(e,t)=>{if(void 0===t)return;const i=he(this.selectedIconY,this.deselectedIconY,t),n=he(this.selectedIconX,this.deselectedIconX,t);this.icon.setPosition(n,i,0);const a=he(255,0,t<.5?2*t:1);this.text.opacity=a;const s=he(this.selectedTextY,this.deselectedTextY,t),o=he(this.selectedTextX,this.deselectedTextX,t);this.text.node.setPosition(o,s,0);const r=this.selectedIconScale.clone().lerp(this.deselectedIconScale,k.quintInOut(t));this.icon.setScale(r.x,r.y,this.icon.scale.z)}})}onLoad(){this.uiTransform=this.getComponent(l),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}}).prototype,"wip",[MO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),aN=ve(iN.prototype,"isSelectedInEditor",[kO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),sN=ve(iN.prototype,"animationDuration",[xO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),oN=ve(iN.prototype,"selectedSpacing",[FO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),rN=ve(iN.prototype,"deselectedSpacing",[BO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 88}}),lN=ve(iN.prototype,"selectedIconY",[zO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),cN=ve(iN.prototype,"selectedIconX",[UO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hN=ve(iN.prototype,"selectedIconScale",[GO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(1,1,1)}}),dN=ve(iN.prototype,"deselectedIconY",[HO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uN=ve(iN.prototype,"deselectedIconX",[VO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),pN=ve(iN.prototype,"deselectedIconScale",[qO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new j(.8,.8,1)}}),mN=ve(iN.prototype,"selectedTextY",[WO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-10}}),gN=ve(iN.prototype,"selectedTextX",[KO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yN=ve(iN.prototype,"deselectedTextY",[YO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bN=ve(iN.prototype,"deselectedTextX",[jO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fN=ve(iN.prototype,"spacer",[XO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wN=ve(iN.prototype,"icon",[$O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SN=ve(iN.prototype,"text",[QO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vN=ve(iN.prototype,"uiTransform",[JO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EN=ve(iN.prototype,"screenType",[ZO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CN=ve(iN.prototype,"navManager",[eN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tN=iN))||tN);var _N,LN,DN,ON,NN,MN,kN;i._RF.pop(),i._RF.push({},"9b83boaSv9PE6mRFqy0MSI8","GameScene",void 0);const{ccclass:xN,property:FN,disallowMultiple:BN}=a,{audio:zN,player:UN}=globalThis.game,{Layout:GN}=ia;_N=xN("GameScene"),LN=FN(Ov),DN=FN(Vw),_N(ON=BN((MN=ve((NN=class extends s{constructor(){super(...arguments),e(this,"animSkipOverlay",MN,this),e(this,"coinManager",kN,this),this.handleGameExit=()=>{Ag.hideBannerAds(),El.switchScene(Br)},this.handleShowResults=()=>{El.switchScene(zr)},this.handleGameMaskWhenLayoutChanged=e=>{const t=P("Canvas/Game/GameObjects");if(!t)return;const i=t.getComponent(de);i&&(i.enabled=e===GN.Landscape)},this.attemptCallSubscribeBot=()=>{"subscribeBotAsync"in GameSDK.extra&&GameSDK.extra.subscribeBotAsync().catch((e=>{console.warn("subscribeBotAsync",e)}))}}__preload(){this.validateRequiredComponents(),this.listenGameEvents(),Ag.showBannerAds()}onLoad(){this.coinManager.init(this.animSkipOverlay)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenGameEvents(){W.on(jn,this.handleGameMaskWhenLayoutChanged),this.node.scene.on(Ga.GAME_EXIT,this.handleGameExit),this.node.scene.on(Ga.SHOW_CHALLENGE_RESULTS,this.handleShowResults)}start(){this.scheduleOnce(this.attemptCallSubscribeBot,.5),UN.getPlayerSetting("music")&&ji.playMusic(),this.updateVolumeBackgroundMusic(),this.scheduleOnce(this.preloadScenes,2)}preloadScenes(){El.preloadDashboardScene()}updateVolumeBackgroundMusic(){zN.setVolume(1,"global_music")}}).prototype,"animSkipOverlay",[LN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kN=ve(NN.prototype,"coinManager",[DN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ON=NN))||ON);var HN,VN,qN,WN,KN,YN,jN,XN,$N,QN,JN,ZN,eM,tM,iM;i._RF.pop(),i._RF.push({},"48081huyTZGu5rme4u8PrdR","Item",void 0);const{ccclass:nM,property:aM}=a;HN=nM("ItemButton"),VN=aM(H),qN=aM(p),WN=aM({type:f}),KN=aM(h),YN=aM(n),jN=aM(n),HN((QN=ve(($N=class extends s{constructor(){super(...arguments),e(this,"isDebug",QN,this),e(this,"button",JN,this),e(this,"quantity",ZN,this),e(this,"quantityLabel",eM,this),e(this,"plusNode",tM,this),e(this,"quantityNode",iM,this)}__preload(){this.item=this.getComponent(og),this.validateRequiredComponents()}start(){this.quantity=this.item.loadQuantity(),this.quantityLabel.string=`${this.quantity}`,this.validateButton(),this.node.scene.on(Ga.GRID_CREATE,this.validateButton,this),this.node.scene.on(Ga.GRID_MATCH_SUCCESS,this.validateButton,this),this.node.scene.on(Ga.GRID_CLEAR,this.validateButton,this)}validateRequiredComponents(){if(!this.item)throw new Error("Item: BaseItem component not found");if(!this.button)throw new Error("Item: Button component not found");if(!this.quantityLabel)throw new Error("Item: Quantity label not found");if(!this.plusNode)throw new Error("Item: Plus node not found");if(!this.quantityNode)throw new Error("Item: Quantity node not found")}validateButton(){console.log("VALIDATE BUTTON"),this.canActivate().then((e=>{this.button.interactable=!0,this.plusNode.active=0==this.quantity,this.quantityNode.active=this.quantity>0}))}activate(){return new Promise((e=>{if(this.quantity<=0)return this.handleShowAddItemScreen(),void e();this.item.activate().then((()=>{this.isDebug||(this.quantity--,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity()),this.validateButton(),e()}))}))}canActivate(){return Promise.resolve(!0)}addQuantity(e){this.quantity+=e,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}clearQuantity(){this.quantity=0,this.quantityLabel.string=`${this.quantity}`,this.item.saveQuantity(),this.validateButton()}handleShowAddItemScreen(){ql.openScreen(Gi.GET_ITEM_SCREEN,{item:yr.HINT,quantity:1})}}).prototype,"isDebug",[VN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),JN=ve($N.prototype,"button",[qN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZN=ve($N.prototype,"quantity",[WN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eM=ve($N.prototype,"quantityLabel",[KN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tM=ve($N.prototype,"plusNode",[YN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iM=ve($N.prototype,"quantityNode",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XN=$N));var sM,oM,rM,lM,cM,hM,dM;i._RF.pop(),i._RF.push({},"0c0b4cnFOFJ6pJmGNHnMo7m","ComboEffect",void 0);const{ccclass:uM,property:pM}=a;sM=uM("ComboEffect"),oM=pM(x),rM=pM(se),sM((hM=ve((cM=class extends s{constructor(){super(...arguments),e(this,"circleOpacity",hM,this),e(this,"particle",dM,this)}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){if(!this.circleOpacity)throw new Error("ComboEffect requires a circleOpacity component");if(!this.particle)throw new Error("ComboEffect requires a particle component")}start(){this.node.scene.on(Ga.COMBO_UPDATED,this.handleOnComboUpdated,this)}handleOnComboUpdated(e){e>1&&(this.circleOpacity.node.scale=j.ZERO,this.circleOpacity.opacity=127.5,this.particle.resetSystem(),E(this.circleOpacity.node).to(.2,{scale:new j(1.3,1.3,1.3)},{easing:"quadOut"}).start(),E(this.circleOpacity).delay(.2).to(.2,{opacity:0},{easing:"expoIn"}).start())}}).prototype,"circleOpacity",[oM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dM=ve(cM.prototype,"particle",[rM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lM=cM));var mM,gM,yM,bM,fM,wM,SM;i._RF.pop(),i._RF.push({},"0506aJZ1EdPqJejQ2PpB980","ComboLabel",void 0);const{ccclass:vM,property:EM}=a;mM=vM("ComboLabel"),gM=EM(h),yM=EM(n),mM((wM=ve((fM=class extends s{constructor(){super(...arguments),e(this,"comboNumber",wM,this),e(this,"comboContainer",SM,this)}onLoad(){this.opacity=this.getComponent(x),this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}start(){this.node.scene.on(Ga.COMBO_UPDATED,this.handleOnComboUpdated,this)}handleOnComboUpdated(e){0===e?this.opacity.opacity=0:e>1?(this.opacity.opacity=255,this.comboNumber.string=`${e}`,E(this.comboContainer).to(.1,{scale:new j(1.3,1.3,1.3)},{easing:"sineIn"}).to(.1,{scale:j.ONE},{easing:"sineOut"}).start()):this.opacity.opacity=0}}).prototype,"comboNumber",[gM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SM=ve(fM.prototype,"comboContainer",[yM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bM=fM));var CM,TM,AM,RM,IM,PM,_M,LM,DM;i._RF.pop(),i._RF.push({},"51871oF8CFOkp81rgCf90UQ","ComboPopup",void 0);const{ccclass:OM,property:NM}=a;CM=OM("ComboPopup"),TM=NM(R),AM=NM(N),RM=NM(y),CM((_M=ve((PM=class extends s{constructor(){super(...arguments),e(this,"textSprite",_M,this),e(this,"comboSprites",LM,this),e(this,"animation",DM,this)}onLoad(){this.validateRequiredComponents()}start(){this.node.scene.on(Ga.COMBO_UPDATED,this.handleOnComboUpdated,this)}validateRequiredComponents(){if(!this.textSprite)throw new Error("ComboPopup: textSprite not found");if(0===this.comboSprites.length)throw new Error("ComboPopup: comboSprites not found");if(!this.animation)throw new Error("ComboPopup: animation not found")}handleOnComboUpdated(e){if(!(e<2))for(let t=this.comboSprites.length-1;t>=0;t--)if(e>=t+2){this.textSprite.spriteFrame=this.comboSprites[t],this.animation.play();break}}}).prototype,"textSprite",[TM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LM=ve(PM.prototype,"comboSprites",[AM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DM=ve(PM.prototype,"animation",[RM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IM=PM));var MM,kM,xM,FM,BM,zM,UM,GM,HM;i._RF.pop(),i._RF.push({},"a0819yK3HpO2505QqLUOChz","PlayerScore",void 0);const{ccclass:VM,property:qM}=a,{Utils:{Image:WM}}=GameCore;let KM=(MM=VM("PlayerScore"),kM=qM(n),xM=qM(h),FM=qM(R),MM((UM=ve((zM=class extends s{constructor(){super(...arguments),e(this,"crown",UM,this),e(this,"playerScore",GM,this),e(this,"avatar",HM,this)}showCrown(e){this.crown.active=e}setPlayerScore(e){this.playerScore.string=e.toString()}playWaitingAnimation(){let e=0;this.playerScore.schedule((()=>{e=(e+1)%4;const t=Array(e+1).join(".");this.playerScore.string="Waiting"+t}),.5);const t=this.playerScore.getComponent(x),i=E(t).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=E(t).repeatForever(i).start()}stopWaitingAnimation(){this.playerScore.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.playerScore.getComponent(x).opacity=255}async loadPhoto(e){try{const t=await WM.loadImage(e);if(!t)throw new Error("Failed to load image");const i=N.createWithImage(t);if(!i)throw new Error("Failed to create sprite frame");i.packable=!0,this.avatar.spriteFrame=i}catch(e){return void console.error(e)}}}).prototype,"crown",[kM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GM=ve(zM.prototype,"playerScore",[xM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HM=ve(zM.prototype,"avatar",[FM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BM=zM))||BM);var YM,jM,XM,$M,QM,JM,ZM,ek,tk,ik,nk,ak,sk,ok,rk;i._RF.pop(),i._RF.push({},"4b062RYQK5PQbgs7yH66gDw","ChallengeResultScene",void 0);const{ccclass:lk,disallowMultiple:ck,property:hk}=a,{match:dk,player:uk,monitorError:pk}=globalThis.game,mk="Waiting",{Dtos:{Match:{Data:gk}}}=GameCore;YM=lk("ChallengeResultScene"),jM=hk(f),XM=hk({type:KM,group:"Score"}),$M=hk({type:KM,group:"Score"}),QM=hk(jS),JM=hk(h),ZM=hk(gg),YM(ek=ck((ik=ve((tk=class extends s{constructor(){super(...arguments),e(this,"pollingInterval",ik,this),e(this,"playerScore",nk,this),e(this,"opponentScore",ak,this),e(this,"paperConfetti",sk,this),e(this,"titleText",ok,this),e(this,"levelManager",rk,this),this.goToDashboardScene=()=>{Ag.hideBannerAds(),El.switchScene(Br)},this.pollMatchState=async()=>{try{const{id:e}=dk.getMatchState();if(null===e)throw new Error("Match id is not found");const t=uk.getPlayerId(),i=Date.now(),n=await dk.api.getMatchAPI().getMatchDetailByIdAsync(e),a=Date.now(),s=Math.max(0,a-i,this.pollingInterval),o=new gk(n).toObject(),{blackPlayerId:r,blackPlayerScore:l,whitePlayerScore:c,blackPlayerFinish:h,whitePlayerFinish:d}=o,u=t===r?l:c,p=t===r?c:l,m=t===r?h:d,g=t===r?d:h,y=h&&d;if(this.playerScore.setPlayerScore(u),this.opponentScore.setPlayerScore(p),this.playerScore.showCrown(y&&u>p),this.opponentScore.showCrown(y&&p>u),this.stopWaitingAnimation(),this.playerScore.stopWaitingAnimation(),this.opponentScore.stopWaitingAnimation(),y)if(u===p)this.titleText.string="Draw";else if(u>p)this.titleText.string="You Win";else{if(!(u<p))return;this.titleText.string="You Lose"}else this.titleText.string=mk,this.playWaitingAnimation(),m||this.playerScore.playWaitingAnimation(),g||this.opponentScore.playWaitingAnimation();this.scheduleOnce(this.pollMatchState,s)}catch(e){console.warn("ResultScene: Error on pollMatchState",e),this.scheduleOnce(this.pollMatchState,this.pollingInterval)}}}__preload(){this.validateRequiredComponents(),this.listenEvents(),Ag.showBannerAds()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}onLoad(){try{const e=dk.getMatchState(),{playerId:t,opponentId:i}=e.customData;if(null===t||null===i)throw new Error(`ResultScene: playerId is ${t} and opponentId is ${i}. Expected to not be null.`);const{photo:n}=uk.getPlayer(),{score:a=0,finished:s=!1}=e.profiles[t],{photo:o,score:r=0,finished:l=!1}=e.profiles[i],c=s&&l,h=c&&a>r,d=c&&r>a;this.playerScore.loadPhoto(n),this.opponentScore.loadPhoto(o),this.playerScore.setPlayerScore(a),this.opponentScore.setPlayerScore(r),this.playerScore.showCrown(h),this.opponentScore.showCrown(d),s&&l?a===r?this.titleText.string="Draw":h?this.titleText.string="You Win":d&&(this.titleText.string="You Lose"):(this.titleText.string=mk,this.playWaitingAnimation(),s||this.playerScore.playWaitingAnimation(),l||this.opponentScore.playWaitingAnimation())}catch(e){console.warn("ResultScene: Error on load",e),this.goToDashboardScene()}}listenEvents(){this.node.scene.on(Zn,this.goToDashboardScene),this.node.scene.on(Jn,this.onReplayButtonPressed,this)}start(){this.scheduleOnce(this.pollMatchState,this.pollingInterval),this.scheduleOnce((()=>{this.paperConfetti.runEffect()}),.2)}onDestroy(){this.unschedule(this.pollMatchState)}async onReplayButtonPressed(){let{level:e=1}=uk.getGameData()??{};e=Math.max(1,e);const t=await this.levelManager.loadLevelData(e);try{if(!t)throw new Error("Level data is not found");const{opponentId:e}=dk.getMatchState().customData;if(!e)throw new Error("Opponent id is not found");ql.showLoadingScreen();const i=Zh.generateFen(t),{mode:n="",rules:a={addRandomTilesPerMove:0,maxSpaceOfPair:0},time:s=0,level:o}=t;await dk.challenge.friend.processAsync({playerId:uk.getPlayerId(),opponentId:e,extraData:{level:o,fen:i,gravity:n,rules:a,time:s}}),ql.closeLoadingScreen(),this.goToGameScene()}catch(e){console.warn("ReplayChallengeFriend",e),ql.closeLoadingScreen();const t=2;ql.showNotificationScreen("Sorry, you cannot replay\nat this time.",t),pk?.sendException(e instanceof Error?e:new Error("ReplayChallengeFriend"+JSON.stringify(e))),this.scheduleOnce(this.goToDashboardScene,t)}}onHomeButtonPressed(){this.goToDashboardScene()}goToGameScene(){El.switchScene(Fr)}playWaitingAnimation(){let e=0;this.titleText.schedule((()=>{e=(e+1)%4;const t=Array(e+1).join(".");this.titleText.string=mk+t}),.5);const t=this.titleText.getComponent(x),i=E(t).to(1,{opacity:130},{easing:"sineInOut"}).to(1,{opacity:255},{easing:"sineInOut"}).delay(.25);this.waitingAnimation=E(t).repeatForever(i).start()}stopWaitingAnimation(){this.titleText.unscheduleAllCallbacks(),this.waitingAnimation&&this.waitingAnimation.stop(),this.titleText.getComponent(x).opacity=255}}).prototype,"pollingInterval",[jM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),nk=ve(tk.prototype,"playerScore",[XM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ak=ve(tk.prototype,"opponentScore",[$M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sk=ve(tk.prototype,"paperConfetti",[QM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ok=ve(tk.prototype,"titleText",[JM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rk=ve(tk.prototype,"levelManager",[ZM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ek=tk))||ek);var yk,bk,fk,wk,Sk,vk,Ek,Ck,Tk;i._RF.pop(),i._RF.push({},"acb0egHPppFmYJalVNrDDv/","BaseScreen",void 0);const{ccclass:Ak,property:Rk,disallowMultiple:Ik}=a,{Events:Pk}=GameCore,{event:_k}=globalThis.game;let Lk=(yk=Ak("BaseScreen"),bk=Rk(n),fk=Rk(n),wk=Rk(x),yk(Sk=Ik((Ek=ve((vk=class extends s{constructor(){super(...arguments),e(this,"container",Ek,this),e(this,"backgroundMask",Ck,this),e(this,"screenOpacity",Tk,this),this.data={}}__preload(){this.animation=this.getComponent(y),this.validateRequiredComponents(),this.initializeNodes()}initializeNodes(){const e=this.getMaskOpacity(),t=this.getContainerOpacity();e&&t&&(e.opacity=0,t.opacity=0)}validateRequiredComponents(){Fe.lazyValidateProperties(this)}setScreenOpacity(e){this.screenOpacity.opacity=e}open(e){e&&(this.data=e),this.show(),this.runAnimation("OpenScreen")}close(){this.node.active&&(this.animation.once(y.EventType.FINISHED,(()=>{_k.emit(Pk.CLOSED_SCREEN,{screenName:this.node.name}),this.hide()})),this.runAnimation("CloseScreen"))}runAnimation(e){if(!this.isAnimationExist(e))throw new Error(`${this.node.name}: Animation component must have ${e} clip`);this.animation.play(e)}isAnimationExist(e){return this.animation.clips.some((t=>!(!t||t.name!==e)))}getMaskOpacity(){const e=this.backgroundMask.getComponent(x);return e||(console.warn("BaseScreen: maskOpacity not found"),null)}getContainerOpacity(){const e=this.container.getComponent(x);return e||(console.warn("BaseScreen: containerOpacity not found"),null)}show(){this.setScreenOpacity(255);const e=this.node.getComponent(A);e&&(e.enabled=!0,e.updateAlignment(),this.node.getComponentsInChildren(A).forEach((e=>{e.updateAlignment()})))}hide(){this.setScreenOpacity(0),this.node.setWorldPosition(new j(-1e3,-1e3,0));const e=this.node.getComponent(A);e&&(e.enabled=!1)}}).prototype,"container",[bk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ck=ve(vk.prototype,"backgroundMask",[fk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tk=ve(vk.prototype,"screenOpacity",[wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sk=vk))||Sk)||Sk);var Dk;i._RF.pop(),i._RF.push({},"f3521L4Mn5I3bhxr0QZJ9y9","BackgroundMask",void 0);const{ccclass:Ok,requireComponent:Nk}=a;Ok("BackgroundMask")(Dk=Nk([x])(Dk=class extends s{onLoad(){const e=this.getComponent(x);e?(this.opacity=e,this.updateMaskAlpha()):console.warn("BackgroundMask: UIOpacity not found")}updateMaskAlpha(){(e=>{const t=document.getElementById("app-mask");t&&(t.style.background=`rgb(0 0 0 / ${e})`)})(this.opacity.opacity/255)}})||Dk);var Mk,kk,xk,Fk,Bk;i._RF.pop(),i._RF.push({},"d25c5ZVzYVC/YcfG5prmRdB","Screens",void 0);const{ccclass:zk,property:Uk}=a;let Gk=(Mk=zk("Screens"),kk=Uk({type:M(Gi)}),Mk((Bk=ve((Fk=class extends s{constructor(){super(...arguments),e(this,"screenKeys",Bk,this)}}).prototype,"screenKeys",[kk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xk=Fk))||xk);var Hk,Vk,qk,Wk,Kk,Yk,jk,Xk,$k,Qk,Jk,Zk,ex,tx;i._RF.pop(),i._RF.push({},"cecf2nUBzhIWZw7uJgVliXz","CongratulationScreen",void 0);const{ccclass:ix,property:nx,disallowMultiple:ax,requireComponent:sx}=a,{Events:ox}=GameCore,{event:rx}=globalThis.game;Hk=ix("CongratulationScreen"),Vk=sx(Lk),qk=nx(n),Wk=nx(n),Kk=nx(p),Yk=nx(p),jk=nx(p),Hk(Xk=ax(Xk=Vk((Qk=ve(($k=class extends s{constructor(){super(...arguments),e(this,"congratulation",Qk,this),e(this,"confirmation",Jk,this),e(this,"closeButtonComponent",Zk,this),e(this,"yesButtonComponent",ex,this),e(this,"noButtonComponent",tx,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("CongratulationScreen: screen not found");this.validateEventPayload(e)&&(this.closeButtonComponent.interactable=!0,this.yesButtonComponent.interactable=!0,this.noButtonComponent.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Lk),this.confirmationUIOpacity=this.confirmation.getComponent(x),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){rx.on(ox.OPENING_SCREEN,this.handleOpeningScreen),rx.on(ox.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){rx.off(ox.OPENING_SCREEN,this.handleOpeningScreen),rx.off(ox.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name}open(){this.confirmation.active=!1,this.congratulation.active=!0}close(){this.closeButtonComponent.interactable=!1,this.yesButtonComponent.interactable=!1,this.noButtonComponent.interactable=!1,ql.closeScreen(Vi[this.node.name])}handleStartOver(){this.confirmation.active=!0,this.congratulation.active=!1,E(this.confirmationUIOpacity).set({opacity:0}).to(.2,{opacity:255}).start(),E(this.confirmation).set({scale:new j(.8,.8,.8)}).to(.2,{scale:new j(1,1,1)},{easing:"backOut"}).start()}handleYesStartOver(){this.close(),this.node.scene.emit(Ga.START_OVER)}handleNoStartOver(){this.requestGameReplay()}handleClickedClose(){this.requestGameReplay()}requestGameReplay(){this.close(),this.node.scene.emit(Ga.GAME_REPLAY,{level:this.screen.data.level})}}).prototype,"congratulation",[qk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jk=ve($k.prototype,"confirmation",[Wk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zk=ve($k.prototype,"closeButtonComponent",[Kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ex=ve($k.prototype,"yesButtonComponent",[Yk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tx=ve($k.prototype,"noButtonComponent",[jk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xk=$k))||Xk)||Xk);var lx,cx,hx,dx,ux,px,mx,gx,yx,bx,fx,wx,Sx,vx,Ex,Cx,Tx,Ax,Rx,Ix,Px;i._RF.pop(),i._RF.push({},"01c067hcjNDc7prJzSE6UEq","DayBlock",void 0);const{ccclass:_x,property:Lx}=a;let Dx=(lx=_x("DayBlock"),cx=Lx({type:R,group:"Background"}),hx=Lx({type:R,group:"Background"}),dx=Lx({type:N,group:"Background"}),ux=Lx({type:N,group:"Background"}),px=Lx(h),mx=Lx(h),gx=Lx(n),yx=Lx(n),bx=Lx(n),lx((Sx=ve((wx=class extends s{constructor(){super(...arguments),e(this,"background",Sx,this),e(this,"topBackground",vx,this),e(this,"blueBackground",Ex,this),e(this,"blueTopBackground",Cx,this),e(this,"dayLabel",Tx,this),e(this,"coinLabel",Ax,this),e(this,"rewardItemsNode",Rx,this),e(this,"checkNode",Ix,this),e(this,"glowNodes",Px,this)}onLoad(){this.uiOpacity=this.getComponent(x),this.initDefaultProperties(),this.validateRequiredComponents()}initDefaultProperties(){this.defaultBackground=this.background.spriteFrame,this.defaultTopBackground=this.topBackground.spriteFrame,this.defaultDayLabelOutlineColor=new o(this.dayLabel.outlineColor),this.blueDayLabelOutlineColor=new o("#3469bf")}validateRequiredComponents(){Fe.lazyValidateProperties(this)}updateInfo(e){this.updateBackground(e),this.updateDayLabel(e),this.coinLabel.string=e.value.toString(),this.updateRewardItems(e)}updateBackground(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"rewarded":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}updateDayLabel(e){this.dayLabel.string=`Day ${e.day.toString()}`;let t=this.defaultDayLabelOutlineColor;"rewarded"!==e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.outlineColor=t,this.dayLabel.shadowColor=t}updateRewardItems(e){switch(e.status){case"ready":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!0);break;case"waiting":this.rewardItemsNode.active=!0,this.checkNode.active=!1,this.setGlowNodesActive(!1);break;case"rewarded":this.rewardItemsNode.active=!1,this.checkNode.active=!0,this.setGlowNodesActive(!1)}}setGlowNodesActive(e){this.glowNodes&&this.glowNodes.forEach((t=>{t.active=e}))}}).prototype,"background",[cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vx=ve(wx.prototype,"topBackground",[hx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ex=ve(wx.prototype,"blueBackground",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cx=ve(wx.prototype,"blueTopBackground",[ux],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tx=ve(wx.prototype,"dayLabel",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ax=ve(wx.prototype,"coinLabel",[mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rx=ve(wx.prototype,"rewardItemsNode",[gx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ix=ve(wx.prototype,"checkNode",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Px=ve(wx.prototype,"glowNodes",[bx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fx=wx))||fx);var Ox,Nx,Mx,kx,xx,Fx;i._RF.pop(),i._RF.push({},"cc662r8eR5Al6FdOBdcAkHG","DailyRewardsScreen",void 0);const{ccclass:Bx,property:zx,requireComponent:Ux}=a,{Events:Gx,Utils:{Object:Hx,Array:Vx},Configs:{DailyRewards:qx}}=GameCore,{event:Wx,dailyRewards:Kx,player:Yx,monitorError:jx}=globalThis.game;Ox=Bx("DailyRewardsScreen"),Nx=Ux(Lk),Mx=zx([Dx]),Ox(kx=Nx((Fx=ve((xx=class extends s{constructor(){super(...arguments),this.rewardsData=[],this.debugScreenOpened=!1,this.debugUpdatedRewardsData=!1,e(this,"dailyBlocks",Fx,this),this.handleOpeningScreen=e=>{this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){Wx.on(Gx.OPENING_SCREEN,this.handleOpeningScreen),Wx.on(Gx.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){Wx.off(Gx.OPENING_SCREEN,this.handleOpeningScreen),Wx.off(Gx.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name}async open(){
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.debugScreenOpened=!0,this.node.scene.emit(Ga.HIDE_UI),this.resetState(),await this.updateRewardsData(),this.loginDailyRewards(),this.updateDayBlocks(),this.runPopUpAnimation()}close(){Wx.emit(Gx.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ga.SHOW_UI)}resetState(){this.dailyBlocks.forEach((e=>{e.uiOpacity.opacity=0,e.node.scale=new j(1.2,1.2,1.2)}))}runPopUpAnimation(){this.screen.container||console.warn("DailyRewardScreen: screen not found"),this.dailyBlocks.forEach(((e,t)=>{this.runAppearTween(e,.15*t)}))}runAppearTween(e,t){E(e.uiOpacity).delay(t).to(.3,{opacity:255},{easing:"quadOut"}).start(),E(e.node).delay(t).to(.3,{scale:j.ONE},{easing:"backOut"}).start()}handleOnClaim(){const e=this.getCurrentRewardData();if(!e)
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return jx?.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),void ql.showNotificationScreen("Unable to validate rewards. Please try again later...",2);this.claimReward(e)}async handleOnClaimX2(){const e=this.getCurrentRewardData();if(!e)
//! DEBUG bug Cannot read properties of undefined (reading 'find')
return jx?.sendException(new Error("DailyRewardsScreen: rewardData not found"),{nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened}),void ql.showNotificationScreen("Unable to validate rewards. Please try again later...",2);if(!await Ag.showRewardVideoAdAsync({}))return;this.claimReward(e,!0)}getCurrentRewardData(){return Vx.search(this.rewardsData,(e=>"ready"===e.status))}claimReward(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=e.value*(t?2:1),n=new si;if(this.node.scene.emit(Ga.ADD_COINS,{coins:i,collectionAnimation:{animateTextOnly:!1,signal:n}}),!e.items)return void this.close();const a=e.items.hint*(t?2:1),s=e.items.thunder*(t?2:1),o=e.items.storm*(t?2:1),r=Yx.getGameData();r?(Yx.setGameData({items:{hint:r.items.hint+a,thunder:r.items.thunder+s,storm:r.items.storm+o,pliers:r.items.pliers}}),this.close()):this.close()}async updateRewardsData(){await Kx.requestDailyRewardsAsync();const e={...Kx.getDailyRewards()};for(let t=0;t<qx.MaxDays;t++)e[t]={...e[t],value:Cr[t].value,items:Cr[t].items};e&&(this.rewardsData=Hx.vals(e),
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.debugUpdatedRewardsData=!0,console.log("DailyRewardsScreen: rewardsData",this.rewardsData))}loginDailyRewards(){Kx.logLoginReward()}updateDayBlocks(){
//! DEBUG bug Cannot read properties of undefined (reading 'find')
this.dailyBlocks.length>this.rewardsData.length&&(console.warn("DailyRewardsScreen: dailyBlocks not enough"),jx?.sendException(new Error("DailyRewardsScreen: dailyBlocks not enough"),{dailyBlocksCount:this.dailyBlocks.length,rewardsDataCount:this.rewardsData.length,nodeIsActive:this.node.activeInHierarchy,nodeHasParent:null!==this.node.parent&&void 0!==this.node.parent,hasLoadedRewardsData:this.debugUpdatedRewardsData,hasOpenedScreen:this.debugScreenOpened})),this.dailyBlocks.forEach(((e,t)=>{
//! DEBUG bug Cannot read properties of undefined (reading 'find')
if(t>=this.rewardsData.length)return;const{id:i,type:n,value:a,status:s}=this.rewardsData[t];e.updateInfo({day:i,type:n,value:a,status:s})}))}}).prototype,"dailyBlocks",[Mx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kx=xx))||kx);var Xx;i._RF.pop(),i._RF.push({},"5a6aeaMAdtMGYA8B1wIuhDa","DayBlockRed",void 0);const{ccclass:$x}=a;$x("DayBlockRed")(Xx=class extends Dx{updateBackground(e){if(this.blueTopBackground&&this.blueBackground)switch(e.status){case"ready":this.background.spriteFrame=this.blueBackground,this.topBackground.spriteFrame=this.blueTopBackground;break;case"waiting":this.background.spriteFrame=this.defaultBackground,this.topBackground.spriteFrame=this.defaultTopBackground}}updateDayLabel(e){this.dayLabel.string=`Day ${e.day.toString()}`;let t=this.defaultDayLabelOutlineColor;"ready"===e.status&&(t=this.blueDayLabelOutlineColor),this.dayLabel.shadowColor=t,this.dayLabel.outlineColor=t}});var Qx,Jx,Zx,eF,tF,iF,nF,aF,sF,oF;i._RF.pop(),i._RF.push({},"6fed95tFh5MRKzFqaFB2Ts8","GetCoinScreen",void 0);const{ccclass:rF,property:lF,requireComponent:cF}=a,{event:hF}=globalThis.game,{Events:dF}=GameCore;Qx=rF("GetCoinScreen"),Jx=cF(Lk),Zx=lF(h),eF=lF(p),tF=lF(p),Qx(iF=Jx((aF=ve((nF=class extends s{constructor(){super(...arguments),e(this,"quantityLabel",aF,this),e(this,"closeButtonComponent",sF,this),e(this,"getNowButtonComponent",oF,this),this.handleOpeningScreen=e=>{console.log("GetCoinScreen.OPENING_SCREEN",e),this.validateEventPayload(e)&&(this.closeButtonComponent.interactable=!0,this.getNowButtonComponent.interactable=!0,this.updateStatus())},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){hF.on(dF.OPENING_SCREEN,this.handleOpeningScreen),hF.on(dF.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){hF.off(dF.OPENING_SCREEN,this.handleOpeningScreen),hF.off(dF.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){if(!("screenName"in e))return!1;const{screenName:t}=e;return t===this.node.name&&(this.payload=e,!0)}open(){this.updateStatus(),this.runPopUpAnimation(),this.node.scene.emit(Ga.HIDE_UI)}close(){this.closeButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,hF.emit(dF.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ga.SHOW_UI)}updateStatus(){this.updateCoinQuantity()}runPopUpAnimation(){this.screen.container||console.warn("GetCoinScreen: screen not found")}updateCoinQuantity(){const e=this.getQuantity();e&&this.updateQuantityLabel(e)}updateQuantityLabel(e){this.quantityLabel.string=`x${e.toString()}`}getQuantity(){if(!this.payload||!("screenData"in this.payload))return 0;const{screenData:e}=this.payload;return e&&"quantity"in e&&e.quantity&&"number"==typeof e.quantity?e.quantity:0}handleAddCoin(){const e=this.getQuantity();this.node.scene.emit(Ga.ADD_COINS,{coins:e,collectionAnimation:{animateTextOnly:!1}}),this.close()}async handleGetNowButtonClicked(){ji.stopAllSounds();await Ag.showRewardVideoAdAsync({})&&this.handleAddCoin()}}).prototype,"quantityLabel",[Zx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sF=ve(nF.prototype,"closeButtonComponent",[eF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oF=ve(nF.prototype,"getNowButtonComponent",[tF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iF=nF))||iF);var uF,pF,mF,gF,yF,bF,fF,wF,SF;i._RF.pop(),i._RF.push({},"91e6dGDvN1FKLi7g/JQPwl8","ItemCollectionFX",void 0);const{ccclass:vF,property:EF}=a;let CF=(uF=vF("ItemCollectionFX"),pF=EF(R),mF=EF(x),gF=EF(se),uF((fF=ve((bF=class extends s{constructor(){super(...arguments),e(this,"sprite",fF,this),e(this,"glowUIOpacity",wF,this),e(this,"particles",SF,this)}__preload(){Fe.lazyValidateProperties(this)}playExplosionParticles(){this.particles.resetSystem()}}).prototype,"sprite",[pF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wF=ve(bF.prototype,"glowUIOpacity",[mF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SF=ve(bF.prototype,"particles",[gF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yF=bF))||yF);var TF,AF,RF,IF,PF,_F,LF,DF,OF,NF,MF,kF,xF,FF,BF,zF,UF,GF,HF,VF,qF,WF,KF,YF,jF;i._RF.pop(),i._RF.push({},"f016fTAlsNKRYkdu72AyCLI","GetItemScreen",void 0);const{ccclass:XF,property:$F}=a,{event:QF,player:JF,analytics:ZF}=globalThis.game,{Events:eB,Utils:{Object:tB,Array:iB},Plugins:{Analytics:{Events:nB}}}=GameCore;TF=XF("GetItemScreen"),AF=$F(_),RF=$F(R),IF=$F(R),PF=$F(R),_F=$F(R),LF=$F(h),DF=$F(h),OF=$F(h),NF=$F(p),MF=$F(p),kF=$F(p),TF((BF=ve((FF=class extends s{constructor(){super(...arguments),e(this,"itemFxPrefab",BF,this),e(this,"hintSprite",zF,this),e(this,"stormSprite",UF,this),e(this,"pliersSprite",GF,this),e(this,"thunderSprite",HF,this),e(this,"titleLabel",VF,this),e(this,"descriptionLabel",qF,this),e(this,"coinLabel",WF,this),e(this,"closeButtonComponent",KF,this),e(this,"buyItemButtonComponent",YF,this),e(this,"getNowButtonComponent",jF,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("GetItemScreen: screen not found");if(!this.validateEventPayload(e))return;this.closeButtonComponent.interactable=!0,this.getNowButtonComponent.interactable=!0,this.buyItemButtonComponent.interactable=!0;const t=this.getItemType();t&&this.updateStatus(t)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){QF.on(eB.OPENING_SCREEN,this.handleOpeningScreen),QF.on(eB.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){QF.off(eB.OPENING_SCREEN,this.handleOpeningScreen),QF.off(eB.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name&&(this.payload=e,!0)}open(){this.node.scene.emit(Ga.GAME_PAUSE)}close(){this.closeButtonComponent.interactable=!1,this.buyItemButtonComponent.interactable=!1,this.getNowButtonComponent.interactable=!1,QF.emit(eB.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ga.GAME_RESUME)}updateStatus(e){this.updateItemIcon(e),this.updateTitle(e),this.updateDescription(),this.updateButtons(e)}updateItemIcon(e){switch([this.hintSprite,this.stormSprite,this.thunderSprite,this.pliersSprite].forEach((e=>{e.node.active=!1})),e){case yr.HINT:this.activeIcon=this.hintSprite;break;case yr.STORM:this.activeIcon=this.stormSprite;break;case yr.THUNDER:this.activeIcon=this.thunderSprite;break;case yr.PLIERS:this.activeIcon=this.pliersSprite}this.activeIcon.node.active=!0}updateTitle(e){const t=e.charAt(0).toUpperCase()+e.slice(1);this.titleLabel.string=t}updateDescription(){const e=this.payload.screenData?.message;e&&(this.descriptionLabel.string=e)}updateButtons(e){const t=this.canBuyItem(e);this.buyItemButtonComponent.node.active=t,this.getNowButtonComponent.node.active=!t,t&&(this.coinLabel.string=""+3*Sr[e])}canBuyItem(e){const t=JF.getGameData();if(!t)return!1;const{coins:i}=t;return i>=3*Sr[e]}getItemType(){const{screenData:e}=this.payload;return e&&e.item&&iB.has(tB.vals(yr),e.item)?e.item:null}async handleAddItem(){const e=this.getItemType();if(!e)return;ZF.event(nB.EARN_ITEM,{item_name:e,value:3}),this.node.scene.emit(Ga.ADD_ITEM,{animate:()=>this.animateAddItem(e),item:e,quantity:3})}async animateAddItem(e){const{spriteFrame:t}=this.activeIcon,[i,n]=this.createItemCollectionNode(t),a=this.getItemButtonWorldPosition(e),s=new j(.5,.5,.5);n.glowUIOpacity.opacity=150,await this.playScaleUpItemAnim(i,n),await vt.runTweenAsync(E(n.glowUIOpacity).to(.8,{opacity:0},{easing:"cubicIn"})),await this.playMoveCloseToItemButtonAnim(i,a,s),await this.playJumpAnim(i,s,a),ji.playSound("sounds/clicks"),i.destroy()}async playJumpAnim(e,t,i){const n=i.clone().add3f(0,70,0),a=t.clone().multiplyScalar(1.3);await Promise.all([vt.runTweenAsync(E(e).to(.3,{worldPosition:n},{easing:"cubicOut"})),vt.runTweenAsync(E(e).to(.3,{scale:a},{easing:"cubicOut"}))]),await vt.runTweenAsync(E(e).to(.5,{worldPosition:i},{easing:"cubicIn"}))}playMoveCloseToItemButtonAnim(e,t,i){const n=t.clone().add3f(0,30,0);return vt.runTweenAsync(E(e).to(1,{worldPosition:n,scale:i},{easing:"cubicInOut"}))}createItemCollectionNode(e){const t=c(this.itemFxPrefab),i=t.getComponent(CF);return t.setParent(this.node.parent),i.sprite.spriteFrame=e,t.setWorldPosition(this.activeIcon.node.worldPosition.clone()),[t,i]}playScaleUpItemAnim(e,t){return e.setScale(j.ZERO),vt.runTweenAsync(E(e).delay(.2).call((()=>{t.playExplosionParticles(),ji.playSound("sounds/item_reward")})).to(.1,{scale:new j(.8,1.2,1)}).to(.1,{scale:new j(1.2,.8,1)}).to(.1,{scale:new j(1,1,1)}))}getItemButtonWorldPosition(e){return this.getItemButton(e).worldPosition.clone()}async handleGetNowButtonClicked(){this.stopAllSounds();await Ag.showRewardVideoAdAsync({})&&(this.handleAddItem(),this.close())}async handleBuyItemButtonClicked(){this.node.scene.emit(Ga.REMOVE_COINS,{coins:3*Sr[this.getItemType()],collectionAnimation:{animateTextOnly:!0}}),this.handleAddItem(),this.close()}stopAllSounds(){P("Sound")?.getComponent(St)?.stopAll()}getItemButton(e){switch(e){case yr.HINT:return P("Canvas/UI/Footer/HintItemButton");case yr.STORM:return P("Canvas/UI/Footer/StormItemButton");case yr.THUNDER:return P("Canvas/UI/Footer/ThunderItemButton");case yr.PLIERS:return P("Canvas/UI/Footer/PliersItemButton")}}}).prototype,"itemFxPrefab",[AF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zF=ve(FF.prototype,"hintSprite",[RF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UF=ve(FF.prototype,"stormSprite",[IF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GF=ve(FF.prototype,"pliersSprite",[PF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HF=ve(FF.prototype,"thunderSprite",[_F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VF=ve(FF.prototype,"titleLabel",[LF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qF=ve(FF.prototype,"descriptionLabel",[DF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WF=ve(FF.prototype,"coinLabel",[OF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KF=ve(FF.prototype,"closeButtonComponent",[NF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YF=ve(FF.prototype,"buyItemButtonComponent",[MF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jF=ve(FF.prototype,"getNowButtonComponent",[kF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xF=FF));var aB,sB,oB,rB,lB,cB,hB,dB,uB,pB,mB,gB,yB,bB,fB,wB,SB,vB,EB,CB,TB,AB,RB,IB,PB,_B,LB,DB,OB,NB;i._RF.pop(),i._RF.push({},"31829DUddVEq6NgIYHvnI68","LevelCompleteScreen",void 0);const{ccclass:MB,property:kB,requireComponent:xB}=a,{Events:FB,Utils:{Valid:BB}}=GameCore,{event:zB,player:UB}=globalThis.game,GB="Coin Container";aB=MB("LevelCompleteScreen"),sB=xB(Lk),oB=kB(Wv),rB=kB(n),lB=kB(h),cB=kB(n),hB=kB(n),dB=kB(p),uB=kB(n),pB=kB(y),mB=kB(n),gB=kB({type:y,group:GB}),yB=kB({type:D,group:GB}),bB=kB({type:D,group:GB}),fB=kB(jS),aB(wB=sB((vB=ve((SB=class extends s{constructor(){super(...arguments),this.levelId=1,this.coins=40,this.currentCoin=0,e(this,"coinContainer",vB,this),e(this,"playButton",EB,this),e(this,"coinText",CB,this),e(this,"levelText",TB,this),e(this,"nextLevelText",AB,this),e(this,"playButtonComponent",RB,this),e(this,"wellDoneText",IB,this),e(this,"coinAnimation",PB,this),e(this,"playButtonContainer",_B,this),e(this,"coinContainerAnimation",LB,this),e(this,"coinContainerEnterClip",DB,this),e(this,"coinContainerExitClip",OB,this),e(this,"paperConfetti",NB,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("StarChestScreen: screen not found");this.validateEventPayload(e)&&(this.playButtonComponent.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Lk),this.validateRequiredComponents(),this.listenScreenEvents()}onLoad(){const e=this.screen.open;this.screen.open=t=>{this.overrideOpenHandler(e,t)}}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){zB.on(FB.OPENING_SCREEN,this.handleOpeningScreen),zB.on(FB.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){zB.off(FB.OPENING_SCREEN,this.handleOpeningScreen),zB.off(FB.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t,screenData:i}=e??{};return t===this.node.name&&(!!BB.isObject(i)&&(BB.isNumber(i.level)&&(this.levelId=i.level,this.coins=this.levelId<5?br:fr),BB.isNumber(i.currentCoin)&&(this.currentCoin=i.currentCoin),!0))}open(){this.updateComponents(),this.node.scene.emit(Ga.HIDE_UI)}async close(){await vt.runAnimationAsync(this.coinContainerAnimation,this.coinContainerExitClip.name),zB.emit(FB.CLOSE_SCREEN,{screenName:this.node.name}),await Ag.showInterstitialAdAsync({forLevel:this.screen.data.level}),this.handleNextLevel()}async overrideOpenHandler(e,t){this.screen.setScreenOpacity(255),this.coinText.string="x0",this.playButtonComponent.interactable=!1,this.paperConfetti.runEffect(),await this.animateWellDoneText(),this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z),e.call(this.screen,t),this.screen.getComponent(y)?.once(y.EventType.FINISHED,(()=>{this.animateCoin()}))}handleNextLevel(){const e=this.screen.data.level;if(!e)return void console.warn("LevelCompleteScreen: level not found");const t=UB.getGameData();if(!t)return void console.warn("LevelCompleteScreen: gameData not found");e>=t.totalLevel?this.node.scene.emit(Ga.MAX_LEVEL):this.node.scene.emit(Ga.NEXT_LEVEL)}updateComponents(){this.updateLevelText(),this.updateCoinContainer()}updateCoinContainer(){this.coinContainer.updateCoins({coins:this.currentCoin})}updateLevelText(){const e=UB.getGameData();if(!e)return void console.warn("LevelCompleteScreen: gameData not found");this.levelText.getComponent(h).string=`Level ${this.levelId}`,console.log("LevelCompleteScreen: updateLevelText",this.levelId);const t=this.levelId+1>e.totalLevel?"Complete":`Level ${this.levelId+1}`;this.nextLevelText.getComponent(h).string=t}updateCoinString(){this.coinText.string=`x${this.coins}`,console.log("LevelCompleteScreen: updateCoinString",this.coins)}async animateCoin(){this.screen.container?(this.coinAnimation.play(),await this.animateCoinText({contentFn:e=>`x${e}`,currentQuantity:0,targetQuantity:this.coins}),await this.animateCoinCollection(),await vt.runTweenAsync(this.showPlayButton()),this.updateCoinString()):console.warn("LevelCompleteScreen: screen not found")}async animateCoinCollection(){await vt.runAnimationAsync(this.coinContainerAnimation,this.coinContainerEnterClip.name),this.node.scene.emit(Ga.ADD_COINS,{coins:this.coins,collectionAnimation:{animateTextOnly:!1,target:this.coinContainer}})}showPlayButton(){return E(this.playButtonContainer).call((()=>{this.playButtonContainer.setScale(0,0,this.playButtonContainer.scale.z)})).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).call((()=>{this.playButtonComponent.interactable=!0}))}handleClickedPlay(){this.playButtonComponent.interactable=!1,this.close()}animateWellDoneText(){const e=this.wellDoneText.position.clone(),t=E(this.wellDoneText).call((()=>{this.wellDoneText.setPosition(0,0,this.wellDoneText.position.z),this.wellDoneText.setScale(0,0,this.wellDoneText.scale.z)})).to(.5,{scale:new j(1.5,1.5,1)},{easing:"cubicOut"}).to(.5,{scale:new j(1,1,1)},{easing:"backOut"}).to(.5,{position:e},{easing:"backOut"});return vt.runTweenAsync(t)}animateCoinText(e){let{contentFn:t,currentQuantity:i,targetQuantity:n,duration:a=.8}=e;const s=E({currentQuantity:i}).to(a,{currentQuantity:n},{easing:"linear",onUpdate:e=>{if(!e)return;const i=e.currentQuantity,n=Math.floor(i);this.coinText.string=t(n)}});return vt.runTweenAsync(s)}}).prototype,"coinContainer",[oB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EB=ve(SB.prototype,"playButton",[rB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CB=ve(SB.prototype,"coinText",[lB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TB=ve(SB.prototype,"levelText",[cB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AB=ve(SB.prototype,"nextLevelText",[hB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RB=ve(SB.prototype,"playButtonComponent",[dB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IB=ve(SB.prototype,"wellDoneText",[uB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PB=ve(SB.prototype,"coinAnimation",[pB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_B=ve(SB.prototype,"playButtonContainer",[mB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LB=ve(SB.prototype,"coinContainerAnimation",[gB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DB=ve(SB.prototype,"coinContainerEnterClip",[yB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OB=ve(SB.prototype,"coinContainerExitClip",[bB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NB=ve(SB.prototype,"paperConfetti",[fB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wB=SB))||wB);var HB;i._RF.pop(),i._RF.push({},"61985gSEDBMY6nVNc9Q1D6W","LoadingScreen",void 0);const{ccclass:VB,disallowMultiple:qB,requireComponent:WB}=a,{Events:KB}=GameCore,{event:YB}=globalThis.game;VB("LoadingScreen")(HB=qB(HB=WB(Lk)(HB=class extends s{constructor(){super(...arguments),this.handleOpeningScreen=e=>{this.validateEventPayload(e)&&(this.enabled=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()},this.handleClosingScreen=e=>{this.validateEventPayload(e)&&this.unscheduleAllCallbacks()},this.handleClosedScreen=e=>{this.validateEventPayload(e)&&(this.enabled=!1)},this.handleOnCloseScreen=()=>{ql.closeScreen(Vi[this.node.name])}}onLoad(){this.enabled=!1,this.screen=this.getComponent(Lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){YB.on(KB.OPENING_SCREEN,this.handleOpeningScreen),YB.on(KB.OPENED_SCREEN,this.handleOpenedScreen),YB.on(KB.CLOSING_SCREEN,this.handleClosingScreen),YB.on(KB.CLOSED_SCREEN,this.handleClosedScreen)}unListenScreenEvents(){YB.off(KB.OPENING_SCREEN,this.handleOpeningScreen),YB.off(KB.OPENED_SCREEN,this.handleOpenedScreen),YB.off(KB.CLOSING_SCREEN,this.handleClosingScreen),YB.off(KB.CLOSED_SCREEN,this.handleClosedScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name}open(){if(!this.enabled)return;const e=this.screen.data.duration;e&&e>0&&this.scheduleOnce(this.handleOnCloseScreen,e)}})||HB)||HB);var jB,XB,$B,QB,JB,ZB,ez,tz;i._RF.pop(),i._RF.push({},"6460akNFfhP9pDOT2Z0+s2R","NotificationScreen",void 0);const{ccclass:iz,disallowMultiple:nz,requireComponent:az,property:sz}=a,{Events:oz,Utils:{Valid:rz}}=GameCore,{event:lz}=globalThis.game;jB=iz("NotificationScreen"),XB=az(Lk),$B=sz(h),QB=sz(p),jB(JB=nz(JB=XB((ez=ve((ZB=class extends s{constructor(){super(...arguments),e(this,"message",ez,this),e(this,"touchZone",tz,this),this.enableCloseOnTouch=!0,this.handleOpeningScreen=e=>{this.validateEventPayload(e)&&this.updateScreenData(e)},this.handleClosingScreen=e=>{this.validateEventPayload(e)&&this.unscheduleAllCallbacks()}}__preload(){this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}onLoad(){this.validateRequiredComponents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){lz.on(oz.OPENING_SCREEN,this.handleOpeningScreen),lz.on(oz.CLOSING_SCREEN,this.handleClosingScreen)}unListenScreenEvents(){lz.off(oz.OPENING_SCREEN,this.handleOpeningScreen),lz.off(oz.CLOSING_SCREEN,this.handleClosingScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name}updateScreenData(e){const{screenData:t}=e;rz.isObject(t)?(t.message&&(this.message.string=t.message),t.duration&&t.duration>0&&this.scheduleOnce((()=>{ql.closeScreen(Vi[this.node.name])}),t.duration),!1===t.enableCloseOnTouch?this.enableCloseOnTouch=!1:this.enableCloseOnTouch=!0):console.warn("NotificationScreen: screenData not found")}handleClickedClose(){this.unscheduleAllCallbacks(),ql.closeScreen(Vi[this.node.name])}closeOnTouch(){this.enableCloseOnTouch&&this.handleClickedClose()}}).prototype,"message",[$B],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tz=ve(ZB.prototype,"touchZone",[QB],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JB=ZB))||JB)||JB);var cz,hz,dz,uz,pz,mz,gz,yz;i._RF.pop(),i._RF.push({},"7129ca71jRMGaTHxWhEL4F4","QuitLevelScreen",void 0);const{ccclass:bz,property:fz,requireComponent:wz}=a,{Events:Sz}=GameCore,{event:vz}=globalThis.game;cz=bz("QuitLevelScreen"),hz=wz(Lk),dz=fz(p),uz=fz(p),cz(pz=hz((gz=ve((mz=class extends s{constructor(){super(...arguments),e(this,"noButton",gz,this),e(this,"yesButton",yz,this),this.handleOpeningScreen=e=>{this.validateEventPayload(e)&&(this.noButton.interactable=!0,this.yesButton.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){vz.on(Sz.OPENING_SCREEN,this.handleOpeningScreen),vz.on(Sz.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){vz.off(Sz.OPENING_SCREEN,this.handleOpeningScreen),vz.off(Sz.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name}open(){this.runPopUpAnimation(),this.node.scene.emit(Ga.HIDE_UI)}close(){this.noButton.interactable=!1,this.yesButton.interactable=!1,ql.closeScreen(Vi[this.node.name]),this.node.scene.emit(Ga.SHOW_UI),this.node.scene.emit(Ga.GAME_RESUME)}runPopUpAnimation(){this.screen.container||console.warn("StartLevelScreen: screen not found")}handleClickedNo(){this.close()}handleClickedYes(){this.node.scene.emit(Ga.GAME_EXIT)}}).prototype,"noButton",[dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yz=ve(mz.prototype,"yesButton",[uz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pz=mz))||pz);var Ez,Cz,Tz,Az,Rz,Iz,Pz,_z,Lz,Dz,Oz,Nz,Mz,kz,xz,Fz,Bz,zz,Uz,Gz,Hz,Vz;i._RF.pop(),i._RF.push({},"85907Tnp/NBq7myeciP/4h3","RescuesScreen",void 0);const{ccclass:qz,property:Wz,disallowMultiple:Kz,requireComponent:Yz}=a,{Events:jz}=GameCore,{event:Xz,player:$z}=globalThis.game;Ez=qz("RescuesScreen"),Cz=Yz(Lk),Tz=Wz(x),Az=Wz([n]),Rz=Wz(h),Iz=Wz(h),Pz=Wz(n),_z=Wz(n),Lz=Wz(y),Dz=Wz(n),Oz=Wz(n),Ez(Nz=Kz(Nz=Cz((kz=ve((Mz=class extends s{constructor(){super(...arguments),e(this,"adOpacity",kz,this),e(this,"animNodes",xz,this),e(this,"titleLabel",Fz,this),e(this,"descriptionLabel",Bz,this),e(this,"timer",zz,this),e(this,"bomb",Uz,this),e(this,"bombAnim",Gz,this),e(this,"replayButton",Hz,this),e(this,"buyTimeButton",Vz,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("RescuesScreen: screen not found");this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){Xz.on(jz.OPENING_SCREEN,this.handleOpeningScreen),Xz.on(jz.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){Xz.off(jz.OPENING_SCREEN,this.handleOpeningScreen),Xz.off(jz.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e;return t===this.node.name&&(this.payload=e,!0)}async open(){await this.resetState(),this.runOpenAnimation(),this.node.scene.emit(Ga.HIDE_UI)}close(){Xz.emit(jz.CLOSE_SCREEN,{screenName:this.node.name})}async resetState(){const e=this.payload.screenData?.failKey===Zl;this.titleLabel.string=e?"Boom!":"Time's Up!",this.descriptionLabel.string=e?"The bomb exploded!":"Restart or add 2 minutes?",this.timer.active=!e,this.bomb.active=e,e&&this.bombAnim.play();const t=$z.getGameData();if(!t)return;const i=t.coins>=vr;this.replayButton.active=!i,this.buyTimeButton.active=i,this.adOpacity.opacity=0}async runOpenAnimation(){this.screen.container?(await Promise.all(this.animNodes.map(((e,t)=>{this.runAppearTween(e,.1*t)}))),await this.runShowAdContainer()):console.warn("TimeUpScreen: screen not found")}async runAppearTween(e,t){await vt.runTweenAsync(E(e).set({scale:new j(0,0,0)}).delay(t).to(1,{scale:new j(1,1,1)},{progress:(e,t,i,n)=>e+(t-e)*vt.elasticOut(n,.1,.45)}))}runShowAdContainer(){const e=E(this.adOpacity);return e.delay(1),e.to(.5,{opacity:255}),vt.runTweenAsync(e)}handleClickReplayButton(){this.close(),this.node.scene.emit(Ga.GAME_REPLAY,{level:this.screen.data.level})}handleClickBuyTimeButton(){this.node.scene.emit(Ga.REMOVE_COINS,{coins:vr,collectionAnimation:{animateTextOnly:!0}}),this.startRescue()}async handleClickAdButton(){await Ag.showRewardVideoAdAsync({})&&this.startRescue()}startRescue(){this.node.scene.emit(Ga.SHOW_UI),this.node.scene.emit(Ga.RESCUE_START),this.close()}}).prototype,"adOpacity",[Tz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xz=ve(Mz.prototype,"animNodes",[Az],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Fz=ve(Mz.prototype,"titleLabel",[Rz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bz=ve(Mz.prototype,"descriptionLabel",[Iz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zz=ve(Mz.prototype,"timer",[Pz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Uz=ve(Mz.prototype,"bomb",[_z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gz=ve(Mz.prototype,"bombAnim",[Lz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hz=ve(Mz.prototype,"replayButton",[Dz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vz=ve(Mz.prototype,"buyTimeButton",[Oz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nz=Mz))||Nz)||Nz);var Qz,Jz,Zz,eU,tU,iU,nU,aU,sU,oU,rU,lU,cU,hU,dU,uU,pU,mU,gU,yU,bU,fU,wU,SU,vU,EU;i._RF.pop(),i._RF.push({},"61932YLC/5CFrE0eD0ez8Zg","SettingsScreen",void 0);const{ccclass:CU,property:TU,requireComponent:AU}=a,{Events:RU,Utils:{Device:IU}}=GameCore,{player:PU,event:_U}=globalThis.game;Qz=CU("SettingsScreen"),Jz=AU(Lk),Zz=TU(n),eU=TU(n),tU=TU(n),iU=TU(BP),nU=TU(BP),aU=TU(BP),sU=TU(p),oU=TU(p),rU=TU(p),lU=TU(p),cU=TU(n),Qz(hU=Jz((uU=ve((dU=class extends s{constructor(){super(...arguments),e(this,"musicSetting",uU,this),e(this,"soundSetting",pU,this),e(this,"vibrateSetting",mU,this),e(this,"musicSwitch",gU,this),e(this,"soundSwitch",yU,this),e(this,"vibrateSwitch",bU,this),e(this,"closeButtonComponent",fU,this),e(this,"continueButtonComponent",wU,this),e(this,"restartButtonComponent",SU,this),e(this,"inviteFriendsButtonComponent",vU,this),e(this,"animNodes",EU,this),this.triggerSequence="",this.handleOpeningScreen=e=>{this.validateSwitchScreenPayload(e)&&(this.closeButtonComponent.interactable=!0,this.continueButtonComponent.interactable=!0,this.restartButtonComponent.interactable=!0,this.inviteFriendsButtonComponent.interactable=!0,this.updateStatus())},this.handleOpenedScreen=e=>{this.validateSwitchScreenPayload(e)&&this.open()},this.handleResetSequence=()=>{this.triggerSequence=""},this.handleTriggerUnlockKey=e=>{if(!("code"in e))return;const{code:t}=e,{UNLOCK_SEQUENCE:i}=Ir;"number"==typeof t&&-1!==i.indexOf(t.toString())&&(this.triggerSequence+=t.toString(),console.log("SettingsScreen: handleTriggerUnlockKey",t,this.triggerSequence,this.triggerSequence===i),this.triggerSequence===i&&(this.node.scene.emit(Ir.Events.UNLOCK_DEV_TOOLS),this.node.off(Ir.Events.TRIGGER_UNLOCK_KEY)))},this.updateVibrateButton=()=>{const e=this.vibrateSetting.getComponentInChildren(p),t=this.vibrateSetting.getComponentInChildren(BP),i=this.vibrateSetting.getComponentInChildren(qn);if(e&&t&&i)if(IU.isMobile()){const e=PU.getPlayerSetting("vibrate")??!1;t.setEnabled(e)}else e.interactable=!1,t.setEnabled(!1),i.changeState(!1);else console.warn("SettingsScreen: vibrate button missing components")}}onLoad(){this.enabled=!1,this.screen=this.getComponent(Lk),this.validateRequiredComponents(),this.listenScreenEvents(),this.listenUnlockDevTools()}onDestroy(){this.unListenScreenEvents(),this.unListenUnlockDevTools()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){_U.on(RU.OPENING_SCREEN,this.handleOpeningScreen),_U.on(RU.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){_U.off(RU.OPENING_SCREEN,this.handleOpeningScreen),_U.off(RU.OPENED_SCREEN,this.handleOpenedScreen)}validateSwitchScreenPayload(e){const{screenName:t}=e;return t===this.node.name}listenUnlockDevTools(){this.node.off(Ir.Events.TRIGGER_UNLOCK_KEY),this.node.on(Ir.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.on(Ir.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}unListenUnlockDevTools(){this.node.off(Ir.Events.TRIGGER_RESET_SEQUENCE,this.handleResetSequence),this.node.off(Ir.Events.TRIGGER_UNLOCK_KEY,this.handleTriggerUnlockKey)}open(){this.updateStatus(),this.runPopUpAnimation(),this.node.emit(Ir.Events.TRIGGER_RESET_SEQUENCE),this.node.scene.emit(Ga.HIDE_UI)}close(){this.closeButtonComponent.interactable=!1,this.continueButtonComponent.interactable=!1,this.restartButtonComponent.interactable=!1,this.inviteFriendsButtonComponent.interactable=!1,this.node.emit(Ir.Events.TRIGGER_RESET_SEQUENCE),ql.closeScreen(Vi[this.node.name])}updateStatus(){const e={music:PU.getPlayerSetting("music")??!1,sound:PU.getPlayerSetting("sound")??!1,vibrate:PU.getPlayerSetting("vibrate")??!1};this.musicSwitch?this.soundSwitch?(this.musicSwitch.setEnabled(e.music),this.soundSwitch.setEnabled(e.sound),"GameDistributions"!==GameSDK.getSDKName()&&this.scheduleOnce(this.updateVibrateButton,.1)):console.warn("SettingsScreen: soundSwitch not found"):console.warn("SettingsScreen: musicSwitch not found")}runPopUpAnimation(){this.screen.container||console.warn("SettingsScreen: screen not found"),this.animNodes.forEach(((e,t)=>{this.runAppearTween(e,.1*t)}))}runAppearTween(e,t){const i=E(e);i.set({scale:new j(0,0,0)}),i.delay(t),i.to(1,{scale:new j(1,1,1)},{progress:(e,t,i,n)=>e+(t-e)*vt.elasticOut(n,.1,.45)}),i.start()}switchMusicButton(){if(!this.musicSwitch)return void console.warn("SettingsScreen: musicSwitch not found");const e=this.musicSwitch.switch();PU.setSetting("music",e),this.node.emit(Ir.Events.TRIGGER_UNLOCK_KEY,{code:e?1:0}),e?ji.playMusic():ji.pauseMusic()}switchSoundButton(){if(!this.soundSwitch)return void console.warn("SettingsScreen: soundSwitch not found");const e=this.soundSwitch.switch();PU.setSetting("sound",e),this.node.emit(Ir.Events.TRIGGER_UNLOCK_KEY,{code:e?3:2})}switchVibrateButton(){if(!this.vibrateSwitch)return void console.warn("SettingsScreen: vibrateSwitch not found");const e=this.vibrateSwitch.switch();PU.setSetting("vibrate",e)}handleClickedResume(){this.resumeGame()}handleClickedClose(){this.resumeGame()}handleClickedReplayGame(){this.restartGame()}async handleClickedInviteFriends(){this.close(),this.node.scene.emit(Ga.INVITE_FRIENDS)}resumeGame(){this.close(),this.node.scene.emit(Ga.GAME_RESUME),this.node.scene.emit(Ga.SHOW_UI)}restartGame(){this.close(),this.node.scene.emit(Ga.GAME_RESUME);const{level:e=1}=PU.getGameData()??{};this.node.scene.emit(Ga.GAME_REPLAY,{level:e})}}).prototype,"musicSetting",[Zz],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pU=ve(dU.prototype,"soundSetting",[eU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mU=ve(dU.prototype,"vibrateSetting",[tU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gU=ve(dU.prototype,"musicSwitch",[iU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yU=ve(dU.prototype,"soundSwitch",[nU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bU=ve(dU.prototype,"vibrateSwitch",[aU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fU=ve(dU.prototype,"closeButtonComponent",[sU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wU=ve(dU.prototype,"continueButtonComponent",[oU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SU=ve(dU.prototype,"restartButtonComponent",[rU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vU=ve(dU.prototype,"inviteFriendsButtonComponent",[lU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EU=ve(dU.prototype,"animNodes",[cU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hU=dU))||hU);var LU,DU,OU,NU,MU,kU,xU,FU,BU,zU,UU,GU,HU,VU,qU,WU,KU,YU,jU,XU,$U,QU,JU;i._RF.pop(),i._RF.push({},"891d37NJ6lLdp3CNLPHxZ6d","StarChest",void 0);const{ccclass:ZU,property:eG}=a;let tG=(LU=ZU("StarChest"),DU=eG(R),OU=eG(x),NU=eG(se),MU=eG(x),kU=eG(x),xU=eG({type:C,readonly:!0,displayName:"Starting Offset X",group:"Reward Animations"}),FU=eG({type:C,readonly:!0,displayName:"Starting Offset Y",group:"Reward Animations"}),BU=eG({type:C,displayName:"Centered Offset X",group:"Reward Animations"}),zU=eG({type:C,displayName:"Centered Offset Y",group:"Reward Animations"}),UU=eG({type:C,min:0,displayName:"Starting Scale",group:"Reward Animations"}),GU=eG({type:C,min:0,displayName:"Ending Scale",group:"Reward Animations"}),LU((qU=ve((VU=class extends s{constructor(){super(...arguments),e(this,"sprite",qU,this),e(this,"glowOpacity",WU,this),e(this,"explosionParticles",KU,this),e(this,"circle",YU,this),e(this,"uiOpacity",jU,this),this.ogCenterX=0,this.ogCenterY=0,e(this,"endingOffsetX",XU,this),e(this,"endingOffsetY",$U,this),e(this,"startingScale",QU,this),e(this,"endingScale",JU,this)}get startingOffsetX(){return this.node.position.x}get startingOffsetY(){return this.node.position.y}__preload(){this.validateRequiredComponents(),this.ogCenterX=this.startingOffsetX,this.ogCenterY=this.startingOffsetY}validateRequiredComponents(){Fe.lazyValidateProperties(this)}async moveToCenter(e){const t=new j(this.endingOffsetX,this.endingOffsetY,this.node.position.z);await vt.runTweenAsync(E(this.node).to(.7,{position:t},{easing:"quintInOut"}),e),this.node.position=t}respawnAtStartingState(){this.node.position=new j(this.ogCenterX,this.ogCenterY,this.node.position.z),this.glowOpacity.opacity=0,this.sprite.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.glowOpacity.node.setScale(this.startingScale,this.startingScale,this.startingScale),this.uiOpacity.opacity=255}async scale(e,t){const i=this.startingScale+(this.endingScale-this.startingScale)*e,n=new j(i,i,i);await Promise.all([vt.runTweenAsync(E(this.sprite.node).to(.2,{scale:n},{easing:"backOut"}),t),vt.runTweenAsync(E(this.glowOpacity.node).to(.2,{scale:n},{easing:"backOut"}),t)]),this.sprite.node.setScale(n),this.glowOpacity.node.setScale(n)}startShaking(){const e=this.node.position.clone();this.shakingTween={ogPos:e,tw:E({}).to(.1,{},{onUpdate:(t,i)=>{if(i){const t=e.x+10*(i-.5);this.node.position=new j(t,e.y,e.z)}}}).repeatForever().start()}}stopShaking(){this.shakingTween&&(this.shakingTween.tw.stop(),this.node.position=this.shakingTween.ogPos,this.shakingTween=void 0)}async glow(e){const t=this.sprite.node.scale.clone().multiplyScalar(1.1);await Promise.all([vt.runTweenAsync(E(this.sprite.node).to(.2,{scale:t},{easing:"cubicInOut"}),e),vt.runTweenAsync(E(this.glowOpacity.node).to(.2,{scale:t}),e),vt.runTweenAsync(E(this.glowOpacity).to(.5,{opacity:255}),e)])}async explode(e){const t=new j(8,8,8);await Promise.all([this.explodeParticles(e),(async()=>{this.circle.opacity=255,this.circle.node.setScale(j.ZERO),await Promise.all([vt.runTweenAsync(E(this.circle).to(.3,{opacity:0}),e),vt.runTweenAsync(E(this.circle.node).to(.3,{scale:t},{easing:"cubicOut"}),e)]),this.circle.opacity=0,this.circle.node.scale=t})(),(async()=>{await Promise.all([vt.runTweenAsync(E(this.glowOpacity.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),e),vt.runTweenAsync(E(this.sprite.node).to(.3,{scale:j.ZERO},{easing:"cubicOut"}),e)]),this.sprite.node.setScale(j.ZERO),this.glowOpacity.node.setScale(j.ZERO)})()])}async explodeParticles(e){e.aborted||(this.explosionParticles.node.active=!0,this.explosionParticles.resetSystem(),await vt.waitTweenAsync(1),this.explosionParticles.node.active=!1)}}).prototype,"sprite",[DU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WU=ve(VU.prototype,"glowOpacity",[OU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KU=ve(VU.prototype,"explosionParticles",[NU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YU=ve(VU.prototype,"circle",[MU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jU=ve(VU.prototype,"uiOpacity",[kU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ve(VU.prototype,"startingOffsetX",[xU],Object.getOwnPropertyDescriptor(VU.prototype,"startingOffsetX"),VU.prototype),ve(VU.prototype,"startingOffsetY",[FU],Object.getOwnPropertyDescriptor(VU.prototype,"startingOffsetY"),VU.prototype),XU=ve(VU.prototype,"endingOffsetX",[BU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$U=ve(VU.prototype,"endingOffsetY",[zU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),QU=ve(VU.prototype,"startingScale",[UU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),JU=ve(VU.prototype,"endingScale",[GU],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),HU=VU))||HU);var iG,nG,aG,sG,oG,rG,lG,cG,hG,dG,uG,pG,mG,gG,yG,bG,fG,wG,SG,vG;i._RF.pop(),i._RF.push({},"e414bczbutHJKcOfhl1sc4p","StarChestScreen",void 0);const{ccclass:EG,property:CG,requireComponent:TG}=a,{Events:AG}=GameCore,{event:RG,player:IG}=globalThis.game;iG=EG("StarChestScreen"),nG=TG(Lk),aG=CG(sA),sG=CG(h),oG=CG(p),rG=CG(y),lG=CG(tG),cG=CG(x),hG=CG(Ov),dG=CG(h),iG(uG=nG((mG=ve((pG=class extends s{constructor(){super(...arguments),e(this,"starProgressBar",mG,this),e(this,"buttonLabel",gG,this),e(this,"button",yG,this),e(this,"chestAnimation",bG,this),e(this,"starChest",fG,this),e(this,"chestUnlockFXMask",wG,this),e(this,"skipOverlay",SG,this),e(this,"messageLabel",vG,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("StarChestScreen: screen not found");this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){RG.on(AG.OPENING_SCREEN,this.handleOpeningScreen),RG.on(AG.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){RG.off(AG.OPENING_SCREEN,this.handleOpeningScreen),RG.off(AG.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name}open(){this.runPopUpAnimation(),this.node.scene.emit(Ga.HIDE_UI);const e=IG.getGameData();if(!e)return;const{stars:t}=e;this.numChestAvailable=Math.floor(t/20),this.starProgressBar.setRange(t,20),this.buttonLabel.string=this.numChestAvailable?"Open":"Continue",this.messageLabel.string=this.numChestAvailable?"Congrats, you have enough stars to open the chest!":"Win more stars to open!",this.button.interactable=!0,this.numChestAvailable?this.chestAnimation.play():this.chestAnimation.stop(),this.chestUnlockFXMask.node.active=!1,this.chestUnlockFXMask.opacity=0,this.starChest.respawnAtStartingState()}close(){RG.emit(AG.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ga.SHOW_UI)}runPopUpAnimation(){this.screen.container||console.warn("StarChestScreen: screen not found")}async handleClickButton(){if(0===this.numChestAvailable)return void this.close();ji.turnDownMusic();const e=IG.getGameData();if(!e)return;this.button.interactable=!1;const{stars:t}=e;IG.setGameData({stars:e.stars-20*this.numChestAvailable});const i=new si;await this.skipOverlay.open({opacity:200,onSkip:()=>i.abort()}),await this.handleUnlockAnimation(t,e.stars,i),await this.skipOverlay.close(),ji.turnUpMusic(),W.emit(Zt),this.close()}async handleUnlockAnimation(e,t,i){await Promise.all([this.starChest.moveToCenter(i),this.fadeInChestUnlockFX(i)]),this.chestAnimation.stop(),this.starChest.startShaking(),ji.playSound(Fi.STAR_CHEST_DRUM_ROLL,{loop:!0}),await vt.waitTweenAsync(0);let n=e,a=this.numChestAvailable;const s=e=>this.numChestAvailable>2?1-e/this.numChestAvailable:.35*(1-e/this.numChestAvailable);await Promise.all([this.starProgressBar.animateTo(t,i,(e=>{n-e>=20&&(n=e,a--,this.starChest.scale(s(a),i),ji.playSound(Fi.STAR_CHEST_OPEN))}))]),await vt.waitTweenAsync(1,i),this.starChest.stopShaking(),await this.starChest.glow(i),ji.stopSound(Fi.STAR_CHEST_DRUM_ROLL);const o=wr*this.numChestAvailable;this.node.scene.emit(Ga.ADD_COINS,{coins:o,collectionAnimation:{animateTextOnly:!1,floatDuration:3,signal:i}}),await this.starChest.explode(i),await vt.waitTweenAsync(1,i),await Promise.all([this.fadeOutChestUnlockFX(i)])}async fadeInChestUnlockFX(e){this.chestUnlockFXMask.node.active=!0,await vt.runTweenAsync(E(this.chestUnlockFXMask).to(.5,{opacity:150}),e)}async fadeOutChestUnlockFX(e){await vt.runTweenAsync(E(this.chestUnlockFXMask).to(.3,{opacity:0}),e),this.chestUnlockFXMask.opacity=0,this.chestUnlockFXMask.node.active=!1}}).prototype,"starProgressBar",[aG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gG=ve(pG.prototype,"buttonLabel",[sG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yG=ve(pG.prototype,"button",[oG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bG=ve(pG.prototype,"chestAnimation",[rG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fG=ve(pG.prototype,"starChest",[lG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wG=ve(pG.prototype,"chestUnlockFXMask",[cG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SG=ve(pG.prototype,"skipOverlay",[hG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vG=ve(pG.prototype,"messageLabel",[dG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uG=pG))||uG);var PG,_G,LG,DG,OG,NG,MG,kG,xG,FG,BG,zG,UG,GG;i._RF.pop(),i._RF.push({},"ecbb9MLxRlP2Kv7swFe9AXo","StartLevelScreen",void 0);const{ccclass:HG,property:VG,requireComponent:qG}=a,{Events:WG}=GameCore,{event:KG}=globalThis.game;PG=HG("StartLevelScreen"),_G=qG(Lk),LG=VG(n),DG=VG(n),OG=VG(n),NG=VG(n),MG=VG(p),PG(kG=_G((FG=ve((xG=class extends s{constructor(){super(...arguments),e(this,"playButton",FG,this),e(this,"goalText",BG,this),e(this,"levelText",zG,this),e(this,"missionText",UG,this),e(this,"playButtonComponent",GG,this),this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("StartLevelScreen: screen not found");this.validateEventPayload(e)&&(this.playButtonComponent.interactable=!0)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Lk),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){KG.on(WG.OPENING_SCREEN,this.handleOpeningScreen),KG.on(WG.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){KG.off(WG.OPENING_SCREEN,this.handleOpeningScreen),KG.off(WG.OPENED_SCREEN,this.handleOpenedScreen)}validateEventPayload(e){const{screenName:t,screenData:i}=e??{};return t===this.node.name&&(i?.level&&(this.levelId=i.level),i?.mission&&(this.mission=i.mission),!0)}open(){this.updateComponents(),this.runPopUpAnimation(),this.node.scene.emit(Ga.HIDE_UI)}close(){this.playButtonComponent.interactable=!1,KG.emit(WG.CLOSE_SCREEN,{screenName:this.node.name}),this.node.scene.emit(Ga.SHOW_UI)}updateComponents(){this.updateGoalText(),this.updateLevelText(),this.updateDescriptionText()}updateGoalText(){const{mission:e}=this.mission;this.goalText.getComponent(h).string=e>1?"Goals":"Goal"}updateLevelText(){this.levelText.getComponent(h).string=`Level ${this.levelId}`}updateDescriptionText(){this.missionText.getComponent(h).string=this.mission.description}runPopUpAnimation(){this.screen.container||console.warn("StartLevelScreen: screen not found")}handleClickedPlay(){this.node.scene.emit(Ga.GAME_START),this.close()}}).prototype,"playButton",[LG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BG=ve(xG.prototype,"goalText",[DG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zG=ve(xG.prototype,"levelText",[OG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UG=ve(xG.prototype,"missionText",[NG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GG=ve(xG.prototype,"playButtonComponent",[MG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kG=xG))||kG);var YG,jG,XG,$G,QG;i._RF.pop(),i._RF.push({},"fe274iMNmBCzZ13Ie1nGU1R","TournamentLeaderSkeleton",void 0);const{ccclass:JG,property:ZG}=a;let eH=(YG=JG("TournamentLeaderSkeleton"),jG=ZG(n),YG((QG=ve(($G=class extends s{constructor(){super(...arguments),e(this,"container",QG,this)}__preload(){this.uiOpacity=this.getComponent(x),this.validateRequiredComponents()}async hide(e){await vt.runTweenAsync(E(this.uiOpacity).to(.2,{opacity:0}).call((()=>{this.node.active=!1})),e)}async show(e,t){this.node.active=!0,this.node.scale=new j(.8,.8,.8),this.uiOpacity.opacity=0;const i=this.container.position.clone();this.container.position=new j(i.x,i.y-100,i.z);const n=E(this.node).delay(e);n.to(.2,{scale:j.ONE},{easing:"elasticOut"});const a=E(this.container).delay(e);a.to(.2,{position:i},{easing:"backOut"});const s=E(this.uiOpacity).delay(e);s.to(.2,{opacity:255},{easing:"cubicOut"}),await Promise.all([vt.runTweenAsync(n,t),vt.runTweenAsync(a,t),vt.runTweenAsync(s,t)])}validateRequiredComponents(){if(!this.uiOpacity)throw new Error("UIOpacity component is not attached to the same node");if(!this.container)throw new Error("Container is not attached to the same node")}}).prototype,"container",[jG],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XG=$G))||XG);var tH,iH,nH,aH,sH,oH,rH,lH,cH,hH,dH,uH,pH,mH,gH,yH,bH,fH,wH,SH,vH,EH,CH,TH,AH,RH;i._RF.pop(),i._RF.push({},"cdaa9B4pK9PFrDmP6/GQcMn","TournamentDetailScreen",void 0);const{ccclass:IH,property:PH,requireComponent:_H}=a,{Events:LH,Utils:{Object:DH,Time:OH,Number:NH,Array:MH}}=GameCore,{event:kH,storage:xH,player:FH,leaderboard:BH}=globalThis.game;tH=IH("TournamentDetailScreen"),iH=_H(Lk),nH=PH(h),aH=PH(h),sH=PH(h),oH=PH(gL),rH=PH(l),lH=PH({type:n,group:"Buttons"}),cH=PH({type:n,group:"Buttons"}),hH=PH({type:n,group:"Buttons"}),dH=PH({type:[eH]}),uH=PH({type:[R]}),pH=PH(jS),tH(mH=iH((yH=ve((gH=class extends s{constructor(){super(...arguments),e(this,"titleLabel",yH,this),e(this,"timeLabel",bH,this),e(this,"playerCountLabel",fH,this),e(this,"tournamentLeaders",wH,this),e(this,"viewport",SH,this),e(this,"playButton",vH,this),e(this,"continueButton",EH,this),e(this,"replayButton",CH,this),e(this,"leaderSkeletons",TH,this),e(this,"banners",AH,this),e(this,"paperConfetti",RH,this),this.animAbortSignal=null,this.fetchAbortController=null,this.leadersPayload=null,this.handleOpeningScreen=e=>{if(!this.screen)throw new Error("TournamentDetailScreen: screen not found");this.validateEventPayload(e)},this.handleOpenedScreen=e=>{this.validateEventPayload(e)&&this.open()}}__preload(){this.enabled=!1,this.screen=this.getComponent(Lk),this.tournamentScrollView=this.tournamentLeaders.node.getComponent(ce),this.validateRequiredComponents(),this.listenScreenEvents()}onDestroy(){this.unListenScreenEvents()}validateRequiredComponents(){Fe.lazyValidateProperties(this)}listenScreenEvents(){kH.on(LH.OPENING_SCREEN,this.handleOpeningScreen),kH.on(LH.OPENED_SCREEN,this.handleOpenedScreen)}unListenScreenEvents(){kH.off(LH.OPENING_SCREEN,this.handleOpeningScreen),kH.off(LH.OPENED_SCREEN,this.handleOpenedScreen)}updateVisibility(){this.tournamentLeaders.updateVisibility()}validateEventPayload(e){const{screenName:t}=e??{};return t===this.node.name&&(this.payload=e,!0)}open(){if(this.updateButtonVisibility(),this.setPlayerCountWaiting(),this.runPopUpAnimation(),this.node.scene.emit(Ga.HIDE_UI),this.tournamentScrollView.node.on(ce.EventType.SCROLLING,this.updateVisibility,this),null!==this.animAbortSignal)throw new Error("TournamentContent: TournamentContent is already loading. Please handle cancelling gracefully.");this.animAbortSignal=new si,this.updateInfo(this.animAbortSignal)}close(){ql.closeTournamentDetailScreen(),this.node.scene.emit(Ga.SHOW_UI),this.tournamentScrollView.node.off(ce.EventType.SCROLLING,this.updateVisibility,this),this.cleanup()}cleanup(){this.fetchAbortController?.abort(),this.animAbortSignal?.abort(),this.animAbortSignal=null,this.fetchAbortController=null,this.tournamentLeaders.removeLeaders()}runPopUpAnimation(){this.screen.container||console.warn("StartLevelScreen: screen not found")}async updateInfo(e){const t=this.payload?.screenData?.tournament;if(!t)return;const i=JSON.parse(t);i.id=i.id.toString(),this.tournamentPayload=i;const{endTime:n,payload:a,title:s}=this.tournamentPayload,{leaderboardId:o="",themeId:r}=a;this.updateTitle(s),this.updateEndTime(n),this.updateTournamentBanner(r);const{previousScore:l,previousRank:c,animateTournamentLeader:h}=xH.getStorage("tournament");if(this.updateButtonsVisibility(h),await this.showLoading(e),this.leadersPayload=await this.getLeadersPayload(o),!this.leadersPayload)return this.updatePlayerCount(0),void this.hideLoading(e);const{player:d,leaders:u}=this.leadersPayload;this.updatePlayerCount(u.length);const p=d?.score??0;if(d&&h&&l&&l<p&&c&&c!==(d?.rank??0)){MH.search(u,(e=>e.playerId===d.playerId)).score=l}await this.hideLoading(e),this.tournamentLeaders.updateData(u),await this.runShowUpAnimation(e),h&&(xH.setStorageData("tournament","animateTournamentLeader",!1),await this.runPlayerRankChangeAnimation(e,p))}updateTournamentBanner(e){e?this.activateThemeBanner(e):this.activateThemeBanner(el.SUMMER)}activateThemeBanner(e){let t=!1;this.banners.forEach((i=>{i.node.active=i.node.name.toLowerCase()===e,i.node.active&&(t=!0)})),t||this.banners.forEach((e=>{e.node.active=e.node.name.toLowerCase()===el.SUMMER}))}async showLoading(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;await Promise.all([this.leaderSkeletons.map(((i,n)=>i.show(n*t,e)))])}async hideLoading(e){await Promise.all(this.leaderSkeletons.map((t=>t.hide(e))))}async runShowUpAnimation(e){await this.tournamentLeaders.showLeaders(e);const t=this.tournamentLeaders.getPlayerLeader();t&&await this.scrollToLeader(t,1)}async runPlayerRankChangeAnimation(e,t){const i=this.tournamentLeaders.getLeaderData(),n=MH.search(i,(e=>e.playerId===FH.getPlayerId()));if(!n)return;const{score:a,rank:s}=n;if(a===t)return;n.score=t,i.sort(((e,t)=>t.score-e.score)),i.forEach(((e,t)=>{e.rank=t+1}));const o=this.tournamentLeaders.getPlayerLeader();if(!o)return;const r=this.tournamentLeaders.getLeaderByRank(n.rank);if(!r)return;this.tournamentLeaders.layout.enabled=!1,o.node.setParent(this.node,!0),await o.runScaleAnimation(e,1.1,.5),n.rank<=10&&ji.playSound(Fi.STAR_CHEST_DRUM_ROLL);const l=Math.min(.5*(s-n.rank),2),c=[o.runUpdateDataAnimation(s,n.rank,a,n.score,l),this.scrollToLeader(r,l)],h=this.viewport.contentSize.height,d=this.viewport.getBoundingBoxToWorld(),u=this.tournamentScrollView.getMaxScrollOffset().y,p=-r.node.position.y-h/2;let m=j.ZERO;p<0?m=new j(o.node.worldPosition.x,d.yMax+r.node.position.y,o.node.worldPosition.z):this.tournamentScrollView.getScrollOffset().y>=u-5&&(m=p<u?new j(o.node.worldPosition.x,d.center.y,o.node.worldPosition.z):r.node.worldPosition),m.equals(j.ZERO)||c.push(o.runWorldPositionAnimation(m,l)),await Promise.all(c),ji.stopSound(Fi.STAR_CHEST_DRUM_ROLL),await Promise.all([o.runScaleAnimation(e,1,.25),o.node.setParent(this.tournamentLeaders.layout.node,!0),o.node.setSiblingIndex(n.rank-1),this.tournamentLeaders.runUpdateLeadersRankAnimation(n.rank,s),this.runPaperConfettiEffect(n.rank)]),this.tournamentLeaders.layout.enabled=!0,this.tournamentLeaders.layout.updateLayout()}runPaperConfettiEffect(e){e>10||(this.paperConfetti.runEffect(),ji.playSound(Fi.LEADERBOARD_TRIUMPH))}async scrollToLeader(e,t){const{contentSize:i}=this.tournamentLeaders.uiTransform,n=new Q(0,-e.node.position.y-i.height/2),a=this.tournamentScrollView.getScrollOffset().clone();n.y=Math.max(n.y,0),a.y=Math.max(a.y,0);const s=n.y-a.y;if(!(Math.abs(s)<5))return this.tournamentScrollView.scrollToOffset(n,t),vt.waitTweenAsync(t)}updateTitle(e){e&&(this.titleLabel.string=e)}updateEndTime(e){let t=OH.getRelativeTime(e);t=t.replace("seconds","secs").replace("second","sec"),t=t.replace("minutes","mins").replace("minute","min"),this.timeLabel.string=`Ends ${t}`}updatePlayerCount(e){const t=NH.getShortNumber(e,3);this.playerCountLabel.string=`${t} `+(e>1?"players":"player")}setPlayerCountWaiting(){this.playerCountLabel.string="Loading..."}async getLeadersPayload(e){const t=BH.getLeaderboardName(e);if(!t)return null;await BH.requestLeaderboardAsync(t,0);const i=BH.getLeaderboard(t);if(!i)return null;const n=DH.vals(i.leaders),a=FH.getPlayerId(),s={leaders:[],player:void 0,isPlayerInTournament:!1};for(const e of n){const{playerId:t}=e;t===a?(s.player=e,s.isPlayerInTournament=!0,s.leaders.push(e)):s.leaders.push(e)}return s}updateButtonsVisibility(e){this.playButton.active=!e,this.continueButton.active=e,this.replayButton.active=e}async handleOnPlay(){const e=this.tournamentPayload.id||"";if(Ql.validateTournamentExpired(e))return this.close(),this.node.scene.emit(Ur.RELOAD_TOURNAMENT),void ql.showNotificationScreen("Tournament has ended",2);try{ql.showLoadingNotificationScreen(),await this.processJoinTournament()}catch(e){if(DH.hasOwn(e,"code")&&"USER_INPUT"===e.code)return void ql.closeNotificationScreen();try{await this.processContinueTournament()}catch(e){if(DH.hasOwn(e,"code")&&"USER_INPUT"===e.code)return void ql.closeNotificationScreen();console.error("processPlayButtonPressed",e),ql.showNotificationScreen("Sorry, you cannot join\nat this time.",2)}}}async processJoinTournament(){try{await this.joinTournamentAsync(),El.switchScene(Fr,{level:1})}catch(e){throw console.warn("processJoinTournament",e),e}}async processContinueTournament(){try{await this.continueTournamentAsync(),El.switchScene(Fr,{level:1})}catch(e){throw console.warn("processContinueTournament",e),e}}async joinTournamentAsync(){const e=this.tournamentPayload.id||"";await wl.joinTournamentAsync(e)}async continueTournamentAsync(){const e=GameSDK.context.getID()??"";await wl.continueTournamentAsync(e)}updateButtonVisibility(){const{tournamentContextType:e="tournament_start"}=this.payload?.screenData??{};switch(e){case"tournament_end":this.playButton.active=!1,this.continueButton.active=!0,this.replayButton.active=!0;break;case"tournament_start":this.playButton.active=!0,this.continueButton.active=!1,this.replayButton.active=!1}}}).prototype,"titleLabel",[nH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bH=ve(gH.prototype,"timeLabel",[aH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fH=ve(gH.prototype,"playerCountLabel",[sH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wH=ve(gH.prototype,"tournamentLeaders",[oH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SH=ve(gH.prototype,"viewport",[rH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vH=ve(gH.prototype,"playButton",[lH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EH=ve(gH.prototype,"continueButton",[cH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CH=ve(gH.prototype,"replayButton",[hH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TH=ve(gH.prototype,"leaderSkeletons",[dH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AH=ve(gH.prototype,"banners",[uH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RH=ve(gH.prototype,"paperConfetti",[pH],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mH=gH))||mH);var zH;i._RF.pop(),i._RF.push({},"36d58kn8v5POaqgX4C8S3ct","TournamentLeader",void 0);const{ccclass:UH}=a;UH("TournamentLeader")(zH=class extends $_{});i._RF.pop(),i._RF.push({},"43001Am3F9GVZjL3Nj2K44h","CoreManager",void 0);const{Events:GH}=GameCore,{event:HH,monitorError:VH}=globalThis.game;class qH{constructor(){this.callbackCoreBooting=null,this.callbackCoreStarting=null,this.callbackCoreReady=null,this.handleWhenCoreBooting=()=>{if(!this.callbackCoreBooting)return console.error("Core: Booting callback is not set"),void VH?.sendException(new Error("Core: Booting callback is not set"));console.info(" Core: Boot"),this.callbackCoreBooting(),this.callbackCoreBooting=null},this.handleWhenCoreStarting=()=>{if(!this.callbackCoreStarting)return console.error("Core: Starting callback is not set"),void VH?.sendException(new Error("Core: Starting callback is not set"));console.info(" Core: Starting"),this.callbackCoreStarting(),this.callbackCoreStarting=null},this.handleWhenCoreReady=()=>{if(!this.callbackCoreReady)return console.error("Core: Ready callback is not set"),void VH?.sendException(new Error("Core: Ready callback is not set"));console.info(" Core: Ready"),this.callbackCoreReady(),this.callbackCoreReady=null}}init(){this.listenEvents(),console.info("Core Manager: Initialized")}listenEvents(){HH.once(GH.CORE_BOOTING,this.handleWhenCoreBooting),HH.once(GH.CORE_STARTING,this.handleWhenCoreStarting),HH.once(GH.CORE_READY,this.handleWhenCoreReady)}requestStart(){HH.emit(GH.REQUEST_CORE_START)}onCoreBoot(e){this.callbackCoreBooting=e;HH.getEventEmitCount(GH.CORE_BOOTING)>0&&(HH.off(GH.CORE_BOOTING,this.handleWhenCoreBooting),this.handleWhenCoreBooting())}onCoreStart(e){this.callbackCoreStarting=e;HH.getEventEmitCount(GH.CORE_STARTING)>0&&(HH.off(GH.CORE_STARTING,this.handleWhenCoreStarting),this.handleWhenCoreStarting())}onCoreReady(e){this.callbackCoreReady=e;HH.getEventEmitCount(GH.CORE_READY)>0&&(HH.off(GH.CORE_READY,this.handleWhenCoreReady),this.handleWhenCoreReady())}}i._RF.pop(),i._RF.push({},"b4ad5mMokdAa6EVNGzNedpF","EngineManager",void 0);const{Configs:{GameEngine:{DynamicAtlas:WH}},Utils:{Valid:KH}}=GameCore;class YH{constructor(){this.overrideSettings=()=>{ue.overrideSettings(pe.Category.ENGINE,"debug",KH.isDebugger())},this.handleResizeView=e=>{le.instance.resizeWithBrowserSize(!1);const{width:t,height:i}=e;this.resizeView(t,i)},this.handleViewResized=e=>{const{width:t,height:i}=e;le.instance.resizeWithBrowserSize(!0),console.info(" New View Size",{width:t,height:i})}}init(){this.overrideSettings(),this.setupAutoAtlas(),this.setupBatcherLimit(),this.setupDynamicAtlas(),this.listenEvents(),console.info("Engine Manager: Initialized")}listenEvents(){W.on(Wn,this.handleResizeView),W.on(Kn,this.handleViewResized)}setupAutoAtlas(){me.instance.cacheAsset=!0}setupDynamicAtlas(){switch(Y.os){case Y.OS.IOS:this.setupDynamicAtlasForIOS();break;case Y.OS.ANDROID:this.setupDynamicAtlasForAndroid();break;default:this.setupDynamicAtlasForDesktop()}}setDynamicAtlas(e){const{Enabled:t,AutoAtlasSize:i,MaxAtlasCount:n,MaxAtlasSize:a,MaxFrameSize:s}=e;if(ge.instance.enabled=t,ge.instance.textureSize=a,ge.instance.maxFrameSize=s,ge.instance.maxAtlasCount=n,ge.instance.textureBleeding=!0,i){const e=this.getMaxTextureSize();if(!e)return;ge.instance.maxAtlasCount=1,ge.instance.textureSize=e}}getMaxTextureSize(){if(!m.root)return-1;const{capabilities:e}=m.root.device,{maxTextureSize:t}=e;return t>8192?7168:t-1024}setupDynamicAtlasForIOS(){const{IOS:e}=WH;this.setDynamicAtlas(e)}setupDynamicAtlasForAndroid(){const{Android:e}=WH;this.setDynamicAtlas(e)}setupDynamicAtlasForDesktop(){const{Desktop:e}=WH;this.setDynamicAtlas(e)}setupBatcherLimit(){ye.BATCHER2D_MEM_INCREMENT=288,ye.MAX_LABEL_CANVAS_POOL_SIZE=125}resizeView(e,t){const i=window.devicePixelRatio,n=i>=2?2/i:1,a=e*i*n,s=t*i*n;m.root?.resize(a,s),B.windowSize=new z.Size(a,s),m.once(J.EVENT_AFTER_UPDATE,(()=>{W.emit(Kn,{width:a,height:s})}))}}i._RF.pop();var jH=new class{constructor(){this._registry={},this._moduleCache={}}define(e,t,i){this._registry[e]={factory:t,resolveMap:i}}require(e){return this._require(e)}throwInvalidWrapper(e,t){throw new Error(`Module '${e}' imported from '${t}' is expected be an ESM-wrapped CommonJS module but it doesn't.`)}_require(e,t){const i=this._moduleCache[e];if(i)return i.exports;const n={id:e,exports:{}};return this._moduleCache[e]=n,this._tryModuleLoad(n,e),n.exports}_resolve(e,t){return this._resolveFromInfos(e,t)||this._throwUnresolved(e,t)}_resolveFromInfos(e,t){return e in cjsInfos?e:t?cjsInfos[t]?.resolveCache[e]??void 0:void 0}_tryModuleLoad(e,t){let i=!0;try{this._load(e,t),i=!1}finally{i&&delete this._moduleCache[t]}}_load(e,t){const{factory:i,resolveMap:n}=this._loadWrapper(t),a=this._createRequire(e),s=n?this._createRequireWithResolveMap("function"==typeof n?n():n,a):a;i(e.exports,s,e)}_loadWrapper(e){return e in this._registry?this._registry[e]:this._loadHostProvidedModules(e)}_loadHostProvidedModules(e){return{factory:(t,i,n)=>{if("undefined"==typeof require)throw new Error(`Current environment does not provide a require() for requiring '${e}'.`);try{n.exports=require(e)}catch(t){throw new Error(`Exception thrown when calling host defined require('${e}').`,{cause:t})}}}}_createRequire(e){return t=>this._require(t,e)}_createRequireWithResolveMap(e,t){return i=>{const n=e[i];if(n)return t(n);throw new Error("Unresolved specifier "+i)}}_throwUnresolved(e,t){throw new Error(`Unable to resolve ${e} from ${parent}.`)}};let XH;const $H="file:///D:/VSCode%20Project/tile-connect-remaster-game/node_modules/resize-observer-polyfill/dist/ResizeObserver.js";jH.define($H,(function(e,t,i,n,a){!function(t,n){"object"==typeof e&&void 0!==i?i.exports=n():"function"==typeof define&&define.amd?define(n):t.ResizeObserver=n()}(this,(function(){var e=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var i=-1;return e.some((function(e,n){return e[0]===t&&(i=n,!0)})),i}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var i=e(this.__entries__,t),n=this.__entries__[i];return n&&n[1]},t.prototype.set=function(t,i){var n=e(this.__entries__,t);~n?this.__entries__[n][1]=i:this.__entries__.push([t,i])},t.prototype.delete=function(t){var i=this.__entries__,n=e(i,t);~n&&i.splice(n,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var i=0,n=this.__entries__;i<n.length;i++){var a=n[i];e.call(t,a[1],a[0])}},t}()}(),t="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,i="undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),n="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(i):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var a=["top","right","bottom","left","width","height","size","weight"],s="undefined"!=typeof MutationObserver,o=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var i=!1,a=!1,s=0;function o(){i&&(i=!1,e()),a&&l()}function r(){n(o)}function l(){var e=Date.now();if(i){if(e-s<2)return;a=!0}else i=!0,a=!1,setTimeout(r,t);s=e}return l}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,i=t.indexOf(e);~i&&t.splice(i,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){t&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),s?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){t&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,i=void 0===t?"":t;a.some((function(e){return!!~i.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),r=function(e,t){for(var i=0,n=Object.keys(t);i<n.length;i++){var a=n[i];Object.defineProperty(e,a,{value:t[a],enumerable:!1,writable:!1,configurable:!0})}return e},l=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||i},c=g(0,0,0,0);function h(e){return parseFloat(e)||0}function d(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduce((function(t,i){return t+h(e["border-"+i+"-width"])}),0)}function u(e){var t=e.clientWidth,i=e.clientHeight;if(!t&&!i)return c;var n=l(e).getComputedStyle(e),a=function(e){for(var t={},i=0,n=["top","right","bottom","left"];i<n.length;i++){var a=n[i],s=e["padding-"+a];t[a]=h(s)}return t}(n),s=a.left+a.right,o=a.top+a.bottom,r=h(n.width),u=h(n.height);if("border-box"===n.boxSizing&&(Math.round(r+s)!==t&&(r-=d(n,"left","right")+s),Math.round(u+o)!==i&&(u-=d(n,"top","bottom")+o)),!function(e){return e===l(e).document.documentElement}(e)){var p=Math.round(r+s)-t,m=Math.round(u+o)-i;1!==Math.abs(p)&&(r-=p),1!==Math.abs(m)&&(u-=m)}return g(a.left,a.top,r,u)}var p="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof l(e).SVGGraphicsElement}:function(e){return e instanceof l(e).SVGElement&&"function"==typeof e.getBBox};function m(e){return t?p(e)?function(e){var t=e.getBBox();return g(0,0,t.width,t.height)}(e):u(e):c}function g(e,t,i,n){return{x:e,y:t,width:i,height:n}}var y=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=g(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=m(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),b=function(e,t){var i,n,a,s,o,l,c,h=(n=(i=t).x,a=i.y,s=i.width,o=i.height,l="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,c=Object.create(l.prototype),r(c,{x:n,y:a,width:s,height:o,top:a,right:n+s,bottom:o+a,left:n}),c);r(this,{target:e,contentRect:h})},f=function(){function t(t,i,n){if(this.activeObservations_=[],this.observations_=new e,"function"!=typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=i,this.callbackCtx_=n}return t.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new y(e)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof l(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new b(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),w="undefined"!=typeof WeakMap?new WeakMap:new e,S=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=o.getInstance(),n=new f(t,i,this);w.set(this,n)};return["observe","unobserve","disconnect"].forEach((function(e){S.prototype[e]=function(){var t;return(t=w.get(this))[e].apply(t,arguments)}})),void 0!==i.ResizeObserver?i.ResizeObserver:S})),XH=i.exports}),{}),jH.require($H),i._RF.push({},"9f0a0l1uXlNwqKEKardFRyv","LayoutManager",void 0);const{Layout:QH,DesignSize:JH}=ia,{Portrait:ZH,Landscape:eV}=JH,{Utils:{Function:tV}}=GameCore;class iV{constructor(){this.currentLayout="",this.handleViewResizeBySystem=e=>{console.info(" View resize by system"),window.devicePixelRatio=e||window.devicePixelRatio,this.setupOrientationByScreenSize(),this.resizeGameView()},this.handleViewResize=tV.debounce((()=>{console.info(" View resize by window"),this.setupOrientationByScreenSize(),this.resizeGameView()}),200),this.handleBodyResize=tV.debounce((()=>{this.resizeGameDiv()&&(console.info(" View resize by body"),this.setupOrientationByScreenSize(),this.resizeGameView())}),200)}init(){this.listenResizeEvent(),this.listenObserverEvent(),this.setupResolutionPolicy(),W.emit(Yn),console.info("Layout Manager: Initialized")}listenResizeEvent(){Y.isBrowser?(B.on("window-resize",this.handleViewResize,this),B.on("orientation-change",this.handleViewResize,this)):Y.isMobile?window.addEventListener("resize",this.handleViewResize,{capture:!1,passive:!0}):console.warn("LayoutManager: Not support this platform"),W.on(Yn,this.handleViewResizeBySystem)}listenObserverEvent(){new XH(this.handleBodyResize).observe(document.body)}setupResolutionPolicy(){le.instance.resizeWithBrowserSize(!0),le.instance.setOrientation(ye.ORIENTATION_AUTO),le.instance.setResolutionPolicy(be.ContentStrategy.FIXED_WIDTH),le.instance.setResolutionPolicy(be.ContainerStrategy.EQUAL_TO_FRAME),this.resolutionPolicy=le.instance.getResolutionPolicy()}setupOrientationByScreenSize(){const e=this.getScreenRatio();this.resolutionPolicy.setContentStrategy(be.ContentStrategy.FIXED_WIDTH),e<1?this.setPortraitView():this.setLandscapeView()}resizeGameDiv(){const e=document.getElementById("GameDiv");if(!e)return!1;const t=Xi.getScreenWidthCss(),i=Xi.getScreenHeightCss(),{width:n,height:a}=e.getBoundingClientRect();return(t!==n||i!==a)&&(e.style.width=`${t}px`,e.style.height=`${i}px`,!0)}resizeGameView(){let e=Xi.getScreenWidthCss(),t=Xi.getScreenHeightCss();W.emit(Wn,{width:e,height:t})}setPortraitView(){let{WIDTH:e,HEIGHT:t}=ZH;ia.FORCE_LAYOUT===QH.Landscape&&(e=eV.WIDTH,t=eV.HEIGHT,this.resolutionPolicy.setContentStrategy(be.ContentStrategy.SHOW_ALL)),this.currentLayout=QH.Portrait,this.changeDesignResolutionSize(e,t)}setLandscapeView(){let{WIDTH:e,HEIGHT:t}=eV;ia.FORCE_LAYOUT===QH.Portrait&&(e=ZH.WIDTH,t=ZH.HEIGHT,this.resolutionPolicy.setContentStrategy(be.ContentStrategy.EXACT_FIT)),this.currentLayout=QH.Landscape,this.changeDesignResolutionSize(e,t)}changeDesignResolutionSize(e,t){le.instance.setDesignResolutionSize(e,t,this.resolutionPolicy),W.emit(jn,this.currentLayout),console.info(" Change layout to",this.currentLayout)}getScreenRatio(){return Xi.getScreenWidthCss()/Xi.getScreenHeightCss()}}i._RF.pop(),i._RF.push({},"535cbXcmXdEzLn3H3LOIS27","MatchManager",void 0);const{Utils:{Valid:nV,Object:aV,Array:sV},Dtos:{Match:{CustomData:oV,Data:rV}}}=GameCore,lV=["code","cols","encoding","idSize","rows"],cV=["addRandomTilesPerMove","maxSpaceOfPair"];class hV{init(){console.info("Match Manager: Initialized")}setupDefaultMatchData(){this.setupMatchData(),this.setupMatchCustomData()}setupMatchCustomData(){oV.addDefaultData(Mr),oV.addValidateFunction("score",(e=>{if(!nV.isNumber(e)||e<0)throw new Error(`score ${e} is invalid`)}))}setupMatchData(){rV.addDefaultData(Ar),rV.addValidateFunction("extraData",(e=>{if(null==e)return;if(!nV.isObject(e))throw new Error(`extraData ${e} must be a record of string keys`);const t=e,i=Object.keys(t);if(!sV.has(i,"level"))throw new Error("extraData.level is missing");if(!nV.isNumber(t.level))throw new Error(`extraData.level ${t.level} must be a number`);if(!sV.has(i,"fen"))throw new Error("extraData.fen is missing");if(this.validateFen(t.fen),!sV.has(i,"gravity"))throw new Error("extraData.gravity is missing");if(!nV.isString(t.gravity))throw new Error(`extraData.gravity ${t.gravity} must be a string`);if(!sV.has(i,"rules"))throw new Error("extraData.rules is missing");if(this.validateLevelRules(t.rules),!sV.has(i,"time"))throw new Error("extraData.time is missing");if(!nV.isNumber(t.time))throw new Error(`extraData.time ${t.time} must be a number`)}))}validateFen(e){if(!nV.isObject(e))throw new Error(`extraData.fen ${e} must be a record of string keys`);const t=this.validateKeys(e,lV);if(!nV.isNumber(t.idSize))throw new Error("fen.idSize must be a number");if(!nV.isString(t.code))throw new Error("fen.code must be a string");if(!nV.isNumber(t.rows))throw new Error("fen.rows must be a number");if(!nV.isNumber(t.cols))throw new Error("fen.cols must be a number");if(!nV.isObject(t.encoding))throw new Error("fen.encoding must be a record of string keys");const i=this.validateKeys(t.encoding,aV.vals(uc));Object.entries(i).forEach((e=>{let[t,i]=e;if(!nV.isString(i))throw new Error(`fen.encoding.${t} ${i} must be a string`)}))}validateLevelRules(e){if(!nV.isObject(e))throw new Error(`extraData.rules ${e} must be a record of string keys`);const t=this.validateKeys(e,cV);if(!nV.isNumber(t.addRandomTilesPerMove))throw new Error("rules.addRandomTilesPerMove must be a number");if(!nV.isNumber(t.maxSpaceOfPair))throw new Error("rules.maxSpaceOfPair must be a number")}validateKeys(e,t){return Object.keys(e).forEach((e=>{if(!t.indexOf(e))throw new Error(`Key ${e} is missing`)})),e}}i._RF.pop(),i._RF.push({},"d675ctpYslBHp4qqiYEki+q","PlayerManager",void 0);const{Utils:{Valid:dV,Array:uV,Object:pV},Dtos:mV}=GameCore,{player:gV}=globalThis.game;class yV{init(){console.info("Player Manager: Initialized")}setupDefaultGameData(){const{Player:e}=mV;e.Data.addDefaultData(kr),e.GameData.addDefaultData(Pr),e.GameData.addValidateFunction("stars",(e=>{if(!dV.isNumber(e)||e<0)throw new Error(`stars ${e} is invalid`)})),e.GameData.addValidateFunction("totalLevel",(e=>{if(!dV.isNumber(e)||e<1)throw new Error(`totalLevel ${e} is invalid`)})),e.GameData.addValidateFunction("levelVersion",(e=>{if(!dV.isNumber(e)||e<0)throw new Error(`levelVersion ${e} is invalid`)})),e.GameData.addValidateFunction("lastRewardedItems",(e=>{if(!dV.isNumber(e)||e<0)throw new Error(`lastRewardedItems ${e} is invalid`)})),e.GameData.addValidateFunction("lastCreateTournamentShown",(e=>{if(!dV.isNumber(e)||e<0)throw new Error(`lastCreateTournamentShown ${e} is invalid`)})),e.GameData.addValidateFunction("guideItemShowed",(e=>{if(!Array.isArray(e))throw new Error(`guideItemShowed ${e} is invalid`)})),e.GameData.addValidateFunction("items",(e=>{if(!dV.isObject(e))throw new Error(`items ${e} is invalid`);const t=Object.keys(e),i=pV.vals(e);if(!uV.has(t,yr.HINT))throw new Error(`item ${yr.HINT} not found`);if(!uV.has(t,yr.THUNDER))throw new Error(`item ${yr.THUNDER} not found`);if(!uV.has(t,yr.STORM))throw new Error(`item ${yr.STORM} not found`);if(!uV.has(t,yr.PLIERS))throw new Error(`item ${yr.PLIERS} not found`);i.forEach((e=>{if(!dV.isNumber(e)||e<0)throw new Error(`item ${e} is invalid`)}))})),e.GameData.addValidateFunction("skins",(e=>{if(!dV.isObject(e))throw new Error(`skins ${e} is invalid`)}))}requestConnectedPlayers(){gV.requestConnectedPlayers().catch((e=>{console.warn("player.requestConnectedPlayers",e)}))}}i._RF.pop(),i._RF.push({},"51079bCfn9MZK6cuxbahS7M","AdaptivePerformance",void 0);const{Events:bV,Utils:{Valid:fV}}=GameCore,{event:wV,adaptivePerformance:SV}=globalThis.game;class vV{constructor(){this.handleBeginFrame=()=>{m.on(J.EVENT_AFTER_UPDATE,this.lateUpdate),m.on(J.EVENT_BEFORE_UPDATE,this.updateActualFPS)},this.handleAfterSceneLaunch=e=>{SV&&SV.trackingScene(e.name)},this.handleRequestResizeGame=e=>{const{forcePixelRatio:t}=e;fV.isNumber(t)&&W.emit(Yn,t)},this.lateUpdate=()=>{const e=1e3*W.deltaTime;SV?.updatePostStepDeltaTime(e)},this.updateActualFPS=()=>{const e=m.root?.fps;fV.isNumber(e)&&SV?.updateActualFPS(e)}}init(){SV&&this.listenEvents()}listenEvents(){wV.on(bV.REQUEST_RESIZE_GAME,this.handleRequestResizeGame),m.once(J.EVENT_BEGIN_FRAME,this.handleBeginFrame),m.on(J.EVENT_AFTER_SCENE_LAUNCH,this.handleAfterSceneLaunch)}}i._RF.pop(),i._RF.push({},"0bbd4wf2fRDcKljBcls6K8a","CanvasRecorder",void 0);const{canvasRecorder:EV}=globalThis.game;class CV{init(){if(!W.canvas||!EV)return;EV.setCanvas(W.canvas);const e=EV.getOptions(),t=EV.waitNextFrame;EV.waitNextFrame=async()=>e.syncFps?new Promise((e=>{m.once(J.EVENT_AFTER_RENDER,e),W.pause(),W.step()})):(W.resume(),await t.call(EV),Promise.resolve())}}i._RF.pop(),i._RF.push({},"4a29byVcRpBGogGcAwYASiP","CocosStats",void 0);class TV{constructor(){this.hideCocosStats=()=>{clearInterval(this.waiter),this.waiter=setInterval(this.checkProfilerReady,100)},this.checkProfilerReady=()=>{if(!K)return;K._showFPS=!1;const{_rootNode:e}=K;e&&(e.active=!1,e.isValid&&(e.destroyAllChildren(),e.removeAllChildren(),e.destroy(),clearInterval(this.waiter)))}}init(){K&&m.on(J.EVENT_BEFORE_SCENE_LAUNCH,this.hideCocosStats)}}i._RF.pop(),i._RF.push({},"49a72YoKFFCKbOm5Xgp9R+k","DynamicAssets",void 0);const{Configs:{GameEngine:{DynamicAssets:AV}},Events:RV,Utils:{Array:IV}}=GameCore,{event:PV}=globalThis.game,_V=[".png",".jpg",".jpeg",".webp"];class LV{constructor(){this.useHighQuality=!1,this.upgradableAssets=new Map,this.requestUpdateDynamicAssets=()=>{W.emit(ta)},this.collectUpgradableAssets=e=>{const t=e.output=e.input;for(const e of t)if(IV.has(_V,e.ext)&&!this.upgradableAssets.has(e.uuid)){this.useHighQuality&&(e.url=this.replaceAssetUrl(e.url),e.requestUpgrade=!0);const t={uuid:e.uuid,url:e.url,options:e.options,upgraded:e.upgraded,requestUpgrade:e.requestUpgrade,ext:e.ext};this.upgradableAssets.set(e.uuid,t)}},this.replaceAssetUrl=e=>this.useHighQuality?e.replace("native/","native32/"):e,this.handleUpgradeQuality=()=>{this.useHighQuality=!0;let e=0,t=0;const{assets:i,loadAny:n}=me.instance;let a=0;this.upgradableAssets.forEach((s=>{if(s.upgraded||s.requestUpgrade)return void e++;t++;const o=i.get(s.uuid);o instanceof O?(s.url=this.replaceAssetUrl(s.url),console.info("DynamicAssets: Process upgrade quality",s.uuid,s,o),n(s,s.options,((e,i)=>{a++,e?console.warn("DynamicAssets: Upgrade error",e):(o.reset(i),s.upgraded=!0,this.upgradableAssets.set(s.uuid,s),console.info("DynamicAssets: Upgrade done",s.uuid,i,o),a>=t&&this.requestUpdateDynamicAssets())}))):console.warn("DynamicAssets: Asset not found",s.uuid)})),console.warn("DynamicAssets: Upgradable Assets Info",{needUpgrade:t,upgraded:e,total:this.upgradableAssets.size})}}init(){const{Enabled:e}=AV;console.info("DynamicAssets: init",{EDITOR:false,Enabled:e}),e&&(me.instance.transformPipeline.insert(this.collectUpgradableAssets,3),this.listenEvents())}listenEvents(){W.on(ea,this.handleUpgradeQuality),PV.on(RV.SCENE_LAUNCHED,(e=>{const t=e.sceneName,i=[xr];IV.has(i,t)||this.handleUpgradeQuality()}))}}i._RF.pop(),i._RF.push({},"15ecbqnx5lFtYRSJp2lOLCm","DynamicAtlas",void 0);const{Configs:{GameEngine:{DynamicAtlas:DV}},Utils:{Array:OV},Events:NV}=GameCore,{event:MV}=globalThis.game;class kV{constructor(){this.drawInfo=[],this.atlasInfo=null,this.lastRenderTime=0,this.updateRenderTime=()=>{this.lastRenderTime=performance.now()},this.checkRenderTimeHighers=()=>{const e=performance.now()-this.lastRenderTime;e>8&&(m.off(J.EVENT_AFTER_RENDER,this.checkRenderTimeHighers),console.warn(`DynamicAtlas: Laggy frame detected, render time is ${e.toFixed(2)}ms`),this.requestUpdateDynamicAtlas(),setTimeout((()=>{m.on(J.EVENT_AFTER_RENDER,this.checkRenderTimeHighers)}),2e3))},this.requestUpdateDynamicAtlas=()=>{m.once(J.EVENT_AFTER_RENDER,this.updateDynamicAtlas)},this.updateDynamicAtlas=()=>{const e=m.getScene();if(!e)return;const t=e.getComponentsInChildren(fe),i=[],n={};t.forEach((e=>{if(!e.enabled)return;if(!e.node.activeInHierarchy)return;if(!("spriteFrame"in e))return;if(!(e.spriteFrame instanceof N))return;const{uuid:t,packable:a,texture:s,original:o}=e.spriteFrame;if(!a)return void console.warn("DynamicAtlas: Skip non-packable texture",e.name);if(!(s instanceof we))return void console.warn("DynamicAtlas: Skip non-texture2d texture",e.name);let r=s.getId();const{width:l,height:c}=s,{width:h,height:d}=o?._texture||{width:0,height:0};if(o){const t=o._texture.getId();if(r===t)return void console.warn("DynamicAtlas: Skip original texture",e.name,{ori:o._texture,tex:s});r=t}let u=o?h:l,p=o?d:c;if(u<=1||p<=1)return void console.warn("DynamicAtlas: Skip invalid texture size",e.name,{w:u,h:p});u+=2,p+=2;const m={id:r,w:u,h:p,x:-1,y:-1};n[r]?n[r].components.push(e):(i.push(m),n[r]={...m,name:t,components:[e]})})),console.info("DynamicAtlas: collect info",n),i.length<1||(console.info("DynamicAtlas: process textures",i),this.drawInfo=[],this.atlasInfo=null,this.generateDrawInfo(i),this.atlasInfo?(this.updateAtlasData(),this.refreshComponents(t)):console.warn("DynamicAtlas: Atlas info not found",{textures:i}))},this.generateDrawInfo=e=>{if(e.length<1)return;console.info("DynamicAtlas: generate draw info",e);const{textureSize:t}=ge.instance;if(this.calculateOptimizedAtlas(e,t),!this.atlasInfo)return void console.warn("DynamicAtlas: Atlas info not found",{textures:e});const{textures:i}=this.atlasInfo;if(i.forEach((e=>{this.drawInfo.push(e)})),e.length>i.length){const t=e.filter((e=>!i.some((t=>t.id===e.id))));console.warn("DynamicAtlas: Missing textures",t),this.generateDrawInfo(t)}},this.calculateOptimizedAtlas=(e,t)=>{const{w:i,h:n,fill:a}=function(e){let t=0,i=0;for(const n of e)t+=n.w*n.h,i=Math.max(i,n.w);e.sort(((e,t)=>t.h-e.h));const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let a=0,s=0;for(const t of e)for(let e=n.length-1;e>=0;e--){const i=n[e];if(!(t.w>i.w||t.h>i.h)){if(t.x=i.x,t.y=i.y,s=Math.max(s,t.y+t.h),a=Math.max(a,t.x+t.w),t.w===i.w&&t.h===i.h){const t=n.pop();e<n.length&&(n[e]=t)}else t.h===i.h?(i.x+=t.w,i.w-=t.w):t.w===i.w?(i.y+=t.h,i.h-=t.h):(n.push({x:i.x+t.w,y:i.y,w:i.w-t.w,h:t.h}),i.y+=t.h,i.h-=t.h);break}}return{w:a,h:s,fill:t/(a*s)||0}}(e);if(i>t||n>t){e.pop()?this.calculateOptimizedAtlas(e,t):console.warn("DynamicAtlas: Texture size is too big",i,n,t)}else this.atlasInfo={textures:e,atlasSize:t,packedInfo:{width:i,height:n,fillRate:a}}},this.drawTexture=(e,t,i)=>{const n=t.texture,a=n.getId(),s=OV.search([...this.drawInfo],(e=>e.id===a)),{x:o,y:r}=s||{x:-1,y:-1};if(o<0||r<0)return;const l=e._innerTextureInfos[a];l||(i&&(e._texture.drawTextureAt(n.image,o-1,r),e._texture.drawTextureAt(n.image,o+1,r),e._texture.drawTextureAt(n.image,o,r-1),e._texture.drawTextureAt(n.image,o,r+1)),e._texture.drawTextureAt(n.image,o,r),e._count++,e._innerTextureInfos[a]={texture:n,x:o,y:r});let{x:c,y:h}=t.rect;c+=l?.x||o,h+=l?.y||r;const d={texture:e._texture,x:c,y:h};return e._innerSpriteFrames.push(t),d},this.refreshComponents=e=>{e.forEach((e=>{e.node.active&&(e.node.active=!1,e.node.active=!0)}))}}init(){const{TextureAtlasOptimize:e}=DV;e&&(console.info("DynamicAtlas: init",{TextureAtlasOptimize:e}),this.listenEvents(),this.overrideDynamicAtlas())}listenEvents(){MV.on(NV.SCENE_LAUNCHED,this.requestUpdateDynamicAtlas),W.on(ta,this.requestUpdateDynamicAtlas),m.on(J.EVENT_BEFORE_RENDER,this.updateRenderTime),m.on(J.EVENT_AFTER_RENDER,this.checkRenderTimeHighers)}overrideDynamicAtlas(){const{instance:e}=ge;ge.instance.insertSpriteFrame=t=>{if(e._atlasIndex>=e._maxAtlasCount)return null;if(!t||t.original)return null;if(!t.packable)return null;let i=this.getAtlas();const n=i?i.insertSpriteFrame(t):null;return!n&&e._atlasIndex<e._maxAtlasCount?(i=this.getAtlas(),i?i.insertSpriteFrame(t):null):n}}createAtlas(){const{instance:e}=ge;return e.newAtlas()}getAtlas(){const{_atlases:e=[],_atlasIndex:t,textureBleeding:i}=ge.instance;let n=e[t];return n||(n=this.createAtlas()),n.originalInsertSpriteFrame||(n.originalInsertSpriteFrame=n.insertSpriteFrame,n.insertSpriteFrame=e=>this.drawTexture(n,e,i)),n}updateAtlasData(){if(!this.atlasInfo)return;console.info("DynamicAtlas: atlas info",this.atlasInfo);const{packedInfo:e}=this.atlasInfo;ge.instance.reset();const t=this.getAtlas();if(t){const{width:i,height:n}=e,a=Math.max(i,n);t._texture.initWithSize(a,a),console.info("DynamicAtlas: Resize texture",a,t._texture)}}}i._RF.pop();var xV={text:{level:"Level",settings:"SETTINGS",music:"Music",sound:"Sound",vibrate:"Vibrate",resume:"CONTINUE",on:"ON",off:"OFF",notification:"Notification",adsNotComplete:"Sorry, No Rewards!\nYou have cancelled the ad!",loadingAds:"Loading ads...",loading:"Loading...",load:"Loading",rewardNotReady:"No ads to display!",next:"NEXT",completed:"COMPLETED",tryAgain:"TRY AGAIN",retry:"RETRY",congratulation:"CONGRATULATION",you_have_pass_all_levels:"You have passed all levels.",please_come_back_later:"Please come back later,\nwe will update soon!",start_over:"START OVER",confirmation:"CONFIRMATION",are_you_sure_to_start_over:"ARE YOU SURE TO START OVER?",you_will_play_the_game_again:"You will play the game again\nfrom the beginning, at level 1.",no:"NO",yes:"YES"},texture:{image:"image"}};i._RF.push({},"14b76Yew19JgY7K+L9F5mmu","Languages",void 0);const{Events:FV}=GameCore,{event:BV,language:zV}=globalThis.game;class UV{constructor(){this.handleLanguageChanged=async e=>{const{locale:t}=e;W.emit("update-language",t),this.updateComponentInEditor()}}init(){this.addLanguage("en").then((()=>{this.setLanguage("en"),this.listenEvent()}))}listenEvent(){BV.on(FV.LANGUAGE_CHANGED,this.handleLanguageChanged)}async addLanguage(e){const t=await this.getLangData(e);zV.add(e,t)}setLanguage(e){zV.choose(e)}async getLangData(e){switch(e){case"en":return xV;case"ru":return this.loadLanguageAsync(e);default:throw new Error(`Language ${e} not supported`)}}async loadLanguageAsync(e){const i=(await t.import(`db://assets/resources/locales/${e}.json`)).default;zV.add(e,i)}updateComponentInEditor(){}}i._RF.pop(),i._RF.push({},"fb33bK/6Y5FAas5AwmmBM/X","Leaderboards",void 0);const{Configs:{Mockup:{Leaderboards:GV,GameSDK:{Player:HV}},Leaderboards:VV},Utils:{Number:qV}}=GameCore,{leaderboard:WV}=globalThis.game;class KV{constructor(){this.handleWhenGameSDKStarted=()=>{GV.Enabled?this.setupLeaderboardsMockup():this.setupLeaderboards()}}init(){this.handleWhenGameSDKStarted()}async setupLeaderboards(){this.setupLeaderboardByConfigs()}setupLeaderboardByConfigs(){const{LeaderboardId:e}=VV;e?(WV.addLeaderboard({name:_r,type:"global",autoSortRank:!0,leaderboardId:e}),WV.addLeaderboard({name:Lr,type:"friends",autoSortRank:!0,leaderboardId:e})):console.warn("LeaderboardId in Configs is not set")}async setupLeaderboardsMockup(){this.setupMockGlobalLeaderboard(),this.setupMockFriendsLeaderboard(),this.setupMockGlobalTournamentLeaderboard()}async setupMockGlobalLeaderboard(){const e=_r,t=Dr,i=await WV.createLeaderboardAsync({_id:t,name:e,numberOfLeaders:100});WV.addLeaderboard({name:e,type:"global",autoSortRank:!0,leaderboardId:i}),await WV.requestLeaderboardAsync(e,10);let n=WV.getLeaderboard(e);console.info("setupGlobalLeaderboard fetch new",n,n&&Object.keys(n.leaders).length),n=WV.getLeaderboard(e),console.info("setupGlobalLeaderboard load more",n,n&&Object.keys(n.leaders).length)}async setupMockFriendsLeaderboard(){const e=Lr,t=Or;let i=0;const{ConnectedPlayers:n}=HV;n.Enabled&&(i=qV.random(n.NumOfPlayers));const a=await WV.createLeaderboardAsync({_id:t,name:e,numberOfLeaders:i});WV.addLeaderboard({name:e,type:"friends",autoSortRank:!0,leaderboardId:a}),await WV.requestLeaderboardAsync(e,10);const s=WV.getLeaderboard(e);console.info("setupFriendsLeaderboard done",s)}async setupMockGlobalTournamentLeaderboard(){const e=await Ql.requestTournamentDataAsync();e.forEach((e=>{const{payload:t}=e,{leaderboardId:i}=t;i&&(WV.isExistLeaderboardId(i)||WV.addLeaderboard({type:"tournament",name:i,autoSortRank:!0,leaderboardId:i}))})),console.info("setupGlobalTournamentLeaderboard done",e)}}i._RF.pop(),i._RF.push({},"e7bf73g4jJGuI9FqvW5YBsS","PerformanceMonitor",void 0);const{Configs:{PerformanceMonitor:YV},Utils:jV,Events:XV}=GameCore,{event:$V}=globalThis.game;class QV{constructor(){this.markName="FPS Tracking",this.handleStartTraceFps=()=>{this.startTraceFps()},this.handleLateUpdate=()=>{if(this.mark){if(this.fpsTraceDuration-=W.deltaTime,this.fpsTraceDuration<=0&&!this.traceStopped)return this.traceStopped=!0,this.unListenEvents(),this.updateFPS(),void this.mark.stop(this.markName);this.fpsTraceIntervalTimer-=W.deltaTime,this.fpsTraceIntervalTimer>0||(this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.updateFPS(),this.mark.stop(this.markName),this.startTraceFps())}}}get mark(){return YV.FpsTracking?jV.Mark:null}init(){const{TrackingDuration:e,TrackingInterval:t}=YV.FpsTracking;this.fpsTraceDuration=e??60,this.fpsTraceInterval=t??10,this.fpsTraceIntervalTimer=this.fpsTraceInterval,this.traceStopped=!1,this.listenEvents()}listenEvents(){$V.once(XV.GAME_READY,this.handleStartTraceFps),m.on(J.EVENT_AFTER_UPDATE,this.handleLateUpdate)}unListenEvents(){m.off(J.EVENT_AFTER_UPDATE,this.handleLateUpdate)}startTraceFps(){this.mark&&(this.mark.measure(this.markName),this.mark.start(this.markName))}updateFPS(){if(!this.mark)return;const e=this.getFPS(),t=this.getDrawCalls(),i=this.getDeviceRender(),n=this.getTextureMemory();this.minFps=Math.min(this.minFps??e,e),this.maxFps=Math.max(this.maxFps??0,e),this.mark.putMetric(this.markName,"FPS Metric",e),this.mark.putAttr(this.markName,"Page Title",document.title),this.mark.putAttr(this.markName,"Device Render",i),this.mark.putAttr(this.markName,"Draw Calls",t.toString()),this.mark.putAttr(this.markName,"Texture Memory",n.toFixed(2)),this.mark.putAttr(this.markName,"Min FPS",this.minFps.toString()),this.mark.putAttr(this.markName,"Max FPS",this.maxFps.toString()),console.info(`FPS: ${e} Min: ${this.minFps} Max: ${this.maxFps}, draw calls: ${t}, texture memory: ${n.toFixed(2)}MB`)}getFPS(){if(!m.root)return 0;const{fps:e}=m.root;return Math.floor(e)||0}getDrawCalls(){if(!m.root)return 0;const{numDrawCalls:e}=m.root.device;return e||0}getDeviceRender(){if(!m.root)return"Unknown";const{renderer:e}=m.root.device;return e||"Unknown"}getTextureMemory(){if(!m.root)return 0;const{memoryStatus:e}=m.root.device;return e.textureSize/1048576||0}}i._RF.pop(),i._RF.push({},"58248LBip1DBrMjK0UWw2rM","RemoteConfig",void 0);const{Events:JV}=GameCore,{event:ZV}=globalThis.game;class eq{constructor(){this.handleHotReload=()=>{W.restart()},this.handleUpdateConfig=e=>{if("Gameplay"!==e.type)return;W.emit(Xn,e.config);const{id:t,type:i}=e;ZV.emit(JV.REMOTE_CONFIG_UPDATED,{id:t,type:i})}}init(){this.listenEvents()}listenEvents(){ZV.on(JV.REQUEST_HOT_RELOAD,this.handleHotReload),ZV.on(JV.REQUEST_UPDATE_CONFIG,this.handleUpdateConfig)}}i._RF.pop(),i._RF.push({},"c34a93D1BREiKms1T21AkQS","PluginsManager",void 0);class tq{init(){console.info("Plugins Manager: Initialized"),this.initCocosStats(),this.initDynamicAtlas()}initLanguages(){(new UV).init()}initCocosStats(){(new TV).init()}initLeaderboards(){(new KV).init()}initRemoteConfig(){(new eq).init()}initDynamicAtlas(){(new kV).init()}initDynamicAssets(){(new LV).init()}initCanvasRecorder(){(new CV).init()}initPerformanceMonitor(){(new QV).init()}initAdaptivePerformance(){(new vV).init()}}i._RF.pop(),i._RF.push({},"ac8b03T+rFB061sXoEEsCUH","SceneManager",void 0);const{event:iq,monitorError:nq}=globalThis.game,{Events:aq,Configs:{PerformanceMonitor:sq},Utils:{Mark:oq}}=GameCore;class rq{constructor(){this.markName="Load Scene",this.queueLoadScene={},this.callbackSwitchScene=null,this.switchScene=async e=>{const{sceneName:t,sceneData:i}=e,n=this.correctSceneName(t);console.info("Switching",n,i??{}),n&&(ql.showLoadingFullScreen(n),this.startScene({sceneName:n,sceneData:i}))},this.preloadScene=(e,t)=>{const{sceneName:i}=e;this.startMeasure(i),m.preloadScene(i,this.onSceneProgress,this.onScenePreloaded(i,t))},this.startMeasure=e=>{this.mark&&(this.queueLoadScene[e]&&(this.mark.putAttr(this.markName,"Canceled","true"),this.stopMeasure(e)),console.groupCollapsed(" Load scene progress"),this.mark.measure(this.markName),this.mark.putAttr(this.markName,"Cancel","false"),this.mark.putAttr(this.markName,"Success","false"),this.mark.putMetric(this.markName,e),this.mark.start(this.markName),this.queueLoadScene[e]=!0)},this.stopMeasure=e=>{this.mark&&this.queueLoadScene[e]&&(this.mark.rmAttr(this.markName,"File"),this.mark.putAttr(this.markName,"Success","true"),this.mark.stop(this.markName),this.queueLoadScene[e]=!1,console.groupEnd())},this.onSceneProgress=(e,t,i)=>{const n=e/t;this.mark&&this.mark.putAttr(this.markName,"Last File",`${i.id} (${i.ext})`);const a=Math.floor(70*n+30);GameSDK.setLoadingProgress(a)},this.onScenePreloaded=(e,t)=>i=>{i?console.warn("SceneManager.onScenePreloaded",{sceneName:e,error:i}):(t&&t(e,i),iq.emit(aq.SCENE_LOADED,{sceneName:e,isPreload:!0}))},this.onDirectorLoadScene=e=>(t,i)=>{if(t)return void console.warn("SceneManager.onSceneLoaded",t);if(!i?.scene)return void console.warn("SceneManager.onSceneLoaded","Scene not found");const n=i.name;this.handleBeforeSceneLaunch(i,e)(),m.once(J.EVENT_AFTER_SCENE_LAUNCH,this.handleSceneLaunched(n,e))},this.handleBeforeSceneLaunch=(e,t)=>()=>{this.setSceneData(e,t??{}),W.emit(Yn),iq.emit(aq.SCENE_LOADED,{sceneName:e.name})},this.handleSceneLaunched=(e,t)=>()=>{ql.hideLoadingFullScreen(e),Yi.switchSceneTracking(),nq?.addMetadata({currentScene:e}),this.callbackSwitchScene?.({sceneName:e,sceneData:t}),iq.emit(aq.SCENE_LAUNCHED,{sceneName:e})},this.handleSceneLoaded=e=>{const{sceneName:t}=e;this.stopMeasure(t)}}init(){this.listenEvents(),console.info("Scene Manager: Initialized")}listenEvents(){iq.on(aq.SWITCH_SCENE,this.switchScene),iq.on(aq.PRELOAD_SCENE,this.preloadScene),iq.on(aq.SCENE_LOADED,this.handleSceneLoaded)}correctSceneName(e){const t=this.getCurrentScene();return t&&e===t.name?null:e}startScene(e){const{sceneName:t,sceneData:i}=e;this.preloadScene({sceneName:t},((e,n)=>{e===t&&(n?console.warn("SceneManager.startScene",{sceneName:t,error:n}):m.loadScene(t,this.onDirectorLoadScene(i)))}))}get mark(){return sq.LoadResources?oq:null}getCurrentScene(){return m.getScene()}getLoadedScenes(){const e=[];return Object.keys(this.queueLoadScene).map((t=>{this.queueLoadScene[t]||e.push(t)})),e}onSwitchScene(e){this.callbackSwitchScene=e}setSceneData(e,t){if(!t)return;if("data"in e||e.scene.attr({data:{}}),!("data"in e))return;const i=e.data||{};e.scene.attr({data:{...i,...t}}),console.info("SceneManager.setSceneData",{sceneName:e.name,sceneData:t,currentData:i})}}i._RF.pop(),i._RF.push({},"617b2SRAL5CyL75C998xBnx","ScreenManager",void 0);const{event:lq,monitorError:cq}=globalThis.game,{Events:hq,Utils:{Object:dq}}=GameCore;class uq{constructor(){this.screens={},this.handleOpenScreen=e=>{const{screenName:t,screenData:i}=e;this.openScreen(t,i)},this.handleCloseScreen=e=>{const{screenName:t}=e;this.closeScreen(t)}}init(){this.listenEvents(),console.info("Screen Manager: Initialized")}listenEvents(){lq.on(hq.OPEN_SCREEN,this.handleOpenScreen),lq.on(hq.CLOSE_SCREEN,this.handleCloseScreen)}reorderScreens(){const e=dq.vals(this.screens).filter((e=>"ready"===e.state));e.sort(((e,t)=>e.order-t.order));for(let t=0;t<e.length;t++){const i=e[t];i.order=t,i.comp.node.setSiblingIndex(i.order)}}addScreenKeys(e,t){e.forEach(((e,i)=>{this.screens[Hi[e]]&&(this.screens[Hi[e]].order=i),this.screens[Hi[e]]={state:"key",parent:t,key:e,order:i}}))}addScreens(e){e.forEach(((e,t)=>{this.screens[e.node.name]={state:"ready",comp:e,order:t}}))}async preloadScreens(){const e=dq.vals(this.screens).reduce(((e,t)=>{if("key"===t.state){const i=ci.loadPrefabAsync(`screens/${Hi[t.key]}`);e.push(i)}return e}),[]);return await Promise.all(e)}async getScreen(e){const t=this.screens[e];if(null==t)return cq?.sendException(new Error(`ScreenManager.openScreen Screen ${e} not found`),{screenName:e,screens:this.getScreensAsMetadata()}),null;if("ready"===t.state)return t.comp;console.info("ScreenManager.getScreen",`Screen ${e} not found in cache, instantiating it...`);const{parent:i,key:n,order:a}=t,s=await ci.loadPrefabAsync(`screens/${Hi[n]}`);if(!s)return cq?.sendException(new Error(`ScreenManager.getScreen: Failed to load Screen ${e} prefab...`),{screenName:e,screens:this.getScreensAsMetadata()}),null;const o=c(s);o.name=e,i.addChild(o),o.active=!1;const r=o.getComponent(Lk);return r?(this.screens[e]={state:"ready",comp:r,order:a},this.reorderScreens(),r):(cq?.sendException(new Error(`ScreenManager.getScreen: Screen ${e} prefab doesn't have BaseScreen component...`),{screenName:e,screens:this.getScreensAsMetadata()}),null)}getScreensAsMetadata(){return Object.keys(this.screens).map((e=>{const t=this.screens[e];return"ready"===t.state?`${t.comp.node.name}(loaded)`:`${Hi[t.key]}(notloaded)`})).join(", ")}clearScreens(){this.screens={}}async openScreen(e,t){try{ci.setBlockInput(!0);const i=await this.getScreen(e);if(ci.setBlockInput(!1),!i?.node)return void console.warn("ScreenManager.openScreen",`Screen ${e} not found`);i.node.active=!0,i.node.setPosition(new j(0,0,0));const n={screenName:e,screenData:t};lq.emit(hq.OPENING_SCREEN,n),Yi.trackCurrentPage(e,!0),cq?.addMetadata({currentScreen:e}),await vt.waitTweenAsync(0),i.open(t),lq.emit(hq.OPENED_SCREEN,n)}catch(e){console.error("ScreenManager.openScreen",e)}}async closeScreen(e){try{const t=await this.getScreen(e);if(!t)return void console.warn("ScreenManager.closeScreen",`Screen ${e} not found`);if(!t.node?.active)return;const i={screenName:e};lq.emit(hq.CLOSING_SCREEN,i),t.close(),Yi.trackCurrentPage(e,!1),cq?.removeMetadata("currentScreen")}catch(e){console.error("ScreenManager.closeScreen",e)}}closeAllScreens(){Object.keys(this.screens).forEach((e=>{"ready"===this.screens[e].state&&this.closeScreen(e)}))}}i._RF.pop(),i._RF.push({},"a851bnZR1RCUILrjMPf7nMm","CorecosSystem",void 0);const{Configs:{Core:pq},Events:mq,Plugins:{Analytics:{Events:gq}}}=GameCore,{context:yq,storage:bq,event:fq,analytics:wq,monitorError:Sq}=globalThis.game;new class{constructor(){this.coreManager=new qH,this.matchManager=new hV,this.sceneManager=new rq,this.screenManager=new uq,this.engineManager=new YH,this.layoutManager=new iV,this.playerManager=new yV,this.pluginsManager=new tq,this.handleWhenCoreBoot=()=>{W.inited?this.handleCocosInit():W.once(Se.EVENT_POST_PROJECT_INIT,this.handleCocosInit)},this.handleCocosInit=()=>{this.coreManager.requestStart()},this.handleWhenCoreStart=()=>{this.playerManager.setupDefaultGameData(),this.matchManager.setupDefaultMatchData(),console.groupEnd()},this.handleWhenCoreReady=()=>{this.initPlugins(),console.groupEnd(),pq.StartSDKAfterLoadGame?fq.once(mq.SCENE_LOADED,this.handleStartGameWhenMainSceneReady):this.processStartGame(),this.preloadScenes()},this.handleStartGameWhenMainSceneReady=()=>{this.processStartGame()},this.handleSwitchScene=e=>{const{sceneName:t}=e,i=this.sceneManager.getCurrentScene();if(i?.name!==t)return;this.screenManager.closeAllScreens(),this.screenManager.clearScreens();const n=i?.getComponentsInChildren(Lk);if(n.length>0){const e=n.map((e=>e.node.name)).join(", ");console.info(` Loaded Screens in ${t}: ${e}`),this.screenManager.addScreens(n)}const a=i?.getComponentInChildren(Gk);if(!a)return;const s=a.screenKeys.filter((e=>!n.some((t=>t.node.name===Hi[e]))));if(0===s.length)return;const o=s.map((e=>Hi[e])).join(", ");console.info(` Lazy-loading Screens in ${t}: ${o}`),this.screenManager.addScreenKeys(s,a.node),this.screenManager.preloadScreens()},console.groupCollapsed(" Corecos System"),console.info("Corecos Initializing..."),this.listenEvents(),this.initManagers(),console.groupEnd()}initManagers(){this.coreManager.init(),this.engineManager.init(),this.layoutManager.init(),this.sceneManager.init(),this.screenManager.init(),this.playerManager.init(),this.matchManager.init(),this.pluginsManager.init()}listenEvents(){this.coreManager.onCoreBoot(this.handleWhenCoreBoot),this.coreManager.onCoreStart(this.handleWhenCoreStart),this.coreManager.onCoreReady(this.handleWhenCoreReady),this.sceneManager.onSwitchScene(this.handleSwitchScene)}preloadScenes(){"solo"===bq.getStorageData("context","sessionContextType")?El.preloadDashboardScene():El.preloadGameScene()}async processStartGame(){console.groupEnd(),wq.event(gq.LOAD_COMPLETE),await this.startGameAsync(),this.startProcessContextData(),this.playerManager.requestConnectedPlayers(),wq.event(gq.APP_READY,{success:!0}),fq.emit(mq.GAME_READY)}async startGameAsync(){try{await GameSDK.startGameAsync(),wq.event(gq.GAME_SDK_READY,{success:!0})}catch(e){console.warn("GameSDK.startGameAsync",e),wq.event(gq.GAME_SDK_READY,{success:!1}),e instanceof Error&&Sq?.sendException(e)}}startProcessContextData(){fq.getEventEmitCount(mq.PLAYER_INFO_LOADED)?yq.processContextData().catch((e=>{console.error("startProcessContextData",e)})):fq.once(mq.PLAYER_INFO_LOADED,this.startProcessContextData)}initPlugins(){this.pluginsManager.initLeaderboards(),this.pluginsManager.initDynamicAssets(),this.pluginsManager.initCanvasRecorder(),this.pluginsManager.initPerformanceMonitor(),this.pluginsManager.initAdaptivePerformance()}},i._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/start-scene', 'chunks:///start-scene.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});